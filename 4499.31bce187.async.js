var ty=(Sr,oe,Z)=>new Promise((ye,se)=>{var y=ce=>{try{V(Z.next(ce))}catch(ae){se(ae)}},de=ce=>{try{V(Z.throw(ce))}catch(ae){se(ae)}},V=ce=>ce.done?ye(ce.value):Promise.resolve(ce.value).then(y,de);V((Z=Z.apply(Sr,oe)).next())});(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[4499],{64335:function(Sr,oe,Z){"use strict";var ye=Z(67294),se=(0,ye.createContext)({});oe.Z=se},21349:function(Sr,oe,Z){"use strict";var ye=Z(84305),se=Z(39559),y=Z(85893),de=Z(94184),V=Z.n(de),ce=Z(67294),ae=Z(64335),Be=Z(53645),ie=Z.n(Be),Ve=function(it){var Ct=(0,ce.useContext)(ae.Z),Tt=it.children,Xt=it.contentWidth,ir=it.className,Ft=it.style,Rt=(0,ce.useContext)(se.ZP.ConfigContext),xt=Rt.getPrefixCls,Zr=it.prefixCls||xt("pro"),Tr=Xt||Ct.contentWidth,dr="".concat(Zr,"-grid-content");return(0,y.jsx)("div",{className:V()(dr,ir,{wide:Tr==="Fixed"}),style:Ft,children:(0,y.jsx)("div",{className:"".concat(Zr,"-grid-content-children"),children:Tt})})};oe.Z=Ve},90857:function(Sr){"use strict";var oe=Object.prototype.hasOwnProperty,Z="~";function ye(){}Object.create&&(ye.prototype=Object.create(null),new ye().__proto__||(Z=!1));function se(ce,ae,Be){this.fn=ce,this.context=ae,this.once=Be||!1}function y(ce,ae,Be,ie,Ve){if(typeof Be!="function")throw new TypeError("The listener must be a function");var rt=new se(Be,ie||ce,Ve),it=Z?Z+ae:ae;return ce._events[it]?ce._events[it].fn?ce._events[it]=[ce._events[it],rt]:ce._events[it].push(rt):(ce._events[it]=rt,ce._eventsCount++),ce}function de(ce,ae){--ce._eventsCount==0?ce._events=new ye:delete ce._events[ae]}function V(){this._events=new ye,this._eventsCount=0}V.prototype.eventNames=function(){var ae=[],Be,ie;if(this._eventsCount===0)return ae;for(ie in Be=this._events)oe.call(Be,ie)&&ae.push(Z?ie.slice(1):ie);return Object.getOwnPropertySymbols?ae.concat(Object.getOwnPropertySymbols(Be)):ae},V.prototype.listeners=function(ae){var Be=Z?Z+ae:ae,ie=this._events[Be];if(!ie)return[];if(ie.fn)return[ie.fn];for(var Ve=0,rt=ie.length,it=new Array(rt);Ve<rt;Ve++)it[Ve]=ie[Ve].fn;return it},V.prototype.listenerCount=function(ae){var Be=Z?Z+ae:ae,ie=this._events[Be];return ie?ie.fn?1:ie.length:0},V.prototype.emit=function(ae,Be,ie,Ve,rt,it){var Ct=Z?Z+ae:ae;if(!this._events[Ct])return!1;var Tt=this._events[Ct],Xt=arguments.length,ir,Ft;if(Tt.fn){switch(Tt.once&&this.removeListener(ae,Tt.fn,void 0,!0),Xt){case 1:return Tt.fn.call(Tt.context),!0;case 2:return Tt.fn.call(Tt.context,Be),!0;case 3:return Tt.fn.call(Tt.context,Be,ie),!0;case 4:return Tt.fn.call(Tt.context,Be,ie,Ve),!0;case 5:return Tt.fn.call(Tt.context,Be,ie,Ve,rt),!0;case 6:return Tt.fn.call(Tt.context,Be,ie,Ve,rt,it),!0}for(Ft=1,ir=new Array(Xt-1);Ft<Xt;Ft++)ir[Ft-1]=arguments[Ft];Tt.fn.apply(Tt.context,ir)}else{var Rt=Tt.length,xt;for(Ft=0;Ft<Rt;Ft++)switch(Tt[Ft].once&&this.removeListener(ae,Tt[Ft].fn,void 0,!0),Xt){case 1:Tt[Ft].fn.call(Tt[Ft].context);break;case 2:Tt[Ft].fn.call(Tt[Ft].context,Be);break;case 3:Tt[Ft].fn.call(Tt[Ft].context,Be,ie);break;case 4:Tt[Ft].fn.call(Tt[Ft].context,Be,ie,Ve);break;default:if(!ir)for(xt=1,ir=new Array(Xt-1);xt<Xt;xt++)ir[xt-1]=arguments[xt];Tt[Ft].fn.apply(Tt[Ft].context,ir)}}return!0},V.prototype.on=function(ae,Be,ie){return y(this,ae,Be,ie,!1)},V.prototype.once=function(ae,Be,ie){return y(this,ae,Be,ie,!0)},V.prototype.removeListener=function(ae,Be,ie,Ve){var rt=Z?Z+ae:ae;if(!this._events[rt])return this;if(!Be)return de(this,rt),this;var it=this._events[rt];if(it.fn)it.fn===Be&&(!Ve||it.once)&&(!ie||it.context===ie)&&de(this,rt);else{for(var Ct=0,Tt=[],Xt=it.length;Ct<Xt;Ct++)(it[Ct].fn!==Be||Ve&&!it[Ct].once||ie&&it[Ct].context!==ie)&&Tt.push(it[Ct]);Tt.length?this._events[rt]=Tt.length===1?Tt[0]:Tt:de(this,rt)}return this},V.prototype.removeAllListeners=function(ae){var Be;return ae?(Be=Z?Z+ae:ae,this._events[Be]&&de(this,Be)):(this._events=new ye,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=Z,V.EventEmitter=V,Sr.exports=V},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Sr){try{let ie=function(){V||(V=!0,y())},Ve=function(){try{de.documentElement.doScroll("left")}catch(rt){return void setTimeout(Ve,50)}ie()};var ae=ie,Be=Ve,oe=(oe=document.getElementsByTagName("script"))[oe.length-1],Z=oe.getAttribute("data-injectcss"),oe=oe.getAttribute("data-disable-injectsvg");if(!oe){var ye,se,y,de,V,ce=function(it,Ct){Ct.parentNode.insertBefore(it,Ct)};if(Z&&!Sr.__iconfont__svg__cssinject__){Sr.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(rt){console&&console.log(rt)}}ye=function(){var it,Ct=document.createElement("div");Ct.innerHTML=Sr._iconfont_svg_string_3580659,(Ct=Ct.getElementsByTagName("svg")[0])&&(Ct.setAttribute("aria-hidden","true"),Ct.style.position="absolute",Ct.style.width=0,Ct.style.height=0,Ct.style.overflow="hidden",Ct=Ct,(it=document.body).firstChild?ce(Ct,it.firstChild):it.appendChild(Ct))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(ye,0):(se=function(){document.removeEventListener("DOMContentLoaded",se,!1),ye()},document.addEventListener("DOMContentLoaded",se,!1)):document.attachEvent&&(y=ye,de=Sr.document,V=!1,Ve(),de.onreadystatechange=function(){de.readyState=="complete"&&(de.onreadystatechange=null,ie())})}}catch(ie){}}(window)},83557:function(Sr,oe,Z){var ye=Z(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var se;(function(y){(function(de){var V=typeof Z.g=="object"?Z.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=ae(y);typeof V.Reflect=="undefined"?V.Reflect=y:ce=ae(V.Reflect,ce),de(ce);function ae(Be,ie){return function(Ve,rt){typeof Be[Ve]!="function"&&Object.defineProperty(Be,Ve,{configurable:!0,writable:!0,value:rt}),ie&&ie(Ve,rt)}}})(function(de){var V=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",ae=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Be=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ie=typeof Object.create=="function",Ve={__proto__:[]}instanceof Array,rt=!ie&&!Ve,it={create:ie?function(){return bs(Object.create(null))}:Ve?function(){return bs({__proto__:null})}:function(){return bs({})},has:rt?function(Vt,gr){return V.call(Vt,gr)}:function(Vt,gr){return gr in Vt},get:rt?function(Vt,gr){return V.call(Vt,gr)?Vt[gr]:void 0}:function(Vt,gr){return Vt[gr]}},Ct=Object.getPrototypeOf(Function),Tt=typeof ye=="object"&&ye["env"]&&ye["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",Xt=!Tt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:eo(),ir=!Tt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ws(),Ft=!Tt&&typeof WeakMap=="function"?WeakMap:xs(),Rt=new Ft;function xt(Vt,gr,Gr,an){if(ar(Gr)){if(!ea(Vt))throw new TypeError;if(!kn(gr))throw new TypeError;return te(Vt,gr)}else{if(!ea(Vt))throw new TypeError;if(!nn(gr))throw new TypeError;if(!nn(an)&&!ar(an)&&!Dn(an))throw new TypeError;return Dn(an)&&(an=void 0),Gr=hi(Gr),Ne(Vt,gr,Gr,an)}}de("decorate",xt);function Zr(Vt,gr){function Gr(an,Zn){if(!nn(an))throw new TypeError;if(!ar(Zn)&&!Ea(Zn))throw new TypeError;kt(Vt,gr,an,Zn)}return Gr}de("metadata",Zr);function Tr(Vt,gr,Gr,an){if(!nn(Gr))throw new TypeError;return ar(an)||(an=hi(an)),kt(Vt,gr,Gr,an)}de("defineMetadata",Tr);function dr(Vt,gr,Gr){if(!nn(gr))throw new TypeError;return ar(Gr)||(Gr=hi(Gr)),ke(Vt,gr,Gr)}de("hasMetadata",dr);function Mt(Vt,gr,Gr){if(!nn(gr))throw new TypeError;return ar(Gr)||(Gr=hi(Gr)),Re(Vt,gr,Gr)}de("hasOwnMetadata",Mt);function lt(Vt,gr,Gr){if(!nn(gr))throw new TypeError;return ar(Gr)||(Gr=hi(Gr)),ct(Vt,gr,Gr)}de("getMetadata",lt);function Bt(Vt,gr,Gr){if(!nn(gr))throw new TypeError;return ar(Gr)||(Gr=hi(Gr)),Et(Vt,gr,Gr)}de("getOwnMetadata",Bt);function pt(Vt,gr){if(!nn(Vt))throw new TypeError;return ar(gr)||(gr=hi(gr)),er(Vt,gr)}de("getMetadataKeys",pt);function ur(Vt,gr){if(!nn(Vt))throw new TypeError;return ar(gr)||(gr=hi(gr)),rr(Vt,gr)}de("getOwnMetadataKeys",ur);function Ar(Vt,gr,Gr){if(!nn(gr))throw new TypeError;ar(Gr)||(Gr=hi(Gr));var an=k(gr,Gr,!1);if(ar(an)||!an.delete(Vt))return!1;if(an.size>0)return!0;var Zn=Rt.get(gr);return Zn.delete(Gr),Zn.size>0||Rt.delete(gr),!0}de("deleteMetadata",Ar);function te(Vt,gr){for(var Gr=Vt.length-1;Gr>=0;--Gr){var an=Vt[Gr],Zn=an(gr);if(!ar(Zn)&&!Dn(Zn)){if(!kn(Zn))throw new TypeError;gr=Zn}}return gr}function Ne(Vt,gr,Gr,an){for(var Zn=Vt.length-1;Zn>=0;--Zn){var Hi=Vt[Zn],fe=Hi(gr,Gr,an);if(!ar(fe)&&!Dn(fe)){if(!nn(fe))throw new TypeError;an=fe}}return an}function k(Vt,gr,Gr){var an=Rt.get(Vt);if(ar(an)){if(!Gr)return;an=new Xt,Rt.set(Vt,an)}var Zn=an.get(gr);if(ar(Zn)){if(!Gr)return;Zn=new Xt,an.set(gr,Zn)}return Zn}function ke(Vt,gr,Gr){var an=Re(Vt,gr,Gr);if(an)return!0;var Zn=sa(gr);return Dn(Zn)?!1:ke(Vt,Zn,Gr)}function Re(Vt,gr,Gr){var an=k(gr,Gr,!1);return ar(an)?!1:En(an.has(Vt))}function ct(Vt,gr,Gr){var an=Re(Vt,gr,Gr);if(an)return Et(Vt,gr,Gr);var Zn=sa(gr);if(!Dn(Zn))return ct(Vt,Zn,Gr)}function Et(Vt,gr,Gr){var an=k(gr,Gr,!1);if(!ar(an))return an.get(Vt)}function kt(Vt,gr,Gr,an){var Zn=k(Gr,an,!0);Zn.set(Vt,gr)}function er(Vt,gr){var Gr=rr(Vt,gr),an=sa(Vt);if(an===null)return Gr;var Zn=er(an,gr);if(Zn.length<=0)return Gr;if(Gr.length<=0)return Zn;for(var Hi=new ir,fe=[],D=0,z=Gr;D<z.length;D++){var ne=z[D],Ae=Hi.has(ne);Ae||(Hi.add(ne),fe.push(ne))}for(var De=0,Zt=Zn;De<Zt.length;De++){var ne=Zt[De],Ae=Hi.has(ne);Ae||(Hi.add(ne),fe.push(ne))}return fe}function rr(Vt,gr){var Gr=[],an=k(Vt,gr,!1);if(ar(an))return Gr;for(var Zn=an.keys(),Hi=ja(Zn),fe=0;;){var D=Me(Hi);if(!D)return Gr.length=fe,Gr;var z=Ha(D);try{Gr[fe]=z}catch(ne){try{Wa(Hi)}finally{throw ne}}fe++}}function fn(Vt){if(Vt===null)return 1;switch(typeof Vt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Vt===null?1:6;default:return 6}}function ar(Vt){return Vt===void 0}function Dn(Vt){return Vt===null}function hn(Vt){return typeof Vt=="symbol"}function nn(Vt){return typeof Vt=="object"?Vt!==null:typeof Vt=="function"}function ri(Vt,gr){switch(fn(Vt)){case 0:return Vt;case 1:return Vt;case 2:return Vt;case 3:return Vt;case 4:return Vt;case 5:return Vt}var Gr=gr===3?"string":gr===5?"number":"default",an=ji(Vt,ae);if(an!==void 0){var Zn=an.call(Vt,Gr);if(nn(Zn))throw new TypeError;return Zn}return qn(Vt,Gr==="default"?"number":Gr)}function qn(Vt,gr){if(gr==="string"){var Gr=Vt.toString;if(Tn(Gr)){var an=Gr.call(Vt);if(!nn(an))return an}var Zn=Vt.valueOf;if(Tn(Zn)){var an=Zn.call(Vt);if(!nn(an))return an}}else{var Zn=Vt.valueOf;if(Tn(Zn)){var an=Zn.call(Vt);if(!nn(an))return an}var Hi=Vt.toString;if(Tn(Hi)){var an=Hi.call(Vt);if(!nn(an))return an}}throw new TypeError}function En(Vt){return!!Vt}function Ti(Vt){return""+Vt}function hi(Vt){var gr=ri(Vt,3);return hn(gr)?gr:Ti(gr)}function ea(Vt){return Array.isArray?Array.isArray(Vt):Vt instanceof Object?Vt instanceof Array:Object.prototype.toString.call(Vt)==="[object Array]"}function Tn(Vt){return typeof Vt=="function"}function kn(Vt){return typeof Vt=="function"}function Ea(Vt){switch(fn(Vt)){case 3:return!0;case 4:return!0;default:return!1}}function ji(Vt,gr){var Gr=Vt[gr];if(Gr!=null){if(!Tn(Gr))throw new TypeError;return Gr}}function ja(Vt){var gr=ji(Vt,Be);if(!Tn(gr))throw new TypeError;var Gr=gr.call(Vt);if(!nn(Gr))throw new TypeError;return Gr}function Ha(Vt){return Vt.value}function Me(Vt){var gr=Vt.next();return gr.done?!1:gr}function Wa(Vt){var gr=Vt.return;gr&&gr.call(Vt)}function sa(Vt){var gr=Object.getPrototypeOf(Vt);if(typeof Vt!="function"||Vt===Ct||gr!==Ct)return gr;var Gr=Vt.prototype,an=Gr&&Object.getPrototypeOf(Gr);if(an==null||an===Object.prototype)return gr;var Zn=an.constructor;return typeof Zn!="function"||Zn===Vt?gr:Zn}function eo(){var Vt={},gr=[],Gr=function(){function fe(D,z,ne){this._index=0,this._keys=D,this._values=z,this._selector=ne}return fe.prototype["@@iterator"]=function(){return this},fe.prototype[Be]=function(){return this},fe.prototype.next=function(){var D=this._index;if(D>=0&&D<this._keys.length){var z=this._selector(this._keys[D],this._values[D]);return D+1>=this._keys.length?(this._index=-1,this._keys=gr,this._values=gr):this._index++,{value:z,done:!1}}return{value:void 0,done:!0}},fe.prototype.throw=function(D){throw this._index>=0&&(this._index=-1,this._keys=gr,this._values=gr),D},fe.prototype.return=function(D){return this._index>=0&&(this._index=-1,this._keys=gr,this._values=gr),{value:D,done:!0}},fe}();return function(){function fe(){this._keys=[],this._values=[],this._cacheKey=Vt,this._cacheIndex=-2}return Object.defineProperty(fe.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),fe.prototype.has=function(D){return this._find(D,!1)>=0},fe.prototype.get=function(D){var z=this._find(D,!1);return z>=0?this._values[z]:void 0},fe.prototype.set=function(D,z){var ne=this._find(D,!0);return this._values[ne]=z,this},fe.prototype.delete=function(D){var z=this._find(D,!1);if(z>=0){for(var ne=this._keys.length,Ae=z+1;Ae<ne;Ae++)this._keys[Ae-1]=this._keys[Ae],this._values[Ae-1]=this._values[Ae];return this._keys.length--,this._values.length--,D===this._cacheKey&&(this._cacheKey=Vt,this._cacheIndex=-2),!0}return!1},fe.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Vt,this._cacheIndex=-2},fe.prototype.keys=function(){return new Gr(this._keys,this._values,an)},fe.prototype.values=function(){return new Gr(this._keys,this._values,Zn)},fe.prototype.entries=function(){return new Gr(this._keys,this._values,Hi)},fe.prototype["@@iterator"]=function(){return this.entries()},fe.prototype[Be]=function(){return this.entries()},fe.prototype._find=function(D,z){return this._cacheKey!==D&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=D)),this._cacheIndex<0&&z&&(this._cacheIndex=this._keys.length,this._keys.push(D),this._values.push(void 0)),this._cacheIndex},fe}();function an(fe,D){return fe}function Zn(fe,D){return D}function Hi(fe,D){return[fe,D]}}function Ws(){return function(){function Vt(){this._map=new Xt}return Object.defineProperty(Vt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Vt.prototype.has=function(gr){return this._map.has(gr)},Vt.prototype.add=function(gr){return this._map.set(gr,gr),this},Vt.prototype.delete=function(gr){return this._map.delete(gr)},Vt.prototype.clear=function(){this._map.clear()},Vt.prototype.keys=function(){return this._map.keys()},Vt.prototype.values=function(){return this._map.values()},Vt.prototype.entries=function(){return this._map.entries()},Vt.prototype["@@iterator"]=function(){return this.keys()},Vt.prototype[Be]=function(){return this.keys()},Vt}()}function xs(){var Vt=16,gr=it.create(),Gr=an();return function(){function z(){this._key=an()}return z.prototype.has=function(ne){var Ae=Zn(ne,!1);return Ae!==void 0?it.has(Ae,this._key):!1},z.prototype.get=function(ne){var Ae=Zn(ne,!1);return Ae!==void 0?it.get(Ae,this._key):void 0},z.prototype.set=function(ne,Ae){var De=Zn(ne,!0);return De[this._key]=Ae,this},z.prototype.delete=function(ne){var Ae=Zn(ne,!1);return Ae!==void 0?delete Ae[this._key]:!1},z.prototype.clear=function(){this._key=an()},z}();function an(){var z;do z="@@WeakMap@@"+D();while(it.has(gr,z));return gr[z]=!0,z}function Zn(z,ne){if(!V.call(z,Gr)){if(!ne)return;Object.defineProperty(z,Gr,{value:it.create()})}return z[Gr]}function Hi(z,ne){for(var Ae=0;Ae<ne;++Ae)z[Ae]=Math.random()*255|0;return z}function fe(z){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(z)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(z)):Hi(new Uint8Array(z),z):Hi(new Array(z),z)}function D(){var z=fe(Vt);z[6]=z[6]&79|64,z[8]=z[8]&191|128;for(var ne="",Ae=0;Ae<Vt;++Ae){var De=z[Ae];(Ae===4||Ae===6||Ae===8)&&(ne+="-"),De<16&&(ne+="0"),ne+=De.toString(16).toLowerCase()}return ne}}function bs(Vt){return Vt.__=void 0,delete Vt.__,Vt}})})(se||(se={}))},53614:function(Sr,oe,Z){"use strict";Z.d(oe,{zP:function(){return CF},JE:function(){return TB},ns:function(){return wF}});var ye={};Z.r(ye),Z.d(ye,{add:function(){return uf},adjoint:function(){return oi},clone:function(){return wr},copy:function(){return xr},create:function(){return or},determinant:function(){return Ji},equals:function(){return Bc},exactEquals:function(){return ts},frob:function(){return lp},fromQuat:function(){return g0},fromQuat2:function(){return p0},fromRotation:function(){return h0},fromRotationTranslation:function(){return Ch},fromRotationTranslationScale:function(){return v0},fromRotationTranslationScaleOrigin:function(){return m0},fromScaling:function(){return f0},fromTranslation:function(){return Gv},fromValues:function(){return Pr},fromXRotation:function(){return Hd},fromYRotation:function(){return wh},fromZRotation:function(){return Xv},frustum:function(){return _0},getRotation:function(){return d0},getScaling:function(){return Ia},getTranslation:function(){return Fo},identity:function(){return Sn},invert:function(){return Wn},lookAt:function(){return Gd},mul:function(){return b0},multiply:function(){return xa},multiplyScalar:function(){return x0},multiplyScalarAndAdd:function(){return Bg},ortho:function(){return Qp},orthoNO:function(){return ko},orthoZO:function(){return sf},perspective:function(){return Wf},perspectiveFromFieldOfView:function(){return y0},perspectiveNO:function(){return Wd},perspectiveZO:function(){return Rh},rotate:function(){return $u},rotateX:function(){return Ah},rotateY:function(){return gl},rotateZ:function(){return Th},scale:function(){return of},set:function(){return On},str:function(){return $v},sub:function(){return o},subtract:function(){return Yv},targetTo:function(){return Xd},translate:function(){return eu},transpose:function(){return wn}});var se=Z(67294),y=(0,se.createContext)({});function de(){return(0,se.useContext)(y)}var V={},ce={},ae=function(r){return ce[r]},Be=function(r,t){ce[r]=t},ie=function(r){return V[r]},Ve=function(r,t){V[r]=t},rt={},it={},Ct=34,Tt=10,Xt=13;function ir(e){return new Function("d","return {"+e.map(function(r,t){return JSON.stringify(r)+": d["+t+'] || ""'}).join(",")+"}")}function Ft(e,r){var t=ir(e);return function(n,i){return r(t(n),i,e)}}function Rt(e){var r=Object.create(null),t=[];return e.forEach(function(n){for(var i in n)i in r||t.push(r[i]=i)}),t}function xt(e,r){var t=e+"",n=t.length;return n<r?new Array(r-n+1).join(0)+t:t}function Zr(e){return e<0?"-"+xt(-e,6):e>9999?"+"+xt(e,6):xt(e,4)}function Tr(e){var r=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Zr(e.getUTCFullYear(),4)+"-"+xt(e.getUTCMonth()+1,2)+"-"+xt(e.getUTCDate(),2)+(i?"T"+xt(r,2)+":"+xt(t,2)+":"+xt(n,2)+"."+xt(i,3)+"Z":n?"T"+xt(r,2)+":"+xt(t,2)+":"+xt(n,2)+"Z":t||r?"T"+xt(r,2)+":"+xt(t,2)+"Z":"")}function dr(e){var r=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(b,A){var w,I,P=i(b,function(B,H){if(w)return w(B,H-1);I=B,w=A?Ft(B,A):ir(B)});return P.columns=I||[],P}function i(b,A){var w=[],I=b.length,P=0,B=0,H,Q=I<=0,ue=!1;b.charCodeAt(I-1)===Tt&&--I,b.charCodeAt(I-1)===Xt&&--I;function Ee(){if(Q)return it;if(ue)return ue=!1,rt;var Ze,tt=P,ft;if(b.charCodeAt(tt)===Ct){for(;P++<I&&b.charCodeAt(P)!==Ct||b.charCodeAt(++P)===Ct;);return(Ze=P)>=I?Q=!0:(ft=b.charCodeAt(P++))===Tt?ue=!0:ft===Xt&&(ue=!0,b.charCodeAt(P)===Tt&&++P),b.slice(tt+1,Ze-1).replace(/""/g,'"')}for(;P<I;){if((ft=b.charCodeAt(Ze=P++))===Tt)ue=!0;else if(ft===Xt)ue=!0,b.charCodeAt(P)===Tt&&++P;else if(ft!==t)continue;return b.slice(tt,Ze)}return Q=!0,b.slice(tt,I)}for(;(H=Ee())!==it;){for(var Le=[];H!==rt&&H!==it;)Le.push(H),H=Ee();A&&(Le=A(Le,B++))==null||w.push(Le)}return w}function a(b,A){return b.map(function(w){return A.map(function(I){return _(w[I])}).join(e)})}function s(b,A){return A==null&&(A=Rt(b)),[A.map(_).join(e)].concat(a(b,A)).join(`
`)}function l(b,A){return A==null&&(A=Rt(b)),a(b,A).join(`
`)}function c(b){return b.map(p).join(`
`)}function p(b){return b.map(_).join(e)}function _(b){return b==null?"":b instanceof Date?Tr(b):r.test(b+="")?'"'+b.replace(/"/g,'""')+'"':b}return{parse:n,parseRows:i,format:s,formatBody:l,formatRows:c,formatRow:p,formatValue:_}}var Mt=dr(","),lt=Mt.parse,Bt=Mt.parseRows,pt=Mt.format,ur=Mt.formatBody,Ar=Mt.formatRows,te=Mt.formatRow,Ne=Mt.formatValue,k=Z(28991),ke=63710088e-1,Re={centimeters:ke*100,centimetres:ke*100,degrees:ke/111325,feet:ke*3.28084,inches:ke*39.37,kilometers:ke/1e3,kilometres:ke/1e3,meters:ke,metres:ke,miles:ke/1609.344,millimeters:ke*1e3,millimetres:ke*1e3,nauticalmiles:ke/1852,radians:1,yards:ke*1.0936},ct={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ke,yards:1.0936133},Et={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function kt(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function er(e,r,t){switch(t===void 0&&(t={}),e){case"Point":return rr(r).geometry;case"LineString":return hn(r).geometry;case"Polygon":return ar(r).geometry;case"MultiPoint":return En(r).geometry;case"MultiLineString":return qn(r).geometry;case"MultiPolygon":return Ti(r).geometry;default:throw new Error(e+" is invalid")}}function rr(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!sa(e[0])||!sa(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return kt(n,r,t)}function fn(e,r,t){return t===void 0&&(t={}),ri(e.map(function(n){return rr(n,r)}),t)}function ar(e,r,t){t===void 0&&(t={});for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return kt(l,r,t)}function Dn(e,r,t){return t===void 0&&(t={}),ri(e.map(function(n){return ar(n,r)}),t)}function hn(e,r,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return kt(n,r,t)}function nn(e,r,t){return t===void 0&&(t={}),ri(e.map(function(n){return hn(n,r)}),t)}function ri(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function qn(e,r,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return kt(n,r,t)}function En(e,r,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return kt(n,r,t)}function Ti(e,r,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return kt(n,r,t)}function hi(e,r,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return kt(n,r,t)}function ea(e,r){if(r===void 0&&(r=0),r&&!(r>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,r||0);return Math.round(e*t)/t}function Tn(e,r){r===void 0&&(r="kilometers");var t=Re[r];if(!t)throw new Error(r+" units is invalid");return e*t}function kn(e,r){r===void 0&&(r="kilometers");var t=Re[r];if(!t)throw new Error(r+" units is invalid");return e/t}function Ea(e,r){return ja(kn(e,r))}function ji(e){var r=e%360;return r<0&&(r+=360),r}function ja(e){var r=e%(2*Math.PI);return r*180/Math.PI}function Ha(e){var r=e%360;return r*Math.PI/180}function Me(e,r,t){if(r===void 0&&(r="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Tn(kn(e,r),t)}function Wa(e,r,t){if(r===void 0&&(r="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=Et[r];if(!n)throw new Error("invalid original units");var i=Et[t];if(!i)throw new Error("invalid final units");return e/n*i}function sa(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function eo(e){return!!e&&e.constructor===Object}function Ws(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(r){if(!sa(r))throw new Error("bbox must only contain numbers")})}function xs(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function bs(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Vt(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function gr(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return gr(e[0]);throw new Error("coordinates must only contain numbers")}function Gr(e,r,t){if(!r||!t)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.type)}function an(e,r,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.geometry.type)}function Zn(e,r,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var a=i[n];if(!a||a.type!=="Feature"||!a.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!a.geometry||a.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+a.geometry.type)}}function Hi(e){return e.type==="Feature"?e.geometry:e}function fe(e,r){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function D(e,r,t){if(e!==null)for(var n,i,a,s,l,c,p,_=0,b=0,A,w=e.type,I=w==="FeatureCollection",P=w==="Feature",B=I?e.features.length:1,H=0;H<B;H++){p=I?e.features[H].geometry:P?e.geometry:e,A=p?p.type==="GeometryCollection":!1,l=A?p.geometries.length:1;for(var Q=0;Q<l;Q++){var ue=0,Ee=0;if(s=A?p.geometries[Q]:p,s!==null){c=s.coordinates;var Le=s.type;switch(_=t&&(Le==="Polygon"||Le==="MultiPolygon")?1:0,Le){case null:break;case"Point":if(r(c,b,H,ue,Ee)===!1)return!1;b++,ue++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(r(c[n],b,H,ue,Ee)===!1)return!1;b++,Le==="MultiPoint"&&ue++}Le==="LineString"&&ue++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(i=0;i<c[n].length-_;i++){if(r(c[n][i],b,H,ue,Ee)===!1)return!1;b++}Le==="MultiLineString"&&ue++,Le==="Polygon"&&Ee++}Le==="Polygon"&&ue++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(Ee=0,i=0;i<c[n].length;i++){for(a=0;a<c[n][i].length-_;a++){if(r(c[n][i][a],b,H,ue,Ee)===!1)return!1;b++}Ee++}ue++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(D(s.geometries[n],r,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function z(e,r,t,n){var i=t;return D(e,function(a,s,l,c,p){s===0&&t===void 0?i=a:i=r(i,a,s,l,c,p)},n),i}function ne(e,r){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&r(e.features[t].properties,t)!==!1;t++);break;case"Feature":r(e.properties,0);break}}function Ae(e,r,t){var n=t;return ne(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function De(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&r(e.features[t],t)!==!1;t++);}function Zt(e,r,t){var n=t;return De(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function St(e){var r=[];return D(e,function(t){r.push(t)}),r}function At(e,r){var t,n,i,a,s,l,c,p,_,b,A=0,w=e.type==="FeatureCollection",I=e.type==="Feature",P=w?e.features.length:1;for(t=0;t<P;t++){for(l=w?e.features[t].geometry:I?e.geometry:e,p=w?e.features[t].properties:I?e.properties:{},_=w?e.features[t].bbox:I?e.bbox:void 0,b=w?e.features[t].id:I?e.id:void 0,c=l?l.type==="GeometryCollection":!1,s=c?l.geometries.length:1,i=0;i<s;i++){if(a=c?l.geometries[i]:l,a===null){if(r(null,A,p,_,b)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(a,A,p,_,b)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(r(a.geometries[n],A,p,_,b)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function mt(e,r,t){var n=t;return At(e,function(i,a,s,l,c){a===0&&t===void 0?n=i:n=r(n,i,a,s,l,c)}),n}function U(e,r){At(e,function(t,n,i,a,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return r(kt(t,i,{bbox:a,id:s}),n,0)===!1?!1:void 0}var c;switch(l){case"MultiPoint":c="Point";break;case"MultiLineString":c="LineString";break;case"MultiPolygon":c="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var _=t.coordinates[p],b={type:c,coordinates:_};if(r(kt(b,i),n,p)===!1)return!1}})}function F(e,r,t){var n=t;return U(e,function(i,a,s){a===0&&s===0&&t===void 0?n=i:n=r(n,i,a,s)}),n}function X(e,r){U(e,function(t,n,i){var a=0;if(!!t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,c=0,p=0,_=0;if(D(t,function(b,A,w,I,P){if(l===void 0||n>c||I>p||P>_){l=b,c=n,p=I,_=P,a=0;return}var B=lineString([l,b],t.properties);if(r(B,n,i,P,a)===!1)return!1;a++,l=b})===!1)return!1}}})}function ee(e,r,t){var n=t,i=!1;return X(e,function(a,s,l,c,p){i===!1&&t===void 0?n=a:n=r(n,a,s,l,c,p),i=!0}),n}function Se(e,r){if(!e)throw new Error("geojson is required");U(e,function(t,n,i){if(t.geometry!==null){var a=t.geometry.type,s=t.geometry.coordinates;switch(a){case"LineString":if(r(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(r(lineString(s[l],t.properties),n,i,l)===!1)return!1;break}}})}function Ue(e,r,t){var n=t;return Se(e,function(i,a,s,l){a===0&&t===void 0?n=i:n=r(n,i,a,s,l)}),n}function Je(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.segmentIndex||0,s=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),s=s||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var c=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=c.length+a-1),lineString([c[a],c[a+1]],s,r);case"Polygon":return i<0&&(i=c.length+i),a<0&&(a=c[i].length+a-1),lineString([c[i][a],c[i][a+1]],s,r);case"MultiLineString":return n<0&&(n=c.length+n),a<0&&(a=c[n].length+a-1),lineString([c[n][a],c[n][a+1]],s,r);case"MultiPolygon":return n<0&&(n=c.length+n),i<0&&(i=c[n].length+i),a<0&&(a=c[n][i].length-a-1),lineString([c[n][i][a],c[n][i][a+1]],s,r)}throw new Error("geojson is invalid")}function he(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.coordIndex||0,s=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),s=s||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var c=l.coordinates;switch(l.type){case"Point":return point(c,s,r);case"MultiPoint":return n<0&&(n=c.length+n),point(c[n],s,r);case"LineString":return a<0&&(a=c.length+a),point(c[a],s,r);case"Polygon":return i<0&&(i=c.length+i),a<0&&(a=c[i].length+a),point(c[i][a],s,r);case"MultiLineString":return n<0&&(n=c.length+n),a<0&&(a=c[n].length+a),point(c[n][a],s,r);case"MultiPolygon":return n<0&&(n=c.length+n),i<0&&(i=c[n].length+i),a<0&&(a=c[n][i].length-a),point(c[n][i][a],s,r)}throw new Error("geojson is invalid")}var K=Z(5991),ge=Z(6610),Qe=Z(10379),gt=Z(46070),pe=Z(77608),vr=Z(14665);function en(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(r){return typeof e=="function"}}var tn=Z(51814);function Kt(e,r,t){return(0,tn.Z)()?Kt=Reflect.construct.bind():Kt=function(i,a,s){var l=[null];l.push.apply(l,a);var c=Function.bind.apply(i,l),p=new c;return s&&(0,vr.Z)(p,s.prototype),p},Kt.apply(null,arguments)}function $r(e){var r=typeof Map=="function"?new Map:void 0;return $r=function(n){if(n===null||!en(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return Kt(n,arguments,(0,pe.Z)(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),(0,vr.Z)(i,n)},$r(e)}var Br={REGISTERED_PROTOCOLS:{}};function jr(e){var r=ni();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function ni(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var on=function(r){return Br.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]},di=function(e){(0,Qe.Z)(t,e);var r=jr(t);function t(n,i,a,s){var l;return(0,ge.Z)(this,t),l=r.call(this,"AJAXError: ".concat(i," (").concat(n,"): ").concat(a)),l.status=n,l.statusText=i,l.url=a,l.body=s,l}return(0,K.Z)(t)}($r(Error));function Fi(e,r){var t=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;t.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&t.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var a=t.response;if(e.type==="json")try{a=JSON.parse(t.response)}catch(l){return r(l)}r(null,a,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"),t)}else{var s=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});r(new di(t.status,t.statusText,n.toString(),s))}},t.cancel=t.abort,t.send(e.body),t}function mi(e){return new Promise(function(r,t){Fi(e,function(n,i,a,s,l){n?t({err:n,data:null,xhr:l}):r({err:null,data:i,cacheControl:a,expires:s,xhr:l})})})}function Ci(e,r){return Fi(e,r)}var Ri=function(r,t){var n=on(r.url)||Ci;return n((0,k.Z)((0,k.Z)({},r),{},{type:"json"}),t)},bo=function(r,t){var n=on(r.url)||Ci;return n((0,k.Z)((0,k.Z)({},r),{},{type:"arrayBuffer"}),t)},Ki=function(r,t){return Ci(_objectSpread(_objectSpread({},r),{},{method:"POST"}),t)},Sa=function(r,t){return Ci((0,k.Z)((0,k.Z)({},r),{},{method:"GET"}),t)};function Mi(e){var r=window.document.createElement("a");return r.href=e,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}var gi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ei(e,r){var t=new window.Image,n=window.URL||window.webkitURL;t.crossOrigin="anonymous",t.onload=function(){r(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=gi})},t.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(i):gi}function wa(e,r){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){r(null,n)}).catch(function(n){r(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Gs=function(r,t,n){var i=function(s,l){if(s)t(s);else if(l){var c=typeof createImageBitmap=="function",p=n?n(l):l;c?wa(p,t):Ei(p,t)}};return r.type==="json"?Ri(r,i):bo(r,i)},fa=function(r,t){var n=typeof createImageBitmap=="function";n?wa(r,t):Ei(r,t)},Ca=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),Ju={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function iu(e,r,t){var n=e.classList;for(var i in Ju)Ju.hasOwnProperty(i)&&n.remove("l7-".concat(t,"-anchor-").concat(i));n.add("l7-".concat(t,"-anchor-").concat(r))}var _a=Z(2650);function os(e){return typeof e=="string"?!!d3.color(e):!1}function li(e){var r=_a.ZP(e),t=[0,0,0,0];return r!=null&&(t[0]=r.r/255,t[1]=r.g/255,t[2]=r.b/255,t[3]=r.opacity),t}function ia(e){var r=e&&e[0],t=e&&e[1],n=e&&e[2],i=r+t*256+n*65536-1;return i}function Ra(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function aa(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;for(var n=null,i=t.createLinearGradient(0,0,256,1),a=e.positions[0],s=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var c=(e.positions[l]-a)/(s-a);i.addColorStop(c,e.colors[l])}return t.fillStyle=i,t.fillRect(0,0,256,1),n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),r=null,t=null,{data:n,width:256,height:1}}function $o(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var i=n.createLinearGradient(0,0,256,1),a=r[1]-r[0],s=0;s<e.colors.length;++s){var l=Math.max((e.positions[s]-r[0])/a,0);i.addColorStop(l,e.colors[s])}n.fillStyle=i,n.fillRect(0,0,256,1);var c=n.getImageData(0,0,256,1).data,p=mc(n,c);return t=null,n=null,p}function Vo(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;var n=t.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(i,a){var s=li(e.colors[a]);n.data[i*4+0]=s[0]*255,n.data[i*4+1]=s[1]*255,n.data[i*4+2]=s[2]*255,n.data[i*4+3]=s[3]*255}),r=null,t=null,n}function Du(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");t.globalAlpha=1,r.width=256,r.height=1;for(var n=256/e.colors.length,i=0;i<e.colors.length;i++)t.beginPath(),t.lineWidth=2,t.strokeStyle=e.colors[i],t.moveTo(i*n,0),t.lineTo((i+1)*n,0),t.stroke();var a=t.getImageData(0,0,256,1).data,s=mc(t,a);return r=null,t=null,s}function ws(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;var i=r[1]-r[0];e.positions.length-e.colors.length!=1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var a=0;a<e.colors.length;a++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[a],n.moveTo((e.positions[a]-r[0])/i*255,0),n.lineTo((e.positions[a+1]-r[0])/i*255,0),n.stroke();var s=n.getImageData(0,0,256,1).data,l=mc(n,s);return t=null,n=null,l}function mc(e,r){for(var t=e.createImageData(256,1),n=0;n<t.data.length;n+=4)t.data[n+0]=r[n+0],t.data[n+1]=r[n+1],t.data[n+2]=r[n+2],t.data[n+3]=r[n+3];return t}function Da(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var zi={BACK:1029,FRONT:1028};function jo(e){switch(e){case"GAODE1.x":return zi.BACK;case"GAODE2.x":return zi.BACK;case"MAPBOX":return zi.FRONT;case"SIMPLE":return zi.FRONT;case"GLOBEL":return zi.BACK;case"DEBAULT":return zi.FRONT;default:return zi.FRONT}}var Gt=Z(85061),re=Z(28481),Oe=Z(74691),dt=Z.n(Oe),lr=Z(50361),Kr=Z.n(lr),Pn=Z(23279),Zi=Z.n(Pn),lo=Z(27361),Eo=Z.n(lo),ao=Z(51584),Cs=Z.n(ao),Zc=Z(60442),au=Z.n(Zc),_f=Z(14293),Ho=Z.n(_f),Al=Z(81763),Tl=Z.n(Al),Lu=Z(68630),Bu=Z.n(Lu),el=Z(47037),Vc=Z.n(el),Rs=Z(36719),Ga=Z.n(Rs),wl=Z(82492),tl=Z.n(wl),yf=Z(30236),jh=Z.n(yf),xf=Z(97019),nh=Z.n(xf),ih=Z(23493),ah=Z.n(ih),Hh=Z(44908),Wh=Z.n(Hh),Np=Z(11700),jc=Z.n(Np),Fu=Z(23560),Gh=Z.n(Fu),Wo=Z(13218),Hl=Z.n(Wo),Cl=Z(52353),Xs=Z.n(Cl),Rl=Z(68929),ou=Z.n(Rl),vi={isNil:Ho(),merge:tl(),throttle:ah(),isString:Vc(),debounce:Zi(),pull:nh(),isTypedArray:Ga(),isPlainObject:Bu(),isNumber:Tl(),isBoolean:Cs(),isEqual:au(),cloneDeep:Kr(),uniq:Wh(),clamp:dt(),upperFirst:jc(),get:Eo(),mergeWith:jh(),isFunction:Gh(),isObject:Hl(),isUndefined:Xs(),camelCase:ou()},$s=vi.pull;function Nu(e){var r=e;return typeof e=="string"&&(r=window.document.getElementById(e)),r}function rl(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function oh(e){return rl(e).split(/\s+/)}function Xh(e){var r,t=(r=document)===null||r===void 0||(r=r.documentElement)===null||r===void 0?void 0:r.style;if(!t)return e[0];for(var n in e)if(e[n]&&e[n]in t)return e[n];return e[0]}function In(e,r,t){var n=window.document.createElement(e);return r&&(n.className=r||""),t&&t.appendChild(n),n}function Ys(e){var r=e.parentNode;r&&r.removeChild(e)}function Es(e,r){if(e.classList!==void 0)for(var t=oh(r),n=0,i=t.length;n<i;n++)e.classList.add(t[n]);else if(!Xa(e,r)){var a=Ef(e);bf(e,(a?a+" ":"")+r)}}function Uu(e,r){if(e.classList!==void 0){var t=oh(r);t.forEach(function(n){e.classList.remove(n)})}else bf(e,rl((" "+Ef(e)+" ").replace(" "+r+" "," ")))}function Xa(e,r){if(e.classList!==void 0)return e.classList.contains(r);var t=Ef(e);return t.length>0&&new RegExp("(^|\\s)"+r+"(\\s|$)").test(t)}function bf(e,r){e instanceof HTMLElement?e.className=r:e.className.baseVal=r}function Ef(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Ms(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var nl=Xh(["transform","WebkitTransform"]);function _u(e,r){e.style[nl]=r}function Ml(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function sh(e){var r=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,r.join(""))}function gc(){var e,r=window.document.querySelector('meta[name="viewport"]');if(!r)return 1;var t=(e=r.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(i){var a=i.split("="),s=(0,re.Z)(a,1),l=s[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var oa=gc()<1?1:window.devicePixelRatio;function _c(e,r){e.setAttribute("style","".concat(e.style.cssText).concat(r))}function il(e){return e.split(";").map(function(r){return r.trim()}).filter(function(r){return r})}function Il(e,r){var t,n=il((t=e.getAttribute("style"))!==null&&t!==void 0?t:""),i=il(r),a=$s.apply(void 0,[n].concat((0,Gt.Z)(i)));e.setAttribute("style",a.join(";"))}function uh(e){return Object.entries(e).map(function(r){var t=(0,re.Z)(r,2),n=t[0],i=t[1];return"".concat(n,": ").concat(i)}).join(";")}function Hc(e,r){return{left:e.left-r.left,top:e.top-r.top,right:r.left+r.width-e.left-e.width,bottom:r.top+r.height-e.top-e.height}}function ua(e,r){e.checked=r,r?e.setAttribute("checked","true"):e.removeAttribute("checked")}function Pl(e){e.innerHTML=""}function $h(e){e.setAttribute("draggable","false")}function Is(e,r){if(typeof r=="string"){var t=document.createElement("div");for(t.innerHTML=r;t.firstChild;)e.append(t.firstChild)}else Array.isArray(r)?e.append.apply(e,(0,Gt.Z)(r)):e.append(r)}function Wc(e,r){for(var t=Array.isArray(r)?r:[r],n=e;n instanceof Element&&n!==window.document.body;){var i,a;if(t.find(function(s){var l;return(l=n)===null||l===void 0?void 0:l.matches(s)}))return n;n=(i=(a=n)===null||a===void 0?void 0:a.parentElement)!==null&&i!==void 0?i:null}}var Gc;function Sf(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function al(){return typeof importScripts=="function"}var Wl=al()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},zu=(Gc=navigator)===null||Gc===void 0?void 0:Gc.userAgent,Xc=!!zu.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),yc=zu.indexOf("Android")>-1||zu.indexOf("Adr")>-1;function Gl(){for(var e=zu,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],t=!0,n=0,i=r;n<i.length;n++){var a=i[n];if(e.indexOf(a)>0){t=!1;break}}return t}function Af(e,r){e.forEach(function(t){!r[t]||(r[t]=r[t].bind(r))})}var xc=null;function Ps(e){var r=[Infinity,Infinity,-Infinity,-Infinity];return D(e,function(t){r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}Ps.default=Ps;var lh=Ps;function $c(e){return typeof e=="number"}var bc=2*Math.PI*6378137/2;function Ol(e,r){var t=(0,re.Z)(r,4),n=t[0],i=t[1],a=t[2],s=t[3];return e.lng>n&&e.lng<=a&&e.lat>i&&e.lat<=s}function Zu(e){var r=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var n=t.coordinates;Xl(r,n)}),r}function Xl(e,r){return Array.isArray(r[0])?r.forEach(function(t){Xl(e,t)}):(e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])),e}function Tf(e,r){return ol(e,r)}function ol(e,r){return Array.isArray(e[0])?e.map(function(t){return ol(t,r)}):r(e)}function ch(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Yh(e,r);var n=e[0],i=e[1],a=n*bc/180,s=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return s=s*bc/180,t.enable&&(a=Number(a.toFixed(t.decimal)),s=Number(s.toFixed(t.decimal))),e.length===3?[a,s,e[2]]:[a,s]}function fh(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],i=t/bc*180,a=n/bc*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),r!=null&&(i=Number(i.toFixed(r)),a=Number(a.toFixed(r))),e.length===3?[i,a,e[2]]:[i,a]}function hh(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function wf(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Yh(e,r){if(r===!1)return e;var t=hh(e[0]),n=wf(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function La(e){var r=85.0511287798,t=Math.max(Math.min(r,e[1]),-r),n=256<<20,i=Math.PI/180,a=e[0]*i,s=t*i;s=Math.log(Math.tan(Math.PI/4+s/2));var l=.5/Math.PI,c=.5,p=-.5/Math.PI;return i=.5,a=n*(l*a+c),s=n*(p*s+i),[Math.floor(a),Math.floor(s)]}function qh(e){var r=.5/Math.PI,t=.5,n=-.5/Math.PI,i=.5,a=256<<20,s=_slicedToArray(e,2),l=s[0],c=s[1];l=(l/a-t)/r,c=(c/a-i)/n,c=(Math.atan(Math.pow(Math.E,c))-Math.PI/4)*2,i=Math.PI/180;var p=c/i,_=l/i;return[_,p]}function Cf(e,r){var t=85.0511287798,n=Math.PI/180,i=6378137;return r=Math.max(Math.min(t,r),-t),e*=n,r*=n,r=Math.log(Math.tan(Math.PI/4+r/2)),[e*i,r*i]}function Kh(e,r){var t=Math.PI/180,n=6378137,i=e/n/t,a=2*(Math.atan(Math.exp(r/n))-Math.PI/4)/t;return[i,a]}function $l(e,r,t){var n=Ha(r[1]-e[1]),i=Ha(r[0]-e[0]),a=Ha(e[1]),s=Ha(r[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return Tn(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),t="meters")}function Qh(e){var r=Math.PI/180,t=85.0511287798,n=6378137,i=Math.max(Math.min(t,e[1]),-t),a=Math.sin(i*r),s=n*e[0]*r,l=n*Math.log((1+a)/(1-a))/2;return[s,l]}function su(e,r){var t=Math.abs(e[1][1]-e[0][1])*r,n=Math.abs(e[1][0]-e[0][0])*r;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function la(e,r){return e[0][0]<=r[0][0]&&e[0][1]<=r[0][1]&&e[1][0]>=r[1][0]&&e[1][1]>=r[1][1]}function Yl(e){return[[e[0],e[1]],[e[2],e[3]]]}function Vu(e){var r=sl(e,[0,0]);return[e[0]/r,e[1]/r]}function sl(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Di(e,r){return e[0]*r[0]+e[1]*r[1]}function ha(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function uu(e,r){return Math.acos(Di(e,r)/(ha(e)*ha(r)))*180/Math.PI}function Yc(e,r){return r[0]>0?r[1]>0?90-Math.atan(r[1]/r[0])*180/Math.PI:90+Math.atan(-r[1]/r[0])*180/Math.PI:r[1]<0?180+(90-Math.atan(r[1]/r[0])*180/Math.PI):270+Math.atan(r[1]/-r[0])*180/Math.PI}function qc(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,i=[],a=0;a<e.length-1;a++){var s=e[a],l=e[a+1],c=sl(s,l);n+=c;var p=[s[0]-l[0],s[1]-l[1]],_=Yc(t,p);if(a>0){var b=i[a-1].rotation;b-_>360-b+_&&(_=_+360)}i.push({start:s,end:l,dis:c,rotation:_,duration:0})}return i.map(function(A){A.duration=r*(A.dis/n)}),i}}function qs(e){if($c(e[0]))return e;if($c(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if($c(e[0][0][0])){var r=e,t=0,n=0,i=0;return r.forEach(function(a){a.forEach(function(s){t+=s[0],n+=s[1],i++})}),[t/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Jh(e){for(var r=e[0],t=e[1],n=e[0],i=e[1],a=0,s=0,l=0,c=0;c<e.length;c+=2){var p=e[c],_=e[c+1];p&&_&&(r=Math.max(p,r),t=Math.max(_,t),n=Math.min(p,n),i=Math.min(_,i),a+=p,s+=_,l++)}return{center:[a/l,s/l],radius:Math.sqrt(Math.pow(r-n,2)+Math.pow(t-i,2))/2}}function Rf(e){return lh(ri([hn(e)]))}function Mf(e){var r=131,t=137,n=0;e+="x";for(var i=Math.floor(9007199254740991/t),a=0;a<e.length;a++)n>i&&(n=Math.floor(n/t)),n=n*r+e.charCodeAt(a);return n}function ql(e){e=e.toString();for(var r=5381,t=e.length;t;)r=r*33^e.charCodeAt(--t);return r>>>0}function So(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.random()*16|0,t=e==="x"?r:r&3|8;return t.toString(16)})}var Ba=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function Kc(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=t;return s&&(l=Math.round(t*(a-1))/(a-1)),n?ss(e,r,l,n,i):ss(e,r,l,.314,i)}function Ec(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function to(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function bn(e,r,t){var n=[r[0]-e[0],r[1]-e[1]],i=to(n,[0,0]),a=Math.atan2(n[1],n[0]),s=i/2/Math.cos(t),l=a+t,c=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return c}function ss(e,r,t,n,i){if(i===MapType["GAODE2.x"]){var a=amap2Project(e[0],e[1]),s=amap2Project(r[0],r[1]),l=bn(a,s,n),c=[a[0],l[0],s[0]],p=[a[1],l[1],s[1]];return[].concat(_toConsumableArray(amap2UnProject(Ec(c,t),Ec(p,t))),[0])}else{var _=bn(e,r,n),b=[e[0],_[0],r[0]],A=[e[1],_[1],r[1]];return[Ec(b,t),Ec(A,t),0]}}function If(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=t;return s&&(l=Math.round(t*29)/29),Pf(e,r,l,i)}function Sc(e,r){var t=[r[0]-e[0],r[1]-e[1]],n=calDistance(t,[0,0]),i=Math.atan2(t[1],t[0]),a=.314,s=n/2/Math.cos(a),l=i+a,c=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return c}function Yo(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function ca(e,r){var t=[e[0]-r[0],e[1]-r[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],i=n[1]*n[1]+Math.cos(e[1])*Math.cos(r[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}function Pf(e,r,t,n){var i=[degreesToRadians(e[0]),degreesToRadians(e[1])],a=[degreesToRadians(r[0]),degreesToRadians(r[1])];if(n==="GAODE2.x"){var s=Sc(i,a),l=[i[0],s[0],a[0]],c=[i[1],s[1],a[1]];return[Yo(l,t),Yo(c,t),0]}else{var p=ca(i,a);if(Math.abs(p-Math.PI)<.001)return[(1-t)*i[0]+t*a[0],(1-t)*i[1]+t*a[1]];var _=Math.sin((1-t)*p)/Math.sin(p),b=Math.sin(t*p)/Math.sin(p),A=[Math.sin(i[0]),Math.sin(i[1])],w=[Math.cos(i[0]),Math.cos(i[1])],I=[Math.sin(a[0]),Math.sin(a[1])],P=[Math.cos(a[0]),Math.cos(a[1])],B=_*w[1]*w[0]+b*P[1]*P[0],H=_*w[1]*A[0]+b*P[1]*I[0],Q=_*A[1]+b*I[1];return[radiansToDegrees(Math.atan2(H,B)),radiansToDegrees(Math.atan2(Q,Math.sqrt(B*B+H*H)))]}}function sn(e,r){for(var t=0,n=[],i=0;i<e.length-1;i++){var a=e[i],s=e[i+1],l=Qc(a,s),c=t;t+=l,n.push({p1:a,p2:s,totalDistance:t,distance:l,lastTotalDistance:c})}for(var p=t*r,_,b,A=0,w=n;A<w.length;A++){var I=w[A],P=I.totalDistance;if(P>p){var B=I.p1,H=I.p2,Q=(p-I.lastTotalDistance)/I.distance,ue=ul(H,B,Q);_=ue[0],b=ue[1];break}}return{lng:_,lat:b,height:0}}function ul(e,r,t){return[e[0]*t+r[0]*(1-t),e[1]*t+r[1]*(1-t)]}function Qc(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Jc(e,r){var t=r.featureId,n=e.data.dataArray;return typeof t=="number"&&(n=n.filter(function(i){var a=i.id;return a===t})),n.map(function(i){var a=Os(i,r);return _objectSpread(_objectSpread({},i),a)})}function yu(e,r){return new Promise(function(t){e.inited?t(Jc(e,r)):e.once("update",function(){t(Jc(e,r))})})}function Os(e,r){var t=r.offset,n=r.shape,i=r.thetaOffset,a=r.mapVersion,s=r.segmentNumber,l=s===void 0?30:s,c=r.autoFit,p=c===void 0?!0:c,_=e.coordinates;if(n==="line")return pathLineAtOffset(_,t);var b=_[0],A=_[1],w=typeof i=="string"?e[i]||0:i,I;switch(n){case"arc":I=arcLineAtOffset;break;case"greatcircle":I=greatCircleLineAtOffset;break;default:I=arcLineAtOffset}var P=I(b,A,t,w,a,l,p),B=_slicedToArray(P,3),H=B[0],Q=B[1],ue=B[2];return{lng:H,lat:Q,height:ue}}var Of=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,ge.Z)(this,e),this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,K.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(i){return i===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function kf(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r*1}function us(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r*1}function xu(e){if(e.length===0)return 0;for(var r=e[0]*1,t=1;t<e.length;t++)r+=e[t]*1;return r}function ep(e){if(e.length===0)throw new Error("mean requires at least one data point");return xu(e)/e.length}function Ac(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var r=e[0],t=NaN,n=0,i=1,a=1;a<e.length+1;a++)e[a]!==r?(i>n&&(n=i,t=r),i=1,r=e[a]):i++;return t*1}var Tc={min:us,max:kf,mean:ep,sum:xu,mode:Ac};function ef(e,r){return e.map(function(t){return t[r]})}function ks(e,r){return Tc[e](r)}var Nt=Z(92137),we=Z(63349),N=Z(96156),Ks=Z(87757),xe=Z.n(Ks);function kl(e,r){r===void 0&&(r={});var t=Number(e[0]),n=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[t,n],l=[t,a],c=[i,a],p=[i,n];return ar([[s,p,c,l,s]],r.properties,{bbox:e,id:r.id})}var Fa=Z(26729),Ds=Z.n(Fa),Ao=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),ls=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),Ln=0,An=1,qo=2;function Ko(e){e.forEach(function(r){r.isCurrent&&(r.isVisible=r.isLoaded)})}function bu(e){e.forEach(function(r){r.properties.state=Ln}),e.forEach(function(r){r.isCurrent&&!Qs(r)&&Eu(r)}),e.forEach(function(r){r.isVisible=Boolean(r.properties.state&qo)})}function Ma(e){e.forEach(function(t){t.properties.state=Ln}),e.forEach(function(t){t.isCurrent&&Qs(t)});var r=e.slice().sort(function(t,n){return t.z-n.z});r.forEach(function(t){t.isVisible=Boolean(t.properties.state&qo),t.children.length&&(t.isVisible||t.properties.state&An)?t.children.forEach(function(n){n.properties.state=An}):t.isCurrent&&Eu(t)})}function Qs(e){for(;e;){if(e.isLoaded)return e.properties.state|=qo,!0;e=e.parent}return!1}function Eu(e){e.children.forEach(function(r){r.isLoaded?r.properties.state|=qo:Eu(r)})}var Su,ta=256,co=[-Infinity,-Infinity,Infinity,Infinity],ph=.2,Dl=5,Df=(Su={},(0,N.Z)(Su,Ao.Realtime,Ko),(0,N.Z)(Su,Ao.Overlap,bu),(0,N.Z)(Su,Ao.Replace,Ma),Su),ll=function(){};function cs(e,r,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),i=Math.floor((1-Math.log(Math.tan(r*Math.PI/180)+1/Math.cos(r*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,i]}function Kl(e,r,t){var n=e/Math.pow(2,t)*360-180,i=Math.PI-2*Math.PI*r/Math.pow(2,t),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,a]}var Au=function(r,t,n){var i=Kl(r,t,n),a=(0,re.Z)(i,2),s=a[0],l=a[1],c=Kl(r+1,t+1,n),p=(0,re.Z)(c,2),_=p[0],b=p[1];return[s,b,_,l]};function Lf(e){var r=e.zoom,t=e.latLonBounds,n=e.maxZoom,i=n===void 0?Infinity:n,a=e.minZoom,s=a===void 0?0:a,l=e.zoomOffset,c=l===void 0?0:l,p=e.extent,_=p===void 0?co:p,b=Math.ceil(r)+c;if(Number.isFinite(s)&&b<s)return[];Number.isFinite(i)&&b>i&&(b=i);for(var A=(0,re.Z)(t,4),w=A[0],I=A[1],P=A[2],B=A[3],H=[Math.max(w,_[0]),Math.max(I,_[1]),Math.min(P,_[2]),Math.min(B,_[3])],Q=[],ue=cs(H[0],H[1],b),Ee=(0,re.Z)(ue,2),Le=Ee[0],Ze=Ee[1],tt=cs(H[2],H[3],b),ft=(0,re.Z)(tt,2),wt=ft[0],fr=ft[1],hr=Le;hr<=wt;hr++)for(var Mr=fr;Mr<=Ze;Mr++)Q.push({x:hr,y:Mr,z:b});var ln=(wt+Le)/2,Rn=(Ze+fr)/2,wi=function(Va,io){return Math.abs(Va-ln)+Math.abs(io-Rn)};return Q.sort(function(ba,Va){return wi(ba.x,ba.y)-wi(Va.x,Va.y)}),Q}var wc=function(r,t,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Math.pow(2,n),s=a-1,l=a,c=r,p=t;return i&&(c<0?c=c+l:c>s&&(c=c%l)),{warpX:c,warpY:p}};function tf(e){var r=Bf();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Bf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ql=function(e){(0,Qe.Z)(t,e);var r=tf(t);function t(n){var i;(0,ge.Z)(this,t),i=r.call(this),(0,N.Z)((0,we.Z)(i),"tileSize",256),(0,N.Z)((0,we.Z)(i),"isVisible",!1),(0,N.Z)((0,we.Z)(i),"isCurrent",!1),(0,N.Z)((0,we.Z)(i),"isVisibleChange",!1),(0,N.Z)((0,we.Z)(i),"loadedLayers",0),(0,N.Z)((0,we.Z)(i),"isLayerLoaded",!1),(0,N.Z)((0,we.Z)(i),"isLoad",!1),(0,N.Z)((0,we.Z)(i),"isChildLoad",!1),(0,N.Z)((0,we.Z)(i),"parent",null),(0,N.Z)((0,we.Z)(i),"children",[]),(0,N.Z)((0,we.Z)(i),"data",null),(0,N.Z)((0,we.Z)(i),"properties",{}),(0,N.Z)((0,we.Z)(i),"loadDataId",0);var a=n.x,s=n.y,l=n.z,c=n.tileSize,p=n.warp,_=p===void 0?!0:p;return i.x=a,i.y=s,i.z=l,i.warp=_||!0,i.tileSize=c,i}return(0,K.Z)(t,[{key:"isLoading",get:function(){return this.loadStatus===ls.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===ls.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===ls.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===ls.Cancelled}},{key:"isDone",get:function(){return[ls.Loaded,ls.Cancelled,ls.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Au(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var i=(0,re.Z)(this.bounds,4),a=i[0],s=i[1],l=i[2],c=i[3],p=[(l-a)/2,(c-s)/2],_=kl(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:p,meta:`
      `.concat(this.key,`
      `)}});return _}},{key:"key",get:function(){var i="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return i}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s){var l,c,p,_,b,A,w,I,P,B,H,Q,ue,Ee,Le,Ze,tt;return xe().wrap(function(wt){for(;;)switch(wt.prev=wt.next){case 0:return l=s.getData,c=s.onLoad,p=s.onError,this.loadDataId++,_=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=ls.Loading,b=null,wt.prev=7,w=this.x,I=this.y,P=this.z,B=this.bounds,H=this.tileSize,Q=this.warp,ue=wc(w,I,P,Q),Ee=ue.warpX,Le=ue.warpY,Ze=this.abortController.signal,tt={x:Ee,y:Le,z:P,bounds:B,tileSize:H,signal:Ze,warp:Q},wt.next=14,l(tt,this);case 14:b=wt.sent,wt.next=20;break;case 17:wt.prev=17,wt.t0=wt.catch(7),A=wt.t0;case 20:if(_===this.loadDataId){wt.next=22;break}return wt.abrupt("return");case 22:if(!(this.isCancelled&&!b)){wt.next=24;break}return wt.abrupt("return");case 24:if(!(A||!b)){wt.next=28;break}return this.loadStatus=ls.Failure,p(A,this),wt.abrupt("return");case 28:this.loadStatus=ls.Loaded,this.data=b,c(this);case 31:case"end":return wt.stop()}},a,this,[[7,17]])}));function i(a){return n.apply(this,arguments)}return i}()},{key:"reloadData",value:function(i){this.isLoading&&this.abortLoad(),this.loadData(i)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=ls.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),t}(Fa.EventEmitter),Jl=function(r,t){var n=Yl(r),i=su(n,t),a=360*3-180,s=85.0511287798065,l=[Math.max(i[0][0],-a),Math.max(i[0][1],-s),Math.min(i[1][0],a),Math.min(i[1][1],s)];return l},dh=function(r,t){var n=Yl(r),i=Yl(t),a=la(n,i);return a};function Qo(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Tu(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Tu(e,r){if(!!e){if(typeof e=="string")return rf(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rf(e,r)}}function rf(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Ll(e){var r=lu();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function lu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vh=vi.throttle,ju=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),Ff=function(e){(0,Qe.Z)(t,e);var r=Ll(t);function t(n){var i;return(0,ge.Z)(this,t),i=r.call(this),(0,N.Z)((0,we.Z)(i),"currentTiles",[]),(0,N.Z)((0,we.Z)(i),"cacheTiles",new Map),(0,N.Z)((0,we.Z)(i),"throttleUpdate",vh(function(a,s){i.update(a,s)},16)),(0,N.Z)((0,we.Z)(i),"onTileLoad",function(a){i.emit(ju.TileLoaded,a),i.updateTileVisible(),i.loadFinished()}),(0,N.Z)((0,we.Z)(i),"onTileError",function(a,s){i.emit(ju.TileError,{error:a,tile:s}),i.updateTileVisible(),i.loadFinished()}),(0,N.Z)((0,we.Z)(i),"onTileUnload",function(a){i.emit(ju.TileUnload,a),i.loadFinished()}),i.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:co,getTileData:ll,warp:!0,updateStrategy:Ao.Replace},i.updateOptions(n),i}return(0,K.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(a,s){return a.z-s.z});return i}},{key:"updateOptions",value:function(i){var a=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),s=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=(0,k.Z)((0,k.Z)((0,k.Z)({},this.options),i),{},{minZoom:a,maxZoom:s})}},{key:"update",value:function(i,a){var s=this,l=Math.max(0,Math.ceil(i));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&dh(this.lastViewStates.latLonBoundsBuffer,a))){var c=Jl(a,ph);this.lastViewStates={zoom:l,latLonBounds:a,latLonBoundsBuffer:c},this.currentZoom=l;var p=!1,_=this.getTileIndices(l,c).filter(function(b){return s.options.warp||b.x>=0&&b.x<Math.pow(2,l)});this.emit(ju.TilesLoadStart),this.currentTiles=_.map(function(b){var A=b.x,w=b.y,I=b.z,P=s.getTile(A,w,I);if(P){var B,H,Q=((B=P)===null||B===void 0?void 0:B.isFailure)||((H=P)===null||H===void 0?void 0:H.isCancelled);return Q&&P.loadData({getData:s.options.getTileData,onLoad:s.onTileLoad,onError:s.onTileError}),P}return P=s.createTile(A,w,I),p=!0,P}),p&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=Qo(this.cacheTiles),a;try{for(i.s();!(a=i.n()).done;){var s=(0,re.Z)(a.value,2),l=s[0],c=s[1];if(!this.currentTiles.includes(c)){this.cacheTiles.delete(l),this.onTileUnload(c);return}this.onTileUnload(c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(p){i.e(p)}finally{i.f()}}},{key:"reloadTileById",value:function(i,a,s){var l=this.cacheTiles.get("".concat(a,",").concat(s,",").concat(i));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(i,a,s){var l=this.getTileByLngLat(i,a,s);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(i,a){var s=this,l=this.getTileIndices(a,i);l.forEach(function(c){s.reloadTileById(c.z,c.x,c.y)})}},{key:"pruneRequests",value:function(){var i=[],a=Qo(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&i.push(l)}}catch(p){a.e(p)}finally{a.f()}for(;i.length>0;){var c=i.shift();c.abortLoad()}}},{key:"getTileByLngLat",value:function(i,a,s){var l=this.options.zoomOffset,c=Math.ceil(s)+l,p=cs(i,a,c),_=this.tiles.filter(function(b){return b.key==="".concat(p[0],"_").concat(p[1],"_").concat(c)});return _[0]}},{key:"getTileExtent",value:function(i,a){return this.getTileIndices(a,i)}},{key:"getTileByZXY",value:function(i,a,s){var l=this.tiles.filter(function(c){return c.key==="".concat(a,"_").concat(s,"_").concat(i)});return l[0]}},{key:"clear",value:function(){var i=Qo(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.isLoading?s.abortLoad():this.onTileUnload(s)}}catch(l){i.e(l)}finally{i.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,a=new Map,s=Qo(this.cacheTiles.values()),l;try{for(s.s();!(l=s.n()).done;){var c=l.value;a.set(c.key,c.isVisible),c.isCurrent=!1,c.isVisible=!1}}catch(I){s.e(I)}finally{s.f()}var p=Qo(this.currentTiles),_;try{for(p.s();!(_=p.n()).done;){var b=_.value;b.isCurrent=!0,b.isVisible=!0}}catch(I){p.e(I)}finally{p.f()}var A=Array.from(this.cacheTiles.values());typeof i=="function"?i(A):Df[i](A);var w=!1;Array.from(this.cacheTiles.values()).forEach(function(I){I.isVisible!==a.get(I.key)?(I.isVisibleChange=!0,w=!0):I.isVisibleChange=!1}),w&&this.emit(ju.TileUpdate)}},{key:"getTileIndices",value:function(i,a){var s=this.options,l=s.tileSize,c=s.extent,p=s.zoomOffset,_=Math.floor(this.options.maxZoom),b=Math.ceil(this.options.minZoom),A=Lf({maxZoom:_,minZoom:b,zoomOffset:p,tileSize:l,zoom:i,latLonBounds:a,extent:c});return A}},{key:"getTileId",value:function(i,a,s){var l="".concat(i,",").concat(a,",").concat(s);return l}},{key:"loadFinished",value:function(){var i=!this.currentTiles.some(function(a){return!a.isDone});return i&&this.emit(ju.TilesLoadFinished),i}},{key:"getTile",value:function(i,a,s){var l=this.getTileId(i,a,s),c=this.cacheTiles.get(l);return c}},{key:"createTile",value:function(i,a,s){var l=this.getTileId(i,a,s),c=new Ql({x:i,y:a,z:s,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),c}},{key:"resizeCacheTiles",value:function(){var i=Dl*this.currentTiles.length,a=this.cacheTiles.size>i;if(a){var s=Qo(this.cacheTiles),l;try{for(s.s();!(l=s.n()).done;){var c=(0,re.Z)(l.value,2),p=c[0],_=c[1];if(!_.isVisible&&!this.currentTiles.includes(_)&&(this.cacheTiles.delete(p),this.onTileUnload(_)),this.cacheTiles.size<=i)break}}catch(b){s.e(b)}finally{s.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var i=Qo(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.parent=null,s.children.length=0}}catch(b){i.e(b)}finally{i.f()}var l=Qo(this.cacheTiles.values()),c;try{for(l.s();!(c=l.n()).done;){var p=c.value,_=this.getNearestAncestor(p.x,p.y,p.z);p.parent=_,_!=null&&_.children&&_.children.push(p)}}catch(b){l.e(b)}finally{l.f()}}},{key:"getNearestAncestor",value:function(i,a,s){for(;s>this.options.minZoom;){i=Math.floor(i/2),a=Math.floor(a/2),s=s-1;var l=this.getTile(i,a,s);if(l)return l}return null}}]),t}(Ds());function mh(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function h(e){var r=[],t=/\{([a-z])-([a-z])\}/.exec(e);if(t){var n=t[1].charCodeAt(0),i=t[2].charCodeAt(0),a;for(a=n;a<=i;++a)r.push(e.replace(t[0],String.fromCharCode(a)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(e),t){for(var s=parseInt(t[2],10),l=parseInt(t[1],10);l<=s;l++)r.push(e.replace(t[0],l.toString()));return r}return r.push(e),r}function v(e,r){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=r.x,n=r.y,i=r.z,a=h(e),s=Math.abs(t+n)%a.length,l=on(a[s])?"".concat(a[s],"/{z}/{x}/{y}"):a[s];return l.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,Au(t,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function d(e,r){var t=r.x,n=r.y,i=r.z,a=r.layer,s=r.version,l=s===void 0?"1.0.0":s,c=r.style,p=c===void 0?"default":c,_=r.format,b=r.service,A=b===void 0?"WMTS":b,w=r.tileMatrixset,I="".concat(e,"&SERVICE=").concat(A,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(a,"&STYLE=").concat(p,"&TILEMATRIXSET=").concat(w,"&FORMAT=").concat(_,"&TILECOL=").concat(t,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(i);return I}function g(e,r){if(!e)throw new Error(r||"web worker helper assertion failed.")}var S={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},C=S.self||S.window||{},R=S.window||S.self||{},O=S.self||S.window||{},G=S.document||{},J=typeof importScripts=="function",_e=typeof window!="undefined"&&typeof window.orientation!="undefined",be=function(){function e(r,t){var n=this;this.name=r,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(i,a){n.resolve=i,n.reject=a})}return e.prototype.postMessage=function(r,t){this.workerThread.postMessage({source:"Main thread",type:r,payload:t})},e.prototype.done=function(r){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(r)},e.prototype.error=function(r){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(r)},e}(),Te=be,We=new Map;function je(e){g(e.source&&!e.url||!e.source&&e.url);var r=We.get(e.source||e.url);return r||(e.url&&(r=at(e.url),We.set(e.url,r)),e.source&&(r=Fe(e.source),We.set(e.source,r))),g(r),r}function at(e){if(!e.startsWith("http"))return e;var r=nt(e);return Fe(r)}function Fe(e){var r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}function nt(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function _t(e,r,t){r===void 0&&(r=!0);var n=t||new Set;if(e){if(Dt(e))n.add(e);else if(Dt(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(r&&typeof e=="object")for(var i in e)_t(e[i],r,n)}}return t===void 0?Array.from(n):[]}function Dt(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var nr=function(){},$t=function(){function e(r){this.terminated=!1,this.loadableURL="";var t=r.name,n=r.source,i=r.url;g(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=nr,this.onError=function(a){return console.log(a)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=nr,this.onError=nr,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(r,t){t=t||_t(r),this.worker.postMessage(r,t)},e.prototype.getErrorFromErrorEvent=function(r){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",r.message&&(t+=r.message+" in "),r.lineno&&(t+=":"+r.lineno+":"+r.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var r=this;this.loadableURL=je({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?r.onMessage(n.data):r.onError(new Error("No data received"))},t.onerror=function(n){r.onError(r.getErrorFromErrorEvent(n)),r.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+r.name+", message error: "+n)},t},e}(),cr=$t,yr=function(){return yr=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},yr.apply(this,arguments)},Hr=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{p(n.next(_))}catch(b){s(b)}}function c(_){try{p(n.throw(_))}catch(b){s(b)}}function p(_){_.done?a(_.value):i(_.value).then(l,c)}p((n=n.apply(e,r||[])).next())})},Nr=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(p){return function(_){return c([p,_])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(_){p=[6,_],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},dn=function(){function e(r){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=r.source,this.url=r.url,this.setProps(r)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(r){return r.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(r){this.props=yr(yr({},this.props),r),r.name!==void 0&&(this.name=r.name),r.maxConcurrency!==void 0&&(this.maxConcurrency=r.maxConcurrency),r.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=r.maxMobileConcurrency),r.reuseWorkers!==void 0&&(this.reuseWorkers=r.reuseWorkers),r.onDebug!==void 0&&(this.onDebug=r.onDebug)},e.prototype.startJob=function(r,t,n){return t===void 0&&(t=function(i,a,s){return i.done(s)}),n===void 0&&(n=function(i,a){return i.error(a)}),Hr(this,void 0,void 0,function(){var i,a=this;return Nr(this,function(s){switch(s.label){case 0:return i=new Promise(function(l){return a.jobQueue.push({name:r,onMessage:t,onError:n,onStart:l}),a}),this.startQueuedJob(),[4,i];case 1:return[2,s.sent()]}})})},e.prototype.startQueuedJob=function(){return Hr(this,void 0,void 0,function(){var r,t,n;return Nr(this,function(i){switch(i.label){case 0:if(!this.jobQueue.length)return[2];if(r=this.getAvailableWorker(),!r)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:r}),n=new Te(t.name,r),r.onMessage=function(a){return t.onMessage(n,a.type,a.payload)},r.onError=function(a){return t.onError(n,a)},t.onStart(n),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,n.result];case 2:return i.sent(),[3,4];case 3:return this.returnWorkerToQueue(r),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(r){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(r.destroy(),this.count--):this.idleQueue.push(r),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var r=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new cr({name:r,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return _e?this.maxMobileConcurrency:this.maxConcurrency},e}(),Nn=dn,Bn=function(){return Bn=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Bn.apply(this,arguments)},zn=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Ni={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},yn=function(){function e(r){this.workerPools=new Map,this.props=Bn({},Ni),this.setProps(r),this.workerPools=new Map}return e.isSupported=function(){return cr.isSupported()},e.getWorkerFarm=function(r){return r===void 0&&(r={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(r),e.workerFarm},e.prototype.destroy=function(){var r,t;try{for(var n=zn(this.workerPools.values()),i=n.next();!i.done;i=n.next()){var a=i.value;a.destroy()}}catch(s){r={error:s}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setProps=function(r){var t,n;this.props=Bn(Bn({},this.props),r);try{for(var i=zn(this.workerPools.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.setProps(this.getWorkerPoolProps())}}catch(l){t={error:l}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(r){var t=r.name,n=r.source,i=r.url,a=this.workerPools.get(t);return a||(a=new Nn({name:t,source:n,url:i}),a.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,a)),a},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),ii=null,pi=new Map,ti=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(r){self.onmessage=function(t){if(!!fi(t)){var n=t.data,i=n.type,a=n.payload;r(i,a)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(r){var t=pi.get(r);t||(t=function(n){if(!!fi(n)){var i=n.data,a=i.type,s=i.payload;r(a,s)}}),self.addEventListener("message",t)},e.removeEventListener=function(r){var t=pi.get(r);pi.delete(r),self.removeEventListener("message",t)},e.postMessage=function(r,t){if(self){var n={source:"Worker thread",type:r,payload:t},i=_t(t);self.postMessage(n,i)}},e}(),Jn=null;function fi(e){var r=e.type,t=e.data;return r==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function ei(e){return JSON.parse($n(e))}function $n(e){var r=new Set;return JSON.stringify(e,function(t,n){if(typeof n=="object"&&n!==null){if(r.has(n))try{return JSON.parse(JSON.stringify(n))}catch(i){return}r.add(n)}return n})}function To(e){return""+e.name}function $a(e,r){r===void 0&&(r={});var t=r[e.id]||{},n=e.name+".worker.js",i=t.workerUrl;return r._workerType==="test"&&(i=e.module+"/dist/"+n),i||(i="https://unpkg.com/"+e.module+"/dist/"+n),assert(i),i}var wo=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{p(n.next(_))}catch(b){s(b)}}function c(_){try{p(n.throw(_))}catch(b){s(b)}}function p(_){_.done?a(_.value):i(_.value).then(l,c)}p((n=n.apply(e,r||[])).next())})},fo=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(p){return function(_){return c([p,_])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(_){p=[6,_],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}};function Na(e,r){return WorkerFarm.isSupported()?e.worker&&(r==null?void 0:r.worker):!1}function Ya(e,r,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),wo(this,void 0,void 0,function(){var i,a,s,l,c,p,_,b;return fo(this,function(A){switch(A.label){case 0:return i=getWorkerName(e),a=getWorkerURL(e,t),s=WorkerFarm.getWorkerFarm(t),l=s.getWorkerPool({name:i,url:a}),c=t.jobName||e.name,[4,l.startJob(c,fs.bind(null,n))];case 1:return p=A.sent(),_=removeNontransferableOptions(t),p.postMessage("process",{input:r,options:_}),[4,p.result];case 2:return b=A.sent(),[2,b.result]}})})}function fs(e,r,t,n){return wo(this,void 0,void 0,function(){var i,a,s,l,c,p,_;return fo(this,function(b){switch(b.label){case 0:switch(i=t,i){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return r.done(n),[3,9];case 2:return r.error(new Error(n.error)),[3,9];case 3:a=n.id,s=n.input,l=n.options,b.label=4;case 4:return b.trys.push([4,6,,7]),e.process?[4,e.process(s,l)]:(r.postMessage("error",{id:a,error:"Worker not set up to process on main thread"}),[2]);case 5:return c=b.sent(),r.postMessage("done",{id:a,result:c}),[3,7];case 6:return p=b.sent(),_=p instanceof Error?p.message:"unknown error",r.postMessage("error",{id:a,error:_}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),b.label=9;case 9:return[2]}})})}var hs=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(r){return this.enqueue(r)},e.prototype.enqueue=function(r){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();r instanceof Error?t.reject(r):t.resolve({value:r})}else this._values.push(r)},e.prototype.close=function(){for(;this._settlers.length>0;){var r=this._settlers.shift();r.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var r=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,i){r._settlers.push({resolve:n,reject:i})})},e}(),cl=null,ps=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{p(n.next(_))}catch(b){s(b)}}function c(_){try{p(n.throw(_))}catch(b){s(b)}}function p(_){_.done?a(_.value):i(_.value).then(l,c)}p((n=n.apply(e,r||[])).next())})},cu=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(p){return function(_){return c([p,_])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(_){p=[6,_],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},Ls=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e[Symbol.asyncIterator],t;return r?r.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(a){t[a]=e[a]&&function(s){return new Promise(function(l,c){s=e[a](s),i(l,c,s.done,s.value)})}}function i(a,s,l,c){Promise.resolve(c).then(function(p){a({value:p,done:l})},s)}},Cc=0,Hu,wu;function ec(e,r){var t=this;if(typeof self!="undefined"){var n={process:fl};WorkerBody.onmessage=function(i,a){return ps(t,void 0,void 0,function(){var s,l,c,p,_,b,A,w,I,P,B;return cu(this,function(H){switch(H.label){case 0:switch(H.trys.push([0,19,,20]),s=i,s){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(a.input,a.options||{},n)];case 2:return l=H.sent(),WorkerBody.postMessage("done",{result:l}),[3,18];case 3:if(!r)throw new Error("Worker does not support batched processing");Hu=new AsyncQueue,wu=a.options||{},c=r(Hu,wu,n),H.label=4;case 4:H.trys.push([4,9,10,15]),p=Ls(c),H.label=5;case 5:return[4,p.next()];case 6:if(_=H.sent(),!!_.done)return[3,8];b=_.value,WorkerBody.postMessage("output-batch",{result:b}),H.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return A=H.sent(),P={error:A},[3,15];case 10:return H.trys.push([10,,13,14]),_&&!_.done&&(B=p.return)?[4,B.call(p)]:[3,12];case 11:H.sent(),H.label=12;case 12:return[3,14];case 13:if(P)throw P.error;return[7];case 14:return[7];case 15:return WorkerBody.postMessage("done",{}),[3,18];case 16:return Hu.push(a.input),[3,18];case 17:return Hu.close(),[3,18];case 18:return[3,20];case 19:return w=H.sent(),I=w instanceof Error?w.message:"",WorkerBody.postMessage("error",{error:I}),[3,20];case 20:return[2]}})})}}}function fl(e,r){return r===void 0&&(r={}),new Promise(function(t,n){var i=Cc++,a=function(l,c){if(c.id===i)switch(l){case"done":WorkerBody.removeEventListener(a),t(c.result);break;case"error":WorkerBody.removeEventListener(a),n(c.error);break;default:}};WorkerBody.addEventListener(a);var s={id:i,input:e,options:r};WorkerBody.postMessage("process",s)})}var fu=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{p(n.next(_))}catch(b){s(b)}}function c(_){try{p(n.throw(_))}catch(b){s(b)}}function p(_){_.done?a(_.value):i(_.value).then(l,c)}p((n=n.apply(e,r||[])).next())})},hl=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(p){return function(_){return c([p,_])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(_){p=[6,_],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},Co={};function ro(e,r,t){return r===void 0&&(r=null),t===void 0&&(t={}),fu(this,void 0,void 0,function(){return hl(this,function(n){switch(n.label){case 0:return r&&(e=Ss(e,r,t)),Co[e]=Co[e]||hu(e),[4,Co[e]];case 1:return[2,n.sent()]}})})}function Ss(e,r,t){if(e.startsWith("http"))return e;var n=t.modules||{};return n[e]?n[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+r+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+r+"/src/libs/"+e}function hu(e){return fu(this,void 0,void 0,function(){var r,t,n;return hl(this,function(i){switch(i.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return r=i.sent(),[4,r.arrayBuffer()];case 2:return[2,i.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=i.sent(),[4,t.text()];case 5:return n=i.sent(),[2,Cu(n,e)]}})})}function Cu(e,r){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=r;try{t.appendChild(document.createTextNode(e))}catch(n){t.text=e}return document.body.appendChild(t),null}var Li="0.0.3",Go={id:"null",name:"null",module:"web-worker-helper",options:{}};function no(e){var r=e.color;return!r||!r.length?[1,1,1,1]:r}function pu(e,r,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function Rc(e){var r=e.filter;return r?[1]:[0]}function Wu(e,r){return[r]}var gh=Z(9187),Ro=Z.n(gh),Dr=Z(31437),Bs=Dr.create(),_h=Dr.create(),Mo=Dr.create(),Js=Dr.create(),Io=Dr.create();function tp(e,r,t,n,i){Dr.add(e,t,n),Dr.normalize(e,e),r=Dr.fromValues(-e[1],e[0]);var a=Dr.fromValues(-t[1],t[0]);return[i/Dr.dot(r,a),r]}function tc(e,r){return Dr.set(e,-r[1],r[0])}function pl(e,r,t){return Dr.sub(e,r,t),Dr.normalize(e,e),e}function Up(e,r){return e[0]===r[0]&&e[1]===r[1]}function l0(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var Zv=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ge.Z)(this,e),(0,N.Z)(this,"lastFlip",-1),(0,N.Z)(this,"miter",Dr.fromValues(0,0)),(0,N.Z)(this,"started",!1),(0,N.Z)(this,"dash",!1),(0,N.Z)(this,"totalDistance",0),(0,N.Z)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,K.Z)(e,[{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var c,p,_,b=t[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=t[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<t.length-1?[].concat((0,Gt.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,B=l<n.length-1?n[l+1]:null,H=this.segment_gaode2(i,s,b,w,P,A,I,B);s+=H}if(this.dash)for(var Q=0;Q<i.positions.length/6;Q++)i.positions[Q*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var c,p,_,b=t[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=t[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<t.length-1?[].concat((0,Gt.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,B=l<n.length-1?n[l+1]:null,H=this.simpleSegment(i,s,b,w,P,A,I,B);s+=H}if(this.dash)for(var Q=0;Q<i.positions.length/6;Q++)i.positions[Q*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],c=t[s],p=s<t.length-1?t[s+1]:null,_=this.segment(n,a,l,c,p);a+=_}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],c=t[s],p=s<t.length-1?t[s+1]:null,_=this.simpleSegment(n,a,l,c,p);a+=_}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,i,a,s,l,c,p){var _=0,b=t.indices,A=t.positions,w=t.normals,I=this.cap==="square",P=this.join==="bevel",B=La([c[0],c[1]]),H=La([l[0],l[1]]);pl(Mo,a,i);var Q=0;if(this.dash&&(Q=this.lineSegmentDistance(B,H),this.totalDistance+=Q),this.normal||(this.normal=Dr.create(),tc(this.normal,Mo)),!this.started)if(this.started=!0,I){var ue=Dr.create(),Ee=Dr.create();Dr.add(ue,this.normal,Mo),Dr.add(Ee,this.normal,Mo),w.push(Ee[0],Ee[1],0),w.push(ue[0],ue[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-Q,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-Q,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,i,this.normal,this.thickness,this.totalDistance-Q);if(b.push(n+0,n+1,n+2),s){Up(a,s)&&Dr.add(s,a,Dr.normalize(s,Dr.subtract(s,a,i))),pl(Js,s,a);var tt=tp(Io,Dr.create(),Mo,Js,this.thickness),ft=(0,re.Z)(tt,2),wt=ft[0],fr=ft[1],hr=Dr.dot(Io,this.normal)<0?-1:1,Mr=P;if(!Mr&&this.join==="miter"){var ln=wt;ln>this.miterLimit&&(Mr=!0)}Mr?(w.push(this.normal[0],this.normal[1],0),w.push(fr[0],fr[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*hr,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*hr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,(0,Gt.Z)(this.lastFlip!==-hr?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),tc(Bs,Js),Dr.copy(this.normal,Bs),w.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*hr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(A,w,a,fr,wt,this.totalDistance),b.push.apply(b,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),hr=-1,Dr.copy(this.normal,fr),_+=2),this.lastFlip=hr}else{if(tc(this.normal,Mo),I){var Le=Dr.create(),Ze=Dr.create();Dr.sub(Ze,Mo,this.normal),Dr.add(Le,Mo,this.normal),w.push(Ze[0],Ze[1],0),w.push(Le[0],Le[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,a,this.normal,this.thickness,this.totalDistance);b.push.apply(b,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"simpleSegment",value:function(t,n,i,a,s){var l=0,c=t.indices,p=t.positions,_=t.normals,b=La([a[0],a[1]]),A=La([i[0],i[1]]);pl(Mo,b,A);var w=0;if(this.dash&&(w=this.lineSegmentDistance(b,A),this.totalDistance+=w),this.normal||(this.normal=Dr.create(),tc(this.normal,Mo)),this.started||(this.started=!0,this.extrusions(p,_,i,this.normal,this.thickness,this.totalDistance-w)),c.push(n+0,n+1,n+2),!s)tc(this.normal,Mo),this.extrusions(p,_,a,this.normal,this.thickness,this.totalDistance),c.push.apply(c,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=La([s[0],s[1]]);Up(b,I)&&Dr.add(I,b,Dr.normalize(I,Dr.subtract(I,b,A))),pl(Js,I,b);var P=tp(Io,Dr.create(),Mo,Js,this.thickness),B=(0,re.Z)(P,2),H=B[0],Q=B[1],ue=Dr.dot(Io,this.normal)<0?-1:1;this.extrusions(p,_,a,Q,H,this.totalDistance),c.push.apply(c,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ue=-1,Dr.copy(this.normal,Q),l+=2,this.lastFlip=ue}return l}},{key:"segment",value:function(t,n,i,a,s){var l=0,c=t.indices,p=t.positions,_=t.normals,b=this.cap==="square",A=this.join==="bevel",w=La([a[0],a[1]]),I=La([i[0],i[1]]);pl(Mo,w,I);var P=0;if(this.dash&&(P=this.lineSegmentDistance(w,I),this.totalDistance+=P),this.normal||(this.normal=Dr.create(),tc(this.normal,Mo)),!this.started)if(this.started=!0,b){var B=Dr.create(),H=Dr.create();Dr.add(B,this.normal,Mo),Dr.add(H,this.normal,Mo),_.push(H[0],H[1],0),_.push(B[0],B[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,_,i,this.normal,this.thickness,this.totalDistance-P);if(c.push(n+0,n+1,n+2),s){var Ee=La([s[0],s[1]]);Up(w,Ee)&&Dr.add(Ee,w,Dr.normalize(Ee,Dr.subtract(Ee,w,I))),pl(Js,Ee,w);var Le=tp(Io,Dr.create(),Mo,Js,this.thickness),Ze=(0,re.Z)(Le,2),tt=Ze[0],ft=Ze[1],wt=Dr.dot(Io,this.normal)<0?-1:1,fr=A;if(!fr&&this.join==="miter"){var hr=tt;hr>this.miterLimit&&(fr=!0)}fr?(_.push(this.normal[0],this.normal[1],0),_.push(ft[0],ft[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*wt,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*wt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,(0,Gt.Z)(this.lastFlip!==-wt?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),tc(Bs,Js),Dr.copy(this.normal,Bs),_.push(this.normal[0],this.normal[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*wt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(p,_,a,ft,tt,this.totalDistance),c.push.apply(c,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),wt=-1,Dr.copy(this.normal,ft),l+=2),this.lastFlip=wt}else{if(tc(this.normal,Mo),b){var Q=Dr.create(),ue=Dr.create();Dr.sub(ue,Mo,this.normal),Dr.add(Q,Mo,this.normal),_.push(ue[0],ue[1],0),_.push(Q[0],Q[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,_,a,this.normal,this.thickness,this.totalDistance);c.push.apply(c,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}();function Nf(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new Zv({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var s=t;Array.isArray(s[0][0])||(s=[t]);for(var l=0;l<a.length;l++){var c=a[l],p=s[l];i.extrude_gaode2(c,p)}}else{var _=r;_[0]&&!Array.isArray(_[0][0])&&(_=[r]),_.forEach(function(A){i.extrude(A)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function rp(e){var r=qs(e.coordinates);return{vertices:[].concat((0,Gt.Z)(r),(0,Gt.Z)(r),(0,Gt.Z)(r),(0,Gt.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function yh(e){var r=e.coordinates,t=Ro().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes,s=Ro()(n,a,i);return{indices:s,vertices:n,size:i}}var Od=function(){var e=(0,Nt.Z)(xe().mark(function r(t){var n,i,a,s,l,c,p,_,b;return xe().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s=t.iconMap,l={a_Color:no,a_Position:pu,filter:Rc,a_vertexId:Wu,a_PickingColor:function(P){var B=P.id;return a?Ra(B):[0,0,0]},a_DistanceAndIndex:function(P,B,H,Q,ue,Ee){return Ee===void 0?[H[3],10]:[H[3],Ee]},a_Total_Distance:function(P,B,H){return[H[5]]},a_Size:function(P){var B=P.size,H=B===void 0?1:B;return Array.isArray(H)?[H[0],H[1]]:[H,0]},a_Normal:function(P,B,H,Q,ue){return ue},a_Miter:function(P,B,H){return[H[4]]},a_iconMapUV:function(P){var B=P.texture,H=s[B]||{x:0,y:0},Q=H.x,ue=H.y;return[Q,ue]}},c={sizePerElement:0,elements:[]},p=0,_=[],b=3,i.forEach(function(I,P){var B=Nf(I),H=B.indices,Q=B.vertices,ue=B.normals,Ee=B.size,Le=B.indexes;H.forEach(function(wt){_.push(wt+p)}),b=Ee;var Ze=Q.length/Ee;c.sizePerElement=b,c.elements.push({featureIdx:P,vertices:Q,normals:ue,offset:p}),p+=Ze;for(var tt=function(fr){var hr=(ue==null?void 0:ue.slice(fr*3,fr*3+3))||[],Mr=Q.slice(fr*Ee,fr*Ee+Ee),ln=0;Le&&Le[fr]!==void 0&&(ln=Le[fr]),n.forEach(function(Rn){if(Rn&&l[Rn.name]){var wi;(wi=Rn.buffer.data).push.apply(wi,(0,Gt.Z)(l[Rn.name](I,P,Mr,fr,hr,ln)))}})},ft=0;ft<Ze;ft++)tt(ft)}),w.abrupt("return",{descriptors:n,featureLayout:c,indices:_});case 8:case"end":return w.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Mc=function(){var e=(0,Nt.Z)(xe().mark(function r(t){var n,i,a,s,l,c,p,_,b;return xe().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s=t.shape2d,l={a_Color:no,a_Position:pu,filter:Rc,a_vertexId:Wu,a_PickingColor:function(P){var B=P.id;return a?Ra(B):[0,0,0]},a_Shape:function(P){var B=P.shape,H=B===void 0?2:B,Q=s.indexOf(H);return[Q]},a_Extrude:function(P,B,H,Q){var ue=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Ee=Q%4*3;return[ue[Ee],ue[Ee+1],ue[Ee+2]]},a_Size:function(P){var B=P.size,H=B===void 0?5:B;return Array.isArray(H)?[H[0]]:[H]}},c={sizePerElement:0,elements:[]},p=0,_=[],b=3,i.forEach(function(I,P){var B=rp(I),H=B.indices,Q=B.vertices,ue=B.normals,Ee=B.size,Le=B.indexes;H.forEach(function(wt){_.push(wt+p)}),b=Ee;var Ze=Q.length/Ee;c.sizePerElement=b,c.elements.push({featureIdx:P,vertices:Q,normals:ue,offset:p}),p+=Ze;for(var tt=function(fr){var hr=(ue==null?void 0:ue.slice(fr*3,fr*3+3))||[],Mr=Q.slice(fr*Ee,fr*Ee+Ee),ln=0;Le&&Le[fr]!==void 0&&(ln=Le[fr]),n.forEach(function(Rn){if(Rn&&l[Rn.name]){var wi;(wi=Rn.buffer.data).push.apply(wi,(0,Gt.Z)(l[Rn.name](I,P,Mr,fr,hr,ln)))}})},ft=0;ft<Ze;ft++)tt(ft)}),w.abrupt("return",{descriptors:n,featureLayout:c,indices:_});case 8:case"end":return w.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),xh=function(){var e=(0,Nt.Z)(xe().mark(function r(t){var n,i,a,s,l,c,p,_;return xe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s={a_Color:no,a_Position:pu,filter:Rc,a_vertexId:Wu,a_PickingColor:function(I){var P=I.id;return a?Ra(P):[0,0,0]}},l={sizePerElement:0,elements:[]},c=0,p=[],_=3,i.forEach(function(w,I){var P=yh(w),B=P.indices,H=P.vertices,Q=P.normals,ue=P.size,Ee=P.indexes;B.forEach(function(ft){p.push(ft+c)}),_=ue;var Le=H.length/ue;l.sizePerElement=_,l.elements.push({featureIdx:I,vertices:H,normals:Q,offset:c}),c+=Le;for(var Ze=function(wt){var fr=(Q==null?void 0:Q.slice(wt*3,wt*3+3))||[],hr=H.slice(wt*ue,wt*ue+ue),Mr=0;Ee&&Ee[wt]!==void 0&&(Mr=Ee[wt]),n.forEach(function(ln){if(ln&&s[ln.name]){var Rn;(Rn=ln.buffer.data).push.apply(Rn,(0,Gt.Z)(s[ln.name](w,I,hr,wt,fr,Mr)))}})},tt=0;tt<Le;tt++)Ze(tt)}),A.abrupt("return",{descriptors:n,featureLayout:l,indices:p});case 8:case"end":return A.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Vv={pointFill:Mc,line:Od,polygonFill:xh},kd=(0,k.Z)({},Vv);function c0(e){return zp.apply(this,arguments)}function zp(){return zp=_asyncToGenerator(_regeneratorRuntime.mark(function e(r){var t,n;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=r.workerType,n=r.data,!kd[t]){a.next=3;break}return a.abrupt("return",kd[t](n));case 3:return a.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return a.stop()}},e)})),zp.apply(this,arguments)}var Dd=new Map;function Ld(e,r){Dd.set(e,r)}function Zp(e){var r=Dd.get(e);return r}var Bl="l7-worker",np=3,Ic=!0;function Vp(e){registerWorkerSource(Bl,e)}function qa(){var e=getWorkerSource(Bl);if(!e)throw new Error("get worker failed by workerName: ".concat(Bl,"."));return e}function Uf(e,r){return zf.apply(this,arguments)}function zf(){return zf=_asyncToGenerator(_regeneratorRuntime.mark(function e(r,t){var n,i,a,s,l;return _regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n=qa(),i=WorkerFarm.getWorkerFarm({maxConcurrency:np,reuseWorkers:Ic}),a=i.getWorkerPool({name:Bl,source:n}),p.next=5,a.startJob(Bl,function(_,b,A){return _.done(A)});case 5:return s=p.sent,s.postMessage("process",{input:{workerType:r,data:t}}),p.next=9,s.result;case 9:return l=p.sent,p.abrupt("return",l.result);case 11:case"end":return p.stop()}},e)})),zf.apply(this,arguments)}function dl(e,r){return e==null?r:e}var nf=Z(38163),Pc=Z.n(nf);function Zf(e,r){return e.map(function(t){return t[r]*1})}function Vf(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function Oc(e){return Array.isArray(e)?e.length===0?!1:!!Vf(e[0]):!1}function kc(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function rc(e){var r=Object.isFrozen(e)?vi.cloneDeep(e):e;return Pc()(r,!0),r}function jp(e,r){var t=r.x,n=r.y,i=r.x1,a=r.y1,s=r.coordinates,l=r.geometry,c=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(H){return H[l]&&H[l].type&&H[l].coordinates&&H[l].coordinates.length>0}).forEach(function(H,Q){var ue=rc(H[l]);U(ue,function(Ee){var Le=Vt(Ee),Ze=(0,k.Z)((0,k.Z)({},H),{},{_id:Q,coordinates:Le});c.push(Ze)})}),{dataArray:c};for(var p=0;p<e.length;p++){var _=e[p],b=[];if(s){var A="Polygon";Array.isArray(s[0])||(A="Point"),Array.isArray(s[0])&&!Array.isArray(s[0][0])&&(A="LineString");var w=rc({type:A,coordinates:_[s]});b=w.coordinates}else if(t&&n&&i&&a){var I=[parseFloat(_[t]),parseFloat(_[n])],P=[parseFloat(_[i]),parseFloat(_[a])];b=[I,P]}else t&&n&&(b=[parseFloat(_[t]),parseFloat(_[n])]);var B=(0,k.Z)((0,k.Z)({},_),{},{_id:p,coordinates:b});c.push(B)}return{dataArray:c}}function nc(e,r){var t=lt(e);return jp(t,r)}var Fs=Z(90484);function ip(e){for(var r=e.toString(),t=5381,n=r.length;n;)t=t*33^r.charCodeAt(--n);return t>>>0}function Hp(e,r){return r===void 0?null:(0,Fs.Z)(e.properties[r])*1==="number"?e.properties[r]*1:e.properties&&e.properties[r]?ip(e.properties[r]+"")%1000019:null}function Wp(e,r){var t=[],n={};return e.features?(e.features=e.features.filter(function(i){var a=i.geometry;return i!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),e=rc(e),e.features.length===0?{dataArray:[],featureKeys:n}:(U(e,function(i,a){var s=Hp(i,r==null?void 0:r.featureId);s===null&&(s=a);var l=s,c=Vt(i),p=(0,k.Z)((0,k.Z)({},i.properties),{},{coordinates:c,_id:l});t.push(p)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}function bh(e,r,t,n){for(var i=n,a=t-r>>1,s=t-r,l,c=e[r],p=e[r+1],_=e[t],b=e[t+1],A=r+3;A<t;A+=3){var w=vl(e[A],e[A+1],c,p,_,b);if(w>i)l=A,i=w;else if(w===i){var I=Math.abs(A-a);I<s&&(l=A,s=I)}}i>n&&(l-r>3&&bh(e,r,l,n),e[l+2]=i,t-l>3&&bh(e,l,t,n))}function vl(e,r,t,n,i,a){var s=i-t,l=a-n;if(s!==0||l!==0){var c=((e-t)*s+(r-n)*l)/(s*s+l*l);c>1?(t=i,n=a):c>0&&(t+=s*c,n+=l*c)}return s=e-t,l=r-n,s*s+l*l}function Gu(e,r,t,n){var i={id:typeof e=="undefined"?null:e,type:r,geometry:t,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return Bd(i),i}function Bd(e){var r=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")ap(e,r);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<r.length;n++)ap(e,r[n]);else if(t==="MultiPolygon")for(n=0;n<r.length;n++)for(var i=0;i<r[n].length;i++)ap(e,r[n][i])}function ap(e,r){for(var t=0;t<r.length;t+=3)e.minX=Math.min(e.minX,r[t]),e.minY=Math.min(e.minY,r[t+1]),e.maxX=Math.max(e.maxX,r[t]),e.maxY=Math.max(e.maxY,r[t+1])}function Fd(e,r){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Eh(t,e.features[n],r,n);else e.type==="Feature"?Eh(t,e,r):Eh(t,{geometry:e},r);return t}function Eh(e,r,t,n){if(!!r.geometry){var i=r.geometry.coordinates,a=r.geometry.type,s=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),l=[],c=r.id;if(t.promoteId?c=r.properties[t.promoteId]:t.generateId&&(c=n||0),a==="Point")Dc(i,l);else if(a==="MultiPoint")for(var p=0;p<i.length;p++)Dc(i[p],l);else if(a==="LineString")Gp(i,l,s,!1);else if(a==="MultiLineString")if(t.lineMetrics){for(p=0;p<i.length;p++)l=[],Gp(i[p],l,s,!1),e.push(Gu(c,"LineString",l,r.properties));return}else Xu(i,l,s,!1);else if(a==="Polygon")Xu(i,l,s,!0);else if(a==="MultiPolygon")for(p=0;p<i.length;p++){var _=[];Xu(i[p],_,s,!0),l.push(_)}else if(a==="GeometryCollection"){for(p=0;p<r.geometry.geometries.length;p++)Eh(e,{id:c,geometry:r.geometry.geometries[p],properties:r.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Gu(c,a,l,r.properties))}}function Dc(e,r){r.push(op(e[0])),r.push(Lc(e[1])),r.push(0)}function Gp(e,r,t,n){for(var i,a,s=0,l=0;l<e.length;l++){var c=op(e[l][0]),p=Lc(e[l][1]);r.push(c),r.push(p),r.push(0),l>0&&(n?s+=(i*p-c*a)/2:s+=Math.sqrt(Math.pow(c-i,2)+Math.pow(p-a,2))),i=c,a=p}var _=r.length-3;r[2]=1,bh(r,0,_,t),r[_+2]=1,r.size=Math.abs(s),r.start=0,r.end=r.size}function Xu(e,r,t,n){for(var i=0;i<e.length;i++){var a=[];Gp(e[i],a,t,n),r.push(a)}}function op(e){return e/360+.5}function Lc(e){var r=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return t<0?0:t>1?1:t}function Ns(e,r,t,n,i,a,s,l){if(t/=r,n/=r,a>=t&&s<n)return e;if(s<t||a>=n)return null;for(var c=[],p=0;p<e.length;p++){var _=e[p],b=_.geometry,A=_.type,w=i===0?_.minX:_.minY,I=i===0?_.maxX:_.maxY;if(w>=t&&I<n){c.push(_);continue}else if(I<t||w>=n)continue;var P=[];if(A==="Point"||A==="MultiPoint")Nd(b,P,t,n,i);else if(A==="LineString")ic(b,P,t,n,i,!1,l.lineMetrics);else if(A==="MultiLineString")jf(b,P,t,n,i,!1);else if(A==="Polygon")jf(b,P,t,n,i,!0);else if(A==="MultiPolygon")for(var B=0;B<b.length;B++){var H=[];jf(b[B],H,t,n,i,!0),H.length&&P.push(H)}if(P.length){if(l.lineMetrics&&A==="LineString"){for(B=0;B<P.length;B++)c.push(Gu(_.id,A,P[B],_.tags));continue}(A==="LineString"||A==="MultiLineString")&&(P.length===1?(A="LineString",P=P[0]):A="MultiLineString"),(A==="Point"||A==="MultiPoint")&&(A=P.length===3?"Point":"MultiPoint"),c.push(Gu(_.id,A,P,_.tags))}}return c.length?c:null}function Nd(e,r,t,n,i){for(var a=0;a<e.length;a+=3){var s=e[a+i];s>=t&&s<=n&&(r.push(e[a]),r.push(e[a+1]),r.push(e[a+2]))}}function ic(e,r,t,n,i,a,s){for(var l=Sh(e),c=i===0?ds:Po,p=e.start,_,b,A=0;A<e.length-3;A+=3){var w=e[A],I=e[A+1],P=e[A+2],B=e[A+3],H=e[A+4],Q=i===0?w:I,ue=i===0?B:H,Ee=!1;s&&(_=Math.sqrt(Math.pow(w-B,2)+Math.pow(I-H,2))),Q<t?ue>t&&(b=c(l,w,I,B,H,t),s&&(l.start=p+_*b)):Q>n?ue<n&&(b=c(l,w,I,B,H,n),s&&(l.start=p+_*b)):Jo(l,w,I,P),ue<t&&Q>=t&&(b=c(l,w,I,B,H,t),Ee=!0),ue>n&&Q<=n&&(b=c(l,w,I,B,H,n),Ee=!0),!a&&Ee&&(s&&(l.end=p+_*b),r.push(l),l=Sh(e)),s&&(p+=_)}var Le=e.length-3;w=e[Le],I=e[Le+1],P=e[Le+2],Q=i===0?w:I,Q>=t&&Q<=n&&Jo(l,w,I,P),Le=l.length-3,a&&Le>=3&&(l[Le]!==l[0]||l[Le+1]!==l[1])&&Jo(l,l[0],l[1],l[2]),l.length&&r.push(l)}function Sh(e){var r=[];return r.size=e.size,r.start=e.start,r.end=e.end,r}function jf(e,r,t,n,i,a){for(var s=0;s<e.length;s++)ic(e[s],r,t,n,i,a,!1)}function Jo(e,r,t,n){e.push(r),e.push(t),e.push(n)}function ds(e,r,t,n,i,a){var s=(a-r)/(n-r);return e.push(a),e.push(t+(i-t)*s),e.push(1),s}function Po(e,r,t,n,i,a){var s=(a-t)/(i-t);return e.push(r+(n-r)*s),e.push(a),e.push(1),s}function du(e,r){var t=r.buffer/r.extent,n=e,i=Ns(e,1,-1-t,t,0,-1,2,r),a=Ns(e,1,1-t,2+t,0,-1,2,r);return(i||a)&&(n=Ns(e,1,-t,1+t,0,-1,2,r)||[],i&&(n=Xp(i,1).concat(n)),a&&(n=n.concat(Xp(a,-1)))),n}function Xp(e,r){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=i.type,s;if(a==="Point"||a==="MultiPoint"||a==="LineString")s=af(i.geometry,r);else if(a==="MultiLineString"||a==="Polygon"){s=[];for(var l=0;l<i.geometry.length;l++)s.push(af(i.geometry[l],r))}else if(a==="MultiPolygon")for(s=[],l=0;l<i.geometry.length;l++){for(var c=[],p=0;p<i.geometry[l].length;p++)c.push(af(i.geometry[l][p],r));s.push(c)}t.push(Gu(i.id,a,s,i.tags))}return t}function af(e,r){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+r,e[n+1],e[n+2]);return t}function $p(e,r){if(e.transformed)return e;var t=1<<e.z,n=e.x,i=e.y,a,s,l;for(a=0;a<e.features.length;a++){var c=e.features[a],p=c.geometry,_=c.type;if(c.geometry=[],_===1)for(s=0;s<p.length;s+=2)c.geometry.push(Ud(p[s],p[s+1],r,t,n,i));else for(s=0;s<p.length;s++){var b=[];for(l=0;l<p[s].length;l+=2)b.push(Ud(p[s][l],p[s][l+1],r,t,n,i));c.geometry.push(b)}}return e.transformed=!0,e}function Ud(e,r,t,n,i,a){return[Math.round(t*(e*n-i)),Math.round(t*(r*n-a))]}function jv(e,r,t,n,i){for(var a=r===i.maxZoom?0:i.tolerance/((1<<r)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:r,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){s.numFeatures++,zd(s,e[l],a,i);var c=e[l].minX,p=e[l].minY,_=e[l].maxX,b=e[l].maxY;c<s.minX&&(s.minX=c),p<s.minY&&(s.minY=p),_>s.maxX&&(s.maxX=_),b>s.maxY&&(s.maxY=b)}return s}function zd(e,r,t,n){var i=r.geometry,a=r.type,s=[];if(a==="Point"||a==="MultiPoint")for(var l=0;l<i.length;l+=3)s.push(i[l]),s.push(i[l+1]),e.numPoints++,e.numSimplified++;else if(a==="LineString")Yp(s,i,e,t,!1,!1);else if(a==="MultiLineString"||a==="Polygon")for(l=0;l<i.length;l++)Yp(s,i[l],e,t,a==="Polygon",l===0);else if(a==="MultiPolygon")for(var c=0;c<i.length;c++){var p=i[c];for(l=0;l<p.length;l++)Yp(s,p[l],e,t,!0,l===0)}if(s.length){var _=r.tags||null;if(a==="LineString"&&n.lineMetrics){_={};for(var b in r.tags)_[b]=r.tags[b];_.mapbox_clip_start=i.start/i.size,_.mapbox_clip_end=i.end/i.size}var A={geometry:s,type:a==="Polygon"||a==="MultiPolygon"?3:a==="LineString"||a==="MultiLineString"?2:1,tags:_};r.id!==null&&(A.id=r.id),e.features.push(A)}}function Yp(e,r,t,n,i,a){var s=n*n;if(n>0&&r.size<(i?s:n)){t.numPoints+=r.length/3;return}for(var l=[],c=0;c<r.length;c+=3)(n===0||r[c+2]>s)&&(t.numSimplified++,l.push(r[c]),l.push(r[c+1])),t.numPoints++;i&&Zd(l,a),e.push(l)}function Zd(e,r){for(var t=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)t+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(t>0===r)for(n=0,i=e.length;n<i/2;n+=2){var s=e[n],l=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=s,e[i-1-n]=l}}function As(e,r){return new sp(e,r)}function sp(e,r){r=this.options=qp(Object.create(this.options),r);var t=r.debug;if(t&&console.time("preprocess data"),r.maxZoom<0||r.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Fd(e,r);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=du(n,r),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}sp.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},sp.prototype.splitTile=function(e,r,t,n,i,a,s){for(var l=[e,r,t,n],c=this.options,p=c.debug;l.length;){n=l.pop(),t=l.pop(),r=l.pop(),e=l.pop();var _=1<<r,b=up(r,t,n),A=this.tiles[b];if(!A&&(p>1&&console.time("creation"),A=this.tiles[b]=jv(e,r,t,n,c),this.tileCoords.push({z:r,x:t,y:n}),p)){p>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,t,n,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var w="z"+r;this.stats[w]=(this.stats[w]||0)+1,this.total++}if(A.source=e,i){if(r===c.maxZoom||r===i)continue;var I=1<<i-r;if(t!==Math.floor(a/I)||n!==Math.floor(s/I))continue}else if(r===c.indexMaxZoom||A.numPoints<=c.indexMaxPoints)continue;if(A.source=null,e.length!==0){p>1&&console.time("clipping");var P=.5*c.buffer/c.extent,B=.5-P,H=.5+P,Q=1+P,ue,Ee,Le,Ze,tt,ft;ue=Ee=Le=Ze=null,tt=Ns(e,_,t-P,t+H,0,A.minX,A.maxX,c),ft=Ns(e,_,t+B,t+Q,0,A.minX,A.maxX,c),e=null,tt&&(ue=Ns(tt,_,n-P,n+H,1,A.minY,A.maxY,c),Ee=Ns(tt,_,n+B,n+Q,1,A.minY,A.maxY,c),tt=null),ft&&(Le=Ns(ft,_,n-P,n+H,1,A.minY,A.maxY,c),Ze=Ns(ft,_,n+B,n+Q,1,A.minY,A.maxY,c),ft=null),p>1&&console.timeEnd("clipping"),l.push(ue||[],r+1,t*2,n*2),l.push(Ee||[],r+1,t*2,n*2+1),l.push(Le||[],r+1,t*2+1,n*2),l.push(Ze||[],r+1,t*2+1,n*2+1)}}},sp.prototype.getTile=function(e,r,t){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var s=1<<e;r=(r%s+s)%s;var l=up(e,r,t);if(this.tiles[l])return $p(this.tiles[l],i);a>1&&console.log("drilling down to z%d-%d-%d",e,r,t);for(var c=e,p=r,_=t,b;!b&&c>0;)c--,p=Math.floor(p/2),_=Math.floor(_/2),b=this.tiles[up(c,p,_)];return!b||!b.source?null:(a>1&&console.log("found parent tile z%d-%d-%d",c,p,_),a>1&&console.time("drilling down"),this.splitTile(b.source,c,p,_,e,r,t),a>1&&console.timeEnd("drilling down"),this.tiles[l]?$p(this.tiles[l],i):null)};function up(e,r,t){return((1<<e)*t+r)*32+e}function qp(e,r){for(var t in r)e[t]=r[t];return e}var Hf=function(){function e(r,t,n,i){(0,ge.Z)(this,e),(0,N.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=r}return(0,K.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Kp={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Hv(e){for(var r=0,t=0,n=e.length,i=n-1,a,s;t<n;i=t++)a=e[t],s=e[i],r+=(s.x-a.x)*(a.y+s.y);return r}function Wv(e){var r=e.length;if(r<=1)return[e];for(var t=[],n,i,a=0;a<r;a++){var s=Hv(e[a]);s!==0&&(i===void 0&&(i=s<0),i===s<0?(n&&t.push(n),n=[e[a]]):n.push(e[a]))}return n&&t.push(n),t}var Vd=["Unknown","Point","LineString","Polygon"];function jd(e,r,t,n,i){var a=i.geometry,s=i.type,l=i.tags,c=i.id,p=e*Math.pow(2,n),_=e*r,b=e*t,A=Vd[s],w,I;function P(Q){for(var ue=0;ue<Q.length;ue++){var Ee=Q[ue];if(Ee[3])break;var Le=180-(Ee[1]+b)*360/p,Ze=(Ee[0]+_)*360/p-180,tt=360/Math.PI*Math.atan(Math.exp(Le*Math.PI/180))-90;Q[ue]=[Ze,tt,0,1]}}switch(s){case 1:var B=[];for(w=0;w<a.length;w++)B[w]=a[w][0];a=B,P(a);break;case 2:for(w=0;w<a.length;w++)P(a[w]);break;case 3:for(a=Wv(a),w=0;w<a.length;w++)for(I=0;I<a[w].length;I++)P(a[w][I]);break}a.length===1?a=a[0]:A="Multi"+A;var H={type:"Feature",geometry:{type:A,coordinates:a},properties:l,id:c,tileOrigin:[0,0],coord:""};return H}var W=function(){var e=(0,Nt.Z)(xe().mark(function r(t,n,i,a){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(c){var p=n.getTile(t.z,t.x,t.y),_=p?p.features.map(function(w){return jd(a,i.x,i.y,i.z,w)}):[],b={layers:{defaultLayer:{features:_}}},A=new Hf(b,t.x,t.y,t.z);c(A)}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function Ce(e){var r={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?r:(0,k.Z)((0,k.Z)({},r),e.geojsonvtOptions)}function Ke(e,r){var t=Ce(r),n=t.extent||4096,i=As(e,t),a=function(c,p){return W(p,i,c,n)},s=(0,k.Z)((0,k.Z)((0,k.Z)({},Kp),r),{},{getTileData:a});return{data:e,dataArray:[],tilesetOptions:s,isTile:!0}}function Yt(e,r){var t=r.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,i=r.requestParameters,a=i===void 0?{}:i,s=new Promise(function(c){e instanceof HTMLImageElement||Sf(e)?c([e]):pr(e,a,function(p){c(p)})}),l={originData:e,images:s,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return l}function pr(e,r,t){var n=[];if(typeof e=="string")Gs((0,k.Z)((0,k.Z)({},r),{},{url:e}),function(s,l){l&&(n.push(l),t(n))});else{var i=e.length,a=0;e.forEach(function(s){Gs((0,k.Z)((0,k.Z)({},r),{},{url:s}),function(l,c){a++,c&&n.push(c),a===i&&t(n)})})}return Yt}var Qt=function(){var e=(0,Nt.Z)(xe().mark(function r(t,n,i,a){var s,l;return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return s={x:n.x,y:n.y,z:n.z},l=v(t,s),p.abrupt("return",new Promise(function(_){a?a(s,function(b,A){if(b||!A){var w={layers:{defaultLayer:{features:[]}}},I=new Hf(w,n.x,n.y,n.z);_(I)}else{var P={layers:{defaultLayer:{features:A.features}}},B=new Hf(P,n.x,n.y,n.z);_(B)}}):Sa((0,k.Z)((0,k.Z)({},i),{},{url:l}),function(b,A){if(b||!A){var w={layers:{defaultLayer:{features:[]}}},I=new Hf(w,n.x,n.y,n.z);_(I)}else{var P=JSON.parse(A),B={layers:{defaultLayer:{features:P}}},H=new Hf(B,n.x,n.y,n.z);_(H)}})}));case 3:case"end":return p.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function zt(e,r){var t=function(a,s){return Qt(e,s,r==null?void 0:r.requestParameters,r.getCustomData)},n=(0,k.Z)((0,k.Z)({},r),{},{getTileData:t});return{dataArray:[],tilesetOptions:n,isTile:!0}}var Fr=Z(38929),Ir=Z(3614),Yr=Z.n(Ir),Ur=function(){function e(r,t,n,i){(0,ge.Z)(this,e),(0,N.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=new Fr.VectorTile(new(Yr())(r))}return(0,K.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];if(Array.isArray(n.features))return this.vectorLayerCache[t]=n.features,n.features;for(var i=[],a=0;a<n.length;a++){var s=n.feature(a),l=s.toGeoJSON(this.x,this.y,this.z);i.push((0,k.Z)((0,k.Z)({},l),{},{properties:(0,k.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[t]=i,i}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Wr={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},Qr=function(){var e=(0,Nt.Z)(xe().mark(function r(t,n,i,a,s){var l;return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return l=v(t,n),p.abrupt("return",new Promise(function(_){if(s)s({x:i.x,y:i.y,z:i.z},function(A,w){if(A||!w)_(void 0);else{var I=new Ur(w,i.x,i.y,i.z);_(I)}});else{var b=bo((0,k.Z)((0,k.Z)({},a),{},{url:l}),function(A,w){if(A||!w)_(void 0);else{var I=new Ur(w,i.x,i.y,i.z);_(I)}});i.xhrCancel=function(){return b.cancel()}}}));case 2:case"end":return p.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}();function Or(e,r){var t=Array.isArray(e)?e[0]:e,n=function(s,l){return Qr(t,s,l,r==null?void 0:r.requestParameters,r==null?void 0:r.getCustomData)},i=(0,k.Z)((0,k.Z)((0,k.Z)({},Wr),r),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}}function Xr(e,r,t){switch(e){case"+":return r+t;case"-":return r-t;case"*":return r*t;case"/":return r/t;case"%":return r%t;case"^":return Math.pow(r,t);case"abs":return Math.abs(r);case"floor":return Math.floor(r);case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"sin":return Math.sin(r);case"cos":return Math.cos(r);case"atan":return t===-1?Math.atan(r):Math.atan2(r,t);case"min":return Math.min(r,t);case"max":return Math.max(r,t);case"log10":return Math.log(r);case"log2":return Math.log2(r);default:return console.warn("Calculate symbol err! Return default 0"),0}}function It(e,r){for(var t=r[0],n=t.width,i=t.height,a=r.map(function(w){return w.rasterData}),s=n*i,l=[],c=JSON.stringify(e),p=0;p<s;p++){var _=JSON.parse(c),b=sr(_,a,p);if(typeof b=="number")l.push(b);else{var A=cn(_);l.push(A)}}return l}function sr(e,r,t){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return r[e[1]][t]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,i){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=r[n[1]][t]}catch(a){console.warn("Raster Data err!"),e[i]=0}break;default:sr(n,r,t)}})}function zr(e){var r=(0,re.Z)(e,3),t=r[0],n=r[1],i=n===void 0?-1:n,a=r[2],s=a===void 0?-1:a;if(t===void 0)return console.warn("Express err!"),["+",0,0];var l=t.replace(/\s+/g,"");return[l,i,s]}function cn(e){var r=zr(e),t=r[0],n=r[1],i=r[2];return Array.isArray(n)&&(n=cn(e[1])),Array.isArray(i)&&(i=cn(e[2])),Xr(t,n,i)}var Er={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:vn}};function vn(e,r){for(var t=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,a=[],s=(r==null?void 0:r.countCut)||[2,98],l=(0,re.Z)(s,2),c=l[0],p=l[1],_=(r==null?void 0:r.RMinMax)||kr(t,c,p),b=(r==null?void 0:r.GMinMax)||kr(n,c,p),A=(r==null?void 0:r.BMinMax)||kr(i,c,p),w=0;w<t.length;w++)a.push(Math.max(0,t[w]-_[0])),a.push(Math.max(0,n[w]-b[0])),a.push(Math.max(0,i[w]-A[0]));return{rasterData:a,rMinMax:_,gMinMax:b,bMinMax:A}}function kr(e,r,t){var n=e.slice().sort(function(l,c){return l-c}),i=n.length,a=n[Math.ceil(i*r/100)],s=n[Math.ceil(i*t/100)];return[a,s]}function pn(e,r,t){return br.apply(this,arguments)}function br(){return br=(0,Nt.Z)(xe().mark(function e(r,t,n){var i,a,s,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(r.length!==0){b.next=2;break}return b.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return b.next=4,Promise.all(r.map(function(A){var w=A.data,I=A.bands,P=I===void 0?[0]:I;return t(w,P)}));case 4:i=b.sent,a=[],i.forEach(function(A){Array.isArray(A)?a.push.apply(a,(0,Gt.Z)(A)):a.push(A)}),s=a[0],l=s.width,c=s.height,b.t0=(0,Fs.Z)(n),b.next=b.t0==="function"?11:b.t0==="object"?13:15;break;case 11:return p=n(a),b.abrupt("break",16);case 13:return Array.isArray(n)?p={rasterData:It(n,a)}:p=un(n,a),b.abrupt("break",16);case 15:p={rasterData:a[0].rasterData};case 16:return b.abrupt("return",(0,k.Z)((0,k.Z)({},p),{},{width:l,height:c}));case 17:case"end":return b.stop()}},e)})),br.apply(this,arguments)}function un(e,r){var t=Er[e.type];if(t.type==="function")return t.method(r,e==null?void 0:e.options);if(t.type==="operation")return e.type==="rgb"?jn(t.expression,r):{rasterData:It(t.expression,r)}}function jn(e,r){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var t=It(e.r||["band",0],r),n=It(e.g||["band",0],r),i=It(e.b||["band",0],r);return[t,n,i]}function ai(e,r,t,n){return rn.apply(this,arguments)}function rn(){return rn=(0,Nt.Z)(xe().mark(function e(r,t,n,i){var a;return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,pn(r,t,n);case 2:a=l.sent,i(null,{data:a});case 4:case"end":return l.stop()}},e)})),rn.apply(this,arguments)}function Lr(e,r){var t=r.extent,n=r.width,i=r.height,a=r.min,s=r.max,l=r.format,c=r.operation,p,_,b;if(l===void 0||kc(e))p=Array.from(e),_=n,b=i;else{var A=Array.isArray(e)?e:[e];p=pn(A,l,c)}var w={_id:1,dataArray:[{_id:1,data:p,width:_,height:b,min:a,max:s,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return w}var _r=Z(28660),Jt=Z(86700),Si=Z(84879),Ye={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},xi=Z(49296),ui=Z.n(xi);function Kn(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=$i(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function $i(e,r){if(!!e){if(typeof e=="string")return oo(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return oo(e,r)}}function oo(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var so=30;function Oi(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,a=e.maxCanvasWidth,s=e.mapping,l=s===void 0?{}:s,c=e.xOffset,p=c===void 0?0:c,_=e.yOffset,b=_===void 0?0:_,A=0,w=p;Array.from(r).forEach(function(P,B){if(!l[P]){var H=t(P,B);w+so>a&&(w=0,A++),l[P]={x:w,y:b+A*so,width:so,height:so,advance:H},w+=so}});var I=n+i*2;return{mapping:l,xOffset:w,yOffset:b+A*I,canvasHeight:po(b+(A+1)*I)}}function ho(e,r,t){var n=0,i=0,a=0,s=[],l={},c=Kn(e),p;try{for(c.s();!(p=c.n()).done;){var _=p.value;if(!l[_.id]){var b=_.size;n+b+r>t&&(ya(l,s,i),n=0,i=a+i+r,a=0,s=[]),s.push({icon:_,xOffset:n}),n=n+b+r,a=Math.max(a,b)}}}catch(w){c.e(w)}finally{c.f()}s.length>0&&ya(l,s,i);var A=po(a+i+r);return{mapping:l,canvasHeight:A}}function ya(e,r,t){var n=Kn(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,s=a.icon,l=a.xOffset;e[s.id]=(0,k.Z)((0,k.Z)({},s),{},{x:l,y:t,image:s.image,width:s.width,height:s.height})}}catch(c){n.e(c)}finally{n.f()}}function po(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var vo,Ua;function Oo(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=vs(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function vs(e,r){if(!!e){if(typeof e=="string")return mo(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return mo(e,r)}}function mo(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _i(e){var r=es();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function es(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qi=ve(),Yn="sans-serif",Ii="normal",Wi=24,go=3,ml=.25,Ge=8,tr=1024,Ht=1,mn=1,bi=3,pa=null;function ve(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}function Pe(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="black",e.textBaseline="middle"}function qe(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}var Wt=(vo=(0,Jt.b2)(),vo(Ua=function(e){(0,Qe.Z)(t,e);var r=_i(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"fontAtlas",void 0),(0,N.Z)((0,we.Z)(n),"iconFontMap",void 0),(0,N.Z)((0,we.Z)(n),"iconFontGlyphs",{}),(0,N.Z)((0,we.Z)(n),"fontOptions",void 0),(0,N.Z)((0,we.Z)(n),"key",void 0),(0,N.Z)((0,we.Z)(n),"cache",new Of(bi)),n}return(0,K.Z)(t,[{key:"scale",get:function(){return mn}},{key:"canvas",get:function(){var i=this.cache.get(this.key);return i&&i.data}},{key:"mapping",get:function(){var i=this.cache.get(this.key);return i&&i.mapping||{}}},{key:"getCanvasByKey",value:function(i){var a=this.cache.get(i);return a&&a.data}},{key:"getMappingByKey",value:function(i){var a=this.cache.get(i);return a&&a.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Yn,fontWeight:Ii,characterSet:Qi,fontSize:Wi,buffer:go,sdf:!0,cutoff:ml,radius:Ge,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(i){var a=this;i.forEach(function(s){a.iconFontGlyphs[s.name]=s.unicode})}},{key:"addIconFont",value:function(i,a){this.iconFontMap.set(i,a)}},{key:"getIconFontKey",value:function(i){return this.iconFontMap.get(i)||i}},{key:"getGlyph",value:function(i){return this.iconFontGlyphs[i]?String.fromCharCode(parseInt(this.iconFontGlyphs[i],16)):""}},{key:"setFontOptions",value:function(i){this.fontOptions=(0,k.Z)((0,k.Z)({},this.fontOptions),i),this.key=this.getKey();var a=this.getNewChars(this.key,this.fontOptions.characterSet),s=this.cache.get(this.key);if(!(s&&a.length===0)){var l=this.generateFontAtlas(this.key,a,s);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(i,a){var s=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(a,`') format('woff2'),
            url('`).concat(a,`') format('woff'),
            url('`).concat(a,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(i),"L7text"),document.fonts.ready.then(function(){s.emit("fontloaded",{fontFamily:i})})}catch(c){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(c)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(i,a,s){var l=this.fontOptions,c=l.fontFamily,p=l.fontWeight,_=l.fontSize,b=l.buffer,A=l.sdf,w=l.radius,I=l.cutoff,P=l.iconfont,B=s&&s.data;B||(B=window.document.createElement("canvas"),B.width=tr);var H=B.getContext("2d",{willReadFrequently:!0});Pe(H,c,_,p);var Q=Oi((0,k.Z)({getFontWidth:function(as){return H.measureText(as).width},fontHeight:_*mn,buffer:b,characterSet:a,maxCanvasWidth:tr},s&&{mapping:s.mapping,xOffset:s.xOffset,yOffset:s.yOffset})),ue=Q.mapping,Ee=Q.canvasHeight,Le=Q.xOffset,Ze=Q.yOffset,tt=H.getImageData(0,0,B.width,B.height);if(B.height=Ee,H.putImageData(tt,0,0),Pe(H,c,_,p),A){var ft=new(ui())(_,b,w,I,c,p),wt=H.getImageData(0,0,ft.size,ft.size),fr=Oo(a),hr;try{for(fr.s();!(hr=fr.n()).done;){var Mr=hr.value;if(P){var ln=String.fromCharCode(parseInt(Mr.replace("&#x","").replace(";",""),16)),Rn=ft.draw(ln);qe(Rn,wt)}else qe(ft.draw(Mr),wt);H.putImageData(wt,ue[Mr].x,ue[Mr].y)}}catch(io){fr.e(io)}finally{fr.f()}}else{var wi=Oo(a),ba;try{for(wi.s();!(ba=wi.n()).done;){var Va=ba.value;H.fillText(Va,ue[Va].x,ue[Va].y+_*Ht)}}catch(io){wi.e(io)}finally{wi.f()}}return{xOffset:Le,yOffset:Ze,mapping:ue,data:B,width:B.width,height:B.height}}},{key:"getKey",value:function(){var i=this.fontOptions,a=i.fontFamily,s=i.fontWeight;return"".concat(a,"_").concat(s)}},{key:"getNewChars",value:function(i,a){var s=this.cache.get(i);if(!s)return a;var l=[],c=s.mapping,p=new Set(Object.keys(c)),_=new Set(a);return _.forEach(function(b){p.has(b)||l.push(b)}),l}}]),t}(Fa.EventEmitter))||Ua),Ut,ot;function vt(e){var r=yt();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function yt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xe=3,ut=1024,Ie=64,ht=(Ut=(0,Jt.b2)(),Ut(ot=function(e){(0,Qe.Z)(t,e);var r=vt(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"canvasHeight",128),(0,N.Z)((0,we.Z)(n),"texture",void 0),(0,N.Z)((0,we.Z)(n),"canvas",void 0),(0,N.Z)((0,we.Z)(n),"iconData",void 0),(0,N.Z)((0,we.Z)(n),"iconMap",void 0),(0,N.Z)((0,we.Z)(n),"ctx",void 0),(0,N.Z)((0,we.Z)(n),"loadingImageCount",0),n}return(0,K.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s,l){var c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c=new Image,this.loadingImageCount++,this.hasImage(s)?console.warn("Image Id already exists"):this.iconData.push({id:s,size:Ie}),this.updateIconMap(),b.next=6,this.loadImage(l);case 6:c=b.sent,p=this.iconData.find(function(A){return A.id===s}),p&&(p.image=c,p.width=c.width,p.height=c.height),this.update();case 10:case"end":return b.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addImageMini",value:function(i,a,s){var l=this,c=s.getSceneConfig().canvas,p=c.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:Ie}),this.updateIconMap(),this.loadImageMini(a,c).then(function(_){p=_;var b=l.iconData.find(function(A){return A.id===i});b&&(b.image=p,b.width=p.width,b.height=p.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(a){return a.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(a,s){if(i instanceof HTMLImageElement){a(i);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){a(l)},l.onerror=function(){s(new Error("Could not load image at "+i))},l.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=ut,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(a){var s=i.iconMap[a],l=s.x,c=s.y,p=s.image,_=s.width,b=_===void 0?64:_,A=s.height,w=A===void 0?64:A,I=Math.max(b,w),P=I/Ie,B=w/P,H=b/P;p&&i.ctx.drawImage(p,l+(Ie-H)/2,c+(Ie-B)/2,H,B)})}},{key:"updateIconMap",value:function(){var i=ho(this.iconData,Xe,ut),a=i.mapping,s=i.canvasHeight;this.iconMap=a,this.canvasHeight=s}},{key:"loadImageMini",value:function(i,a){return new Promise(function(s,l){var c=a.createImage();c.crossOrigin="anonymous",c.onload=function(){s(c)},c.onerror=function(){l(new Error("Could not load image at "+i))},c.src=i})}}]),t}(Fa.EventEmitter))||ot),Ot=Z(49685);function or(){var e=new Ot.WT(16);return Ot.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function wr(e){var r=new Ot.WT(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function xr(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Pr(e,r,t,n,i,a,s,l,c,p,_,b,A,w,I,P){var B=new Ot.WT(16);return B[0]=e,B[1]=r,B[2]=t,B[3]=n,B[4]=i,B[5]=a,B[6]=s,B[7]=l,B[8]=c,B[9]=p,B[10]=_,B[11]=b,B[12]=A,B[13]=w,B[14]=I,B[15]=P,B}function On(e,r,t,n,i,a,s,l,c,p,_,b,A,w,I,P,B){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e[4]=a,e[5]=s,e[6]=l,e[7]=c,e[8]=p,e[9]=_,e[10]=b,e[11]=A,e[12]=w,e[13]=I,e[14]=P,e[15]=B,e}function Sn(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wn(e,r){if(e===r){var t=r[1],n=r[2],i=r[3],a=r[6],s=r[7],l=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=t,e[6]=r[9],e[7]=r[13],e[8]=n,e[9]=a,e[11]=r[14],e[12]=i,e[13]=s,e[14]=l}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}function Wn(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],s=r[4],l=r[5],c=r[6],p=r[7],_=r[8],b=r[9],A=r[10],w=r[11],I=r[12],P=r[13],B=r[14],H=r[15],Q=t*l-n*s,ue=t*c-i*s,Ee=t*p-a*s,Le=n*c-i*l,Ze=n*p-a*l,tt=i*p-a*c,ft=_*P-b*I,wt=_*B-A*I,fr=_*H-w*I,hr=b*B-A*P,Mr=b*H-w*P,ln=A*H-w*B,Rn=Q*ln-ue*Mr+Ee*hr+Le*fr-Ze*wt+tt*ft;return Rn?(Rn=1/Rn,e[0]=(l*ln-c*Mr+p*hr)*Rn,e[1]=(i*Mr-n*ln-a*hr)*Rn,e[2]=(P*tt-B*Ze+H*Le)*Rn,e[3]=(A*Ze-b*tt-w*Le)*Rn,e[4]=(c*fr-s*ln-p*wt)*Rn,e[5]=(t*ln-i*fr+a*wt)*Rn,e[6]=(B*Ee-I*tt-H*ue)*Rn,e[7]=(_*tt-A*Ee+w*ue)*Rn,e[8]=(s*Mr-l*fr+p*ft)*Rn,e[9]=(n*fr-t*Mr-a*ft)*Rn,e[10]=(I*Ze-P*Ee+H*Q)*Rn,e[11]=(b*Ee-_*Ze-w*Q)*Rn,e[12]=(l*wt-s*hr-c*ft)*Rn,e[13]=(t*hr-n*wt+i*ft)*Rn,e[14]=(P*ue-I*Le-B*Q)*Rn,e[15]=(_*Le-b*ue+A*Q)*Rn,e):null}function oi(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],s=r[4],l=r[5],c=r[6],p=r[7],_=r[8],b=r[9],A=r[10],w=r[11],I=r[12],P=r[13],B=r[14],H=r[15];return e[0]=l*(A*H-w*B)-b*(c*H-p*B)+P*(c*w-p*A),e[1]=-(n*(A*H-w*B)-b*(i*H-a*B)+P*(i*w-a*A)),e[2]=n*(c*H-p*B)-l*(i*H-a*B)+P*(i*p-a*c),e[3]=-(n*(c*w-p*A)-l*(i*w-a*A)+b*(i*p-a*c)),e[4]=-(s*(A*H-w*B)-_*(c*H-p*B)+I*(c*w-p*A)),e[5]=t*(A*H-w*B)-_*(i*H-a*B)+I*(i*w-a*A),e[6]=-(t*(c*H-p*B)-s*(i*H-a*B)+I*(i*p-a*c)),e[7]=t*(c*w-p*A)-s*(i*w-a*A)+_*(i*p-a*c),e[8]=s*(b*H-w*P)-_*(l*H-p*P)+I*(l*w-p*b),e[9]=-(t*(b*H-w*P)-_*(n*H-a*P)+I*(n*w-a*b)),e[10]=t*(l*H-p*P)-s*(n*H-a*P)+I*(n*p-a*l),e[11]=-(t*(l*w-p*b)-s*(n*w-a*b)+_*(n*p-a*l)),e[12]=-(s*(b*B-A*P)-_*(l*B-c*P)+I*(l*A-c*b)),e[13]=t*(b*B-A*P)-_*(n*B-i*P)+I*(n*A-i*b),e[14]=-(t*(l*B-c*P)-s*(n*B-i*P)+I*(n*c-i*l)),e[15]=t*(l*A-c*b)-s*(n*A-i*b)+_*(n*c-i*l),e}function Ji(e){var r=e[0],t=e[1],n=e[2],i=e[3],a=e[4],s=e[5],l=e[6],c=e[7],p=e[8],_=e[9],b=e[10],A=e[11],w=e[12],I=e[13],P=e[14],B=e[15],H=r*s-t*a,Q=r*l-n*a,ue=r*c-i*a,Ee=t*l-n*s,Le=t*c-i*s,Ze=n*c-i*l,tt=p*I-_*w,ft=p*P-b*w,wt=p*B-A*w,fr=_*P-b*I,hr=_*B-A*I,Mr=b*B-A*P;return H*Mr-Q*hr+ue*fr+Ee*wt-Le*ft+Ze*tt}function xa(e,r,t){var n=r[0],i=r[1],a=r[2],s=r[3],l=r[4],c=r[5],p=r[6],_=r[7],b=r[8],A=r[9],w=r[10],I=r[11],P=r[12],B=r[13],H=r[14],Q=r[15],ue=t[0],Ee=t[1],Le=t[2],Ze=t[3];return e[0]=ue*n+Ee*l+Le*b+Ze*P,e[1]=ue*i+Ee*c+Le*A+Ze*B,e[2]=ue*a+Ee*p+Le*w+Ze*H,e[3]=ue*s+Ee*_+Le*I+Ze*Q,ue=t[4],Ee=t[5],Le=t[6],Ze=t[7],e[4]=ue*n+Ee*l+Le*b+Ze*P,e[5]=ue*i+Ee*c+Le*A+Ze*B,e[6]=ue*a+Ee*p+Le*w+Ze*H,e[7]=ue*s+Ee*_+Le*I+Ze*Q,ue=t[8],Ee=t[9],Le=t[10],Ze=t[11],e[8]=ue*n+Ee*l+Le*b+Ze*P,e[9]=ue*i+Ee*c+Le*A+Ze*B,e[10]=ue*a+Ee*p+Le*w+Ze*H,e[11]=ue*s+Ee*_+Le*I+Ze*Q,ue=t[12],Ee=t[13],Le=t[14],Ze=t[15],e[12]=ue*n+Ee*l+Le*b+Ze*P,e[13]=ue*i+Ee*c+Le*A+Ze*B,e[14]=ue*a+Ee*p+Le*w+Ze*H,e[15]=ue*s+Ee*_+Le*I+Ze*Q,e}function eu(e,r,t){var n=t[0],i=t[1],a=t[2],s,l,c,p,_,b,A,w,I,P,B,H;return r===e?(e[12]=r[0]*n+r[4]*i+r[8]*a+r[12],e[13]=r[1]*n+r[5]*i+r[9]*a+r[13],e[14]=r[2]*n+r[6]*i+r[10]*a+r[14],e[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(s=r[0],l=r[1],c=r[2],p=r[3],_=r[4],b=r[5],A=r[6],w=r[7],I=r[8],P=r[9],B=r[10],H=r[11],e[0]=s,e[1]=l,e[2]=c,e[3]=p,e[4]=_,e[5]=b,e[6]=A,e[7]=w,e[8]=I,e[9]=P,e[10]=B,e[11]=H,e[12]=s*n+_*i+I*a+r[12],e[13]=l*n+b*i+P*a+r[13],e[14]=c*n+A*i+B*a+r[14],e[15]=p*n+w*i+H*a+r[15]),e}function of(e,r,t){var n=t[0],i=t[1],a=t[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=r[7]*i,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=r[11]*a,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function $u(e,r,t,n){var i=n[0],a=n[1],s=n[2],l=Math.hypot(i,a,s),c,p,_,b,A,w,I,P,B,H,Q,ue,Ee,Le,Ze,tt,ft,wt,fr,hr,Mr,ln,Rn,wi;return l<Ot.Ib?null:(l=1/l,i*=l,a*=l,s*=l,c=Math.sin(t),p=Math.cos(t),_=1-p,b=r[0],A=r[1],w=r[2],I=r[3],P=r[4],B=r[5],H=r[6],Q=r[7],ue=r[8],Ee=r[9],Le=r[10],Ze=r[11],tt=i*i*_+p,ft=a*i*_+s*c,wt=s*i*_-a*c,fr=i*a*_-s*c,hr=a*a*_+p,Mr=s*a*_+i*c,ln=i*s*_+a*c,Rn=a*s*_-i*c,wi=s*s*_+p,e[0]=b*tt+P*ft+ue*wt,e[1]=A*tt+B*ft+Ee*wt,e[2]=w*tt+H*ft+Le*wt,e[3]=I*tt+Q*ft+Ze*wt,e[4]=b*fr+P*hr+ue*Mr,e[5]=A*fr+B*hr+Ee*Mr,e[6]=w*fr+H*hr+Le*Mr,e[7]=I*fr+Q*hr+Ze*Mr,e[8]=b*ln+P*Rn+ue*wi,e[9]=A*ln+B*Rn+Ee*wi,e[10]=w*ln+H*Rn+Le*wi,e[11]=I*ln+Q*Rn+Ze*wi,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)}function Ah(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[4],s=r[5],l=r[6],c=r[7],p=r[8],_=r[9],b=r[10],A=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=a*i+p*n,e[5]=s*i+_*n,e[6]=l*i+b*n,e[7]=c*i+A*n,e[8]=p*i-a*n,e[9]=_*i-s*n,e[10]=b*i-l*n,e[11]=A*i-c*n,e}function gl(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],s=r[1],l=r[2],c=r[3],p=r[8],_=r[9],b=r[10],A=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i-p*n,e[1]=s*i-_*n,e[2]=l*i-b*n,e[3]=c*i-A*n,e[8]=a*n+p*i,e[9]=s*n+_*i,e[10]=l*n+b*i,e[11]=c*n+A*i,e}function Th(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],s=r[1],l=r[2],c=r[3],p=r[4],_=r[5],b=r[6],A=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i+p*n,e[1]=s*i+_*n,e[2]=l*i+b*n,e[3]=c*i+A*n,e[4]=p*i-a*n,e[5]=_*i-s*n,e[6]=b*i-l*n,e[7]=A*i-c*n,e}function Gv(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function f0(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function h0(e,r,t){var n=t[0],i=t[1],a=t[2],s=Math.hypot(n,i,a),l,c,p;return s<Ot.Ib?null:(s=1/s,n*=s,i*=s,a*=s,l=Math.sin(r),c=Math.cos(r),p=1-c,e[0]=n*n*p+c,e[1]=i*n*p+a*l,e[2]=a*n*p-i*l,e[3]=0,e[4]=n*i*p-a*l,e[5]=i*i*p+c,e[6]=a*i*p+n*l,e[7]=0,e[8]=n*a*p+i*l,e[9]=i*a*p-n*l,e[10]=a*a*p+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Hd(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wh(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xv(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ch(e,r,t){var n=r[0],i=r[1],a=r[2],s=r[3],l=n+n,c=i+i,p=a+a,_=n*l,b=n*c,A=n*p,w=i*c,I=i*p,P=a*p,B=s*l,H=s*c,Q=s*p;return e[0]=1-(w+P),e[1]=b+Q,e[2]=A-H,e[3]=0,e[4]=b-Q,e[5]=1-(_+P),e[6]=I+B,e[7]=0,e[8]=A+H,e[9]=I-B,e[10]=1-(_+w),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function p0(e,r){var t=new Ot.WT(3),n=-r[0],i=-r[1],a=-r[2],s=r[3],l=r[4],c=r[5],p=r[6],_=r[7],b=n*n+i*i+a*a+s*s;return b>0?(t[0]=(l*s+_*n+c*a-p*i)*2/b,t[1]=(c*s+_*i+p*n-l*a)*2/b,t[2]=(p*s+_*a+l*i-c*n)*2/b):(t[0]=(l*s+_*n+c*a-p*i)*2,t[1]=(c*s+_*i+p*n-l*a)*2,t[2]=(p*s+_*a+l*i-c*n)*2),Ch(e,r,t),e}function Fo(e,r){return e[0]=r[12],e[1]=r[13],e[2]=r[14],e}function Ia(e,r){var t=r[0],n=r[1],i=r[2],a=r[4],s=r[5],l=r[6],c=r[8],p=r[9],_=r[10];return e[0]=Math.hypot(t,n,i),e[1]=Math.hypot(a,s,l),e[2]=Math.hypot(c,p,_),e}function d0(e,r){var t=new Ot.WT(3);Ia(t,r);var n=1/t[0],i=1/t[1],a=1/t[2],s=r[0]*n,l=r[1]*i,c=r[2]*a,p=r[4]*n,_=r[5]*i,b=r[6]*a,A=r[8]*n,w=r[9]*i,I=r[10]*a,P=s+_+I,B=0;return P>0?(B=Math.sqrt(P+1)*2,e[3]=.25*B,e[0]=(b-w)/B,e[1]=(A-c)/B,e[2]=(l-p)/B):s>_&&s>I?(B=Math.sqrt(1+s-_-I)*2,e[3]=(b-w)/B,e[0]=.25*B,e[1]=(l+p)/B,e[2]=(A+c)/B):_>I?(B=Math.sqrt(1+_-s-I)*2,e[3]=(A-c)/B,e[0]=(l+p)/B,e[1]=.25*B,e[2]=(b+w)/B):(B=Math.sqrt(1+I-s-_)*2,e[3]=(l-p)/B,e[0]=(A+c)/B,e[1]=(b+w)/B,e[2]=.25*B),e}function v0(e,r,t,n){var i=r[0],a=r[1],s=r[2],l=r[3],c=i+i,p=a+a,_=s+s,b=i*c,A=i*p,w=i*_,I=a*p,P=a*_,B=s*_,H=l*c,Q=l*p,ue=l*_,Ee=n[0],Le=n[1],Ze=n[2];return e[0]=(1-(I+B))*Ee,e[1]=(A+ue)*Ee,e[2]=(w-Q)*Ee,e[3]=0,e[4]=(A-ue)*Le,e[5]=(1-(b+B))*Le,e[6]=(P+H)*Le,e[7]=0,e[8]=(w+Q)*Ze,e[9]=(P-H)*Ze,e[10]=(1-(b+I))*Ze,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function m0(e,r,t,n,i){var a=r[0],s=r[1],l=r[2],c=r[3],p=a+a,_=s+s,b=l+l,A=a*p,w=a*_,I=a*b,P=s*_,B=s*b,H=l*b,Q=c*p,ue=c*_,Ee=c*b,Le=n[0],Ze=n[1],tt=n[2],ft=i[0],wt=i[1],fr=i[2],hr=(1-(P+H))*Le,Mr=(w+Ee)*Le,ln=(I-ue)*Le,Rn=(w-Ee)*Ze,wi=(1-(A+H))*Ze,ba=(B+Q)*Ze,Va=(I+ue)*tt,io=(B-Q)*tt,as=(1-(A+P))*tt;return e[0]=hr,e[1]=Mr,e[2]=ln,e[3]=0,e[4]=Rn,e[5]=wi,e[6]=ba,e[7]=0,e[8]=Va,e[9]=io,e[10]=as,e[11]=0,e[12]=t[0]+ft-(hr*ft+Rn*wt+Va*fr),e[13]=t[1]+wt-(Mr*ft+wi*wt+io*fr),e[14]=t[2]+fr-(ln*ft+ba*wt+as*fr),e[15]=1,e}function g0(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],s=t+t,l=n+n,c=i+i,p=t*s,_=n*s,b=n*l,A=i*s,w=i*l,I=i*c,P=a*s,B=a*l,H=a*c;return e[0]=1-b-I,e[1]=_+H,e[2]=A-B,e[3]=0,e[4]=_-H,e[5]=1-p-I,e[6]=w+P,e[7]=0,e[8]=A+B,e[9]=w-P,e[10]=1-p-b,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _0(e,r,t,n,i,a,s){var l=1/(t-r),c=1/(i-n),p=1/(a-s);return e[0]=a*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*c,e[6]=0,e[7]=0,e[8]=(t+r)*l,e[9]=(i+n)*c,e[10]=(s+a)*p,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*p,e[15]=0,e}function Wd(e,r,t,n,i){var a=1/Math.tan(r/2),s;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(s=1/(n-i),e[10]=(i+n)*s,e[14]=2*i*n*s):(e[10]=-1,e[14]=-2*n),e}var Wf=Wd;function Rh(e,r,t,n,i){var a=1/Math.tan(r/2),s;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(s=1/(n-i),e[10]=i*s,e[14]=i*n*s):(e[10]=-1,e[14]=-n),e}function y0(e,r,t,n){var i=Math.tan(r.upDegrees*Math.PI/180),a=Math.tan(r.downDegrees*Math.PI/180),s=Math.tan(r.leftDegrees*Math.PI/180),l=Math.tan(r.rightDegrees*Math.PI/180),c=2/(s+l),p=2/(i+a);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=-((s-l)*c*.5),e[9]=(i-a)*p*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function ko(e,r,t,n,i,a,s){var l=1/(r-t),c=1/(n-i),p=1/(a-s);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*p,e[11]=0,e[12]=(r+t)*l,e[13]=(i+n)*c,e[14]=(s+a)*p,e[15]=1,e}var Qp=ko;function sf(e,r,t,n,i,a,s){var l=1/(r-t),c=1/(n-i),p=1/(a-s);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=p,e[11]=0,e[12]=(r+t)*l,e[13]=(i+n)*c,e[14]=a*p,e[15]=1,e}function Gd(e,r,t,n){var i,a,s,l,c,p,_,b,A,w,I=r[0],P=r[1],B=r[2],H=n[0],Q=n[1],ue=n[2],Ee=t[0],Le=t[1],Ze=t[2];return Math.abs(I-Ee)<Ot.Ib&&Math.abs(P-Le)<Ot.Ib&&Math.abs(B-Ze)<Ot.Ib?Sn(e):(_=I-Ee,b=P-Le,A=B-Ze,w=1/Math.hypot(_,b,A),_*=w,b*=w,A*=w,i=Q*A-ue*b,a=ue*_-H*A,s=H*b-Q*_,w=Math.hypot(i,a,s),w?(w=1/w,i*=w,a*=w,s*=w):(i=0,a=0,s=0),l=b*s-A*a,c=A*i-_*s,p=_*a-b*i,w=Math.hypot(l,c,p),w?(w=1/w,l*=w,c*=w,p*=w):(l=0,c=0,p=0),e[0]=i,e[1]=l,e[2]=_,e[3]=0,e[4]=a,e[5]=c,e[6]=b,e[7]=0,e[8]=s,e[9]=p,e[10]=A,e[11]=0,e[12]=-(i*I+a*P+s*B),e[13]=-(l*I+c*P+p*B),e[14]=-(_*I+b*P+A*B),e[15]=1,e)}function Xd(e,r,t,n){var i=r[0],a=r[1],s=r[2],l=n[0],c=n[1],p=n[2],_=i-t[0],b=a-t[1],A=s-t[2],w=_*_+b*b+A*A;w>0&&(w=1/Math.sqrt(w),_*=w,b*=w,A*=w);var I=c*A-p*b,P=p*_-l*A,B=l*b-c*_;return w=I*I+P*P+B*B,w>0&&(w=1/Math.sqrt(w),I*=w,P*=w,B*=w),e[0]=I,e[1]=P,e[2]=B,e[3]=0,e[4]=b*B-A*P,e[5]=A*I-_*B,e[6]=_*P-b*I,e[7]=0,e[8]=_,e[9]=b,e[10]=A,e[11]=0,e[12]=i,e[13]=a,e[14]=s,e[15]=1,e}function $v(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function lp(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function uf(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e[4]=r[4]+t[4],e[5]=r[5]+t[5],e[6]=r[6]+t[6],e[7]=r[7]+t[7],e[8]=r[8]+t[8],e[9]=r[9]+t[9],e[10]=r[10]+t[10],e[11]=r[11]+t[11],e[12]=r[12]+t[12],e[13]=r[13]+t[13],e[14]=r[14]+t[14],e[15]=r[15]+t[15],e}function Yv(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e[4]=r[4]-t[4],e[5]=r[5]-t[5],e[6]=r[6]-t[6],e[7]=r[7]-t[7],e[8]=r[8]-t[8],e[9]=r[9]-t[9],e[10]=r[10]-t[10],e[11]=r[11]-t[11],e[12]=r[12]-t[12],e[13]=r[13]-t[13],e[14]=r[14]-t[14],e[15]=r[15]-t[15],e}function x0(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*t,e[5]=r[5]*t,e[6]=r[6]*t,e[7]=r[7]*t,e[8]=r[8]*t,e[9]=r[9]*t,e[10]=r[10]*t,e[11]=r[11]*t,e[12]=r[12]*t,e[13]=r[13]*t,e[14]=r[14]*t,e[15]=r[15]*t,e}function Bg(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e[4]=r[4]+t[4]*n,e[5]=r[5]+t[5]*n,e[6]=r[6]+t[6]*n,e[7]=r[7]+t[7]*n,e[8]=r[8]+t[8]*n,e[9]=r[9]+t[9]*n,e[10]=r[10]+t[10]*n,e[11]=r[11]+t[11]*n,e[12]=r[12]+t[12]*n,e[13]=r[13]+t[13]*n,e[14]=r[14]+t[14]*n,e[15]=r[15]+t[15]*n,e}function ts(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}function Bc(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],s=e[4],l=e[5],c=e[6],p=e[7],_=e[8],b=e[9],A=e[10],w=e[11],I=e[12],P=e[13],B=e[14],H=e[15],Q=r[0],ue=r[1],Ee=r[2],Le=r[3],Ze=r[4],tt=r[5],ft=r[6],wt=r[7],fr=r[8],hr=r[9],Mr=r[10],ln=r[11],Rn=r[12],wi=r[13],ba=r[14],Va=r[15];return Math.abs(t-Q)<=Ot.Ib*Math.max(1,Math.abs(t),Math.abs(Q))&&Math.abs(n-ue)<=Ot.Ib*Math.max(1,Math.abs(n),Math.abs(ue))&&Math.abs(i-Ee)<=Ot.Ib*Math.max(1,Math.abs(i),Math.abs(Ee))&&Math.abs(a-Le)<=Ot.Ib*Math.max(1,Math.abs(a),Math.abs(Le))&&Math.abs(s-Ze)<=Ot.Ib*Math.max(1,Math.abs(s),Math.abs(Ze))&&Math.abs(l-tt)<=Ot.Ib*Math.max(1,Math.abs(l),Math.abs(tt))&&Math.abs(c-ft)<=Ot.Ib*Math.max(1,Math.abs(c),Math.abs(ft))&&Math.abs(p-wt)<=Ot.Ib*Math.max(1,Math.abs(p),Math.abs(wt))&&Math.abs(_-fr)<=Ot.Ib*Math.max(1,Math.abs(_),Math.abs(fr))&&Math.abs(b-hr)<=Ot.Ib*Math.max(1,Math.abs(b),Math.abs(hr))&&Math.abs(A-Mr)<=Ot.Ib*Math.max(1,Math.abs(A),Math.abs(Mr))&&Math.abs(w-ln)<=Ot.Ib*Math.max(1,Math.abs(w),Math.abs(ln))&&Math.abs(I-Rn)<=Ot.Ib*Math.max(1,Math.abs(I),Math.abs(Rn))&&Math.abs(P-wi)<=Ot.Ib*Math.max(1,Math.abs(P),Math.abs(wi))&&Math.abs(B-ba)<=Ot.Ib*Math.max(1,Math.abs(B),Math.abs(ba))&&Math.abs(H-Va)<=Ot.Ib*Math.max(1,Math.abs(H),Math.abs(Va))}var b0=xa,o=Yv,u,f,m=(u=(0,Jt.b2)(),u(f=function(){function e(){(0,ge.Z)(this,e),(0,N.Z)(this,"viewport",void 0),(0,N.Z)(this,"overridedViewProjectionMatrix",void 0),(0,N.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,N.Z)(this,"jitteredProjectionMatrix",void 0),(0,N.Z)(this,"viewMatrixInverse",void 0),(0,N.Z)(this,"cameraPosition",void 0)}return(0,K.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=or(),Wn(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=(0,re.Z)(t,2),i=n[0],a=n[1];return[i,a]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var i=Gv(or(),[t,n,0]);this.jitteredProjectionMatrix=xa(or(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=xa(or(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||f),x=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),E,T;function M(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=L(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function L(e,r){if(!!e){if(typeof e=="string")return j(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return j(e,r)}}function j(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var $={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},q=(E=(0,Jt.b2)(),E(T=function(){function e(){(0,ge.Z)(this,e),(0,N.Z)(this,"container",void 0),(0,N.Z)(this,"controlCorners",void 0),(0,N.Z)(this,"controlContainer",void 0),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"controls",[]),(0,N.Z)(this,"unAddControls",[])}return(0,K.Z)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(Ye.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var i=n.get(Ye.IMapService);i.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=M(this.controls),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.remove()}}catch(a){t.e(a)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",i=this.controlContainer=In("div",n+"control-container",this.container);function a(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],c=l.map(function(p){return n+p}).join(" ");t[l.filter(function(p){return!["row","column"].includes(p)}).join("")]=In("div",c,i)}function s(l){var c=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,Gt.Z)(c),[$[l]])}Object.values(x).forEach(function(l){a(s(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&Ys(this.controlCorners[t]);this.controlContainer&&Ys(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var t=this,n=window.MutationObserver;if(!!n)for(var i=function(){var c=s[a],p=c.match(/^(top|bottom)(left|right)$/);if(p){var _=(0,re.Z)(p,3),b=_[1],A=_[2],w=t.controlCorners["".concat(b).concat(A)],I=new n(function(P){var B=(0,re.Z)(P,1),H=B[0].target;w&&(w.style[b]=H.clientHeight+"px")});I.observe(t.controlCorners["".concat(A).concat(b)],{childList:!0,attributes:!0})}},a=0,s=Object.keys(this.controlCorners);a<s.length;a++)i()}}]),e}())||T),le,me,ze=(le=(0,Jt.b2)(),le(me=function(){function e(){(0,ge.Z)(this,e),(0,N.Z)(this,"container",void 0),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"markers",[]),(0,N.Z)(this,"markerLayers",[]),(0,N.Z)(this,"unAddMarkers",[]),(0,N.Z)(this,"unAddMarkerLayers",[])}return(0,K.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Ye.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||me),He,st,et=(He=(0,Jt.b2)(),He(st=function(){function e(){(0,ge.Z)(this,e),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"popups",[]),(0,N.Z)(this,"unAddPopups",[])}return(0,K.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){t!=null&&t.isOpen()&&t.remove();var n=this.popups.indexOf(t);n>-1&&this.popups.splice(n,1);var i=this.unAddPopups.indexOf(t);i>-1&&this.unAddPopups.splice(i,1)}},{key:"destroy",value:function(){this.popups.forEach(function(t){return t.remove()})}},{key:"addPopup",value:function(t){var n=this;t&&t.getOptions().autoClose&&[].concat((0,Gt.Z)(this.popups),(0,Gt.Z)(this.unAddPopups)).forEach(function(i){i.getOptions().autoClose&&n.removePopup(i)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",function(){n.removePopup(t)})}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){t.addPopup(n),t.unAddPopups=[]})}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Ye.IMapService)}}]),e}())||st),bt=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),Lt=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),qt=function(e){return e.AND="and",e.OR="or",e}({}),jt=function(e){return e.INIT="init",e.UPDATE="update",e}({}),mr={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Vr=mr,Jr,Fn,gn=vi.merge,Hn={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},_n={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:qt.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Ai=(Jr=(0,Jt.b2)(),Jr(Fn=function(){function e(){(0,ge.Z)(this,e),(0,N.Z)(this,"sceneConfigCache",{}),(0,N.Z)(this,"layerConfigCache",{}),(0,N.Z)(this,"layerAttributeConfigCache",{})}return(0,K.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return Vr[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=(0,k.Z)((0,k.Z)({},Hn),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,i){this.layerConfigCache[n]=(0,k.Z)({},gn({},this.sceneConfigCache[t],_n,i))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,n){this.layerAttributeConfigCache[t]=(0,k.Z)((0,k.Z)({},this.layerAttributeConfigCache[t]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Fn);function qr(e,r,t,n){!t||Object.defineProperty(e,r,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function Cr(e,r,t,n,i){var a={};return Object.keys(n).forEach(function(s){a[s]=n[s]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=t.slice().reverse().reduce(function(s,l){return l(e,r,s)||s},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,r,a),a=null),a}function Pi(){var e=new Ot.WT(4);return Ot.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function yi(e){var r=new glMatrix.ARRAY_TYPE(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function Gi(e,r,t,n){var i=new Ot.WT(4);return i[0]=e,i[1]=r,i[2]=t,i[3]=n,i}function Xn(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function ra(e,r,t,n,i){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e}function Ka(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e}function _o(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e}function uo(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e[3]=r[3]*t[3],e}function Qa(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e[3]=r[3]/t[3],e}function yo(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e[3]=Math.ceil(r[3]),e}function rs(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e[3]=Math.floor(r[3]),e}function ns(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e[3]=Math.min(r[3],t[3]),e}function tu(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e[3]=Math.max(r[3],t[3]),e}function ms(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e[3]=Math.round(r[3]),e}function Us(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function Do(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e}function gs(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return Math.hypot(t,n,i,a)}function Ui(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return t*t+n*n+i*i+a*a}function Aa(e){var r=e[0],t=e[1],n=e[2],i=e[3];return Math.hypot(r,t,n,i)}function da(e){var r=e[0],t=e[1],n=e[2],i=e[3];return r*r+t*t+n*n+i*i}function Yi(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=-r[3],e}function vu(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e[3]=1/r[3],e}function zs(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],s=t*t+n*n+i*i+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=t*s,e[1]=n*s,e[2]=i*s,e[3]=a*s,e}function za(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]}function No(e,r,t,n){var i=t[0]*n[1]-t[1]*n[0],a=t[0]*n[2]-t[2]*n[0],s=t[0]*n[3]-t[3]*n[0],l=t[1]*n[2]-t[2]*n[1],c=t[1]*n[3]-t[3]*n[1],p=t[2]*n[3]-t[3]*n[2],_=r[0],b=r[1],A=r[2],w=r[3];return e[0]=b*p-A*c+w*l,e[1]=-(_*p)+A*s-w*a,e[2]=_*c-b*s+w*i,e[3]=-(_*l)+b*a-A*i,e}function Zs(e,r,t,n){var i=r[0],a=r[1],s=r[2],l=r[3];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=s+n*(t[2]-s),e[3]=l+n*(t[3]-l),e}function na(e,r){r=r||1;var t,n,i,a,s,l;do t=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,s=t*t+n*n;while(s>=1);do i=glMatrix.RANDOM()*2-1,a=glMatrix.RANDOM()*2-1,l=i*i+a*a;while(l>=1);var c=Math.sqrt((1-s)/l);return e[0]=r*t,e[1]=r*n,e[2]=r*i*c,e[3]=r*a*c,e}function Fl(e,r,t){var n=r[0],i=r[1],a=r[2],s=r[3];return e[0]=t[0]*n+t[4]*i+t[8]*a+t[12]*s,e[1]=t[1]*n+t[5]*i+t[9]*a+t[13]*s,e[2]=t[2]*n+t[6]*i+t[10]*a+t[14]*s,e[3]=t[3]*n+t[7]*i+t[11]*a+t[15]*s,e}function _l(e,r,t){var n=r[0],i=r[1],a=r[2],s=t[0],l=t[1],c=t[2],p=t[3],_=p*n+l*a-c*i,b=p*i+c*n-s*a,A=p*a+s*i-l*n,w=-s*n-l*i-c*a;return e[0]=_*p+w*-s+b*-c-A*-l,e[1]=b*p+w*-l+A*-s-_*-c,e[2]=A*p+w*-c+_*-l-b*-s,e[3]=r[3],e}function lf(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Lo(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function cf(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function ac(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],s=r[0],l=r[1],c=r[2],p=r[3];return Math.abs(t-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(n-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))}var Jp=null,cp=null,ed=null,Gf=null,td=null,qv=null,rd=null,$d=function(){var e=Pi();return function(r,t,n,i,a,s){var l,c;for(t||(t=4),n||(n=0),i?c=Math.min(i*t+n,r.length):c=r.length,l=n;l<c;l+=t)e[0]=r[l],e[1]=r[l+1],e[2]=r[l+2],e[3]=r[l+3],a(e,e,s),r[l]=e[0],r[l+1]=e[1],r[l+2]=e[2],r[l+3]=e[3];return r}}(),fp=Math.PI/180,Yd=512,Fc=4003e4;function hp(e){var r=e.latitude,t=r===void 0?0:r,n=e.zoom,i=n===void 0?0:n,a=e.scale,s=e.highPrecision,l=s===void 0?!1:s,c=e.flipY,p=c===void 0?!1:c;a=a!==void 0?a:Math.pow(2,i);var _={},b=Yd*a,A=Math.cos(t*fp),w=b/360,I=w/A,P=b/Fc/A;if(_.pixelsPerMeter=[P,-P,P],_.metersPerPixel=[1/P,-1/P,1/P],_.pixelsPerDegree=[w,-I,P],_.degreesPerPixel=[1/w,-1/I,1/P],l){var B=fp*Math.tan(t*fp)/A,H=w*B/2,Q=b/Fc*B,ue=Q/I*P;_.pixelsPerDegree2=[0,-H,Q],_.pixelsPerMeter2=[ue,0,ue],p&&(_.pixelsPerDegree2[1]=-_.pixelsPerDegree2[1],_.pixelsPerMeter2[1]=-_.pixelsPerMeter2[1])}return p&&(_.pixelsPerMeter[1]=-_.pixelsPerMeter[1],_.metersPerPixel[1]=-_.metersPerPixel[1],_.pixelsPerDegree[1]=-_.pixelsPerDegree[1],_.degreesPerPixel[1]=-_.degreesPerPixel[1]),_}var oc=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),Yu={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Mh,nd,id,Ih,pp,qd=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ad=(Mh=(0,Jt.b2)(),nd=(0,Jt.f3)(Ye.ICameraService),Mh(id=(Ih=function(){function e(){(0,ge.Z)(this,e),(0,N.Z)(this,"needRefresh",!0),qr(this,"cameraService",pp,this),(0,N.Z)(this,"coordinateSystem",void 0),(0,N.Z)(this,"viewportCenter",void 0),(0,N.Z)(this,"viewportCenterProjection",void 0),(0,N.Z)(this,"pixelsPerDegree",void 0),(0,N.Z)(this,"pixelsPerDegree2",void 0),(0,N.Z)(this,"pixelsPerMeter",void 0)}return(0,K.Z)(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=t||this.cameraService.getCenter(),s=hp({latitude:a[1],zoom:n}),l=s.pixelsPerMeter,c=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=c,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===oc.LNGLAT||this.coordinateSystem===oc.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===oc.LNGLAT_OFFSET?this.calculateLnglatOffset(a,n):this.coordinateSystem===oc.P20_OFFSET&&this.calculateLnglatOffset(a,n,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,i,a){var s=hp({latitude:t[1],zoom:n,scale:i,flipY:a,highPrecision:!0}),l=s.pixelsPerMeter,c=s.pixelsPerDegree,p=s.pixelsPerDegree2,_=this.cameraService.getViewMatrix(),b=this.cameraService.getProjectionMatrix(),A=xa([],b,_),w=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=Fl([],[w[0],w[1],0,1],A),_=this.cameraService.getViewMatrixUncentered()||_,A=xa([],b,_),A=xa([],A,qd),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=l,this.pixelsPerDegree=c,this.pixelsPerDegree2=p}}]),e}(),pp=Cr(Ih.prototype,"cameraService",[nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ih))||id),dp,vp;function Kd(e){var r=mp();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function mp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qd=(dp=(0,Jt.b2)(),dp(vp=function(e){(0,Qe.Z)(t,e);var r=Kd(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"renderMap",new Map),(0,N.Z)((0,we.Z)(n),"enable",!1),(0,N.Z)((0,we.Z)(n),"renderEnable",!1),(0,N.Z)((0,we.Z)(n),"cacheLogs",{}),n}return(0,K.Z)(t,[{key:"setEnable",value:function(i){this.enable=!!i}},{key:"log",value:function(i,a){var s=this;if(!!this.enable){var l=i.split("."),c=null;l.forEach(function(p,_){c!==null?(c[p]||(c[p]={}),_!==l.length-1&&(c=c[p])):(s.cacheLogs[p]||(s.cacheLogs[p]={}),_!==l.length-1&&(c=s.cacheLogs[p])),_===l.length-1&&(c[p]=(0,k.Z)((0,k.Z)({time:Date.now()},c[p]),a))})}}},{key:"getLog",value:function(i){var a=this;switch((0,Fs.Z)(i)){case"string":return this.cacheLogs[i];case"object":return i.map(function(s){return a.cacheLogs[s]}).filter(function(s){return s!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(i){delete this.cacheLogs[i]}},{key:"generateRenderUid",value:function(){return this.renderEnable?So():""}},{key:"renderDebug",value:function(i){this.renderEnable=i}},{key:"renderStart",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i)||{};this.renderMap.set(i,(0,k.Z)((0,k.Z)({},a),{},{renderUid:i,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i);if(a){var s=a.renderStart,l=Date.now();this.emit("renderEnd",(0,k.Z)((0,k.Z)({},a),{},{renderEnd:l,renderDuration:l-s})),this.renderMap.delete(i)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),t}(Fa.EventEmitter))||vp),gp=Z(50840),ff=Z.n(gp),is=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),_p,Ph,Jd,ev,tv;function E0(e){var r=Kv();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Kv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fg={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},od=(_p=(0,Jt.b2)(),Ph=(0,Jt.f3)(Ye.IMapService),_p(Jd=(ev=function(e){(0,Qe.Z)(t,e);var r=E0(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"indragging",!1),qr((0,we.Z)(n),"mapService",tv,(0,we.Z)(n)),(0,N.Z)((0,we.Z)(n),"hammertime",void 0),(0,N.Z)((0,we.Z)(n),"lastClickTime",0),(0,N.Z)((0,we.Z)(n),"lastClickXY",[-1,-1]),(0,N.Z)((0,we.Z)(n),"clickTimer",void 0),(0,N.Z)((0,we.Z)(n),"$containter",void 0),(0,N.Z)((0,we.Z)(n),"onDrag",function(l){var c=n.interactionEvent(l);c.type=Fg[c.type],c.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(is.Drag,c)}),(0,N.Z)((0,we.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var c=n.interactionEvent(l);n.emit(is.Hover,c)}),(0,N.Z)((0,we.Z)(n),"onTouch",function(l){var c=l.touches[0];n.onHover({x:c.pageX,y:c.pageY,type:"touch"})}),(0,N.Z)((0,we.Z)(n),"onHover",function(l){var c=l.clientX,p=l.clientY,_=c,b=p,A=l.type,w=n.mapService.getMapContainer();if(w){var I=w.getBoundingClientRect(),P=I.top,B=I.left;_=_-B-w.clientLeft,b=b-P-w.clientTop}var H=n.mapService.containerToLngLat([_,b]);if(A==="click"){n.isDoubleTap(_,b,H);return}if(A==="touch"){n.isDoubleTap(_,b,H);return}A!=="click"&&A!=="dblclick"&&n.emit(is.Hover,{x:_,y:b,lngLat:H,type:A,target:l})}),n}return(0,K.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(is.Hover)}},{key:"triggerHover",value:function(i){var a=i.x,s=i.y;this.emit(is.Hover,{x:a,y:s})}},{key:"triggerSelect",value:function(i){this.emit(is.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(is.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i){var a=new(ff()).Manager(i);a.add(new(ff()).Tap({event:"dblclick",taps:2})),a.add(new(ff()).Tap({event:"click"})),a.add(new(ff()).Pan({threshold:0,pointers:0})),a.add(new(ff()).Press({})),a.on("dblclick click",this.onHammer),a.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=a}}},{key:"removeEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(i){var a=i.type,s=i.pointerType,l,c;s==="touch"?(c=Math.floor(i.pointers[0].clientY),l=Math.floor(i.pointers[0].clientX)):(c=Math.floor(i.srcEvent.y),l=Math.floor(i.srcEvent.x));var p=this.mapService.getMapContainer();if(p){var _=p.getBoundingClientRect(),b=_.top,A=_.left;l-=A,c-=b}var w=this.mapService.containerToLngLat([l,c]);return{x:l,y:c,lngLat:w,type:a,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,a,s){var l=this,c=new Date().getTime(),p="click";c-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-a)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),p="dblclick",this.emit(is.Hover,{x:i,y:a,lngLat:s,type:p})):(this.lastClickTime=c,this.lastClickXY=[i,a],this.clickTimer=setTimeout(function(){p="click",l.emit(is.Hover,{x:i,y:a,lngLat:s,type:p})},400))}}]),t}(Ds()),tv=Cr(ev.prototype,"mapService",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ev))||Jd),xo=0;function sc(e){var r=e;if(typeof e=="string"&&(r=document.getElementById(e)),r){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(xo++),t.classList.add("l7-scene"),r.appendChild(t),t}return null}function Ng(e){var r,t=!0;if((e==null||(r=e.target)===null||r===void 0?void 0:r.target)instanceof HTMLElement)for(var n,i=e==null||(n=e.target)===null||n===void 0?void 0:n.target;i;){var a,s=Array.from(i.classList);if(s.includes("l7-marker")||s.includes("l7-popup")){t=!1;break}i=(a=i)===null||a===void 0?void 0:a.parentElement}return t}var Y=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),Oh=function(e){return e[e.SAMPLED=0]="SAMPLED",e[e.RENDER_TARGET=1]="RENDER_TARGET",e}({}),Qv,sd,uc,ud,yp,ld,cd,hf,Jv,xp,em,tm,rm,S0=(Qv=(0,Jt.b2)(),sd=(0,Jt.f3)(Ye.IMapService),uc=(0,Jt.f3)(Ye.IRendererService),ud=(0,Jt.f3)(Ye.IGlobalConfigService),yp=(0,Jt.f3)(Ye.IInteractionService),ld=(0,Jt.f3)(Ye.ILayerService),Qv(cd=(hf=function(){function e(){var r=this;(0,ge.Z)(this,e),(0,N.Z)(this,"pickedColors",void 0),(0,N.Z)(this,"pickedTileLayers",[]),qr(this,"mapService",Jv,this),qr(this,"rendererService",xp,this),qr(this,"configService",em,this),qr(this,"interactionService",tm,this),qr(this,"layerService",rm,this),(0,N.Z)(this,"pickingFBO",void 0),(0,N.Z)(this,"width",0),(0,N.Z)(this,"height",0),(0,N.Z)(this,"alreadyInPicking",!1),(0,N.Z)(this,"pickBufferScale",1),(0,N.Z)(this,"pickFromPickingFBO",function(t,n){var i=n.x,a=n.y,s=n.lngLat,l=n.type,c=n.target,p=!1,_=r.rendererService,b=_.readPixels,A=_.getContainer,w=r.getContainerSize(A()),I=w.width,P=w.height;I*=oa,P*=oa;var B=t.getLayerConfig(),H=B.enableHighlight,Q=B.enableSelect,ue=i*oa,Ee=a*oa;if(ue>I-1*oa||ue<0||Ee>P-1*oa||Ee<0)return!1;var Le=b({x:Math.floor(ue/r.pickBufferScale),y:Math.floor((P-(a+1)*oa)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO});if(r.pickedColors=Le,Le[0]!==0||Le[1]!==0||Le[2]!==0){var Ze=ia(Le),tt=t.layerPickService.getFeatureById(Ze);Ze!==t.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var ft={x:i,y:a,type:l,lngLat:s,featureId:Ze,feature:tt,target:c};tt&&(p=!0,t.setCurrentPickId(Ze),r.triggerHoverOnLayer(t,ft))}else{var wt={x:i,y:a,lngLat:s,type:t.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:c,feature:null};r.triggerHoverOnLayer(t,(0,k.Z)((0,k.Z)({},wt),{},{type:"unpick"})),r.triggerHoverOnLayer(t,wt),t.setCurrentPickId(null)}if(H&&t.layerPickService.highlightPickedFeature(Le),Q&&l==="click"&&(Le==null?void 0:Le.toString())!==[0,0,0,0].toString()){var fr=ia(Le);t.getCurrentSelectedId()===null||fr!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(Le),t.setCurrentSelectedId(fr)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return p})}return(0,K.Z)(e,[{key:"init",value:function(t){var n=this.rendererService,i=n.createTexture2D,a=n.createFramebuffer,s=n.getContainer,l=this.getContainerSize(s()),c=l.width,p=l.height;c*=oa,p*=oa,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,c=Math.round(c/this.pickBufferScale),p=Math.round(p/this.pickBufferScale),this.pickingFBO=a({color:i({width:c,height:p,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,usage:Oh.RENDER_TARGET}),depth:!0,width:c,height:p}),this.interactionService.on(is.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i,a,s){var l=this,c,p,_;return xe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:c=this.rendererService,p=c.useFramebuffer,_=c.clear,this.resizePickingFBO(),p(this.pickingFBO,function(){_({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels({ispick:!0}),i.hooks.afterPickingEncode.call();var w=l.pickBox(i,a);s(w)});case 3:case"end":return A.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var i=this,a=n.map(function(fr){var hr=fr<0?0:fr;return Math.floor(hr*oa/i.pickBufferScale)}),s=(0,re.Z)(a,4),l=s[0],c=s[1],p=s[2],_=s[3],b=this.rendererService,A=b.readPixels,w=b.getContainer,I=this.getContainerSize(w()),P=I.width,B=I.height;if(P*=oa,B*=oa,l>(P-1)*oa/this.pickBufferScale||p<0||c>(B-1)*oa/this.pickBufferScale||_<0)return[];for(var H=Math.min(P/this.pickBufferScale,p)-l,Q=Math.min(B/this.pickBufferScale,_)-c,ue=A({x:l,y:Math.floor(B/this.pickBufferScale-(_+1)),width:H,height:Q,data:new Uint8Array(H*Q*4),framebuffer:this.pickingFBO}),Ee=[],Le={},Ze=0;Ze<ue.length/4;Ze=Ze+1){var tt=ue.slice(Ze*4,Ze*4+4),ft=ia(tt);if(ft!==-1&&!Le[ft]){var wt=t.layerPickService.getFeatureById(ft);Ee.push((0,k.Z)((0,k.Z)({},wt),{},{pickedFeatureIdx:ft})),Le[ft]=!0}}return Ee}},{key:"handleCursor",value:function(t,n){var i=t.getLayerConfig(),a=i.cursor,s=a===void 0?"":a,l=i.cursorEnabled;if(l){var c=this.mapService.version,p=c==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),_=p==null?void 0:p.style.getPropertyValue("cursor");n==="unmousemove"&&_!==""?p==null||p.style.setProperty("cursor",""):n==="mousemove"&&(p==null||p.style.setProperty("cursor",s))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/oa,height:t.height/oa}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i){return xe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(!this.layerService.needPick(i.type)||!this.isPickingAllLayer())){s.next=2;break}return s.abrupt("return");case 2:return this.alreadyInPicking=!0,s.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),i=n.width,a=n.height;i*=oa,a*=oa,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(a/this.pickBufferScale)}),this.width=i,this.height=a)}},{key:"pickingLayers",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i){var a=this,s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:s=this.rendererService.clear,this.resizePickingFBO(),this.rendererService.useFramebuffer(this.pickingFBO,function(){var p=a.layerService.getRenderList();p.filter(function(_){return _.needPick(i.type)}).reverse().some(function(_){s({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),_.layerPickService.pickRender(i);var b=a.pickFromPickingFBO(_,i);return a.layerService.pickedLayerId=b?+_.id:-1,b&&!_.getLayerConfig().enablePropagation})});case 3:case"end":return c.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){Ng(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}}]),e}(),Jv=Cr(hf.prototype,"mapService",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xp=Cr(hf.prototype,"rendererService",[uc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),em=Cr(hf.prototype,"configService",[ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm=Cr(hf.prototype,"interactionService",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rm=Cr(hf.prototype,"layerService",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hf))||cd),A0=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ge.Z)(this,e),(0,N.Z)(this,"autoStart",void 0),(0,N.Z)(this,"startTime",0),(0,N.Z)(this,"oldTime",0),(0,N.Z)(this,"running",!1),(0,N.Z)(this,"elapsedTime",0),this.autoStart=r}return(0,K.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),Ru,fd,nm,lc,T0,bp,Xf,kh,Dh;function pf(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ep(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Ep(e,r){if(!!e){if(typeof e=="string")return im(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return im(e,r)}}function im(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function w0(e){var r=C0();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function C0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var am=vi.throttle,om=(Ru=(0,Jt.b2)(),fd=(0,Jt.f3)(Ye.IRendererService),nm=(0,Jt.f3)(Ye.IMapService),lc=(0,Jt.f3)(Ye.IDebugService),Ru(T0=(bp=function(e){(0,Qe.Z)(t,e);var r=w0(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"pickedLayerId",-1),(0,N.Z)((0,we.Z)(n),"clock",new A0),(0,N.Z)((0,we.Z)(n),"alreadyInRendering",!1),(0,N.Z)((0,we.Z)(n),"layers",[]),(0,N.Z)((0,we.Z)(n),"layerList",[]),(0,N.Z)((0,we.Z)(n),"layerRenderID",void 0),(0,N.Z)((0,we.Z)(n),"sceneInited",!1),(0,N.Z)((0,we.Z)(n),"animateInstanceCount",0),(0,N.Z)((0,we.Z)(n),"shaderPicking",!0),(0,N.Z)((0,we.Z)(n),"enableRender",!0),qr((0,we.Z)(n),"renderService",Xf,(0,we.Z)(n)),qr((0,we.Z)(n),"mapService",kh,(0,we.Z)(n)),qr((0,we.Z)(n),"debugService",Dh,(0,we.Z)(n)),(0,N.Z)((0,we.Z)(n),"reRender",am(function(){n.renderLayers()},32)),(0,N.Z)((0,we.Z)(n),"throttleRenderLayers",am(function(){n.renderLayers()},16)),n}return(0,K.Z)(t,[{key:"needPick",value:function(i){return this.layerList.some(function(a){return a.needPick(i)})}},{key:"add",value:function(i){var a=this;this.layers.push(i),this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"addMask",value:function(i){var a=this;this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s=this;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var p=(0,Nt.Z)(xe().mark(function _(b){return xe().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(b.startInit){w.next=4;break}return w.next=3,b.init();case 3:s.updateLayerRenderList();case 4:case"end":return w.stop()}},_)}));return function(_){return p.apply(this,arguments)}}());case 2:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(i){return this.layers.find(function(a){return a.id===i})}},{key:"getLayerByName",value:function(i){return this.layers.find(function(a){return a.name===i})}},{key:"remove",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s,l){var c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:l?(c=l.layerChildren.indexOf(s),c>-1&&l.layerChildren.splice(c,1)):(p=this.layers.indexOf(s),p>-1&&this.layers.splice(p,1)),s.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return b.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"removeAllLayers",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setEnableRender",value:function(i){this.enableRender=i}},{key:"renderLayers",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b,A,w,I;return xe().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){B.next=2;break}return B.abrupt("return");case 2:this.updateLayerRenderList(),s=this.debugService.generateRenderUid(),this.debugService.renderStart(s),this.alreadyInRendering=!0,this.clear(),l=pf(this.layerList);try{for(l.s();!(c=l.n()).done;)p=c.value,p.prerender()}catch(H){l.e(H)}finally{l.f()}this.renderService.beginFrame(),_=pf(this.layerList),B.prev=11,_.s();case 13:if((b=_.n()).done){B.next=25;break}if(A=b.value,w=A.getLayerConfig(),I=w.enableMask,A.masks.filter(function(H){return H.inited}).length>0&&I&&this.renderMask(A.masks),!A.getLayerConfig().enableMultiPassRenderer){B.next=22;break}return B.next=20,A.renderMultiPass();case 20:B.next=23;break;case 22:A.render();case 23:B.next=13;break;case 25:B.next=30;break;case 27:B.prev=27,B.t0=B.catch(11),_.e(B.t0);case 30:return B.prev=30,_.f(),B.finish(30);case 33:this.renderService.endFrame(),this.debugService.renderEnd(s),this.alreadyInRendering=!1;case 36:case"end":return B.stop()}},a,this,[[11,27,30,33]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMask",value:function(i){var a=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var s=i.length>1?Lt.MULTIPLE:Lt.SINGLE,l=pf(i),c;try{for(l.s();!(c=l.n()).done;){var p=c.value;p.render({isStencil:!0,stencilType:s,stencilIndex:a++})}}catch(_){l.e(_)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s){var l;return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,s.hooks.beforeRenderData.promise();case 2:l=p.sent,l&&this.renderLayers();case 4:case"end":return p.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderTileLayerMask",value:function(i){var a=0,s=i.getLayerConfig(),l=s.enableMask,c=l===void 0?!0:l,p=i.tileMask?1:0,_=i.masks.filter(function(P){return P.inited});p=p+(c?_.length:1);var b=p>1?Lt.MULTIPLE:Lt.SINGLE;if((i.tileMask||_.length&&c)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),_.length&&c){var A=pf(_),w;try{for(A.s();!(w=A.n()).done;){var I=w.value;I.render({isStencil:!0,stencilType:b,stencilIndex:a++})}}catch(P){A.e(P)}finally{A.f()}}i.tileMask&&i.tileMask.render({isStencil:!0,stencilType:b,stencilIndex:a++,stencilOperation:qt.OR})}},{key:"renderTileLayer",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s){return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.renderTileLayerMask(s),!s.getLayerConfig().enableMultiPassRenderer){c.next=6;break}return c.next=4,s.renderMultiPass();case 4:c.next=8;break;case 6:return c.next=8,s.render();case 8:case"end":return c.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateLayerRenderList",value:function(){var i=this;this.layerList=[],this.layers.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){i.layerList.push(a)})}},{key:"destroy",value:function(){this.layers.forEach(function(i){i.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var i=li(this.mapService.bgColor);this.renderService.clear({color:i,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),t}(Fa.EventEmitter),Xf=Cr(bp.prototype,"renderService",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kh=Cr(bp.prototype,"mapService",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=Cr(bp.prototype,"debugService",[lc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bp))||T0),yl=Z(81253),df=vi.isNil,R0=function(){function e(r){var t=this;(0,ge.Z)(this,e),(0,N.Z)(this,"name",void 0),(0,N.Z)(this,"type",void 0),(0,N.Z)(this,"scale",void 0),(0,N.Z)(this,"descriptor",void 0),(0,N.Z)(this,"featureBufferLayout",[]),(0,N.Z)(this,"needRescale",!1),(0,N.Z)(this,"needRemapping",!1),(0,N.Z)(this,"needRegenerateVertices",!1),(0,N.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,N.Z)(this,"vertexAttribute",void 0),(0,N.Z)(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=t.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(a,s){var l,c=(l=t.scale)===null||l===void 0?void 0:l.scalers[s].func,p=c(a);return p})}),this.setProps(r)}return(0,K.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,a=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,(0,Gt.Z)(t));if(!df(a))return[a]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),sm=["buffer","update","name"],um=["buffer","update","name"],Sp,rv,lm,cm,hd,fm,pd=(Sp={},(0,N.Z)(Sp,Y.FLOAT,4),(0,N.Z)(Sp,Y.UNSIGNED_BYTE,1),(0,N.Z)(Sp,Y.UNSIGNED_SHORT,2),Sp),M0=(rv=(0,Jt.b2)(),lm=(0,Jt.f3)(Ye.IRendererService),rv(cm=(hd=function(){function e(){(0,ge.Z)(this,e),(0,N.Z)(this,"attributesAndIndices",void 0),qr(this,"rendererService",fm,this),(0,N.Z)(this,"attributes",[]),(0,N.Z)(this,"triangulation",void 0),(0,N.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,K.Z)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new R0(t),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(t){var n=this.attributes.findIndex(function(i){return i.name===t});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach(function(n){var i,a=n.name,s=(i=n.scale)===null||i===void 0?void 0:i.field;(t[a]||s&&t[s])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(t,n,i){var a=this.getLayerStyleAttribute(t);a||(a=this.registerStyleAttribute((0,k.Z)((0,k.Z)({},n),{},{name:t})));var s=n.scale;s&&a&&(a.scale=s,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,i=this.getLayerStyleAttribute(t),a=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return a&&a[0]?a[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(Le){return Le.name===t});if(l&&l.descriptor){var c=l.descriptor,p=c.update,_=c.buffer,b=c.size,A=b===void 0?0:b,w=pd[_.type||Y.FLOAT];if(p){var I=this.featureLayout,P=I.elements,B=I.sizePerElement,H=P.slice(i,a);if(!H.length)return;var Q=H[0].offset,ue=Q*A*w,Ee=H.map(function(Le,Ze){for(var tt=Le.featureIdx,ft=Le.vertices,wt=Le.normals,fr=ft.length/B,hr=[],Mr=0;Mr<fr;Mr++){var ln=wt?wt.slice(Mr*3,Mr*3+3):[];hr.push.apply(hr,(0,Gt.Z)(p(n[tt],tt,ft.slice(Mr*B,Mr*B+B),Ze,ln)))}return hr}).flat();l.vertexAttribute.updateBuffer({data:Ee,offset:ue}),s==null||s.emit("legend:".concat(t),{type:t,attr:l})}}}},{key:"createAttributesAndIndices",value:function(t,n,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(H){return H.resetDescriptor(),H.descriptor}),l=0,c=0,p=[],_=3;t.forEach(function(H,Q){var ue=a.triangulation(H,i),Ee=ue.indices,Le=ue.vertices,Ze=ue.normals,tt=ue.size,ft=ue.indexes,wt=ue.count;typeof wt=="number"&&(c+=wt),Ee.forEach(function(ln){p.push(ln+l)}),_=tt;var fr=Le.length/tt;a.featureLayout.sizePerElement=_,a.featureLayout.elements.push({featureIdx:Q,vertices:Le,normals:Ze,offset:l}),l+=fr;for(var hr=function(Rn){var wi=(Ze==null?void 0:Ze.slice(Rn*3,Rn*3+3))||[],ba=Le.slice(Rn*tt,Rn*tt+tt),Va=0;ft&&ft[Rn]!==void 0&&(Va=ft[Rn]),s.forEach(function(io,as){if(io&&io.update){var Sl;(Sl=io.buffer.data).push.apply(Sl,(0,Gt.Z)(io.update(H,Q,ba,Rn,wi,Va)))}})},Mr=0;Mr<fr;Mr++)hr(Mr)});var b=this.rendererService,A=b.createAttribute,w=b.createBuffer,I=b.createElements,P={};s.forEach(function(H,Q){if(H){var ue=H.buffer,Ee=H.update,Le=H.name,Ze=(0,yl.Z)(H,sm),tt=A((0,k.Z)({buffer:w(ue)},Ze));P[H.name||""]=tt,a.attributes[Q].vertexAttribute=tt}});var B=I({data:p,type:Y.UNSIGNED_INT,count:p.length});return this.attributesAndIndices={attributes:P,elements:B,count:c},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var a=this.attributes.map(function(w){return w.resetDescriptor(),w.descriptor}),s=0,l=[],c=3;t.forEach(function(w,I){var P=i.triangulation(w),B=P.indices,H=P.vertices,Q=P.normals,ue=P.size,Ee=P.indexes;B.forEach(function(ft){l.push(ft+s)}),c=ue;var Le=H.length/ue;i.featureLayout.sizePerElement=c,i.featureLayout.elements.push({featureIdx:I,vertices:H,normals:Q,offset:s}),s+=Le;for(var Ze=function(wt){var fr=(Q==null?void 0:Q.slice(wt*3,wt*3+3))||[],hr=H.slice(wt*ue,wt*ue+ue),Mr=0;Ee&&Ee[wt]!==void 0&&(Mr=Ee[wt]),a.forEach(function(ln,Rn){if(ln&&ln.update){var wi;(wi=ln.buffer.data).push.apply(wi,(0,Gt.Z)(ln.update(w,I,hr,wt,fr,Mr)))}})},tt=0;tt<Le;tt++)Ze(tt)});var p=this.rendererService,_=p.createAttribute,b=p.createBuffer,A={};return a.forEach(function(w,I){if(w){var P=w.buffer,B=w.update,H=w.name,Q=(0,yl.Z)(w,um),ue=_((0,k.Z)({buffer:b(P)},Q));A[w.name||""]=ue,i.attributes[I].vertexAttribute=ue}}),{attributes:A}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}]),e}(),fm=Cr(hd.prototype,"rendererService",[lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hd))||cm),Ap=Z(34155);function hm(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{p(n.next(_))}catch(b){s(b)}}function c(_){try{p(n.throw(_))}catch(b){s(b)}}function p(_){_.done?a(_.value):i(_.value).then(l,c)}p((n=n.apply(e,r||[])).next())})}function nv(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(p){return function(_){return c([p,_])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(_){p=[6,_],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function iv(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),i,a=[],s;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return a}function av(e,r,t){if(t||arguments.length===2)for(var n=0,i=r.length,a;n<i;n++)(a||!(n in r))&&(a||(a=Array.prototype.slice.call(r,0,n)),a[n]=r[n]);return e.concat(a||Array.prototype.slice.call(r))}function pm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var dm={exports:{}},ov={exports:{}},dd={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=r.default})(dd,dd.exports);var qu={},vm={exports:{}},Nl={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=n.pop();return t.call(this,n,a)}},e.exports=r.default})(Nl,Nl.exports);var cc={};Object.defineProperty(cc,"__esModule",{value:!0}),cc.fallback=ry,cc.wrap=ny;var I0=cc.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,vd=cc.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,P0=cc.hasNextTick=typeof Ap=="object"&&typeof Ap.nextTick=="function";function ry(e){setTimeout(e,0)}function ny(e){return function(r){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return e(function(){return r.apply(void 0,t)})}}var mm;I0?mm=queueMicrotask:vd?mm=setImmediate:P0?mm=Ap.nextTick:mm=ry,cc.default=ny(mm),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=c;var t=Nl.exports,n=l(t),i=cc,a=l(i),s=qu;function l(b){return b&&b.__esModule?b:{default:b}}function c(b){return(0,s.isAsync)(b)?function(){for(var A=[],w=arguments.length;w--;)A[w]=arguments[w];var I=A.pop(),P=b.apply(this,A);return p(P,I)}:(0,n.default)(function(A,w){var I;try{I=b.apply(this,A)}catch(P){return w(P)}if(I&&typeof I.then=="function")return p(I,w);w(null,I)})}function p(b,A){return b.then(function(w){_(A,null,w)},function(w){_(A,w&&w.message?w:new Error(w))})}function _(b,A,w){try{b(A,w)}catch(I){(0,a.default)(function(P){throw P},I)}}e.exports=r.default}(vm,vm.exports),Object.defineProperty(qu,"__esModule",{value:!0}),qu.isAsyncIterable=qu.isAsyncGenerator=qu.isAsync=void 0;var sA=vm.exports,uA=lA(sA);function lA(e){return e&&e.__esModule?e:{default:e}}function iy(e){return e[Symbol.toStringTag]==="AsyncFunction"}function cA(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function fA(e){return typeof e[Symbol.asyncIterator]=="function"}function hA(e){if(typeof e!="function")throw new Error("expected a function");return iy(e)?(0,uA.default)(e):e}qu.default=hA,qu.isAsync=iy,qu.isAsyncGenerator=cA,qu.isAsyncIterable=fA;var md={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function a(){for(var s=this,l=[],c=arguments.length;c--;)l[c]=arguments[c];return typeof l[i-1]=="function"?n.apply(this,l):new Promise(function(p,_){l[i-1]=function(b){for(var A=[],w=arguments.length-1;w-- >0;)A[w]=arguments[w+1];if(b)return _(b);p(A.length>1?A:A[0])},n.apply(s,l)})}return a}e.exports=r.default})(md,md.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=dd.exports,n=c(t),i=qu,a=c(i),s=md.exports,l=c(s);function c(p){return p&&p.__esModule?p:{default:p}}r.default=(0,l.default)(function(p,_,b){var A=(0,n.default)(_)?[]:{};p(_,function(w,I,P){(0,a.default)(w)(function(B){for(var H,Q=[],ue=arguments.length-1;ue-- >0;)Q[ue]=arguments[ue+1];Q.length<2&&(H=Q,Q=H[0]),A[I]=Q,P(B)})},function(w){return b(w,A)})},3),e.exports=r.default}(ov,ov.exports);var Ug={exports:{}},O0={exports:{}},zg={exports:{}},gm={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){function i(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n!==null){var l=n;n=null,l.apply(this,a)}}return Object.assign(i,n),i}e.exports=r.default})(gm,gm.exports);var Zg={exports:{}},Vg={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=r.default})(Vg,Vg.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=_;var t=dd.exports,n=s(t),i=Vg.exports,a=s(i);function s(b){return b&&b.__esModule?b:{default:b}}function l(b){var A=-1,w=b.length;return function(){return++A<w?{value:b[A],key:A}:null}}function c(b){var A=-1;return function(){var I=b.next();return I.done?null:(A++,{value:I.value,key:A})}}function p(b){var A=b?Object.keys(b):[],w=-1,I=A.length;return function P(){var B=A[++w];return B==="__proto__"?P():w<I?{value:b[B],key:B}:null}}function _(b){if((0,n.default)(b))return l(b);var A=(0,a.default)(b);return A?c(A):p(b)}e.exports=r.default}(Zg,Zg.exports);var _m={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];if(n===null)throw new Error("Callback was already called.");var s=n;n=null,s.apply(this,i)}}e.exports=r.default})(_m,_m.exports);var jg={exports:{}},ym={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t={};r.default=t,e.exports=r.default})(ym,ym.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=a;var t=ym.exports,n=i(t);function i(s){return s&&s.__esModule?s:{default:s}}function a(s,l,c,p){var _=!1,b=!1,A=!1,w=0,I=0;function P(){w>=l||A||_||(A=!0,s.next().then(function(Q){var ue=Q.value,Ee=Q.done;if(!(b||_)){if(A=!1,Ee){_=!0,w<=0&&p(null);return}w++,c(ue,I,B),I++,P()}}).catch(H))}function B(Q,ue){if(w-=1,!b){if(Q)return H(Q);if(Q===!1){_=!0,b=!0;return}if(ue===n.default||_&&w<=0)return _=!0,p(null);P()}}function H(Q){b||(A=!1,_=!0,p(Q))}P()}e.exports=r.default}(jg,jg.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=gm.exports,n=w(t),i=Zg.exports,a=w(i),s=_m.exports,l=w(s),c=qu,p=jg.exports,_=w(p),b=ym.exports,A=w(b);function w(I){return I&&I.__esModule?I:{default:I}}r.default=function(I){return function(P,B,H){if(H=(0,n.default)(H),I<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!P)return H(null);if((0,c.isAsyncGenerator)(P))return(0,_.default)(P,I,B,H);if((0,c.isAsyncIterable)(P))return(0,_.default)(P[Symbol.asyncIterator](),I,B,H);var Q=(0,a.default)(P),ue=!1,Ee=!1,Le=0,Ze=!1;function tt(wt,fr){if(!Ee)if(Le-=1,wt)ue=!0,H(wt);else if(wt===!1)ue=!0,Ee=!0;else{if(fr===A.default||ue&&Le<=0)return ue=!0,H(null);Ze||ft()}}function ft(){for(Ze=!0;Le<I&&!ue;){var wt=Q();if(wt===null){ue=!0,Le<=0&&H(null);return}Le+=1,B(wt.value,wt.key,(0,l.default)(tt))}Ze=!1}ft()}},e.exports=r.default}(zg,zg.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=zg.exports,n=c(t),i=qu,a=c(i),s=md.exports,l=c(s);function c(_){return _&&_.__esModule?_:{default:_}}function p(_,b,A,w){return(0,n.default)(b)(_,(0,a.default)(A),w)}r.default=(0,l.default)(p,4),e.exports=r.default}(O0,O0.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=O0.exports,n=s(t),i=md.exports,a=s(i);function s(c){return c&&c.__esModule?c:{default:c}}function l(c,p,_){return(0,n.default)(c,1,p,_)}r.default=(0,a.default)(l,3),e.exports=r.default}(Ug,Ug.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=ov.exports,n=s(t),i=Ug.exports,a=s(i);function s(c){return c&&c.__esModule?c:{default:c}}function l(c,p){return(0,n.default)(a.default,c,p)}e.exports=r.default}(dm,dm.exports);var k0=pm(dm.exports),$f=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,k0(this.tasks)},e.prototype.tap=function(r,t){var n=this;this.tasks.push(function(i){t.apply(void 0,av([],iv(n.args),!1)),i(null,r)})},e}(),Hg={exports:{}},Wg={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=dd.exports,n=B(t),i=ym.exports,a=B(i),s=O0.exports,l=B(s),c=gm.exports,p=B(c),_=_m.exports,b=B(_),A=qu,w=B(A),I=md.exports,P=B(I);function B(Ee){return Ee&&Ee.__esModule?Ee:{default:Ee}}function H(Ee,Le,Ze){Ze=(0,p.default)(Ze);var tt=0,ft=0,wt=Ee.length,fr=!1;wt===0&&Ze(null);function hr(Mr,ln){Mr===!1&&(fr=!0),fr!==!0&&(Mr?Ze(Mr):(++ft===wt||ln===a.default)&&Ze(null))}for(;tt<wt;tt++)Le(Ee[tt],tt,(0,b.default)(hr))}function Q(Ee,Le,Ze){return(0,l.default)(Ee,Infinity,Le,Ze)}function ue(Ee,Le,Ze){var tt=(0,n.default)(Ee)?H:Q;return tt(Ee,(0,w.default)(Le),Ze)}r.default=(0,P.default)(ue,3),e.exports=r.default})(Wg,Wg.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=Wg.exports,n=s(t),i=ov.exports,a=s(i);function s(c){return c&&c.__esModule?c:{default:c}}function l(c,p){return(0,a.default)(n.default,c,p)}e.exports=r.default}(Hg,Hg.exports);var pA=pm(Hg.exports),eN=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return pA(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return hm(n,void 0,void 0,function(){return nv(this,function(a){switch(a.label){case 0:return[4,t()];case 1:return a.sent(),i(null,r),[2]}})})})},e}(),Gg={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=gm.exports,n=_(t),i=_m.exports,a=_(i),s=qu,l=_(s),c=md.exports,p=_(c);function _(A){return A&&A.__esModule?A:{default:A}}function b(A,w){if(w=(0,n.default)(w),!Array.isArray(A))return w(new Error("First argument to waterfall must be an array of functions"));if(!A.length)return w();var I=0;function P(H){var Q=(0,l.default)(A[I++]);Q.apply(void 0,H.concat([(0,a.default)(B)]))}function B(H){for(var Q=[],ue=arguments.length-1;ue-- >0;)Q[ue]=arguments[ue+1];if(H!==!1){if(H||I===A.length)return w.apply(void 0,[H].concat(Q));P(Q)}}P([])}r.default=(0,p.default)(b),e.exports=r.default})(Gg,Gg.exports);var ay=pm(Gg.exports),tN=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return ay(this.tasks)},e.prototype.tap=function(r,t){this.tasks.length===0?this.tasks.push(function(n){var i=t();n(i?null:!1,i)}):this.tasks.push(function(n,i){var a=t.apply(void 0,av([],iv(n),!1));i(a?null:!1,r)})},e}(),oy=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return k0(this.tasks)},e.prototype.tap=function(r,t){this.tasks.push(function(n){var i=t();n(i,r)})},e}(),dA=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,k0(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return hm(n,void 0,void 0,function(){return nv(this,function(a){switch(a.label){case 0:return[4,t.apply(void 0,av([],iv(this.args),!1))];case 1:return a.sent(),i(null,r),[2]}})})})},e}(),vA=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,k0(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return hm(n,void 0,void 0,function(){var a;return nv(this,function(s){switch(s.label){case 0:return[4,t.apply(void 0,av([],iv(this.args),!1))];case 1:return a=s.sent(),i(a,r),[2]}})})})},e}(),mA=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return ay(this.tasks)},e.prototype.tapPromise=function(r,t){this.tasks.length===0?this.tasks.push(function(n){t().then(function(i){n(null,i)})}):this.tasks.push(function(n,i){t(n).then(function(a){i(null,a)})})},e}(),sy=Z(67709),gA=Z.n(sy),uy,ly,cy,fy,hy,py,dy,vy,gy,_y,yy,xy,by,Ey,Sy,Ay,Ty,wy,mu,Cy,Ry,My,Iy,Py,Oy,ky,Dy,Ly,By,Fy,Ny,Uy,zy,Zy,Vy;function _A(e){var r=yA();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function yA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xA=(uy=(0,Jt.b2)(),ly=(0,Jt.f3)(Ye.SceneID),cy=(0,Jt.f3)(Ye.IIconService),fy=(0,Jt.f3)(Ye.IFontService),hy=(0,Jt.f3)(Ye.IControlService),py=(0,Jt.f3)(Ye.IGlobalConfigService),dy=(0,Jt.f3)(Ye.IMapService),vy=(0,Jt.f3)(Ye.ICoordinateSystemService),gy=(0,Jt.f3)(Ye.IRendererService),_y=(0,Jt.f3)(Ye.ILayerService),yy=(0,Jt.f3)(Ye.IDebugService),xy=(0,Jt.f3)(Ye.ICameraService),by=(0,Jt.f3)(Ye.IInteractionService),Ey=(0,Jt.f3)(Ye.IPickingService),Sy=(0,Jt.f3)(Ye.IShaderModuleService),Ay=(0,Jt.f3)(Ye.IMarkerService),Ty=(0,Jt.f3)(Ye.IPopupService),uy(wy=(mu=function(e){(0,Qe.Z)(t,e);var r=_A(t);function t(){var n;return(0,ge.Z)(this,t),n=r.call(this),(0,N.Z)((0,we.Z)(n),"destroyed",!1),(0,N.Z)((0,we.Z)(n),"loaded",!1),qr((0,we.Z)(n),"id",Cy,(0,we.Z)(n)),qr((0,we.Z)(n),"iconService",Ry,(0,we.Z)(n)),qr((0,we.Z)(n),"fontService",My,(0,we.Z)(n)),qr((0,we.Z)(n),"controlService",Iy,(0,we.Z)(n)),qr((0,we.Z)(n),"configService",Py,(0,we.Z)(n)),qr((0,we.Z)(n),"map",Oy,(0,we.Z)(n)),qr((0,we.Z)(n),"coordinateSystemService",ky,(0,we.Z)(n)),qr((0,we.Z)(n),"rendererService",Dy,(0,we.Z)(n)),qr((0,we.Z)(n),"layerService",Ly,(0,we.Z)(n)),qr((0,we.Z)(n),"debugService",By,(0,we.Z)(n)),qr((0,we.Z)(n),"cameraService",Fy,(0,we.Z)(n)),qr((0,we.Z)(n),"interactionService",Ny,(0,we.Z)(n)),qr((0,we.Z)(n),"pickingService",Uy,(0,we.Z)(n)),qr((0,we.Z)(n),"shaderModuleService",zy,(0,we.Z)(n)),qr((0,we.Z)(n),"markerService",Zy,(0,we.Z)(n)),qr((0,we.Z)(n),"popupService",Vy,(0,we.Z)(n)),(0,N.Z)((0,we.Z)(n),"inited",!1),(0,N.Z)((0,we.Z)(n),"initPromise",void 0),(0,N.Z)((0,we.Z)(n),"rendering",!1),(0,N.Z)((0,we.Z)(n),"$container",void 0),(0,N.Z)((0,we.Z)(n),"canvas",void 0),(0,N.Z)((0,we.Z)(n),"markerContainer",void 0),(0,N.Z)((0,we.Z)(n),"hooks",void 0),(0,N.Z)((0,we.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),Ml(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,N.Z)((0,we.Z)(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new dA},n}return(0,K.Z)(t,[{key:"init",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Nt.Z)(xe().mark(function s(){return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a.debugService.log("map.mapInitStart",{type:a.map.version}),c.next=3,new Promise(function(p){a.map.onCameraChanged(function(_){a.cameraService.init(),a.cameraService.update(_),p()}),a.map.init()});case 3:a.map.onCameraChanged(a.handleMapCameraChanged),a.map.addMarkerContainer(),a.markerService.addMarkers(),a.markerService.addMarkerLayers(),a.popupService.initPopup(),a.interactionService.init(),a.interactionService.on(is.Drag,a.addSceneEvent.bind(a));case 10:case"end":return c.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,Nt.Z)(xe().mark(function s(){var l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(c=((l=a.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,c?a.$container=c:a.$container=sc(a.configService.getSceneConfig(a.id).id||""),!a.$container){b.next=13;break}return a.canvas=In("canvas","",a.$container),a.setCanvas(),b.next=7,a.rendererService.init(a.canvas,a.configService.getSceneConfig(a.id),i.gl);case 7:a.registerContextLost(),a.initContainer(),gA()(a.$container,a.handleWindowResized),window.matchMedia&&((p=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||p===void 0||p.addListener(a.handleWindowResized)),b.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:a.pickingService.init(a.id);case 15:case"end":return b.stop()}},s)}))),this.render()}},{key:"registerContextLost",value:function(){var i=this,a=this.rendererService.getCanvas();a&&a.addEventListener("webglcontextlost",function(){return i.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Nt.Z)(xe().mark(function s(){return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,new Promise(function(p){a.map.onCameraChanged(function(_){a.cameraService.init(),a.cameraService.update(_),a.map.version!=="GAODE2.x"&&p()}),a.map.initMiniMap()});case 2:a.map.onCameraChanged(a.handleMapCameraChanged),a.interactionService.init(),a.interactionService.on(is.Drag,a.addSceneEvent.bind(a));case 5:case"end":return c.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,Nt.Z)(xe().mark(function s(){var l;return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(l=i.canvas,a.$container=l||null,!a.$container){p.next=7;break}return p.next=5,a.rendererService.init(i.canvas,a.configService.getSceneConfig(a.id),void 0);case 5:p.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:a.pickingService.init(a.id);case 9:case"end":return p.stop()}},s)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,a){this.fontService.addFontFace(i,a)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s){var l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],b.next=3,this.render();case 3:return p=s==="jpg"?c==null?void 0:c.toDataURL("image/jpeg"):c==null?void 0:c.toDataURL("image/png"),b.abrupt("return",p);case 5:case"end":return b.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=In("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,a;if(!this.inited){this.destroyed=!0;return}if((0,sy.unbind)(this.$container,this.handleWindowResized),window.matchMedia){var s;(s=window.matchMedia("screen and (min-resolution: 2dppx)"))===null||s===void 0||s.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var l;(l=i.$container)===null||l===void 0||l.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),(a=this.$container)===null||a===void 0||(a=a.parentNode)===null||a===void 0||a.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var i,a,s=oa,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,p=this.canvas;p&&(p.width=l*s,p.height=c*s),this.rendererService.viewport({x:0,y:0,width:s*l,height:s*c})}},{key:"setCanvas",value:function(){var i,a,s=oa,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,p=this.canvas;p.width=l*s,p.height=c*s,p.style.width="100%",p.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),t}(Fa.EventEmitter),Cy=Cr(mu.prototype,"id",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry=Cr(mu.prototype,"iconService",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),My=Cr(mu.prototype,"fontService",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iy=Cr(mu.prototype,"controlService",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Py=Cr(mu.prototype,"configService",[py],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oy=Cr(mu.prototype,"map",[dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ky=Cr(mu.prototype,"coordinateSystemService",[vy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dy=Cr(mu.prototype,"rendererService",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ly=Cr(mu.prototype,"layerService",[_y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),By=Cr(mu.prototype,"debugService",[yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fy=Cr(mu.prototype,"cameraService",[xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ny=Cr(mu.prototype,"interactionService",[by],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uy=Cr(mu.prototype,"pickingService",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zy=Cr(mu.prototype,"shaderModuleService",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zy=Cr(mu.prototype,"markerService",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vy=Cr(mu.prototype,"popupService",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mu))||wy);function bA(e){var r=0;switch(e){case"vec2":case"ivec2":r=2;break;case"vec3":case"ivec3":r=3;break;case"vec4":case"ivec4":case"mat2":r=4;break;case"mat3":r=9;break;case"mat4":r=16;break;default:}return r}var jy=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Hy(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t={};return e=e.replace(jy,function(n,i,a){var s=a.split(":"),l=s[0].trim(),c="";switch(s.length>1&&(c=s[1].trim()),i){case"bool":c=c==="true";break;case"float":case"int":c=Number(c);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":c?c=c.replace("[","").replace("]","").split(",").reduce(function(p,_){return p.push(Number(_.trim())),p},[]):c=new Array(bA(i)).fill(0);break;default:}return t[l]=c,"".concat(r?"uniform ":"").concat(i," ").concat(l,`;
`)}),{content:e,uniforms:t}}function Xg(e){var r=Hy(e,!0),t=r.content,n=r.uniforms;return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,function(i,a,s){s=s.trim().replace(/^.*$/gm,function(_){return"uniform ".concat(_)});var l=Hy(s),c=l.content,p=l.uniforms;return Object.assign(n,p),"".concat(a,`{
`).concat(c,`
};`)}),{content:t,uniforms:n}}function Wy(e){var r={};return e.replace(jy,function(t,n,i){var a=i.trim();return r[a]?"":(r[a]=!0,"uniform ".concat(n," ").concat(a,`;
`))})}var Gy,Xy,EA=vi.uniq,$y="#define PI 3.14159265359",SA=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Yy=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
};

layout(std140) uniform LayerUniforms {
  mat4 u_Mvp;
  vec2 u_sceneCenterMercator;
};
`,qy=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_EnableSelect;
  float u_activeMix;
};`,AA=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,TA=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,wA=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,CA=`layout(location = 3) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,RA=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Ky=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)
#define EARTH_CIRCUMFERENCE 40.03e6

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
#pragma include "scene_uniforms"


// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return lnglat;
  }
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
 

  //    return vec4(
  //     position.xy,
  //     project_scale(position.z),
  //     position.w);
  // }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}



float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }

  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
   return meter;
  } else  {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}
`,MA=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,IA=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Qy=/precision\s+(high|low|medium)p\s+float/,Jy=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,PA=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,OA=/void\s+main\s*\([^)]*\)\s*\{\n?/,rN=/}\n?[^{}]*$/,kA=(Gy=(0,Jt.b2)(),Gy(Xy=function(){function e(){(0,ge.Z)(this,e),(0,N.Z)(this,"moduleCache",{}),(0,N.Z)(this,"rawContentCache",{})}return(0,K.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:$y,fs:$y}),this.registerModule("decode",{vs:SA,fs:""}),this.registerModule("scene_uniforms",{vs:Yy,fs:Yy}),this.registerModule("picking_uniforms",{vs:qy,fs:qy}),this.registerModule("projection",{vs:Ky,fs:Ky}),this.registerModule("project",{vs:RA,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:IA}),this.registerModule("lighting",{vs:TA,fs:""}),this.registerModule("light",{vs:AA,fs:""}),this.registerModule("picking",{vs:CA,fs:wA}),this.registerModule("rotation_2d",{vs:MA,fs:""})}},{key:"registerModule",value:function(t,n){n.vs=n.vs.replace(/\r\n/g,`
`),n.fs=n.fs.replace(/\r\n/g,`
`);var i=n.vs,a=n.fs,s=n.uniforms,l=n.inject,c=Xg(i),p=c.content,_=c.uniforms,b=Xg(a),A=b.content,w=b.uniforms;this.rawContentCache[t]={fs:A,inject:l,uniforms:(0,k.Z)((0,k.Z)((0,k.Z)({},_),w),s),vs:p}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this,i=this.rawContentCache[t].vs,a=this.rawContentCache[t].fs,s=this.rawContentCache[t].inject,l={};s!=null&&s["vs:#decl"]&&(i=(s==null?void 0:s["vs:#decl"])+i,l=Xg(s==null?void 0:s["vs:#decl"]).uniforms),s!=null&&s["vs:#main-start"]&&(i=i.replace(OA,function(H){return H+(s==null?void 0:s["vs:#main-start"])})),s!=null&&s["fs:#decl"]&&(a=(s==null?void 0:s["fs:#decl"])+a);var c=this.processModule(i,[],"vs"),p=c.content,_=c.includeList,b=this.processModule(a,[],"fs"),A=b.content,w=b.includeList,I="",P=EA(_.concat(w).concat(t)).reduce(function(H,Q){return(0,k.Z)((0,k.Z)({},H),n.rawContentCache[Q].uniforms)},(0,k.Z)({},l));Qy.test(A)||(I=I+Jy),I=I+A;var B="";return Qy.test(p)||(B=B+Jy),B=B+p,this.moduleCache[t]={fs:I.trim(),uniforms:P,vs:B.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,i){var a=this,s=t.replace(PA,function(l,c){var p=c.split(" "),_=p[0].replace(/"/g,"");if(n.indexOf(_)>-1)return"";var b=a.rawContentCache[_][i];n.push(_);var A=a.processModule(b,n,i),w=A.content;return w});return{content:s,includeList:n}}},{key:"injectDefines",value:function(t){var n=Object.keys(t).reduce(function(i,a){return i+"#define ".concat(a.toUpperCase()," ").concat(t[a],`;
`)},`
`);return n}}]),e}())||Xy),va=Z(66213),sv=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),e1,t1,D0=(e1=(0,Jt.b2)(),e1(t1=function(){function e(){(0,ge.Z)(this,e),(0,N.Z)(this,"shaderModuleService",void 0),(0,N.Z)(this,"rendererService",void 0),(0,N.Z)(this,"cameraService",void 0),(0,N.Z)(this,"mapService",void 0),(0,N.Z)(this,"interactionService",void 0),(0,N.Z)(this,"layerService",void 0),(0,N.Z)(this,"config",void 0)}return(0,K.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return sv.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Ye.IRendererService),this.cameraService=t.getContainer().get(Ye.ICameraService),this.mapService=t.getContainer().get(Ye.IMapService),this.interactionService=t.getContainer().get(Ye.IInteractionService),this.layerService=t.getContainer().get(Ye.ILayerService),this.shaderModuleService=t.getContainer().get(Ye.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||t1),r1,n1;function DA(e){var r=LA();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function LA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BA=(r1=(0,Jt.b2)(),r1(n1=function(e){(0,Qe.Z)(t,e);var r=DA(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,a){(0,va.Z)((0,pe.Z)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(D0))||n1),i1,a1,o1,$g,s1;function FA(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=NA(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function NA(e,r){if(!!e){if(typeof e=="string")return u1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return u1(e,r)}}function u1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var UA=(i1=(0,Jt.b2)(),a1=(0,Jt.f3)(Ye.IPostProcessor),i1(o1=($g=function(){function e(){(0,ge.Z)(this,e),(0,N.Z)(this,"passes",[]),qr(this,"postProcessor",s1,this),(0,N.Z)(this,"layer",void 0),(0,N.Z)(this,"renderFlag",void 0),(0,N.Z)(this,"width",0),(0,N.Z)(this,"height",0)}return(0,K.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var r=(0,Nt.Z)(xe().mark(function n(){var i,a,s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=FA(this.passes),c.prev=1,i.s();case 3:if((a=i.n()).done){c.next=9;break}return s=a.value,c.next=7,s.render(this.layer);case 7:c.next=3;break;case 9:c.next=14;break;case 11:c.prev=11,c.t0=c.catch(1),i.e(c.t0);case 14:return c.prev=14,i.f(),c.finish(14);case 17:return c.next=19,this.postProcessor.render(this.layer);case 19:case"end":return c.stop()}},n,this,[[1,11,14,17]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===sv.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,i){t.init(this.layer,n),this.passes.splice(i,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),s1=Cr($g.prototype,"postProcessor",[a1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$g))||o1),l1,c1;function zA(e){var r=ZA();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function ZA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VA=(l1=(0,Jt.b2)(),l1(c1=function(e){(0,Qe.Z)(t,e);var r=zA(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"pickingFBO",void 0),(0,N.Z)((0,we.Z)(n),"layer",void 0),(0,N.Z)((0,we.Z)(n),"width",0),(0,N.Z)((0,we.Z)(n),"height",0),(0,N.Z)((0,we.Z)(n),"alreadyInRendering",!1),(0,N.Z)((0,we.Z)(n),"pickFromPickingFBO",function(l){var c=l.x,p=l.y,_=l.lngLat,b=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(b))){var A=n.rendererService,w=A.getViewportSize,I=A.readPixels,P=A.useFramebuffer,B=w(),H=B.width,Q=B.height,ue=n.layer.getLayerConfig(),Ee=ue.enableHighlight,Le=ue.enableSelect,Ze=c*oa,tt=p*oa;if(!(Ze>H||Ze<0||tt>Q||tt<0)){var ft;P(n.pickingFBO,function(){var wt;if(ft=I({x:Math.round(Ze),y:Math.round(Q-(p+1)*oa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),ft[0]!==0||ft[1]!==0||ft[2]!==0){var fr=ia(ft),hr=n.layer.getSource().getFeatureById(fr),Mr={x:c,y:p,type:b,lngLat:_,featureId:fr,feature:hr};hr&&(n.layer.setCurrentPickId(fr),n.triggerHoverOnLayer(Mr))}else{var ln={x:c,y:p,lngLat:_,type:n.layer.getCurrentPickId()===null?"un"+b:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,k.Z)((0,k.Z)({},ln),{},{type:"unpick"})),n.triggerHoverOnLayer(ln),n.layer.setCurrentPickId(null)}Ee&&n.highlightPickedFeature(ft),Le&&b==="click"&&((wt=ft)===null||wt===void 0?void 0:wt.toString())!==[0,0,0,0].toString()&&n.selectFeature(ft)})}}}),n}return(0,K.Z)(t,[{key:"getType",value:function(){return sv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,a){(0,va.Z)((0,pe.Z)(t.prototype),"init",this).call(this,i,a),this.layer=i;var s=this.rendererService,l=s.createTexture2D,c=s.createFramebuffer,p=s.getViewportSize,_=p(),b=_.width,A=_.height;this.pickingFBO=c({color:l({width:b,height:A,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.interactionService.on(is.Hover,this.pickFromPickingFBO),this.interactionService.on(is.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(is.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var a=this;if(!this.alreadyInRendering){var s=this.rendererService,l=s.getViewportSize,c=s.useFramebuffer,p=s.clear,_=l(),b=_.width,A=_.height;this.alreadyInRendering=!0,(this.width!==b||this.height!==A)&&(this.pickingFBO.resize({width:b,height:A}),this.width=b,this.height=A),c(this.pickingFBO,function(){p({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var w=a.layer.multiPassRenderer.getRenderFlag();a.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),a.layer.multiPassRenderer.setRenderFlag(w),a.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var a=(0,re.Z)(i,3),s=a[0],l=a[1],c=a[2];this.layer.hooks.beforeHighlight.call([s,l,c]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var a=(0,re.Z)(i,3),s=a[0],l=a[1],c=a[2];this.layer.hooks.beforeSelect.call([s,l,c]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var a=i.featureId,s=Ra(a);this.selectFeature(new Uint8Array(s))}},{key:"highlightFeatureHandle",value:function(i){var a=i.featureId,s=Ra(a);this.highlightPickedFeature(new Uint8Array(s))}}]),t}(D0))||c1),f1,h1,p1,Yg,d1,jA=vi.camelCase,HA=vi.isNil,WA=vi.upperFirst,GA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Lh=(f1=(0,Jt.b2)(),h1=(0,Jt.f3)(Ye.IShaderModuleService),f1(p1=(Yg=function(){function e(){(0,ge.Z)(this,e),qr(this,"shaderModuleService",d1,this),(0,N.Z)(this,"rendererService",void 0),(0,N.Z)(this,"config",void 0),(0,N.Z)(this,"quad",GA),(0,N.Z)(this,"enabled",!0),(0,N.Z)(this,"renderToScreen",!1),(0,N.Z)(this,"model",void 0),(0,N.Z)(this,"name",void 0),(0,N.Z)(this,"optionsToUpdate",{})}return(0,K.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return sv.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Ye.IRendererService),this.shaderModuleService=t.getContainer().get(Ye.IShaderModuleService);var i=this.rendererService,a=i.createAttribute,s=i.createBuffer,l=i.createModel,c=this.setupShaders(),p=c.vs,_=c.fs,b=c.uniforms;this.model=l({vs:p,fs:_,attributes:{a_Position:a({buffer:s({data:[-4,-4,4,-4,0,4],type:Y.FLOAT}),size:2})},uniforms:(0,k.Z)((0,k.Z)({u_Texture:null},b),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var i=this,a=t.multiPassRenderer.getPostProcessor(),s=this.rendererService,l=s.useFramebuffer,c=s.getViewportSize,p=s.clear,_=c(),b=_.width,A=_.height;l(this.renderToScreen?null:a.getWriteFBO(),function(){p({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var w=(0,k.Z)({u_BloomFinal:0,u_Texture:a.getReadFBO(),u_ViewportSize:[b,A]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(w.u_BloomFinal=1,w.u_Texture2=n),i.model.draw({uniforms:w})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,k.Z)((0,k.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(i){HA(t[i])||(n["u_".concat(WA(jA(i)))]=t[i])}),n}}]),e}(),d1=Cr(Yg.prototype,"shaderModuleService",[h1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yg))||p1),v1,m1;function XA(e){var r=$A();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function $A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YA=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,qA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qg=vi.isNil,KA=(v1=(0,Jt.b2)(),v1(m1=function(e){(0,Qe.Z)(t,e);var r=XA(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:qA,fs:YA});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:s,uniforms:(0,k.Z)((0,k.Z)({},l),{},{u_ViewportSize:[p,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return qg(i.bloomRadius)||(a.u_radius=i.bloomRadius),qg(i.bloomIntensity)||(a.u_intensity=i.bloomIntensity),qg(i.bloomBaseRadio)||(a.u_baseRadio=i.bloomBaseRadio),a}}]),t}(Lh))||m1),g1,_1;function QA(e){var r=JA();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function JA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,tT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,rT=vi.isNil,nT=(g1=(0,Jt.b2)(),g1(_1=function(e){(0,Qe.Z)(t,e);var r=QA(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:tT,fs:eT});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:s,uniforms:(0,k.Z)((0,k.Z)({},l),{},{u_ViewportSize:[p,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return rT(i.blurRadius)||(a.u_BlurDir=[i.blurRadius,0]),a}}]),t}(Lh))||_1),y1,x1;function iT(e){var r=aT();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function aT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,sT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,uT=vi.isNil,lT=(y1=(0,Jt.b2)(),y1(x1=function(e){(0,Qe.Z)(t,e);var r=iT(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:sT,fs:oT});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:s,uniforms:(0,k.Z)((0,k.Z)({},l),{},{u_ViewportSize:[p,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return uT(i.blurRadius)||(a.u_BlurDir=[0,i.blurRadius]),a}}]),t}(Lh))||x1),b1,E1;function cT(e){var r=fT();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function fT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hT=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,pT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,dT=(b1=(0,Jt.b2)(),b1(E1=function(e){(0,Qe.Z)(t,e);var r=cT(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:pT,fs:hT});var i=this.shaderModuleService.getModule("colorhalftone-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:s,uniforms:(0,k.Z)((0,k.Z)({},l),{},{u_ViewportSize:[p,_]})}}}]),t}(Lh))||E1),S1,A1;function vT(e){var r=mT();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function mT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,_T=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yT=(S1=(0,Jt.b2)(),S1(A1=function(e){(0,Qe.Z)(t,e);var r=vT(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:_T,fs:gT}),this.shaderModuleService.getModule("copy-pass")}}]),t}(Lh))||A1),T1,w1;function xT(e){var r=bT();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function bT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ET=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,ST=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,AT=(T1=(0,Jt.b2)(),T1(w1=function(e){(0,Qe.Z)(t,e);var r=xT(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:ST,fs:ET});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:s,uniforms:(0,k.Z)((0,k.Z)({},l),{},{u_ViewportSize:[p,_]})}}}]),t}(Lh))||w1),C1,R1;function TT(e){var r=wT();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function wT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CT=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,RT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,MT=(C1=(0,Jt.b2)(),C1(R1=function(e){(0,Qe.Z)(t,e);var r=TT(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:RT,fs:CT});var i=this.shaderModuleService.getModule("ink-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:s,uniforms:(0,k.Z)((0,k.Z)({},l),{},{u_ViewportSize:[p,_]})}}}]),t}(Lh))||R1),M1,I1;function IT(e){var r=PT();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function PT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OT=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,kT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,DT=(M1=(0,Jt.b2)(),M1(I1=function(e){(0,Qe.Z)(t,e);var r=IT(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:kT,fs:OT}),this.shaderModuleService.getModule("noise-pass")}}]),t}(Lh))||I1),P1,O1;function LT(e){var r=BT();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function BT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,NT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,UT=(P1=(0,Jt.b2)(),P1(O1=function(e){(0,Qe.Z)(t,e);var r=LT(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:FT,fs:NT}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(Lh))||O1),k1,D1,L1,B1,uv,F1,zT=(k1=(0,Jt.b2)(),D1=(0,Jt.f3)(Ye.IRendererService),L1=(0,Jt.zY)(),k1(B1=(uv=function(){function e(){(0,ge.Z)(this,e),qr(this,"rendererService",F1,this),(0,N.Z)(this,"passes",[]),(0,N.Z)(this,"readFBO",void 0),(0,N.Z)(this,"writeFBO",void 0)}return(0,K.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,i=t.createTexture2D,a=n(),s=a.width,l=a.height;return i({x:0,y:0,width:s,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(i){n(t.readFBO,(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:i(t.getCurrentFBOTex());case 1:case"end":return l.stop()}},a)})))})}},{key:"renderBloomPass",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i,a){var s,l;return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.getReadFBOTex();case 2:s=p.sent,l=0;case 4:if(!(l<4)){p.next=11;break}return p.next=7,a.render(i,s);case 7:this.swap(),l++,p.next=4;break;case 11:case"end":return p.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i){var a,s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:a=0;case 1:if(!(a<this.passes.length)){c.next=15;break}if(s=this.passes[a],s.setRenderToScreen(this.isLastEnabledPass(a)),s.getName()!=="bloom"){c.next=9;break}return c.next=7,this.renderBloomPass(i,s);case 7:c.next=12;break;case 9:return c.next=11,s.render(i);case 11:a!==this.passes.length-1&&this.swap();case 12:a++,c.next=1;break;case 15:case"end":return c.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,i){t.init(n,i),this.passes.push(t)}},{key:"insert",value:function(t,n,i,a){t.init(i,a),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,i=t.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),F1=Cr(uv.prototype,"rendererService",[D1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cr(uv.prototype,"init",[L1],Object.getOwnPropertyDescriptor(uv.prototype,"init"),uv.prototype),uv))||B1),N1,U1;function ZT(e){var r=VT();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function VT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jT=(N1=(0,Jt.b2)(),N1(U1=function(e){(0,Qe.Z)(t,e);var r=ZT(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getType",value:function(){return sv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,a){(0,va.Z)((0,pe.Z)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(i){var a=this.rendererService,s=a.useFramebuffer,l=a.clear,c=i.multiPassRenderer.getPostProcessor().getReadFBO();s(c,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(p){p.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),t}(D0))||U1),z1,Z1,V1,Kg,j1;function HT(e){var r=WT();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function WT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GT=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,H1=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,XT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function W1(e,r){for(var t=0,n=1/r,i=e;i>0;)t=t+n*(i%r),i=Math.floor(i/r),n=n/r;return t}var $T=1,YT=(z1=(0,Jt.b2)(),Z1=(0,Jt.f3)(Ye.IShaderModuleService),z1(V1=(Kg=function(e){(0,Qe.Z)(t,e);var r=HT(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),qr((0,we.Z)(n),"shaderModuleService",j1,(0,we.Z)(n)),(0,N.Z)((0,we.Z)(n),"haltonSequence",[]),(0,N.Z)((0,we.Z)(n),"accumulatingId",0),(0,N.Z)((0,we.Z)(n),"frame",0),(0,N.Z)((0,we.Z)(n),"timer",void 0),(0,N.Z)((0,we.Z)(n),"sampleRenderTarget",void 0),(0,N.Z)((0,we.Z)(n),"prevRenderTarget",void 0),(0,N.Z)((0,we.Z)(n),"outputRenderTarget",void 0),(0,N.Z)((0,we.Z)(n),"copyRenderTarget",void 0),(0,N.Z)((0,we.Z)(n),"blendModel",void 0),(0,N.Z)((0,we.Z)(n),"outputModel",void 0),(0,N.Z)((0,we.Z)(n),"copyModel",void 0),n}return(0,K.Z)(t,[{key:"getType",value:function(){return sv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,a){(0,va.Z)((0,pe.Z)(t.prototype),"init",this).call(this,i,a);var s=this.rendererService,l=s.createFramebuffer,c=s.createTexture2D;this.sampleRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})});for(var p=0;p<30;p++)this.haltonSequence.push([W1(p,2),W1(p,3)]);this.blendModel=this.createTriangleModel("blend-pass",GT),this.outputModel=this.createTriangleModel("copy-pass",H1,{blend:{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE_MINUS_SRC_ALPHA,srcAlpha:Y.ONE,dstAlpha:Y.ONE_MINUS_SRC_ALPHA},equation:{rgb:Y.FUNC_ADD,alpha:Y.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",H1)}},{key:"render",value:function(i){var a=this,s=this.rendererService,l=s.clear,c=s.getViewportSize,p=s.useFramebuffer,_=c(),b=_.width,A=_.height;this.sampleRenderTarget.resize({width:b,height:A}),this.prevRenderTarget.resize({width:b,height:A}),this.outputRenderTarget.resize({width:b,height:A}),this.copyRenderTarget.resize({width:b,height:A}),this.resetFrame(),this.stopAccumulating();var w=i.multiPassRenderer.getPostProcessor().getReadFBO();p(w,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:w}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var I=function P(B){!a.accumulatingId||B!==a.accumulatingId||a.isFinished()||(a.doRender(i),window.requestAnimationFrame(function(){P(B)}))};this.accumulatingId=$T++,this.timer=window.setTimeout(function(){I(a.accumulatingId)},50)}},{key:"doRender",value:function(i){var a=this,s=this.rendererService,l=s.clear,c=s.getViewportSize,p=s.useFramebuffer,_=c(),b=_.width,A=_.height,w=i.getLayerConfig(),I=w.jitterScale,P=I===void 0?1:I,B=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((B[0]*2-1)/b*P,(B[1]*2-1)/A*P),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),p(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var H=i.getLayerConfig();p(this.outputRenderTarget,function(){a.blendModel.draw({uniforms:{u_opacity:H.opacity||1,u_MixRatio:a.frame===0?1:.9,u_Diffuse1:a.sampleRenderTarget,u_Diffuse2:a.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():a.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(p(this.copyRenderTarget,function(){a.outputModel.draw({uniforms:{u_Texture:a.outputRenderTarget}})}),p(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){a.copyModel.draw({uniforms:{u_Texture:a.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var Q=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Q,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,a,s){this.shaderModuleService.registerModule(i,{vs:XT,fs:a});var l=this.shaderModuleService.getModule(i),c=l.vs,p=l.fs,_=l.uniforms,b=this.rendererService,A=b.createAttribute,w=b.createBuffer,I=b.createModel;return I((0,k.Z)({vs:c,fs:p,attributes:{a_Position:A({buffer:w({data:[-4,-4,4,-4,0,4],type:Y.FLOAT}),size:2})},uniforms:(0,k.Z)({},_),depth:{enable:!1},count:3},s))}}]),t}(D0),j1=Cr(Kg.prototype,"shaderModuleService",[Z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kg))||V1),xm=new Jt.W2;xm.bind(Ye.IGlobalConfigService).to(Ai).inSingletonScope(),(0,Jt.GW)((0,Jt.b2)(),Fa.EventEmitter),xm.bind(Ye.IEventEmitter).to(Fa.EventEmitter);var G1=(0,Si.Z)(xm,!1),Qg=function(r){var t=G1.lazyInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},nN=function(r){var t=G1.lazyMultiInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},Ul=xm,qT=0;function KT(){var e=new Jt.W2;return e.parent=xm,e.bind(Ye.SceneID).toConstantValue("".concat(qT++)),e.bind(Ye.IShaderModuleService).to(kA).inSingletonScope(),e.bind(Ye.ILayerService).to(om).inSingletonScope(),e.bind(Ye.IDebugService).to(Qd).inSingletonScope(),e.bind(Ye.ISceneService).to(xA).inSingletonScope(),e.bind(Ye.ICameraService).to(m).inSingletonScope(),e.bind(Ye.ICoordinateSystemService).to(ad).inSingletonScope(),e.bind(Ye.IInteractionService).to(od).inSingletonScope(),e.bind(Ye.IPickingService).to(S0).inSingletonScope(),e.bind(Ye.IControlService).to(q).inSingletonScope(),e.bind(Ye.IMarkerService).to(ze).inSingletonScope(),e.bind(Ye.IIconService).to(ht).inSingletonScope(),e.bind(Ye.IFontService).to(Wt).inSingletonScope(),e.bind(Ye.IPopupService).to(et).inSingletonScope(),e.bind(Ye.INormalPass).to(BA).whenTargetNamed("clear"),e.bind(Ye.INormalPass).to(VA).whenTargetNamed("pixelPicking"),e.bind(Ye.INormalPass).to(jT).whenTargetNamed("render"),e.bind(Ye.INormalPass).to(YT).whenTargetNamed("taa"),e.bind(Ye.IFactoryNormalPass).toFactory(function(r){return function(t){return r.container.getNamed(Ye.INormalPass,t)}}),e.bind(Ye.IPostProcessingPass).to(yT).whenTargetNamed("copy"),e.bind(Ye.IPostProcessingPass).to(KA).whenTargetNamed("bloom"),e.bind(Ye.IPostProcessingPass).to(nT).whenTargetNamed("blurH"),e.bind(Ye.IPostProcessingPass).to(lT).whenTargetNamed("blurV"),e.bind(Ye.IPostProcessingPass).to(DT).whenTargetNamed("noise"),e.bind(Ye.IPostProcessingPass).to(UT).whenTargetNamed("sepia"),e.bind(Ye.IPostProcessingPass).to(dT).whenTargetNamed("colorHalftone"),e.bind(Ye.IPostProcessingPass).to(AT).whenTargetNamed("hexagonalPixelate"),e.bind(Ye.IPostProcessingPass).to(MT).whenTargetNamed("ink"),e.bind(Ye.IFactoryPostProcessingPass).toFactory(function(r){return function(t){var n=r.container.getNamed(Ye.IPostProcessingPass,t);return n.setName(t),n}}),e}function lv(e){var r=new Jt.W2;return r.parent=e,r.bind(Ye.IStyleAttributeService).to(M0).inSingletonScope(),r.bind(Ye.IMultiPassRenderer).to(UA).inSingletonScope(),r.bind(Ye.IPostProcessor).to(zT).inSingletonScope(),r}var QT=null;function iN(e){return QT.indexOf(e)}var X1=vi.clamp,JT=2,aN=4,ew=64,oN=128,tw=256,rw=512,sN=8192,uN=16384,lN=32768,nw=null,$1=131072,cN=262144,iw=524288,fN=1048576,aw=2097152,hN=4194304,ow=8388608,sw=16777216,uw=null;function L0(e,r){return e=X1(Math.floor(e),0,255),r=X1(Math.floor(r),0,255),256*e+r}function pN(e){var r=e.color,t=e.radius,n=e.tileX,i=e.tileY,a=e.shape,s=e.opacity,l=e.stroke,c=e.strokeWidth,p=e.strokeOpacity,_=[],b=[],A=[],w=[L0(r[0],r[1]),L0(r[2],r[3])],I=[L0(l[0],l[1]),L0(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(P){var B=_slicedToArray(P,2),H=B[0],Q=B[1];_.push([].concat(w,[(H+1)*ow+(Q+1)*aw+getShapeIndex(a)*$1+t,(n+512)*iw+(i+512)*ew])),b.push([].concat(I,[c,p])),A.push([s,0,0,0])}),{packedBuffer:_,packedBuffer2:b,packedBuffer3:A}}function dN(e,r){if(e===0&&!r)return 0;if(e===1&&r)return 4294967295;var t=r?1:0,n=Math.floor(e*127);return n*uw+t*sw+n*$1+t*nw+n*rw+t*tw+n*JT+t}var gd={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Ts={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},Za=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),cv=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Un=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),lw=["mapload","mapchange","mapAfterFrameChange"],B0=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Mu=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),cw=function(){var e=(0,Nt.Z)(xe().mark(function r(t,n,i,a){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(c,p){n({x:t.x,y:t.y,z:t.z},function(_,b){if(_||b.length===0){p(_);return}b&&ai([{data:b,bands:[0]}],i,a,function(A,w){A?p(A):w&&c(w)})})}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),fw=function(){var e=(0,Nt.Z)(xe().mark(function r(t,n){return xe().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(s,l){n({x:t.x,y:t.y,z:t.z},function(c,p){if(c||!p){l(c);return}p instanceof ArrayBuffer?fa(p,function(_,b){_&&l(_),s(b)}):p instanceof HTMLImageElement?s(p):l(c)})}));case 1:case"end":return a.stop()}},r)}));return function(t,n){return e.apply(this,arguments)}}();function hw(e,r){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(t){return v(t,r)}):e.map(function(t){return{url:v(t.url,r),bands:t.bands||[0]}}):v(e,r)}function pw(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(r){return{url:r,bands:[0]}}):e}function Y1(e,r){e.xhrCancel=function(){r.map(function(t){t.abort()})}}var dw=function(){var e=(0,Nt.Z)(xe().mark(function r(t,n,i,a,s){var l,c,p,_,b,A;return xe().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(l=pw(n.url),!(l.length>1)){I.next=15;break}return I.next=4,vw(l,n);case 4:if(c=I.sent,p=c.rasterFiles,_=c.xhrList,b=c.errList,Y1(t,_),!(b.length>0)){I.next=12;break}return i(b,null),I.abrupt("return");case 12:ai(p,a,s,i),I.next=17;break;case 15:A=bo(n,function(P,B){if(P)i(P);else if(B){var H=[{data:B,bands:l[0].bands}];ai(H,a,s,i)}}),Y1(t,[A]);case 17:case"end":return I.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}();function vw(e,r){return Jg.apply(this,arguments)}function Jg(){return Jg=(0,Nt.Z)(xe().mark(function e(r,t){var n,i,a,s,l,c,p,_,b,A,w;return xe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:n=[],i=[],a=[],s=0;case 4:if(!(s<r.length)){P.next=20;break}return l=r[s],c=(0,k.Z)((0,k.Z)({},t),{},{url:l.url}),p=l.bands,P.next=10,mi((0,k.Z)((0,k.Z)({},c),{},{type:"arrayBuffer"}));case 10:_=P.sent,b=_.err,A=_.data,w=_.xhr,b&&a.push(b),i.push(w),n.push({data:A,bands:p});case 17:s++,P.next=4;break;case 20:return P.abrupt("return",{rasterFiles:n,xhrList:i,errList:a});case 21:case"end":return P.stop()}},e)})),Jg.apply(this,arguments)}var mw=function(){var e=(0,Nt.Z)(xe().mark(function r(t,n,i,a,s){var l;return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return l={url:hw(t,n)},p.abrupt("return",new Promise(function(_,b){dw(i,l,function(A,w){A?b(A):w&&_(w)},a,s)}));case 2:case"end":return p.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}(),q1=function(){var e=(0,Nt.Z)(xe().mark(function r(t,n,i,a){var s,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return l=Array.isArray(t)?t[0]:t,a.wmtsOptions?(c=(a==null?void 0:a.getURLFromTemplate)||d,s=c(l,(0,k.Z)((0,k.Z)({},n),a.wmtsOptions))):(p=(a==null?void 0:a.getURLFromTemplate)||v,s=p(l,n)),b.abrupt("return",new Promise(function(A,w){var I,P=Gs({url:s,type:(a==null||(I=a.requestParameters)===null||I===void 0?void 0:I.type)||"arrayBuffer"},function(B,H){B?w(B):H&&A(H)},a.transformResponse);i.xhrCancel=function(){return P.cancel()}}));case 3:case"end":return b.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),K1=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},gw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},vN=[Mu.ARRAYBUFFER,Mu.RGB];function _w(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function yw(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(_w(e))throw new Error("tile server url is error");var t=(r==null?void 0:r.dataType)||Mu.IMAGE;t===Mu.RGB&&(t=Mu.ARRAYBUFFER);var n=function(s,l){switch(t){case Mu.IMAGE:return q1(e,s,l,r);case Mu.CUSTOMIMAGE:case Mu.CUSTOMTERRAINRGB:return fw(l,r==null?void 0:r.getCustomData);case Mu.ARRAYBUFFER:return mw(e,s,l,(r==null?void 0:r.format)||K1,r==null?void 0:r.operation);case Mu.CUSTOMARRAYBUFFER:case Mu.CUSTOMRGB:return cw(l,r==null?void 0:r.getCustomData,(r==null?void 0:r.format)||K1,r==null?void 0:r.operation);default:return q1(e,s,l,r)}},i=(0,k.Z)((0,k.Z)((0,k.Z)({},gw),r),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var xw=["extent","min","max","width","height","format","operation"];function bw(e,r){var t=r.extent,n=r.min,i=r.max,a=r.width,s=r.height,l=r.format,c=r.operation,p=(0,yl.Z)(r,xw),_;if(l===void 0||kc(e))_=Array.from(e);else{var b=Array.isArray(e)?e:[e];_=pn(b,l,c)}var A={_id:1,dataArray:[(0,k.Z)((0,k.Z)({_id:1,data:_,width:a,height:s},p),{},{min:n,max:i,coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return A}var Ew={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Sw=function(){var e=(0,Nt.Z)(xe().mark(function r(t){return xe().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(a){var s=(0,re.Z)(t.bounds,4),l=s[0],c=s[1],p=s[2],_=s[3],b={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(l+p)/2,y:(c+_)/2},geometry:{type:"LineString",coordinates:[[p,_],[p,c],[l,c],[l,c]]}}]}}};a(b)}));case 1:case"end":return i.stop()}},r)}));return function(t){return e.apply(this,arguments)}}();function Aw(e,r){var t=function(a){return Sw(a)},n=(0,k.Z)((0,k.Z)((0,k.Z)({},Ew),r),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var Tw=Z(69848),Q1=Z.n(Tw);function J1(e,r){var t=r.radius,n=t===void 0?40:t,i=r.maxZoom,a=i===void 0?18:i,s=r.minZoom,l=s===void 0?0:s,c=r.zoom,p=c===void 0?2:c;if(e.pointIndex){var _=e.pointIndex.getClusters(e.extent,Math.floor(p));return e.dataArray=ww(_),e}var b=new(Q1())({radius:n,minZoom:l,maxZoom:a}),A={type:"FeatureCollection",features:[]};return A.features=e.dataArray.map(function(w){return{type:"Feature",geometry:{type:"Point",coordinates:w.coordinates},properties:(0,k.Z)({},w)}}),b.load(A.features),b}function ww(e){return e.map(function(r,t){return(0,k.Z)({coordinates:r.geometry.coordinates,_id:t+1},r.properties)})}function Cw(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r}function Rw(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r}function ex(e){if(e.length===0)return 0;for(var r=e[0],t=0,n,i=1;i<e.length;i++)n=r+e[i]*1,Math.abs(r)>=Math.abs(e[i])?t+=r-n+e[i]:t+=e[i]-n+r,r=n;return r+t*1}function Mw(e){if(e.length===0)throw new Error("mean requires at least one data point");return ex(e)/e.length}var Iw={min:Rw,max:Cw,mean:Mw,sum:ex};function Pw(e){var r=Ow();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kw=vi.cloneDeep,tx=vi.isFunction,Dw=vi.isString,Lw=vi.mergeWith;function Bw(e,r){if(Array.isArray(r))return r}var Fw=function(e){(0,Qe.Z)(t,e);var r=Pw(t);function t(n,i){var a;return(0,ge.Z)(this,t),a=r.call(this),(0,N.Z)((0,we.Z)(a),"type","source"),(0,N.Z)((0,we.Z)(a),"isTile",!1),(0,N.Z)((0,we.Z)(a),"inited",!1),(0,N.Z)((0,we.Z)(a),"hooks",{init:new $f}),(0,N.Z)((0,we.Z)(a),"parser",{type:"geojson"}),(0,N.Z)((0,we.Z)(a),"transforms",[]),(0,N.Z)((0,we.Z)(a),"cluster",!1),(0,N.Z)((0,we.Z)(a),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,N.Z)((0,we.Z)(a),"invalidExtent",!1),(0,N.Z)((0,we.Z)(a),"dataArrayChanged",!1),(0,N.Z)((0,we.Z)(a),"cfg",{autoRender:!0}),a.originData=n,a.initCfg(i),a.init().then(function(){a.inited=!0,a.emit("update",{type:"inited"})}),a}return(0,K.Z)(t,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var a=this,s=this.clusterOptions,l=s.method,c=l===void 0?"sum":l,p=s.field,_=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,_.forEach(function(b){b.id||(b.properties.point_count=1)}),(p||tx(c))&&(_=_.map(function(b){var A=b.id;if(A){var w=a.clusterIndex.getLeaves(A,Infinity),I=w.map(function(H){return H.properties}),P;if(Dw(c)&&p){var B=Zf(I,p);P=Iw[c](B)}tx(c)&&(P=c(I)),b.properties.stat=P}else b.properties.point_count=1;return b})),this.data=ae("geojson")({type:"FeatureCollection",features:_}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var a=this.parser,s=a.type,l=s===void 0?"geojson":s,c=a.geometry;if(l==="geojson"&&!this.cluster){var p=i<this.originData.features.length?this.originData.features[i]:"null",_=kw(p);if(_!=null&&_.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var b=this.data.dataArray.find(function(A){return A._id===i});_.properties=b}return _}else return l==="json"&&c?this.data.dataArray.find(function(A){return A._id===i}):i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,a){this.data.dataArray=this.data.dataArray.map(function(s){return s._id===i?(0,k.Z)((0,k.Z)({},s),a):s}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(i,a){var s=this.data.dataArray.find(function(l){return l[i]===a});return s==null?void 0:s._id}},{key:"setData",value:function(i,a){var s=this;this.originData=i,this.dataArrayChanged=!1,this.initCfg(a),this.init().then(function(){s.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var i;(i=this.tileset)===null||i===void 0||i.reloadAll()}},{key:"reloadTilebyId",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(i,a,s)}},{key:"reloadTileByLnglat",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(i,a,s)}},{key:"getTileExtent",value:function(i,a){var s;return(s=this.tileset)===null||s===void 0?void 0:s.getTileExtent(i,a)}},{key:"getTileByZXY",value:function(i,a,s){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(i,a,s)}},{key:"reloadTileByExtent",value:function(i,a){var s;(s=this.tileset)===null||s===void 0||s.reloadTileByExtent(i,a)}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"processData",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s=this;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",new Promise(function(p,_){try{s.excuteParser(),s.initCluster(),s.executeTrans(),p({})}catch(b){_(b)}}));case 1:case"end":return c.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"initCfg",value:function(i){this.cfg=Lw(this.cfg,i,Bw);var a=this.cfg;a&&(a.parser&&(this.parser=a.parser),a.transforms&&(this.transforms=a.transforms),this.cluster=a.cluster||!1,a.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,k.Z)((0,k.Z)({},this.clusterOptions),a.clusterOptions)))}},{key:"init",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"excuteParser",value:function(){var i=this.parser,a=i.type||"geojson",s=ae(a);this.data=s(this.originData,i),this.tileset=this.initTileset(),!i.cancelExtent&&(this.extent=Zu(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(!!i){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(i),this.tileset;var a=new Ff((0,k.Z)({},i));return a}}},{key:"executeTrans",value:function(){var i=this,a=this.transforms;a.forEach(function(s){var l=s.type,c=ie(l)(i.data,s);Object.assign(i.data,c)})}},{key:"initCluster",value:function(){if(!!this.cluster){var i=this.clusterOptions||{};this.clusterIndex=J1(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var a=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(a=su(Yl(this.extent),i)),a[0].concat(a[1])}}]),t}(Fa.EventEmitter);function Nw(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function rx(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Uw(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Uw(e,r){if(!!e){if(typeof e=="string")return nx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return nx(e,r)}}function nx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var e_=6378e3;function zw(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=i/(2*Math.PI*e_)*(256<<20)/2,s=Zw(t,i),l=s.gridHash,c=s.gridOffset,p=Ww(l,c,r);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:p}}function Zw(e,r){var t=Infinity,n=-Infinity,i,a=rx(e),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;i=l.coordinates[1],Number.isFinite(i)&&(t=i<t?i:t,n=i>n?i:n)}}catch(ue){a.e(ue)}finally{a.f()}var c=(t+n)/2,p=Vw(r,c);if(p.xOffset<=0||p.yOffset<=0)return{gridHash:{},gridOffset:p};var _={},b=rx(e),A;try{for(b.s();!(A=b.n()).done;){var w=A.value,I=w.coordinates[1],P=w.coordinates[0];if(Number.isFinite(I)&&Number.isFinite(P)){var B=Math.floor((I+90)/p.yOffset),H=Math.floor((P+180)/p.xOffset),Q="".concat(B,"-").concat(H);_[Q]=_[Q]||{count:0,points:[]},_[Q].count+=1,_[Q].points.push(w)}}}catch(ue){b.e(ue)}finally{b.f()}return{gridHash:_,gridOffset:p}}function Vw(e,r){var t=jw(e),n=Hw(r,e);return{yOffset:t,xOffset:n}}function jw(e){return e/e_*(180/Math.PI)}function Hw(e,r){return r/e_*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Ww(e,r,t){return Object.keys(e).reduce(function(n,i,a){var s=i.split("-"),l=parseInt(s[0],10),c=parseInt(s[1],10),p={};if(t.field&&t.method){var _=ef(e[i].points,t.field);p[t.method]=Tc[t.method](_)}return Object.assign(p,{_id:a,coordinates:La([-180+r.xOffset*(c+.5),-90+r.yOffset*(l+.5)]),rawData:e[i].points,count:e[i].count}),n.push(p),n},[])}var fv=Math.PI/3,Gw=[0,fv,2*fv,3*fv,4*fv,5*fv];function Xw(e){return e[0]}function $w(e){return e[1]}function Yw(){var e=0,r=0,t=1,n=1,i=Xw,a=$w,s,l,c;function p(b){var A={},w=[],I,P=b.length;for(I=0;I<P;++I)if(!(isNaN(H=+i.call(null,B=b[I],I,b))||isNaN(Q=+a.call(null,B,I,b)))){var B,H,Q,ue=Math.round(Q=Q/c),Ee=Math.round(H=H/l-(ue&1)/2),Le=Q-ue;if(Math.abs(Le)*3>1){var Ze=H-Ee,tt=Ee+(H<Ee?-1:1)/2,ft=ue+(Q<ue?-1:1),wt=H-tt,fr=Q-ft;Ze*Ze+Le*Le>wt*wt+fr*fr&&(Ee=tt+(ue&1?1:-1)/2,ue=ft)}var hr=Ee+"-"+ue,Mr=A[hr];Mr?Mr.push(B):(w.push(Mr=A[hr]=[B]),Mr.x=(Ee+(ue&1)/2)*l,Mr.y=ue*c)}return w}function _(b){var A=0,w=0;return Gw.map(function(I){var P=Math.sin(I)*b,B=-Math.cos(I)*b,H=P-A,Q=B-w;return A=P,w=B,[H,Q]})}return p.hexagon=function(b){return"m"+_(b==null?s:+b).join("l")+"z"},p.centers=function(){for(var b=[],A=Math.round(r/c),w=Math.round(e/l),I=A*c;I<n+s;I+=c,++A)for(var P=w*l+(A&1)*l/2;P<t+l/2;P+=l)b.push([P,I]);return b},p.mesh=function(){var b=_(s).slice(0,4).join("l");return p.centers().map(function(A){return"M"+A+"m"+b}).join("")},p.x=function(b){return arguments.length?(i=b,p):i},p.y=function(b){return arguments.length?(a=b,p):a},p.radius=function(b){return arguments.length?(s=+b,l=s*2*Math.sin(fv),c=s*1.5,p):s},p.size=function(b){return arguments.length?(e=r=0,t=+b[0],n=+b[1],p):[t-e,n-r]},p.extent=function(b){return arguments.length?(e=+b[0][0],r=+b[0][1],t=+b[1][0],n=+b[1][1],p):[[e,r],[t,n]]},p.radius(1)}var qw=6378e3;function Kw(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=r.method,s=a===void 0?"sum":a,l=i/(2*Math.PI*qw)*(256<<20)/2,c=t.map(function(A){var w=La(A.coordinates),I=(0,re.Z)(w,2),P=I[0],B=I[1];return(0,k.Z)((0,k.Z)({},A),{},{coordinates:[P,B]})}),p=Yw().radius(l).x(function(A){return A.coordinates[0]}).y(function(A){return A.coordinates[1]}),_=p(c),b={dataArray:_.map(function(A,w){var I;if(r.field&&s){var P=ef(A,r.field);A[s]=Tc[s](P)}return I={},(0,N.Z)(I,r.method,A[s]),(0,N.Z)(I,"count",A.length),(0,N.Z)(I,"rawData",A),(0,N.Z)(I,"coordinates",[A.x,A.y]),(0,N.Z)(I,"_id",w),I}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return b}function Qw(e,r){var t=r.sourceField,n=r.targetField,i=r.data,a={};return i.forEach(function(s){a[s[t]]=s}),e.dataArray=e.dataArray.map(function(s){var l=s[n];return(0,k.Z)((0,k.Z)({},s),a[l])}),e}function Jw(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}Be("rasterTile",yw),Be("mvt",Or),Be("geojsonvt",Ke),Be("testTile",Aw),Be("geojson",Wp),Be("jsonTile",zt),Be("image",Yt),Be("csv",nc),Be("json",jp),Be("raster",Lr),Be("rasterRgb",bw),Ve("cluster",J1),Ve("filter",Nw),Ve("join",Qw),Ve("map",Jw),Ve("grid",zw),Ve("hexagon",Kw);var ix=Fw;function e3(e){var r=t3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function t3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ax=function(e){(0,Qe.Z)(t,e);var r=e3(t);function t(n){var i;return(0,ge.Z)(this,t),i=r.call(this),(0,N.Z)((0,we.Z)(i),"added",!1),(0,N.Z)((0,we.Z)(i),"eventHandle",function(a){i.polyfillEvent(a),i.emit(a.type,{target:a,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=(0,k.Z)((0,k.Z)({},i.getDefault()),n),Af(["update","onMove","onMapClick"],(0,we.Z)(i)),i.init(),i}return(0,K.Z)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Ca.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(Ye.IMapService),this.sceneSerive=i.get(Ye.ISceneService);var a=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&Ys(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var a=this;if(!this.added)return this.once("added",function(){a.setElement(i)}),this;var s=this.markerOption.element;return s&&Ys(s),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var a=this.popup;return a?(a.isOpen()||a.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var a=this.popup;return a&&a.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,s=i.anchor;this.updatePosition(),_u(a,"".concat(Ju[s]))}}},{key:"onMapClick",value:function(i){var a=this.markerOption.element;this.popup&&a&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var i=this.mapsService.getContainer();return{containerHeight:(i==null?void 0:i.scrollHeight)||0,containerWidth:(i==null?void 0:i.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,s=i.offsets,l=this.lngLat,c=l.lng,p=l.lat,_=this.mapsService.lngLatToContainer([c,p]);if(a){a.style.display="block",a.style.whiteSpace="nowrap";var b=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=b.containerHeight,w=b.containerWidth,I=b.bounds;if(!I)return;if(Math.abs(I[0][0])>180||Math.abs(I[1][0])>180){if(_.x>w){var P=this.mapsService.lngLatToContainer([c-360,p]);_.x=P.x}if(_.x<0){var B=this.mapsService.lngLatToContainer([c+360,p]);_.x=B.x}}(_.x>w||_.x<0||_.y>A||_.y<0)&&(a.style.display="none"),a.style.left=_.x+s[0]+"px",a.style.top=_.y-s[1]+"px"}}}},{key:"init",value:function(){var i=this,a=this.markerOption.element,s=this.markerOption,l=s.color,c=s.anchor;if(!a){this.defaultMarker=!0,a=In("div"),this.markerOption.element=a;var p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height","48px"),p.setAttributeNS(null,"width","48px"),p.setAttributeNS(null,"viewBox","0 0 1024 1024");var _=document.createElementNS("http://www.w3.org/2000/svg","path");_.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),_.setAttributeNS(null,"fill",l),p.appendChild(_),a.appendChild(p)}Es(a,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(b){var A,w,I=((A=i.markerOption)===null||A===void 0?void 0:A.style)&&((w=i.markerOption)===null||w===void 0?void 0:w.style[b]);a&&(a.style[b]=I)}),iu(a,c,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("click",this.onMapClick),i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle),i.addEventListener("touchstart",this.eventHandle),i.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("click",this.onMapClick),i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle),i.removeEventListener("touchstart",this.eventHandle),i.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(i){!this.mapsService||this.mapsService.version!=="GAODE2.x"||Gl()||(i.type==="touchstart"&&(this.touchStartTime=Date.now()),i.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:i,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(i){return null}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),t}(Fa.EventEmitter);function r3(e){var r=n3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function n3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i3=vi.merge,mN=function(e){(0,Qe.Z)(t,e);var r=r3(t);function t(n){var i,a;return(0,ge.Z)(this,t),a=r.call(this),(0,N.Z)((0,we.Z)(a),"markers",[]),(0,N.Z)((0,we.Z)(a),"points",[]),(0,N.Z)((0,we.Z)(a),"clusterMarkers",[]),a.markerLayerOption=i3(a.getDefault(),n),Af(["update"],(0,we.Z)(a)),a.zoom=((i=a.markerLayerOption.clusterOption)===null||i===void 0?void 0:i.zoom)||-99,a}return(0,K.Z)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(i){return this.scene=i,this.mapsService=i.get(Ye.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var i=this.mapsService.getContainer();this.containerSize={containerWidth:(i==null?void 0:i.scrollWidth)||0,containerHeight:(i==null?void 0:i.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(i){var a=this.markerLayerOption.cluster;if(i.getMarkerLayerContainerSize=this.getContainerSize.bind(this),a&&(this.addPoint(i,this.markers.length),this.mapsService)){var s=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=su(l,.5),this.zoom=Math.floor(s),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(i)}},{key:"removeMarker",value:function(i){this.markers.indexOf(i);var a=this.markers.indexOf(i);a>-1&&(this.markers.splice(a,1),this.markerLayerOption.cluster&&(this.removePoint(a),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom)))}},{key:"hide",value:function(){this.markers.map(function(i){i.getElement().style.opacity="0"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(i){i.getElement().style.opacity="1"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var i=this.markerLayerOption.cluster;return i?this.clusterMarkers:this.markers}},{key:"getOriginMarkers",value:function(){return this.markers}},{key:"addMarkers",value:function(){var i=this;this.getMarkers().forEach(function(a){a.addTo(i.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(i){i.remove()}),this.clusterMarkers.forEach(function(i){i.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(i,a){var s=i.getLnglat(),l=s.lng,c=s.lat,p={geometry:{type:"Point",coordinates:[l,c]},properties:(0,k.Z)((0,k.Z)({},i.getExtData()),{},{marker_id:a})};this.points.push(p),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"removePoint",value:function(i){var a=this.points.findIndex(function(s){return s.properties.marker_id===i});a>-1&&this.points.splice(a,1),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var i=this.markerLayerOption.clusterOption,a=i.radius,s=i.minZoom,l=s===void 0?0:s,c=i.maxZoom;this.clusterIndex=new(Q1())({radius:a,minZoom:l,maxZoom:c}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(i,a){var s=this,l=i[0].concat(i[1]),c=this.clusterIndex.getClusters(l,a);this.clusterMarkers.forEach(function(p){p.remove()}),this.clusterMarkers=[],c.forEach(function(p){var _,b=s.markerLayerOption.clusterOption,A=b.field,w=b.method;if((_=p.properties)!==null&&_!==void 0&&_.cluster_id){var I,P=s.getLeaves((I=p.properties)===null||I===void 0?void 0:I.cluster_id);if(p.properties.clusterData=P,A&&w){var B=P==null?void 0:P.map(function(Le){var Ze=(0,N.Z)({},A,Le.properties[A]);return Ze}),H=ef(B,A),Q=ks(w,H),ue="point_"+w;p.properties[ue]=Q.toFixed(2)}}var Ee=s.clusterMarker(p);s.clusterMarkers.push(Ee),Ee.addTo(s.scene)})}},{key:"getLeaves",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return i?this.clusterIndex.getLeaves(i,a,s):null}},{key:"clusterMarker",value:function(i){var a=this.markerLayerOption.clusterOption,s=a,l=s.element,c=l===void 0?this.generateElement.bind(this):l,p=new ax({element:c(i)}).setLnglat({lng:i.geometry.coordinates[0],lat:i.geometry.coordinates[1]});return p}},{key:"normalMarker",value:function(i){var a=i.properties.marker_id;return this.markers[a]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var i=this.mapsService.getZoom(),a=this.mapsService.getBounds();(!this.bbox||Math.abs(i-this.zoom)>=1||!la(this.bbox,a))&&(this.bbox=su(a,.5),this.zoom=Math.floor(i),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(i){var a=In("div","l7-marker-cluster"),s=In("div","",a),l=In("span","",s),c=this.markerLayerOption.clusterOption,p=c.field,_=c.method;i.properties.point_count=i.properties.point_count||1;var b=p&&_?i.properties["point_"+_]||i.properties[p]:i.properties.point_count;return l.textContent=b,a}}]),t}(Fa.EventEmitter),gN=Z(4157);function a3(e){var r=o3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function o3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _d=function(e){(0,Qe.Z)(t,e);var r=a3(t);function t(n){var i;return(0,ge.Z)(this,t),i=r.call(this),t.controlCount++,i.controlOption=(0,k.Z)((0,k.Z)({},i.getDefault(n)),n||{}),i}return(0,K.Z)(t,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(i){var a=this.getDefault(i);Object.entries(i).forEach(function(s){var l=(0,re.Z)(s,2),c=l[0],p=l[1];p===void 0&&(i[c]=a[c])}),"position"in i&&this.setPosition(i.position),"className"in i&&this.setClassName(i.className),"style"in i&&this.setStyle(i.style),this.controlOption=(0,k.Z)((0,k.Z)({},this.controlOption),i)}},{key:"addTo",value:function(i){this.mapsService=i.get(Ye.IMapService),this.renderService=i.get(Ye.IRendererService),this.layerService=i.get(Ye.ILayerService),this.controlService=i.get(Ye.IControlService),this.configService=i.get(Ye.IGlobalConfigService),this.scene=i.get(Ye.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd(),Es(this.container,"l7-control");var a=this.controlOption,s=a.className,l=a.style;return s&&this.setClassName(s),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Ys(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return In("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var i=this.container;Uu(i,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i=this.container;Es(i,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(i){return{position:x.TOPRIGHT,name:"".concat(t.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var a=this.mapsService.getContainer();a!==null&&a.focus()}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:x.TOPLEFT,a=this.controlService;return a&&a.removeControl(this),this.controlOption.position=i,a&&a.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(i){var a=this.container,s=this.controlOption.className;s&&Uu(a,s),i&&Es(a,i)}},{key:"setStyle",value:function(i){var a=this.container;i?a.setAttribute("style",i):a.removeAttribute("style")}},{key:"insertContainer",value:function(){var i=this.controlOption.position,a=this.container;if(i instanceof Element)i.appendChild(a);else{var s=this.controlService.controlCorners[i];["bottomleft","bottomright","righttop","rightbottom"].includes(i)?s.insertBefore(a,s.firstChild):s.appendChild(a)}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),t}(Ds());(0,N.Z)(_d,"controlCount",0);function s3(e){var r=u3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function u3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F0=function(e){(0,Qe.Z)(t,e);var r=s3(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"isDisable",!1),n}return(0,K.Z)(t,[{key:"setIsDisable",value:function(i){if(this.isDisable=i,i){var a;(a=this.button)===null||a===void 0||a.setAttribute("disabled","true")}else{var s;(s=this.button)===null||s===void 0||s.removeAttribute("disabled")}}},{key:"createButton",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return In("button","l7-button-control ".concat(i))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var i=this.controlOption,a=i.title,s=i.btnText,l=i.btnIcon;return this.setBtnTitle(a),this.setBtnText(s),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(i){var a=i.title,s=i.btnText,l=i.btnIcon;this.checkUpdateOption(i,["title"])&&this.setBtnTitle(a),this.checkUpdateOption(i,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(i,["btnText"])&&this.setBtnText(s),(0,va.Z)((0,pe.Z)(t.prototype),"setOptions",this).call(this,i)}},{key:"setBtnTitle",value:function(i){var a;(a=this.button)===null||a===void 0||a.setAttribute("title",i!=null?i:"")}},{key:"setBtnIcon",value:function(i){if(this.buttonIcon&&Ys(this.buttonIcon),i){var a,s=(a=this.button)===null||a===void 0?void 0:a.firstChild;if(s){var l;(l=this.button)===null||l===void 0||l.insertBefore(i,s)}else{var c;(c=this.button)===null||c===void 0||c.appendChild(i)}this.buttonIcon=i}}},{key:"setBtnText",value:function(i){if(!!this.button)if(Uu(this.button,"l7-button-control--row"),Uu(this.button,"l7-button-control--column"),i){var a=this.buttonText;if(!a){var s;a=In("div","l7-button-control__text"),(s=this.button)===null||s===void 0||s.appendChild(a),this.buttonText=a}a.innerText=i,Es(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!i&&this.buttonText&&(Ys(this.buttonText),this.buttonText=void 0)}}]),t}(_d);function l3(e){var r=c3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function c3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ox=function(e){(0,Qe.Z)(t,e);var r=l3(t);function t(n,i){var a;return(0,ge.Z)(this,t),a=r.call(this),(0,N.Z)((0,we.Z)(a),"isShow",!1),(0,N.Z)((0,we.Z)(a),"timeout",null),(0,N.Z)((0,we.Z)(a),"show",function(){return a.isShow||!a.contentDOM.innerHTML||(a.resetPopperPosition(),Uu(a.popperDOM,"l7-popper-hide"),a.isShow=!0,a.option.unique&&t.conflictPopperList.forEach(function(s){s!==(0,we.Z)(a)&&s.isShow&&s.hide()}),a.emit("show"),window.addEventListener("pointerdown",a.onPopperUnClick)),(0,we.Z)(a)}),(0,N.Z)((0,we.Z)(a),"hide",function(){return a.isShow&&(Es(a.popperDOM,"l7-popper-hide"),a.isShow=!1,a.emit("hide"),window.removeEventListener("pointerdown",a.onPopperUnClick)),(0,we.Z)(a)}),(0,N.Z)((0,we.Z)(a),"setHideTimeout",function(){a.timeout||(a.timeout=window.setTimeout(function(){!a.isShow||(a.hide(),a.timeout=null)},300))}),(0,N.Z)((0,we.Z)(a),"clearHideTimeout",function(){a.timeout&&(window.clearTimeout(a.timeout),a.timeout=null)}),(0,N.Z)((0,we.Z)(a),"onBtnClick",function(){a.isShow?a.hide():a.show()}),(0,N.Z)((0,we.Z)(a),"onPopperUnClick",function(s){Wc(s.target,[".l7-button-control",".l7-popper-content"])||a.hide()}),(0,N.Z)((0,we.Z)(a),"onBtnMouseLeave",function(){a.setHideTimeout()}),(0,N.Z)((0,we.Z)(a),"onBtnMouseMove",function(){a.clearHideTimeout(),!a.isShow&&a.show()}),a.button=n,a.option=i,a.init(),i.unique&&t.conflictPopperList.push((0,we.Z)(a)),a}return(0,K.Z)(t,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(i){typeof i=="string"?this.contentDOM.innerHTML=i:i instanceof HTMLElement&&(Pl(this.contentDOM),this.contentDOM.appendChild(i)),this.content=i}},{key:"init",value:function(){var i=this.option.trigger;this.popperDOM=this.createPopper(),i==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Ys(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var i={},a=this.option,s=a.container,l=a.offset,c=l===void 0?[0,0]:l,p=a.placement,_=(0,re.Z)(c,2),b=_[0],A=_[1],w=this.button.getBoundingClientRect(),I=s.getBoundingClientRect(),P=Hc(w,I),B=P.left,H=P.right,Q=P.top,ue=P.bottom,Ee=!1,Le=!1;/^(left|right)/.test(p)?(p.includes("left")?i.right="".concat(w.width+H,"px"):p.includes("right")&&(i.left="".concat(w.width+B,"px")),p.includes("start")?i.top="".concat(Q,"px"):p.includes("end")?i.bottom="".concat(ue,"px"):(i.top="".concat(Q+w.height/2,"px"),Le=!0,i.transform="translate(".concat(b,"px, calc(").concat(A,"px - 50%))"))):/^(top|bottom)/.test(p)&&(p.includes("top")?i.bottom="".concat(w.height+ue,"px"):p.includes("bottom")&&(i.top="".concat(w.height+Q,"px")),p.includes("start")?i.left="".concat(B,"px"):p.includes("end")?i.right="".concat(H,"px"):(i.left="".concat(B+w.width/2,"px"),Ee=!0,i.transform="translate(calc(".concat(b,"px - 50%), ").concat(A,"px)"))),i.transform="translate(calc(".concat(b,"px - ").concat(Ee?"50%":"0%","), calc(").concat(A,"px - ").concat(Le?"50%":"0%",")");var Ze=p.split("-");Ze.length&&Es(this.popperDOM,Ze.map(function(tt){return"l7-popper-".concat(tt)}).join(" ")),_c(this.popperDOM,uh(i))}},{key:"createPopper",value:function(){var i=this.option,a=i.container,s=i.className,l=s===void 0?"":s,c=i.content,p=In("div","l7-popper l7-popper-hide ".concat(l)),_=In("div","l7-popper-content"),b=In("div","l7-popper-arrow");return p.appendChild(_),p.appendChild(b),a.appendChild(p),this.popperDOM=p,this.contentDOM=_,c&&this.setContent(c),p}}]),t}(Fa.EventEmitter);(0,N.Z)(ox,"conflictPopperList",[]);function f3(e){var r=h3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function h3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p3={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},v3=function(e){(0,Qe.Z)(t,e);var r=f3(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,va.Z)((0,pe.Z)(t.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(i){var a,s=(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this,i),l=(a=i==null?void 0:i.position)!==null&&a!==void 0?a:s.position;return(0,k.Z)((0,k.Z)({},(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this,i)),{},{popperPlacement:l instanceof Element?"bottom":p3[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var i=(0,va.Z)((0,pe.Z)(t.prototype),"onAdd",this).call(this);return this.initPopper(),i}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var i=this,a=this.controlOption,s=a.popperClassName,l=a.popperPlacement,c=a.popperTrigger,p=this.mapsService.getMapContainer();return this.popper=new ox(this.button,{className:s,placement:l,trigger:c,container:p,unique:!0}),this.popper.on("show",function(){i.emit("popperShow",i)}).on("hide",function(){i.emit("popperHide",i)}),this.popper}},{key:"setOptions",value:function(i){if((0,va.Z)((0,pe.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["popperPlacement","popperTrigger","popperClassName"])){var a=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(a)}}}]),t}(F0);function m3(e){var r=g3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function g3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tp=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(Tp||{}),sx=function(e){(0,Qe.Z)(t,e);var r=m3(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"selectValue",[]),(0,N.Z)((0,we.Z)(n),"createNormalOption",function(l){var c=n.selectValue.includes(l.value),p=In("div","l7-select-control-item ".concat(c?Tp.ActiveOptionClassName:""));n.getIsMultiple()&&p.appendChild(n.createCheckbox(c)),l.icon&&p.appendChild(l.icon);var _=In("span");return _.innerText=l.text,p.appendChild(_),p}),(0,N.Z)((0,we.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var c=n.selectValue.findIndex(function(p){return p===l.value});c>-1?n.selectValue.splice(c,1):n.selectValue=[].concat((0,Gt.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,K.Z)(t,[{key:"setOptions",value:function(i){(0,va.Z)((0,pe.Z)(t.prototype),"setOptions",this).call(this,i);var a=i.options;a&&this.popper.setContent(this.getPopperContent(a))}},{key:"onAdd",value:function(){var i=(0,va.Z)((0,pe.Z)(t.prototype),"onAdd",this).call(this),a=this.controlOption.defaultValue;return a&&(this.selectValue=this.transSelectValue(a)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),i}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(i){var a=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(i);this.optionDOMList.forEach(function(c){var p=c.getAttribute(Tp.OptionValueAttrKey),_=a.getIsMultiple()?c.querySelector("input[type=checkbox]"):void 0;l.includes(p)?(Es(c,Tp.ActiveOptionClassName),_&&ua(_,!0)):(Uu(c,Tp.ActiveOptionClassName),_&&ua(_,!1))}),this.selectValue=l,s&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(i){var a=this,s=this.isImageOptions(),l=In("div",s?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Es(l,"l7-select-control--multiple");var c=i.map(function(p,_){var b=s?a.createImageOption(p):a.createNormalOption(p);return b.setAttribute(Tp.OptionValueAttrKey,p.value),b.setAttribute(Tp.OptionIndexAttrKey,window.String(_)),b.addEventListener("click",a.onItemClick.bind(a,p)),b});return l.append.apply(l,(0,Gt.Z)(c)),this.optionDOMList=c,l}},{key:"createImageOption",value:function(i){var a=this.selectValue.includes(i.value),s=In("div","l7-select-control-item ".concat(a?Tp.ActiveOptionClassName:"")),l=In("img");l.setAttribute("src",i.img),$h(l),s.appendChild(l);var c=In("div","l7-select-control-item-row");this.getIsMultiple()&&s.appendChild(this.createCheckbox(a));var p=In("span");return p.innerText=i.text,c.appendChild(p),s.appendChild(c),s}},{key:"createCheckbox",value:function(i){var a=In("input");return a.setAttribute("type","checkbox"),i&&ua(a,!0),a}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(i){return i.img})}},{key:"transSelectValue",value:function(i){return Array.isArray(i)?i:[i]}}]),t}(v3),Bh=function(r){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(r)),t.appendChild(n),t};function _3(e){var r=y3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function y3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x3=function(e){(0,Qe.Z)(t,e);var r=_3(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"onClick",(0,Nt.Z)(xe().mark(function l(){var c;return xe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(c=n.controlOption.onExport,_.t0=c==null,_.t0){_.next=8;break}return _.t1=c,_.next=6,n.getImage();case 6:_.t2=_.sent,(0,_.t1)(_.t2);case 8:case"end":return _.stop()}},l)}))),(0,N.Z)((0,we.Z)(n),"mergeImage",(0,Nt.Z)(xe().mark(function l(){var c,p,_,b,A,w,I,P,B,H,Q,ue,Ee,Le,Ze=arguments;return xe().wrap(function(ft){for(;;)switch(ft.prev=ft.next){case 0:for(_=n.controlOption.imageType,b=(c=(p=n.mapsService.getContainer())===null||p===void 0?void 0:p.getBoundingClientRect())!==null&&c!==void 0?c:{},A=b.width,w=A===void 0?0:A,I=b.height,P=I===void 0?0:I,B=document.createElement("canvas"),B.width=w,B.height=P,H=B.getContext("2d"),Q=Ze.length,ue=new Array(Q),Ee=0;Ee<Q;Ee++)ue[Ee]=Ze[Ee];return ft.next=9,Promise.all(ue.map(function(wt){return new Promise(function(fr){var hr=new Image;hr.onload=function(){fr(hr)},hr.src=wt})}));case 9:return Le=ft.sent,Le.forEach(function(wt){H==null||H.drawImage(wt,0,0,w,P)}),ft.abrupt("return",B.toDataURL("image/".concat(_)));case 12:case"end":return ft.stop()}},l)}))),n}return(0,K.Z)(t,[{key:"onAdd",value:function(){var i=(0,va.Z)((0,pe.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}},{key:"getDefault",value:function(i){return(0,k.Z)((0,k.Z)({},(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Bh("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l;return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.mapsService.exportMap("png");case 2:return s=p.sent,p.next=5,this.scene.exportPng("png");case 5:return l=p.sent,p.abrupt("return",this.mergeImage.apply(this,(0,Gt.Z)([s,l].filter(function(_){return _}))));case 7:case"end":return p.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(F0);function b3(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=E3(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function E3(e,r){if(!!e){if(typeof e=="string")return ux(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ux(e,r)}}function ux(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var lx=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Fh=function(){if(typeof document=="undefined")return!1;for(var e=lx[0],r={},t=0,n=lx;t<n.length;t++){var i=n[t],a=i==null?void 0:i[1];if(a in document){var s=b3(i.entries()),l;try{for(s.s();!(l=s.n()).done;){var c=(0,re.Z)(l.value,2),p=c[0],_=c[1];r[e[p]]=_}}catch(b){s.e(b)}finally{s.f()}return r}}return!1}(),cx={change:Fh.fullscreenchange,error:Fh.fullscreenerror},fc={request:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,i){var a=function l(){fc.off("change",l),n()};fc.on("change",a);var s=r[Fh.requestFullscreen](t);s instanceof Promise&&s.then(a).catch(i)})},exit:function(){return new Promise(function(r,t){if(!fc.isFullscreen){r();return}var n=function a(){fc.off("change",a),r()};fc.on("change",n);var i=document[Fh.exitFullscreen]();i instanceof Promise&&i.then(n).catch(t)})},toggle:function(r,t){return fc.isFullscreen?fc.exit():fc.request(r,t)},onchange:function(r){fc.on("change",r)},onerror:function(r){fc.on("error",r)},on:function(r,t){var n=cx[r];n&&document.addEventListener(n,t,!1)},off:function(r,t){var n=cx[r];n&&document.removeEventListener(n,t,!1)},raw:Fh};Object.defineProperties(fc,{isFullscreen:{get:function(){return Boolean(document[Fh.fullscreenElement])}},element:{enumerable:!0,get:function(){var r;return(r=document[Fh.fullscreenElement])!==null&&r!==void 0?r:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[Fh.fullscreenEnabled])}}}),Fh||(fc={isEnabled:!1});var t_=fc;function S3(e){var r=A3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function A3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T3=function(e){(0,Qe.Z)(t,e);var r=S3(t);function t(n){var i;return(0,ge.Z)(this,t),i=r.call(this,n),(0,N.Z)((0,we.Z)(i),"isFullscreen",!1),(0,N.Z)((0,we.Z)(i),"toggleFullscreen",(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!t_.isEnabled){l.next=3;break}return l.next=3,t_.toggle(i.mapContainer);case 3:case"end":return l.stop()}},a)}))),(0,N.Z)((0,we.Z)(i),"onClick",function(){i.toggleFullscreen()}),(0,N.Z)((0,we.Z)(i),"onFullscreenChange",function(){i.isFullscreen=!!document.fullscreenElement;var a=i.controlOption,s=a.btnText,l=a.btnIcon,c=a.title,p=a.exitBtnText,_=a.exitBtnIcon,b=a.exitTitle;i.isFullscreen?(i.setBtnTitle(b),i.setBtnText(p),i.setBtnIcon(_)):(i.setBtnTitle(c),i.setBtnText(s),i.setBtnIcon(l)),i.emit("fullscreenChange",i.isFullscreen)}),t_.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),i}return(0,K.Z)(t,[{key:"setOptions",value:function(i){var a=i.exitBtnText,s=i.exitBtnIcon,l=i.exitTitle;this.isFullscreen&&(this.checkUpdateOption(i,["exitBtnIcon"])&&this.setBtnIcon(s),this.checkUpdateOption(i,["exitBtnText"])&&this.setBtnText(a),this.checkUpdateOption(i,["exitTitle"])&&this.setBtnTitle(l)),(0,va.Z)((0,pe.Z)(t.prototype),"setOptions",this).call(this,i)}},{key:"onAdd",value:function(){var i=(0,va.Z)((0,pe.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),this.mapContainer=Nu(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),i}},{key:"onRemove",value:function(){(0,va.Z)((0,pe.Z)(t.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(i){return(0,k.Z)((0,k.Z)({},(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5168\u5C4F",btnIcon:Bh("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Bh("l7-icon-exit-fullscreen")})}}]),t}(F0);function w3(e){var r=C3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function C3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R3=function(e){(0,Qe.Z)(t,e);var r=w3(t);function t(n){var i;return(0,ge.Z)(this,t),i=r.call(this,n),(0,N.Z)((0,we.Z)(i),"getGeoLocation",function(){return new Promise(function(a,s){window.navigator.geolocation.getCurrentPosition(function(l){var c=l.coords,p=c!=null?c:{},_=p.longitude,b=p.latitude;!isNaN(_)&&!isNaN(b)?a([_,b]):s()},function(l){s(l)})})}),(0,N.Z)((0,we.Z)(i),"onClick",(0,Nt.Z)(xe().mark(function a(){var s,l,c;return xe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(window.navigator.geolocation){_.next=2;break}return _.abrupt("return");case 2:return s=i.controlOption.transform,_.next=5,i.getGeoLocation();case 5:if(l=_.sent,c=i.mapsService.getZoom(),_.t0=i.mapsService,_.t1=c>15?c:15,!s){_.next=15;break}return _.next=12,s(l);case 12:_.t2=_.sent,_.next=16;break;case 15:_.t2=l;case 16:_.t3=_.t2,_.t0.setZoomAndCenter.call(_.t0,_.t1,_.t3);case 18:case"end":return _.stop()}},a)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),i}return(0,K.Z)(t,[{key:"getDefault",value:function(i){return(0,k.Z)((0,k.Z)({},(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5B9A\u4F4D",btnIcon:Bh("l7-icon-reposition")})}},{key:"onAdd",value:function(){var i=(0,va.Z)((0,pe.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}}]),t}(F0);function M3(e){var r=I3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function I3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function fx(e){return Object.keys(e!=null?e:{}).every(function(r){return["layer","name","img"].includes(r)})}var hx=function(e){(0,Qe.Z)(t,e);var r=M3(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,N.Z)((0,we.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,N.Z)((0,we.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var c=n.selectValue.includes(l.name),p=l.isVisible();c&&!p&&l.show(),!c&&p&&l.hide()})}),n}return(0,K.Z)(t,[{key:"layers",get:function(){var i=this.layerService,a=this.controlOption.layers;if(Array.isArray(a)&&a.length){var s=[];return a.forEach(function(l){if(l instanceof Object&&(fx(l)?s.push(l.layer):s.push(l)),typeof l=="string"){var c=i.getLayer(l)||i.getLayerByName(l);c&&s.push(c)}}),s}return i.getLayers()||[]}},{key:"getDefault",value:function(i){return(0,k.Z)((0,k.Z)({},(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Bh("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(i){return i.isVisible()}).map(function(i){return i.name})}},{key:"getLayerOptions",value:function(){var i=this,a=this.controlOption.layers,s=a==null?void 0:a.every(function(l){return l.img});return a?a==null?void 0:a.map(function(l){if(fx(l))return{text:l.name||l.layer.name,value:l.layer.name,img:s?l.img:void 0};if(typeof l=="string"){var c=i.layerService.getLayer(l)||i.layerService.getLayerByName(l);return{text:c==null?void 0:c.name,value:c==null?void 0:c.name}}return{text:l.name,value:l.name}}):this.layers.map(function(l){return{text:l.name,value:l.name}})}},{key:"setOptions",value:function(i){var a=this.checkUpdateOption(i,["layers"]);(0,va.Z)((0,pe.Z)(t.prototype),"setOptions",this).call(this,i),a&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var i;return(i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,va.Z)((0,pe.Z)(t.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),t}(sx);function P3(e){var r=O3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function O3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var px=function(e){(0,Qe.Z)(t,e);var r=P3(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getDefault",value:function(){return{position:x.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var i=In("div","l7-control-logo");return this.setLogoContent(i),i}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(i){(0,va.Z)((0,pe.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["img","href"])&&(Pl(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(i){var a=this.controlOption,s=a.href,l=a.img,c=In("img");if(c.setAttribute("src",l),c.setAttribute("aria-label","AntV logo"),$h(c),s){var p=In("a","l7-control-logo-link");p.target="_blank",p.href=s,p.rel="noopener nofollow",p.setAttribute("rel","noopener nofollow"),p.appendChild(c),i.appendChild(p)}else i.appendChild(c)}}]),t}(_d),k3={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},D3={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function L3(e){var r=B3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function B3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F3=function(e){(0,Qe.Z)(t,e);var r=L3(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,K.Z)(t,[{key:"getDefault",value:function(i){return(0,k.Z)((0,k.Z)({},(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Bh("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var i=this.mapsService.getType()==="mapbox"?D3:k3;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(a){var s=(0,re.Z)(a,2),l=s[0],c=s[1];return typeof c=="string"&&l!=="blank"}).map(function(a){var s,l=(0,re.Z)(a,2),c=l[0],p=l[1],_=(s=i[c])!==null&&s!==void 0?s:{},b=_.text,A=_.img;return{text:b!=null?b:c,value:p,img:A,key:c}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var i,a=this;if((i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var s,l,c=this.controlOption.defaultValue;this.controlOption.defaultValue=(s=(l=this.controlOption.options.find(function(_){return _.key===c}))===null||l===void 0?void 0:l.value)!==null&&s!==void 0?s:c}else{var p=this.getMapStyle();p?this.controlOption.defaultValue=p:this.mapsService.map.once("styledata",function(){var _=a.mapsService.getMapStyle();a.controlOption.defaultValue=_,a.setSelectValue(_,!1)})}return this.on("selectChange",this.onMapThemeChange),(0,va.Z)((0,pe.Z)(t.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),t}(sx);function N3(e){var r=U3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function U3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var z3=function(e){(0,Qe.Z)(t,e);var r=N3(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"location",[0,0]),(0,N.Z)((0,we.Z)(n),"onMouseMove",function(l){var c=n.location,p=l.lngLat||l.lnglat,_=n.controlOption.transform;p&&(c=[p.lng,p.lat]),n.location=c,_&&(c=_(c)),n.insertLocation2HTML(c),n.emit("locationChange",c)}),n}return(0,K.Z)(t,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(i){return(0,k.Z)((0,k.Z)({},(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this,i)),{},{position:x.BOTTOMLEFT,transform:function(s){var l=(0,re.Z)(s,2),c=l[0],p=l[1];return[+(+c).toFixed(6),+(+p).toFixed(6)]}})}},{key:"onAdd",value:function(){var i=In("div","l7-control-mouse-location");return i.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),i}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(i){this.container.innerText=i.join(", ")}}]),t}(_d);function Z3(e){var r=V3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function V3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j3=function(e){(0,Qe.Z)(t,e);var r=Z3(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"update",function(){var l=n.mapsService,c=n.controlOption.maxWidth,p=l.getSize()[1]/2,_=l.containerToLngLat([0,p]),b=l.containerToLngLat([c,p]),A=$l([_.lng,_.lat],[b.lng,b.lat]);n.updateScales(A)}),n}return(0,K.Z)(t,[{key:"getDefault",value:function(i){return(0,k.Z)((0,k.Z)({},(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this,i)),{},{name:"scale",position:x.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var i="l7-control-scale",a=In("div",i);this.resetScaleLines(a);var s=this.controlOption.updateWhenIdle;return this.mapsService.on(s?"moveend":"mapmove",this.update),this.mapsService.on(s?"zoomend":"zoomchange",this.update),a}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(i){(0,va.Z)((0,pe.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(i){var a=this.controlOption,s=a.metric,l=a.imperial;s&&i&&this.updateMetric(i),l&&i&&this.updateImperial(i)}},{key:"resetScaleLines",value:function(i){Pl(i);var a=this.controlOption,s=a.metric,l=a.imperial,c=a.maxWidth,p=a.lockWidth;p&&_c(i,"width: ".concat(c,"px")),s&&(this.mScale=In("div","l7-control-scale-line",i)),l&&(this.iScale=In("div","l7-control-scale-line",i)),this.update()}},{key:"updateScale",value:function(i,a,s){var l=this.controlOption.maxWidth;i.style.width=Math.round(l*s)+"px",i.innerHTML=a}},{key:"getRoundNum",value:function(i){var a=Math.pow(10,(Math.floor(i)+"").length-1),s=i/a;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:1,a*s}},{key:"updateMetric",value:function(i){var a=this.getRoundNum(i),s=a<1e3?a+" m":a/1e3+" km";this.updateScale(this.mScale,s,a/i)}},{key:"updateImperial",value:function(i){var a=i*3.2808399,s,l,c;a>5280?(s=a/5280,l=this.getRoundNum(s),this.updateScale(this.iScale,l+" mi",l/s)):(c=this.getRoundNum(a),this.updateScale(this.iScale,c+" ft",c/a))}}]),t}(_d),wp,dx=(wp={},(0,N.Z)(wp,bt.additive,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE,srcAlpha:1,dstAlpha:1}}),(0,N.Z)(wp,bt.none,{enable:!1}),(0,N.Z)(wp,bt.normal,{enable:!0,func:{srcRGB:Y.SRC_ALPHA,dstRGB:Y.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,N.Z)(wp,bt.subtractive,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE,srcAlpha:Y.ZERO,dstAlpha:Y.ONE_MINUS_SRC_COLOR},equation:{rgb:Y.FUNC_SUBTRACT,alpha:Y.FUNC_SUBTRACT}}),(0,N.Z)(wp,bt.max,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE},equation:{rgb:Y.MAX_EXT}}),(0,N.Z)(wp,bt.min,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE},equation:{rgb:Y.MIN_EXT}}),wp);function vx(e){return e.map(function(r){return typeof r=="string"&&(r=[r,{}]),r})}function mx(e,r,t,n){var i=e.multiPassRenderer,a=e.getLayerConfig(),s=a.enableTAA;return s?i.add(n("taa")):i.add(n("render")),vx(r).forEach(function(l){var c=(0,re.Z)(l,2),p=c[0],_=c[1];i.add(t(p),_)}),i.add(t("copy")),i}var H3=function(){function e(r){(0,ge.Z)(this,e),this.layer=r}return(0,K.Z)(e,[{key:"pickRender",value:function(t){var n=this.layer.getContainer(),i=n.get(Ye.ILayerService),a=this.layer;if(a.tileLayer)return a.tileLayer.pickRender(t);a.hooks.beforePickingEncode.call(),i.renderTileLayerMask(a),a.renderModels({ispick:!0}),a.hooks.afterPickingEncode.call()}},{key:"pick",value:function(t,n){var i=this.layer.getContainer(),a=i.get(Ye.IPickingService);return t.type==="RasterLayer"?this.pickRasterLayer(t,n):(this.pickRender(n),a.pickFromPickingFBO(t,n))}},{key:"pickRasterLayer",value:function(t,n,i){var a=this.layer.getContainer(),s=a.get(Ye.IPickingService),l=a.get(Ye.IMapService),c=this.layer.getSource().extent,p=Ol(n.lngLat,c),_={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},b=i||t;if(p){var A=this.readRasterValue(t,c,l,n.x,n.y);return _.rasterValue=A,s.triggerHoverOnLayer(b,_),!0}else return _.type=n.type==="mousemove"?"mouseout":"un"+n.type,s.triggerHoverOnLayer(b,(0,k.Z)((0,k.Z)({},_),{},{type:"unpick"})),s.triggerHoverOnLayer(b,_),!1}},{key:"readRasterValue",value:function(t,n,i,a,s){var l=t.getSource().data.dataArray[0],c=(0,re.Z)(n,4),p=c[0],_=p===void 0?0:p,b=c[1],A=b===void 0?0:b,w=c[2],I=w===void 0?10:w,P=c[3],B=P===void 0?-10:P,H=i.lngLatToContainer([_,A]),Q=i.lngLatToContainer([I,B]),ue=Q.x-H.x,Ee=H.y-Q.y,Le=[(a-H.x)/ue,(s-Q.y)/Ee],Ze=l.width||1,tt=l.height||1,ft=Math.floor(Le[0]*Ze),wt=Math.floor(Le[1]*tt),fr=Math.max(0,wt-1)*Ze+ft,hr=l.data[fr];return hr}},{key:"selectFeature",value:function(t){var n=this.layer,i=(0,re.Z)(t,3),a=i[0],s=i[1],l=i[2];n.hooks.beforeSelect.call([a,s,l])}},{key:"highlightPickedFeature",value:function(t){var n=(0,re.Z)(t,3),i=n[0],a=n[1],s=n[2];this.layer.hooks.beforeHighlight.call([i,a,s])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),e}(),W3=function(){function e(r){(0,ge.Z)(this,e),this.layer=r;var t=this.layer.getContainer();this.rendererService=t.get(Ye.IRendererService)}return(0,K.Z)(e,[{key:"getColorTexture",value:function(t,n){var i=this.getTextureKey(t,n);return this.key===i?this.colorTexture:(this.createColorTexture(t,n),this.key=i,this.colorTexture)}},{key:"createColorTexture",value:function(t,n){var i=this.rendererService.createTexture2D,a=this.getColorRampBar(t,n),s=i({data:new Uint8Array(a.data),width:a.width,height:a.height,flipY:!1});return this.colorTexture=s,s}},{key:"setColorTexture",value:function(t,n,i){this.key=this.getTextureKey(n,i),this.colorTexture=t}},{key:"destroy",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"getColorRampBar",value:function(t,n){switch(t.type){case"cat":return Vo(t);case"quantize":return Du(t);case"custom":return ws(t,n);case"linear":return $o(t,n);default:return aa(t)}}},{key:"getTextureKey",value:function(t,n){var i;return"".concat(t.colors.join("_"),"_").concat(t==null||(i=t.positions)===null||i===void 0?void 0:i.join("_"),"_").concat(t.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),G3=["passes"],X3=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption"],gx,r_,_x;function $3(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Y3(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Y3(e,r){if(!!e){if(typeof e=="string")return yx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return yx(e,r)}}function yx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function q3(e){var r=K3();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function K3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n_=vi.isEqual,xx=vi.isFunction,bx=vi.isNumber,Iu=vi.isObject,Q3=vi.isPlainObject,J3=vi.isUndefined,Ex=0,Cp=(gx=Qg(Ye.IGlobalConfigService),r_=function(e){(0,Qe.Z)(t,e);var r=q3(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ge.Z)(this,t),n=r.call(this),(0,N.Z)((0,we.Z)(n),"id","".concat(Ex++)),(0,N.Z)((0,we.Z)(n),"name","".concat(Ex)),(0,N.Z)((0,we.Z)(n),"visible",!0),(0,N.Z)((0,we.Z)(n),"zIndex",0),(0,N.Z)((0,we.Z)(n),"inited",!1),(0,N.Z)((0,we.Z)(n),"layerModelNeedUpdate",!1),(0,N.Z)((0,we.Z)(n),"pickedFeatureID",null),(0,N.Z)((0,we.Z)(n),"selectedFeatureID",null),(0,N.Z)((0,we.Z)(n),"styleNeedUpdate",!1),(0,N.Z)((0,we.Z)(n),"forceRender",!1),(0,N.Z)((0,we.Z)(n),"clusterZoom",0),(0,N.Z)((0,we.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,N.Z)((0,we.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,N.Z)((0,we.Z)(n),"hooks",{init:new vA,afterInit:new oy,beforeRender:new oy,beforeRenderData:new mA,afterRender:new $f,beforePickingEncode:new $f,afterPickingEncode:new $f,beforeHighlight:new $f(["pickedColor"]),afterHighlight:new $f,beforeSelect:new $f(["pickedColor"]),afterSelect:new $f,beforeDestroy:new $f,afterDestroy:new $f}),(0,N.Z)((0,we.Z)(n),"models",[]),(0,N.Z)((0,we.Z)(n),"startInit",!1),(0,N.Z)((0,we.Z)(n),"layerChildren",[]),(0,N.Z)((0,we.Z)(n),"masks",[]),qr((0,we.Z)(n),"configService",_x,(0,we.Z)(n)),(0,N.Z)((0,we.Z)(n),"animateOptions",{enable:!1}),(0,N.Z)((0,we.Z)(n),"currentPickId",null),(0,N.Z)((0,we.Z)(n),"encodeStyleAttribute",{}),(0,N.Z)((0,we.Z)(n),"enableShaderEncodeStyles",[]),(0,N.Z)((0,we.Z)(n),"enableDataEncodeStyles",[]),(0,N.Z)((0,we.Z)(n),"enablg",[]),(0,N.Z)((0,we.Z)(n),"pendingStyleAttributes",[]),(0,N.Z)((0,we.Z)(n),"scaleOptions",{}),(0,N.Z)((0,we.Z)(n),"animateStatus",!1),(0,N.Z)((0,we.Z)(n),"isDestroyed",!1),(0,N.Z)((0,we.Z)(n),"uniformBuffers",[]),(0,N.Z)((0,we.Z)(n),"encodeDataLength",0),(0,N.Z)((0,we.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var a=n.getLayerConfig();a&&a.autoFit&&n.fitBounds(a.fitBoundsOptions);var s=n.layerSource.getSourceCfg().autoRender;s&&setTimeout(function(){n.reRender()},10)}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return(0,K.Z)(t,[{key:"addMask",value:function(i){this.masks.push(i),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}},{key:"removeMask",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),this.updateLayerConfig({maskLayers:this.masks})}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var a=this;if(Object.keys(i).map(function(l){l in a.rawConfig&&(a.rawConfig[l]=i[l])}),!this.startInit)this.needUpdateConfig=(0,k.Z)((0,k.Z)({},this.needUpdateConfig),i);else{var s=this.container.get(Ye.SceneID);this.configService.setLayerConfig(s,this.id,(0,k.Z)((0,k.Z)((0,k.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,a){this.container=i,this.sceneContainer=a}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s=this,l,c,p,_,b,A,w;return xe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:l=this.container.get(Ye.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Ye.IIconService),this.fontService=this.container.get(Ye.IFontService),this.rendererService=this.container.get(Ye.IRendererService),this.layerService=this.container.get(Ye.ILayerService),this.debugService=this.container.get(Ye.IDebugService),this.interactionService=this.container.get(Ye.IInteractionService),this.pickingService=this.container.get(Ye.IPickingService),this.mapService=this.container.get(Ye.IMapService),c=this.getLayerConfig(),p=c.enableMultiPassRenderer,_=c.passes,p&&_!==null&&_!==void 0&&_.length&&_.length>0&&this.mapService.on("mapAfterFrameChange",function(){s.renderLayers()}),this.cameraService=this.container.get(Ye.ICameraService),this.coordinateService=this.container.get(Ye.ICoordinateSystemService),this.shaderModuleService=this.container.get(Ye.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Ye.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ye.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ye.IStyleAttributeService),p&&(this.multiPassRenderer=this.container.get(Ye.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(B){var H=B.attributeName,Q=B.attributeField,ue=B.attributeValues,Ee=B.updateOptions;s.styleAttributeService.updateStyleAttribute(H,{scale:(0,k.Z)({field:Q},s.splitValuesAndCallbackInAttribute(ue,Q?void 0:s.getLayerConfig()[H]))},Ee)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ye.ILayerPlugin),b=$3(this.plugins);try{for(b.s();!(A=b.n()).done;)w=A.value,w.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(B){b.e(B)}finally{b.f()}return this.layerPickService=new H3(this),this.textureService=new W3(this),this.log(Ts.LayerInitStart),P.next=31,this.hooks.init.promise();case 31:this.log(Ts.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"log",value:function(i){var a,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(s,".").concat(i),c={id:this.id,type:this.type};(a=this.debugService)===null||a===void 0||a.log(l,c)}}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models.map(function(a){a.updateAttributesAndElements(i.attributes,i.elements)}):console.warn("data error")}},{key:"setLayerPickService",value:function(i){this.layerPickService=i}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var i=this.getLayerConfig(),a=i.animateOption;a!=null&&a.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(i,a,s){return this.updateStyleAttribute("color",i,a,s),this}},{key:"texture",value:function(i,a,s){return this.updateStyleAttribute("texture",i,a,s),this}},{key:"rotate",value:function(i,a,s){return this.updateStyleAttribute("rotate",i,a,s),this}},{key:"size",value:function(i,a,s){return this.updateStyleAttribute("size",i,a,s),this}},{key:"filter",value:function(i,a,s){var l=this.updateStyleAttribute("filter",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(i,a,s){this.shapeOption={field:i,values:a};var l=this.updateStyleAttribute("shape",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(i,a,s){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:a,updateOptions:s}),this}},{key:"animate",value:function(i){var a={};return Iu(i)?(a.enable=!0,a=(0,k.Z)((0,k.Z)({},a),i)):a.enable=i,this.updateLayerConfig({animateOption:a}),this}},{key:"source",value:function(i,a){return(i==null?void 0:i.type)==="source"?(this.setSource(i),this):(this.sourceOption={data:i,options:a},this.clusterZoom=0,this)}},{key:"setData",value:function(i,a){var s=this;return this.inited?(this.log(Ts.SourceInitStart,jt.UPDATE),this.layerSource.setData(i,a),this.log(Ts.SourceInitEnd,jt.UPDATE)):this.on("inited",function(){s.log(Ts.SourceInitStart,jt.UPDATE);var l=s.getSource();l?s.layerSource.setData(i,a):s.source(new ix(i,a)),s.layerSource.once("update",function(){s.log(Ts.SourceInitEnd,jt.UPDATE)})}),this}},{key:"style",value:function(i){var a=this,s=i.passes,l=(0,yl.Z)(i,G3);s&&vx(s).forEach(function(p){var _=a.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(p[0]);_&&_.updateOptions(p[1])}),l.borderColor&&(l.stroke=l.borderColor),l.borderWidth&&(l.strokeWidth=l.borderWidth);var c=l;return Object.keys(l).forEach(function(p){var _=l[p];Array.isArray(_)&&_.length===2&&!bx(_[0])&&!bx(_[1])&&(c[p]={field:_[0],value:_[1]})}),this.encodeStyle(c),this.updateLayerConfig(c),this}},{key:"encodeStyle",value:function(i){var a=this;Object.keys(i).forEach(function(s){[].concat((0,Gt.Z)(a.enableShaderEncodeStyles),(0,Gt.Z)(a.enableDataEncodeStyles)).includes(s)&&Q3(i[s])&&(i[s].field||i[s].value)&&!n_(a.encodeStyleAttribute[s],i[s])?(a.encodeStyleAttribute[s]=i[s],a.updateStyleAttribute(s,i[s].field,i[s].value),a.inited&&(a.dataState.dataMappingNeedUpdate=!0)):a.encodeStyleAttribute[s]&&(delete a.encodeStyleAttribute[s],a.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(i,a){var s=(0,k.Z)({},this.scaleOptions);if(Iu(i)?this.scaleOptions=(0,k.Z)((0,k.Z)({},this.scaleOptions),i):this.scaleOptions[i]=a,this.styleAttributeService&&!n_(s,this.scaleOptions)){var l=Iu(i)?i:(0,N.Z)({},i,a);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"prerender",value:function(){}},{key:"render",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(i),this))}},{key:"renderMultiPass",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var a={};return a.enableHighlight=Iu(i)?!0:i,Iu(i)?(a.enableHighlight=!0,i.color&&(a.highlightColor=i.color),i.mix&&(a.activeMix=i.mix)):a.enableHighlight=!!i,this.updateLayerConfig(a),this}},{key:"setActive",value:function(i,a){var s=this;if(Iu(i)){var l=i.x,c=l===void 0?0:l,p=i.y,_=p===void 0?0:p;this.updateLayerConfig({highlightColor:Iu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Iu(a)?a.mix:this.getLayerConfig().activeMix}),this.pick({x:c,y:_})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Iu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Iu(a)?a.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Ra(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"select",value:function(i){var a={};return a.enableSelect=Iu(i)?!0:i,Iu(i)?(a.enableSelect=!0,i.color&&(a.selectColor=i.color),i.mix&&(a.selectMix=i.mix)):a.enableSelect=!!i,this.updateLayerConfig(a),this}},{key:"setSelect",value:function(i,a){var s=this;if(Iu(i)){var l=i.x,c=l===void 0?0:l,p=i.y,_=p===void 0?0:p;this.updateLayerConfig({selectColor:Iu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Iu(a)?a.mix:this.getLayerConfig().selectMix}),this.pick({x:c,y:_})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Iu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Iu(a)?a.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ra(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),a=this.getLayerConfig(),s=a.visible,l=a.minZoom,c=l===void 0?-Infinity:l,p=a.maxZoom,_=p===void 0?Infinity:p;return!!s&&i>=c&&i<_}},{key:"setMultiPass",value:function(i,a){if(this.updateLayerConfig({enableMultiPassRenderer:i}),a&&this.updateLayerConfig({passes:a}),i){var s=this.getLayerConfig(),l=s.passes,c=l===void 0?[]:l;this.multiPassRenderer=mx(this,c,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var p=this.rendererService.getViewportSize(),_=p.width,b=p.height;this.multiPassRenderer.resize(_,b)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),a=i.minZoom;return a}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),a=i.maxZoom;return a}},{key:"get",value:function(i){var a=this.getLayerConfig();return a[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var a=this.getSource(),s=a.extent,l=s.some(function(c){return Math.abs(c)===Infinity});return l?this:(this.mapService.fitBounds([[s[0],s[1]],[s[2],s[3]]],i),this)}},{key:"destroy",value:function(){var i,a,s,l,c,p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){(i=this.layerModel)===null||i===void 0||i.uniformBuffers.forEach(function(A){A.destroy()}),this.layerChildren.map(function(A){return A.destroy(!1)}),this.layerChildren=[];var _=this.getLayerConfig(),b=_.maskfence;b&&(this.masks.map(function(A){return A.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(a=this.multiPassRenderer)===null||a===void 0||a.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(s=this.layerModel)===null||s===void 0||s.clearModels(p),(l=this.tileLayer)===null||l===void 0||l.destroy(),this.models=[],(c=this.debugService)===null||c===void 0||c.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(a){return a.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var a=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var c=l.type;if(a.coordCenter===void 0){var p,_=a.layerSource.center;a.coordCenter=_,(p=a.mapService)!==null&&p!==void 0&&p.setCoordCenter&&a.mapService.setCoordCenter(_)}if(c==="update"){if(a.tileLayer){a.tileLayer.reload();return}a.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i,this.encodeDataLength=i.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegend",value:function(i){var a,s,l,c=this.styleAttributeService.getLayerStyleAttribute(i),p=(c==null||(a=c.scale)===null||a===void 0?void 0:a.scalers)||[];return{type:(s=p[0].option)===null||s===void 0?void 0:s.type,field:c==null||(l=c.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(i)}}},{key:"getLegendItems",value:function(i){var a=this.styleAttributeService.getLayerAttributeScale(i);if(!a)return[];if(a.invertExtent){var s=a.range().map(function(p){return(0,N.Z)({value:a.invertExtent(p)},i,p)});return s}else if(a.ticks){var l=a.ticks().map(function(p){return(0,N.Z)({value:p},i,a(p))});return l}else if(a!=null&&a.domain){var c=a.domain().filter(function(p){return!J3(p)}).map(function(p){return(0,N.Z)({value:p},i,a(p))});return c}return[]}},{key:"pick",value:function(i){var a=i.x,s=i.y;this.interactionService.triggerHover({x:a,y:s})}},{key:"boxSelect",value:function(i,a){this.pickingService.boxPickLayer(this,i,a)}},{key:"buildLayerModel",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s){var l=this,c,p,_,b,A,w,I,P,B,H,Q,ue;return xe().wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:return c=s.moduleName,p=s.vertexShader,_=s.fragmentShader,b=s.inject,A=s.triangulation,w=s.styleOption,I=(0,yl.Z)(s,X3),this.shaderModuleService.registerModule(c,{vs:p,fs:_,inject:b}),P=this.shaderModuleService.getModule(c),B=P.vs,H=P.fs,Q=P.uniforms,ue=this.rendererService.createModel,Le.abrupt("return",new Promise(function(Ze){var tt=l.styleAttributeService.createAttributesAndIndices(l.encodedData,A,w),ft=tt.attributes,wt=tt.elements,fr=tt.count,hr=(0,k.Z)({attributes:ft,uniforms:Q,fs:H,vs:B,elements:wt,blend:dx[bt.normal],uniformBuffers:[].concat((0,Gt.Z)(l.layerModel.uniformBuffers),(0,Gt.Z)(l.rendererService.uniformBuffers),[l.getLayerUniformBuffer(),l.getPickingUniformBuffer()]),textures:l.layerModel.textures},I);fr&&(hr.count=fr);var Mr=ue(hr);Ze(Mr)}));case 5:case"end":return Le.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"createAttributes",value:function(i){var a=i.triangulation,s=this.styleAttributeService.createAttributes(this.encodedData,a),l=s.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var a=this.getLayerConfig(),s=a.enableHighlight,l=s===void 0?!0:s,c=a.enableSelect,p=c===void 0?!0:c,_=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&p&&(_=!0),i==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(_=!0),this.isVisible()&&_}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMulPass",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s){return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,s.render();case 2:case"end":return c.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(s){s.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a),textures:i.layerModel.textures},(a==null?void 0:a.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(i,a,s,l){var c=this.configService.getAttributeConfig(this.id)||{};return n_(c[i],{field:a,values:s})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(i)!==-1&&this.configService.setAttributeConfig(this.id,(0,N.Z)({},i,{field:a,values:s})),this.startInit?this.styleAttributeService.updateStyleAttribute(i,{scale:(0,k.Z)({field:a},this.splitValuesAndCallbackInAttribute(s,this.getLayerConfig()[a]))},l):this.pendingStyleAttributes.push({attributeName:i,attributeField:a,attributeValues:s,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"processData",value:function(i){return i}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l;return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.models.forEach(function(_){return _.destroy()}),this.models=[],this.uniformBuffers.forEach(function(_){_.destroy()}),this.uniformBuffers=[],s=this.rendererService.createBuffer({data:new Float32Array(16+4).fill(0),isUBO:!0}),this.uniformBuffers.push(s),l=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(l),p.next=10,this.layerModel.initModels();case 10:this.models=p.sent;case 11:case"end":return p.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getLayerUniformBuffer",value:function(){return this.uniformBuffers[0]}},{key:"getPickingUniformBuffer",value:function(){return this.uniformBuffers[1]}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(i){return{values:xx(i)?void 0:i,callback:xx(i)?i:void 0}}}]),t}(Fa.EventEmitter),_x=Cr(r_.prototype,"configService",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r_);function eC(e,r){return{enable:e,mask:255,func:{cmp:Y.EQUAL,ref:r?1:0,mask:1}}}function Sx(e){return e.maskOperation===qt.OR?{enable:!0,mask:255,func:{cmp:Y.ALWAYS,ref:1,mask:255},opFront:{fail:Y.KEEP,zfail:Y.REPLACE,zpass:Y.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===Lt.SINGLE||e.stencilIndex===0?Y.ALWAYS:Y.LESS,ref:e.stencilType===Lt.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:Y.KEEP,zfail:Y.REPLACE,zpass:Y.REPLACE}}}var Qn=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e[e.UV=14]="UV",e[e.LINEAR=15]="LINEAR",e}({});function tC(e){switch(e){case"rotation":return{name:"Rotation",type:Un.Attribute,descriptor:{name:"a_Rotation",shaderLocation:Qn.ROTATION,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(t){var n=t.rotation,i=n===void 0?0:n;return Array.isArray(i)?[i[0]]:[i]}}};case"stroke":return{name:"stroke",type:Un.Attribute,descriptor:{name:"a_Stroke",shaderLocation:Qn.STROKE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(t){var n=t.stroke,i=n===void 0?[1,1,1,1]:n;return i}}};case"opacity":return{name:"opacity",type:Un.Attribute,descriptor:{name:"a_Opacity",shaderLocation:Qn.OPACITY,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(t){var n=t.opacity,i=n===void 0?1:n;return[i]}}};case"extrusionBase":return{name:"extrusionBase",type:Un.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:Qn.EXTRUSION_BASE,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(t){var n=t.extrusionBase,i=n===void 0?0:n;return[i]}}};case"offsets":return{name:"offsets",type:Un.Attribute,descriptor:{name:"a_Offsets",shaderLocation:Qn.OFFSETS,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(t){var n=t.offsets;return n}}};case"thetaOffset":return{name:"thetaOffset",type:Un.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:15,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(t){var n=t.thetaOffset,i=n===void 0?1:n;return[i]}}};default:return}}var rC={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},N0={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function _N(e){var r="";return Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?r+="vec".concat(n.length," ").concat(t,`;
`):r+="flot ".concat(t,`;
`)}),r}function Ax(e){return Math.max(Math.ceil(e/4)*4,4)}var Tx,i_,Cx,a_={opacity:Qn.OPACITY,stroke:Qn.STROKE,offsets:Qn.OFFSETS,rotation:Qn.ROTATION,extrusionBase:Qn.EXTRUSION_BASE,thetaOffset:15},Pa=(Tx=Qg(Ye.IGlobalConfigService),i_=function(){function e(r){(0,ge.Z)(this,e),(0,N.Z)(this,"uniformBuffers",[]),(0,N.Z)(this,"textures",[]),(0,N.Z)(this,"preStyleAttribute",{}),(0,N.Z)(this,"encodeStyleAttribute",{}),qr(this,"configService",Cx,this),this.layer=r,this.rendererService=r.getContainer().get(Ye.IRendererService),this.pickingService=r.getContainer().get(Ye.IPickingService),this.shaderModuleService=r.getContainer().get(Ye.IShaderModuleService),this.styleAttributeService=r.getContainer().get(Ye.IStyleAttributeService),this.mapService=r.getContainer().get(Ye.IMapService),this.iconService=r.getContainer().get(Ye.IIconService),this.fontService=r.getContainer().get(Ye.IFontService),this.cameraService=r.getContainer().get(Ye.ICameraService),this.layerService=r.getContainer().get(Ye.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t}return(0,K.Z)(e,[{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,i=n===void 0?"normal":n;return dx[bt[i]]}},{key:"getStencil",value:function(t){var n=this.layer.getLayerConfig(),i=n.mask,a=i===void 0?!1:i,s=n.maskInside,l=s===void 0?!0:s,c=n.enableMask,p=n.maskOperation,_=p===void 0?qt.AND:p;if(this.layer.type==="MaskLayer")return Sx({isStencil:!0,stencilType:Lt.SINGLE});if(t.isStencil)return Sx((0,k.Z)((0,k.Z)({},t),{},{maskOperation:_}));var b=a||c&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return eC(b,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),n=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();var i=(0,k.Z)((0,k.Z)({},n.uniformsOption),t.uniformsOption);return!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(i.u_texture=this.textures[0]),i}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var r=(0,Nt.Z)(xe().mark(function n(){return xe().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",!1);case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var r=(0,Nt.Z)(xe().mark(function n(){return xe().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var r=(0,Nt.Z)(xe().mark(function n(){return xe().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"prerender",value:function(){}},{key:"render",value:function(t){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var t=this.layer.encodeStyleAttribute,n="",i=[];this.layer.enableShaderEncodeStyles.forEach(function(l){t[l]?n+="#define USE_ATTRIBUTE_".concat(l.toUpperCase(),` 0.0; 

`):i.push("  ".concat(N0[l]," u_").concat(l,";"));var c=a_[l];!c&&l==="THETA_OFFSET"&&(c=15),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
          layout(location = `).concat(a_[l],") in ").concat(N0[l]," a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
        #endif

        `)});var a=i.length?`
layout(std140) uniform AttributeUniforms {
`.concat(i.join(`
`),`
};
    `):"";n+=a;var s="";return this.layer.enableShaderEncodeStyles.forEach(function(l){s+=`

    #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
      `).concat(N0[l]," ").concat(l,"  = a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
    #else
      `).concat(N0[l]," ").concat(l," = u_").concat(l,`;
    #endif

    `)}),{"vs:#decl":n,"fs:#decl":a,"vs:#main-start":s}}},{key:"getStyleAttribute",value:function(){var t=this,n={};return this.layer.enableShaderEncodeStyles.forEach(function(i){if(!t.layer.encodeStyleAttribute[i]){var a=t.layer.getLayerConfig()[i],s=typeof a=="undefined"?rC[i]:a;i==="stroke"&&(s=li(s)),n["u_"+i]=s}}),n}},{key:"registerStyleAttribute",value:function(){var t=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var i=tC(n);i&&(t.styleAttributeService.registerStyleAttribute(i),i.descriptor&&(i.descriptor.shaderLocation=a_[n]))})}},{key:"updateEncodeAttribute",value:function(t,n){this.encodeStyleAttribute[t]=n}},{key:"initUniformsBuffer",value:function(){var t=this.getUniformsBufferInfo(this.getStyleAttribute()),n=this.getCommonUniformsInfo();t.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(Ax(t.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.attributeUnifoms)),n.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(Ax(n.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.commonUnifoms))}},{key:"getUniformsBufferInfo",value:function(t){var n=0,i=[];return Object.values(t).forEach(function(a){Array.isArray(a)?(i.push.apply(i,(0,Gt.Z)(a)),n+=a.length):typeof a=="number"?(i.push(a),n+=1):typeof a=="boolean"&&(i.push(Number(a)),n+=1)}),{uniformsOption:t,uniformsLength:n,uniformsArray:i}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var t,n,i=this.getUniformsBufferInfo(this.getStyleAttribute()),a=i.uniformsArray,s=this.getCommonUniformsInfo(),l=s.uniformsArray;(t=this.attributeUnifoms)===null||t===void 0||t.subData({offset:0,data:new Uint8Array(new Float32Array(a).buffer)}),(n=this.commonUnifoms)===null||n===void 0||n.subData({offset:0,data:new Uint8Array(new Float32Array(l).buffer)})}}]),e}(),Cx=Cr(i_.prototype,"configService",[Tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i_),Rx=100,yN=36,xN=40;function Mx(e){return e/180*Math.acos(-1)}function Ix(e){var r=Mx(e[0])+Math.PI/2,t=Mx(e[1]),n=Rx+Math.random()*.4,i=n*Math.cos(t)*Math.cos(r),a=n*Math.cos(t)*Math.sin(r),s=n*Math.sin(t);return[a,s,i]}function bN(e,r){var t=mat4.create(),n=mat4.create(),i=vec3.fromValues(0,1,0),a=vec3.fromValues(0,0,0);r=r||{},e=typeof e!="undefined"?e:1;for(var s=typeof r.segments!="undefined"?r.segments:32,l=2+s,c=2*l,p=[],_=[],b=[],A=[],w=[],I=[],P=0;P<=l;P++){for(var B=P/l,H=B*Math.PI,Q=0;Q<=c;Q++){var ue=Q/c,Ee=ue*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-H),mat4.identity(t),mat4.rotateY(t,t,Ee),vec3.transformMat4(a,i,n),vec3.transformMat4(a,a,t),vec3.scale(a,a,-e),b.push(a.slice()),A.push.apply(A,_toConsumableArray(a.slice())),vec3.normalize(a,a),w.push.apply(w,_toConsumableArray(a.slice())),I.push([ue,1-B]),A.push(ue,1-B)}if(P>0)for(var Le=b.length,Ze=Le-2*(c+1);Ze+c+2<Le;Ze++)p.push([Ze,Ze+1,Ze+c+1]),_.push(Ze,Ze+1,Ze+c+1),p.push([Ze+c+1,Ze+1,Ze+c+2]),_.push(Ze+c+1,Ze+1,Ze+c+2)}return{cells:p,positions:b,uvs:I,positionsArr:A,indicesArr:_,normalArr:w}}var U0=Dr.create(),EN=Dr.create(),Vs=Dr.create(),Rp=Dr.create(),hv=Dr.create();function o_(e,r,t,n,i){Dr.add(e,t,n),Dr.normalize(e,e),r=Dr.fromValues(-e[1],e[0]);var a=Dr.fromValues(-t[1],t[0]);return[i/Dr.dot(r,a),r]}function Mp(e,r){return Dr.set(e,-r[1],r[0])}function pv(e,r,t){return Dr.sub(e,r,t),Dr.normalize(e,e),e}function s_(e,r){return e[0]===r[0]&&e[1]===r[1]}function SN(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var nC=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ge.Z)(this,e),(0,N.Z)(this,"lastFlip",-1),(0,N.Z)(this,"miter",Dr.fromValues(0,0)),(0,N.Z)(this,"started",!1),(0,N.Z)(this,"dash",!1),(0,N.Z)(this,"totalDistance",0),(0,N.Z)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,K.Z)(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],c=t[s],p=s<t.length-1?t[s+1]:null,_=this.simpleSegment(n,a,l,c,p);a+=_}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var c,p,_,b=t[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=t[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<t.length-1?[].concat((0,Gt.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,B=l<n.length-1?n[l+1]:null,H=this.simpleSegment(i,s,b,w,P,A,I,B);s+=H}if(this.dash)for(var Q=0;Q<i.positions.length/6;Q++)i.positions[Q*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var c,p,_,b=t[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=t[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<t.length-1?[].concat((0,Gt.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,B=l<n.length-1?n[l+1]:null,H=this.segment_gaode2(i,s,b,w,P,A,I,B);s+=H}if(this.dash)for(var Q=0;Q<i.positions.length/6;Q++)i.positions[Q*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],c=t[s],p=s<t.length-1?t[s+1]:null,_=this.segment(n,a,l,c,p);a+=_}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,i,a,s){var l=0,c=t.indices,p=t.positions,_=t.normals,b=La([a[0],a[1]]),A=La([i[0],i[1]]);pv(Vs,b,A);var w=0;if(this.dash&&(w=this.lineSegmentDistance(b,A),this.totalDistance+=w),this.normal||(this.normal=Dr.create(),Mp(this.normal,Vs)),this.started||(this.started=!0,this.extrusions(p,_,i,this.normal,this.thickness,this.totalDistance-w)),c.push(n+0,n+1,n+2),!s)Mp(this.normal,Vs),this.extrusions(p,_,a,this.normal,this.thickness,this.totalDistance),c.push.apply(c,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=La([s[0],s[1]]);s_(b,I)&&Dr.add(I,b,Dr.normalize(I,Dr.subtract(I,b,A))),pv(Rp,I,b);var P=o_(hv,Dr.create(),Vs,Rp,this.thickness),B=(0,re.Z)(P,2),H=B[0],Q=B[1],ue=Dr.dot(hv,this.normal)<0?-1:1;this.extrusions(p,_,a,Q,H,this.totalDistance),c.push.apply(c,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ue=-1,Dr.copy(this.normal,Q),l+=2,this.lastFlip=ue}return l}},{key:"segment_gaode2",value:function(t,n,i,a,s,l,c,p){var _=0,b=t.indices,A=t.positions,w=t.normals,I=this.cap==="square",P=this.join==="bevel",B=La([c[0],c[1]]),H=La([l[0],l[1]]);pv(Vs,a,i);var Q=0;if(this.dash&&(Q=this.lineSegmentDistance(B,H),this.totalDistance+=Q),this.normal||(this.normal=Dr.create(),Mp(this.normal,Vs)),!this.started)if(this.started=!0,I){var ue=Dr.create(),Ee=Dr.create();Dr.add(ue,this.normal,Vs),Dr.add(Ee,this.normal,Vs),w.push(Ee[0],Ee[1],0),w.push(ue[0],ue[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-Q,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-Q,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,i,this.normal,this.thickness,this.totalDistance-Q);if(b.push(n+0,n+1,n+2),s){s_(a,s)&&Dr.add(s,a,Dr.normalize(s,Dr.subtract(s,a,i))),pv(Rp,s,a);var tt=o_(hv,Dr.create(),Vs,Rp,this.thickness),ft=(0,re.Z)(tt,2),wt=ft[0],fr=ft[1],hr=Dr.dot(hv,this.normal)<0?-1:1,Mr=P;if(!Mr&&this.join==="miter"){var ln=wt;ln>this.miterLimit&&(Mr=!0)}Mr?(w.push(this.normal[0],this.normal[1],0),w.push(fr[0],fr[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*hr,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*hr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,(0,Gt.Z)(this.lastFlip!==-hr?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),Mp(U0,Rp),Dr.copy(this.normal,U0),w.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*hr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(A,w,a,fr,wt,this.totalDistance),b.push.apply(b,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),hr=-1,Dr.copy(this.normal,fr),_+=2),this.lastFlip=hr}else{if(Mp(this.normal,Vs),I){var Le=Dr.create(),Ze=Dr.create();Dr.sub(Ze,Vs,this.normal),Dr.add(Le,Vs,this.normal),w.push(Ze[0],Ze[1],0),w.push(Le[0],Le[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,a,this.normal,this.thickness,this.totalDistance);b.push.apply(b,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"segment",value:function(t,n,i,a,s){var l=0,c=t.indices,p=t.positions,_=t.normals,b=this.cap==="square",A=this.join==="bevel",w=La([a[0],a[1]]),I=La([i[0],i[1]]);pv(Vs,w,I);var P=0;if(this.dash&&(P=this.lineSegmentDistance(w,I),this.totalDistance+=P),this.normal||(this.normal=Dr.create(),Mp(this.normal,Vs)),!this.started)if(this.started=!0,b){var B=Dr.create(),H=Dr.create();Dr.add(B,this.normal,Vs),Dr.add(H,this.normal,Vs),_.push(H[0],H[1],0),_.push(B[0],B[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,_,i,this.normal,this.thickness,this.totalDistance-P);if(c.push(n+0,n+1,n+2),s){var Ee=La([s[0],s[1]]);s_(w,Ee)&&Dr.add(Ee,w,Dr.normalize(Ee,Dr.subtract(Ee,w,I))),pv(Rp,Ee,w);var Le=o_(hv,Dr.create(),Vs,Rp,this.thickness),Ze=(0,re.Z)(Le,2),tt=Ze[0],ft=Ze[1],wt=Dr.dot(hv,this.normal)<0?-1:1,fr=A;if(!fr&&this.join==="miter"){var hr=tt;hr>this.miterLimit&&(fr=!0)}fr?(_.push(this.normal[0],this.normal[1],0),_.push(ft[0],ft[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*wt,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*wt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,(0,Gt.Z)(this.lastFlip!==-wt?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),Mp(U0,Rp),Dr.copy(this.normal,U0),_.push(this.normal[0],this.normal[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*wt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(p,_,a,ft,tt,this.totalDistance),c.push.apply(c,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),wt=-1,Dr.copy(this.normal,ft),l+=2),this.lastFlip=wt}else{if(Mp(this.normal,Vs),b){var Q=Dr.create(),ue=Dr.create();Dr.sub(ue,Vs,this.normal),Dr.add(Q,Vs,this.normal),_.push(ue[0],ue[1],0),_.push(Q[0],Q[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,_,a,this.normal,this.thickness,this.totalDistance);c.push.apply(c,(0,Gt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}(),Ta=Z(77160);function iC(e){var r=e[0][0],t=e[0][e[0].length-1];r[0]===t[0]&&r[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,i=Ro().flatten(e),a=i.vertices,s=i.dimensions,l=[],c=[],p=0;p<a.length/s;p++)s===2?l.push(a[p*2],a[p*2+1],1):l.push(a[p*3],a[p*3+1],1);var _=Ro()(i.vertices,i.holes,i.dimensions);c.push.apply(c,(0,Gt.Z)(_));for(var b=function(){var I=i.vertices.slice(A*s,(A+1)*s),P=i.vertices.slice((A+1)*s,(A+2)*s);P.length===0&&(P=i.vertices.slice(0,s));var B=l.length/3;l.push(I[0],I[1],1,P[0],P[1],1,I[0],I[1],0,P[0],P[1],0),c.push.apply(c,(0,Gt.Z)([0,2,1,2,3,1].map(function(H){return H+B})))},A=0;A<n;A++)b();return{positions:l,index:c}}function aC(e){var r=Ro().flatten(e),t=Ro()(r.vertices,r.holes,r.dimensions);return{positions:r.vertices,index:t}}function Px(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=Ro().flatten(e),s=a.vertices,l=a.dimensions,c=[],p=[],_=[],b=0;b<s.length/l;b++)c.push(s[b*l],s[b*l+1],1,-1,-1),_.push(0,0,1);var A=Ro()(a.vertices,a.holes,a.dimensions);p.push.apply(p,(0,Gt.Z)(A));for(var w=function(){var B=a.vertices.slice(I*l,(I+1)*l),H=a.vertices.slice((I+1)*l,(I+2)*l);H.length===0&&(H=a.vertices.slice(0,l));var Q=c.length/5;c.push(B[0],B[1],1,0,0,H[0],H[1],1,.1,0,B[0],B[1],0,0,.8,H[0],H[1],0,.1,.8);var ue=oC([H[0],H[1],1],[B[0],B[1],0],[B[0],B[1],1],r);_.push.apply(_,(0,Gt.Z)(ue).concat((0,Gt.Z)(ue),(0,Gt.Z)(ue),(0,Gt.Z)(ue))),p.push.apply(p,(0,Gt.Z)([1,2,0,3,2,1].map(function(Ee){return Ee+Q})))},I=0;I<i;I++)w();return{positions:c,index:p,normals:_}}function oC(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=Ta.create(),a=Ta.create(),s=Ta.create();n&&(e=ch(e),r=ch(r),t=ch(t));var l=Ta.fromValues.apply(Ta,(0,Gt.Z)(e)),c=Ta.fromValues.apply(Ta,(0,Gt.Z)(r)),p=Ta.fromValues.apply(Ta,(0,Gt.Z)(t));Ta.sub(i,p,c),Ta.sub(a,l,c),Ta.cross(s,i,a);var _=Ta.create();return Ta.normalize(_,s),_}var Nc,bm=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),Em=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function Sm(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(t*i+r*Math.PI/12);var a=n.map(function(s){var l=Math.sin(s+Math.PI/4),c=Math.cos(s+Math.PI/4);return[l,c,0]});return a}function u_(){return Sm(30)}function Ox(){return Sm(4)}function kx(){return Sm(3)}function Dx(){return Sm(6,1)}function Lx(){return Sm(5)}var dv=(Nc={},(0,N.Z)(Nc,Em.CIRCLE,u_),(0,N.Z)(Nc,Em.HEXAGON,Dx),(0,N.Z)(Nc,Em.TRIANGLE,kx),(0,N.Z)(Nc,Em.SQUARE,Ox),(0,N.Z)(Nc,Em.PENTAGON,Lx),(0,N.Z)(Nc,bm.CYLINDER,u_),(0,N.Z)(Nc,bm.HEXAGONCOLUMN,Dx),(0,N.Z)(Nc,bm.TRIANGLECOLUMN,kx),(0,N.Z)(Nc,bm.SQUARECOLUMN,Ox),(0,N.Z)(Nc,bm.PENTAGONCOLUMN,Lx),Nc),z0={};function Z0(e){var r=qs(e.coordinates);return{vertices:[].concat((0,Gt.Z)(r),(0,Gt.Z)(r),(0,Gt.Z)(r),(0,Gt.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Bx(e){var r=qs(e.coordinates),t=Ix(r);return{vertices:[].concat((0,Gt.Z)(t),(0,Gt.Z)(t),(0,Gt.Z)(t),(0,Gt.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function l_(e){var r=e.shape,t=dC(r,!1),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function sC(e){var r=qs(e.coordinates);return{vertices:(0,Gt.Z)(r),indices:[0],size:r.length}}function uC(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new nC({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var s=t;Array.isArray(s[0][0])||(s=[t]);for(var l=0;l<a.length;l++){var c=a[l],p=s[l];i.extrude_gaode2(c,p)}}else{var _=r;_[0]&&!Array.isArray(_[0][0])&&(_=[r]),_.forEach(function(A){i.extrude(A)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function AN(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat(_toConsumableArray(r),[1,2,-3],_toConsumableArray(r),[1,1,-3],_toConsumableArray(r),[0,1,0],_toConsumableArray(r),[0,0,0],_toConsumableArray(r),[1,0,0],_toConsumableArray(r),[1,2,-3],_toConsumableArray(r),[1,1,-3],_toConsumableArray(r),[0,1,0],_toConsumableArray(r),[0,0,0],_toConsumableArray(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function lC(e){var r=e.coordinates,t=e.originCoordinates,n=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var i=cC(r,t),a=i.results,s=i.totalDistance;return a.map(function(l){n.push(l[0],l[1],l[2],l[3],0,s)}),{vertices:n,indices:[],normals:[],size:6,count:a.length}}function TN(e){var r=e.coordinates,t=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],size:4,count:0};var n=fC(r),i=n.results;return i.map(function(a){t.push(a[0],a[1],a[2],a[3])}),{vertices:t,indices:[],size:4,count:i.length}}function Fx(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.sqrt(t*t+n*n)}function vv(e,r){return e.length<3&&e.push(0),r!==void 0&&e.push(r),e}function cC(e,r){var t=e,n=r||e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=r.flat(),n=r.flat());var i=0;if(t.length<2)return{results:t,totalDistance:0};var a=[],s=vv(t[0],i);a.push(s);for(var l=1;l<t.length-1;l++){var c=Fx(La(n[l-1]),La(n[l]));i+=c;var p=vv(t[l],i);a.push(p),a.push(p)}var _=Fx(La(n[n.length-2]),La(n[n.length-1]));return i+=_,a.push(vv(t[t.length-1],i)),{results:a,totalDistance:i}}function fC(e){if(e.length<2)return{results:e};var r=[],t=vv(e[0]);r.push(t);for(var n=1;n<e.length-1;n++){var i=vv(e[n]);r.push(i),r.push(i)}return r.push(vv(e[e.length-1])),{results:r}}function c_(e){var r=e.coordinates,t=Ro().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Ro()(n,a,i),vertices:n,size:i}}function hC(e){var r=e.coordinates,t=Ro().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Ro()(n,a,i),vertices:pC(n),size:i+4}}function pC(e){for(var r=[],t=Jh(e),n=t.center,i=t.radius,a=0;a<e.length;a+=2){var s=e[a],l=e[a+1];r.push.apply(r,[s,l,0].concat((0,Gt.Z)(n),[i]))}return r}function f_(e){var r=e.coordinates,t=Px(r,!0),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function Nx(e){var r=e.shape,t=mC(r),n=t.positions,i=t.index;return{vertices:n,indices:i,size:3}}function V0(e){var r=e.coordinates,t=[].concat((0,Gt.Z)(r[0]),[0,0,1,r[1][0],r[0][1],0,1,1],(0,Gt.Z)(r[1]),[0,1,0],(0,Gt.Z)(r[0]),[0,0,1],(0,Gt.Z)(r[1]),[0,1,0,r[0][0],r[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function h_(e,r){for(var t=r.segmentNumber,n=t===void 0?30:t,i=e.coordinates,a=[],s=[],l=function(_){a.push(_,1,_,i[0][0],i[0][1],i[1][0],i[1][1],_,-1,_,i[0][0],i[0][1],i[1][0],i[1][1]),_!==n-1&&s.push.apply(s,(0,Gt.Z)([0,1,2,1,3,2].map(function(b){return _*2+b})))},c=0;c<n;c++)l(c);return{vertices:a,indices:s,size:7}}function Ux(e){var r=e.coordinates;r.length===2&&r.push(0);var t=j0(-1,1),n=j0(1,1),i=j0(-1,-1),a=j0(1,-1),s=[].concat((0,Gt.Z)(r),(0,Gt.Z)(t),(0,Gt.Z)(r),(0,Gt.Z)(i),(0,Gt.Z)(r),(0,Gt.Z)(a),(0,Gt.Z)(r),(0,Gt.Z)(n)),l=[0,1,2,3,0,2];return{vertices:s,indices:l,size:5}}function dC(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(z0&&z0[e])return z0[e];var t=dv[e]?dv[e]():dv.cylinder(),n=Px([t],r);return z0[e]=n,n}function wN(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=new Float32Array(e.length/t*3),a,s,l,c=vec3.create(),p=vec3.create(),_=vec3.create(),b=0,A=r.length;b<A;b+=3){a=r[b+0]*3,s=r[b+1]*3,l=r[b+2]*3;var w=[e[a],e[a+1]],I=[e[s],e[s+1]],P=[e[l],e[l+1]];n&&(w=lngLatToMeters(w),I=lngLatToMeters(I),P=lngLatToMeters(P));var B=w,H=_slicedToArray(B,2),Q=H[0],ue=H[1],Ee=vec3.fromValues(Q,ue,e[a+2]),Le=I,Ze=_slicedToArray(Le,2),tt=Ze[0],ft=Ze[1],wt=vec3.fromValues(tt,ft,e[s+2]),fr=P,hr=_slicedToArray(fr,2),Mr=hr[0],ln=hr[1],Rn=vec3.fromValues(Mr,ln,e[l+2]);vec3.sub(c,Rn,wt),vec3.sub(p,Ee,wt),vec3.cross(_,c,p),i[a]+=c[0],i[a+1]+=c[1],i[a+2]+=c[2],i[s]+=c[0],i[s+1]+=c[1],i[s+2]+=c[2],i[l]+=c[0],i[l+1]+=c[1],i[l+2]+=c[2]}return vC(i),i}function vC(e){for(var r=0,t=e.length;r<t;r+=3){var n=vec3.fromValues(e[r],e[r+1],e[r+2]),i=vec3.create();vec3.normalize(i,n),e.set(i,r)}}function CN(e){var r=e[0][0],t=e[0][e[0].length-1];return r[0]===t[0]&&r[1]===t[1]}function mC(e){var r=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=dv[e]?dv[e]():dv.circle(),n=r.indexOf(e)===-1?aC([t]):iC([t]);return n}function j0(e,r){var t=(e+1)/2,n=(r+1)/2;return[t,n]}function RN(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function MN(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function gC(e){var r=_C();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function _C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yC=`precision highp float;
layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
in vec4 v_Color;
in vec2 v_texCoord;
in float v_worldDis;
out vec4 outputColor;

#pragma include "picking"
#pragma include "scene_uniforms"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  outputColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       outputColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        outputColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    outputColor.rgb += r * r * u_circleSweepColor.rgb;
  }
   
  outputColor.a *= u_opacity;
  outputColor = filterColor(outputColor);
}
`,xC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_Uv;

out vec2 v_texCoord;
out vec4 v_Color;
out float v_worldDis;

layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,bC=function(e){(0,Qe.Z)(t,e);var r=gC(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.baseColor,c=l===void 0?"rgb(16,16,16)":l,p=i.brightColor,_=p===void 0?"rgb(255,176,38)":p,b=i.windowColor,A=b===void 0?"rgb(30,60,89)":b,w=i.time,I=w===void 0?0:w,P=i.sweep,B=P===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:P,H={u_baseColor:li(c),u_brightColor:li(_),u_windowColor:li(A),u_circleSweepColor:[].concat((0,Gt.Z)(li(B.sweepColor).slice(0,3)),[1]),u_cityCenter:B.sweepCenter||this.cityCenter,u_circleSweep:B.enable?1:0,u_cityMinSize:this.cityMinSize*B.sweepRadius,u_circleSweepSpeed:B.sweepSpeed,u_opacity:s,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||I},Q=this.getUniformsBufferInfo(H);return Q}},{key:"calCityGeo",value:function(){var i=(0,re.Z)(this.layer.getSource().extent,4),a=i[0],s=i[1],l=i[2],c=i[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+a)/2,(c+s)/2]);var p=this.mapService.lngLatToCoord([l,c]),_=this.mapService.lngLatToCoord([a,s]);this.cityMinSize=Math.sqrt(Math.pow(p[0]-_[0],2)+Math.pow(p[1]-_[1],2))/4}else{var b=l-a,A=c-s;this.cityCenter=[(l+a)/2,(c+s)/2],this.cityMinSize=Math.sqrt(Math.pow(b,2)+Math.pow(A,2))/4}}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.initUniformsBuffer(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:xC,fragmentShader:yC,triangulation:f_,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:Y.BACK}});case 2:return s=c.sent,c.abrupt("return",[s]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",shaderLocation:Qn.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Pa);function EC(e){var r=SC();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function SC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AC=function(e){(0,Qe.Z)(t,e);var r=EC(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"type","CityBuildingLayer"),n}return(0,K.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new bC(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setLight",value:function(i){this.updateLayerConfig({time:i})}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Cp);function TC(e){var r=wC();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function wC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CC=`layout(location = 0) in vec3 a_Position;\r
layout(location = 1) in vec4 a_Color;\r
layout(location = 10) in vec3 a_Pos;\r
\r
layout(std140) uniform commonUniforms {\r
    vec2 u_radius;\r
    float u_opacity;\r
    float u_coverage;\r
    float u_angle;\r
};\r
\r
\r
out vec4 v_color;\r
\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
  v_color.a *= u_opacity;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,RC=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,MC=function(e){(0,Qe.Z)(t,e);var r=TC(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,c={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},p=this.getUniformsBufferInfo(c);return p}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:CC,fragmentShader:RC,triangulation:Nx,primitive:Y.TRIANGLES,depth:{enable:!1}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Un.Attribute,descriptor:{shaderLocation:10,name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Pa);function IC(e){var r=PC();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function PC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w * u_opacity);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,kC=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,DC=function(e){(0,Qe.Z)(t,e);var r=IC(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,c={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},p=this.getUniformsBufferInfo(c);return p}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:OC,fragmentShader:kC,triangulation:l_,primitive:Y.TRIANGLES,depth:{enable:!0}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{shaderLocation:Qn.SIZE,name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Un.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Pa),IN=Z(83557);function LC(e,r){for(var t=[],n=[],i=[],a=e+1,s=r+1,l=e/2,c=r/2,p=0;p<s;p++)for(var _=p-c,b=0;b<a;b++){var A=b-l;n.push(A/l,-_/c,0),i.push(b/e),i.push(1-p/r)}for(var w=0;w<r;w++)for(var I=0;I<e;I++){var P=I+a*w,B=I+a*(w+1),H=I+1+a*(w+1),Q=I+1+a*w;t.push(P,B,Q),t.push(B,H,Q)}return{vertices:n,indices:t,uvs:i}}var zx,Zx;function BC(e){var r=FC();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function FC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NC=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main(){
   
    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));
    outputColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,UC=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,zC=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
    float vW = 2.0/ u_ViewportSize.x;
    float vH = 2.0/ u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;
    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
    outputColor = color;
    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,ZC=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,VC=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in float v_weight;
in vec2 v_extrude;
out vec4 outputColor;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    outputColor = vec4(val, 1., 1., 1.);
}
`,jC=`layout(location = 0) in vec3 a_Position;
layout(location = 9) in float a_Size;
layout(location = 10) in vec2 a_Dir;


layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;


#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,HC=vi.isEqual,Vx=(zx=(0,Jt.b2)(),zx(Zx=function(e){(0,Qe.Z)(t,e);var r=BC(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"colorModelUniformBuffer",[]),(0,N.Z)((0,we.Z)(n),"heat3DModelUniformBuffer",[]),n}return(0,K.Z)(t,[{key:"prerender",value:function(){var i=this,a=this.rendererService,s=a.clear,l=a.useFramebuffer;l(this.heatmapFramerBuffer,function(){s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i.heatmapFramerBuffer}),i.drawIntensityMode()})}},{key:"render",value:function(i){var a=this.layer.getLayerConfig(),s=a.rampColors;HC(this.preRampColors,s)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawHeatMap(i):this.draw3DHeatMap(i)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b,A,w,I,P;return xe().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return l=this.rendererService,c=l.createFramebuffer,p=l.getViewportSize,_=l.createTexture2D,b=this.styleAttributeService.getLayerStyleAttribute("shape"),A=(b==null||(s=b.scale)===null||s===void 0?void 0:s.field)||"heatmap",this.shapeType=A,H.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=H.sent,this.colorModel=A==="heatmap"?this.buildHeatmap():this.build3dHeatMap(),w=p(),I=w.width,P=w.height,this.heatmapTexture=_({width:Math.floor(I/4),height:Math.floor(P/4),wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.LINEAR,mag:Y.LINEAR,usage:Oh.RENDER_TARGET}),this.heatmapFramerBuffer=c({color:this.heatmapTexture,depth:!1}),this.updateColorTexture(),H.abrupt("return",[this.intensityModel,this.colorModel]);case 13:case"end":return H.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Un.Attribute,descriptor:{name:"a_Dir",shaderLocation:10,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.uniformBuffers=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],this.layer.triangulation=Ux,c.next=4,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:jC,fragmentShader:VC,triangulation:Ux,depth:{enable:!1},cull:{enable:!0,face:jo(this.mapService.version)}});case 4:return s=c.sent,c.abrupt("return",s);case 6:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildHeatmap",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:ZC,fs:zC}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];var i=this.shaderModuleService.getModule("heatmapColor"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService,p=c.createAttribute,_=c.createElements,b=c.createBuffer,A=c.createModel;return A({vs:a,fs:s,uniformBuffers:[].concat((0,Gt.Z)(this.colorModelUniformBuffer),(0,Gt.Z)(this.rendererService.uniformBuffers)),attributes:{a_Position:p({shaderLocation:Qn.POSITION,buffer:b({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:Y.FLOAT}),size:3}),a_Uv:p({shaderLocation:Qn.UV,buffer:b({data:[0,1,1,1,0,0,1,0],type:Y.FLOAT}),size:2})},uniforms:(0,k.Z)({},l),depth:{enable:!1},elements:_({data:[0,2,1,2,3,1],type:Y.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var i,a=this.layer.getLayerConfig(),s=a.intensity,l=s===void 0?10:s,c=a.radius,p=c===void 0?5:c,_={u_radius:p,u_intensity:l};this.uniformBuffers[0].subData({offset:0,data:[p,l]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(i=this.intensityModel)===null||i===void 0||i.draw({uniforms:_,blend:{enable:!0,func:{srcRGB:Y.ONE,srcAlpha:1,dstRGB:Y.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawHeatMap",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity,c=l===void 0?1:l,p={u_opacity:c,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},_=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[c]}),(a=this.colorModel)===null||a===void 0||a.draw({uniforms:p,textures:_,blend:this.getBlend(),stencil:this.getStencil(i)})}},{key:"draw3DHeatMap",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity,c=l===void 0?1:l,p=or();Wn(p,this.cameraService.getViewProjectionMatrixUncentered());var _={u_opacity:c,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Gt.Z)(p)};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[].concat((0,Gt.Z)(_.u_ViewProjectionMatrixUncentered),(0,Gt.Z)(_.u_InverseViewProjectionMatrix),[c])});var b=[this.heatmapTexture,this.colorTexture];(a=this.colorModel)===null||a===void 0||a.draw({uniforms:_,textures:b,blend:{enable:!0,func:{srcRGB:Y.SRC_ALPHA,srcAlpha:1,dstRGB:Y.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(i)})}},{key:"build3dHeatMap",value:function(){var i=this.rendererService.getViewportSize,a=i(),s=a.width,l=a.height,c=LC(s/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:UC,fs:NC}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(16*2+4).fill(0),isUBO:!0})];var p=this.shaderModuleService.getModule("heatmap3dColor"),_=p.vs,b=p.fs,A=p.uniforms,w=this.rendererService,I=w.createAttribute,P=w.createElements,B=w.createBuffer,H=w.createModel;return H({vs:_,fs:b,attributes:{a_Position:I({shaderLocation:Qn.POSITION,buffer:B({data:c.vertices,type:Y.FLOAT}),size:3}),a_Uv:I({shaderLocation:Qn.UV,buffer:B({data:c.uvs,type:Y.FLOAT}),size:2})},primitive:Y.TRIANGLES,uniformBuffers:[].concat((0,Gt.Z)(this.heat3DModelUniformBuffer),(0,Gt.Z)(this.rendererService.uniformBuffers)),uniforms:(0,k.Z)({},A),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:Y.SRC_ALPHA,srcAlpha:1,dstRGB:Y.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:P({data:c.indices,type:Y.UNSIGNED_INT,count:c.indices.length})})}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var a=this.layer.getLayerConfig(),s=a.rampColors,l=aa(s);this.colorTexture=i({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.NEAREST,mag:Y.NEAREST,flipY:!1}),this.preRampColors=s}}]),t}(Pa))||Zx);function WC(e){var r=GC();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function GC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XC=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,$C=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 10) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,YC=function(e){(0,Qe.Z)(t,e);var r=WC(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,c={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},p=this.getUniformsBufferInfo(c);return p}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:$C,fragmentShader:XC,triangulation:Nx,depth:{enable:!1},primitive:Y.TRIANGLES});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Un.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Pa),qC={heatmap:Vx,heatmap3d:Vx,grid:MC,grid3d:DC,hexagon:YC},KC=qC;function QC(e){var r=JC();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function JC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eR=function(e){(0,Qe.Z)(t,e);var r=QC(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"type","HeatMapLayer"),n}return(0,K.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new KC[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"prerender",value:function(){var i=this.getModelType();i==="heatmap"&&this.layerModel&&this.layerModel.prerender()}},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(a),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models[0].updateAttributesAndElements(i.attributes,i.elements):console.warn("data error")}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=this.getLayerConfig(),l=s.shape3d,c=this.getSource(),p=c.data.type,_=(a==null||(i=a.scale)===null||i===void 0?void 0:i.field)||"heatmap";return _==="heatmap"||_==="heatmap3d"?"heatmap":p==="hexagon"?(l==null?void 0:l.indexOf(_))===-1?"hexagon":"grid3d":p==="grid"?(l==null?void 0:l.indexOf(_))===-1?"grid":"grid3d":"heatmap"}}]),t}(Cp);function tR(e){var r=rR();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function rR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nR=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,iR=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,aR=function(e){(0,Qe.Z)(t,e);var r=tR(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.color,s=a===void 0?"rgb(255,255,255)":a,l=i.opacity,c=i.brightness,p=i.contrast,_=i.saturation,b=i.gamma,A=li(s),w={u_opacity:dl(l,1),u_brightness:dl(c,1),u_contrast:dl(p,1),u_saturation:dl(_,1),u_gamma:dl(b,1)};this.textures=[this.texture];var I=this.getUniformsBufferInfo(w);return I}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"loadTexture",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c;return xe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return s=this.rendererService.createTexture2D,this.texture=s({height:0,width:0}),l=this.layer.getSource(),_.next=5,l.data.images;case 5:c=_.sent,this.texture=s({data:c[0],width:c[0].width,height:c[0].height,mag:Y.LINEAR,min:Y.LINEAR});case 7:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:iR,fragmentShader:nR,triangulation:V0,primitive:Y.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",shaderLocation:Qn.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Pa),oR={image:aR},sR=oR;function uR(e){var r=lR();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function lR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jx=function(e){(0,Qe.Z)(t,e);var r=uR(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"type","ImageLayer"),n}return(0,K.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new sR[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={image:{}};return a[i]}},{key:"getModelType",value:function(){return"image"}}]),t}(Cp);function cR(e){var r=fR();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function fR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hR=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};
in vec2 v_iconMapUV;
in vec4 v_lineData;
in vec4 v_color;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,pR=`#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9



  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  //\u8BA1\u7B97dashArray\u548CdistanceRatio \u8F93\u51FA\u5230\u7247\u5143
  vec2 s = source;
  vec2 t = target;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,dR={solid:0,dash:1},PN=vi.isNumber,vR=function(e){(0,Qe.Z)(t,e);var r=cR(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineType,_=p===void 0?"solid":p,b=i.dashArray,A=b===void 0?[10,5]:b,w=i.forward,I=w===void 0?!0:w,P=i.lineTexture,B=P===void 0?!1:P,H=i.iconStep,Q=H===void 0?100:H,ue=i.segmentNumber,Ee=ue===void 0?30:ue,Le=this.layer.getLayerConfig(),Ze=Le.animateOption,tt=A;_!=="dash"&&(tt=[0,0]),tt.length===2&&tt.push(0,0);var ft=0,wt=[0,0,0,0],fr=[0,0,0,0];a&&s&&(wt=li(a),fr=li(s),ft=1),this.rendererService.getDirty()&&this.texture.bind();var hr={u_animate:this.animateOption2Array(Ze),u_dash_array:tt,u_sourceColor:wt,u_targetColor:fr,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:Ee,u_lineDir:I?1:-1,u_icon_step:Q,u_line_texture:B?1:0,u_textureBlend:c==="normal"?0:1,u_blur:.9,u_line_type:dR[_||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:ft},Mr=this.getUniformsBufferInfo(hr);return Mr}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:hR,vert:pR,type:""}}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b,A,w;return xe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.initUniformsBuffer(),s=this.layer.getLayerConfig(),l=s.segmentNumber,c=l===void 0?30:l,p=this.getShaders(),_=p.frag,b=p.vert,A=p.type,P.next=5,this.layer.buildLayerModel({moduleName:"lineArc2d"+A,vertexShader:b,fragmentShader:_,inject:this.getInject(),triangulation:h_,depth:{enable:!1},styleOption:{segmentNumber:c}});case 5:return w=P.sent,P.abrupt("return",[w]);case 7:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Un.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(s,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.texture,p=l[c]||{x:0,y:0},_=p.x,b=p.y;return[_,b]}}})}}]),t}(Pa);function mR(e){var r=gR();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function gR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _R=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

// varying vec2 v_normal;
in vec4 v_dash_array;
in vec4 v_color;
in vec4 v_line_data;
in float v_segmentIndex;
in vec2 v_iconMapUV;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,yR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,xR={solid:0,dash:1},Hx=function(e){(0,Qe.Z)(t,e);var r=mR(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineType,_=p===void 0?"solid":p,b=i.dashArray,A=b===void 0?[10,5]:b,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,B=P===void 0?100:P,H=i.segmentNumber,Q=H===void 0?30:H,ue=i.globalArcHeight,Ee=ue===void 0?10:ue,Le=this.layer.getLayerConfig(),Ze=Le.animateOption;A.length===2&&A.push(0,0);var tt=0,ft=[0,0,0,0],wt=[0,0,0,0];a&&s&&(ft=li(a),wt=li(s),tt=1),this.rendererService.getDirty()&&this.texture.bind();var fr={u_animate:this.animateOption2Array(Ze),u_dash_array:A,u_sourceColor:ft,u_targetColor:wt,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Rx,u_global_height:Ee,segmentNumber:Q,u_line_type:xR[_]||0,u_icon_step:B,u_line_texture:I?1:0,u_textureBlend:c==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:tt},hr=this.getUniformsBufferInfo(fr);return hr}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:_R,vert:yR,type:""}}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b,A,w;return xe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,c=l===void 0?30:l,p=this.getShaders(),_=p.frag,b=p.vert,A=p.type,P.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+A,vertexShader:b,fragmentShader:_,inject:this.getInject(),triangulation:h_,styleOption:{segmentNumber:c}});case 4:return w=P.sent,P.abrupt("return",[w]);case 6:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Un.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(s,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.texture,p=l[c]||{x:0,y:0},_=p.x,b=p.y;return[_,b]}}})}}]),t}(Pa),Wx={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},zl=1/2;function bR(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?1:i;return{vertices:[0,zl*e,1*e*n,-(a+zl)*e,1*e*n,(a-zl)*e,0,zl*e,1*e*n,-(a+zl)*e,1*e*n,(a-zl)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function ER(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*e*n,1*a,1*e*n,-1*a,0,0,1*e*n,1*a,1*e*n,-1*a],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function SR(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i;return{vertices:[0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2,0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function AR(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a,0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function TR(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a,0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function wR(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i,s=u_(),l=Ro().flatten([s]),c=Ro()(l.vertices,l.holes,l.dimensions),p=s.map(function(_){return[_[0]*n*e,_[1]*a]}).flat();return{vertices:[].concat((0,Gt.Z)(p),(0,Gt.Z)(p)),dimensions:2,indices:c.map(function(_){return _+s.length}),outLineIndices:c,normals:[].concat((0,Gt.Z)(s.map(function(_){return[_[1]*a,_[0]*n*e,1]}).flat()),(0,Gt.Z)(new Array(s.length*3).fill(0)))}}function CR(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,n=(0,Fs.Z)(t.source)==="object"?t.source.type:t.source,i=(0,Fs.Z)(t.target)==="object"?t.target.type:t.target,a=(0,Fs.Z)(t.source)==="object"?t.source:{},s=a.width,l=s===void 0?n?Wx[n]:0:s,c=a.height,p=c===void 0?2:c,_=(0,Fs.Z)(t.target)==="object"?t.target:{},b=_.width,A=b===void 0?i?Wx[i]:0:b,w=_.height,I=w===void 0?2:w;return{vertices:[0,zl,1*l].concat((0,Gt.Z)(e),[1,zl,-1*A],(0,Gt.Z)(e),[1,-zl,-1*A],(0,Gt.Z)(e),[0,-zl,1*l],(0,Gt.Z)(e),[0,zl,1*l],(0,Gt.Z)(e),[1,zl,-1*A],(0,Gt.Z)(e),[1,-zl,-1*A],(0,Gt.Z)(e),[0,-zl,1*l],(0,Gt.Z)(e)),outLineIndices:[0,1,2,0,2,3].map(function(P){return P+r}),indices:[4,5,6,4,6,7].map(function(P){return P+r}),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function Gx(e,r){var t=(0,Fs.Z)(e)==="object"?e.type:e,n=r==="source"?1:-1,i=(0,Fs.Z)(e)==="object"?e:{};switch(t){case"circle":return wR(n,i);case"triangle":return ER(n,i);case"diamond":return AR(n,i);case"rect":return SR(n,i);case"classic":return TR(n,i);case"halfTriangle":return bR(n,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function RR(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat((0,Gt.Z)(r),[1,2,-3],(0,Gt.Z)(r),[1,1,-3],(0,Gt.Z)(r),[0,1,0],(0,Gt.Z)(r),[0,0,0],(0,Gt.Z)(r),[1,0,0],(0,Gt.Z)(r),[1,2,-3],(0,Gt.Z)(r),[1,1,-3],(0,Gt.Z)(r),[0,1,0],(0,Gt.Z)(r),[0,0,0],(0,Gt.Z)(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function MR(e,r){return r?IR(e,r):RR(e)}function IR(e,r){var t=e.coordinates.flat(),n=r,i=n.target,a=i===void 0?"classic":i,s=n.source,l=s===void 0?"circle":s,c=Xx(Gx(l,"source"),t,0,0),p=CR(t,c.vertices.length/7,r),_=Xx(Gx(a,"target"),t,1,c.vertices.length/7+p.vertices.length/7),b={vertices:[].concat((0,Gt.Z)(c.vertices),(0,Gt.Z)(p.vertices),(0,Gt.Z)(_.vertices)),indices:[].concat((0,Gt.Z)(c.outLineIndices),(0,Gt.Z)(p.outLineIndices),(0,Gt.Z)(_.outLineIndices),(0,Gt.Z)(c.indices),(0,Gt.Z)(p.indices),(0,Gt.Z)(_.indices)),normals:[].concat((0,Gt.Z)(c.normals),(0,Gt.Z)(p.normals),(0,Gt.Z)(_.normals)),size:7};return b}function Xx(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=[],a=e.vertices,s=e.indices,l=e.dimensions,c=e.outLineIndices,p=0;p<a.length;p+=l)i.push.apply(i,[t,a[p+1],a[p]].concat((0,Gt.Z)(r)));return(0,k.Z)((0,k.Z)({},e),{},{vertices:i,indices:s.map(function(_){return _+n}),outLineIndices:c.map(function(_){return _+n})})}function PR(e){var r=OR();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function OR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kR=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,DR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {

   vec2 data = project_pixel(offsets);
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return data;
  }

  return vec2(data.x, -data.y);;
}

vec2 line_dir(vec2 target, vec2 source) {

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return normalize(target - source);
  }
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}

float flag_gap() {
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return 1.;
  }
  return -1.;

}


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target,source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x); // mapbox || \u9AD8\u5FB7
   
  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || \u9AD8\u5FB7

  float gapCommon = flag_gap() * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir *  (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,LR=function(e){(0,Qe.Z)(t,e);var r=PR(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.gapWidth,s=a===void 0?2:a,l=i.strokeWidth,c=l===void 0?1:l,p=i.strokeOpacity,_=p===void 0?1:p,b={u_gap_width:s,u_stroke_width:c,u_stroke_opacity:_},A=this.getUniformsBufferInfo(b);return A}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:DR,fragmentShader:kR,inject:this.getInject(),triangulation:MR,styleOption:this.layer.getLayerConfig().symbol,primitive:Y.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return s=c.sent,c.abrupt("return",[s]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Un.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(a,s,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}})}}]),t}(Pa);function BR(e){var r=FR();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function FR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_line_data;
in vec2 v_iconMapUV;
in vec4 v_dash_array;
in float v_distance_ratio;
in vec4 v_color;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,UR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
  mix(source, target, segmentRatio),
  sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }
  else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,zR={solid:0,dash:1},ZR=function(e){(0,Qe.Z)(t,e);var r=BR(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineType,_=p===void 0?"solid":p,b=i.dashArray,A=b===void 0?[10,5]:b,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,B=P===void 0?100:P,H=i.segmentNumber,Q=H===void 0?30:H,ue=this.layer.getLayerConfig(),Ee=ue.animateOption;A.length===2&&A.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Le=0,Ze=[0,0,0,0],tt=[0,0,0,0];a&&s&&(Ze=li(a),tt=li(s),Le=1);var ft=this.layer.getLayerAnimateTime();isNaN(ft)&&(ft=0);var wt={u_animate:this.animateOption2Array(Ee),u_dash_array:A,u_sourceColor:Ze,u_targetColor:tt,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:Q,u_line_type:zR[_]||0,u_icon_step:B,u_line_texture:I?1:0,u_textureBlend:c==="normal"?0:1,u_time:ft,u_linearColor:Le},fr=this.getUniformsBufferInfo(wt);return fr}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,c=l===void 0?30:l,b.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:UR,fragmentShader:NR,triangulation:h_,styleOption:{segmentNumber:c},inject:this.getInject(),depth:{enable:!1}});case 3:return p=b.sent,b.abrupt("return",[p]);case 5:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Un.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(s,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.texture,p=l[c]||{x:0,y:0},_=p.x,b=p.y;return[_,b]}}})}}]),t}(Pa),ON=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),$x=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),VR=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),p_=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),kN=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function jR(e){var r=HR();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function HR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WR=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
in vec2 v_iconMapUV;
in vec4 v_texture_data;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,GR=`
#define Animate 0.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec4 a_SizeDistanceAndTotalDistance;
layout(location = 13) in vec4 a_NormalAndMiter;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};
#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_texture_data;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;
  v_d_distance_ratio = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_NormalAndMiter.w * setPickingSize(a_SizeDistanceAndTotalDistance.x) * reverse_offset_normal(a_NormalAndMiter.xyz);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_SizeDistanceAndTotalDistance.b;
  float currentLinePointRatio = lineDistance / a_SizeDistanceAndTotalDistance.a;
 

  float lineOffsetWidth = length(offset + offset * sign(a_NormalAndMiter.w)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_SizeDistanceAndTotalDistance.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_SizeDistanceAndTotalDistance.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_SizeDistanceAndTotalDistance.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,DN={solid:0,dash:1},Yx=function(e){(0,Qe.Z)(t,e);var r=jR(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"textureEventFlag",!1),(0,N.Z)((0,we.Z)(n),"texture",n.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),(0,N.Z)((0,we.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.textures.length===0&&(n.textures=[n.texture]),n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineType,_=p===void 0?"solid":p,b=i.dashArray,A=b===void 0?[10,5,0,0]:b,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,B=P===void 0?100:P,H=i.vertexHeightScale,Q=H===void 0?20:H,ue=i.strokeWidth,Ee=ue===void 0?0:ue,Le=i.raisingHeight,Ze=Le===void 0?0:Le,tt=i.heightfixed,ft=tt===void 0?!1:tt,wt=i.linearDir,fr=wt===void 0?$x.VERTICAL:wt,hr=i.blur,Mr=hr===void 0?[1,1,1,0]:hr,ln=A;_!=="dash"&&(ln=[0,0,0,0]),ln.length===2&&ln.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var Rn=this.layer.getLayerConfig(),wi=Rn.animateOption,ba=0,Va=[0,0,0,0],io=[0,0,0,0];a&&s&&(Va=li(a),io=li(s),ba=1);var as={u_animate:this.animateOption2Array(wi),u_dash_array:ln,u_blur:Mr,u_sourceColor:Va,u_targetColor:io,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:B,u_heightfixed:Number(ft),u_vertexScale:Q,u_raisingHeight:Number(Ze),u_strokeWidth:Ee,u_textureBlend:c===VR.NORMAL?0:1,u_line_texture:I?1:0,u_linearDir:fr===$x.VERTICAL?1:0,u_linearColor:ba,u_time:this.layer.getLayerAnimateTime()||0},Sl=this.getUniformsBufferInfo(as);return Sl}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b,A,w;return xe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,c=l===void 0?!1:l,p=this.getShaders(),_=p.frag,b=p.vert,A=p.type,this.layer.triangulation=Nf,P.next=5,this.layer.buildLayerModel({moduleName:"line"+A,vertexShader:b,fragmentShader:_,triangulation:Nf,inject:this.getInject(),depth:{enable:c}});case 5:return w=P.sent,P.abrupt("return",[w]);case 7:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:WR,vert:GR,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:Un.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:Qn.SIZE,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(s,l,c){var p=s.size,_=p===void 0?1:p,b=Array.isArray(_)?[_[0],_[1]]:[_,0];return[b[0],b[1],c[3],c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normalAndMiter",type:Un.Attribute,descriptor:{name:"a_NormalAndMiter",shaderLocation:Qn.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(s,l,c,p,_){return[].concat((0,Gt.Z)(_),[c[4]])}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:Qn.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.texture,p=l[c]||{x:0,y:0},_=p.x,b=p.y;return[_,b]}}})}}]),t}(Pa);function XR(e){var r=$R();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function $R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YR=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  }
  else{
    outputColor = v_color;
  }
}
`,qR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color; 
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_SizeDistanceAndTotalDistance.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_SizeDistanceAndTotalDistance.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,LN=vi.isNumber,KR=function(e){(0,Qe.Z)(t,e);var r=XR(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.lineType,c=l===void 0?"solid":l,p=i.dashArray,_=p===void 0?[10,5,0,0]:p,b=i.vertexHeightScale,A=b===void 0?20:b,w=_;c!=="dash"&&(w=[0,0,0,0]),w.length===2&&w.push(0,0);var I=0,P=[0,0,0,0],B=[0,0,0,0];a&&s&&(P=li(a),B=li(s),I=1);var H={u_sourceColor:P,u_targetColor:B,u_dash_array:w,u_vertexScale:A,u_linearColor:I},Q=this.getUniformsBufferInfo(H);return Q}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:YR,vert:qR,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_;return xe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return this.initUniformsBuffer(),s=this.getShaders(),l=s.frag,c=s.vert,p=s.type,A.next=4,this.layer.buildLayerModel({moduleName:p,vertexShader:c,fragmentShader:l,triangulation:lC,inject:this.getInject(),primitive:Y.LINES,depth:{enable:!1},pick:!1});case 4:return _=A.sent,A.abrupt("return",[_]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:Un.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:Qn.SIZE,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(a,s,l){var c=a.size,p=c===void 0?1:c,_=Array.isArray(p)?[p[0],p[1]]:[p,0];return[_[0],_[1],l[3],l[5]]}}})}}]),t}(Pa);function QR(e){var r=JR();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function JR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eM=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
in vec2 v_iconMapUV;
in float v_blur;
in float v_radio;
in vec4 v_color;
in vec4 v_dataset;

out vec4 outputColor;
#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,tM=`#define Animate 0.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 10) in float a_Miter;
layout(location = 11) in float a_Total_Distance;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_iconMapUV;
layout(location = 15) in float a_Distance;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out float v_radio;
out vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {    
     originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }


  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,rM=function(e){(0,Qe.Z)(t,e);var r=QR(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.heightfixed,_=p===void 0?!1:p,b=i.lineTexture,A=b===void 0?!1:b,w=i.iconStep,I=w===void 0?100:w,P=i.iconStepCount,B=P===void 0?1:P,H=this.layer.getLayerConfig(),Q=H.animateOption;this.rendererService.getDirty()&&this.texture.bind();var ue=0,Ee=[0,0,0,0],Le=[0,0,0,0];a&&s&&(Ee=li(a),Le=li(s),ue=1);var Ze={u_animate:this.animateOption2Array(Q),u_sourceColor:Ee,u_targetColor:Le,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:I,u_heightfixed:Number(_),u_linearColor:ue,u_line_texture:A?1:0,u_textureBlend:c==="normal"?0:1,u_iconStepCount:B,u_time:this.layer.getLayerAnimateTime()||0},tt=this.getUniformsBufferInfo(Ze);return tt}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:tM,fragmentShader:eM,triangulation:uC,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return s=c.sent,c.abrupt("return",[s]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Un.Attribute,descriptor:{name:"a_Distance",shaderLocation:15,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s,l,c){return[c[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Un.Attribute,descriptor:{name:"a_Total_Distance",shaderLocation:11,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s,l,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=s.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(s,l,c,p,_){return _}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Un.Attribute,descriptor:{name:"a_Miter",shaderLocation:10,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s,l,c){return[c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.texture,p=l[c]||{x:0,y:0},_=p.x,b=p.y;return[_,b]}}})}}]),t}(Pa),nM={arc:vR,arc3d:Hx,greatcircle:ZR,wall:rM,line:Yx,simple:KR,flowline:LR,earthArc3d:Hx},iM=nM;function aM(e){var r=oM();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function oM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d_=function(e){(0,Qe.Z)(t,e);var r=aM(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"type","LineLayer"),(0,N.Z)((0,we.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),(0,N.Z)((0,we.Z)(n),"arrowInsertCount",0),(0,N.Z)((0,we.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,K.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new iM[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}};return a[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s||"line"}},{key:"processData",value:function(i){if(this.getModelType()!=="simple")return i;var a=[];return i.map(function(s){if(Array.isArray(s.coordinates)&&Array.isArray(s.coordinates[0])&&Array.isArray(s.coordinates[0][0])){var l=(0,k.Z)({},s);s.coordinates.map(function(c){a.push((0,k.Z)((0,k.Z)({},l),{},{coordinates:c}))})}else a.push(s)}),a}}]),t}(Cp);function sM(e){var r=uM();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function uM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lM=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,cM=`
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function qx(e){var r=e.coordinates;return{vertices:(0,Gt.Z)(r),indices:[0],size:r.length}}var fM=function(e){(0,Qe.Z)(t,e);var r=sM(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.blend,s=i.strokeOpacity,l=s===void 0?1:s,c=i.strokeWidth,p=c===void 0?0:c,_=i.stroke,b=_===void 0?"#fff":_,A={u_stroke_color:li(b),u_additive:a==="additive"?1:0,u_stroke_opacity:l,u_stroke_width:p},w=this.getUniformsBufferInfo(A);return w}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=qx,this.initUniformsBuffer(),c.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:cM,fragmentShader:lM,inject:this.getInject(),triangulation:qx,depth:{enable:!1},primitive:Y.POINTS});case 4:return s=c.sent,c.abrupt("return",[s]);case 6:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Pa);function hM(e){var r=pM();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function pM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dM=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,vM=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;


layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,mM=vi.isNumber,gM=function(e){(0,Qe.Z)(t,e);var r=hM(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"raiseCount",0),(0,N.Z)((0,we.Z)(n),"raiseRepeat",0),n}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.opacity,c=l===void 0?1:l,p=i.sourceColor,_=i.targetColor,b=i.pickLight,A=b===void 0?!1:b,w=i.heightfixed,I=w===void 0?!0:w,P=i.opacityLinear,B=P===void 0?{enable:!1,dir:"up"}:P,H=i.lightEnable,Q=H===void 0?!0:H,ue=0,Ee=[0,0,0,0],Le=[0,0,0,0];if(p&&_&&(Ee=li(p),Le=li(_),ue=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var Ze=s.speed,tt=Ze===void 0?.01:Ze;this.raiseCount+=tt,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var ft={u_sourceColor:Ee,u_targetColor:Le,u_linearColor:ue,u_pickLight:Number(A),u_heightfixed:Number(I),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:mM(c)?c:1,u_opacitylinear:Number(B.enable),u_opacitylinear_dir:B.dir==="up"?1:0,u_lightEnable:Number(Q)},wt=this.getUniformsBufferInfo(ft);return wt}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption.repeat,c=l===void 0?1:l,this.raiseRepeat=c,b.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:vM,fragmentShader:dM,triangulation:l_,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:jo(this.mapService.version)},blend:this.getBlend()});case 4:return p=b.sent,b.abrupt("return",[p]);case 6:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Un.Attribute,descriptor:{name:"a_Pos",shaderLocation:15,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=qs(a.coordinates);return Ix([s[0],s[1]])}}})}}]),t}(Pa);function _M(e){var r=yM();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function yM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xM=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,bM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}`,EM=function(e){(0,Qe.Z)(t,e);var r=_M(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,s=a===void 0?1:a,l=i.strokeWidth,c=l===void 0?0:l,p=i.blend,_=i.blur,b=_===void 0?0:_;this.layer.getLayerConfig();var A={u_additive:p==="additive"?1:0,u_stroke_opacity:s,u_stroke_width:c,u_blur:b},w=this.getUniformsBufferInfo(A);return w}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=Bx,c.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:bM,fragmentShader:xM,triangulation:Bx,inject:this.getInject(),depth:{enable:!0},blend:this.getBlend()});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Un.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Qn.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(s,l,c,p){var _=(0,re.Z)(c,3),b=_[0],A=_[1],w=_[2],I=Ta.fromValues(0,0,1),P=Ta.fromValues(b,0,w),B=b>=0?Ta.angle(I,P):Math.PI*2-Ta.angle(I,P),H=Math.PI*2-Math.asin(A/100),Q=or();gl(Q,Q,B),Ah(Q,Q,H);var ue=Ta.fromValues(1,1,0);Ta.transformMat4(ue,ue,Q),Ta.normalize(ue,ue);var Ee=Ta.fromValues(-1,1,0);Ta.transformMat4(Ee,Ee,Q),Ta.normalize(Ee,Ee);var Le=Ta.fromValues(-1,-1,0);Ta.transformMat4(Le,Le,Q),Ta.normalize(Le,Le);var Ze=Ta.fromValues(1,-1,0);Ta.transformMat4(Ze,Ze,Q),Ta.normalize(Ze,Ze);var tt=[].concat((0,Gt.Z)(ue),(0,Gt.Z)(Ee),(0,Gt.Z)(Le),(0,Gt.Z)(Ze)),ft=p%4*3;return[tt[ft],tt[ft+1],tt[ft+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Un.Attribute,descriptor:{name:"a_Shape",shaderLocation:Qn.SHAPE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.shape,c=l===void 0?2:l,p=i.layer.getLayerConfig().shape2d,_=p.indexOf(c);return[_]}}})}}]),t}(Pa);function SM(e){var r=AM();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function AM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TM=`in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;


layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,wM=`#define pi 3.1415926535

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,Kx=function(e){(0,Qe.Z)(t,e);var r=SM(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"raiseCount",0),(0,N.Z)((0,we.Z)(n),"raiseRepeat",0),n}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.sourceColor,c=i.targetColor,p=i.pickLight,_=p===void 0?!1:p,b=i.heightfixed,A=b===void 0?!1:b,w=i.opacityLinear,I=w===void 0?{enable:!1,dir:"up"}:w,P=i.lightEnable,B=P===void 0?!0:P,H=0,Q=[0,0,0,0],ue=[0,0,0,0];if(l&&c&&(Q=li(l),ue=li(c),H=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var Ee=s.speed,Le=Ee===void 0?.01:Ee;this.raiseCount+=Le,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var Ze={u_pickLight:Number(_),u_heightfixed:Number(A),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:H,u_sourceColor:Q,u_targetColor:ue,u_opacitylinear:Number(I.enable),u_opacitylinear_dir:I.dir==="up"?1:0,u_lightEnable:Number(B)},tt=this.getUniformsBufferInfo(Ze);return tt}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b;return xe().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,c=l===void 0?!0:l,p=s.animateOption.repeat,_=p===void 0?1:p,this.raiseRepeat=_,this.initUniformsBuffer(),w.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:wM,fragmentShader:TM,triangulation:l_,inject:this.getInject(),cull:{enable:!0,face:jo(this.mapService.version)},depth:{enable:c}});case 5:return b=w.sent,w.abrupt("return",[b]);case 7:case"end":return w.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Un.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Qn.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=qs(a.coordinates);return[s[0],s[1],0]}}})}}]),t}(Pa);function CM(e){var r=RM();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function RM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MM=`layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};


in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave\u76F8\u5173\u903B\u8F91
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,IM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_SizeAndShape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;   
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_SizeAndShape.y;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_SizeAndShape.x);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,Qx=function(e){(0,Qe.Z)(t,e);var r=CM(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,s=a===void 0?1:a,l=i.strokeWidth,c=l===void 0?0:l,p=i.blend,_=i.blur,b=_===void 0?0:_,A=i.raisingHeight,w=A===void 0?0:A,I=i.heightfixed,P=I===void 0?!1:I,B=i.unit,H=B===void 0?"pixel":B,Q=this.getAnimateUniforms().u_time;isNaN(Q)&&(Q=-1);var ue={u_blur_height_fixed:[b,Number(w),Number(P)],u_stroke_width:c,u_additive:p==="additive"?1:0,u_stroke_opacity:s,u_size_unit:p_[H],u_time:Q,u_animate:this.getAnimateUniforms().u_animate},Ee=this.getUniformsBufferInfo(ue);return Ee}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),rp)}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b,A,w;return xe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption,c=l===void 0?{enable:!1}:l,p=this.getShaders(c),_=p.frag,b=p.vert,A=p.type,this.layer.triangulation=rp,this.initUniformsBuffer(),P.next=6,this.layer.buildLayerModel({moduleName:A,vertexShader:b,fragmentShader:_,inject:this.getInject(),triangulation:rp,depth:{enable:!1}});case 6:return w=P.sent,P.abrupt("return",[w]);case 8:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){return{frag:MM,vert:IM,type:"pointFill"}}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Un.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Qn.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(s,l,c,p){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=p%4*3;return[_[b],_[b+1],_[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"sizeAndShape",type:Un.Attribute,descriptor:{name:"a_SizeAndShape",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=s.size,c=l===void 0?5:l,p=s.shape,_=p===void 0?2:p,b=i.indexOf(_),A=Array.isArray(c)?c[0]:c;return[A,b]}}})}}]),t}(Pa);function PM(e){var r=OM();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function OM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kM=`in vec4 v_color;
in vec2 v_uv;// \u672C\u8EAB\u7684 uv \u5750\u6807
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,DM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,LM=function(e){(0,Qe.Z)(t,e);var r=PM(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"meter2coord",1),(0,N.Z)((0,we.Z)(n),"isMeter",!1),(0,N.Z)((0,we.Z)(n),"radian",0),(0,N.Z)((0,we.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.LINEAR,min:Y.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0}),n.textures=[n.texture]}),n}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,c=l===void 0?!1:l,p=i.unit,_=p===void 0?"pixel":p;this.rendererService.getDirty()&&this.texture.bind();var b={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(c),u_raisingHeight:Number(s),u_size_unit:p_[_],u_texture:this.texture};this.textures=[this.texture];var A=this.getUniformsBufferInfo(b);return A}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Z0)}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:DM,fragmentShader:kM,triangulation:Z0,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:jo(this.mapService.version)}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",shaderLocation:Qn.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.shape,p=l[c]||{x:-64,y:-64},_=p.x,b=p.y;return[_,b]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Un.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Qn.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(s,l,c,p){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=p%4*3;return[_[b],_[b+1],_[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}})}}]),t}(Pa);function BM(e){var r=FM();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function FM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NM=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,UM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,Jx=function(e){(0,Qe.Z)(t,e);var r=BM(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.LINEAR,min:Y.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,K.Z)(t,[{key:"getUninforms",value:function(){this.rendererService.getDirty()&&this.texture.bind();var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,c=l===void 0?!1:l,p={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(s),u_heightfixed:Number(c),u_texture:this.texture};this.textures=[this.texture];var _=this.getUniformsBufferInfo(p);return _}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:UM,fragmentShader:NM,triangulation:sC,inject:this.getInject(),depth:{enable:!1},primitive:Y.POINTS});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",shaderLocation:Qn.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.shape,p=l[c]||{x:-64,y:-64},_=p.x,b=p.y;return[_,b]}}})}}]),t}(Pa);function zM(e){var r=ZM();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function ZM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VM=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,jM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;
}
`;function eb(e){var r=e.coordinates;return{vertices:(0,Gt.Z)(r),indices:[0],size:r.length}}var tb=function(e){(0,Qe.Z)(t,e);var r=zM(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var i={u_size_scale:.5},a=this.getUniformsBufferInfo(i);return a}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=eb,this.initUniformsBuffer(),c.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:jM,fragmentShader:VM,triangulation:eb,inject:this.getInject(),depth:{enable:!1},primitive:Y.POINTS,pick:!1});case 4:return s=c.sent,c.abrupt("return",[s]);case 6:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Pa);function HM(e){var r=WM();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function WM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GM=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,XM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 11) in vec4 a_ExtrudeAndSize;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_ExtrudeAndSize.xyz;
  float newSize = setPickingSize(a_ExtrudeAndSize.w);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_ExtrudeAndSize.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_ExtrudeAndSize.w, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,$M=function(e){(0,Qe.Z)(t,e);var r=HM(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.blend,s=i.speed,l=s===void 0?1:s,c=i.unit,p=c===void 0?"pixel":c,_={u_additive:a==="additive"?1:0,u_size_unit:p_[p],u_speed:l,u_time:this.layer.getLayerAnimateTime()},b=this.getUniformsBufferInfo(_);return b}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Z0)}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:XM,fragmentShader:GM,triangulation:Z0,inject:this.getInject(),depth:{enable:!1}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrudeAndSize",type:Un.Attribute,descriptor:{name:"a_ExtrudeAndSize",shaderLocation:Qn.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(a,s,l,c){var p=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],_=c%4*3,b=a.size,A=b===void 0?5:b,w=Array.isArray(A)?A[0]:A;return[p[_],p[_+1],p[_+2],w]}}})}}]),t}(Pa);function YM(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=qM(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function qM(e,r){if(!!e){if(typeof e=="string")return rb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rb(e,r)}}function rb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var KM=function(){function e(r,t,n){(0,ge.Z)(this,e),(0,N.Z)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(r/n),this.yCellCount=Math.ceil(t/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=r,this.height=t,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,K.Z)(e,[{key:"insert",value:function(t,n,i,a,s){this.forEachCell(n,i,a,s,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(s)}},{key:"query",value:function(t,n,i,a,s){return this.queryHitTest(t,n,i,a,!1,s)}},{key:"hitTest",value:function(t,n,i,a,s){return this.queryHitTest(t,n,i,a,!0,s)}},{key:"insertBoxCell",value:function(t,n,i,a,s,l){this.boxCells[s].push(l)}},{key:"queryHitTest",value:function(t,n,i,a,s,l){if(i<0||t>this.width||a<0||n>this.height)return s?!1:[];var c=[];if(t<=0&&n<=0&&this.width<=i&&this.height<=a){if(s)return!0;for(var p=0;p<this.boxKeys.length;p++)c.push({key:this.boxKeys[p],x1:this.bboxes[p*4],y1:this.bboxes[p*4+1],x2:this.bboxes[p*4+2],y2:this.bboxes[p*4+3]});return l?c.filter(l):c}var _={hitTest:s,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,i,a,this.queryCell,c,_,l),s?c.length>0:c}},{key:"queryCell",value:function(t,n,i,a,s,l,c,p){var _=c.seenUids,b=this.boxCells[s];if(b!==null){var A=this.bboxes,w=YM(b),I;try{for(w.s();!(I=w.n()).done;){var P=I.value;if(!_.box[P]){_.box[P]=!0;var B=P*4;if(t<=A[B+2]&&n<=A[B+3]&&i>=A[B+0]&&a>=A[B+1]&&(!p||p(this.boxKeys[P]))){if(c.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[P],x1:A[B],y1:A[B+1],x2:A[B+2],y2:A[B+3]})}}}}catch(H){w.e(H)}finally{w.f()}}return!1}},{key:"forEachCell",value:function(t,n,i,a,s,l,c,p){for(var _=this.convertToXCellCoord(t),b=this.convertToYCellCoord(n),A=this.convertToXCellCoord(i),w=this.convertToYCellCoord(a),I=_;I<=A;I++)for(var P=b;P<=w;P++){var B=this.xCellCount*P+I;if(s.call(this,t,n,i,a,B,l,c,p))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),QM=KM,JM=function(){function e(r,t){(0,ge.Z)(this,e),(0,N.Z)(this,"viewportPadding",100),this.width=r,this.height=t,this.viewportPadding=Math.max(r,t),this.grid=new QM(r+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=r+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=r+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,K.Z)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,a=t.x2+t.anchorPointX+this.viewportPadding,s=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,a,s)||this.grid.hitTest(n,i,a,s)?{box:[]}:{box:[n,i,a,s]}}},{key:"insertCollisionBox",value:function(t,n){var i={featureIndex:n};this.grid.insert(i,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,i){var a=Gi(n,i,0,1),s=Pi(),l=Pr.apply(ye,(0,Gt.Z)(t));return Fl(s,a,l),{x:(s[0]/s[3]+1)/2*this.width+this.viewportPadding,y:(-s[1]/s[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}}]),e}();function nb(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=eI(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function eI(e,r){if(!!e){if(typeof e=="string")return ib(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ib(e,r)}}function ib(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ab(e){var r=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0;break;default:r=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:r,verticalAlign:t}}function ob(e,r,t,n,i){if(!!i){var a=e[n],s=a.glyph;if(s)for(var l=r[s].advance*a.scale,c=(e[n].x+l)*i,p=t;p<=n;p++)e[p].x-=c}}function sb(e,r,t,n,i,a,s){var l=(r-t)*i,c=(-n*s+.5)*a,p=nb(e),_;try{for(p.s();!(_=p.n()).done;){var b=_.value;b.x+=l,b.y+=c}}catch(A){p.e(A)}finally{p.f()}}function tI(e,r,t,n,i,a,s){var l=-8,c=0,p=l,_=0,b=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,w=b.length;t.forEach(function(Q){if(Q.split("").forEach(function(Ee){var Le=r[Ee],Ze=0;Le&&(b.push({glyph:Ee,x:c,y:p+Ze,vertical:!1,scale:1,metrics:Le}),c+=Le.advance+s)}),b.length!==w){var ue=c-s;_=Math.max(ue,_),ob(b,r,w,b.length-1,A)}c=0,p-=n+5});var I=ab(i),P=I.horizontalAlign,B=I.verticalAlign;sb(b,A,P,B,_,n,t.length);var H=p-l;e.top+=-B*H,e.bottom=e.top-H,e.left+=-P*_,e.right=e.left+_}function rI(e,r,t,n,i,a,s){var l=-8,c=0,p=l,_=0,b=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,w=b.length;t.forEach(function(Q){var ue=r[Q],Ee=0;if(ue&&(b.push({glyph:Q,x:ue.advance/2,y:p+Ee,vertical:!1,scale:1,metrics:ue}),c+=ue.advance+s),b.length!==w){var Le=c-s;_=Math.max(Le,_),ob(b,r,w,b.length-1,A)}c=0,p-=n+5});var I=ab(i),P=I.horizontalAlign,B=I.verticalAlign;sb(b,A,P,B,_,n,t.length);var H=p-l;e.top+=-B*H,e.bottom=e.top-H,e.left+=-P*_,e.right=e.left+_}function nI(e,r,t,n,i,a){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,c=e.split(`
`),p=[],_={positionedGlyphs:p,top:s[1],bottom:s[1],left:s[0],right:s[0],lineCount:c.length,text:e};return l?rI(_,r,c,t,n,i,a):tI(_,r,c,t,n,i,a),p.length?_:!1}function iI(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,a=[],s=nb(i),l;try{for(s.s();!(l=s.n()).done;){var c=l.value,p=c.metrics,_=4,b=p.advance*c.scale/2,A=t?[c.x+b,c.y]:[0,0],w=t?[0,0]:[c.x+b+r[0],c.y+r[1]],I=(0-_)*c.scale-b+w[0],P=(0-_)*c.scale+w[1],B=I+p.width*c.scale,H=P+p.height*c.scale,Q={x:I,y:P},ue={x:B,y:P},Ee={x:I,y:H},Le={x:B,y:H};a.push({tl:Q,tr:ue,bl:Ee,br:Le,tex:p,glyphOffset:A})}}catch(Ze){s.e(Ze)}finally{s.f()}return a}function aI(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=oI(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function oI(e,r){if(!!e){if(typeof e=="string")return ub(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ub(e,r)}}function ub(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function sI(e){var r=uI();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function uI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lb=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec4 v_color;
in vec4 v_stroke_color;
in vec2 v_uv;
in float v_gamma_scale;
in float v_fontScale;
out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,cb=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 14) in vec4 a_textUvAndOffsets;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;



#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_textUvAndOffsets.xy / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textUvAndOffsets.zw,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,Am=vi.isEqual;function fb(e){var r=this,t=e.id,n=[],i=[];if(!r.glyphInfoMap||!r.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var a=r.glyphInfoMap[t].centroid,s=a.length===2?[a[0],a[1],0]:a;return r.glyphInfoMap[t].glyphQuads.forEach(function(l,c){n.push.apply(n,(0,Gt.Z)(s).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,Gt.Z)(s),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,Gt.Z)(s),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,Gt.Z)(s),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),i.push(0+c*4,1+c*4,2+c*4,2+c*4,3+c*4,0+c*4)}),{vertices:n,indices:i,size:7}}var hb=function(e){(0,Qe.Z)(t,e);var r=sI(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"glyphInfoMap",{}),(0,N.Z)((0,we.Z)(n),"currentZoom",-1),(0,N.Z)((0,we.Z)(n),"textureHeight",0),(0,N.Z)((0,we.Z)(n),"textCount",0),(0,N.Z)((0,we.Z)(n),"preTextStyle",{}),(0,N.Z)((0,we.Z)(n),"mapping",(0,Nt.Z)(xe().mark(function l(){return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n.initGlyph(),n.updateTexture(),p.next=4,n.reBuildModel();case 4:case"end":return p.stop()}},l)}))),n}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption),{u_sdf_map:this.textures[0]})}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.stroke,s=a===void 0?"#fff":a,l=i.strokeWidth,c=l===void 0?0:l,p=i.halo,_=p===void 0?.5:p,b=i.gamma,A=b===void 0?2:b,w=i.raisingHeight,I=w===void 0?0:w,P=this.getFontServiceMapping(),B=this.getFontServiceCanvas();P&&Object.keys(P).length!==this.textCount&&B&&(this.updateTexture(),this.textCount=Object.keys(P).length),this.preTextStyle=this.getTextStyle();var H={u_stroke_color:li(s),u_sdf_map_size:[(B==null?void 0:B.width)||1,(B==null?void 0:B.height)||1],u_raisingHeight:Number(I),u_stroke_width:c,u_gamma_scale:A,u_halo_blur:_},Q=this.getUniformsBufferInfo(H);return Q}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 6:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.textAllowOverlap,c=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),c||this.filterGlyphs(),b.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:cb,fragmentShader:lb,inject:this.getInject(),triangulation:fb.bind(this),depth:{enable:!1}});case 6:return p=b.sent,b.abrupt("return",[p]);case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"needUpdate",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b,A,w,I,P,B,H;return xe().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(s=this.getTextStyle(),l=s.textAllowOverlap,c=l===void 0?!1:l,p=s.textAnchor,_=p===void 0?"center":p,b=s.textOffset,A=s.padding,w=s.fontFamily,I=s.fontWeight,!(!Am(A,this.preTextStyle.padding)||!Am(b,this.preTextStyle.textOffset)||!Am(_,this.preTextStyle.textAnchor)||!Am(w,this.preTextStyle.fontFamily)||!Am(I,this.preTextStyle.fontWeight))){ue.next=5;break}return ue.next=4,this.mapping();case 4:return ue.abrupt("return",!0);case 5:if(!c){ue.next=7;break}return ue.abrupt("return",!1);case 7:if(P=this.mapService.getZoom(),B=this.mapService.getBounds(),H=la(this.extent,B),!(Math.abs(this.currentZoom-P)>.5||!H||c!==this.preTextStyle.textAllowOverlap)){ue.next=14;break}return ue.next=13,this.reBuildModel();case 13:return ue.abrupt("return",!0);case 14:return ue.abrupt("return",!1);case 15:case"end":return ue.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textUvAndOffsets",type:Un.Attribute,descriptor:{name:"a_textUvAndOffsets",shaderLocation:Qn.UV,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(a,s,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?12:s;return Array.isArray(l)?[l[0]]:[l]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return su(i,.5)}},{key:"initTextFont",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,c=[];l.forEach(function(p){var _=p.shape,b=_===void 0?"":_;b=b.toString();var A=aI(b),w;try{for(A.s();!(w=A.n()).done;){var I=w.value;c.indexOf(I)===-1&&c.push(I)}}catch(P){A.e(P)}finally{A.f()}}),this.fontService.setFontOptions({characterSet:c,fontWeight:a,fontFamily:s,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,c=[];l.forEach(function(p){var _=p.shape,b=_===void 0?"":_;b="".concat(b),c.indexOf(b)===-1&&c.push(b)}),this.fontService.setFontOptions({characterSet:c,fontWeight:a,fontFamily:s,iconfont:!0})}},{key:"getTextStyle",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l,p=i.textAllowOverlap,_=p===void 0?!1:p,b=i.padding,A=b===void 0?[0,0]:b,w=i.textAnchor,I=w===void 0?"center":w,P=i.textOffset,B=P===void 0?[0,0]:P,H=i.opacity,Q=H===void 0?1:H,ue=i.strokeOpacity,Ee=ue===void 0?1:ue,Le=i.strokeWidth,Ze=Le===void 0?0:Le,tt=i.stroke,ft=tt===void 0?"#000":tt;return{fontWeight:s,fontFamily:c,textAllowOverlap:_,padding:A,textAnchor:I,textOffset:B,opacity:Q,strokeOpacity:Ee,strokeWidth:Ze,stroke:ft}}},{key:"generateGlyphLayout",value:function(i){var a=this,s=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),c=l.spacing,p=c===void 0?2:c,_=l.textAnchor,b=_===void 0?"center":_,A=l.textOffset,w=this.rawEncodeData;this.glyphInfo=w.map(function(I){var P=I.shape,B=P===void 0?"":P,H=I.id,Q=I.size,ue=Q===void 0?1:Q,Ee=I.textOffset?I.textOffset:A||[0,0],Le=I.textAnchor?I.textAnchor:b||"center",Ze=nI(B.toString(),s,ue,Le,"left",p,Ee,i),tt=iI(Ze,Ee,!1);return I.shaping=Ze,I.glyphQuads=tt,I.centroid=qs(I.coordinates),I.originCentroid=I.version==="GAODE2.x"?qs(I.originCoordinates):I.originCentroid=I.centroid,a.glyphInfoMap[H]={shaping:Ze,glyphQuads:tt,centroid:qs(I.coordinates)},I})}},{key:"getFontServiceMapping",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(c,"_").concat(s))}},{key:"getFontServiceCanvas",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(c,"_").concat(s))}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.padding,l=s===void 0?[0,0]:s,c=a.textAllowOverlap,p=c===void 0?!1:c;if(!p){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var _=this.rendererService.getViewportSize(),b=_.width,A=_.height,w=new JM(b,A),I=this.glyphInfo.filter(function(P){var B=P.shaping,H=P.id,Q=H===void 0?0:H,ue=P.version==="GAODE2.x"?P.originCentroid:P.centroid,Ee=P.size,Le=Ee/16,Ze=i.mapService.lngLatToContainer(ue),tt=w.placeCollisionBox({x1:B.left*Le-l[0],x2:B.right*Le+l[0],y1:B.top*Le-l[1],y2:B.bottom*Le+l[1],anchorPointX:Ze.x,anchorPointY:Ze.y}),ft=tt.box;return ft&&ft.length?(w.insertCollisionBox(ft,Q),!0):!1});I.forEach(function(P){i.glyphInfoMap[P.id]=P})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,s=a===void 0?!1:a;s?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(s)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.getFontServiceCanvas();this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:Y.LINEAR,min:Y.LINEAR,width:a.width,height:a.height}),this.textures=[this.texture]}},{key:"reBuildModel",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.filterGlyphs(),c.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:cb,fragmentShader:lb,triangulation:fb.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:s=c.sent,this.layer.models=[s];case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Pa),lI={fillImage:LM,fill:Qx,radar:$M,image:Jx,normal:tb,simplePoint:fM,extrude:Kx,text:hb,earthFill:EM,earthExtrude:gM},cI=lI;function fI(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=hI(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function hI(e,r){if(!!e){if(typeof e=="string")return pb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return pb(e,r)}}function pb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function pI(e){var r=dI();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function dI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H0=function(e){(0,Qe.Z)(t,e);var r=pI(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"type","PointLayer"),(0,N.Z)((0,we.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),(0,N.Z)((0,we.Z)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,N.Z)((0,we.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,K.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new cI[s](this),c.next=5,this.initLayerModels();case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,a=i.field,s=i.values,l=this.getLayerConfig(),c=l.shape2d,p=this.iconService.getIconMap();if(a&&(c==null?void 0:c.indexOf(a))!==-1)return"fill";if(s==="text")return"text";if(s&&s instanceof Array){var _=fI(s),b;try{for(_.s();!(b=_.n()).done;){var A=b.value;if(typeof A=="string"&&p.hasOwnProperty(A))return"image"}}catch(w){_.e(w)}finally{_.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,c=a.billboard,p=c===void 0?!0:c,_=this.iconService.getIconMap(),b=i.find(function(w){return w.hasOwnProperty("shape")});if(b){var A=b.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"||p===!1?"fillImage":(s==null?void 0:s.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":_.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Cp);function vI(e){var r=mI();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function mI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gI=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,_I=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,yI=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;


#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  }
  

  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,xI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

out vec2 v_texture_data;
out vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;
   
  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,bI=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,EI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec2 v_texture_data;
out vec3 v_uvs;
out vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,SI=function(e){(0,Qe.Z)(t,e);var r=vI(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.heightfixed,s=a===void 0?!1:a,l=i.raisingHeight,c=l===void 0?0:l,p=i.topsurface,_=p===void 0?!0:p,b=i.sidesurface,A=b===void 0?!0:b,w=i.sourceColor,I=i.targetColor,P=0,B=[1,1,1,1],H=[1,1,1,1];w&&I&&(B=li(w),H=li(I),P=1);var Q={u_sourceColor:B,u_targetColor:H,u_linearColor:P,u_topsurface:Number(_),u_sidesurface:Number(A),u_heightfixed:Number(s),u_raisingHeight:Number(c),u_texture:this.texture};this.texture&&(this.textures=[this.texture]);var ue=this.getUniformsBufferInfo(Q);return ue}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_;return xe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=this.getShaders(),l=s.frag,c=s.vert,p=s.type,this.initUniformsBuffer(),A.next=4,this.layer.buildLayerModel({moduleName:p,vertexShader:c,fragmentShader:l,depth:{enable:!0},inject:this.getInject(),triangulation:f_});case 4:return _=A.sent,A.abrupt("return",[_]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.pickLight,s=i.mapTexture;return s?{frag:yI,vert:xI,type:"polygonExtrudeTexture"}:a?{frag:bI,vert:EI,type:"polygonExtrudePickLight"}:{frag:gI,vert:_I,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.textures=[]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=i,s=this.layer.coordCenter||this.layer.getSource().center,l=a[2]-a[0],c=a[3]-a[1];if(this.mapService.version==="GAODE2.x"){var p=this.mapService.coordToAMap2RelativeCoordinates([i[0],i[1]],s),_=(0,re.Z)(p,2),b=_[0],A=_[1],w=this.mapService.coordToAMap2RelativeCoordinates([i[2],i[3]],s),I=(0,re.Z)(w,2),P=I[0],B=I[1];l=P-b,c=B-A,a=[b,A,P,B]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Un.Attribute,descriptor:{name:"a_uvs",shaderLocation:Qn.UV,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(Q,ue,Ee){var Le=Ee[0],Ze=Ee[1];return[(Le-a[0])/l,(Ze-a[1])/c,Ee[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(Q,ue,Ee,Le,Ze){return Ze}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(Q){var ue=Q.size,Ee=ue===void 0?10:ue;return Array.isArray(Ee)?[Ee[0]]:[Ee]}}})}},{key:"loadTexture",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s=this,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(l=this.layer.getLayerConfig(),c=l.mapTexture,p=this.rendererService.createTexture2D,this.texture=p({height:0,width:0}),!c){b.next=5;break}return b.abrupt("return",new Promise(function(A,w){var I=new Image;I.crossOrigin="anonymous",I.src=c,I.onload=function(){return s.texture=p({data:I,width:I.width,height:I.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.LINEAR,mag:Y.LINEAR}),A(null)},I.onerror=function(){w(new Error("image load error"))}}));case 5:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Pa);function AI(e){var r=TI();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function TI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wI=`
in vec4 v_Color;
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,CI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos);
   float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,RI=function(e){(0,Qe.Z)(t,e);var r=AI(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i={},a=this.getUniformsBufferInfo(i);return a}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_;return xe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=this.getShaders(),l=s.frag,c=s.vert,p=s.type,this.initUniformsBuffer(),A.next=4,this.layer.buildLayerModel({moduleName:p,vertexShader:c,fragmentShader:l,inject:this.getInject(),triangulation:f_,depth:{enable:!0}});case 4:return _=A.sent,A.abrupt("return",[_]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:wI,vert:CI,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Pa);function MI(e){var r=II();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function II(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PI=`in vec4 v_color;
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,OI=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec3 v_linear;
in vec2 v_pos;
in vec4 v_color;
out vec4 outputColor;
#pragma include "picking"

void main() {
   outputColor = v_color;
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,kI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 15) in vec3 a_linear;


layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};


out vec4 v_color;

#pragma include "projection"
#pragma include "picking"

out vec3 v_linear;
out vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,DI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};


out vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,LI=function(e){(0,Qe.Z)(t,e);var r=MI(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.opacityLinear,c=l===void 0?{enable:!1,dir:"in"}:l,p={u_raisingHeight:Number(s),u_opacitylinear:Number(c.enable),u_dir:c.dir==="in"?1:0},_=this.getUniformsBufferInfo(p);return _}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b;return xe().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return s=this.getModelParams(),l=s.frag,c=s.vert,p=s.triangulation,_=s.type,this.initUniformsBuffer(),this.layer.triangulation=p,w.next=5,this.layer.buildLayerModel({moduleName:_,vertexShader:c,fragmentShader:l,inject:this.getInject(),triangulation:p,primitive:Y.TRIANGLES,depth:{enable:!1}});case 5:return b=w.sent,w.abrupt("return",[b]);case 7:case"end":return w.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1,dir:"in"}:a;s.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Un.Attribute,descriptor:{name:"a_linear",shaderLocation:Qn.LINEAR,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(c,p,_){return[_[3],_[4],_[5]]}}})}},{key:"getModelParams",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1}:a;return s.enable?{frag:OI,vert:kI,type:"polygonLinear",triangulation:hC}:{frag:PI,vert:DI,type:"polygonFill",triangulation:yh}}}]),t}(Pa);function BI(e){var r=FI();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function FI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NI=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,UI=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};


out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,BN=vi.isNumber,zI=function(e){(0,Qe.Z)(t,e);var r=BI(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.watercolor,s=a===void 0?"#6D99A8":a,l=i.watercolor2,c=l===void 0?"#0F121C":l,p={u_watercolor:li(s),u_watercolor2:li(c),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};this.textures=[this.texture1,this.texture2,this.texture3];var _=this.getUniformsBufferInfo(p);return _}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:UI,fragmentShader:NI,inject:this.getInject(),triangulation:c_,primitive:Y.TRIANGLES,depth:{enable:!1}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a,s;(i=this.texture1)===null||i===void 0||i.destroy(),(a=this.texture2)===null||a===void 0||a.destroy(),(s=this.texture3)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,re.Z)(i,4),s=a[0],l=a[1],c=a[2],p=a[3],_=c-s,b=p-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Un.Attribute,descriptor:{name:"a_uv",shaderLocation:Qn.UV,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(w,I,P,B){var H=w.version==="GAODE2.x"?w.originCoordinates[0][B]:P,Q=(0,re.Z)(H,2),ue=Q[0],Ee=Q[1];return[(ue-s)/_,(Ee-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.rendererService.createTexture2D,s={height:0,width:0};this.texture1=a(s),this.texture2=a(s),this.texture3=a(s),l(function(p){i.texture1=c(p[0]),i.texture2=c(p[1]),i.texture3=c(p[2]),i.layerService.reRender()});function l(p){var _=0,b=[],A=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];A.map(function(w){var I=new Image;I.crossOrigin="",I.src=w,b.push(I),I.onload=function(){_++,_===3&&p(b)}})}function c(p){return a({data:p,width:p.width,height:p.height,wrapS:Y.MIRRORED_REPEAT,wrapT:Y.MIRRORED_REPEAT,min:Y.LINEAR,mag:Y.LINEAR})}}}]),t}(Pa);function ZI(e){var r=VI();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function VI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jI=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,HI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 14) in vec2 a_uv;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;


#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,FN=vi.isNumber,WI=function(e){(0,Qe.Z)(t,e);var r=ZI(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.speed,s=a===void 0?.5:a,l={u_speed:s,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};this.textures=[this.texture];var c=this.getUniformsBufferInfo(l);return c}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:HI,fragmentShader:jI,triangulation:c_,inject:this.getInject(),primitive:Y.TRIANGLES,depth:{enable:!1}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,re.Z)(i,4),s=a[0],l=a[1],c=a[2],p=a[3],_=c-s,b=p-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Un.Attribute,descriptor:{name:"a_uv",shaderLocation:Qn.UV,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(w,I,P,B){var H=w.version==="GAODE2.x"?w.originCoordinates[0][B]:P,Q=(0,re.Z)(H,2),ue=Q[0],Ee=Q[1];return[(ue-s)/_,(Ee-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var c=new Image;c.crossOrigin="",s?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),c.src=s):c.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",c.onload=function(){i.texture=l({data:c,width:c.width,height:c.height,wrapS:Y.MIRRORED_REPEAT,wrapT:Y.MIRRORED_REPEAT,min:Y.LINEAR,mag:Y.LINEAR}),i.layerService.reRender()}}}]),t}(Pa),GI={fill:LI,line:Yx,extrude:SI,text:hb,point_fill:Qx,point_image:Jx,point_normal:tb,point_extrude:Kx,water:WI,ocean:zI,extrusion:RI},XI=GI;function $I(e){var r=YI();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function YI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tm=function(e){(0,Qe.Z)(t,e);var r=$I(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"type","PolygonLayer"),(0,N.Z)((0,we.Z)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return(0,K.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new XI[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s==="fill"||!s?"fill":s==="extrude"?"extrude":s==="extrusion"?"extrusion":s==="water"?"water":s==="ocean"?"ocean":s==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,c=this.iconService.getIconMap(),p=i.find(function(b){return b.hasOwnProperty("shape")});if(p){var _=p.shape;return _==="dot"?"point_normal":(s==null?void 0:s.indexOf(_))!==-1?"point_fill":(l==null?void 0:l.indexOf(_))!==-1?"point_extrude":c.hasOwnProperty(_)?"point_image":"text"}else return"fill"}}]),t}(Cp);function qI(e){var r=KI();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function KI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QI=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  bool u_clampLow;
  bool u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r * 255.0;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,JI=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  bool u_clampLow;
  bool u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,db=function(e){(0,Qe.Z)(t,e);var r=qI(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.clampLow,c=l===void 0?!0:l,p=i.clampHigh,_=p===void 0?!0:p,b=i.noDataValue,A=b===void 0?-9999999:b,w=i.domain,I=i.rampColors,P=w||Da(I);this.colorTexture=this.layer.textureService.getColorTexture(I,P);var B={u_domain:P,u_opacity:s||1,u_noDataValue:A,u_clampLow:c,u_clampHigh:typeof _!="undefined"?_:c,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};this.textures=[this.texture,this.colorTexture];var H=this.getUniformsBufferInfo(B);return H}},{key:"getRasterData",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s){var l,c,p,_;return xe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!Array.isArray(s.data)){A.next=4;break}return A.abrupt("return",{data:s.data,width:s.width,height:s.height});case 4:return A.next=6,s.data;case 6:return l=A.sent,c=l.rasterData,p=l.width,_=l.height,A.abrupt("return",{data:Array.from(c),width:p,height:_});case 11:case"end":return A.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b,A,w;return xe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService.createTexture2D,c=s.data.dataArray[0],P.next=6,this.getRasterData(c);case 6:return p=P.sent,_=p.data,b=p.width,A=p.height,this.texture=l({data:new Uint8Array(_),width:b,height:A,format:Y.LUMINANCE,type:Y.UNSIGNED_BYTE,alignment:1}),P.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:JI,fragmentShader:QI,triangulation:V0,primitive:Y.TRIANGLES,depth:{enable:!1}});case 13:return w=P.sent,P.abrupt("return",[w]);case 15:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.colorTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{shaderLocation:Qn.UV,name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Pa),eP=["data"],tP=["rasterData"];function rP(e){var r=nP();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function nP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iP=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(outputColor.a < 0.01)
    discard;
 
}`,aP=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,oP=function(e){(0,Qe.Z)(t,e);var r=rP(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"dataOption",{}),n}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.noDataValue,c=l===void 0?0:l,p=this.dataOption,_=p.rMinMax,b=_===void 0?[0,255]:_,A=p.gMinMax,w=A===void 0?[0,255]:A,I=p.bMinMax,P=I===void 0?[0,255]:I,B={u_rminmax:b,u_gminmax:w,u_bminmax:P,u_opacity:s||1,u_noDataValue:c,u_texture:this.texture};this.textures=[this.texture];var H=this.getUniformsBufferInfo(B);return H}},{key:"getRasterData",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s){var l,c,p,_,b;return xe().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!Array.isArray(s.data)){w.next=4;break}return l=s.data,c=(0,yl.Z)(s,eP),this.dataOption=c,w.abrupt("return",(0,k.Z)({data:l},c));case 4:return w.next=6,s.data;case 6:if(p=w.sent,_=p.rasterData,b=(0,yl.Z)(p,tP),this.dataOption=b,!Array.isArray(_)){w.next=14;break}return w.abrupt("return",(0,k.Z)({data:_},b));case 14:return w.abrupt("return",(0,k.Z)({data:Array.from(_)},b));case 15:case"end":return w.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b,A,w;return xe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService.createTexture2D,c=s.data.dataArray[0],P.next=6,this.getRasterData(c);case 6:return p=P.sent,_=p.data,b=p.width,A=p.height,this.texture=l({data:new Float32Array(_),width:b,height:A,format:Y.RGB,type:Y.FLOAT}),P.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:aP,fragmentShader:iP,triangulation:V0,primitive:Y.TRIANGLES,depth:{enable:!1}});case 13:return w=P.sent,P.abrupt("return",[w]);case 15:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",shaderLocation:Qn.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Pa);function sP(e){var r=uP();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function uP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lP=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,cP=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,fP=function(e){(0,Qe.Z)(t,e);var r=sP(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.clampLow,l=s===void 0?!0:s,c=i.clampHigh,p=c===void 0?!0:c,_=i.noDataValue,b=_===void 0?-9999999:_,A=i.domain,w=i.rampColors,I=i.colorTexture,P=i.rScaler,B=P===void 0?6553.6:P,H=i.gScaler,Q=H===void 0?25.6:H,ue=i.bScaler,Ee=ue===void 0?.1:ue,Le=i.offset,Ze=Le===void 0?1e4:Le,tt=A||Da(w),ft=I;return I?this.layer.textureService.setColorTexture(I,w,tt):ft=this.layer.textureService.getColorTexture(w,tt),{u_opacity:a||1,u_texture:this.texture,u_domain:tt,u_clampLow:l,u_clampHigh:typeof p!="undefined"?p:l,u_noDataValue:b,u_unpack:[B,Q,Ee,Ze],u_colorTexture:ft}}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getSource(),l=this.rendererService.createTexture2D,b.next=4,s.data.images;case 4:return c=b.sent,this.texture=l({data:c[0],width:c[0].width,height:c[0].height,min:Y.LINEAR,mag:Y.LINEAR}),b.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:cP,fragmentShader:lP,triangulation:V0,primitive:Y.TRIANGLES,depth:{enable:!1}});case 8:return p=b.sent,b.abrupt("return",[p]);case 10:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Pa),hP={raster:db,rasterRgb:oP,raster3d:db,rasterTerrainRgb:fP},pP=hP;function dP(e){var r=vP();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function vP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W0=function(e){(0,Qe.Z)(t,e);var r=dP(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"type","RasterLayer"),n}return(0,K.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new pP[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();switch(i){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),t}(Cp);function mP(e){var r=gP();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function gP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _P=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,yP=`layout(location = 0) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,xP=function(e){(0,Qe.Z)(t,e);var r=mP(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,k.Z)((0,k.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.color,c=l===void 0?"#000":l,p={u_color:li(c),u_opacity:s||1},_=this.getUniformsBufferInfo(p);return _}},{key:"initModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"mask",vertexShader:yP,fragmentShader:_P,triangulation:c_,depth:{enable:!1},pick:!1});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(Pa),bP={fill:xP},EP=bP;function SP(e){var r=AP();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function AP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vb=function(e){(0,Qe.Z)(t,e);var r=SP(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"type","MaskLayer"),n}return(0,K.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new EP[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){return"fill"}}]),t}(Cp),mb,gb,_b,yb,G0,xb,bb,TP=vi.cloneDeep,wP=(mb=(0,Jt.b2)(),gb=(0,Jt.f3)(Ye.IMapService),_b=(0,Jt.f3)(Ye.IFontService),mb(yb=(G0=function(){function e(){(0,ge.Z)(this,e),qr(this,"mapService",xb,this),qr(this,"fontService",bb,this)}return(0,K.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",(0,Nt.Z)(xe().mark(function s(){return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:t.log(Ts.MappingStart,jt.INIT),i.generateMaping(t,{styleAttributeService:a}),t.log(Ts.MappingEnd,jt.INIT);case 3:case"end":return c.stop()}},s)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var s=(0,Nt.Z)(xe().mark(function l(c){var p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(c){b.next=2;break}return b.abrupt("return",c);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(Ts.MappingStart,jt.UPDATE),p=i.generateMaping(t,{styleAttributeService:a}),t.log(Ts.MappingEnd,jt.UPDATE),b.abrupt("return",p);case 7:case"end":return b.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var s=t.getSource();if(!(t.layerModelNeedUpdate||!s||!s.inited)){var l=a.getLayerStyleAttributes()||[],c=a.getLayerStyleAttribute("filter"),p=s.data.dataArray;if(!(Array.isArray(p)&&p.length===0)){var _=l.filter(function(w){return w.needRemapping}),b=p;if(c!=null&&c.needRemapping&&c!==null&&c!==void 0&&c.scale&&(b=p.filter(function(w){return i.applyAttributeMapping(c,w)[0]})),_.length){var A=i.mapping(t,_,b,t.getEncodedData());t.setEncodedData(A)}}}})}},{key:"generateMaping",value:function(t,n){var i=this,a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],l=a.getLayerStyleAttribute("filter"),c=t.getSource().data.dataArray,p=c;l!=null&&l.scale&&(p=c.filter(function(b){return i.applyAttributeMapping(l,b)[0]})),p=t.processData(p);var _=this.mapping(t,s,p,void 0);return t.setEncodedData(_),t.emit("dataUpdate",null),!0}},{key:"mapping",value:function(t,n,i,a){var s=this,l=n.filter(function(p){return p.scale!==void 0}).filter(function(p){return p.name!=="filter"}),c=i.map(function(p,_){var b=a?a[_]:{},A=(0,k.Z)({id:p._id,coordinates:p.coordinates},b);return l.forEach(function(w){var I=s.applyAttributeMapping(w,p);(w.name==="color"||w.name==="stroke")&&(I=I.map(function(P){return li(P)})),A[w.name]=Array.isArray(I)&&I.length===1?I[0]:I,w.name==="shape"&&(A.shape=s.fontService.getIconFontKey(A[w.name]))}),A});return n.forEach(function(p){p.needRemapping=!1}),this.adjustData2Amap2Coordinates(c,t),this.adjustData2SimpleCoordinates(c),c}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var i=this;if(t.length>0&&this.mapService.version==="GAODE2.x"){var a=n.coordCenter||n.getSource().center;t.filter(function(s){return!s.originCoordinates}).map(function(s){s.version="GAODE2.x",s.originCoordinates=TP(s.coordinates),s.coordinates=i.mapService.coordToAMap2RelativeCoordinates(s.coordinates,a)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version==="SIMPLE"&&t.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var i=[];return t.map(function(s){var l=[];s.map(function(c){l.push(n.mapService.simpleMapCoord.unproject(c))}),i.push(l)}),i}else{var a=[];return t.map(function(s){a.push(n.mapService.simpleMapCoord.unproject(s))}),a}}},{key:"applyAttributeMapping",value:function(t,n){var i;if(!t.scale)return[];var a=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],s=[];a.forEach(function(c){var p,_=c.field;(n.hasOwnProperty(_)||((p=t.scale)===null||p===void 0?void 0:p.type)==="variable")&&s.push(n[_])});var l=t.mapping?t.mapping(s):[];return l}},{key:"getArrowPoints",value:function(t,n){var i=[n[0]-t[0],n[1]-t[1]],a=Vu(i),s=[t[0]+a[0]*1e-4,t[1]+a[1]*1e-4];return s}}]),e}(),xb=Cr(G0.prototype,"mapService",[gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bb=Cr(G0.prototype,"fontService",[_b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G0))||yb),Eb,Sb,CP=(Eb=(0,Jt.b2)(),Eb(Sb=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(Ye.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",(0,Nt.Z)(xe().mark(function i(){var a,s,l,c;return xe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(t.log(Ts.SourceInitStart,jt.INIT),a=t.getSource(),a||(s=t.sourceOption||t.defaultSourceConfig,l=s.data,c=s.options,a=new ix(l,c),t.setSource(a)),!a.inited){_.next=8;break}n.updateClusterData(t),t.log(Ts.SourceInitEnd,jt.INIT),_.next=10;break;case 8:return _.next=10,new Promise(function(b){a.on("update",function(A){A.type==="inited"&&(n.updateClusterData(t),t.log(Ts.SourceInitEnd,jt.INIT)),b(null)})});case 10:case"end":return _.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,Nt.Z)(xe().mark(function i(){var a,s,l;return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return a=n.updateClusterData(t),s=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,l=a||s,p.abrupt("return",l);case 5:case"end":return p.stop()}},i)})))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var n=t.getSource(),i=n.cluster,a=n.clusterOptions.zoom,s=a===void 0?0:a,l=this.mapService.getZoom()-1,c=t.dataState.dataSourceNeedUpdate;return i&&c&&n.updateClusterData(Math.floor(l)),i&&Math.abs(t.clusterZoom-l)>=1?(s!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),t.clusterZoom=l,!0):!1}}]),e}())||Sb);function v_(e,r){return e<r?-1:e>r?1:e>=r?0:NaN}function Ab(e){return e.length===1&&(e=RP(e)),{left:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)<0?n=a+1:i=a}return n},right:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)>0?i=a:n=a+1}return n}}}function RP(e){return function(r,t){return v_(e(r),t)}}var Tb=Ab(v_),MP=Tb.right,NN=Tb.left,X0=MP;function wb(e,r){var t=e.length,n=-1,i,a,s;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=s=i;++n<t;)(i=e[n])!=null&&(a>i&&(a=i),s<i&&(s=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=s=i;++n<t;)(i=r(e[n],n,e))!=null&&(a>i&&(a=i),s<i&&(s=i));return[a,s]}var Cb=Array.prototype,UN=Cb.slice,zN=Cb.map,m_=Math.sqrt(50),g_=Math.sqrt(10),__=Math.sqrt(2);function Rb(e,r,t){var n,i=-1,a,s,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(l=$0(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),s=new Array(a=Math.ceil(r-e+1));++i<a;)s[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),s=new Array(a=Math.ceil(e-r+1));++i<a;)s[i]=(e-i)/l;return n&&s.reverse(),s}function $0(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=m_?10:a>=g_?5:a>=__?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=m_?10:a>=g_?5:a>=__?2:1)}function y_(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=m_?i*=10:a>=g_?i*=5:a>=__&&(i*=2),r<e?-i:i}function ZN(){var e=identity,r=extent,t=sturges;function n(i){var a,s=i.length,l,c=new Array(s);for(a=0;a<s;++a)c[a]=e(i[a],a,i);var p=r(c),_=p[0],b=p[1],A=t(c,_,b);Array.isArray(A)||(A=tickStep(_,b,A),A=range(Math.ceil(_/A)*A,b,A));for(var w=A.length;A[0]<=_;)A.shift(),--w;for(;A[w-1]>b;)A.pop(),--w;var I=new Array(w+1),P;for(a=0;a<=w;++a)P=I[a]=[],P.x0=a>0?A[a-1]:_,P.x1=a<w?A[a]:b;for(a=0;a<s;++a)l=c[a],_<=l&&l<=b&&I[bisect(A,l,0,w)].push(i[a]);return I}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:constant(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:constant([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?constant(slice.call(i)):constant(i),n):t},n}function VN(e,r,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-r)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function IP(e){return e===null?NaN:+e}function PP(e,r,t){if(t==null&&(t=IP),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,a=Math.floor(i),s=+t(e[a],a,e),l=+t(e[a+1],a+1,e);return s+(l-s)*(i-a)}}var OP=Z(87765),Uc="$";function Y0(){}Y0.prototype=Mb.prototype={constructor:Y0,has:function(e){return Uc+e in this},get:function(e){return this[Uc+e]},set:function(e,r){return this[Uc+e]=r,this},remove:function(e){var r=Uc+e;return r in this&&delete this[r]},clear:function(){for(var e in this)e[0]===Uc&&delete this[e]},keys:function(){var e=[];for(var r in this)r[0]===Uc&&e.push(r.slice(1));return e},values:function(){var e=[];for(var r in this)r[0]===Uc&&e.push(this[r]);return e},entries:function(){var e=[];for(var r in this)r[0]===Uc&&e.push({key:r.slice(1),value:this[r]});return e},size:function(){var e=0;for(var r in this)r[0]===Uc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Uc)return!1;return!0},each:function(e){for(var r in this)r[0]===Uc&&e(this[r],r.slice(1),this)}};function Mb(e,r){var t=new Y0;if(e instanceof Y0)e.each(function(l,c){t.set(c,l)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(r==null)for(;++n<i;)t.set(n,e[n]);else for(;++n<i;)t.set(r(a=e[n],n,e),a)}else if(e)for(var s in e)t.set(s,e[s]);return t}var x_=Mb;function jN(){var e=[],r=[],t,n,i;function a(l,c,p,_){if(c>=e.length)return t!=null&&l.sort(t),n!=null?n(l):l;for(var b=-1,A=l.length,w=e[c++],I,P,B=map(),H,Q=p();++b<A;)(H=B.get(I=w(P=l[b])+""))?H.push(P):B.set(I,[P]);return B.each(function(ue,Ee){_(Q,Ee,a(ue,c,p,_))}),Q}function s(l,c){if(++c>e.length)return l;var p,_=r[c-1];return n!=null&&c>=e.length?p=l.entries():(p=[],l.each(function(b,A){p.push({key:A,values:s(b,c)})})),_!=null?p.sort(function(b,A){return _(b.key,A.key)}):p}return i={object:function(l){return a(l,0,kP,DP)},map:function(l){return a(l,0,Ib,Pb)},entries:function(l){return s(a(l,0,Ib,Pb),0)},key:function(l){return e.push(l),i},sortKeys:function(l){return r[e.length-1]=l,i},sortValues:function(l){return t=l,i},rollup:function(l){return n=l,i}}}function kP(){return{}}function DP(e,r,t){e[r]=t}function Ib(){return map()}function Pb(e,r,t){e.set(r,t)}function q0(){}var yd=x_.prototype;q0.prototype=LP.prototype={constructor:q0,has:yd.has,add:function(e){return e+="",this[Uc+e]=e,this},remove:yd.remove,clear:yd.clear,values:yd.keys,size:yd.size,empty:yd.empty,each:yd.each};function LP(e,r){var t=new q0;if(e instanceof q0)e.each(function(a){t.add(a)});else if(e){var n=-1,i=e.length;if(r==null)for(;++n<i;)t.add(e[n]);else for(;++n<i;)t.add(r(e[n],n,e))}return t}var HN=null,Ob=Array.prototype,kb=Ob.map,xd=Ob.slice;function Ip(e,r){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(r).domain(e);break}return this}function Db(e,r){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(r).domain(e);break}return this}var Lb={name:"implicit"};function K0(){var e=x_(),r=[],t=[],n=Lb;function i(a){var s=a+"",l=e.get(s);if(!l){if(n!==Lb)return n;e.set(s,l=r.push(a))}return t[(l-1)%t.length]}return i.domain=function(a){if(!arguments.length)return r.slice();r=[],e=x_();for(var s=-1,l=a.length,c,p;++s<l;)e.has(p=(c=a[s])+"")||e.set(p,r.push(c));return i},i.range=function(a){return arguments.length?(t=xd.call(a),i):t.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return K0(r,t).unknown(n)},Ip.apply(i,arguments),i}function Bb(){var e=ordinal().unknown(void 0),r=e.domain,t=e.range,n=[0,1],i,a,s=!1,l=0,c=0,p=.5;delete e.unknown;function _(){var b=r().length,A=n[1]<n[0],w=n[A-0],I=n[1-A];i=(I-w)/Math.max(1,b-l+c*2),s&&(i=Math.floor(i)),w+=(I-w-i*(b-l))*p,a=i*(1-l),s&&(w=Math.round(w),a=Math.round(a));var P=sequence(b).map(function(B){return w+i*B});return t(A?P.reverse():P)}return e.domain=function(b){return arguments.length?(r(b),_()):r()},e.range=function(b){return arguments.length?(n=[+b[0],+b[1]],_()):n.slice()},e.rangeRound=function(b){return n=[+b[0],+b[1]],s=!0,_()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(b){return arguments.length?(s=!!b,_()):s},e.padding=function(b){return arguments.length?(l=Math.min(1,c=+b),_()):l},e.paddingInner=function(b){return arguments.length?(l=Math.min(1,b),_()):l},e.paddingOuter=function(b){return arguments.length?(c=+b,_()):c},e.align=function(b){return arguments.length?(p=Math.max(0,Math.min(1,b)),_()):p},e.copy=function(){return Bb(r(),n).round(s).paddingInner(l).paddingOuter(c).align(p)},initRange.apply(_(),arguments)}function Fb(e){var r=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Fb(r())},e}function WN(){return Fb(Bb.apply(null,arguments).paddingInner(1))}var BP=Z(21775),FP=Z(73626);function NP(e,r){return e=+e,r=+r,function(t){return Math.round(e*(1-t)+r*t)}}function UP(e){return function(){return e}}function zP(e){return+e}var Nb=[0,1];function Ku(e){return e}function b_(e,r){return(r-=e=+e)?function(t){return(t-e)/r}:UP(isNaN(r)?NaN:.5)}function Ub(e){var r=e[0],t=e[e.length-1],n;return r>t&&(n=r,r=t,t=n),function(i){return Math.max(r,Math.min(t,i))}}function ZP(e,r,t){var n=e[0],i=e[1],a=r[0],s=r[1];return i<n?(n=b_(i,n),a=t(s,a)):(n=b_(n,i),a=t(a,s)),function(l){return a(n(l))}}function VP(e,r,t){var n=Math.min(e.length,r.length)-1,i=new Array(n),a=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),r=r.slice().reverse());++s<n;)i[s]=b_(e[s],e[s+1]),a[s]=t(r[s],r[s+1]);return function(l){var c=X0(e,l,1,n)-1;return a[c](i[c](l))}}function Q0(e,r){return r.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function E_(){var e=Nb,r=Nb,t=BP.Z,n,i,a,s=Ku,l,c,p;function _(){return l=Math.min(e.length,r.length)>2?VP:ZP,c=p=null,b}function b(A){return isNaN(A=+A)?a:(c||(c=l(e.map(n),r,t)))(n(s(A)))}return b.invert=function(A){return s(i((p||(p=l(r,e.map(n),FP.Z)))(A)))},b.domain=function(A){return arguments.length?(e=kb.call(A,zP),s===Ku||(s=Ub(e)),_()):e.slice()},b.range=function(A){return arguments.length?(r=xd.call(A),_()):r.slice()},b.rangeRound=function(A){return r=xd.call(A),t=NP,_()},b.clamp=function(A){return arguments.length?(s=A?Ub(e):Ku,b):s!==Ku},b.interpolate=function(A){return arguments.length?(t=A,_()):t},b.unknown=function(A){return arguments.length?(a=A,b):a},function(A,w){return n=A,i=w,_()}}function zb(e,r){return E_()(e,r)}var jP=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function J0(e){if(!(r=jP.exec(e)))throw new Error("invalid format: "+e);var r;return new S_({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}J0.prototype=S_.prototype;function S_(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}S_.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function HP(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function eg(e,r){if((t=(e=r?e.toExponential(r-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}function mv(e){return e=eg(Math.abs(e)),e?e[1]:NaN}function WP(e,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(mv(r)/3)))*3-mv(Math.abs(e)))}function GP(e,r){return function(t,n){for(var i=t.length,a=[],s=0,l=e[0],c=0;i>0&&l>0&&(c+l+1>n&&(l=Math.max(1,n-c)),a.push(t.substring(i-=l,i+l)),!((c+=l+1)>n));)l=e[s=(s+1)%e.length];return a.reverse().join(r)}}function XP(e){return function(r){return r.replace(/[0-9]/g,function(t){return e[+t]})}}function $P(e){e:for(var r=e.length,t=1,n=-1,i;t<r;++t)switch(e[t]){case".":n=i=t;break;case"0":n===0&&(n=t),i=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var Zb;function YP(e,r){var t=eg(e,r);if(!t)return e+"";var n=t[0],i=t[1],a=i-(Zb=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=n.length;return a===s?n:a>s?n+new Array(a-s+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+eg(e,Math.max(0,r+a-1))[0]}function Vb(e,r){var t=eg(e,r);if(!t)return e+"";var n=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}var jb={"%":function(e,r){return(e*100).toFixed(r)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:HP,e:function(e,r){return e.toExponential(r)},f:function(e,r){return e.toFixed(r)},g:function(e,r){return e.toPrecision(r)},o:function(e){return Math.round(e).toString(8)},p:function(e,r){return Vb(e*100,r)},r:Vb,s:YP,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Hb(e){return e}var Wb=Array.prototype.map,Gb=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function qP(e){var r=e.grouping===void 0||e.thousands===void 0?Hb:GP(Wb.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?Hb:XP(Wb.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function p(b){b=J0(b);var A=b.fill,w=b.align,I=b.sign,P=b.symbol,B=b.zero,H=b.width,Q=b.comma,ue=b.precision,Ee=b.trim,Le=b.type;Le==="n"?(Q=!0,Le="g"):jb[Le]||(ue===void 0&&(ue=12),Ee=!0,Le="g"),(B||A==="0"&&w==="=")&&(B=!0,A="0",w="=");var Ze=P==="$"?t:P==="#"&&/[boxX]/.test(Le)?"0"+Le.toLowerCase():"",tt=P==="$"?n:/[%p]/.test(Le)?s:"",ft=jb[Le],wt=/[defgprs%]/.test(Le);ue=ue===void 0?6:/[gprs]/.test(Le)?Math.max(1,Math.min(21,ue)):Math.max(0,Math.min(20,ue));function fr(hr){var Mr=Ze,ln=tt,Rn,wi,ba;if(Le==="c")ln=ft(hr)+ln,hr="";else{hr=+hr;var Va=hr<0||1/hr<0;if(hr=isNaN(hr)?c:ft(Math.abs(hr),ue),Ee&&(hr=$P(hr)),Va&&+hr==0&&I!=="+"&&(Va=!1),Mr=(Va?I==="("?I:l:I==="-"||I==="("?"":I)+Mr,ln=(Le==="s"?Gb[8+Zb/3]:"")+ln+(Va&&I==="("?")":""),wt){for(Rn=-1,wi=hr.length;++Rn<wi;)if(ba=hr.charCodeAt(Rn),48>ba||ba>57){ln=(ba===46?i+hr.slice(Rn+1):hr.slice(Rn))+ln,hr=hr.slice(0,Rn);break}}}Q&&!B&&(hr=r(hr,Infinity));var io=Mr.length+hr.length+ln.length,as=io<H?new Array(H-io+1).join(A):"";switch(Q&&B&&(hr=r(as+hr,as.length?H-ln.length:Infinity),as=""),w){case"<":hr=Mr+hr+ln+as;break;case"=":hr=Mr+as+hr+ln;break;case"^":hr=as.slice(0,io=as.length>>1)+Mr+hr+ln+as.slice(io);break;default:hr=as+Mr+hr+ln;break}return a(hr)}return fr.toString=function(){return b+""},fr}function _(b,A){var w=p((b=J0(b),b.type="f",b)),I=Math.max(-8,Math.min(8,Math.floor(mv(A)/3)))*3,P=Math.pow(10,-I),B=Gb[8+I/3];return function(H){return w(P*H)+B}}return{format:p,formatPrefix:_}}var tg,A_,Xb;KP({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function KP(e){return tg=qP(e),A_=tg.format,Xb=tg.formatPrefix,tg}function QP(e,r){return e=Math.abs(e),r=Math.abs(r)-e,Math.max(0,mv(r)-mv(e))+1}function JP(e){return Math.max(0,-mv(Math.abs(e)))}function e4(e,r,t,n){var i=y_(e,r,t),a;switch(n=J0(n==null?",f":n),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(r));return n.precision==null&&!isNaN(a=WP(i,s))&&(n.precision=a),Xb(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=QP(i,Math.max(Math.abs(e),Math.abs(r))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=JP(i))&&(n.precision=a-(n.type==="%")*2);break}}return A_(n)}function wm(e){var r=e.domain;return e.ticks=function(t){var n=r();return Rb(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var i=r();return e4(i[0],i[i.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=r(),i=0,a=n.length-1,s=n[i],l=n[a],c;return l<s&&(c=s,s=l,l=c,c=i,i=a,a=c),c=$0(s,l,t),c>0?(s=Math.floor(s/c)*c,l=Math.ceil(l/c)*c,c=$0(s,l,t)):c<0&&(s=Math.ceil(s*c)/c,l=Math.floor(l*c)/c,c=$0(s,l,t)),c>0?(n[i]=Math.floor(s/c)*c,n[a]=Math.ceil(l/c)*c,r(n)):c<0&&(n[i]=Math.ceil(s*c)/c,n[a]=Math.floor(l*c)/c,r(n)),e},e}function $b(){var e=zb(Ku,Ku);return e.copy=function(){return Q0(e,$b())},Ip.apply(e,arguments),wm(e)}function t4(e){var r;function t(n){return isNaN(n=+n)?r:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=map.call(n,number),t):e.slice()},t.unknown=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return t4(e).unknown(r)},e=arguments.length?map.call(e,number):[0,1],linearish(t)}function Yb(e,r){e=e.slice();var t=0,n=e.length-1,i=e[t],a=e[n],s;return a<i&&(s=t,t=n,n=s,s=i,i=a,a=s),e[t]=r.floor(i),e[n]=r.ceil(a),e}function qb(e){return Math.log(e)}function Kb(e){return Math.exp(e)}function r4(e){return-Math.log(-e)}function n4(e){return-Math.exp(-e)}function i4(e){return isFinite(e)?+("1e"+e):e<0?0:e}function a4(e){return e===10?i4:e===Math.E?Math.exp:function(r){return Math.pow(e,r)}}function o4(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(r){return Math.log(r)/e})}function Qb(e){return function(r){return-e(-r)}}function s4(e){var r=e(qb,Kb),t=r.domain,n=10,i,a;function s(){return i=o4(n),a=a4(n),t()[0]<0?(i=Qb(i),a=Qb(a),e(r4,n4)):e(qb,Kb),r}return r.base=function(l){return arguments.length?(n=+l,s()):n},r.domain=function(l){return arguments.length?(t(l),s()):t()},r.ticks=function(l){var c=t(),p=c[0],_=c[c.length-1],b;(b=_<p)&&(A=p,p=_,_=A);var A=i(p),w=i(_),I,P,B,H=l==null?10:+l,Q=[];if(!(n%1)&&w-A<H){if(A=Math.round(A)-1,w=Math.round(w)+1,p>0){for(;A<w;++A)for(P=1,I=a(A);P<n;++P)if(B=I*P,!(B<p)){if(B>_)break;Q.push(B)}}else for(;A<w;++A)for(P=n-1,I=a(A);P>=1;--P)if(B=I*P,!(B<p)){if(B>_)break;Q.push(B)}}else Q=Rb(A,w,Math.min(w-A,H)).map(a);return b?Q.reverse():Q},r.tickFormat=function(l,c){if(c==null&&(c=n===10?".0e":","),typeof c!="function"&&(c=A_(c)),l===Infinity)return c;l==null&&(l=10);var p=Math.max(1,n*l/r.ticks().length);return function(_){var b=_/a(Math.round(i(_)));return b*n<n-.5&&(b*=n),b<=p?c(_):""}},r.nice=function(){return t(Yb(t(),{floor:function(l){return a(Math.floor(i(l)))},ceil:function(l){return a(Math.ceil(i(l)))}}))},r}function Jb(){var e=s4(E_()).domain([1,10]);return e.copy=function(){return Q0(e,Jb()).base(e.base())},Ip.apply(e,arguments),e}function eE(e){return function(r){return Math.sign(r)*Math.log1p(Math.abs(r/e))}}function tE(e){return function(r){return Math.sign(r)*Math.expm1(Math.abs(r))*e}}function u4(e){var r=1,t=e(eE(r),tE(r));return t.constant=function(n){return arguments.length?e(eE(r=+n),tE(r)):r},linearish(t)}function l4(){var e=u4(transformer());return e.copy=function(){return copy(e,l4()).constant(e.constant())},initRange.apply(e,arguments)}function rE(e){return function(r){return r<0?-Math.pow(-r,e):Math.pow(r,e)}}function c4(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function f4(e){return e<0?-e*e:e*e}function h4(e){var r=e(Ku,Ku),t=1;function n(){return t===1?e(Ku,Ku):t===.5?e(c4,f4):e(rE(t),rE(1/t))}return r.exponent=function(i){return arguments.length?(t=+i,n()):t},wm(r)}function T_(){var e=h4(E_());return e.copy=function(){return Q0(e,T_()).exponent(e.exponent())},Ip.apply(e,arguments),e}function GN(){return T_.apply(null,arguments).exponent(.5)}function nE(){var e=[],r=[],t=[],n;function i(){var s=0,l=Math.max(1,r.length);for(t=new Array(l-1);++s<l;)t[s-1]=PP(e,s/l);return a}function a(s){return isNaN(s=+s)?n:r[X0(t,s)]}return a.invertExtent=function(s){var l=r.indexOf(s);return l<0?[NaN,NaN]:[l>0?t[l-1]:e[0],l<t.length?t[l]:e[e.length-1]]},a.domain=function(s){if(!arguments.length)return e.slice();e=[];for(var l=0,c=s.length,p;l<c;++l)p=s[l],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(v_),i()},a.range=function(s){return arguments.length?(r=xd.call(s),i()):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.quantiles=function(){return t.slice()},a.copy=function(){return nE().domain(e).range(r).unknown(n)},Ip.apply(a,arguments)}function iE(){var e=0,r=1,t=1,n=[.5],i=[0,1],a;function s(c){return c<=c?i[X0(n,c,0,t)]:a}function l(){var c=-1;for(n=new Array(t);++c<t;)n[c]=((c+1)*r-(c-t)*e)/(t+1);return s}return s.domain=function(c){return arguments.length?(e=+c[0],r=+c[1],l()):[e,r]},s.range=function(c){return arguments.length?(t=(i=xd.call(c)).length-1,l()):i.slice()},s.invertExtent=function(c){var p=i.indexOf(c);return p<0?[NaN,NaN]:p<1?[e,n[0]]:p>=t?[n[t-1],r]:[n[p-1],n[p]]},s.unknown=function(c){return arguments.length&&(a=c),s},s.thresholds=function(){return n.slice()},s.copy=function(){return iE().domain([e,r]).range(i).unknown(a)},Ip.apply(wm(s),arguments)}function aE(){var e=[.5],r=[0,1],t,n=1;function i(a){return a<=a?r[X0(e,a,0,n)]:t}return i.domain=function(a){return arguments.length?(e=xd.call(a),n=Math.min(e.length,r.length-1),i):e.slice()},i.range=function(a){return arguments.length?(r=xd.call(a),n=Math.min(e.length,r.length-1),i):r.slice()},i.invertExtent=function(a){var s=r.indexOf(a);return[e[s-1],e[s]]},i.unknown=function(a){return arguments.length?(t=a,i):t},i.copy=function(){return aE().domain(e).range(r).unknown(t)},Ip.apply(i,arguments)}var w_=new Date,C_=new Date;function xl(e,r,t,n){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),r(a,1),e(a),a},i.round=function(a){var s=i(a),l=i.ceil(a);return a-s<l-a?s:l},i.offset=function(a,s){return r(a=new Date(+a),s==null?1:Math.floor(s)),a},i.range=function(a,s,l){var c=[],p;if(a=i.ceil(a),l=l==null?1:Math.floor(l),!(a<s)||!(l>0))return c;do c.push(p=new Date(+a)),r(a,l),e(a);while(p<a&&a<s);return c},i.filter=function(a){return xl(function(s){if(s>=s)for(;e(s),!a(s);)s.setTime(s-1)},function(s,l){if(s>=s)if(l<0)for(;++l<=0;)for(;r(s,-1),!a(s););else for(;--l>=0;)for(;r(s,1),!a(s););})},t&&(i.count=function(a,s){return w_.setTime(+a),C_.setTime(+s),e(w_),e(C_),Math.floor(t(w_,C_))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?function(s){return n(s)%a==0}:function(s){return i.count(0,s)%a==0}):i}),i}var R_=xl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r)},function(e,r){return r.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});R_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:xl(function(r){r.setFullYear(Math.floor(r.getFullYear()/e)*e),r.setMonth(0,1),r.setHours(0,0,0,0)},function(r,t){r.setFullYear(r.getFullYear()+t*e)})};var gv=R_,XN=R_.range,oE=xl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,r){e.setMonth(e.getMonth()+r)},function(e,r){return r.getMonth()-e.getMonth()+(r.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),p4=oE,$N=oE.range,rg=1e3,Cm=6e4,sE=36e5,uE=864e5,lE=6048e5;function bd(e){return xl(function(r){r.setDate(r.getDate()-(r.getDay()+7-e)%7),r.setHours(0,0,0,0)},function(r,t){r.setDate(r.getDate()+t*7)},function(r,t){return(t-r-(t.getTimezoneOffset()-r.getTimezoneOffset())*Cm)/lE})}var M_=bd(0),ng=bd(1),d4=bd(2),v4=bd(3),_v=bd(4),m4=bd(5),g4=bd(6),YN=M_.range,qN=ng.range,KN=d4.range,QN=v4.range,JN=_v.range,e6=m4.range,t6=g4.range,cE=xl(function(e){e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*Cm)/uE},function(e){return e.getDate()-1}),I_=cE,r6=cE.range,fE=xl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*rg-e.getMinutes()*Cm)},function(e,r){e.setTime(+e+r*sE)},function(e,r){return(r-e)/sE},function(e){return e.getHours()}),_4=fE,n6=fE.range,hE=xl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*rg)},function(e,r){e.setTime(+e+r*Cm)},function(e,r){return(r-e)/Cm},function(e){return e.getMinutes()}),y4=hE,i6=hE.range,pE=xl(function(e){e.setTime(e-e.getMilliseconds())},function(e,r){e.setTime(+e+r*rg)},function(e,r){return(r-e)/rg},function(e){return e.getUTCSeconds()}),x4=pE,a6=pE.range,ig=xl(function(){},function(e,r){e.setTime(+e+r)},function(e,r){return r-e});ig.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?xl(function(r){r.setTime(Math.floor(r/e)*e)},function(r,t){r.setTime(+r+t*e)},function(r,t){return(t-r)/e}):ig};var b4=ig,o6=ig.range;function Ed(e){return xl(function(r){r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-e)%7),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCDate(r.getUTCDate()+t*7)},function(r,t){return(t-r)/lE})}var dE=Ed(0),ag=Ed(1),E4=Ed(2),S4=Ed(3),yv=Ed(4),A4=Ed(5),T4=Ed(6),s6=dE.range,u6=ag.range,l6=E4.range,c6=S4.range,f6=yv.range,h6=A4.range,p6=T4.range,vE=xl(function(e){e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r)},function(e,r){return(r-e)/uE},function(e){return e.getUTCDate()-1}),mE=vE,d6=vE.range,P_=xl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r)},function(e,r){return r.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});P_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:xl(function(r){r.setUTCFullYear(Math.floor(r.getUTCFullYear()/e)*e),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCFullYear(r.getUTCFullYear()+t*e)})};var Rm=P_,v6=P_.range;function O_(e){if(0<=e.y&&e.y<100){var r=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return r.setFullYear(e.y),r}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function k_(e){if(0<=e.y&&e.y<100){var r=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return r.setUTCFullYear(e.y),r}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Mm(e,r,t){return{y:e,m:r,d:t,H:0,M:0,S:0,L:0}}function w4(e){var r=e.dateTime,t=e.date,n=e.time,i=e.periods,a=e.days,s=e.shortDays,l=e.months,c=e.shortMonths,p=Im(i),_=Pm(i),b=Im(a),A=Pm(a),w=Im(s),I=Pm(s),P=Im(l),B=Pm(l),H=Im(c),Q=Pm(c),ue={a:Va,A:io,b:as,B:Sl,c:null,d:EE,e:EE,f:Y4,g:aO,G:sO,H:G4,I:X4,j:$4,L:SE,m:q4,M:K4,p:GF,q:XF,Q:ME,s:IE,S:Q4,u:J4,U:eO,V:tO,w:rO,W:nO,x:null,X:null,y:iO,Y:oO,Z:uO,"%":RE},Ee={a:$F,A:YF,b:qF,B:KF,c:null,d:TE,e:TE,f:hO,g:EO,G:AO,H:lO,I:cO,j:fO,L:wE,m:pO,M:dO,p:QF,q:JF,Q:ME,s:IE,S:vO,u:mO,U:gO,V:_O,w:yO,W:xO,x:null,X:null,y:bO,Y:SO,Z:TO,"%":RE},Le={a:fr,A:hr,b:Mr,B:ln,c:Rn,d:xE,e:xE,f:V4,g:yE,G:_E,H:bE,I:bE,j:N4,L:Z4,m:F4,M:U4,p:wt,q:B4,Q:H4,s:W4,S:z4,u:P4,U:O4,V:k4,w:I4,W:D4,x:wi,X:ba,y:yE,Y:_E,Z:L4,"%":j4};ue.x=Ze(t,ue),ue.X=Ze(n,ue),ue.c=Ze(r,ue),Ee.x=Ze(t,Ee),Ee.X=Ze(n,Ee),Ee.c=Ze(r,Ee);function Ze(si,ga){return function(ka){var xn=[],jl=-1,Bo=0,dc=si.length,vc,Pd,oA;for(ka instanceof Date||(ka=new Date(+ka));++jl<dc;)si.charCodeAt(jl)===37&&(xn.push(si.slice(Bo,jl)),(Pd=gE[vc=si.charAt(++jl)])!=null?vc=si.charAt(++jl):Pd=vc==="e"?" ":"0",(oA=ga[vc])&&(vc=oA(ka,Pd)),xn.push(vc),Bo=jl+1);return xn.push(si.slice(Bo,jl)),xn.join("")}}function tt(si,ga){return function(ka){var xn=Mm(1900,void 0,1),jl=ft(xn,si,ka+="",0),Bo,dc;if(jl!=ka.length)return null;if("Q"in xn)return new Date(xn.Q);if("s"in xn)return new Date(xn.s*1e3+("L"in xn?xn.L:0));if(ga&&!("Z"in xn)&&(xn.Z=0),"p"in xn&&(xn.H=xn.H%12+xn.p*12),xn.m===void 0&&(xn.m="q"in xn?xn.q:0),"V"in xn){if(xn.V<1||xn.V>53)return null;"w"in xn||(xn.w=1),"Z"in xn?(Bo=k_(Mm(xn.y,0,1)),dc=Bo.getUTCDay(),Bo=dc>4||dc===0?ag.ceil(Bo):ag(Bo),Bo=mE.offset(Bo,(xn.V-1)*7),xn.y=Bo.getUTCFullYear(),xn.m=Bo.getUTCMonth(),xn.d=Bo.getUTCDate()+(xn.w+6)%7):(Bo=O_(Mm(xn.y,0,1)),dc=Bo.getDay(),Bo=dc>4||dc===0?ng.ceil(Bo):ng(Bo),Bo=I_.offset(Bo,(xn.V-1)*7),xn.y=Bo.getFullYear(),xn.m=Bo.getMonth(),xn.d=Bo.getDate()+(xn.w+6)%7)}else("W"in xn||"U"in xn)&&("w"in xn||(xn.w="u"in xn?xn.u%7:"W"in xn?1:0),dc="Z"in xn?k_(Mm(xn.y,0,1)).getUTCDay():O_(Mm(xn.y,0,1)).getDay(),xn.m=0,xn.d="W"in xn?(xn.w+6)%7+xn.W*7-(dc+5)%7:xn.w+xn.U*7-(dc+6)%7);return"Z"in xn?(xn.H+=xn.Z/100|0,xn.M+=xn.Z%100,k_(xn)):O_(xn)}}function ft(si,ga,ka,xn){for(var jl=0,Bo=ga.length,dc=ka.length,vc,Pd;jl<Bo;){if(xn>=dc)return-1;if(vc=ga.charCodeAt(jl++),vc===37){if(vc=ga.charAt(jl++),Pd=Le[vc in gE?ga.charAt(jl++):vc],!Pd||(xn=Pd(si,ka,xn))<0)return-1}else if(vc!=ka.charCodeAt(xn++))return-1}return xn}function wt(si,ga,ka){var xn=p.exec(ga.slice(ka));return xn?(si.p=_[xn[0].toLowerCase()],ka+xn[0].length):-1}function fr(si,ga,ka){var xn=w.exec(ga.slice(ka));return xn?(si.w=I[xn[0].toLowerCase()],ka+xn[0].length):-1}function hr(si,ga,ka){var xn=b.exec(ga.slice(ka));return xn?(si.w=A[xn[0].toLowerCase()],ka+xn[0].length):-1}function Mr(si,ga,ka){var xn=H.exec(ga.slice(ka));return xn?(si.m=Q[xn[0].toLowerCase()],ka+xn[0].length):-1}function ln(si,ga,ka){var xn=P.exec(ga.slice(ka));return xn?(si.m=B[xn[0].toLowerCase()],ka+xn[0].length):-1}function Rn(si,ga,ka){return ft(si,r,ga,ka)}function wi(si,ga,ka){return ft(si,t,ga,ka)}function ba(si,ga,ka){return ft(si,n,ga,ka)}function Va(si){return s[si.getDay()]}function io(si){return a[si.getDay()]}function as(si){return c[si.getMonth()]}function Sl(si){return l[si.getMonth()]}function GF(si){return i[+(si.getHours()>=12)]}function XF(si){return 1+~~(si.getMonth()/3)}function $F(si){return s[si.getUTCDay()]}function YF(si){return a[si.getUTCDay()]}function qF(si){return c[si.getUTCMonth()]}function KF(si){return l[si.getUTCMonth()]}function QF(si){return i[+(si.getUTCHours()>=12)]}function JF(si){return 1+~~(si.getUTCMonth()/3)}return{format:function(si){var ga=Ze(si+="",ue);return ga.toString=function(){return si},ga},parse:function(si){var ga=tt(si+="",!1);return ga.toString=function(){return si},ga},utcFormat:function(si){var ga=Ze(si+="",Ee);return ga.toString=function(){return si},ga},utcParse:function(si){var ga=tt(si+="",!0);return ga.toString=function(){return si},ga}}}var gE={"-":"",_:" ","0":"0"},gu=/^\s*\d+/,C4=/^%/,R4=/[\\^$*+?|[\]().{}]/g;function Oa(e,r,t){var n=e<0?"-":"",i=(n?-e:e)+"",a=i.length;return n+(a<t?new Array(t-a+1).join(r)+i:i)}function M4(e){return e.replace(R4,"\\$&")}function Im(e){return new RegExp("^(?:"+e.map(M4).join("|")+")","i")}function Pm(e){for(var r={},t=-1,n=e.length;++t<n;)r[e[t].toLowerCase()]=t;return r}function I4(e,r,t){var n=gu.exec(r.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function P4(e,r,t){var n=gu.exec(r.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function O4(e,r,t){var n=gu.exec(r.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function k4(e,r,t){var n=gu.exec(r.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function D4(e,r,t){var n=gu.exec(r.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function _E(e,r,t){var n=gu.exec(r.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function yE(e,r,t){var n=gu.exec(r.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function L4(e,r,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function B4(e,r,t){var n=gu.exec(r.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function F4(e,r,t){var n=gu.exec(r.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function xE(e,r,t){var n=gu.exec(r.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function N4(e,r,t){var n=gu.exec(r.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function bE(e,r,t){var n=gu.exec(r.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function U4(e,r,t){var n=gu.exec(r.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function z4(e,r,t){var n=gu.exec(r.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function Z4(e,r,t){var n=gu.exec(r.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function V4(e,r,t){var n=gu.exec(r.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function j4(e,r,t){var n=C4.exec(r.slice(t,t+1));return n?t+n[0].length:-1}function H4(e,r,t){var n=gu.exec(r.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function W4(e,r,t){var n=gu.exec(r.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function EE(e,r){return Oa(e.getDate(),r,2)}function G4(e,r){return Oa(e.getHours(),r,2)}function X4(e,r){return Oa(e.getHours()%12||12,r,2)}function $4(e,r){return Oa(1+I_.count(gv(e),e),r,3)}function SE(e,r){return Oa(e.getMilliseconds(),r,3)}function Y4(e,r){return SE(e,r)+"000"}function q4(e,r){return Oa(e.getMonth()+1,r,2)}function K4(e,r){return Oa(e.getMinutes(),r,2)}function Q4(e,r){return Oa(e.getSeconds(),r,2)}function J4(e){var r=e.getDay();return r===0?7:r}function eO(e,r){return Oa(M_.count(gv(e)-1,e),r,2)}function AE(e){var r=e.getDay();return r>=4||r===0?_v(e):_v.ceil(e)}function tO(e,r){return e=AE(e),Oa(_v.count(gv(e),e)+(gv(e).getDay()===4),r,2)}function rO(e){return e.getDay()}function nO(e,r){return Oa(ng.count(gv(e)-1,e),r,2)}function iO(e,r){return Oa(e.getFullYear()%100,r,2)}function aO(e,r){return e=AE(e),Oa(e.getFullYear()%100,r,2)}function oO(e,r){return Oa(e.getFullYear()%1e4,r,4)}function sO(e,r){var t=e.getDay();return e=t>=4||t===0?_v(e):_v.ceil(e),Oa(e.getFullYear()%1e4,r,4)}function uO(e){var r=e.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+Oa(r/60|0,"0",2)+Oa(r%60,"0",2)}function TE(e,r){return Oa(e.getUTCDate(),r,2)}function lO(e,r){return Oa(e.getUTCHours(),r,2)}function cO(e,r){return Oa(e.getUTCHours()%12||12,r,2)}function fO(e,r){return Oa(1+mE.count(Rm(e),e),r,3)}function wE(e,r){return Oa(e.getUTCMilliseconds(),r,3)}function hO(e,r){return wE(e,r)+"000"}function pO(e,r){return Oa(e.getUTCMonth()+1,r,2)}function dO(e,r){return Oa(e.getUTCMinutes(),r,2)}function vO(e,r){return Oa(e.getUTCSeconds(),r,2)}function mO(e){var r=e.getUTCDay();return r===0?7:r}function gO(e,r){return Oa(dE.count(Rm(e)-1,e),r,2)}function CE(e){var r=e.getUTCDay();return r>=4||r===0?yv(e):yv.ceil(e)}function _O(e,r){return e=CE(e),Oa(yv.count(Rm(e),e)+(Rm(e).getUTCDay()===4),r,2)}function yO(e){return e.getUTCDay()}function xO(e,r){return Oa(ag.count(Rm(e)-1,e),r,2)}function bO(e,r){return Oa(e.getUTCFullYear()%100,r,2)}function EO(e,r){return e=CE(e),Oa(e.getUTCFullYear()%100,r,2)}function SO(e,r){return Oa(e.getUTCFullYear()%1e4,r,4)}function AO(e,r){var t=e.getUTCDay();return e=t>=4||t===0?yv(e):yv.ceil(e),Oa(e.getUTCFullYear()%1e4,r,4)}function TO(){return"+0000"}function RE(){return"%"}function ME(e){return+e}function IE(e){return Math.floor(+e/1e3)}var xv,PE,wO,CO,RO;MO({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function MO(e){return xv=w4(e),PE=xv.format,wO=xv.parse,CO=xv.utcFormat,RO=xv.utcParse,xv}var Om=1e3,km=Om*60,Dm=km*60,Lm=Dm*24,IO=Lm*7,OE=Lm*30,D_=Lm*365;function PO(e){return new Date(e)}function OO(e){return e instanceof Date?+e:+new Date(+e)}function kE(e,r,t,n,i,a,s,l,c){var p=zb(Ku,Ku),_=p.invert,b=p.domain,A=c(".%L"),w=c(":%S"),I=c("%I:%M"),P=c("%I %p"),B=c("%a %d"),H=c("%b %d"),Q=c("%B"),ue=c("%Y"),Ee=[[s,1,Om],[s,5,5*Om],[s,15,15*Om],[s,30,30*Om],[a,1,km],[a,5,5*km],[a,15,15*km],[a,30,30*km],[i,1,Dm],[i,3,3*Dm],[i,6,6*Dm],[i,12,12*Dm],[n,1,Lm],[n,2,2*Lm],[t,1,IO],[r,1,OE],[r,3,3*OE],[e,1,D_]];function Le(tt){return(s(tt)<tt?A:a(tt)<tt?w:i(tt)<tt?I:n(tt)<tt?P:r(tt)<tt?t(tt)<tt?B:H:e(tt)<tt?Q:ue)(tt)}function Ze(tt,ft,wt,fr){if(tt==null&&(tt=10),typeof tt=="number"){var hr=Math.abs(wt-ft)/tt,Mr=Ab(function(ln){return ln[2]}).right(Ee,hr);Mr===Ee.length?(fr=y_(ft/D_,wt/D_,tt),tt=e):Mr?(Mr=Ee[hr/Ee[Mr-1][2]<Ee[Mr][2]/hr?Mr-1:Mr],fr=Mr[1],tt=Mr[0]):(fr=Math.max(y_(ft,wt,tt),1),tt=l)}return fr==null?tt:tt.every(fr)}return p.invert=function(tt){return new Date(_(tt))},p.domain=function(tt){return arguments.length?b(kb.call(tt,OO)):b().map(PO)},p.ticks=function(tt,ft){var wt=b(),fr=wt[0],hr=wt[wt.length-1],Mr=hr<fr,ln;return Mr&&(ln=fr,fr=hr,hr=ln),ln=Ze(tt,fr,hr,ft),ln=ln?ln.range(fr,hr+1):[],Mr?ln.reverse():ln},p.tickFormat=function(tt,ft){return ft==null?Le:c(ft)},p.nice=function(tt,ft){var wt=b();return(tt=Ze(tt,wt[0],wt[wt.length-1],ft))?b(Yb(wt,tt)):p},p.copy=function(){return Q0(p,kE(e,r,t,n,i,a,s,l,c))},p}function kO(){return Ip.apply(kE(gv,p4,M_,I_,_4,y4,x4,b4,PE).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function m6(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function og(){var e=0,r=1,t,n,i,a,s=Ku,l=!1,c;function p(_){return isNaN(_=+_)?c:s(i===0?.5:(_=(a(_)-t)*i,l?Math.max(0,Math.min(1,_)):_))}return p.domain=function(_){return arguments.length?(t=a(e=+_[0]),n=a(r=+_[1]),i=t===n?0:1/(n-t),p):[e,r]},p.clamp=function(_){return arguments.length?(l=!!_,p):l},p.interpolator=function(_){return arguments.length?(s=_,p):s},p.unknown=function(_){return arguments.length?(c=_,p):c},function(_){return a=_,t=_(e),n=_(r),i=t===n?0:1/(n-t),p}}function Bm(e,r){return r.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function DE(){var e=wm(og()(Ku));return e.copy=function(){return Bm(e,DE())},Db.apply(e,arguments)}function DO(){var e=loggish(og()).domain([1,10]);return e.copy=function(){return Bm(e,DO()).base(e.base())},initInterpolator.apply(e,arguments)}function LO(){var e=symlogish(og());return e.copy=function(){return Bm(e,LO()).constant(e.constant())},initInterpolator.apply(e,arguments)}function LE(){var e=powish(og());return e.copy=function(){return Bm(e,LE()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function g6(){return LE.apply(null,arguments).exponent(.5)}function BO(){var e=[],r=identity;function t(n){if(!isNaN(n=+n))return r((bisect(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var i=0,a=n.length,s;i<a;++i)s=n[i],s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(ascending),t},t.interpolator=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return BO(r).domain(e)},initInterpolator.apply(t,arguments)}function sg(){var e=0,r=.5,t=1,n,i,a,s,l,c=Ku,p,_=!1,b;function A(w){return isNaN(w=+w)?b:(w=.5+((w=+p(w))-i)*(w<i?s:l),c(_?Math.max(0,Math.min(1,w)):w))}return A.domain=function(w){return arguments.length?(n=p(e=+w[0]),i=p(r=+w[1]),a=p(t=+w[2]),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A):[e,r,t]},A.clamp=function(w){return arguments.length?(_=!!w,A):_},A.interpolator=function(w){return arguments.length?(c=w,A):c},A.unknown=function(w){return arguments.length?(b=w,A):b},function(w){return p=w,n=w(e),i=w(r),a=w(t),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A}}function BE(){var e=wm(sg()(Ku));return e.copy=function(){return Bm(e,BE())},Db.apply(e,arguments)}function FO(){var e=loggish(sg()).domain([.1,1,10]);return e.copy=function(){return copy(e,FO()).base(e.base())},initInterpolator.apply(e,arguments)}function NO(){var e=symlogish(sg());return e.copy=function(){return copy(e,NO()).constant(e.constant())},initInterpolator.apply(e,arguments)}function FE(){var e=powish(sg());return e.copy=function(){return copy(e,FE()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function _6(){return FE.apply(null,arguments).exponent(.5)}function NE(e){var r,t=[];function n(i){return i==null?r:i}return n.invert=n,n.domain=n.range=function(i){return i?(t=i,i):t},n.unknown=function(i){return i?(r=i,i):r},n.copy=function(){return NE(e).unknown(r)},n}var hc,UE,zE,L_=vi.isNil,UO=vi.isString,zO=vi.uniq,ZO=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,VO=(hc={},(0,N.Z)(hc,Za.LINEAR,$b),(0,N.Z)(hc,Za.POWER,T_),(0,N.Z)(hc,Za.LOG,Jb),(0,N.Z)(hc,Za.IDENTITY,NE),(0,N.Z)(hc,Za.SEQUENTIAL,DE),(0,N.Z)(hc,Za.TIME,kO),(0,N.Z)(hc,Za.QUANTILE,nE),(0,N.Z)(hc,Za.QUANTIZE,iE),(0,N.Z)(hc,Za.THRESHOLD,aE),(0,N.Z)(hc,Za.CAT,K0),(0,N.Z)(hc,Za.DIVERGING,BE),hc),jO=(UE=(0,Jt.b2)(),UE(zE=function(){function e(){(0,ge.Z)(this,e),(0,N.Z)(this,"scaleOptions",{})}return(0,K.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",(0,Nt.Z)(xe().mark(function s(){var l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(t.log(Ts.ScaleInitStart,jt.INIT),i.scaleOptions=t.getScaleOptions(),c=a.getLayerStyleAttributes(),p=(l=t.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(p)&&p.length===0)){b.next=8;break}return b.abrupt("return");case 8:i.caculateScalesForAttributes(c||[],p);case 9:t.log(Ts.ScaleInitEnd,jt.INIT);case 10:case"end":return b.stop()}},s)}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var s=(0,Nt.Z)(xe().mark(function l(c){var p,_;return xe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(c){A.next=2;break}return A.abrupt("return",c);case 2:if(t.log(Ts.ScaleInitStart,jt.UPDATE),i.scaleOptions=t.getScaleOptions(),p=a.getLayerStyleAttributes(),_=t.getSource().data.dataArray,!(Array.isArray(_)&&_.length===0)){A.next=8;break}return A.abrupt("return",!0);case 8:return i.caculateScalesForAttributes(p||[],_),t.log(Ts.ScaleInitEnd,jt.UPDATE),t.layerModelNeedUpdate=!0,A.abrupt("return",!0);case 12:case"end":return A.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){i.scaleOptions=t.getScaleOptions();var s=a.getLayerStyleAttributes(),l=t.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&s){var c=s.filter(function(p){return p.needRescale});c.length&&i.caculateScalesForAttributes(c,l)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var i=this;t.forEach(function(a){if(a.scale){var s=a.scale,l=a.scale.field;s.names=i.parseFields(L_(l)?[]:l);var c=[];s.names.forEach(function(p){var _;c.push(i.createScale(p,a.name,(_=a.scale)===null||_===void 0?void 0:_.values,n))}),c.some(function(p){return p.type===cv.VARIABLE})?(s.type=cv.VARIABLE,c.forEach(function(p){if(!s.callback&&s.values!=="text"){var _;switch((_=p.option)===null||_===void 0?void 0:_.type){case Za.LOG:case Za.LINEAR:case Za.POWER:if(s.values&&s.values.length>2){var b=p.scale.ticks(s.values.length);p.scale.domain(b)}s.values?p.scale.range(s.values):p.scale.range(p.option.domain);break;case Za.QUANTILE:case Za.QUANTIZE:case Za.THRESHOLD:p.scale.range(s.values);break;case Za.IDENTITY:break;case Za.CAT:s.values?p.scale.range(s.values):p.scale.range(p.option.domain);break;case Za.DIVERGING:case Za.SEQUENTIAL:p.scale.interpolator(OP.hD(s.values));break}}if(s.values==="text"){var A;p.scale.range((A=p.option)===null||A===void 0?void 0:A.domain)}})):(s.type=cv.CONSTANT,s.defaultValues=c.map(function(p,_){return p.scale(s.names[_])})),s.scalers=c.map(function(p){return{field:p.field,func:p.scale,option:p.option}}),a.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:UO(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,i,a){var s,l,c=this.scaleOptions[n]&&((s=this.scaleOptions[n])===null||s===void 0?void 0:s.field)===t?this.scaleOptions[n]:this.scaleOptions[t],p={field:t,scale:void 0,type:cv.VARIABLE,option:c};if(!a||!a.length)return c&&c.type?p.scale=this.createDefaultScale(c):(p.scale=K0([t]),p.type=cv.CONSTANT),p;var _=(l=a.find(function(w){return!L_(w[t])}))===null||l===void 0?void 0:l[t];if(this.isNumber(t)||L_(_)&&!c)p.scale=K0([t]),p.type=cv.CONSTANT;else{var b=c&&c.type||this.getDefaultType(_);i==="text"&&(b=Za.CAT),i===void 0&&(b=Za.IDENTITY);var A=this.createScaleConfig(b,t,c,a);p.scale=this.createDefaultScale(A),p.option=A}return p}},{key:"getDefaultType",value:function(t){var n=Za.LINEAR;return typeof t=="string"&&(n=ZO.test(t)?Za.TIME:Za.CAT),n}},{key:"createScaleConfig",value:function(t,n,i,a){var s={type:t},l=[];if(t===Za.QUANTILE){var c=new Map;a==null||a.forEach(function(b){c.set(b._id,b[n])}),l=Array.from(c.values())}else l=(a==null?void 0:a.map(function(b){return b[n]}))||[];if(i!=null&&i.domain)s.domain=i==null?void 0:i.domain;else if(t===Za.CAT||t===Za.IDENTITY)s.domain=zO(l);else if(t===Za.QUANTILE)s.domain=l;else if(t===Za.DIVERGING){var p=wb(l),_=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(p[0]+p[1])/2;s.domain=[p[0],_,p[1]]}else s.domain=wb(l);return(0,k.Z)((0,k.Z)({},s),i)}},{key:"createDefaultScale",value:function(t){var n=t.type,i=t.domain,a=t.unknown,s=t.clamp,l=t.nice,c=VO[n]();return i&&c.domain&&c.domain(i),a&&c.unknown(a),s!==void 0&&c.clamp&&c.clamp(s),l!==void 0&&c.nice&&c.nice(l),c}}]),e}())||zE),ZE,VE,HO=(ZE=(0,Jt.b2)(),ZE(VE=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=t.animateStatus;n&&t.models.forEach(function(i){i.addUniforms((0,k.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}())||VE),jE,HE,WO=(jE=(0,Jt.b2)(),jE(HE=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=t.getLayerConfig(),i=n.maskLayers,a=n.enableMask;if(!t.tileLayer&&i&&i.length>0){var s;(s=t.masks).push.apply(s,(0,Gt.Z)(i)),t.updateLayerConfig({mask:a})}})}}]),e}())||HE),GO=function(){function e(r){var t=r.rendererService,n=r.layerService,i=r.parent;(0,ge.Z)(this,e),(0,N.Z)(this,"tileResource",new Map),(0,N.Z)(this,"layerTiles",[]),this.rendererService=t,this.layerService=n,this.parent=i}return(0,K.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some(function(n){return n.key===t})}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find(function(n){return n.key===t})}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(t)})}},{key:"removeTile",value:function(t){var n=this.layerTiles.findIndex(function(a){return a.key===t}),i=this.layerTiles.splice(n,1);i[0]&&i[0].destroy()}},{key:"updateTileVisible",value:function(t){var n=this.getTile(t.key);if(t.isVisible)if(t.parent){var i=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(i)}else n==null||n.updateVisible(!0);else if(t.parent){var a=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(!a)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(t){var n=t.parent;if(!n)return!0;var i=this.getTile(n==null?void 0:n.key);return!!(i!=null&&i.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var n=this,i=t==null?void 0:t.children;return i.length===0?!0:i.every(function(a){var s=n.getTile(a==null?void 0:a.key);return s?(s==null?void 0:s.isLoaded)===!0:!0})}},{key:"render",value:function(){var r=(0,Nt.Z)(xe().mark(function n(){var i=this,a,s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=this.getRenderLayers(),s=a.map(function(){var p=(0,Nt.Z)(xe().mark(function _(b){return xe().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,i.layerService.renderTileLayer(b);case 2:case"end":return w.stop()}},_)}));return function(_){return p.apply(this,arguments)}}()),c.next=4,Promise.all(s);case 4:case"end":return c.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.visible&&i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,(0,Gt.Z)(i.getLayers()))}),n}},{key:"getLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,(0,Gt.Z)(i.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(t){return t.destroy()}),this.tileResource.clear()}}]),e}(),XO=Z(32676);function $O(e,r,t){t===void 0&&(t={});var n=Hi(e),i=Hi(r),a=XO.union(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?ar(a[0],t.properties):Ti(a,t.properties)}var YO=$O,qO=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"getCombineFeature",value:function(t){var n=null,i=t[0];return t.map(function(a){var s=ar(a.coordinates);n===null?n=s:n=YO(n,s)}),i&&(n.properties=(0,k.Z)({},i)),n}}]),e}(),Fm="select",Nm="active",KO=function(){function e(r){var t=r.layerService,n=r.tileLayerService,i=r.parent;(0,ge.Z)(this,e),(0,N.Z)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=n,this.parent=i,this.tileSourceService=new qO}return(0,K.Z)(e,[{key:"pickRender",value:function(t){var n=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(n){var i=n.getMainLayer();i==null||i.layerPickService.pickRender(t)}}},{key:"pick",value:function(t,n){var i=this.parent.getContainer(),a=i.get(Ye.IPickingService);if(t.type==="RasterLayer"){var s=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(s&&s.getMainLayer()!==void 0){var l=s.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),a.pickFromPickingFBO(t,n)}},{key:"selectFeature",value:function(t){var n=(0,re.Z)(t,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(Fm,l),this.updateHighLight(i,a,s,Fm)}},{key:"highlightPickedFeature",value:function(t){var n=(0,re.Z)(t,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(Nm,l),this.updateHighLight(i,a,s,Nm)}},{key:"updateHighLight",value:function(t,n,i,a){this.tileLayerService.tiles.map(function(s){var l=s.getMainLayer();switch(a){case Fm:l==null||l.hooks.beforeSelect.call([t,n,i]);break;case Nm:l==null||l.hooks.beforeHighlight.call([t,n,i]);break}})}},{key:"setPickState",value:function(){var t=this.tilePickID.get(Fm),n=this.tilePickID.get(Nm);if(t){var i=this.pickId2Color(t),a=(0,re.Z)(i,3),s=a[0],l=a[1],c=a[2];this.updateHighLight(s,l,c,Fm);return}if(n){var p=this.pickId2Color(n),_=(0,re.Z)(p,3),b=_[0],A=_[1],w=_[2];this.updateHighLight(b,A,w,Nm);return}}},{key:"color2PickId",value:function(t,n,i){return ia(new Uint8Array([t,n,i]))}},{key:"pickId2Color",value:function(t){return Ra(t)}},{key:"getFeatureById",value:function(t){var n=this.tileLayerService.getTiles().filter(function(a){return a.visible}),i=[];return n.forEach(function(a){i.push.apply(i,(0,Gt.Z)(a.getFeatureById(t)))}),i}},{key:"pickRasterLayer",value:function(t,n,i){return!1}}]),e}();function QO(e){return e==="PolygonLayer"?Tm:e==="LineLayer"?d_:H0}function JO(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function e5(e){var r=t5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function t5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sd=function(e){(0,Qe.Z)(t,e);var r=e5(t);function t(n,i){var a;return(0,ge.Z)(this,t),a=r.call(this),(0,N.Z)((0,we.Z)(a),"visible",!0),(0,N.Z)((0,we.Z)(a),"layers",[]),(0,N.Z)((0,we.Z)(a),"isLoaded",!1),(0,N.Z)((0,we.Z)(a),"tileMaskLayers",[]),a.parent=i,a.sourceTile=n,a.x=n.x,a.y=n.y,a.z=n.z,a.key="".concat(a.x,"_").concat(a.y,"_").concat(a.z),a}return(0,K.Z)(t,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(i){var a=(0,re.Z)(this.sourceTile.bounds,4),s=a[0],l=a[1],c=a[2],p=a[3],_=i.lng,b=i.lat;return _>=s&&_<=c&&b>=l&&b<=p}},{key:"getLayerOptions",value:function(){var i,a=this.parent.getLayerConfig();return(0,k.Z)((0,k.Z)({},a),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:JO(this.parent.type),mask:a.mask||((i=a.maskLayers)===null||i===void 0?void 0:i.length)!==0&&a.enableMask})}},{key:"getMaskLayer",value:function(){var i=this,a=this.parent.getLayerConfig(),s=a.maskLayers,l=[];return s==null||s.forEach(function(c){if(!c.tileLayer)return l.push(c),c;var p=c.tileLayer,_=p.getTile(i.sourceTile.key),b=_==null?void 0:_.getLayers()[0];b&&l.push(b)}),l}},{key:"addTileMask",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c;return xe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return s=new Tm({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").style({opacity:.5}),l=lv(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),_.next=5,s.init();case 5:return this.tileMask=s,c=this.getMainLayer(),c!==void 0&&(c.tileMask=s),_.abrupt("return",s);case 9:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addMask",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s,l){var c;return xe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return c=lv(this.parent.sceneContainer),l.setContainer(c,this.parent.sceneContainer),_.next=4,l.init();case 4:s.addMask(l),this.tileMaskLayers.push(l);case 6:case"end":return _.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addLayer",value:function(){var n=(0,Nt.Z)(xe().mark(function a(s){var l;return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return s.isTileLayer=!0,l=lv(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),this.layers.push(s),p.next=6,s.init();case 6:case"end":return p.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateVisible",value:function(i){this.visible=i,this.updateOptions("visible",i)}},{key:"updateOptions",value:function(i,a){this.layers.forEach(function(s){s.updateLayerConfig((0,N.Z)({},i,a))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(i){return[]}},{key:"getFeatureById",value:function(i){return[]}},{key:"destroy",value:function(){var i;(i=this.tileMask)===null||i===void 0||i.destroy(),this.layers.forEach(function(a){return a.destroy()})}}]),t}(Fa.EventEmitter);function r5(e){var r=n5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function n5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i5=function(e){(0,Qe.Z)(t,e);var r=r5(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.getSourceOption(),l=s.data.features[0].properties,c=new d_().source(s.data,s.options).size(1).shape("line").color("red"),p=new H0({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),b.next=6,this.addLayer(c);case 6:return b.next=8,this.addLayer(p);case 8:this.isLoaded=!0;case 9:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:a},options:{parser:{type:"geojson"},transforms:i.transforms}}}}]),t}(Sd);function a5(e){var r=o5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function o5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s5=function(e){(0,Qe.Z)(t,e);var r=a5(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new jx((0,k.Z)({},l)).source(c.data,c.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;p[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(Sd);function u5(e){var r=l5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function l5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c5=function(e){(0,Qe.Z)(t,e);var r=u5(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new vb((0,k.Z)({},l)).source(c.data,c.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;p[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getFeatures",value:function(i){if(!i)return[];var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=a.featureId,c=this.getFeatures(s);return{data:{type:"FeatureCollection",features:c},options:{parser:{type:"geojson",featureId:l},transforms:i.transforms}}}}]),t}(Sd),f5=["rasterData"];function h5(e){var r=p5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function p5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d5=function(e){(0,Qe.Z)(t,e);var r=h5(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new W0((0,k.Z)({},l)).source(c.data,c.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;p[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,yl.Z)(a,f5);return{data:s,options:{parser:(0,k.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}}]),t}(Sd);function v5(e){var r=m5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function m5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g5=function(e){(0,Qe.Z)(t,e);var r=v5(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p;return xe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new W0((0,k.Z)({},l)).source(c.data,c.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;p[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(Sd),_5=["rasterData"];function y5(e){var r=x5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function x5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b5={positions:[0,1],colors:["#000","#fff"]},E5=function(e){(0,Qe.Z)(t,e);var r=y5(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_,b,A;return xe().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=this.getLayerOptions(),_=p.rampColors,b=p.domain,this.colorTexture=this.parent.textureService.getColorTexture(_,b),A=new W0((0,k.Z)((0,k.Z)({},l),{},{colorTexture:this.colorTexture})).source(c.data,c.options),s&&Object.keys(s).forEach(function(P){var B,H,Q=P;A[Q]((B=s[Q])===null||B===void 0?void 0:B.field,(H=s[Q])===null||H===void 0?void 0:H.values)}),I.next=9,this.addLayer(A);case 9:this.isLoaded=!0;case 10:case"end":return I.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,yl.Z)(a,_5);return{data:s,options:{parser:(0,k.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}},{key:"styleUpdate",value:function(){for(var i=this,a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];var c=s,p=c.rampColors,_=p===void 0?b5:p,b=c.domain;this.colorTexture=this.parent.textureService.getColorTexture(_,b||Da(_)),this.layers.forEach(function(A){return A.style({colorTexture:i.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(i){return i.destroy()})}}]),t}(Sd);function S5(e){var r=A5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function A5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ug=function(e){(0,Qe.Z)(t,e);var r=S5(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s,l,c,p,_;return xe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=QO(this.parent.type),p=this.getSourceOption(),p){A.next=8;break}return this.isLoaded=!0,this.emit("loaded"),A.abrupt("return");case 8:return _=new c((0,k.Z)({},l)).source(p.data,p.options),Object.keys(s).forEach(function(w){var I,P,B=w;_[B]((I=s[B])===null||I===void 0?void 0:I.field,(P=s[B])===null||P===void 0?void 0:P.values)}),A.next=12,this.addLayer(_);case 12:if(!l.tileMask){A.next=15;break}return A.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(_),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=s===void 0?"defaultLayer":s,c=a.featureId,p=c===void 0?"id":c,_=this.getFeatures(l);return{data:{type:"FeatureCollection",features:_},options:{parser:{type:"geojson",featureId:p},transforms:i.transforms}}}},{key:"setLayerMinMaxZoom",value:function(i){i.getModelType()==="text"&&i.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(i){var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getFeatureById",value:function(i){var a=this.getMainLayer();if(!a)return[];var s=a.getSource().data.dataArray.filter(function(l){return l._id===i});return s}}]),t}(Sd);function T5(e){var r=e.type;switch(r){case"PolygonLayer":return ug;case"LineLayer":return ug;case"PointLayer":return ug;case"TileDebugLayer":return i5;case"MaskLayer":return c5;case"RasterLayer":var t=e.getSource().parser.dataType;switch(t){case Mu.RGB:case Mu.CUSTOMRGB:return d5;case Mu.ARRAYBUFFER:case Mu.CUSTOMARRAYBUFFER:return E5;case Mu.TERRAINRGB:case Mu.CUSTOMTERRAINRGB:return g5;default:return s5}default:return ug}}var w5=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],C5=vi.debounce,WE=function(){function e(r){var t=this;(0,ge.Z)(this,e),(0,N.Z)(this,"initedTileset",!1),(0,N.Z)(this,"mapchange",function(){var i;if(t.parent.isVisible()!==!1){var a=t.getCurrentView(),s=a.latLonBounds,l=a.zoom;if(t.mapService.version==="GAODE1.x"){var c=t.parent.getLayerConfig(),p=c.visible;l<2&&p?(t.parent.updateLayerConfig({visible:!1}),t.layerService.reRender()):l>=2&&!p&&(t.parent.updateLayerConfig({visible:!0}),t.layerService.reRender())}t.lastViewStates&&t.lastViewStates.zoom===l&&t.lastViewStates.latLonBounds.toString()===s.toString()||(t.lastViewStates={zoom:l,latLonBounds:s},(i=t.tilesetManager)===null||i===void 0||i.throttleUpdate(l,s))}}),(0,N.Z)(this,"viewchange",C5(this.mapchange,24)),this.parent=r;var n=this.parent.getContainer();this.rendererService=n.get(Ye.IRendererService),this.layerService=n.get(Ye.ILayerService),this.mapService=n.get(Ye.IMapService),this.pickingService=n.get(Ye.IPickingService),this.tileLayerService=new GO({rendererService:this.rendererService,layerService:this.layerService,parent:r}),this.tilePickService=new KO({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:r}),this.parent.setLayerPickService(this.tilePickService),this.proxy(r),this.initTileSetManager()}return(0,K.Z)(e,[{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var i=this.getCurrentView(),a=i.latLonBounds,s=i.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(s,a)}}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:n,zoom:i}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,i){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(t){return this.tileLayerService.getTile(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var t;this.tilesetManager.clear();var n=this.getCurrentView(),i=n.latLonBounds,a=n.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(a,i)}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:function(){var r=(0,Nt.Z)(xe().mark(function n(){var i=this,a,s;return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.tilesetManager){c.next=2;break}return c.abrupt("return");case 2:return a=this.parent.getMinZoom(),s=this.parent.getMaxZoom(),c.next=6,Promise.all(this.tilesetManager.tiles.filter(function(p){return p.isLoaded}).filter(function(p){return p.isVisibleChange}).filter(function(p){return p.data}).filter(function(p){return p.z>=a&&p.z<s}).map(function(){var p=(0,Nt.Z)(xe().mark(function _(b){var A,w;return xe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(i.tileLayerService.hasTile(b.key)){P.next=9;break}return A=T5(i.parent),w=new A(b,i.parent),P.next=5,w.initTileLayer();case 5:i.tilePickService.setPickState(),w.getLayers().length!==0&&(i.tileLayerService.addTile(w),i.tileLayerService.updateTileVisible(b),i.layerService.reRender()),P.next=12;break;case 9:i.tileLayerService.updateTileVisible(b),i.tilePickService.setPickState(),i.layerService.reRender();case 12:case"end":return P.stop()}},_)}));return function(_){return p.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return c.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var n=this;w5.forEach(function(i){var a=t[i].bind(t);t[i]=function(){for(var s=arguments.length,l=new Array(s),c=0;c<s;c++)l[c]=arguments[c];return a.apply(void 0,l),n.getLayers().map(function(p){p[i].apply(p,l)}),i==="style"&&n.getTiles().forEach(function(p){return p.styleUpdate.apply(p,l)}),t}})}}]),e}(),GE,XE,R5=(GE=(0,Jt.b2)(),GE(XE=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"build",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i){return xe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i.prepareBuildModel(),s.next=3,i.buildModels();case 3:case"end":return s.stop()}},n)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"initLayerModel",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i){return xe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"prepareLayerModel",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i){return xe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"apply",value:function(t){var n=this;t.hooks.init.tapPromise("LayerModelPlugin",(0,Nt.Z)(xe().mark(function i(){return xe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!t.getSource().isTile){s.next=4;break}return t.prepareBuildModel(),t.tileLayer=new WE(t),s.abrupt("return");case 4:return t.log(Ts.BuildModelStart,jt.INIT),s.next=7,n.initLayerModel(t);case 7:t.log(Ts.BuildModelEnd,jt.INIT);case 8:case"end":return s.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=(0,Nt.Z)(xe().mark(function a(s){return xe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s){c.next=2;break}return c.abrupt("return",!1);case 2:if(!t.getSource().isTile){c.next=5;break}return t.tileLayer=new WE(t),c.abrupt("return",!1);case 5:return t.log(Ts.BuildModelStart,jt.UPDATE),c.next=8,n.prepareLayerModel(t);case 8:return t.log(Ts.BuildModelEnd,jt.UPDATE),c.abrupt("return",!0);case 10:case"end":return c.stop()}},a)}));return function(a){return i.apply(this,arguments)}}())}}]),e}())||XE),$E,YE,M5=($E=(0,Jt.b2)(),$E(YE=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){var n=t.getLayerConfig(),i=n.autoFit,a=n.fitBoundsOptions;i&&t.fitBounds(a),t.styleNeedUpdate=!1})}}]),e}())||YE),qE,KE,I5=["type"],QE={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},P5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},O5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},k5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function D5(e){var r={u_DirectionalLights:new Array(3).fill((0,k.Z)({},O5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,k.Z)({},k5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[P5]),e.forEach(function(t){var n=t.type,i=n===void 0?"directional":n,a=(0,yl.Z)(t,I5),s=QE[i].lights,l=QE[i].num,c=r[l];r[s][c]=(0,k.Z)((0,k.Z)({},r[s][c]),a),r[l]++}),r}var L5=(qE=(0,Jt.b2)(),qE(KE=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),i=n.enableLighting;i&&t.models.forEach(function(a){return a.addUniforms((0,k.Z)({},D5()))})})}}]),e}())||KE),JE,e2,B5=(JE=(0,Jt.b2)(),JE(e2=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.rendererService,s=n.postProcessingPassFactory,l=n.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var c=t.getLayerConfig(),p=c.enableMultiPassRenderer,_=c.passes,b=_===void 0?[]:_;i.enabled=!!p&&t.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(t.multiPassRenderer=mx(t,b,s,l),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var c=a.getViewportSize(),p=c.width,_=c.height;t.multiPassRenderer.resize(p,_)}})}}]),e}())||e2),t2,r2,F5=vi.isNumber,bv={NONE:0,ENCODE:1,HIGHLIGHT:2},N5=(t2=(0,Jt.b2)(),t2(r2=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"pickOption2Array",value:function(){var t=[];return this.pickingUniformMap.forEach(function(n,i){F5(n)?t.push(n):t.push.apply(t,(0,Gt.Z)(n))}),t}},{key:"updatePickOption",value:function(t,n){var i=this;Object.keys(t).forEach(function(c){i.pickingUniformMap.set(c,t[c])});var a=n.getLayerConfig().pickingBuffer||0,s=Number(n.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",a),this.pickingUniformMap.set("u_shaderPick",s);var l=n.getPickingUniformBuffer();l.subData({offset:0,data:this.pickOption2Array()})}},{key:"apply",value:function(t,n){var i=this,a=n.rendererService,s=n.styleAttributeService,l;this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_EnableSelect",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",function(){var c=t.getLayerConfig(),p=c.enablePicking;s.registerStyleAttribute({name:"pickingColor",type:Un.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:Qn.PICKING_COLOR,buffer:{data:[],type:Y.FLOAT},size:3,update:function(b){var A=b.id;return p?Ra(A):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var c=t.getLayerConfig(),p=c.enablePicking;p&&t.isVisible()&&(i.updatePickOption({u_PickingStage:bv.ENCODE},t),t.models.forEach(function(_){return _.addUniforms({u_PickingStage:bv.ENCODE})}))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var c=t.getLayerConfig(),p=c.enablePicking;p&&t.isVisible()&&(i.updatePickOption({u_PickingStage:bv.HIGHLIGHT},t),t.models.forEach(function(_){return _.addUniforms({u_PickingStage:bv.HIGHLIGHT})}))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(c){var p=t.getLayerConfig(),_=p.highlightColor,b=p.activeMix,A=b===void 0?0:b,w=typeof _=="string"?li(_):_||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:ia(new Uint8Array(c))});var I={u_PickingStage:bv.HIGHLIGHT,u_PickingColor:c,u_HighlightColor:w.map(function(P){return P*255}),u_activeMix:A};i.updatePickOption(I,t),t.models.forEach(function(P){return P.addUniforms(I)})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(c){var p=t.getLayerConfig(),_=p.selectColor,b=p.selectMix,A=b===void 0?0:b,w=typeof _=="string"?li(_):_||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:ia(new Uint8Array(c))});var I={u_PickingStage:bv.HIGHLIGHT,u_PickingColor:c,u_HighlightColor:w.map(function(P){return P*255}),u_activeMix:A,u_CurrentSelectedId:c,u_SelectColor:w.map(function(P){return P*255}),u_EnableSelect:1};i.updatePickOption(I,t),t.models.forEach(function(P){return P.addUniforms(I)})})}}]),e}())||r2),U5=["mvt","geojsonvt","testTile"];function z5(e){var r=e.getSource();return U5.includes(r.parser.type)}function y6(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var n2,i2,Z5=(n2=(0,Jt.b2)(),n2(i2=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){z5(t)||i.registerBuiltinAttributes(a,t)})}},{key:"registerBuiltinAttributes",value:function(t,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:Un.Attribute,descriptor:{name:"a_Position",shaderLocation:Qn.POSITION,buffer:{data:[],type:Y.FLOAT},size:3,update:function(i,a,s){return s.length===2?[s[0],s[1],0]:[s[0],s[1],s[2]]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:Un.Attribute,descriptor:{name:"a_Color",shaderLocation:Qn.COLOR,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(i){var a=i.color;return!a||!a.length?[1,1,1,1]:a}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:Un.Attribute,descriptor:{name:"a_vertexId",shaderLocation:Qn.VERTEX_ID,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(i,a){return[a]}}})}}]),e}())||i2),a2,o2,s2,u2,l2,c2,f2,Ad,h2,p2,d2,v2,m2,V5=(a2=(0,Jt.b2)(),o2=(0,Jt.f3)(Ye.ICameraService),s2=(0,Jt.f3)(Ye.ICoordinateSystemService),u2=(0,Jt.f3)(Ye.IRendererService),l2=(0,Jt.f3)(Ye.IMapService),c2=(0,Jt.f3)(Ye.ILayerService),a2(f2=(Ad=function(){function e(){(0,ge.Z)(this,e),qr(this,"cameraService",h2,this),qr(this,"coordinateSystemService",p2,this),qr(this,"rendererService",d2,this),qr(this,"mapService",v2,this),qr(this,"layerService",m2,this)}return(0,K.Z)(e,[{key:"apply",value:function(t){var n=this,i=this.mapService.version,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=[0,0],l;this.rendererService.uniformBuffers[0]||(l=this.rendererService.createBuffer({data:new Float32Array(16*4+4*7),isUBO:!0}),this.rendererService.uniformBuffers[0]=l),t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var c=t.getLayerConfig().tileOrigin;if(n.coordinateSystemService.refresh(c),i==="GAODE2.x"){n.setLayerCenter(t),a=n.mapService.map.customCoords.getMVPMatrix(),s=n.mapService.getCustomCoordCenter();var p=t.getLayerUniformBuffer();p.subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,Gt.Z)(a),(0,Gt.Z)(s))).buffer)})}var _=n.rendererService.getViewportSize(),b=_.width,A=_.height,w=n.generateUBO(a,s,b,A),I=w.data,P=w.uniforms;n.layerService.alreadyInRendering&&l&&l.subData({offset:0,data:I}),t.models.forEach(function(B){B.addUniforms((0,k.Z)((0,k.Z)({},P),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}},{key:"setLayerCenter",value:function(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}},{key:"generateUBO",value:function(t,n,i,a){var s,l=this.cameraService.getProjectionMatrix(),c=this.cameraService.getViewMatrix(),p=this.cameraService.getViewProjectionMatrix(),_=this.cameraService.getModelMatrix(),b=this.coordinateSystemService.getViewportCenterProjection(),A=this.coordinateSystemService.getPixelsPerDegree(),w=this.cameraService.getZoom(),I=this.coordinateSystemService.getPixelsPerDegree2(),P=this.cameraService.getZoomScale(),B=this.coordinateSystemService.getPixelsPerMeter(),H=this.coordinateSystemService.getCoordinateSystem(),Q=this.cameraService.getCameraPosition(),ue=window.devicePixelRatio,Ee=this.coordinateSystemService.getViewportCenter(),Le=[i,a],Ze=this.cameraService.getFocalDistance(),tt=[].concat((0,Gt.Z)(c),(0,Gt.Z)(l),(0,Gt.Z)(p),(0,Gt.Z)(_),(0,Gt.Z)(b),(0,Gt.Z)(A),[w],(0,Gt.Z)(I),[P],(0,Gt.Z)(B),[H],(0,Gt.Z)(Q),[ue],(0,Gt.Z)(Ee),Le,[Ze,0,0,0]);return{data:tt,uniforms:(s={},(0,N.Z)(s,gd.ProjectionMatrix,l),(0,N.Z)(s,gd.ViewMatrix,c),(0,N.Z)(s,gd.ViewProjectionMatrix,p),(0,N.Z)(s,gd.Zoom,w),(0,N.Z)(s,gd.ZoomScale,P),(0,N.Z)(s,gd.FocalDistance,Ze),(0,N.Z)(s,gd.CameraPosition,Q),(0,N.Z)(s,Yu.CoordinateSystem,H),(0,N.Z)(s,Yu.ViewportCenter,Ee),(0,N.Z)(s,Yu.ViewportCenterProjection,b),(0,N.Z)(s,Yu.PixelsPerDegree,A),(0,N.Z)(s,Yu.PixelsPerDegree2,I),(0,N.Z)(s,Yu.PixelsPerMeter,B),(0,N.Z)(s,Yu.Mvp,t),(0,N.Z)(s,"u_sceneCenterMercator",n),(0,N.Z)(s,"u_ViewportSize",Le),(0,N.Z)(s,"u_ModelMatrix",_),(0,N.Z)(s,"u_DevicePixelRatio",ue),s)}}}]),e}(),h2=Cr(Ad.prototype,"cameraService",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p2=Cr(Ad.prototype,"coordinateSystemService",[s2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d2=Cr(Ad.prototype,"rendererService",[u2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v2=Cr(Ad.prototype,"mapService",[l2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m2=Cr(Ad.prototype,"layerService",[c2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad))||f2),g2,_2,j5=(g2=(0,Jt.b2)(),g2(_2=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate().then(function(n){n&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",function(){t.layerModelNeedUpdate=!1})}}]),e}())||_2),y2,x2,H5=(y2=(0,Jt.b2)(),y2(x2=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(t,{styleAttributeService:a})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||t.inited&&i.updateStyleAttribute(t,{styleAttributeService:a})})}},{key:"updateStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[],s=i.getLayerStyleAttribute("filter");if(s&&s.needRegenerateVertices){t.layerModelNeedUpdate=!0,a.forEach(function(l){return l.needRegenerateVertices=!1});return}a.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,t),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[];a.filter(function(s){return s.needRegenerateVertices}).forEach(function(s){i.updateAttributeByFeatureRange(s.name,t.getEncodedData(),s.featureRange.startIndex,s.featureRange.endIndex),s.needRegenerateVertices=!1})}}]),e}())||x2);Ul.bind(Ye.ILayerPlugin).to(CP).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(Z5).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(jO).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(wP).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(M5).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(WO).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(H5).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(j5).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(B5).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(V5).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(HO).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(L5).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(N5).inRequestScope(),Ul.bind(Ye.ILayerPlugin).to(R5).inRequestScope();function W5(e){var r=G5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function G5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x6=function(e){(0,Qe.Z)(t,e);var r=W5(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"isMoving",!1),(0,N.Z)((0,we.Z)(n),"move",function(l){switch(l.stopPropagation(),l.type){case"touchcancel":case"touchend":case"mouseup":{var c;n.isMoving=!1,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(function(wt){document.removeEventListener(wt,n.move)}),(c=n.scene)===null||c===void 0||c.render();break}case"mousedown":case"touchstart":n.isMoving=!0,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(function(wt){document.addEventListener(wt,n.move)});case"mousemove":case"touchmove":{if(n.isMoving)if(n.controlOption.orientation==="vertical"){var p;if("pageX"in l?p=l.pageX:l.touches&&l.touches.length&&l.touches[0].pageX?p=l.touches[0].pageX:l.changedTouches&&l.changedTouches.length&&(p=l.changedTouches[0].pageX),!p)break;var _=n.getContainerDOMRect(),b=n.getContainerSize(),A=b[0],w=(_==null?void 0:_.left)||0,I=p-w+window.scrollX-document.documentElement.clientLeft,P=A-Math.min(Math.max(0,A-I),A),B=P/A;n.setOptions({ratio:B}),n.emit("moving",{size:[P,b[1]],ratio:[B,0]})}else{var H;if("pageY"in l?H=l.pageY:l.touches&&l.touches.length&&l.touches[0].pageY?H=l.touches[0].pageY:l.changedTouches&&l.changedTouches.length&&(H=l.changedTouches[0].pageY),!H)break;var Q=n.getContainerDOMRect(),ue=n.getContainerSize(),Ee=ue[1],Le=(Q==null?void 0:Q.top)||0,Ze=H-Le+window.scrollY-document.documentElement.clientTop,tt=Ee-Math.min(Math.max(0,Ee-Ze),Ee),ft=tt/Ee;n.setOptions({ratio:ft}),n.emit("moving",{size:[ue[0],tt],ratio:[0,ft]})}break}default:break}}),(0,N.Z)((0,we.Z)(n),"getMaskLayer",function(){return new Tm({visible:!1}).source({type:"FeatureCollection",features:[]}).shape("fill").color("red").style({opacity:.1})}),(0,N.Z)((0,we.Z)(n),"updateMask",function(){var l;if(!!n.mapsService){var c=n.getMaskGeoData();(l=n.maskLayer)===null||l===void 0||l.setData(c)}}),n}return(0,K.Z)(t,[{key:"getDefault",value:function(){return(0,k.Z)((0,k.Z)({},(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this)),{},{layers:[],rightLayers:[],ratio:.5,orientation:"vertical"})}},{key:"onAdd",value:function(){var i=In("div","l7-control-swipe");In("button","l7-control-swipe__button",i);var a=this.controlOption,s=a.orientation,l=s===void 0?"vertical":s,c=a.ratio,p=c===void 0?.5:c;return l==="horizontal"?(i.style.top=p*100+"%",i.style.left=""):(i.style.left=p*100+"%",i.style.top=""),i.classList.add(l),i}},{key:"addTo",value:function(i){this.mapsService=i.get(Ye.IMapService),this.renderService=i.get(Ye.IRendererService),this.layerService=i.get(Ye.ILayerService),this.controlService=i.get(Ye.IControlService),this.configService=i.get(Ye.IGlobalConfigService),this.scene=i.get(Ye.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd();var a=this.controlOption,s=a.className,l=a.style,c=a.layers,p=a.rightLayers;s&&this.setClassName(s),l&&this.setStyle(l),this.mapsService.getMarkerContainer().appendChild(this.container),this.maskLayer=this.getMaskLayer(),this.updateMask(),this.registerEvent(),this.addMaskToLayers(c,!1),this.addMaskToLayers(p,!0);var _=lv(i);return this.maskLayer.setContainer(_,i),this.scene.addLayer(this.maskLayer),this.emit("add",this),this}},{key:"onRemove",value:function(){if(this.maskLayer){var i,a=this.controlOption,s=a.layers,l=a.rightLayers;this.removeMaskFromLayers(s),this.removeMaskFromLayers(l),(i=this.layerService)===null||i===void 0||i.remove(this.maskLayer)}this.unRegisterEvent(),this.removeAllListeners()}},{key:"show",value:function(){var i,a=this.container;Uu(a,"l7-control-swipe_hide");var s=this.controlOption,l=s.layers,c=s.rightLayers;l.forEach(function(p){return p.enableMask()}),c.forEach(function(p){return p.enableMask()}),(i=this.scene)===null||i===void 0||i.render(),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i,a=this.container;Es(a,"l7-control-swipe_hide");var s=this.controlOption,l=s.layers,c=s.rightLayers;l.forEach(function(p){return p.disableMask()}),c.forEach(function(p){return p.disableMask()}),(i=this.scene)===null||i===void 0||i.render(),this.isShow=!1,this.emit("hide",this)}},{key:"setOptions",value:function(i){var a=(0,k.Z)((0,k.Z)({},this.controlOption),i);if(i.className&&this.setClassName(i.className),i.style&&this.setStyle(i.style),(i.orientation||i.ratio!==void 0)&&this.setOrientationAndRatio(a.orientation,a.ratio),i.layers){var s=i.layers,l=this.controlOption.layers;this.setLayers(s,l,!1)}if(i.rightLayers){var c=i.rightLayers,p=this.controlOption.rightLayers;this.setLayers(c,p,!0)}this.controlOption=a,this.updateMask()}},{key:"registerEvent",value:function(){this.container.addEventListener("mousedown",this.move),this.container.addEventListener("touchstart",this.move),this.mapsService.on("camerachange",this.updateMask)}},{key:"unRegisterEvent",value:function(){var i;this.container.removeEventListener("mousedown",this.move),this.container.removeEventListener("touchstart",this.move),(i=this.mapsService)===null||i===void 0||i.off("camerachange",this.updateMask)}},{key:"setOrientationAndRatio",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"vertical",a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;this.container.classList.remove("horizontal","vertical"),this.container.classList.add(i),i==="horizontal"?(this.container.style.top=a*100+"%",this.container.style.left=""):(this.container.style.left=a*100+"%",this.container.style.top="")}},{key:"setLayers",value:function(i,a){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,l=i.filter(function(p){return a.includes(p)===!1}),c=a.filter(function(p){return i.includes(p)===!1});this.addMaskToLayers(l,s),this.removeMaskFromLayers(c)}},{key:"addMaskToLayers",value:function(i,a){var s=this;i.forEach(function(l){l.updateLayerConfig({maskInside:!a}),l.addMask(s.maskLayer)})}},{key:"removeMaskFromLayers",value:function(i){var a=this;i.forEach(function(s){s.updateLayerConfig({maskInside:!0}),s.removeMask(a.maskLayer)})}},{key:"getMaskGeoData",value:function(){var i=this.controlOption,a=i.ratio,s=a===void 0?.5:a,l=i.orientation,c=l===void 0?"vertical":l,p=c==="vertical",_=this.getBounds(),b=(0,re.Z)(_,2),A=b[0],w=b[1],I=(0,re.Z)(A,2),P=I[0],B=I[1],H=(0,re.Z)(w,2),Q=H[0],ue=H[1],Ee;if(p){var Le=P+(Q-P)*s;Ee=[[P,ue],[Le,ue],[Le,B],A,[P,ue]]}else{var Ze=this.getContainerSize(),tt=this.mapsService.containerToLngLat([Ze[0],Ze[1]*s]),ft=tt.lat;Ee=[[P,ue],w,[Q,ft],[P,ft],[P,ue]]}var wt={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[Ee]}}]};return wt}},{key:"getContainerDOMRect",value:function(){var i,a=(i=this.mapsService.getContainer())===null||i===void 0?void 0:i.getBoundingClientRect();return a}},{key:"getContainerSize",value:function(){var i=this.mapsService.getSize();return i}},{key:"getBounds",value:function(){var i=this.mapsService.getBounds();return i}},{key:"addLayer",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=Array.isArray(i)?i:[i];if(a){var l,c=(l=this.controlOption.rightLayers).concat.apply(l,(0,Gt.Z)(s));this.setOptions({rightLayers:c})}else{var p,_=(p=this.controlOption.layers).concat.apply(p,(0,Gt.Z)(s));this.setOptions({layers:_})}}},{key:"removeLayer",value:function(i){var a=Array.isArray(i)?i:[i],s=this.controlOption.layers.filter(function(c){return a.includes(c)}),l=this.controlOption.rightLayers.filter(function(c){return a.includes(c)});this.setOptions({layers:s,rightLayers:l})}},{key:"removeLayers",value:function(){this.setOptions({layers:[],rightLayers:[]})}}]),t}(_d);function X5(e){var r=$5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function $5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y5=function(e){(0,Qe.Z)(t,e);var r=X5(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,N.Z)((0,we.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,N.Z)((0,we.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,K.Z)(t,[{key:"getDefault",value:function(i){return(0,k.Z)((0,k.Z)({},(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this,i)),{},{position:x.BOTTOMRIGHT,name:"zoom",zoomInText:Bh("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Bh("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(i){(0,va.Z)((0,pe.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var i=In("div","l7-control-zoom");return this.resetButtonGroup(i),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),i}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(i){Pl(i),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",i,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",i)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",i,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(i,a,s,l,c){var p=In("button",s,l);return typeof i=="string"?p.innerHTML=i:p.append(i),p.title=a,c&&p.addEventListener("click",c),p}}]),t}(_d);function q5(e){var r=K5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function K5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B_=function(e){(0,Qe.Z)(t,e);var r=q5(t);function t(n){var i;(0,ge.Z)(this,t),i=r.call(this),(0,N.Z)((0,we.Z)(i),"isShow",!0),(0,N.Z)((0,we.Z)(i),"onMouseMove",function(s){var l,c=i.mapsService.getMapContainer(),p=(l=c==null?void 0:c.getBoundingClientRect())!==null&&l!==void 0?l:{},_=p.left,b=_===void 0?0:_,A=p.top,w=A===void 0?0:A;i.setPopupPosition(s.clientX-b,s.clientY-w)}),(0,N.Z)((0,we.Z)(i),"updateLngLatPosition",function(){if(!(!i.mapsService||i.popupOption.followCursor)){var s=i.lngLat,l=s.lng,c=s.lat,p=i.mapsService.lngLatToContainer([l,c]),_=p.x,b=p.y;i.setPopupPosition(_,b)}}),(0,N.Z)((0,we.Z)(i),"onKeyDown",function(s){s.keyCode===27&&i.remove()}),(0,N.Z)((0,we.Z)(i),"onCloseButtonClick",function(s){s.stopPropagation&&s.stopPropagation(),i.hide()}),(0,N.Z)((0,we.Z)(i),"update",function(){var s=!!i.lngLat,l=i.popupOption,c=l.className,p=l.style,_=l.maxWidth,b=l.anchor,A=l.stopPropagation;if(!(!i.mapsService||!s||!i.content)){var w=i.mapsService.getMarkerContainer();if(!i.container&&w&&(i.container=In("div","l7-popup ".concat(c!=null?c:""," ").concat(i.isShow?"":"l7-popup-hide"),w),p&&i.container.setAttribute("style",p),i.tip=In("div","l7-popup-tip",i.container),i.container.appendChild(i.content),A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(B){i.container.addEventListener(B,function(H){H.stopPropagation()})}),i.container.style.whiteSpace="nowrap"),i.updateLngLatPosition(),_u(i.container,"".concat(Ju[b])),iu(i.container,b,"popup"),_){var I=i.container.getBoundingClientRect(),P=I.width;P>parseFloat(_)&&(i.container.style.width=_)}else i.container.style.removeProperty("width")}}),i.popupOption=(0,k.Z)((0,k.Z)({},i.getDefault(n!=null?n:{})),n);var a=i.popupOption.lngLat;return a&&(i.lngLat=a),i}return(0,K.Z)(t,[{key:"lngLat",get:function(){var i;return(i=this.popupOption.lngLat)!==null&&i!==void 0?i:{lng:0,lat:0}},set:function(i){this.popupOption.lngLat=i}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(i){this.mapsService=i.get(Ye.IMapService),this.sceneService=i.get(Ye.ISceneService),this.layerService=i.get(Ye.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var a=this.popupOption,s=a.html,l=a.text,c=a.title;return s?this.setHTML(s):l&&this.setText(l),c&&this.setTitle(c),this.emit("open"),this}},{key:"remove",value:function(){if(!!(this!==null&&this!==void 0&&this.isOpen()))return this.content&&Ys(this.content),this.container&&(Ys(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(i){return this.show(),this.popupOption=(0,k.Z)((0,k.Z)({},this.popupOption),i),this.checkUpdateOption(i,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Ys(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(i,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(i,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(i,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(i,["html"])&&i.html?this.setHTML(i.html):this.checkUpdateOption(i,["text"])&&i.text&&this.setText(i.text),this.checkUpdateOption(i,["lngLat"])&&i.lngLat&&this.setLnglat(i.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Uu(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&Es(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(i){return this.popupOption.html=i,this.setDOMContent(i)}},{key:"setText",value:function(i){return this.popupOption.text=i,this.setDOMContent(window.document.createTextNode(i))}},{key:"setTitle",value:function(i){this.show(),this.popupOption.title=i,i?(this.contentTitle||(this.contentTitle=In("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),Pl(this.contentTitle),Is(this.contentTitle,i)):this.contentTitle&&(Ys(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var i=this.lngLat,a=i.lng,s=i.lat;return this.popupOption.autoPan&&this.mapsService.panTo([a,s]),this}},{key:"setLngLat",value:function(i){return this.setLnglat(i)}},{key:"setLnglat",value:function(i){var a=this;return this.show(),this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){a.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(i){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Ca.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(i){return this.show(),this.createContent(),Is(this.contentPanel,i),this.update(),this}},{key:"updateCloseOnClick",value:function(i){var a=this,s=this.mapsService;s&&(s==null||s.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!i&&requestAnimationFrame(function(){s==null||s.on("click",a.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(i){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!i&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(i){var a,s=(a=this.mapsService)===null||a===void 0?void 0:a.getContainer();s&&(s==null||s.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!i&&(s==null||s.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var i=this;if(this.content&&Ys(this.content),this.contentTitle=void 0,this.content=In("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var a=Bh("l7-icon-guanbi");Es(a,"l7-popup-close-button"),this.content.appendChild(a),this.popupOption.closeButtonOffsets&&(a.style.right=this.popupOption.closeButtonOffsets[0]+"px",a.style.top=this.popupOption.closeButtonOffsets[1]+"px"),a.setAttribute("aria-label","Close popup"),a.addEventListener("click",function(){i.hide()}),a.addEventListener("pointerup",function(s){s.stopPropagation()}),a.addEventListener("pointerdown",function(s){s.stopPropagation()}),this.closeButton=a}else this.closeButton=void 0;this.contentPanel=In("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(i,a){if(this.container){var s=this.popupOption.offsets;this.container.style.left=i+s[0]+"px",this.container.style.top=a-s[1]+"px"}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),t}(Fa.EventEmitter);function Q5(e){var r=J5();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function J5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ek=vi.get,b6=function(e){(0,Qe.Z)(t,e);var r=Q5(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"layerClickCountByFrame",0),(0,N.Z)((0,we.Z)(n),"layerConfigMap",new WeakMap),(0,N.Z)((0,we.Z)(n),"onLayerClick",function(l,c){requestAnimationFrame(function(){if(n.popupOption.closeOnClick&&n.layerClickCountByFrame++,n.isShow&&n.isSameFeature(l,c.featureId))n.hide();else{var p=n.getLayerInfoFrag(l,c),_=p.title,b=p.content;n.setDOMContent(b),n.setLnglat(c.lngLat),n.setTitle(_),n.displayFeatureInfo={layer:l,featureId:c.featureId},n.show()}})}),(0,N.Z)((0,we.Z)(n),"onSceneClick",function(){n.layerClickCountByFrame=0,requestAnimationFrame(function(){n.layerClickCountByFrame||n.hide()})}),(0,N.Z)((0,we.Z)(n),"updateCloseOnClick",function(){}),n}return(0,K.Z)(t,[{key:"layerConfigItems",get:function(){var i,a=this.popupOption,s=a.config,l=a.items;return(i=s!=null?s:l)!==null&&i!==void 0?i:[]}},{key:"addTo",value:function(i){return(0,va.Z)((0,pe.Z)(t.prototype),"addTo",this).call(this,i),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,va.Z)((0,pe.Z)(t.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(i){this.unbindLayerEvent();var a=(0,k.Z)({},i),s=a.trigger||this.popupOption.trigger,l=a.items||this.popupOption.items,c=(l==null?void 0:l.length)===0;return a.followCursor=s==="hover"&&!c,(0,va.Z)((0,pe.Z)(t.prototype),"setOptions",this).call(this,a),this.bindLayerEvent(),c&&this.hide(),this}},{key:"getDefault",value:function(i){var a=i.trigger==="hover";return(0,k.Z)((0,k.Z)({},(0,va.Z)((0,pe.Z)(t.prototype),"getDefault",this).call(this,i)),{},{trigger:"hover",followCursor:a,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var i=this,a=this.popupOption,s=a.trigger,l=a.closeOnClick;this.layerConfigItems.forEach(function(c){var p,_=i.getLayerByConfig(c);if(!!_){var b=(0,k.Z)({},c);if(s==="hover"){var A=i.onLayerMouseMove.bind(i,_),w=i.onLayerMouseOut.bind(i,_);b.onMouseMove=A,b.onMouseOut=w,_==null||_.on("mousemove",A),_==null||_.on("mouseout",w)}else{var I,P=i.onLayerClick.bind(i,_);b.onClick=P,_==null||_.on("click",P);var B=(I=i.mapsService)===null||I===void 0?void 0:I.getMapContainer();B&&l&&B.addEventListener("click",i.onSceneClick)}var H=_==null||(p=_.getSource)===null||p===void 0?void 0:p.call(_),Q=i.onSourceUpdate.bind(i);H==null||H.on("update",Q),b.onSourceUpdate=Q,i.layerConfigMap.set(_,b)}})}},{key:"unbindLayerEvent",value:function(){var i=this;this.layerConfigItems.forEach(function(a){var s,l=i.getLayerByConfig(a),c=l&&i.layerConfigMap.get(l);if(!!c){var p=c.onMouseMove,_=c.onMouseOut,b=c.onClick,A=c.onSourceUpdate;if(p&&l.off("mousemove",p),_&&l.off("mouseout",_),b&&l.off("click",b),A){var w;l==null||(w=l.getSource())===null||w===void 0||w.off("update",A)}var I=(s=i.mapsService)===null||s===void 0?void 0:s.getMapContainer();I&&I.removeEventListener("click",i.onSceneClick)}})}},{key:"onLayerMouseMove",value:function(i,a){if(!this.isSameFeature(i,a.featureId)){var s=this.getLayerInfoFrag(i,a),l=s.title,c=s.content;this.setDOMContent(c),this.setTitle(l),this.displayFeatureInfo={layer:i,featureId:a.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(i,a){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onSourceUpdate",value:function(){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(i,a){var s=this.layerConfigMap.get(i),l,c=document.createDocumentFragment();if(s){var p=a.feature;p.type==="Feature"&&"properties"in p&&"geometry"in p&&(p=p.properties);var _=s.title,b=s.fields,A=s.customContent;if(_){l=document.createDocumentFragment();var w=_ instanceof Function?_(p):_;Is(l,w)}if(A){var I=A instanceof Function?A(p):A;Is(c,I)}else b!=null&&b.length&&(b==null||b.forEach(function(P){var B,H,Q=typeof P=="string"?{field:P}:P,ue=Q.field,Ee=Q.formatField,Le=Q.formatValue,Ze=Q.getValue,tt=In("div","l7-layer-popup__row"),ft=Ze?Ze(a.feature):ek(p,ue),wt=(B=Ee instanceof Function?Ee(ue,p):Ee)!==null&&B!==void 0?B:ue,fr=(H=Le instanceof Function?Le(ft,p):Le)!==null&&H!==void 0?H:ft,hr=In("span","l7-layer-popup__key",tt);Is(hr,wt),Is(hr,document.createTextNode("\uFF1A"));var Mr=In("span","l7-layer-popup__value",tt);Array.isArray(fr)&&fr.every(function(ln){return!(ln instanceof Object)})&&(fr=fr.map(function(ln){return String(ln)}).join(",")),Is(Mr,fr),c.appendChild(tt)}))}return{title:l,content:c}}},{key:"getLayerByConfig",value:function(i){var a=i.layer;if(a instanceof Object)return a;if(typeof a=="string")return this.layerService.getLayer(a)||this.layerService.getLayerByName(a)}},{key:"isSameFeature",value:function(i,a){var s=this.displayFeatureInfo;return s&&i===s.layer&&a===s.featureId}}]),t}(B_);function tk(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}tk(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 0;
      -ms-flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
          flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -ms-touch-action: none;
      touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`);var rk=Z(81550),nk=Z.n(rk),ik=function(){function e(r,t){(0,ge.Z)(this,e);var n=t.buffer,i=t.offset,a=t.stride,s=t.normalized,l=t.size,c=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:c||0},l&&(this.attribute.size=l)}return(0,K.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Nh,Um,Pp,zc,zm,Op,Zm,lg,Yf,Td,Pu,qf,Kf,cg,ak=(Nh={},(0,N.Z)(Nh,Y.POINTS,"points"),(0,N.Z)(Nh,Y.LINES,"lines"),(0,N.Z)(Nh,Y.LINE_LOOP,"line loop"),(0,N.Z)(Nh,Y.LINE_STRIP,"line strip"),(0,N.Z)(Nh,Y.TRIANGLES,"triangles"),(0,N.Z)(Nh,Y.TRIANGLE_FAN,"triangle fan"),(0,N.Z)(Nh,Y.TRIANGLE_STRIP,"triangle strip"),Nh),b2=(Um={},(0,N.Z)(Um,Y.STATIC_DRAW,"static"),(0,N.Z)(Um,Y.DYNAMIC_DRAW,"dynamic"),(0,N.Z)(Um,Y.STREAM_DRAW,"stream"),Um),F_=(Pp={},(0,N.Z)(Pp,Y.BYTE,"int8"),(0,N.Z)(Pp,Y.INT,"int32"),(0,N.Z)(Pp,Y.UNSIGNED_BYTE,"uint8"),(0,N.Z)(Pp,Y.UNSIGNED_SHORT,"uint16"),(0,N.Z)(Pp,Y.UNSIGNED_INT,"uint32"),(0,N.Z)(Pp,Y.FLOAT,"float"),Pp),ok=(zc={},(0,N.Z)(zc,Y.ALPHA,"alpha"),(0,N.Z)(zc,Y.LUMINANCE,"luminance"),(0,N.Z)(zc,Y.LUMINANCE_ALPHA,"luminance alpha"),(0,N.Z)(zc,Y.RGB,"rgb"),(0,N.Z)(zc,Y.RGBA,"rgba"),(0,N.Z)(zc,Y.RGBA4,"rgba4"),(0,N.Z)(zc,Y.RGB5_A1,"rgb5 a1"),(0,N.Z)(zc,Y.RGB565,"rgb565"),(0,N.Z)(zc,Y.DEPTH_COMPONENT,"depth"),(0,N.Z)(zc,Y.DEPTH_STENCIL,"depth stencil"),zc),sk=(zm={},(0,N.Z)(zm,Y.DONT_CARE,"dont care"),(0,N.Z)(zm,Y.NICEST,"nice"),(0,N.Z)(zm,Y.FASTEST,"fast"),zm),E2=(Op={},(0,N.Z)(Op,Y.NEAREST,"nearest"),(0,N.Z)(Op,Y.LINEAR,"linear"),(0,N.Z)(Op,Y.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,N.Z)(Op,Y.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,N.Z)(Op,Y.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,N.Z)(Op,Y.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Op),S2=(Zm={},(0,N.Z)(Zm,Y.REPEAT,"repeat"),(0,N.Z)(Zm,Y.CLAMP_TO_EDGE,"clamp"),(0,N.Z)(Zm,Y.MIRRORED_REPEAT,"mirror"),Zm),uk=(lg={},(0,N.Z)(lg,Y.NONE,"none"),(0,N.Z)(lg,Y.BROWSER_DEFAULT_WEBGL,"browser"),lg),lk=(Yf={},(0,N.Z)(Yf,Y.NEVER,"never"),(0,N.Z)(Yf,Y.ALWAYS,"always"),(0,N.Z)(Yf,Y.LESS,"less"),(0,N.Z)(Yf,Y.LEQUAL,"lequal"),(0,N.Z)(Yf,Y.GREATER,"greater"),(0,N.Z)(Yf,Y.GEQUAL,"gequal"),(0,N.Z)(Yf,Y.EQUAL,"equal"),(0,N.Z)(Yf,Y.NOTEQUAL,"notequal"),Yf),A2=(Td={},(0,N.Z)(Td,Y.FUNC_ADD,"add"),(0,N.Z)(Td,Y.MIN_EXT,"min"),(0,N.Z)(Td,Y.MAX_EXT,"max"),(0,N.Z)(Td,Y.FUNC_SUBTRACT,"subtract"),(0,N.Z)(Td,Y.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Td),fg=(Pu={},(0,N.Z)(Pu,Y.ZERO,"zero"),(0,N.Z)(Pu,Y.ONE,"one"),(0,N.Z)(Pu,Y.SRC_COLOR,"src color"),(0,N.Z)(Pu,Y.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,N.Z)(Pu,Y.SRC_ALPHA,"src alpha"),(0,N.Z)(Pu,Y.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,N.Z)(Pu,Y.DST_COLOR,"dst color"),(0,N.Z)(Pu,Y.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,N.Z)(Pu,Y.DST_ALPHA,"dst alpha"),(0,N.Z)(Pu,Y.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,N.Z)(Pu,Y.CONSTANT_COLOR,"constant color"),(0,N.Z)(Pu,Y.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,N.Z)(Pu,Y.CONSTANT_ALPHA,"constant alpha"),(0,N.Z)(Pu,Y.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,N.Z)(Pu,Y.SRC_ALPHA_SATURATE,"src alpha saturate"),Pu),ck=(qf={},(0,N.Z)(qf,Y.NEVER,"never"),(0,N.Z)(qf,Y.ALWAYS,"always"),(0,N.Z)(qf,Y.LESS,"less"),(0,N.Z)(qf,Y.LEQUAL,"lequal"),(0,N.Z)(qf,Y.GREATER,"greater"),(0,N.Z)(qf,Y.GEQUAL,"gequal"),(0,N.Z)(qf,Y.EQUAL,"equal"),(0,N.Z)(qf,Y.NOTEQUAL,"notequal"),qf),Ev=(Kf={},(0,N.Z)(Kf,Y.ZERO,"zero"),(0,N.Z)(Kf,Y.KEEP,"keep"),(0,N.Z)(Kf,Y.REPLACE,"replace"),(0,N.Z)(Kf,Y.INVERT,"invert"),(0,N.Z)(Kf,Y.INCR,"increment"),(0,N.Z)(Kf,Y.DECR,"decrement"),(0,N.Z)(Kf,Y.INCR_WRAP,"increment wrap"),(0,N.Z)(Kf,Y.DECR_WRAP,"decrement wrap"),Kf),fk=(cg={},(0,N.Z)(cg,Y.FRONT,"front"),(0,N.Z)(cg,Y.BACK,"back"),cg),hk=function(){function e(r,t){(0,ge.Z)(this,e),(0,N.Z)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type;this.buffer=r.buffer({data:n,usage:b2[i||Y.STATIC_DRAW],type:F_[a||Y.UNSIGNED_BYTE]})}return(0,K.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset;this.buffer.subdata(n,i)}}]),e}(),pk=function(){function e(r,t){(0,ge.Z)(this,e);var n=t.data,i=t.usage,a=t.type,s=t.count;this.elements=r.elements({data:n,usage:b2[i||Y.STATIC_DRAW],type:F_[a||Y.UNSIGNED_BYTE],count:s})}return(0,K.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),dk=function(){function e(r,t){(0,ge.Z)(this,e);var n=t.width,i=t.height,a=t.color,s=t.colors,l={width:n,height:i};Array.isArray(s)&&(l.colors=s.map(function(c){return c.get()})),a&&typeof a!="boolean"&&(l.color=a.get()),this.framebuffer=r.framebuffer(l)}return(0,K.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.framebuffer.resize(n,i)}}]),e}(),vk={}.toString,mk=function(e,r){return vk.call(e)==="[object "+r+"]"},gk=mk,_k=function(e){return gk(e,"Number")},Sv=_k,yk=function(e){return e==null},kp=yk,xk=function(e,r,t){return e<r?r:e>t?t:e},bk=xk,Mn=Z(65353),Ek=Z(90857),T2=Ek,$e;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})($e||($e={}));var ma;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool"})(ma||(ma={}));var Bi;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(Bi||(Bi={}));var Vm;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(Vm||(Vm={}));var Zl;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(Zl||(Zl={}));var Xi;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(Xi||(Xi={}));var ru;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(ru||(ru={}));var bl;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(bl||(bl={}));var Xo;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(Xo||(Xo={}));var js;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(js||(js={}));var _s;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(_s||(_s={}));var Ja;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(Ja||(Ja={}));var vf;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})(vf||(vf={}));var wd;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(wd||(wd={}));var w2;(function(e){e.LOADED="loaded"})(w2||(w2={}));var Vi;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(Vi||(Vi={}));var Ou;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"})(Ou||(Ou={}));var nu;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(nu||(nu={}));var Uo;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(Uo||(Uo={}));function E6(e,r,t,n){var i=Vi.TEXTURE_2D,a=1,s=Ou.SAMPLED;return{dimension:i,format:e,width:r,height:t,depthOrArrayLayers:a,mipLevelCount:n,usage:s}}var zo;(function(e){e[e.Float=0]="Float",e[e.Uint=1]="Uint",e[e.Sint=2]="Sint",e[e.Depth=3]="Depth"})(zo||(zo={}));var Av;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(Av||(Av={}));var Tv;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(Tv||(Tv={}));var hg;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(hg||(hg={}));var Rr;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(Rr||(Rr={}));var Gn;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(Gn||(Gn={}));function C2(e){return e}var Cn;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"})(Cn||(Cn={}));function ci(e,r,t){return e<<16|r<<8|t}var Pt;(function(e){e[e.ALPHA=ci(Rr.U8,Gn.A,Cn.None)]="ALPHA",e[e.U8_LUMINANCE=ci(Rr.U8,Gn.A,Cn.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=ci(Rr.F16,Gn.A,Cn.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=ci(Rr.F32,Gn.A,Cn.Luminance)]="F32_LUMINANCE",e[e.F16_R=ci(Rr.F16,Gn.R,Cn.None)]="F16_R",e[e.F16_RG=ci(Rr.F16,Gn.RG,Cn.None)]="F16_RG",e[e.F16_RGB=ci(Rr.F16,Gn.RGB,Cn.None)]="F16_RGB",e[e.F16_RGBA=ci(Rr.F16,Gn.RGBA,Cn.None)]="F16_RGBA",e[e.F32_R=ci(Rr.F32,Gn.R,Cn.None)]="F32_R",e[e.F32_RG=ci(Rr.F32,Gn.RG,Cn.None)]="F32_RG",e[e.F32_RGB=ci(Rr.F32,Gn.RGB,Cn.None)]="F32_RGB",e[e.F32_RGBA=ci(Rr.F32,Gn.RGBA,Cn.None)]="F32_RGBA",e[e.U8_R=ci(Rr.U8,Gn.R,Cn.None)]="U8_R",e[e.U8_R_NORM=ci(Rr.U8,Gn.R,Cn.Normalized)]="U8_R_NORM",e[e.U8_RG=ci(Rr.U8,Gn.RG,Cn.None)]="U8_RG",e[e.U8_RG_NORM=ci(Rr.U8,Gn.RG,Cn.Normalized)]="U8_RG_NORM",e[e.U8_RGB=ci(Rr.U8,Gn.RGB,Cn.None)]="U8_RGB",e[e.U8_RGB_NORM=ci(Rr.U8,Gn.RGB,Cn.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=ci(Rr.U8,Gn.RGB,Cn.sRGB|Cn.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=ci(Rr.U8,Gn.RGBA,Cn.None)]="U8_RGBA",e[e.U8_RGBA_NORM=ci(Rr.U8,Gn.RGBA,Cn.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=ci(Rr.U8,Gn.RGBA,Cn.sRGB|Cn.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=ci(Rr.U16,Gn.R,Cn.None)]="U16_R",e[e.U16_R_NORM=ci(Rr.U16,Gn.R,Cn.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=ci(Rr.U16,Gn.RG,Cn.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=ci(Rr.U16,Gn.RGBA,Cn.Normalized)]="U16_RGBA_NORM",e[e.U16_RGB=ci(Rr.U16,Gn.RGB,Cn.None)]="U16_RGB",e[e.U32_R=ci(Rr.U32,Gn.R,Cn.None)]="U32_R",e[e.U32_RG=ci(Rr.U32,Gn.RG,Cn.None)]="U32_RG",e[e.S8_R=ci(Rr.S8,Gn.R,Cn.None)]="S8_R",e[e.S8_R_NORM=ci(Rr.S8,Gn.R,Cn.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=ci(Rr.S8,Gn.RG,Cn.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=ci(Rr.S8,Gn.RGB,Cn.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=ci(Rr.S8,Gn.RGBA,Cn.Normalized)]="S8_RGBA_NORM",e[e.S16_R=ci(Rr.S16,Gn.R,Cn.None)]="S16_R",e[e.S16_RG=ci(Rr.S16,Gn.RG,Cn.None)]="S16_RG",e[e.S16_RG_NORM=ci(Rr.S16,Gn.RG,Cn.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=ci(Rr.S16,Gn.RGB,Cn.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=ci(Rr.S16,Gn.RGBA,Cn.None)]="S16_RGBA",e[e.S16_RGBA_NORM=ci(Rr.S16,Gn.RGBA,Cn.Normalized)]="S16_RGBA_NORM",e[e.S32_R=ci(Rr.S32,Gn.R,Cn.None)]="S32_R",e[e.U16_RGBA_5551=ci(Rr.U16_PACKED_5551,Gn.RGBA,Cn.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=ci(Rr.U16_PACKED_565,Gn.RGB,Cn.Normalized)]="U16_RGB_565",e[e.BC1=ci(Rr.BC1,Gn.RGBA,Cn.Normalized)]="BC1",e[e.BC1_SRGB=ci(Rr.BC1,Gn.RGBA,Cn.Normalized|Cn.sRGB)]="BC1_SRGB",e[e.BC2=ci(Rr.BC2,Gn.RGBA,Cn.Normalized)]="BC2",e[e.BC2_SRGB=ci(Rr.BC2,Gn.RGBA,Cn.Normalized|Cn.sRGB)]="BC2_SRGB",e[e.BC3=ci(Rr.BC3,Gn.RGBA,Cn.Normalized)]="BC3",e[e.BC3_SRGB=ci(Rr.BC3,Gn.RGBA,Cn.Normalized|Cn.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=ci(Rr.BC4_UNORM,Gn.R,Cn.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=ci(Rr.BC4_SNORM,Gn.R,Cn.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=ci(Rr.BC5_UNORM,Gn.RG,Cn.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=ci(Rr.BC5_SNORM,Gn.RG,Cn.Normalized)]="BC5_SNORM",e[e.D24=ci(Rr.D24,Gn.R,Cn.Depth)]="D24",e[e.D24_S8=ci(Rr.D24S8,Gn.RG,Cn.Depth|Cn.Stencil)]="D24_S8",e[e.D32F=ci(Rr.D32F,Gn.R,Cn.Depth)]="D32F",e[e.D32F_S8=ci(Rr.D32FS8,Gn.RG,Cn.Depth|Cn.Stencil)]="D32F_S8",e[e.U8_RGB_RT=ci(Rr.U8,Gn.RGB,Cn.RenderTarget|Cn.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=ci(Rr.U8,Gn.RGBA,Cn.RenderTarget|Cn.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=ci(Rr.U8,Gn.RGBA,Cn.RenderTarget|Cn.Normalized|Cn.sRGB)]="U8_RGBA_RT_SRGB"})(Pt||(Pt={}));function pg(e){return e>>>8&255}function Qf(e){return e>>>16&255}function wv(e){return e&255}function R2(e){switch(e){case Rr.F32:case Rr.U32:case Rr.S32:return 4;case Rr.U16:case Rr.S16:case Rr.F16:return 2;case Rr.U8:case Rr.S8:return 1;default:throw new Error("whoops")}}function M2(e){return R2(Qf(e))}function S6(e){return C2(pg(e))}function Sk(e){var r=R2(Qf(e)),t=C2(pg(e));return r*t}function A6(e,r){return e&4294967040|r}function T6(e,r){return e&4294902015|r<<8}function I2(e){var r=wv(e);if(r&Cn.Depth)return zo.Depth;if(r&Cn.Normalized)return zo.Float;var t=Qf(e);if(t===Rr.F16||t===Rr.F32)return zo.Float;if(t===Rr.U8||t===Rr.U16||t===Rr.U32)return zo.Uint;if(t===Rr.S8||t===Rr.S16||t===Rr.S32)return zo.Sint;throw new Error("whoops")}function ki(e,r){if(r===void 0&&(r=""),!e)throw new Error("Assert fail: ".concat(r))}function Cd(e){if(e!=null)return e;throw new Error("Missing object")}function P2(e,r){return e.r===r.r&&e.g===r.g&&e.b===r.b&&e.a===r.a}function O2(e,r){e.r=r.r,e.g=r.g,e.b=r.b,e.a=r.a}function k2(e){var r=e.r,t=e.g,n=e.b,i=e.a;return{r,g:t,b:n,a:i}}function jm(e,r,t,n){return n===void 0&&(n=1),{r:e,g:r,b:t,a:n}}var N_=jm(0,0,0,0),w6=jm(0,0,0,1),Ak=jm(1,1,1,0),C6=jm(1,1,1,1),Cv=!0;function R6(e,r){r===void 0&&(r=Cv),r&&(e[10]=-e[10],e[14]=-e[14])}function M6(e,r){r===void 0&&(r=Cv),r&&(e[10]=-e[10],e[14]=-e[14]+1)}function Tk(e,r){if(r===void 0&&(r=Cv),r)switch(e){case Bi.LESS:return Bi.GREATER;case Bi.LEQUAL:return Bi.GEQUAL;case Bi.GEQUAL:return Bi.LEQUAL;case Bi.GREATER:return Bi.LESS;default:return e}else return e}function I6(e,r){return r===void 0&&(r=Cv),r?1-e:e}function P6(e,r){return r===void 0&&(r=Cv),r?-e:e}function O6(e,r,t,n){if(n===void 0&&(n=Cv),t=Tk(t,n),t===Bi.LESS)return e<r;if(t===Bi.LEQUAL)return e<=r;if(t===Bi.GREATER)return e>r;if(t===Bi.GEQUAL)return e>=r;throw new Error("whoops")}function dg(e){return!!(e&&(e&e-1)==0)}function Rv(e,r){return e!=null?e:r}function wk(e){return e===void 0?null:e}function k6(e,r,t){e.length=r,e.fill(t)}function vg(e,r){var t=r-1;return e+t&~t}function D6(e,r){return((e+r-1)/r|0)*r}function Ck(e,r,t){for(var n=0,i=e.length;n<i;){var a=n+(i-n>>>1),s=t(r,e[a]);s<0?i=a:n=a+1}return n}function L6(e,r,t){var n=Ck(e,r,t);e.splice(n,0,r)}function B6(e,r,t){return t?e|=r:e&=~r,e}function Rk(e,r){for(var t=new Array(e),n=0;n<e;n++)t[n]=r();return t}function Mk(e,r){r===void 0&&(r=1);var t=e.split(`
`);return t.map(function(n,i){return"".concat(Ik(""+(r+i),4," "),"  ").concat(n)}).join(`
`)}function Ik(e,r,t){for(t===void 0&&(t="0");e.length<r;)e="".concat(t).concat(e);return e}function F6(e,r){for(var t=[],n=e;n<e+r;n++)t.push(n);return t}function D2(e,r){e.blendDstFactor=r.blendDstFactor,e.blendSrcFactor=r.blendSrcFactor,e.blendMode=r.blendMode}function mg(e,r){return e===void 0&&(e={}),e.compare=r.compare,e.depthFailOp=r.depthFailOp,e.passOp=r.passOp,e.failOp=r.failOp,e}function L2(e,r){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),D2(e.rgbBlendState,r.rgbBlendState),D2(e.alphaBlendState,r.alphaBlendState),e.channelWriteMask=r.channelWriteMask,e}function U_(e,r){e.length!==r.length&&(e.length=r.length);for(var t=0;t<r.length;t++)e[t]=L2(e[t],r[t])}function Pk(e,r){r.attachmentsState!==void 0&&U_(e.attachmentsState,r.attachmentsState),e.blendConstant&&r.blendConstant&&O2(e.blendConstant,r.blendConstant),e.depthCompare=Rv(r.depthCompare,e.depthCompare),e.depthWrite=Rv(r.depthWrite,e.depthWrite),e.stencilWrite=Rv(r.stencilWrite,e.stencilWrite),e.stencilFront&&r.stencilFront&&mg(e.stencilFront,r.stencilFront),e.stencilBack&&r.stencilBack&&mg(e.stencilBack,r.stencilBack),e.cullMode=Rv(r.cullMode,e.cullMode),e.frontFace=Rv(r.frontFace,e.frontFace),e.polygonOffset=Rv(r.polygonOffset,e.polygonOffset)}function Mv(e){var r=Object.assign({},e);return r.attachmentsState=[],U_(r.attachmentsState,e.attachmentsState),r.blendConstant=r.blendConstant&&k2(r.blendConstant),r.stencilFront=mg(void 0,e.stencilFront),r.stencilBack=mg(void 0,e.stencilBack),r}function Ok(e,r){r.channelWriteMask!==void 0&&(e.channelWriteMask=r.channelWriteMask),r.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=r.rgbBlendMode),r.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=r.alphaBlendMode),r.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=r.rgbBlendSrcFactor),r.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=r.alphaBlendSrcFactor),r.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=r.rgbBlendDstFactor),r.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=r.alphaBlendDstFactor)}var B2={blendMode:ru.ADD,blendSrcFactor:Xi.ONE,blendDstFactor:Xi.ZERO},Rd={attachmentsState:[{channelWriteMask:nu.ALL,rgbBlendState:B2,alphaBlendState:B2}],blendConstant:k2(N_),depthWrite:!0,depthCompare:Bi.LEQUAL,stencilWrite:!1,stencilFront:{compare:Bi.ALWAYS,passOp:Uo.KEEP,depthFailOp:Uo.KEEP,failOp:Uo.KEEP},stencilBack:{compare:Bi.ALWAYS,passOp:Uo.KEEP,depthFailOp:Uo.KEEP,failOp:Uo.KEEP},cullMode:Zl.NONE,frontFace:Vm.CCW,polygonOffset:!1};function kk(e,r){e===void 0&&(e=null),r===void 0&&(r=Rd);var t=Mv(r);return e!==null&&Pk(t,e),t}var N6=kk({depthCompare:Bi.ALWAYS,depthWrite:!1},Rd);function U6(e,r){return e.attachmentsState===void 0&&(e.attachmentsState=[],U_(e.attachmentsState,Rd.attachmentsState)),Ok(e.attachmentsState[0],r),e}var F2={texture:null,sampler:null,formatKind:zo.Float,dimension:Vi.TEXTURE_2D};function Iv(e,r,t){if(e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}function Pv(e,r){for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=r(e[n]);return t}function Dk(e,r){return e.buffer===r.buffer&&e.size===r.size&&e.binding===r.binding&&e.offset===r.offset}function Lk(e,r){return e===null?r===null:r===null?!1:e.sampler===r.sampler&&e.texture===r.texture&&e.dimension===r.dimension&&e.formatKind===r.formatKind&&e.comparison===r.comparison}function z6(e,r){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],r.samplerBindings=r.samplerBindings||[],r.uniformBufferBindings=r.uniformBufferBindings||[],!(e.samplerBindings.length!==r.samplerBindings.length||!Iv(e.samplerBindings,r.samplerBindings,Lk)||!Iv(e.uniformBufferBindings,r.uniformBufferBindings,Dk))}function N2(e,r){return e.blendMode==r.blendMode&&e.blendSrcFactor===r.blendSrcFactor&&e.blendDstFactor===r.blendDstFactor}function Bk(e,r){return!(!N2(e.rgbBlendState,r.rgbBlendState)||!N2(e.alphaBlendState,r.alphaBlendState)||e.channelWriteMask!==r.channelWriteMask)}function gg(e,r){return e.compare==r.compare&&e.depthFailOp===r.depthFailOp&&e.failOp===r.failOp&&e.passOp===r.passOp}function Fk(e,r){return!Iv(e.attachmentsState,r.attachmentsState,Bk)||e.blendConstant&&r.blendConstant&&!P2(e.blendConstant,r.blendConstant)||e.stencilFront&&r.stencilFront&&!gg(e.stencilFront,r.stencilFront)||e.stencilBack&&r.stencilBack&&!gg(e.stencilBack,r.stencilBack)?!1:e.depthCompare===r.depthCompare&&e.depthWrite===r.depthWrite&&e.stencilWrite===r.stencilWrite&&e.cullMode===r.cullMode&&e.frontFace===r.frontFace&&e.polygonOffset===r.polygonOffset}function U2(e,r){return e.id===r.id}function Nk(e,r){return e===r}function Z6(e,r){return!(e.topology!==r.topology||e.inputLayout!==r.inputLayout||e.sampleCount!==r.sampleCount||e.megaStateDescriptor&&r.megaStateDescriptor&&!Fk(e.megaStateDescriptor,r.megaStateDescriptor)||!U2(e.program,r.program)||!Iv(e.colorAttachmentFormats,r.colorAttachmentFormats,Nk)||e.depthStencilAttachmentFormat!==r.depthStencilAttachmentFormat)}function Uk(e,r){return e.offset===r.offset&&e.shaderLocation===r.shaderLocation&&e.format===r.format&&e.divisor===r.divisor}function zk(e,r){return isNil(e)?isNil(r):isNil(r)?!1:e.arrayStride===r.arrayStride&&e.stepMode===r.stepMode&&Iv(e.attributes,r.attributes,Uk)}function V6(e,r){return!(e.indexBufferFormat!==r.indexBufferFormat||!Iv(e.vertexBufferDescriptors,r.vertexBufferDescriptors,zk)||!U2(e.program,r.program))}function j6(e,r){return e.addressModeU===r.addressModeU&&e.addressModeV===r.addressModeV&&e.minFilter===r.minFilter&&e.magFilter===r.magFilter&&e.mipmapFilter===r.mipmapFilter&&e.lodMinClamp===r.lodMinClamp&&e.lodMaxClamp===r.lodMaxClamp&&e.maxAnisotropy===r.maxAnisotropy&&e.compareFunction===r.compareFunction}function Zk(e){var r=e.sampler,t=e.texture,n=e.dimension,i=e.formatKind,a=e.comparison;return{sampler:r,texture:t,dimension:n,formatKind:i,comparison:a}}function z2(e){var r=e.buffer,t=e.size,n=e.binding,i=e.offset;return{binding:n,buffer:r,offset:i,size:t}}function Vk(e){var r=e.binding,t=e.texture;return{binding:r,texture:t}}function H6(e){var r=e.samplerBindings&&Pv(e.samplerBindings,Zk),t=e.uniformBufferBindings&&Pv(e.uniformBufferBindings,z2),n=e.storageBufferBindings&&Pv(e.storageBufferBindings,z2),i=e.storageTextureBindings&&Pv(e.storageTextureBindings,Vk);return{samplerBindings:r,uniformBufferBindings:t,storageBufferBindings:n,storageTextureBindings:i,pipeline:e.pipeline}}function W6(e){var r=e.inputLayout,t=e.program,n=e.topology,i=e.megaStateDescriptor&&Mv(e.megaStateDescriptor),a=e.colorAttachmentFormats.slice(),s=e.depthStencilAttachmentFormat,l=e.sampleCount;return{inputLayout:r,megaStateDescriptor:i,program:t,topology:n,colorAttachmentFormats:a,depthStencilAttachmentFormat:s,sampleCount:l}}function jk(e){var r=e.shaderLocation,t=e.format,n=e.offset,i=e.divisor;return{shaderLocation:r,format:t,offset:n,divisor:i}}function Hk(e){if(isNil(e))return e;var r=e.arrayStride,t=e.stepMode,n=Pv(e.attributes,jk);return{arrayStride:r,stepMode:t,attributes:n}}function G6(e){var r=Pv(e.vertexBufferDescriptors,Hk),t=e.indexBufferFormat,n=e.program;return{vertexBufferDescriptors:r,indexBufferFormat:t,program:n}}var qi,Wk=/([^[]*)(\[[0-9]+\])?/;function Gk(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var r=e.match(Wk);if(!r||r.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:r[1],length:Number(r[2])||1,isArray:Boolean(r[2])}}function El(){var e=null;return function(r,t,n){var i=e!==n;return i&&(r.uniform1i(t,n),e=n),i}}function Zo(e,r,t,n){var i=null,a=null;return function(s,l,c){var p=r(c,t),_=p.length,b=!1;if(i===null)i=new Float32Array(_),a=_,b=!0;else{ki(a===_,"Uniform length cannot change.");for(var A=0;A<_;++A)if(p[A]!==i[A]){b=!0;break}}return b&&(n(s,e,l,p),i.set(p)),b}}function Qu(e,r,t,n){e[r](t,n)}function Uh(e,r,t,n){e[r](t,!1,n)}var Xk={},$k={},Yk={},Z2=[0];function z_(e,r,t,n){r===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(Z2[0]=e,e=Z2);var i=e.length;if(e instanceof t)return e;var a=n[i];a||(a=new t(i),n[i]=a);for(var s=0;s<i;s++)a[s]=e[s];return a}function pc(e,r){return z_(e,r,Float32Array,Xk)}function Dp(e,r){return z_(e,r,Int32Array,$k)}function _g(e,r){return z_(e,r,Uint32Array,Yk)}var qk=(qi={},qi[$e.FLOAT]=Zo.bind(null,"uniform1fv",pc,1,Qu),qi[$e.FLOAT_VEC2]=Zo.bind(null,"uniform2fv",pc,2,Qu),qi[$e.FLOAT_VEC3]=Zo.bind(null,"uniform3fv",pc,3,Qu),qi[$e.FLOAT_VEC4]=Zo.bind(null,"uniform4fv",pc,4,Qu),qi[$e.INT]=Zo.bind(null,"uniform1iv",Dp,1,Qu),qi[$e.INT_VEC2]=Zo.bind(null,"uniform2iv",Dp,2,Qu),qi[$e.INT_VEC3]=Zo.bind(null,"uniform3iv",Dp,3,Qu),qi[$e.INT_VEC4]=Zo.bind(null,"uniform4iv",Dp,4,Qu),qi[$e.BOOL]=Zo.bind(null,"uniform1iv",Dp,1,Qu),qi[$e.BOOL_VEC2]=Zo.bind(null,"uniform2iv",Dp,2,Qu),qi[$e.BOOL_VEC3]=Zo.bind(null,"uniform3iv",Dp,3,Qu),qi[$e.BOOL_VEC4]=Zo.bind(null,"uniform4iv",Dp,4,Qu),qi[$e.FLOAT_MAT2]=Zo.bind(null,"uniformMatrix2fv",pc,4,Uh),qi[$e.FLOAT_MAT3]=Zo.bind(null,"uniformMatrix3fv",pc,9,Uh),qi[$e.FLOAT_MAT4]=Zo.bind(null,"uniformMatrix4fv",pc,16,Uh),qi[$e.UNSIGNED_INT]=Zo.bind(null,"uniform1uiv",_g,1,Qu),qi[$e.UNSIGNED_INT_VEC2]=Zo.bind(null,"uniform2uiv",_g,2,Qu),qi[$e.UNSIGNED_INT_VEC3]=Zo.bind(null,"uniform3uiv",_g,3,Qu),qi[$e.UNSIGNED_INT_VEC4]=Zo.bind(null,"uniform4uiv",_g,4,Qu),qi[$e.FLOAT_MAT2x3]=Zo.bind(null,"uniformMatrix2x3fv",pc,6,Uh),qi[$e.FLOAT_MAT2x4]=Zo.bind(null,"uniformMatrix2x4fv",pc,8,Uh),qi[$e.FLOAT_MAT3x2]=Zo.bind(null,"uniformMatrix3x2fv",pc,6,Uh),qi[$e.FLOAT_MAT3x4]=Zo.bind(null,"uniformMatrix3x4fv",pc,12,Uh),qi[$e.FLOAT_MAT4x2]=Zo.bind(null,"uniformMatrix4x2fv",pc,8,Uh),qi[$e.FLOAT_MAT4x3]=Zo.bind(null,"uniformMatrix4x3fv",pc,12,Uh),qi[$e.SAMPLER_2D]=El,qi[$e.SAMPLER_CUBE]=El,qi[$e.SAMPLER_3D]=El,qi[$e.SAMPLER_2D_SHADOW]=El,qi[$e.SAMPLER_2D_ARRAY]=El,qi[$e.SAMPLER_2D_ARRAY_SHADOW]=El,qi[$e.SAMPLER_CUBE_SHADOW]=El,qi[$e.INT_SAMPLER_2D]=El,qi[$e.INT_SAMPLER_3D]=El,qi[$e.INT_SAMPLER_CUBE]=El,qi[$e.INT_SAMPLER_2D_ARRAY]=El,qi[$e.UNSIGNED_INT_SAMPLER_2D]=El,qi[$e.UNSIGNED_INT_SAMPLER_3D]=El,qi[$e.UNSIGNED_INT_SAMPLER_CUBE]=El,qi[$e.UNSIGNED_INT_SAMPLER_2D_ARRAY]=El,qi);function V2(e,r,t){var n=qk[t.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(t.type));return n().bind(null,e,r)}var Kk={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function Qk(e){return Object.prototype.toString.call(e)in Kk}function Hm(e,r){return"#define ".concat(e," ").concat(r)}function Jk(e){var r={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(t,n,i){var a=Number(i);return r[n]=isNaN(a)?i:a,""}),r}function eD(e,r){var t=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(n,i,a){var s=Number(i);return t.push({location:isNaN(s)?r[i]:s,name:a}),""}),t}function X6(e){var r=[],t=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(n,i,a){var s=[];return a.trim().replace(`\r
`,`
`).split(`
`).forEach(function(l){var c=__read(l.trim().split(/\s+/),2),p=c[0],_=c[1];s.push({type:p.trim(),name:_.replace(";","").trim()})}),t.push({type:i.trim(),uniforms:s}),""}),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,function(n,i){return i.trim().replace(`\r
`,`
`).split(`
`).forEach(function(a){var s=a.trim().split(" "),l=s[0]||"",c=s[1]||"",p=c.indexOf("[")>-1;if(c=c.replace(";","").replace("[","").trim(),!l.startsWith("#")){if(l){var _=t.find(function(w){return l===w.type});if(_)if(p)for(var b=function(w){_.uniforms.forEach(function(I){r.push("".concat(c,"[").concat(w,"].").concat(I.name))})},A=0;A<5;A++)b(A);else _.uniforms.forEach(function(w){r.push("".concat(c,".").concat(w.name))})}c&&r.push(c)}}),""}),r}function j2(e){if(e===void 0)return null;var r=/binding\s*=\s*(\d+)/.exec(e);if(r!==null){var t=parseInt(r[1],10);if(!Number.isNaN(t))return t}return null}function tD(e){var r="",t=e;return[t,r]}function Lp(e,r,t,n,i){var a;n===void 0&&(n=null),i===void 0&&(i=!0);var s=e.glslVersion==="#version 100",l=r==="frag"&&((a=t.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||a===void 0?void 0:a.length)>1,c=t.replace(`\r
`,`
`).split(`
`).map(function(Ze){return Ze.replace(/[/][/].*$/,"")}).filter(function(Ze){var tt=!Ze||/^\s+$/.test(Ze);return!tt}),p="";n!==null&&(p=Object.keys(n).map(function(Ze){return Hm(Ze,n[Ze])}).join(`
`));var _=c.find(function(Ze){return Ze.startsWith("precision")})||"precision mediump float;",b=i?c.filter(function(Ze){return!Ze.startsWith("precision")}).join(`
`):c.join(`
`),A="";if(e.viewportOrigin===Av.UPPER_LEFT&&(A+="".concat(Hm("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===Tv.ZERO&&(A+="".concat(Hm("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var w=0,I=0,P=0;b=b.replace(/^(layout\((.*)\))?\s*uniform(.+{)$/gm,function(Ze,tt,ft,wt){var fr=ft?"".concat(ft,", "):"";return"layout(".concat(fr,"set = ").concat(w,", binding = ").concat(I++,") uniform ").concat(wt)}),w++,I=0,ki(e.separateSamplerTextures),b=b.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(Ze,tt,ft,wt,fr){var hr=j2(ft);hr===null&&(hr=I++);var Mr=(0,Mn.__read)(tD(wt),2),ln=Mr[0],Rn=Mr[1];return r==="frag"?`
layout(set = `.concat(w,", binding = ").concat(hr*2+0,") uniform texture").concat(ln," T_").concat(fr,`;
layout(set = `).concat(w,", binding = ").concat(hr*2+1,") uniform sampler").concat(Rn," S_").concat(fr,";").trim():""}),b=b.replace(r==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(Ze,tt){return"layout(location = ".concat(P++,") ").concat(tt)}),A+="".concat(Hm("gl_VertexID","gl_VertexIndex"),`
`),A+="".concat(Hm("gl_InstanceID","gl_InstanceIndex"),`
`),_=_.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var B=0;b=b.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(Ze,tt,ft,wt,fr){var hr=j2(ft);return hr===null&&(hr=B++),"uniform sampler".concat(wt," ").concat(fr,"; // BINDING=").concat(hr)})}if(e.separateSamplerTextures)b=b.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(Ze,tt,ft){return"sampler".concat(tt,"(T_").concat(ft,", S_").concat(ft,")")}),b=b.replace(/\bTEXTURE\((.*?)\)/g,function(Ze,tt){return"T_".concat(tt)});else{var H=[];b=b.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(Ze,tt,ft){return H.push([ft,tt]),ft}),s&&H.forEach(function(Ze){var tt=(0,Mn.__read)(Ze,2),ft=tt[0],wt=tt[1];b=b.replace(new RegExp("texture\\(".concat(ft),"g"),function(){return"texture".concat(wt,"(").concat(ft)})}),b=b.replace(/\bTEXTURE\((.*?)\)/g,function(Ze,tt){return tt})}var Q="".concat(s?"":e.glslVersion,`
`).concat(s&&l?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(s&&r==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(i?_:"",`
`).concat(A||"").concat(p?p+`
`:"",`
`).concat(b,`
`).trim();if(e.explicitBindingLocations&&r==="frag"&&(Q=Q.replace(/^\b(out)\b/g,function(Ze,tt){return"layout(location = 0) ".concat(tt)})),s){if(r==="frag"&&(Q=Q.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(Ze,tt,ft){return"varying ".concat(tt," ").concat(ft,`;
`)})),r==="vert"&&(Q=Q.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(Ze,tt,ft){return"varying ".concat(tt," ").concat(ft,`;
`)}),Q=Q.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(Ze,tt,ft){return"attribute ".concat(tt," ").concat(ft,`;
`)})),Q=Q.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(Ze,tt){return tt.trim().replace(/^.*$/gm,function(ft){var wt=ft.trim();return wt.startsWith("#")?wt:ft?"uniform ".concat(wt):""})}),r==="frag")if(l){var ue=[];Q=Q.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(Ze,tt){return ue.push(tt),"vec4 ".concat(tt,`;
`)});var Ee=Q.lastIndexOf("}");Q=Q.substring(0,Ee)+`
    `.concat(ue.map(function(Ze,tt){return"gl_FragData[".concat(tt,"] = ").concat(Ze,`;
    `)}).join(`
`))+Q.substring(Ee)}else{var Le;if(Q=Q.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(Ze,tt,ft){return Le=ft,"".concat(tt," ").concat(ft,`;
`)}),Le){var Ee=Q.lastIndexOf("}");Q=Q.substring(0,Ee)+`
  gl_FragColor = vec4(`.concat(Le,`);
`)+Q.substring(Ee)}}Q=Q.replace(/^\s*layout\((.*)\)/gm,"")}return Q}function $6(e,r,t,n){n===void 0&&(n=null);var i=Lp(e,"vert",r,n),a=Lp(e,"frag",t,n);return{vert:r,frag:t,preprocessedVert:i,preprocessedFrag:a}}var mf=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a.device.resourceCreationTracker!==null&&a.device.resourceCreationTracker.trackResourceCreated(a),a}return r.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},r}(T2),rD=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ma.Bindings;var l=a.uniformBufferBindings,c=a.samplerBindings;return s.uniformBufferBindings=l||[],s.samplerBindings=c||[],s.bindingLayouts=s.createBindingLayouts(),s}return r.prototype.createBindingLayouts=function(){var t=0,n=0,i=[],a=this.uniformBufferBindings.length,s=this.samplerBindings.length;return i.push({firstUniformBuffer:t,numUniformBuffers:a,firstSampler:n,numSamplers:s}),t+=a,n+=s,{numUniformBuffers:t,numSamplers:n,bindingLayoutTables:i}},r}(mf);function Vn(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}function H2(e){var r=Qf(e);switch(r){case Rr.BC1:case Rr.BC2:case Rr.BC3:case Rr.BC4_UNORM:case Rr.BC4_SNORM:case Rr.BC5_UNORM:case Rr.BC5_SNORM:return!0;default:return!1}}function W2(e){var r=wv(e);if(r&Cn.Normalized)return!1;var t=Qf(e);return t===Rr.S8||t===Rr.S16||t===Rr.S32||t===Rr.U8||t===Rr.U16||t===Rr.U32}function nD(e){switch(e){case vf.STATIC:return $e.STATIC_DRAW;case vf.DYNAMIC:return $e.DYNAMIC_DRAW}}function G2(e){if(e&Ja.INDEX)return $e.ELEMENT_ARRAY_BUFFER;if(e&Ja.VERTEX)return $e.ARRAY_BUFFER;if(e&Ja.UNIFORM)return $e.UNIFORM_BUFFER}function iD(e){switch(e){case _s.TRIANGLES:return $e.TRIANGLES;case _s.POINTS:return $e.POINTS;case _s.TRIANGLE_STRIP:return $e.TRIANGLE_STRIP;case _s.LINES:return $e.LINES;case _s.LINE_STRIP:return $e.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function aD(e){switch(e){case Rr.U8:return $e.UNSIGNED_BYTE;case Rr.U16:return $e.UNSIGNED_SHORT;case Rr.U32:return $e.UNSIGNED_INT;case Rr.S8:return $e.BYTE;case Rr.S16:return $e.SHORT;case Rr.S32:return $e.INT;case Rr.F16:return $e.HALF_FLOAT;case Rr.F32:return $e.FLOAT;default:throw new Error("whoops")}}function oD(e){switch(e){case Gn.R:return 1;case Gn.RG:return 2;case Gn.RGB:return 3;case Gn.RGBA:return 4;default:return 1}}function sD(e){var r=Qf(e),t=pg(e),n=wv(e),i=aD(r),a=oD(t),s=!!(n&Cn.Normalized);return{size:a,type:i,normalized:s}}function uD(e){switch(e){case Pt.U8_R:return $e.UNSIGNED_BYTE;case Pt.U16_R:return $e.UNSIGNED_SHORT;case Pt.U32_R:return $e.UNSIGNED_INT;default:throw new Error("whoops")}}function Wm(e){switch(e){case bl.CLAMP_TO_EDGE:return $e.CLAMP_TO_EDGE;case bl.REPEAT:return $e.REPEAT;case bl.MIRRORED_REPEAT:return $e.MIRRORED_REPEAT;default:throw new Error("whoops")}}function yg(e,r){if(r===js.LINEAR&&e===Xo.BILINEAR)return $e.LINEAR_MIPMAP_LINEAR;if(r===js.LINEAR&&e===Xo.POINT)return $e.NEAREST_MIPMAP_LINEAR;if(r===js.NEAREST&&e===Xo.BILINEAR)return $e.LINEAR_MIPMAP_NEAREST;if(r===js.NEAREST&&e===Xo.POINT)return $e.NEAREST_MIPMAP_NEAREST;if(r===js.NO_MIP&&e===Xo.BILINEAR)return $e.LINEAR;if(r===js.NO_MIP&&e===Xo.POINT)return $e.NEAREST;throw new Error("Unknown texture filter mode")}function Ov(e,r){r===void 0&&(r=0);var t=e;return t.gl_buffer_pages[r/t.pageByteSize|0]}function kv(e){var r=e;return r.gl_texture}function Z_(e){var r=e;return r.gl_sampler}function Gm(e,r){e.name=r,e.__SPECTOR_Metadata={name:r}}function X2(e,r){for(var t=[];;){var n=r.exec(e);if(!n)break;t.push(n)}return t}function Bp(e){return e.blendMode==ru.ADD&&e.blendSrcFactor==Xi.ONE&&e.blendDstFactor===Xi.ZERO}function lD(e){switch(e){case hg.OcclusionConservative:return $e.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function cD(e){if(e===Vi.TEXTURE_2D)return $e.TEXTURE_2D;if(e===Vi.TEXTURE_2D_ARRAY)return $e.TEXTURE_2D_ARRAY;if(e===Vi.TEXTURE_CUBE_MAP)return $e.TEXTURE_CUBE_MAP;if(e===Vi.TEXTURE_3D)return $e.TEXTURE_3D;throw new Error("whoops")}function V_(e,r,t,n){return!(e%t!=0||r%n!=0)}var fD=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ma.Buffer;var l=a.viewOrSize,c=a.usage,p=a.hint,_=p===void 0?vf.STATIC:p,b=i.uniformBufferMaxPageByteSize,A=i.gl,w=c&Ja.UNIFORM;w||(Vn(A)?A.bindVertexArray(null):i.OES_vertex_array_object.bindVertexArrayOES(null));var I=Sv(l)?vg(l,4):vg(l.byteLength,4);s.gl_buffer_pages=[];var P;if(w){for(var B=I;B>0;)s.gl_buffer_pages.push(s.createBufferPage(Math.min(B,b),c,_)),B-=b;P=b}else s.gl_buffer_pages.push(s.createBufferPage(I,c,_)),P=I;return s.pageByteSize=P,s.byteSize=I,s.usage=c,s.gl_target=G2(c),Sv(l)||s.setSubData(0,new Uint8Array(l.buffer)),w||(Vn(A)?A.bindVertexArray(s.device.currentBoundVAO):i.OES_vertex_array_object.bindVertexArrayOES(s.device.currentBoundVAO)),s}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=n.byteLength-i);for(var s=this.device.gl,l=this.pageByteSize,c=t+a,p=t,_=t%l;p<c;){var b=Vn(s)?s.COPY_WRITE_BUFFER:this.gl_target,A=Ov(this,p);if(A.ubo)return;s.bindBuffer(b,A),Vn(s)?s.bufferSubData(b,_,n,i,Math.min(c-p,l)):s.bufferSubData(b,_,n),p+=l,_=0,i+=l,this.device.debugGroupStatisticsBufferUpload()}},r.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},r.prototype.createBufferPage=function(t,n,i){var a=this.device.gl,s=n&Ja.UNIFORM;if(!Vn(a)&&s)return{ubo:!0};var l=this.device.ensureResourceExists(a.createBuffer()),c=G2(n),p=nD(i);return a.bindBuffer(c,l),a.bufferData(c,t,p),l},r}(mf),hD=function(e){(0,Mn.__extends)(r,e);function r(t){var n,i,a,s,l=t.id,c=t.device,p=t.descriptor,_,b=e.call(this,{id:l,device:c})||this;b.type=ma.InputLayout;var A=p.vertexBufferDescriptors,w=p.indexBufferFormat,I=p.program;ki(w===Pt.U16_R||w===Pt.U32_R||w===null);var P=w!==null?uD(w):null,B=w!==null?M2(w):null,H=b.device.gl,Q=b.device.ensureResourceExists(Vn(H)?H.createVertexArray():c.OES_vertex_array_object.createVertexArrayOES());Vn(H)?H.bindVertexArray(Q):c.OES_vertex_array_object.bindVertexArrayOES(Q),H.bindBuffer(H.ARRAY_BUFFER,Ov(b.device.fallbackVertexBuffer));try{for(var ue=(0,Mn.__values)(p.vertexBufferDescriptors),Ee=ue.next();!Ee.done;Ee=ue.next()){var Le=Ee.value,Ze=Le.stepMode,tt=Le.attributes;try{for(var ft=(a=void 0,(0,Mn.__values)(tt)),wt=ft.next();!wt.done;wt=ft.next()){var fr=wt.value,hr=fr.shaderLocation,Mr=fr.format,ln=fr.divisor,Rn=ln===void 0?1:ln,wi=Vn(H)?hr:(_=I.attributes[hr])===null||_===void 0?void 0:_.location,ba=sD(Mr);if(fr.vertexFormat=ba,!kp(wi)){W2(Mr);var Va=ba.size,io=ba.type,as=ba.normalized;H.vertexAttribPointer(wi,Va,io,as,0,0),Ze===wd.INSTANCE&&(Vn(H)?H.vertexAttribDivisor(wi,Rn):c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(wi,Rn)),H.enableVertexAttribArray(wi)}}}catch(Sl){a={error:Sl}}finally{try{wt&&!wt.done&&(s=ft.return)&&s.call(ft)}finally{if(a)throw a.error}}}}catch(Sl){n={error:Sl}}finally{try{Ee&&!Ee.done&&(i=ue.return)&&i.call(ue)}finally{if(n)throw n.error}}return Vn(H)?H.bindVertexArray(null):c.OES_vertex_array_object.bindVertexArrayOES(null),b.vertexBufferDescriptors=A,b.vao=Q,b.indexBufferFormat=w,b.indexBufferType=P,b.indexBufferCompByteSize=B,b.program=I,b}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Vn(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},r}(mf),j_=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=t.fake,l=e.call(this,{id:n,device:i})||this;l.type=ma.Texture,a=(0,Mn.__assign)({dimension:Vi.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},a);var c=l.device.gl,p,_,b=l.clampmipLevelCount(a);if(l.immutable=a.usage===Ou.RENDER_TARGET,l.pixelStore=a.pixelStore,l.format=a.format,l.dimension=a.dimension,l.formatKind=I2(a.format),l.width=a.width,l.height=a.height,l.depthOrArrayLayers=a.depthOrArrayLayers,l.mipmaps=b>=1,!s){_=l.device.ensureResourceExists(c.createTexture());var A=l.device.translateTextureType(a.format),w=l.device.translateTextureInternalFormat(a.format);if(l.device.setActiveTexture(c.TEXTURE0),l.device.currentTextures[0]=null,l.preprocessImage(),a.dimension===Vi.TEXTURE_2D){if(p=$e.TEXTURE_2D,c.bindTexture(p,_),l.immutable)if(Vn(c))c.texStorage2D(p,b,w,a.width,a.height);else{var I=(w===$e.DEPTH_COMPONENT||l.isNPOT(),0);(l.format===Pt.D32F||l.format===Pt.D24_S8)&&!Vn(c)&&!i.WEBGL_depth_texture||(c.texImage2D(p,I,w,a.width,a.height,0,w,A,null),l.mipmaps&&(l.mipmaps=!1,c.texParameteri($e.TEXTURE_2D,$e.TEXTURE_MIN_FILTER,$e.LINEAR),c.texParameteri($e.TEXTURE_2D,$e.TEXTURE_WRAP_S,$e.CLAMP_TO_EDGE),c.texParameteri($e.TEXTURE_2D,$e.TEXTURE_WRAP_T,$e.CLAMP_TO_EDGE)))}ki(a.depthOrArrayLayers===1)}else if(a.dimension===Vi.TEXTURE_2D_ARRAY)p=$e.TEXTURE_2D_ARRAY,c.bindTexture(p,_),l.immutable&&Vn(c)&&c.texStorage3D(p,b,w,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Vi.TEXTURE_3D)p=$e.TEXTURE_3D,c.bindTexture(p,_),l.immutable&&Vn(c)&&c.texStorage3D(p,b,w,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Vi.TEXTURE_CUBE_MAP)p=$e.TEXTURE_CUBE_MAP,c.bindTexture(p,_),l.immutable&&Vn(c)&&c.texStorage2D(p,b,w,a.width,a.height),ki(a.depthOrArrayLayers===6);else throw new Error("whoops")}return l.gl_texture=_,l.gl_target=p,l.mipLevelCount=b,l}return r.prototype.setImageData=function(t,n){n===void 0&&(n=0);var i=this.device.gl;H2(this.format);var a=this.gl_target===$e.TEXTURE_3D||this.gl_target===$e.TEXTURE_2D_ARRAY,s=this.gl_target===$e.TEXTURE_CUBE_MAP,l=Qk(t[0]);this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null;var c=t[0],p,_;l?(p=this.width,_=this.height):(p=c.width,_=c.height,this.width=p,this.height=_),i.bindTexture(this.gl_target,this.gl_texture);var b=this.device.translateTextureFormat(this.format),A=Vn(i)?this.device.translateInternalTextureFormat(this.format):b,w=this.device.translateTextureType(this.format);this.preprocessImage();for(var I=0;I<this.depthOrArrayLayers;I++){var P=t[I],B=this.gl_target;s&&(B=$e.TEXTURE_CUBE_MAP_POSITIVE_X+I%6),this.immutable?i.texSubImage2D(B,n,0,0,p,_,b,w,P):Vn(i)?a?i.texImage3D(B,n,A,p,_,this.depthOrArrayLayers,0,b,w,P):i.texImage2D(B,n,A,p,_,0,b,w,P):l?i.texImage2D(B,n,b,p,_,0,b,w,P):i.texImage2D(B,n,b,b,w,P)}this.mipmaps&&this.generateMipmap(a)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(kv(this))},r.prototype.clampmipLevelCount=function(t){if(t.dimension===Vi.TEXTURE_2D_ARRAY&&t.depthOrArrayLayers>1){var n=Qf(t.format);if(n===Rr.BC1)for(var i=t.width,a=t.height,s=0;s<t.mipLevelCount;s++){if(i<=2||a<=2)return s-1;i=Math.max(i/2|0,1),a=Math.max(a/2|0,1)}}return t.mipLevelCount},r.prototype.preprocessImage=function(){var t=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&t.pixelStorei($e.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&t.pixelStorei($e.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&t.pixelStorei($e.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},r.prototype.generateMipmap=function(t){t===void 0&&(t=!1);var n=this.device.gl;return!Vn(n)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(n.bindTexture(this.gl_target,this.gl_texture),t?(n.texParameteri(this.gl_target,$e.TEXTURE_BASE_LEVEL,0),n.texParameteri(this.gl_target,$e.TEXTURE_MAX_LEVEL,Math.log2(this.width)),n.texParameteri(this.gl_target,$e.TEXTURE_MIN_FILTER,$e.LINEAR_MIPMAP_LINEAR),n.texParameteri(this.gl_target,$e.TEXTURE_MAG_FILTER,$e.LINEAR)):n.texParameteri($e.TEXTURE_2D,$e.TEXTURE_MIN_FILTER,$e.NEAREST_MIPMAP_LINEAR),n.generateMipmap(this.gl_target),n.bindTexture(this.gl_target,null)),this)},r.prototype.isNPOT=function(){var t=this.device.gl;return Vn(t)?!1:!dg(this.width)||!dg(this.height)},r}(mf),pD=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ma.RenderTarget,s.gl_renderbuffer=null,s.texture=null;var l=s.device.gl,c=a.format,p=a.width,_=a.height,b=a.sampleCount,A=b===void 0?1:b,w=a.texture,I=!1;if((c===Pt.D32F||c===Pt.D24_S8)&&w&&!Vn(l)&&!i.WEBGL_depth_texture&&(w.destroy(),s.texture=null,I=!0),!I&&w)s.texture=w;else{s.gl_renderbuffer=s.device.ensureResourceExists(l.createRenderbuffer()),l.bindRenderbuffer(l.RENDERBUFFER,s.gl_renderbuffer);var P=s.device.translateTextureInternalFormat(c,!0);Vn(l)&&A>1?l.renderbufferStorageMultisample($e.RENDERBUFFER,A,P,p,_):l.renderbufferStorage($e.RENDERBUFFER,P,p,_)}return s.format=c,s.width=p,s.height=_,s.sampleCount=A,s}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},r}(mf),Vl;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(Vl||(Vl={}));var dD=function(e){(0,Mn.__extends)(r,e);function r(t,n){var i=t.id,a=t.device,s=t.descriptor,l=e.call(this,{id:i,device:a})||this;l.rawVertexGLSL=n,l.type=ma.Program,l.uniformSetters={},l.attributes=[];var c=l.device.gl;return l.descriptor=s,l.gl_program=l.device.ensureResourceExists(c.createProgram()),l.gl_shader_vert=null,l.gl_shader_frag=null,l.compileState=Vl.NeedsCompile,l.tryCompileProgram(),l}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},r.prototype.tryCompileProgram=function(){var t,n;ki(this.compileState===Vl.NeedsCompile);var i=this.descriptor,a=this.device.gl;((t=i.vertex)===null||t===void 0?void 0:t.glsl)&&((n=i.fragment)===null||n===void 0?void 0:n.glsl)&&(this.gl_shader_vert=this.compileShader(i.vertex.glsl,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(i.fragment.glsl,a.FRAGMENT_SHADER),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=Vl.Compiling,Vn(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},r.prototype.readAttributesFromLinkedProgram=function(){for(var t,n=this.device.gl,i=n.getProgramParameter(this.gl_program,n.ACTIVE_ATTRIBUTES),a=Jk(this.descriptor.vertex.glsl),s=eD(this.rawVertexGLSL,a),l=function(_){var b=n.getActiveAttrib(c.gl_program,_),A=b.name,w=b.type,I=b.size,P=n.getAttribLocation(c.gl_program,A),B=(t=s.find(function(H){return H.name===A}))===null||t===void 0?void 0:t.location;P>=0&&!kp(B)&&(c.attributes[B]={name:A,location:P,type:w,size:I})},c=this,p=0;p<i;p++)l(p)},r.prototype.readUniformLocationsFromLinkedProgram=function(){for(var t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=t.getActiveUniform(this.gl_program,i),s=Gk(a.name).name,l=t.getUniformLocation(this.gl_program,s);if(this.uniformSetters[s]=V2(t,l,a),a&&a.size>1)for(var c=0;c<a.size;c++)l=t.getUniformLocation(this.gl_program,"".concat(s,"[").concat(c,"]")),this.uniformSetters["".concat(s,"[").concat(c,"]")]=V2(t,l,a)}},r.prototype.compileShader=function(t,n){var i=this.device.gl,a=this.device.ensureResourceExists(i.createShader(n));return i.shaderSource(a,t),i.compileShader(a),a},r.prototype.setUniformsLegacy=function(t){t===void 0&&(t={});var n=this.device.gl;if(!Vn(n)){var i=!1;for(var a in t){i||(n.useProgram(this.gl_program),i=!0);var s=t[a],l=this.uniformSetters[a];if(l){var c=s;c instanceof j_&&(c=c.textureIndex),l(c)}}}return this},r}(mf),vD=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ma.QueryPool;var l=s.device.gl;if(Vn(l)){var c=a.elemCount,p=a.type;s.gl_query=Rk(c,function(){return s.device.ensureResourceExists(l.createQuery())}),s.gl_query_type=lD(p)}return s}return r.prototype.queryResultOcclusion=function(t){var n=this.device.gl;if(Vn(n)){var i=this.gl_query[t];return n.getQueryParameter(i,n.QUERY_RESULT_AVAILABLE)?!!n.getQueryParameter(i,n.QUERY_RESULT):null}return null},r.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(Vn(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},r}(mf),mD=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=ma.Readback,a.gl_pbo=null,a.gl_sync=null,a}return r.prototype.clientWaitAsync=function(t,n,i){n===void 0&&(n=0),i===void 0&&(i=10);var a=this.device.gl;return new Promise(function(s,l){function c(){var p=a.clientWaitSync(t,n,0);if(p==a.WAIT_FAILED){l();return}if(p==a.TIMEOUT_EXPIRED){setTimeout(c,bk(i,0,a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}s()}c()})},r.prototype.getBufferSubDataAsync=function(t,n,i,a,s,l){return(0,Mn.__awaiter)(this,void 0,void 0,function(){var c;return(0,Mn.__generator)(this,function(p){switch(p.label){case 0:return c=this.device.gl,Vn(c)?(this.gl_sync=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0),c.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return p.sent(),c.bindBuffer(t,n),c.getBufferSubData(t,i,a,s,l),c.bindBuffer(t,null),[2,a];case 2:return[2]}})})},r.prototype.readTexture=function(t,n,i,a,s,l,c,p){return c===void 0&&(c=0),p===void 0&&(p=l.byteLength||0),(0,Mn.__awaiter)(this,void 0,void 0,function(){var _,b,A,w,I;return(0,Mn.__generator)(this,function(P){return _=this.device.gl,b=t,A=this.device.translateTextureFormat(b.format),w=this.device.translateTextureType(b.format),I=Sk(b.format),Vn(_)?(this.gl_pbo=this.device.ensureResourceExists(_.createBuffer()),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.bufferData(_.PIXEL_PACK_BUFFER,p,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),_.bindFramebuffer($e.READ_FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D($e.READ_FRAMEBUFFER,$e.COLOR_ATTACHMENT0,$e.TEXTURE_2D,b.gl_texture,0),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.readPixels(n,i,a,s,A,w,c*I),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(_.PIXEL_PACK_BUFFER,this.gl_pbo,0,l,c,0)]):[2,this.readTextureSync(t,n,i,a,s,l,c,p)]})})},r.prototype.readTextureSync=function(t,n,i,a,s,l,c,p){p===void 0&&(p=l.byteLength||0);var _=this.device.gl,b=t,A=this.device.translateTextureType(b.format);return _.bindFramebuffer($e.FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D($e.FRAMEBUFFER,$e.COLOR_ATTACHMENT0,$e.TEXTURE_2D,b.gl_texture,0),_.pixelStorei(_.PACK_ALIGNMENT,4),_.readPixels(n,i,a,s,_.RGBA,A,l),l},r.prototype.readBuffer=function(t,n,i,a,s){return(0,Mn.__awaiter)(this,void 0,void 0,function(){var l;return(0,Mn.__generator)(this,function(c){return l=this.device.gl,Vn(l)?[2,this.getBufferSubDataAsync(l.ARRAY_BUFFER,Ov(t,n),n,i,a,s)]:[2,Promise.reject()]})})},r.prototype.destroy=function(){e.prototype.destroy.call(this),Vn(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},r}(mf),gD=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,c=e.call(this,{id:n,device:i})||this;return c.type=ma.RenderPipeline,c.drawMode=iD((s=a.topology)!==null&&s!==void 0?s:_s.TRIANGLES),c.program=a.program,c.inputLayout=a.inputLayout,c.megaState=(0,Mn.__assign)((0,Mn.__assign)({},Mv(Rd)),a.megaStateDescriptor),c.colorAttachmentFormats=a.colorAttachmentFormats.slice(),c.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,c.sampleCount=(l=a.sampleCount)!==null&&l!==void 0?l:1,c}return r}(mf),_D=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ma.ComputePipeline,s.descriptor=a,s}return r}(mf),yD=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(r){this.creationStacks.set(r,new Error().stack),this.liveObjects.add(r)},e.prototype.trackResourceDestroyed=function(r){this.deletionStacks.has(r)&&console.warn("Object double freed:",r,`

Creation stack: `,this.creationStacks.get(r),`

Deletion stack: `,this.deletionStacks.get(r),`

This stack: `,new Error().stack),this.deletionStacks.set(r,new Error().stack),this.liveObjects.delete(r)},e.prototype.checkForLeaks=function(){var r,t;try{for(var n=(0,Mn.__values)(this.liveObjects.values()),i=n.next();!i.done;i=n.next()){var a=i.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}}catch(s){r={error:s}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setResourceLeakCheck=function(r,t){t?this.liveObjects.add(r):this.liveObjects.delete(r)},e}(),xD=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,c=e.call(this,{id:n,device:i})||this;c.type=ma.Sampler;var p=c.device.gl;if(Vn(p)){var _=c.device.ensureResourceExists(p.createSampler());p.samplerParameteri(_,$e.TEXTURE_WRAP_S,Wm(a.addressModeU)),p.samplerParameteri(_,$e.TEXTURE_WRAP_T,Wm(a.addressModeV)),p.samplerParameteri(_,$e.TEXTURE_WRAP_R,Wm((s=a.addressModeW)!==null&&s!==void 0?s:a.addressModeU)),p.samplerParameteri(_,$e.TEXTURE_MIN_FILTER,yg(a.minFilter,a.mipmapFilter)),p.samplerParameteri(_,$e.TEXTURE_MAG_FILTER,yg(a.magFilter,js.NO_MIP)),a.lodMinClamp!==void 0&&p.samplerParameterf(_,$e.TEXTURE_MIN_LOD,a.lodMinClamp),a.lodMaxClamp!==void 0&&p.samplerParameterf(_,$e.TEXTURE_MAX_LOD,a.lodMaxClamp),a.compareFunction!==void 0&&(p.samplerParameteri(_,p.TEXTURE_COMPARE_MODE,p.COMPARE_REF_TO_TEXTURE),p.samplerParameteri(_,p.TEXTURE_COMPARE_FUNC,a.compareFunction));var b=(l=a.maxAnisotropy)!==null&&l!==void 0?l:1;b>1&&c.device.EXT_texture_filter_anisotropic!==null&&(ki(a.minFilter===Xo.BILINEAR&&a.magFilter===Xo.BILINEAR&&a.mipmapFilter===js.LINEAR),p.samplerParameterf(_,c.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b)),c.gl_sampler=_}else c.descriptor=a;return c}return r.prototype.setTextureParameters=function(t,n,i){var a,s=this.device.gl,l=this.descriptor;this.isNPOT(n,i)?s.texParameteri($e.TEXTURE_2D,$e.TEXTURE_MIN_FILTER,$e.LINEAR):s.texParameteri(t,$e.TEXTURE_MIN_FILTER,yg(l.minFilter,l.mipmapFilter)),s.texParameteri($e.TEXTURE_2D,$e.TEXTURE_WRAP_S,Wm(l.addressModeU)),s.texParameteri($e.TEXTURE_2D,$e.TEXTURE_WRAP_T,Wm(l.addressModeV)),s.texParameteri(t,$e.TEXTURE_MAG_FILTER,yg(l.magFilter,js.NO_MIP));var c=(a=l.maxAnisotropy)!==null&&a!==void 0?a:1;c>1&&this.device.EXT_texture_filter_anisotropic!==null&&(ki(l.minFilter===Xo.BILINEAR&&l.magFilter===Xo.BILINEAR&&l.mipmapFilter===js.LINEAR),s.texParameteri(t,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c))},r.prototype.destroy=function(){e.prototype.destroy.call(this),Vn(this.device.gl)&&this.device.gl.deleteSampler(Z_(this))},r.prototype.isNPOT=function(t,n){return!dg(t)||!dg(n)},r}(mf),bD=function(){function e(){}return e.prototype.dispatchWorkgroups=function(r,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(r,t){},e.prototype.setPipeline=function(r){},e.prototype.setBindings=function(r){},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e}(),$2=65536,ED=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,SD=function(){function e(r,t){this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=Mv(Rd),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=Av.LOWER_LEFT,this.clipSpaceNearZ=Tv.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=r,this.contextAttributes=Cd(r.getContextAttributes()),Vn(r)?(this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=r.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=r.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=r.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=r.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=r.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=r.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=r.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=r.getExtension("EXT_color_buffer_half_float"),r.getExtension("EXT_frag_depth"),r.getExtension("OES_element_index_uint"),r.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=r.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=r.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=r.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=r.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=r.getExtension("KHR_parallel_shader_compile"),Vn(r)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new j_({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Vi.TEXTURE_2D,mipLevelCount:1,usage:Ou.RENDER_TARGET,format:this.contextAttributes.alpha===!1?Pt.U8_RGB_RT:Pt.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=zo.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Vi.TEXTURE_2D,zo.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Vi.TEXTURE_2D,zo.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:Ja.VERTEX,hint:vf.STATIC}),Vn(r)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Vi.TEXTURE_2D_ARRAY,zo.Float),this.fallbackTexture3D=this.createFallbackTexture(Vi.TEXTURE_3D,zo.Float),this.fallbackTextureCube=this.createFallbackTexture(Vi.TEXTURE_CUBE_MAP,zo.Float)),this.currentMegaState.depthCompare=Bi.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=nu.ALL,r.enable(r.DEPTH_TEST),r.enable(r.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new yD)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(r,t){var n=r===Vi.TEXTURE_CUBE_MAP?6:1,i=t===zo.Depth?Pt.D32F:Pt.U8_RGBA_NORM,a=this.createTexture({dimension:r,format:i,usage:Ou.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===zo.Float&&a.setImageData([new Uint8Array(4*n)]),kv(a)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var r=this.gl;if(this.maxVertexAttribs=r.getParameter($e.MAX_VERTEX_ATTRIBS),Vn(r)){this.uniformBufferMaxPageByteSize=Math.min(r.getParameter($e.MAX_UNIFORM_BLOCK_SIZE),$2),this.uniformBufferWordAlignment=r.getParameter(r.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=r.getInternalformatParameter(r.RENDERBUFFER,r.DEPTH32F_STENCIL8,r.SAMPLES);this.supportedSampleCounts=t?(0,Mn.__spreadArray)([],(0,Mn.__read)(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=$2;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(n,i){return n-i})},e.prototype.configureSwapChain=function(r,t,n){var i=this.scTexture;i.width=r,i.height=t,this.scPlatformFramebuffer=wk(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(r,t){switch(t===void 0&&(t=!1),r){case Pt.ALPHA:return $e.ALPHA;case Pt.U8_LUMINANCE:case Pt.F16_LUMINANCE:case Pt.F32_LUMINANCE:return $e.LUMINANCE;case Pt.F16_R:return $e.R16F;case Pt.F16_RG:return $e.RG16F;case Pt.F16_RGB:return $e.RGB16F;case Pt.F16_RGBA:return $e.RGBA16F;case Pt.F32_R:return $e.R32F;case Pt.F32_RG:return $e.RG32F;case Pt.F32_RGB:return $e.RGB32F;case Pt.F32_RGBA:return Vn(this.gl)?$e.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:$e.RGBA;case Pt.U8_R_NORM:return $e.R8;case Pt.U8_RG_NORM:return $e.RG8;case Pt.U8_RGB_NORM:case Pt.U8_RGB_RT:return $e.RGB8;case Pt.U8_RGB_SRGB:return $e.SRGB8;case Pt.U8_RGBA_NORM:case Pt.U8_RGBA_RT:return Vn(this.gl)?$e.RGBA8:t?$e.RGBA4:$e.RGBA;case Pt.U8_RGBA:return $e.RGBA;case Pt.U8_RGBA_SRGB:case Pt.U8_RGBA_RT_SRGB:return $e.SRGB8_ALPHA8;case Pt.U16_R:return $e.R16UI;case Pt.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case Pt.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case Pt.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case Pt.U16_RGBA_5551:return $e.RGB5_A1;case Pt.U16_RGB_565:return $e.RGB565;case Pt.U32_R:return $e.R32UI;case Pt.S8_RGBA_NORM:return $e.RGBA8_SNORM;case Pt.S8_RG_NORM:return $e.RG8_SNORM;case Pt.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Pt.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case Pt.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Pt.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case Pt.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Pt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case Pt.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case Pt.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case Pt.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case Pt.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case Pt.D32F_S8:return Vn(this.gl)?$e.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?$e.DEPTH_STENCIL:$e.DEPTH_COMPONENT16;case Pt.D24_S8:return Vn(this.gl)?$e.DEPTH24_STENCIL8:this.WEBGL_depth_texture?$e.DEPTH_STENCIL:$e.DEPTH_COMPONENT16;case Pt.D32F:return Vn(this.gl)?$e.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?$e.DEPTH_COMPONENT:$e.DEPTH_COMPONENT16;case Pt.D24:return Vn(this.gl)?$e.DEPTH_COMPONENT24:this.WEBGL_depth_texture?$e.DEPTH_COMPONENT:$e.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(r){var t=Qf(r);switch(t){case Rr.U8:return $e.UNSIGNED_BYTE;case Rr.U16:return $e.UNSIGNED_SHORT;case Rr.U32:return $e.UNSIGNED_INT;case Rr.S8:return $e.BYTE;case Rr.F16:return $e.HALF_FLOAT;case Rr.F32:return $e.FLOAT;case Rr.U16_PACKED_5551:return $e.UNSIGNED_SHORT_5_5_5_1;case Rr.D32F:return Vn(this.gl)?$e.FLOAT:this.WEBGL_depth_texture?$e.UNSIGNED_INT:$e.UNSIGNED_BYTE;case Rr.D24:return Vn(this.gl)?$e.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?$e.UNSIGNED_SHORT:$e.UNSIGNED_BYTE;case Rr.D24S8:return Vn(this.gl)?$e.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?$e.UNSIGNED_INT_24_8_WEBGL:$e.UNSIGNED_BYTE;case Rr.D32FS8:return $e.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(r){switch(r){case Pt.F32_R:return $e.R32F;case Pt.F32_RG:return $e.RG32F;case Pt.F32_RGB:return $e.RGB32F;case Pt.F32_RGBA:return $e.RGBA32F;case Pt.F16_R:return $e.R16F;case Pt.F16_RG:return $e.RG16F;case Pt.F16_RGB:return $e.RGB16F;case Pt.F16_RGBA:return $e.RGBA16F}return this.translateTextureFormat(r)},e.prototype.translateTextureFormat=function(r){if(H2(r)||r===Pt.F32_LUMINANCE||r===Pt.U8_LUMINANCE)return this.translateTextureInternalFormat(r);var t=Vn(this.gl)||!Vn(this.gl)&&!!this.WEBGL_depth_texture;switch(r){case Pt.D24_S8:case Pt.D32F_S8:return t?$e.DEPTH_STENCIL:$e.RGBA;case Pt.D24:case Pt.D32F:return t?$e.DEPTH_COMPONENT:$e.RGBA}var n=W2(r),i=pg(r);switch(i){case Gn.A:return $e.ALPHA;case Gn.R:return n?$e.RED_INTEGER:$e.RED;case Gn.RG:return n?$e.RG_INTEGER:$e.RG;case Gn.RGB:return n?$e.RGB_INTEGER:$e.RGB;case Gn.RGBA:return $e.RGBA}},e.prototype.setActiveTexture=function(r){this.currentActiveTexture!==r&&(this.gl.activeTexture(r),this.currentActiveTexture=r)},e.prototype.bindVAO=function(r){this.currentBoundVAO!==r&&(Vn(this.gl)?this.gl.bindVertexArray(r):this.OES_vertex_array_object.bindVertexArrayOES(r),this.currentBoundVAO=r)},e.prototype.programCompiled=function(r){ki(r.compileState!==Vl.NeedsCompile),r.compileState===Vl.Compiling&&(r.compileState=Vl.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(r))},e.prototype.useProgram=function(r){this.currentProgram!==r&&(this.programCompiled(r),this.gl.useProgram(r.gl_program),this.currentProgram=r)},e.prototype.ensureResourceExists=function(r){if(r===null){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}else return r},e.prototype.createBuffer=function(r){return new fD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new j_({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new xD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){return new pD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,s=t.mipLevelCount;return ki(s===1),this.createRenderTarget({format:n,width:i,height:a,sampleCount:1,texture:r})},e.prototype.createProgram=function(r){var t,n,i,a=(t=r.vertex)===null||t===void 0?void 0:t.glsl;return((n=r.vertex)===null||n===void 0?void 0:n.glsl)&&(r.vertex.glsl=Lp(this.queryVendorInfo(),"vert",r.vertex.glsl)),((i=r.fragment)===null||i===void 0?void 0:i.glsl)&&(r.fragment.glsl=Lp(this.queryVendorInfo(),"frag",r.fragment.glsl)),this.createProgramSimple(r,a)},e.prototype.createProgramSimple=function(r,t){var n=new dD({id:this.getNextUniqueId(),device:this,descriptor:r},t);return n},e.prototype.createBindings=function(r){return new rD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new hD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new gD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePass=function(){return new bD},e.prototype.createComputePipeline=function(r){return new _D({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createReadback=function(){return new mD({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(r,t){return new vD({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(r){var t,n,i,a,s,l,c=r.colorAttachment;r.depthClearValue=(t=r.depthClearValue)!==null&&t!==void 0?t:"load",r.stencilClearValue=(n=r.stencilClearValue)!==null&&n!==void 0?n:"load";for(var p=0;p<c.length;p++)r.colorAttachmentLevel||(r.colorAttachmentLevel=[]),r.colorAttachmentLevel[p]=(i=r.colorAttachmentLevel[p])!==null&&i!==void 0?i:0,r.colorResolveToLevel||(r.colorResolveToLevel=[]),r.colorResolveToLevel[p]=(a=r.colorResolveToLevel[p])!==null&&a!==void 0?a:0,r.colorClearColor||(r.colorClearColor=[]),r.colorClearColor[p]=(s=r.colorClearColor[p])!==null&&s!==void 0?s:"load",r.colorStore||(r.colorStore=[]),r.colorStore[p]=(l=r.colorStore[p])!==null&&l!==void 0?l:!1},e.prototype.createRenderPass=function(r){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=r,this.formatRenderPassDescriptor(r);var t=r.colorAttachment,n=r.colorAttachmentLevel,i=r.colorClearColor,a=r.colorResolveTo,s=r.colorResolveToLevel,l=r.depthStencilAttachment,c=r.depthClearValue,p=r.stencilClearValue,_=r.depthStencilResolveTo;this.setRenderPassParametersBegin(t.length);for(var b=0;b<t.length;b++)this.setRenderPassParametersColor(b,t[b],n[b],a[b],s[b]);this.setRenderPassParametersDepthStencil(l,_),this.validateCurrentAttachments();for(var b=0;b<t.length;b++){var A=i[b];A!=="load"&&this.setRenderPassParametersClearColor(b,A.r,A.g,A.b,A.a)}return this.setRenderPassParametersClearDepthStencil(c,p),this},e.prototype.submitPass=function(r){ki(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(r,t,n,i,a,s){var l=this.gl,c=r,p=i;if(ki(p.mipLevelCount===1),ki(c.mipLevelCount===1),Vn(l))c===this.scTexture?l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,c,0)),l.bindFramebuffer(l.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,p,0),l.blitFramebuffer(a,s,a+p.width,s+p.height,t,n,t+p.width,n+p.height,l.COLOR_BUFFER_BIT,l.LINEAR),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null);else if(c===this.scTexture){var _=this.createRenderTargetFromTexture(i);this.submitBlitRenderPass(_,c)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(r,t,n){switch(r){case Pt.BC1_SRGB:case Pt.BC2_SRGB:case Pt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?V_(t,n,4,4):!1;case Pt.BC1:case Pt.BC2:case Pt.BC3:return this.WEBGL_compressed_texture_s3tc!==null?V_(t,n,4,4):!1;case Pt.BC4_UNORM:case Pt.BC4_SNORM:case Pt.BC5_UNORM:case Pt.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?V_(t,n,4,4):!1;case Pt.U16_R_NORM:case Pt.U16_RG_NORM:case Pt.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case Pt.F32_R:case Pt.F32_RG:case Pt.F32_RGB:case Pt.F32_RGBA:return this.OES_texture_float_linear!==null;case Pt.F16_R:case Pt.F16_RG:case Pt.F16_RGB:case Pt.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(r){var t=this.gl;if(r.compileState===Vl.NeedsCompile)throw new Error("whoops");if(r.compileState===Vl.Compiling){var n=void 0;return this.KHR_parallel_shader_compile!==null?n=t.getProgramParameter(r.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):n=!0,n&&this.programCompiled(r),n}return r.compileState===Vl.NeedsBind||r.compileState===Vl.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===ma.Buffer)for(var n=r.gl_buffer_pages,i=0;i<n.length;i++)Gm(n[i],"".concat(t," Page ").concat(i));else if(r.type===ma.Texture)Gm(kv(r),t);else if(r.type===ma.Sampler)Gm(Z_(r),t);else if(r.type===ma.RenderTarget){var a=r.gl_renderbuffer;a!==null&&Gm(a,t)}else r.type===ma.InputLayout&&Gm(r.vao,t)},e.prototype.setResourceLeakCheck=function(r,t){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(r,t)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e.prototype.programPatched=function(r,t){ki(this.shaderDebug)},e.prototype.getBufferData=function(r,t,n){n===void 0&&(n=0);var i=this.gl;Vn(i)&&(i.bindBuffer(i.COPY_READ_BUFFER,Ov(r,n*4)),i.getBufferSubData(i.COPY_READ_BUFFER,n*4,t))},e.prototype.debugGroupStatisticsDrawCall=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=r},e.prototype.debugGroupStatisticsBufferUpload=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=r},e.prototype.debugGroupStatisticsTextureBind=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=r},e.prototype.debugGroupStatisticsTriangles=function(r){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=r},e.prototype.reportShaderError=function(r,t){var n=this.gl,i=n.getShaderParameter(r,n.COMPILE_STATUS);if(!i){console.error(Mk(t));var a=n.getExtension("WEBGL_debug_shaders");a&&console.error(a.getTranslatedShaderSource(r)),console.error(n.getShaderInfoLog(r))}return i},e.prototype.checkProgramCompilationForErrors=function(r){var t=this.gl,n=r.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var i=r.descriptor;if(!this.reportShaderError(r.gl_shader_vert,i.vertex.glsl)||!this.reportShaderError(r.gl_shader_frag,i.fragment.glsl))return;console.error(t.getProgramInfoLog(r.gl_program))}},e.prototype.bindFramebufferAttachment=function(r,t,n,i){var a=this.gl;if(kp(n))a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,null);else if(n.type===ma.RenderTarget)n.gl_renderbuffer!==null?a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,n.gl_renderbuffer):n.texture!==null&&a.framebufferTexture2D(r,t,$e.TEXTURE_2D,kv(n.texture),i);else if(n.type===ma.Texture){var s=kv(n);n.dimension===Vi.TEXTURE_2D?a.framebufferTexture2D(r,t,$e.TEXTURE_2D,s,i):Vn(a)&&n.dimension===Vi.TEXTURE_2D_ARRAY}},e.prototype.bindFramebufferDepthStencilAttachment=function(r,t){var n=this.gl,i=kp(t)?Cn.Depth|Cn.Stencil:wv(t.format),a=!!(i&Cn.Depth),s=!!(i&Cn.Stencil);if(a&&s){var l=Vn(this.gl)||!Vn(this.gl)&&!!this.WEBGL_depth_texture;l?this.bindFramebufferAttachment(r,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0)}else a?(this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,null,0)):s&&(this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var r=-1,t=-1,n=-1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];a!==null&&(r===-1?(r=a.sampleCount,t=a.width,n=a.height):(ki(r===a.sampleCount),ki(t===a.width),ki(n===a.height)))}this.currentDepthStencilAttachment&&(r===-1?r=this.currentDepthStencilAttachment.sampleCount:(ki(r===this.currentDepthStencilAttachment.sampleCount),ki(t===this.currentDepthStencilAttachment.width),ki(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=r},e.prototype.setRenderPassParametersBegin=function(r){var t=this.gl;if(Vn(t)?t.bindFramebuffer($e.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||t.bindFramebuffer($e.FRAMEBUFFER,this.renderPassDrawFramebuffer),Vn(t)?t.drawBuffers([$e.COLOR_ATTACHMENT0,$e.COLOR_ATTACHMENT1,$e.COLOR_ATTACHMENT2,$e.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([$e.COLOR_ATTACHMENT0_WEBGL,$e.COLOR_ATTACHMENT1_WEBGL,$e.COLOR_ATTACHMENT2_WEBGL,$e.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=r;n<this.currentColorAttachments.length;n++){var i=Vn(t)?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,a=Vn(t)?$e.COLOR_ATTACHMENT0:$e.COLOR_ATTACHMENT0_WEBGL;t.framebufferRenderbuffer(i,a+n,$e.RENDERBUFFER,null),t.framebufferTexture2D(i,a+n,$e.TEXTURE_2D,null,0)}this.currentColorAttachments.length=r},e.prototype.setRenderPassParametersColor=function(r,t,n,i,a){var s=this.gl,l=Vn(s);(this.currentColorAttachments[r]!==t||this.currentColorAttachmentLevels[r]!==n)&&(this.currentColorAttachments[r]=t,this.currentColorAttachmentLevels[r]=n,(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,(l?$e.COLOR_ATTACHMENT0:$e.COLOR_ATTACHMENT0_WEBGL)+r,t,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[r]!==i||this.currentColorResolveToLevels[r]!==a)&&(this.currentColorResolveTos[r]=i,this.currentColorResolveToLevels[r]=a,i!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(r,t){var n=this.gl;this.currentDepthStencilAttachment!==r&&(this.currentDepthStencilAttachment=r,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Vn(n)?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(r,t,n,i,a){var s=this.gl;if(this.OES_draw_buffers_indexed!==null){var l=this.currentMegaState.attachmentsState[r];l&&l.channelWriteMask!==nu.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(r,!0,!0,!0,!0),l.channelWriteMask=nu.ALL)}else{var l=this.currentMegaState.attachmentsState[0];l&&l.channelWriteMask!==nu.ALL&&(s.colorMask(!0,!0,!0,!0),l.channelWriteMask=nu.ALL)}this.setScissorRectEnabled(!1),Vn(s)?s.clearBufferfv(s.COLOR,r,[t,n,i,a]):(s.clearColor(t,n,i,a),s.clear(s.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(r,t){r===void 0&&(r="load"),t===void 0&&(t="load");var n=this.gl;r!=="load"&&(ki(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),Vn(n)?n.clearBufferfv(n.DEPTH,0,[r]):(n.clearDepth(r),n.clear(n.DEPTH_BUFFER_BIT))),t!=="load"&&(ki(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),Vn(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(r){var t,n=this.gl,i=r,a=i.uniformBufferBindings,s=i.samplerBindings,l=i.bindingLayouts;ki(0<l.bindingLayoutTables.length);var c=l.bindingLayoutTables[0];ki(a.length>=c.numUniformBuffers),ki(s.length>=c.numSamplers);for(var p=0;p<a.length;p++){var _=a[p];if(_.size!==0){var b=c.firstUniformBuffer+p,A=_.buffer,w=_.offset||0,I=_.size||A.byteSize;if(A!==this.currentUniformBuffers[b]||w!==this.currentUniformBufferByteOffsets[b]||I!==this.currentUniformBufferByteSizes[b]){var P=w%A.pageByteSize,B=A.gl_buffer_pages[w/A.pageByteSize|0];ki(P+I<=A.pageByteSize),Vn(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,b,B,P,I),this.currentUniformBuffers[b]=A,this.currentUniformBufferByteOffsets[b]=w,this.currentUniformBufferByteSizes[b]=I}}}for(var p=0;p<c.numSamplers;p++){var _=s[p],H=c.firstSampler+p,Q=_!==null&&_.sampler!==null?Z_(_.sampler):null,ue=_!==null&&_.texture!==null?kv(_.texture):null;if(this.currentSamplers[H]!==Q&&(Vn(n)&&n.bindSampler(H,Q),this.currentSamplers[H]=Q),this.currentTextures[H]!==ue){if(this.setActiveTexture(n.TEXTURE0+H),ue!==null){var Ee=Cd(_).texture,Le=Ee.gl_target,Ze=Ee.width,tt=Ee.height;_.texture.textureIndex=H,n.bindTexture(Le,ue),Vn(n)||(t=_.sampler)===null||t===void 0||t.setTextureParameters(Le,Ze,tt),this.debugGroupStatisticsTextureBind()}else{var ft=(0,Mn.__assign)((0,Mn.__assign)({},_),F2),wt=ft.dimension,fr=ft.formatKind,Le=cD(wt);n.bindTexture(Le,this.getFallbackTexture((0,Mn.__assign)({gl_target:Le,formatKind:fr},ft)))}this.currentTextures[H]=ue}}},e.prototype.setViewport=function(r,t,n,i){var a=this.gl;a.viewport(r,t,n,i)},e.prototype.setScissorRect=function(r,t,n,i){var a=this.gl;this.setScissorRectEnabled(!0),a.scissor(r,t,n,i)},e.prototype.applyAttachmentStateIndexed=function(r,t,n){var i=this.gl,a=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(a.colorMaskiOES(r,!!(n.channelWriteMask&nu.RED),!!(n.channelWriteMask&nu.GREEN),!!(n.channelWriteMask&nu.BLUE),!!(n.channelWriteMask&nu.ALPHA)),t.channelWriteMask=n.channelWriteMask);var s=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,l=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(l||s)&&(Bp(t.rgbBlendState)&&Bp(t.alphaBlendState)?a.enableiOES(r,i.BLEND):Bp(n.rgbBlendState)&&Bp(n.alphaBlendState)&&a.disableiOES(r,i.BLEND)),s&&(a.blendEquationSeparateiOES(r,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),l&&(a.blendFuncSeparateiOES(r,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(r,t){var n=this.gl;r.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&nu.RED),!!(t.channelWriteMask&nu.GREEN),!!(t.channelWriteMask&nu.BLUE),!!(t.channelWriteMask&nu.ALPHA)),r.channelWriteMask=t.channelWriteMask);var i=r.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,a=r.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(a||i)&&(Bp(r.rgbBlendState)&&Bp(r.alphaBlendState)?n.enable(n.BLEND):Bp(t.rgbBlendState)&&Bp(t.alphaBlendState)&&n.disable(n.BLEND)),i&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),r.rgbBlendState.blendMode=t.rgbBlendState.blendMode,r.alphaBlendState.blendMode=t.alphaBlendState.blendMode),a&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(r){var t=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var i=0;i<r.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,n.attachmentsState[0],r.attachmentsState[0]);else ki(r.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],r.attachmentsState[0]);if(P2(n.blendConstant,r.blendConstant)||(t.blendColor(r.blendConstant.r,r.blendConstant.g,r.blendConstant.b,r.blendConstant.a),O2(n.blendConstant,r.blendConstant)),n.depthCompare!==r.depthCompare&&(t.depthFunc(r.depthCompare),n.depthCompare=r.depthCompare),!!n.depthWrite!=!!r.depthWrite&&(t.depthMask(r.depthWrite),n.depthWrite=r.depthWrite),!!n.stencilWrite!=!!r.stencilWrite&&(t.stencilMask(r.stencilWrite?255:0),n.stencilWrite=r.stencilWrite),!gg(n.stencilFront,r.stencilFront)){var a=r.stencilFront,s=a.passOp,l=a.failOp,c=a.depthFailOp,p=a.compare;(n.stencilFront.passOp!==s||n.stencilFront.failOp!==l||n.stencilFront.depthFailOp!==c)&&(t.stencilOpSeparate(t.FRONT,l,c,s),n.stencilFront.passOp=s,n.stencilFront.failOp=l,n.stencilFront.depthFailOp=c),n.stencilFront.compare!==p&&(this.setStencilReference(0),n.stencilFront.compare=p)}if(!gg(n.stencilBack,r.stencilBack)){var _=r.stencilBack,s=_.passOp,l=_.failOp,c=_.depthFailOp,p=_.compare;(n.stencilBack.passOp!==s||n.stencilBack.failOp!==l||n.stencilBack.depthFailOp!==c)&&(t.stencilOpSeparate(t.BACK,l,c,s),n.stencilBack.passOp=s,n.stencilBack.failOp=l,n.stencilBack.depthFailOp=c),n.stencilBack.compare!==p&&(this.setStencilReference(0),n.stencilBack.compare=p)}n.cullMode!==r.cullMode&&(n.cullMode===Zl.NONE?t.enable(t.CULL_FACE):r.cullMode===Zl.NONE&&t.disable(t.CULL_FACE),r.cullMode===Zl.BACK?t.cullFace(t.BACK):r.cullMode===Zl.FRONT?t.cullFace(t.FRONT):r.cullMode===Zl.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=r.cullMode),n.frontFace!==r.frontFace&&(t.frontFace(r.frontFace),n.frontFace=r.frontFace),n.polygonOffset!==r.polygonOffset&&(r.polygonOffset?(t.polygonOffset(1,1),t.enable(t.POLYGON_OFFSET_FILL)):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=r.polygonOffset)},e.prototype.validatePipelineFormats=function(r){for(var t=0;t<this.currentColorAttachments.length;t++)var n=this.currentColorAttachments[t];this.currentDepthStencilAttachment&&ki(this.currentDepthStencilAttachment.format===r.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&ki(this.currentSampleCount===r.sampleCount)},e.prototype.setPipeline=function(r){this.currentPipeline=r,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var t=this.currentPipeline.program;if(this.useProgram(t),t.compileState===Vl.NeedsBind){var n=this.gl,i=t.gl_program,a=t.descriptor,s=X2(a.vertex.glsl,ED);if(Vn(n))for(var l=0;l<s.length;l++){var c=(0,Mn.__read)(s[l],2),p=c[1],_=n.getUniformBlockIndex(i,p);_!==-1&&_!==4294967295&&n.uniformBlockBinding(i,_,l)}for(var b=X2(a.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),l=0;l<b.length;l++){var A=(0,Mn.__read)(b[l],3),w=A[1],I=A[2],P=n.getUniformLocation(i,w);n.uniform1i(P,parseInt(I))}t.compileState=Vl.ReadyToUse}},e.prototype.setVertexInput=function(r,t,n){var i,a,s;if(r!==null){ki(this.currentPipeline.inputLayout===r);var l=r;this.bindVAO(l.vao);for(var c=this.gl,p=0;p<l.vertexBufferDescriptors.length;p++){var _=l.vertexBufferDescriptors[p],b=_.arrayStride,A=_.attributes;try{for(var w=(i=void 0,(0,Mn.__values)(A)),I=w.next();!I.done;I=w.next()){var P=I.value,B=P.shaderLocation,H=P.offset,Q=Vn(c)?B:(s=l.program.attributes[B])===null||s===void 0?void 0:s.location;if(!kp(Q)){var ue=t[p];if(ue===null)continue;var Ee=P.vertexFormat;c.bindBuffer(c.ARRAY_BUFFER,Ov(ue.buffer));var Le=(ue.offset||0)+H;c.vertexAttribPointer(Q,Ee.size,Ee.type,Ee.normalized,b,Le)}}}catch(tt){i={error:tt}}finally{try{I&&!I.done&&(a=w.return)&&a.call(w)}finally{if(i)throw i.error}}}if(ki(n!==null==(l.indexBufferFormat!==null)),n!==null){var Ze=n.buffer;ki(Ze.usage===Ja.INDEX),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,Ov(Ze)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else ki(this.currentPipeline.inputLayout===null),ki(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(r){this.currentStencilRef!==r&&(this.currentStencilRef=r,this.applyStencil())},e.prototype.draw=function(r,t,n,i){var a,s=this.gl,l=this.currentPipeline;if(t){var c=[l.drawMode,n||0,r,t];Vn(s)?s.drawArraysInstanced.apply(s,(0,Mn.__spreadArray)([],(0,Mn.__read)(c),!1)):(a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(a,(0,Mn.__spreadArray)([],(0,Mn.__read)(c),!1))}else s.drawArrays(l.drawMode,n,r);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndexed=function(r,t,n,i,a){var s,l=this.gl,c=this.currentPipeline,p=Cd(c.inputLayout),_=Cd(this.currentIndexBufferByteOffset)+n*p.indexBufferCompByteSize;if(t){var b=[c.drawMode,r,p.indexBufferType,_,t];Vn(l)?l.drawElementsInstanced.apply(l,(0,Mn.__spreadArray)([],(0,Mn.__read)(b),!1)):(s=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(s,(0,Mn.__spreadArray)([],(0,Mn.__read)(b),!1))}else l.drawElements(c.drawMode,r,p.indexBufferType,_);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndirect=function(r,t){},e.prototype.drawIndexedIndirect=function(r,t){},e.prototype.beginOcclusionQuery=function(r){var t=this.gl;if(Vn(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[r])}},e.prototype.endOcclusionQuery=function(){var r=this.gl;if(Vn(r)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;r.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(r){var t=r;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(r){},e.prototype.endPass=function(){for(var r=this.gl,t=Vn(r),n=!1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];if(a!==null){var s=this.currentColorResolveTos[i],l=!1;s!==null&&(ki(a.width===s.width&&a.height===s.height),this.setScissorRectEnabled(!1),t&&r.bindFramebuffer(r.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i]),l=!0,s===this.scTexture?r.bindFramebuffer(t?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,this.scPlatformFramebuffer):(r.bindFramebuffer(t?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&r.framebufferTexture2D(t?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s.gl_texture,this.currentColorResolveToLevels[i])),t?(r.blitFramebuffer(0,0,a.width,a.height,0,0,s.width,s.height,r.COLOR_BUFFER_BIT,r.LINEAR),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(a,s),n=!0),this.currentRenderPassDescriptor.colorStore[i]||l||(r.bindFramebuffer(t?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),r.bindFramebuffer(t?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var c=this.currentDepthStencilAttachment;if(c){var p=this.currentDepthStencilResolveTo,l=!1;p&&(ki(c.width===p.width&&c.height===p.height),this.setScissorRectEnabled(!1),r.bindFramebuffer(t?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),r.bindFramebuffer(t?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,c),this.bindFramebufferDepthStencilAttachment(t?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,p)),l=!0,t&&r.blitFramebuffer(0,0,c.width,c.height,0,0,p.width,p.height,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(t?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(l||(r.bindFramebuffer(t?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,c),l=!0),t&&r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[r.DEPTH_STENCIL_ATTACHMENT])),l&&r.bindFramebuffer(t?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||r.bindFramebuffer(t?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(r){if(this.currentScissorEnabled!==r){var t=this.gl;r?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=r}},e.prototype.applyStencil=function(){kp(this.currentStencilRef)||(this.gl.stencilFuncSeparate($e.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,255),this.gl.stencilFuncSeparate($e.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,255))},e.prototype.getFallbackTexture=function(r){var t=r.gl_target,n=r.formatKind;if(t===$e.TEXTURE_2D)return n===zo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===$e.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===$e.TEXTURE_3D)return this.fallbackTexture3D;if(t===$e.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(r,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:Ja.VERTEX|Ja.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:wd.VERTEX,attributes:[{format:Pt.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:_s.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[Pt.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:Mv(Rd)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:r.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:r}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var i=this.createRenderPass({colorAttachment:[r],colorResolveTo:[t],colorClearColor:[Ak]}),a=this.getCanvas(),s=a.width,l=a.height;i.setPipeline(this.blitRenderPipeline),i.setBindings(this.blitBindings),i.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),i.setViewport(0,0,s,l),this.gl.disable(this.gl.BLEND),i.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),AD=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return(0,Mn.__awaiter)(this,void 0,void 0,function(){var t,n,i,a,s,l,c,p,_,b,A;return(0,Mn.__generator)(this,function(w){return t=this.pluginOptions,n=t.targets,i=t.xrCompatible,a=t.antialias,s=a===void 0?!1:a,l=t.preserveDrawingBuffer,c=l===void 0?!1:l,p=t.premultipliedAlpha,_=p===void 0?!0:p,b={antialias:s,preserveDrawingBuffer:c,stencil:!0,premultipliedAlpha:_,xrCompatible:i},this.handleContextEvents(r),n.includes("webgl2")&&(A=r.getContext("webgl2",b)||r.getContext("experimental-webgl2",b)),!A&&n.includes("webgl1")&&(A=r.getContext("webgl",b)||r.getContext("experimental-webgl",b)),[2,new SD(A,{shaderDebug:!0,trackResources:!0})]})})},e.prototype.handleContextEvents=function(r){var t=this.pluginOptions,n=t.onContextLost,i=t.onContextRestored,a=t.onContextCreationError;a&&r.addEventListener("webglcontextcreationerror",a,!1),n&&r.addEventListener("webglcontextlost",n,!1),i&&r.addEventListener("webglcontextrestored",i,!1)},e}();let ys;const Y2=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&Y2.decode();let Xm=null;function xg(){return(Xm===null||Xm.byteLength===0)&&(Xm=new Uint8Array(ys.memory.buffer)),Xm}function bg(e,r){return e=e>>>0,Y2.decode(xg().subarray(e,e+r))}const zh=new Array(128).fill(void 0);zh.push(void 0,null,!0,!1);let $m=zh.length;function TD(e){$m===zh.length&&zh.push(zh.length+1);const r=$m;return $m=zh[r],zh[r]=e,r}function Eg(e){return zh[e]}function wD(e){e<132||(zh[e]=$m,$m=e)}function CD(e){const r=Eg(e);return wD(e),r}let Ym=0;const Sg=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},RD=typeof Sg.encodeInto=="function"?function(e,r){return Sg.encodeInto(e,r)}:function(e,r){const t=Sg.encode(e);return r.set(t),{read:e.length,written:t.length}};function H_(e,r,t){if(t===void 0){const l=Sg.encode(e),c=r(l.length,1)>>>0;return xg().subarray(c,c+l.length).set(l),Ym=l.length,c}let n=e.length,i=r(n,1)>>>0;const a=xg();let s=0;for(;s<n;s++){const l=e.charCodeAt(s);if(l>127)break;a[i+s]=l}if(s!==n){s!==0&&(e=e.slice(s)),i=t(i,n,n=s+e.length*3,1)>>>0;const l=xg().subarray(i+s,i+n);s+=RD(e,l).written}return Ym=s,i}let qm=null;function Ag(){return(qm===null||qm.byteLength===0)&&(qm=new Int32Array(ys.memory.buffer)),qm}function MD(e,r,t){let n,i;try{const l=ys.__wbindgen_add_to_stack_pointer(-16),c=H_(e,ys.__wbindgen_malloc,ys.__wbindgen_realloc),p=Ym,_=H_(r,ys.__wbindgen_malloc,ys.__wbindgen_realloc),b=Ym;ys.glsl_compile(l,c,p,_,b,t);var a=Ag()[l/4+0],s=Ag()[l/4+1];return n=a,i=s,bg(a,s)}finally{ys.__wbindgen_add_to_stack_pointer(16),ys.__wbindgen_free(n,i,1)}}class Km{static __wrap(r){r=r>>>0;const t=Object.create(Km.prototype);return t.__wbg_ptr=r,t}__destroy_into_raw(){const r=this.__wbg_ptr;return this.__wbg_ptr=0,r}free(){const r=this.__destroy_into_raw();ys.__wbg_wgslcomposer_free(r)}constructor(){const r=ys.wgslcomposer_new();return Km.__wrap(r)}wgsl_compile(r){let t,n;try{const s=ys.__wbindgen_add_to_stack_pointer(-16),l=H_(r,ys.__wbindgen_malloc,ys.__wbindgen_realloc),c=Ym;ys.wgslcomposer_wgsl_compile(s,this.__wbg_ptr,l,c);var i=Ag()[s/4+0],a=Ag()[s/4+1];return t=i,n=a,bg(i,a)}finally{ys.__wbindgen_add_to_stack_pointer(16),ys.__wbindgen_free(t,n,1)}}}function ID(e,r){return ty(this,null,function*(){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return yield WebAssembly.instantiateStreaming(e,r)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=yield e.arrayBuffer();return yield WebAssembly.instantiate(t,r)}else{const t=yield WebAssembly.instantiate(e,r);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}})}function PD(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(r,t){const n=bg(r,t);return TD(n)},e.wbg.__wbindgen_object_drop_ref=function(r){CD(r)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(r){console.log(Eg(r))},e.wbg.__wbg_log_576ca876af0d4a77=function(r,t){console.log(Eg(r),Eg(t))},e.wbg.__wbindgen_throw=function(r,t){throw new Error(bg(r,t))},e}function OD(e,r){return ys=e.exports,q2.__wbindgen_wasm_module=r,qm=null,Xm=null,ys}function q2(e){return ty(this,null,function*(){if(ys!==void 0)return ys;const r=PD();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:n}=yield ID(yield e,r);return OD(t,n)})}var Hs;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(Hs||(Hs={}));var W_;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(W_||(W_={}));function kD(e){var r=0;return e&Ou.SAMPLED&&(r|=Hs.TEXTURE_BINDING|Hs.COPY_DST|Hs.COPY_SRC),e&Ou.STORAGE&&(r|=Hs.TEXTURE_BINDING|Hs.STORAGE_BINDING|Hs.COPY_SRC|Hs.COPY_DST),e&Ou.RENDER_TARGET&&(r|=Hs.RENDER_ATTACHMENT|Hs.TEXTURE_BINDING|Hs.COPY_SRC|Hs.COPY_DST),r}function G_(e){if(e===Pt.U8_R_NORM)return"r8unorm";if(e===Pt.U8_RG_NORM)return"rg8unorm";if(e===Pt.U8_RGBA_RT)return"bgra8unorm";if(e===Pt.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===Pt.U8_RGBA_NORM)return"rgba8unorm";if(e===Pt.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===Pt.S8_R_NORM)return"r8snorm";if(e===Pt.S8_RG_NORM)return"rg8snorm";if(e===Pt.S8_RGBA_NORM)return"rgba8snorm";if(e===Pt.U32_R)return"r32uint";if(e===Pt.F16_RGBA)return"rgba16float";if(e===Pt.F32_RGBA)return"rgba32float";if(e===Pt.D24)return"depth24plus";if(e===Pt.D24_S8)return"depth24plus-stencil8";if(e===Pt.D32F)return"depth32float";if(e===Pt.D32F_S8)return"depth32float-stencil8";if(e===Pt.BC1)return"bc1-rgba-unorm";if(e===Pt.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===Pt.BC2)return"bc2-rgba-unorm";if(e===Pt.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===Pt.BC3)return"bc3-rgba-unorm";if(e===Pt.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===Pt.BC4_SNORM)return"bc4-r-snorm";if(e===Pt.BC4_UNORM)return"bc4-r-unorm";if(e===Pt.BC5_SNORM)return"bc5-rg-snorm";if(e===Pt.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function DD(e){if(e===Vi.TEXTURE_2D)return"2d";if(e===Vi.TEXTURE_CUBE_MAP)return"2d";if(e===Vi.TEXTURE_2D_ARRAY)return"2d";if(e===Vi.TEXTURE_3D)return"3d";throw new Error("whoops")}function LD(e){if(e===Vi.TEXTURE_2D)return"2d";if(e===Vi.TEXTURE_CUBE_MAP)return"cube";if(e===Vi.TEXTURE_2D_ARRAY)return"2d-array";if(e===Vi.TEXTURE_3D)return"3d";throw new Error("whoops")}function BD(e){var r=0;return e&Ja.INDEX&&(r|=GPUBufferUsage.INDEX),e&Ja.VERTEX&&(r|=GPUBufferUsage.VERTEX),e&Ja.UNIFORM&&(r|=GPUBufferUsage.UNIFORM),e&Ja.STORAGE&&(r|=GPUBufferUsage.STORAGE),e&Ja.COPY_SRC&&(r|=GPUBufferUsage.COPY_SRC),r|=GPUBufferUsage.COPY_DST,r}function X_(e){if(e===bl.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===bl.REPEAT)return"repeat";if(e===bl.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function K2(e){if(e===Xo.BILINEAR)return"linear";if(e===Xo.POINT)return"nearest";throw new Error("whoops")}function FD(e){if(e===js.LINEAR)return"linear";if(e===js.NEAREST)return"nearest";if(e===js.NO_MIP)return"nearest";throw new Error("whoops")}function Dv(e){var r=e;return r.gpuBuffer}function ND(e){var r=e;return r.gpuSampler}function UD(e){var r=e;return r.querySet}function zD(e){if(e===hg.OcclusionConservative)return"occlusion";throw new Error("whoops")}function ZD(e){switch(e){case _s.TRIANGLES:return"triangle-list";case _s.POINTS:return"point-list";case _s.TRIANGLE_STRIP:return"triangle-strip";case _s.LINES:return"line-list";case _s.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function VD(e){if(e===Zl.NONE)return"none";if(e===Zl.FRONT)return"front";if(e===Zl.BACK)return"back";throw new Error("whoops")}function jD(e){if(e===Vm.CCW)return"ccw";if(e===Vm.CW)return"cw";throw new Error("whoops")}function HD(e,r){return{topology:ZD(e),cullMode:VD(r.cullMode),frontFace:jD(r.frontFace)}}function Q2(e){if(e===Xi.ZERO)return"zero";if(e===Xi.ONE)return"one";if(e===Xi.SRC)return"src";if(e===Xi.ONE_MINUS_SRC)return"one-minus-src";if(e===Xi.DST)return"dst";if(e===Xi.ONE_MINUS_DST)return"one-minus-dst";if(e===Xi.SRC_ALPHA)return"src-alpha";if(e===Xi.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===Xi.DST_ALPHA)return"dst-alpha";if(e===Xi.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===Xi.CONST)return"constant";if(e===Xi.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===Xi.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function WD(e){if(e===ru.ADD)return"add";if(e===ru.SUBSTRACT)return"subtract";if(e===ru.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===ru.MIN)return"min";if(e===ru.MAX)return"max";throw new Error("whoops")}function J2(e){return{operation:WD(e.blendMode),srcFactor:Q2(e.blendSrcFactor),dstFactor:Q2(e.blendDstFactor)}}function eS(e){return e.blendMode===ru.ADD&&e.blendSrcFactor===Xi.ONE&&e.blendDstFactor===Xi.ZERO}function GD(e){if(!(eS(e.rgbBlendState)&&eS(e.alphaBlendState)))return{color:J2(e.rgbBlendState),alpha:J2(e.alphaBlendState)}}function XD(e,r){return{format:G_(r),blend:GD(e),writeMask:e.channelWriteMask}}function $D(e,r){return r.attachmentsState.map(function(t,n){return XD(t,e[n])})}function Tg(e){if(e===Bi.NEVER)return"never";if(e===Bi.LESS)return"less";if(e===Bi.EQUAL)return"equal";if(e===Bi.LEQUAL)return"less-equal";if(e===Bi.GREATER)return"greater";if(e===Bi.NOTEQUAL)return"not-equal";if(e===Bi.GEQUAL)return"greater-equal";if(e===Bi.ALWAYS)return"always";throw new Error("whoops")}function Lv(e){if(e===Uo.KEEP)return"keep";if(e===Uo.REPLACE)return"replace";if(e===Uo.ZERO)return"zero";if(e===Uo.DECREMENT_CLAMP)return"decrement-clamp";if(e===Uo.DECREMENT_WRAP)return"decrement-wrap";if(e===Uo.INCREMENT_CLAMP)return"increment-clamp";if(e===Uo.INCREMENT_WRAP)return"increment-wrap";if(e===Uo.INVERT)return"invert";throw new Error("whoops")}function YD(e,r){if(!kp(e))return{format:G_(e),depthWriteEnabled:!!r.depthWrite,depthCompare:Tg(r.depthCompare),depthBias:r.polygonOffset?1:0,depthBiasSlopeScale:r.polygonOffset?1:0,stencilFront:{compare:Tg(r.stencilFront.compare),passOp:Lv(r.stencilFront.passOp),failOp:Lv(r.stencilFront.failOp),depthFailOp:Lv(r.stencilFront.depthFailOp)},stencilBack:{compare:Tg(r.stencilBack.compare),passOp:Lv(r.stencilBack.passOp),failOp:Lv(r.stencilBack.failOp),depthFailOp:Lv(r.stencilBack.depthFailOp)},stencilReadMask:1,stencilWriteMask:1}}function qD(e){if(e!==null){if(e===Pt.U16_R)return"uint16";if(e===Pt.U32_R)return"uint32";throw new Error("whoops")}}function KD(e){if(e===wd.VERTEX)return"vertex";if(e===wd.INSTANCE)return"instance";throw new Error("whoops")}function QD(e){if(e===Pt.U8_R)return"uint8x2";if(e===Pt.U8_RG)return"uint8x2";if(e===Pt.U8_RGB)return"uint8x4";if(e===Pt.U8_RGBA)return"uint8x4";if(e===Pt.U8_RG_NORM)return"unorm8x2";if(e===Pt.U8_RGBA_NORM)return"unorm8x4";if(e===Pt.S8_RGB_NORM)return"snorm8x4";if(e===Pt.S8_RGBA_NORM)return"snorm8x4";if(e===Pt.U16_RG_NORM)return"unorm16x2";if(e===Pt.U16_RGBA_NORM)return"unorm16x4";if(e===Pt.S16_RG_NORM)return"snorm16x2";if(e===Pt.S16_RGBA_NORM)return"snorm16x4";if(e===Pt.S16_RG)return"uint16x2";if(e===Pt.F16_RG)return"float16x2";if(e===Pt.F16_RGBA)return"float16x4";if(e===Pt.F32_R)return"float32";if(e===Pt.F32_RG)return"float32x2";if(e===Pt.F32_RGB)return"float32x3";if(e===Pt.F32_RGBA)return"float32x4";throw"whoops"}function JD(e){var r=Qf(e);switch(r){case Rr.BC1:case Rr.BC2:case Rr.BC3:case Rr.BC4_SNORM:case Rr.BC4_UNORM:case Rr.BC5_SNORM:case Rr.BC5_UNORM:return!0;default:return!1}}function eL(e){var r=Qf(e);switch(r){case Rr.BC1:case Rr.BC2:case Rr.BC3:case Rr.BC4_SNORM:case Rr.BC4_UNORM:case Rr.BC5_SNORM:case Rr.BC5_UNORM:return 4;default:return 1}}function tS(e,r,t,n){switch(t===void 0&&(t=!1),e){case Pt.S8_R:case Pt.S8_R_NORM:case Pt.S8_RG_NORM:case Pt.S8_RGB_NORM:case Pt.S8_RGBA_NORM:{var i=r instanceof ArrayBuffer?new Int8Array(r):new Int8Array(r);return n&&i.set(new Int8Array(n)),i}case Pt.U8_R:case Pt.U8_R_NORM:case Pt.U8_RG:case Pt.U8_RG_NORM:case Pt.U8_RGB:case Pt.U8_RGB_NORM:case Pt.U8_RGB_SRGB:case Pt.U8_RGBA:case Pt.U8_RGBA_NORM:case Pt.U8_RGBA_SRGB:{var a=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&a.set(new Uint8Array(n)),a}case Pt.S16_R:case Pt.S16_RG:case Pt.S16_RG_NORM:case Pt.S16_RGB_NORM:case Pt.S16_RGBA:case Pt.S16_RGBA_NORM:{var s=r instanceof ArrayBuffer?new Int16Array(r):new Int16Array(t?r/2:r);return n&&s.set(new Int16Array(n)),s}case Pt.U16_R:case Pt.U16_RGB:case Pt.U16_RGBA_5551:case Pt.U16_RGBA_NORM:case Pt.U16_RG_NORM:case Pt.U16_R_NORM:{var l=r instanceof ArrayBuffer?new Uint16Array(r):new Uint16Array(t?r/2:r);return n&&l.set(new Uint16Array(n)),l}case Pt.S32_R:{var c=r instanceof ArrayBuffer?new Int32Array(r):new Int32Array(t?r/4:r);return n&&c.set(new Int32Array(n)),c}case Pt.U32_R:case Pt.U32_RG:{var p=r instanceof ArrayBuffer?new Uint32Array(r):new Uint32Array(t?r/4:r);return n&&p.set(new Uint32Array(n)),p}case Pt.F32_R:case Pt.F32_RG:case Pt.F32_RGB:case Pt.F32_RGBA:{var _=r instanceof ArrayBuffer?new Float32Array(r):new Float32Array(t?r/4:r);return n&&_.set(new Float32Array(n)),_}}var b=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&b.set(new Uint8Array(n)),b}function tL(e){var r=(e&32768)>>15,t=(e&31744)>>10,n=e&1023;return t===0?(r?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):t==31?n?NaN:(r?-1:1)*Infinity:(r?-1:1)*Math.pow(2,t-15)*(1+n/Math.pow(2,10))}var Jf=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a}return r.prototype.destroy=function(){},r}(T2),rL=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,c=e.call(this,{id:n,device:i})||this;c.type=ma.Bindings;var p=a.pipeline;ki(!!p);var _=a.uniformBufferBindings,b=a.storageBufferBindings,A=a.samplerBindings,w=a.storageTextureBindings;c.numUniformBuffers=(_==null?void 0:_.length)||0;var I=[[],[],[],[]],P=0;if(_&&_.length)for(var B=0;B<_.length;B++){var H=a.uniformBufferBindings[B],Q=H.binding,ue=H.size,Ee=H.offset,Le=H.buffer,Ze={buffer:Dv(Le),offset:Ee!=null?Ee:0,size:ue};I[0].push({binding:Q!=null?Q:P++,resource:Ze})}if(A&&A.length){P=0;for(var B=0;B<A.length;B++){var tt=(0,Mn.__assign)((0,Mn.__assign)({},A[B]),F2),Q=a.samplerBindings[B],ft=Q.texture!==null?Q.texture:c.device.getFallbackTexture(tt);tt.dimension=ft.dimension,tt.formatKind=I2(ft.format);var wt=ft.gpuTextureView;if(I[1].push({binding:(s=Q.textureBinding)!==null&&s!==void 0?s:P++,resource:wt}),Q.samplerBinding!==-1){var fr=Q.sampler!==null?Q.sampler:c.device.getFallbackSampler(tt),hr=ND(fr);I[1].push({binding:(l=Q.samplerBinding)!==null&&l!==void 0?l:P++,resource:hr})}}}if(b&&b.length){P=0;for(var B=0;B<b.length;B++){var Mr=a.storageBufferBindings[B],Q=Mr.binding,ue=Mr.size,Ee=Mr.offset,Le=Mr.buffer,Ze={buffer:Dv(Le),offset:Ee!=null?Ee:0,size:ue};I[2].push({binding:Q!=null?Q:P++,resource:Ze})}}if(w&&w.length){P=0;for(var B=0;B<w.length;B++){var ln=a.storageTextureBindings[B],Q=ln.binding,ft=ln.texture,wt=ft.gpuTextureView;I[3].push({binding:Q!=null?Q:P++,resource:wt})}}var Rn=I.findLastIndex(function(wi){return!!wi.length});return c.gpuBindGroup=I.map(function(wi,ba){return ba<=Rn&&c.device.device.createBindGroup({layout:p.getBindGroupLayout(ba),entries:wi})}),c}return r}(Jf),nL=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ma.Buffer;var l=a.usage,c=a.viewOrSize,p=!!(l&Ja.MAP_READ);s.usage=BD(l),p&&(s.usage=Ja.MAP_READ|Ja.COPY_DST);var _=!Sv(c);if(s.view=Sv(c)?null:c,s.size=Sv(c)?vg(c,4):vg(c.byteLength,4),Sv(c))s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:p?_:!1});else{s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:!0});var b=c&&c.constructor||Float32Array;new b(s.gpuBuffer.getMappedRange()).set(c),s.gpuBuffer.unmap()}return s}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=0);var s=this.gpuBuffer;a=a||n.byteLength,a=Math.min(a,this.size-t);var l=n.byteOffset+i,c=l+a,p=a+3&~3;if(p!==a){var _=new Uint8Array(n.buffer.slice(l,c));n=new Uint8Array(p),n.set(_),i=0,l=0,c=p,a=p}for(var b=1024*1024*15,A=0;c-(l+A)>b;)this.device.device.queue.writeBuffer(s,t+A,n.buffer,l+A,b),A+=b;this.device.device.queue.writeBuffer(s,t+A,n.buffer,l+A,a-A)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},r}(Jf),iL=function(){function e(){this.commandEncoder=null,this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(r,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(r,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(r,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(r.gpuBuffer,t)},e.prototype.finish=function(){return this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.commandEncoder.finish()},e.prototype.beginComputePass=function(){ki(this.gpuComputePassEncoder===null),this.gpuComputePassEncoder=this.commandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(r){var t=r,n=Cd(t.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(n)},e.prototype.setBindings=function(r){var t=this,n=r;n.gpuBindGroup.forEach(function(i,a){i&&t.gpuComputePassEncoder.setBindGroup(a,n.gpuBindGroup[a])})},e.prototype.pushDebugGroup=function(r){this.gpuComputePassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuComputePassEncoder.insertDebugMarker(r)},e}(),aL=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ma.ComputePipeline,s.gpuComputePipeline=null,s.descriptor=a;var l=a.program,c=l.computeStage;if(c===null)return s;var p={layout:"auto",compute:(0,Mn.__assign)({},c)};return s.gpuComputePipeline=s.device.device.createComputePipeline(p),s.name!==void 0&&(s.gpuComputePipeline.label=s.name),s}return r.prototype.getBindGroupLayout=function(t){return this.gpuComputePipeline.getBindGroupLayout(t)},r}(Jf),oL=function(e){(0,Mn.__extends)(r,e);function r(t){var n,i,a,s,l=t.id,c=t.device,p=t.descriptor,_=e.call(this,{id:l,device:c})||this;_.type=ma.InputLayout;var b=[];try{for(var A=(0,Mn.__values)(p.vertexBufferDescriptors),w=A.next();!w.done;w=A.next()){var I=w.value,P=I.arrayStride,B=I.stepMode,H=I.attributes;b.push({arrayStride:P,stepMode:KD(B),attributes:[]});try{for(var Q=(a=void 0,(0,Mn.__values)(H)),ue=Q.next();!ue.done;ue=Q.next()){var Ee=ue.value,Le=Ee.shaderLocation,Ze=Ee.format,tt=Ee.offset;b[b.length-1].attributes.push({shaderLocation:Le,format:QD(Ze),offset:tt})}}catch(ft){a={error:ft}}finally{try{ue&&!ue.done&&(s=Q.return)&&s.call(Q)}finally{if(a)throw a.error}}}}catch(ft){n={error:ft}}finally{try{w&&!w.done&&(i=A.return)&&i.call(A)}finally{if(n)throw n.error}}return _.indexFormat=qD(p.indexBufferFormat),_.buffers=b,_}return r}(Jf),rS=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ma.Program,s.vertexStage=null,s.fragmentStage=null,s.computeStage=null,s.descriptor=a,a.vertex&&(s.vertexStage=s.createShaderStage(a.vertex,"vertex")),a.fragment&&(s.fragmentStage=s.createShaderStage(a.fragment,"fragment")),a.compute&&(s.computeStage=s.createShaderStage(a.compute,"compute")),s}return r.prototype.setUniformsLegacy=function(t){},r.prototype.createShaderStage=function(t,n){var i,a,s=t.glsl,l=t.wgsl,c=t.entryPoint,p=!1,_=l;if(!_)try{_=this.device.glsl_compile(s,n,p)}catch(B){throw console.error(B,s),new Error("whoops")}var b=function(B){if(!_.includes(B))return"continue";_=_.replace("var T_".concat(B,": texture_2d<f32>;"),"var T_".concat(B,": texture_depth_2d;")),_=_.replace(new RegExp("textureSample\\(T_".concat(B,"(.*)\\);$"),"gm"),function(H,Q){return"vec4<f32>(textureSample(T_".concat(B).concat(Q,"), 0.0, 0.0, 0.0);")})};try{for(var A=(0,Mn.__values)(["u_TextureFramebufferDepth"]),w=A.next();!w.done;w=A.next()){var I=w.value;b(I)}}catch(B){i={error:B}}finally{try{w&&!w.done&&(a=A.return)&&a.call(A)}finally{if(i)throw i.error}}var P=this.device.device.createShaderModule({code:_});return{module:P,entryPoint:c||"main"}},r}(Jf),sL=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ma.QueryPool;var l=a.elemCount,c=a.type;return s.querySet=s.device.device.createQuerySet({type:zD(c),count:l}),s.resolveBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),s.cpuBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),s.results=null,s}return r.prototype.queryResultOcclusion=function(t){return this.results===null?null:this.results[t]!==BigInt(0)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},r}(Jf),uL=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=ma.Readback,a}return r.prototype.readTexture=function(t,n,i,a,s,l,c,p){return c===void 0&&(c=0),(0,Mn.__awaiter)(this,void 0,void 0,function(){var _,b,A,w,I,P,B,H;return(0,Mn.__generator)(this,function(Q){return _=t,b=0,A=this.getBlockInformationFromFormat(_.gpuTextureformat),w=Math.ceil(a/A.width)*A.length,I=Math.ceil(w/256)*256,P=I*s,B=this.device.createBuffer({usage:Ja.STORAGE|Ja.MAP_READ|Ja.COPY_DST,hint:vf.STATIC,viewOrSize:P}),H=this.device.device.createCommandEncoder(),H.copyTextureToBuffer({texture:_.gpuTexture,mipLevel:0,origin:{x:n,y:i,z:Math.max(b,0)}},{buffer:B.gpuBuffer,offset:0,bytesPerRow:I},{width:a,height:s,depthOrArrayLayers:1}),this.device.device.queue.submit([H.finish()]),[2,this.readBuffer(B,0,l.byteLength===P?l:null,c,P,_.format)]})})},r.prototype.readTextureSync=function(t,n,i,a,s,l,c,p){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},r.prototype.readBuffer=function(t,n,i,a,s,l,c,p){var _=this;n===void 0&&(n=0),i===void 0&&(i=null),s===void 0&&(s=0),l===void 0&&(l=Pt.U8_RGB),c===void 0&&(c=!1);var b=t,A=s||b.size,w=i||b.view,I=w&&w.constructor&&w.constructor.BYTES_PER_ELEMENT||M2(l),P=b;if(!(b.usage&Ja.MAP_READ&&b.usage&Ja.COPY_DST)){var B=this.device.device.createCommandEncoder();P=this.device.createBuffer({usage:Ja.STORAGE|Ja.MAP_READ|Ja.COPY_DST,hint:vf.STATIC,viewOrSize:A}),B.copyBufferToBuffer(b.gpuBuffer,n,P.gpuBuffer,0,A),this.device.device.queue.submit([B.finish()])}return new Promise(function(H,Q){P.gpuBuffer.mapAsync(W_.READ,n,A).then(function(){var ue=P.gpuBuffer.getMappedRange(n,A),Ee=w;if(c)Ee===null?Ee=tS(l,A,!0,ue):Ee=tS(l,Ee.buffer,void 0,ue);else if(Ee===null)switch(I){case 1:Ee=new Uint8Array(A),Ee.set(new Uint8Array(ue));break;case 2:Ee=_.getHalfFloatAsFloatRGBAArrayBuffer(A/2,ue);break;case 4:Ee=new Float32Array(A/4),Ee.set(new Float32Array(ue));break}else switch(I){case 1:Ee=new Uint8Array(Ee.buffer),Ee.set(new Uint8Array(ue));break;case 2:Ee=_.getHalfFloatAsFloatRGBAArrayBuffer(A/2,ue,w);break;case 4:var Le=w&&w.constructor||Float32Array;Ee=new Le(Ee.buffer),Ee.set(new Le(ue));break}P.gpuBuffer.unmap(),H(Ee)},function(ue){return Q(ue)})})},r.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(t,n,i){i||(i=new Float32Array(t));for(var a=new Uint16Array(n);t--;)i[t]=tL(a[t]);return i},r.prototype.getBlockInformationFromFormat=function(t){switch(t){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}},r}(Jf),lL=function(){function e(r){this.device=r,this.commandEncoder=null,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getTextureView=function(r,t){return ki(t<r.mipLevelCount),r.mipLevelCount===1?r.gpuTextureView:r.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(r){var t,n,i,a,s,l;this.descriptor=r,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var c=r.colorAttachment.length;this.gfxColorAttachment.length=c,this.gfxColorResolveTo.length=c;for(var p=0;p<r.colorAttachment.length;p++){var _=r.colorAttachment[p],b=r.colorResolveTo[p];if(_===null&&b!==null&&(_=b,b=null),this.gfxColorAttachment[p]=_,this.gfxColorResolveTo[p]=b,this.gfxColorAttachmentLevel[p]=((t=r.colorAttachmentLevel)===null||t===void 0?void 0:t[p])||0,this.gfxColorResolveToLevel[p]=((n=r.colorResolveToLevel)===null||n===void 0?void 0:n[p])||0,_!==null){this.gpuColorAttachments[p]===void 0&&(this.gpuColorAttachments[p]={});var A=this.gpuColorAttachments[p];A.view=this.getTextureView(_,((i=this.gfxColorAttachmentLevel)===null||i===void 0?void 0:i[p])||0);var w=(s=(a=r.colorClearColor)===null||a===void 0?void 0:a[p])!==null&&s!==void 0?s:"load";w==="load"?A.loadOp="load":(A.loadOp="clear",A.clearValue=w),A.storeOp=((l=r.colorStore)===null||l===void 0?void 0:l[p])?"store":"discard",A.resolveTarget=void 0,b!==null&&(_.sampleCount>1?A.resolveTarget=this.getTextureView(b,this.gfxColorResolveToLevel[p]):A.storeOp="store")}else{this.gpuColorAttachments.length=p,this.gfxColorAttachment.length=p,this.gfxColorResolveTo.length=p;break}}if(this.gfxDepthStencilAttachment=r.depthStencilAttachment,this.gfxDepthStencilResolveTo=r.depthStencilResolveTo,r.depthStencilAttachment){var I=r.depthStencilAttachment,A=this.gpuDepthStencilAttachment;A.view=I.gpuTextureView;var P=!!(wv(I.format)&Cn.Depth);P?(r.depthClearValue==="load"?A.depthLoadOp="load":(A.depthLoadOp="clear",A.depthClearValue=r.depthClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.depthStoreOp="store":A.depthStoreOp="discard"):(A.depthLoadOp=void 0,A.depthStoreOp=void 0);var B=!!(wv(I.format)&Cn.Stencil);B?(r.stencilClearValue==="load"?A.stencilLoadOp="load":(A.stencilLoadOp="clear",A.stencilClearValue=r.stencilClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.stencilStoreOp="store":A.stencilStoreOp="discard"):(A.stencilLoadOp=void 0,A.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=kp(r.occlusionQueryPool)?void 0:UD(r.occlusionQueryPool)},e.prototype.beginRenderPass=function(r){ki(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(r),this.gpuRenderPassEncoder=this.commandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(r,t){var n=this.device.swapChainHeight;return n-r-t},e.prototype.setViewport=function(r,t,n,i,a,s){a===void 0&&(a=0),s===void 0&&(s=1),this.gpuRenderPassEncoder.setViewport(r,this.flipY(t,i),n,i,a,s)},e.prototype.setScissorRect=function(r,t,n,i){this.gpuRenderPassEncoder.setScissorRect(r,this.flipY(t,i),n,i)},e.prototype.setPipeline=function(r){var t=r,n=Cd(t.gpuRenderPipeline);this.gpuRenderPassEncoder.setPipeline(n)},e.prototype.setVertexInput=function(r,t,n){if(r!==null){var i=r;n!==null&&this.gpuRenderPassEncoder.setIndexBuffer(Dv(n.buffer),Cd(i.indexFormat),n.offset);for(var a=0;a<t.length;a++){var s=t[a];s!==null&&this.gpuRenderPassEncoder.setVertexBuffer(a,Dv(s.buffer),s.offset)}}},e.prototype.setBindings=function(r){var t=this,n=r;n.gpuBindGroup.forEach(function(i,a){i&&t.gpuRenderPassEncoder.setBindGroup(a,n.gpuBindGroup[a])})},e.prototype.setStencilReference=function(r){this.gpuRenderPassEncoder.setStencilReference(r)},e.prototype.draw=function(r,t,n,i){this.gpuRenderPassEncoder.draw(r,t,n,i)},e.prototype.drawIndexed=function(r,t,n,i,a){this.gpuRenderPassEncoder.drawIndexed(r,t,n,i,a)},e.prototype.drawIndirect=function(r,t){this.gpuRenderPassEncoder.drawIndirect(Dv(r),t)},e.prototype.drawIndexedIndirect=function(r,t){this.gpuRenderPassEncoder.drawIndexedIndirect(Dv(r),t)},e.prototype.beginOcclusionQuery=function(r){this.gpuRenderPassEncoder.beginOcclusionQuery(r)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(r){this.gpuRenderPassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuRenderPassEncoder.insertDebugMarker(r)},e.prototype.finish=function(){this.gpuRenderPassEncoder.end(),this.gpuRenderPassEncoder=null;for(var r=0;r<this.gfxColorAttachment.length;r++){var t=this.gfxColorAttachment[r],n=this.gfxColorResolveTo[r];t!==null&&n!==null&&t.sampleCount===1&&this.copyAttachment(n,this.gfxColorAttachmentLevel[r],t,this.gfxColorResolveToLevel[r])}return this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.commandEncoder.finish()},e.prototype.copyAttachment=function(r,t,n,i){ki(n.sampleCount===1);var a={texture:n.gpuTexture,mipLevel:i},s={texture:r.gpuTexture,mipLevel:t};ki(n.width>>>i==r.width>>>t),ki(n.height>>>i==r.height>>>t),ki(!!(n.usage&Hs.COPY_SRC)),ki(!!(r.usage&Hs.COPY_DST)),this.commandEncoder.copyTextureToTexture(a,s,[r.width,r.height,1])},e}(),cL=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ma.RenderPipeline,s.isCreatingAsync=!1,s.gpuRenderPipeline=null,s.descriptor=a,s.device.createRenderPipelineInternal(s,!1),s}return r.prototype.getBindGroupLayout=function(t){return this.gpuRenderPipeline.getBindGroupLayout(t)},r}(Jf),fL=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,c=e.call(this,{id:n,device:i})||this;c.type=ma.Sampler;var p=a.lodMinClamp,_=a.mipmapFilter===js.NO_MIP?a.lodMinClamp:a.lodMaxClamp,b=(s=a.maxAnisotropy)!==null&&s!==void 0?s:1;return b>1&&ki(a.minFilter===Xo.BILINEAR&&a.magFilter===Xo.BILINEAR&&a.mipmapFilter===js.LINEAR),c.gpuSampler=c.device.device.createSampler({addressModeU:X_(a.addressModeU),addressModeV:X_(a.addressModeV),addressModeW:X_((l=a.addressModeW)!==null&&l!==void 0?l:a.addressModeU),lodMinClamp:p,lodMaxClamp:_,minFilter:K2(a.minFilter),magFilter:K2(a.magFilter),mipmapFilter:FD(a.mipmapFilter),compare:a.compareFunction!==void 0?Tg(a.compareFunction):void 0,maxAnisotropy:b}),c}return r}(Jf),wg=function(e){(0,Mn.__extends)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=t.skipCreate,l=t.sampleCount,c=e.call(this,{id:n,device:i})||this;c.type=ma.Texture,c.flipY=!1;var p=a.format,_=a.dimension,b=a.width,A=a.height,w=a.depthOrArrayLayers,I=a.mipLevelCount,P=a.usage,B=a.pixelStore;return c.flipY=!!(B==null?void 0:B.unpackFlipY),c.device.createTextureShared({format:p,dimension:_!=null?_:Vi.TEXTURE_2D,width:b,height:A,depthOrArrayLayers:w!=null?w:1,mipLevelCount:I!=null?I:1,usage:P,sampleCount:l!=null?l:1},c,s),c}return r.prototype.textureFromImageBitmapOrCanvas=function(t,n,i){for(var a=n[0].width,s=n[0].height,l={size:{width:a,height:s,depthOrArrayLayers:i},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},c=t.createTexture(l),p=0;p<n.length;p++)t.queue.copyExternalImageToTexture({source:n[p],flipY:this.flipY},{texture:c,origin:[0,0,p]},[a,s]);return[c,a,s]},r.prototype.isImageBitmapOrCanvases=function(t){var n=t[0];return n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas},r.prototype.isVideo=function(t){var n=t[0];return n instanceof HTMLVideoElement},r.prototype.setImageData=function(t,n){var i,a=this,s=this.device.device,l,c,p;this.isImageBitmapOrCanvases(t)?(i=(0,Mn.__read)(this.textureFromImageBitmapOrCanvas(s,t,this.depthOrArrayLayers),3),l=i[0],c=i[1],p=i[2]):this.isVideo(t)?l=s.importExternalTexture({source:t[0]}):t.forEach(function(_){s.queue.writeTexture({texture:a.gpuTexture},_,{},{width:a.width,height:a.height})}),this.width=c,this.height=p,this.gpuTexture=l,this.gpuTextureView=l.createView({dimension:LD(this.dimension)})},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},r}(Jf),hL=function(){function e(r,t,n,i,a,s){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=Hs.RENDER_ATTACHMENT|Hs.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=Av.UPPER_LEFT,this.clipSpaceNearZ=Tv.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=i,this.glsl_compile=a,this.WGSLComposer=s,this.fallbackTexture2D=this.createFallbackTexture(Vi.TEXTURE_2D,zo.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Vi.TEXTURE_2D,zo.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Vi.TEXTURE_2D_ARRAY,zo.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Vi.TEXTURE_3D,zo.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Vi.TEXTURE_CUBE_MAP,zo.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:bl.REPEAT,addressModeV:bl.REPEAT,minFilter:Xo.POINT,magFilter:Xo.POINT,mipmapFilter:js.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:bl.REPEAT,addressModeV:bl.REPEAT,minFilter:Xo.POINT,magFilter:Xo.POINT,mipmapFilter:js.NEAREST,compareFunction:Bi.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(l){console.error(l.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(r,t){this.swapChainWidth===r&&this.swapChainHeight===t||(this.swapChainWidth=r,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var r=this.canvasContext.getCurrentTexture(),t=r.createView(),n=new wg({id:0,device:this,descriptor:{format:Pt.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Vi.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=r,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(r){return new nL({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new wg({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new fL({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){var t=new wg({id:this.getNextUniqueId(),device:this,descriptor:(0,Mn.__assign)((0,Mn.__assign)({},r),{dimension:Vi.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:Ou.RENDER_TARGET}),sampleCount:r.sampleCount});return t.depthOrArrayLayers=1,t.type=ma.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,s=t.depthOrArrayLayers,l=t.sampleCount,c=t.mipLevelCount,p=t.gpuTexture,_=t.gpuTextureView,b=t.usage;ki(!!(b&Hs.RENDER_ATTACHMENT));var A=new wg({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:i,height:a,depthOrArrayLayers:s,dimension:Vi.TEXTURE_2D,mipLevelCount:c,usage:b},skipCreate:!0});return A.depthOrArrayLayers=s,A.sampleCount=l,A.gpuTexture=p,A.gpuTextureView=_,A},e.prototype.createProgram=function(r){var t,n;return((t=r.vertex)===null||t===void 0?void 0:t.glsl)&&(r.vertex.glsl=Lp(this.queryVendorInfo(),"vert",r.vertex.glsl)),((n=r.fragment)===null||n===void 0?void 0:n.glsl)&&(r.fragment.glsl=Lp(this.queryVendorInfo(),"frag",r.fragment.glsl)),new rS({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createProgramSimple=function(r){return new rS({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTextureShared=function(r,t,n){var i={width:r.width,height:r.height,depthOrArrayLayers:r.depthOrArrayLayers},a=r.mipLevelCount,s=G_(r.format),l=DD(r.dimension),c=kD(r.usage);if(t.gpuTextureformat=s,t.dimension=r.dimension,t.format=r.format,t.width=r.width,t.height=r.height,t.depthOrArrayLayers=r.depthOrArrayLayers,t.mipLevelCount=a,t.usage=c,t.sampleCount=r.sampleCount,!n){var p=this.device.createTexture({size:i,mipLevelCount:a,format:s,dimension:l,sampleCount:r.sampleCount,usage:c}),_=p.createView();t.gpuTexture=p,t.gpuTextureView=_}},e.prototype.getFallbackSampler=function(r){var t=r.formatKind;return t===zo.Depth&&r.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(r){var t=r.dimension,n=r.formatKind;if(t===Vi.TEXTURE_2D)return n===zo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Vi.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Vi.TEXTURE_3D)return this.fallbackTexture3D;if(t===Vi.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(r,t){var n=r===Vi.TEXTURE_CUBE_MAP?6:1,i=t===zo.Float?Pt.U8_RGBA_NORM:Pt.D24;return this.createTexture({dimension:r,format:i,usage:Ou.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(r){return new rL({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new oL({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePipeline=function(r){return new aL({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new cL({id:this.getNextUniqueId(),device:this,descriptor:(0,Mn.__assign)({},r)})},e.prototype.createQueryPool=function(r,t){return new sL({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(r,t){var n;if(r.gpuRenderPipeline===null){var i=r.descriptor,a=i.program,s=a.vertexStage,l=a.fragmentStage;if(!(s===null||l===null)){var c=i.megaStateDescriptor||{},p=c.stencilBack,_=c.stencilFront,b=(0,Mn.__rest)(c,["stencilBack","stencilFront"]),A=Mv(Rd);i.megaStateDescriptor=(0,Mn.__assign)((0,Mn.__assign)((0,Mn.__assign)({},A),{stencilBack:(0,Mn.__assign)((0,Mn.__assign)({},A.stencilBack),p),stencilFront:(0,Mn.__assign)((0,Mn.__assign)({},A.stencilFront),_)}),b);var w=i.megaStateDescriptor.attachmentsState[0];i.colorAttachmentFormats.forEach(function(Ee,Le){i.megaStateDescriptor.attachmentsState[Le]||(i.megaStateDescriptor.attachmentsState[Le]=L2(void 0,w))});var I=HD((n=i.topology)!==null&&n!==void 0?n:_s.TRIANGLES,i.megaStateDescriptor),P=$D(i.colorAttachmentFormats,i.megaStateDescriptor),B=YD(i.depthStencilAttachmentFormat,i.megaStateDescriptor),H=void 0;i.inputLayout!==null&&(H=i.inputLayout.buffers);var Q=i.sampleCount,ue={layout:"auto",vertex:(0,Mn.__assign)((0,Mn.__assign)({},s),{buffers:H}),primitive:I,depthStencil:B,multisample:{count:Q},fragment:(0,Mn.__assign)((0,Mn.__assign)({},l),{targets:P})};r.gpuRenderPipeline=this.device.createRenderPipeline(ue)}}},e.prototype.createReadback=function(){return new uL({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(r){var t=this.renderPassPool.pop();return t===void 0&&(t=new lL(this)),t.commandEncoder=this.device.createCommandEncoder(),t.beginRenderPass(r),t},e.prototype.createComputePass=function(){var r=this.computePassPool.pop();return r===void 0&&(r=new iL),r.commandEncoder=this.device.createCommandEncoder(),r.beginComputePass(),r},e.prototype.submitPass=function(r){var t=this.device.queue,n=r,i=n.finish();t.submit([i]),n.commandEncoder=null},e.prototype.copySubTexture2D=function(r,t,n,i,a,s,l){var c=this.device.createCommandEncoder(),p=r,_=i,b={texture:_.gpuTexture,origin:[a,s,0],mipLevel:0,aspect:"all"},A={texture:p.gpuTexture,origin:[t,n,0],mipLevel:0,aspect:"all"};ki(!!(_.usage&Hs.COPY_SRC)),ki(!!(p.usage&Hs.COPY_DST)),c.copyTextureToTexture(b,A,[_.width,_.height,l||1]),this.device.queue.submit([c.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(r,t,n){if(JD(r)){if(!this.featureTextureCompressionBC)return!1;var i=eL(r);return t%i!=0||n%i!=0?!1:this.featureTextureCompressionBC}switch(r){case Pt.U16_RGBA_NORM:return!1;case Pt.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){var t=r;return t.descriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===ma.Buffer){var n=r;n.gpuBuffer.label=t}else if(r.type===ma.Texture){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===ma.RenderTarget){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===ma.Sampler){var n=r;n.gpuSampler.label=t}else if(r.type===ma.RenderPipeline){var n=r;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(r,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(r){},e.prototype.pipelineQueryReady=function(r){var t=r;return t.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(r){var t=r;this.createRenderPipelineInternal(t,!1)},e}(),pL=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return(0,Mn.__awaiter)(this,void 0,void 0,function(){var t,n,i,a,s,l,c,p;return(0,Mn.__generator)(this,function(_){switch(_.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];t=null,_.label=1;case 1:return _.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=_.sent(),[3,4];case 3:return i=_.sent(),console.log(i),[3,4];case 4:return t===null?[2,null]:(a=["depth32float-stencil8","texture-compression-bc"],s=a.filter(function(b){return t.features.has(b)}),[4,t.requestDevice({requiredFeatures:s})]);case 5:if(l=_.sent(),l&&(c=this.pluginOptions.onContextLost,l.lost.then(function(){c&&c()})),l===null)return[2,null];if(p=r.getContext("webgpu"),!p)return[2,null];_.label=6;case 6:return _.trys.push([6,8,,9]),[4,q2(this.pluginOptions.shaderCompilerPath)];case 7:return _.sent(),[3,9];case 8:return _.sent(),[3,9];case 9:return[2,new hL(t,l,r,p,MD,Km&&new Km)]}})})},e}(),dL=vi.isPlainObject,vL=vi.isTypedArray,mL=function(){function e(r,t){(0,ge.Z)(this,e),(0,N.Z)(this,"destroyed",!1),(0,N.Z)(this,"uniforms",{}),this.reGl=r;var n=t.vs,i=t.fs,a=t.attributes,s=t.uniforms,l=t.primitive,c=t.count,p=t.elements,_=t.depth,b=t.cull,A=t.instances,w={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:Av.LOWER_LEFT,clipSpaceNearZ:Tv.NEGATIVE_ONE,supportMRT:!1},I={};this.options=t,s&&(this.uniforms=this.extractUniforms(s),Object.keys(s).forEach(function(ue){I[ue]=r.prop(ue)}));var P={};Object.keys(a).forEach(function(ue){P[ue]=a[ue].get()});var B=Wy(Lp(w,"frag",i,null,!1)),H=Wy(Lp(w,"vert",n,null,!1)),Q={attributes:P,frag:B,uniforms:I,vert:H,colorMask:r.prop("colorMask"),lineWidth:1,blend:{enable:r.prop("blend.enable"),func:r.prop("blend.func"),equation:r.prop("blend.equation"),color:r.prop("blend.color")},stencil:{enable:r.prop("stencil.enable"),mask:r.prop("stencil.mask"),func:r.prop("stencil.func"),opFront:r.prop("stencil.opFront"),opBack:r.prop("stencil.opBack")},primitive:ak[l===void 0?Y.TRIANGLES:l]};A&&(Q.instances=A),c?Q.count=c:p&&(Q.elements=p.get()),this.initDepthDrawParams({depth:_},Q),this.initCullDrawParams({cull:b},Q),this.drawCommand=r(Q),this.drawParams=Q}return(0,K.Z)(e,[{key:"updateAttributesAndElements",value:function(t,n){var i={};Object.keys(t).forEach(function(a){i[a]=t[a].get()}),this.drawParams.attributes=i,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(t){var n={};Object.keys(t).forEach(function(i){n[i]=t[i].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(t){this.uniforms=(0,k.Z)((0,k.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=(0,k.Z)((0,k.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),a={};Object.keys(i).forEach(function(s){var l=(0,Fs.Z)(i[s]);l==="boolean"||l==="number"||Array.isArray(i[s])||i[s].BYTES_PER_ELEMENT?a[s]=i[s]:a[s]=i[s].get()}),a.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),a.stencil=this.getStencilDrawParams(t),a.colorMask=this.getColorMaskDrawParams(t,n),this.drawCommand(a)}}},{key:"destroy",value:function(){var t;(t=this.drawParams)===null||t===void 0||(t=t.elements)===null||t===void 0||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(n){n==null||n.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var i=t.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:lk[i.func||Y.LESS],range:i.range||[0,1]})}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,c=i.color,p=c===void 0?[0,0,0,0]:c;return{enable:!!a,func:{srcRGB:fg[s&&s.srcRGB||Y.SRC_ALPHA],srcAlpha:fg[s&&s.srcAlpha||Y.SRC_ALPHA],dstRGB:fg[s&&s.dstRGB||Y.ONE_MINUS_SRC_ALPHA],dstAlpha:fg[s&&s.dstAlpha||Y.ONE_MINUS_SRC_ALPHA]},equation:{rgb:A2[l&&l.rgb||Y.FUNC_ADD],alpha:A2[l&&l.alpha||Y.FUNC_ADD]},color:p}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,i=n||{},a=i.enable,s=i.mask,l=s===void 0?-1:s,c=i.func,p=c===void 0?{cmp:Y.ALWAYS,ref:0,mask:-1}:c,_=i.opFront,b=_===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:_,A=i.opBack,w=A===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:A;return{enable:!!a,mask:l,func:(0,k.Z)((0,k.Z)({},p),{},{cmp:ck[p.cmp]}),opFront:{fail:Ev[b.fail],zfail:Ev[b.zfail],zpass:Ev[b.zpass]},opBack:{fail:Ev[w.fail],zfail:Ev[w.zfail],zpass:Ev[w.zpass]}}}},{key:"getColorMaskDrawParams",value:function(t,n){var i=t.stencil,a=i!=null&&i.enable&&i.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return a}},{key:"initCullDrawParams",value:function(t,n){var i=t.cull;if(i){var a=i.enable,s=i.face,l=s===void 0?Y.BACK:s;n.cull={enable:!!a,face:fk[l]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||vL(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}dL(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,c){Object.keys(l).forEach(function(p){s.extractUniformsRecursively(p,l[p],i,"".concat(a&&a+".").concat(t,"[").concat(c,"]"))})})}}]),e}(),gL=function(){function e(r,t){(0,ge.Z)(this,e),(0,N.Z)(this,"isDestroy",!1);var n=t.data,i=t.type,a=i===void 0?Y.UNSIGNED_BYTE:i,s=t.width,l=t.height,c=t.flipY,p=c===void 0?!1:c,_=t.format,b=_===void 0?Y.RGBA:_,A=t.mipmap,w=A===void 0?!1:A,I=t.wrapS,P=I===void 0?Y.CLAMP_TO_EDGE:I,B=t.wrapT,H=B===void 0?Y.CLAMP_TO_EDGE:B,Q=t.aniso,ue=Q===void 0?0:Q,Ee=t.alignment,Le=Ee===void 0?1:Ee,Ze=t.premultiplyAlpha,tt=Ze===void 0?!1:Ze,ft=t.mag,wt=ft===void 0?Y.NEAREST:ft,fr=t.min,hr=fr===void 0?Y.NEAREST:fr,Mr=t.colorSpace,ln=Mr===void 0?Y.BROWSER_DEFAULT_WEBGL:Mr,Rn=t.x,wi=Rn===void 0?0:Rn,ba=t.y,Va=ba===void 0?0:ba,io=t.copy,as=io===void 0?!1:io;this.width=s,this.height=l;var Sl={width:s,height:l,type:F_[a],format:ok[b],wrapS:S2[P],wrapT:S2[H],mag:E2[wt],min:E2[hr],alignment:Le,flipY:p,colorSpace:uk[ln],premultiplyAlpha:tt,aniso:ue,x:wi,y:Va,copy:as};n&&(Sl.data=n),typeof w=="number"?Sl.mipmap=sk[w]:typeof w=="boolean"&&(Sl.mipmap=w),this.texture=r.texture(Sl)}return(0,K.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),nS,iS,_L=(nS=(0,Jt.b2)(),nS(iS=function(){function e(){var r=this;(0,ge.Z)(this,e),(0,N.Z)(this,"uniformBuffers",[]),(0,N.Z)(this,"createModel",function(t){return new mL(r.gl,t)}),(0,N.Z)(this,"createAttribute",function(t){return new ik(r.gl,t)}),(0,N.Z)(this,"createBuffer",function(t){return new hk(r.gl,t)}),(0,N.Z)(this,"createElements",function(t){return new pk(r.gl,t)}),(0,N.Z)(this,"createTexture2D",function(t){return new gL(r.gl,t)}),(0,N.Z)(this,"createFramebuffer",function(t){return new dk(r.gl,t)}),(0,N.Z)(this,"useFramebuffer",function(t,n){r.gl({framebuffer:t?t.get():null})(n)}),(0,N.Z)(this,"clear",function(t){var n,i=t.color,a=t.depth,s=t.stencil,l=t.framebuffer,c=l===void 0?null:l,p={color:i,depth:a,stencil:s};p.framebuffer=c===null?c:c.get(),(n=r.gl)===null||n===void 0||n.clear(p)}),(0,N.Z)(this,"viewport",function(t){var n=t.x,i=t.y,a=t.width,s=t.height;r.gl._gl.viewport(n,i,a,s),r.width=a,r.height=s,r.gl._refresh()}),(0,N.Z)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,s=t.width,l=t.height,c={x:i,y:a,width:s,height:l};return n&&(c.framebuffer=n.get()),r.gl.read(c)}),(0,N.Z)(this,"getViewportSize",function(){return{width:r.gl._gl.drawingBufferWidth,height:r.gl._gl.drawingBufferHeight}}),(0,N.Z)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),(0,N.Z)(this,"getCanvas",function(){return r.canvas}),(0,N.Z)(this,"getGLContext",function(){return r.gl._gl}),(0,N.Z)(this,"destroy",function(){var t;r.canvas=null,(t=r.gl)===null||t===void 0||(t=t._gl)===null||t===void 0||(t=t.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),r.gl.destroy(),r.gl=null})}return(0,K.Z)(e,[{key:"init",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i,a,s){var l=this;return xe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.canvas=i,!s){p.next=5;break}this.gl=s,p.next=8;break;case 5:return p.next=7,new Promise(function(_,b){nk()({canvas:l.canvas,attributes:{alpha:!0,antialias:a.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:a.preserveDrawingBuffer,stencil:a.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(w,I){(w||!I)&&b(w),_(I)}})});case 7:this.gl=p.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return p.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}())||iS),yL=function(){function e(r,t){(0,ge.Z)(this,e);var n=t.buffer,i=t.offset,a=t.stride,s=t.normalized,l=t.size,c=t.divisor,p=t.shaderLocation;this.buffer=n,this.attribute={shaderLocation:p,buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:c||0},l&&(this.attribute.size=l)}return(0,K.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Fp,Zh,Bv,Qm,Jm,eh,Cg,Md,ku,th,rh,Rg=(Fp={},(0,N.Z)(Fp,Y.FLOAT,Float32Array),(0,N.Z)(Fp,Y.UNSIGNED_BYTE,Uint8Array),(0,N.Z)(Fp,Y.SHORT,Int16Array),(0,N.Z)(Fp,Y.UNSIGNED_SHORT,Uint16Array),(0,N.Z)(Fp,Y.INT,Int32Array),(0,N.Z)(Fp,Y.UNSIGNED_INT,Uint32Array),Fp),xL=(Zh={},(0,N.Z)(Zh,Y.POINTS,_s.POINTS),(0,N.Z)(Zh,Y.LINES,_s.LINES),(0,N.Z)(Zh,Y.LINE_LOOP,_s.LINES),(0,N.Z)(Zh,Y.LINE_STRIP,_s.LINE_STRIP),(0,N.Z)(Zh,Y.TRIANGLES,_s.TRIANGLES),(0,N.Z)(Zh,Y.TRIANGLE_FAN,_s.TRIANGLES),(0,N.Z)(Zh,Y.TRIANGLE_STRIP,_s.TRIANGLE_STRIP),Zh),bL=(Bv={},(0,N.Z)(Bv,1,Pt.F32_R),(0,N.Z)(Bv,2,Pt.F32_RG),(0,N.Z)(Bv,3,Pt.F32_RGB),(0,N.Z)(Bv,4,Pt.F32_RGBA),Bv),EL=(Qm={},(0,N.Z)(Qm,Y.STATIC_DRAW,vf.STATIC),(0,N.Z)(Qm,Y.DYNAMIC_DRAW,vf.DYNAMIC),(0,N.Z)(Qm,Y.STREAM_DRAW,vf.DYNAMIC),Qm),aS=(Jm={},(0,N.Z)(Jm,Y.REPEAT,bl.REPEAT),(0,N.Z)(Jm,Y.CLAMP_TO_EDGE,bl.CLAMP_TO_EDGE),(0,N.Z)(Jm,Y.MIRRORED_REPEAT,bl.MIRRORED_REPEAT),Jm),SL=(eh={},(0,N.Z)(eh,Y.NEVER,Bi.NEVER),(0,N.Z)(eh,Y.ALWAYS,Bi.ALWAYS),(0,N.Z)(eh,Y.LESS,Bi.LESS),(0,N.Z)(eh,Y.LEQUAL,Bi.LEQUAL),(0,N.Z)(eh,Y.GREATER,Bi.GREATER),(0,N.Z)(eh,Y.GEQUAL,Bi.GEQUAL),(0,N.Z)(eh,Y.EQUAL,Bi.EQUAL),(0,N.Z)(eh,Y.NOTEQUAL,Bi.NOTEQUAL),eh),AL=(Cg={},(0,N.Z)(Cg,Y.FRONT,Zl.FRONT),(0,N.Z)(Cg,Y.BACK,Zl.BACK),Cg),oS=(Md={},(0,N.Z)(Md,Y.FUNC_ADD,ru.ADD),(0,N.Z)(Md,Y.MIN_EXT,ru.MIN),(0,N.Z)(Md,Y.MAX_EXT,ru.MAX),(0,N.Z)(Md,Y.FUNC_SUBTRACT,ru.SUBSTRACT),(0,N.Z)(Md,Y.FUNC_REVERSE_SUBTRACT,ru.REVERSE_SUBSTRACT),Md),Mg=(ku={},(0,N.Z)(ku,Y.ZERO,Xi.ZERO),(0,N.Z)(ku,Y.ONE,Xi.ONE),(0,N.Z)(ku,Y.SRC_COLOR,Xi.SRC),(0,N.Z)(ku,Y.ONE_MINUS_SRC_COLOR,Xi.ONE_MINUS_SRC),(0,N.Z)(ku,Y.SRC_ALPHA,Xi.SRC_ALPHA),(0,N.Z)(ku,Y.ONE_MINUS_SRC_ALPHA,Xi.ONE_MINUS_SRC_ALPHA),(0,N.Z)(ku,Y.DST_COLOR,Xi.DST),(0,N.Z)(ku,Y.ONE_MINUS_DST_COLOR,Xi.ONE_MINUS_DST),(0,N.Z)(ku,Y.DST_ALPHA,Xi.DST_ALPHA),(0,N.Z)(ku,Y.ONE_MINUS_DST_ALPHA,Xi.ONE_MINUS_DST_ALPHA),(0,N.Z)(ku,Y.CONSTANT_COLOR,Xi.CONST),(0,N.Z)(ku,Y.ONE_MINUS_CONSTANT_COLOR,Xi.ONE_MINUS_CONSTANT),(0,N.Z)(ku,Y.CONSTANT_ALPHA,Xi.CONST),(0,N.Z)(ku,Y.ONE_MINUS_CONSTANT_ALPHA,Xi.ONE_MINUS_CONSTANT),(0,N.Z)(ku,Y.SRC_ALPHA_SATURATE,Xi.SRC_ALPHA_SATURATE),ku),Fv=(th={},(0,N.Z)(th,Y.REPLACE,Uo.REPLACE),(0,N.Z)(th,Y.KEEP,Uo.KEEP),(0,N.Z)(th,Y.ZERO,Uo.ZERO),(0,N.Z)(th,Y.INVERT,Uo.INVERT),(0,N.Z)(th,Y.INCR,Uo.INCREMENT_CLAMP),(0,N.Z)(th,Y.DECR,Uo.DECREMENT_CLAMP),(0,N.Z)(th,Y.INCR_WRAP,Uo.INCREMENT_WRAP),(0,N.Z)(th,Y.DECR_WRAP,Uo.DECREMENT_WRAP),th),TL=(rh={},(0,N.Z)(rh,Y.ALWAYS,Bi.ALWAYS),(0,N.Z)(rh,Y.EQUAL,Bi.EQUAL),(0,N.Z)(rh,Y.GEQUAL,Bi.GEQUAL),(0,N.Z)(rh,Y.GREATER,Bi.GREATER),(0,N.Z)(rh,Y.LEQUAL,Bi.LEQUAL),(0,N.Z)(rh,Y.LESS,Bi.LESS),(0,N.Z)(rh,Y.NEVER,Bi.NEVER),(0,N.Z)(rh,Y.NOTEQUAL,Bi.NOTEQUAL),rh),wL={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function Ig(e){return Object.prototype.toString.call(e)in wL}var CL=function(){function e(r,t){(0,ge.Z)(this,e),(0,N.Z)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type,s=t.isUBO,l=t.label,c;Ig(n)?c=n:c=new Rg[this.type||Y.FLOAT](n),this.type=a,this.size=c.byteLength,this.buffer=r.createBuffer({viewOrSize:c,usage:s?Ja.UNIFORM:Ja.VERTEX,hint:EL[i||Y.STATIC_DRAW]}),l&&r.setResourceName(this.buffer,l)}return(0,K.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset,a;Ig(n)?a=n:a=new Rg[this.type||Y.FLOAT](n),this.buffer.setSubData(i,new Uint8Array(a.buffer))}}]),e}(),RL=function(){function e(r,t){(0,ge.Z)(this,e);var n=t.data,i=t.type,a=t.count,s=a===void 0?0:a,l;Ig(n)?l=n:l=new Rg[this.type||Y.UNSIGNED_INT](n),this.type=i,this.count=s,this.indexBuffer=r.createBuffer({viewOrSize:l,usage:Ja.INDEX})}return(0,K.Z)(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(t){var n=t.data,i;Ig(n)?i=n:i=new Rg[this.type||Y.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(i.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}();function sS(e){return!!(e&&e.texture)}var uS=function(){function e(r,t){(0,ge.Z)(this,e),(0,N.Z)(this,"isDestroy",!1);var n=t.data,i=t.type,a=i===void 0?Y.UNSIGNED_BYTE:i,s=t.width,l=t.height,c=t.flipY,p=c===void 0?!1:c,_=t.format,b=_===void 0?Y.RGBA:_,A=t.wrapS,w=A===void 0?Y.CLAMP_TO_EDGE:A,I=t.wrapT,P=I===void 0?Y.CLAMP_TO_EDGE:I,B=t.aniso,H=B===void 0?0:B,Q=t.alignment,ue=Q===void 0?1:Q,Ee=t.usage,Le=Ee===void 0?Oh.SAMPLED:Ee,Ze=t.mipmap,tt=Ze===void 0?!1:Ze,ft=t.mag,wt=ft===void 0?Y.NEAREST:ft,fr=t.min,hr=fr===void 0?Y.NEAREST:fr;this.width=s,this.height=l;var Mr=Pt.U8_RGBA_RT;if(a===Y.UNSIGNED_BYTE&&b===Y.RGBA)Mr=Pt.U8_RGBA_RT;else if(a===Y.UNSIGNED_BYTE&&b===Y.LUMINANCE)Mr=Pt.U8_LUMINANCE;else if(a===Y.FLOAT&&b===Y.RGB)Mr=Pt.F32_RGB;else throw new Error("create texture error, type: ".concat(a,", format: ").concat(b));this.texture=r.createTexture({format:Mr,width:s,height:l,usage:Le===Oh.SAMPLED?Ou.SAMPLED:Ou.RENDER_TARGET,pixelStore:{unpackFlipY:p,packAlignment:ue},mipLevelCount:Le===Oh.RENDER_TARGET||tt?1:0}),n&&this.texture.setImageData([n]),this.sampler=r.createSampler({addressModeU:aS[w],addressModeV:aS[P],minFilter:hr===Y.NEAREST?Xo.POINT:Xo.BILINEAR,magFilter:wt===Y.NEAREST?Xo.POINT:Xo.BILINEAR,mipmapFilter:js.NO_MIP,maxAnisotropy:H})}return(0,K.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(t){var n=t.data;this.texture.setImageData([n])}},{key:"bind",value:function(){}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),lS=function(){function e(r,t){(0,ge.Z)(this,e),this.device=r,this.options=t,this.createColorRenderTarget(),this.createDepthRenderTarget()}return(0,K.Z)(e,[{key:"createColorRenderTarget",value:function(){var t=this.options,n=t.width,i=t.height,a=t.color;a&&(sS(a)?(this.colorTexture=a.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=a.width,this.height=a.height):n&&i&&(this.colorTexture=this.device.createTexture({format:Pt.U8_RGBA_RT,usage:Ou.RENDER_TARGET,width:n,height:i}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=n,this.height=i))}},{key:"createDepthRenderTarget",value:function(){var t=this.options,n=t.width,i=t.height,a=t.depth;a&&(sS(a)?(this.depthTexture=a.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=a.width,this.height=a.height):n&&i&&(this.depthTexture=this.device.createTexture({format:Pt.D24_S8,usage:Ou.RENDER_TARGET,width:n,height:i}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=n,this.height=i))}},{key:"get",value:function(){return this.colorRenderTarget}},{key:"destroy",value:function(){var t,n;(t=this.colorRenderTarget)===null||t===void 0||t.destroy(),(n=this.depthRenderTarget)===null||n===void 0||n.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;(this.width!==n||this.height!==i)&&(this.destroy(),this.options.width=n,this.options.height=i,this.createColorRenderTarget(),this.createDepthRenderTarget())}}]),e}(),ML=vi.isPlainObject,IL=vi.isTypedArray,PL=function(){function e(r,t,n){var i=this;(0,ge.Z)(this,e),(0,N.Z)(this,"destroyed",!1),(0,N.Z)(this,"uniforms",{}),(0,N.Z)(this,"vertexBuffers",[]),this.device=r,this.options=t,this.service=n;var a=t.vs,s=t.fs,l=t.attributes,c=t.uniforms,p=t.count,_=t.elements;this.options=t;var b=r.createProgram({vertex:{glsl:a},fragment:{glsl:s}});this.program=b,c&&(this.uniforms=this.extractUniforms(c));var A=[],w=0;Object.keys(l).forEach(function(P){var B=l[P],H=B.get();i.vertexBuffers.push(H.get());var Q=B.attribute,ue=Q.offset,Ee=ue===void 0?0:ue,Le=Q.stride,Ze=Le===void 0?0:Le,tt=Q.size,ft=tt===void 0?1:tt,wt=Q.divisor,fr=wt===void 0?0:wt,hr=Q.shaderLocation,Mr=hr===void 0?0:hr;A.push({arrayStride:Ze||ft*4,stepMode:wd.VERTEX,attributes:[{format:bL[ft],shaderLocation:Mr,offset:Ee,divisor:fr}]}),w=H.size/ft}),p||(this.options.count=w),_&&(this.indexBuffer=_.get());var I=r.createInputLayout({vertexBufferDescriptors:A,indexBufferFormat:_?Pt.U32_R:null,program:b});this.inputLayout=I,this.pipeline=this.createPipeline(t)}return(0,K.Z)(e,[{key:"createPipeline",value:function(t,n){var i=t.primitive,a=i===void 0?Y.TRIANGLES:i,s=t.depth,l=t.cull,c=t.blend,p=t.stencil,_=this.initDepthDrawParams({depth:s}),b=!!(_&&_.enable),A=this.initCullDrawParams({cull:l}),w=!!(A&&A.enable),I=this.getBlendDrawParams({blend:c}),P=!!(I&&I.enable),B=this.getStencilDrawParams({stencil:p}),H=!!(B&&B.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:xL[a],colorAttachmentFormats:[Pt.U8_RGBA_RT],depthStencilAttachmentFormat:Pt.D24_S8,megaStateDescriptor:{attachmentsState:[n?{channelWriteMask:nu.ALL,rgbBlendState:{blendMode:ru.ADD,blendSrcFactor:Xi.ONE,blendDstFactor:Xi.ZERO},alphaBlendState:{blendMode:ru.ADD,blendSrcFactor:Xi.ONE,blendDstFactor:Xi.ZERO}}:{channelWriteMask:H&&B.opFront.zpass===Uo.REPLACE?nu.NONE:nu.ALL,rgbBlendState:{blendMode:P&&I.equation.rgb||ru.ADD,blendSrcFactor:P&&I.func.srcRGB||Xi.SRC_ALPHA,blendDstFactor:P&&I.func.dstRGB||Xi.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:P&&I.equation.alpha||ru.ADD,blendSrcFactor:P&&I.func.srcAlpha||Xi.ONE,blendDstFactor:P&&I.func.dstAlpha||Xi.ONE}}],blendConstant:P?N_:void 0,depthWrite:b,depthCompare:b&&_.func||Bi.LESS,cullMode:w&&A.face||Zl.NONE,stencilWrite:H,stencilFront:{compare:H?B.func.cmp:Bi.ALWAYS,passOp:B.opFront.zpass},stencilBack:{compare:H?B.func.cmp:Bi.ALWAYS,passOp:B.opBack.zpass}}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(t){this.uniforms=(0,k.Z)((0,k.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){var i=this,a=(0,k.Z)((0,k.Z)({},this.options),t),s=a.count,l=s===void 0?0:s,c=a.instances,p=a.elements,_=a.uniforms,b=_===void 0?{}:_,A=a.uniformBuffers,w=a.textures;this.uniforms=(0,k.Z)((0,k.Z)({},this.uniforms),this.extractUniforms(b));var I=this.service,P=I.renderPass,B=I.currentFramebuffer,H=I.width,Q=I.height;if(this.pipeline=this.createPipeline(a,n),P.setViewport(0,0,(B==null?void 0:B.width)||H,(B==null?void 0:B.height)||Q),P.setPipeline(this.pipeline),P.setStencilReference(1),P.setVertexInput(this.inputLayout,this.vertexBuffers.map(function(Ee){return{buffer:Ee}}),p?{buffer:this.indexBuffer,offset:0}:null),A&&(this.bindings=this.device.createBindings({pipeline:this.pipeline,uniformBufferBindings:A.map(function(Ee,Le){var Ze=Ee;return{binding:Le,buffer:Ze.get(),size:Ze.size}}),samplerBindings:w==null?void 0:w.map(function(Ee){return{texture:Ee.texture,sampler:Ee.sampler}})})),this.bindings&&(P.setBindings(this.bindings),Object.keys(this.uniforms).forEach(function(Ee){var Le=i.uniforms[Ee];Le instanceof uS?i.uniforms[Ee]=Le.get():Le instanceof lS&&(i.uniforms[Ee]=Le.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),p){var ue=p.count;ue===0?P.draw(l,c):P.drawIndexed(ue,c)}else P.draw(l,c)}},{key:"destroy",value:function(){var t,n,i;this.program.destroy(),(t=this.vertexBuffers)===null||t===void 0||t.forEach(function(a){return a.destroy()}),(n=this.indexBuffer)===null||n===void 0||n.destroy(),(i=this.bindings)===null||i===void 0||i.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t){var n=t.depth;if(n)return{enable:n.enable===void 0?!0:!!n.enable,mask:n.mask===void 0?!0:!!n.mask,func:SL[n.func||Y.LESS],range:n.range||[0,1]}}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,c=i.color,p=c===void 0?[0,0,0,0]:c;return{enable:!!a,func:{srcRGB:Mg[s&&s.srcRGB||Y.SRC_ALPHA],srcAlpha:Mg[s&&s.srcAlpha||Y.SRC_ALPHA],dstRGB:Mg[s&&s.dstRGB||Y.ONE_MINUS_SRC_ALPHA],dstAlpha:Mg[s&&s.dstAlpha||Y.ONE_MINUS_SRC_ALPHA]},equation:{rgb:oS[l&&l.rgb||Y.FUNC_ADD],alpha:oS[l&&l.alpha||Y.FUNC_ADD]},color:p}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,i=n||{},a=i.enable,s=i.mask,l=s===void 0?-1:s,c=i.func,p=c===void 0?{cmp:Y.ALWAYS,ref:0,mask:-1}:c,_=i.opFront,b=_===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:_,A=i.opBack,w=A===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:A;return{enable:!!a,mask:l,func:(0,k.Z)((0,k.Z)({},p),{},{cmp:TL[p.cmp]}),opFront:{fail:Fv[b.fail],zfail:Fv[b.zfail],zpass:Fv[b.zpass]},opBack:{fail:Fv[w.fail],zfail:Fv[w.zfail],zpass:Fv[w.zpass]}}}},{key:"initCullDrawParams",value:function(t){var n=t.cull;if(n){var i=n.enable,a=n.face,s=a===void 0?Y.BACK:a;return{enable:!!i,face:AL[s]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||IL(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}ML(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,c){Object.keys(l).forEach(function(p){s.extractUniformsRecursively(p,l[p],i,"".concat(a&&a+".").concat(t,"[").concat(c,"]"))})})}}]),e}();function OL(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}var cS,fS,kL=(cS=(0,Jt.b2)(),cS(fS=function(){function e(){var r=this;(0,ge.Z)(this,e),(0,N.Z)(this,"uniformBuffers",[]),(0,N.Z)(this,"createModel",function(t){return new PL(r.device,t,r)}),(0,N.Z)(this,"createAttribute",function(t){return new yL(r.device,t)}),(0,N.Z)(this,"createBuffer",function(t){return new CL(r.device,t)}),(0,N.Z)(this,"createElements",function(t){return new RL(r.device,t)}),(0,N.Z)(this,"createTexture2D",function(t){return new uS(r.device,t)}),(0,N.Z)(this,"createFramebuffer",function(t){return new lS(r.device,t)}),(0,N.Z)(this,"useFramebuffer",function(t,n){r.currentFramebuffer=t,r.beginFrame(),n(),r.endFrame(),r.currentFramebuffer=null}),(0,N.Z)(this,"clear",function(t){var n=t.color,i=t.depth,a=t.stencil,s=t.framebuffer,l=s===void 0?null:s;l&&(l.clearOptions={color:n,depth:i,stencil:a})}),(0,N.Z)(this,"viewport",function(t){var n=t.width,i=t.height;r.width=n,r.height=i}),(0,N.Z)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,s=t.width,l=t.height,c=r.device.createReadback(),p=n.colorTexture;return c.readTextureSync(p,i,a,s,l,new Uint8Array(s*l*4))}),(0,N.Z)(this,"getViewportSize",function(){return{width:r.width,height:r.height}}),(0,N.Z)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),(0,N.Z)(this,"getCanvas",function(){return r.canvas}),(0,N.Z)(this,"getGLContext",function(){return r.device.gl}),(0,N.Z)(this,"destroy",function(){var t;r.canvas=null,(t=r.uniformBuffers)===null||t===void 0||t.forEach(function(n){n.destroy()}),r.device.destroy()})}return(0,K.Z)(e,[{key:"init",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i,a){var s,l,c,p,_;return xe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=a.enableWebGPU,l=a.shaderCompilerPath,this.canvas=i,c=s?new pL({shaderCompilerPath:l}):new AD({targets:["webgl2","webgl1"],onContextLost:function(I){console.warn("context lost",I)},onContextCreationError:function(I){console.warn("context creation error",I)},onContextRestored:function(I){console.warn("context restored",I)}}),A.next=5,c.createSwapChain(i);case 5:p=A.sent,p.configureSwapChain(i.width,i.height),this.device=p.getDevice(),this.swapChain=p,this.currentFramebuffer=null,_=this.device.gl,this.extensionObject={OES_texture_float:!OL(_)&&this.device.OES_texture_float},this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:Pt.U8_RGBA_RT,width:i.width,height:i.height,usage:Ou.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:Pt.D24_S8,width:i.width,height:i.height,usage:Ou.RENDER_TARGET}));case 14:case"end":return A.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"beginFrame",value:function(){var t=this.currentFramebuffer,n=this.swapChain,i=this.mainColorRT,a=this.mainDepthRT,s=n.getOnscreenTexture(),l=t?t.colorRenderTarget:i,c=t?null:s,p=t?t.depthRenderTarget:a,_=(t==null?void 0:t.clearOptions)||{},b=_.color,A=b===void 0?[0,0,0,0]:b,w=_.depth,I=w===void 0?1:w,P=_.stencil,B=P===void 0?0:P,H=l?jm(A[0]*255,A[1]*255,A[2]*255,A[3]):N_,Q=p?I:void 0,ue=p?B:void 0,Ee=this.device.createRenderPass({colorAttachment:[l],colorResolveTo:[c],colorClearColor:[H],depthStencilAttachment:p,depthClearValue:Q,stencilClearValue:ue});this.renderPass=Ee}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass)}},{key:"getPointSizeRange",value:function(){var t=this.device.gl;return t.getParameter(t.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||fS);function DL(e){var r=LL();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function LL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $_=["selectstart","selecting","selectend"],BL=function(e){(0,Qe.Z)(t,e);var r=DL(t);function t(n){var i,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,ge.Z)(this,t),i=r.call(this),(0,N.Z)((0,we.Z)(i),"isEnable",!1),(0,N.Z)((0,we.Z)(i),"onDragStart",function(s){i.box.style.display="block",i.startEvent=i.endEvent=s,i.syncBoxBound(),i.emit("selectstart",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,N.Z)((0,we.Z)(i),"onDragging",function(s){i.endEvent=s,i.syncBoxBound(),i.emit("selecting",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,N.Z)((0,we.Z)(i),"onDragEnd",function(s){i.endEvent=s,i.box.style.display="none",i.emit("selectend",i.getLngLatBox(),i.startEvent,i.endEvent)}),i.scene=n,i.options=a,i}return(0,K.Z)(t,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var i=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var a=In("div",void 0,this.container);a.classList.add("l7-select-box"),i&&a.classList.add(i),a.style.display="none",this.box=a}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var i=this.startEvent,a=i.x,s=i.y,l=this.endEvent,c=l.x,p=l.y,_=Math.min(a,c),b=Math.min(s,p),A=Math.abs(a-c),w=Math.abs(s-p);this.box.style.top="".concat(b,"px"),this.box.style.left="".concat(_,"px"),this.box.style.width="".concat(A,"px"),this.box.style.height="".concat(w,"px")}},{key:"getLngLatBox",value:function(){var i=this.startEvent.lngLat,a=i.lng,s=i.lat,l=this.endEvent.lngLat,c=l.lng,p=l.lat;return Rf([[a,s],[c,p]])}}]),t}(Fa.EventEmitter),FL=function(){function e(r){(0,ge.Z)(this,e);var t=r.id,n=r.map,i=r.canvas,a=r.renderer,s=a===void 0?"regl":a,l=KT();this.container=l,n.setContainer(l,t,i),l.bind(Ye.IRendererService).to(s==="regl"?_L:kL).inSingletonScope(),this.sceneService=l.get(Ye.ISceneService),this.mapService=l.get(Ye.IMapService),this.iconService=l.get(Ye.IIconService),this.fontService=l.get(Ye.IFontService),this.controlService=l.get(Ye.IControlService),this.layerService=l.get(Ye.ILayerService),this.debugService=l.get(Ye.IDebugService),this.debugService.setEnable(r.debug),this.markerService=l.get(Ye.IMarkerService),this.interactionService=l.get(Ye.IInteractionService),this.popupService=l.get(Ye.IPopupService),this.boxSelect=new BL(this,{}),this.initComponent(t),this.sceneService.init(r),this.initControl()}return(0,K.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i){return xe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"exportMap",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i){return xe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var i=new t(this);i.init()}else this.on("loaded",function(){var a=new t(n);a.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=this,i=lv(this.container);if(t.setContainer(i,this.container),this.sceneService.addLayer(t),t.inited){var a=this.initMask(t);this.addMask(a,t.id)}else t.on("inited",function(){var s=n.initMask(t);n.addMask(s,t.id)})}},{key:"initMask",value:function(t){var n=t.getLayerConfig(),i=n.mask,a=n.maskfence,s=n.maskColor,l=s===void 0?"#000":s,c=n.maskOpacity,p=c===void 0?0:c;if(!(!i||!a)){var _=new vb().source(a).shape("fill").style({color:l,opacity:p});return _}}},{key:"addMask",value:function(t,n){if(!!t){var i=this.getLayer(n);if(i){var a=lv(this.container);t.setContainer(a,this.container),i.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i,a){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"removeAllLayer",value:function(){var r=(0,Nt.Z)(xe().mark(function n(){return xe().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.layerService.removeAllLayers();case 2:case"end":return a.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(i){var a=(0,re.Z)(i,2),s=a[0],l=a[1];n.fontService.addIconFont(s,l)})}},{key:"addFontFace",value:function(t,n){var i=this;this.fontService.once("fontloaded",function(a){i.emit("fontloaded",a)}),this.fontService.addFontFace(t,n)}},{key:"addImage",value:function(){var r=(0,Nt.Z)(xe().mark(function n(i,a){return xe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,n){if($_.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.on(t,n)}else B0.includes(t)?this.sceneService.on(t,n):this.mapService.on(t,n)}},{key:"once",value:function(t,n){if($_.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.once(t,n)}else B0.includes(t)?this.sceneService.once(t,n):this.mapService.once(t,n)}},{key:"emit",value:function(t,n){B0.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.emit(t,n)}},{key:"off",value:function(t,n){if($_.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.off(t,n)}else B0.includes(t)?this.sceneService.off(t,n):this.mapService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var i=this.sceneService.getSceneConfig(),a=i.fitBoundsOptions,s=i.animate;this.mapService.fitBounds(t,n||(0,k.Z)((0,k.Z)({},a),{},{animate:s}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(Ye.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){t.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(t){return Br.REGISTERED_PROTOCOLS[t]}},{key:"startAnimate",value:function(){this.layerService.startAnimate()}},{key:"stopAnimate",value:function(){this.layerService.stopAnimate()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:Nu(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,i=t.logoPosition;n&&this.addControl(new px({position:i}))}}],[{key:"addProtocol",value:function(t,n){Br.REGISTERED_PROTOCOLS[t]=n}},{key:"removeProtocol",value:function(t){delete Br.REGISTERED_PROTOCOLS[t]}}]),e}(),Y6="2.20.9";function e0(e){return e0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},e0(e)}function hS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function q6(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?hS(Object(t),!0).forEach(function(n){NL(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):hS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function NL(e,r,t){return r=UL(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function UL(e){var r=zL(e,"string");return e0(r)==="symbol"?r:String(r)}function zL(e,r){if(e0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(e0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function K6(e,r){return HL(e)||jL(e,r)||VL(e,r)||ZL()}function ZL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VL(e,r){if(!!e){if(typeof e=="string")return pS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return pS(e,r)}}function pS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function jL(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);c=!0);}catch(_){p=!0,i=_}finally{try{if(!c&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function HL(e){if(Array.isArray(e))return e}var Q6=null,J6=null,dS,Y_,vS,WL=(dS=Qg(Ye.IGlobalConfigService),Y_=function(){function e(r){(0,ge.Z)(this,e),qr(this,"configService",vS,this),this.config=r}return(0,K.Z)(e,[{key:"setContainer",value:function(t,n,i){t.bind(Ye.MapConfig).toConstantValue((0,k.Z)((0,k.Z)({},this.config),{},{id:n,canvas:i})),t.bind(Ye.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),vS=Cr(Y_.prototype,"configService",[dS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y_),GL=Z(6158),t0=Z.n(GL),XL=function(){function e(r){(0,ge.Z)(this,e),(0,N.Z)(this,"size",1e4),this.size=r||1e4}return(0,K.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[n,i]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[n,i]}}]),e}(),$L={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},mS,gS,_S,yS,xS,bS,Nv,ES,SS,AS,TS,wS={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},YL=12,qL=(mS=(0,Jt.b2)(),gS=(0,Jt.f3)(Ye.MapConfig),_S=(0,Jt.f3)(Ye.IGlobalConfigService),yS=(0,Jt.f3)(Ye.ICoordinateSystemService),xS=(0,Jt.f3)(Ye.IEventEmitter),mS(bS=(Nv=function(){function e(){var r=this;(0,ge.Z)(this,e),(0,N.Z)(this,"version","DEFAUlTMAP"),(0,N.Z)(this,"simpleMapCoord",new XL),(0,N.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),qr(this,"config",ES,this),qr(this,"configService",SS,this),qr(this,"coordinateSystemService",AS,this),qr(this,"eventEmitter",TS,this),(0,N.Z)(this,"handleCameraChanged",function(t){var n=r.map.getCenter(),i=n.lat,a=n.lng;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[a,i],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0}),r.updateCoordinateSystemService(),r.cameraChangedCallback(r.viewport)})}return(0,K.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=In("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,n){lw.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(wS[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(wS[t]||t,n),this.eventEmitter.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,n){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,n=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(i){return""}}},{key:"getMapStyleConfig",value:function(){return $L}},{key:"getMapStyleValue",value:function(t){var n;return(n=this.getMapStyleConfig()[t])!==null&&n!==void 0?n:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var n=t;return typeof t=="string"&&(n=document.getElementById(t)),n}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,n=t===void 0?!0:t;this.viewport.getZoom()>YL&&n?this.coordinateSystemService.setCoordinateSystem(oc.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(oc.LNGLAT)}}]),e}(),ES=Cr(Nv.prototype,"config",[gS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SS=Cr(Nv.prototype,"configService",[_S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AS=Cr(Nv.prototype,"coordinateSystemService",[yS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TS=Cr(Nv.prototype,"eventEmitter",[xS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv))||bS);function r0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Pg(e,r){var t=Fl([],r,e);return Us(t,t,1/t[3]),t}function e8(e,r){var t=e%r;return t<0?r+t:t}function t8(e,r,t){return t*r+(1-t)*e}function Id(e,r){if(!e)throw new Error(r||"viewport-mercator-project: assertion failed.")}var gf=Math.PI,CS=gf/4,Vh=gf/180,RS=180/gf,q_=512,K_=4003e4,KL=1.5;function MS(e){return Math.pow(2,e)}function QL(e){return Math.log2(e)}function Og(e,r){var t=(0,re.Z)(e,2),n=t[0],i=t[1];Id(Number.isFinite(n)&&Number.isFinite(r)),Id(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),r*=q_;var a=n*Vh,s=i*Vh,l=r*(a+gf)/(2*gf),c=r*(gf-Math.log(Math.tan(CS+s*.5)))/(2*gf);return[l,c]}function Q_(e,r){var t=(0,re.Z)(e,2),n=t[0],i=t[1];r*=q_;var a=n/r*(2*gf)-gf,s=2*(Math.atan(Math.exp(gf-i/r*(2*gf)))-CS);return[a*RS,s*RS]}function r8(e){var r=e.latitude;assert(Number.isFinite(r));var t=Math.cos(r*Vh);return QL(K_*t)-9}function IS(e){var r=e.latitude,t=e.longitude,n=e.zoom,i=e.scale,a=e.highPrecision,s=a===void 0?!1:a;i=i!==void 0?i:MS(n),Id(Number.isFinite(r)&&Number.isFinite(t)&&Number.isFinite(i));var l={},c=q_*i,p=Math.cos(r*Vh),_=c/360,b=_/p,A=c/K_/p;if(l.pixelsPerMeter=[A,-A,A],l.metersPerPixel=[1/A,-1/A,1/A],l.pixelsPerDegree=[_,-b,A],l.degreesPerPixel=[1/_,-1/b,1/A],s){var w=Vh*Math.tan(r*Vh)/p,I=_*w/2,P=c/K_*w,B=P/b*A;l.pixelsPerDegree2=[0,-I,P],l.pixelsPerMeter2=[B,0,B]}return l}function n8(e,r){var t=_slicedToArray(e,3),n=t[0],i=t[1],a=t[2],s=_slicedToArray(r,3),l=s[0],c=s[1],p=s[2],_=1,b=IS({longitude:n,latitude:i,scale:_,highPrecision:!0}),A=b.pixelsPerMeter,w=b.pixelsPerMeter2,I=Og(e,_);I[0]+=l*(A[0]+w[0]*c),I[1]+=c*(A[1]+w[1]*c);var P=Q_(I,_),B=(a||0)+(p||0);return Number.isFinite(a)||Number.isFinite(p)?[P[0],P[1],B]:P}function JL(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,a=e.center,s=a===void 0?null:a,l=e.flipY,c=l===void 0?!1:l,p=r0();return eu(p,p,[0,0,-i]),of(p,p,[1,1,1/r]),Ah(p,p,-t*Vh),Th(p,p,n*Vh),c&&of(p,p,[1,-1,1]),s&&eu(p,p,Ta.negate([],s)),p}function eB(e){var r=e.width,t=e.height,n=e.altitude,i=n===void 0?KL:n,a=e.pitch,s=a===void 0?0:a,l=e.nearZMultiplier,c=l===void 0?1:l,p=e.farZMultiplier,_=p===void 0?1:p,b=s*Vh,A=Math.atan(.5/i),w=Math.sin(A)*i/Math.sin(Math.PI/2-b-A),I=Math.cos(Math.PI/2-b)*w+i;return{fov:2*Math.atan(t/2/i),aspect:r/t,focalDistance:i,near:c,far:I*_}}function tB(e){var r=e.width,t=e.height,n=e.pitch,i=e.altitude,a=e.nearZMultiplier,s=e.farZMultiplier,l=eB({width:r,height:t,altitude:i,pitch:n,nearZMultiplier:a,farZMultiplier:s}),c=l.fov,p=l.aspect,_=l.near,b=l.far,A=Wf([],c,p,_,b);return A}function rB(e,r){var t=(0,re.Z)(e,3),n=t[0],i=t[1],a=t[2],s=a===void 0?0:a;return Id(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),Pg(r,[n,i,s,1])}function PS(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,re.Z)(e,3),i=n[0],a=n[1],s=n[2];if(Id(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(s)){var l=Pg(r,[i,a,s,1]);return l}var c=Pg(r,[i,a,0,1]),p=Pg(r,[i,a,1,1]),_=c[2],b=p[2],A=_===b?0:((t||0)-_)/(b-_);return Dr.lerp([],c,p,A)}var OS=r0(),nB=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=r.width,n=r.height,i=r.viewMatrix,a=i===void 0?OS:i,s=r.projectionMatrix,l=s===void 0?OS:s;(0,ge.Z)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=l;var c=r0();xa(c,c,this.projectionMatrix),xa(c,c,this.viewMatrix),this.viewProjectionMatrix=c;var p=r0();of(p,p,[this.width/2,-this.height/2,1]),eu(p,p,[1,-1,0]),xa(p,p,this.viewProjectionMatrix);var _=Wn(r0(),p);if(!_)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=p,this.pixelUnprojectionMatrix=_,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,K.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&Bc(t.projectionMatrix,this.projectionMatrix)&&Bc(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=this.projectPosition(t),l=rB(s,this.pixelProjectionMatrix),c=(0,re.Z)(l,2),p=c[0],_=c[1],b=a?_:this.height-_;return t.length===2?[p,b]:[p,b,l[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=n.targetZ,l=(0,re.Z)(t,3),c=l[0],p=l[1],_=l[2],b=a?p:this.height-p,A=s&&s*this.pixelsPerMeter,w=PS([c,b,_],this.pixelUnprojectionMatrix,A),I=this.unprojectPosition(w),P=(0,re.Z)(I,3),B=P[0],H=P[1],Q=P[2];return Number.isFinite(_)?[B,H,Q]:Number.isFinite(s)?[B,H,s]:[B,H]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),i=(0,re.Z)(n,2),a=i[0],s=i[1],l=(t[2]||0)*this.pixelsPerMeter;return[a,s,l]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),i=(0,re.Z)(n,2),a=i[0],s=i[1],l=(t[2]||0)/this.pixelsPerMeter;return[a,s,l]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function iB(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,a=i===void 0?0:i,s=e.maxZoom,l=s===void 0?24:s,c=e.padding,p=c===void 0?0:c,_=e.offset,b=_===void 0?[0,0]:_,A=(0,re.Z)(n,2),w=(0,re.Z)(A[0],2),I=w[0],P=w[1],B=(0,re.Z)(A[1],2),H=B[0],Q=B[1];if(Number.isFinite(p)){var ue=p;p={top:ue,bottom:ue,left:ue,right:ue}}else Id(Number.isFinite(p.top)&&Number.isFinite(p.bottom)&&Number.isFinite(p.left)&&Number.isFinite(p.right));var Ee=new kS({width:r,height:t,longitude:0,latitude:0,zoom:0}),Le=Ee.project([I,Q]),Ze=Ee.project([H,P]),tt=[Math.max(Math.abs(Ze[0]-Le[0]),a),Math.max(Math.abs(Ze[1]-Le[1]),a)],ft=[r-p.left-p.right-Math.abs(b[0])*2,t-p.top-p.bottom-Math.abs(b[1])*2];Id(ft[0]>0&&ft[1]>0);var wt=ft[0]/tt[0],fr=ft[1]/tt[1],hr=(p.right-p.left)/2/wt,Mr=(p.bottom-p.top)/2/fr,ln=[(Ze[0]+Le[0])/2+hr,(Ze[1]+Le[1])/2+Mr],Rn=Ee.unproject(ln),wi=Ee.zoom+Math.log2(Math.abs(Math.min(wt,fr)));return{longitude:Rn[0],latitude:Rn[1],zoom:Math.min(wi,l)}}var kS=function(e){(0,Qe.Z)(r,e);function r(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,a=n.height,s=n.latitude,l=s===void 0?0:s,c=n.longitude,p=c===void 0?0:c,_=n.zoom,b=_===void 0?0:_,A=n.pitch,w=A===void 0?0:A,I=n.bearing,P=I===void 0?0:I,B=n.altitude,H=B===void 0?1.5:B,Q=n.nearZMultiplier,ue=n.farZMultiplier;(0,ge.Z)(this,r),i=i||1,a=a||1;var Ee=MS(b);H=Math.max(.75,H);var Le=Og([p,l],Ee);Le[2]=0;var Ze=tB({width:i,height:a,pitch:w,bearing:P,altitude:H,nearZMultiplier:Q||1/a,farZMultiplier:ue||1.01}),tt=JL({height:a,center:Le,pitch:w,bearing:P,altitude:H,flipY:!0});return t=(0,gt.Z)(this,(0,pe.Z)(r).call(this,{width:i,height:a,viewMatrix:tt,projectionMatrix:Ze})),t.latitude=l,t.longitude=p,t.zoom=b,t.pitch=w,t.bearing=P,t.altitude=H,t.scale=Ee,t.center=Le,t.pixelsPerMeter=IS((0,we.Z)((0,we.Z)(t))).pixelsPerMeter[2],Object.freeze((0,we.Z)((0,we.Z)(t))),t}return(0,K.Z)(r,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Og(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Q_(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,a=n.pos,s=PS(a,this.pixelUnprojectionMatrix),l=Og(i,this.scale),c=Dr.add([],l,Dr.negate([],s)),p=Dr.add([],this.center,c);return Q_(p,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,a=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:a})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,s=this.height,l=iB(Object.assign({width:a,height:s,bounds:n},i)),c=l.longitude,p=l.latitude,_=l.zoom;return new r({width:a,height:s,longitude:c,latitude:p,zoom:_})}}]),r}(nB),aB=function(){function e(){(0,ge.Z)(this,e)}return(0,K.Z)(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,a=t.pitch,s=t.bearing,l=t.viewportHeight,c=t.viewportWidth;this.viewport=new kS({width:c,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:a,bearing:s})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),oB=["id","attributionControl","style","token","rotation","mapInstance"],DS,LS;function sB(e){var r=uB();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function uB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function lB(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}lB(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=t0();var cB=0,BS="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",fB=(DS=(0,Jt.b2)(),DS(LS=function(e){(0,Qe.Z)(t,e);var r=sB(t);function t(){var n;(0,ge.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,N.Z)((0,we.Z)(n),"version","MAPBOX"),n}return(0,K.Z)(t,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},s=this.lngLatToMercator(i,0),l=s.x,c=s.y;return[l-a.x,c-a.y]}},{key:"lngLatToMercator",value:function(i,a){var s=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),l=s.x,c=l===void 0?0:l,p=s.y,_=p===void 0?0:p,b=s.z,A=b===void 0?0:b;return{x:c,y:_,z:A}}},{key:"getModelMatrix",value:function(i,a,s){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},p=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),_=p.meterInMercatorCoordinateUnits(),b=or();return eu(b,b,Ta.fromValues(p.x-c.x,p.y-c.y,p.z||0-c.z)),of(b,b,Ta.fromValues(_*l[0],-_*l[1],_*l[2])),Ah(b,b,s[0]),gl(b,b,s[1]),Th(b,b,s[2]),b}},{key:"init",value:function(){var n=(0,Nt.Z)(xe().mark(function a(){var s=this,l,c,p,_,b,A,w,I,P,B,H,Q,ue;return xe().wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:l=this.config,c=l.id,p=c===void 0?"map":c,_=l.attributionControl,b=_===void 0?!1:_,A=l.style,w=A===void 0?"light":A,I=l.token,P=I===void 0?BS:I,B=l.rotation,H=B===void 0?0:B,Q=l.mapInstance,ue=(0,yl.Z)(l,oB),this.viewport=new aB,!Q&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),P===BS&&w!=="blank"&&!window.mapboxgl.accessToken&&!Q&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Q&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=P),Q?(this.map=Q,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(p),this.map=new window.mapboxgl.Map((0,k.Z)({container:this.$mapContainer,style:this.getMapStyleValue(w),attributionControl:b,bearing:H},ue))),this.map.on("load",function(){s.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Le.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"destroy",value:function(){var i;(i=this.$mapContainer)===null||i===void 0||(i=i.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),c=1;c<s;c++)l[c-1]=arguments[c];(a=this.eventEmitter).emit.apply(a,[i].concat(l))}},{key:"once",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),c=1;c<s;c++)l[c-1]=arguments[c];(a=this.eventEmitter).once.apply(a,[i].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(i,a){var s=new(t0()).LngLat(i[0],i[1]),l=new(t0()).LngLat(a[0],a[1]),c=s.distanceTo(l),p=t0().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),_=t0().MercatorCoordinate.fromLngLat({lng:a[0],lat:a[1]}),b=p.x,A=p.y,w=_.x,I=_.y,P=Math.sqrt(Math.pow(b-w,2)+Math.pow(A-I,2))*4194304*2;return P/c}},{key:"exportMap",value:function(i){var a=this.map.getCanvas(),s=i==="jpg"?a==null?void 0:a.toDataURL("image/jpeg"):a==null?void 0:a.toDataURL("image/png");return s}},{key:"creatMapContainer",value:function(i){var a=i;typeof i=="string"&&(a=document.getElementById(i));var s=document.createElement("div");return s.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,s.id="l7_mapbox_div"+cB++,a.appendChild(s),s}}]),t}(qL))||LS);function hB(e){var r=pB();return function(){var n=(0,pe.Z)(e),i;if(r){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function pB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function dB(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}dB(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var vB=function(e){(0,Qe.Z)(t,e);var r=hB(t);function t(){return(0,ge.Z)(this,t),r.apply(this,arguments)}return(0,K.Z)(t,[{key:"getServiceConstructor",value:function(){return fB}}]),t}(WL);function n0(e){return n0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},n0(e)}function FS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function NS(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?FS(Object(t),!0).forEach(function(n){mB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):FS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function mB(e,r,t){return r=gB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function gB(e){var r=_B(e,"string");return n0(r)==="symbol"?r:String(r)}function _B(e,r){if(n0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(n0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function yB(e,r){return SB(e)||EB(e,r)||bB(e,r)||xB()}function xB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bB(e,r){if(!!e){if(typeof e=="string")return US(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return US(e,r)}}function US(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function EB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);c=!0);}catch(_){p=!0,i=_}finally{try{if(!c&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function SB(e){if(Array.isArray(e))return e}var AB=se.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,s=(0,se.createRef)(),l=(0,se.useState)(),c=yB(l,2),p=c[0],_=c[1];return(0,se.useEffect)(function(){var b=new FL(NS(NS({id:s.current},i),{},{map:new vB(n)}));return b.on("loaded",function(){_(b),a&&a(b)}),function(){b.destroy()}},[]),(0,se.useEffect)(function(){p&&n.style&&p.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,se.useEffect)(function(){p&&n.zoom&&p.setZoom(n.zoom)},[n.zoom]),(0,se.useEffect)(function(){p&&n.center&&p.setCenter(n.center)},[JSON.stringify(n.center)]),(0,se.useEffect)(function(){p&&n.pitch!==void 0&&p.setPitch(n.pitch||0)},[n.pitch]),(0,se.useEffect)(function(){p&&n.rotation&&p.setRotation(n.rotation)},[n.rotation]),se.createElement(y.Provider,{value:p},(0,se.createElement)("div",{ref:s,style:r,className:t},p&&e.children))}),TB=AB;function i0(e){return i0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},i0(e)}function zS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function i8(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?zS(Object(t),!0).forEach(function(n){wB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function wB(e,r,t){return r=CB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function CB(e){var r=RB(e,"string");return i0(r)==="symbol"?r:String(r)}function RB(e,r){if(i0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(i0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function a8(e,r){return OB(e)||PB(e,r)||IB(e,r)||MB()}function MB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IB(e,r){if(!!e){if(typeof e=="string")return ZS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ZS(e,r)}}function ZS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function PB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);c=!0);}catch(_){p=!0,i=_}finally{try{if(!c&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function OB(e){if(Array.isArray(e))return e}var o8=null,s8=null;function a0(e){return a0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},a0(e)}function VS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function u8(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?VS(Object(t),!0).forEach(function(n){kB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):VS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function kB(e,r,t){return r=DB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function DB(e){var r=LB(e,"string");return a0(r)==="symbol"?r:String(r)}function LB(e,r){if(a0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(a0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function l8(e,r){return UB(e)||NB(e,r)||FB(e,r)||BB()}function BB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FB(e,r){if(!!e){if(typeof e=="string")return jS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return jS(e,r)}}function jS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function NB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);c=!0);}catch(_){p=!0,i=_}finally{try{if(!c&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function UB(e){if(Array.isArray(e))return e}var c8=null,f8=null;function o0(e){return o0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},o0(e)}function HS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function h8(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?HS(Object(t),!0).forEach(function(n){zB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):HS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function zB(e,r,t){return r=ZB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function ZB(e){var r=VB(e,"string");return o0(r)==="symbol"?r:String(r)}function VB(e,r){if(o0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(o0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function p8(e,r){return GB(e)||WB(e,r)||HB(e,r)||jB()}function jB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HB(e,r){if(!!e){if(typeof e=="string")return WS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return WS(e,r)}}function WS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function WB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);c=!0);}catch(_){p=!0,i=_}finally{try{if(!c&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function GB(e){if(Array.isArray(e))return e}var d8=null,v8=null;function m8(e,r){return qB(e)||YB(e,r)||$B(e,r)||XB()}function XB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $B(e,r){if(!!e){if(typeof e=="string")return GS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return GS(e,r)}}function GS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function YB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);c=!0);}catch(_){p=!0,i=_}finally{try{if(!c&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function qB(e){if(Array.isArray(e))return e}var g8=null;function s0(e){return s0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},s0(e)}var _8=null;function XS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function y8(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?XS(Object(t),!0).forEach(function(n){KB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):XS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function KB(e,r,t){return r=QB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function QB(e){var r=JB(e,"string");return s0(r)==="symbol"?r:String(r)}function JB(e,r){if(s0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(s0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function x8(e,r){if(e==null)return{};var t=eF(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function eF(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var b8={exportImage:x3,fullscreen:T3,geoLocate:R3,layer:hx,layerSwitch:hx,logo:px,mapTheme:F3,mouseLocation:z3,zoom:Y5,scale:j3},E8=null,$S=Z(73935);function YS(e,r){return iF(e)||nF(e,r)||rF(e,r)||tF()}function tF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rF(e,r){if(!!e){if(typeof e=="string")return qS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return qS(e,r)}}function qS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function nF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);c=!0);}catch(_){p=!0,i=_}finally{try{if(!c&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function iF(e){if(Array.isArray(e))return e}var KS=se.useEffect,QS=se.useState,aF=/\B([A-Z])/g,oF=function(r){return r.replace(aF,"-$1").toLowerCase()};function S8(e){var r=e.className,t=e.style,n=e.children,i=e.position,a=QS(),s=YS(a,2),l=s[0],c=s[1],p=useSceneValue(),_=QS(function(){return document.createElement("div")}),b=YS(_,1),A=b[0];return KS(function(){var w=new Control({position:i});return w.onAdd=function(){if(r&&(A.className=r),t){var I=Object.keys(t).map(function(P){return"".concat(oF(P),":").concat(t[P])}).join(";");A.style.cssText=I}return A},w.onRemove=function(){},c(w),p.addControl(w),function(){p.removeControl(w)}},[]),KS(function(){l&&l.setPosition(i||"bottomleft")},[i]),createPortal(n,A)}var JS=(0,se.createContext)({});function A8(){return useContext(JS)}var sF=se.memo(function(r){var t=r.layer,n=r.active;return t.active(n.option),null},au()),uF=se.memo(function(r){var t=r.layer,n=r.animate;return t.animate(n),null},au()),lF=se.memo(function(r){var t=r.layer,n=r.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},au()),cF=se.memo(function(r){var t=r.layer,n=r.filter;return n.field&&t.filter(n.field,n.values),null},au()),fF=se.memo(function(r){var t=r.layer,n=r.scale;return t.scale(n.values),null},au()),hF=se.memo(function(r){var t=r.layer,n=r.select;return t.select(n.option),null},au()),pF=se.memo(function(r){var t=r.layer,n=r.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},au()),dF=se.memo(function(r){var t=r.layer,n=r.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},au()),vF=["data"];function mF(e,r){if(e==null)return{};var t=gF(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function gF(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var _F=se.memo(function(r){var t=r.layer,n=r.source,i=n.data,a=mF(n,vF);return t.inited?t.setData(i,a):t.source(i,a),a.autoFit&&t.fitBounds(a&&a.fitBoundsOptions),null},au()),T8=se.useEffect,yF=se.memo(function(r){var t=r.layer,n=r.style;return t.style(n),null},au());function xF(e,r){return AF(e)||SF(e,r)||EF(e,r)||bF()}function bF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EF(e,r){if(!!e){if(typeof e=="string")return eA(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return eA(e,r)}}function eA(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function SF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);c=!0);}catch(_){p=!0,i=_}finally{try{if(!c&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function AF(e){if(Array.isArray(e))return e}var u0=se.useEffect,TF=se.useState;function tA(e,r){var t=r.source,n=r.color,i=r.shape,a=r.style,s=r.size,l=r.scale,c=r.active,p=r.select,_=r.filter,b=r.animate,A=r.options,w=r.onLayerLoaded,I=de(),P=TF(function(){var Q;switch(e){case"polygonLayer":Q=new Tm(A);break;case"lineLayer":Q=new d_(A);break;case"pointLayer":Q=new H0(A);break;case"heatmapLayer":Q=new eR(A);break;case"rasterLayer":Q=new W0(A);break;case"imageLayer":Q=new jx(A);break;case"citybuildingLayer":Q=new AC(A);break;default:Q=new Tm(A)}return Q.on("inited",function(){w&&w(Q,I)}),Q}),B=xF(P,1),H=B[0];return u0(function(){return I.addLayer(H),function(){I.removeLayer(H)}},[]),u0(function(){H.inited&&A&&H.updateLayerConfig(A)},[A==null?void 0:A.minZoom,A==null?void 0:A.maxZoom,A==null?void 0:A.visible]),u0(function(){H.inited&&(A==null?void 0:A.zIndex)&&H.setIndex(A.zIndex)},[A==null?void 0:A.zIndex]),u0(function(){H.inited&&(A==null?void 0:A.blend)&&H.setBlend(A.blend)},[A==null?void 0:A.blend]),u0(function(){I.render()}),se.createElement(JS.Provider,{value:H},se.createElement(_F,{layer:H,source:t}),l&&se.createElement(fF,{layer:H,scale:l}),n&&se.createElement(lF,{layer:H,color:n}),s&&se.createElement(dF,{layer:H,size:s}),i&&se.createElement(pF,{layer:H,shape:i}),a&&se.createElement(yF,{layer:H,style:a}),c&&se.createElement(sF,{layer:H,active:c}),p&&se.createElement(hF,{layer:H,select:p}),_&&se.createElement(cF,{layer:H,filter:_}),b&&se.createElement(uF,{layer:H,animate:b}),r.children)}var w8=null,C8=null,wF=se.memo(function(r){return tA("pointLayer",r)}),CF=se.memo(function(r){return tA("heatmapLayer",r)}),R8=null,M8=null,I8=null,P8=se.useEffect,O8=null,k8=null;function Uv(e){return Uv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Uv(e)}function rA(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function kg(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?rA(Object(t),!0).forEach(function(n){RF(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):rA(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function RF(e,r,t){return r=iA(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function MF(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function nA(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,iA(n.key),n)}}function IF(e,r,t){return r&&nA(e.prototype,r),t&&nA(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function iA(e){var r=PF(e,"string");return Uv(r)==="symbol"?r:String(r)}function PF(e,r){if(Uv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Uv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function OF(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&J_(e,r)}function J_(e,r){return J_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},J_(e,r)}function kF(e){var r=BF();return function(){var n=Dg(e),i;if(r){var a=Dg(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return DF(this,i)}}function DF(e,r){if(r&&(Uv(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LF(e)}function LF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function BF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Dg(e){return Dg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Dg(e)}var D8=function(e){OF(t,e);var r=kF(t);function t(n){var i;return MF(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.popup=void 0,i.el=document.createElement("div"),i}return IF(t,[{key:"componentDidMount",value:function(){var i,a=this.props,s=a.lnglat,l=a.children,c=a.option,p=a.lngLat,_=new B_(kg(kg({},c),{},{stopPropagation:(i=this.props.option)===null||i===void 0?void 0:i.stopPropagation}));s&&_.setLnglat(s),p&&_.setLnglat(p),l&&_.setHTML(this.el),this.popup=_,this.scene.addPopup(_)}},{key:"componentDidUpdate",value:function(i){var a,s,l,c,p,_,b=Array.isArray(i.lnglat)?i.lnglat:[i==null||(a=i.lnglat)===null||a===void 0?void 0:a.lng,i==null||(s=i.lnglat)===null||s===void 0?void 0:s.lat],A=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(c=l.lnglat)===null||c===void 0?void 0:c.lng,(p=this.props)===null||p===void 0||(_=p.lnglat)===null||_===void 0?void 0:_.lat],w=b.toString()!==A.toString();if(w){var I;this.popup.remove(),this.popup=new B_(kg(kg({},this.props.option),{},{stopPropagation:(I=this.props.option)===null||I===void 0?void 0:I.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var i=this;return se.createElement(y.Consumer,{},function(a){return a&&(i.scene=a),(0,$S.createPortal)(i.props.children,i.el)})}}]),t}(se.PureComponent);function zv(e){return zv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},zv(e)}function FF(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function aA(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,UF(n.key),n)}}function NF(e,r,t){return r&&aA(e.prototype,r),t&&aA(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function UF(e){var r=zF(e,"string");return zv(r)==="symbol"?r:String(r)}function zF(e,r){if(zv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(zv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function ZF(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&ey(e,r)}function ey(e,r){return ey=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},ey(e,r)}function VF(e){var r=WF();return function(){var n=Lg(e),i;if(r){var a=Lg(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return jF(this,i)}}function jF(e,r){if(r&&(zv(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return HF(e)}function HF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function WF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Lg(e){return Lg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Lg(e)}var L8=function(e){ZF(t,e);var r=VF(t);function t(n){var i;return FF(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.marker=void 0,i.el=document.createElement("div"),i}return NF(t,[{key:"componentDidMount",value:function(){var i=this.props,a=i.lnglat,s=i.children,l=i.option,c=i.onMarkerLoaded,p=new ax(l);a&&p.setLnglat(a),s&&p.setElement(this.el),this.marker=p,c&&c(p),this.scene.addMarker(p)}},{key:"componentDidUpdate",value:function(i){var a,s=JSON.stringify(i==null?void 0:i.lnglat)!==JSON.stringify((a=this.props)===null||a===void 0?void 0:a.lnglat);s&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var i=this;return se.createElement(y.Consumer,{},function(a){return a&&(i.scene=a),(0,$S.createPortal)(i.props.children,i.el)})}}]),t}(se.PureComponent),B8=se.useEffect,F8=null,N8=null,U8=se.useEffect,z8=null},66213:function(Sr,oe,Z){"use strict";Z.d(oe,{Z:function(){return y}});var ye=Z(77608);function se(de,V){for(;!Object.prototype.hasOwnProperty.call(de,V)&&(de=(0,ye.Z)(de),de!==null););return de}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(V,ce,ae){var Be=se(V,ce);if(!!Be){var ie=Object.getOwnPropertyDescriptor(Be,ce);return ie.get?ie.get.call(arguments.length<3?V:ae):ie.value}},y.apply(this,arguments)}},38163:function(Sr){Sr.exports=oe;function oe(se,y){var de=se&&se.type,V;if(de==="FeatureCollection")for(V=0;V<se.features.length;V++)oe(se.features[V],y);else if(de==="GeometryCollection")for(V=0;V<se.geometries.length;V++)oe(se.geometries[V],y);else if(de==="Feature")oe(se.geometry,y);else if(de==="Polygon")Z(se.coordinates,y);else if(de==="MultiPolygon")for(V=0;V<se.coordinates.length;V++)Z(se.coordinates[V],y);return se}function Z(se,y){if(se.length!==0){ye(se[0],y);for(var de=1;de<se.length;de++)ye(se[de],!y)}}function ye(se,y){for(var de=0,V=0,ce=0,ae=se.length,Be=ae-1;ce<ae;Be=ce++){var ie=(se[ce][0]-se[Be][0])*(se[Be][1]+se[ce][1]),Ve=de+ie;V+=Math.abs(de)>=Math.abs(ie)?de-Ve+ie:ie-Ve+de,de=Ve}de+V>=0!=!!y&&se.reverse()}},75550:function(Sr){"use strict";Sr.exports=oe;function oe(Z,ye){this.x=Z,this.y=ye}oe.prototype={clone:function(){return new oe(this.x,this.y)},add:function(Z){return this.clone()._add(Z)},sub:function(Z){return this.clone()._sub(Z)},multByPoint:function(Z){return this.clone()._multByPoint(Z)},divByPoint:function(Z){return this.clone()._divByPoint(Z)},mult:function(Z){return this.clone()._mult(Z)},div:function(Z){return this.clone()._div(Z)},rotate:function(Z){return this.clone()._rotate(Z)},rotateAround:function(Z,ye){return this.clone()._rotateAround(Z,ye)},matMult:function(Z){return this.clone()._matMult(Z)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(Z){return this.x===Z.x&&this.y===Z.y},dist:function(Z){return Math.sqrt(this.distSqr(Z))},distSqr:function(Z){var ye=Z.x-this.x,se=Z.y-this.y;return ye*ye+se*se},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(Z){return Math.atan2(this.y-Z.y,this.x-Z.x)},angleWith:function(Z){return this.angleWithSep(Z.x,Z.y)},angleWithSep:function(Z,ye){return Math.atan2(this.x*ye-this.y*Z,this.x*Z+this.y*ye)},_matMult:function(Z){var ye=Z[0]*this.x+Z[1]*this.y,se=Z[2]*this.x+Z[3]*this.y;return this.x=ye,this.y=se,this},_add:function(Z){return this.x+=Z.x,this.y+=Z.y,this},_sub:function(Z){return this.x-=Z.x,this.y-=Z.y,this},_mult:function(Z){return this.x*=Z,this.y*=Z,this},_div:function(Z){return this.x/=Z,this.y/=Z,this},_multByPoint:function(Z){return this.x*=Z.x,this.y*=Z.y,this},_divByPoint:function(Z){return this.x/=Z.x,this.y/=Z.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var Z=this.y;return this.y=this.x,this.x=-Z,this},_rotate:function(Z){var ye=Math.cos(Z),se=Math.sin(Z),y=ye*this.x-se*this.y,de=se*this.x+ye*this.y;return this.x=y,this.y=de,this},_rotateAround:function(Z,ye){var se=Math.cos(Z),y=Math.sin(Z),de=ye.x+se*(this.x-ye.x)-y*(this.y-ye.y),V=ye.y+y*(this.x-ye.x)+se*(this.y-ye.y);return this.x=de,this.y=V,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},oe.convert=function(Z){return Z instanceof oe?Z:Array.isArray(Z)?new oe(Z[0],Z[1]):Z}},49296:function(Sr){"use strict";Sr.exports=Z,Sr.exports.default=Z;var oe=1e20;function Z(V,ce,ae,Be,ie,Ve){this.fontSize=V||24,this.buffer=ce===void 0?3:ce,this.cutoff=Be||.25,this.fontFamily=ie||"sans-serif",this.fontWeight=Ve||"normal",this.radius=ae||8;var rt=this.size=this.fontSize+this.buffer*2,it=rt+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=rt,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(it*it),this.gridInner=new Float64Array(it*it),this.f=new Float64Array(it),this.z=new Float64Array(it+1),this.v=new Uint16Array(it),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(rt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ye(V,ce,ae,Be,ie,Ve,rt){Ve.fill(oe,0,ce*ae),rt.fill(0,0,ce*ae);for(var it=(ce-Be)/2,Ct=0;Ct<ie;Ct++)for(var Tt=0;Tt<Be;Tt++){var Xt=(Ct+it)*ce+Tt+it,ir=V.data[4*(Ct*Be+Tt)+3]/255;if(ir===1)Ve[Xt]=0,rt[Xt]=oe;else if(ir===0)Ve[Xt]=oe,rt[Xt]=0;else{var Ft=Math.max(0,.5-ir),Rt=Math.max(0,ir-.5);Ve[Xt]=Ft*Ft,rt[Xt]=Rt*Rt}}}function se(V,ce,ae,Be,ie,Ve,rt){for(var it=0;it<ce*ae;it++){var Ct=Math.sqrt(Be[it])-Math.sqrt(ie[it]);V[it]=Math.round(255-255*(Ct/Ve+rt))}}Z.prototype._draw=function(V,ce){var ae=this.ctx.measureText(V),Be=ae.width,ie=2*this.buffer,Ve,rt,it,Ct,Tt,Xt,ir,Ft;ce&&this.useMetrics?(Tt=Math.floor(ae.actualBoundingBoxAscent),Ft=this.buffer+Math.ceil(ae.actualBoundingBoxAscent),Xt=this.buffer,ir=this.buffer,rt=Math.min(this.size,Math.ceil(ae.actualBoundingBoxRight-ae.actualBoundingBoxLeft)),Ct=Math.min(this.size-Xt,Math.ceil(ae.actualBoundingBoxAscent+ae.actualBoundingBoxDescent)),Ve=rt+ie,it=Ct+ie,this.ctx.textBaseline="alphabetic"):(Ve=rt=this.size,it=Ct=this.size,Tt=19*this.fontSize/24,Xt=ir=0,Ft=this.middle,this.ctx.textBaseline="middle");var Rt;rt&&Ct&&(this.ctx.clearRect(ir,Xt,rt,Ct),this.ctx.fillText(V,this.buffer,Ft),Rt=this.ctx.getImageData(ir,Xt,rt,Ct));var xt=new Uint8ClampedArray(Ve*it);return ye(Rt,Ve,it,rt,Ct,this.gridOuter,this.gridInner),y(this.gridOuter,Ve,it,this.f,this.v,this.z),y(this.gridInner,Ve,it,this.f,this.v,this.z),se(xt,Ve,it,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:xt,metrics:{width:rt,height:Ct,sdfWidth:Ve,sdfHeight:it,top:Tt,left:0,advance:Be}}},Z.prototype.draw=function(V){return this._draw(V,!1).data},Z.prototype.drawWithMetrics=function(V){return this._draw(V,!0)};function y(V,ce,ae,Be,ie,Ve){for(var rt=0;rt<ce;rt++)de(V,rt,ce,ae,Be,ie,Ve);for(var it=0;it<ae;it++)de(V,it*ce,1,ce,Be,ie,Ve)}function de(V,ce,ae,Be,ie,Ve,rt){var it,Ct,Tt,Xt;for(Ve[0]=0,rt[0]=-oe,rt[1]=oe,it=0;it<Be;it++)ie[it]=V[ce+it*ae];for(it=1,Ct=0,Tt=0;it<Be;it++){do Xt=Ve[Ct],Tt=(ie[it]-ie[Xt]+it*it-Xt*Xt)/(it-Xt)/2;while(Tt<=rt[Ct]&&--Ct>-1);Ct++,Ve[Ct]=it,rt[Ct]=Tt,rt[Ct+1]=oe}for(it=0,Ct=0;it<Be;it++){for(;rt[Ct+1]<it;)Ct++;Xt=Ve[Ct],V[ce+it*ae]=ie[Xt]+(it-Xt)*(it-Xt)}}},38929:function(Sr,oe,Z){Sr.exports.VectorTile=Z(22779),Z(66024),Z(59701)},22779:function(Sr,oe,Z){"use strict";var ye=Z(59701);Sr.exports=se;function se(de,V){this.layers=de.readFields(y,{},V)}function y(de,V,ce){if(de===3){var ae=new ye(ce,ce.readVarint()+ce.pos);ae.length&&(V[ae.name]=ae)}}},66024:function(Sr,oe,Z){"use strict";var ye=Z(75550);Sr.exports=se;function se(ae,Be,ie,Ve,rt){this.properties={},this.extent=ie,this.type=0,this._pbf=ae,this._geometry=-1,this._keys=Ve,this._values=rt,ae.readFields(y,this,Be)}function y(ae,Be,ie){ae==1?Be.id=ie.readVarint():ae==2?de(ie,Be):ae==3?Be.type=ie.readVarint():ae==4&&(Be._geometry=ie.pos)}function de(ae,Be){for(var ie=ae.readVarint()+ae.pos;ae.pos<ie;){var Ve=Be._keys[ae.readVarint()],rt=Be._values[ae.readVarint()];Be.properties[Ve]=rt}}se.types=["Unknown","Point","LineString","Polygon"],se.prototype.loadGeometry=function(){var ae=this._pbf;ae.pos=this._geometry;for(var Be=ae.readVarint()+ae.pos,ie=1,Ve=0,rt=0,it=0,Ct=[],Tt;ae.pos<Be;){if(Ve<=0){var Xt=ae.readVarint();ie=Xt&7,Ve=Xt>>3}if(Ve--,ie===1||ie===2)rt+=ae.readSVarint(),it+=ae.readSVarint(),ie===1&&(Tt&&Ct.push(Tt),Tt=[]),Tt.push(new ye(rt,it));else if(ie===7)Tt&&Tt.push(Tt[0].clone());else throw new Error("unknown command "+ie)}return Tt&&Ct.push(Tt),Ct},se.prototype.bbox=function(){var ae=this._pbf;ae.pos=this._geometry;for(var Be=ae.readVarint()+ae.pos,ie=1,Ve=0,rt=0,it=0,Ct=Infinity,Tt=-Infinity,Xt=Infinity,ir=-Infinity;ae.pos<Be;){if(Ve<=0){var Ft=ae.readVarint();ie=Ft&7,Ve=Ft>>3}if(Ve--,ie===1||ie===2)rt+=ae.readSVarint(),it+=ae.readSVarint(),rt<Ct&&(Ct=rt),rt>Tt&&(Tt=rt),it<Xt&&(Xt=it),it>ir&&(ir=it);else if(ie!==7)throw new Error("unknown command "+ie)}return[Ct,Xt,Tt,ir]},se.prototype.toGeoJSON=function(ae,Be,ie){var Ve=this.extent*Math.pow(2,ie),rt=this.extent*ae,it=this.extent*Be,Ct=this.loadGeometry(),Tt=se.types[this.type],Xt,ir;function Ft(Zr){for(var Tr=0;Tr<Zr.length;Tr++){var dr=Zr[Tr],Mt=180-(dr.y+it)*360/Ve;Zr[Tr]=[(dr.x+rt)*360/Ve-180,360/Math.PI*Math.atan(Math.exp(Mt*Math.PI/180))-90]}}switch(this.type){case 1:var Rt=[];for(Xt=0;Xt<Ct.length;Xt++)Rt[Xt]=Ct[Xt][0];Ct=Rt,Ft(Ct);break;case 2:for(Xt=0;Xt<Ct.length;Xt++)Ft(Ct[Xt]);break;case 3:for(Ct=V(Ct),Xt=0;Xt<Ct.length;Xt++)for(ir=0;ir<Ct[Xt].length;ir++)Ft(Ct[Xt][ir]);break}Ct.length===1?Ct=Ct[0]:Tt="Multi"+Tt;var xt={type:"Feature",geometry:{type:Tt,coordinates:Ct},properties:this.properties};return"id"in this&&(xt.id=this.id),xt};function V(ae){var Be=ae.length;if(Be<=1)return[ae];for(var ie=[],Ve,rt,it=0;it<Be;it++){var Ct=ce(ae[it]);Ct!==0&&(rt===void 0&&(rt=Ct<0),rt===Ct<0?(Ve&&ie.push(Ve),Ve=[ae[it]]):Ve.push(ae[it]))}return Ve&&ie.push(Ve),ie}function ce(ae){for(var Be=0,ie=0,Ve=ae.length,rt=Ve-1,it,Ct;ie<Ve;rt=ie++)it=ae[ie],Ct=ae[rt],Be+=(Ct.x-it.x)*(it.y+Ct.y);return Be}},59701:function(Sr,oe,Z){"use strict";var ye=Z(66024);Sr.exports=se;function se(V,ce){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=V,this._keys=[],this._values=[],this._features=[],V.readFields(y,this,ce),this.length=this._features.length}function y(V,ce,ae){V===15?ce.version=ae.readVarint():V===1?ce.name=ae.readString():V===5?ce.extent=ae.readVarint():V===2?ce._features.push(ae.pos):V===3?ce._keys.push(ae.readString()):V===4&&ce._values.push(de(ae))}function de(V){for(var ce=null,ae=V.readVarint()+V.pos;V.pos<ae;){var Be=V.readVarint()>>3;ce=Be===1?V.readString():Be===2?V.readFloat():Be===3?V.readDouble():Be===4?V.readVarint64():Be===5?V.readVarint():Be===6?V.readSVarint():Be===7?V.readBoolean():null}return ce}se.prototype.feature=function(V){if(V<0||V>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[V];var ce=this._pbf.readVarint()+this._pbf.pos;return new ye(this._pbf,ce,this.extent,this._keys,this._values)}},53645:function(){},81903:function(){},7277:function(Sr,oe,Z){"use strict";Z.d(oe,{Z:function(){return ur}});var ye=Z(22122),se=Z(67294),y=Z(57838),de=Z(96159),V=Z(96156),ce=Z(94184),ae=Z.n(ce),Be=Z(53124),ie=Z(90860),Ve=Z(11726),rt=Z.n(Ve),it=function(te){var Ne=te.value,k=te.formatter,ke=te.precision,Re=te.decimalSeparator,ct=te.groupSeparator,Et=ct===void 0?"":ct,kt=te.prefixCls,er;if(typeof k=="function")er=k(Ne);else{var rr=String(Ne),fn=rr.match(/^(-?)(\d*)(\.(\d+))?$/);if(!fn||rr==="-")er=rr;else{var ar=fn[1],Dn=fn[2]||"0",hn=fn[4]||"";Dn=Dn.replace(/\B(?=(\d{3})+(?!\d))/g,Et),typeof ke=="number"&&(hn=rt()(hn,ke,"0").slice(0,ke>0?ke:0)),hn&&(hn="".concat(Re).concat(hn)),er=[se.createElement("span",{key:"int",className:"".concat(kt,"-content-value-int")},ar,Dn),hn&&se.createElement("span",{key:"decimal",className:"".concat(kt,"-content-value-decimal")},hn)]}}return se.createElement("span",{className:"".concat(kt,"-content-value")},er)},Ct=it,Tt=function(te){var Ne=te.prefixCls,k=te.className,ke=te.style,Re=te.valueStyle,ct=te.value,Et=ct===void 0?0:ct,kt=te.title,er=te.valueRender,rr=te.prefix,fn=te.suffix,ar=te.loading,Dn=ar===void 0?!1:ar,hn=te.direction,nn=te.onMouseEnter,ri=te.onMouseLeave,qn=te.decimalSeparator,En=qn===void 0?".":qn,Ti=te.groupSeparator,hi=Ti===void 0?",":Ti,ea=se.createElement(Ct,(0,ye.Z)({decimalSeparator:En,groupSeparator:hi},te,{value:Et})),Tn=ae()(Ne,(0,V.Z)({},"".concat(Ne,"-rtl"),hn==="rtl"),k);return se.createElement("div",{className:Tn,style:ke,onMouseEnter:nn,onMouseLeave:ri},kt&&se.createElement("div",{className:"".concat(Ne,"-title")},kt),se.createElement(ie.Z,{paragraph:!1,loading:Dn,className:"".concat(Ne,"-skeleton")},se.createElement("div",{style:Re,className:"".concat(Ne,"-content")},rr&&se.createElement("span",{className:"".concat(Ne,"-content-prefix")},rr),er?er(ea):ea,fn&&se.createElement("span",{className:"".concat(Ne,"-content-suffix")},fn))))},Xt=(0,Be.PG)({prefixCls:"statistic"})(Tt),ir=Xt,Ft=Z(28481),Rt=Z(32475),xt=Z.n(Rt),Zr=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function Tr(Ar,te){var Ne=Ar,k=/\[[^\]]*]/g,ke=(te.match(k)||[]).map(function(kt){return kt.slice(1,-1)}),Re=te.replace(k,"[]"),ct=Zr.reduce(function(kt,er){var rr=(0,Ft.Z)(er,2),fn=rr[0],ar=rr[1];if(kt.includes(fn)){var Dn=Math.floor(Ne/ar);return Ne-=Dn*ar,kt.replace(new RegExp("".concat(fn,"+"),"g"),function(hn){var nn=hn.length;return xt()(Dn.toString(),nn,"0")})}return kt},Re),Et=0;return ct.replace(k,function(){var kt=ke[Et];return Et+=1,kt})}function dr(Ar,te){var Ne=te.format,k=Ne===void 0?"":Ne,ke=new Date(Ar).getTime(),Re=Date.now(),ct=Math.max(ke-Re,0);return Tr(ct,k)}var Mt=1e3/30;function lt(Ar){return new Date(Ar).getTime()}var Bt=function(te){var Ne=te.value,k=te.format,ke=k===void 0?"HH:mm:ss":k,Re=te.onChange,ct=te.onFinish,Et=(0,y.Z)(),kt=se.useRef(null),er=function(){ct==null||ct(),kt.current&&(clearInterval(kt.current),kt.current=null)},rr=function(){var hn=lt(Ne);hn>=Date.now()&&(kt.current=setInterval(function(){Et(),Re==null||Re(hn-Date.now()),hn<Date.now()&&er()},Mt))};se.useEffect(function(){return rr(),function(){kt.current&&(clearInterval(kt.current),kt.current=null)}},[Ne]);var fn=function(hn,nn){return dr(hn,(0,ye.Z)((0,ye.Z)({},nn),{format:ke}))},ar=function(hn){return(0,de.Tm)(hn,{title:void 0})};return se.createElement(ir,(0,ye.Z)({},te,{valueRender:ar,formatter:fn}))},pt=se.memo(Bt);ir.Countdown=pt;var ur=ir},95300:function(Sr,oe,Z){"use strict";var ye=Z(38663),se=Z.n(ye),y=Z(81903),de=Z.n(y),V=Z(18446)},9187:function(Sr){"use strict";Sr.exports=oe,Sr.exports.default=oe;function oe(k,ke,Re){Re=Re||2;var ct=ke&&ke.length,Et=ct?ke[0]*Re:k.length,kt=Z(k,0,Et,Re,!0),er=[];if(!kt||kt.next===kt.prev)return er;var rr,fn,ar,Dn,hn,nn,ri;if(ct&&(kt=ae(k,ke,kt,Re)),k.length>80*Re){rr=ar=k[0],fn=Dn=k[1];for(var qn=Re;qn<Et;qn+=Re)hn=k[qn],nn=k[qn+1],hn<rr&&(rr=hn),nn<fn&&(fn=nn),hn>ar&&(ar=hn),nn>Dn&&(Dn=nn);ri=Math.max(ar-rr,Dn-fn),ri=ri!==0?32767/ri:0}return se(kt,er,Re,rr,fn,ri,0),er}function Z(k,ke,Re,ct,Et){var kt,er;if(Et===Ne(k,ke,Re,ct)>0)for(kt=ke;kt<Re;kt+=ct)er=ur(kt,k[kt],k[kt+1],er);else for(kt=Re-ct;kt>=ke;kt-=ct)er=ur(kt,k[kt],k[kt+1],er);return er&&xt(er,er.next)&&(Ar(er),er=er.next),er}function ye(k,ke){if(!k)return k;ke||(ke=k);var Re=k,ct;do if(ct=!1,!Re.steiner&&(xt(Re,Re.next)||Rt(Re.prev,Re,Re.next)===0)){if(Ar(Re),Re=ke=Re.prev,Re===Re.next)break;ct=!0}else Re=Re.next;while(ct||Re!==ke);return ke}function se(k,ke,Re,ct,Et,kt,er){if(!!k){!er&&kt&&it(k,ct,Et,kt);for(var rr=k,fn,ar;k.prev!==k.next;){if(fn=k.prev,ar=k.next,kt?de(k,ct,Et,kt):y(k)){ke.push(fn.i/Re|0),ke.push(k.i/Re|0),ke.push(ar.i/Re|0),Ar(k),k=ar.next,rr=ar.next;continue}if(k=ar,k===rr){er?er===1?(k=V(ye(k),ke,Re),se(k,ke,Re,ct,Et,kt,2)):er===2&&ce(k,ke,Re,ct,Et,kt):se(ye(k),ke,Re,ct,Et,kt,1);break}}}}function y(k){var ke=k.prev,Re=k,ct=k.next;if(Rt(ke,Re,ct)>=0)return!1;for(var Et=ke.x,kt=Re.x,er=ct.x,rr=ke.y,fn=Re.y,ar=ct.y,Dn=Et<kt?Et<er?Et:er:kt<er?kt:er,hn=rr<fn?rr<ar?rr:ar:fn<ar?fn:ar,nn=Et>kt?Et>er?Et:er:kt>er?kt:er,ri=rr>fn?rr>ar?rr:ar:fn>ar?fn:ar,qn=ct.next;qn!==ke;){if(qn.x>=Dn&&qn.x<=nn&&qn.y>=hn&&qn.y<=ri&&ir(Et,rr,kt,fn,er,ar,qn.x,qn.y)&&Rt(qn.prev,qn,qn.next)>=0)return!1;qn=qn.next}return!0}function de(k,ke,Re,ct){var Et=k.prev,kt=k,er=k.next;if(Rt(Et,kt,er)>=0)return!1;for(var rr=Et.x,fn=kt.x,ar=er.x,Dn=Et.y,hn=kt.y,nn=er.y,ri=rr<fn?rr<ar?rr:ar:fn<ar?fn:ar,qn=Dn<hn?Dn<nn?Dn:nn:hn<nn?hn:nn,En=rr>fn?rr>ar?rr:ar:fn>ar?fn:ar,Ti=Dn>hn?Dn>nn?Dn:nn:hn>nn?hn:nn,hi=Tt(ri,qn,ke,Re,ct),ea=Tt(En,Ti,ke,Re,ct),Tn=k.prevZ,kn=k.nextZ;Tn&&Tn.z>=hi&&kn&&kn.z<=ea;){if(Tn.x>=ri&&Tn.x<=En&&Tn.y>=qn&&Tn.y<=Ti&&Tn!==Et&&Tn!==er&&ir(rr,Dn,fn,hn,ar,nn,Tn.x,Tn.y)&&Rt(Tn.prev,Tn,Tn.next)>=0||(Tn=Tn.prevZ,kn.x>=ri&&kn.x<=En&&kn.y>=qn&&kn.y<=Ti&&kn!==Et&&kn!==er&&ir(rr,Dn,fn,hn,ar,nn,kn.x,kn.y)&&Rt(kn.prev,kn,kn.next)>=0))return!1;kn=kn.nextZ}for(;Tn&&Tn.z>=hi;){if(Tn.x>=ri&&Tn.x<=En&&Tn.y>=qn&&Tn.y<=Ti&&Tn!==Et&&Tn!==er&&ir(rr,Dn,fn,hn,ar,nn,Tn.x,Tn.y)&&Rt(Tn.prev,Tn,Tn.next)>=0)return!1;Tn=Tn.prevZ}for(;kn&&kn.z<=ea;){if(kn.x>=ri&&kn.x<=En&&kn.y>=qn&&kn.y<=Ti&&kn!==Et&&kn!==er&&ir(rr,Dn,fn,hn,ar,nn,kn.x,kn.y)&&Rt(kn.prev,kn,kn.next)>=0)return!1;kn=kn.nextZ}return!0}function V(k,ke,Re){var ct=k;do{var Et=ct.prev,kt=ct.next.next;!xt(Et,kt)&&Zr(Et,ct,ct.next,kt)&&lt(Et,kt)&&lt(kt,Et)&&(ke.push(Et.i/Re|0),ke.push(ct.i/Re|0),ke.push(kt.i/Re|0),Ar(ct),Ar(ct.next),ct=k=kt),ct=ct.next}while(ct!==k);return ye(ct)}function ce(k,ke,Re,ct,Et,kt){var er=k;do{for(var rr=er.next.next;rr!==er.prev;){if(er.i!==rr.i&&Ft(er,rr)){var fn=pt(er,rr);er=ye(er,er.next),fn=ye(fn,fn.next),se(er,ke,Re,ct,Et,kt,0),se(fn,ke,Re,ct,Et,kt,0);return}rr=rr.next}er=er.next}while(er!==k)}function ae(k,ke,Re,ct){var Et=[],kt,er,rr,fn,ar;for(kt=0,er=ke.length;kt<er;kt++)rr=ke[kt]*ct,fn=kt<er-1?ke[kt+1]*ct:k.length,ar=Z(k,rr,fn,ct,!1),ar===ar.next&&(ar.steiner=!0),Et.push(Xt(ar));for(Et.sort(Be),kt=0;kt<Et.length;kt++)Re=ie(Et[kt],Re);return Re}function Be(k,ke){return k.x-ke.x}function ie(k,ke){var Re=Ve(k,ke);if(!Re)return ke;var ct=pt(Re,k);return ye(ct,ct.next),ye(Re,Re.next)}function Ve(k,ke){var Re=ke,ct=k.x,Et=k.y,kt=-Infinity,er;do{if(Et<=Re.y&&Et>=Re.next.y&&Re.next.y!==Re.y){var rr=Re.x+(Et-Re.y)*(Re.next.x-Re.x)/(Re.next.y-Re.y);if(rr<=ct&&rr>kt&&(kt=rr,er=Re.x<Re.next.x?Re:Re.next,rr===ct))return er}Re=Re.next}while(Re!==ke);if(!er)return null;var fn=er,ar=er.x,Dn=er.y,hn=Infinity,nn;Re=er;do ct>=Re.x&&Re.x>=ar&&ct!==Re.x&&ir(Et<Dn?ct:kt,Et,ar,Dn,Et<Dn?kt:ct,Et,Re.x,Re.y)&&(nn=Math.abs(Et-Re.y)/(ct-Re.x),lt(Re,k)&&(nn<hn||nn===hn&&(Re.x>er.x||Re.x===er.x&&rt(er,Re)))&&(er=Re,hn=nn)),Re=Re.next;while(Re!==fn);return er}function rt(k,ke){return Rt(k.prev,k,ke.prev)<0&&Rt(ke.next,k,k.next)<0}function it(k,ke,Re,ct){var Et=k;do Et.z===0&&(Et.z=Tt(Et.x,Et.y,ke,Re,ct)),Et.prevZ=Et.prev,Et.nextZ=Et.next,Et=Et.next;while(Et!==k);Et.prevZ.nextZ=null,Et.prevZ=null,Ct(Et)}function Ct(k){var ke,Re,ct,Et,kt,er,rr,fn,ar=1;do{for(Re=k,k=null,kt=null,er=0;Re;){for(er++,ct=Re,rr=0,ke=0;ke<ar&&(rr++,ct=ct.nextZ,!!ct);ke++);for(fn=ar;rr>0||fn>0&&ct;)rr!==0&&(fn===0||!ct||Re.z<=ct.z)?(Et=Re,Re=Re.nextZ,rr--):(Et=ct,ct=ct.nextZ,fn--),kt?kt.nextZ=Et:k=Et,Et.prevZ=kt,kt=Et;Re=ct}kt.nextZ=null,ar*=2}while(er>1);return k}function Tt(k,ke,Re,ct,Et){return k=(k-Re)*Et|0,ke=(ke-ct)*Et|0,k=(k|k<<8)&16711935,k=(k|k<<4)&252645135,k=(k|k<<2)&858993459,k=(k|k<<1)&1431655765,ke=(ke|ke<<8)&16711935,ke=(ke|ke<<4)&252645135,ke=(ke|ke<<2)&858993459,ke=(ke|ke<<1)&1431655765,k|ke<<1}function Xt(k){var ke=k,Re=k;do(ke.x<Re.x||ke.x===Re.x&&ke.y<Re.y)&&(Re=ke),ke=ke.next;while(ke!==k);return Re}function ir(k,ke,Re,ct,Et,kt,er,rr){return(Et-er)*(ke-rr)>=(k-er)*(kt-rr)&&(k-er)*(ct-rr)>=(Re-er)*(ke-rr)&&(Re-er)*(kt-rr)>=(Et-er)*(ct-rr)}function Ft(k,ke){return k.next.i!==ke.i&&k.prev.i!==ke.i&&!Mt(k,ke)&&(lt(k,ke)&&lt(ke,k)&&Bt(k,ke)&&(Rt(k.prev,k,ke.prev)||Rt(k,ke.prev,ke))||xt(k,ke)&&Rt(k.prev,k,k.next)>0&&Rt(ke.prev,ke,ke.next)>0)}function Rt(k,ke,Re){return(ke.y-k.y)*(Re.x-ke.x)-(ke.x-k.x)*(Re.y-ke.y)}function xt(k,ke){return k.x===ke.x&&k.y===ke.y}function Zr(k,ke,Re,ct){var Et=dr(Rt(k,ke,Re)),kt=dr(Rt(k,ke,ct)),er=dr(Rt(Re,ct,k)),rr=dr(Rt(Re,ct,ke));return!!(Et!==kt&&er!==rr||Et===0&&Tr(k,Re,ke)||kt===0&&Tr(k,ct,ke)||er===0&&Tr(Re,k,ct)||rr===0&&Tr(Re,ke,ct))}function Tr(k,ke,Re){return ke.x<=Math.max(k.x,Re.x)&&ke.x>=Math.min(k.x,Re.x)&&ke.y<=Math.max(k.y,Re.y)&&ke.y>=Math.min(k.y,Re.y)}function dr(k){return k>0?1:k<0?-1:0}function Mt(k,ke){var Re=k;do{if(Re.i!==k.i&&Re.next.i!==k.i&&Re.i!==ke.i&&Re.next.i!==ke.i&&Zr(Re,Re.next,k,ke))return!0;Re=Re.next}while(Re!==k);return!1}function lt(k,ke){return Rt(k.prev,k,k.next)<0?Rt(k,ke,k.next)>=0&&Rt(k,k.prev,ke)>=0:Rt(k,ke,k.prev)<0||Rt(k,k.next,ke)<0}function Bt(k,ke){var Re=k,ct=!1,Et=(k.x+ke.x)/2,kt=(k.y+ke.y)/2;do Re.y>kt!=Re.next.y>kt&&Re.next.y!==Re.y&&Et<(Re.next.x-Re.x)*(kt-Re.y)/(Re.next.y-Re.y)+Re.x&&(ct=!ct),Re=Re.next;while(Re!==k);return ct}function pt(k,ke){var Re=new te(k.i,k.x,k.y),ct=new te(ke.i,ke.x,ke.y),Et=k.next,kt=ke.prev;return k.next=ke,ke.prev=k,Re.next=Et,Et.prev=Re,ct.next=Re,Re.prev=ct,kt.next=ct,ct.prev=kt,ct}function ur(k,ke,Re,ct){var Et=new te(k,ke,Re);return ct?(Et.next=ct.next,Et.prev=ct,ct.next.prev=Et,ct.next=Et):(Et.prev=Et,Et.next=Et),Et}function Ar(k){k.next.prev=k.prev,k.prev.next=k.next,k.prevZ&&(k.prevZ.nextZ=k.nextZ),k.nextZ&&(k.nextZ.prevZ=k.prevZ)}function te(k,ke,Re){this.i=k,this.x=ke,this.y=Re,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}oe.deviation=function(k,ke,Re,ct){var Et=ke&&ke.length,kt=Et?ke[0]*Re:k.length,er=Math.abs(Ne(k,0,kt,Re));if(Et)for(var rr=0,fn=ke.length;rr<fn;rr++){var ar=ke[rr]*Re,Dn=rr<fn-1?ke[rr+1]*Re:k.length;er-=Math.abs(Ne(k,ar,Dn,Re))}var hn=0;for(rr=0;rr<ct.length;rr+=3){var nn=ct[rr]*Re,ri=ct[rr+1]*Re,qn=ct[rr+2]*Re;hn+=Math.abs((k[nn]-k[qn])*(k[ri+1]-k[nn+1])-(k[nn]-k[ri])*(k[qn+1]-k[nn+1]))}return er===0&&hn===0?0:Math.abs((hn-er)/er)};function Ne(k,ke,Re,ct){for(var Et=0,kt=ke,er=Re-ct;kt<Re;kt+=ct)Et+=(k[er]-k[kt])*(k[kt+1]+k[er+1]),er=kt;return Et}oe.flatten=function(k){for(var ke=k[0][0].length,Re={vertices:[],holes:[],dimensions:ke},ct=0,Et=0;Et<k.length;Et++){for(var kt=0;kt<k[Et].length;kt++)for(var er=0;er<ke;er++)Re.vertices.push(k[Et][kt][er]);Et>0&&(ct+=k[Et-1].length,Re.holes.push(ct))}return Re}},67709:function(Sr){function oe(ye){var se=ye.target||ye.srcElement;se.__resizeRAF__&&cancelAnimationFrame(se.__resizeRAF__),se.__resizeRAF__=requestAnimationFrame(function(){var y=se.__resizeTrigger__,de=y&&y.__resizeListeners__;de&&de.forEach(function(V){V.call(y,ye)})})}var Z=function(se,y){var de=this,V=de.document,ce,ae=V.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Be(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",oe)}if(!se.__resizeListeners__)if(se.__resizeListeners__=[],ae)se.__resizeTrigger__=se,se.attachEvent("onresize",oe);else{getComputedStyle(se).position==="static"&&(se.style.position="relative");var ie=se.__resizeTrigger__=V.createElement("object");ie.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ie.setAttribute("class","resize-sensor"),ie.setAttribute("tabindex","-1"),ie.setAttribute("title",""),ie.__resizeElement__=se,ie.onload=Be,ie.type="text/html",ce&&se.appendChild(ie),ie.data="about:blank",ce||se.appendChild(ie)}se.__resizeListeners__.push(y)};Sr.exports=typeof window=="undefined"?Z:Z.bind(window),Sr.exports.unbind=function(ye,se){var y=document.attachEvent,de=ye.__resizeListeners__||[];if(se){var V=de.indexOf(se);V!==-1&&de.splice(V,1)}else de=ye.__resizeListeners__=[];if(!de.length){if(y)ye.detachEvent("onresize",oe);else if(ye.__resizeTrigger__){var ce=ye.__resizeTrigger__.contentDocument,ae=ce&&ce.defaultView;ae&&(ae.removeEventListener("resize",oe),delete ae.__resizeTrigger__),ye.__resizeTrigger__=!ye.removeChild(ye.__resizeTrigger__)}delete ye.__resizeListeners__}}},26729:function(Sr){"use strict";var oe=Object.prototype.hasOwnProperty,Z="~";function ye(){}Object.create&&(ye.prototype=Object.create(null),new ye().__proto__||(Z=!1));function se(ce,ae,Be){this.fn=ce,this.context=ae,this.once=Be||!1}function y(ce,ae,Be,ie,Ve){if(typeof Be!="function")throw new TypeError("The listener must be a function");var rt=new se(Be,ie||ce,Ve),it=Z?Z+ae:ae;return ce._events[it]?ce._events[it].fn?ce._events[it]=[ce._events[it],rt]:ce._events[it].push(rt):(ce._events[it]=rt,ce._eventsCount++),ce}function de(ce,ae){--ce._eventsCount==0?ce._events=new ye:delete ce._events[ae]}function V(){this._events=new ye,this._eventsCount=0}V.prototype.eventNames=function(){var ae=[],Be,ie;if(this._eventsCount===0)return ae;for(ie in Be=this._events)oe.call(Be,ie)&&ae.push(Z?ie.slice(1):ie);return Object.getOwnPropertySymbols?ae.concat(Object.getOwnPropertySymbols(Be)):ae},V.prototype.listeners=function(ae){var Be=Z?Z+ae:ae,ie=this._events[Be];if(!ie)return[];if(ie.fn)return[ie.fn];for(var Ve=0,rt=ie.length,it=new Array(rt);Ve<rt;Ve++)it[Ve]=ie[Ve].fn;return it},V.prototype.listenerCount=function(ae){var Be=Z?Z+ae:ae,ie=this._events[Be];return ie?ie.fn?1:ie.length:0},V.prototype.emit=function(ae,Be,ie,Ve,rt,it){var Ct=Z?Z+ae:ae;if(!this._events[Ct])return!1;var Tt=this._events[Ct],Xt=arguments.length,ir,Ft;if(Tt.fn){switch(Tt.once&&this.removeListener(ae,Tt.fn,void 0,!0),Xt){case 1:return Tt.fn.call(Tt.context),!0;case 2:return Tt.fn.call(Tt.context,Be),!0;case 3:return Tt.fn.call(Tt.context,Be,ie),!0;case 4:return Tt.fn.call(Tt.context,Be,ie,Ve),!0;case 5:return Tt.fn.call(Tt.context,Be,ie,Ve,rt),!0;case 6:return Tt.fn.call(Tt.context,Be,ie,Ve,rt,it),!0}for(Ft=1,ir=new Array(Xt-1);Ft<Xt;Ft++)ir[Ft-1]=arguments[Ft];Tt.fn.apply(Tt.context,ir)}else{var Rt=Tt.length,xt;for(Ft=0;Ft<Rt;Ft++)switch(Tt[Ft].once&&this.removeListener(ae,Tt[Ft].fn,void 0,!0),Xt){case 1:Tt[Ft].fn.call(Tt[Ft].context);break;case 2:Tt[Ft].fn.call(Tt[Ft].context,Be);break;case 3:Tt[Ft].fn.call(Tt[Ft].context,Be,ie);break;case 4:Tt[Ft].fn.call(Tt[Ft].context,Be,ie,Ve);break;default:if(!ir)for(xt=1,ir=new Array(Xt-1);xt<Xt;xt++)ir[xt-1]=arguments[xt];Tt[Ft].fn.apply(Tt[Ft].context,ir)}}return!0},V.prototype.on=function(ae,Be,ie){return y(this,ae,Be,ie,!1)},V.prototype.once=function(ae,Be,ie){return y(this,ae,Be,ie,!0)},V.prototype.removeListener=function(ae,Be,ie,Ve){var rt=Z?Z+ae:ae;if(!this._events[rt])return this;if(!Be)return de(this,rt),this;var it=this._events[rt];if(it.fn)it.fn===Be&&(!Ve||it.once)&&(!ie||it.context===ie)&&de(this,rt);else{for(var Ct=0,Tt=[],Xt=it.length;Ct<Xt;Ct++)(it[Ct].fn!==Be||Ve&&!it[Ct].once||ie&&it[Ct].context!==ie)&&Tt.push(it[Ct]);Tt.length?this._events[rt]=Tt.length===1?Tt[0]:Tt:de(this,rt)}return this},V.prototype.removeAllListeners=function(ae){var Be;return ae?(Be=Z?Z+ae:ae,this._events[Be]&&de(this,Be)):(this._events=new ye,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=Z,V.EventEmitter=V,Sr.exports=V},50840:function(Sr,oe,Z){var ye;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(se,y,de,V){"use strict";var ce=["","webkit","Moz","MS","ms","o"],ae=y.createElement("div"),Be="function",ie=Math.round,Ve=Math.abs,rt=Date.now;function it(re,Oe,dt){return setTimeout(Zr(re,dt),Oe)}function Ct(re,Oe,dt){return Array.isArray(re)?(Tt(re,dt[Oe],dt),!0):!1}function Tt(re,Oe,dt){var lr;if(!!re)if(re.forEach)re.forEach(Oe,dt);else if(re.length!==V)for(lr=0;lr<re.length;)Oe.call(dt,re[lr],lr,re),lr++;else for(lr in re)re.hasOwnProperty(lr)&&Oe.call(dt,re[lr],lr,re)}function Xt(re,Oe,dt){var lr="DEPRECATED METHOD: "+Oe+`
`+dt+` AT 
`;return function(){var Kr=new Error("get-stack-trace"),Pn=Kr&&Kr.stack?Kr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Zi=se.console&&(se.console.warn||se.console.log);return Zi&&Zi.call(se.console,lr,Pn),re.apply(this,arguments)}}var ir;typeof Object.assign!="function"?ir=function(Oe){if(Oe===V||Oe===null)throw new TypeError("Cannot convert undefined or null to object");for(var dt=Object(Oe),lr=1;lr<arguments.length;lr++){var Kr=arguments[lr];if(Kr!==V&&Kr!==null)for(var Pn in Kr)Kr.hasOwnProperty(Pn)&&(dt[Pn]=Kr[Pn])}return dt}:ir=Object.assign;var Ft=Xt(function(Oe,dt,lr){for(var Kr=Object.keys(dt),Pn=0;Pn<Kr.length;)(!lr||lr&&Oe[Kr[Pn]]===V)&&(Oe[Kr[Pn]]=dt[Kr[Pn]]),Pn++;return Oe},"extend","Use `assign`."),Rt=Xt(function(Oe,dt){return Ft(Oe,dt,!0)},"merge","Use `assign`.");function xt(re,Oe,dt){var lr=Oe.prototype,Kr;Kr=re.prototype=Object.create(lr),Kr.constructor=re,Kr._super=lr,dt&&ir(Kr,dt)}function Zr(re,Oe){return function(){return re.apply(Oe,arguments)}}function Tr(re,Oe){return typeof re==Be?re.apply(Oe&&Oe[0]||V,Oe):re}function dr(re,Oe){return re===V?Oe:re}function Mt(re,Oe,dt){Tt(ur(Oe),function(lr){re.addEventListener(lr,dt,!1)})}function lt(re,Oe,dt){Tt(ur(Oe),function(lr){re.removeEventListener(lr,dt,!1)})}function Bt(re,Oe){for(;re;){if(re==Oe)return!0;re=re.parentNode}return!1}function pt(re,Oe){return re.indexOf(Oe)>-1}function ur(re){return re.trim().split(/\s+/g)}function Ar(re,Oe,dt){if(re.indexOf&&!dt)return re.indexOf(Oe);for(var lr=0;lr<re.length;){if(dt&&re[lr][dt]==Oe||!dt&&re[lr]===Oe)return lr;lr++}return-1}function te(re){return Array.prototype.slice.call(re,0)}function Ne(re,Oe,dt){for(var lr=[],Kr=[],Pn=0;Pn<re.length;){var Zi=Oe?re[Pn][Oe]:re[Pn];Ar(Kr,Zi)<0&&lr.push(re[Pn]),Kr[Pn]=Zi,Pn++}return dt&&(Oe?lr=lr.sort(function(Eo,ao){return Eo[Oe]>ao[Oe]}):lr=lr.sort()),lr}function k(re,Oe){for(var dt,lr,Kr=Oe[0].toUpperCase()+Oe.slice(1),Pn=0;Pn<ce.length;){if(dt=ce[Pn],lr=dt?dt+Kr:Oe,lr in re)return lr;Pn++}return V}var ke=1;function Re(){return ke++}function ct(re){var Oe=re.ownerDocument||re;return Oe.defaultView||Oe.parentWindow||se}var Et=/mobile|tablet|ip(ad|hone|od)|android/i,kt="ontouchstart"in se,er=k(se,"PointerEvent")!==V,rr=kt&&Et.test(navigator.userAgent),fn="touch",ar="pen",Dn="mouse",hn="kinect",nn=25,ri=1,qn=2,En=4,Ti=8,hi=1,ea=2,Tn=4,kn=8,Ea=16,ji=ea|Tn,ja=kn|Ea,Ha=ji|ja,Me=["x","y"],Wa=["clientX","clientY"];function sa(re,Oe){var dt=this;this.manager=re,this.callback=Oe,this.element=re.element,this.target=re.options.inputTarget,this.domHandler=function(lr){Tr(re.options.enable,[re])&&dt.handler(lr)},this.init()}sa.prototype={handler:function(){},init:function(){this.evEl&&Mt(this.element,this.evEl,this.domHandler),this.evTarget&&Mt(this.target,this.evTarget,this.domHandler),this.evWin&&Mt(ct(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&lt(this.element,this.evEl,this.domHandler),this.evTarget&&lt(this.target,this.evTarget,this.domHandler),this.evWin&&lt(ct(this.element),this.evWin,this.domHandler)}};function eo(re){var Oe,dt=re.options.inputClass;return dt?Oe=dt:er?Oe=F:rr?Oe=ge:kt?Oe=vr:Oe=Zt,new Oe(re,Ws)}function Ws(re,Oe,dt){var lr=dt.pointers.length,Kr=dt.changedPointers.length,Pn=Oe&ri&&lr-Kr==0,Zi=Oe&(En|Ti)&&lr-Kr==0;dt.isFirst=!!Pn,dt.isFinal=!!Zi,Pn&&(re.session={}),dt.eventType=Oe,xs(re,dt),re.emit("hammer.input",dt),re.recognize(dt),re.session.prevInput=dt}function xs(re,Oe){var dt=re.session,lr=Oe.pointers,Kr=lr.length;dt.firstInput||(dt.firstInput=gr(Oe)),Kr>1&&!dt.firstMultiple?dt.firstMultiple=gr(Oe):Kr===1&&(dt.firstMultiple=!1);var Pn=dt.firstInput,Zi=dt.firstMultiple,lo=Zi?Zi.center:Pn.center,Eo=Oe.center=Gr(lr);Oe.timeStamp=rt(),Oe.deltaTime=Oe.timeStamp-Pn.timeStamp,Oe.angle=fe(lo,Eo),Oe.distance=Hi(lo,Eo),bs(dt,Oe),Oe.offsetDirection=Zn(Oe.deltaX,Oe.deltaY);var ao=an(Oe.deltaTime,Oe.deltaX,Oe.deltaY);Oe.overallVelocityX=ao.x,Oe.overallVelocityY=ao.y,Oe.overallVelocity=Ve(ao.x)>Ve(ao.y)?ao.x:ao.y,Oe.scale=Zi?z(Zi.pointers,lr):1,Oe.rotation=Zi?D(Zi.pointers,lr):0,Oe.maxPointers=dt.prevInput?Oe.pointers.length>dt.prevInput.maxPointers?Oe.pointers.length:dt.prevInput.maxPointers:Oe.pointers.length,Vt(dt,Oe);var Cs=re.element;Bt(Oe.srcEvent.target,Cs)&&(Cs=Oe.srcEvent.target),Oe.target=Cs}function bs(re,Oe){var dt=Oe.center,lr=re.offsetDelta||{},Kr=re.prevDelta||{},Pn=re.prevInput||{};(Oe.eventType===ri||Pn.eventType===En)&&(Kr=re.prevDelta={x:Pn.deltaX||0,y:Pn.deltaY||0},lr=re.offsetDelta={x:dt.x,y:dt.y}),Oe.deltaX=Kr.x+(dt.x-lr.x),Oe.deltaY=Kr.y+(dt.y-lr.y)}function Vt(re,Oe){var dt=re.lastInterval||Oe,lr=Oe.timeStamp-dt.timeStamp,Kr,Pn,Zi,lo;if(Oe.eventType!=Ti&&(lr>nn||dt.velocity===V)){var Eo=Oe.deltaX-dt.deltaX,ao=Oe.deltaY-dt.deltaY,Cs=an(lr,Eo,ao);Pn=Cs.x,Zi=Cs.y,Kr=Ve(Cs.x)>Ve(Cs.y)?Cs.x:Cs.y,lo=Zn(Eo,ao),re.lastInterval=Oe}else Kr=dt.velocity,Pn=dt.velocityX,Zi=dt.velocityY,lo=dt.direction;Oe.velocity=Kr,Oe.velocityX=Pn,Oe.velocityY=Zi,Oe.direction=lo}function gr(re){for(var Oe=[],dt=0;dt<re.pointers.length;)Oe[dt]={clientX:ie(re.pointers[dt].clientX),clientY:ie(re.pointers[dt].clientY)},dt++;return{timeStamp:rt(),pointers:Oe,center:Gr(Oe),deltaX:re.deltaX,deltaY:re.deltaY}}function Gr(re){var Oe=re.length;if(Oe===1)return{x:ie(re[0].clientX),y:ie(re[0].clientY)};for(var dt=0,lr=0,Kr=0;Kr<Oe;)dt+=re[Kr].clientX,lr+=re[Kr].clientY,Kr++;return{x:ie(dt/Oe),y:ie(lr/Oe)}}function an(re,Oe,dt){return{x:Oe/re||0,y:dt/re||0}}function Zn(re,Oe){return re===Oe?hi:Ve(re)>=Ve(Oe)?re<0?ea:Tn:Oe<0?kn:Ea}function Hi(re,Oe,dt){dt||(dt=Me);var lr=Oe[dt[0]]-re[dt[0]],Kr=Oe[dt[1]]-re[dt[1]];return Math.sqrt(lr*lr+Kr*Kr)}function fe(re,Oe,dt){dt||(dt=Me);var lr=Oe[dt[0]]-re[dt[0]],Kr=Oe[dt[1]]-re[dt[1]];return Math.atan2(Kr,lr)*180/Math.PI}function D(re,Oe){return fe(Oe[1],Oe[0],Wa)+fe(re[1],re[0],Wa)}function z(re,Oe){return Hi(Oe[0],Oe[1],Wa)/Hi(re[0],re[1],Wa)}var ne={mousedown:ri,mousemove:qn,mouseup:En},Ae="mousedown",De="mousemove mouseup";function Zt(){this.evEl=Ae,this.evWin=De,this.pressed=!1,sa.apply(this,arguments)}xt(Zt,sa,{handler:function(Oe){var dt=ne[Oe.type];dt&ri&&Oe.button===0&&(this.pressed=!0),dt&qn&&Oe.which!==1&&(dt=En),!!this.pressed&&(dt&En&&(this.pressed=!1),this.callback(this.manager,dt,{pointers:[Oe],changedPointers:[Oe],pointerType:Dn,srcEvent:Oe}))}});var St={pointerdown:ri,pointermove:qn,pointerup:En,pointercancel:Ti,pointerout:Ti},At={2:fn,3:ar,4:Dn,5:hn},mt="pointerdown",U="pointermove pointerup pointercancel";se.MSPointerEvent&&!se.PointerEvent&&(mt="MSPointerDown",U="MSPointerMove MSPointerUp MSPointerCancel");function F(){this.evEl=mt,this.evWin=U,sa.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}xt(F,sa,{handler:function(Oe){var dt=this.store,lr=!1,Kr=Oe.type.toLowerCase().replace("ms",""),Pn=St[Kr],Zi=At[Oe.pointerType]||Oe.pointerType,lo=Zi==fn,Eo=Ar(dt,Oe.pointerId,"pointerId");Pn&ri&&(Oe.button===0||lo)?Eo<0&&(dt.push(Oe),Eo=dt.length-1):Pn&(En|Ti)&&(lr=!0),!(Eo<0)&&(dt[Eo]=Oe,this.callback(this.manager,Pn,{pointers:dt,changedPointers:[Oe],pointerType:Zi,srcEvent:Oe}),lr&&dt.splice(Eo,1))}});var X={touchstart:ri,touchmove:qn,touchend:En,touchcancel:Ti},ee="touchstart",Se="touchstart touchmove touchend touchcancel";function Ue(){this.evTarget=ee,this.evWin=Se,this.started=!1,sa.apply(this,arguments)}xt(Ue,sa,{handler:function(Oe){var dt=X[Oe.type];if(dt===ri&&(this.started=!0),!!this.started){var lr=Je.call(this,Oe,dt);dt&(En|Ti)&&lr[0].length-lr[1].length==0&&(this.started=!1),this.callback(this.manager,dt,{pointers:lr[0],changedPointers:lr[1],pointerType:fn,srcEvent:Oe})}}});function Je(re,Oe){var dt=te(re.touches),lr=te(re.changedTouches);return Oe&(En|Ti)&&(dt=Ne(dt.concat(lr),"identifier",!0)),[dt,lr]}var he={touchstart:ri,touchmove:qn,touchend:En,touchcancel:Ti},K="touchstart touchmove touchend touchcancel";function ge(){this.evTarget=K,this.targetIds={},sa.apply(this,arguments)}xt(ge,sa,{handler:function(Oe){var dt=he[Oe.type],lr=Qe.call(this,Oe,dt);!lr||this.callback(this.manager,dt,{pointers:lr[0],changedPointers:lr[1],pointerType:fn,srcEvent:Oe})}});function Qe(re,Oe){var dt=te(re.touches),lr=this.targetIds;if(Oe&(ri|qn)&&dt.length===1)return lr[dt[0].identifier]=!0,[dt,dt];var Kr,Pn,Zi=te(re.changedTouches),lo=[],Eo=this.target;if(Pn=dt.filter(function(ao){return Bt(ao.target,Eo)}),Oe===ri)for(Kr=0;Kr<Pn.length;)lr[Pn[Kr].identifier]=!0,Kr++;for(Kr=0;Kr<Zi.length;)lr[Zi[Kr].identifier]&&lo.push(Zi[Kr]),Oe&(En|Ti)&&delete lr[Zi[Kr].identifier],Kr++;if(!!lo.length)return[Ne(Pn.concat(lo),"identifier",!0),lo]}var gt=2500,pe=25;function vr(){sa.apply(this,arguments);var re=Zr(this.handler,this);this.touch=new ge(this.manager,re),this.mouse=new Zt(this.manager,re),this.primaryTouch=null,this.lastTouches=[]}xt(vr,sa,{handler:function(Oe,dt,lr){var Kr=lr.pointerType==fn,Pn=lr.pointerType==Dn;if(!(Pn&&lr.sourceCapabilities&&lr.sourceCapabilities.firesTouchEvents)){if(Kr)en.call(this,dt,lr);else if(Pn&&Kt.call(this,lr))return;this.callback(Oe,dt,lr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function en(re,Oe){re&ri?(this.primaryTouch=Oe.changedPointers[0].identifier,tn.call(this,Oe)):re&(En|Ti)&&tn.call(this,Oe)}function tn(re){var Oe=re.changedPointers[0];if(Oe.identifier===this.primaryTouch){var dt={x:Oe.clientX,y:Oe.clientY};this.lastTouches.push(dt);var lr=this.lastTouches,Kr=function(){var Pn=lr.indexOf(dt);Pn>-1&&lr.splice(Pn,1)};setTimeout(Kr,gt)}}function Kt(re){for(var Oe=re.srcEvent.clientX,dt=re.srcEvent.clientY,lr=0;lr<this.lastTouches.length;lr++){var Kr=this.lastTouches[lr],Pn=Math.abs(Oe-Kr.x),Zi=Math.abs(dt-Kr.y);if(Pn<=pe&&Zi<=pe)return!0}return!1}var $r=k(ae.style,"touchAction"),Br=$r!==V,jr="compute",ni="auto",on="manipulation",di="none",Fi="pan-x",mi="pan-y",Ci=Ki();function Ri(re,Oe){this.manager=re,this.set(Oe)}Ri.prototype={set:function(re){re==jr&&(re=this.compute()),Br&&this.manager.element.style&&Ci[re]&&(this.manager.element.style[$r]=re),this.actions=re.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var re=[];return Tt(this.manager.recognizers,function(Oe){Tr(Oe.options.enable,[Oe])&&(re=re.concat(Oe.getTouchAction()))}),bo(re.join(" "))},preventDefaults:function(re){var Oe=re.srcEvent,dt=re.offsetDirection;if(this.manager.session.prevented){Oe.preventDefault();return}var lr=this.actions,Kr=pt(lr,di)&&!Ci[di],Pn=pt(lr,mi)&&!Ci[mi],Zi=pt(lr,Fi)&&!Ci[Fi];if(Kr){var lo=re.pointers.length===1,Eo=re.distance<2,ao=re.deltaTime<250;if(lo&&Eo&&ao)return}if(!(Zi&&Pn)&&(Kr||Pn&&dt&ji||Zi&&dt&ja))return this.preventSrc(Oe)},preventSrc:function(re){this.manager.session.prevented=!0,re.preventDefault()}};function bo(re){if(pt(re,di))return di;var Oe=pt(re,Fi),dt=pt(re,mi);return Oe&&dt?di:Oe||dt?Oe?Fi:mi:pt(re,on)?on:ni}function Ki(){if(!Br)return!1;var re={},Oe=se.CSS&&se.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(dt){re[dt]=Oe?se.CSS.supports("touch-action",dt):!0}),re}var Sa=1,Mi=2,gi=4,Ei=8,wa=Ei,Gs=16,fa=32;function Ca(re){this.options=ir({},this.defaults,re||{}),this.id=Re(),this.manager=null,this.options.enable=dr(this.options.enable,!0),this.state=Sa,this.simultaneous={},this.requireFail=[]}Ca.prototype={defaults:{},set:function(re){return ir(this.options,re),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(re){if(Ct(re,"recognizeWith",this))return this;var Oe=this.simultaneous;return re=_a(re,this),Oe[re.id]||(Oe[re.id]=re,re.recognizeWith(this)),this},dropRecognizeWith:function(re){return Ct(re,"dropRecognizeWith",this)?this:(re=_a(re,this),delete this.simultaneous[re.id],this)},requireFailure:function(re){if(Ct(re,"requireFailure",this))return this;var Oe=this.requireFail;return re=_a(re,this),Ar(Oe,re)===-1&&(Oe.push(re),re.requireFailure(this)),this},dropRequireFailure:function(re){if(Ct(re,"dropRequireFailure",this))return this;re=_a(re,this);var Oe=Ar(this.requireFail,re);return Oe>-1&&this.requireFail.splice(Oe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(re){return!!this.simultaneous[re.id]},emit:function(re){var Oe=this,dt=this.state;function lr(Kr){Oe.manager.emit(Kr,re)}dt<Ei&&lr(Oe.options.event+Ju(dt)),lr(Oe.options.event),re.additionalEvent&&lr(re.additionalEvent),dt>=Ei&&lr(Oe.options.event+Ju(dt))},tryEmit:function(re){if(this.canEmit())return this.emit(re);this.state=fa},canEmit:function(){for(var re=0;re<this.requireFail.length;){if(!(this.requireFail[re].state&(fa|Sa)))return!1;re++}return!0},recognize:function(re){var Oe=ir({},re);if(!Tr(this.options.enable,[this,Oe])){this.reset(),this.state=fa;return}this.state&(wa|Gs|fa)&&(this.state=Sa),this.state=this.process(Oe),this.state&(Mi|gi|Ei|Gs)&&this.tryEmit(Oe)},process:function(re){},getTouchAction:function(){},reset:function(){}};function Ju(re){return re&Gs?"cancel":re&Ei?"end":re&gi?"move":re&Mi?"start":""}function iu(re){return re==Ea?"down":re==kn?"up":re==ea?"left":re==Tn?"right":""}function _a(re,Oe){var dt=Oe.manager;return dt?dt.get(re):re}function os(){Ca.apply(this,arguments)}xt(os,Ca,{defaults:{pointers:1},attrTest:function(re){var Oe=this.options.pointers;return Oe===0||re.pointers.length===Oe},process:function(re){var Oe=this.state,dt=re.eventType,lr=Oe&(Mi|gi),Kr=this.attrTest(re);return lr&&(dt&Ti||!Kr)?Oe|Gs:lr||Kr?dt&En?Oe|Ei:Oe&Mi?Oe|gi:Mi:fa}});function li(){os.apply(this,arguments),this.pX=null,this.pY=null}xt(li,os,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ha},getTouchAction:function(){var re=this.options.direction,Oe=[];return re&ji&&Oe.push(mi),re&ja&&Oe.push(Fi),Oe},directionTest:function(re){var Oe=this.options,dt=!0,lr=re.distance,Kr=re.direction,Pn=re.deltaX,Zi=re.deltaY;return Kr&Oe.direction||(Oe.direction&ji?(Kr=Pn===0?hi:Pn<0?ea:Tn,dt=Pn!=this.pX,lr=Math.abs(re.deltaX)):(Kr=Zi===0?hi:Zi<0?kn:Ea,dt=Zi!=this.pY,lr=Math.abs(re.deltaY))),re.direction=Kr,dt&&lr>Oe.threshold&&Kr&Oe.direction},attrTest:function(re){return os.prototype.attrTest.call(this,re)&&(this.state&Mi||!(this.state&Mi)&&this.directionTest(re))},emit:function(re){this.pX=re.deltaX,this.pY=re.deltaY;var Oe=iu(re.direction);Oe&&(re.additionalEvent=this.options.event+Oe),this._super.emit.call(this,re)}});function ia(){os.apply(this,arguments)}xt(ia,os,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[di]},attrTest:function(re){return this._super.attrTest.call(this,re)&&(Math.abs(re.scale-1)>this.options.threshold||this.state&Mi)},emit:function(re){if(re.scale!==1){var Oe=re.scale<1?"in":"out";re.additionalEvent=this.options.event+Oe}this._super.emit.call(this,re)}});function Ra(){Ca.apply(this,arguments),this._timer=null,this._input=null}xt(Ra,Ca,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ni]},process:function(re){var Oe=this.options,dt=re.pointers.length===Oe.pointers,lr=re.distance<Oe.threshold,Kr=re.deltaTime>Oe.time;if(this._input=re,!lr||!dt||re.eventType&(En|Ti)&&!Kr)this.reset();else if(re.eventType&ri)this.reset(),this._timer=it(function(){this.state=wa,this.tryEmit()},Oe.time,this);else if(re.eventType&En)return wa;return fa},reset:function(){clearTimeout(this._timer)},emit:function(re){this.state===wa&&(re&&re.eventType&En?this.manager.emit(this.options.event+"up",re):(this._input.timeStamp=rt(),this.manager.emit(this.options.event,this._input)))}});function aa(){os.apply(this,arguments)}xt(aa,os,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[di]},attrTest:function(re){return this._super.attrTest.call(this,re)&&(Math.abs(re.rotation)>this.options.threshold||this.state&Mi)}});function $o(){os.apply(this,arguments)}xt($o,os,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ji|ja,pointers:1},getTouchAction:function(){return li.prototype.getTouchAction.call(this)},attrTest:function(re){var Oe=this.options.direction,dt;return Oe&(ji|ja)?dt=re.overallVelocity:Oe&ji?dt=re.overallVelocityX:Oe&ja&&(dt=re.overallVelocityY),this._super.attrTest.call(this,re)&&Oe&re.offsetDirection&&re.distance>this.options.threshold&&re.maxPointers==this.options.pointers&&Ve(dt)>this.options.velocity&&re.eventType&En},emit:function(re){var Oe=iu(re.offsetDirection);Oe&&this.manager.emit(this.options.event+Oe,re),this.manager.emit(this.options.event,re)}});function Vo(){Ca.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}xt(Vo,Ca,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[on]},process:function(re){var Oe=this.options,dt=re.pointers.length===Oe.pointers,lr=re.distance<Oe.threshold,Kr=re.deltaTime<Oe.time;if(this.reset(),re.eventType&ri&&this.count===0)return this.failTimeout();if(lr&&Kr&&dt){if(re.eventType!=En)return this.failTimeout();var Pn=this.pTime?re.timeStamp-this.pTime<Oe.interval:!0,Zi=!this.pCenter||Hi(this.pCenter,re.center)<Oe.posThreshold;this.pTime=re.timeStamp,this.pCenter=re.center,!Zi||!Pn?this.count=1:this.count+=1,this._input=re;var lo=this.count%Oe.taps;if(lo===0)return this.hasRequireFailures()?(this._timer=it(function(){this.state=wa,this.tryEmit()},Oe.interval,this),Mi):wa}return fa},failTimeout:function(){return this._timer=it(function(){this.state=fa},this.options.interval,this),fa},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==wa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Du(re,Oe){return Oe=Oe||{},Oe.recognizers=dr(Oe.recognizers,Du.defaults.preset),new Da(re,Oe)}Du.VERSION="2.0.7",Du.defaults={domEvents:!1,touchAction:jr,enable:!0,inputTarget:null,inputClass:null,preset:[[aa,{enable:!1}],[ia,{enable:!1},["rotate"]],[$o,{direction:ji}],[li,{direction:ji},["swipe"]],[Vo],[Vo,{event:"doubletap",taps:2},["tap"]],[Ra]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ws=1,mc=2;function Da(re,Oe){this.options=ir({},Du.defaults,Oe||{}),this.options.inputTarget=this.options.inputTarget||re,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=re,this.input=eo(this),this.touchAction=new Ri(this,this.options.touchAction),zi(this,!0),Tt(this.options.recognizers,function(dt){var lr=this.add(new dt[0](dt[1]));dt[2]&&lr.recognizeWith(dt[2]),dt[3]&&lr.requireFailure(dt[3])},this)}Da.prototype={set:function(re){return ir(this.options,re),re.touchAction&&this.touchAction.update(),re.inputTarget&&(this.input.destroy(),this.input.target=re.inputTarget,this.input.init()),this},stop:function(re){this.session.stopped=re?mc:ws},recognize:function(re){var Oe=this.session;if(!Oe.stopped){this.touchAction.preventDefaults(re);var dt,lr=this.recognizers,Kr=Oe.curRecognizer;(!Kr||Kr&&Kr.state&wa)&&(Kr=Oe.curRecognizer=null);for(var Pn=0;Pn<lr.length;)dt=lr[Pn],Oe.stopped!==mc&&(!Kr||dt==Kr||dt.canRecognizeWith(Kr))?dt.recognize(re):dt.reset(),!Kr&&dt.state&(Mi|gi|Ei)&&(Kr=Oe.curRecognizer=dt),Pn++}},get:function(re){if(re instanceof Ca)return re;for(var Oe=this.recognizers,dt=0;dt<Oe.length;dt++)if(Oe[dt].options.event==re)return Oe[dt];return null},add:function(re){if(Ct(re,"add",this))return this;var Oe=this.get(re.options.event);return Oe&&this.remove(Oe),this.recognizers.push(re),re.manager=this,this.touchAction.update(),re},remove:function(re){if(Ct(re,"remove",this))return this;if(re=this.get(re),re){var Oe=this.recognizers,dt=Ar(Oe,re);dt!==-1&&(Oe.splice(dt,1),this.touchAction.update())}return this},on:function(re,Oe){if(re!==V&&Oe!==V){var dt=this.handlers;return Tt(ur(re),function(lr){dt[lr]=dt[lr]||[],dt[lr].push(Oe)}),this}},off:function(re,Oe){if(re!==V){var dt=this.handlers;return Tt(ur(re),function(lr){Oe?dt[lr]&&dt[lr].splice(Ar(dt[lr],Oe),1):delete dt[lr]}),this}},emit:function(re,Oe){this.options.domEvents&&jo(re,Oe);var dt=this.handlers[re]&&this.handlers[re].slice();if(!(!dt||!dt.length)){Oe.type=re,Oe.preventDefault=function(){Oe.srcEvent.preventDefault()};for(var lr=0;lr<dt.length;)dt[lr](Oe),lr++}},destroy:function(){this.element&&zi(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function zi(re,Oe){var dt=re.element;if(!!dt.style){var lr;Tt(re.options.cssProps,function(Kr,Pn){lr=k(dt.style,Pn),Oe?(re.oldCssProps[lr]=dt.style[lr],dt.style[lr]=Kr):dt.style[lr]=re.oldCssProps[lr]||""}),Oe||(re.oldCssProps={})}}function jo(re,Oe){var dt=y.createEvent("Event");dt.initEvent(re,!0,!0),dt.gesture=Oe,Oe.target.dispatchEvent(dt)}ir(Du,{INPUT_START:ri,INPUT_MOVE:qn,INPUT_END:En,INPUT_CANCEL:Ti,STATE_POSSIBLE:Sa,STATE_BEGAN:Mi,STATE_CHANGED:gi,STATE_ENDED:Ei,STATE_RECOGNIZED:wa,STATE_CANCELLED:Gs,STATE_FAILED:fa,DIRECTION_NONE:hi,DIRECTION_LEFT:ea,DIRECTION_RIGHT:Tn,DIRECTION_UP:kn,DIRECTION_DOWN:Ea,DIRECTION_HORIZONTAL:ji,DIRECTION_VERTICAL:ja,DIRECTION_ALL:Ha,Manager:Da,Input:sa,TouchAction:Ri,TouchInput:ge,MouseInput:Zt,PointerEventInput:F,TouchMouseInput:vr,SingleTouchInput:Ue,Recognizer:Ca,AttrRecognizer:os,Tap:Vo,Pan:li,Swipe:$o,Pinch:ia,Rotate:aa,Press:Ra,on:Mt,off:lt,each:Tt,merge:Rt,extend:Ft,assign:ir,inherit:xt,bindFn:Zr,prefixed:k});var Gt=typeof se!="undefined"?se:typeof self!="undefined"?self:{};Gt.Hammer=Du,ye=function(){return Du}.call(oe,Z,oe,Sr),ye!==V&&(Sr.exports=ye)})(window,document,"Hammer")},80645:function(Sr,oe){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */oe.read=function(Z,ye,se,y,de){var V,ce,ae=de*8-y-1,Be=(1<<ae)-1,ie=Be>>1,Ve=-7,rt=se?de-1:0,it=se?-1:1,Ct=Z[ye+rt];for(rt+=it,V=Ct&(1<<-Ve)-1,Ct>>=-Ve,Ve+=ae;Ve>0;V=V*256+Z[ye+rt],rt+=it,Ve-=8);for(ce=V&(1<<-Ve)-1,V>>=-Ve,Ve+=y;Ve>0;ce=ce*256+Z[ye+rt],rt+=it,Ve-=8);if(V===0)V=1-ie;else{if(V===Be)return ce?NaN:(Ct?-1:1)*Infinity;ce=ce+Math.pow(2,y),V=V-ie}return(Ct?-1:1)*ce*Math.pow(2,V-y)},oe.write=function(Z,ye,se,y,de,V){var ce,ae,Be,ie=V*8-de-1,Ve=(1<<ie)-1,rt=Ve>>1,it=de===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ct=y?0:V-1,Tt=y?1:-1,Xt=ye<0||ye===0&&1/ye<0?1:0;for(ye=Math.abs(ye),isNaN(ye)||ye===Infinity?(ae=isNaN(ye)?1:0,ce=Ve):(ce=Math.floor(Math.log(ye)/Math.LN2),ye*(Be=Math.pow(2,-ce))<1&&(ce--,Be*=2),ce+rt>=1?ye+=it/Be:ye+=it*Math.pow(2,1-rt),ye*Be>=2&&(ce++,Be/=2),ce+rt>=Ve?(ae=0,ce=Ve):ce+rt>=1?(ae=(ye*Be-1)*Math.pow(2,de),ce=ce+rt):(ae=ye*Math.pow(2,rt-1)*Math.pow(2,de),ce=0));de>=8;Z[se+Ct]=ae&255,Ct+=Tt,ae/=256,de-=8);for(ce=ce<<de|ae,ie+=de;ie>0;Z[se+Ct]=ce&255,Ct+=Tt,ce/=256,ie-=8);Z[se+Ct-Tt]|=Xt*128}},7375:function(Sr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0});var Z=Symbol.for("INJECTION");function ye(ce,ae,Be,ie){function Ve(){return ie&&!Reflect.hasMetadata(Z,this,ae)&&Reflect.defineMetadata(Z,Be(),this,ae),Reflect.hasMetadata(Z,this,ae)?Reflect.getMetadata(Z,this,ae):Be()}function rt(it){Reflect.defineMetadata(Z,it,this,ae)}Object.defineProperty(ce,ae,{configurable:!0,enumerable:!0,get:Ve,set:rt})}function se(ce,ae){return function(Be){return function(ie,Ve){var rt=function(){return ce.get(Be)};ye(ie,Ve,rt,ae)}}}oe.makePropertyInjectDecorator=se;function y(ce,ae){return function(Be,ie){return function(Ve,rt){var it=function(){return ce.getNamed(Be,ie)};ye(Ve,rt,it,ae)}}}oe.makePropertyInjectNamedDecorator=y;function de(ce,ae){return function(Be,ie,Ve){return function(rt,it){var Ct=function(){return ce.getTagged(Be,ie,Ve)};ye(rt,it,Ct,ae)}}}oe.makePropertyInjectTaggedDecorator=de;function V(ce,ae){return function(Be){return function(ie,Ve){var rt=function(){return ce.getAll(Be)};ye(ie,Ve,rt,ae)}}}oe.makePropertyMultiInjectDecorator=V},84879:function(Sr,oe,Z){"use strict";var ye;ye={value:!0};var se=Z(7375);function y(de,V){V===void 0&&(V=!0);var ce=se.makePropertyInjectDecorator(de,V),ae=se.makePropertyInjectNamedDecorator(de,V),Be=se.makePropertyInjectTaggedDecorator(de,V),ie=se.makePropertyMultiInjectDecorator(de,V);return{lazyInject:ce,lazyInjectNamed:ae,lazyInjectTagged:Be,lazyMultiInject:ie}}oe.Z=y},99934:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.tagProperty=oe.tagParameter=oe.decorate=void 0;var ye=Z(16674),se=Z(6867);function y(ie,Ve,rt,it){var Ct=se.TAGGED;V(Ct,ie,Ve,it,rt)}oe.tagParameter=y;function de(ie,Ve,rt){var it=se.TAGGED_PROP;V(it,ie.constructor,Ve,rt)}oe.tagProperty=de;function V(ie,Ve,rt,it,Ct){var Tt={},Xt=typeof Ct=="number",ir=Ct!==void 0&&Xt?Ct.toString():rt;if(Xt&&rt!==void 0)throw new Error(ye.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ie,Ve)&&(Tt=Reflect.getMetadata(ie,Ve));var Ft=Tt[ir];if(!Array.isArray(Ft))Ft=[];else for(var Rt=0,xt=Ft;Rt<xt.length;Rt++){var Zr=xt[Rt];if(Zr.key===it.key)throw new Error(ye.DUPLICATED_METADATA+" "+Zr.key.toString())}Ft.push(it),Tt[ir]=Ft,Reflect.defineMetadata(ie,Tt,Ve)}function ce(ie,Ve){Reflect.decorate(ie,Ve)}function ae(ie,Ve){return function(rt,it){Ve(rt,it,ie)}}function Be(ie,Ve,rt){typeof rt=="number"?ce([ae(rt,ie)],Ve):typeof rt=="string"?Reflect.decorate([ie],Ve,rt):ce([ie],Ve)}oe.decorate=Be},5744:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.inject=oe.LazyServiceIdentifer=void 0;var ye=Z(16674),se=Z(6867),y=Z(47738),de=Z(99934),V=function(){function ae(Be){this._cb=Be}return ae.prototype.unwrap=function(){return this._cb()},ae}();oe.LazyServiceIdentifer=V;function ce(ae){return function(Be,ie,Ve){if(ae===void 0)throw new Error(ye.UNDEFINED_INJECT_ANNOTATION(Be.name));var rt=new y.Metadata(se.INJECT_TAG,ae);typeof Ve=="number"?de.tagParameter(Be,ie,Ve,rt):de.tagProperty(Be,ie,rt)}}oe.inject=ce},64315:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.injectable=void 0;var ye=Z(16674),se=Z(6867);function y(){return function(de){if(Reflect.hasOwnMetadata(se.PARAM_TYPES,de))throw new Error(ye.DUPLICATED_INJECTABLE_DECORATOR);var V=Reflect.getMetadata(se.DESIGN_PARAM_TYPES,de)||[];return Reflect.defineMetadata(se.PARAM_TYPES,V,de),de}}oe.injectable=y},71693:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.multiInject=void 0;var ye=Z(6867),se=Z(47738),y=Z(99934);function de(V){return function(ce,ae,Be){var ie=new se.Metadata(ye.MULTI_INJECT_TAG,V);typeof Be=="number"?y.tagParameter(ce,ae,Be,ie):y.tagProperty(ce,ae,ie)}}oe.multiInject=de},38085:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.named=void 0;var ye=Z(6867),se=Z(47738),y=Z(99934);function de(V){return function(ce,ae,Be){var ie=new se.Metadata(ye.NAMED_TAG,V);typeof Be=="number"?y.tagParameter(ce,ae,Be,ie):y.tagProperty(ce,ae,ie)}}oe.named=de},6515:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.optional=void 0;var ye=Z(6867),se=Z(47738),y=Z(99934);function de(){return function(V,ce,ae){var Be=new se.Metadata(ye.OPTIONAL_TAG,!0);typeof ae=="number"?y.tagParameter(V,ce,ae,Be):y.tagProperty(V,ce,Be)}}oe.optional=de},7014:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.postConstruct=void 0;var ye=Z(16674),se=Z(6867),y=Z(47738);function de(){return function(V,ce,ae){var Be=new y.Metadata(se.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(se.POST_CONSTRUCT,V.constructor))throw new Error(ye.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(se.POST_CONSTRUCT,Be,V.constructor)}}oe.postConstruct=de},32052:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.tagged=void 0;var ye=Z(47738),se=Z(99934);function y(de,V){return function(ce,ae,Be){var ie=new ye.Metadata(de,V);typeof Be=="number"?se.tagParameter(ce,ae,Be,ie):se.tagProperty(ce,ae,ie)}}oe.tagged=y},55638:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.targetName=void 0;var ye=Z(6867),se=Z(47738),y=Z(99934);function de(V){return function(ce,ae,Be){var ie=new se.Metadata(ye.NAME_TAG,V);y.tagParameter(ce,ae,Be,ie)}}oe.targetName=de},86757:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.unmanaged=void 0;var ye=Z(6867),se=Z(47738),y=Z(99934);function de(){return function(V,ce,ae){var Be=new se.Metadata(ye.UNMANAGED_TAG,!0);y.tagParameter(V,ce,ae,Be)}}oe.unmanaged=de},44290:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Binding=void 0;var ye=Z(28421),se=Z(37791),y=function(){function de(V,ce){this.id=se.id(),this.activated=!1,this.serviceIdentifier=V,this.scope=ce,this.type=ye.BindingTypeEnum.Invalid,this.constraint=function(ae){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return de.prototype.clone=function(){var V=new de(this.serviceIdentifier,this.scope);return V.activated=V.scope===ye.BindingScopeEnum.Singleton?this.activated:!1,V.implementationType=this.implementationType,V.dynamicValue=this.dynamicValue,V.scope=this.scope,V.type=this.type,V.factory=this.factory,V.provider=this.provider,V.constraint=this.constraint,V.onActivation=this.onActivation,V.cache=this.cache,V},de}();oe.Binding=y},23184:function(Sr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingCount=void 0;var Z={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};oe.BindingCount=Z},16674:function(Sr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.STACK_OVERFLOW=oe.CIRCULAR_DEPENDENCY_IN_FACTORY=oe.POST_CONSTRUCT_ERROR=oe.MULTIPLE_POST_CONSTRUCT_METHODS=oe.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=oe.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=oe.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=oe.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=oe.ARGUMENTS_LENGTH_MISMATCH=oe.INVALID_DECORATOR_OPERATION=oe.INVALID_TO_SELF_VALUE=oe.INVALID_FUNCTION_BINDING=oe.INVALID_MIDDLEWARE_RETURN=oe.NO_MORE_SNAPSHOTS_AVAILABLE=oe.INVALID_BINDING_TYPE=oe.NOT_IMPLEMENTED=oe.CIRCULAR_DEPENDENCY=oe.UNDEFINED_INJECT_ANNOTATION=oe.MISSING_INJECT_ANNOTATION=oe.MISSING_INJECTABLE_ANNOTATION=oe.NOT_REGISTERED=oe.CANNOT_UNBIND=oe.AMBIGUOUS_MATCH=oe.KEY_NOT_FOUND=oe.NULL_ARGUMENT=oe.DUPLICATED_METADATA=oe.DUPLICATED_INJECTABLE_DECORATOR=void 0,oe.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",oe.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",oe.NULL_ARGUMENT="NULL argument",oe.KEY_NOT_FOUND="Key Not Found",oe.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",oe.CANNOT_UNBIND="Could not unbind serviceIdentifier:",oe.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",oe.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",oe.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var Z=function(de){return"@inject called with undefined this could mean that the class "+de+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};oe.UNDEFINED_INJECT_ANNOTATION=Z,oe.CIRCULAR_DEPENDENCY="Circular dependency found:",oe.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",oe.INVALID_BINDING_TYPE="Invalid binding type:",oe.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",oe.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",oe.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",oe.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",oe.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ye=function(){for(var de=[],V=0;V<arguments.length;V++)de[V]=arguments[V];return"The number of constructor arguments in the derived class "+(de[0]+" must be >= than the number of constructor arguments of its base class.")};oe.ARGUMENTS_LENGTH_MISMATCH=ye,oe.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",oe.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",oe.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",oe.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",oe.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var se=function(){for(var de=[],V=0;V<arguments.length;V++)de[V]=arguments[V];return"@postConstruct error in class "+de[0]+": "+de[1]};oe.POST_CONSTRUCT_ERROR=se;var y=function(){for(var de=[],V=0;V<arguments.length;V++)de[V]=arguments[V];return"It looks like there is a circular dependency "+("in one of the '"+de[0]+"' bindings. Please investigate bindings with")+("service identifier '"+de[1]+"'.")};oe.CIRCULAR_DEPENDENCY_IN_FACTORY=y,oe.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Sr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.TargetTypeEnum=oe.BindingTypeEnum=oe.BindingScopeEnum=void 0;var Z={Request:"Request",Singleton:"Singleton",Transient:"Transient"};oe.BindingScopeEnum=Z;var ye={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};oe.BindingTypeEnum=ye;var se={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};oe.TargetTypeEnum=se},6867:function(Sr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.NON_CUSTOM_TAG_KEYS=oe.POST_CONSTRUCT=oe.DESIGN_PARAM_TYPES=oe.PARAM_TYPES=oe.TAGGED_PROP=oe.TAGGED=oe.MULTI_INJECT_TAG=oe.INJECT_TAG=oe.OPTIONAL_TAG=oe.UNMANAGED_TAG=oe.NAME_TAG=oe.NAMED_TAG=void 0,oe.NAMED_TAG="named",oe.NAME_TAG="name",oe.UNMANAGED_TAG="unmanaged",oe.OPTIONAL_TAG="optional",oe.INJECT_TAG="inject",oe.MULTI_INJECT_TAG="multi_inject",oe.TAGGED="inversify:tagged",oe.TAGGED_PROP="inversify:tagged_props",oe.PARAM_TYPES="inversify:paramtypes",oe.DESIGN_PARAM_TYPES="design:paramtypes",oe.POST_CONSTRUCT="post_construct";function Z(){return[oe.INJECT_TAG,oe.MULTI_INJECT_TAG,oe.NAME_TAG,oe.UNMANAGED_TAG,oe.NAMED_TAG,oe.OPTIONAL_TAG]}oe.NON_CUSTOM_TAG_KEYS=Z()},51389:function(Sr,oe,Z){"use strict";var ye=this&&this.__awaiter||function(Ft,Rt,xt,Zr){function Tr(dr){return dr instanceof xt?dr:new xt(function(Mt){Mt(dr)})}return new(xt||(xt=Promise))(function(dr,Mt){function lt(ur){try{pt(Zr.next(ur))}catch(Ar){Mt(Ar)}}function Bt(ur){try{pt(Zr.throw(ur))}catch(Ar){Mt(Ar)}}function pt(ur){ur.done?dr(ur.value):Tr(ur.value).then(lt,Bt)}pt((Zr=Zr.apply(Ft,Rt||[])).next())})},se=this&&this.__generator||function(Ft,Rt){var xt={label:0,sent:function(){if(dr[0]&1)throw dr[1];return dr[1]},trys:[],ops:[]},Zr,Tr,dr,Mt;return Mt={next:lt(0),throw:lt(1),return:lt(2)},typeof Symbol=="function"&&(Mt[Symbol.iterator]=function(){return this}),Mt;function lt(pt){return function(ur){return Bt([pt,ur])}}function Bt(pt){if(Zr)throw new TypeError("Generator is already executing.");for(;xt;)try{if(Zr=1,Tr&&(dr=pt[0]&2?Tr.return:pt[0]?Tr.throw||((dr=Tr.return)&&dr.call(Tr),0):Tr.next)&&!(dr=dr.call(Tr,pt[1])).done)return dr;switch(Tr=0,dr&&(pt=[pt[0]&2,dr.value]),pt[0]){case 0:case 1:dr=pt;break;case 4:return xt.label++,{value:pt[1],done:!1};case 5:xt.label++,Tr=pt[1],pt=[0];continue;case 7:pt=xt.ops.pop(),xt.trys.pop();continue;default:if(dr=xt.trys,!(dr=dr.length>0&&dr[dr.length-1])&&(pt[0]===6||pt[0]===2)){xt=0;continue}if(pt[0]===3&&(!dr||pt[1]>dr[0]&&pt[1]<dr[3])){xt.label=pt[1];break}if(pt[0]===6&&xt.label<dr[1]){xt.label=dr[1],dr=pt;break}if(dr&&xt.label<dr[2]){xt.label=dr[2],xt.ops.push(pt);break}dr[2]&&xt.ops.pop(),xt.trys.pop();continue}pt=Rt.call(Ft,xt)}catch(ur){pt=[6,ur],Tr=0}finally{Zr=dr=0}if(pt[0]&5)throw pt[1];return{value:pt[0]?pt[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(Ft,Rt){for(var xt=0,Zr=Rt.length,Tr=Ft.length;xt<Zr;xt++,Tr++)Ft[Tr]=Rt[xt];return Ft};Object.defineProperty(oe,"__esModule",{value:!0}),oe.Container=void 0;var de=Z(44290),V=Z(16674),ce=Z(28421),ae=Z(6867),Be=Z(51377),ie=Z(86311),Ve=Z(31927),rt=Z(15451),it=Z(37791),Ct=Z(55800),Tt=Z(85700),Xt=Z(80175),ir=function(){function Ft(Rt){this._appliedMiddleware=[];var xt=Rt||{};if(typeof xt!="object")throw new Error(""+V.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(xt.defaultScope===void 0)xt.defaultScope=ce.BindingScopeEnum.Transient;else if(xt.defaultScope!==ce.BindingScopeEnum.Singleton&&xt.defaultScope!==ce.BindingScopeEnum.Transient&&xt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+V.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(xt.autoBindInjectable===void 0)xt.autoBindInjectable=!1;else if(typeof xt.autoBindInjectable!="boolean")throw new Error(""+V.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(xt.skipBaseClassChecks===void 0)xt.skipBaseClassChecks=!1;else if(typeof xt.skipBaseClassChecks!="boolean")throw new Error(""+V.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:xt.autoBindInjectable,defaultScope:xt.defaultScope,skipBaseClassChecks:xt.skipBaseClassChecks},this.id=it.id(),this._bindingDictionary=new Xt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Be.MetadataReader}return Ft.merge=function(Rt,xt){for(var Zr=[],Tr=2;Tr<arguments.length;Tr++)Zr[Tr-2]=arguments[Tr];var dr=new Ft,Mt=y([Rt,xt],Zr).map(function(pt){return ie.getBindingDictionary(pt)}),lt=ie.getBindingDictionary(dr);function Bt(pt,ur){pt.traverse(function(Ar,te){te.forEach(function(Ne){ur.add(Ne.serviceIdentifier,Ne.clone())})})}return Mt.forEach(function(pt){Bt(pt,lt)}),dr},Ft.prototype.load=function(){for(var Rt=[],xt=0;xt<arguments.length;xt++)Rt[xt]=arguments[xt];for(var Zr=this._getContainerModuleHelpersFactory(),Tr=0,dr=Rt;Tr<dr.length;Tr++){var Mt=dr[Tr],lt=Zr(Mt.id);Mt.registry(lt.bindFunction,lt.unbindFunction,lt.isboundFunction,lt.rebindFunction)}},Ft.prototype.loadAsync=function(){for(var Rt=[],xt=0;xt<arguments.length;xt++)Rt[xt]=arguments[xt];return ye(this,void 0,void 0,function(){var Zr,Tr,dr,Mt,lt;return se(this,function(Bt){switch(Bt.label){case 0:Zr=this._getContainerModuleHelpersFactory(),Tr=0,dr=Rt,Bt.label=1;case 1:return Tr<dr.length?(Mt=dr[Tr],lt=Zr(Mt.id),[4,Mt.registry(lt.bindFunction,lt.unbindFunction,lt.isboundFunction,lt.rebindFunction)]):[3,4];case 2:Bt.sent(),Bt.label=3;case 3:return Tr++,[3,1];case 4:return[2]}})})},Ft.prototype.unload=function(){for(var Rt=this,xt=[],Zr=0;Zr<arguments.length;Zr++)xt[Zr]=arguments[Zr];var Tr=function(dr){return function(Mt){return Mt.moduleId===dr}};xt.forEach(function(dr){var Mt=Tr(dr.id);Rt._bindingDictionary.removeByCondition(Mt)})},Ft.prototype.bind=function(Rt){var xt=this.options.defaultScope||ce.BindingScopeEnum.Transient,Zr=new de.Binding(Rt,xt);return this._bindingDictionary.add(Rt,Zr),new rt.BindingToSyntax(Zr)},Ft.prototype.rebind=function(Rt){return this.unbind(Rt),this.bind(Rt)},Ft.prototype.unbind=function(Rt){try{this._bindingDictionary.remove(Rt)}catch(xt){throw new Error(V.CANNOT_UNBIND+" "+Ct.getServiceIdentifierAsString(Rt))}},Ft.prototype.unbindAll=function(){this._bindingDictionary=new Xt.Lookup},Ft.prototype.isBound=function(Rt){var xt=this._bindingDictionary.hasKey(Rt);return!xt&&this.parent&&(xt=this.parent.isBound(Rt)),xt},Ft.prototype.isBoundNamed=function(Rt,xt){return this.isBoundTagged(Rt,ae.NAMED_TAG,xt)},Ft.prototype.isBoundTagged=function(Rt,xt,Zr){var Tr=!1;if(this._bindingDictionary.hasKey(Rt)){var dr=this._bindingDictionary.get(Rt),Mt=ie.createMockRequest(this,Rt,xt,Zr);Tr=dr.some(function(lt){return lt.constraint(Mt)})}return!Tr&&this.parent&&(Tr=this.parent.isBoundTagged(Rt,xt,Zr)),Tr},Ft.prototype.snapshot=function(){this._snapshots.push(Tt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ft.prototype.restore=function(){var Rt=this._snapshots.pop();if(Rt===void 0)throw new Error(V.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Rt.bindings,this._middleware=Rt.middleware},Ft.prototype.createChild=function(Rt){var xt=new Ft(Rt||this.options);return xt.parent=this,xt},Ft.prototype.applyMiddleware=function(){for(var Rt=[],xt=0;xt<arguments.length;xt++)Rt[xt]=arguments[xt];this._appliedMiddleware=this._appliedMiddleware.concat(Rt);var Zr=this._middleware?this._middleware:this._planAndResolve();this._middleware=Rt.reduce(function(Tr,dr){return dr(Tr)},Zr)},Ft.prototype.applyCustomMetadataReader=function(Rt){this._metadataReader=Rt},Ft.prototype.get=function(Rt){return this._get(!1,!1,ce.TargetTypeEnum.Variable,Rt)},Ft.prototype.getTagged=function(Rt,xt,Zr){return this._get(!1,!1,ce.TargetTypeEnum.Variable,Rt,xt,Zr)},Ft.prototype.getNamed=function(Rt,xt){return this.getTagged(Rt,ae.NAMED_TAG,xt)},Ft.prototype.getAll=function(Rt){return this._get(!0,!0,ce.TargetTypeEnum.Variable,Rt)},Ft.prototype.getAllTagged=function(Rt,xt,Zr){return this._get(!1,!0,ce.TargetTypeEnum.Variable,Rt,xt,Zr)},Ft.prototype.getAllNamed=function(Rt,xt){return this.getAllTagged(Rt,ae.NAMED_TAG,xt)},Ft.prototype.resolve=function(Rt){var xt=this.createChild();return xt.bind(Rt).toSelf(),this._appliedMiddleware.forEach(function(Zr){xt.applyMiddleware(Zr)}),xt.get(Rt)},Ft.prototype._getContainerModuleHelpersFactory=function(){var Rt=this,xt=function(lt,Bt){lt._binding.moduleId=Bt},Zr=function(lt){return function(Bt){var pt=Rt.bind.bind(Rt),ur=pt(Bt);return xt(ur,lt),ur}},Tr=function(lt){return function(Bt){var pt=Rt.unbind.bind(Rt);pt(Bt)}},dr=function(lt){return function(Bt){var pt=Rt.isBound.bind(Rt);return pt(Bt)}},Mt=function(lt){return function(Bt){var pt=Rt.rebind.bind(Rt),ur=pt(Bt);return xt(ur,lt),ur}};return function(lt){return{bindFunction:Zr(lt),isboundFunction:dr(lt),rebindFunction:Mt(lt),unbindFunction:Tr(lt)}}},Ft.prototype._get=function(Rt,xt,Zr,Tr,dr,Mt){var lt=null,Bt={avoidConstraints:Rt,contextInterceptor:function(pt){return pt},isMultiInject:xt,key:dr,serviceIdentifier:Tr,targetType:Zr,value:Mt};if(this._middleware){if(lt=this._middleware(Bt),lt==null)throw new Error(V.INVALID_MIDDLEWARE_RETURN)}else lt=this._planAndResolve()(Bt);return lt},Ft.prototype._planAndResolve=function(){var Rt=this;return function(xt){var Zr=ie.plan(Rt._metadataReader,Rt,xt.isMultiInject,xt.targetType,xt.serviceIdentifier,xt.key,xt.value,xt.avoidConstraints);Zr=xt.contextInterceptor(Zr);var Tr=Ve.resolve(Zr);return Tr}},Ft}();oe.Container=ir},33244:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.AsyncContainerModule=oe.ContainerModule=void 0;var ye=Z(37791),se=function(){function de(V){this.id=ye.id(),this.registry=V}return de}();oe.ContainerModule=se;var y=function(){function de(V){this.id=ye.id(),this.registry=V}return de}();oe.AsyncContainerModule=y},85700:function(Sr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.ContainerSnapshot=void 0;var Z=function(){function ye(){}return ye.of=function(se,y){var de=new ye;return de.bindings=se,de.middleware=y,de},ye}();oe.ContainerSnapshot=Z},80175:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Lookup=void 0;var ye=Z(16674),se=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(de,V){if(de==null)throw new Error(ye.NULL_ARGUMENT);if(V==null)throw new Error(ye.NULL_ARGUMENT);var ce=this._map.get(de);ce!==void 0?(ce.push(V),this._map.set(de,ce)):this._map.set(de,[V])},y.prototype.get=function(de){if(de==null)throw new Error(ye.NULL_ARGUMENT);var V=this._map.get(de);if(V!==void 0)return V;throw new Error(ye.KEY_NOT_FOUND)},y.prototype.remove=function(de){if(de==null)throw new Error(ye.NULL_ARGUMENT);if(!this._map.delete(de))throw new Error(ye.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(de){var V=this;this._map.forEach(function(ce,ae){var Be=ce.filter(function(ie){return!de(ie)});Be.length>0?V._map.set(ae,Be):V._map.delete(ae)})},y.prototype.hasKey=function(de){if(de==null)throw new Error(ye.NULL_ARGUMENT);return this._map.has(de)},y.prototype.clone=function(){var de=new y;return this._map.forEach(function(V,ce){V.forEach(function(ae){return de.add(ce,ae.clone())})}),de},y.prototype.traverse=function(de){this._map.forEach(function(V,ce){de(ce,V)})},y}();oe.Lookup=se},86700:function(Sr,oe,Z){"use strict";var ye;ye={value:!0},ye=ye=ye=ye=ye=ye=oe.GW=ye=ye=oe.zY=ye=ye=ye=ye=ye=oe.f3=ye=ye=oe.b2=ye=ye=ye=ye=ye=oe.W2=ye=void 0;var se=Z(6867);ye=se;var y=Z(51389);Object.defineProperty(oe,"W2",{enumerable:!0,get:function(){return y.Container}});var de=Z(28421);ye={enumerable:!0,get:function(){return de.BindingScopeEnum}},ye={enumerable:!0,get:function(){return de.BindingTypeEnum}},ye={enumerable:!0,get:function(){return de.TargetTypeEnum}};var V=Z(33244);ye={enumerable:!0,get:function(){return V.AsyncContainerModule}},ye={enumerable:!0,get:function(){return V.ContainerModule}};var ce=Z(64315);Object.defineProperty(oe,"b2",{enumerable:!0,get:function(){return ce.injectable}});var ae=Z(32052);ye={enumerable:!0,get:function(){return ae.tagged}};var Be=Z(38085);ye={enumerable:!0,get:function(){return Be.named}};var ie=Z(5744);Object.defineProperty(oe,"f3",{enumerable:!0,get:function(){return ie.inject}}),ye={enumerable:!0,get:function(){return ie.LazyServiceIdentifer}};var Ve=Z(6515);ye={enumerable:!0,get:function(){return Ve.optional}};var rt=Z(86757);ye={enumerable:!0,get:function(){return rt.unmanaged}};var it=Z(71693);ye={enumerable:!0,get:function(){return it.multiInject}};var Ct=Z(55638);ye={enumerable:!0,get:function(){return Ct.targetName}};var Tt=Z(7014);Object.defineProperty(oe,"zY",{enumerable:!0,get:function(){return Tt.postConstruct}});var Xt=Z(51377);ye={enumerable:!0,get:function(){return Xt.MetadataReader}};var ir=Z(37791);ye={enumerable:!0,get:function(){return ir.id}};var Ft=Z(99934);Object.defineProperty(oe,"GW",{enumerable:!0,get:function(){return Ft.decorate}});var Rt=Z(80758);ye={enumerable:!0,get:function(){return Rt.traverseAncerstors}},ye={enumerable:!0,get:function(){return Rt.taggedConstraint}},ye={enumerable:!0,get:function(){return Rt.namedConstraint}},ye={enumerable:!0,get:function(){return Rt.typeConstraint}};var xt=Z(55800);ye={enumerable:!0,get:function(){return xt.getServiceIdentifierAsString}};var Zr=Z(70600);ye={enumerable:!0,get:function(){return Zr.multiBindToService}}},95228:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Context=void 0;var ye=Z(37791),se=function(){function y(de){this.id=ye.id(),this.container=de}return y.prototype.addPlan=function(de){this.plan=de},y.prototype.setCurrentRequest=function(de){this.currentRequest=de},y}();oe.Context=se},47738:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Metadata=void 0;var ye=Z(6867),se=function(){function y(de,V){this.key=de,this.value=V}return y.prototype.toString=function(){return this.key===ye.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();oe.Metadata=se},51377:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.MetadataReader=void 0;var ye=Z(6867),se=function(){function y(){}return y.prototype.getConstructorMetadata=function(de){var V=Reflect.getMetadata(ye.PARAM_TYPES,de),ce=Reflect.getMetadata(ye.TAGGED,de);return{compilerGeneratedMetadata:V,userGeneratedMetadata:ce||{}}},y.prototype.getPropertiesMetadata=function(de){var V=Reflect.getMetadata(ye.TAGGED_PROP,de)||[];return V},y}();oe.MetadataReader=se},55314:function(Sr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Plan=void 0;var Z=function(){function ye(se,y){this.parentContext=se,this.rootRequest=y}return ye}();oe.Plan=Z},86311:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.getBindingDictionary=oe.createMockRequest=oe.plan=void 0;var ye=Z(23184),se=Z(16674),y=Z(28421),de=Z(6867),V=Z(85265),ce=Z(55800),ae=Z(95228),Be=Z(47738),ie=Z(55314),Ve=Z(6e3),rt=Z(6748),it=Z(18924);function Ct(Tr){return Tr._bindingDictionary}oe.getBindingDictionary=Ct;function Tt(Tr,dr,Mt,lt,Bt,pt){var ur=Tr?de.MULTI_INJECT_TAG:de.INJECT_TAG,Ar=new Be.Metadata(ur,Mt),te=new it.Target(dr,lt,Mt,Ar);if(Bt!==void 0){var Ne=new Be.Metadata(Bt,pt);te.metadata.push(Ne)}return te}function Xt(Tr,dr,Mt,lt,Bt){var pt=Rt(Mt.container,Bt.serviceIdentifier),ur=[];return pt.length===ye.BindingCount.NoBindingsAvailable&&Mt.container.options.autoBindInjectable&&typeof Bt.serviceIdentifier=="function"&&Tr.getConstructorMetadata(Bt.serviceIdentifier).compilerGeneratedMetadata&&(Mt.container.bind(Bt.serviceIdentifier).toSelf(),pt=Rt(Mt.container,Bt.serviceIdentifier)),dr?ur=pt:ur=pt.filter(function(Ar){var te=new rt.Request(Ar.serviceIdentifier,Mt,lt,Ar,Bt);return Ar.constraint(te)}),ir(Bt.serviceIdentifier,ur,Bt,Mt.container),ur}function ir(Tr,dr,Mt,lt){switch(dr.length){case ye.BindingCount.NoBindingsAvailable:if(Mt.isOptional())return dr;var Bt=ce.getServiceIdentifierAsString(Tr),pt=se.NOT_REGISTERED;throw pt+=ce.listMetadataForTarget(Bt,Mt),pt+=ce.listRegisteredBindingsForServiceIdentifier(lt,Bt,Rt),new Error(pt);case ye.BindingCount.OnlyOneBindingAvailable:if(!Mt.isArray())return dr;case ye.BindingCount.MultipleBindingsAvailable:default:if(Mt.isArray())return dr;var Bt=ce.getServiceIdentifierAsString(Tr),pt=se.AMBIGUOUS_MATCH+" "+Bt;throw pt+=ce.listRegisteredBindingsForServiceIdentifier(lt,Bt,Rt),new Error(pt)}}function Ft(Tr,dr,Mt,lt,Bt,pt){var ur,Ar;if(Bt===null){ur=Xt(Tr,dr,lt,null,pt),Ar=new rt.Request(Mt,lt,null,ur,pt);var te=new ie.Plan(lt,Ar);lt.addPlan(te)}else ur=Xt(Tr,dr,lt,Bt,pt),Ar=Bt.addChildRequest(pt.serviceIdentifier,ur,pt);ur.forEach(function(Ne){var k=null;if(pt.isArray())k=Ar.addChildRequest(Ne.serviceIdentifier,Ne,pt);else{if(Ne.cache)return;k=Ar}if(Ne.type===y.BindingTypeEnum.Instance&&Ne.implementationType!==null){var ke=Ve.getDependencies(Tr,Ne.implementationType);if(!lt.container.options.skipBaseClassChecks){var Re=Ve.getBaseClassDependencyCount(Tr,Ne.implementationType);if(ke.length<Re){var ct=se.ARGUMENTS_LENGTH_MISMATCH(Ve.getFunctionName(Ne.implementationType));throw new Error(ct)}}ke.forEach(function(Et){Ft(Tr,!1,Et.serviceIdentifier,lt,k,Et)})}})}function Rt(Tr,dr){var Mt=[],lt=Ct(Tr);return lt.hasKey(dr)?Mt=lt.get(dr):Tr.parent!==null&&(Mt=Rt(Tr.parent,dr)),Mt}function xt(Tr,dr,Mt,lt,Bt,pt,ur,Ar){Ar===void 0&&(Ar=!1);var te=new ae.Context(dr),Ne=Tt(Mt,lt,Bt,"",pt,ur);try{return Ft(Tr,Ar,Bt,te,null,Ne),te}catch(k){throw V.isStackOverflowExeption(k)&&te.plan&&ce.circularDependencyToException(te.plan.rootRequest),k}}oe.plan=xt;function Zr(Tr,dr,Mt,lt){var Bt=new it.Target(y.TargetTypeEnum.Variable,"",dr,new Be.Metadata(Mt,lt)),pt=new ae.Context(Tr),ur=new rt.Request(dr,pt,null,[],Bt);return ur}oe.createMockRequest=Zr},88460:function(Sr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.QueryableString=void 0;var Z=function(){function ye(se){this.str=se}return ye.prototype.startsWith=function(se){return this.str.indexOf(se)===0},ye.prototype.endsWith=function(se){var y="",de=se.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},de)},ye.prototype.contains=function(se){return this.str.indexOf(se)!==-1},ye.prototype.equals=function(se){return this.str===se},ye.prototype.value=function(){return this.str},ye}();oe.QueryableString=Z},6e3:function(Sr,oe,Z){"use strict";var ye=this&&this.__spreadArray||function(Xt,ir){for(var Ft=0,Rt=ir.length,xt=Xt.length;Ft<Rt;Ft++,xt++)Xt[xt]=ir[Ft];return Xt};Object.defineProperty(oe,"__esModule",{value:!0}),oe.getFunctionName=oe.getBaseClassDependencyCount=oe.getDependencies=void 0;var se=Z(5744),y=Z(16674),de=Z(28421),V=Z(6867),ce=Z(55800);Object.defineProperty(oe,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var ae=Z(18924);function Be(Xt,ir){var Ft=ce.getFunctionName(ir),Rt=ie(Xt,Ft,ir,!1);return Rt}oe.getDependencies=Be;function ie(Xt,ir,Ft,Rt){var xt=Xt.getConstructorMetadata(Ft),Zr=xt.compilerGeneratedMetadata;if(Zr===void 0){var Tr=y.MISSING_INJECTABLE_ANNOTATION+" "+ir+".";throw new Error(Tr)}var dr=xt.userGeneratedMetadata,Mt=Object.keys(dr),lt=Ft.length===0&&Mt.length>0,Bt=Mt.length>Ft.length,pt=lt||Bt?Mt.length:Ft.length,ur=rt(Rt,ir,Zr,dr,pt),Ar=it(Xt,Ft),te=ye(ye([],ur),Ar);return te}function Ve(Xt,ir,Ft,Rt,xt){var Zr=xt[Xt.toString()]||[],Tr=Tt(Zr),dr=Tr.unmanaged!==!0,Mt=Rt[Xt],lt=Tr.inject||Tr.multiInject;if(Mt=lt||Mt,Mt instanceof se.LazyServiceIdentifer&&(Mt=Mt.unwrap()),dr){var Bt=Mt===Object,pt=Mt===Function,ur=Mt===void 0,Ar=Bt||pt||ur;if(!ir&&Ar){var te=y.MISSING_INJECT_ANNOTATION+" argument "+Xt+" in class "+Ft+".";throw new Error(te)}var Ne=new ae.Target(de.TargetTypeEnum.ConstructorArgument,Tr.targetName,Mt);return Ne.metadata=Zr,Ne}return null}function rt(Xt,ir,Ft,Rt,xt){for(var Zr=[],Tr=0;Tr<xt;Tr++){var dr=Tr,Mt=Ve(dr,Xt,ir,Ft,Rt);Mt!==null&&Zr.push(Mt)}return Zr}function it(Xt,ir){for(var Ft=Xt.getPropertiesMetadata(ir),Rt=[],xt=Object.keys(Ft),Zr=0,Tr=xt;Zr<Tr.length;Zr++){var dr=Tr[Zr],Mt=Ft[dr],lt=Tt(Ft[dr]),Bt=lt.targetName||dr,pt=lt.inject||lt.multiInject,ur=new ae.Target(de.TargetTypeEnum.ClassProperty,Bt,pt);ur.metadata=Mt,Rt.push(ur)}var Ar=Object.getPrototypeOf(ir.prototype).constructor;if(Ar!==Object){var te=it(Xt,Ar);Rt=ye(ye([],Rt),te)}return Rt}function Ct(Xt,ir){var Ft=Object.getPrototypeOf(ir.prototype).constructor;if(Ft!==Object){var Rt=ce.getFunctionName(Ft),xt=ie(Xt,Rt,Ft,!0),Zr=xt.map(function(Mt){return Mt.metadata.filter(function(lt){return lt.key===V.UNMANAGED_TAG})}),Tr=[].concat.apply([],Zr).length,dr=xt.length-Tr;return dr>0?dr:Ct(Xt,Ft)}else return 0}oe.getBaseClassDependencyCount=Ct;function Tt(Xt){var ir={};return Xt.forEach(function(Ft){ir[Ft.key.toString()]=Ft.value}),{inject:ir[V.INJECT_TAG],multiInject:ir[V.MULTI_INJECT_TAG],targetName:ir[V.NAME_TAG],unmanaged:ir[V.UNMANAGED_TAG]}}},6748:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Request=void 0;var ye=Z(37791),se=function(){function y(de,V,ce,ae,Be){this.id=ye.id(),this.serviceIdentifier=de,this.parentContext=V,this.parentRequest=ce,this.target=Be,this.childRequests=[],this.bindings=Array.isArray(ae)?ae:[ae],this.requestScope=ce===null?new Map:null}return y.prototype.addChildRequest=function(de,V,ce){var ae=new y(de,this.parentContext,this,V,ce);return this.childRequests.push(ae),ae},y}();oe.Request=se},18924:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Target=void 0;var ye=Z(6867),se=Z(37791),y=Z(47738),de=Z(88460),V=function(){function ce(ae,Be,ie,Ve){this.id=se.id(),this.type=ae,this.serviceIdentifier=ie,this.name=new de.QueryableString(Be||""),this.metadata=new Array;var rt=null;typeof Ve=="string"?rt=new y.Metadata(ye.NAMED_TAG,Ve):Ve instanceof y.Metadata&&(rt=Ve),rt!==null&&this.metadata.push(rt)}return ce.prototype.hasTag=function(ae){for(var Be=0,ie=this.metadata;Be<ie.length;Be++){var Ve=ie[Be];if(Ve.key===ae)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(ye.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(ae){return this.matchesTag(ye.MULTI_INJECT_TAG)(ae)},ce.prototype.isNamed=function(){return this.hasTag(ye.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(ae){return ye.NON_CUSTOM_TAG_KEYS.every(function(Be){return ae.key!==Be})})},ce.prototype.isOptional=function(){return this.matchesTag(ye.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ae){return ae.key===ye.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ae){return ye.NON_CUSTOM_TAG_KEYS.every(function(Be){return ae.key!==Be})}):null},ce.prototype.matchesNamedTag=function(ae){return this.matchesTag(ye.NAMED_TAG)(ae)},ce.prototype.matchesTag=function(ae){var Be=this;return function(ie){for(var Ve=0,rt=Be.metadata;Ve<rt.length;Ve++){var it=rt[Ve];if(it.key===ae&&it.value===ie)return!0}return!1}},ce}();oe.Target=V},52279:function(Sr,oe,Z){"use strict";var ye=this&&this.__spreadArray||function(ie,Ve){for(var rt=0,it=Ve.length,Ct=ie.length;rt<it;rt++,Ct++)ie[Ct]=Ve[rt];return ie};Object.defineProperty(oe,"__esModule",{value:!0}),oe.resolveInstance=void 0;var se=Z(16674),y=Z(28421),de=Z(6867);function V(ie,Ve,rt){var it=Ve.filter(function(Tt){return Tt.target!==null&&Tt.target.type===y.TargetTypeEnum.ClassProperty}),Ct=it.map(rt);return it.forEach(function(Tt,Xt){var ir="";ir=Tt.target.name.value();var Ft=Ct[Xt];ie[ir]=Ft}),ie}function ce(ie,Ve){return new(ie.bind.apply(ie,ye([void 0],Ve)))}function ae(ie,Ve){if(Reflect.hasMetadata(de.POST_CONSTRUCT,ie)){var rt=Reflect.getMetadata(de.POST_CONSTRUCT,ie);try{Ve[rt.value]()}catch(it){throw new Error(se.POST_CONSTRUCT_ERROR(ie.name,it.message))}}}function Be(ie,Ve,rt){var it=null;if(Ve.length>0){var Ct=Ve.filter(function(Xt){return Xt.target!==null&&Xt.target.type===y.TargetTypeEnum.ConstructorArgument}),Tt=Ct.map(rt);it=ce(ie,Tt),it=V(it,Ve,rt)}else it=new ie;return ae(ie,it),it}oe.resolveInstance=Be},31927:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.resolve=void 0;var ye=Z(16674),se=Z(28421),y=Z(85265),de=Z(55800),V=Z(52279),ce=function(ie,Ve,rt){try{return rt()}catch(it){throw y.isStackOverflowExeption(it)?new Error(ye.CIRCULAR_DEPENDENCY_IN_FACTORY(ie,Ve.toString())):it}},ae=function(ie){return function(Ve){Ve.parentContext.setCurrentRequest(Ve);var rt=Ve.bindings,it=Ve.childRequests,Ct=Ve.target&&Ve.target.isArray(),Tt=!Ve.parentRequest||!Ve.parentRequest.target||!Ve.target||!Ve.parentRequest.target.matchesArray(Ve.target.serviceIdentifier);if(Ct&&Tt)return it.map(function(Zr){var Tr=ae(ie);return Tr(Zr)});var Xt=null;if(Ve.target.isOptional()&&rt.length===0)return;var ir=rt[0],Ft=ir.scope===se.BindingScopeEnum.Singleton,Rt=ir.scope===se.BindingScopeEnum.Request;if(Ft&&ir.activated)return ir.cache;if(Rt&&ie!==null&&ie.has(ir.id))return ie.get(ir.id);if(ir.type===se.BindingTypeEnum.ConstantValue)Xt=ir.cache,ir.activated=!0;else if(ir.type===se.BindingTypeEnum.Function)Xt=ir.cache,ir.activated=!0;else if(ir.type===se.BindingTypeEnum.Constructor)Xt=ir.implementationType;else if(ir.type===se.BindingTypeEnum.DynamicValue&&ir.dynamicValue!==null)Xt=ce("toDynamicValue",ir.serviceIdentifier,function(){return ir.dynamicValue(Ve.parentContext)});else if(ir.type===se.BindingTypeEnum.Factory&&ir.factory!==null)Xt=ce("toFactory",ir.serviceIdentifier,function(){return ir.factory(Ve.parentContext)});else if(ir.type===se.BindingTypeEnum.Provider&&ir.provider!==null)Xt=ce("toProvider",ir.serviceIdentifier,function(){return ir.provider(Ve.parentContext)});else if(ir.type===se.BindingTypeEnum.Instance&&ir.implementationType!==null)Xt=V.resolveInstance(ir.implementationType,it,ae(ie));else{var xt=de.getServiceIdentifierAsString(Ve.serviceIdentifier);throw new Error(ye.INVALID_BINDING_TYPE+" "+xt)}return typeof ir.onActivation=="function"&&(Xt=ir.onActivation(Ve.parentContext,Xt)),Ft&&(ir.cache=Xt,ir.activated=!0),Rt&&ie!==null&&!ie.has(ir.id)&&ie.set(ir.id,Xt),Xt}};function Be(ie){var Ve=ae(ie.plan.rootRequest.requestScope);return Ve(ie.plan.rootRequest)}oe.resolve=Be},83366:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingInSyntax=void 0;var ye=Z(28421),se=Z(71325),y=function(){function de(V){this._binding=V}return de.prototype.inRequestScope=function(){return this._binding.scope=ye.BindingScopeEnum.Request,new se.BindingWhenOnSyntax(this._binding)},de.prototype.inSingletonScope=function(){return this._binding.scope=ye.BindingScopeEnum.Singleton,new se.BindingWhenOnSyntax(this._binding)},de.prototype.inTransientScope=function(){return this._binding.scope=ye.BindingScopeEnum.Transient,new se.BindingWhenOnSyntax(this._binding)},de}();oe.BindingInSyntax=y},74889:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingInWhenOnSyntax=void 0;var ye=Z(83366),se=Z(51811),y=Z(98370),de=function(){function V(ce){this._binding=ce,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new se.BindingOnSyntax(this._binding),this._bindingInSyntax=new ye.BindingInSyntax(ce)}return V.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},V.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},V.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},V.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},V.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},V.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},V.prototype.whenTargetTagged=function(ce,ae){return this._bindingWhenSyntax.whenTargetTagged(ce,ae)},V.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},V.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},V.prototype.whenParentTagged=function(ce,ae){return this._bindingWhenSyntax.whenParentTagged(ce,ae)},V.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},V.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},V.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},V.prototype.whenAnyAncestorTagged=function(ce,ae){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,ae)},V.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},V.prototype.whenNoAncestorTagged=function(ce,ae){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,ae)},V.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},V.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},V.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},V}();oe.BindingInWhenOnSyntax=de},51811:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingOnSyntax=void 0;var ye=Z(98370),se=function(){function y(de){this._binding=de}return y.prototype.onActivation=function(de){return this._binding.onActivation=de,new ye.BindingWhenSyntax(this._binding)},y}();oe.BindingOnSyntax=se},15451:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingToSyntax=void 0;var ye=Z(16674),se=Z(28421),y=Z(74889),de=Z(71325),V=function(){function ce(ae){this._binding=ae}return ce.prototype.to=function(ae){return this._binding.type=se.BindingTypeEnum.Instance,this._binding.implementationType=ae,new y.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ye.INVALID_TO_SELF_VALUE);var ae=this._binding.serviceIdentifier;return this.to(ae)},ce.prototype.toConstantValue=function(ae){return this._binding.type=se.BindingTypeEnum.ConstantValue,this._binding.cache=ae,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=se.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(ae){return this._binding.type=se.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ae,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(ae){return this._binding.type=se.BindingTypeEnum.Constructor,this._binding.implementationType=ae,this._binding.scope=se.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(ae){return this._binding.type=se.BindingTypeEnum.Factory,this._binding.factory=ae,this._binding.scope=se.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(ae){if(typeof ae!="function")throw new Error(ye.INVALID_FUNCTION_BINDING);var Be=this.toConstantValue(ae);return this._binding.type=se.BindingTypeEnum.Function,this._binding.scope=se.BindingScopeEnum.Singleton,Be},ce.prototype.toAutoFactory=function(ae){return this._binding.type=se.BindingTypeEnum.Factory,this._binding.factory=function(Be){var ie=function(){return Be.container.get(ae)};return ie},this._binding.scope=se.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(ae){return this._binding.type=se.BindingTypeEnum.Provider,this._binding.provider=ae,this._binding.scope=se.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(ae){this.toDynamicValue(function(Be){return Be.container.get(ae)})},ce}();oe.BindingToSyntax=V},71325:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingWhenOnSyntax=void 0;var ye=Z(51811),se=Z(98370),y=function(){function de(V){this._binding=V,this._bindingWhenSyntax=new se.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ye.BindingOnSyntax(this._binding)}return de.prototype.when=function(V){return this._bindingWhenSyntax.when(V)},de.prototype.whenTargetNamed=function(V){return this._bindingWhenSyntax.whenTargetNamed(V)},de.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},de.prototype.whenTargetTagged=function(V,ce){return this._bindingWhenSyntax.whenTargetTagged(V,ce)},de.prototype.whenInjectedInto=function(V){return this._bindingWhenSyntax.whenInjectedInto(V)},de.prototype.whenParentNamed=function(V){return this._bindingWhenSyntax.whenParentNamed(V)},de.prototype.whenParentTagged=function(V,ce){return this._bindingWhenSyntax.whenParentTagged(V,ce)},de.prototype.whenAnyAncestorIs=function(V){return this._bindingWhenSyntax.whenAnyAncestorIs(V)},de.prototype.whenNoAncestorIs=function(V){return this._bindingWhenSyntax.whenNoAncestorIs(V)},de.prototype.whenAnyAncestorNamed=function(V){return this._bindingWhenSyntax.whenAnyAncestorNamed(V)},de.prototype.whenAnyAncestorTagged=function(V,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(V,ce)},de.prototype.whenNoAncestorNamed=function(V){return this._bindingWhenSyntax.whenNoAncestorNamed(V)},de.prototype.whenNoAncestorTagged=function(V,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(V,ce)},de.prototype.whenAnyAncestorMatches=function(V){return this._bindingWhenSyntax.whenAnyAncestorMatches(V)},de.prototype.whenNoAncestorMatches=function(V){return this._bindingWhenSyntax.whenNoAncestorMatches(V)},de.prototype.onActivation=function(V){return this._bindingOnSyntax.onActivation(V)},de}();oe.BindingWhenOnSyntax=y},98370:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingWhenSyntax=void 0;var ye=Z(51811),se=Z(80758),y=function(){function de(V){this._binding=V}return de.prototype.when=function(V){return this._binding.constraint=V,new ye.BindingOnSyntax(this._binding)},de.prototype.whenTargetNamed=function(V){return this._binding.constraint=se.namedConstraint(V),new ye.BindingOnSyntax(this._binding)},de.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(V){var ce=V.target!==null&&!V.target.isNamed()&&!V.target.isTagged();return ce},new ye.BindingOnSyntax(this._binding)},de.prototype.whenTargetTagged=function(V,ce){return this._binding.constraint=se.taggedConstraint(V)(ce),new ye.BindingOnSyntax(this._binding)},de.prototype.whenInjectedInto=function(V){return this._binding.constraint=function(ce){return se.typeConstraint(V)(ce.parentRequest)},new ye.BindingOnSyntax(this._binding)},de.prototype.whenParentNamed=function(V){return this._binding.constraint=function(ce){return se.namedConstraint(V)(ce.parentRequest)},new ye.BindingOnSyntax(this._binding)},de.prototype.whenParentTagged=function(V,ce){return this._binding.constraint=function(ae){return se.taggedConstraint(V)(ce)(ae.parentRequest)},new ye.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorIs=function(V){return this._binding.constraint=function(ce){return se.traverseAncerstors(ce,se.typeConstraint(V))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorIs=function(V){return this._binding.constraint=function(ce){return!se.traverseAncerstors(ce,se.typeConstraint(V))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorNamed=function(V){return this._binding.constraint=function(ce){return se.traverseAncerstors(ce,se.namedConstraint(V))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorNamed=function(V){return this._binding.constraint=function(ce){return!se.traverseAncerstors(ce,se.namedConstraint(V))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorTagged=function(V,ce){return this._binding.constraint=function(ae){return se.traverseAncerstors(ae,se.taggedConstraint(V)(ce))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorTagged=function(V,ce){return this._binding.constraint=function(ae){return!se.traverseAncerstors(ae,se.taggedConstraint(V)(ce))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorMatches=function(V){return this._binding.constraint=function(ce){return se.traverseAncerstors(ce,V)},new ye.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorMatches=function(V){return this._binding.constraint=function(ce){return!se.traverseAncerstors(ce,V)},new ye.BindingOnSyntax(this._binding)},de}();oe.BindingWhenSyntax=y},80758:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.typeConstraint=oe.namedConstraint=oe.taggedConstraint=oe.traverseAncerstors=void 0;var ye=Z(6867),se=Z(47738),y=function(ae,Be){var ie=ae.parentRequest;return ie!==null?Be(ie)?!0:y(ie,Be):!1};oe.traverseAncerstors=y;var de=function(ae){return function(Be){var ie=function(Ve){return Ve!==null&&Ve.target!==null&&Ve.target.matchesTag(ae)(Be)};return ie.metaData=new se.Metadata(ae,Be),ie}};oe.taggedConstraint=de;var V=de(ye.NAMED_TAG);oe.namedConstraint=V;var ce=function(ae){return function(Be){var ie=null;if(Be!==null)if(ie=Be.bindings[0],typeof ae=="string"){var Ve=ie.serviceIdentifier;return Ve===ae}else{var rt=Be.bindings[0].implementationType;return ae===rt}return!1}};oe.typeConstraint=ce},70600:function(Sr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.multiBindToService=void 0;var Z=function(ye){return function(se){return function(){for(var y=[],de=0;de<arguments.length;de++)y[de]=arguments[de];return y.forEach(function(V){return ye.bind(V).toService(se)})}}};oe.multiBindToService=Z},85265:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.isStackOverflowExeption=void 0;var ye=Z(16674);function se(y){return y instanceof RangeError||y.message===ye.STACK_OVERFLOW}oe.isStackOverflowExeption=se},37791:function(Sr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.id=void 0;var Z=0;function ye(){return Z++}oe.id=ye},55800:function(Sr,oe,Z){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.circularDependencyToException=oe.listMetadataForTarget=oe.listRegisteredBindingsForServiceIdentifier=oe.getServiceIdentifierAsString=oe.getFunctionName=void 0;var ye=Z(16674);function se(ie){if(typeof ie=="function"){var Ve=ie;return Ve.name}else{if(typeof ie=="symbol")return ie.toString();var Ve=ie;return Ve}}oe.getServiceIdentifierAsString=se;function y(ie,Ve,rt){var it="",Ct=rt(ie,Ve);return Ct.length!==0&&(it=`
Registered bindings:`,Ct.forEach(function(Tt){var Xt="Object";Tt.implementationType!==null&&(Xt=Be(Tt.implementationType)),it=it+`
 `+Xt,Tt.constraint.metaData&&(it=it+" - "+Tt.constraint.metaData)})),it}oe.listRegisteredBindingsForServiceIdentifier=y;function de(ie,Ve){return ie.parentRequest===null?!1:ie.parentRequest.serviceIdentifier===Ve?!0:de(ie.parentRequest,Ve)}function V(ie){function Ve(it,Ct){Ct===void 0&&(Ct=[]);var Tt=se(it.serviceIdentifier);return Ct.push(Tt),it.parentRequest!==null?Ve(it.parentRequest,Ct):Ct}var rt=Ve(ie);return rt.reverse().join(" --> ")}function ce(ie){ie.childRequests.forEach(function(Ve){if(de(Ve,Ve.serviceIdentifier)){var rt=V(Ve);throw new Error(ye.CIRCULAR_DEPENDENCY+" "+rt)}else ce(Ve)})}oe.circularDependencyToException=ce;function ae(ie,Ve){if(Ve.isTagged()||Ve.isNamed()){var rt="",it=Ve.getNamedTag(),Ct=Ve.getCustomTags();return it!==null&&(rt+=it.toString()+`
`),Ct!==null&&Ct.forEach(function(Tt){rt+=Tt.toString()+`
`})," "+ie+`
 `+ie+" - "+rt}else return" "+ie}oe.listMetadataForTarget=ae;function Be(ie){if(ie.name)return ie.name;var Ve=ie.toString(),rt=Ve.match(/^function\s*([^\s(]+)/);return rt?rt[1]:"Anonymous function: "+Ve}oe.getFunctionName=Be},29750:function(Sr){function oe(Z,ye,se){return Z===Z&&(se!==void 0&&(Z=Z<=se?Z:se),ye!==void 0&&(Z=Z>=ye?Z:ye)),Z}Sr.exports=oe},74221:function(Sr){function oe(Z,ye,se,y){for(var de=se-1,V=Z.length;++de<V;)if(y(Z[de],ye))return de;return-1}Sr.exports=oe},65464:function(Sr,oe,Z){var ye=Z(29932),se=Z(42118),y=Z(74221),de=Z(7518),V=Z(278),ce=Array.prototype,ae=ce.splice;function Be(ie,Ve,rt,it){var Ct=it?y:se,Tt=-1,Xt=Ve.length,ir=ie;for(ie===Ve&&(Ve=V(Ve)),rt&&(ir=ye(ie,de(rt)));++Tt<Xt;)for(var Ft=0,Rt=Ve[Tt],xt=rt?rt(Rt):Rt;(Ft=Ct(ir,xt,Ft,it))>-1;)ir!==ie&&ae.call(ir,Ft,1),ae.call(ie,Ft,1);return ie}Sr.exports=Be},18190:function(Sr){var oe=9007199254740991,Z=Math.floor;function ye(se,y){var de="";if(!se||y<1||y>oe)return de;do y%2&&(de+=se),y=Z(y/2),y&&(se+=se);while(y);return de}Sr.exports=ye},78302:function(Sr,oe,Z){var ye=Z(18190),se=Z(80531),y=Z(40180),de=Z(62689),V=Z(88016),ce=Z(83140),ae=Math.ceil;function Be(ie,Ve){Ve=Ve===void 0?" ":se(Ve);var rt=Ve.length;if(rt<2)return rt?ye(Ve,ie):Ve;var it=ye(Ve,ae(ie/V(Ve)));return de(Ve)?y(ce(it),0,ie).join(""):it.slice(0,ie)}Sr.exports=Be},74691:function(Sr,oe,Z){var ye=Z(29750),se=Z(14841);function y(de,V,ce){return ce===void 0&&(ce=V,V=void 0),ce!==void 0&&(ce=se(ce),ce=ce===ce?ce:0),V!==void 0&&(V=se(V),V=V===V?V:0),ye(se(de),V,ce)}Sr.exports=y},51584:function(Sr,oe,Z){var ye=Z(44239),se=Z(37005),y="[object Boolean]";function de(V){return V===!0||V===!1||se(V)&&ye(V)==y}Sr.exports=de},60442:function(Sr,oe,Z){var ye=Z(90939);function se(y,de){return ye(y,de)}Sr.exports=se},14293:function(Sr){function oe(Z){return Z==null}Sr.exports=oe},81763:function(Sr,oe,Z){var ye=Z(44239),se=Z(37005),y="[object Number]";function de(V){return typeof V=="number"||se(V)&&ye(V)==y}Sr.exports=de},30236:function(Sr,oe,Z){var ye=Z(42980),se=Z(21463),y=se(function(de,V,ce,ae){ye(de,V,ce,ae)});Sr.exports=y},11726:function(Sr,oe,Z){var ye=Z(78302),se=Z(88016),y=Z(40554),de=Z(79833);function V(ce,ae,Be){ce=de(ce),ae=y(ae);var ie=ae?se(ce):0;return ae&&ie<ae?ce+ye(ae-ie,Be):ce}Sr.exports=V},32475:function(Sr,oe,Z){var ye=Z(78302),se=Z(88016),y=Z(40554),de=Z(79833);function V(ce,ae,Be){ce=de(ce),ae=y(ae);var ie=ae?se(ce):0;return ae&&ie<ae?ye(ae-ie,Be)+ce:ce}Sr.exports=V},97019:function(Sr,oe,Z){var ye=Z(5976),se=Z(45604),y=ye(se);Sr.exports=y},45604:function(Sr,oe,Z){var ye=Z(65464);function se(y,de){return y&&y.length&&de&&de.length?ye(y,de):y}Sr.exports=se},23493:function(Sr,oe,Z){var ye=Z(23279),se=Z(13218),y="Expected a function";function de(V,ce,ae){var Be=!0,ie=!0;if(typeof V!="function")throw new TypeError(y);return se(ae)&&(Be="leading"in ae?!!ae.leading:Be,ie="trailing"in ae?!!ae.trailing:ie),ye(V,ce,{leading:Be,maxWait:ce,trailing:ie})}Sr.exports=de},44908:function(Sr,oe,Z){var ye=Z(45652);function se(y){return y&&y.length?ye(y):[]}Sr.exports=se},6158:function(Sr){(function(oe,Z){Sr.exports=Z()})(this,function(){"use strict";var oe,Z,ye;function se(y,de){if(!oe)oe=de;else if(!Z)Z=de;else{var V="var sharedChunk = {}; ("+oe+")(sharedChunk); ("+Z+")(sharedChunk);",ce={};oe(ce),ye=de(ce),typeof window!="undefined"&&(ye.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}return se(["exports"],function(y){"use strict";function de(o,u){return o(u={exports:{}},u.exports),u.exports}var V=ce;function ce(o,u,f,m){this.cx=3*o,this.bx=3*(f-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(m-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=m,this.p2x=f,this.p2y=m}ce.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},ce.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},ce.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},ce.prototype.solveCurveX=function(o,u){var f,m,x,E,T;for(u===void 0&&(u=1e-6),x=o,T=0;T<8;T++){if(E=this.sampleCurveX(x)-o,Math.abs(E)<u)return x;var M=this.sampleCurveDerivativeX(x);if(Math.abs(M)<1e-6)break;x-=E/M}if((x=o)<(f=0))return f;if(x>(m=1))return m;for(;f<m;){if(E=this.sampleCurveX(x),Math.abs(E-o)<u)return x;o>E?f=x:m=x,x=.5*(m-f)+f}return x},ce.prototype.solve=function(o,u){return this.sampleCurveY(this.solveCurveX(o,u))};var ae=Be;function Be(o,u){this.x=o,this.y=u}Be.prototype={clone:function(){return new Be(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,u){return this.clone()._rotateAround(o,u)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var u=o.x-this.x,f=o.y-this.y;return u*u+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,u){return Math.atan2(this.x*u-this.y*o,this.x*o+this.y*u)},_matMult:function(o){var u=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=u,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var u=Math.cos(o),f=Math.sin(o),m=f*this.x+u*this.y;return this.x=u*this.x-f*this.y,this.y=m,this},_rotateAround:function(o,u){var f=Math.cos(o),m=Math.sin(o),x=u.y+m*(this.x-u.x)+f*(this.y-u.y);return this.x=u.x+f*(this.x-u.x)-m*(this.y-u.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Be.convert=function(o){return o instanceof Be?o:Array.isArray(o)?new Be(o[0],o[1]):o};var ie=typeof self!="undefined"?self:{},Ve=Math.pow(2,53)-1;function rt(o,u,f,m){var x=new V(o,u,f,m);return function(E){return x.solve(E)}}var it=rt(.25,.1,.25,1);function Ct(o,u,f){return Math.min(f,Math.max(u,o))}function Tt(o,u,f){var m=f-u,x=((o-u)%m+m)%m+u;return x===u?f:x}function Xt(o){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];for(var m=0,x=u;m<x.length;m+=1){var E=x[m];for(var T in E)o[T]=E[T]}return o}var ir=1;function Ft(){return ir++}function Rt(){return function o(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function xt(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Zr(o,u){o.forEach(function(f){u[f]&&(u[f]=u[f].bind(u))})}function Tr(o,u){return o.indexOf(u,o.length-u.length)!==-1}function dr(o,u,f){var m={};for(var x in o)m[x]=u.call(f||this,o[x],x,o);return m}function Mt(o,u,f){var m={};for(var x in o)u.call(f||this,o[x],x,o)&&(m[x]=o[x]);return m}function lt(o){return Array.isArray(o)?o.map(lt):typeof o=="object"&&o?dr(o,lt):o}var Bt={};function pt(o){Bt[o]||(typeof console!="undefined"&&console.warn(o),Bt[o]=!0)}function ur(o,u,f){return(f.y-o.y)*(u.x-o.x)>(u.y-o.y)*(f.x-o.x)}function Ar(o){for(var u=0,f=0,m=o.length,x=m-1,E=void 0,T=void 0;f<m;x=f++)u+=((T=o[x]).x-(E=o[f]).x)*(E.y+T.y);return u}function te(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ne(o){var u={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,x,E,T){var M=E||T;return u[x]=!M||M.toLowerCase(),""}),u["max-age"]){var f=parseInt(u["max-age"],10);isNaN(f)?delete u["max-age"]:u["max-age"]=f}return u}var k=null;function ke(o){if(k==null){var u=o.navigator?o.navigator.userAgent:null;k=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return k}function Re(o){try{var u=ie[o];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch(f){return!1}}var ct,Et,kt,er,rr=ie.performance&&ie.performance.now?ie.performance.now.bind(ie.performance):Date.now.bind(Date),fn=ie.requestAnimationFrame||ie.mozRequestAnimationFrame||ie.webkitRequestAnimationFrame||ie.msRequestAnimationFrame,ar=ie.cancelAnimationFrame||ie.mozCancelAnimationFrame||ie.webkitCancelAnimationFrame||ie.msCancelAnimationFrame,Dn={now:rr,frame:function(o){var u=fn(o);return{cancel:function(){return ar(u)}}},getImageData:function(o,u){u===void 0&&(u=0);var f=ie.document.createElement("canvas"),m=f.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return f.width=o.width,f.height=o.height,m.drawImage(o,0,0,o.width,o.height),m.getImageData(-u,-u,o.width+2*u,o.height+2*u)},resolveURL:function(o){return ct||(ct=ie.document.createElement("a")),ct.href=o,ct.href},hardwareConcurrency:ie.navigator&&ie.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ie.devicePixelRatio},get prefersReducedMotion(){return!!ie.matchMedia&&(Et==null&&(Et=ie.matchMedia("(prefers-reduced-motion: reduce)")),Et.matches)}},hn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},nn={supported:!1,testSupport:function(o){!ri&&er&&(qn?En(o):kt=o)}},ri=!1,qn=!1;function En(o){var u=o.createTexture();o.bindTexture(o.TEXTURE_2D,u);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,er),o.isContextLost())return;nn.supported=!0}catch(f){}o.deleteTexture(u),ri=!0}ie.document&&((er=ie.document.createElement("img")).onload=function(){kt&&En(kt),kt=null,qn=!0},er.onerror=function(){ri=!0,kt=null},er.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ti="01",hi=function(o,u){this._transformRequestFn=o,this._customAccessToken=u,this._createSkuToken()};function ea(o){return o.indexOf("mapbox:")===0}hi.prototype._createSkuToken=function(){var o=function(){for(var u="",f=0;f<10;f++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ti,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt},hi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},hi.prototype.transformRequest=function(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}},hi.prototype.normalizeStyleURL=function(o,u){if(!ea(o))return o;var f=ji(o);return f.path="/styles/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||u)},hi.prototype.normalizeGlyphsURL=function(o,u){if(!ea(o))return o;var f=ji(o);return f.path="/fonts/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||u)},hi.prototype.normalizeSourceURL=function(o,u){if(!ea(o))return o;var f=ji(o);return f.path="/v4/"+f.authority+".json",f.params.push("secure"),this._makeAPIURL(f,this._customAccessToken||u)},hi.prototype.normalizeSpriteURL=function(o,u,f,m){var x=ji(o);return ea(o)?(x.path="/styles/v1"+x.path+"/sprite"+u+f,this._makeAPIURL(x,this._customAccessToken||m)):(x.path+=""+u+f,ja(x))},hi.prototype.normalizeTileURL=function(o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!ea(o))return o;var f=ji(o);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Dn.devicePixelRatio>=2||u===512?"@2x":"")+(nn.supported?".webp":"$1")),f.path=f.path.replace(/^.+\/v4\//,"/"),f.path="/v4"+f.path;var m=this._customAccessToken||function(x){for(var E=0,T=x;E<T.length;E+=1){var M=T[E].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(f.params)||hn.ACCESS_TOKEN;return hn.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&f.params.push("sku="+this._skuToken),this._makeAPIURL(f,m)},hi.prototype.canonicalizeTileURL=function(o,u){var f=ji(o);if(!f.path.match(/(^\/v4\/)/)||!f.path.match(/\.[\w]+$/))return o;var m="mapbox://tiles/";m+=f.path.replace("/v4/","");var x=f.params;return u&&(x=x.filter(function(E){return!E.match(/^access_token=/)})),x.length&&(m+="?"+x.join("&")),m},hi.prototype.canonicalizeTileset=function(o,u){for(var f=!!u&&ea(u),m=[],x=0,E=o.tiles||[];x<E.length;x+=1){var T=E[x];kn(T)?m.push(this.canonicalizeTileURL(T,f)):m.push(T)}return m},hi.prototype._makeAPIURL=function(o,u){var f="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=ji(hn.API_URL);if(o.protocol=m.protocol,o.authority=m.authority,o.protocol==="http"){var x=o.params.indexOf("secure");x>=0&&o.params.splice(x,1)}if(m.path!=="/"&&(o.path=""+m.path+o.path),!hn.REQUIRE_ACCESS_TOKEN)return ja(o);if(!(u=u||hn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+f);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+f);return o.params=o.params.filter(function(E){return E.indexOf("access_token")===-1}),o.params.push("access_token="+u),ja(o)};var Tn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function kn(o){return Tn.test(o)}var Ea=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ji(o){var u=o.match(Ea);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function ja(o){var u=o.params.length?"?"+o.params.join("&"):"";return o.protocol+"://"+o.authority+o.path+u}function Ha(o){if(!o)return null;var u=o.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(ie.atob(u[1]).split("").map(function(f){return"%"+("00"+f.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(f){return null}}var Me=function(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Me.prototype.getStorageKey=function(o){var u,f=Ha(hn.ACCESS_TOKEN);return u=f&&f.u?ie.btoa(encodeURIComponent(f.u).replace(/%([0-9A-F]{2})/g,function(m,x){return String.fromCharCode(Number("0x"+x))})):hn.ACCESS_TOKEN||"",o?"mapbox.eventData."+o+":"+u:"mapbox.eventData:"+u},Me.prototype.fetchEventData=function(){var o=Re("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(o)try{var m=ie.localStorage.getItem(u);m&&(this.eventData=JSON.parse(m));var x=ie.localStorage.getItem(f);x&&(this.anonId=x)}catch(E){pt("Unable to read from LocalStorage")}},Me.prototype.saveEventData=function(){var o=Re("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(o)try{ie.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&ie.localStorage.setItem(u,JSON.stringify(this.eventData))}catch(m){pt("Unable to write to LocalStorage")}},Me.prototype.processRequests=function(o){},Me.prototype.postEvent=function(o,u,f,m){var x=this;if(hn.EVENTS_URL){var E=ji(hn.EVENTS_URL);E.params.push("access_token="+(m||hn.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(o).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Ti,userId:this.anonId},M=u?Xt(T,u):T,L={url:ja(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=mt(L,function(j){x.pendingRequest=null,f(j),x.saveEventData(),x.processRequests(m)})}},Me.prototype.queueRequest=function(o,u){this.queue.push(o),this.processRequests(u)};var Wa,sa,eo=function(o){function u(){o.call(this,"map.load"),this.success={},this.skuToken=""}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(f,m,x,E){this.skuToken=x;var T=!(!E&&!hn.ACCESS_TOKEN),M=Array.isArray(f)&&f.some(function(L){return ea(L)||kn(L)});hn.EVENTS_URL&&T&&M&&this.queueRequest({id:m,timestamp:Date.now()},E)},u.prototype.processRequests=function(f){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var x=this.queue.shift(),E=x.id,T=x.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),xt(this.anonId)||(this.anonId=Rt()),this.postEvent(T,{skuToken:this.skuToken},function(M){M||E&&(m.success[E]=!0)},f))}},u}(Me),Ws=new(function(o){function u(f){o.call(this,"appUserTurnstile"),this._customAccessToken=f}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(f,m){hn.EVENTS_URL&&hn.ACCESS_TOKEN&&Array.isArray(f)&&f.some(function(x){return ea(x)||kn(x)})&&this.queueRequest(Date.now(),m)},u.prototype.processRequests=function(f){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var x=Ha(hn.ACCESS_TOKEN),E=x?x.u:hn.ACCESS_TOKEN,T=E!==this.eventData.tokenU;xt(this.anonId)||(this.anonId=Rt(),T=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var L=new Date(this.eventData.lastSuccess),j=new Date(M),$=(M-this.eventData.lastSuccess)/864e5;T=T||$>=1||$<-1||L.getDate()!==j.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(q){q||(m.eventData.lastSuccess=M,m.eventData.tokenU=E)},f)}},u}(Me)),xs=Ws.postTurnstileEvent.bind(Ws),bs=new eo,Vt=bs.postMapLoadEvent.bind(bs),gr=500,Gr=50;function an(){ie.caches&&!Wa&&(Wa=ie.caches.open("mapbox-tiles"))}function Zn(o){var u=o.indexOf("?");return u<0?o:o.slice(0,u)}var Hi,fe=1/0;function D(){return Hi==null&&(Hi=ie.OffscreenCanvas&&new ie.OffscreenCanvas(1,1).getContext("2d")&&typeof ie.createImageBitmap=="function"),Hi}var z={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(z);var ne=function(o){function u(f,m,x){m===401&&kn(x)&&(f+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),o.call(this,f),this.status=m,this.url=x,this.name=this.constructor.name,this.message=f}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),Ae=te()?function(){return self.worker&&self.worker.referrer}:function(){return(ie.location.protocol==="blob:"?ie.parent:ie).location.href},De,Zt,St=function(o,u){if(!(/^file:/.test(f=o.url)||/^file:/.test(Ae())&&!/^\w+:/.test(f))){if(ie.fetch&&ie.Request&&ie.AbortController&&ie.Request.prototype.hasOwnProperty("signal"))return function(m,x){var E,T=new ie.AbortController,M=new ie.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:Ae(),signal:T.signal}),L=!1,j=!1,$=(E=M.url).indexOf("sku=")>0&&kn(E);m.type==="json"&&M.headers.set("Accept","application/json");var q=function(me,ze,He){if(!j){if(me&&me.message!=="SecurityError"&&pt(me),ze&&He)return le(ze);var st=Date.now();ie.fetch(M).then(function(et){if(et.ok){var bt=$?et.clone():null;return le(et,bt,st)}return x(new ne(et.statusText,et.status,m.url))}).catch(function(et){et.code!==20&&x(new Error(et.message))})}},le=function(me,ze,He){(m.type==="arrayBuffer"?me.arrayBuffer():m.type==="json"?me.json():me.text()).then(function(st){j||(ze&&He&&function(et,bt,Lt){if(an(),Wa){var qt={status:bt.status,statusText:bt.statusText,headers:new ie.Headers};bt.headers.forEach(function(mr,Vr){return qt.headers.set(Vr,mr)});var jt=Ne(bt.headers.get("Cache-Control")||"");jt["no-store"]||(jt["max-age"]&&qt.headers.set("Expires",new Date(Lt+1e3*jt["max-age"]).toUTCString()),new Date(qt.headers.get("Expires")).getTime()-Lt<42e4||function(mr,Vr){if(sa===void 0)try{new Response(new ReadableStream),sa=!0}catch(Jr){sa=!1}sa?Vr(mr.body):mr.blob().then(Vr)}(bt,function(mr){var Vr=new ie.Response(mr,qt);an(),Wa&&Wa.then(function(Jr){return Jr.put(Zn(et.url),Vr)}).catch(function(Jr){return pt(Jr.message)})}))}}(M,ze,He),L=!0,x(null,st,me.headers.get("Cache-Control"),me.headers.get("Expires")))}).catch(function(st){j||x(new Error(st.message))})};return $?function(me,ze){if(an(),!Wa)return ze(null);var He=Zn(me.url);Wa.then(function(st){st.match(He).then(function(et){var bt=function(Lt){if(!Lt)return!1;var qt=new Date(Lt.headers.get("Expires")||0),jt=Ne(Lt.headers.get("Cache-Control")||"");return qt>Date.now()&&!jt["no-cache"]}(et);st.delete(He),bt&&st.put(He,et.clone()),ze(null,et,bt)}).catch(ze)}).catch(ze)}(M,q):q(null,null),{cancel:function(){j=!0,L||T.abort()}}}(o,u);if(te()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,u,void 0,!0)}var f;return function(m,x){var E=new ie.XMLHttpRequest;for(var T in E.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(E.responseType="arraybuffer"),m.headers)E.setRequestHeader(T,m.headers[T]);return m.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=m.credentials==="include",E.onerror=function(){x(new Error(E.statusText))},E.onload=function(){if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){var M=E.response;if(m.type==="json")try{M=JSON.parse(E.response)}catch(L){return x(L)}x(null,M,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else x(new ne(E.statusText,E.status,m.url))},E.send(m.body),{cancel:function(){return E.abort()}}}(o,u)},At=function(o,u){return St(Xt(o,{type:"arrayBuffer"}),u)},mt=function(o,u){return St(Xt(o,{method:"POST"}),u)},U="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";De=[],Zt=0;var F=function(o,u){if(nn.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Zt>=hn.MAX_PARALLEL_IMAGE_REQUESTS){var f={requestParameters:o,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return De.push(f),f}Zt++;var m=!1,x=function(){if(!m)for(m=!0,Zt--;De.length&&Zt<hn.MAX_PARALLEL_IMAGE_REQUESTS;){var T=De.shift();T.cancelled||(T.cancel=F(T.requestParameters,T.callback).cancel)}},E=At(o,function(T,M,L,j){x(),T?u(T):M&&(D()?function($,q){var le=new ie.Blob([new Uint8Array($)],{type:"image/png"});ie.createImageBitmap(le).then(function(me){q(null,me)}).catch(function(me){q(new Error("Could not load image because of "+me.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,u):function($,q,le,me){var ze=new ie.Image,He=ie.URL;ze.onload=function(){q(null,ze),He.revokeObjectURL(ze.src),ze.onload=null,ie.requestAnimationFrame(function(){ze.src=U})},ze.onerror=function(){return q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var st=new ie.Blob([new Uint8Array($)],{type:"image/png"});ze.cacheControl=le,ze.expires=me,ze.src=$.byteLength?He.createObjectURL(st):U}(M,u,L,j))});return{cancel:function(){E.cancel(),x()}}};function X(o,u,f){f[o]&&f[o].indexOf(u)!==-1||(f[o]=f[o]||[],f[o].push(u))}function ee(o,u,f){if(f&&f[o]){var m=f[o].indexOf(u);m!==-1&&f[o].splice(m,1)}}var Se=function(o,u){u===void 0&&(u={}),Xt(this,u),this.type=o},Ue=function(o){function u(f,m){m===void 0&&(m={}),o.call(this,"error",Xt({error:f},m))}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Se),Je=function(){};Je.prototype.on=function(o,u){return this._listeners=this._listeners||{},X(o,u,this._listeners),this},Je.prototype.off=function(o,u){return ee(o,u,this._listeners),ee(o,u,this._oneTimeListeners),this},Je.prototype.once=function(o,u){return this._oneTimeListeners=this._oneTimeListeners||{},X(o,u,this._oneTimeListeners),this},Je.prototype.fire=function(o,u){typeof o=="string"&&(o=new Se(o,u||{}));var f=o.type;if(this.listens(f)){o.target=this;for(var m=0,x=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];m<x.length;m+=1)x[m].call(this,o);for(var E=0,T=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];E<T.length;E+=1){var M=T[E];ee(f,M,this._oneTimeListeners),M.call(this,o)}var L=this._eventedParent;L&&(Xt(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),L.fire(o))}else o instanceof Ue&&console.error(o.error);return this},Je.prototype.listens=function(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)},Je.prototype.setEventedParent=function(o,u){return this._eventedParent=o,this._eventedParentData=u,this};var he={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},K=function(o,u,f,m){this.message=(o?o+": ":"")+f,m&&(this.identifier=m),u!=null&&u.__line__&&(this.line=u.__line__)};function ge(o){var u=o.value;return u?[new K(o.key,u,"constants have been deprecated as of v8")]:[]}function Qe(o){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];for(var m=0,x=u;m<x.length;m+=1){var E=x[m];for(var T in E)o[T]=E[T]}return o}function gt(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function pe(o){if(Array.isArray(o))return o.map(pe);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){var u={};for(var f in o)u[f]=pe(o[f]);return u}return gt(o)}var vr=function(o){function u(f,m){o.call(this,m),this.message=m,this.key=f}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Error),en=function(o,u){u===void 0&&(u=[]),this.parent=o,this.bindings={};for(var f=0,m=u;f<m.length;f+=1){var x=m[f];this.bindings[x[0]]=x[1]}};en.prototype.concat=function(o){return new en(this,o)},en.prototype.get=function(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(o+" not found in scope.")},en.prototype.has=function(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)};var tn={kind:"null"},Kt={kind:"number"},$r={kind:"string"},Br={kind:"boolean"},jr={kind:"color"},ni={kind:"object"},on={kind:"value"},di={kind:"collator"},Fi={kind:"formatted"},mi={kind:"resolvedImage"};function Ci(o,u){return{kind:"array",itemType:o,N:u}}function Ri(o){if(o.kind==="array"){var u=Ri(o.itemType);return typeof o.N=="number"?"array<"+u+", "+o.N+">":o.itemType.kind==="value"?"array":"array<"+u+">"}return o.kind}var bo=[tn,Kt,$r,Br,jr,Fi,ni,Ci(on),mi];function Ki(o,u){if(u.kind==="error")return null;if(o.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Ki(o.itemType,u.itemType))&&(typeof o.N!="number"||o.N===u.N))return null}else{if(o.kind===u.kind)return null;if(o.kind==="value"){for(var f=0,m=bo;f<m.length;f+=1)if(!Ki(m[f],u))return null}}return"Expected "+Ri(o)+" but found "+Ri(u)+" instead."}function Sa(o,u){return u.some(function(f){return f.kind===o.kind})}function Mi(o,u){return u.some(function(f){return f==="null"?o===null:f==="array"?Array.isArray(o):f==="object"?o&&!Array.isArray(o)&&typeof o=="object":f===typeof o})}var gi=de(function(o,u){var f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(M){return(M=Math.round(M))<0?0:M>255?255:M}function x(M){return m(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function E(M){return(L=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:L>1?1:L;var L}function T(M,L,j){return j<0?j+=1:j>1&&(j-=1),6*j<1?M+(L-M)*j*6:2*j<1?L:3*j<2?M+(L-M)*(2/3-j)*6:M}try{u.parseCSSColor=function(M){var L,j=M.replace(/ /g,"").toLowerCase();if(j in f)return f[j].slice();if(j[0]==="#")return j.length===4?(L=parseInt(j.substr(1),16))>=0&&L<=4095?[(3840&L)>>4|(3840&L)>>8,240&L|(240&L)>>4,15&L|(15&L)<<4,1]:null:j.length===7&&(L=parseInt(j.substr(1),16))>=0&&L<=16777215?[(16711680&L)>>16,(65280&L)>>8,255&L,1]:null;var $=j.indexOf("("),q=j.indexOf(")");if($!==-1&&q+1===j.length){var le=j.substr(0,$),me=j.substr($+1,q-($+1)).split(","),ze=1;switch(le){case"rgba":if(me.length!==4)return null;ze=E(me.pop());case"rgb":return me.length!==3?null:[x(me[0]),x(me[1]),x(me[2]),ze];case"hsla":if(me.length!==4)return null;ze=E(me.pop());case"hsl":if(me.length!==3)return null;var He=(parseFloat(me[0])%360+360)%360/360,st=E(me[1]),et=E(me[2]),bt=et<=.5?et*(st+1):et+st-et*st,Lt=2*et-bt;return[m(255*T(Lt,bt,He+1/3)),m(255*T(Lt,bt,He)),m(255*T(Lt,bt,He-1/3)),ze];default:return null}}return null}}catch(M){}}).parseCSSColor,Ei=function(o,u,f,m){m===void 0&&(m=1),this.r=o,this.g=u,this.b=f,this.a=m};Ei.parse=function(o){if(o){if(o instanceof Ei)return o;if(typeof o=="string"){var u=gi(o);if(u)return new Ei(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},Ei.prototype.toString=function(){var o=this.toArray(),u=o[1],f=o[2],m=o[3];return"rgba("+Math.round(o[0])+","+Math.round(u)+","+Math.round(f)+","+m+")"},Ei.prototype.toArray=function(){var o=this.a;return o===0?[0,0,0,0]:[255*this.r/o,255*this.g/o,255*this.b/o,o]},Ei.black=new Ei(0,0,0,1),Ei.white=new Ei(1,1,1,1),Ei.transparent=new Ei(0,0,0,0),Ei.red=new Ei(1,0,0,1);var wa=function(o,u,f){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};wa.prototype.compare=function(o,u){return this.collator.compare(o,u)},wa.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Gs=function(o,u,f,m,x){this.text=o,this.image=u,this.scale=f,this.fontStack=m,this.textColor=x},fa=function(o){this.sections=o};fa.fromString=function(o){return new fa([new Gs(o,null,null,null,null)])},fa.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(o){return o.text.length!==0||o.image&&o.image.name.length!==0})},fa.factory=function(o){return o instanceof fa?o:fa.fromString(o)},fa.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(o){return o.text}).join("")},fa.prototype.serialize=function(){for(var o=["format"],u=0,f=this.sections;u<f.length;u+=1){var m=f[u];if(m.image)o.push(["image",m.image.name]);else{o.push(m.text);var x={};m.fontStack&&(x["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(x["font-scale"]=m.scale),m.textColor&&(x["text-color"]=["rgba"].concat(m.textColor.toArray())),o.push(x)}}return o};var Ca=function(o){this.name=o.name,this.available=o.available};function Ju(o,u,f,m){return typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof f=="number"&&f>=0&&f<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[o,u,f,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[o,u,f,m]:[o,u,f]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function iu(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Ei||o instanceof wa||o instanceof fa||o instanceof Ca)return!0;if(Array.isArray(o)){for(var u=0,f=o;u<f.length;u+=1)if(!iu(f[u]))return!1;return!0}if(typeof o=="object"){for(var m in o)if(!iu(o[m]))return!1;return!0}return!1}function _a(o){if(o===null)return tn;if(typeof o=="string")return $r;if(typeof o=="boolean")return Br;if(typeof o=="number")return Kt;if(o instanceof Ei)return jr;if(o instanceof wa)return di;if(o instanceof fa)return Fi;if(o instanceof Ca)return mi;if(Array.isArray(o)){for(var u,f=o.length,m=0,x=o;m<x.length;m+=1){var E=_a(x[m]);if(u){if(u===E)continue;u=on;break}u=E}return Ci(u||on,f)}return ni}function os(o){var u=typeof o;return o===null?"":u==="string"||u==="number"||u==="boolean"?String(o):o instanceof Ei||o instanceof fa||o instanceof Ca?o.toString():JSON.stringify(o)}Ca.prototype.toString=function(){return this.name},Ca.fromString=function(o){return o?new Ca({name:o,available:!1}):null},Ca.prototype.serialize=function(){return["image",this.name]};var li=function(o,u){this.type=o,this.value=u};li.parse=function(o,u){if(o.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(!iu(o[1]))return u.error("invalid value");var f=o[1],m=_a(f),x=u.expectedType;return m.kind!=="array"||m.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(m=x),new li(m,f)},li.prototype.evaluate=function(){return this.value},li.prototype.eachChild=function(){},li.prototype.outputDefined=function(){return!0},li.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ei?["rgba"].concat(this.value.toArray()):this.value instanceof fa?this.value.serialize():this.value};var ia=function(o){this.name="ExpressionEvaluationError",this.message=o};ia.prototype.toJSON=function(){return this.message};var Ra={string:$r,number:Kt,boolean:Br,object:ni},aa=function(o,u){this.type=o,this.args=u};aa.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var f,m=1,x=o[0];if(x==="array"){var E,T;if(o.length>2){var M=o[1];if(typeof M!="string"||!(M in Ra)||M==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=Ra[M],m++}else E=on;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);T=o[2],m++}f=Ci(E,T)}else f=Ra[x];for(var L=[];m<o.length;m++){var j=u.parse(o[m],m,on);if(!j)return null;L.push(j)}return new aa(f,L)},aa.prototype.evaluate=function(o){for(var u=0;u<this.args.length;u++){var f=this.args[u].evaluate(o);if(!Ki(this.type,_a(f)))return f;if(u===this.args.length-1)throw new ia("Expected value to be of type "+Ri(this.type)+", but found "+Ri(_a(f))+" instead.")}return null},aa.prototype.eachChild=function(o){this.args.forEach(o)},aa.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},aa.prototype.serialize=function(){var o=this.type,u=[o.kind];if(o.kind==="array"){var f=o.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){u.push(f.kind);var m=o.N;(typeof m=="number"||this.args.length>1)&&u.push(m)}}return u.concat(this.args.map(function(x){return x.serialize()}))};var $o=function(o){this.type=Fi,this.sections=o};$o.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var f=o[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");for(var m=[],x=!1,E=1;E<=o.length-1;++E){var T=o[E];if(x&&typeof T=="object"&&!Array.isArray(T)){x=!1;var M=null;if(T["font-scale"]&&!(M=u.parse(T["font-scale"],1,Kt)))return null;var L=null;if(T["text-font"]&&!(L=u.parse(T["text-font"],1,Ci($r))))return null;var j=null;if(T["text-color"]&&!(j=u.parse(T["text-color"],1,jr)))return null;var $=m[m.length-1];$.scale=M,$.font=L,$.textColor=j}else{var q=u.parse(o[E],1,on);if(!q)return null;var le=q.type.kind;if(le!=="string"&&le!=="value"&&le!=="null"&&le!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,m.push({content:q,scale:null,font:null,textColor:null})}}return new $o(m)},$o.prototype.evaluate=function(o){return new fa(this.sections.map(function(u){var f=u.content.evaluate(o);return _a(f)===mi?new Gs("",f,null,null,null):new Gs(os(f),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))},$o.prototype.eachChild=function(o){for(var u=0,f=this.sections;u<f.length;u+=1){var m=f[u];o(m.content),m.scale&&o(m.scale),m.font&&o(m.font),m.textColor&&o(m.textColor)}},$o.prototype.outputDefined=function(){return!1},$o.prototype.serialize=function(){for(var o=["format"],u=0,f=this.sections;u<f.length;u+=1){var m=f[u];o.push(m.content.serialize());var x={};m.scale&&(x["font-scale"]=m.scale.serialize()),m.font&&(x["text-font"]=m.font.serialize()),m.textColor&&(x["text-color"]=m.textColor.serialize()),o.push(x)}return o};var Vo=function(o){this.type=mi,this.input=o};Vo.parse=function(o,u){if(o.length!==2)return u.error("Expected two arguments.");var f=u.parse(o[1],1,$r);return f?new Vo(f):u.error("No image name provided.")},Vo.prototype.evaluate=function(o){var u=this.input.evaluate(o),f=Ca.fromString(u);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(u)>-1),f},Vo.prototype.eachChild=function(o){o(this.input)},Vo.prototype.outputDefined=function(){return!1},Vo.prototype.serialize=function(){return["image",this.input.serialize()]};var Du={"to-boolean":Br,"to-color":jr,"to-number":Kt,"to-string":$r},ws=function(o,u){this.type=o,this.args=u};ws.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var f=o[0];if((f==="to-boolean"||f==="to-string")&&o.length!==2)return u.error("Expected one argument.");for(var m=Du[f],x=[],E=1;E<o.length;E++){var T=u.parse(o[E],E,on);if(!T)return null;x.push(T)}return new ws(m,x)},ws.prototype.evaluate=function(o){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(o));if(this.type.kind==="color"){for(var u,f,m=0,x=this.args;m<x.length;m+=1){if(f=null,(u=x[m].evaluate(o))instanceof Ei)return u;if(typeof u=="string"){var E=o.parseColor(u);if(E)return E}else if(Array.isArray(u)&&!(f=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":Ju(u[0],u[1],u[2],u[3])))return new Ei(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ia(f||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var T=null,M=0,L=this.args;M<L.length;M+=1){if((T=L[M].evaluate(o))===null)return 0;var j=Number(T);if(!isNaN(j))return j}throw new ia("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?fa.fromString(os(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?Ca.fromString(os(this.args[0].evaluate(o))):os(this.args[0].evaluate(o))},ws.prototype.eachChild=function(o){this.args.forEach(o)},ws.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},ws.prototype.serialize=function(){if(this.type.kind==="formatted")return new $o([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vo(this.args[0]).serialize();var o=["to-"+this.type.kind];return this.eachChild(function(u){o.push(u.serialize())}),o};var mc=["Unknown","Point","LineString","Polygon"],Da=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Da.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Da.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?mc[this.feature.type]:this.feature.type:null},Da.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Da.prototype.canonicalID=function(){return this.canonical},Da.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Da.prototype.parseColor=function(o){var u=this._parseColorCache[o];return u||(u=this._parseColorCache[o]=Ei.parse(o)),u};var zi=function(o,u,f,m){this.name=o,this.type=u,this._evaluate=f,this.args=m};zi.prototype.evaluate=function(o){return this._evaluate(o,this.args)},zi.prototype.eachChild=function(o){this.args.forEach(o)},zi.prototype.outputDefined=function(){return!1},zi.prototype.serialize=function(){return[this.name].concat(this.args.map(function(o){return o.serialize()}))},zi.parse=function(o,u){var f,m=o[0],x=zi.definitions[m];if(!x)return u.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(x)?x[0]:x.type,T=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,M=T.filter(function(Hn){var _n=Hn[0];return!Array.isArray(_n)||_n.length===o.length-1}),L=null,j=0,$=M;j<$.length;j+=1){var q=$[j],le=q[0],me=q[1];L=new el(u.registry,u.path,null,u.scope);for(var ze=[],He=!1,st=1;st<o.length;st++){var et=o[st],bt=Array.isArray(le)?le[st-1]:le.type,Lt=L.parse(et,1+ze.length,bt);if(!Lt){He=!0;break}ze.push(Lt)}if(!He)if(Array.isArray(le)&&le.length!==ze.length)L.error("Expected "+le.length+" arguments, but found "+ze.length+" instead.");else{for(var qt=0;qt<ze.length;qt++){var jt=Array.isArray(le)?le[qt]:le.type,mr=ze[qt];L.concat(qt+1).checkSubtype(jt,mr.type)}if(L.errors.length===0)return new zi(m,E,me,ze)}}if(M.length===1)(f=u.errors).push.apply(f,L.errors);else{for(var Vr=(M.length?M:T).map(function(Hn){var _n;return _n=Hn[0],Array.isArray(_n)?"("+_n.map(Ri).join(", ")+")":"("+Ri(_n.type)+"...)"}).join(" | "),Jr=[],Fn=1;Fn<o.length;Fn++){var gn=u.parse(o[Fn],1+Jr.length);if(!gn)return null;Jr.push(Ri(gn.type))}u.error("Expected arguments of type "+Vr+", but found ("+Jr.join(", ")+") instead.")}return null},zi.register=function(o,u){for(var f in zi.definitions=u,u)o[f]=zi};var jo=function(o,u,f){this.type=di,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=u};function Gt(o,u){o[0]=Math.min(o[0],u[0]),o[1]=Math.min(o[1],u[1]),o[2]=Math.max(o[2],u[0]),o[3]=Math.max(o[3],u[1])}function re(o,u){return!(o[0]<=u[0]||o[2]>=u[2]||o[1]<=u[1]||o[3]>=u[3])}function Oe(o,u){var f=(180+o[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,x=Math.pow(2,u.z);return[Math.round(f*x*8192),Math.round(m*x*8192)]}function dt(o,u,f){return u[1]>o[1]!=f[1]>o[1]&&o[0]<(f[0]-u[0])*(o[1]-u[1])/(f[1]-u[1])+u[0]}function lr(o,u){for(var f,m,x,E,T,M,L,j=!1,$=0,q=u.length;$<q;$++)for(var le=u[$],me=0,ze=le.length;me<ze-1;me++){if((E=(f=o)[0]-(m=le[me])[0])*(L=f[1]-(x=le[me+1])[1])-(M=f[0]-x[0])*(T=f[1]-m[1])==0&&E*M<=0&&T*L<=0)return!1;dt(o,le[me],le[me+1])&&(j=!j)}return j}function Kr(o,u){for(var f=0;f<u.length;f++)if(lr(o,u[f]))return!0;return!1}function Pn(o,u,f,m){var x=m[0]-f[0],E=m[1]-f[1],T=(o[0]-f[0])*E-x*(o[1]-f[1]),M=(u[0]-f[0])*E-x*(u[1]-f[1]);return T>0&&M<0||T<0&&M>0}function Zi(o,u,f){for(var m=0,x=f;m<x.length;m+=1)for(var E=x[m],T=0;T<E.length-1;++T)if((q=[($=E[T+1])[0]-(j=E[T])[0],$[1]-j[1]])[0]*(le=[(L=u)[0]-(M=o)[0],L[1]-M[1]])[1]-q[1]*le[0]!=0&&Pn(M,L,j,$)&&Pn(j,$,M,L))return!0;var M,L,j,$,q,le;return!1}function lo(o,u){for(var f=0;f<o.length;++f)if(!lr(o[f],u))return!1;for(var m=0;m<o.length-1;++m)if(Zi(o[m],o[m+1],u))return!1;return!0}function Eo(o,u){for(var f=0;f<u.length;f++)if(lo(o,u[f]))return!0;return!1}function ao(o,u,f){for(var m=[],x=0;x<o.length;x++){for(var E=[],T=0;T<o[x].length;T++){var M=Oe(o[x][T],f);Gt(u,M),E.push(M)}m.push(E)}return m}function Cs(o,u,f){for(var m=[],x=0;x<o.length;x++){var E=ao(o[x],u,f);m.push(E)}return m}function Zc(o,u,f,m){if(o[0]<f[0]||o[0]>f[2]){var x=.5*m,E=o[0]-f[0]>x?-m:f[0]-o[0]>x?m:0;E===0&&(E=o[0]-f[2]>x?-m:f[2]-o[0]>x?m:0),o[0]+=E}Gt(u,o)}function au(o,u,f,m){for(var x=8192*Math.pow(2,m.z),E=[8192*m.x,8192*m.y],T=[],M=0,L=o;M<L.length;M+=1)for(var j=0,$=L[M];j<$.length;j+=1){var q=$[j],le=[q.x+E[0],q.y+E[1]];Zc(le,u,f,x),T.push(le)}return T}function _f(o,u,f,m){for(var x,E=8192*Math.pow(2,m.z),T=[8192*m.x,8192*m.y],M=[],L=0,j=o;L<j.length;L+=1){for(var $=[],q=0,le=j[L];q<le.length;q+=1){var me=le[q],ze=[me.x+T[0],me.y+T[1]];Gt(u,ze),$.push(ze)}M.push($)}if(u[2]-u[0]<=E/2){(x=u)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(var He=0,st=M;He<st.length;He+=1)for(var et=0,bt=st[He];et<bt.length;et+=1)Zc(bt[et],u,f,E)}return M}jo.parse=function(o,u){if(o.length!==2)return u.error("Expected one argument.");var f=o[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");var m=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Br);if(!m)return null;var x=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Br);if(!x)return null;var E=null;return f.locale&&!(E=u.parse(f.locale,1,$r))?null:new jo(m,x,E)},jo.prototype.evaluate=function(o){return new wa(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)},jo.prototype.eachChild=function(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)},jo.prototype.outputDefined=function(){return!1},jo.prototype.serialize=function(){var o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]};var Ho=function(o,u){this.type=Br,this.geojson=o,this.geometries=u};function Al(o){if(o instanceof zi&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Ho)return!1;var u=!0;return o.eachChild(function(f){u&&!Al(f)&&(u=!1)}),u}function Tl(o){if(o instanceof zi&&o.name==="feature-state")return!1;var u=!0;return o.eachChild(function(f){u&&!Tl(f)&&(u=!1)}),u}function Lu(o,u){if(o instanceof zi&&u.indexOf(o.name)>=0)return!1;var f=!0;return o.eachChild(function(m){f&&!Lu(m,u)&&(f=!1)}),f}Ho.parse=function(o,u){if(o.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(iu(o[1])){var f=o[1];if(f.type==="FeatureCollection")for(var m=0;m<f.features.length;++m){var x=f.features[m].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new Ho(f,f.features[m].geometry)}else if(f.type==="Feature"){var E=f.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Ho(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Ho(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ho.prototype.evaluate=function(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(u,f){var m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(f.type==="Polygon"){var T=ao(f.coordinates,x,E),M=au(u.geometry(),m,x,E);if(!re(m,x))return!1;for(var L=0,j=M;L<j.length;L+=1)if(!lr(j[L],T))return!1}if(f.type==="MultiPolygon"){var $=Cs(f.coordinates,x,E),q=au(u.geometry(),m,x,E);if(!re(m,x))return!1;for(var le=0,me=q;le<me.length;le+=1)if(!Kr(me[le],$))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(u,f){var m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(f.type==="Polygon"){var T=ao(f.coordinates,x,E),M=_f(u.geometry(),m,x,E);if(!re(m,x))return!1;for(var L=0,j=M;L<j.length;L+=1)if(!lo(j[L],T))return!1}if(f.type==="MultiPolygon"){var $=Cs(f.coordinates,x,E),q=_f(u.geometry(),m,x,E);if(!re(m,x))return!1;for(var le=0,me=q;le<me.length;le+=1)if(!Eo(me[le],$))return!1}return!0}(o,this.geometries)}return!1},Ho.prototype.eachChild=function(){},Ho.prototype.outputDefined=function(){return!0},Ho.prototype.serialize=function(){return["within",this.geojson]};var Bu=function(o,u){this.type=u.type,this.name=o,this.boundExpression=u};Bu.parse=function(o,u){if(o.length!==2||typeof o[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var f=o[1];return u.scope.has(f)?new Bu(f,u.scope.get(f)):u.error('Unknown variable "'+f+'". Make sure "'+f+'" has been bound in an enclosing "let" expression before using it.',1)},Bu.prototype.evaluate=function(o){return this.boundExpression.evaluate(o)},Bu.prototype.eachChild=function(){},Bu.prototype.outputDefined=function(){return!1},Bu.prototype.serialize=function(){return["var",this.name]};var el=function(o,u,f,m,x){u===void 0&&(u=[]),m===void 0&&(m=new en),x===void 0&&(x=[]),this.registry=o,this.path=u,this.key=u.map(function(E){return"["+E+"]"}).join(""),this.scope=m,this.errors=x,this.expectedType=f};function Vc(o,u){for(var f,m=o.length-1,x=0,E=m,T=0;x<=E;)if((f=o[T=Math.floor((x+E)/2)])<=u){if(T===m||u<o[T+1])return T;x=T+1}else{if(!(f>u))throw new ia("Input is not a number.");E=T-1}return 0}el.prototype.parse=function(o,u,f,m,x){return x===void 0&&(x={}),u?this.concat(u,f,m)._parse(o,x):this._parse(o,x)},el.prototype._parse=function(o,u){function f(j,$,q){return q==="assert"?new aa($,[j]):q==="coerce"?new ws($,[j]):j}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=o[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var x=this.registry[m];if(x){var E=x.parse(o,this);if(!E)return null;if(this.expectedType){var T=this.expectedType,M=E.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||M.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(T,M))return null}else E=f(E,T,u.typeAnnotation||"coerce");else E=f(E,T,u.typeAnnotation||"assert")}if(!(E instanceof li)&&E.type.kind!=="resolvedImage"&&function j($){if($ instanceof Bu)return j($.boundExpression);if($ instanceof zi&&$.name==="error"||$ instanceof jo||$ instanceof Ho)return!1;var q=$ instanceof ws||$ instanceof aa,le=!0;return $.eachChild(function(me){le=q?le&&j(me):le&&me instanceof li}),!!le&&Al($)&&Lu($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var L=new Da;try{E=new li(E.type,E.evaluate(L))}catch(j){return this.error(j.message),null}}return E}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof o+" instead.")},el.prototype.concat=function(o,u,f){var m=typeof o=="number"?this.path.concat(o):this.path,x=f?this.scope.concat(f):this.scope;return new el(this.registry,m,u||null,x,this.errors)},el.prototype.error=function(o){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];var m=""+this.key+u.map(function(x){return"["+x+"]"}).join("");this.errors.push(new vr(m,o))},el.prototype.checkSubtype=function(o,u){var f=Ki(o,u);return f&&this.error(f),f};var Rs=function(o,u,f){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(var m=0,x=f;m<x.length;m+=1){var E=x[m],T=E[1];this.labels.push(E[0]),this.outputs.push(T)}};function Ga(o,u,f){return o*(1-f)+u*f}Rs.parse=function(o,u){if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");var f=u.parse(o[1],1,Kt);if(!f)return null;var m=[],x=null;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(var E=1;E<o.length;E+=2){var T=E===1?-1/0:o[E],M=o[E+1],L=E,j=E+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(m.length&&m[m.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);var $=u.parse(M,j,x);if(!$)return null;x=x||$.type,m.push([T,$])}return new Rs(x,f,m)},Rs.prototype.evaluate=function(o){var u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return f[0].evaluate(o);var x=u.length;return m>=u[x-1]?f[x-1].evaluate(o):f[Vc(u,m)].evaluate(o)},Rs.prototype.eachChild=function(o){o(this.input);for(var u=0,f=this.outputs;u<f.length;u+=1)o(f[u])},Rs.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},Rs.prototype.serialize=function(){for(var o=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&o.push(this.labels[u]),o.push(this.outputs[u].serialize());return o};var wl=Object.freeze({__proto__:null,number:Ga,color:function(o,u,f){return new Ei(Ga(o.r,u.r,f),Ga(o.g,u.g,f),Ga(o.b,u.b,f),Ga(o.a,u.a,f))},array:function(o,u,f){return o.map(function(m,x){return Ga(m,u[x],f)})}}),tl=6/29*3*(6/29),yf=Math.PI/180,jh=180/Math.PI;function xf(o){return o>.008856451679035631?Math.pow(o,1/3):o/tl+4/29}function nh(o){return o>6/29?o*o*o:tl*(o-4/29)}function ih(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function ah(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Hh(o){var u=ah(o.r),f=ah(o.g),m=ah(o.b),x=xf((.4124564*u+.3575761*f+.1804375*m)/.95047),E=xf((.2126729*u+.7151522*f+.072175*m)/1);return{l:116*E-16,a:500*(x-E),b:200*(E-xf((.0193339*u+.119192*f+.9503041*m)/1.08883)),alpha:o.a}}function Wh(o){var u=(o.l+16)/116,f=isNaN(o.a)?u:u+o.a/500,m=isNaN(o.b)?u:u-o.b/200;return u=1*nh(u),f=.95047*nh(f),m=1.08883*nh(m),new Ei(ih(3.2404542*f-1.5371385*u-.4985314*m),ih(-.969266*f+1.8760108*u+.041556*m),ih(.0556434*f-.2040259*u+1.0572252*m),o.alpha)}function Np(o,u,f){var m=u-o;return o+f*(m>180||m<-180?m-360*Math.round(m/360):m)}var jc={forward:Hh,reverse:Wh,interpolate:function(o,u,f){return{l:Ga(o.l,u.l,f),a:Ga(o.a,u.a,f),b:Ga(o.b,u.b,f),alpha:Ga(o.alpha,u.alpha,f)}}},Fu={forward:function(o){var u=Hh(o),f=u.l,m=u.a,x=u.b,E=Math.atan2(x,m)*jh;return{h:E<0?E+360:E,c:Math.sqrt(m*m+x*x),l:f,alpha:o.a}},reverse:function(o){var u=o.h*yf,f=o.c;return Wh({l:o.l,a:Math.cos(u)*f,b:Math.sin(u)*f,alpha:o.alpha})},interpolate:function(o,u,f){return{h:Np(o.h,u.h,f),c:Ga(o.c,u.c,f),l:Ga(o.l,u.l,f),alpha:Ga(o.alpha,u.alpha,f)}}},Gh=Object.freeze({__proto__:null,lab:jc,hcl:Fu}),Wo=function(o,u,f,m,x){this.type=o,this.operator=u,this.interpolation=f,this.input=m,this.labels=[],this.outputs=[];for(var E=0,T=x;E<T.length;E+=1){var M=T[E],L=M[1];this.labels.push(M[0]),this.outputs.push(L)}};function Hl(o,u,f,m){var x=m-f,E=o-f;return x===0?0:u===1?E/x:(Math.pow(u,E)-1)/(Math.pow(u,x)-1)}Wo.interpolationFactor=function(o,u,f,m){var x=0;if(o.name==="exponential")x=Hl(u,o.base,f,m);else if(o.name==="linear")x=Hl(u,1,f,m);else if(o.name==="cubic-bezier"){var E=o.controlPoints;x=new V(E[0],E[1],E[2],E[3]).solve(Hl(u,1,f,m))}return x},Wo.parse=function(o,u){var f=o[0],m=o[1],x=o[2],E=o.slice(3);if(!Array.isArray(m)||m.length===0)return u.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var T=m[1];if(typeof T!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:T}}else{if(m[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(m[0]),1,0);var M=m.slice(1);if(M.length!==4||M.some(function(st){return typeof st!="number"||st<0||st>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(x=u.parse(x,2,Kt)))return null;var L=[],j=null;f==="interpolate-hcl"||f==="interpolate-lab"?j=jr:u.expectedType&&u.expectedType.kind!=="value"&&(j=u.expectedType);for(var $=0;$<E.length;$+=2){var q=E[$],le=E[$+1],me=$+3,ze=$+4;if(typeof q!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',me);if(L.length&&L[L.length-1][0]>=q)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',me);var He=u.parse(le,ze,j);if(!He)return null;j=j||He.type,L.push([q,He])}return j.kind==="number"||j.kind==="color"||j.kind==="array"&&j.itemType.kind==="number"&&typeof j.N=="number"?new Wo(j,f,m,x,L):u.error("Type "+Ri(j)+" is not interpolatable.")},Wo.prototype.evaluate=function(o){var u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return f[0].evaluate(o);var x=u.length;if(m>=u[x-1])return f[x-1].evaluate(o);var E=Vc(u,m),T=Wo.interpolationFactor(this.interpolation,m,u[E],u[E+1]),M=f[E].evaluate(o),L=f[E+1].evaluate(o);return this.operator==="interpolate"?wl[this.type.kind.toLowerCase()](M,L,T):this.operator==="interpolate-hcl"?Fu.reverse(Fu.interpolate(Fu.forward(M),Fu.forward(L),T)):jc.reverse(jc.interpolate(jc.forward(M),jc.forward(L),T))},Wo.prototype.eachChild=function(o){o(this.input);for(var u=0,f=this.outputs;u<f.length;u+=1)o(f[u])},Wo.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},Wo.prototype.serialize=function(){var o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,o,this.input.serialize()],f=0;f<this.labels.length;f++)u.push(this.labels[f],this.outputs[f].serialize());return u};var Cl=function(o,u){this.type=o,this.args=u};Cl.parse=function(o,u){if(o.length<2)return u.error("Expectected at least one argument.");var f=null,m=u.expectedType;m&&m.kind!=="value"&&(f=m);for(var x=[],E=0,T=o.slice(1);E<T.length;E+=1){var M=u.parse(T[E],1+x.length,f,void 0,{typeAnnotation:"omit"});if(!M)return null;f=f||M.type,x.push(M)}var L=m&&x.some(function(j){return Ki(m,j.type)});return new Cl(L?on:f,x)},Cl.prototype.evaluate=function(o){for(var u,f=null,m=0,x=0,E=this.args;x<E.length&&(m++,(f=E[x].evaluate(o))&&f instanceof Ca&&!f.available&&(u||(u=f.name),f=null,m===this.args.length&&(f=u)),f===null);x+=1);return f},Cl.prototype.eachChild=function(o){this.args.forEach(o)},Cl.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},Cl.prototype.serialize=function(){var o=["coalesce"];return this.eachChild(function(u){o.push(u.serialize())}),o};var Xs=function(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u};Xs.prototype.evaluate=function(o){return this.result.evaluate(o)},Xs.prototype.eachChild=function(o){for(var u=0,f=this.bindings;u<f.length;u+=1)o(f[u][1]);o(this.result)},Xs.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found "+(o.length-1)+" instead.");for(var f=[],m=1;m<o.length-1;m+=2){var x=o[m];if(typeof x!="string")return u.error("Expected string, but found "+typeof x+" instead.",m);if(/[^a-zA-Z0-9_]/.test(x))return u.error("Variable names must contain only alphanumeric characters or '_'.",m);var E=u.parse(o[m+1],m+1);if(!E)return null;f.push([x,E])}var T=u.parse(o[o.length-1],o.length-1,u.expectedType,f);return T?new Xs(f,T):null},Xs.prototype.outputDefined=function(){return this.result.outputDefined()},Xs.prototype.serialize=function(){for(var o=["let"],u=0,f=this.bindings;u<f.length;u+=1){var m=f[u];o.push(m[0],m[1].serialize())}return o.push(this.result.serialize()),o};var Rl=function(o,u,f){this.type=o,this.index=u,this.input=f};Rl.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var f=u.parse(o[1],1,Kt),m=u.parse(o[2],2,Ci(u.expectedType||on));return f&&m?new Rl(m.type.itemType,f,m):null},Rl.prototype.evaluate=function(o){var u=this.index.evaluate(o),f=this.input.evaluate(o);if(u<0)throw new ia("Array index out of bounds: "+u+" < 0.");if(u>=f.length)throw new ia("Array index out of bounds: "+u+" > "+(f.length-1)+".");if(u!==Math.floor(u))throw new ia("Array index must be an integer, but found "+u+" instead.");return f[u]},Rl.prototype.eachChild=function(o){o(this.index),o(this.input)},Rl.prototype.outputDefined=function(){return!1},Rl.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ou=function(o,u){this.type=Br,this.needle=o,this.haystack=u};ou.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var f=u.parse(o[1],1,on),m=u.parse(o[2],2,on);return f&&m?Sa(f.type,[Br,$r,Kt,tn,on])?new ou(f,m):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ri(f.type)+" instead"):null},ou.prototype.evaluate=function(o){var u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!f)return!1;if(!Mi(u,["boolean","string","number","null"]))throw new ia("Expected first argument to be of type boolean, string, number or null, but found "+Ri(_a(u))+" instead.");if(!Mi(f,["string","array"]))throw new ia("Expected second argument to be of type array or string, but found "+Ri(_a(f))+" instead.");return f.indexOf(u)>=0},ou.prototype.eachChild=function(o){o(this.needle),o(this.haystack)},ou.prototype.outputDefined=function(){return!0},ou.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var vi=function(o,u,f){this.type=Kt,this.needle=o,this.haystack=u,this.fromIndex=f};vi.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var f=u.parse(o[1],1,on),m=u.parse(o[2],2,on);if(!f||!m)return null;if(!Sa(f.type,[Br,$r,Kt,tn,on]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ri(f.type)+" instead");if(o.length===4){var x=u.parse(o[3],3,Kt);return x?new vi(f,m,x):null}return new vi(f,m)},vi.prototype.evaluate=function(o){var u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!Mi(u,["boolean","string","number","null"]))throw new ia("Expected first argument to be of type boolean, string, number or null, but found "+Ri(_a(u))+" instead.");if(!Mi(f,["string","array"]))throw new ia("Expected second argument to be of type array or string, but found "+Ri(_a(f))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(o);return f.indexOf(u,m)}return f.indexOf(u)},vi.prototype.eachChild=function(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)},vi.prototype.outputDefined=function(){return!1},vi.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var $s=function(o,u,f,m,x,E){this.inputType=o,this.type=u,this.input=f,this.cases=m,this.outputs=x,this.otherwise=E};$s.parse=function(o,u){if(o.length<5)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if(o.length%2!=1)return u.error("Expected an even number of arguments.");var f,m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);for(var x={},E=[],T=2;T<o.length-1;T+=2){var M=o[T],L=o[T+1];Array.isArray(M)||(M=[M]);var j=u.concat(T);if(M.length===0)return j.error("Expected at least one branch label.");for(var $=0,q=M;$<q.length;$+=1){var le=q[$];if(typeof le!="number"&&typeof le!="string")return j.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return j.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof le=="number"&&Math.floor(le)!==le)return j.error("Numeric branch labels must be integer values.");if(f){if(j.checkSubtype(f,_a(le)))return null}else f=_a(le);if(x[String(le)]!==void 0)return j.error("Branch labels must be unique.");x[String(le)]=E.length}var me=u.parse(L,T,m);if(!me)return null;m=m||me.type,E.push(me)}var ze=u.parse(o[1],1,on);if(!ze)return null;var He=u.parse(o[o.length-1],o.length-1,m);return He?ze.type.kind!=="value"&&u.concat(1).checkSubtype(f,ze.type)?null:new $s(f,m,ze,x,E,He):null},$s.prototype.evaluate=function(o){var u=this.input.evaluate(o);return(_a(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)},$s.prototype.eachChild=function(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)},$s.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})&&this.otherwise.outputDefined()},$s.prototype.serialize=function(){for(var o=this,u=["match",this.input.serialize()],f=[],m={},x=0,E=Object.keys(this.cases).sort();x<E.length;x+=1){var T=E[x];(q=m[this.cases[T]])===void 0?(m[this.cases[T]]=f.length,f.push([this.cases[T],[T]])):f[q][1].push(T)}for(var M=function(me){return o.inputType.kind==="number"?Number(me):me},L=0,j=f;L<j.length;L+=1){var $=j[L],q=$[0],le=$[1];u.push(le.length===1?M(le[0]):le.map(M)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var Nu=function(o,u,f){this.type=o,this.branches=u,this.otherwise=f};Nu.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found only "+(o.length-1)+".");if(o.length%2!=0)return u.error("Expected an odd number of arguments.");var f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);for(var m=[],x=1;x<o.length-1;x+=2){var E=u.parse(o[x],x,Br);if(!E)return null;var T=u.parse(o[x+1],x+1,f);if(!T)return null;m.push([E,T]),f=f||T.type}var M=u.parse(o[o.length-1],o.length-1,f);return M?new Nu(f,m,M):null},Nu.prototype.evaluate=function(o){for(var u=0,f=this.branches;u<f.length;u+=1){var m=f[u],x=m[1];if(m[0].evaluate(o))return x.evaluate(o)}return this.otherwise.evaluate(o)},Nu.prototype.eachChild=function(o){for(var u=0,f=this.branches;u<f.length;u+=1){var m=f[u],x=m[1];o(m[0]),o(x)}o(this.otherwise)},Nu.prototype.outputDefined=function(){return this.branches.every(function(o){return o[1].outputDefined()})&&this.otherwise.outputDefined()},Nu.prototype.serialize=function(){var o=["case"];return this.eachChild(function(u){o.push(u.serialize())}),o};var rl=function(o,u,f,m){this.type=o,this.input=u,this.beginIndex=f,this.endIndex=m};function oh(o,u){return o==="=="||o==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Xh(o,u,f,m){return m.compare(u,f)===0}function In(o,u,f){var m=o!=="=="&&o!=="!=";return function(){function x(E,T,M){this.type=Br,this.lhs=E,this.rhs=T,this.collator=M,this.hasUntypedArgument=E.type.kind==="value"||T.type.kind==="value"}return x.parse=function(E,T){if(E.length!==3&&E.length!==4)return T.error("Expected two or three arguments.");var M=E[0],L=T.parse(E[1],1,on);if(!L)return null;if(!oh(M,L.type))return T.concat(1).error('"'+M+`" comparisons are not supported for type '`+Ri(L.type)+"'.");var j=T.parse(E[2],2,on);if(!j)return null;if(!oh(M,j.type))return T.concat(2).error('"'+M+`" comparisons are not supported for type '`+Ri(j.type)+"'.");if(L.type.kind!==j.type.kind&&L.type.kind!=="value"&&j.type.kind!=="value")return T.error("Cannot compare types '"+Ri(L.type)+"' and '"+Ri(j.type)+"'.");m&&(L.type.kind==="value"&&j.type.kind!=="value"?L=new aa(j.type,[L]):L.type.kind!=="value"&&j.type.kind==="value"&&(j=new aa(L.type,[j])));var $=null;if(E.length===4){if(L.type.kind!=="string"&&j.type.kind!=="string"&&L.type.kind!=="value"&&j.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!($=T.parse(E[3],3,di)))return null}return new x(L,j,$)},x.prototype.evaluate=function(E){var T=this.lhs.evaluate(E),M=this.rhs.evaluate(E);if(m&&this.hasUntypedArgument){var L=_a(T),j=_a(M);if(L.kind!==j.kind||L.kind!=="string"&&L.kind!=="number")throw new ia('Expected arguments for "'+o+'" to be (string, string) or (number, number), but found ('+L.kind+", "+j.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var $=_a(T),q=_a(M);if($.kind!=="string"||q.kind!=="string")return u(E,T,M)}return this.collator?f(E,T,M,this.collator.evaluate(E)):u(E,T,M)},x.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},x.prototype.outputDefined=function(){return!0},x.prototype.serialize=function(){var E=[o];return this.eachChild(function(T){E.push(T.serialize())}),E},x}()}rl.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var f=u.parse(o[1],1,on),m=u.parse(o[2],2,Kt);if(!f||!m)return null;if(!Sa(f.type,[Ci(on),$r,on]))return u.error("Expected first argument to be of type array or string, but found "+Ri(f.type)+" instead");if(o.length===4){var x=u.parse(o[3],3,Kt);return x?new rl(f.type,f,m,x):null}return new rl(f.type,f,m)},rl.prototype.evaluate=function(o){var u=this.input.evaluate(o),f=this.beginIndex.evaluate(o);if(!Mi(u,["string","array"]))throw new ia("Expected first argument to be of type array or string, but found "+Ri(_a(u))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(o);return u.slice(f,m)}return u.slice(f)},rl.prototype.eachChild=function(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)},rl.prototype.outputDefined=function(){return!1},rl.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Ys=In("==",function(o,u,f){return u===f},Xh),Es=In("!=",function(o,u,f){return u!==f},function(o,u,f,m){return!Xh(0,u,f,m)}),Uu=In("<",function(o,u,f){return u<f},function(o,u,f,m){return m.compare(u,f)<0}),Xa=In(">",function(o,u,f){return u>f},function(o,u,f,m){return m.compare(u,f)>0}),bf=In("<=",function(o,u,f){return u<=f},function(o,u,f,m){return m.compare(u,f)<=0}),Ef=In(">=",function(o,u,f){return u>=f},function(o,u,f,m){return m.compare(u,f)>=0}),Ms=function(o,u,f,m,x){this.type=$r,this.number=o,this.locale=u,this.currency=f,this.minFractionDigits=m,this.maxFractionDigits=x};Ms.parse=function(o,u){if(o.length!==3)return u.error("Expected two arguments.");var f=u.parse(o[1],1,Kt);if(!f)return null;var m=o[2];if(typeof m!="object"||Array.isArray(m))return u.error("NumberFormat options argument must be an object.");var x=null;if(m.locale&&!(x=u.parse(m.locale,1,$r)))return null;var E=null;if(m.currency&&!(E=u.parse(m.currency,1,$r)))return null;var T=null;if(m["min-fraction-digits"]&&!(T=u.parse(m["min-fraction-digits"],1,Kt)))return null;var M=null;return m["max-fraction-digits"]&&!(M=u.parse(m["max-fraction-digits"],1,Kt))?null:new Ms(f,x,E,T,M)},Ms.prototype.evaluate=function(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))},Ms.prototype.eachChild=function(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)},Ms.prototype.outputDefined=function(){return!1},Ms.prototype.serialize=function(){var o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]};var nl=function(o){this.type=Kt,this.input=o};nl.parse=function(o,u){if(o.length!==2)return u.error("Expected 1 argument, but found "+(o.length-1)+" instead.");var f=u.parse(o[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Ri(f.type)+" instead."):new nl(f):null},nl.prototype.evaluate=function(o){var u=this.input.evaluate(o);if(typeof u=="string"||Array.isArray(u))return u.length;throw new ia("Expected value to be of type string or array, but found "+Ri(_a(u))+" instead.")},nl.prototype.eachChild=function(o){o(this.input)},nl.prototype.outputDefined=function(){return!1},nl.prototype.serialize=function(){var o=["length"];return this.eachChild(function(u){o.push(u.serialize())}),o};var _u={"==":Ys,"!=":Es,">":Xa,"<":Uu,">=":Ef,"<=":bf,array:aa,at:Rl,boolean:aa,case:Nu,coalesce:Cl,collator:jo,format:$o,image:Vo,in:ou,"index-of":vi,interpolate:Wo,"interpolate-hcl":Wo,"interpolate-lab":Wo,length:nl,let:Xs,literal:li,match:$s,number:aa,"number-format":Ms,object:aa,slice:rl,step:Rs,string:aa,"to-boolean":ws,"to-color":ws,"to-number":ws,"to-string":ws,var:Bu,within:Ho};function Ml(o,u){var f=u[0],m=u[1],x=u[2],E=u[3];f=f.evaluate(o),m=m.evaluate(o),x=x.evaluate(o);var T=E?E.evaluate(o):1,M=Ju(f,m,x,T);if(M)throw new ia(M);return new Ei(f/255*T,m/255*T,x/255*T,T)}function sh(o,u){return o in u}function gc(o,u){var f=u[o];return f===void 0?null:f}function oa(o){return{type:o}}function _c(o){return{result:"success",value:o}}function il(o){return{result:"error",value:o}}function Il(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function uh(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Hc(o){return!!o.expression&&o.expression.interpolated}function ua(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Pl(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function $h(o){return o}function Is(o,u,f){return o!==void 0?o:u!==void 0?u:f!==void 0?f:void 0}function Wc(o,u,f,m,x){return Is(typeof f===x?m[f]:void 0,o.default,u.default)}function Gc(o,u,f){if(ua(f)!=="number")return Is(o.default,u.default);var m=o.stops.length;if(m===1||f<=o.stops[0][0])return o.stops[0][1];if(f>=o.stops[m-1][0])return o.stops[m-1][1];var x=Vc(o.stops.map(function(E){return E[0]}),f);return o.stops[x][1]}function Sf(o,u,f){var m=o.base!==void 0?o.base:1;if(ua(f)!=="number")return Is(o.default,u.default);var x=o.stops.length;if(x===1||f<=o.stops[0][0])return o.stops[0][1];if(f>=o.stops[x-1][0])return o.stops[x-1][1];var E=Vc(o.stops.map(function(q){return q[0]}),f),T=function(q,le,me,ze){var He=ze-me,st=q-me;return He===0?0:le===1?st/He:(Math.pow(le,st)-1)/(Math.pow(le,He)-1)}(f,m,o.stops[E][0],o.stops[E+1][0]),M=o.stops[E][1],L=o.stops[E+1][1],j=wl[u.type]||$h;if(o.colorSpace&&o.colorSpace!=="rgb"){var $=Gh[o.colorSpace];j=function(q,le){return $.reverse($.interpolate($.forward(q),$.forward(le),T))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var q=[],le=arguments.length;le--;)q[le]=arguments[le];var me=M.evaluate.apply(void 0,q),ze=L.evaluate.apply(void 0,q);if(me!==void 0&&ze!==void 0)return j(me,ze,T)}}:j(M,L,T)}function al(o,u,f){return u.type==="color"?f=Ei.parse(f):u.type==="formatted"?f=fa.fromString(f.toString()):u.type==="resolvedImage"?f=Ca.fromString(f.toString()):ua(f)===u.type||u.type==="enum"&&u.values[f]||(f=void 0),Is(f,o.default,u.default)}zi.register(_u,{error:[{kind:"error"},[$r],function(o,u){throw new ia(u[0].evaluate(o))}],typeof:[$r,[on],function(o,u){return Ri(_a(u[0].evaluate(o)))}],"to-rgba":[Ci(Kt,4),[jr],function(o,u){return u[0].evaluate(o).toArray()}],rgb:[jr,[Kt,Kt,Kt],Ml],rgba:[jr,[Kt,Kt,Kt,Kt],Ml],has:{type:Br,overloads:[[[$r],function(o,u){return sh(u[0].evaluate(o),o.properties())}],[[$r,ni],function(o,u){var f=u[1];return sh(u[0].evaluate(o),f.evaluate(o))}]]},get:{type:on,overloads:[[[$r],function(o,u){return gc(u[0].evaluate(o),o.properties())}],[[$r,ni],function(o,u){var f=u[1];return gc(u[0].evaluate(o),f.evaluate(o))}]]},"feature-state":[on,[$r],function(o,u){return gc(u[0].evaluate(o),o.featureState||{})}],properties:[ni,[],function(o){return o.properties()}],"geometry-type":[$r,[],function(o){return o.geometryType()}],id:[on,[],function(o){return o.id()}],zoom:[Kt,[],function(o){return o.globals.zoom}],"heatmap-density":[Kt,[],function(o){return o.globals.heatmapDensity||0}],"line-progress":[Kt,[],function(o){return o.globals.lineProgress||0}],accumulated:[on,[],function(o){return o.globals.accumulated===void 0?null:o.globals.accumulated}],"+":[Kt,oa(Kt),function(o,u){for(var f=0,m=0,x=u;m<x.length;m+=1)f+=x[m].evaluate(o);return f}],"*":[Kt,oa(Kt),function(o,u){for(var f=1,m=0,x=u;m<x.length;m+=1)f*=x[m].evaluate(o);return f}],"-":{type:Kt,overloads:[[[Kt,Kt],function(o,u){var f=u[1];return u[0].evaluate(o)-f.evaluate(o)}],[[Kt],function(o,u){return-u[0].evaluate(o)}]]},"/":[Kt,[Kt,Kt],function(o,u){var f=u[1];return u[0].evaluate(o)/f.evaluate(o)}],"%":[Kt,[Kt,Kt],function(o,u){var f=u[1];return u[0].evaluate(o)%f.evaluate(o)}],ln2:[Kt,[],function(){return Math.LN2}],pi:[Kt,[],function(){return Math.PI}],e:[Kt,[],function(){return Math.E}],"^":[Kt,[Kt,Kt],function(o,u){var f=u[1];return Math.pow(u[0].evaluate(o),f.evaluate(o))}],sqrt:[Kt,[Kt],function(o,u){return Math.sqrt(u[0].evaluate(o))}],log10:[Kt,[Kt],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN10}],ln:[Kt,[Kt],function(o,u){return Math.log(u[0].evaluate(o))}],log2:[Kt,[Kt],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN2}],sin:[Kt,[Kt],function(o,u){return Math.sin(u[0].evaluate(o))}],cos:[Kt,[Kt],function(o,u){return Math.cos(u[0].evaluate(o))}],tan:[Kt,[Kt],function(o,u){return Math.tan(u[0].evaluate(o))}],asin:[Kt,[Kt],function(o,u){return Math.asin(u[0].evaluate(o))}],acos:[Kt,[Kt],function(o,u){return Math.acos(u[0].evaluate(o))}],atan:[Kt,[Kt],function(o,u){return Math.atan(u[0].evaluate(o))}],min:[Kt,oa(Kt),function(o,u){return Math.min.apply(Math,u.map(function(f){return f.evaluate(o)}))}],max:[Kt,oa(Kt),function(o,u){return Math.max.apply(Math,u.map(function(f){return f.evaluate(o)}))}],abs:[Kt,[Kt],function(o,u){return Math.abs(u[0].evaluate(o))}],round:[Kt,[Kt],function(o,u){var f=u[0].evaluate(o);return f<0?-Math.round(-f):Math.round(f)}],floor:[Kt,[Kt],function(o,u){return Math.floor(u[0].evaluate(o))}],ceil:[Kt,[Kt],function(o,u){return Math.ceil(u[0].evaluate(o))}],"filter-==":[Br,[$r,on],function(o,u){var f=u[0],m=u[1];return o.properties()[f.value]===m.value}],"filter-id-==":[Br,[on],function(o,u){var f=u[0];return o.id()===f.value}],"filter-type-==":[Br,[$r],function(o,u){var f=u[0];return o.geometryType()===f.value}],"filter-<":[Br,[$r,on],function(o,u){var f=u[0],m=u[1],x=o.properties()[f.value],E=m.value;return typeof x==typeof E&&x<E}],"filter-id-<":[Br,[on],function(o,u){var f=u[0],m=o.id(),x=f.value;return typeof m==typeof x&&m<x}],"filter->":[Br,[$r,on],function(o,u){var f=u[0],m=u[1],x=o.properties()[f.value],E=m.value;return typeof x==typeof E&&x>E}],"filter-id->":[Br,[on],function(o,u){var f=u[0],m=o.id(),x=f.value;return typeof m==typeof x&&m>x}],"filter-<=":[Br,[$r,on],function(o,u){var f=u[0],m=u[1],x=o.properties()[f.value],E=m.value;return typeof x==typeof E&&x<=E}],"filter-id-<=":[Br,[on],function(o,u){var f=u[0],m=o.id(),x=f.value;return typeof m==typeof x&&m<=x}],"filter->=":[Br,[$r,on],function(o,u){var f=u[0],m=u[1],x=o.properties()[f.value],E=m.value;return typeof x==typeof E&&x>=E}],"filter-id->=":[Br,[on],function(o,u){var f=u[0],m=o.id(),x=f.value;return typeof m==typeof x&&m>=x}],"filter-has":[Br,[on],function(o,u){return u[0].value in o.properties()}],"filter-has-id":[Br,[],function(o){return o.id()!==null&&o.id()!==void 0}],"filter-type-in":[Br,[Ci($r)],function(o,u){return u[0].value.indexOf(o.geometryType())>=0}],"filter-id-in":[Br,[Ci(on)],function(o,u){return u[0].value.indexOf(o.id())>=0}],"filter-in-small":[Br,[$r,Ci(on)],function(o,u){var f=u[0];return u[1].value.indexOf(o.properties()[f.value])>=0}],"filter-in-large":[Br,[$r,Ci(on)],function(o,u){var f=u[0],m=u[1];return function(x,E,T,M){for(;T<=M;){var L=T+M>>1;if(E[L]===x)return!0;E[L]>x?M=L-1:T=L+1}return!1}(o.properties()[f.value],m.value,0,m.value.length-1)}],all:{type:Br,overloads:[[[Br,Br],function(o,u){var f=u[1];return u[0].evaluate(o)&&f.evaluate(o)}],[oa(Br),function(o,u){for(var f=0,m=u;f<m.length;f+=1)if(!m[f].evaluate(o))return!1;return!0}]]},any:{type:Br,overloads:[[[Br,Br],function(o,u){var f=u[1];return u[0].evaluate(o)||f.evaluate(o)}],[oa(Br),function(o,u){for(var f=0,m=u;f<m.length;f+=1)if(m[f].evaluate(o))return!0;return!1}]]},"!":[Br,[Br],function(o,u){return!u[0].evaluate(o)}],"is-supported-script":[Br,[$r],function(o,u){var f=o.globals&&o.globals.isSupportedScript;return!f||f(u[0].evaluate(o))}],upcase:[$r,[$r],function(o,u){return u[0].evaluate(o).toUpperCase()}],downcase:[$r,[$r],function(o,u){return u[0].evaluate(o).toLowerCase()}],concat:[$r,oa(on),function(o,u){return u.map(function(f){return os(f.evaluate(o))}).join("")}],"resolved-locale":[$r,[di],function(o,u){return u[0].evaluate(o).resolvedLocale()}]});var Wl=function(o,u){this.expression=o,this._warningHistory={},this._evaluator=new Da,this._defaultValue=u?function(f){return f.type==="color"&&Pl(f.default)?new Ei(0,0,0,0):f.type==="color"?Ei.parse(f.default)||null:f.default===void 0?null:f.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function zu(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in _u}function Xc(o,u){var f=new el(_u,[],u?function(x){var E={color:jr,string:$r,number:Kt,enum:$r,boolean:Br,formatted:Fi,resolvedImage:mi};return x.type==="array"?Ci(E[x.value]||on,x.length):E[x.type]}(u):void 0),m=f.parse(o,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?_c(new Wl(m,u)):il(f.errors)}Wl.prototype.evaluateWithoutErrorHandling=function(o,u,f,m,x,E){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=m,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},Wl.prototype.evaluate=function(o,u,f,m,x,E){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=m,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ia("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var yc=function(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!Tl(u.expression)};yc.prototype.evaluateWithoutErrorHandling=function(o,u,f,m,x,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,m,x,E)},yc.prototype.evaluate=function(o,u,f,m,x,E){return this._styleExpression.evaluate(o,u,f,m,x,E)};var Gl=function(o,u,f,m){this.kind=o,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!Tl(u.expression),this.interpolationType=m};function Af(o,u){if((o=Xc(o,u)).result==="error")return o;var f=o.value.expression,m=Al(f);if(!m&&!Il(u))return il([new vr("","data expressions not supported")]);var x=Lu(f,["zoom"]);if(!x&&!uh(u))return il([new vr("","zoom expressions not supported")]);var E=function T(M){var L=null;if(M instanceof Xs)L=T(M.result);else if(M instanceof Cl)for(var j=0,$=M.args;j<$.length&&!(L=T($[j]));j+=1);else(M instanceof Rs||M instanceof Wo)&&M.input instanceof zi&&M.input.name==="zoom"&&(L=M);return L instanceof vr||M.eachChild(function(q){var le=T(q);le instanceof vr?L=le:!L&&le?L=new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):L&&le&&L!==le&&(L=new vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),L}(f);return E||x?E instanceof vr?il([E]):E instanceof Wo&&!Hc(u)?il([new vr("",'"interpolate" expressions cannot be used with this property')]):_c(E?new Gl(m?"camera":"composite",o.value,E.labels,E instanceof Wo?E.interpolation:void 0):new yc(m?"constant":"source",o.value)):il([new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Gl.prototype.evaluateWithoutErrorHandling=function(o,u,f,m,x,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,m,x,E)},Gl.prototype.evaluate=function(o,u,f,m,x,E){return this._styleExpression.evaluate(o,u,f,m,x,E)},Gl.prototype.interpolationFactor=function(o,u,f){return this.interpolationType?Wo.interpolationFactor(this.interpolationType,o,u,f):0};var xc=function(o,u){this._parameters=o,this._specification=u,Qe(this,function f(m,x){var E,T,M,L=x.type==="color",j=m.stops&&typeof m.stops[0][0]=="object",$=j||!(j||m.property!==void 0),q=m.type||(Hc(x)?"exponential":"interval");if(L&&((m=Qe({},m)).stops&&(m.stops=m.stops.map(function(gn){return[gn[0],Ei.parse(gn[1])]})),m.default=Ei.parse(m.default?m.default:x.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!Gh[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(q==="exponential")E=Sf;else if(q==="interval")E=Gc;else if(q==="categorical"){E=Wc,T=Object.create(null);for(var le=0,me=m.stops;le<me.length;le+=1){var ze=me[le];T[ze[0]]=ze[1]}M=typeof m.stops[0][0]}else{if(q!=="identity")throw new Error('Unknown function type "'+q+'"');E=al}if(j){for(var He={},st=[],et=0;et<m.stops.length;et++){var bt=m.stops[et],Lt=bt[0].zoom;He[Lt]===void 0&&(He[Lt]={zoom:Lt,type:m.type,property:m.property,default:m.default,stops:[]},st.push(Lt)),He[Lt].stops.push([bt[0].value,bt[1]])}for(var qt=[],jt=0,mr=st;jt<mr.length;jt+=1){var Vr=mr[jt];qt.push([He[Vr].zoom,f(He[Vr],x)])}var Jr={name:"linear"};return{kind:"composite",interpolationType:Jr,interpolationFactor:Wo.interpolationFactor.bind(void 0,Jr),zoomStops:qt.map(function(gn){return gn[0]}),evaluate:function(gn,Hn){var _n=gn.zoom;return Sf({stops:qt,base:m.base},x,_n).evaluate(_n,Hn)}}}if($){var Fn=q==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:Fn,interpolationFactor:Wo.interpolationFactor.bind(void 0,Fn),zoomStops:m.stops.map(function(gn){return gn[0]}),evaluate:function(gn){return E(m,x,gn.zoom,T,M)}}}return{kind:"source",evaluate:function(gn,Hn){var _n=Hn&&Hn.properties?Hn.properties[m.property]:void 0;return _n===void 0?Is(m.default,x.default):E(m,x,_n,T,M)}}}(this._parameters,this._specification))};function Ps(o){var u=o.key,f=o.value,m=o.valueSpec||{},x=o.objectElementValidators||{},E=o.style,T=o.styleSpec,M=[],L=ua(f);if(L!=="object")return[new K(u,f,"object expected, "+L+" found")];for(var j in f){var $=j.split(".")[0],q=m[$]||m["*"],le=void 0;if(x[$])le=x[$];else if(m[$])le=Di;else if(x["*"])le=x["*"];else{if(!m["*"]){M.push(new K(u,f[j],'unknown property "'+j+'"'));continue}le=Di}M=M.concat(le({key:(u&&u+".")+j,value:f[j],valueSpec:q,style:E,styleSpec:T,object:f,objectKey:j},f))}for(var me in m)x[me]||m[me].required&&m[me].default===void 0&&f[me]===void 0&&M.push(new K(u,f,'missing required property "'+me+'"'));return M}function lh(o){var u=o.value,f=o.valueSpec,m=o.style,x=o.styleSpec,E=o.key,T=o.arrayElementValidator||Di;if(ua(u)!=="array")return[new K(E,u,"array expected, "+ua(u)+" found")];if(f.length&&u.length!==f.length)return[new K(E,u,"array length "+f.length+" expected, length "+u.length+" found")];if(f["min-length"]&&u.length<f["min-length"])return[new K(E,u,"array length at least "+f["min-length"]+" expected, length "+u.length+" found")];var M={type:f.value,values:f.values};x.$version<7&&(M.function=f.function),ua(f.value)==="object"&&(M=f.value);for(var L=[],j=0;j<u.length;j++)L=L.concat(T({array:u,arrayIndex:j,value:u[j],valueSpec:M,style:m,styleSpec:x,key:E+"["+j+"]"}));return L}function $c(o){var u=o.key,f=o.value,m=o.valueSpec,x=ua(f);return x==="number"&&f!=f&&(x="NaN"),x!=="number"?[new K(u,f,"number expected, "+x+" found")]:"minimum"in m&&f<m.minimum?[new K(u,f,f+" is less than the minimum value "+m.minimum)]:"maximum"in m&&f>m.maximum?[new K(u,f,f+" is greater than the maximum value "+m.maximum)]:[]}function bc(o){var u,f,m,x=o.valueSpec,E=gt(o.value.type),T={},M=E!=="categorical"&&o.value.property===void 0,L=!M,j=ua(o.value.stops)==="array"&&ua(o.value.stops[0])==="array"&&ua(o.value.stops[0][0])==="object",$=Ps({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(me){if(E==="identity")return[new K(me.key,me.value,'identity function may not have a "stops" property')];var ze=[],He=me.value;return ze=ze.concat(lh({key:me.key,value:He,valueSpec:me.valueSpec,style:me.style,styleSpec:me.styleSpec,arrayElementValidator:q})),ua(He)==="array"&&He.length===0&&ze.push(new K(me.key,He,"array must have at least one stop")),ze},default:function(me){return Di({key:me.key,value:me.value,valueSpec:x,style:me.style,styleSpec:me.styleSpec})}}});return E==="identity"&&M&&$.push(new K(o.key,o.value,'missing required property "property"')),E==="identity"||o.value.stops||$.push(new K(o.key,o.value,'missing required property "stops"')),E==="exponential"&&o.valueSpec.expression&&!Hc(o.valueSpec)&&$.push(new K(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(L&&!Il(o.valueSpec)?$.push(new K(o.key,o.value,"property functions not supported")):M&&!uh(o.valueSpec)&&$.push(new K(o.key,o.value,"zoom functions not supported"))),E!=="categorical"&&!j||o.value.property!==void 0||$.push(new K(o.key,o.value,'"property" property is required')),$;function q(me){var ze=[],He=me.value,st=me.key;if(ua(He)!=="array")return[new K(st,He,"array expected, "+ua(He)+" found")];if(He.length!==2)return[new K(st,He,"array length 2 expected, length "+He.length+" found")];if(j){if(ua(He[0])!=="object")return[new K(st,He,"object expected, "+ua(He[0])+" found")];if(He[0].zoom===void 0)return[new K(st,He,"object stop key must have zoom")];if(He[0].value===void 0)return[new K(st,He,"object stop key must have value")];if(m&&m>gt(He[0].zoom))return[new K(st,He[0].zoom,"stop zoom values must appear in ascending order")];gt(He[0].zoom)!==m&&(m=gt(He[0].zoom),f=void 0,T={}),ze=ze.concat(Ps({key:st+"[0]",value:He[0],valueSpec:{zoom:{}},style:me.style,styleSpec:me.styleSpec,objectElementValidators:{zoom:$c,value:le}}))}else ze=ze.concat(le({key:st+"[0]",value:He[0],valueSpec:{},style:me.style,styleSpec:me.styleSpec},He));return zu(pe(He[1]))?ze.concat([new K(st+"[1]",He[1],"expressions are not allowed in function stops.")]):ze.concat(Di({key:st+"[1]",value:He[1],valueSpec:x,style:me.style,styleSpec:me.styleSpec}))}function le(me,ze){var He=ua(me.value),st=gt(me.value),et=me.value!==null?me.value:ze;if(u){if(He!==u)return[new K(me.key,et,He+" stop domain type must match previous stop domain type "+u)]}else u=He;if(He!=="number"&&He!=="string"&&He!=="boolean")return[new K(me.key,et,"stop domain value must be a number, string, or boolean")];if(He!=="number"&&E!=="categorical"){var bt="number expected, "+He+" found";return Il(x)&&E===void 0&&(bt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new K(me.key,et,bt)]}return E!=="categorical"||He!=="number"||isFinite(st)&&Math.floor(st)===st?E!=="categorical"&&He==="number"&&f!==void 0&&st<f?[new K(me.key,et,"stop domain values must appear in ascending order")]:(f=st,E==="categorical"&&st in T?[new K(me.key,et,"stop domain values must be unique")]:(T[st]=!0,[])):[new K(me.key,et,"integer expected, found "+st)]}}function Ol(o){var u=(o.expressionContext==="property"?Af:Xc)(pe(o.value),o.valueSpec);if(u.result==="error")return u.value.map(function(m){return new K(""+o.key+m.key,o.value,m.message)});var f=u.value.expression||u.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!f.outputDefined())return[new K(o.key,o.value,'Invalid data expression for "'+o.propertyKey+'". Output values must be contained as literals within the expression.')];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Tl(f))return[new K(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!Tl(f))return[new K(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Lu(f,["zoom","feature-state"]))return[new K(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Al(f))return[new K(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zu(o){var u=o.key,f=o.value,m=o.valueSpec,x=[];return Array.isArray(m.values)?m.values.indexOf(gt(f))===-1&&x.push(new K(u,f,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(f)+" found")):Object.keys(m.values).indexOf(gt(f))===-1&&x.push(new K(u,f,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(f)+" found")),x}function Xl(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(var u=0,f=o.slice(1);u<f.length;u+=1){var m=f[u];if(!Xl(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}xc.deserialize=function(o){return new xc(o._parameters,o._specification)},xc.serialize=function(o){return{_parameters:o._parameters,_specification:o._specification}};var Tf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ol(o){if(o==null)return{filter:function(){return!0},needGeometry:!1};Xl(o)||(o=fh(o));var u=Xc(o,Tf);if(u.result==="error")throw new Error(u.value.map(function(f){return f.key+": "+f.message}).join(", "));return{filter:function(f,m,x){return u.value.evaluate(f,m,{},x)},needGeometry:function f(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var x=1;x<m.length;x++)if(f(m[x]))return!0;return!1}(o)}}function ch(o,u){return o<u?-1:o>u?1:0}function fh(o){if(!o)return!0;var u,f=o[0];return o.length<=1?f!=="any":f==="=="?hh(o[1],o[2],"=="):f==="!="?La(hh(o[1],o[2],"==")):f==="<"||f===">"||f==="<="||f===">="?hh(o[1],o[2],f):f==="any"?(u=o.slice(1),["any"].concat(u.map(fh))):f==="all"?["all"].concat(o.slice(1).map(fh)):f==="none"?["all"].concat(o.slice(1).map(fh).map(La)):f==="in"?wf(o[1],o.slice(2)):f==="!in"?La(wf(o[1],o.slice(2))):f==="has"?Yh(o[1]):f==="!has"?La(Yh(o[1])):f!=="within"||o}function hh(o,u,f){switch(o){case"$type":return["filter-type-"+f,u];case"$id":return["filter-id-"+f,u];default:return["filter-"+f,o,u]}}function wf(o,u){if(u.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(f){return typeof f!=typeof u[0]})?["filter-in-large",o,["literal",u.sort(ch)]]:["filter-in-small",o,["literal",u]]}}function Yh(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function La(o){return["!",o]}function qh(o){return Xl(pe(o.value))?Ol(Qe({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(f){var m=f.value,x=f.key;if(ua(m)!=="array")return[new K(x,m,"array expected, "+ua(m)+" found")];var E,T=f.styleSpec,M=[];if(m.length<1)return[new K(x,m,"filter array must have at least 1 element")];switch(M=M.concat(Zu({key:x+"[0]",value:m[0],valueSpec:T.filter_operator,style:f.style,styleSpec:f.styleSpec})),gt(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&gt(m[1])==="$type"&&M.push(new K(x,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&M.push(new K(x,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(E=ua(m[1]))!=="string"&&M.push(new K(x+"[1]",m[1],"string expected, "+E+" found"));for(var L=2;L<m.length;L++)E=ua(m[L]),gt(m[1])==="$type"?M=M.concat(Zu({key:x+"["+L+"]",value:m[L],valueSpec:T.geometry_type,style:f.style,styleSpec:f.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&M.push(new K(x+"["+L+"]",m[L],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var j=1;j<m.length;j++)M=M.concat(u({key:x+"["+j+"]",value:m[j],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":E=ua(m[1]),m.length!==2?M.push(new K(x,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="string"&&M.push(new K(x+"[1]",m[1],"string expected, "+E+" found"));break;case"within":E=ua(m[1]),m.length!==2?M.push(new K(x,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="object"&&M.push(new K(x+"[1]",m[1],"object expected, "+E+" found"))}return M}(o)}function Cf(o,u){var f=o.key,m=o.style,x=o.styleSpec,E=o.value,T=o.objectKey,M=x[u+"_"+o.layerType];if(!M)return[];var L=T.match(/^(.*)-transition$/);if(u==="paint"&&L&&M[L[1]]&&M[L[1]].transition)return Di({key:f,value:E,valueSpec:x.transition,style:m,styleSpec:x});var j,$=o.valueSpec||M[T];if(!$)return[new K(f,E,'unknown property "'+T+'"')];if(ua(E)==="string"&&Il($)&&!$.tokens&&(j=/^{([^}]+)}$/.exec(E)))return[new K(f,E,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(j[1])+" }`.")];var q=[];return o.layerType==="symbol"&&(T==="text-field"&&m&&!m.glyphs&&q.push(new K(f,E,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&Pl(pe(E))&&gt(E.type)==="identity"&&q.push(new K(f,E,'"text-font" does not support identity functions'))),q.concat(Di({key:o.key,value:E,valueSpec:$,style:m,styleSpec:x,expressionContext:"property",propertyType:u,propertyKey:T}))}function Kh(o){return Cf(o,"paint")}function $l(o){return Cf(o,"layout")}function Qh(o){var u=[],f=o.value,m=o.key,x=o.style,E=o.styleSpec;f.type||f.ref||u.push(new K(m,f,'either "type" or "ref" is required'));var T,M=gt(f.type),L=gt(f.ref);if(f.id)for(var j=gt(f.id),$=0;$<o.arrayIndex;$++){var q=x.layers[$];gt(q.id)===j&&u.push(new K(m,f.id,'duplicate layer id "'+f.id+'", previously used at line '+q.id.__line__))}if("ref"in f)["type","source","source-layer","filter","layout"].forEach(function(ze){ze in f&&u.push(new K(m,f[ze],'"'+ze+'" is prohibited for ref layers'))}),x.layers.forEach(function(ze){gt(ze.id)===L&&(T=ze)}),T?T.ref?u.push(new K(m,f.ref,"ref cannot reference another ref layer")):M=gt(T.type):u.push(new K(m,f.ref,'ref layer "'+L+'" not found'));else if(M!=="background")if(f.source){var le=x.sources&&x.sources[f.source],me=le&&gt(le.type);le?me==="vector"&&M==="raster"?u.push(new K(m,f.source,'layer "'+f.id+'" requires a raster source')):me==="raster"&&M!=="raster"?u.push(new K(m,f.source,'layer "'+f.id+'" requires a vector source')):me!=="vector"||f["source-layer"]?me==="raster-dem"&&M!=="hillshade"?u.push(new K(m,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!f.paint||!f.paint["line-gradient"]||me==="geojson"&&le.lineMetrics||u.push(new K(m,f,'layer "'+f.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new K(m,f,'layer "'+f.id+'" must specify a "source-layer"')):u.push(new K(m,f.source,'source "'+f.source+'" not found'))}else u.push(new K(m,f,'missing required property "source"'));return u=u.concat(Ps({key:m,value:f,valueSpec:E.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Di({key:m+".type",value:f.type,valueSpec:E.layer.type,style:o.style,styleSpec:o.styleSpec,object:f,objectKey:"type"})},filter:qh,layout:function(ze){return Ps({layer:f,key:ze.key,value:ze.value,style:ze.style,styleSpec:ze.styleSpec,objectElementValidators:{"*":function(He){return $l(Qe({layerType:M},He))}}})},paint:function(ze){return Ps({layer:f,key:ze.key,value:ze.value,style:ze.style,styleSpec:ze.styleSpec,objectElementValidators:{"*":function(He){return Kh(Qe({layerType:M},He))}}})}}}))}function su(o){var u=o.value,f=o.key,m=ua(u);return m!=="string"?[new K(f,u,"string expected, "+m+" found")]:[]}var la={promoteId:function(o){var u=o.key,f=o.value;if(ua(f)==="string")return su({key:u,value:f});var m=[];for(var x in f)m.push.apply(m,su({key:u+"."+x,value:f[x]}));return m}};function Yl(o){var u=o.value,f=o.key,m=o.styleSpec,x=o.style;if(!u.type)return[new K(f,u,'"type" is required')];var E,T=gt(u.type);switch(T){case"vector":case"raster":case"raster-dem":return Ps({key:f,value:u,valueSpec:m["source_"+T.replace("-","_")],style:o.style,styleSpec:m,objectElementValidators:la});case"geojson":if(E=Ps({key:f,value:u,valueSpec:m.source_geojson,style:x,styleSpec:m,objectElementValidators:la}),u.cluster)for(var M in u.clusterProperties){var L=u.clusterProperties[M],j=L[0],$=typeof j=="string"?[j,["accumulated"],["get",M]]:j;E.push.apply(E,Ol({key:f+"."+M+".map",value:L[1],expressionContext:"cluster-map"})),E.push.apply(E,Ol({key:f+"."+M+".reduce",value:$,expressionContext:"cluster-reduce"}))}return E;case"video":return Ps({key:f,value:u,valueSpec:m.source_video,style:x,styleSpec:m});case"image":return Ps({key:f,value:u,valueSpec:m.source_image,style:x,styleSpec:m});case"canvas":return[new K(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zu({key:f+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:x,styleSpec:m})}}function Vu(o){var u=o.value,f=o.styleSpec,m=f.light,x=o.style,E=[],T=ua(u);if(u===void 0)return E;if(T!=="object")return E.concat([new K("light",u,"object expected, "+T+" found")]);for(var M in u){var L=M.match(/^(.*)-transition$/);E=E.concat(L&&m[L[1]]&&m[L[1]].transition?Di({key:M,value:u[M],valueSpec:f.transition,style:x,styleSpec:f}):m[M]?Di({key:M,value:u[M],valueSpec:m[M],style:x,styleSpec:f}):[new K(M,u[M],'unknown property "'+M+'"')])}return E}var sl={"*":function(){return[]},array:lh,boolean:function(o){var u=o.value,f=o.key,m=ua(u);return m!=="boolean"?[new K(f,u,"boolean expected, "+m+" found")]:[]},number:$c,color:function(o){var u=o.key,f=o.value,m=ua(f);return m!=="string"?[new K(u,f,"color expected, "+m+" found")]:gi(f)===null?[new K(u,f,'color expected, "'+f+'" found')]:[]},constants:ge,enum:Zu,filter:qh,function:bc,layer:Qh,object:Ps,source:Yl,light:Vu,string:su,formatted:function(o){return su(o).length===0?[]:Ol(o)},resolvedImage:function(o){return su(o).length===0?[]:Ol(o)}};function Di(o){var u=o.value,f=o.valueSpec,m=o.styleSpec;return f.expression&&Pl(gt(u))?bc(o):f.expression&&zu(pe(u))?Ol(o):f.type&&sl[f.type]?sl[f.type](o):Ps(Qe({},o,{valueSpec:f.type?m[f.type]:f}))}function ha(o){var u=o.value,f=o.key,m=su(o);return m.length||(u.indexOf("{fontstack}")===-1&&m.push(new K(f,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&m.push(new K(f,u,'"glyphs" url must include a "{range}" token'))),m}function uu(o,u){u===void 0&&(u=he);var f=[];return f=f.concat(Di({key:"",value:o,valueSpec:u.$root,styleSpec:u,style:o,objectElementValidators:{glyphs:ha,"*":function(){return[]}}})),o.constants&&(f=f.concat(ge({key:"constants",value:o.constants,style:o,styleSpec:u}))),Yc(f)}function Yc(o){return[].concat(o).sort(function(u,f){return u.line-f.line})}function qc(o){return function(){for(var u=[],f=arguments.length;f--;)u[f]=arguments[f];return Yc(o.apply(this,u))}}uu.source=qc(Yl),uu.light=qc(Vu),uu.layer=qc(Qh),uu.filter=qc(qh),uu.paintProperty=qc(Kh),uu.layoutProperty=qc($l);var qs=uu,Jh=qs.light,Rf=qs.paintProperty,Mf=qs.layoutProperty;function ql(o,u){var f=!1;if(u&&u.length)for(var m=0,x=u;m<x.length;m+=1)o.fire(new Ue(new Error(x[m].message))),f=!0;return f}var So=Ba;function Ba(o,u,f){var m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var x=new Int32Array(this.arrayBuffer);o=x[0],this.d=(u=x[1])+2*(f=x[2]);for(var E=0;E<this.d*this.d;E++){var T=x[3+E],M=x[3+E+1];m.push(T===M?null:x.subarray(T,M))}var L=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],L),this.bboxes=x.subarray(L),this.insert=this._insertReadonly}else{this.d=u+2*f;for(var j=0;j<this.d*this.d;j++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=f,this.scale=u/o,this.uid=0;var $=f/u*o;this.min=-$,this.max=o+$}Ba.prototype.insert=function(o,u,f,m,x){this._forEachCell(u,f,m,x,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(x)},Ba.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ba.prototype._insertCell=function(o,u,f,m,x,E){this.cells[x].push(E)},Ba.prototype.query=function(o,u,f,m,x){var E=this.min,T=this.max;if(o<=E&&u<=E&&T<=f&&T<=m&&!x)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(o,u,f,m,this._queryCell,M,{},x),M},Ba.prototype._queryCell=function(o,u,f,m,x,E,T,M){var L=this.cells[x];if(L!==null)for(var j=this.keys,$=this.bboxes,q=0;q<L.length;q++){var le=L[q];if(T[le]===void 0){var me=4*le;(M?M($[me+0],$[me+1],$[me+2],$[me+3]):o<=$[me+2]&&u<=$[me+3]&&f>=$[me+0]&&m>=$[me+1])?(T[le]=!0,E.push(j[le])):T[le]=!1}}},Ba.prototype._forEachCell=function(o,u,f,m,x,E,T,M){for(var L=this._convertToCellCoord(o),j=this._convertToCellCoord(u),$=this._convertToCellCoord(f),q=this._convertToCellCoord(m),le=L;le<=$;le++)for(var me=j;me<=q;me++){var ze=this.d*me+le;if((!M||M(this._convertFromCellCoord(le),this._convertFromCellCoord(me),this._convertFromCellCoord(le+1),this._convertFromCellCoord(me+1)))&&x.call(this,o,u,f,m,ze,E,T,M))return}},Ba.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Ba.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Ba.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=3+this.cells.length+1+1,f=0,m=0;m<this.cells.length;m++)f+=this.cells[m].length;var x=new Int32Array(u+f+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var E=u,T=0;T<o.length;T++){var M=o[T];x[3+T]=E,x.set(M,E),E+=M.length}return x[3+o.length]=E,x.set(this.keys,E),x[3+o.length+1]=E+=this.keys.length,x.set(this.bboxes,E),E+=this.bboxes.length,x.buffer};var Kc=ie.ImageData,Ec=ie.ImageBitmap,to={};function bn(o,u,f){f===void 0&&(f={}),Object.defineProperty(u,"_classRegistryKey",{value:o,writeable:!1}),to[o]={klass:u,omit:f.omit||[],shallow:f.shallow||[]}}for(var ss in bn("Object",Object),So.serialize=function(o,u){var f=o.toArrayBuffer();return u&&u.push(f),{buffer:f}},So.deserialize=function(o){return new So(o.buffer)},bn("Grid",So),bn("Color",Ei),bn("Error",Error),bn("ResolvedImage",Ca),bn("StylePropertyFunction",xc),bn("StyleExpression",Wl,{omit:["_evaluator"]}),bn("ZoomDependentExpression",Gl),bn("ZoomConstantExpression",yc),bn("CompoundExpression",zi,{omit:["_evaluate"]}),_u)_u[ss]._classRegistryKey||bn("Expression_"+ss,_u[ss]);function If(o){return o&&typeof ArrayBuffer!="undefined"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Sc(o){return Ec&&o instanceof Ec}function Yo(o,u){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(If(o)||Sc(o))return u&&u.push(o),o;if(ArrayBuffer.isView(o)){var f=o;return u&&u.push(f.buffer),f}if(o instanceof Kc)return u&&u.push(o.data.buffer),o;if(Array.isArray(o)){for(var m=[],x=0,E=o;x<E.length;x+=1)m.push(Yo(E[x],u));return m}if(typeof o=="object"){var T=o.constructor,M=T._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var L=T.serialize?T.serialize(o,u):{};if(!T.serialize){for(var j in o)if(o.hasOwnProperty(j)&&!(to[M].omit.indexOf(j)>=0)){var $=o[j];L[j]=to[M].shallow.indexOf(j)>=0?$:Yo($,u)}o instanceof Error&&(L.message=o.message)}if(L.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(L.$name=M),L}throw new Error("can't serialize object of type "+typeof o)}function ca(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||If(o)||Sc(o)||ArrayBuffer.isView(o)||o instanceof Kc)return o;if(Array.isArray(o))return o.map(ca);if(typeof o=="object"){var u=o.$name||"Object",f=to[u].klass;if(!f)throw new Error("can't deserialize unregistered class "+u);if(f.deserialize)return f.deserialize(o);for(var m=Object.create(f.prototype),x=0,E=Object.keys(o);x<E.length;x+=1){var T=E[x];if(T!=="$name"){var M=o[T];m[T]=to[u].shallow.indexOf(T)>=0?M:ca(M)}}return m}throw new Error("can't deserialize object of type "+typeof o)}var Pf=function(){this.first=!0};Pf.prototype.update=function(o,u){var f=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=f,!0))};var sn={"Latin-1 Supplement":function(o){return o>=128&&o<=255},Arabic:function(o){return o>=1536&&o<=1791},"Arabic Supplement":function(o){return o>=1872&&o<=1919},"Arabic Extended-A":function(o){return o>=2208&&o<=2303},"Hangul Jamo":function(o){return o>=4352&&o<=4607},"Unified Canadian Aboriginal Syllabics":function(o){return o>=5120&&o<=5759},Khmer:function(o){return o>=6016&&o<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(o){return o>=6320&&o<=6399},"General Punctuation":function(o){return o>=8192&&o<=8303},"Letterlike Symbols":function(o){return o>=8448&&o<=8527},"Number Forms":function(o){return o>=8528&&o<=8591},"Miscellaneous Technical":function(o){return o>=8960&&o<=9215},"Control Pictures":function(o){return o>=9216&&o<=9279},"Optical Character Recognition":function(o){return o>=9280&&o<=9311},"Enclosed Alphanumerics":function(o){return o>=9312&&o<=9471},"Geometric Shapes":function(o){return o>=9632&&o<=9727},"Miscellaneous Symbols":function(o){return o>=9728&&o<=9983},"Miscellaneous Symbols and Arrows":function(o){return o>=11008&&o<=11263},"CJK Radicals Supplement":function(o){return o>=11904&&o<=12031},"Kangxi Radicals":function(o){return o>=12032&&o<=12255},"Ideographic Description Characters":function(o){return o>=12272&&o<=12287},"CJK Symbols and Punctuation":function(o){return o>=12288&&o<=12351},Hiragana:function(o){return o>=12352&&o<=12447},Katakana:function(o){return o>=12448&&o<=12543},Bopomofo:function(o){return o>=12544&&o<=12591},"Hangul Compatibility Jamo":function(o){return o>=12592&&o<=12687},Kanbun:function(o){return o>=12688&&o<=12703},"Bopomofo Extended":function(o){return o>=12704&&o<=12735},"CJK Strokes":function(o){return o>=12736&&o<=12783},"Katakana Phonetic Extensions":function(o){return o>=12784&&o<=12799},"Enclosed CJK Letters and Months":function(o){return o>=12800&&o<=13055},"CJK Compatibility":function(o){return o>=13056&&o<=13311},"CJK Unified Ideographs Extension A":function(o){return o>=13312&&o<=19903},"Yijing Hexagram Symbols":function(o){return o>=19904&&o<=19967},"CJK Unified Ideographs":function(o){return o>=19968&&o<=40959},"Yi Syllables":function(o){return o>=40960&&o<=42127},"Yi Radicals":function(o){return o>=42128&&o<=42191},"Hangul Jamo Extended-A":function(o){return o>=43360&&o<=43391},"Hangul Syllables":function(o){return o>=44032&&o<=55215},"Hangul Jamo Extended-B":function(o){return o>=55216&&o<=55295},"Private Use Area":function(o){return o>=57344&&o<=63743},"CJK Compatibility Ideographs":function(o){return o>=63744&&o<=64255},"Arabic Presentation Forms-A":function(o){return o>=64336&&o<=65023},"Vertical Forms":function(o){return o>=65040&&o<=65055},"CJK Compatibility Forms":function(o){return o>=65072&&o<=65103},"Small Form Variants":function(o){return o>=65104&&o<=65135},"Arabic Presentation Forms-B":function(o){return o>=65136&&o<=65279},"Halfwidth and Fullwidth Forms":function(o){return o>=65280&&o<=65519}};function ul(o){for(var u=0,f=o;u<f.length;u+=1)if(Qc(f[u].charCodeAt(0)))return!0;return!1}function Qc(o){return!(o!==746&&o!==747&&(o<4352||!(sn["Bopomofo Extended"](o)||sn.Bopomofo(o)||sn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||sn["CJK Compatibility Ideographs"](o)||sn["CJK Compatibility"](o)||sn["CJK Radicals Supplement"](o)||sn["CJK Strokes"](o)||!(!sn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||sn["CJK Unified Ideographs Extension A"](o)||sn["CJK Unified Ideographs"](o)||sn["Enclosed CJK Letters and Months"](o)||sn["Hangul Compatibility Jamo"](o)||sn["Hangul Jamo Extended-A"](o)||sn["Hangul Jamo Extended-B"](o)||sn["Hangul Jamo"](o)||sn["Hangul Syllables"](o)||sn.Hiragana(o)||sn["Ideographic Description Characters"](o)||sn.Kanbun(o)||sn["Kangxi Radicals"](o)||sn["Katakana Phonetic Extensions"](o)||sn.Katakana(o)&&o!==12540||!(!sn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!sn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||sn["Unified Canadian Aboriginal Syllabics"](o)||sn["Unified Canadian Aboriginal Syllabics Extended"](o)||sn["Vertical Forms"](o)||sn["Yijing Hexagram Symbols"](o)||sn["Yi Syllables"](o)||sn["Yi Radicals"](o))))}function Jc(o){return!(Qc(o)||function(u){return!!(sn["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||sn["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||sn["Letterlike Symbols"](u)||sn["Number Forms"](u)||sn["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||sn["Control Pictures"](u)&&u!==9251||sn["Optical Character Recognition"](u)||sn["Enclosed Alphanumerics"](u)||sn["Geometric Shapes"](u)||sn["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||sn["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||sn["CJK Symbols and Punctuation"](u)||sn.Katakana(u)||sn["Private Use Area"](u)||sn["CJK Compatibility Forms"](u)||sn["Small Form Variants"](u)||sn["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(o))}function yu(o){return o>=1424&&o<=2303||sn["Arabic Presentation Forms-A"](o)||sn["Arabic Presentation Forms-B"](o)}function Os(o,u){return!(!u&&yu(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||sn.Khmer(o))}function Of(o){for(var u=0,f=o;u<f.length;u+=1)if(yu(f[u].charCodeAt(0)))return!0;return!1}var kf=null,us="unavailable",xu=null,ep=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(us="error"),kf&&kf(o)};function Ac(){Tc.fire(new Se("pluginStateChange",{pluginStatus:us,pluginURL:xu}))}var Tc=new Je,ef=function(){return us},ks=function(){if(us!=="deferred"||!xu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");us="loading",Ac(),xu&&At({url:xu},function(o){o?ep(o):(us="loaded",Ac())})},Nt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return us==="loaded"||Nt.applyArabicShaping!=null},isLoading:function(){return us==="loading"},setState:function(o){us=o.pluginStatus,xu=o.pluginURL},isParsed:function(){return Nt.applyArabicShaping!=null&&Nt.processBidirectionalText!=null&&Nt.processStyledBidirectionalText!=null},getPluginURL:function(){return xu}},we=function(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Pf,this.transition={})};we.prototype.isSupportedScript=function(o){return function(u,f){for(var m=0,x=u;m<x.length;m+=1)if(!Os(x[m].charCodeAt(0),f))return!1;return!0}(o,Nt.isLoaded())},we.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},we.prototype.getCrossfadeParameters=function(){var o=this.zoom,u=o-Math.floor(o),f=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}};var N=function(o,u){this.property=o,this.value=u,this.expression=function(f,m){if(Pl(f))return new xc(f,m);if(zu(f)){var x=Af(f,m);if(x.result==="error")throw new Error(x.value.map(function(T){return T.key+": "+T.message}).join(", "));return x.value}var E=f;return typeof f=="string"&&m.type==="color"&&(E=Ei.parse(f)),{kind:"constant",evaluate:function(){return E}}}(u===void 0?o.specification.default:u,o.specification)};N.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},N.prototype.possiblyEvaluate=function(o,u,f){return this.property.possiblyEvaluate(this,o,u,f)};var Ks=function(o){this.property=o,this.value=new N(o,void 0)};Ks.prototype.transitioned=function(o,u){return new kl(this.property,this.value,u,Xt({},o.transition,this.transition),o.now)},Ks.prototype.untransitioned=function(){return new kl(this.property,this.value,null,{},0)};var xe=function(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)};xe.prototype.getValue=function(o){return lt(this._values[o].value.value)},xe.prototype.setValue=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new Ks(this._values[o].property)),this._values[o].value=new N(this._values[o].property,u===null?void 0:lt(u))},xe.prototype.getTransition=function(o){return lt(this._values[o].transition)},xe.prototype.setTransition=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new Ks(this._values[o].property)),this._values[o].transition=lt(u)||void 0},xe.prototype.serialize=function(){for(var o={},u=0,f=Object.keys(this._values);u<f.length;u+=1){var m=f[u],x=this.getValue(m);x!==void 0&&(o[m]=x);var E=this.getTransition(m);E!==void 0&&(o[m+"-transition"]=E)}return o},xe.prototype.transitioned=function(o,u){for(var f=new Fa(this._properties),m=0,x=Object.keys(this._values);m<x.length;m+=1){var E=x[m];f._values[E]=this._values[E].transitioned(o,u._values[E])}return f},xe.prototype.untransitioned=function(){for(var o=new Fa(this._properties),u=0,f=Object.keys(this._values);u<f.length;u+=1){var m=f[u];o._values[m]=this._values[m].untransitioned()}return o};var kl=function(o,u,f,m,x){this.property=o,this.value=u,this.begin=x+m.delay||0,this.end=this.begin+m.duration||0,o.specification.transition&&(m.delay||m.duration)&&(this.prior=f)};kl.prototype.possiblyEvaluate=function(o,u,f){var m=o.now||0,x=this.value.possiblyEvaluate(o,u,f),E=this.prior;if(E){if(m>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(m<this.begin)return E.possiblyEvaluate(o,u,f);var T=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(o,u,f),x,function(M){if(M<=0)return 0;if(M>=1)return 1;var L=M*M,j=L*M;return 4*(M<.5?j:3*(M-L)+j-.75)}(T))}return x};var Fa=function(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)};Fa.prototype.possiblyEvaluate=function(o,u,f){for(var m=new ls(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var T=E[x];m._values[T]=this._values[T].possiblyEvaluate(o,u,f)}return m},Fa.prototype.hasTransition=function(){for(var o=0,u=Object.keys(this._values);o<u.length;o+=1)if(this._values[u[o]].prior)return!0;return!1};var Ds=function(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)};Ds.prototype.getValue=function(o){return lt(this._values[o].value)},Ds.prototype.setValue=function(o,u){this._values[o]=new N(this._values[o].property,u===null?void 0:lt(u))},Ds.prototype.serialize=function(){for(var o={},u=0,f=Object.keys(this._values);u<f.length;u+=1){var m=f[u],x=this.getValue(m);x!==void 0&&(o[m]=x)}return o},Ds.prototype.possiblyEvaluate=function(o,u,f){for(var m=new ls(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var T=E[x];m._values[T]=this._values[T].possiblyEvaluate(o,u,f)}return m};var Ao=function(o,u,f){this.property=o,this.value=u,this.parameters=f};Ao.prototype.isConstant=function(){return this.value.kind==="constant"},Ao.prototype.constantOr=function(o){return this.value.kind==="constant"?this.value.value:o},Ao.prototype.evaluate=function(o,u,f,m){return this.property.evaluate(this.value,this.parameters,o,u,f,m)};var ls=function(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)};ls.prototype.get=function(o){return this._values[o]};var Ln=function(o){this.specification=o};Ln.prototype.possiblyEvaluate=function(o,u){return o.expression.evaluate(u)},Ln.prototype.interpolate=function(o,u,f){var m=wl[this.specification.type];return m?m(o,u,f):o};var An=function(o,u){this.specification=o,this.overrides=u};An.prototype.possiblyEvaluate=function(o,u,f,m){return new Ao(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(u,null,{},f,m)}:o.expression,u)},An.prototype.interpolate=function(o,u,f){if(o.value.kind!=="constant"||u.value.kind!=="constant")return o;if(o.value.value===void 0||u.value.value===void 0)return new Ao(this,{kind:"constant",value:void 0},o.parameters);var m=wl[this.specification.type];return m?new Ao(this,{kind:"constant",value:m(o.value.value,u.value.value,f)},o.parameters):o},An.prototype.evaluate=function(o,u,f,m,x,E){return o.kind==="constant"?o.value:o.evaluate(u,f,m,x,E)};var qo=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(f,m,x,E){if(f.value===void 0)return new Ao(this,{kind:"constant",value:void 0},m);if(f.expression.kind==="constant"){var T=f.expression.evaluate(m,null,{},x,E),M=f.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,L=this._calculate(M,M,M,m);return new Ao(this,{kind:"constant",value:L},m)}if(f.expression.kind==="camera"){var j=this._calculate(f.expression.evaluate({zoom:m.zoom-1}),f.expression.evaluate({zoom:m.zoom}),f.expression.evaluate({zoom:m.zoom+1}),m);return new Ao(this,{kind:"constant",value:j},m)}return new Ao(this,f.expression,m)},u.prototype.evaluate=function(f,m,x,E,T,M){if(f.kind==="source"){var L=f.evaluate(m,x,E,T,M);return this._calculate(L,L,L,m)}return f.kind==="composite"?this._calculate(f.evaluate({zoom:Math.floor(m.zoom)-1},x,E),f.evaluate({zoom:Math.floor(m.zoom)},x,E),f.evaluate({zoom:Math.floor(m.zoom)+1},x,E),m):f.value},u.prototype._calculate=function(f,m,x,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:f,to:m}:{from:x,to:m}},u.prototype.interpolate=function(f){return f},u}(An),Ko=function(o){this.specification=o};Ko.prototype.possiblyEvaluate=function(o,u,f,m){if(o.value!==void 0){if(o.expression.kind==="constant"){var x=o.expression.evaluate(u,null,{},f,m);return this._calculate(x,x,x,u)}return this._calculate(o.expression.evaluate(new we(Math.floor(u.zoom-1),u)),o.expression.evaluate(new we(Math.floor(u.zoom),u)),o.expression.evaluate(new we(Math.floor(u.zoom+1),u)),u)}},Ko.prototype._calculate=function(o,u,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:f,to:u}},Ko.prototype.interpolate=function(o){return o};var bu=function(o){this.specification=o};bu.prototype.possiblyEvaluate=function(o,u,f,m){return!!o.expression.evaluate(u,null,{},f,m)},bu.prototype.interpolate=function(){return!1};var Ma=function(o){for(var u in this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],o){var f=o[u];f.specification.overridable&&this.overridableProperties.push(u);var m=this.defaultPropertyValues[u]=new N(f,void 0),x=this.defaultTransitionablePropertyValues[u]=new Ks(f);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate({})}};bn("DataDrivenProperty",An),bn("DataConstantProperty",Ln),bn("CrossFadedDataDrivenProperty",qo),bn("CrossFadedProperty",Ko),bn("ColorRampProperty",bu);var Qs=function(o){function u(f,m){if(o.call(this),this.id=f.id,this.type=f.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},f.type!=="custom"&&(this.metadata=(f=f).metadata,this.minzoom=f.minzoom,this.maxzoom=f.maxzoom,f.type!=="background"&&(this.source=f.source,this.sourceLayer=f["source-layer"],this.filter=f.filter),m.layout&&(this._unevaluatedLayout=new Ds(m.layout)),m.paint)){for(var x in this._transitionablePaint=new xe(m.paint),f.paint)this.setPaintProperty(x,f.paint[x],{validate:!1});for(var E in f.layout)this.setLayoutProperty(E,f.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ls(m.paint)}}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(f){return f==="visibility"?this.visibility:this._unevaluatedLayout.getValue(f)},u.prototype.setLayoutProperty=function(f,m,x){x===void 0&&(x={}),m!=null&&this._validate(Mf,"layers."+this.id+".layout."+f,f,m,x)||(f!=="visibility"?this._unevaluatedLayout.setValue(f,m):this.visibility=m)},u.prototype.getPaintProperty=function(f){return Tr(f,"-transition")?this._transitionablePaint.getTransition(f.slice(0,-"-transition".length)):this._transitionablePaint.getValue(f)},u.prototype.setPaintProperty=function(f,m,x){if(x===void 0&&(x={}),m!=null&&this._validate(Rf,"layers."+this.id+".paint."+f,f,m,x))return!1;if(Tr(f,"-transition"))return this._transitionablePaint.setTransition(f.slice(0,-"-transition".length),m||void 0),!1;var E=this._transitionablePaint._values[f],T=E.property.specification["property-type"]==="cross-faded-data-driven",M=E.value.isDataDriven(),L=E.value;this._transitionablePaint.setValue(f,m),this._handleSpecialPaintPropertyUpdate(f);var j=this._transitionablePaint._values[f].value;return j.isDataDriven()||M||T||this._handleOverridablePaintPropertyUpdate(f,L,j)},u.prototype._handleSpecialPaintPropertyUpdate=function(f){},u.prototype._handleOverridablePaintPropertyUpdate=function(f,m,x){return!1},u.prototype.isHidden=function(f){return!!(this.minzoom&&f<this.minzoom)||!!(this.maxzoom&&f>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(f){this._transitioningPaint=this._transitionablePaint.transitioned(f,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(f,m){f.getCrossfadeParameters&&(this._crossfadeParameters=f.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(f,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(f,void 0,m)},u.prototype.serialize=function(){var f={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(f.layout=f.layout||{},f.layout.visibility=this.visibility),Mt(f,function(m,x){return!(m===void 0||x==="layout"&&!Object.keys(m).length||x==="paint"&&!Object.keys(m).length)})},u.prototype._validate=function(f,m,x,E,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&ql(this,f.call(qs,{key:m,layerType:this.type,objectKey:x,value:E,styleSpec:he,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var f in this.paint._values){var m=this.paint.get(f);if(m instanceof Ao&&Il(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},u}(Je),Eu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Su=function(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ta=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function co(o,u){u===void 0&&(u=1);var f=0,m=0;return{members:o.map(function(x){var E=Eu[x.type].BYTES_PER_ELEMENT,T=f=ph(f,Math.max(u,E)),M=x.components||1;return m=Math.max(m,E),f+=E*M,{name:x.name,type:x.type,components:M,offset:T}}),size:ph(f,Math.max(m,u)),alignment:u}}function ph(o,u){return Math.ceil(o/u)*u}ta.serialize=function(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}},ta.deserialize=function(o){var u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},ta.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ta.prototype.clear=function(){this.length=0},ta.prototype.resize=function(o){this.reserve(o),this.length=o},ta.prototype.reserve=function(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},ta.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Dl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m){var x=this.length;return this.resize(x+1),this.emplace(x,f,m)},u.prototype.emplace=function(f,m,x){var E=2*f;return this.int16[E+0]=m,this.int16[E+1]=x,f},u}(ta);Dl.prototype.bytesPerElement=4,bn("StructArrayLayout2i4",Dl);var Df=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E){var T=this.length;return this.resize(T+1),this.emplace(T,f,m,x,E)},u.prototype.emplace=function(f,m,x,E,T){var M=4*f;return this.int16[M+0]=m,this.int16[M+1]=x,this.int16[M+2]=E,this.int16[M+3]=T,f},u}(ta);Df.prototype.bytesPerElement=8,bn("StructArrayLayout4i8",Df);var ll=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M){var L=this.length;return this.resize(L+1),this.emplace(L,f,m,x,E,T,M)},u.prototype.emplace=function(f,m,x,E,T,M,L){var j=6*f;return this.int16[j+0]=m,this.int16[j+1]=x,this.int16[j+2]=E,this.int16[j+3]=T,this.int16[j+4]=M,this.int16[j+5]=L,f},u}(ta);ll.prototype.bytesPerElement=12,bn("StructArrayLayout2i4i12",ll);var cs=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M){var L=this.length;return this.resize(L+1),this.emplace(L,f,m,x,E,T,M)},u.prototype.emplace=function(f,m,x,E,T,M,L){var j=4*f,$=8*f;return this.int16[j+0]=m,this.int16[j+1]=x,this.uint8[$+4]=E,this.uint8[$+5]=T,this.uint8[$+6]=M,this.uint8[$+7]=L,f},u}(ta);cs.prototype.bytesPerElement=8,bn("StructArrayLayout2i4ub8",cs);var Kl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m){var x=this.length;return this.resize(x+1),this.emplace(x,f,m)},u.prototype.emplace=function(f,m,x){var E=2*f;return this.float32[E+0]=m,this.float32[E+1]=x,f},u}(ta);Kl.prototype.bytesPerElement=8,bn("StructArrayLayout2f8",Kl);var Au=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M,L,j,$,q){var le=this.length;return this.resize(le+1),this.emplace(le,f,m,x,E,T,M,L,j,$,q)},u.prototype.emplace=function(f,m,x,E,T,M,L,j,$,q,le){var me=10*f;return this.uint16[me+0]=m,this.uint16[me+1]=x,this.uint16[me+2]=E,this.uint16[me+3]=T,this.uint16[me+4]=M,this.uint16[me+5]=L,this.uint16[me+6]=j,this.uint16[me+7]=$,this.uint16[me+8]=q,this.uint16[me+9]=le,f},u}(ta);Au.prototype.bytesPerElement=20,bn("StructArrayLayout10ui20",Au);var Lf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M,L,j,$,q,le,me){var ze=this.length;return this.resize(ze+1),this.emplace(ze,f,m,x,E,T,M,L,j,$,q,le,me)},u.prototype.emplace=function(f,m,x,E,T,M,L,j,$,q,le,me,ze){var He=12*f;return this.int16[He+0]=m,this.int16[He+1]=x,this.int16[He+2]=E,this.int16[He+3]=T,this.uint16[He+4]=M,this.uint16[He+5]=L,this.uint16[He+6]=j,this.uint16[He+7]=$,this.int16[He+8]=q,this.int16[He+9]=le,this.int16[He+10]=me,this.int16[He+11]=ze,f},u}(ta);Lf.prototype.bytesPerElement=24,bn("StructArrayLayout4i4ui4i24",Lf);var wc=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,f,m,x)},u.prototype.emplace=function(f,m,x,E){var T=3*f;return this.float32[T+0]=m,this.float32[T+1]=x,this.float32[T+2]=E,f},u}(ta);wc.prototype.bytesPerElement=12,bn("StructArrayLayout3f12",wc);var tf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var m=this.length;return this.resize(m+1),this.emplace(m,f)},u.prototype.emplace=function(f,m){return this.uint32[1*f+0]=m,f},u}(ta);tf.prototype.bytesPerElement=4,bn("StructArrayLayout1ul4",tf);var Bf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M,L,j,$){var q=this.length;return this.resize(q+1),this.emplace(q,f,m,x,E,T,M,L,j,$)},u.prototype.emplace=function(f,m,x,E,T,M,L,j,$,q){var le=10*f,me=5*f;return this.int16[le+0]=m,this.int16[le+1]=x,this.int16[le+2]=E,this.int16[le+3]=T,this.int16[le+4]=M,this.int16[le+5]=L,this.uint32[me+3]=j,this.uint16[le+8]=$,this.uint16[le+9]=q,f},u}(ta);Bf.prototype.bytesPerElement=20,bn("StructArrayLayout6i1ul2ui20",Bf);var Ql=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M){var L=this.length;return this.resize(L+1),this.emplace(L,f,m,x,E,T,M)},u.prototype.emplace=function(f,m,x,E,T,M,L){var j=6*f;return this.int16[j+0]=m,this.int16[j+1]=x,this.int16[j+2]=E,this.int16[j+3]=T,this.int16[j+4]=M,this.int16[j+5]=L,f},u}(ta);Ql.prototype.bytesPerElement=12,bn("StructArrayLayout2i2i2i12",Ql);var Jl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T){var M=this.length;return this.resize(M+1),this.emplace(M,f,m,x,E,T)},u.prototype.emplace=function(f,m,x,E,T,M){var L=4*f,j=8*f;return this.float32[L+0]=m,this.float32[L+1]=x,this.float32[L+2]=E,this.int16[j+6]=T,this.int16[j+7]=M,f},u}(ta);Jl.prototype.bytesPerElement=16,bn("StructArrayLayout2f1f2i16",Jl);var dh=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E){var T=this.length;return this.resize(T+1),this.emplace(T,f,m,x,E)},u.prototype.emplace=function(f,m,x,E,T){var M=12*f,L=3*f;return this.uint8[M+0]=m,this.uint8[M+1]=x,this.float32[L+1]=E,this.float32[L+2]=T,f},u}(ta);dh.prototype.bytesPerElement=12,bn("StructArrayLayout2ub2f12",dh);var Qo=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,f,m,x)},u.prototype.emplace=function(f,m,x,E){var T=3*f;return this.uint16[T+0]=m,this.uint16[T+1]=x,this.uint16[T+2]=E,f},u}(ta);Qo.prototype.bytesPerElement=6,bn("StructArrayLayout3ui6",Qo);var Tu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M,L,j,$,q,le,me,ze,He,st,et,bt){var Lt=this.length;return this.resize(Lt+1),this.emplace(Lt,f,m,x,E,T,M,L,j,$,q,le,me,ze,He,st,et,bt)},u.prototype.emplace=function(f,m,x,E,T,M,L,j,$,q,le,me,ze,He,st,et,bt,Lt){var qt=24*f,jt=12*f,mr=48*f;return this.int16[qt+0]=m,this.int16[qt+1]=x,this.uint16[qt+2]=E,this.uint16[qt+3]=T,this.uint32[jt+2]=M,this.uint32[jt+3]=L,this.uint32[jt+4]=j,this.uint16[qt+10]=$,this.uint16[qt+11]=q,this.uint16[qt+12]=le,this.float32[jt+7]=me,this.float32[jt+8]=ze,this.uint8[mr+36]=He,this.uint8[mr+37]=st,this.uint8[mr+38]=et,this.uint32[jt+10]=bt,this.int16[qt+22]=Lt,f},u}(ta);Tu.prototype.bytesPerElement=48,bn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Tu);var rf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M,L,j,$,q,le,me,ze,He,st,et,bt,Lt,qt,jt,mr,Vr,Jr,Fn,gn,Hn,_n,Ai){var qr=this.length;return this.resize(qr+1),this.emplace(qr,f,m,x,E,T,M,L,j,$,q,le,me,ze,He,st,et,bt,Lt,qt,jt,mr,Vr,Jr,Fn,gn,Hn,_n,Ai)},u.prototype.emplace=function(f,m,x,E,T,M,L,j,$,q,le,me,ze,He,st,et,bt,Lt,qt,jt,mr,Vr,Jr,Fn,gn,Hn,_n,Ai,qr){var Cr=34*f,Pi=17*f;return this.int16[Cr+0]=m,this.int16[Cr+1]=x,this.int16[Cr+2]=E,this.int16[Cr+3]=T,this.int16[Cr+4]=M,this.int16[Cr+5]=L,this.int16[Cr+6]=j,this.int16[Cr+7]=$,this.uint16[Cr+8]=q,this.uint16[Cr+9]=le,this.uint16[Cr+10]=me,this.uint16[Cr+11]=ze,this.uint16[Cr+12]=He,this.uint16[Cr+13]=st,this.uint16[Cr+14]=et,this.uint16[Cr+15]=bt,this.uint16[Cr+16]=Lt,this.uint16[Cr+17]=qt,this.uint16[Cr+18]=jt,this.uint16[Cr+19]=mr,this.uint16[Cr+20]=Vr,this.uint16[Cr+21]=Jr,this.uint16[Cr+22]=Fn,this.uint32[Pi+12]=gn,this.float32[Pi+13]=Hn,this.float32[Pi+14]=_n,this.float32[Pi+15]=Ai,this.float32[Pi+16]=qr,f},u}(ta);rf.prototype.bytesPerElement=68,bn("StructArrayLayout8i15ui1ul4f68",rf);var Ll=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var m=this.length;return this.resize(m+1),this.emplace(m,f)},u.prototype.emplace=function(f,m){return this.float32[1*f+0]=m,f},u}(ta);Ll.prototype.bytesPerElement=4,bn("StructArrayLayout1f4",Ll);var lu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,f,m,x)},u.prototype.emplace=function(f,m,x,E){var T=3*f;return this.int16[T+0]=m,this.int16[T+1]=x,this.int16[T+2]=E,f},u}(ta);lu.prototype.bytesPerElement=6,bn("StructArrayLayout3i6",lu);var vh=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,f,m,x)},u.prototype.emplace=function(f,m,x,E){var T=4*f;return this.uint32[2*f+0]=m,this.uint16[T+2]=x,this.uint16[T+3]=E,f},u}(ta);vh.prototype.bytesPerElement=8,bn("StructArrayLayout1ul2ui8",vh);var ju=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m){var x=this.length;return this.resize(x+1),this.emplace(x,f,m)},u.prototype.emplace=function(f,m,x){var E=2*f;return this.uint16[E+0]=m,this.uint16[E+1]=x,f},u}(ta);ju.prototype.bytesPerElement=4,bn("StructArrayLayout2ui4",ju);var Ff=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var m=this.length;return this.resize(m+1),this.emplace(m,f)},u.prototype.emplace=function(f,m){return this.uint16[1*f+0]=m,f},u}(ta);Ff.prototype.bytesPerElement=2,bn("StructArrayLayout1ui2",Ff);var mh=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E){var T=this.length;return this.resize(T+1),this.emplace(T,f,m,x,E)},u.prototype.emplace=function(f,m,x,E,T){var M=4*f;return this.float32[M+0]=m,this.float32[M+1]=x,this.float32[M+2]=E,this.float32[M+3]=T,f},u}(ta);mh.prototype.bytesPerElement=16,bn("StructArrayLayout4f16",mh);var h=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var f={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return f.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},f.x1.get=function(){return this._structArray.int16[this._pos2+2]},f.y1.get=function(){return this._structArray.int16[this._pos2+3]},f.x2.get=function(){return this._structArray.int16[this._pos2+4]},f.y2.get=function(){return this._structArray.int16[this._pos2+5]},f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.anchorPoint.get=function(){return new ae(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,f),u}(Su);h.prototype.size=20;var v=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(f){return new h(this,f)},u}(Bf);bn("CollisionBoxArray",v);var d=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},f.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},f.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},f.segment.get=function(){return this._structArray.uint16[this._pos2+10]},f.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},f.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},f.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},f.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},f.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},f.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},f.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},f.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},f.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},f.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},f.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,f),u}(Su);d.prototype.size=48;var g=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(f){return new d(this,f)},u}(Tu);bn("PlacedSymbolArray",g);var S=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},f.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},f.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},f.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},f.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},f.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},f.key.get=function(){return this._structArray.uint16[this._pos2+8]},f.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},f.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},f.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},f.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},f.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},f.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},f.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},f.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},f.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},f.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},f.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},f.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},f.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},f.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},f.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},f.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},f.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},f.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,f),u}(Su);S.prototype.size=68;var C=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(f){return new S(this,f)},u}(rf);bn("SymbolInstanceArray",C);var R=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getoffsetX=function(f){return this.float32[1*f+0]},u}(Ll);bn("GlyphOffsetArray",R);var O=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getx=function(f){return this.int16[3*f+0]},u.prototype.gety=function(f){return this.int16[3*f+1]},u.prototype.gettileUnitDistanceFromAnchor=function(f){return this.int16[3*f+2]},u}(lu);bn("SymbolLineVertexArray",O);var G=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var f={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,f),u}(Su);G.prototype.size=8;var J=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(f){return new G(this,f)},u}(vh);bn("FeatureIndexArray",J);var _e=co([{name:"a_pos",components:2,type:"Int16"}],4).members,be=function(o){o===void 0&&(o=[]),this.segments=o};function Te(o,u){return 256*(o=Ct(Math.floor(o),0,255))+Ct(Math.floor(u),0,255)}be.prototype.prepareSegment=function(o,u,f,m){var x=this.segments[this.segments.length-1];return o>be.MAX_VERTEX_ARRAY_LENGTH&&pt("Max vertices per segment is "+be.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+o),(!x||x.vertexLength+o>be.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==m)&&(x={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},m!==void 0&&(x.sortKey=m),this.segments.push(x)),x},be.prototype.get=function(){return this.segments},be.prototype.destroy=function(){for(var o=0,u=this.segments;o<u.length;o+=1){var f=u[o];for(var m in f.vaos)f.vaos[m].destroy()}},be.simpleSegment=function(o,u,f,m){return new be([{vertexOffset:o,primitiveOffset:u,vertexLength:f,primitiveLength:m,vaos:{},sortKey:0}])},be.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bn("SegmentVector",be);var We=co([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),je=de(function(o){o.exports=function(u,f){var m,x,E,T,M,L,j,$;for(x=u.length-(m=3&u.length),E=f,M=3432918353,L=461845907,$=0;$<x;)j=255&u.charCodeAt($)|(255&u.charCodeAt(++$))<<8|(255&u.charCodeAt(++$))<<16|(255&u.charCodeAt(++$))<<24,++$,E=27492+(65535&(T=5*(65535&(E=(E^=j=(65535&(j=(j=(65535&j)*M+(((j>>>16)*M&65535)<<16)&4294967295)<<15|j>>>17))*L+(((j>>>16)*L&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(j=0,m){case 3:j^=(255&u.charCodeAt($+2))<<16;case 2:j^=(255&u.charCodeAt($+1))<<8;case 1:E^=j=(65535&(j=(j=(65535&(j^=255&u.charCodeAt($)))*M+(((j>>>16)*M&65535)<<16)&4294967295)<<15|j>>>17))*L+(((j>>>16)*L&65535)<<16)&4294967295}return E^=u.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),at=de(function(o){o.exports=function(u,f){for(var m,x=u.length,E=f^x,T=0;x>=4;)m=1540483477*(65535&(m=255&u.charCodeAt(T)|(255&u.charCodeAt(++T))<<8|(255&u.charCodeAt(++T))<<16|(255&u.charCodeAt(++T))<<24))+((1540483477*(m>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),x-=4,++T;switch(x){case 3:E^=(255&u.charCodeAt(T+2))<<16;case 2:E^=(255&u.charCodeAt(T+1))<<8;case 1:E=1540483477*(65535&(E^=255&u.charCodeAt(T)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),Fe=je,nt=at;Fe.murmur3=je,Fe.murmur2=nt;var _t=function(){this.ids=[],this.positions=[],this.indexed=!1};_t.prototype.add=function(o,u,f,m){this.ids.push(nr(o)),this.positions.push(u,f,m)},_t.prototype.getPositions=function(o){for(var u=nr(o),f=0,m=this.ids.length-1;f<m;){var x=f+m>>1;this.ids[x]>=u?m=x:f=x+1}for(var E=[];this.ids[f]===u;)E.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return E},_t.serialize=function(o,u){var f=new Float64Array(o.ids),m=new Uint32Array(o.positions);return function x(E,T,M,L){for(;M<L;){for(var j=E[M+L>>1],$=M-1,q=L+1;;){do $++;while(E[$]<j);do q--;while(E[q]>j);if($>=q)break;$t(E,$,q),$t(T,3*$,3*q),$t(T,3*$+1,3*q+1),$t(T,3*$+2,3*q+2)}q-M<L-q?(x(E,T,M,q),M=q+1):(x(E,T,q+1,L),L=q)}}(f,m,0,f.length-1),u&&u.push(f.buffer,m.buffer),{ids:f,positions:m}},_t.deserialize=function(o){var u=new _t;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u};var Dt=Math.pow(2,53)-1;function nr(o){var u=+o;return!isNaN(u)&&u<=Dt?u:Fe(String(o))}function $t(o,u,f){var m=o[u];o[u]=o[f],o[f]=m}bn("FeaturePositionMap",_t);var cr=function(o,u){this.gl=o.gl,this.location=u},yr=function(o){function u(f,m){o.call(this,f,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))},u}(cr),Hr=function(o){function u(f,m){o.call(this,f,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))},u}(cr),Nr=function(o){function u(f,m){o.call(this,f,m),this.current=[0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))},u}(cr),dn=function(o){function u(f,m){o.call(this,f,m),this.current=[0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))},u}(cr),Nn=function(o){function u(f,m){o.call(this,f,m),this.current=[0,0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3]))},u}(cr),Bn=function(o){function u(f,m){o.call(this,f,m),this.current=Ei.transparent}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a))},u}(cr),zn=new Float32Array(16),Ni=function(o){function u(f,m){o.call(this,f,m),this.current=zn}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(var m=1;m<16;m++)if(f[m]!==this.current[m]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}},u}(cr);function yn(o){return[Te(255*o.r,255*o.g),Te(255*o.b,255*o.a)]}var ii=function(o,u,f){this.value=o,this.uniformNames=u.map(function(m){return"u_"+m}),this.type=f};ii.prototype.setUniform=function(o,u,f){o.set(f.constantOr(this.value))},ii.prototype.getBinding=function(o,u,f){return this.type==="color"?new Bn(o,u):new Hr(o,u)};var pi=function(o,u){this.uniformNames=u.map(function(f){return"u_"+f}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};pi.prototype.setConstantPatternPositions=function(o,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=o.tlbr},pi.prototype.setUniform=function(o,u,f,m){var x=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&o.set(x)},pi.prototype.getBinding=function(o,u,f){return f.substr(0,9)==="u_pattern"?new Nn(o,u):new Hr(o,u)};var ti=function(o,u,f,m){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(function(x){return{name:"a_"+x,type:"Float32",components:f==="color"?2:1,offset:0}}),this.paintVertexArray=new m};ti.prototype.populatePaintArray=function(o,u,f,m,x){var E=this.paintVertexArray.length,T=this.expression.evaluate(new we(0),u,{},m,[],x);this.paintVertexArray.resize(o),this._setPaintValue(E,o,T)},ti.prototype.updatePaintArray=function(o,u,f,m){var x=this.expression.evaluate({zoom:0},f,m);this._setPaintValue(o,u,x)},ti.prototype._setPaintValue=function(o,u,f){if(this.type==="color")for(var m=yn(f),x=o;x<u;x++)this.paintVertexArray.emplace(x,m[0],m[1]);else{for(var E=o;E<u;E++)this.paintVertexArray.emplace(E,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}},ti.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ti.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Jn=function(o,u,f,m,x,E){this.expression=o,this.uniformNames=u.map(function(T){return"u_"+T+"_t"}),this.type=f,this.useIntegerZoom=m,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=u.map(function(T){return{name:"a_"+T,type:"Float32",components:f==="color"?4:2,offset:0}}),this.paintVertexArray=new E};Jn.prototype.populatePaintArray=function(o,u,f,m,x){var E=this.expression.evaluate(new we(this.zoom),u,{},m,[],x),T=this.expression.evaluate(new we(this.zoom+1),u,{},m,[],x),M=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(M,o,E,T)},Jn.prototype.updatePaintArray=function(o,u,f,m){var x=this.expression.evaluate({zoom:this.zoom},f,m),E=this.expression.evaluate({zoom:this.zoom+1},f,m);this._setPaintValue(o,u,x,E)},Jn.prototype._setPaintValue=function(o,u,f,m){if(this.type==="color")for(var x=yn(f),E=yn(m),T=o;T<u;T++)this.paintVertexArray.emplace(T,x[0],x[1],E[0],E[1]);else{for(var M=o;M<u;M++)this.paintVertexArray.emplace(M,f,m);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(m))}},Jn.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Jn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Jn.prototype.setUniform=function(o,u){var f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,m=Ct(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);o.set(m)},Jn.prototype.getBinding=function(o,u,f){return new Hr(o,u)};var fi=function(o,u,f,m,x,E){this.expression=o,this.type=u,this.useIntegerZoom=f,this.zoom=m,this.layerId=E,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x};fi.prototype.populatePaintArray=function(o,u,f){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(m,o,u.patterns&&u.patterns[this.layerId],f)},fi.prototype.updatePaintArray=function(o,u,f,m,x){this._setPaintValues(o,u,f.patterns&&f.patterns[this.layerId],x)},fi.prototype._setPaintValues=function(o,u,f,m){if(m&&f){var x=m[f.min],E=m[f.mid],T=m[f.max];if(x&&E&&T)for(var M=o;M<u;M++)this.zoomInPaintVertexArray.emplace(M,E.tl[0],E.tl[1],E.br[0],E.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],E.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,E.tl[0],E.tl[1],E.br[0],E.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],E.pixelRatio,T.pixelRatio)}},fi.prototype.upload=function(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,We.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,We.members,this.expression.isStateDependent))},fi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ei=function(o,u,f){this.binders={},this._buffers=[];var m=[];for(var x in o.paint._values)if(f(x)){var E=o.paint.get(x);if(E instanceof Ao&&Il(E.property.specification)){var T=To(x,o.type),M=E.value,L=E.property.specification.type,j=E.property.useIntegerZoom,$=E.property.specification["property-type"],q=$==="cross-faded"||$==="cross-faded-data-driven";if(M.kind==="constant")this.binders[x]=q?new pi(M.value,T):new ii(M.value,T,L),m.push("/u_"+x);else if(M.kind==="source"||q){var le=$a(x,L,"source");this.binders[x]=q?new fi(M,L,j,u,le,o.id):new ti(M,T,L,le),m.push("/a_"+x)}else{var me=$a(x,L,"composite");this.binders[x]=new Jn(M,T,L,j,u,me),m.push("/z_"+x)}}}this.cacheKey=m.sort().join("")};ei.prototype.getMaxValue=function(o){var u=this.binders[o];return u instanceof ti||u instanceof Jn?u.maxValue:0},ei.prototype.populatePaintArrays=function(o,u,f,m,x){for(var E in this.binders){var T=this.binders[E];(T instanceof ti||T instanceof Jn||T instanceof fi)&&T.populatePaintArray(o,u,f,m,x)}},ei.prototype.setConstantPatternPositions=function(o,u){for(var f in this.binders){var m=this.binders[f];m instanceof pi&&m.setConstantPatternPositions(o,u)}},ei.prototype.updatePaintArrays=function(o,u,f,m,x){var E=!1;for(var T in o)for(var M=0,L=u.getPositions(T);M<L.length;M+=1){var j=L[M],$=f.feature(j.index);for(var q in this.binders){var le=this.binders[q];if((le instanceof ti||le instanceof Jn||le instanceof fi)&&le.expression.isStateDependent===!0){var me=m.paint.get(q);le.expression=me.value,le.updatePaintArray(j.start,j.end,$,o[T],x),E=!0}}}return E},ei.prototype.defines=function(){var o=[];for(var u in this.binders){var f=this.binders[u];(f instanceof ii||f instanceof pi)&&o.push.apply(o,f.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return o},ei.prototype.getBinderAttributes=function(){var o=[];for(var u in this.binders){var f=this.binders[u];if(f instanceof ti||f instanceof Jn)for(var m=0;m<f.paintVertexAttributes.length;m++)o.push(f.paintVertexAttributes[m].name);else if(f instanceof fi)for(var x=0;x<We.members.length;x++)o.push(We.members[x].name)}return o},ei.prototype.getBinderUniforms=function(){var o=[];for(var u in this.binders){var f=this.binders[u];if(f instanceof ii||f instanceof pi||f instanceof Jn)for(var m=0,x=f.uniformNames;m<x.length;m+=1)o.push(x[m])}return o},ei.prototype.getPaintVertexBuffers=function(){return this._buffers},ei.prototype.getUniforms=function(o,u){var f=[];for(var m in this.binders){var x=this.binders[m];if(x instanceof ii||x instanceof pi||x instanceof Jn)for(var E=0,T=x.uniformNames;E<T.length;E+=1){var M=T[E];if(u[M]){var L=x.getBinding(o,u[M],M);f.push({name:M,property:m,binding:L})}}}return f},ei.prototype.setUniforms=function(o,u,f,m){for(var x=0,E=u;x<E.length;x+=1){var T=E[x],M=T.name,L=T.property;this.binders[L].setUniform(T.binding,m,f.get(L),M)}},ei.prototype.updatePaintBuffers=function(o){for(var u in this._buffers=[],this.binders){var f=this.binders[u];if(o&&f instanceof fi){var m=o.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(f instanceof ti||f instanceof Jn)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}},ei.prototype.upload=function(o){for(var u in this.binders){var f=this.binders[u];(f instanceof ti||f instanceof Jn||f instanceof fi)&&f.upload(o)}this.updatePaintBuffers()},ei.prototype.destroy=function(){for(var o in this.binders){var u=this.binders[o];(u instanceof ti||u instanceof Jn||u instanceof fi)&&u.destroy()}};var $n=function(o,u,f){f===void 0&&(f=function(){return!0}),this.programConfigurations={};for(var m=0,x=o;m<x.length;m+=1){var E=x[m];this.programConfigurations[E.id]=new ei(E,u,f)}this.needsUpload=!1,this._featureMap=new _t,this._bufferOffset=0};function To(o,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(u+"-","").replace(/-/g,"_")]}function $a(o,u,f){var m={color:{source:Kl,composite:mh},number:{source:Ll,composite:Kl}},x=function(E){return{"line-pattern":{source:Au,composite:Au},"fill-pattern":{source:Au,composite:Au},"fill-extrusion-pattern":{source:Au,composite:Au}}[E]}(o);return x&&x[f]||m[u][f]}$n.prototype.populatePaintArrays=function(o,u,f,m,x,E){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(o,u,m,x,E);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0},$n.prototype.updatePaintArrays=function(o,u,f,m){for(var x=0,E=f;x<E.length;x+=1){var T=E[x];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(o,this._featureMap,u,T,m)||this.needsUpload}},$n.prototype.get=function(o){return this.programConfigurations[o]},$n.prototype.upload=function(o){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}},$n.prototype.destroy=function(){for(var o in this.programConfigurations)this.programConfigurations[o].destroy()},bn("ConstantBinder",ii),bn("CrossFadedConstantBinder",pi),bn("SourceExpressionBinder",ti),bn("CrossFadedCompositeBinder",fi),bn("CompositeExpressionBinder",Jn),bn("ProgramConfiguration",ei,{omit:["_buffers"]}),bn("ProgramConfigurationSet",$n);var wo=Math.pow(2,14)-1,fo=-wo-1;function Na(o){for(var u=8192/o.extent,f=o.loadGeometry(),m=0;m<f.length;m++)for(var x=f[m],E=0;E<x.length;E++){var T=x[E],M=Math.round(T.x*u),L=Math.round(T.y*u);T.x=Ct(M,fo,wo),T.y=Ct(L,fo,wo),(M<T.x||M>T.x+1||L<T.y||L>T.y+1)&&pt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return f}function Ya(o,u){return{type:o.type,id:o.id,properties:o.properties,geometry:u?Na(o):[]}}function fs(o,u,f,m,x){o.emplaceBack(2*u+(m+1)/2,2*f+(x+1)/2)}var hs=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Dl,this.indexArray=new Qo,this.segments=new be,this.programConfigurations=new $n(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function cl(o,u){for(var f=0;f<o.length;f++)if(fu(u,o[f]))return!0;for(var m=0;m<u.length;m++)if(fu(o,u[m]))return!0;return!!Cc(o,u)}function ps(o,u,f){return!!fu(o,u)||!!wu(u,o,f)}function cu(o,u){if(o.length===1)return fl(u,o[0]);for(var f=0;f<u.length;f++)for(var m=u[f],x=0;x<m.length;x++)if(fu(o,m[x]))return!0;for(var E=0;E<o.length;E++)if(fl(u,o[E]))return!0;for(var T=0;T<u.length;T++)if(Cc(o,u[T]))return!0;return!1}function Ls(o,u,f){if(o.length>1){if(Cc(o,u))return!0;for(var m=0;m<u.length;m++)if(wu(u[m],o,f))return!0}for(var x=0;x<o.length;x++)if(wu(o[x],u,f))return!0;return!1}function Cc(o,u){if(o.length===0||u.length===0)return!1;for(var f=0;f<o.length-1;f++)for(var m=o[f],x=o[f+1],E=0;E<u.length-1;E++)if(Hu(m,x,u[E],u[E+1]))return!0;return!1}function Hu(o,u,f,m){return ur(o,f,m)!==ur(u,f,m)&&ur(o,u,f)!==ur(o,u,m)}function wu(o,u,f){var m=f*f;if(u.length===1)return o.distSqr(u[0])<m;for(var x=1;x<u.length;x++)if(ec(o,u[x-1],u[x])<m)return!0;return!1}function ec(o,u,f){var m=u.distSqr(f);if(m===0)return o.distSqr(u);var x=((o.x-u.x)*(f.x-u.x)+(o.y-u.y)*(f.y-u.y))/m;return o.distSqr(x<0?u:x>1?f:f.sub(u)._mult(x)._add(u))}function fl(o,u){for(var f,m,x,E=!1,T=0;T<o.length;T++)for(var M=0,L=(f=o[T]).length-1;M<f.length;L=M++)(m=f[M]).y>u.y!=(x=f[L]).y>u.y&&u.x<(x.x-m.x)*(u.y-m.y)/(x.y-m.y)+m.x&&(E=!E);return E}function fu(o,u){for(var f=!1,m=0,x=o.length-1;m<o.length;x=m++){var E=o[m],T=o[x];E.y>u.y!=T.y>u.y&&u.x<(T.x-E.x)*(u.y-E.y)/(T.y-E.y)+E.x&&(f=!f)}return f}function hl(o,u,f){var m=f[0],x=f[2];if(o.x<m.x&&u.x<m.x||o.x>x.x&&u.x>x.x||o.y<m.y&&u.y<m.y||o.y>x.y&&u.y>x.y)return!1;var E=ur(o,u,f[0]);return E!==ur(o,u,f[1])||E!==ur(o,u,f[2])||E!==ur(o,u,f[3])}function Co(o,u,f){var m=u.paint.get(o).value;return m.kind==="constant"?m.value:f.programConfigurations.get(u.id).getMaxValue(o)}function ro(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Ss(o,u,f,m,x){if(!u[0]&&!u[1])return o;var E=ae.convert(u)._mult(x);f==="viewport"&&E._rotate(-m);for(var T=[],M=0;M<o.length;M++)T.push(o[M].sub(E));return T}hs.prototype.populate=function(o,u,f){var m=this.layers[0],x=[],E=null;m.type==="circle"&&(E=m.layout.get("circle-sort-key"));for(var T=0,M=o;T<M.length;T+=1){var L=M[T],j=L.feature,$=L.id,q=L.index,le=L.sourceLayerIndex,me=this.layers[0]._featureFilter.needGeometry,ze=Ya(j,me);if(this.layers[0]._featureFilter.filter(new we(this.zoom),ze,f)){var He=E?E.evaluate(ze,{},f):void 0,st={id:$,properties:j.properties,type:j.type,sourceLayerIndex:le,index:q,geometry:me?ze.geometry:Na(j),patterns:{},sortKey:He};x.push(st)}}E&&x.sort(function(Jr,Fn){return Jr.sortKey-Fn.sortKey});for(var et=0,bt=x;et<bt.length;et+=1){var Lt=bt[et],qt=Lt.geometry,jt=Lt.index,mr=Lt.sourceLayerIndex,Vr=o[jt].feature;this.addFeature(Lt,qt,jt,f),u.featureIndex.insert(Vr,qt,jt,mr,this.index)}},hs.prototype.update=function(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)},hs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},hs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},hs.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,_e),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},hs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},hs.prototype.addFeature=function(o,u,f,m){for(var x=0,E=u;x<E.length;x+=1)for(var T=0,M=E[x];T<M.length;T+=1){var L=M[T],j=L.x,$=L.y;if(!(j<0||j>=8192||$<0||$>=8192)){var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),le=q.vertexLength;fs(this.layoutVertexArray,j,$,-1,-1),fs(this.layoutVertexArray,j,$,1,-1),fs(this.layoutVertexArray,j,$,1,1),fs(this.layoutVertexArray,j,$,-1,1),this.indexArray.emplaceBack(le,le+1,le+2),this.indexArray.emplaceBack(le,le+3,le+2),q.vertexLength+=4,q.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},m)},bn("CircleBucket",hs,{omit:["layers"]});var hu=new Ma({"circle-sort-key":new An(he.layout_circle["circle-sort-key"])}),Cu={paint:new Ma({"circle-radius":new An(he.paint_circle["circle-radius"]),"circle-color":new An(he.paint_circle["circle-color"]),"circle-blur":new An(he.paint_circle["circle-blur"]),"circle-opacity":new An(he.paint_circle["circle-opacity"]),"circle-translate":new Ln(he.paint_circle["circle-translate"]),"circle-translate-anchor":new Ln(he.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ln(he.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ln(he.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new An(he.paint_circle["circle-stroke-width"]),"circle-stroke-color":new An(he.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new An(he.paint_circle["circle-stroke-opacity"])}),layout:hu},Li=typeof Float32Array!="undefined"?Float32Array:Array;function Go(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function no(o,u,f){var m=u[0],x=u[1],E=u[2],T=u[3],M=u[4],L=u[5],j=u[6],$=u[7],q=u[8],le=u[9],me=u[10],ze=u[11],He=u[12],st=u[13],et=u[14],bt=u[15],Lt=f[0],qt=f[1],jt=f[2],mr=f[3];return o[0]=Lt*m+qt*M+jt*q+mr*He,o[1]=Lt*x+qt*L+jt*le+mr*st,o[2]=Lt*E+qt*j+jt*me+mr*et,o[3]=Lt*T+qt*$+jt*ze+mr*bt,o[4]=(Lt=f[4])*m+(qt=f[5])*M+(jt=f[6])*q+(mr=f[7])*He,o[5]=Lt*x+qt*L+jt*le+mr*st,o[6]=Lt*E+qt*j+jt*me+mr*et,o[7]=Lt*T+qt*$+jt*ze+mr*bt,o[8]=(Lt=f[8])*m+(qt=f[9])*M+(jt=f[10])*q+(mr=f[11])*He,o[9]=Lt*x+qt*L+jt*le+mr*st,o[10]=Lt*E+qt*j+jt*me+mr*et,o[11]=Lt*T+qt*$+jt*ze+mr*bt,o[12]=(Lt=f[12])*m+(qt=f[13])*M+(jt=f[14])*q+(mr=f[15])*He,o[13]=Lt*x+qt*L+jt*le+mr*st,o[14]=Lt*E+qt*j+jt*me+mr*et,o[15]=Lt*T+qt*$+jt*ze+mr*bt,o}Math.hypot||(Math.hypot=function(){for(var o=arguments,u=0,f=arguments.length;f--;)u+=o[f]*o[f];return Math.sqrt(u)});var pu,Rc=no;function Wu(o,u,f){var m=u[0],x=u[1],E=u[2],T=u[3];return o[0]=f[0]*m+f[4]*x+f[8]*E+f[12]*T,o[1]=f[1]*m+f[5]*x+f[9]*E+f[13]*T,o[2]=f[2]*m+f[6]*x+f[10]*E+f[14]*T,o[3]=f[3]*m+f[7]*x+f[11]*E+f[15]*T,o}pu=new Li(3),Li!=Float32Array&&(pu[0]=0,pu[1]=0,pu[2]=0),function(){var o=new Li(4);Li!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0)}();var gh=(function(){var o=new Li(2);Li!=Float32Array&&(o[0]=0,o[1]=0)}(),function(o){function u(f){o.call(this,f,Cu)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(f){return new hs(f)},u.prototype.queryRadius=function(f){var m=f;return Co("circle-radius",this,m)+Co("circle-stroke-width",this,m)+ro(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(f,m,x,E,T,M,L,j){for(var $=Ss(f,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,L),q=this.paint.get("circle-radius").evaluate(m,x)+this.paint.get("circle-stroke-width").evaluate(m,x),le=this.paint.get("circle-pitch-alignment")==="map",me=le?$:function(Vr,Jr){return Vr.map(function(Fn){return Ro(Fn,Jr)})}($,j),ze=le?q*L:q,He=0,st=E;He<st.length;He+=1)for(var et=0,bt=st[He];et<bt.length;et+=1){var Lt=bt[et],qt=le?Lt:Ro(Lt,j),jt=ze,mr=Wu([],[Lt.x,Lt.y,0,1],j);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?jt*=mr[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(jt*=M.cameraToCenterDistance/mr[3]),ps(me,qt,jt))return!0}return!1},u}(Qs));function Ro(o,u){var f=Wu([],[o.x,o.y,0,1],u);return new ae(f[0]/f[3],f[1]/f[3])}var Dr=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(hs);function Bs(o,u,f,m){var x=u.width,E=u.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==x*E*f)throw new RangeError("mismatched image size")}else m=new Uint8Array(x*E*f);return o.width=x,o.height=E,o.data=m,o}function _h(o,u,f){var m=u.width,x=u.height;if(m!==o.width||x!==o.height){var E=Bs({},{width:m,height:x},f);Mo(o,E,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,m),height:Math.min(o.height,x)},f),o.width=m,o.height=x,o.data=E.data}}function Mo(o,u,f,m,x,E){if(x.width===0||x.height===0)return u;if(x.width>o.width||x.height>o.height||f.x>o.width-x.width||f.y>o.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>u.width||x.height>u.height||m.x>u.width-x.width||m.y>u.height-x.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=o.data,M=u.data,L=0;L<x.height;L++)for(var j=((f.y+L)*o.width+f.x)*E,$=((m.y+L)*u.width+m.x)*E,q=0;q<x.width*E;q++)M[$+q]=T[j+q];return u}bn("HeatmapBucket",Dr,{omit:["layers"]});var Js=function(o,u){Bs(this,o,1,u)};Js.prototype.resize=function(o){_h(this,o,1)},Js.prototype.clone=function(){return new Js({width:this.width,height:this.height},new Uint8Array(this.data))},Js.copy=function(o,u,f,m,x){Mo(o,u,f,m,x,1)};var Io=function(o,u){Bs(this,o,4,u)};Io.prototype.resize=function(o){_h(this,o,4)},Io.prototype.replace=function(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o},Io.prototype.clone=function(){return new Io({width:this.width,height:this.height},new Uint8Array(this.data))},Io.copy=function(o,u,f,m,x){Mo(o,u,f,m,x,4)},bn("AlphaImage",Js),bn("RGBAImage",Io);var tp={paint:new Ma({"heatmap-radius":new An(he.paint_heatmap["heatmap-radius"]),"heatmap-weight":new An(he.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ln(he.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bu(he.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ln(he.paint_heatmap["heatmap-opacity"])})};function tc(o){var u={},f=o.resolution||256,m=o.clips?o.clips.length:1,x=o.image||new Io({width:f,height:m}),E=function(ze,He,st){u[o.evaluationKey]=st;var et=o.expression.evaluate(u);x.data[ze+He+0]=Math.floor(255*et.r/et.a),x.data[ze+He+1]=Math.floor(255*et.g/et.a),x.data[ze+He+2]=Math.floor(255*et.b/et.a),x.data[ze+He+3]=Math.floor(255*et.a)};if(o.clips)for(var T=0,M=0;T<m;++T,M+=4*f)for(var L=0,j=0;L<f;L++,j+=4){var $=L/(f-1),q=o.clips[T];E(M,j,q.start*(1-$)+q.end*$)}else for(var le=0,me=0;le<f;le++,me+=4)E(0,me,le/(f-1));return x}var pl=function(o){function u(f){o.call(this,f,tp),this._updateColorRamp()}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(f){return new Dr(f)},u.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=tc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(Qs),Up={paint:new Ma({"hillshade-illumination-direction":new Ln(he.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ln(he.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ln(he.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ln(he.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ln(he.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ln(he.paint_hillshade["hillshade-accent-color"])})},l0=function(o){function u(f){o.call(this,f,Up)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(Qs),Zv=co([{name:"a_pos",components:2,type:"Int16"}],4).members,Nf=yh,rp=yh;function yh(o,u,f){f=f||2;var m,x,E,T,M,L,j,$=u&&u.length,q=$?u[0]*f:o.length,le=Od(o,0,q,f,!0),me=[];if(!le||le.next===le.prev)return me;if($&&(le=function(He,st,et,bt){var Lt,qt,jt,mr=[];for(Lt=0,qt=st.length;Lt<qt;Lt++)(jt=Od(He,st[Lt]*bt,Lt<qt-1?st[Lt+1]*bt:He.length,bt,!1))===jt.next&&(jt.steiner=!0),mr.push(np(jt));for(mr.sort(Dd),Lt=0;Lt<mr.length;Lt++)Ld(mr[Lt],et),et=Mc(et,et.next);return et}(o,u,le,f)),o.length>80*f){m=E=o[0],x=T=o[1];for(var ze=f;ze<q;ze+=f)(M=o[ze])<m&&(m=M),(L=o[ze+1])<x&&(x=L),M>E&&(E=M),L>T&&(T=L);j=(j=Math.max(E-m,T-x))!==0?1/j:0}return xh(le,me,f,m,x,j),me}function Od(o,u,f,m,x){var E,T;if(x===rc(o,u,f,m)>0)for(E=u;E<f;E+=m)T=Vf(E,o[E],o[E+1],T);else for(E=f-m;E>=u;E-=m)T=Vf(E,o[E],o[E+1],T);return T&&Uf(T,T.next)&&(Oc(T),T=T.next),T}function Mc(o,u){if(!o)return o;u||(u=o);var f,m=o;do if(f=!1,m.steiner||!Uf(m,m.next)&&qa(m.prev,m,m.next)!==0)m=m.next;else{if(Oc(m),(m=u=m.prev)===m.next)break;f=!0}while(f||m!==u);return u}function xh(o,u,f,m,x,E,T){if(o){!T&&E&&function($,q,le,me){var ze=$;do ze.z===null&&(ze.z=Bl(ze.x,ze.y,q,le,me)),ze.prevZ=ze.prev,ze.nextZ=ze.next,ze=ze.next;while(ze!==$);ze.prevZ.nextZ=null,ze.prevZ=null,function(He){var st,et,bt,Lt,qt,jt,mr,Vr,Jr=1;do{for(et=He,He=null,qt=null,jt=0;et;){for(jt++,bt=et,mr=0,st=0;st<Jr&&(mr++,bt=bt.nextZ);st++);for(Vr=Jr;mr>0||Vr>0&&bt;)mr!==0&&(Vr===0||!bt||et.z<=bt.z)?(Lt=et,et=et.nextZ,mr--):(Lt=bt,bt=bt.nextZ,Vr--),qt?qt.nextZ=Lt:He=Lt,Lt.prevZ=qt,qt=Lt;et=bt}qt.nextZ=null,Jr*=2}while(jt>1)}(ze)}(o,m,x,E);for(var M,L,j=o;o.prev!==o.next;)if(M=o.prev,L=o.next,E?kd(o,m,x,E):Vv(o))u.push(M.i/f),u.push(o.i/f),u.push(L.i/f),Oc(o),o=L.next,j=L.next;else if((o=L)===j){T?T===1?xh(o=c0(Mc(o),u,f),u,f,m,x,E,2):T===2&&zp(o,u,f,m,x,E):xh(Mc(o),u,f,m,x,E,1);break}}}function Vv(o){var u=o.prev,f=o,m=o.next;if(qa(u,f,m)>=0)return!1;for(var x=o.next.next;x!==o.prev;){if(Ic(u.x,u.y,f.x,f.y,m.x,m.y,x.x,x.y)&&qa(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function kd(o,u,f,m){var x=o.prev,E=o,T=o.next;if(qa(x,E,T)>=0)return!1;for(var M=x.x>E.x?x.x>T.x?x.x:T.x:E.x>T.x?E.x:T.x,L=x.y>E.y?x.y>T.y?x.y:T.y:E.y>T.y?E.y:T.y,j=Bl(x.x<E.x?x.x<T.x?x.x:T.x:E.x<T.x?E.x:T.x,x.y<E.y?x.y<T.y?x.y:T.y:E.y<T.y?E.y:T.y,u,f,m),$=Bl(M,L,u,f,m),q=o.prevZ,le=o.nextZ;q&&q.z>=j&&le&&le.z<=$;){if(q!==o.prev&&q!==o.next&&Ic(x.x,x.y,E.x,E.y,T.x,T.y,q.x,q.y)&&qa(q.prev,q,q.next)>=0||(q=q.prevZ,le!==o.prev&&le!==o.next&&Ic(x.x,x.y,E.x,E.y,T.x,T.y,le.x,le.y)&&qa(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;q&&q.z>=j;){if(q!==o.prev&&q!==o.next&&Ic(x.x,x.y,E.x,E.y,T.x,T.y,q.x,q.y)&&qa(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;le&&le.z<=$;){if(le!==o.prev&&le!==o.next&&Ic(x.x,x.y,E.x,E.y,T.x,T.y,le.x,le.y)&&qa(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function c0(o,u,f){var m=o;do{var x=m.prev,E=m.next.next;!Uf(x,E)&&zf(x,m,m.next,E)&&Pc(x,E)&&Pc(E,x)&&(u.push(x.i/f),u.push(m.i/f),u.push(E.i/f),Oc(m),Oc(m.next),m=o=E),m=m.next}while(m!==o);return Mc(m)}function zp(o,u,f,m,x,E){var T=o;do{for(var M=T.next.next;M!==T.prev;){if(T.i!==M.i&&Vp(T,M)){var L=Zf(T,M);return T=Mc(T,T.next),L=Mc(L,L.next),xh(T,u,f,m,x,E),void xh(L,u,f,m,x,E)}M=M.next}T=T.next}while(T!==o)}function Dd(o,u){return o.x-u.x}function Ld(o,u){if(u=function(m,x){var E,T=x,M=m.x,L=m.y,j=-1/0;do{if(L<=T.y&&L>=T.next.y&&T.next.y!==T.y){var $=T.x+(L-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if($<=M&&$>j){if(j=$,$===M){if(L===T.y)return T;if(L===T.next.y)return T.next}E=T.x<T.next.x?T:T.next}}T=T.next}while(T!==x);if(!E)return null;if(M===j)return E;var q,le=E,me=E.x,ze=E.y,He=1/0;T=E;do M>=T.x&&T.x>=me&&M!==T.x&&Ic(L<ze?M:j,L,me,ze,L<ze?j:M,L,T.x,T.y)&&(q=Math.abs(L-T.y)/(M-T.x),Pc(T,m)&&(q<He||q===He&&(T.x>E.x||T.x===E.x&&Zp(E,T)))&&(E=T,He=q)),T=T.next;while(T!==le);return E}(o,u)){var f=Zf(u,o);Mc(u,u.next),Mc(f,f.next)}}function Zp(o,u){return qa(o.prev,o,u.prev)<0&&qa(u.next,o,o.next)<0}function Bl(o,u,f,m,x){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-f)*x)|o<<8))|o<<4))|o<<2))|o<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-m)*x)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function np(o){var u=o,f=o;do(u.x<f.x||u.x===f.x&&u.y<f.y)&&(f=u),u=u.next;while(u!==o);return f}function Ic(o,u,f,m,x,E,T,M){return(x-T)*(u-M)-(o-T)*(E-M)>=0&&(o-T)*(m-M)-(f-T)*(u-M)>=0&&(f-T)*(E-M)-(x-T)*(m-M)>=0}function Vp(o,u){return o.next.i!==u.i&&o.prev.i!==u.i&&!function(f,m){var x=f;do{if(x.i!==f.i&&x.next.i!==f.i&&x.i!==m.i&&x.next.i!==m.i&&zf(x,x.next,f,m))return!0;x=x.next}while(x!==f);return!1}(o,u)&&(Pc(o,u)&&Pc(u,o)&&function(f,m){var x=f,E=!1,T=(f.x+m.x)/2,M=(f.y+m.y)/2;do x.y>M!=x.next.y>M&&x.next.y!==x.y&&T<(x.next.x-x.x)*(M-x.y)/(x.next.y-x.y)+x.x&&(E=!E),x=x.next;while(x!==f);return E}(o,u)&&(qa(o.prev,o,u.prev)||qa(o,u.prev,u))||Uf(o,u)&&qa(o.prev,o,o.next)>0&&qa(u.prev,u,u.next)>0)}function qa(o,u,f){return(u.y-o.y)*(f.x-u.x)-(u.x-o.x)*(f.y-u.y)}function Uf(o,u){return o.x===u.x&&o.y===u.y}function zf(o,u,f,m){var x=nf(qa(o,u,f)),E=nf(qa(o,u,m)),T=nf(qa(f,m,o)),M=nf(qa(f,m,u));return x!==E&&T!==M||!(x!==0||!dl(o,f,u))||!(E!==0||!dl(o,m,u))||!(T!==0||!dl(f,o,m))||!(M!==0||!dl(f,u,m))}function dl(o,u,f){return u.x<=Math.max(o.x,f.x)&&u.x>=Math.min(o.x,f.x)&&u.y<=Math.max(o.y,f.y)&&u.y>=Math.min(o.y,f.y)}function nf(o){return o>0?1:o<0?-1:0}function Pc(o,u){return qa(o.prev,o,o.next)<0?qa(o,u,o.next)>=0&&qa(o,o.prev,u)>=0:qa(o,u,o.prev)<0||qa(o,o.next,u)<0}function Zf(o,u){var f=new kc(o.i,o.x,o.y),m=new kc(u.i,u.x,u.y),x=o.next,E=u.prev;return o.next=u,u.prev=o,f.next=x,x.prev=f,m.next=f,f.prev=m,E.next=m,m.prev=E,m}function Vf(o,u,f,m){var x=new kc(o,u,f);return m?(x.next=m.next,x.prev=m,m.next.prev=x,m.next=x):(x.prev=x,x.next=x),x}function Oc(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function kc(o,u,f){this.i=o,this.x=u,this.y=f,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function rc(o,u,f,m){for(var x=0,E=u,T=f-m;E<f;E+=m)x+=(o[T]-o[E])*(o[E+1]+o[T+1]),T=E;return x}function jp(o,u,f,m,x){(function E(T,M,L,j,$){for(;j>L;){if(j-L>600){var q=j-L+1,le=M-L+1,me=Math.log(q),ze=.5*Math.exp(2*me/3),He=.5*Math.sqrt(me*ze*(q-ze)/q)*(le-q/2<0?-1:1);E(T,M,Math.max(L,Math.floor(M-le*ze/q+He)),Math.min(j,Math.floor(M+(q-le)*ze/q+He)),$)}var st=T[M],et=L,bt=j;for(nc(T,L,M),$(T[j],st)>0&&nc(T,L,j);et<bt;){for(nc(T,et,bt),et++,bt--;$(T[et],st)<0;)et++;for(;$(T[bt],st)>0;)bt--}$(T[L],st)===0?nc(T,L,bt):nc(T,++bt,j),bt<=M&&(L=bt+1),M<=bt&&(j=bt-1)}})(o,u,f||0,m||o.length-1,x||Fs)}function nc(o,u,f){var m=o[u];o[u]=o[f],o[f]=m}function Fs(o,u){return o<u?-1:o>u?1:0}function ip(o,u){var f=o.length;if(f<=1)return[o];for(var m,x,E=[],T=0;T<f;T++){var M=Ar(o[T]);M!==0&&(o[T].area=Math.abs(M),x===void 0&&(x=M<0),x===M<0?(m&&E.push(m),m=[o[T]]):m.push(o[T]))}if(m&&E.push(m),u>1)for(var L=0;L<E.length;L++)E[L].length<=u||(jp(E[L],u,1,E[L].length-1,Hp),E[L]=E[L].slice(0,u));return E}function Hp(o,u){return u.area-o.area}function Wp(o,u,f){for(var m=f.patternDependencies,x=!1,E=0,T=u;E<T.length;E+=1){var M=T[E].paint.get(o+"-pattern");M.isConstant()||(x=!0);var L=M.constantOr(null);L&&(x=!0,m[L.to]=!0,m[L.from]=!0)}return x}function bh(o,u,f,m,x){for(var E=x.patternDependencies,T=0,M=u;T<M.length;T+=1){var L=M[T],j=L.paint.get(o+"-pattern").value;if(j.kind!=="constant"){var $=j.evaluate({zoom:m-1},f,{},x.availableImages),q=j.evaluate({zoom:m},f,{},x.availableImages),le=j.evaluate({zoom:m+1},f,{},x.availableImages);q=q&&q.name?q.name:q,le=le&&le.name?le.name:le,E[$=$&&$.name?$.name:$]=!0,E[q]=!0,E[le]=!0,f.patterns[L.id]={min:$,mid:q,max:le}}}return f}yh.deviation=function(o,u,f,m){var x=u&&u.length,E=Math.abs(rc(o,0,x?u[0]*f:o.length,f));if(x)for(var T=0,M=u.length;T<M;T++)E-=Math.abs(rc(o,u[T]*f,T<M-1?u[T+1]*f:o.length,f));var L=0;for(T=0;T<m.length;T+=3){var j=m[T]*f,$=m[T+1]*f,q=m[T+2]*f;L+=Math.abs((o[j]-o[q])*(o[$+1]-o[j+1])-(o[j]-o[$])*(o[q+1]-o[j+1]))}return E===0&&L===0?0:Math.abs((L-E)/E)},yh.flatten=function(o){for(var u=o[0][0].length,f={vertices:[],holes:[],dimensions:u},m=0,x=0;x<o.length;x++){for(var E=0;E<o[x].length;E++)for(var T=0;T<u;T++)f.vertices.push(o[x][E][T]);x>0&&f.holes.push(m+=o[x-1].length)}return f},Nf.default=rp;var vl=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Dl,this.indexArray=new Qo,this.indexArray2=new ju,this.programConfigurations=new $n(o.layers,o.zoom),this.segments=new be,this.segments2=new be,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};vl.prototype.populate=function(o,u,f){this.hasPattern=Wp("fill",this.layers,u);for(var m=this.layers[0].layout.get("fill-sort-key"),x=[],E=0,T=o;E<T.length;E+=1){var M=T[E],L=M.feature,j=M.id,$=M.index,q=M.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,me=Ya(L,le);if(this.layers[0]._featureFilter.filter(new we(this.zoom),me,f)){var ze=m?m.evaluate(me,{},f,u.availableImages):void 0,He={id:j,properties:L.properties,type:L.type,sourceLayerIndex:q,index:$,geometry:le?me.geometry:Na(L),patterns:{},sortKey:ze};x.push(He)}}m&&x.sort(function(Vr,Jr){return Vr.sortKey-Jr.sortKey});for(var st=0,et=x;st<et.length;st+=1){var bt=et[st],Lt=bt.geometry,qt=bt.index,jt=bt.sourceLayerIndex;if(this.hasPattern){var mr=bh("fill",this.layers,bt,this.zoom,u);this.patternFeatures.push(mr)}else this.addFeature(bt,Lt,qt,f,{});u.featureIndex.insert(o[qt].feature,Lt,qt,jt,this.index)}},vl.prototype.update=function(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)},vl.prototype.addFeatures=function(o,u,f){for(var m=0,x=this.patternFeatures;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,f)}},vl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},vl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},vl.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Zv),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0},vl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},vl.prototype.addFeature=function(o,u,f,m,x){for(var E=0,T=ip(u,500);E<T.length;E+=1){for(var M=T[E],L=0,j=0,$=M;j<$.length;j+=1)L+=$[j].length;for(var q=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),le=q.vertexLength,me=[],ze=[],He=0,st=M;He<st.length;He+=1){var et=st[He];if(et.length!==0){et!==M[0]&&ze.push(me.length/2);var bt=this.segments2.prepareSegment(et.length,this.layoutVertexArray,this.indexArray2),Lt=bt.vertexLength;this.layoutVertexArray.emplaceBack(et[0].x,et[0].y),this.indexArray2.emplaceBack(Lt+et.length-1,Lt),me.push(et[0].x),me.push(et[0].y);for(var qt=1;qt<et.length;qt++)this.layoutVertexArray.emplaceBack(et[qt].x,et[qt].y),this.indexArray2.emplaceBack(Lt+qt-1,Lt+qt),me.push(et[qt].x),me.push(et[qt].y);bt.vertexLength+=et.length,bt.primitiveLength+=et.length}}for(var jt=Nf(me,ze),mr=0;mr<jt.length;mr+=3)this.indexArray.emplaceBack(le+jt[mr],le+jt[mr+1],le+jt[mr+2]);q.vertexLength+=L,q.primitiveLength+=jt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,m)},bn("FillBucket",vl,{omit:["layers","patternFeatures"]});var Gu=new Ma({"fill-sort-key":new An(he.layout_fill["fill-sort-key"])}),Bd={paint:new Ma({"fill-antialias":new Ln(he.paint_fill["fill-antialias"]),"fill-opacity":new An(he.paint_fill["fill-opacity"]),"fill-color":new An(he.paint_fill["fill-color"]),"fill-outline-color":new An(he.paint_fill["fill-outline-color"]),"fill-translate":new Ln(he.paint_fill["fill-translate"]),"fill-translate-anchor":new Ln(he.paint_fill["fill-translate-anchor"]),"fill-pattern":new qo(he.paint_fill["fill-pattern"])}),layout:Gu},ap=function(o){function u(f){o.call(this,f,Bd)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(f,m){o.prototype.recalculate.call(this,f,m);var x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(f){return new vl(f)},u.prototype.queryRadius=function(){return ro(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(f,m,x,E,T,M,L){return cu(Ss(f,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,L),E)},u.prototype.isTileClipped=function(){return!0},u}(Qs),Fd=co([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Eh=Dc;function Dc(o,u,f,m,x){this.properties={},this.extent=f,this.type=0,this._pbf=o,this._geometry=-1,this._keys=m,this._values=x,o.readFields(Gp,this,u)}function Gp(o,u,f){o==1?u.id=f.readVarint():o==2?function(m,x){for(var E=m.readVarint()+m.pos;m.pos<E;){var T=x._keys[m.readVarint()],M=x._values[m.readVarint()];x.properties[T]=M}}(f,u):o==3?u.type=f.readVarint():o==4&&(u._geometry=f.pos)}function Xu(o){for(var u,f,m=0,x=0,E=o.length,T=E-1;x<E;T=x++)m+=((f=o[T]).x-(u=o[x]).x)*(u.y+f.y);return m}Dc.types=["Unknown","Point","LineString","Polygon"],Dc.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var u,f=o.readVarint()+o.pos,m=1,x=0,E=0,T=0,M=[];o.pos<f;){if(x<=0){var L=o.readVarint();m=7&L,x=L>>3}if(x--,m===1||m===2)E+=o.readSVarint(),T+=o.readSVarint(),m===1&&(u&&M.push(u),u=[]),u.push(new ae(E,T));else{if(m!==7)throw new Error("unknown command "+m);u&&u.push(u[0].clone())}}return u&&M.push(u),M},Dc.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var u=o.readVarint()+o.pos,f=1,m=0,x=0,E=0,T=1/0,M=-1/0,L=1/0,j=-1/0;o.pos<u;){if(m<=0){var $=o.readVarint();f=7&$,m=$>>3}if(m--,f===1||f===2)(x+=o.readSVarint())<T&&(T=x),x>M&&(M=x),(E+=o.readSVarint())<L&&(L=E),E>j&&(j=E);else if(f!==7)throw new Error("unknown command "+f)}return[T,L,M,j]},Dc.prototype.toGeoJSON=function(o,u,f){var m,x,E=this.extent*Math.pow(2,f),T=this.extent*o,M=this.extent*u,L=this.loadGeometry(),j=Dc.types[this.type];function $(me){for(var ze=0;ze<me.length;ze++){var He=me[ze];me[ze]=[360*(He.x+T)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(He.y+M)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(m=0;m<L.length;m++)q[m]=L[m][0];$(L=q);break;case 2:for(m=0;m<L.length;m++)$(L[m]);break;case 3:for(L=function(me){var ze=me.length;if(ze<=1)return[me];for(var He,st,et=[],bt=0;bt<ze;bt++){var Lt=Xu(me[bt]);Lt!==0&&(st===void 0&&(st=Lt<0),st===Lt<0?(He&&et.push(He),He=[me[bt]]):He.push(me[bt]))}return He&&et.push(He),et}(L),m=0;m<L.length;m++)for(x=0;x<L[m].length;x++)$(L[m][x])}L.length===1?L=L[0]:j="Multi"+j;var le={type:"Feature",geometry:{type:j,coordinates:L},properties:this.properties};return"id"in this&&(le.id=this.id),le};var op=Lc;function Lc(o,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Ns,this,u),this.length=this._features.length}function Ns(o,u,f){o===15?u.version=f.readVarint():o===1?u.name=f.readString():o===5?u.extent=f.readVarint():o===2?u._features.push(f.pos):o===3?u._keys.push(f.readString()):o===4&&u._values.push(function(m){for(var x=null,E=m.readVarint()+m.pos;m.pos<E;){var T=m.readVarint()>>3;x=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return x}(f))}function Nd(o,u,f){if(o===3){var m=new op(f,f.readVarint()+f.pos);m.length&&(u[m.name]=m)}}Lc.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var u=this._pbf.readVarint()+this._pbf.pos;return new Eh(this._pbf,u,this.extent,this._keys,this._values)};var ic={VectorTile:function(o,u){this.layers=o.readFields(Nd,{},u)},VectorTileFeature:Eh,VectorTileLayer:op},Sh=ic.VectorTileFeature.types,jf=Math.pow(2,13);function Jo(o,u,f,m,x,E,T,M){o.emplaceBack(u,f,2*Math.floor(m*jf)+T,x*jf*2,E*jf*2,Math.round(M))}var ds=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new ll,this.indexArray=new Qo,this.programConfigurations=new $n(o.layers,o.zoom),this.segments=new be,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Po(o,u){return o.x===u.x&&(o.x<0||o.x>8192)||o.y===u.y&&(o.y<0||o.y>8192)}ds.prototype.populate=function(o,u,f){this.features=[],this.hasPattern=Wp("fill-extrusion",this.layers,u);for(var m=0,x=o;m<x.length;m+=1){var E=x[m],T=E.feature,M=E.id,L=E.index,j=E.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,q=Ya(T,$);if(this.layers[0]._featureFilter.filter(new we(this.zoom),q,f)){var le={id:M,sourceLayerIndex:j,index:L,geometry:$?q.geometry:Na(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(bh("fill-extrusion",this.layers,le,this.zoom,u)):this.addFeature(le,le.geometry,L,f,{}),u.featureIndex.insert(T,le.geometry,L,j,this.index,!0)}}},ds.prototype.addFeatures=function(o,u,f){for(var m=0,x=this.features;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,f)}},ds.prototype.update=function(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)},ds.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ds.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ds.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Fd),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},ds.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ds.prototype.addFeature=function(o,u,f,m,x){for(var E=0,T=ip(u,500);E<T.length;E+=1){for(var M=T[E],L=0,j=0,$=M;j<$.length;j+=1)L+=$[j].length;for(var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),le=0,me=M;le<me.length;le+=1){var ze=me[le];if(ze.length!==0&&!((Pi=ze).every(function(yi){return yi.x<0})||Pi.every(function(yi){return yi.x>8192})||Pi.every(function(yi){return yi.y<0})||Pi.every(function(yi){return yi.y>8192})))for(var He=0,st=0;st<ze.length;st++){var et=ze[st];if(st>=1){var bt=ze[st-1];if(!Po(et,bt)){q.vertexLength+4>be.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Lt=et.sub(bt)._perp()._unit(),qt=bt.dist(et);He+qt>32768&&(He=0),Jo(this.layoutVertexArray,et.x,et.y,Lt.x,Lt.y,0,0,He),Jo(this.layoutVertexArray,et.x,et.y,Lt.x,Lt.y,0,1,He),Jo(this.layoutVertexArray,bt.x,bt.y,Lt.x,Lt.y,0,0,He+=qt),Jo(this.layoutVertexArray,bt.x,bt.y,Lt.x,Lt.y,0,1,He);var jt=q.vertexLength;this.indexArray.emplaceBack(jt,jt+2,jt+1),this.indexArray.emplaceBack(jt+1,jt+2,jt+3),q.vertexLength+=4,q.primitiveLength+=2}}}}if(q.vertexLength+L>be.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),Sh[o.type]==="Polygon"){for(var mr=[],Vr=[],Jr=q.vertexLength,Fn=0,gn=M;Fn<gn.length;Fn+=1){var Hn=gn[Fn];if(Hn.length!==0){Hn!==M[0]&&Vr.push(mr.length/2);for(var _n=0;_n<Hn.length;_n++){var Ai=Hn[_n];Jo(this.layoutVertexArray,Ai.x,Ai.y,0,0,1,1,0),mr.push(Ai.x),mr.push(Ai.y)}}}for(var qr=Nf(mr,Vr),Cr=0;Cr<qr.length;Cr+=3)this.indexArray.emplaceBack(Jr+qr[Cr],Jr+qr[Cr+2],Jr+qr[Cr+1]);q.primitiveLength+=qr.length/3,q.vertexLength+=L}}var Pi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,m)},bn("FillExtrusionBucket",ds,{omit:["layers","features"]});var du={paint:new Ma({"fill-extrusion-opacity":new Ln(he["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new An(he["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ln(he["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ln(he["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new qo(he["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new An(he["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new An(he["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ln(he["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Xp=function(o){function u(f){o.call(this,f,du)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(f){return new ds(f)},u.prototype.queryRadius=function(){return ro(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(f,m,x,E,T,M,L,j){var $=Ss(f,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,L),q=this.paint.get("fill-extrusion-height").evaluate(m,x),le=this.paint.get("fill-extrusion-base").evaluate(m,x),me=function(He,st,et,bt){for(var Lt=[],qt=0,jt=He;qt<jt.length;qt+=1){var mr=jt[qt],Vr=[mr.x,mr.y,0,1];Wu(Vr,Vr,st),Lt.push(new ae(Vr[0]/Vr[3],Vr[1]/Vr[3]))}return Lt}($,j),ze=function(He,st,et,bt){for(var Lt=[],qt=[],jt=bt[8]*st,mr=bt[9]*st,Vr=bt[10]*st,Jr=bt[11]*st,Fn=bt[8]*et,gn=bt[9]*et,Hn=bt[10]*et,_n=bt[11]*et,Ai=0,qr=He;Ai<qr.length;Ai+=1){for(var Cr=[],Pi=[],yi=0,Gi=qr[Ai];yi<Gi.length;yi+=1){var Xn=Gi[yi],ra=Xn.x,Ka=Xn.y,_o=bt[0]*ra+bt[4]*Ka+bt[12],uo=bt[1]*ra+bt[5]*Ka+bt[13],Qa=bt[2]*ra+bt[6]*Ka+bt[14],yo=bt[3]*ra+bt[7]*Ka+bt[15],rs=Qa+Vr,ns=yo+Jr,tu=_o+Fn,ms=uo+gn,Us=Qa+Hn,Do=yo+_n,gs=new ae((_o+jt)/ns,(uo+mr)/ns);gs.z=rs/ns,Cr.push(gs);var Ui=new ae(tu/Do,ms/Do);Ui.z=Us/Do,Pi.push(Ui)}Lt.push(Cr),qt.push(Pi)}return[Lt,qt]}(E,le,q,j);return function(He,st,et){var bt=1/0;cu(et,st)&&(bt=$p(et,st[0]));for(var Lt=0;Lt<st.length;Lt++)for(var qt=st[Lt],jt=He[Lt],mr=0;mr<qt.length-1;mr++){var Vr=qt[mr],Jr=[Vr,qt[mr+1],jt[mr+1],jt[mr],Vr];cl(et,Jr)&&(bt=Math.min(bt,$p(et,Jr)))}return bt!==1/0&&bt}(ze[0],ze[1],me)},u}(Qs);function af(o,u){return o.x*u.x+o.y*u.y}function $p(o,u){if(o.length===1){for(var f,m=0,x=u[m++];!f||x.equals(f);)if(!(f=u[m++]))return 1/0;for(;m<u.length;m++){var E=u[m],T=o[0],M=f.sub(x),L=E.sub(x),j=T.sub(x),$=af(M,M),q=af(M,L),le=af(L,L),me=af(j,M),ze=af(j,L),He=$*le-q*q,st=(le*me-q*ze)/He,et=($*ze-q*me)/He,bt=x.z*(1-st-et)+f.z*st+E.z*et;if(isFinite(bt))return bt}return 1/0}for(var Lt=1/0,qt=0,jt=u;qt<jt.length;qt+=1)Lt=Math.min(Lt,jt[qt].z);return Lt}var Ud=co([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,jv=co([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,zd=ic.VectorTileFeature.types,Yp=Math.cos(Math.PI/180*37.5),Zd=Math.pow(2,14)/.5,As=function(o){var u=this;this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(f){return f.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(f){u.gradients[f.id]={}}),this.layoutVertexArray=new cs,this.layoutVertexArray2=new Kl,this.indexArray=new Qo,this.programConfigurations=new $n(o.layers,o.zoom),this.segments=new be,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(f){return f.isStateDependent()}).map(function(f){return f.id})};As.prototype.populate=function(o,u,f){this.hasPattern=Wp("line",this.layers,u);for(var m=this.layers[0].layout.get("line-sort-key"),x=[],E=0,T=o;E<T.length;E+=1){var M=T[E],L=M.feature,j=M.id,$=M.index,q=M.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,me=Ya(L,le);if(this.layers[0]._featureFilter.filter(new we(this.zoom),me,f)){var ze=m?m.evaluate(me,{},f):void 0,He={id:j,properties:L.properties,type:L.type,sourceLayerIndex:q,index:$,geometry:le?me.geometry:Na(L),patterns:{},sortKey:ze};x.push(He)}}m&&x.sort(function(Vr,Jr){return Vr.sortKey-Jr.sortKey});for(var st=0,et=x;st<et.length;st+=1){var bt=et[st],Lt=bt.geometry,qt=bt.index,jt=bt.sourceLayerIndex;if(this.hasPattern){var mr=bh("line",this.layers,bt,this.zoom,u);this.patternFeatures.push(mr)}else this.addFeature(bt,Lt,qt,f,{});u.featureIndex.insert(o[qt].feature,Lt,qt,jt,this.index)}},As.prototype.update=function(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)},As.prototype.addFeatures=function(o,u,f){for(var m=0,x=this.patternFeatures;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,f)}},As.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},As.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},As.prototype.upload=function(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,jv)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Ud),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},As.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},As.prototype.lineFeatureClips=function(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}},As.prototype.addFeature=function(o,u,f,m,x){var E=this.layers[0].layout,T=E.get("line-join").evaluate(o,{}),M=E.get("line-cap"),L=E.get("line-miter-limit"),j=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(var $=0,q=u;$<q.length;$+=1)this.addLine(q[$],o,T,M,L,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,m)},As.prototype.addLine=function(o,u,f,m,x,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<o.length-1;T++)this.totalDistance+=o[T].dist(o[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=zd[u.type]==="Polygon",L=o.length;L>=2&&o[L-1].equals(o[L-2]);)L--;for(var j=0;j<L-1&&o[j].equals(o[j+1]);)j++;if(!(L<(M?3:2))){f==="bevel"&&(x=1.05);var $,q=this.overscaling<=16?122880/(512*this.overscaling):0,le=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray),me=void 0,ze=void 0,He=void 0,st=void 0;this.e1=this.e2=-1,M&&(st=o[j].sub($=o[L-2])._unit()._perp());for(var et=j;et<L;et++)if(!(ze=et===L-1?M?o[j+1]:void 0:o[et+1])||!o[et].equals(ze)){st&&(He=st),$&&(me=$),$=o[et],st=ze?ze.sub($)._unit()._perp():He;var bt=(He=He||st).add(st);bt.x===0&&bt.y===0||bt._unit();var Lt=He.x*st.x+He.y*st.y,qt=bt.x*st.x+bt.y*st.y,jt=qt!==0?1/qt:1/0,mr=2*Math.sqrt(2-2*qt),Vr=qt<Yp&&me&&ze,Jr=He.x*st.y-He.y*st.x>0;if(Vr&&et>j){var Fn=$.dist(me);if(Fn>2*q){var gn=$.sub($.sub(me)._mult(q/Fn)._round());this.updateDistance(me,gn),this.addCurrentVertex(gn,He,0,0,le),me=gn}}var Hn=me&&ze,_n=Hn?f:M?"butt":m;if(Hn&&_n==="round"&&(jt<E?_n="miter":jt<=2&&(_n="fakeround")),_n==="miter"&&jt>x&&(_n="bevel"),_n==="bevel"&&(jt>2&&(_n="flipbevel"),jt<x&&(_n="miter")),me&&this.updateDistance(me,$),_n==="miter")bt._mult(jt),this.addCurrentVertex($,bt,0,0,le);else if(_n==="flipbevel"){if(jt>100)bt=st.mult(-1);else{var Ai=jt*He.add(st).mag()/He.sub(st).mag();bt._perp()._mult(Ai*(Jr?-1:1))}this.addCurrentVertex($,bt,0,0,le),this.addCurrentVertex($,bt.mult(-1),0,0,le)}else if(_n==="bevel"||_n==="fakeround"){var qr=-Math.sqrt(jt*jt-1),Cr=Jr?qr:0,Pi=Jr?0:qr;if(me&&this.addCurrentVertex($,He,Cr,Pi,le),_n==="fakeround")for(var yi=Math.round(180*mr/Math.PI/20),Gi=1;Gi<yi;Gi++){var Xn=Gi/yi;if(Xn!==.5){var ra=Xn-.5;Xn+=Xn*ra*(Xn-1)*((1.0904+Lt*(Lt*(3.55645-1.43519*Lt)-3.2452))*ra*ra+(.848013+Lt*(.215638*Lt-1.06021)))}var Ka=st.sub(He)._mult(Xn)._add(He)._unit()._mult(Jr?-1:1);this.addHalfVertex($,Ka.x,Ka.y,!1,Jr,0,le)}ze&&this.addCurrentVertex($,st,-Cr,-Pi,le)}else if(_n==="butt")this.addCurrentVertex($,bt,0,0,le);else if(_n==="square"){var _o=me?1:-1;this.addCurrentVertex($,bt,_o,_o,le)}else _n==="round"&&(me&&(this.addCurrentVertex($,He,0,0,le),this.addCurrentVertex($,He,1,1,le,!0)),ze&&(this.addCurrentVertex($,st,-1,-1,le,!0),this.addCurrentVertex($,st,0,0,le)));if(Vr&&et<L-1){var uo=$.dist(ze);if(uo>2*q){var Qa=$.add(ze.sub($)._mult(q/uo)._round());this.updateDistance($,Qa),this.addCurrentVertex(Qa,st,0,0,le),$=Qa}}}}},As.prototype.addCurrentVertex=function(o,u,f,m,x,E){E===void 0&&(E=!1);var T=u.y*m-u.x,M=-u.y-u.x*m;this.addHalfVertex(o,u.x+u.y*f,u.y-u.x*f,E,!1,f,x),this.addHalfVertex(o,T,M,E,!0,-m,x),this.distance>Zd/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(o,u,f,m,x,E))},As.prototype.addHalfVertex=function(o,u,f,m,x,E,T){var M=.5*(this.lineClips?this.scaledDistance*(Zd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o.x<<1)+(m?1:0),(o.y<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(E===0?0:E<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var L=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),T.primitiveLength++),x?this.e2=L:this.e1=L},As.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},As.prototype.updateDistance=function(o,u){this.distance+=o.dist(u),this.updateScaledDistance()},bn("LineBucket",As,{omit:["layers","patternFeatures"]});var sp=new Ma({"line-cap":new Ln(he.layout_line["line-cap"]),"line-join":new An(he.layout_line["line-join"]),"line-miter-limit":new Ln(he.layout_line["line-miter-limit"]),"line-round-limit":new Ln(he.layout_line["line-round-limit"]),"line-sort-key":new An(he.layout_line["line-sort-key"])}),up={paint:new Ma({"line-opacity":new An(he.paint_line["line-opacity"]),"line-color":new An(he.paint_line["line-color"]),"line-translate":new Ln(he.paint_line["line-translate"]),"line-translate-anchor":new Ln(he.paint_line["line-translate-anchor"]),"line-width":new An(he.paint_line["line-width"]),"line-gap-width":new An(he.paint_line["line-gap-width"]),"line-offset":new An(he.paint_line["line-offset"]),"line-blur":new An(he.paint_line["line-blur"]),"line-dasharray":new Ko(he.paint_line["line-dasharray"]),"line-pattern":new qo(he.paint_line["line-pattern"]),"line-gradient":new bu(he.paint_line["line-gradient"])}),layout:sp},qp=new(function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(f,m){return m=new we(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),o.prototype.possiblyEvaluate.call(this,f,m)},u.prototype.evaluate=function(f,m,x,E){return m=Xt({},m,{zoom:Math.floor(m.zoom)}),o.prototype.evaluate.call(this,f,m,x,E)},u}(An))(up.paint.properties["line-width"].specification);qp.useIntegerZoom=!0;var Hf=function(o){function u(f){o.call(this,f,up),this.gradientVersion=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Rs,this.gradientVersion=(this.gradientVersion+1)%Ve)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(f,m){o.prototype.recalculate.call(this,f,m),this.paint._values["line-floorwidth"]=qp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,f)},u.prototype.createBucket=function(f){return new As(f)},u.prototype.queryRadius=function(f){var m=f,x=Kp(Co("line-width",this,m),Co("line-gap-width",this,m)),E=Co("line-offset",this,m);return x/2+Math.abs(E)+ro(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(f,m,x,E,T,M,L){var j=Ss(f,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,L),$=L/2*Kp(this.paint.get("line-width").evaluate(m,x),this.paint.get("line-gap-width").evaluate(m,x)),q=this.paint.get("line-offset").evaluate(m,x);return q&&(E=function(le,me){for(var ze=[],He=new ae(0,0),st=0;st<le.length;st++){for(var et=le[st],bt=[],Lt=0;Lt<et.length;Lt++){var qt=et[Lt],jt=et[Lt+1],mr=Lt===0?He:qt.sub(et[Lt-1])._unit()._perp(),Vr=Lt===et.length-1?He:jt.sub(qt)._unit()._perp(),Jr=mr._add(Vr)._unit();Jr._mult(1/(Jr.x*Vr.x+Jr.y*Vr.y)),bt.push(Jr._mult(me)._add(qt))}ze.push(bt)}return ze}(E,q*L)),function(le,me,ze){for(var He=0;He<me.length;He++){var st=me[He];if(le.length>=3){for(var et=0;et<st.length;et++)if(fu(le,st[et]))return!0}if(Ls(le,st,ze))return!0}return!1}(j,E,$)},u.prototype.isTileClipped=function(){return!0},u}(Qs);function Kp(o,u){return u>0?u+2*o:o}var Hv=co([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Wv=co([{name:"a_projected_pos",components:3,type:"Float32"}],4),Vd=(co([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),co([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),jd=(co([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),co([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),W=co([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ce(o,u,f){return o.sections.forEach(function(m){m.text=function(x,E,T){var M=E.layout.get("text-transform").evaluate(T,{});return M==="uppercase"?x=x.toLocaleUpperCase():M==="lowercase"&&(x=x.toLocaleLowerCase()),Nt.applyArabicShaping&&(x=Nt.applyArabicShaping(x)),x}(m.text,u,f)}),o}co([{name:"triangle",components:3,type:"Uint16"}]),co([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),co([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),co([{type:"Float32",name:"offsetX"}]),co([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ke={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Yt=function(o,u,f,m,x){var E,T,M=8*x-m-1,L=(1<<M)-1,j=L>>1,$=-7,q=f?x-1:0,le=f?-1:1,me=o[u+q];for(q+=le,E=me&(1<<-$)-1,me>>=-$,$+=M;$>0;E=256*E+o[u+q],q+=le,$-=8);for(T=E&(1<<-$)-1,E>>=-$,$+=m;$>0;T=256*T+o[u+q],q+=le,$-=8);if(E===0)E=1-j;else{if(E===L)return T?NaN:1/0*(me?-1:1);T+=Math.pow(2,m),E-=j}return(me?-1:1)*T*Math.pow(2,E-m)},pr=function(o,u,f,m,x,E){var T,M,L,j=8*E-x-1,$=(1<<j)-1,q=$>>1,le=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,me=m?0:E-1,ze=m?1:-1,He=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(M=isNaN(u)?1:0,T=$):(T=Math.floor(Math.log(u)/Math.LN2),u*(L=Math.pow(2,-T))<1&&(T--,L*=2),(u+=T+q>=1?le/L:le*Math.pow(2,1-q))*L>=2&&(T++,L/=2),T+q>=$?(M=0,T=$):T+q>=1?(M=(u*L-1)*Math.pow(2,x),T+=q):(M=u*Math.pow(2,q-1)*Math.pow(2,x),T=0));x>=8;o[f+me]=255&M,me+=ze,M/=256,x-=8);for(T=T<<x|M,j+=x;j>0;o[f+me]=255&T,me+=ze,T/=256,j-=8);o[f+me-ze]|=128*He},Qt=zt;function zt(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}zt.Varint=0,zt.Fixed64=1,zt.Bytes=2,zt.Fixed32=5;var Fr=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Ir(o){return o.type===zt.Bytes?o.readVarint()+o.pos:o.pos+1}function Yr(o,u,f){return f?4294967296*u+(o>>>0):4294967296*(u>>>0)+(o>>>0)}function Ur(o,u,f){var m=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));f.realloc(m);for(var x=f.pos-1;x>=o;x--)f.buf[x+m]=f.buf[x]}function Wr(o,u){for(var f=0;f<o.length;f++)u.writeVarint(o[f])}function Qr(o,u){for(var f=0;f<o.length;f++)u.writeSVarint(o[f])}function Or(o,u){for(var f=0;f<o.length;f++)u.writeFloat(o[f])}function Xr(o,u){for(var f=0;f<o.length;f++)u.writeDouble(o[f])}function It(o,u){for(var f=0;f<o.length;f++)u.writeBoolean(o[f])}function sr(o,u){for(var f=0;f<o.length;f++)u.writeFixed32(o[f])}function zr(o,u){for(var f=0;f<o.length;f++)u.writeSFixed32(o[f])}function cn(o,u){for(var f=0;f<o.length;f++)u.writeFixed64(o[f])}function Er(o,u){for(var f=0;f<o.length;f++)u.writeSFixed64(o[f])}function vn(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+16777216*o[u+3]}function kr(o,u,f){o[f]=u,o[f+1]=u>>>8,o[f+2]=u>>>16,o[f+3]=u>>>24}function pn(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+(o[u+3]<<24)}function br(o,u,f){o===1&&f.readMessage(un,u)}function un(o,u,f){if(o===3){var m=f.readMessage(jn,{}),x=m.width,E=m.height,T=m.left,M=m.top,L=m.advance;u.push({id:m.id,bitmap:new Js({width:x+6,height:E+6},m.bitmap),metrics:{width:x,height:E,left:T,top:M,advance:L}})}}function jn(o,u,f){o===1?u.id=f.readVarint():o===2?u.bitmap=f.readBytes():o===3?u.width=f.readVarint():o===4?u.height=f.readVarint():o===5?u.left=f.readSVarint():o===6?u.top=f.readSVarint():o===7&&(u.advance=f.readVarint())}function ai(o){for(var u=0,f=0,m=0,x=o;m<x.length;m+=1){var E=x[m];u+=E.w*E.h,f=Math.max(f,E.w)}o.sort(function(He,st){return st.h-He.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),f),h:1/0}],M=0,L=0,j=0,$=o;j<$.length;j+=1)for(var q=$[j],le=T.length-1;le>=0;le--){var me=T[le];if(!(q.w>me.w||q.h>me.h)){if(q.x=me.x,q.y=me.y,L=Math.max(L,q.y+q.h),M=Math.max(M,q.x+q.w),q.w===me.w&&q.h===me.h){var ze=T.pop();le<T.length&&(T[le]=ze)}else q.h===me.h?(me.x+=q.w,me.w-=q.w):q.w===me.w?(me.y+=q.h,me.h-=q.h):(T.push({x:me.x+q.w,y:me.y,w:me.w-q.w,h:q.h}),me.y+=q.h,me.h-=q.h);break}}return{w:M,h:L,fill:u/(M*L)||0}}zt.prototype={destroy:function(){this.buf=null},readFields:function(o,u,f){for(f=f||this.length;this.pos<f;){var m=this.readVarint(),x=m>>3,E=this.pos;this.type=7&m,o(x,u,this),this.pos===E&&this.skip(m)}return u},readMessage:function(o,u){return this.readFields(o,u,this.readVarint()+this.pos)},readFixed32:function(){var o=vn(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=pn(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=vn(this.buf,this.pos)+4294967296*vn(this.buf,this.pos+4);return this.pos+=8,o},readSFixed64:function(){var o=vn(this.buf,this.pos)+4294967296*pn(this.buf,this.pos+4);return this.pos+=8,o},readFloat:function(){var o=Yt(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Yt(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var u,f,m=this.buf;return u=127&(f=m[this.pos++]),f<128?u:(u|=(127&(f=m[this.pos++]))<<7,f<128?u:(u|=(127&(f=m[this.pos++]))<<14,f<128?u:(u|=(127&(f=m[this.pos++]))<<21,f<128?u:function(x,E,T){var M,L,j=T.buf;if(M=(112&(L=j[T.pos++]))>>4,L<128||(M|=(127&(L=j[T.pos++]))<<3,L<128)||(M|=(127&(L=j[T.pos++]))<<10,L<128)||(M|=(127&(L=j[T.pos++]))<<17,L<128)||(M|=(127&(L=j[T.pos++]))<<24,L<128)||(M|=(1&(L=j[T.pos++]))<<31,L<128))return Yr(x,M,E);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(f=m[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,u=this.pos;return this.pos=o,o-u>=12&&Fr?function(f,m,x){return Fr.decode(f.subarray(m,x))}(this.buf,u,o):function(f,m,x){for(var E="",T=m;T<x;){var M,L,j,$=f[T],q=null,le=$>239?4:$>223?3:$>191?2:1;if(T+le>x)break;le===1?$<128&&(q=$):le===2?(192&(M=f[T+1]))==128&&(q=(31&$)<<6|63&M)<=127&&(q=null):le===3?(L=f[T+2],(192&(M=f[T+1]))==128&&(192&L)==128&&((q=(15&$)<<12|(63&M)<<6|63&L)<=2047||q>=55296&&q<=57343)&&(q=null)):le===4&&(L=f[T+2],j=f[T+3],(192&(M=f[T+1]))==128&&(192&L)==128&&(192&j)==128&&((q=(15&$)<<18|(63&M)<<12|(63&L)<<6|63&j)<=65535||q>=1114112)&&(q=null)),q===null?(q=65533,le=1):q>65535&&(q-=65536,E+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),E+=String.fromCharCode(q),T+=le}return E}(this.buf,u,o)},readBytes:function(){var o=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,o);return this.pos=o,u},readPackedVarint:function(o,u){if(this.type!==zt.Bytes)return o.push(this.readVarint(u));var f=Ir(this);for(o=o||[];this.pos<f;)o.push(this.readVarint(u));return o},readPackedSVarint:function(o){if(this.type!==zt.Bytes)return o.push(this.readSVarint());var u=Ir(this);for(o=o||[];this.pos<u;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==zt.Bytes)return o.push(this.readBoolean());var u=Ir(this);for(o=o||[];this.pos<u;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==zt.Bytes)return o.push(this.readFloat());var u=Ir(this);for(o=o||[];this.pos<u;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==zt.Bytes)return o.push(this.readDouble());var u=Ir(this);for(o=o||[];this.pos<u;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==zt.Bytes)return o.push(this.readFixed32());var u=Ir(this);for(o=o||[];this.pos<u;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==zt.Bytes)return o.push(this.readSFixed32());var u=Ir(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==zt.Bytes)return o.push(this.readFixed64());var u=Ir(this);for(o=o||[];this.pos<u;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==zt.Bytes)return o.push(this.readSFixed64());var u=Ir(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed64());return o},skip:function(o){var u=7&o;if(u===zt.Varint)for(;this.buf[this.pos++]>127;);else if(u===zt.Bytes)this.pos=this.readVarint()+this.pos;else if(u===zt.Fixed32)this.pos+=4;else{if(u!==zt.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(o,u){this.writeVarint(o<<3|u)},realloc:function(o){for(var u=this.length||16;u<this.pos+o;)u*=2;if(u!==this.length){var f=new Uint8Array(u);f.set(this.buf),this.buf=f,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),kr(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),kr(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),kr(this.buf,-1&o,this.pos),kr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),kr(this.buf,-1&o,this.pos),kr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(u,f){var m,x;if(u>=0?(m=u%4294967296|0,x=u/4294967296|0):(x=~(-u/4294967296),4294967295^(m=~(-u%4294967296))?m=m+1|0:(m=0,x=x+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(E,T,M){M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,M.buf[M.pos]=127&(E>>>=7)}(m,0,f),function(E,T){var M=(7&E)<<4;T.buf[T.pos++]|=M|((E>>>=3)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E)))))}(x,f)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var u=this.pos;this.pos=function(m,x,E){for(var T,M,L=0;L<x.length;L++){if((T=x.charCodeAt(L))>55295&&T<57344){if(!M){T>56319||L+1===x.length?(m[E++]=239,m[E++]=191,m[E++]=189):M=T;continue}if(T<56320){m[E++]=239,m[E++]=191,m[E++]=189,M=T;continue}T=M-55296<<10|T-56320|65536,M=null}else M&&(m[E++]=239,m[E++]=191,m[E++]=189,M=null);T<128?m[E++]=T:(T<2048?m[E++]=T>>6|192:(T<65536?m[E++]=T>>12|224:(m[E++]=T>>18|240,m[E++]=T>>12&63|128),m[E++]=T>>6&63|128),m[E++]=63&T|128)}return E}(this.buf,o,this.pos);var f=this.pos-u;f>=128&&Ur(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeFloat:function(o){this.realloc(4),pr(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),pr(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var u=o.length;this.writeVarint(u),this.realloc(u);for(var f=0;f<u;f++)this.buf[this.pos++]=o[f]},writeRawMessage:function(o,u){this.pos++;var f=this.pos;o(u,this);var m=this.pos-f;m>=128&&Ur(f,m,this),this.pos=f-1,this.writeVarint(m),this.pos+=m},writeMessage:function(o,u,f){this.writeTag(o,zt.Bytes),this.writeRawMessage(u,f)},writePackedVarint:function(o,u){u.length&&this.writeMessage(o,Wr,u)},writePackedSVarint:function(o,u){u.length&&this.writeMessage(o,Qr,u)},writePackedBoolean:function(o,u){u.length&&this.writeMessage(o,It,u)},writePackedFloat:function(o,u){u.length&&this.writeMessage(o,Or,u)},writePackedDouble:function(o,u){u.length&&this.writeMessage(o,Xr,u)},writePackedFixed32:function(o,u){u.length&&this.writeMessage(o,sr,u)},writePackedSFixed32:function(o,u){u.length&&this.writeMessage(o,zr,u)},writePackedFixed64:function(o,u){u.length&&this.writeMessage(o,cn,u)},writePackedSFixed64:function(o,u){u.length&&this.writeMessage(o,Er,u)},writeBytesField:function(o,u){this.writeTag(o,zt.Bytes),this.writeBytes(u)},writeFixed32Field:function(o,u){this.writeTag(o,zt.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(o,u){this.writeTag(o,zt.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(o,u){this.writeTag(o,zt.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(o,u){this.writeTag(o,zt.Fixed64),this.writeSFixed64(u)},writeVarintField:function(o,u){this.writeTag(o,zt.Varint),this.writeVarint(u)},writeSVarintField:function(o,u){this.writeTag(o,zt.Varint),this.writeSVarint(u)},writeStringField:function(o,u){this.writeTag(o,zt.Bytes),this.writeString(u)},writeFloatField:function(o,u){this.writeTag(o,zt.Fixed32),this.writeFloat(u)},writeDoubleField:function(o,u){this.writeTag(o,zt.Fixed64),this.writeDouble(u)},writeBooleanField:function(o,u){this.writeVarintField(o,Boolean(u))}};var rn=function(o,u){var f=u.pixelRatio,m=u.version,x=u.stretchX,E=u.stretchY,T=u.content;this.paddedRect=o,this.pixelRatio=f,this.stretchX=x,this.stretchY=E,this.content=T,this.version=m},Lr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Lr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Lr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Lr.tlbr.get=function(){return this.tl.concat(this.br)},Lr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(rn.prototype,Lr);var _r=function(o,u){var f={},m={};this.haveRenderCallbacks=[];var x=[];this.addImages(o,f,x),this.addImages(u,m,x);var E=ai(x),T=new Io({width:E.w||1,height:E.h||1});for(var M in o){var L=o[M],j=f[M].paddedRect;Io.copy(L.data,T,{x:0,y:0},{x:j.x+1,y:j.y+1},L.data)}for(var $ in u){var q=u[$],le=m[$].paddedRect,me=le.x+1,ze=le.y+1,He=q.data.width,st=q.data.height;Io.copy(q.data,T,{x:0,y:0},{x:me,y:ze},q.data),Io.copy(q.data,T,{x:0,y:st-1},{x:me,y:ze-1},{width:He,height:1}),Io.copy(q.data,T,{x:0,y:0},{x:me,y:ze+st},{width:He,height:1}),Io.copy(q.data,T,{x:He-1,y:0},{x:me-1,y:ze},{width:1,height:st}),Io.copy(q.data,T,{x:0,y:0},{x:me+He,y:ze},{width:1,height:st})}this.image=T,this.iconPositions=f,this.patternPositions=m};_r.prototype.addImages=function(o,u,f){for(var m in o){var x=o[m],E={x:0,y:0,w:x.data.width+2,h:x.data.height+2};f.push(E),u[m]=new rn(E,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},_r.prototype.patchUpdatedImages=function(o,u){for(var f in o.dispatchRenderCallbacks(this.haveRenderCallbacks),o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),u)},_r.prototype.patchUpdatedImage=function(o,u,f){if(o&&u&&o.version!==u.version){o.version=u.version;var m=o.tl;f.update(u.data,void 0,{x:m[0],y:m[1]})}},bn("ImagePosition",rn),bn("ImageAtlas",_r);var Jt={horizontal:1,vertical:2,horizontalOnly:3},Si=function(){this.scale=1,this.fontStack="",this.imageName=null};Si.forText=function(o,u){var f=new Si;return f.scale=o||1,f.fontStack=u,f},Si.forImage=function(o){var u=new Si;return u.imageName=o,u};var Ye=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function xi(o,u,f,m,x,E,T,M,L,j,$,q,le,me,ze,He){var st,et=Ye.fromFeature(o,x);q===Jt.vertical&&et.verticalizePunctuation();var bt=Nt.processBidirectionalText,Lt=Nt.processStyledBidirectionalText;if(bt&&et.sections.length===1){st=[];for(var qt=0,jt=bt(et.toString(),ho(et,j,E,u,m,me,ze));qt<jt.length;qt+=1){var mr=jt[qt],Vr=new Ye;Vr.text=mr,Vr.sections=et.sections;for(var Jr=0;Jr<mr.length;Jr++)Vr.sectionIndex.push(0);st.push(Vr)}}else if(Lt){st=[];for(var Fn=0,gn=Lt(et.text,et.sectionIndex,ho(et,j,E,u,m,me,ze));Fn<gn.length;Fn+=1){var Hn=gn[Fn],_n=new Ye;_n.text=Hn[0],_n.sectionIndex=Hn[1],_n.sections=et.sections,st.push(_n)}}else st=function(Cr,Pi){for(var yi=[],Gi=Cr.text,Xn=0,ra=0,Ka=Pi;ra<Ka.length;ra+=1){var _o=Ka[ra];yi.push(Cr.substring(Xn,_o)),Xn=_o}return Xn<Gi.length&&yi.push(Cr.substring(Xn,Gi.length)),yi}(et,ho(et,j,E,u,m,me,ze));var Ai=[],qr={positionedLines:Ai,text:et.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:q,iconsInText:!1,verticalizable:!1};return function(Cr,Pi,yi,Gi,Xn,ra,Ka,_o,uo,Qa,yo,rs){for(var ns=0,tu=-17,ms=0,Us=0,Do=_o==="right"?1:_o==="left"?0:.5,gs=0,Ui=0,Aa=Xn;Ui<Aa.length;Ui+=1){var da=Aa[Ui];da.trim();var Yi=da.getMaxScale(),vu=24*(Yi-1),zs={positionedGlyphs:[],lineOffset:0};Cr.positionedLines[gs]=zs;var za=zs.positionedGlyphs,No=0;if(da.length()){for(var Zs=0;Zs<da.length();Zs++){var na=da.getSection(Zs),Fl=da.getSectionIndex(Zs),_l=da.getCharCode(Zs),lf=0,Lo=null,cf=null,ac=null,Jp=24,cp=!(uo===Jt.horizontal||!yo&&!Qc(_l)||yo&&(ui[_l]||(Fc=_l,sn.Arabic(Fc)||sn["Arabic Supplement"](Fc)||sn["Arabic Extended-A"](Fc)||sn["Arabic Presentation Forms-A"](Fc)||sn["Arabic Presentation Forms-B"](Fc))));if(na.imageName){var ed=Gi[na.imageName];if(!ed)continue;ac=na.imageName,Cr.iconsInText=Cr.iconsInText||!0,cf=ed.paddedRect;var Gf=ed.displaySize;na.scale=24*na.scale/rs,lf=vu+(24-Gf[1]*na.scale),Jp=(Lo={width:Gf[0],height:Gf[1],left:1,top:-3,advance:cp?Gf[1]:Gf[0]}).advance;var td=cp?Gf[0]*na.scale-24*Yi:Gf[1]*na.scale-24*Yi;td>0&&td>No&&(No=td)}else{var qv=yi[na.fontStack],rd=qv&&qv[_l];if(rd&&rd.rect)cf=rd.rect,Lo=rd.metrics;else{var $d=Pi[na.fontStack],fp=$d&&$d[_l];if(!fp)continue;Lo=fp.metrics}lf=24*(Yi-na.scale)}cp?(Cr.verticalizable=!0,za.push({glyph:_l,imageName:ac,x:ns,y:tu+lf,vertical:cp,scale:na.scale,fontStack:na.fontStack,sectionIndex:Fl,metrics:Lo,rect:cf}),ns+=Jp*na.scale+Qa):(za.push({glyph:_l,imageName:ac,x:ns,y:tu+lf,vertical:cp,scale:na.scale,fontStack:na.fontStack,sectionIndex:Fl,metrics:Lo,rect:cf}),ns+=Lo.advance*na.scale+Qa)}za.length!==0&&(ms=Math.max(ns-Qa,ms),po(za,0,za.length-1,Do,No)),ns=0;var Yd=ra*Yi+No;zs.lineOffset=Math.max(No,vu),tu+=Yd,Us=Math.max(Yd,Us),++gs}else tu+=ra,++gs}var Fc,hp=tu- -17,oc=ya(Ka),Yu=oc.horizontalAlign,Mh=oc.verticalAlign;(function(nd,id,Ih,pp,qd,ad,dp,vp,Kd){var mp,Qd=(id-Ih)*qd;mp=ad!==dp?-vp*pp- -17:(-pp*Kd+.5)*dp;for(var gp=0,ff=nd;gp<ff.length;gp+=1)for(var is=0,_p=ff[gp].positionedGlyphs;is<_p.length;is+=1){var Ph=_p[is];Ph.x+=Qd,Ph.y+=mp}})(Cr.positionedLines,Do,Yu,Mh,ms,Us,ra,hp,Xn.length),Cr.top+=-Mh*hp,Cr.bottom=Cr.top+hp,Cr.left+=-Yu*ms,Cr.right=Cr.left+ms}(qr,u,f,m,st,T,M,L,q,j,le,He),!function(Cr){for(var Pi=0,yi=Cr;Pi<yi.length;Pi+=1)if(yi[Pi].positionedGlyphs.length!==0)return!1;return!0}(Ai)&&qr}Ye.fromFeature=function(o,u){for(var f=new Ye,m=0;m<o.sections.length;m++){var x=o.sections[m];x.image?f.addImageSection(x):f.addTextSection(x,u)}return f},Ye.prototype.length=function(){return this.text.length},Ye.prototype.getSection=function(o){return this.sections[this.sectionIndex[o]]},Ye.prototype.getSectionIndex=function(o){return this.sectionIndex[o]},Ye.prototype.getCharCode=function(o){return this.text.charCodeAt(o)},Ye.prototype.verticalizePunctuation=function(){this.text=function(o){for(var u="",f=0;f<o.length;f++){var m=o.charCodeAt(f+1)||null,x=o.charCodeAt(f-1)||null;u+=m&&Jc(m)&&!Ke[o[f+1]]||x&&Jc(x)&&!Ke[o[f-1]]||!Ke[o[f]]?o[f]:Ke[o[f]]}return u}(this.text)},Ye.prototype.trim=function(){for(var o=0,u=0;u<this.text.length&&ui[this.text.charCodeAt(u)];u++)o++;for(var f=this.text.length,m=this.text.length-1;m>=0&&m>=o&&ui[this.text.charCodeAt(m)];m--)f--;this.text=this.text.substring(o,f),this.sectionIndex=this.sectionIndex.slice(o,f)},Ye.prototype.substring=function(o,u){var f=new Ye;return f.text=this.text.substring(o,u),f.sectionIndex=this.sectionIndex.slice(o,u),f.sections=this.sections,f},Ye.prototype.toString=function(){return this.text},Ye.prototype.getMaxScale=function(){var o=this;return this.sectionIndex.reduce(function(u,f){return Math.max(u,o.sections[f].scale)},0)},Ye.prototype.addTextSection=function(o,u){this.text+=o.text,this.sections.push(Si.forText(o.scale,o.fontStack||u));for(var f=this.sections.length-1,m=0;m<o.text.length;++m)this.sectionIndex.push(f)},Ye.prototype.addImageSection=function(o){var u=o.image?o.image.name:"";if(u.length!==0){var f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Si.forImage(u)),this.sectionIndex.push(this.sections.length-1)):pt("Reached maximum number of images 6401")}else pt("Can't add FormattedSection with an empty image.")},Ye.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var ui={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Kn={};function $i(o,u,f,m,x,E){if(u.imageName){var T=m[u.imageName];return T?T.displaySize[0]*u.scale*24/E+x:0}var M=f[u.fontStack],L=M&&M[o];return L?L.metrics.advance*u.scale+x:0}function oo(o,u,f,m){var x=Math.pow(o-u,2);return m?o<u?x/2:2*x:x+Math.abs(f)*f}function so(o,u,f){var m=0;return o===10&&(m-=1e4),f&&(m+=150),o!==40&&o!==65288||(m+=50),u!==41&&u!==65289||(m+=50),m}function Oi(o,u,f,m,x,E){for(var T=null,M=oo(u,f,x,E),L=0,j=m;L<j.length;L+=1){var $=j[L],q=oo(u-$.x,f,x,E)+$.badness;q<=M&&(T=$,M=q)}return{index:o,x:u,priorBreak:T,badness:M}}function ho(o,u,f,m,x,E,T){if(E!=="point")return[];if(!o)return[];for(var M,L=[],j=function(st,et,bt,Lt,qt,jt){for(var mr=0,Vr=0;Vr<st.length();Vr++){var Jr=st.getSection(Vr);mr+=$i(st.getCharCode(Vr),Jr,Lt,qt,et,jt)}return mr/Math.max(1,Math.ceil(mr/bt))}(o,u,f,m,x,T),$=o.text.indexOf("\u200B")>=0,q=0,le=0;le<o.length();le++){var me=o.getSection(le),ze=o.getCharCode(le);if(ui[ze]||(q+=$i(ze,me,m,x,u,T)),le<o.length()-1){var He=!((M=ze)<11904||!(sn["Bopomofo Extended"](M)||sn.Bopomofo(M)||sn["CJK Compatibility Forms"](M)||sn["CJK Compatibility Ideographs"](M)||sn["CJK Compatibility"](M)||sn["CJK Radicals Supplement"](M)||sn["CJK Strokes"](M)||sn["CJK Symbols and Punctuation"](M)||sn["CJK Unified Ideographs Extension A"](M)||sn["CJK Unified Ideographs"](M)||sn["Enclosed CJK Letters and Months"](M)||sn["Halfwidth and Fullwidth Forms"](M)||sn.Hiragana(M)||sn["Ideographic Description Characters"](M)||sn["Kangxi Radicals"](M)||sn["Katakana Phonetic Extensions"](M)||sn.Katakana(M)||sn["Vertical Forms"](M)||sn["Yi Radicals"](M)||sn["Yi Syllables"](M)));(Kn[ze]||He||me.imageName)&&L.push(Oi(le+1,q,j,L,so(ze,o.getCharCode(le+1),He&&$),!1))}}return function st(et){return et?st(et.priorBreak).concat(et.index):[]}(Oi(o.length(),q,j,L,0,!0))}function ya(o){var u=.5,f=.5;switch(o){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:u,verticalAlign:f}}function po(o,u,f,m,x){if(m||x)for(var E=o[f],T=(o[f].x+E.metrics.advance*E.scale)*m,M=u;M<=f;M++)o[M].x-=T,o[M].y+=x}function vo(o,u,f,m,x,E){var T,M=o.image;if(M.content){var L=M.content,j=M.pixelRatio||1;T=[L[0]/j,L[1]/j,M.displaySize[0]-L[2]/j,M.displaySize[1]-L[3]/j]}var $,q,le,me,ze=u.left*E,He=u.right*E;f==="width"||f==="both"?(me=x[0]+ze-m[3],q=x[0]+He+m[1]):q=(me=x[0]+(ze+He-M.displaySize[0])/2)+M.displaySize[0];var st=u.top*E,et=u.bottom*E;return f==="height"||f==="both"?($=x[1]+st-m[0],le=x[1]+et+m[2]):le=($=x[1]+(st+et-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:$,right:q,bottom:le,left:me,collisionPadding:T}}Kn[10]=!0,Kn[32]=!0,Kn[38]=!0,Kn[40]=!0,Kn[41]=!0,Kn[43]=!0,Kn[45]=!0,Kn[47]=!0,Kn[173]=!0,Kn[183]=!0,Kn[8203]=!0,Kn[8208]=!0,Kn[8211]=!0,Kn[8231]=!0;var Ua=function(o){function u(f,m,x,E){o.call(this,f,m),this.angle=x,E!==void 0&&(this.segment=E)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(ae);function Oo(o,u){var f=u.expression;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new we(o+1))};if(f.kind==="source")return{kind:"source"};for(var m=f.zoomStops,x=f.interpolationType,E=0;E<m.length&&m[E]<=o;)E++;for(var T=E=Math.max(0,E-1);T<m.length&&m[T]<o+1;)T++;T=Math.min(m.length-1,T);var M=m[E],L=m[T];return f.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:L,interpolationType:x}:{kind:"camera",minZoom:M,maxZoom:L,minSize:f.evaluate(new we(M)),maxSize:f.evaluate(new we(L)),interpolationType:x}}function vs(o,u,f){var m=u.uSize,x=f.lowerSize;return o.kind==="source"?x/128:o.kind==="composite"?Ga(x/128,f.upperSize/128,u.uSizeT):m}function mo(o,u){var f=0,m=0;if(o.kind==="constant")m=o.layoutSize;else if(o.kind!=="source"){var x=o.interpolationType,E=x?Ct(Wo.interpolationFactor(x,u,o.minZoom,o.maxZoom),0,1):0;o.kind==="camera"?m=Ga(o.minSize,o.maxSize,E):f=E}return{uSizeT:f,uSize:m}}bn("Anchor",Ua);var _i=Object.freeze({__proto__:null,getSizeData:Oo,evaluateSizeForFeature:vs,evaluateSizeForZoom:mo,SIZE_PACK_FACTOR:128});function es(o,u,f,m,x){if(u.segment===void 0)return!0;for(var E=u,T=u.segment+1,M=0;M>-f/2;){if(--T<0)return!1;M-=o[T].dist(E),E=o[T]}M+=o[T].dist(o[T+1]),T++;for(var L=[],j=0;M<f/2;){var $=o[T],q=o[T+1];if(!q)return!1;var le=o[T-1].angleTo($)-$.angleTo(q);for(le=Math.abs((le+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:M,angleDelta:le}),j+=le;M-L[0].distance>m;)j-=L.shift().angleDelta;if(j>x)return!1;T++,M+=$.dist(q)}return!0}function Qi(o){for(var u=0,f=0;f<o.length-1;f++)u+=o[f].dist(o[f+1]);return u}function Yn(o,u,f){return o?.6*u*f:0}function Ii(o,u){return Math.max(o?o.right-o.left:0,u?u.right-u.left:0)}function Wi(o,u,f,m,x,E){for(var T=Yn(f,x,E),M=Ii(f,m)*E,L=0,j=Qi(o)/2,$=0;$<o.length-1;$++){var q=o[$],le=o[$+1],me=q.dist(le);if(L+me>j){var ze=(j-L)/me,He=Ga(q.x,le.x,ze),st=Ga(q.y,le.y,ze),et=new Ua(He,st,le.angleTo(q),$);return et._round(),!T||es(o,et,M,T,u)?et:void 0}L+=me}}function go(o,u,f,m,x,E,T,M,L){var j=Yn(m,E,T),$=Ii(m,x),q=$*T,le=o[0].x===0||o[0].x===L||o[0].y===0||o[0].y===L;return u-q<u/4&&(u=q+u/4),function me(ze,He,st,et,bt,Lt,qt,jt,mr){for(var Vr=Lt/2,Jr=Qi(ze),Fn=0,gn=He-st,Hn=[],_n=0;_n<ze.length-1;_n++){for(var Ai=ze[_n],qr=ze[_n+1],Cr=Ai.dist(qr),Pi=qr.angleTo(Ai);gn+st<Fn+Cr;){var yi=((gn+=st)-Fn)/Cr,Gi=Ga(Ai.x,qr.x,yi),Xn=Ga(Ai.y,qr.y,yi);if(Gi>=0&&Gi<mr&&Xn>=0&&Xn<mr&&gn-Vr>=0&&gn+Vr<=Jr){var ra=new Ua(Gi,Xn,Pi,_n);ra._round(),et&&!es(ze,ra,Lt,et,bt)||Hn.push(ra)}}Fn+=Cr}return jt||Hn.length||qt||(Hn=me(ze,Fn/2,st,et,bt,Lt,qt,!0,mr)),Hn}(o,le?u/2*M%u:($/2+2*E)*T*M%u,u,j,f,q,le,!1,L)}function ml(o,u,f,m,x){for(var E=[],T=0;T<o.length;T++)for(var M=o[T],L=void 0,j=0;j<M.length-1;j++){var $=M[j],q=M[j+1];$.x<u&&q.x<u||($.x<u?$=new ae(u,$.y+(u-$.x)/(q.x-$.x)*(q.y-$.y))._round():q.x<u&&(q=new ae(u,$.y+(u-$.x)/(q.x-$.x)*(q.y-$.y))._round()),$.y<f&&q.y<f||($.y<f?$=new ae($.x+(f-$.y)/(q.y-$.y)*(q.x-$.x),f)._round():q.y<f&&(q=new ae($.x+(f-$.y)/(q.y-$.y)*(q.x-$.x),f)._round()),$.x>=m&&q.x>=m||($.x>=m?$=new ae(m,$.y+(m-$.x)/(q.x-$.x)*(q.y-$.y))._round():q.x>=m&&(q=new ae(m,$.y+(m-$.x)/(q.x-$.x)*(q.y-$.y))._round()),$.y>=x&&q.y>=x||($.y>=x?$=new ae($.x+(x-$.y)/(q.y-$.y)*(q.x-$.x),x)._round():q.y>=x&&(q=new ae($.x+(x-$.y)/(q.y-$.y)*(q.x-$.x),x)._round()),L&&$.equals(L[L.length-1])||E.push(L=[$]),L.push(q)))))}return E}function Ge(o,u,f,m){var x=[],E=o.image,T=E.pixelRatio,M=E.paddedRect.w-2,L=E.paddedRect.h-2,j=o.right-o.left,$=o.bottom-o.top,q=E.stretchX||[[0,M]],le=E.stretchY||[[0,L]],me=function(Gi,Xn){return Gi+Xn[1]-Xn[0]},ze=q.reduce(me,0),He=le.reduce(me,0),st=M-ze,et=L-He,bt=0,Lt=ze,qt=0,jt=He,mr=0,Vr=st,Jr=0,Fn=et;if(E.content&&m){var gn=E.content;bt=tr(q,0,gn[0]),qt=tr(le,0,gn[1]),Lt=tr(q,gn[0],gn[2]),jt=tr(le,gn[1],gn[3]),mr=gn[0]-bt,Jr=gn[1]-qt,Vr=gn[2]-gn[0]-Lt,Fn=gn[3]-gn[1]-jt}var Hn=function(Gi,Xn,ra,Ka){var _o=mn(Gi.stretch-bt,Lt,j,o.left),uo=bi(Gi.fixed-mr,Vr,Gi.stretch,ze),Qa=mn(Xn.stretch-qt,jt,$,o.top),yo=bi(Xn.fixed-Jr,Fn,Xn.stretch,He),rs=mn(ra.stretch-bt,Lt,j,o.left),ns=bi(ra.fixed-mr,Vr,ra.stretch,ze),tu=mn(Ka.stretch-qt,jt,$,o.top),ms=bi(Ka.fixed-Jr,Fn,Ka.stretch,He),Us=new ae(_o,Qa),Do=new ae(rs,Qa),gs=new ae(rs,tu),Ui=new ae(_o,tu),Aa=new ae(uo/T,yo/T),da=new ae(ns/T,ms/T),Yi=u*Math.PI/180;if(Yi){var vu=Math.sin(Yi),zs=Math.cos(Yi),za=[zs,-vu,vu,zs];Us._matMult(za),Do._matMult(za),Ui._matMult(za),gs._matMult(za)}var No=Gi.stretch+Gi.fixed,Zs=Xn.stretch+Xn.fixed;return{tl:Us,tr:Do,bl:Ui,br:gs,tex:{x:E.paddedRect.x+1+No,y:E.paddedRect.y+1+Zs,w:ra.stretch+ra.fixed-No,h:Ka.stretch+Ka.fixed-Zs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Aa,pixelOffsetBR:da,minFontScaleX:Vr/T/j,minFontScaleY:Fn/T/$,isSDF:f}};if(m&&(E.stretchX||E.stretchY))for(var _n=Ht(q,st,ze),Ai=Ht(le,et,He),qr=0;qr<_n.length-1;qr++)for(var Cr=_n[qr],Pi=_n[qr+1],yi=0;yi<Ai.length-1;yi++)x.push(Hn(Cr,Ai[yi],Pi,Ai[yi+1]));else x.push(Hn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:L+1}));return x}function tr(o,u,f){for(var m=0,x=0,E=o;x<E.length;x+=1){var T=E[x];m+=Math.max(u,Math.min(f,T[1]))-Math.max(u,Math.min(f,T[0]))}return m}function Ht(o,u,f){for(var m=[{fixed:-1,stretch:0}],x=0,E=o;x<E.length;x+=1){var T=E[x],M=T[0],L=T[1],j=m[m.length-1];m.push({fixed:M-j.stretch,stretch:j.stretch}),m.push({fixed:M-j.stretch,stretch:j.stretch+(L-M)})}return m.push({fixed:u+1,stretch:f}),m}function mn(o,u,f,m){return o/u*f+m}function bi(o,u,f,m){return o-u*f/m}var pa=function(o,u,f,m,x,E,T,M,L,j){if(this.boxStartIndex=o.length,L){var $=E.top,q=E.bottom,le=E.collisionPadding;le&&($-=le[1],q+=le[3]);var me=q-$;me>0&&(me=Math.max(10,me),this.circleDiameter=me)}else{var ze=E.top*T-M,He=E.bottom*T+M,st=E.left*T-M,et=E.right*T+M,bt=E.collisionPadding;if(bt&&(st-=bt[0]*T,ze-=bt[1]*T,et+=bt[2]*T,He+=bt[3]*T),j){var Lt=new ae(st,ze),qt=new ae(et,ze),jt=new ae(st,He),mr=new ae(et,He),Vr=j*Math.PI/180;Lt._rotate(Vr),qt._rotate(Vr),jt._rotate(Vr),mr._rotate(Vr),st=Math.min(Lt.x,qt.x,jt.x,mr.x),et=Math.max(Lt.x,qt.x,jt.x,mr.x),ze=Math.min(Lt.y,qt.y,jt.y,mr.y),He=Math.max(Lt.y,qt.y,jt.y,mr.y)}o.emplaceBack(u.x,u.y,st,ze,et,He,f,m,x)}this.boxEndIndex=o.length},ve=function(o,u){if(o===void 0&&(o=[]),u===void 0&&(u=Pe),this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(var f=(this.length>>1)-1;f>=0;f--)this._down(f)};function Pe(o,u){return o<u?-1:o>u?1:0}function qe(o,u,f){u===void 0&&(u=1),f===void 0&&(f=!1);for(var m=1/0,x=1/0,E=-1/0,T=-1/0,M=o[0],L=0;L<M.length;L++){var j=M[L];(!L||j.x<m)&&(m=j.x),(!L||j.y<x)&&(x=j.y),(!L||j.x>E)&&(E=j.x),(!L||j.y>T)&&(T=j.y)}var $=Math.min(E-m,T-x),q=$/2,le=new ve([],Wt);if($===0)return new ae(m,x);for(var me=m;me<E;me+=$)for(var ze=x;ze<T;ze+=$)le.push(new Ut(me+q,ze+q,q,o));for(var He=function(bt){for(var Lt=0,qt=0,jt=0,mr=bt[0],Vr=0,Jr=mr.length,Fn=Jr-1;Vr<Jr;Fn=Vr++){var gn=mr[Vr],Hn=mr[Fn],_n=gn.x*Hn.y-Hn.x*gn.y;qt+=(gn.x+Hn.x)*_n,jt+=(gn.y+Hn.y)*_n,Lt+=3*_n}return new Ut(qt/Lt,jt/Lt,0,bt)}(o),st=le.length;le.length;){var et=le.pop();(et.d>He.d||!He.d)&&(He=et,f&&console.log("found best %d after %d probes",Math.round(1e4*et.d)/1e4,st)),et.max-He.d<=u||(le.push(new Ut(et.p.x-(q=et.h/2),et.p.y-q,q,o)),le.push(new Ut(et.p.x+q,et.p.y-q,q,o)),le.push(new Ut(et.p.x-q,et.p.y+q,q,o)),le.push(new Ut(et.p.x+q,et.p.y+q,q,o)),st+=4)}return f&&(console.log("num probes: "+st),console.log("best distance: "+He.d)),He.p}function Wt(o,u){return u.max-o.max}function Ut(o,u,f,m){this.p=new ae(o,u),this.h=f,this.d=function(x,E){for(var T=!1,M=1/0,L=0;L<E.length;L++)for(var j=E[L],$=0,q=j.length,le=q-1;$<q;le=$++){var me=j[$],ze=j[le];me.y>x.y!=ze.y>x.y&&x.x<(ze.x-me.x)*(x.y-me.y)/(ze.y-me.y)+me.x&&(T=!T),M=Math.min(M,ec(x,me,ze))}return(T?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}ve.prototype.push=function(o){this.data.push(o),this.length++,this._up(this.length-1)},ve.prototype.pop=function(){if(this.length!==0){var o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}},ve.prototype.peek=function(){return this.data[0]},ve.prototype._up=function(o){for(var u=this.data,f=this.compare,m=u[o];o>0;){var x=o-1>>1,E=u[x];if(f(m,E)>=0)break;u[o]=E,o=x}u[o]=m},ve.prototype._down=function(o){for(var u=this.data,f=this.compare,m=this.length>>1,x=u[o];o<m;){var E=1+(o<<1),T=u[E],M=E+1;if(M<this.length&&f(u[M],T)<0&&(E=M,T=u[M]),f(T,x)>=0)break;u[o]=T,o=E}u[o]=x};var ot=Number.POSITIVE_INFINITY;function vt(o,u){return u[1]!==ot?function(f,m,x){var E=0,T=0;switch(m=Math.abs(m),x=Math.abs(x),f){case"top-right":case"top-left":case"top":T=x-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-x}switch(f){case"top-right":case"bottom-right":case"right":E=-m;break;case"top-left":case"bottom-left":case"left":E=m}return[E,T]}(o,u[0],u[1]):function(f,m){var x=0,E=0;m<0&&(m=0);var T=m/Math.sqrt(2);switch(f){case"top-right":case"top-left":E=T-7;break;case"bottom-right":case"bottom-left":E=7-T;break;case"bottom":E=7-m;break;case"top":E=m-7}switch(f){case"top-right":case"bottom-right":x=-T;break;case"top-left":case"bottom-left":x=T;break;case"left":x=m;break;case"right":x=-m}return[x,E]}(o,u[0])}function yt(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Xe(o,u,f,m,x,E,T,M,L,j,$,q,le,me,ze){var He=function(qt,jt,mr,Vr,Jr,Fn,gn,Hn){for(var _n=Vr.layout.get("text-rotate").evaluate(Fn,{})*Math.PI/180,Ai=[],qr=0,Cr=jt.positionedLines;qr<Cr.length;qr+=1)for(var Pi=Cr[qr],yi=0,Gi=Pi.positionedGlyphs;yi<Gi.length;yi+=1){var Xn=Gi[yi];if(Xn.rect){var ra=Xn.rect||{},Ka=4,_o=!0,uo=1,Qa=0,yo=(Jr||Hn)&&Xn.vertical,rs=Xn.metrics.advance*Xn.scale/2;if(Hn&&jt.verticalizable&&(Qa=Pi.lineOffset/2-(Xn.imageName?-(24-Xn.metrics.width*Xn.scale)/2:24*(Xn.scale-1))),Xn.imageName){var ns=gn[Xn.imageName];_o=ns.sdf,Ka=1/(uo=ns.pixelRatio)}var tu=Jr?[Xn.x+rs,Xn.y]:[0,0],ms=Jr?[0,0]:[Xn.x+rs+mr[0],Xn.y+mr[1]-Qa],Us=[0,0];yo&&(Us=ms,ms=[0,0]);var Do=(Xn.metrics.left-Ka)*Xn.scale-rs+ms[0],gs=(-Xn.metrics.top-Ka)*Xn.scale+ms[1],Ui=Do+ra.w*Xn.scale/uo,Aa=gs+ra.h*Xn.scale/uo,da=new ae(Do,gs),Yi=new ae(Ui,gs),vu=new ae(Do,Aa),zs=new ae(Ui,Aa);if(yo){var za=new ae(-rs,rs- -17),No=-Math.PI/2,Zs=12-rs,na=new ae(22-Zs,-(Xn.imageName?Zs:0)),Fl=new(Function.prototype.bind.apply(ae,[null].concat(Us)));da._rotateAround(No,za)._add(na)._add(Fl),Yi._rotateAround(No,za)._add(na)._add(Fl),vu._rotateAround(No,za)._add(na)._add(Fl),zs._rotateAround(No,za)._add(na)._add(Fl)}if(_n){var _l=Math.sin(_n),lf=Math.cos(_n),Lo=[lf,-_l,_l,lf];da._matMult(Lo),Yi._matMult(Lo),vu._matMult(Lo),zs._matMult(Lo)}var cf=new ae(0,0),ac=new ae(0,0);Ai.push({tl:da,tr:Yi,bl:vu,br:zs,tex:ra,writingMode:jt.writingMode,glyphOffset:tu,sectionIndex:Xn.sectionIndex,isSDF:_o,pixelOffsetTL:cf,pixelOffsetBR:ac,minFontScaleX:0,minFontScaleY:0})}}return Ai}(0,f,M,x,E,T,m,o.allowVerticalPlacement),st=o.textSizeData,et=null;st.kind==="source"?(et=[128*x.layout.get("text-size").evaluate(T,{})])[0]>32640&&pt(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):st.kind==="composite"&&((et=[128*me.compositeTextSizes[0].evaluate(T,{},ze),128*me.compositeTextSizes[1].evaluate(T,{},ze)])[0]>32640||et[1]>32640)&&pt(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),o.addSymbols(o.text,He,et,M,E,T,j,u,L.lineStartIndex,L.lineLength,le,ze);for(var bt=0,Lt=$;bt<Lt.length;bt+=1)q[Lt[bt]]=o.text.placedSymbolArray.length-1;return 4*He.length}function ut(o){for(var u in o)return o[u];return null}function Ie(o,u,f,m){var x=o.compareText;if(u in x){for(var E=x[u],T=E.length-1;T>=0;T--)if(m.dist(E[T])<f)return!0}else x[u]=[];return x[u].push(m),!1}var ht=ic.VectorTileFeature.types,Ot=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function or(o,u,f,m,x,E,T,M,L,j,$,q,le){var me=M?Math.min(32640,Math.round(M[0])):0,ze=M?Math.min(32640,Math.round(M[1])):0;o.emplaceBack(u,f,Math.round(32*m),Math.round(32*x),E,T,(me<<1)+(L?1:0),ze,16*j,16*$,256*q,256*le)}function wr(o,u,f){o.emplaceBack(u.x,u.y,f),o.emplaceBack(u.x,u.y,f),o.emplaceBack(u.x,u.y,f),o.emplaceBack(u.x,u.y,f)}function xr(o){for(var u=0,f=o.sections;u<f.length;u+=1)if(Of(f[u].text))return!0;return!1}var Pr=function(o){this.layoutVertexArray=new Lf,this.indexArray=new Qo,this.programConfigurations=o,this.segments=new be,this.dynamicLayoutVertexArray=new wc,this.opacityVertexArray=new tf,this.placedSymbolArray=new g};Pr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Pr.prototype.upload=function(o,u,f,m){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Hv.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,Wv.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,Ot,!0),this.opacityVertexBuffer.itemSize=1),(f||m)&&this.programConfigurations.upload(o))},Pr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},bn("SymbolBuffers",Pr);var On=function(o,u,f){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new f,this.segments=new be,this.collisionVertexArray=new dh};On.prototype.upload=function(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,Vd.members,!0)},On.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},bn("CollisionBuffers",On);var Sn=function(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(E){return E.id}),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Go([]),this.placementViewportMatrix=Go([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Oo(this.zoom,u["text-size"]),this.iconSizeData=Oo(this.zoom,u["icon-size"]);var f=this.layers[0].layout,m=f.get("symbol-sort-key"),x=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(function(E){return Jt[E]})),this.stateDependentLayerIds=this.layers.filter(function(E){return E.isStateDependent()}).map(function(E){return E.id}),this.sourceID=o.sourceID};Sn.prototype.createArrays=function(){this.text=new Pr(new $n(this.layers,this.zoom,function(o){return/^text/.test(o)})),this.icon=new Pr(new $n(this.layers,this.zoom,function(o){return/^icon/.test(o)})),this.glyphOffsetArray=new R,this.lineVertexArray=new O,this.symbolInstances=new C},Sn.prototype.calculateGlyphDependencies=function(o,u,f,m,x){for(var E=0;E<o.length;E++)if(u[o.charCodeAt(E)]=!0,(f||m)&&x){var T=Ke[o.charAt(E)];T&&(u[T.charCodeAt(0)]=!0)}},Sn.prototype.populate=function(o,u,f){var m=this.layers[0],x=m.layout,E=x.get("text-font"),T=x.get("text-field"),M=x.get("icon-image"),L=(T.value.kind!=="constant"||T.value.value instanceof fa&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),j=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,$=x.get("symbol-sort-key");if(this.features=[],L||j){for(var q=u.iconDependencies,le=u.glyphDependencies,me=u.availableImages,ze=new we(this.zoom),He=0,st=o;He<st.length;He+=1){var et=st[He],bt=et.feature,Lt=et.id,qt=et.index,jt=et.sourceLayerIndex,mr=m._featureFilter.needGeometry,Vr=Ya(bt,mr);if(m._featureFilter.filter(ze,Vr,f)){mr||(Vr.geometry=Na(bt));var Jr=void 0;if(L){var Fn=m.getValueAndResolveTokens("text-field",Vr,f,me),gn=fa.factory(Fn);xr(gn)&&(this.hasRTLText=!0),(!this.hasRTLText||ef()==="unavailable"||this.hasRTLText&&Nt.isParsed())&&(Jr=Ce(gn,m,Vr))}var Hn=void 0;if(j){var _n=m.getValueAndResolveTokens("icon-image",Vr,f,me);Hn=_n instanceof Ca?_n:Ca.fromString(_n)}if(Jr||Hn){var Ai=this.sortFeaturesByKey?$.evaluate(Vr,{},f):void 0;if(this.features.push({id:Lt,text:Jr,icon:Hn,index:qt,sourceLayerIndex:jt,geometry:Vr.geometry,properties:bt.properties,type:ht[bt.type],sortKey:Ai}),Hn&&(q[Hn.name]=!0),Jr){var qr=E.evaluate(Vr,{},f).join(","),Cr=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Jt.vertical)>=0;for(var Pi=0,yi=Jr.sections;Pi<yi.length;Pi+=1){var Gi=yi[Pi];if(Gi.image)q[Gi.image.name]=!0;else{var Xn=ul(Jr.toString()),ra=Gi.fontStack||qr,Ka=le[ra]=le[ra]||{};this.calculateGlyphDependencies(Gi.text,Ka,Cr,this.allowVerticalPlacement,Xn)}}}}}}x.get("symbol-placement")==="line"&&(this.features=function(_o){var uo={},Qa={},yo=[],rs=0;function ns(za){yo.push(_o[za]),rs++}function tu(za,No,Zs){var na=Qa[za];return delete Qa[za],Qa[No]=na,yo[na].geometry[0].pop(),yo[na].geometry[0]=yo[na].geometry[0].concat(Zs[0]),na}function ms(za,No,Zs){var na=uo[No];return delete uo[No],uo[za]=na,yo[na].geometry[0].shift(),yo[na].geometry[0]=Zs[0].concat(yo[na].geometry[0]),na}function Us(za,No,Zs){var na=Zs?No[0][No[0].length-1]:No[0][0];return za+":"+na.x+":"+na.y}for(var Do=0;Do<_o.length;Do++){var gs=_o[Do],Ui=gs.geometry,Aa=gs.text?gs.text.toString():null;if(Aa){var da=Us(Aa,Ui),Yi=Us(Aa,Ui,!0);if(da in Qa&&Yi in uo&&Qa[da]!==uo[Yi]){var vu=ms(da,Yi,Ui),zs=tu(da,Yi,yo[vu].geometry);delete uo[da],delete Qa[Yi],Qa[Us(Aa,yo[zs].geometry,!0)]=zs,yo[vu].geometry=null}else da in Qa?tu(da,Yi,Ui):Yi in uo?ms(da,Yi,Ui):(ns(Do),uo[da]=rs-1,Qa[Yi]=rs-1)}else ns(Do)}return yo.filter(function(za){return za.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(_o,uo){return _o.sortKey-uo.sortKey})}},Sn.prototype.update=function(o,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,f))},Sn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Sn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Sn.prototype.upload=function(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Sn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Sn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Sn.prototype.addToLineVertexArray=function(o,u){var f=this.lineVertexArray.length;if(o.segment!==void 0){for(var m=o.dist(u[o.segment+1]),x=o.dist(u[o.segment]),E={},T=o.segment+1;T<u.length;T++)E[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:m},T<u.length-1&&(m+=u[T+1].dist(u[T]));for(var M=o.segment||0;M>=0;M--)E[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:x},M>0&&(x+=u[M-1].dist(u[M]));for(var L=0;L<u.length;L++){var j=E[L];this.lineVertexArray.emplaceBack(j.x,j.y,j.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}},Sn.prototype.addSymbols=function(o,u,f,m,x,E,T,M,L,j,$,q){for(var le=o.indexArray,me=o.layoutVertexArray,ze=o.segments.prepareSegment(4*u.length,me,le,this.canOverlap?E.sortKey:void 0),He=this.glyphOffsetArray.length,st=ze.vertexLength,et=this.allowVerticalPlacement&&T===Jt.vertical?Math.PI/2:0,bt=E.text&&E.text.sections,Lt=0;Lt<u.length;Lt++){var qt=u[Lt],jt=qt.tl,mr=qt.tr,Vr=qt.bl,Jr=qt.br,Fn=qt.tex,gn=qt.pixelOffsetTL,Hn=qt.pixelOffsetBR,_n=qt.minFontScaleX,Ai=qt.minFontScaleY,qr=qt.glyphOffset,Cr=qt.isSDF,Pi=qt.sectionIndex,yi=ze.vertexLength,Gi=qr[1];or(me,M.x,M.y,jt.x,Gi+jt.y,Fn.x,Fn.y,f,Cr,gn.x,gn.y,_n,Ai),or(me,M.x,M.y,mr.x,Gi+mr.y,Fn.x+Fn.w,Fn.y,f,Cr,Hn.x,gn.y,_n,Ai),or(me,M.x,M.y,Vr.x,Gi+Vr.y,Fn.x,Fn.y+Fn.h,f,Cr,gn.x,Hn.y,_n,Ai),or(me,M.x,M.y,Jr.x,Gi+Jr.y,Fn.x+Fn.w,Fn.y+Fn.h,f,Cr,Hn.x,Hn.y,_n,Ai),wr(o.dynamicLayoutVertexArray,M,et),le.emplaceBack(yi,yi+1,yi+2),le.emplaceBack(yi+1,yi+2,yi+3),ze.vertexLength+=4,ze.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qr[0]),Lt!==u.length-1&&Pi===u[Lt+1].sectionIndex||o.programConfigurations.populatePaintArrays(me.length,E,E.index,{},q,bt&&bt[Pi])}o.placedSymbolArray.emplaceBack(M.x,M.y,He,this.glyphOffsetArray.length-He,st,L,j,M.segment,f?f[0]:0,f?f[1]:0,m[0],m[1],T,0,!1,0,$)},Sn.prototype._addCollisionDebugVertex=function(o,u,f,m,x,E){return u.emplaceBack(0,0),o.emplaceBack(f.x,f.y,m,x,Math.round(E.x),Math.round(E.y))},Sn.prototype.addCollisionDebugVertices=function(o,u,f,m,x,E,T){var M=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),L=M.vertexLength,j=x.layoutVertexArray,$=x.collisionVertexArray,q=T.anchorX,le=T.anchorY;this._addCollisionDebugVertex(j,$,E,q,le,new ae(o,u)),this._addCollisionDebugVertex(j,$,E,q,le,new ae(f,u)),this._addCollisionDebugVertex(j,$,E,q,le,new ae(f,m)),this._addCollisionDebugVertex(j,$,E,q,le,new ae(o,m)),M.vertexLength+=4;var me=x.indexArray;me.emplaceBack(L,L+1),me.emplaceBack(L+1,L+2),me.emplaceBack(L+2,L+3),me.emplaceBack(L+3,L),M.primitiveLength+=4},Sn.prototype.addDebugCollisionBoxes=function(o,u,f,m){for(var x=o;x<u;x++){var E=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,m?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,f)}},Sn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new On(Ql,jd.members,ju),this.iconCollisionBox=new On(Ql,jd.members,ju);for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},Sn.prototype._deserializeCollisionBoxesForSymbol=function(o,u,f,m,x,E,T,M,L){for(var j={},$=u;$<f;$++){var q=o.get($);j.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},j.textFeatureIndex=q.featureIndex;break}for(var le=m;le<x;le++){var me=o.get(le);j.verticalTextBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},j.verticalTextFeatureIndex=me.featureIndex;break}for(var ze=E;ze<T;ze++){var He=o.get(ze);j.iconBox={x1:He.x1,y1:He.y1,x2:He.x2,y2:He.y2,anchorPointX:He.anchorPointX,anchorPointY:He.anchorPointY},j.iconFeatureIndex=He.featureIndex;break}for(var st=M;st<L;st++){var et=o.get(st);j.verticalIconBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},j.verticalIconFeatureIndex=et.featureIndex;break}return j},Sn.prototype.deserializeCollisionBoxes=function(o){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}},Sn.prototype.hasTextData=function(){return this.text.segments.get().length>0},Sn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Sn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Sn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Sn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Sn.prototype.addIndicesForPlacedSymbol=function(o,u){for(var f=o.placedSymbolArray.get(u),m=f.vertexStartIndex+4*f.numGlyphs,x=f.vertexStartIndex;x<m;x+=4)o.indexArray.emplaceBack(x,x+1,x+2),o.indexArray.emplaceBack(x+1,x+2,x+3)},Sn.prototype.getSortedSymbolIndexes=function(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(o),f=Math.cos(o),m=[],x=[],E=[],T=0;T<this.symbolInstances.length;++T){E.push(T);var M=this.symbolInstances.get(T);m.push(0|Math.round(u*M.anchorX+f*M.anchorY)),x.push(M.featureIndex)}return E.sort(function(L,j){return m[L]-m[j]||x[j]-x[L]}),E},Sn.prototype.addToSortKeyRanges=function(o,u){var f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})},Sn.prototype.sortFeatures=function(o){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var f=0,m=this.symbolInstanceIndexes;f<m.length;f+=1){var x=this.symbolInstances.get(m[f]);this.featureSortOrder.push(x.featureIndex),[x.rightJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.leftJustifiedTextSymbolIndex].forEach(function(E,T,M){E>=0&&M.indexOf(E)===T&&u.addIndicesForPlacedSymbol(u.text,E)}),x.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,x.verticalPlacedTextSymbolIndex),x.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.placedIconSymbolIndex),x.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},bn("SymbolBucket",Sn,{omit:["layers","collisionBoxArray","features","compareText"]}),Sn.MAX_GLYPHS=65535,Sn.addDynamicAttributes=wr;var wn=new Ma({"symbol-placement":new Ln(he.layout_symbol["symbol-placement"]),"symbol-spacing":new Ln(he.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ln(he.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new An(he.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ln(he.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ln(he.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ln(he.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ln(he.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ln(he.layout_symbol["icon-rotation-alignment"]),"icon-size":new An(he.layout_symbol["icon-size"]),"icon-text-fit":new Ln(he.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ln(he.layout_symbol["icon-text-fit-padding"]),"icon-image":new An(he.layout_symbol["icon-image"]),"icon-rotate":new An(he.layout_symbol["icon-rotate"]),"icon-padding":new Ln(he.layout_symbol["icon-padding"]),"icon-keep-upright":new Ln(he.layout_symbol["icon-keep-upright"]),"icon-offset":new An(he.layout_symbol["icon-offset"]),"icon-anchor":new An(he.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ln(he.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ln(he.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ln(he.layout_symbol["text-rotation-alignment"]),"text-field":new An(he.layout_symbol["text-field"]),"text-font":new An(he.layout_symbol["text-font"]),"text-size":new An(he.layout_symbol["text-size"]),"text-max-width":new An(he.layout_symbol["text-max-width"]),"text-line-height":new Ln(he.layout_symbol["text-line-height"]),"text-letter-spacing":new An(he.layout_symbol["text-letter-spacing"]),"text-justify":new An(he.layout_symbol["text-justify"]),"text-radial-offset":new An(he.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ln(he.layout_symbol["text-variable-anchor"]),"text-anchor":new An(he.layout_symbol["text-anchor"]),"text-max-angle":new Ln(he.layout_symbol["text-max-angle"]),"text-writing-mode":new Ln(he.layout_symbol["text-writing-mode"]),"text-rotate":new An(he.layout_symbol["text-rotate"]),"text-padding":new Ln(he.layout_symbol["text-padding"]),"text-keep-upright":new Ln(he.layout_symbol["text-keep-upright"]),"text-transform":new An(he.layout_symbol["text-transform"]),"text-offset":new An(he.layout_symbol["text-offset"]),"text-allow-overlap":new Ln(he.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ln(he.layout_symbol["text-ignore-placement"]),"text-optional":new Ln(he.layout_symbol["text-optional"])}),Wn={paint:new Ma({"icon-opacity":new An(he.paint_symbol["icon-opacity"]),"icon-color":new An(he.paint_symbol["icon-color"]),"icon-halo-color":new An(he.paint_symbol["icon-halo-color"]),"icon-halo-width":new An(he.paint_symbol["icon-halo-width"]),"icon-halo-blur":new An(he.paint_symbol["icon-halo-blur"]),"icon-translate":new Ln(he.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ln(he.paint_symbol["icon-translate-anchor"]),"text-opacity":new An(he.paint_symbol["text-opacity"]),"text-color":new An(he.paint_symbol["text-color"],{runtimeType:jr,getOverride:function(o){return o.textColor},hasOverride:function(o){return!!o.textColor}}),"text-halo-color":new An(he.paint_symbol["text-halo-color"]),"text-halo-width":new An(he.paint_symbol["text-halo-width"]),"text-halo-blur":new An(he.paint_symbol["text-halo-blur"]),"text-translate":new Ln(he.paint_symbol["text-translate"]),"text-translate-anchor":new Ln(he.paint_symbol["text-translate-anchor"])}),layout:wn},oi=function(o){this.type=o.property.overrides?o.property.overrides.runtimeType:tn,this.defaultValue=o};oi.prototype.evaluate=function(o){if(o.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default},oi.prototype.eachChild=function(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)},oi.prototype.outputDefined=function(){return!1},oi.prototype.serialize=function(){return null},bn("FormatSectionOverride",oi,{omit:["defaultValue"]});var Ji=function(o){function u(f){o.call(this,f,Wn)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(f,m){if(o.prototype.recalculate.call(this,f,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var x=this.layout.get("text-writing-mode");if(x){for(var E=[],T=0,M=x;T<M.length;T+=1){var L=M[T];E.indexOf(L)<0&&E.push(L)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(f,m,x,E){var T=this.layout.get(f).evaluate(m,{},x,E),M=this._unevaluatedLayout._values[f];return M.isDataDriven()||zu(M.value)||!T?T:function(L,j){return j.replace(/{([^{}]+)}/g,function($,q){return q in L?String(L[q]):""})}(m.properties,T)},u.prototype.createBucket=function(f){return new Sn(f)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var f=0,m=Wn.paint.overridableProperties;f<m.length;f+=1){var x=m[f];if(u.hasPaintOverride(this.layout,x)){var E,T=this.paint.get(x),M=new oi(T),L=new Wl(M,T.property.specification);E=T.value.kind==="constant"||T.value.kind==="source"?new yc("source",L):new Gl("composite",L,T.value.zoomStops,T.value._interpolationType),this.paint._values[x]=new Ao(T.property,E,T.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(f,m,x){return!(!this.layout||m.isDataDriven()||x.isDataDriven())&&u.hasPaintOverride(this.layout,f)},u.hasPaintOverride=function(f,m){var x=f.get("text-field"),E=Wn.paint.properties[m],T=!1,M=function($){for(var q=0,le=$;q<le.length;q+=1)if(E.overrides&&E.overrides.hasOverride(le[q]))return void(T=!0)};if(x.value.kind==="constant"&&x.value.value instanceof fa)M(x.value.value.sections);else if(x.value.kind==="source"){var L=function($){T||($ instanceof li&&_a($.value)===Fi?M($.value.sections):$ instanceof $o?M($.sections):$.eachChild(L))},j=x.value;j._styleExpression&&L(j._styleExpression.expression)}return T},u}(Qs),xa={paint:new Ma({"background-color":new Ln(he.paint_background["background-color"]),"background-pattern":new Ko(he.paint_background["background-pattern"]),"background-opacity":new Ln(he.paint_background["background-opacity"])})},eu=function(o){function u(f){o.call(this,f,xa)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Qs),of={paint:new Ma({"raster-opacity":new Ln(he.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ln(he.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ln(he.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ln(he.paint_raster["raster-brightness-max"]),"raster-saturation":new Ln(he.paint_raster["raster-saturation"]),"raster-contrast":new Ln(he.paint_raster["raster-contrast"]),"raster-resampling":new Ln(he.paint_raster["raster-resampling"]),"raster-fade-duration":new Ln(he.paint_raster["raster-fade-duration"])})},$u=function(o){function u(f){o.call(this,f,of)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Qs),Ah=function(o){function u(f){o.call(this,f,{}),this.implementation=f}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(f){this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},u.prototype.onRemove=function(f){this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},u}(Qs),gl={circle:gh,heatmap:pl,hillshade:l0,fill:ap,"fill-extrusion":Xp,line:Hf,symbol:Ji,background:eu,raster:$u},Th=ie.HTMLImageElement,Gv=ie.HTMLCanvasElement,f0=ie.HTMLVideoElement,h0=ie.ImageData,Hd=ie.ImageBitmap,wh=function(o,u,f,m){this.context=o,this.format=f,this.texture=o.gl.createTexture(),this.update(u,m)};wh.prototype.update=function(o,u,f){var m=o.width,x=o.height,E=!(this.size&&this.size[0]===m&&this.size[1]===x||f),T=this.context,M=T.gl;if(this.useMipmap=Boolean(u&&u.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!u||u.premultiply!==!1)),E)this.size=[m,x],o instanceof Th||o instanceof Gv||o instanceof f0||o instanceof h0||Hd&&o instanceof Hd?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,o):M.texImage2D(M.TEXTURE_2D,0,this.format,m,x,0,this.format,M.UNSIGNED_BYTE,o.data);else{var L=f||{x:0,y:0},j=L.x,$=L.y;o instanceof Th||o instanceof Gv||o instanceof f0||o instanceof h0||Hd&&o instanceof Hd?M.texSubImage2D(M.TEXTURE_2D,0,j,$,M.RGBA,M.UNSIGNED_BYTE,o):M.texSubImage2D(M.TEXTURE_2D,0,j,$,m,x,M.RGBA,M.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},wh.prototype.bind=function(o,u,f){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),f!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=m.LINEAR),o!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,f||o),this.filter=o),u!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrap=u)},wh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},wh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Xv=function(o){var u=this;this._callback=o,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};Xv.prototype.trigger=function(){var o=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){o._triggered=!1,o._callback()},0))},Xv.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ch=function(o,u,f){this.target=o,this.parent=u,this.mapId=f,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Zr(["receive","process"],this),this.invoker=new Xv(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=te()?o:ie};function p0(o,u,f){var m=2*Math.PI*6378137/256/Math.pow(2,f);return[o*m-2*Math.PI*6378137/2,u*m-2*Math.PI*6378137/2]}Ch.prototype.send=function(o,u,f,m,x){var E=this;x===void 0&&(x=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(this.callbacks[T]=f);var M=ke(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:o,hasCallback:!!f,targetMapId:m,mustQueue:x,sourceMapId:this.mapId,data:Yo(u,M)},M),{cancel:function(){f&&delete E.callbacks[T],E.target.postMessage({id:T,type:"<cancel>",targetMapId:m,sourceMapId:E.mapId})}}},Ch.prototype.receive=function(o){var u=o.data,f=u.id;if(f&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[f];var m=this.cancelCallbacks[f];delete this.cancelCallbacks[f],m&&m()}else te()||u.mustQueue?(this.tasks[f]=u,this.taskQueue.push(f),this.invoker.trigger()):this.processTask(f,u)},Ch.prototype.process=function(){if(this.taskQueue.length){var o=this.taskQueue.shift(),u=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(o,u)}},Ch.prototype.processTask=function(o,u){var f=this;if(u.type==="<response>"){var m=this.callbacks[o];delete this.callbacks[o],m&&(u.error?m(ca(u.error)):m(null,ca(u.data)))}else{var x=!1,E=ke(this.globalScope)?void 0:[],T=u.hasCallback?function($,q){x=!0,delete f.cancelCallbacks[o],f.target.postMessage({id:o,type:"<response>",sourceMapId:f.mapId,error:$?Yo($):null,data:Yo(q,E)},E)}:function($){x=!0},M=null,L=ca(u.data);if(this.parent[u.type])M=this.parent[u.type](u.sourceMapId,L,T);else if(this.parent.getWorkerSource){var j=u.type.split(".");M=this.parent.getWorkerSource(u.sourceMapId,j[0],L.source)[j[1]](L,T)}else T(new Error("Could not find function "+u.type));!x&&M&&M.cancel&&(this.cancelCallbacks[o]=M.cancel)}},Ch.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Fo=function(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))};Fo.prototype.setNorthEast=function(o){return this._ne=o instanceof Ia?new Ia(o.lng,o.lat):Ia.convert(o),this},Fo.prototype.setSouthWest=function(o){return this._sw=o instanceof Ia?new Ia(o.lng,o.lat):Ia.convert(o),this},Fo.prototype.extend=function(o){var u,f,m=this._sw,x=this._ne;if(o instanceof Ia)u=o,f=o;else{if(!(o instanceof Fo))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Fo.convert(o)):this.extend(Ia.convert(o)):this;if(f=o._ne,!(u=o._sw)||!f)return this}return m||x?(m.lng=Math.min(u.lng,m.lng),m.lat=Math.min(u.lat,m.lat),x.lng=Math.max(f.lng,x.lng),x.lat=Math.max(f.lat,x.lat)):(this._sw=new Ia(u.lng,u.lat),this._ne=new Ia(f.lng,f.lat)),this},Fo.prototype.getCenter=function(){return new Ia((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Fo.prototype.getSouthWest=function(){return this._sw},Fo.prototype.getNorthEast=function(){return this._ne},Fo.prototype.getNorthWest=function(){return new Ia(this.getWest(),this.getNorth())},Fo.prototype.getSouthEast=function(){return new Ia(this.getEast(),this.getSouth())},Fo.prototype.getWest=function(){return this._sw.lng},Fo.prototype.getSouth=function(){return this._sw.lat},Fo.prototype.getEast=function(){return this._ne.lng},Fo.prototype.getNorth=function(){return this._ne.lat},Fo.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Fo.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Fo.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Fo.prototype.contains=function(o){var u=Ia.convert(o),f=u.lng,m=u.lat,x=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&x},Fo.convert=function(o){return!o||o instanceof Fo?o:new Fo(o)};var Ia=function(o,u){if(isNaN(o)||isNaN(u))throw new Error("Invalid LngLat object: ("+o+", "+u+")");if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ia.prototype.wrap=function(){return new Ia(Tt(this.lng,-180,180),this.lat)},Ia.prototype.toArray=function(){return[this.lng,this.lat]},Ia.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ia.prototype.distanceTo=function(o){var u=Math.PI/180,f=this.lat*u,m=o.lat*u,x=Math.sin(f)*Math.sin(m)+Math.cos(f)*Math.cos(m)*Math.cos((o.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(x,1))},Ia.prototype.toBounds=function(o){o===void 0&&(o=0);var u=360*o/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new Fo(new Ia(this.lng-f,this.lat-u),new Ia(this.lng+f,this.lat+u))},Ia.convert=function(o){if(o instanceof Ia)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Ia(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Ia(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var d0=2*Math.PI*63710088e-1;function v0(o){return d0*Math.cos(o*Math.PI/180)}function m0(o){return(180+o)/360}function g0(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function _0(o,u){return o/v0(u)}function Wd(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}var Wf=function(o,u,f){f===void 0&&(f=0),this.x=+o,this.y=+u,this.z=+f};Wf.fromLngLat=function(o,u){u===void 0&&(u=0);var f=Ia.convert(o);return new Wf(m0(f.lng),g0(f.lat),_0(u,f.lat))},Wf.prototype.toLngLat=function(){return new Ia(360*this.x-180,Wd(this.y))},Wf.prototype.toAltitude=function(){return this.z*v0(Wd(this.y))},Wf.prototype.meterInMercatorCoordinateUnits=function(){return 1/d0*(o=Wd(this.y),1/Math.cos(o*Math.PI/180));var o};var Rh=function(o,u,f){this.z=o,this.x=u,this.y=f,this.key=Qp(0,o,o,u,f)};Rh.prototype.equals=function(o){return this.z===o.z&&this.x===o.x&&this.y===o.y},Rh.prototype.url=function(o,u){var f,m,x,E,T,M=(m=this.y,x=this.z,E=p0(256*(f=this.x),256*(m=Math.pow(2,x)-m-1),x),T=p0(256*(f+1),256*(m+1),x),E[0]+","+E[1]+","+T[0]+","+T[1]),L=function(j,$,q){for(var le,me="",ze=j;ze>0;ze--)me+=($&(le=1<<ze-1)?1:0)+(q&le?2:0);return me}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",L).replace("{bbox-epsg-3857}",M)},Rh.prototype.getTilePoint=function(o){var u=Math.pow(2,this.z);return new ae(8192*(o.x*u-this.x),8192*(o.y*u-this.y))},Rh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var y0=function(o,u){this.wrap=o,this.canonical=u,this.key=Qp(o,u.z,u.z,u.x,u.y)},ko=function(o,u,f,m,x){this.overscaledZ=o,this.wrap=u,this.canonical=new Rh(f,+m,+x),this.key=Qp(u,o,f,m,x)};function Qp(o,u,f,m,x){(o*=2)<0&&(o=-1*o-1);var E=1<<f;return(E*E*o+E*x+m).toString(36)+f.toString(36)+u.toString(36)}ko.prototype.equals=function(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)},ko.prototype.scaledTo=function(o){var u=this.canonical.z-o;return o>this.canonical.z?new ko(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ko(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)},ko.prototype.calculateScaledKey=function(o,u){var f=this.canonical.z-o;return o>this.canonical.z?Qp(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y):Qp(this.wrap*+u,o,o,this.canonical.x>>f,this.canonical.y>>f)},ko.prototype.isChildOf=function(o){if(o.wrap!==this.wrap)return!1;var u=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u},ko.prototype.children=function(o){if(this.overscaledZ>=o)return[new ko(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,f=2*this.canonical.x,m=2*this.canonical.y;return[new ko(u,this.wrap,u,f,m),new ko(u,this.wrap,u,f+1,m),new ko(u,this.wrap,u,f,m+1),new ko(u,this.wrap,u,f+1,m+1)]},ko.prototype.isLessThan=function(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))},ko.prototype.wrapped=function(){return new ko(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ko.prototype.unwrapTo=function(o){return new ko(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)},ko.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ko.prototype.toUnwrapped=function(){return new y0(this.wrap,this.canonical)},ko.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ko.prototype.getTilePoint=function(o){return this.canonical.getTilePoint(new Wf(o.x-this.wrap,o.y))},bn("CanonicalTileID",Rh),bn("OverscaledTileID",ko,{omit:["posMatrix"]});var sf=function(o,u,f){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return pt('"'+f+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var m=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=f||"mapbox";for(var x=0;x<m;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(m,x)]=this.data[this._idx(m-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,m)]=this.data[this._idx(x,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};sf.prototype.get=function(o,u){var f=new Uint8Array(this.data.buffer),m=4*this._idx(o,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[m],f[m+1],f[m+2])},sf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},sf.prototype._idx=function(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)},sf.prototype._unpackMapbox=function(o,u,f){return(256*o*256+256*u+f)/10-1e4},sf.prototype._unpackTerrarium=function(o,u,f){return 256*o+u+f/256-32768},sf.prototype.getPixels=function(){return new Io({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},sf.prototype.backfillBorder=function(o,u,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");var m=u*this.dim,x=u*this.dim+this.dim,E=f*this.dim,T=f*this.dim+this.dim;switch(u){case-1:m=x-1;break;case 1:x=m+1}switch(f){case-1:E=T-1;break;case 1:T=E+1}for(var M=-u*this.dim,L=-f*this.dim,j=E;j<T;j++)for(var $=m;$<x;$++)this.data[this._idx($,j)]=o.data[this._idx($+M,j+L)]},bn("DEMData",sf);var Gd=function(o){this._stringToNumber={},this._numberToString=[];for(var u=0;u<o.length;u++){var f=o[u];this._stringToNumber[f]=u,this._numberToString[u]=f}};Gd.prototype.encode=function(o){return this._stringToNumber[o]},Gd.prototype.decode=function(o){return this._numberToString[o]};var Xd=function(o,u,f,m,x){this.type="Feature",this._vectorTileFeature=o,o._z=u,o._x=f,o._y=m,this.properties=o.properties,this.id=x},$v={geometry:{configurable:!0}};$v.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},$v.geometry.set=function(o){this._geometry=o},Xd.prototype.toJSON=function(){var o={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(o[u]=this[u]);return o},Object.defineProperties(Xd.prototype,$v);var lp=function(){this.state={},this.stateChanges={},this.deletedStates={}};lp.prototype.updateState=function(o,u,f){var m=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},Xt(this.stateChanges[o][m],f),this.deletedStates[o]===null)for(var x in this.deletedStates[o]={},this.state[o])x!==m&&(this.deletedStates[o][x]=null);else if(this.deletedStates[o]&&this.deletedStates[o][m]===null)for(var E in this.deletedStates[o][m]={},this.state[o][m])f[E]||(this.deletedStates[o][m][E]=null);else for(var T in f)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][T]===null&&delete this.deletedStates[o][m][T]},lp.prototype.removeFeatureState=function(o,u,f){if(this.deletedStates[o]!==null){var m=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},f&&u!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][f]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(f in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][f]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}},lp.prototype.getState=function(o,u){var f=String(u),m=Xt({},(this.state[o]||{})[f],(this.stateChanges[o]||{})[f]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){var x=this.deletedStates[o][u];if(x===null)return{};for(var E in x)delete m[E]}return m},lp.prototype.initializeTileState=function(o,u){o.setFeatureState(this.state,u)},lp.prototype.coalesceChanges=function(o,u){var f={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var x={};for(var E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),Xt(this.state[m][E],this.stateChanges[m][E]),x[E]=this.state[m][E];f[m]=x}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var M={};if(this.deletedStates[T]===null)for(var L in this.state[T])M[L]={},this.state[T][L]={};else for(var j in this.deletedStates[T]){if(this.deletedStates[T][j]===null)this.state[T][j]={};else for(var $=0,q=Object.keys(this.deletedStates[T][j]);$<q.length;$+=1)delete this.state[T][j][q[$]];M[j]=this.state[T][j]}f[T]=f[T]||{},Xt(f[T],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(var le in o)o[le].setFeatureState(f,u)};var uf=function(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new So(8192,16,0),this.grid3D=new So(8192,16,0),this.featureIndexArray=new J,this.promoteId=u};function Yv(o,u,f,m,x){return dr(o,function(E,T){var M=u instanceof ls?u.get(T):null;return M&&M.evaluate?M.evaluate(f,m,x):M})}function x0(o){for(var u=1/0,f=1/0,m=-1/0,x=-1/0,E=0,T=o;E<T.length;E+=1){var M=T[E];u=Math.min(u,M.x),f=Math.min(f,M.y),m=Math.max(m,M.x),x=Math.max(x,M.y)}return{minX:u,minY:f,maxX:m,maxY:x}}function Bg(o,u){return u-o}uf.prototype.insert=function(o,u,f,m,x,E){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,m,x);for(var M=E?this.grid3D:this.grid,L=0;L<u.length;L++){for(var j=u[L],$=[1/0,1/0,-1/0,-1/0],q=0;q<j.length;q++){var le=j[q];$[0]=Math.min($[0],le.x),$[1]=Math.min($[1],le.y),$[2]=Math.max($[2],le.x),$[3]=Math.max($[3],le.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&M.insert(T,$[0],$[1],$[2],$[3])}},uf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new ic.VectorTile(new Qt(this.rawTileData)).layers,this.sourceLayerCoder=new Gd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},uf.prototype.query=function(o,u,f,m){var x=this;this.loadVTLayers();for(var E=o.params||{},T=8192/o.tileSize/o.scale,M=ol(E.filter),L=o.queryGeometry,j=o.queryPadding*T,$=x0(L),q=this.grid.query($.minX-j,$.minY-j,$.maxX+j,$.maxY+j),le=x0(o.cameraQueryGeometry),me=this.grid3D.query(le.minX-j,le.minY-j,le.maxX+j,le.maxY+j,function(qt,jt,mr,Vr){return function(Jr,Fn,gn,Hn,_n){for(var Ai=0,qr=Jr;Ai<qr.length;Ai+=1){var Cr=qr[Ai];if(Fn<=Cr.x&&gn<=Cr.y&&Hn>=Cr.x&&_n>=Cr.y)return!0}var Pi=[new ae(Fn,gn),new ae(Fn,_n),new ae(Hn,_n),new ae(Hn,gn)];if(Jr.length>2){for(var yi=0,Gi=Pi;yi<Gi.length;yi+=1)if(fu(Jr,Gi[yi]))return!0}for(var Xn=0;Xn<Jr.length-1;Xn++)if(hl(Jr[Xn],Jr[Xn+1],Pi))return!0;return!1}(o.cameraQueryGeometry,qt-j,jt-j,mr+j,Vr+j)}),ze=0,He=me;ze<He.length;ze+=1)q.push(He[ze]);q.sort(Bg);for(var st,et={},bt=function(qt){var jt=q[qt];if(jt!==st){st=jt;var mr=x.featureIndexArray.get(jt),Vr=null;x.loadMatchingFeature(et,mr.bucketIndex,mr.sourceLayerIndex,mr.featureIndex,M,E.layers,E.availableImages,u,f,m,function(Jr,Fn,gn){return Vr||(Vr=Na(Jr)),Fn.queryIntersectsFeature(L,Jr,gn,Vr,x.z,o.transform,T,o.pixelPosMatrix)})}},Lt=0;Lt<q.length;Lt++)bt(Lt);return et},uf.prototype.loadMatchingFeature=function(o,u,f,m,x,E,T,M,L,j,$){var q=this.bucketLayerIDs[u];if(!E||function(Jr,Fn){for(var gn=0;gn<Jr.length;gn++)if(Fn.indexOf(Jr[gn])>=0)return!0;return!1}(E,q)){var le=this.sourceLayerCoder.decode(f),me=this.vtLayers[le].feature(m);if(x.needGeometry){var ze=Ya(me,!0);if(!x.filter(new we(this.tileID.overscaledZ),ze,this.tileID.canonical))return}else if(!x.filter(new we(this.tileID.overscaledZ),me))return;for(var He=this.getId(me,le),st=0;st<q.length;st++){var et=q[st];if(!(E&&E.indexOf(et)<0)){var bt=M[et];if(bt){var Lt={};He!==void 0&&j&&(Lt=j.getState(bt.sourceLayer||"_geojsonTileLayer",He));var qt=Xt({},L[et]);qt.paint=Yv(qt.paint,bt.paint,me,Lt,T),qt.layout=Yv(qt.layout,bt.layout,me,Lt,T);var jt=!$||$(me,bt,Lt);if(jt){var mr=new Xd(me,this.z,this.x,this.y,He);mr.layer=qt;var Vr=o[et];Vr===void 0&&(Vr=o[et]=[]),Vr.push({featureIndex:m,feature:mr,intersectionZ:jt})}}}}}},uf.prototype.lookupSymbolFeatures=function(o,u,f,m,x,E,T,M){var L={};this.loadVTLayers();for(var j=ol(x),$=0,q=o;$<q.length;$+=1)this.loadMatchingFeature(L,f,m,q[$],j,E,T,M,u);return L},uf.prototype.hasLayer=function(o){for(var u=0,f=this.bucketLayerIDs;u<f.length;u+=1)for(var m=0,x=f[u];m<x.length;m+=1)if(o===x[m])return!0;return!1},uf.prototype.getId=function(o,u){var f=o.id;return this.promoteId&&typeof(f=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(f=Number(f)),f},bn("FeatureIndex",uf,{omit:["rawTileData","sourceLayerCoder"]});var ts=function(o,u){this.tileID=o,this.uid=Ft(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ts.prototype.registerFadeDuration=function(o){var u=o+this.timeAdded;u<Dn.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},ts.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ts.prototype.loadVectorData=function(o,u,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){for(var m in o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(j,$){var q={};if(!$)return q;for(var le=function(){var He=ze[me],st=He.layerIds.map(function(Lt){return $.getLayer(Lt)}).filter(Boolean);if(st.length!==0){He.layers=st,He.stateDependentLayerIds&&(He.stateDependentLayers=He.stateDependentLayerIds.map(function(Lt){return st.filter(function(qt){return qt.id===Lt})[0]}));for(var et=0,bt=st;et<bt.length;et+=1)q[bt[et].id]=He}},me=0,ze=j;me<ze.length;me+=1)le();return q}(o.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var x=this.buckets[m];if(x instanceof Sn){if(this.hasSymbolBuckets=!0,!f)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var T=this.buckets[E];if(T instanceof Sn&&T.hasRTLText){this.hasRTLText=!0,Nt.isLoading()||Nt.isLoaded()||ef()!=="deferred"||ks();break}}for(var M in this.queryPadding=0,this.buckets){var L=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(M).queryRadius(L))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new v},ts.prototype.unloadVectorData=function(){for(var o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ts.prototype.getBucket=function(o){return this.buckets[o.id]},ts.prototype.upload=function(o){for(var u in this.buckets){var f=this.buckets[u];f.uploadPending()&&f.upload(o)}var m=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new wh(o,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new wh(o,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},ts.prototype.prepare=function(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)},ts.prototype.queryRenderedFeatures=function(o,u,f,m,x,E,T,M,L,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:j,transform:M,params:T,queryPadding:this.queryPadding*L},o,u,f):{}},ts.prototype.querySourceFeatures=function(o,u){var f=this.latestFeatureIndex;if(f&&f.rawTileData){var m=f.loadVTLayers(),x=u?u.sourceLayer:"",E=m._geojsonTileLayer||m[x];if(E)for(var T=ol(u&&u.filter),M=this.tileID.canonical,L=M.z,j=M.x,$=M.y,q={z:L,x:j,y:$},le=0;le<E.length;le++){var me=E.feature(le);if(T.needGeometry){var ze=Ya(me,!0);if(!T.filter(new we(this.tileID.overscaledZ),ze,this.tileID.canonical))continue}else if(!T.filter(new we(this.tileID.overscaledZ),me))continue;var He=f.getId(me,x),st=new Xd(me,L,j,$,He);st.tile=q,o.push(st)}}},ts.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ts.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ts.prototype.setExpiryData=function(o){var u=this.expirationTime;if(o.cacheControl){var f=Ne(o.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){var m=Date.now(),x=!1;if(this.expirationTime>m)x=!1;else if(u)if(this.expirationTime<u)x=!0;else{var E=this.expirationTime-u;E?this.expirationTime=m+Math.max(E,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ts.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ts.prototype.setFeatureState=function(o,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(o).length!==0){var f=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(u.style.hasLayer(m)){var x=this.buckets[m],E=x.layers[0].sourceLayer||"_geojsonTileLayer",T=f[E],M=o[E];if(T&&M&&Object.keys(M).length!==0){x.update(M,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var L=u&&u.style&&u.style.getLayer(m);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(x)))}}}},ts.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ts.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Dn.now()},ts.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ts.prototype.setHoldDuration=function(o){this.symbolFadeHoldUntil=Dn.now()+o},ts.prototype.setDependencies=function(o,u){for(var f={},m=0,x=u;m<x.length;m+=1)f[x[m]]=!0;this.dependencies[o]=f},ts.prototype.hasDependency=function(o,u){for(var f=0,m=o;f<m.length;f+=1){var x=this.dependencies[m[f]];if(x){for(var E=0,T=u;E<T.length;E+=1)if(x[T[E]])return!0}}return!1};var Bc=ie.performance,b0=function(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},Bc.mark(this._marks.start)};b0.prototype.finish=function(){Bc.mark(this._marks.end);var o=Bc.getEntriesByName(this._marks.measure);return o.length===0&&(Bc.measure(this._marks.measure,this._marks.start,this._marks.end),o=Bc.getEntriesByName(this._marks.measure),Bc.clearMarks(this._marks.start),Bc.clearMarks(this._marks.end),Bc.clearMeasures(this._marks.measure)),o},y.Actor=Ch,y.AlphaImage=Js,y.CanonicalTileID=Rh,y.CollisionBoxArray=v,y.Color=Ei,y.DEMData=sf,y.DataConstantProperty=Ln,y.DictionaryCoder=Gd,y.EXTENT=8192,y.ErrorEvent=Ue,y.EvaluationParameters=we,y.Event=Se,y.Evented=Je,y.FeatureIndex=uf,y.FillBucket=vl,y.FillExtrusionBucket=ds,y.ImageAtlas=_r,y.ImagePosition=rn,y.LineBucket=As,y.LngLat=Ia,y.LngLatBounds=Fo,y.MercatorCoordinate=Wf,y.ONE_EM=24,y.OverscaledTileID=ko,y.Point=ae,y.Point$1=ae,y.Properties=Ma,y.Protobuf=Qt,y.RGBAImage=Io,y.RequestManager=hi,y.RequestPerformance=b0,y.ResourceType=z,y.SegmentVector=be,y.SourceFeatureState=lp,y.StructArrayLayout1ui2=Ff,y.StructArrayLayout2f1f2i16=Jl,y.StructArrayLayout2i4=Dl,y.StructArrayLayout3ui6=Qo,y.StructArrayLayout4i8=Df,y.SymbolBucket=Sn,y.Texture=wh,y.Tile=ts,y.Transitionable=xe,y.Uniform1f=Hr,y.Uniform1i=yr,y.Uniform2f=Nr,y.Uniform3f=dn,y.Uniform4f=Nn,y.UniformColor=Bn,y.UniformMatrix4f=Ni,y.UnwrappedTileID=y0,y.ValidationError=K,y.WritingMode=Jt,y.ZoomHistory=Pf,y.add=function(o,u,f){return o[0]=u[0]+f[0],o[1]=u[1]+f[1],o[2]=u[2]+f[2],o},y.addDynamicAttributes=wr,y.asyncAll=function(o,u,f){if(!o.length)return f(null,[]);var m=o.length,x=new Array(o.length),E=null;o.forEach(function(T,M){u(T,function(L,j){L&&(E=L),x[M]=j,--m==0&&f(E,x)})})},y.bezier=rt,y.bindAll=Zr,y.browser=Dn,y.cacheEntryPossiblyAdded=function(o){++fe>Gr&&(o.getActor().send("enforceCacheSizeLimit",gr),fe=0)},y.clamp=Ct,y.clearTileCache=function(o){var u=ie.caches.delete("mapbox-tiles");o&&u.catch(o).then(function(){return o()})},y.clipLine=ml,y.clone=function(o){var u=new Li(16);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},y.clone$1=lt,y.clone$2=function(o){var u=new Li(3);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u},y.collisionCircleLayout=W,y.config=hn,y.create=function(){var o=new Li(16);return Li!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},y.create$1=function(){var o=new Li(9);return Li!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o},y.create$2=function(){var o=new Li(4);return Li!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},y.createCommonjsModule=de,y.createExpression=Xc,y.createLayout=co,y.createStyleLayer=function(o){return o.type==="custom"?new Ah(o):new gl[o.type](o)},y.cross=function(o,u,f){var m=u[0],x=u[1],E=u[2],T=f[0],M=f[1],L=f[2];return o[0]=x*L-E*M,o[1]=E*T-m*L,o[2]=m*M-x*T,o},y.deepEqual=function o(u,f){if(Array.isArray(u)){if(!Array.isArray(f)||u.length!==f.length)return!1;for(var m=0;m<u.length;m++)if(!o(u[m],f[m]))return!1;return!0}if(typeof u=="object"&&u!==null&&f!==null){if(typeof f!="object"||Object.keys(u).length!==Object.keys(f).length)return!1;for(var x in u)if(!o(u[x],f[x]))return!1;return!0}return u===f},y.dot=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]},y.dot$1=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]+o[3]*u[3]},y.ease=it,y.emitValidationErrors=ql,y.endsWith=Tr,y.enforceCacheSizeLimit=function(o){an(),Wa&&Wa.then(function(u){u.keys().then(function(f){for(var m=0;m<f.length-o;m++)u.delete(f[m])})})},y.evaluateSizeForFeature=vs,y.evaluateSizeForZoom=mo,y.evaluateVariableOffset=vt,y.evented=Tc,y.extend=Xt,y.featureFilter=ol,y.filterObject=Mt,y.fromRotation=function(o,u){var f=Math.sin(u),m=Math.cos(u);return o[0]=m,o[1]=f,o[2]=0,o[3]=-f,o[4]=m,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},y.getAnchorAlignment=ya,y.getAnchorJustification=yt,y.getArrayBuffer=At,y.getImage=F,y.getJSON=function(o,u){return St(Xt(o,{type:"json"}),u)},y.getRTLTextPluginStatus=ef,y.getReferrer=Ae,y.getVideo=function(o,u){var f,m,x=ie.document.createElement("video");x.muted=!0,x.onloadstart=function(){u(null,x)};for(var E=0;E<o.length;E++){var T=ie.document.createElement("source");f=o[E],m=void 0,(m=ie.document.createElement("a")).href=f,(m.protocol!==ie.document.location.protocol||m.host!==ie.document.location.host)&&(x.crossOrigin="Anonymous"),T.src=o[E],x.appendChild(T)}return{cancel:function(){}}},y.identity=Go,y.invert=function(o,u){var f=u[0],m=u[1],x=u[2],E=u[3],T=u[4],M=u[5],L=u[6],j=u[7],$=u[8],q=u[9],le=u[10],me=u[11],ze=u[12],He=u[13],st=u[14],et=u[15],bt=f*M-m*T,Lt=f*L-x*T,qt=f*j-E*T,jt=m*L-x*M,mr=m*j-E*M,Vr=x*j-E*L,Jr=$*He-q*ze,Fn=$*st-le*ze,gn=$*et-me*ze,Hn=q*st-le*He,_n=q*et-me*He,Ai=le*et-me*st,qr=bt*Ai-Lt*_n+qt*Hn+jt*gn-mr*Fn+Vr*Jr;return qr?(o[0]=(M*Ai-L*_n+j*Hn)*(qr=1/qr),o[1]=(x*_n-m*Ai-E*Hn)*qr,o[2]=(He*Vr-st*mr+et*jt)*qr,o[3]=(le*mr-q*Vr-me*jt)*qr,o[4]=(L*gn-T*Ai-j*Fn)*qr,o[5]=(f*Ai-x*gn+E*Fn)*qr,o[6]=(st*qt-ze*Vr-et*Lt)*qr,o[7]=($*Vr-le*qt+me*Lt)*qr,o[8]=(T*_n-M*gn+j*Jr)*qr,o[9]=(m*gn-f*_n-E*Jr)*qr,o[10]=(ze*mr-He*qt+et*bt)*qr,o[11]=(q*qt-$*mr-me*bt)*qr,o[12]=(M*Fn-T*Hn-L*Jr)*qr,o[13]=(f*Hn-m*Fn+x*Jr)*qr,o[14]=(He*Lt-ze*jt-st*bt)*qr,o[15]=($*jt-q*Lt+le*bt)*qr,o):null},y.isChar=sn,y.isMapboxURL=ea,y.keysDifference=function(o,u){var f=[];for(var m in o)m in u||f.push(m);return f},y.makeRequest=St,y.mapObject=dr,y.mercatorXfromLng=m0,y.mercatorYfromLat=g0,y.mercatorZfromAltitude=_0,y.mul=Rc,y.multiply=no,y.mvt=ic,y.nextPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},y.normalize=function(o,u){var f=u[0],m=u[1],x=u[2],E=f*f+m*m+x*x;return E>0&&(E=1/Math.sqrt(E)),o[0]=u[0]*E,o[1]=u[1]*E,o[2]=u[2]*E,o},y.number=Ga,y.offscreenCanvasSupported=D,y.ortho=function(o,u,f,m,x,E,T){var M=1/(u-f),L=1/(m-x),j=1/(E-T);return o[0]=-2*M,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*L,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*j,o[11]=0,o[12]=(u+f)*M,o[13]=(x+m)*L,o[14]=(T+E)*j,o[15]=1,o},y.parseGlyphPBF=function(o){return new Qt(o).readFields(br,[])},y.pbf=Qt,y.performSymbolLayout=function(o,u,f,m,x,E,T){o.createArrays(),o.tilePixelRatio=8192/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;var M=o.layers[0].layout,L=o.layers[0]._unevaluatedLayout._values,j={};if(o.textSizeData.kind==="composite"){var $=o.textSizeData,q=$.maxZoom;j.compositeTextSizes=[L["text-size"].possiblyEvaluate(new we($.minZoom),T),L["text-size"].possiblyEvaluate(new we(q),T)]}if(o.iconSizeData.kind==="composite"){var le=o.iconSizeData,me=le.maxZoom;j.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new we(le.minZoom),T),L["icon-size"].possiblyEvaluate(new we(me),T)]}j.layoutTextSize=L["text-size"].possiblyEvaluate(new we(o.zoom+1),T),j.layoutIconSize=L["icon-size"].possiblyEvaluate(new we(o.zoom+1),T),j.textMaxSize=L["text-size"].possiblyEvaluate(new we(18));for(var ze=24*M.get("text-line-height"),He=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",st=M.get("text-keep-upright"),et=M.get("text-size"),bt=function(){var jt=qt[Lt],mr=M.get("text-font").evaluate(jt,{},T).join(","),Vr=et.evaluate(jt,{},T),Jr=j.layoutTextSize.evaluate(jt,{},T),Fn=j.layoutIconSize.evaluate(jt,{},T),gn={horizontal:{},vertical:void 0},Hn=jt.text,_n=[0,0];if(Hn){var Ai=Hn.toString(),qr=24*M.get("text-letter-spacing").evaluate(jt,{},T),Cr=function(Ui){for(var Aa=0,da=Ui;Aa<da.length;Aa+=1)if(Yi=da[Aa].charCodeAt(0),sn.Arabic(Yi)||sn["Arabic Supplement"](Yi)||sn["Arabic Extended-A"](Yi)||sn["Arabic Presentation Forms-A"](Yi)||sn["Arabic Presentation Forms-B"](Yi))return!1;var Yi;return!0}(Ai)?qr:0,Pi=M.get("text-anchor").evaluate(jt,{},T),yi=M.get("text-variable-anchor");if(!yi){var Gi=M.get("text-radial-offset").evaluate(jt,{},T);_n=Gi?vt(Pi,[24*Gi,ot]):M.get("text-offset").evaluate(jt,{},T).map(function(Ui){return 24*Ui})}var Xn=He?"center":M.get("text-justify").evaluate(jt,{},T),ra=M.get("symbol-placement"),Ka=ra==="point"?24*M.get("text-max-width").evaluate(jt,{},T):0,_o=function(){o.allowVerticalPlacement&&ul(Ai)&&(gn.vertical=xi(Hn,u,f,x,mr,Ka,ze,Pi,"left",Cr,_n,Jt.vertical,!0,ra,Jr,Vr))};if(!He&&yi){for(var uo=Xn==="auto"?yi.map(function(Ui){return yt(Ui)}):[Xn],Qa=!1,yo=0;yo<uo.length;yo++){var rs=uo[yo];if(!gn.horizontal[rs])if(Qa)gn.horizontal[rs]=gn.horizontal[0];else{var ns=xi(Hn,u,f,x,mr,Ka,ze,"center",rs,Cr,_n,Jt.horizontal,!1,ra,Jr,Vr);ns&&(gn.horizontal[rs]=ns,Qa=ns.positionedLines.length===1)}}_o()}else{Xn==="auto"&&(Xn=yt(Pi));var tu=xi(Hn,u,f,x,mr,Ka,ze,Pi,Xn,Cr,_n,Jt.horizontal,!1,ra,Jr,Vr);tu&&(gn.horizontal[Xn]=tu),_o(),ul(Ai)&&He&&st&&(gn.vertical=xi(Hn,u,f,x,mr,Ka,ze,Pi,Xn,Cr,_n,Jt.vertical,!1,ra,Jr,Vr))}}var ms=void 0,Us=!1;if(jt.icon&&jt.icon.name){var Do=m[jt.icon.name];Do&&(ms=function(Ui,Aa,da){var Yi=ya(da),vu=Aa[0]-Ui.displaySize[0]*Yi.horizontalAlign,zs=Aa[1]-Ui.displaySize[1]*Yi.verticalAlign;return{image:Ui,top:zs,bottom:zs+Ui.displaySize[1],left:vu,right:vu+Ui.displaySize[0]}}(x[jt.icon.name],M.get("icon-offset").evaluate(jt,{},T),M.get("icon-anchor").evaluate(jt,{},T)),Us=Do.sdf,o.sdfIcons===void 0?o.sdfIcons=Do.sdf:o.sdfIcons!==Do.sdf&&pt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Do.pixelRatio!==o.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}var gs=ut(gn.horizontal)||gn.vertical;o.iconsInText=!!gs&&gs.iconsInText,(gs||ms)&&function(Ui,Aa,da,Yi,vu,zs,za,No,Zs,na,Fl){var _l=zs.textMaxSize.evaluate(Aa,{});_l===void 0&&(_l=za);var lf,Lo=Ui.layers[0].layout,cf=Lo.get("icon-offset").evaluate(Aa,{},Fl),ac=ut(da.horizontal),Jp=za/24,cp=Ui.tilePixelRatio*Jp,ed=Ui.tilePixelRatio*_l/24,Gf=Ui.tilePixelRatio*No,td=Ui.tilePixelRatio*Lo.get("symbol-spacing"),qv=Lo.get("text-padding")*Ui.tilePixelRatio,rd=Lo.get("icon-padding")*Ui.tilePixelRatio,$d=Lo.get("text-max-angle")/180*Math.PI,fp=Lo.get("text-rotation-alignment")==="map"&&Lo.get("symbol-placement")!=="point",Yd=Lo.get("icon-rotation-alignment")==="map"&&Lo.get("symbol-placement")!=="point",Fc=Lo.get("symbol-placement"),hp=td/2,oc=Lo.get("icon-text-fit");Yi&&oc!=="none"&&(Ui.allowVerticalPlacement&&da.vertical&&(lf=vo(Yi,da.vertical,oc,Lo.get("icon-text-fit-padding"),cf,Jp)),ac&&(Yi=vo(Yi,ac,oc,Lo.get("icon-text-fit-padding"),cf,Jp)));var Yu=function(Fg,od){od.x<0||od.x>=8192||od.y<0||od.y>=8192||function(xo,sc,Ng,Y,Oh,Qv,sd,uc,ud,yp,ld,cd,hf,Jv,xp,em,tm,rm,S0,A0,Ru,fd,nm,lc,T0){var bp,Xf,kh,Dh,pf,Ep=xo.addToLineVertexArray(sc,Ng),im=0,w0=0,C0=0,am=0,om=-1,yl=-1,df={},R0=Fe(""),sm=0,um=0;if(uc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(sm=(bp=uc.layout.get("text-offset").evaluate(Ru,{},lc).map(function(vd){return 24*vd}))[0],um=bp[1]):(sm=24*uc.layout.get("text-radial-offset").evaluate(Ru,{},lc),um=ot),xo.allowVerticalPlacement&&Y.vertical){var Sp=uc.layout.get("text-rotate").evaluate(Ru,{},lc)+90;Dh=new pa(ud,sc,yp,ld,cd,Y.vertical,hf,Jv,xp,Sp),sd&&(pf=new pa(ud,sc,yp,ld,cd,sd,tm,rm,xp,Sp))}if(Oh){var rv=uc.layout.get("icon-rotate").evaluate(Ru,{}),lm=uc.layout.get("icon-text-fit")!=="none",cm=Ge(Oh,rv,nm,lm),hd=sd?Ge(sd,rv,nm,lm):void 0;kh=new pa(ud,sc,yp,ld,cd,Oh,tm,rm,!1,rv),im=4*cm.length;var fm=xo.iconSizeData,pd=null;fm.kind==="source"?(pd=[128*uc.layout.get("icon-size").evaluate(Ru,{})])[0]>32640&&pt(xo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):fm.kind==="composite"&&((pd=[128*fd.compositeIconSizes[0].evaluate(Ru,{},lc),128*fd.compositeIconSizes[1].evaluate(Ru,{},lc)])[0]>32640||pd[1]>32640)&&pt(xo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),xo.addSymbols(xo.icon,cm,pd,A0,S0,Ru,!1,sc,Ep.lineStartIndex,Ep.lineLength,-1,lc),om=xo.icon.placedSymbolArray.length-1,hd&&(w0=4*hd.length,xo.addSymbols(xo.icon,hd,pd,A0,S0,Ru,Jt.vertical,sc,Ep.lineStartIndex,Ep.lineLength,-1,lc),yl=xo.icon.placedSymbolArray.length-1)}for(var M0 in Y.horizontal){var Ap=Y.horizontal[M0];if(!Xf){R0=Fe(Ap.text);var hm=uc.layout.get("text-rotate").evaluate(Ru,{},lc);Xf=new pa(ud,sc,yp,ld,cd,Ap,hf,Jv,xp,hm)}var nv=Ap.positionedLines.length===1;if(C0+=Xe(xo,sc,Ap,Qv,uc,xp,Ru,em,Ep,Y.vertical?Jt.horizontal:Jt.horizontalOnly,nv?Object.keys(Y.horizontal):[M0],df,om,fd,lc),nv)break}Y.vertical&&(am+=Xe(xo,sc,Y.vertical,Qv,uc,xp,Ru,em,Ep,Jt.vertical,["vertical"],df,yl,fd,lc));var iv=Xf?Xf.boxStartIndex:xo.collisionBoxArray.length,av=Xf?Xf.boxEndIndex:xo.collisionBoxArray.length,pm=Dh?Dh.boxStartIndex:xo.collisionBoxArray.length,dm=Dh?Dh.boxEndIndex:xo.collisionBoxArray.length,ov=kh?kh.boxStartIndex:xo.collisionBoxArray.length,dd=kh?kh.boxEndIndex:xo.collisionBoxArray.length,qu=pf?pf.boxStartIndex:xo.collisionBoxArray.length,vm=pf?pf.boxEndIndex:xo.collisionBoxArray.length,Nl=-1,cc=function(vd,P0){return vd&&vd.circleDiameter?Math.max(vd.circleDiameter,P0):P0};Nl=cc(Xf,Nl),Nl=cc(Dh,Nl),Nl=cc(kh,Nl);var I0=(Nl=cc(pf,Nl))>-1?1:0;I0&&(Nl*=T0/24),xo.glyphOffsetArray.length>=Sn.MAX_GLYPHS&&pt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ru.sortKey!==void 0&&xo.addToSortKeyRanges(xo.symbolInstances.length,Ru.sortKey),xo.symbolInstances.emplaceBack(sc.x,sc.y,df.right>=0?df.right:-1,df.center>=0?df.center:-1,df.left>=0?df.left:-1,df.vertical||-1,om,yl,R0,iv,av,pm,dm,ov,dd,qu,vm,yp,C0,am,im,w0,I0,0,hf,sm,um,Nl)}(Ui,od,Fg,da,Yi,vu,lf,Ui.layers[0],Ui.collisionBoxArray,Aa.index,Aa.sourceLayerIndex,Ui.index,cp,qv,fp,Zs,Gf,rd,Yd,cf,Aa,zs,na,Fl,za)};if(Fc==="line")for(var Mh=0,nd=ml(Aa.geometry,0,0,8192,8192);Mh<nd.length;Mh+=1)for(var id=nd[Mh],Ih=0,pp=go(id,td,$d,da.vertical||ac,Yi,24,ed,Ui.overscaling,8192);Ih<pp.length;Ih+=1){var qd=pp[Ih];ac&&Ie(Ui,ac.text,hp,qd)||Yu(id,qd)}else if(Fc==="line-center")for(var ad=0,dp=Aa.geometry;ad<dp.length;ad+=1){var vp=dp[ad];if(vp.length>1){var Kd=Wi(vp,$d,da.vertical||ac,Yi,24,ed);Kd&&Yu(vp,Kd)}}else if(Aa.type==="Polygon")for(var mp=0,Qd=ip(Aa.geometry,0);mp<Qd.length;mp+=1){var gp=Qd[mp],ff=qe(gp,16);Yu(gp[0],new Ua(ff.x,ff.y,0))}else if(Aa.type==="LineString")for(var is=0,_p=Aa.geometry;is<_p.length;is+=1){var Ph=_p[is];Yu(Ph,new Ua(Ph[0].x,Ph[0].y,0))}else if(Aa.type==="Point")for(var Jd=0,ev=Aa.geometry;Jd<ev.length;Jd+=1)for(var tv=0,E0=ev[Jd];tv<E0.length;tv+=1){var Kv=E0[tv];Yu([Kv],new Ua(Kv.x,Kv.y,0))}}(o,jt,gn,ms,m,j,Jr,Fn,_n,Us,T)},Lt=0,qt=o.features;Lt<qt.length;Lt+=1)bt();E&&o.generateCollisionDebugBuffers()},y.perspective=function(o,u,f,m,x){var E,T=1/Math.tan(u/2);return o[0]=T/f,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,x!=null&&x!==1/0?(o[10]=(x+m)*(E=1/(m-x)),o[14]=2*x*m*E):(o[10]=-1,o[14]=-2*m),o},y.pick=function(o,u){for(var f={},m=0;m<u.length;m++){var x=u[m];x in o&&(f[x]=o[x])}return f},y.plugin=Nt,y.polygonIntersectsPolygon=cl,y.postMapLoadEvent=Vt,y.postTurnstileEvent=xs,y.potpack=ai,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=bn,y.registerForPluginStateChange=function(o){return o({pluginStatus:us,pluginURL:xu}),Tc.on("pluginStateChange",o),o},y.renderColorRamp=tc,y.rotate=function(o,u,f){var m=u[0],x=u[1],E=u[2],T=u[3],M=Math.sin(f),L=Math.cos(f);return o[0]=m*L+E*M,o[1]=x*L+T*M,o[2]=m*-M+E*L,o[3]=x*-M+T*L,o},y.rotateX=function(o,u,f){var m=Math.sin(f),x=Math.cos(f),E=u[4],T=u[5],M=u[6],L=u[7],j=u[8],$=u[9],q=u[10],le=u[11];return u!==o&&(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[4]=E*x+j*m,o[5]=T*x+$*m,o[6]=M*x+q*m,o[7]=L*x+le*m,o[8]=j*x-E*m,o[9]=$*x-T*m,o[10]=q*x-M*m,o[11]=le*x-L*m,o},y.rotateZ=function(o,u,f){var m=Math.sin(f),x=Math.cos(f),E=u[0],T=u[1],M=u[2],L=u[3],j=u[4],$=u[5],q=u[6],le=u[7];return u!==o&&(o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[0]=E*x+j*m,o[1]=T*x+$*m,o[2]=M*x+q*m,o[3]=L*x+le*m,o[4]=j*x-E*m,o[5]=$*x-T*m,o[6]=q*x-M*m,o[7]=le*x-L*m,o},y.scale=function(o,u,f){var m=f[0],x=f[1],E=f[2];return o[0]=u[0]*m,o[1]=u[1]*m,o[2]=u[2]*m,o[3]=u[3]*m,o[4]=u[4]*x,o[5]=u[5]*x,o[6]=u[6]*x,o[7]=u[7]*x,o[8]=u[8]*E,o[9]=u[9]*E,o[10]=u[10]*E,o[11]=u[11]*E,o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},y.scale$1=function(o,u,f){return o[0]=u[0]*f,o[1]=u[1]*f,o[2]=u[2]*f,o[3]=u[3]*f,o},y.scale$2=function(o,u,f){return o[0]=u[0]*f,o[1]=u[1]*f,o[2]=u[2]*f,o},y.setCacheLimits=function(o,u){gr=o,Gr=u},y.setRTLTextPlugin=function(o,u,f){if(f===void 0&&(f=!1),us==="deferred"||us==="loading"||us==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");xu=Dn.resolveURL(o),us="deferred",kf=u,Ac(),f||ks()},y.sphericalToCartesian=function(o){var u=o[0],f=o[1],m=o[2];return f+=90,f*=Math.PI/180,m*=Math.PI/180,{x:u*Math.cos(f)*Math.sin(m),y:u*Math.sin(f)*Math.sin(m),z:u*Math.cos(m)}},y.sqrLen=function(o){var u=o[0],f=o[1];return u*u+f*f},y.styleSpec=he,y.sub=function(o,u,f){return o[0]=u[0]-f[0],o[1]=u[1]-f[1],o[2]=u[2]-f[2],o},y.symbolSize=_i,y.transformMat3=function(o,u,f){var m=u[0],x=u[1],E=u[2];return o[0]=m*f[0]+x*f[3]+E*f[6],o[1]=m*f[1]+x*f[4]+E*f[7],o[2]=m*f[2]+x*f[5]+E*f[8],o},y.transformMat4=Wu,y.translate=function(o,u,f){var m,x,E,T,M,L,j,$,q,le,me,ze,He=f[0],st=f[1],et=f[2];return u===o?(o[12]=u[0]*He+u[4]*st+u[8]*et+u[12],o[13]=u[1]*He+u[5]*st+u[9]*et+u[13],o[14]=u[2]*He+u[6]*st+u[10]*et+u[14],o[15]=u[3]*He+u[7]*st+u[11]*et+u[15]):(x=u[1],E=u[2],T=u[3],M=u[4],L=u[5],j=u[6],$=u[7],q=u[8],le=u[9],me=u[10],ze=u[11],o[0]=m=u[0],o[1]=x,o[2]=E,o[3]=T,o[4]=M,o[5]=L,o[6]=j,o[7]=$,o[8]=q,o[9]=le,o[10]=me,o[11]=ze,o[12]=m*He+M*st+q*et+u[12],o[13]=x*He+L*st+le*et+u[13],o[14]=E*He+j*st+me*et+u[14],o[15]=T*He+$*st+ze*et+u[15]),o},y.triggerPluginCompletionEvent=ep,y.uniqueId=Ft,y.validateCustomStyleLayer=function(o){var u=[],f=o.id;return f===void 0&&u.push({message:"layers."+f+': missing required property "id"'}),o.render===void 0&&u.push({message:"layers."+f+': missing required method "render"'}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&u.push({message:"layers."+f+': property "renderingMode" must be either "2d" or "3d"'}),u},y.validateLight=Jh,y.validateStyle=qs,y.values=function(o){var u=[];for(var f in o)u.push(o[f]);return u},y.vectorTile=ic,y.version="1.13.3",y.warnOnce=pt,y.webpSupported=nn,y.window=ie,y.wrap=Tt}),se(["./shared"],function(y){"use strict";function de(U){var F=typeof U;if(F==="number"||F==="boolean"||F==="string"||U==null)return JSON.stringify(U);if(Array.isArray(U)){for(var X="[",ee=0,Se=U;ee<Se.length;ee+=1)X+=de(Se[ee])+",";return X+"]"}for(var Ue=Object.keys(U).sort(),Je="{",he=0;he<Ue.length;he++)Je+=JSON.stringify(Ue[he])+":"+de(U[Ue[he]])+",";return Je+"}"}function V(U){for(var F="",X=0,ee=y.refProperties;X<ee.length;X+=1)F+="/"+de(U[ee[X]]);return F}var ce=function(U){this.keyCache={},U&&this.replace(U)};ce.prototype.replace=function(U){this._layerConfigs={},this._layers={},this.update(U,[])},ce.prototype.update=function(U,F){for(var X=this,ee=0,Se=U;ee<Se.length;ee+=1){var Ue=Se[ee];this._layerConfigs[Ue.id]=Ue;var Je=this._layers[Ue.id]=y.createStyleLayer(Ue);Je._featureFilter=y.featureFilter(Je.filter),this.keyCache[Ue.id]&&delete this.keyCache[Ue.id]}for(var he=0,K=F;he<K.length;he+=1){var ge=K[he];delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge]}this.familiesBySource={};for(var Qe=0,gt=function(Br,jr){for(var ni={},on=0;on<Br.length;on++){var di=jr&&jr[Br[on].id]||V(Br[on]);jr&&(jr[Br[on].id]=di);var Fi=ni[di];Fi||(Fi=ni[di]=[]),Fi.push(Br[on])}var mi=[];for(var Ci in ni)mi.push(ni[Ci]);return mi}(y.values(this._layerConfigs),this.keyCache);Qe<gt.length;Qe+=1){var pe=gt[Qe].map(function(Br){return X._layers[Br.id]}),vr=pe[0];if(vr.visibility!=="none"){var en=vr.source||"",tn=this.familiesBySource[en];tn||(tn=this.familiesBySource[en]={});var Kt=vr.sourceLayer||"_geojsonTileLayer",$r=tn[Kt];$r||($r=tn[Kt]=[]),$r.push(pe)}}};var ae=function(U){var F={},X=[];for(var ee in U){var Se=U[ee],Ue=F[ee]={};for(var Je in Se){var he=Se[+Je];if(he&&he.bitmap.width!==0&&he.bitmap.height!==0){var K={x:0,y:0,w:he.bitmap.width+2,h:he.bitmap.height+2};X.push(K),Ue[Je]={rect:K,metrics:he.metrics}}}}var ge=y.potpack(X),Qe=new y.AlphaImage({width:ge.w||1,height:ge.h||1});for(var gt in U){var pe=U[gt];for(var vr in pe){var en=pe[+vr];if(en&&en.bitmap.width!==0&&en.bitmap.height!==0){var tn=F[gt][vr].rect;y.AlphaImage.copy(en.bitmap,Qe,{x:0,y:0},{x:tn.x+1,y:tn.y+1},en.bitmap)}}}this.image=Qe,this.positions=F};y.register("GlyphAtlas",ae);var Be=function(U){this.tileID=new y.OverscaledTileID(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.uid=U.uid,this.zoom=U.zoom,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.collectResourceTiming,this.returnDependencies=!!U.returnDependencies,this.promoteId=U.promoteId};function ie(U,F,X){for(var ee=new y.EvaluationParameters(F),Se=0,Ue=U;Se<Ue.length;Se+=1)Ue[Se].recalculate(ee,X)}function Ve(U,F){var X=y.getArrayBuffer(U.request,function(ee,Se,Ue,Je){ee?F(ee):Se&&F(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(Se)),rawData:Se,cacheControl:Ue,expires:Je})});return function(){X.cancel(),F()}}Be.prototype.parse=function(U,F,X,ee,Se){var Ue=this;this.status="parsing",this.data=U,this.collisionBoxArray=new y.CollisionBoxArray;var Je=new y.DictionaryCoder(Object.keys(U.layers).sort()),he=new y.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];var K,ge,Qe,gt,pe={},vr={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:X},en=F.familiesBySource[this.source];for(var tn in en){var Kt=U.layers[tn];if(Kt){Kt.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+tn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var $r=Je.encode(tn),Br=[],jr=0;jr<Kt.length;jr++){var ni=Kt.feature(jr),on=he.getId(ni,tn);Br.push({feature:ni,id:on,index:jr,sourceLayerIndex:$r})}for(var di=0,Fi=en[tn];di<Fi.length;di+=1){var mi=Fi[di],Ci=mi[0];Ci.minzoom&&this.zoom<Math.floor(Ci.minzoom)||Ci.maxzoom&&this.zoom>=Ci.maxzoom||Ci.visibility!=="none"&&(ie(mi,this.zoom,X),(pe[Ci.id]=Ci.createBucket({index:he.bucketLayerIDs.length,layers:mi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$r,sourceID:this.source})).populate(Br,vr,this.tileID.canonical),he.bucketLayerIDs.push(mi.map(function(Mi){return Mi.id})))}}}var Ri=y.mapObject(vr.glyphDependencies,function(Mi){return Object.keys(Mi).map(Number)});Object.keys(Ri).length?ee.send("getGlyphs",{uid:this.uid,stacks:Ri},function(Mi,gi){K||(K=Mi,ge=gi,Sa.call(Ue))}):ge={};var bo=Object.keys(vr.iconDependencies);bo.length?ee.send("getImages",{icons:bo,source:this.source,tileID:this.tileID,type:"icons"},function(Mi,gi){K||(K=Mi,Qe=gi,Sa.call(Ue))}):Qe={};var Ki=Object.keys(vr.patternDependencies);function Sa(){if(K)return Se(K);if(ge&&Qe&&gt){var Mi=new ae(ge),gi=new y.ImageAtlas(Qe,gt);for(var Ei in pe){var wa=pe[Ei];wa instanceof y.SymbolBucket?(ie(wa.layers,this.zoom,X),y.performSymbolLayout(wa,ge,Mi.positions,Qe,gi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):wa.hasPattern&&(wa instanceof y.LineBucket||wa instanceof y.FillBucket||wa instanceof y.FillExtrusionBucket)&&(ie(wa.layers,this.zoom,X),wa.addFeatures(vr,this.tileID.canonical,gi.patternPositions))}this.status="done",Se(null,{buckets:y.values(pe).filter(function(Gs){return!Gs.isEmpty()}),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Mi.image,imageAtlas:gi,glyphMap:this.returnDependencies?ge:null,iconMap:this.returnDependencies?Qe:null,glyphPositions:this.returnDependencies?Mi.positions:null})}}Ki.length?ee.send("getImages",{icons:Ki,source:this.source,tileID:this.tileID,type:"patterns"},function(Mi,gi){K||(K=Mi,gt=gi,Sa.call(Ue))}):gt={},Sa.call(this)};var rt=function(U,F,X,ee){this.actor=U,this.layerIndex=F,this.availableImages=X,this.loadVectorData=ee||Ve,this.loading={},this.loaded={}};rt.prototype.loadTile=function(U,F){var X=this,ee=U.uid;this.loading||(this.loading={});var Se=!!(U&&U.request&&U.request.collectResourceTiming)&&new y.RequestPerformance(U.request),Ue=this.loading[ee]=new Be(U);Ue.abort=this.loadVectorData(U,function(Je,he){if(delete X.loading[ee],Je||!he)return Ue.status="done",X.loaded[ee]=Ue,F(Je);var K=he.rawData,ge={};he.expires&&(ge.expires=he.expires),he.cacheControl&&(ge.cacheControl=he.cacheControl);var Qe={};if(Se){var gt=Se.finish();gt&&(Qe.resourceTiming=JSON.parse(JSON.stringify(gt)))}Ue.vectorTile=he.vectorTile,Ue.parse(he.vectorTile,X.layerIndex,X.availableImages,X.actor,function(pe,vr){if(pe||!vr)return F(pe);F(null,y.extend({rawTileData:K.slice(0)},vr,ge,Qe))}),X.loaded=X.loaded||{},X.loaded[ee]=Ue})},rt.prototype.reloadTile=function(U,F){var X=this,ee=this.loaded,Se=U.uid,Ue=this;if(ee&&ee[Se]){var Je=ee[Se];Je.showCollisionBoxes=U.showCollisionBoxes;var he=function(K,ge){var Qe=Je.reloadCallback;Qe&&(delete Je.reloadCallback,Je.parse(Je.vectorTile,Ue.layerIndex,X.availableImages,Ue.actor,Qe)),F(K,ge)};Je.status==="parsing"?Je.reloadCallback=he:Je.status==="done"&&(Je.vectorTile?Je.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}},rt.prototype.abortTile=function(U,F){var X=this.loading,ee=U.uid;X&&X[ee]&&X[ee].abort&&(X[ee].abort(),delete X[ee]),F()},rt.prototype.removeTile=function(U,F){var X=this.loaded,ee=U.uid;X&&X[ee]&&delete X[ee],F()};var it=y.window.ImageBitmap,Ct=function(){this.loaded={}};function Tt(U,F){if(U.length!==0){Xt(U[0],F);for(var X=1;X<U.length;X++)Xt(U[X],!F)}}function Xt(U,F){for(var X=0,ee=0,Se=0,Ue=U.length,Je=Ue-1;Se<Ue;Je=Se++){var he=(U[Se][0]-U[Je][0])*(U[Je][1]+U[Se][1]),K=X+he;ee+=Math.abs(X)>=Math.abs(he)?X-K+he:he-K+X,X=K}X+ee>=0!=!!F&&U.reverse()}Ct.prototype.loadTile=function(U,F){var X=U.uid,ee=U.encoding,Se=U.rawImageData,Ue=it&&Se instanceof it?this.getImageData(Se):Se,Je=new y.DEMData(X,Ue,ee);this.loaded=this.loaded||{},this.loaded[X]=Je,F(null,Je)},Ct.prototype.getImageData=function(U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);var F=this.offscreenCanvasContext.getImageData(-1,-1,U.width+2,U.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:F.width,height:F.height},F.data)},Ct.prototype.removeTile=function(U){var F=this.loaded,X=U.uid;F&&F[X]&&delete F[X]};var ir=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ft=function(U){this._feature=U,this.extent=y.EXTENT,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))};Ft.prototype.loadGeometry=function(){if(this._feature.type===1){for(var U=[],F=0,X=this._feature.geometry;F<X.length;F+=1){var ee=X[F];U.push([new y.Point$1(ee[0],ee[1])])}return U}for(var Se=[],Ue=0,Je=this._feature.geometry;Ue<Je.length;Ue+=1){for(var he=[],K=0,ge=Je[Ue];K<ge.length;K+=1){var Qe=ge[K];he.push(new y.Point$1(Qe[0],Qe[1]))}Se.push(he)}return Se},Ft.prototype.toGeoJSON=function(U,F,X){return ir.call(this,U,F,X)};var Rt=function(U){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=U.length,this._features=U};Rt.prototype.feature=function(U){return new Ft(this._features[U])};var xt=y.vectorTile.VectorTileFeature,Zr=Tr;function Tr(U,F){this.options=F||{},this.features=U,this.length=U.length}function dr(U,F){this.id=typeof U.id=="number"?U.id:void 0,this.type=U.type,this.rawGeometry=U.type===1?[U.geometry]:U.geometry,this.properties=U.tags,this.extent=F||4096}Tr.prototype.feature=function(U){return new dr(this.features[U],this.options.extent)},dr.prototype.loadGeometry=function(){var U=this.rawGeometry;this.geometry=[];for(var F=0;F<U.length;F++){for(var X=U[F],ee=[],Se=0;Se<X.length;Se++)ee.push(new y.Point$1(X[Se][0],X[Se][1]));this.geometry.push(ee)}return this.geometry},dr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var U=this.geometry,F=1/0,X=-1/0,ee=1/0,Se=-1/0,Ue=0;Ue<U.length;Ue++)for(var Je=U[Ue],he=0;he<Je.length;he++){var K=Je[he];F=Math.min(F,K.x),X=Math.max(X,K.x),ee=Math.min(ee,K.y),Se=Math.max(Se,K.y)}return[F,ee,X,Se]},dr.prototype.toGeoJSON=xt.prototype.toGeoJSON;var Mt=Bt,lt=Zr;function Bt(U){var F=new y.pbf;return function(X,ee){for(var Se in X.layers)ee.writeMessage(3,pt,X.layers[Se])}(U,F),F.finish()}function pt(U,F){var X;F.writeVarintField(15,U.version||1),F.writeStringField(1,U.name||""),F.writeVarintField(5,U.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<U.length;X++)ee.feature=U.feature(X),F.writeMessage(2,ur,ee);var Se=ee.keys;for(X=0;X<Se.length;X++)F.writeStringField(3,Se[X]);var Ue=ee.values;for(X=0;X<Ue.length;X++)F.writeMessage(4,ke,Ue[X])}function ur(U,F){var X=U.feature;X.id!==void 0&&F.writeVarintField(1,X.id),F.writeMessage(2,Ar,U),F.writeVarintField(3,X.type),F.writeMessage(4,k,X)}function Ar(U,F){var X=U.feature,ee=U.keys,Se=U.values,Ue=U.keycache,Je=U.valuecache;for(var he in X.properties){var K=Ue[he];K===void 0&&(ee.push(he),Ue[he]=K=ee.length-1),F.writeVarint(K);var ge=X.properties[he],Qe=typeof ge;Qe!=="string"&&Qe!=="boolean"&&Qe!=="number"&&(ge=JSON.stringify(ge));var gt=Qe+":"+ge,pe=Je[gt];pe===void 0&&(Se.push(ge),Je[gt]=pe=Se.length-1),F.writeVarint(pe)}}function te(U,F){return(F<<3)+(7&U)}function Ne(U){return U<<1^U>>31}function k(U,F){for(var X=U.loadGeometry(),ee=U.type,Se=0,Ue=0,Je=X.length,he=0;he<Je;he++){var K=X[he],ge=1;ee===1&&(ge=K.length),F.writeVarint(te(1,ge));for(var Qe=ee===3?K.length-1:K.length,gt=0;gt<Qe;gt++){gt===1&&ee!==1&&F.writeVarint(te(2,Qe-1));var pe=K[gt].x-Se,vr=K[gt].y-Ue;F.writeVarint(Ne(pe)),F.writeVarint(Ne(vr)),Se+=pe,Ue+=vr}ee===3&&F.writeVarint(te(7,1))}}function ke(U,F){var X=typeof U;X==="string"?F.writeStringField(1,U):X==="boolean"?F.writeBooleanField(7,U):X==="number"&&(U%1!=0?F.writeDoubleField(3,U):U<0?F.writeSVarintField(6,U):F.writeVarintField(5,U))}function Re(U,F,X,ee){ct(U,X,ee),ct(F,2*X,2*ee),ct(F,2*X+1,2*ee+1)}function ct(U,F,X){var ee=U[F];U[F]=U[X],U[X]=ee}function Et(U,F,X,ee){var Se=U-X,Ue=F-ee;return Se*Se+Ue*Ue}Mt.fromVectorTileJs=Bt,Mt.fromGeojsonVt=function(U,F){F=F||{};var X={};for(var ee in U)X[ee]=new Zr(U[ee].features,F),X[ee].name=ee,X[ee].version=F.version,X[ee].extent=F.extent;return Bt({layers:X})},Mt.GeoJSONWrapper=lt;var kt=function(U){return U[0]},er=function(U){return U[1]},rr=function(U,F,X,ee,Se){F===void 0&&(F=kt),X===void 0&&(X=er),ee===void 0&&(ee=64),Se===void 0&&(Se=Float64Array),this.nodeSize=ee,this.points=U;for(var Ue=U.length<65536?Uint16Array:Uint32Array,Je=this.ids=new Ue(U.length),he=this.coords=new Se(2*U.length),K=0;K<U.length;K++)Je[K]=K,he[2*K]=F(U[K]),he[2*K+1]=X(U[K]);(function ge(Qe,gt,pe,vr,en,tn){if(!(en-vr<=pe)){var Kt=vr+en>>1;(function $r(Br,jr,ni,on,di,Fi){for(;di>on;){if(di-on>600){var mi=di-on+1,Ci=ni-on+1,Ri=Math.log(mi),bo=.5*Math.exp(2*Ri/3),Ki=.5*Math.sqrt(Ri*bo*(mi-bo)/mi)*(Ci-mi/2<0?-1:1);$r(Br,jr,ni,Math.max(on,Math.floor(ni-Ci*bo/mi+Ki)),Math.min(di,Math.floor(ni+(mi-Ci)*bo/mi+Ki)),Fi)}var Sa=jr[2*ni+Fi],Mi=on,gi=di;for(Re(Br,jr,on,ni),jr[2*di+Fi]>Sa&&Re(Br,jr,on,di);Mi<gi;){for(Re(Br,jr,Mi,gi),Mi++,gi--;jr[2*Mi+Fi]<Sa;)Mi++;for(;jr[2*gi+Fi]>Sa;)gi--}jr[2*on+Fi]===Sa?Re(Br,jr,on,gi):Re(Br,jr,++gi,di),gi<=ni&&(on=gi+1),ni<=gi&&(di=gi-1)}})(Qe,gt,Kt,vr,en,tn%2),ge(Qe,gt,pe,vr,Kt-1,tn+1),ge(Qe,gt,pe,Kt+1,en,tn+1)}})(Je,he,ee,0,Je.length-1,0)};rr.prototype.range=function(U,F,X,ee){return function(Se,Ue,Je,he,K,ge,Qe){for(var gt,pe,vr=[0,Se.length-1,0],en=[];vr.length;){var tn=vr.pop(),Kt=vr.pop(),$r=vr.pop();if(Kt-$r<=Qe)for(var Br=$r;Br<=Kt;Br++)pe=Ue[2*Br+1],(gt=Ue[2*Br])>=Je&&gt<=K&&pe>=he&&pe<=ge&&en.push(Se[Br]);else{var jr=Math.floor(($r+Kt)/2);pe=Ue[2*jr+1],(gt=Ue[2*jr])>=Je&&gt<=K&&pe>=he&&pe<=ge&&en.push(Se[jr]);var ni=(tn+1)%2;(tn===0?Je<=gt:he<=pe)&&(vr.push($r),vr.push(jr-1),vr.push(ni)),(tn===0?K>=gt:ge>=pe)&&(vr.push(jr+1),vr.push(Kt),vr.push(ni))}}return en}(this.ids,this.coords,U,F,X,ee,this.nodeSize)},rr.prototype.within=function(U,F,X){return function(ee,Se,Ue,Je,he,K){for(var ge=[0,ee.length-1,0],Qe=[],gt=he*he;ge.length;){var pe=ge.pop(),vr=ge.pop(),en=ge.pop();if(vr-en<=K)for(var tn=en;tn<=vr;tn++)Et(Se[2*tn],Se[2*tn+1],Ue,Je)<=gt&&Qe.push(ee[tn]);else{var Kt=Math.floor((en+vr)/2),$r=Se[2*Kt],Br=Se[2*Kt+1];Et($r,Br,Ue,Je)<=gt&&Qe.push(ee[Kt]);var jr=(pe+1)%2;(pe===0?Ue-he<=$r:Je-he<=Br)&&(ge.push(en),ge.push(Kt-1),ge.push(jr)),(pe===0?Ue+he>=$r:Je+he>=Br)&&(ge.push(Kt+1),ge.push(vr),ge.push(jr))}}return Qe}(this.ids,this.coords,U,F,X,this.nodeSize)};var fn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(U){return U}},ar=function(U){this.options=Ti(Object.create(fn),U),this.trees=new Array(this.options.maxZoom+1)};function Dn(U,F,X,ee,Se){return{x:U,y:F,zoom:1/0,id:X,parentId:-1,numPoints:ee,properties:Se}}function hn(U,F){var X=U.geometry.coordinates,ee=X[1];return{x:qn(X[0]),y:En(ee),zoom:1/0,index:F,parentId:-1}}function nn(U){return{type:"Feature",id:U.id,properties:ri(U),geometry:{type:"Point",coordinates:[(ee=U.x,360*(ee-.5)),(F=U.y,X=(180-360*F)*Math.PI/180,360*Math.atan(Math.exp(X))/Math.PI-90)]}};var F,X,ee}function ri(U){var F=U.numPoints,X=F>=1e4?Math.round(F/1e3)+"k":F>=1e3?Math.round(F/100)/10+"k":F;return Ti(Ti({},U.properties),{cluster:!0,cluster_id:U.id,point_count:F,point_count_abbreviated:X})}function qn(U){return U/360+.5}function En(U){var F=Math.sin(U*Math.PI/180),X=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return X<0?0:X>1?1:X}function Ti(U,F){for(var X in F)U[X]=F[X];return U}function hi(U){return U.x}function ea(U){return U.y}function Tn(U,F,X,ee,Se,Ue){var Je=Se-X,he=Ue-ee;if(Je!==0||he!==0){var K=((U-X)*Je+(F-ee)*he)/(Je*Je+he*he);K>1?(X=Se,ee=Ue):K>0&&(X+=Je*K,ee+=he*K)}return(Je=U-X)*Je+(he=F-ee)*he}function kn(U,F,X,ee){var Se={id:U===void 0?null:U,type:F,geometry:X,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ue){var Je=Ue.geometry,he=Ue.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")Ea(Ue,Je);else if(he==="Polygon"||he==="MultiLineString")for(var K=0;K<Je.length;K++)Ea(Ue,Je[K]);else if(he==="MultiPolygon")for(K=0;K<Je.length;K++)for(var ge=0;ge<Je[K].length;ge++)Ea(Ue,Je[K][ge])}(Se),Se}function Ea(U,F){for(var X=0;X<F.length;X+=3)U.minX=Math.min(U.minX,F[X]),U.minY=Math.min(U.minY,F[X+1]),U.maxX=Math.max(U.maxX,F[X]),U.maxY=Math.max(U.maxY,F[X+1])}function ji(U,F,X,ee){if(F.geometry){var Se=F.geometry.coordinates,Ue=F.geometry.type,Je=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),he=[],K=F.id;if(X.promoteId?K=F.properties[X.promoteId]:X.generateId&&(K=ee||0),Ue==="Point")ja(Se,he);else if(Ue==="MultiPoint")for(var ge=0;ge<Se.length;ge++)ja(Se[ge],he);else if(Ue==="LineString")Ha(Se,he,Je,!1);else if(Ue==="MultiLineString"){if(X.lineMetrics){for(ge=0;ge<Se.length;ge++)Ha(Se[ge],he=[],Je,!1),U.push(kn(K,"LineString",he,F.properties));return}Me(Se,he,Je,!1)}else if(Ue==="Polygon")Me(Se,he,Je,!0);else{if(Ue!=="MultiPolygon"){if(Ue==="GeometryCollection"){for(ge=0;ge<F.geometry.geometries.length;ge++)ji(U,{id:K,geometry:F.geometry.geometries[ge],properties:F.properties},X,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ge=0;ge<Se.length;ge++){var Qe=[];Me(Se[ge],Qe,Je,!0),he.push(Qe)}}U.push(kn(K,Ue,he,F.properties))}}function ja(U,F){F.push(Wa(U[0])),F.push(sa(U[1])),F.push(0)}function Ha(U,F,X,ee){for(var Se,Ue,Je=0,he=0;he<U.length;he++){var K=Wa(U[he][0]),ge=sa(U[he][1]);F.push(K),F.push(ge),F.push(0),he>0&&(Je+=ee?(Se*ge-K*Ue)/2:Math.sqrt(Math.pow(K-Se,2)+Math.pow(ge-Ue,2))),Se=K,Ue=ge}var Qe=F.length-3;F[2]=1,function gt(pe,vr,en,tn){for(var Kt,$r=tn,Br=en-vr>>1,jr=en-vr,ni=pe[vr],on=pe[vr+1],di=pe[en],Fi=pe[en+1],mi=vr+3;mi<en;mi+=3){var Ci=Tn(pe[mi],pe[mi+1],ni,on,di,Fi);if(Ci>$r)Kt=mi,$r=Ci;else if(Ci===$r){var Ri=Math.abs(mi-Br);Ri<jr&&(Kt=mi,jr=Ri)}}$r>tn&&(Kt-vr>3&&gt(pe,vr,Kt,tn),pe[Kt+2]=$r,en-Kt>3&&gt(pe,Kt,en,tn))}(F,0,Qe,X),F[Qe+2]=1,F.size=Math.abs(Je),F.start=0,F.end=F.size}function Me(U,F,X,ee){for(var Se=0;Se<U.length;Se++){var Ue=[];Ha(U[Se],Ue,X,ee),F.push(Ue)}}function Wa(U){return U/360+.5}function sa(U){var F=Math.sin(U*Math.PI/180),X=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return X<0?0:X>1?1:X}function eo(U,F,X,ee,Se,Ue,Je,he){if(ee/=F,Ue>=(X/=F)&&Je<ee)return U;if(Je<X||Ue>=ee)return null;for(var K=[],ge=0;ge<U.length;ge++){var Qe=U[ge],gt=Qe.geometry,pe=Qe.type,vr=Se===0?Qe.minX:Qe.minY,en=Se===0?Qe.maxX:Qe.maxY;if(vr>=X&&en<ee)K.push(Qe);else if(!(en<X||vr>=ee)){var tn=[];if(pe==="Point"||pe==="MultiPoint")Ws(gt,tn,X,ee,Se);else if(pe==="LineString")xs(gt,tn,X,ee,Se,!1,he.lineMetrics);else if(pe==="MultiLineString")Vt(gt,tn,X,ee,Se,!1);else if(pe==="Polygon")Vt(gt,tn,X,ee,Se,!0);else if(pe==="MultiPolygon")for(var Kt=0;Kt<gt.length;Kt++){var $r=[];Vt(gt[Kt],$r,X,ee,Se,!0),$r.length&&tn.push($r)}if(tn.length){if(he.lineMetrics&&pe==="LineString"){for(Kt=0;Kt<tn.length;Kt++)K.push(kn(Qe.id,pe,tn[Kt],Qe.tags));continue}pe!=="LineString"&&pe!=="MultiLineString"||(tn.length===1?(pe="LineString",tn=tn[0]):pe="MultiLineString"),pe!=="Point"&&pe!=="MultiPoint"||(pe=tn.length===3?"Point":"MultiPoint"),K.push(kn(Qe.id,pe,tn,Qe.tags))}}}return K.length?K:null}function Ws(U,F,X,ee,Se){for(var Ue=0;Ue<U.length;Ue+=3){var Je=U[Ue+Se];Je>=X&&Je<=ee&&(F.push(U[Ue]),F.push(U[Ue+1]),F.push(U[Ue+2]))}}function xs(U,F,X,ee,Se,Ue,Je){for(var he,K,ge=bs(U),Qe=Se===0?Gr:an,gt=U.start,pe=0;pe<U.length-3;pe+=3){var vr=U[pe],en=U[pe+1],tn=U[pe+2],Kt=U[pe+3],$r=U[pe+4],Br=Se===0?vr:en,jr=Se===0?Kt:$r,ni=!1;Je&&(he=Math.sqrt(Math.pow(vr-Kt,2)+Math.pow(en-$r,2))),Br<X?jr>X&&(K=Qe(ge,vr,en,Kt,$r,X),Je&&(ge.start=gt+he*K)):Br>ee?jr<ee&&(K=Qe(ge,vr,en,Kt,$r,ee),Je&&(ge.start=gt+he*K)):gr(ge,vr,en,tn),jr<X&&Br>=X&&(K=Qe(ge,vr,en,Kt,$r,X),ni=!0),jr>ee&&Br<=ee&&(K=Qe(ge,vr,en,Kt,$r,ee),ni=!0),!Ue&&ni&&(Je&&(ge.end=gt+he*K),F.push(ge),ge=bs(U)),Je&&(gt+=he)}var on=U.length-3;vr=U[on],en=U[on+1],tn=U[on+2],(Br=Se===0?vr:en)>=X&&Br<=ee&&gr(ge,vr,en,tn),on=ge.length-3,Ue&&on>=3&&(ge[on]!==ge[0]||ge[on+1]!==ge[1])&&gr(ge,ge[0],ge[1],ge[2]),ge.length&&F.push(ge)}function bs(U){var F=[];return F.size=U.size,F.start=U.start,F.end=U.end,F}function Vt(U,F,X,ee,Se,Ue){for(var Je=0;Je<U.length;Je++)xs(U[Je],F,X,ee,Se,Ue,!1)}function gr(U,F,X,ee){U.push(F),U.push(X),U.push(ee)}function Gr(U,F,X,ee,Se,Ue){var Je=(Ue-F)/(ee-F);return U.push(Ue),U.push(X+(Se-X)*Je),U.push(1),Je}function an(U,F,X,ee,Se,Ue){var Je=(Ue-X)/(Se-X);return U.push(F+(ee-F)*Je),U.push(Ue),U.push(1),Je}function Zn(U,F){for(var X=[],ee=0;ee<U.length;ee++){var Se,Ue=U[ee],Je=Ue.type;if(Je==="Point"||Je==="MultiPoint"||Je==="LineString")Se=Hi(Ue.geometry,F);else if(Je==="MultiLineString"||Je==="Polygon"){Se=[];for(var he=0;he<Ue.geometry.length;he++)Se.push(Hi(Ue.geometry[he],F))}else if(Je==="MultiPolygon")for(Se=[],he=0;he<Ue.geometry.length;he++){for(var K=[],ge=0;ge<Ue.geometry[he].length;ge++)K.push(Hi(Ue.geometry[he][ge],F));Se.push(K)}X.push(kn(Ue.id,Je,Se,Ue.tags))}return X}function Hi(U,F){var X=[];X.size=U.size,U.start!==void 0&&(X.start=U.start,X.end=U.end);for(var ee=0;ee<U.length;ee+=3)X.push(U[ee]+F,U[ee+1],U[ee+2]);return X}function fe(U,F){if(U.transformed)return U;var X,ee,Se,Ue=1<<U.z,Je=U.x,he=U.y;for(X=0;X<U.features.length;X++){var K=U.features[X],ge=K.geometry,Qe=K.type;if(K.geometry=[],Qe===1)for(ee=0;ee<ge.length;ee+=2)K.geometry.push(D(ge[ee],ge[ee+1],F,Ue,Je,he));else for(ee=0;ee<ge.length;ee++){var gt=[];for(Se=0;Se<ge[ee].length;Se+=2)gt.push(D(ge[ee][Se],ge[ee][Se+1],F,Ue,Je,he));K.geometry.push(gt)}}return U.transformed=!0,U}function D(U,F,X,ee,Se,Ue){return[Math.round(X*(U*ee-Se)),Math.round(X*(F*ee-Ue))]}function z(U,F,X,ee,Se){for(var Ue=F===Se.maxZoom?0:Se.tolerance/((1<<F)*Se.extent),Je={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:ee,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<U.length;he++){Je.numFeatures++,ne(Je,U[he],Ue,Se);var K=U[he].minX,ge=U[he].minY,Qe=U[he].maxX,gt=U[he].maxY;K<Je.minX&&(Je.minX=K),ge<Je.minY&&(Je.minY=ge),Qe>Je.maxX&&(Je.maxX=Qe),gt>Je.maxY&&(Je.maxY=gt)}return Je}function ne(U,F,X,ee){var Se=F.geometry,Ue=F.type,Je=[];if(Ue==="Point"||Ue==="MultiPoint")for(var he=0;he<Se.length;he+=3)Je.push(Se[he]),Je.push(Se[he+1]),U.numPoints++,U.numSimplified++;else if(Ue==="LineString")Ae(Je,Se,U,X,!1,!1);else if(Ue==="MultiLineString"||Ue==="Polygon")for(he=0;he<Se.length;he++)Ae(Je,Se[he],U,X,Ue==="Polygon",he===0);else if(Ue==="MultiPolygon")for(var K=0;K<Se.length;K++){var ge=Se[K];for(he=0;he<ge.length;he++)Ae(Je,ge[he],U,X,!0,he===0)}if(Je.length){var Qe=F.tags||null;if(Ue==="LineString"&&ee.lineMetrics){for(var gt in Qe={},F.tags)Qe[gt]=F.tags[gt];Qe.mapbox_clip_start=Se.start/Se.size,Qe.mapbox_clip_end=Se.end/Se.size}var pe={geometry:Je,type:Ue==="Polygon"||Ue==="MultiPolygon"?3:Ue==="LineString"||Ue==="MultiLineString"?2:1,tags:Qe};F.id!==null&&(pe.id=F.id),U.features.push(pe)}}function Ae(U,F,X,ee,Se,Ue){var Je=ee*ee;if(ee>0&&F.size<(Se?Je:ee))X.numPoints+=F.length/3;else{for(var he=[],K=0;K<F.length;K+=3)(ee===0||F[K+2]>Je)&&(X.numSimplified++,he.push(F[K]),he.push(F[K+1])),X.numPoints++;Se&&function(ge,Qe){for(var gt=0,pe=0,vr=ge.length,en=vr-2;pe<vr;en=pe,pe+=2)gt+=(ge[pe]-ge[en])*(ge[pe+1]+ge[en+1]);if(gt>0===Qe)for(pe=0,vr=ge.length;pe<vr/2;pe+=2){var tn=ge[pe],Kt=ge[pe+1];ge[pe]=ge[vr-2-pe],ge[pe+1]=ge[vr-1-pe],ge[vr-2-pe]=tn,ge[vr-1-pe]=Kt}}(he,Ue),U.push(he)}}function De(U,F){var X=(F=this.options=function(Se,Ue){for(var Je in Ue)Se[Je]=Ue[Je];return Se}(Object.create(this.options),F)).debug;if(X&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(Se,Ue){var Je=[];if(Se.type==="FeatureCollection")for(var he=0;he<Se.features.length;he++)ji(Je,Se.features[he],Ue,he);else ji(Je,Se.type==="Feature"?Se:{geometry:Se},Ue);return Je}(U,F);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ee=function(Se,Ue){var Je=Ue.buffer/Ue.extent,he=Se,K=eo(Se,1,-1-Je,Je,0,-1,2,Ue),ge=eo(Se,1,1-Je,2+Je,0,-1,2,Ue);return(K||ge)&&(he=eo(Se,1,-Je,1+Je,0,-1,2,Ue)||[],K&&(he=Zn(K,1).concat(he)),ge&&(he=he.concat(Zn(ge,-1)))),he}(ee,F)).length&&this.splitTile(ee,0,0,0),X&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zt(U,F,X){return 32*((1<<U)*X+F)+U}function St(U,F){var X=U.tileID.canonical;if(!this._geoJSONIndex)return F(null,null);var ee=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!ee)return F(null,null);var Se=new Rt(ee.features),Ue=Mt(Se);Ue.byteOffset===0&&Ue.byteLength===Ue.buffer.byteLength||(Ue=new Uint8Array(Ue)),F(null,{vectorTile:Se,rawData:Ue.buffer})}ar.prototype.load=function(U){var F=this.options,X=F.log,ee=F.minZoom,Se=F.maxZoom,Ue=F.nodeSize;X&&console.time("total time");var Je="prepare "+U.length+" points";X&&console.time(Je),this.points=U;for(var he=[],K=0;K<U.length;K++)U[K].geometry&&he.push(hn(U[K],K));this.trees[Se+1]=new rr(he,hi,ea,Ue,Float32Array),X&&console.timeEnd(Je);for(var ge=Se;ge>=ee;ge--){var Qe=+Date.now();he=this._cluster(he,ge),this.trees[ge]=new rr(he,hi,ea,Ue,Float32Array),X&&console.log("z%d: %d clusters in %dms",ge,he.length,+Date.now()-Qe)}return X&&console.timeEnd("total time"),this},ar.prototype.getClusters=function(U,F){var X=((U[0]+180)%360+360)%360-180,ee=Math.max(-90,Math.min(90,U[1])),Se=U[2]===180?180:((U[2]+180)%360+360)%360-180,Ue=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)X=-180,Se=180;else if(X>Se){var Je=this.getClusters([X,ee,180,Ue],F),he=this.getClusters([-180,ee,Se,Ue],F);return Je.concat(he)}for(var K=this.trees[this._limitZoom(F)],ge=[],Qe=0,gt=K.range(qn(X),En(Ue),qn(Se),En(ee));Qe<gt.length;Qe+=1){var pe=K.points[gt[Qe]];ge.push(pe.numPoints?nn(pe):this.points[pe.index])}return ge},ar.prototype.getChildren=function(U){var F=this._getOriginId(U),X=this._getOriginZoom(U),ee="No cluster with the specified id.",Se=this.trees[X];if(!Se)throw new Error(ee);var Ue=Se.points[F];if(!Ue)throw new Error(ee);for(var Je=this.options.radius/(this.options.extent*Math.pow(2,X-1)),he=[],K=0,ge=Se.within(Ue.x,Ue.y,Je);K<ge.length;K+=1){var Qe=Se.points[ge[K]];Qe.parentId===U&&he.push(Qe.numPoints?nn(Qe):this.points[Qe.index])}if(he.length===0)throw new Error(ee);return he},ar.prototype.getLeaves=function(U,F,X){var ee=[];return this._appendLeaves(ee,U,F=F||10,X=X||0,0),ee},ar.prototype.getTile=function(U,F,X){var ee=this.trees[this._limitZoom(U)],Se=Math.pow(2,U),Ue=this.options,Je=Ue.radius/Ue.extent,he=(X-Je)/Se,K=(X+1+Je)/Se,ge={features:[]};return this._addTileFeatures(ee.range((F-Je)/Se,he,(F+1+Je)/Se,K),ee.points,F,X,Se,ge),F===0&&this._addTileFeatures(ee.range(1-Je/Se,he,1,K),ee.points,Se,X,Se,ge),F===Se-1&&this._addTileFeatures(ee.range(0,he,Je/Se,K),ee.points,-1,X,Se,ge),ge.features.length?ge:null},ar.prototype.getClusterExpansionZoom=function(U){for(var F=this._getOriginZoom(U)-1;F<=this.options.maxZoom;){var X=this.getChildren(U);if(F++,X.length!==1)break;U=X[0].properties.cluster_id}return F},ar.prototype._appendLeaves=function(U,F,X,ee,Se){for(var Ue=0,Je=this.getChildren(F);Ue<Je.length;Ue+=1){var he=Je[Ue],K=he.properties;if(K&&K.cluster?Se+K.point_count<=ee?Se+=K.point_count:Se=this._appendLeaves(U,K.cluster_id,X,ee,Se):Se<ee?Se++:U.push(he),U.length===X)break}return Se},ar.prototype._addTileFeatures=function(U,F,X,ee,Se,Ue){for(var Je=0,he=U;Je<he.length;Je+=1){var K=F[he[Je]],ge=K.numPoints,Qe={type:1,geometry:[[Math.round(this.options.extent*(K.x*Se-X)),Math.round(this.options.extent*(K.y*Se-ee))]],tags:ge?ri(K):this.points[K.index].properties},gt=void 0;ge?gt=K.id:this.options.generateId?gt=K.index:this.points[K.index].id&&(gt=this.points[K.index].id),gt!==void 0&&(Qe.id=gt),Ue.features.push(Qe)}},ar.prototype._limitZoom=function(U){return Math.max(this.options.minZoom,Math.min(+U,this.options.maxZoom+1))},ar.prototype._cluster=function(U,F){for(var X=[],ee=this.options,Se=ee.reduce,Ue=ee.minPoints,Je=ee.radius/(ee.extent*Math.pow(2,F)),he=0;he<U.length;he++){var K=U[he];if(!(K.zoom<=F)){K.zoom=F;for(var ge=this.trees[F+1],Qe=ge.within(K.x,K.y,Je),gt=K.numPoints||1,pe=gt,vr=0,en=Qe;vr<en.length;vr+=1){var tn=ge.points[en[vr]];tn.zoom>F&&(pe+=tn.numPoints||1)}if(pe>=Ue){for(var Kt=K.x*gt,$r=K.y*gt,Br=Se&&gt>1?this._map(K,!0):null,jr=(he<<5)+(F+1)+this.points.length,ni=0,on=Qe;ni<on.length;ni+=1){var di=ge.points[on[ni]];if(!(di.zoom<=F)){di.zoom=F;var Fi=di.numPoints||1;Kt+=di.x*Fi,$r+=di.y*Fi,di.parentId=jr,Se&&(Br||(Br=this._map(K,!0)),Se(Br,this._map(di)))}}K.parentId=jr,X.push(Dn(Kt/pe,$r/pe,jr,pe,Br))}else if(X.push(K),pe>1)for(var mi=0,Ci=Qe;mi<Ci.length;mi+=1){var Ri=ge.points[Ci[mi]];Ri.zoom<=F||(Ri.zoom=F,X.push(Ri))}}}return X},ar.prototype._getOriginId=function(U){return U-this.points.length>>5},ar.prototype._getOriginZoom=function(U){return(U-this.points.length)%32},ar.prototype._map=function(U,F){if(U.numPoints)return F?Ti({},U.properties):U.properties;var X=this.points[U.index].properties,ee=this.options.map(X);return F&&ee===X?Ti({},ee):ee},De.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},De.prototype.splitTile=function(U,F,X,ee,Se,Ue,Je){for(var he=[U,F,X,ee],K=this.options,ge=K.debug;he.length;){ee=he.pop(),X=he.pop(),F=he.pop(),U=he.pop();var Qe=1<<F,gt=Zt(F,X,ee),pe=this.tiles[gt];if(!pe&&(ge>1&&console.time("creation"),pe=this.tiles[gt]=z(U,F,X,ee,K),this.tileCoords.push({z:F,x:X,y:ee}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,X,ee,pe.numFeatures,pe.numPoints,pe.numSimplified),console.timeEnd("creation"));var vr="z"+F;this.stats[vr]=(this.stats[vr]||0)+1,this.total++}if(pe.source=U,Se){if(F===K.maxZoom||F===Se)continue;var en=1<<Se-F;if(X!==Math.floor(Ue/en)||ee!==Math.floor(Je/en))continue}else if(F===K.indexMaxZoom||pe.numPoints<=K.indexMaxPoints)continue;if(pe.source=null,U.length!==0){ge>1&&console.time("clipping");var tn,Kt,$r,Br,jr,ni,on=.5*K.buffer/K.extent,di=.5-on,Fi=.5+on,mi=1+on;tn=Kt=$r=Br=null,jr=eo(U,Qe,X-on,X+Fi,0,pe.minX,pe.maxX,K),ni=eo(U,Qe,X+di,X+mi,0,pe.minX,pe.maxX,K),U=null,jr&&(tn=eo(jr,Qe,ee-on,ee+Fi,1,pe.minY,pe.maxY,K),Kt=eo(jr,Qe,ee+di,ee+mi,1,pe.minY,pe.maxY,K),jr=null),ni&&($r=eo(ni,Qe,ee-on,ee+Fi,1,pe.minY,pe.maxY,K),Br=eo(ni,Qe,ee+di,ee+mi,1,pe.minY,pe.maxY,K),ni=null),ge>1&&console.timeEnd("clipping"),he.push(tn||[],F+1,2*X,2*ee),he.push(Kt||[],F+1,2*X,2*ee+1),he.push($r||[],F+1,2*X+1,2*ee),he.push(Br||[],F+1,2*X+1,2*ee+1)}}},De.prototype.getTile=function(U,F,X){var ee=this.options,Se=ee.extent,Ue=ee.debug;if(U<0||U>24)return null;var Je=1<<U,he=Zt(U,F=(F%Je+Je)%Je,X);if(this.tiles[he])return fe(this.tiles[he],Se);Ue>1&&console.log("drilling down to z%d-%d-%d",U,F,X);for(var K,ge=U,Qe=F,gt=X;!K&&ge>0;)ge--,Qe=Math.floor(Qe/2),gt=Math.floor(gt/2),K=this.tiles[Zt(ge,Qe,gt)];return K&&K.source?(Ue>1&&console.log("found parent tile z%d-%d-%d",ge,Qe,gt),Ue>1&&console.time("drilling down"),this.splitTile(K.source,ge,Qe,gt,U,F,X),Ue>1&&console.timeEnd("drilling down"),this.tiles[he]?fe(this.tiles[he],Se):null):null};var At=function(U){function F(X,ee,Se,Ue){U.call(this,X,ee,Se,St),Ue&&(this.loadGeoJSON=Ue)}return U&&(F.__proto__=U),(F.prototype=Object.create(U&&U.prototype)).constructor=F,F.prototype.loadData=function(X,ee){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ee,this._pendingLoadDataParams=X,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},F.prototype._loadData=function(){var X=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ee=this._pendingCallback,Se=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ue=!!(Se&&Se.request&&Se.request.collectResourceTiming)&&new y.RequestPerformance(Se.request);this.loadGeoJSON(Se,function(Je,he){if(Je||!he)return ee(Je);if(typeof he!="object")return ee(new Error("Input data given to '"+Se.source+"' is not a valid GeoJSON object."));(function pe(vr,en){var tn,Kt=vr&&vr.type;if(Kt==="FeatureCollection")for(tn=0;tn<vr.features.length;tn++)pe(vr.features[tn],en);else if(Kt==="GeometryCollection")for(tn=0;tn<vr.geometries.length;tn++)pe(vr.geometries[tn],en);else if(Kt==="Feature")pe(vr.geometry,en);else if(Kt==="Polygon")Tt(vr.coordinates,en);else if(Kt==="MultiPolygon")for(tn=0;tn<vr.coordinates.length;tn++)Tt(vr.coordinates[tn],en);return vr})(he,!0);try{if(Se.filter){var K=y.createExpression(Se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(K.result==="error")throw new Error(K.value.map(function(pe){return pe.key+": "+pe.message}).join(", "));var ge=he.features.filter(function(pe){return K.value.evaluate({zoom:0},pe)});he={type:"FeatureCollection",features:ge}}X._geoJSONIndex=Se.cluster?new ar(function(pe){var vr=pe.superclusterOptions,en=pe.clusterProperties;if(!en||!vr)return vr;for(var tn={},Kt={},$r={accumulated:null,zoom:0},Br={properties:null},jr=Object.keys(en),ni=0,on=jr;ni<on.length;ni+=1){var di=on[ni],Fi=en[di],mi=Fi[0],Ci=y.createExpression(Fi[1]),Ri=y.createExpression(typeof mi=="string"?[mi,["accumulated"],["get",di]]:mi);tn[di]=Ci.value,Kt[di]=Ri.value}return vr.map=function(bo){Br.properties=bo;for(var Ki={},Sa=0,Mi=jr;Sa<Mi.length;Sa+=1){var gi=Mi[Sa];Ki[gi]=tn[gi].evaluate($r,Br)}return Ki},vr.reduce=function(bo,Ki){Br.properties=Ki;for(var Sa=0,Mi=jr;Sa<Mi.length;Sa+=1){var gi=Mi[Sa];$r.accumulated=bo[gi],bo[gi]=Kt[gi].evaluate($r,Br)}},vr}(Se)).load(he.features):function(pe,vr){return new De(pe,vr)}(he,Se.geojsonVtOptions)}catch(pe){return ee(pe)}X.loaded={};var Qe={};if(Ue){var gt=Ue.finish();gt&&(Qe.resourceTiming={},Qe.resourceTiming[Se.source]=JSON.parse(JSON.stringify(gt)))}ee(null,Qe)})}},F.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},F.prototype.reloadTile=function(X,ee){var Se=this.loaded;return Se&&Se[X.uid]?U.prototype.reloadTile.call(this,X,ee):this.loadTile(X,ee)},F.prototype.loadGeoJSON=function(X,ee){if(X.request)y.getJSON(X.request,ee);else{if(typeof X.data!="string")return ee(new Error("Input data given to '"+X.source+"' is not a valid GeoJSON object."));try{return ee(null,JSON.parse(X.data))}catch(Se){return ee(new Error("Input data given to '"+X.source+"' is not a valid GeoJSON object."))}}},F.prototype.removeSource=function(X,ee){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ee()},F.prototype.getClusterExpansionZoom=function(X,ee){try{ee(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(Se){ee(Se)}},F.prototype.getClusterChildren=function(X,ee){try{ee(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(Se){ee(Se)}},F.prototype.getClusterLeaves=function(X,ee){try{ee(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(Se){ee(Se)}},F}(rt),mt=function(U){var F=this;this.self=U,this.actor=new y.Actor(U,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:rt,geojson:At},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(X,ee){if(F.workerSourceTypes[X])throw new Error('Worker source with name "'+X+'" already registered.');F.workerSourceTypes[X]=ee},this.self.registerRTLTextPlugin=function(X){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=X.applyArabicShaping,y.plugin.processBidirectionalText=X.processBidirectionalText,y.plugin.processStyledBidirectionalText=X.processStyledBidirectionalText}};return mt.prototype.setReferrer=function(U,F){this.referrer=F},mt.prototype.setImages=function(U,F,X){for(var ee in this.availableImages[U]=F,this.workerSources[U]){var Se=this.workerSources[U][ee];for(var Ue in Se)Se[Ue].availableImages=F}X()},mt.prototype.setLayers=function(U,F,X){this.getLayerIndex(U).replace(F),X()},mt.prototype.updateLayers=function(U,F,X){this.getLayerIndex(U).update(F.layers,F.removedIds),X()},mt.prototype.loadTile=function(U,F,X){this.getWorkerSource(U,F.type,F.source).loadTile(F,X)},mt.prototype.loadDEMTile=function(U,F,X){this.getDEMWorkerSource(U,F.source).loadTile(F,X)},mt.prototype.reloadTile=function(U,F,X){this.getWorkerSource(U,F.type,F.source).reloadTile(F,X)},mt.prototype.abortTile=function(U,F,X){this.getWorkerSource(U,F.type,F.source).abortTile(F,X)},mt.prototype.removeTile=function(U,F,X){this.getWorkerSource(U,F.type,F.source).removeTile(F,X)},mt.prototype.removeDEMTile=function(U,F){this.getDEMWorkerSource(U,F.source).removeTile(F)},mt.prototype.removeSource=function(U,F,X){if(this.workerSources[U]&&this.workerSources[U][F.type]&&this.workerSources[U][F.type][F.source]){var ee=this.workerSources[U][F.type][F.source];delete this.workerSources[U][F.type][F.source],ee.removeSource!==void 0?ee.removeSource(F,X):X()}},mt.prototype.loadWorkerSource=function(U,F,X){try{this.self.importScripts(F.url),X()}catch(ee){X(ee.toString())}},mt.prototype.syncRTLPluginState=function(U,F,X){try{y.plugin.setState(F);var ee=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&ee!=null){this.self.importScripts(ee);var Se=y.plugin.isParsed();X(Se?void 0:new Error("RTL Text Plugin failed to import scripts from "+ee),Se)}}catch(Ue){X(Ue.toString())}},mt.prototype.getAvailableImages=function(U){var F=this.availableImages[U];return F||(F=[]),F},mt.prototype.getLayerIndex=function(U){var F=this.layerIndexes[U];return F||(F=this.layerIndexes[U]=new ce),F},mt.prototype.getWorkerSource=function(U,F,X){var ee=this;return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][F]||(this.workerSources[U][F]={}),this.workerSources[U][F][X]||(this.workerSources[U][F][X]=new this.workerSourceTypes[F]({send:function(Se,Ue,Je){ee.actor.send(Se,Ue,Je,U)}},this.getLayerIndex(U),this.getAvailableImages(U))),this.workerSources[U][F][X]},mt.prototype.getDEMWorkerSource=function(U,F){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][F]||(this.demWorkerSources[U][F]=new Ct),this.demWorkerSources[U][F]},mt.prototype.enforceCacheSizeLimit=function(U,F){y.enforceCacheSizeLimit(F)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new mt(self)),mt}),se(["./shared"],function(y){"use strict";var de=y.createCommonjsModule(function(h){function v(S){return!d(S)}function d(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,O,G=new Blob([""],{type:"text/javascript"}),J=URL.createObjectURL(G);try{O=new Worker(J),R=!0}catch(_e){R=!1}return O&&O.terminate(),URL.revokeObjectURL(J),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var O=R.getContext("2d");if(!O)return!1;var G=O.getImageData(0,0,1,1);return G&&G.width===R.width}()?(g[C=S&&S.failIfMajorPerformanceCaveat]===void 0&&(g[C]=function(R){var O=function(J){var _e=document.createElement("canvas"),be=Object.create(v.webGLContextAttributes);return be.failIfMajorPerformanceCaveat=J,_e.probablySupportsContext?_e.probablySupportsContext("webgl",be)||_e.probablySupportsContext("experimental-webgl",be):_e.supportsContext?_e.supportsContext("webgl",be)||_e.supportsContext("experimental-webgl",be):_e.getContext("webgl",be)||_e.getContext("experimental-webgl",be)}(R);if(!O)return!1;var G=O.createShader(O.VERTEX_SHADER);return!(!G||O.isContextLost())&&(O.shaderSource(G,"void main() {}"),O.compileShader(G),O.getShaderParameter(G,O.COMPILE_STATUS)===!0)}(C)),g[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}h.exports?h.exports=v:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=v,window.mapboxgl.notSupportedReason=d);var g={};v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),V={create:function(h,v,d){var g=y.window.document.createElement(h);return v!==void 0&&(g.className=v),d&&d.appendChild(g),g},createNS:function(h,v){return y.window.document.createElementNS(h,v)}},ce=y.window.document&&y.window.document.documentElement.style;function ae(h){if(!ce)return h[0];for(var v=0;v<h.length;v++)if(h[v]in ce)return h[v];return h[0]}var Be,ie=ae(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);V.disableDrag=function(){ce&&ie&&(Be=ce[ie],ce[ie]="none")},V.enableDrag=function(){ce&&ie&&(ce[ie]=Be)};var Ve=ae(["transform","WebkitTransform"]);V.setTransform=function(h,v){h.style[Ve]=v};var rt=!1;try{var it=Object.defineProperty({},"passive",{get:function(){rt=!0}});y.window.addEventListener("test",it,it),y.window.removeEventListener("test",it,it)}catch(h){rt=!1}V.addEventListener=function(h,v,d,g){g===void 0&&(g={}),h.addEventListener(v,d,"passive"in g&&rt?g:g.capture)},V.removeEventListener=function(h,v,d,g){g===void 0&&(g={}),h.removeEventListener(v,d,"passive"in g&&rt?g:g.capture)};var Ct=function(h){h.preventDefault(),h.stopPropagation(),y.window.removeEventListener("click",Ct,!0)};function Tt(h){var v=h.userImage;return!!(v&&v.render&&v.render())&&(h.data.replace(new Uint8Array(v.data.buffer)),!0)}V.suppressClick=function(){y.window.addEventListener("click",Ct,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",Ct,!0)},0)},V.mousePos=function(h,v){var d=h.getBoundingClientRect();return new y.Point(v.clientX-d.left-h.clientLeft,v.clientY-d.top-h.clientTop)},V.touchPos=function(h,v){for(var d=h.getBoundingClientRect(),g=[],S=0;S<v.length;S++)g.push(new y.Point(v[S].clientX-d.left-h.clientLeft,v[S].clientY-d.top-h.clientTop));return g},V.mouseButton=function(h){return y.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button},V.remove=function(h){h.parentNode&&h.parentNode.removeChild(h)};var Xt=function(h){function v(){h.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.isLoaded=function(){return this.loaded},v.prototype.setLoaded=function(d){if(this.loaded!==d&&(this.loaded=d,d)){for(var g=0,S=this.requestors;g<S.length;g+=1){var C=S[g];this._notify(C.ids,C.callback)}this.requestors=[]}},v.prototype.getImage=function(d){return this.images[d]},v.prototype.addImage=function(d,g){this._validate(d,g)&&(this.images[d]=g)},v.prototype._validate=function(d,g){var S=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+d+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+d+'" has invalid "stretchY" value'))),S=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+d+'" has invalid "content" value'))),S=!1),S},v.prototype._validateStretch=function(d,g){if(!d)return!0;for(var S=0,C=0,R=d;C<R.length;C+=1){var O=R[C];if(O[0]<S||O[1]<O[0]||g<O[1])return!1;S=O[1]}return!0},v.prototype._validateContent=function(d,g){return!(d&&(d.length!==4||d[0]<0||g.data.width<d[0]||d[1]<0||g.data.height<d[1]||d[2]<0||g.data.width<d[2]||d[3]<0||g.data.height<d[3]||d[2]<d[0]||d[3]<d[1]))},v.prototype.updateImage=function(d,g){g.version=this.images[d].version+1,this.images[d]=g,this.updatedImages[d]=!0},v.prototype.removeImage=function(d){var g=this.images[d];delete this.images[d],delete this.patterns[d],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},v.prototype.listImages=function(){return Object.keys(this.images)},v.prototype.getImages=function(d,g){var S=!0;if(!this.isLoaded())for(var C=0,R=d;C<R.length;C+=1)this.images[R[C]]||(S=!1);this.isLoaded()||S?this._notify(d,g):this.requestors.push({ids:d,callback:g})},v.prototype._notify=function(d,g){for(var S={},C=0,R=d;C<R.length;C+=1){var O=R[C];this.images[O]||this.fire(new y.Event("styleimagemissing",{id:O}));var G=this.images[O];G?S[O]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:Boolean(G.userImage&&G.userImage.render)}:y.warnOnce('Image "'+O+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,S)},v.prototype.getPixelSize=function(){var d=this.atlasImage;return{width:d.width,height:d.height}},v.prototype.getPattern=function(d){var g=this.patterns[d],S=this.getImage(d);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{var C={w:S.data.width+2,h:S.data.height+2,x:0,y:0},R=new y.ImagePosition(C,S);this.patterns[d]={bin:C,position:R}}return this._updatePatternAtlas(),this.patterns[d].position},v.prototype.bind=function(d){var g=d.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(d,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},v.prototype._updatePatternAtlas=function(){var d=[];for(var g in this.patterns)d.push(this.patterns[g].bin);var S=y.potpack(d),C=S.w,R=S.h,O=this.atlasImage;for(var G in O.resize({width:C||1,height:R||1}),this.patterns){var J=this.patterns[G].bin,_e=J.x+1,be=J.y+1,Te=this.images[G].data,We=Te.width,je=Te.height;y.RGBAImage.copy(Te,O,{x:0,y:0},{x:_e,y:be},{width:We,height:je}),y.RGBAImage.copy(Te,O,{x:0,y:je-1},{x:_e,y:be-1},{width:We,height:1}),y.RGBAImage.copy(Te,O,{x:0,y:0},{x:_e,y:be+je},{width:We,height:1}),y.RGBAImage.copy(Te,O,{x:We-1,y:0},{x:_e-1,y:be},{width:1,height:je}),y.RGBAImage.copy(Te,O,{x:0,y:0},{x:_e+We,y:be},{width:1,height:je})}this.dirty=!0},v.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},v.prototype.dispatchRenderCallbacks=function(d){for(var g=0,S=d;g<S.length;g+=1){var C=S[g];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var R=this.images[C];Tt(R)&&this.updateImage(C,R)}}},v}(y.Evented),ir=xt,Ft=xt,Rt=1e20;function xt(h,v,d,g,S,C){this.fontSize=h||24,this.buffer=v===void 0?3:v,this.cutoff=g||.25,this.fontFamily=S||"sans-serif",this.fontWeight=C||"normal",this.radius=d||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Zr(h,v,d,g,S,C,R){for(var O=0;O<v;O++){for(var G=0;G<d;G++)g[G]=h[G*v+O];for(Tr(g,S,C,R,d),G=0;G<d;G++)h[G*v+O]=S[G]}for(G=0;G<d;G++){for(O=0;O<v;O++)g[O]=h[G*v+O];for(Tr(g,S,C,R,v),O=0;O<v;O++)h[G*v+O]=Math.sqrt(S[O])}}function Tr(h,v,d,g,S){d[0]=0,g[0]=-Rt,g[1]=+Rt;for(var C=1,R=0;C<S;C++){for(var O=(h[C]+C*C-(h[d[R]]+d[R]*d[R]))/(2*C-2*d[R]);O<=g[R];)R--,O=(h[C]+C*C-(h[d[R]]+d[R]*d[R]))/(2*C-2*d[R]);d[++R]=C,g[R]=O,g[R+1]=+Rt}for(C=0,R=0;C<S;C++){for(;g[R+1]<C;)R++;v[C]=(C-d[R])*(C-d[R])+h[d[R]]}}xt.prototype.draw=function(h){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(h,this.buffer,this.middle);for(var v=this.ctx.getImageData(0,0,this.size,this.size),d=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var S=v.data[4*g+3]/255;this.gridOuter[g]=S===1?0:S===0?Rt:Math.pow(Math.max(0,.5-S),2),this.gridInner[g]=S===1?Rt:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(Zr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Zr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)d[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return d},ir.default=Ft;var dr=function(h,v){this.requestManager=h,this.localIdeographFontFamily=v,this.entries={}};dr.prototype.setURL=function(h){this.url=h},dr.prototype.getGlyphs=function(h,v){var d=this,g=[];for(var S in h)for(var C=0,R=h[S];C<R.length;C+=1)g.push({stack:S,id:R[C]});y.asyncAll(g,function(O,G){var J=O.stack,_e=O.id,be=d.entries[J];be||(be=d.entries[J]={glyphs:{},requests:{},ranges:{}});var Te=be.glyphs[_e];if(Te===void 0){if(Te=d._tinySDF(be,J,_e))return be.glyphs[_e]=Te,void G(null,{stack:J,id:_e,glyph:Te});var We=Math.floor(_e/256);if(256*We>65535)G(new Error("glyphs > 65535 not supported"));else if(be.ranges[We])G(null,{stack:J,id:_e,glyph:Te});else{var je=be.requests[We];je||(je=be.requests[We]=[],dr.loadGlyphRange(J,We,d.url,d.requestManager,function(at,Fe){if(Fe){for(var nt in Fe)d._doesCharSupportLocalGlyph(+nt)||(be.glyphs[+nt]=Fe[+nt]);be.ranges[We]=!0}for(var _t=0,Dt=je;_t<Dt.length;_t+=1)(0,Dt[_t])(at,Fe);delete be.requests[We]})),je.push(function(at,Fe){at?G(at):Fe&&G(null,{stack:J,id:_e,glyph:Fe[_e]||null})})}}else G(null,{stack:J,id:_e,glyph:Te})},function(O,G){if(O)v(O);else if(G){for(var J={},_e=0,be=G;_e<be.length;_e+=1){var Te=be[_e],We=Te.stack,je=Te.id,at=Te.glyph;(J[We]||(J[We]={}))[je]=at&&{id:at.id,bitmap:at.bitmap.clone(),metrics:at.metrics}}v(null,J)}})},dr.prototype._doesCharSupportLocalGlyph=function(h){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](h)||y.isChar["Hangul Syllables"](h)||y.isChar.Hiragana(h)||y.isChar.Katakana(h))},dr.prototype._tinySDF=function(h,v,d){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(d)){var S=h.tinySDF;if(!S){var C="400";/bold/i.test(v)?C="900":/medium/i.test(v)?C="500":/light/i.test(v)&&(C="200"),S=h.tinySDF=new dr.TinySDF(24,3,8,.25,g,C)}return{id:d,bitmap:new y.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(d))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},dr.loadGlyphRange=function(h,v,d,g,S){var C=256*v,R=C+255,O=g.transformRequest(g.normalizeGlyphsURL(d).replace("{fontstack}",h).replace("{range}",C+"-"+R),y.ResourceType.Glyphs);y.getArrayBuffer(O,function(G,J){if(G)S(G);else if(J){for(var _e={},be=0,Te=y.parseGlyphPBF(J);be<Te.length;be+=1){var We=Te[be];_e[We.id]=We}S(null,_e)}})},dr.TinySDF=ir;var Mt=function(){this.specification=y.styleSpec.light.position};Mt.prototype.possiblyEvaluate=function(h,v){return y.sphericalToCartesian(h.expression.evaluate(v))},Mt.prototype.interpolate=function(h,v,d){return{x:y.number(h.x,v.x,d),y:y.number(h.y,v.y,d),z:y.number(h.z,v.z,d)}};var lt=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Mt,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Bt=function(h){function v(d){h.call(this),this._transitionable=new y.Transitionable(lt),this.setLight(d),this._transitioning=this._transitionable.untransitioned()}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getLight=function(){return this._transitionable.serialize()},v.prototype.setLight=function(d,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,d,g))for(var S in d){var C=d[S];y.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-"-transition".length),C):this._transitionable.setValue(S,C)}},v.prototype.updateTransitions=function(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)},v.prototype.hasTransition=function(){return this._transitioning.hasTransition()},v.prototype.recalculate=function(d){this.properties=this._transitioning.possiblyEvaluate(d)},v.prototype._validate=function(d,g,S){return(!S||S.validate!==!1)&&y.emitValidationErrors(this,d.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},v}(y.Evented),pt=function(h,v){this.width=h,this.height=v,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};pt.prototype.getDash=function(h,v){var d=h.join(",")+String(v);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(h,v)),this.dashEntry[d]},pt.prototype.getDashRanges=function(h,v,d){var g=[],S=h.length%2==1?-h[h.length-1]*d:0,C=h[0]*d,R=!0;g.push({left:S,right:C,isDash:R,zeroLength:h[0]===0});for(var O=h[0],G=1;G<h.length;G++){var J=h[G];g.push({left:S=O*d,right:C=(O+=J)*d,isDash:R=!R,zeroLength:J===0})}return g},pt.prototype.addRoundDash=function(h,v,d){for(var g=v/2,S=-d;S<=d;S++)for(var C=this.width*(this.nextRow+d+S),R=0,O=h[R],G=0;G<this.width;G++){G/O.right>1&&(O=h[++R]);var J=Math.abs(G-O.left),_e=Math.abs(G-O.right),be=Math.min(J,_e),Te=void 0,We=S/d*(g+1);if(O.isDash){var je=g-Math.abs(We);Te=Math.sqrt(be*be+je*je)}else Te=g-Math.sqrt(be*be+We*We);this.data[C+G]=Math.max(0,Math.min(255,Te+128))}},pt.prototype.addRegularDash=function(h){for(var v=h.length-1;v>=0;--v){var d=h[v],g=h[v+1];d.zeroLength?h.splice(v,1):g&&g.isDash===d.isDash&&(g.left=d.left,h.splice(v,1))}var S=h[0],C=h[h.length-1];S.isDash===C.isDash&&(S.left=C.left-this.width,C.right=S.right+this.width);for(var R=this.width*this.nextRow,O=0,G=h[O],J=0;J<this.width;J++){J/G.right>1&&(G=h[++O]);var _e=Math.abs(J-G.left),be=Math.abs(J-G.right),Te=Math.min(_e,be);this.data[R+J]=Math.max(0,Math.min(255,(G.isDash?Te:-Te)+128))}},pt.prototype.addDash=function(h,v){var d=v?7:0,g=2*d+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var S=0,C=0;C<h.length;C++)S+=h[C];if(S!==0){var R=this.width/S,O=this.getDashRanges(h,this.width,R);v?this.addRoundDash(O,R,d):this.addRegularDash(O)}var G={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:S};return this.nextRow+=g,this.dirty=!0,G},pt.prototype.bind=function(h){var v=h.gl;this.texture?(v.bindTexture(v.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,v.texSubImage2D(v.TEXTURE_2D,0,0,0,this.width,this.height,v.ALPHA,v.UNSIGNED_BYTE,this.data))):(this.texture=v.createTexture(),v.bindTexture(v.TEXTURE_2D,this.texture),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texImage2D(v.TEXTURE_2D,0,v.ALPHA,this.width,this.height,0,v.ALPHA,v.UNSIGNED_BYTE,this.data))};var ur=function h(v,d){this.workerPool=v,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),S=0;S<g.length;S++){var C=new h.Actor(g[S],d,this.id);C.name="Worker "+S,this.actors.push(C)}};function Ar(h,v,d){var g=function(S,C){if(S)return d(S);if(C){var R=y.pick(y.extend(C,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(R.vectorLayers=C.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(O){return O.id})),R.tiles=v.canonicalizeTileset(R,h.url),d(null,R)}};return h.url?y.getJSON(v.transformRequest(v.normalizeSourceURL(h.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,h)})}ur.prototype.broadcast=function(h,v,d){y.asyncAll(this.actors,function(g,S){g.send(h,v,S)},d=d||function(){})},ur.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},ur.prototype.remove=function(){this.actors.forEach(function(h){h.remove()}),this.actors=[],this.workerPool.release(this.id)},ur.Actor=y.Actor;var te=function(h,v,d){this.bounds=y.LngLatBounds.convert(this.validateBounds(h)),this.minzoom=v||0,this.maxzoom=d||24};te.prototype.validateBounds=function(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]},te.prototype.contains=function(h){var v=Math.pow(2,h.z),d=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*v),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*v),S=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*v),C=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*v);return h.x>=d&&h.x<S&&h.y>=g&&h.y<C};var Ne=function(h){function v(d,g,S,C){if(h.call(this),this.id=d,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var d=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ar(this._options,this.map._requestManager,function(g,S){d._tileJSONRequest=null,d._loaded=!0,g?d.fire(new y.ErrorEvent(g)):S&&(y.extend(d,S),S.bounds&&(d.tileBounds=new te(S.bounds,d.minzoom,d.maxzoom)),y.postTurnstileEvent(S.tiles,d.map._requestManager._customAccessToken),y.postMapLoadEvent(S.tiles,d.map._getMapId(),d.map._requestManager._skuToken,d.map._requestManager._customAccessToken),d.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),d.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.hasTile=function(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.setSourceProperty=function(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},v.prototype.setTiles=function(d){var g=this;return this.setSourceProperty(function(){g._options.tiles=d}),this},v.prototype.setUrl=function(d){var g=this;return this.setSourceProperty(function(){g.url=d,g._options.url=d}),this},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return y.extend({},this._options)},v.prototype.loadTile=function(d,g){var S=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(S,y.ResourceType.Tile),uid:d.uid,tileID:d.tileID,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(O,G){return delete d.request,d.aborted?g(null):O&&O.status!==404?g(O):(G&&G.resourceTiming&&(d.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&d.setExpiryData(G),d.loadVectorData(G,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired"?d.state==="loading"?d.reloadCallback=g:d.request=d.actor.send("reloadTile",C,R.bind(this)):(d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",C,R.bind(this)))},v.prototype.abortTile=function(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id},void 0)},v.prototype.unloadTile=function(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id},void 0)},v.prototype.hasTransition=function(){return!1},v}(y.Evented),k=function(h){function v(d,g,S,C){h.call(this),this.id=d,this.dispatcher=S,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var d=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ar(this._options,this.map._requestManager,function(g,S){d._tileJSONRequest=null,d._loaded=!0,g?d.fire(new y.ErrorEvent(g)):S&&(y.extend(d,S),S.bounds&&(d.tileBounds=new te(S.bounds,d.minzoom,d.maxzoom)),y.postTurnstileEvent(S.tiles),y.postMapLoadEvent(S.tiles,d.map._getMapId(),d.map._requestManager._skuToken),d.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),d.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return y.extend({},this._options)},v.prototype.hasTile=function(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)},v.prototype.loadTile=function(d,g){var S=this,C=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);d.request=y.getImage(this.map._requestManager.transformRequest(C,y.ResourceType.Tile),function(R,O){if(delete d.request,d.aborted)d.state="unloaded",g(null);else if(R)d.state="errored",g(R);else if(O){S.map._refreshExpiredTiles&&d.setExpiryData(O),delete O.cacheControl,delete O.expires;var G=S.map.painter.context,J=G.gl;d.texture=S.map.painter.getTileTexture(O.width),d.texture?d.texture.update(O,{useMipmap:!0}):(d.texture=new y.Texture(G,O,J.RGBA,{useMipmap:!0}),d.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&J.texParameterf(J.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),d.state="loaded",y.cacheEntryPossiblyAdded(S.dispatcher),g(null)}})},v.prototype.abortTile=function(d,g){d.request&&(d.request.cancel(),delete d.request),g()},v.prototype.unloadTile=function(d,g){d.texture&&this.map.painter.saveTileTexture(d.texture),g()},v.prototype.hasTransition=function(){return!1},v}(y.Evented),ke=function(h){function v(d,g,S,C){h.call(this,d,g,S,C),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},v.prototype.loadTile=function(d,g){var S=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(R,O){R&&(d.state="errored",g(R)),O&&(d.dem=O,d.needsHillshadePrepare=!0,d.state="loaded",g(null))}d.request=y.getImage(this.map._requestManager.transformRequest(S,y.ResourceType.Tile),function(R,O){if(delete d.request,d.aborted)d.state="unloaded",g(null);else if(R)d.state="errored",g(R);else if(O){this.map._refreshExpiredTiles&&d.setExpiryData(O),delete O.cacheControl,delete O.expires;var G=y.window.ImageBitmap&&O instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?O:y.browser.getImageData(O,1),J={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:G,encoding:this.encoding};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",J,C.bind(this)))}}.bind(this)),d.neighboringTiles=this._getNeighboringTiles(d.tileID)},v.prototype._getNeighboringTiles=function(d){var g=d.canonical,S=Math.pow(2,g.z),C=(g.x-1+S)%S,R=g.x===0?d.wrap-1:d.wrap,O=(g.x+1+S)%S,G=g.x+1===S?d.wrap+1:d.wrap,J={};return J[new y.OverscaledTileID(d.overscaledZ,R,g.z,C,g.y).key]={backfilled:!1},J[new y.OverscaledTileID(d.overscaledZ,G,g.z,O,g.y).key]={backfilled:!1},g.y>0&&(J[new y.OverscaledTileID(d.overscaledZ,R,g.z,C,g.y-1).key]={backfilled:!1},J[new y.OverscaledTileID(d.overscaledZ,d.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},J[new y.OverscaledTileID(d.overscaledZ,G,g.z,O,g.y-1).key]={backfilled:!1}),g.y+1<S&&(J[new y.OverscaledTileID(d.overscaledZ,R,g.z,C,g.y+1).key]={backfilled:!1},J[new y.OverscaledTileID(d.overscaledZ,d.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},J[new y.OverscaledTileID(d.overscaledZ,G,g.z,O,g.y+1).key]={backfilled:!1}),J},v.prototype.unloadTile=function(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded",d.actor&&d.actor.send("removeDEMTile",{uid:d.uid,source:this.id})},v}(k),Re=function(h){function v(d,g,S,C){h.call(this),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(C),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var R=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*R,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*R,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*R,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var d=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)d.fire(new y.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"metadata"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(S.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new y.Event("data",S))}})},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.setData=function(d){var g=this;return this._data=d,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)g.fire(new y.ErrorEvent(S));else{var C={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(C.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",C))}}),this},v.prototype.getClusterExpansionZoom=function(d,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},g),this},v.prototype.getClusterChildren=function(d,g){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},g),this},v.prototype.getClusterLeaves=function(d,g,S,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:g,offset:S},C),this},v.prototype._updateWorkerData=function(d){var g=this;this._loaded=!1;var S=y.extend({},this.workerOptions),C=this._data;typeof C=="string"?(S.request=this.map._requestManager.transformRequest(y.browser.resolveURL(C),y.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(C),this.actor.send(this.type+".loadData",S,function(R,O){g._removed||O&&O.abandoned||(g._loaded=!0,O&&O.resourceTiming&&O.resourceTiming[g.id]&&(g._resourceTiming=O.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:S.source},null),d(R))})},v.prototype.loaded=function(){return this._loaded},v.prototype.loadTile=function(d,g){var S=this,C=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(C,{type:this.type,uid:d.uid,tileID:d.tileID,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,O){return delete d.request,d.unloadVectorData(),d.aborted?g(null):R?g(R):(d.loadVectorData(O,S.map.painter,C==="reloadTile"),g(null))})},v.prototype.abortTile=function(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0},v.prototype.unloadTile=function(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})},v.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},v.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},v.prototype.hasTransition=function(){return!1},v}(y.Evented),ct=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Et=function(h){function v(d,g,S,C){h.call(this),this.id=d,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(d,g){var S=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(C,R){S._loaded=!0,C?S.fire(new y.ErrorEvent(C)):R&&(S.image=R,d&&(S.coordinates=d),g&&g(),S._finishLoading())})},v.prototype.loaded=function(){return this._loaded},v.prototype.updateImage=function(d){var g=this;return this.image&&d.url?(this.options.url=d.url,this.load(d.coordinates,function(){g.texture=null}),this):this},v.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.setCoordinates=function(d){var g=this;this.coordinates=d;var S=d.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var O=1/0,G=1/0,J=-1/0,_e=-1/0,be=0,Te=R;be<Te.length;be+=1){var We=Te[be];O=Math.min(O,We.x),G=Math.min(G,We.y),J=Math.max(J,We.x),_e=Math.max(_e,We.y)}var je=Math.max(J-O,_e-G),at=Math.max(0,Math.floor(-Math.log(je)/Math.LN2)),Fe=Math.pow(2,at);return new y.CanonicalTileID(at,Math.floor((O+J)/2*Fe),Math.floor((G+_e)/2*Fe))}(S),this.minzoom=this.maxzoom=this.tileID.z;var C=S.map(function(R){return g.tileID.getTilePoint(R)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},v.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var d=this.map.painter.context,g=d.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,ct.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(d,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},v.prototype.loadTile=function(d,g){this.tileID&&this.tileID.equals(d.tileID.canonical)?(this.tiles[String(d.tileID.wrap)]=d,d.buckets={},g(null)):(d.state="errored",g(null))},v.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return!1},v}(y.Evented),kt=function(h){function v(d,g,S,C){h.call(this,d,g,S,C),this.roundZoom=!0,this.type="video",this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var d=this;this._loaded=!1;var g=this.options;this.urls=[];for(var S=0,C=g.urls;S<C.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(C[S],y.ResourceType.Source).url);y.getVideo(this.urls,function(R,O){d._loaded=!0,R?d.fire(new y.ErrorEvent(R)):O&&(d.video=O,d.video.loop=!0,d.video.setAttribute("playsinline",""),d.video.addEventListener("playing",function(){d.map.triggerRepaint()}),d.map&&d.video.play(),d._finishLoading())})},v.prototype.pause=function(){this.video&&this.video.pause()},v.prototype.play=function(){this.video&&this.video.play()},v.prototype.seek=function(d){if(this.video){var g=this.video.seekable;d<g.start(0)||d>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=d}},v.prototype.getVideo=function(){return this.video},v.prototype.onAdd=function(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},v.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var d=this.map.painter.context,g=d.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,ct.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(d,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this.video&&!this.video.paused},v}(Et),er=function(h){function v(d,g,S,C){h.call(this,d,g,S,C),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(O){return typeof O!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+d,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+d,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+d,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+d,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+d,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},v.prototype.getCanvas=function(){return this.canvas},v.prototype.onAdd=function(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()},v.prototype.onRemove=function(){this.pause()},v.prototype.prepare=function(){var d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,S=g.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,ct.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[C];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this._playing},v.prototype._hasInvalidDimensions=function(){for(var d=0,g=[this.canvas.width,this.canvas.height];d<g.length;d+=1){var S=g[d];if(isNaN(S)||S<=0)return!0}return!1},v}(Et),rr={vector:Ne,raster:k,"raster-dem":ke,geojson:Re,video:kt,image:Et,canvas:er};function fn(h,v){var d=y.identity([]);return y.translate(d,d,[1,1,0]),y.scale(d,d,[.5*h.width,.5*h.height,1]),y.multiply(d,d,h.calculatePosMatrix(v.toUnwrapped()))}function ar(h,v,d,g,S,C){var R=function(at,Fe,nt){if(at)for(var _t=0,Dt=at;_t<Dt.length;_t+=1){var nr=Fe[Dt[_t]];if(nr&&nr.source===nt&&nr.type==="fill-extrusion")return!0}else for(var $t in Fe){var cr=Fe[$t];if(cr.source===nt&&cr.type==="fill-extrusion")return!0}return!1}(S&&S.layers,v,h.id),O=C.maxPitchScaleFactor(),G=h.tilesIn(g,O,R);G.sort(Dn);for(var J=[],_e=0,be=G;_e<be.length;_e+=1){var Te=be[_e];J.push({wrappedTileID:Te.tileID.wrapped().key,queryResults:Te.tile.queryRenderedFeatures(v,d,h._state,Te.queryGeometry,Te.cameraQueryGeometry,Te.scale,S,C,O,fn(h.transform,Te.tileID))})}var We=function(at){for(var Fe={},nt={},_t=0,Dt=at;_t<Dt.length;_t+=1){var nr=Dt[_t],$t=nr.queryResults,cr=nr.wrappedTileID,yr=nt[cr]=nt[cr]||{};for(var Hr in $t)for(var Nr=$t[Hr],dn=yr[Hr]=yr[Hr]||{},Nn=Fe[Hr]=Fe[Hr]||[],Bn=0,zn=Nr;Bn<zn.length;Bn+=1){var Ni=zn[Bn];dn[Ni.featureIndex]||(dn[Ni.featureIndex]=!0,Nn.push(Ni))}}return Fe}(J);for(var je in We)We[je].forEach(function(at){var Fe=at.feature,nt=h.getFeatureState(Fe.layer["source-layer"],Fe.id);Fe.source=Fe.layer.source,Fe.layer["source-layer"]&&(Fe.sourceLayer=Fe.layer["source-layer"]),Fe.state=nt});return We}function Dn(h,v){var d=h.tileID,g=v.tileID;return d.overscaledZ-g.overscaledZ||d.canonical.y-g.canonical.y||d.wrap-g.wrap||d.canonical.x-g.canonical.x}var hn=function(h,v){this.max=h,this.onRemove=v,this.reset()};hn.prototype.reset=function(){for(var h in this.data)for(var v=0,d=this.data[h];v<d.length;v+=1){var g=d[v];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},hn.prototype.add=function(h,v,d){var g=this,S=h.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var C={value:v,timeout:void 0};if(d!==void 0&&(C.timeout=setTimeout(function(){g.remove(h,C)},d)),this.data[S].push(C),this.order.push(S),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},hn.prototype.has=function(h){return h.wrapped().key in this.data},hn.prototype.getAndRemove=function(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null},hn.prototype._getAndRemoveByKey=function(h){var v=this.data[h].shift();return v.timeout&&clearTimeout(v.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),v.value},hn.prototype.getByKey=function(h){var v=this.data[h];return v?v[0].value:null},hn.prototype.get=function(h){return this.has(h)?this.data[h.wrapped().key][0].value:null},hn.prototype.remove=function(h,v){if(!this.has(h))return this;var d=h.wrapped().key,g=v===void 0?0:this.data[d].indexOf(v),S=this.data[d][g];return this.data[d].splice(g,1),S.timeout&&clearTimeout(S.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(S.value),this.order.splice(this.order.indexOf(d),1),this},hn.prototype.setMaxSize=function(h){for(this.max=h;this.order.length>this.max;){var v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this},hn.prototype.filter=function(h){var v=[];for(var d in this.data)for(var g=0,S=this.data[d];g<S.length;g+=1){var C=S[g];h(C.value)||v.push(C)}for(var R=0,O=v;R<O.length;R+=1){var G=O[R];this.remove(G.value.tileID,G)}};var nn=function(h,v,d){this.context=h;var g=h.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};nn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},nn.prototype.updateData=function(h){var v=this.context.gl;this.context.unbindVAO(),this.bind(),v.bufferSubData(v.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)},nn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ri={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},qn=function(h,v,d,g){this.length=v.length,this.attributes=d,this.itemSize=v.bytesPerElement,this.dynamicDraw=g,this.context=h;var S=h.gl;this.buffer=S.createBuffer(),h.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};qn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},qn.prototype.updateData=function(h){var v=this.context.gl;this.bind(),v.bufferSubData(v.ARRAY_BUFFER,0,h.arrayBuffer)},qn.prototype.enableAttributes=function(h,v){for(var d=0;d<this.attributes.length;d++){var g=v.attributes[this.attributes[d].name];g!==void 0&&h.enableVertexAttribArray(g)}},qn.prototype.setVertexAttribPointers=function(h,v,d){for(var g=0;g<this.attributes.length;g++){var S=this.attributes[g],C=v.attributes[S.name];C!==void 0&&h.vertexAttribPointer(C,S.components,h[ri[S.type]],!1,this.itemSize,S.offset+this.itemSize*(d||0))}},qn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var En=function(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};En.prototype.get=function(){return this.current},En.prototype.set=function(h){},En.prototype.getDefault=function(){return this.default},En.prototype.setDefault=function(){this.set(this.default)};var Ti=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return y.Color.transparent},v.prototype.set=function(d){var g=this.current;(d.r!==g.r||d.g!==g.g||d.b!==g.b||d.a!==g.a||this.dirty)&&(this.gl.clearColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)},v}(En),hi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 1},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.clearDepth(d),this.current=d,this.dirty=!1)},v}(En),ea=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 0},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.clearStencil(d),this.current=d,this.dirty=!1)},v}(En),Tn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[!0,!0,!0,!0]},v.prototype.set=function(d){var g=this.current;(d[0]!==g[0]||d[1]!==g[1]||d[2]!==g[2]||d[3]!==g[3]||this.dirty)&&(this.gl.colorMask(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)},v}(En),kn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!0},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.depthMask(d),this.current=d,this.dirty=!1)},v}(En),Ea=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 255},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.stencilMask(d),this.current=d,this.dirty=!1)},v}(En),ji=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},v.prototype.set=function(d){var g=this.current;(d.func!==g.func||d.ref!==g.ref||d.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(d.func,d.ref,d.mask),this.current=d,this.dirty=!1)},v}(En),ja=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var d=this.gl;return[d.KEEP,d.KEEP,d.KEEP]},v.prototype.set=function(d){var g=this.current;(d[0]!==g[0]||d[1]!==g[1]||d[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(d[0],d[1],d[2]),this.current=d,this.dirty=!1)},v}(En),Ha=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;d?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=d,this.dirty=!1}},v}(En),Me=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[0,1]},v.prototype.set=function(d){var g=this.current;(d[0]!==g[0]||d[1]!==g[1]||this.dirty)&&(this.gl.depthRange(d[0],d[1]),this.current=d,this.dirty=!1)},v}(En),Wa=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;d?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=d,this.dirty=!1}},v}(En),sa=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.LESS},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.depthFunc(d),this.current=d,this.dirty=!1)},v}(En),eo=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;d?g.enable(g.BLEND):g.disable(g.BLEND),this.current=d,this.dirty=!1}},v}(En),Ws=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var d=this.gl;return[d.ONE,d.ZERO]},v.prototype.set=function(d){var g=this.current;(d[0]!==g[0]||d[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(d[0],d[1]),this.current=d,this.dirty=!1)},v}(En),xs=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return y.Color.transparent},v.prototype.set=function(d){var g=this.current;(d.r!==g.r||d.g!==g.g||d.b!==g.b||d.a!==g.a||this.dirty)&&(this.gl.blendColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)},v}(En),bs=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.FUNC_ADD},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.blendEquation(d),this.current=d,this.dirty=!1)},v}(En),Vt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;d?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=d,this.dirty=!1}},v}(En),gr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.BACK},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.cullFace(d),this.current=d,this.dirty=!1)},v}(En),Gr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.CCW},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.frontFace(d),this.current=d,this.dirty=!1)},v}(En),an=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)},v}(En),Zn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.TEXTURE0},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.activeTexture(d),this.current=d,this.dirty=!1)},v}(En),Hi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var d=this.gl;return[0,0,d.drawingBufferWidth,d.drawingBufferHeight]},v.prototype.set=function(d){var g=this.current;(d[0]!==g[0]||d[1]!==g[1]||d[2]!==g[2]||d[3]!==g[3]||this.dirty)&&(this.gl.viewport(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)},v}(En),fe=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,d),this.current=d,this.dirty=!1}},v}(En),D=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,d),this.current=d,this.dirty=!1}},v}(En),z=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,d),this.current=d,this.dirty=!1}},v}(En),ne=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,d),this.current=d,this.dirty=!1}},v}(En),Ae=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,d),this.current=d,this.dirty=!1},v}(En),De=function(h){function v(d){h.call(this,d),this.vao=d.extVertexArrayObject}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){this.vao&&(d!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(d),this.current=d,this.dirty=!1)},v}(En),Zt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 4},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,d),this.current=d,this.dirty=!1}},v}(En),St=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),this.current=d,this.dirty=!1}},v}(En),At=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,d),this.current=d,this.dirty=!1}},v}(En),mt=function(h){function v(d,g){h.call(this,d),this.context=d,this.parent=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v}(En),U=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.setDirty=function(){this.dirty=!0},v.prototype.set=function(d){if(d!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,d,0),this.current=d,this.dirty=!1}},v}(mt),F=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.set=function(d){if(d!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,d),this.current=d,this.dirty=!1}},v}(mt),X=function(h,v,d,g){this.context=h,this.width=v,this.height=d;var S=this.framebuffer=h.gl.createFramebuffer();this.colorAttachment=new U(h,S),g&&(this.depthAttachment=new F(h,S))};X.prototype.destroy=function(){var h=this.context.gl,v=this.colorAttachment.get();if(v&&h.deleteTexture(v),this.depthAttachment){var d=this.depthAttachment.get();d&&h.deleteRenderbuffer(d)}h.deleteFramebuffer(this.framebuffer)};var ee=function(h,v,d){this.func=h,this.mask=v,this.range=d};ee.ReadOnly=!1,ee.ReadWrite=!0,ee.disabled=new ee(519,ee.ReadOnly,[0,1]);var Se=function(h,v,d,g,S,C){this.test=h,this.ref=v,this.mask=d,this.fail=g,this.depthFail=S,this.pass=C};Se.disabled=new Se({func:519,mask:0},0,0,7680,7680,7680);var Ue=function(h,v,d){this.blendFunction=h,this.blendColor=v,this.mask=d};Ue.disabled=new Ue(Ue.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),Ue.unblended=new Ue(Ue.Replace,y.Color.transparent,[!0,!0,!0,!0]),Ue.alphaBlended=new Ue([1,771],y.Color.transparent,[!0,!0,!0,!0]);var Je=function(h,v,d){this.enable=h,this.mode=v,this.frontFace=d};Je.disabled=new Je(!1,1029,2305),Je.backCCW=new Je(!0,1029,2305);var he=function(h){this.gl=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ti(this),this.clearDepth=new hi(this),this.clearStencil=new ea(this),this.colorMask=new Tn(this),this.depthMask=new kn(this),this.stencilMask=new Ea(this),this.stencilFunc=new ji(this),this.stencilOp=new ja(this),this.stencilTest=new Ha(this),this.depthRange=new Me(this),this.depthTest=new Wa(this),this.depthFunc=new sa(this),this.blend=new eo(this),this.blendFunc=new Ws(this),this.blendColor=new xs(this),this.blendEquation=new bs(this),this.cullFace=new Vt(this),this.cullFaceSide=new gr(this),this.frontFace=new Gr(this),this.program=new an(this),this.activeTexture=new Zn(this),this.viewport=new Hi(this),this.bindFramebuffer=new fe(this),this.bindRenderbuffer=new D(this),this.bindTexture=new z(this),this.bindVertexBuffer=new ne(this),this.bindElementBuffer=new Ae(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new De(this),this.pixelStoreUnpack=new Zt(this),this.pixelStoreUnpackPremultiplyAlpha=new St(this),this.pixelStoreUnpackFlipY=new At(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=h.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(h.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=h.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=h.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE)};he.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},he.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},he.prototype.createIndexBuffer=function(h,v){return new nn(this,h,v)},he.prototype.createVertexBuffer=function(h,v,d){return new qn(this,h,v,d)},he.prototype.createRenderbuffer=function(h,v,d){var g=this.gl,S=g.createRenderbuffer();return this.bindRenderbuffer.set(S),g.renderbufferStorage(g.RENDERBUFFER,h,v,d),this.bindRenderbuffer.set(null),S},he.prototype.createFramebuffer=function(h,v,d){return new X(this,h,v,d)},he.prototype.clear=function(h){var v=h.color,d=h.depth,g=this.gl,S=0;v&&(S|=g.COLOR_BUFFER_BIT,this.clearColor.set(v),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(S|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),g.clear(S)},he.prototype.setCullFace=function(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))},he.prototype.setDepthMode=function(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)},he.prototype.setStencilMode=function(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)},he.prototype.setColorMode=function(h){y.deepEqual(h.blendFunction,Ue.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)},he.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var K=function(h){function v(d,g,S){var C=this;h.call(this),this.id=d,this.dispatcher=S,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(R,O,G,J){var _e=new rr[O.type](R,O,G,J);if(_e.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+_e.id);return y.bindAll(["load","abort","unload","serialize","prepare"],_e),_e}(d,g,S,this),this._tiles={},this._cache=new hn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(d){this.map=d,this._maxTileCacheSize=d?d._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(d)},v.prototype.onRemove=function(d){this._source&&this._source.onRemove&&this._source.onRemove(d)},v.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var d in this._tiles){var g=this._tiles[d];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},v.prototype.getSource=function(){return this._source},v.prototype.pause=function(){this._paused=!0},v.prototype.resume=function(){if(this._paused){var d=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,d&&this.reload(),this.transform&&this.update(this.transform)}},v.prototype._loadTile=function(d,g){return this._source.loadTile(d,g)},v.prototype._unloadTile=function(d){if(this._source.unloadTile)return this._source.unloadTile(d,function(){})},v.prototype._abortTile=function(d){if(this._source.abortTile)return this._source.abortTile(d,function(){})},v.prototype.serialize=function(){return this._source.serialize()},v.prototype.prepare=function(d){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[g];S.upload(d),S.prepare(this.map.style.imageManager)}},v.prototype.getIds=function(){return y.values(this._tiles).map(function(d){return d.tileID}).sort(ge).map(function(d){return d.key})},v.prototype.getRenderableIds=function(d){var g=this,S=[];for(var C in this._tiles)this._isIdRenderable(C,d)&&S.push(this._tiles[C]);return d?S.sort(function(R,O){var G=R.tileID,J=O.tileID,_e=new y.Point(G.canonical.x,G.canonical.y)._rotate(g.transform.angle),be=new y.Point(J.canonical.x,J.canonical.y)._rotate(g.transform.angle);return G.overscaledZ-J.overscaledZ||be.y-_e.y||be.x-_e.x}).map(function(R){return R.tileID.key}):S.map(function(R){return R.tileID}).sort(ge).map(function(R){return R.key})},v.prototype.hasRenderableParent=function(d){var g=this.findLoadedParent(d,0);return!!g&&this._isIdRenderable(g.tileID.key)},v.prototype._isIdRenderable=function(d,g){return this._tiles[d]&&this._tiles[d].hasData()&&!this._coveredTiles[d]&&(g||!this._tiles[d].holdingForFade())},v.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var d in this._cache.reset(),this._tiles)this._tiles[d].state!=="errored"&&this._reloadTile(d,"reloading")},v.prototype._reloadTile=function(d,g){var S=this._tiles[d];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,d,g)))},v.prototype._tileLoaded=function(d,g,S,C){if(C)return d.state="errored",void(C.status!==404?this._source.fire(new y.ErrorEvent(C,{tile:d})):this.update(this.transform));d.timeAdded=y.browser.now(),S==="expired"&&(d.refreshedUponExpiration=!0),this._setTileReloadTimer(g,d),this.getSource().type==="raster-dem"&&d.dem&&this._backfillDEM(d),this._state.initializeTileState(d,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:d,coord:d.tileID}))},v.prototype._backfillDEM=function(d){for(var g=this.getRenderableIds(),S=0;S<g.length;S++){var C=g[S];if(d.neighboringTiles&&d.neighboringTiles[C]){var R=this.getTileByID(C);O(d,R),O(R,d)}}function O(G,J){G.needsHillshadePrepare=!0;var _e=J.tileID.canonical.x-G.tileID.canonical.x,be=J.tileID.canonical.y-G.tileID.canonical.y,Te=Math.pow(2,G.tileID.canonical.z),We=J.tileID.key;_e===0&&be===0||Math.abs(be)>1||(Math.abs(_e)>1&&(Math.abs(_e+Te)===1?_e+=Te:Math.abs(_e-Te)===1&&(_e-=Te)),J.dem&&G.dem&&(G.dem.backfillBorder(J.dem,_e,be),G.neighboringTiles&&G.neighboringTiles[We]&&(G.neighboringTiles[We].backfilled=!0)))}},v.prototype.getTile=function(d){return this.getTileByID(d.key)},v.prototype.getTileByID=function(d){return this._tiles[d]},v.prototype._retainLoadedChildren=function(d,g,S,C){for(var R in this._tiles){var O=this._tiles[R];if(!(C[R]||!O.hasData()||O.tileID.overscaledZ<=g||O.tileID.overscaledZ>S)){for(var G=O.tileID;O&&O.tileID.overscaledZ>g+1;){var J=O.tileID.scaledTo(O.tileID.overscaledZ-1);(O=this._tiles[J.key])&&O.hasData()&&(G=J)}for(var _e=G;_e.overscaledZ>g;)if(d[(_e=_e.scaledTo(_e.overscaledZ-1)).key]){C[G.key]=G;break}}}},v.prototype.findLoadedParent=function(d,g){if(d.key in this._loadedParentTiles){var S=this._loadedParentTiles[d.key];return S&&S.tileID.overscaledZ>=g?S:null}for(var C=d.overscaledZ-1;C>=g;C--){var R=d.scaledTo(C),O=this._getLoadedTile(R);if(O)return O}},v.prototype._getLoadedTile=function(d){var g=this._tiles[d.key];return g&&g.hasData()?g:this._cache.getByKey(d.wrapped().key)},v.prototype.updateCacheSize=function(d){var g=Math.ceil(d.width/this._source.tileSize)+1,S=Math.ceil(d.height/this._source.tileSize)+1,C=Math.floor(g*S*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(R)},v.prototype.handleWrapJump=function(d){var g=Math.round((d-(this._prevLng===void 0?d:this._prevLng))/360);if(this._prevLng=d,g){var S={};for(var C in this._tiles){var R=this._tiles[C];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+g),S[R.tileID.key]=R}for(var O in this._tiles=S,this._timers)clearTimeout(this._timers[O]),delete this._timers[O];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},v.prototype.update=function(d){var g=this;if(this.transform=d,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(d),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=d.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(yr){return new y.OverscaledTileID(yr.canonical.z,yr.wrap,yr.canonical.z,yr.canonical.x,yr.canonical.y)}):(S=d.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(yr){return g._source.hasTile(yr)}))):S=[];var C=d.coveringZoomLevel(this._source),R=Math.max(C-v.maxOverzooming,this._source.minzoom),O=Math.max(C+v.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(S,C);if(Qe(this._source.type)){for(var J={},_e={},be=0,Te=Object.keys(G);be<Te.length;be+=1){var We=Te[be],je=G[We],at=this._tiles[We];if(at&&!(at.fadeEndTime&&at.fadeEndTime<=y.browser.now())){var Fe=this.findLoadedParent(je,R);Fe&&(this._addTile(Fe.tileID),J[Fe.tileID.key]=Fe.tileID),_e[We]=je}}for(var nt in this._retainLoadedChildren(_e,C,O,G),J)G[nt]||(this._coveredTiles[nt]=!0,G[nt]=J[nt])}for(var _t in G)this._tiles[_t].clearFadeHold();for(var Dt=0,nr=y.keysDifference(this._tiles,G);Dt<nr.length;Dt+=1){var $t=nr[Dt],cr=this._tiles[$t];cr.hasSymbolBuckets&&!cr.holdingForFade()?cr.setHoldDuration(this.map._fadeDuration):cr.hasSymbolBuckets&&!cr.symbolFadeFinished()||this._removeTile($t)}this._updateLoadedParentTileCache()}},v.prototype.releaseSymbolFadeTiles=function(){for(var d in this._tiles)this._tiles[d].holdingForFade()&&this._removeTile(d)},v.prototype._updateRetainedTiles=function(d,g){for(var S={},C={},R=Math.max(g-v.maxOverzooming,this._source.minzoom),O=Math.max(g+v.maxUnderzooming,this._source.minzoom),G={},J=0,_e=d;J<_e.length;J+=1){var be=_e[J],Te=this._addTile(be);S[be.key]=be,Te.hasData()||g<this._source.maxzoom&&(G[be.key]=be)}this._retainLoadedChildren(G,g,O,S);for(var We=0,je=d;We<je.length;We+=1){var at=je[We],Fe=this._tiles[at.key];if(!Fe.hasData()){if(g+1>this._source.maxzoom){var nt=at.children(this._source.maxzoom)[0],_t=this.getTile(nt);if(_t&&_t.hasData()){S[nt.key]=nt;continue}}else{var Dt=at.children(this._source.maxzoom);if(S[Dt[0].key]&&S[Dt[1].key]&&S[Dt[2].key]&&S[Dt[3].key])continue}for(var nr=Fe.wasRequested(),$t=at.overscaledZ-1;$t>=R;--$t){var cr=at.scaledTo($t);if(C[cr.key]||(C[cr.key]=!0,!(Fe=this.getTile(cr))&&nr&&(Fe=this._addTile(cr)),Fe&&(S[cr.key]=cr,nr=Fe.wasRequested(),Fe.hasData())))break}}}return S},v.prototype._updateLoadedParentTileCache=function(){for(var d in this._loadedParentTiles={},this._tiles){for(var g=[],S=void 0,C=this._tiles[d].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){S=this._loadedParentTiles[C.key];break}g.push(C.key);var R=C.scaledTo(C.overscaledZ-1);if(S=this._getLoadedTile(R))break;C=R}for(var O=0,G=g;O<G.length;O+=1)this._loadedParentTiles[G[O]]=S}},v.prototype._addTile=function(d){var g=this._tiles[d.key];if(g)return g;(g=this._cache.getAndRemove(d))&&(this._setTileReloadTimer(d.key,g),g.tileID=d,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[d.key]&&(clearTimeout(this._cacheTimers[d.key]),delete this._cacheTimers[d.key],this._setTileReloadTimer(d.key,g)));var S=Boolean(g);return S||(g=new y.Tile(d,this._source.tileSize*d.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,d.key,g.state))),g?(g.uses++,this._tiles[d.key]=g,S||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},v.prototype._setTileReloadTimer=function(d,g){var S=this;d in this._timers&&(clearTimeout(this._timers[d]),delete this._timers[d]);var C=g.getExpiryTimeout();C&&(this._timers[d]=setTimeout(function(){S._reloadTile(d,"expired"),delete S._timers[d]},C))},v.prototype._removeTile=function(d){var g=this._tiles[d];g&&(g.uses--,delete this._tiles[d],this._timers[d]&&(clearTimeout(this._timers[d]),delete this._timers[d]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},v.prototype.clearTiles=function(){for(var d in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(d);this._cache.reset()},v.prototype.tilesIn=function(d,g,S){var C=this,R=[],O=this.transform;if(!O)return R;for(var G=S?O.getCameraQueryGeometry(d):d,J=d.map(function($t){return O.pointCoordinate($t)}),_e=G.map(function($t){return O.pointCoordinate($t)}),be=this.getIds(),Te=1/0,We=1/0,je=-1/0,at=-1/0,Fe=0,nt=_e;Fe<nt.length;Fe+=1){var _t=nt[Fe];Te=Math.min(Te,_t.x),We=Math.min(We,_t.y),je=Math.max(je,_t.x),at=Math.max(at,_t.y)}for(var Dt=function($t){var cr=C._tiles[be[$t]];if(!cr.holdingForFade()){var yr=cr.tileID,Hr=Math.pow(2,O.zoom-cr.tileID.overscaledZ),Nr=g*cr.queryPadding*y.EXTENT/cr.tileSize/Hr,dn=[yr.getTilePoint(new y.MercatorCoordinate(Te,We)),yr.getTilePoint(new y.MercatorCoordinate(je,at))];if(dn[0].x-Nr<y.EXTENT&&dn[0].y-Nr<y.EXTENT&&dn[1].x+Nr>=0&&dn[1].y+Nr>=0){var Nn=J.map(function(zn){return yr.getTilePoint(zn)}),Bn=_e.map(function(zn){return yr.getTilePoint(zn)});R.push({tile:cr,tileID:yr,queryGeometry:Nn,cameraQueryGeometry:Bn,scale:Hr})}}},nr=0;nr<be.length;nr++)Dt(nr);return R},v.prototype.getVisibleCoordinates=function(d){for(var g=this,S=this.getRenderableIds(d).map(function(G){return g._tiles[G].tileID}),C=0,R=S;C<R.length;C+=1){var O=R[C];O.posMatrix=this.transform.calculatePosMatrix(O.toUnwrapped())}return S},v.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Qe(this._source.type))for(var d in this._tiles){var g=this._tiles[d];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},v.prototype.setFeatureState=function(d,g,S){this._state.updateState(d=d||"_geojsonTileLayer",g,S)},v.prototype.removeFeatureState=function(d,g,S){this._state.removeFeatureState(d=d||"_geojsonTileLayer",g,S)},v.prototype.getFeatureState=function(d,g){return this._state.getState(d=d||"_geojsonTileLayer",g)},v.prototype.setDependencies=function(d,g,S){var C=this._tiles[d];C&&C.setDependencies(g,S)},v.prototype.reloadTilesForDependencies=function(d,g){for(var S in this._tiles)this._tiles[S].hasDependency(d,g)&&this._reloadTile(S,"reloading");this._cache.filter(function(C){return!C.hasDependency(d,g)})},v}(y.Evented);function ge(h,v){var d=Math.abs(2*h.wrap)-+(h.wrap<0),g=Math.abs(2*v.wrap)-+(v.wrap<0);return h.overscaledZ-v.overscaledZ||g-d||v.canonical.y-h.canonical.y||v.canonical.x-h.canonical.x}function Qe(h){return h==="raster"||h==="image"||h==="video"}function gt(){return new y.window.Worker(mh.workerUrl)}K.maxOverzooming=10,K.maxUnderzooming=3;var pe="mapboxgl_preloaded_worker_pool",vr=function(){this.active={}};vr.prototype.acquire=function(h){if(!this.workers)for(this.workers=[];this.workers.length<vr.workerCount;)this.workers.push(new gt);return this.active[h]=!0,this.workers.slice()},vr.prototype.release=function(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(function(v){v.terminate()}),this.workers=null)},vr.prototype.isPreloaded=function(){return!!this.active[pe]},vr.prototype.numActive=function(){return Object.keys(this.active).length};var en,tn=Math.floor(y.browser.hardwareConcurrency/2);function Kt(){return en||(en=new vr),en}function $r(h,v){var d={};for(var g in h)g!=="ref"&&(d[g]=h[g]);return y.refProperties.forEach(function(S){S in v&&(d[S]=v[S])}),d}function Br(h){h=h.slice();for(var v=Object.create(null),d=0;d<h.length;d++)v[h[d].id]=h[d];for(var g=0;g<h.length;g++)"ref"in h[g]&&(h[g]=$r(h[g],v[h[g].ref]));return h}vr.workerCount=Math.max(Math.min(tn,6),1);var jr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ni(h,v,d){d.push({command:jr.addSource,args:[h,v[h]]})}function on(h,v,d){v.push({command:jr.removeSource,args:[h]}),d[h]=!0}function di(h,v,d,g){on(h,d,g),ni(h,v,d)}function Fi(h,v,d){var g;for(g in h[d])if(h[d].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(h[d][g],v[d][g]))return!1;for(g in v[d])if(v[d].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(h[d][g],v[d][g]))return!1;return!0}function mi(h,v,d,g,S,C){var R;for(R in v=v||{},h=h||{})h.hasOwnProperty(R)&&(y.deepEqual(h[R],v[R])||d.push({command:C,args:[g,R,v[R],S]}));for(R in v)v.hasOwnProperty(R)&&!h.hasOwnProperty(R)&&(y.deepEqual(h[R],v[R])||d.push({command:C,args:[g,R,v[R],S]}))}function Ci(h){return h.id}function Ri(h,v){return h[v.id]=v,h}var bo=function(h,v){this.reset(h,v)};bo.prototype.reset=function(h,v){this.points=h||[],this._distances=[0];for(var d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(v||0,.5*this.length),this.paddedLength=this.length-2*this.padding},bo.prototype.lerp=function(h){if(this.points.length===1)return this.points[0];h=y.clamp(h,0,1);for(var v=1,d=this._distances[v],g=h*this.paddedLength+this.padding;d<g&&v<this._distances.length;)d=this._distances[++v];var S=v-1,C=this._distances[S],R=d-C,O=R>0?(g-C)/R:0;return this.points[S].mult(1-O).add(this.points[v].mult(O))};var Ki=function(h,v,d){var g=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(h/d),this.yCellCount=Math.ceil(v/d);for(var C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=v,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/v,this.boxUid=0,this.circleUid=0};function Sa(h,v,d,g,S){var C=y.create();return v?(y.scale(C,C,[1/S,1/S,1]),d||y.rotateZ(C,C,g.angle)):y.multiply(C,g.labelPlaneMatrix,h),C}function Mi(h,v,d,g,S){if(v){var C=y.clone(h);return y.scale(C,C,[S,S,1]),d||y.rotateZ(C,C,-g.angle),C}return g.glCoordMatrix}function gi(h,v){var d=[h.x,h.y,0,1];ia(d,d,v);var g=d[3];return{point:new y.Point(d[0]/g,d[1]/g),signedDistanceFromCamera:g}}function Ei(h,v){return .5+h/v*.5}function wa(h,v){var d=h[0]/h[3],g=h[1]/h[3];return d>=-v[0]&&d<=v[0]&&g>=-v[1]&&g<=v[1]}function Gs(h,v,d,g,S,C,R,O){var G=g?h.textSizeData:h.iconSizeData,J=y.evaluateSizeForZoom(G,d.transform.zoom),_e=[256/d.width*2+1,256/d.height*2+1],be=g?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;be.clear();for(var Te=h.lineVertexArray,We=g?h.text.placedSymbolArray:h.icon.placedSymbolArray,je=d.transform.width/d.transform.height,at=!1,Fe=0;Fe<We.length;Fe++){var nt=We.get(Fe);if(nt.hidden||nt.writingMode===y.WritingMode.vertical&&!at)li(nt.numGlyphs,be);else{at=!1;var _t=[nt.anchorX,nt.anchorY,0,1];if(y.transformMat4(_t,_t,v),wa(_t,_e)){var Dt=Ei(d.transform.cameraToCenterDistance,_t[3]),nr=y.evaluateSizeForFeature(G,J,nt),$t=R?nr/Dt:nr*Dt,cr=new y.Point(nt.anchorX,nt.anchorY),yr=gi(cr,S).point,Hr={},Nr=Ju(nt,$t,!1,O,v,S,C,h.glyphOffsetArray,Te,be,yr,cr,Hr,je);at=Nr.useVertical,(Nr.notEnoughRoom||at||Nr.needsFlipping&&Ju(nt,$t,!0,O,v,S,C,h.glyphOffsetArray,Te,be,yr,cr,Hr,je).notEnoughRoom)&&li(nt.numGlyphs,be)}else li(nt.numGlyphs,be)}}g?h.text.dynamicLayoutVertexBuffer.updateData(be):h.icon.dynamicLayoutVertexBuffer.updateData(be)}function fa(h,v,d,g,S,C,R,O,G,J,_e){var be=O.glyphStartIndex+O.numGlyphs,Te=O.lineStartIndex,We=O.lineStartIndex+O.lineLength,je=v.getoffsetX(O.glyphStartIndex),at=v.getoffsetX(be-1),Fe=_a(h*je,d,g,S,C,R,O.segment,Te,We,G,J,_e);if(!Fe)return null;var nt=_a(h*at,d,g,S,C,R,O.segment,Te,We,G,J,_e);return nt?{first:Fe,last:nt}:null}function Ca(h,v,d,g){return h===y.WritingMode.horizontal&&Math.abs(d.y-v.y)>Math.abs(d.x-v.x)*g?{useVertical:!0}:(h===y.WritingMode.vertical?v.y<d.y:v.x>d.x)?{needsFlipping:!0}:null}function Ju(h,v,d,g,S,C,R,O,G,J,_e,be,Te,We){var je,at=v/24,Fe=h.lineOffsetX*at,nt=h.lineOffsetY*at;if(h.numGlyphs>1){var _t=h.glyphStartIndex+h.numGlyphs,Dt=h.lineStartIndex,nr=h.lineStartIndex+h.lineLength,$t=fa(at,O,Fe,nt,d,_e,be,h,G,C,Te);if(!$t)return{notEnoughRoom:!0};var cr=gi($t.first.point,R).point,yr=gi($t.last.point,R).point;if(g&&!d){var Hr=Ca(h.writingMode,cr,yr,We);if(Hr)return Hr}je=[$t.first];for(var Nr=h.glyphStartIndex+1;Nr<_t-1;Nr++)je.push(_a(at*O.getoffsetX(Nr),Fe,nt,d,_e,be,h.segment,Dt,nr,G,C,Te));je.push($t.last)}else{if(g&&!d){var dn=gi(be,S).point,Nn=h.lineStartIndex+h.segment+1,Bn=new y.Point(G.getx(Nn),G.gety(Nn)),zn=gi(Bn,S),Ni=zn.signedDistanceFromCamera>0?zn.point:iu(be,Bn,dn,1,S),yn=Ca(h.writingMode,dn,Ni,We);if(yn)return yn}var ii=_a(at*O.getoffsetX(h.glyphStartIndex),Fe,nt,d,_e,be,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,G,C,Te);if(!ii)return{notEnoughRoom:!0};je=[ii]}for(var pi=0,ti=je;pi<ti.length;pi+=1){var Jn=ti[pi];y.addDynamicAttributes(J,Jn.point,Jn.angle)}return{}}function iu(h,v,d,g,S){var C=gi(h.add(h.sub(v)._unit()),S).point,R=d.sub(C);return d.add(R._mult(g/R.mag()))}function _a(h,v,d,g,S,C,R,O,G,J,_e,be){var Te=g?h-v:h+v,We=Te>0?1:-1,je=0;g&&(We*=-1,je=Math.PI),We<0&&(je+=Math.PI);for(var at=We>0?O+R:O+R+1,Fe=S,nt=S,_t=0,Dt=0,nr=Math.abs(Te),$t=[];_t+Dt<=nr;){if((at+=We)<O||at>=G)return null;if(nt=Fe,$t.push(Fe),(Fe=be[at])===void 0){var cr=new y.Point(J.getx(at),J.gety(at)),yr=gi(cr,_e);if(yr.signedDistanceFromCamera>0)Fe=be[at]=yr.point;else{var Hr=at-We;Fe=iu(_t===0?C:new y.Point(J.getx(Hr),J.gety(Hr)),cr,nt,nr-_t+1,_e)}}_t+=Dt,Dt=nt.dist(Fe)}var Nr=(nr-_t)/Dt,dn=Fe.sub(nt),Nn=dn.mult(Nr)._add(nt);Nn._add(dn._unit()._perp()._mult(d*We));var Bn=je+Math.atan2(Fe.y-nt.y,Fe.x-nt.x);return $t.push(Nn),{point:Nn,angle:Bn,path:$t}}Ki.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ki.prototype.insert=function(h,v,d,g,S){this._forEachCell(v,d,g,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(v),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(S)},Ki.prototype.insertCircle=function(h,v,d,g){this._forEachCell(v-g,d-g,v+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(v),this.circles.push(d),this.circles.push(g)},Ki.prototype._insertBoxCell=function(h,v,d,g,S,C){this.boxCells[S].push(C)},Ki.prototype._insertCircleCell=function(h,v,d,g,S,C){this.circleCells[S].push(C)},Ki.prototype._query=function(h,v,d,g,S,C){if(d<0||h>this.width||g<0||v>this.height)return!S&&[];var R=[];if(h<=0&&v<=0&&this.width<=d&&this.height<=g){if(S)return!0;for(var O=0;O<this.boxKeys.length;O++)R.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(var G=0;G<this.circleKeys.length;G++){var J=this.circles[3*G],_e=this.circles[3*G+1],be=this.circles[3*G+2];R.push({key:this.circleKeys[G],x1:J-be,y1:_e-be,x2:J+be,y2:_e+be})}return C?R.filter(C):R}return this._forEachCell(h,v,d,g,this._queryCell,R,{hitTest:S,seenUids:{box:{},circle:{}}},C),S?R.length>0:R},Ki.prototype._queryCircle=function(h,v,d,g,S){var C=h-d,R=h+d,O=v-d,G=v+d;if(R<0||C>this.width||G<0||O>this.height)return!g&&[];var J=[];return this._forEachCell(C,O,R,G,this._queryCellCircle,J,{hitTest:g,circle:{x:h,y:v,radius:d},seenUids:{box:{},circle:{}}},S),g?J.length>0:J},Ki.prototype.query=function(h,v,d,g,S){return this._query(h,v,d,g,!1,S)},Ki.prototype.hitTest=function(h,v,d,g,S){return this._query(h,v,d,g,!0,S)},Ki.prototype.hitTestCircle=function(h,v,d,g){return this._queryCircle(h,v,d,!0,g)},Ki.prototype._queryCell=function(h,v,d,g,S,C,R,O){var G=R.seenUids,J=this.boxCells[S];if(J!==null)for(var _e=this.bboxes,be=0,Te=J;be<Te.length;be+=1){var We=Te[be];if(!G.box[We]){G.box[We]=!0;var je=4*We;if(h<=_e[je+2]&&v<=_e[je+3]&&d>=_e[je+0]&&g>=_e[je+1]&&(!O||O(this.boxKeys[We]))){if(R.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[We],x1:_e[je],y1:_e[je+1],x2:_e[je+2],y2:_e[je+3]})}}}var at=this.circleCells[S];if(at!==null)for(var Fe=this.circles,nt=0,_t=at;nt<_t.length;nt+=1){var Dt=_t[nt];if(!G.circle[Dt]){G.circle[Dt]=!0;var nr=3*Dt;if(this._circleAndRectCollide(Fe[nr],Fe[nr+1],Fe[nr+2],h,v,d,g)&&(!O||O(this.circleKeys[Dt]))){if(R.hitTest)return C.push(!0),!0;var $t=Fe[nr],cr=Fe[nr+1],yr=Fe[nr+2];C.push({key:this.circleKeys[Dt],x1:$t-yr,y1:cr-yr,x2:$t+yr,y2:cr+yr})}}}},Ki.prototype._queryCellCircle=function(h,v,d,g,S,C,R,O){var G=R.circle,J=R.seenUids,_e=this.boxCells[S];if(_e!==null)for(var be=this.bboxes,Te=0,We=_e;Te<We.length;Te+=1){var je=We[Te];if(!J.box[je]){J.box[je]=!0;var at=4*je;if(this._circleAndRectCollide(G.x,G.y,G.radius,be[at+0],be[at+1],be[at+2],be[at+3])&&(!O||O(this.boxKeys[je])))return C.push(!0),!0}}var Fe=this.circleCells[S];if(Fe!==null)for(var nt=this.circles,_t=0,Dt=Fe;_t<Dt.length;_t+=1){var nr=Dt[_t];if(!J.circle[nr]){J.circle[nr]=!0;var $t=3*nr;if(this._circlesCollide(nt[$t],nt[$t+1],nt[$t+2],G.x,G.y,G.radius)&&(!O||O(this.circleKeys[nr])))return C.push(!0),!0}}},Ki.prototype._forEachCell=function(h,v,d,g,S,C,R,O){for(var G=this._convertToXCellCoord(h),J=this._convertToYCellCoord(v),_e=this._convertToXCellCoord(d),be=this._convertToYCellCoord(g),Te=G;Te<=_e;Te++)for(var We=J;We<=be;We++)if(S.call(this,h,v,d,g,this.xCellCount*We+Te,C,R,O))return},Ki.prototype._convertToXCellCoord=function(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))},Ki.prototype._convertToYCellCoord=function(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))},Ki.prototype._circlesCollide=function(h,v,d,g,S,C){var R=g-h,O=S-v,G=d+C;return G*G>R*R+O*O},Ki.prototype._circleAndRectCollide=function(h,v,d,g,S,C,R){var O=(C-g)/2,G=Math.abs(h-(g+O));if(G>O+d)return!1;var J=(R-S)/2,_e=Math.abs(v-(S+J));if(_e>J+d)return!1;if(G<=O||_e<=J)return!0;var be=G-O,Te=_e-J;return be*be+Te*Te<=d*d};var os=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function li(h,v){for(var d=0;d<h;d++){var g=v.length;v.resize(g+4),v.float32.set(os,3*g)}}function ia(h,v,d){var g=v[0],S=v[1];return h[0]=d[0]*g+d[4]*S+d[12],h[1]=d[1]*g+d[5]*S+d[13],h[3]=d[3]*g+d[7]*S+d[15],h}var Ra=function(h,v,d){v===void 0&&(v=new Ki(h.width+200,h.height+200,25)),d===void 0&&(d=new Ki(h.width+200,h.height+200,25)),this.transform=h,this.grid=v,this.ignoredGrid=d,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+100,this.screenBottomBoundary=h.height+100,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200};function aa(h,v,d){return v*(y.EXTENT/(h.tileSize*Math.pow(2,d-h.tileID.overscaledZ)))}Ra.prototype.placeCollisionBox=function(h,v,d,g,S){var C=this.projectAndGetPerspectiveRatio(g,h.anchorPointX,h.anchorPointY),R=d*C.perspectiveRatio,O=h.x1*R+C.point.x,G=h.y1*R+C.point.y,J=h.x2*R+C.point.x,_e=h.y2*R+C.point.y;return!this.isInsideGrid(O,G,J,_e)||!v&&this.grid.hitTest(O,G,J,_e,S)?{box:[],offscreen:!1}:{box:[O,G,J,_e],offscreen:this.isOffscreen(O,G,J,_e)}},Ra.prototype.placeCollisionCircles=function(h,v,d,g,S,C,R,O,G,J,_e,be,Te){var We=[],je=new y.Point(v.anchorX,v.anchorY),at=gi(je,C),Fe=Ei(this.transform.cameraToCenterDistance,at.signedDistanceFromCamera),nt=(J?S/Fe:S*Fe)/y.ONE_EM,_t=gi(je,R).point,Dt=fa(nt,g,v.lineOffsetX*nt,v.lineOffsetY*nt,!1,_t,je,v,d,R,{}),nr=!1,$t=!1,cr=!0;if(Dt){for(var yr=.5*be*Fe+Te,Hr=new y.Point(-100,-100),Nr=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),dn=new bo,Nn=Dt.first,Bn=Dt.last,zn=[],Ni=Nn.path.length-1;Ni>=1;Ni--)zn.push(Nn.path[Ni]);for(var yn=1;yn<Bn.path.length;yn++)zn.push(Bn.path[yn]);var ii=2.5*yr;if(O){var pi=zn.map(function(Ls){return gi(Ls,O)});zn=pi.some(function(Ls){return Ls.signedDistanceFromCamera<=0})?[]:pi.map(function(Ls){return Ls.point})}var ti=[];if(zn.length>0){for(var Jn=zn[0].clone(),fi=zn[0].clone(),ei=1;ei<zn.length;ei++)Jn.x=Math.min(Jn.x,zn[ei].x),Jn.y=Math.min(Jn.y,zn[ei].y),fi.x=Math.max(fi.x,zn[ei].x),fi.y=Math.max(fi.y,zn[ei].y);ti=Jn.x>=Hr.x&&fi.x<=Nr.x&&Jn.y>=Hr.y&&fi.y<=Nr.y?[zn]:fi.x<Hr.x||Jn.x>Nr.x||fi.y<Hr.y||Jn.y>Nr.y?[]:y.clipLine([zn],Hr.x,Hr.y,Nr.x,Nr.y)}for(var $n=0,To=ti;$n<To.length;$n+=1){var $a;dn.reset(To[$n],.25*yr),$a=dn.length<=.5*yr?1:Math.ceil(dn.paddedLength/ii)+1;for(var wo=0;wo<$a;wo++){var fo=wo/Math.max($a-1,1),Na=dn.lerp(fo),Ya=Na.x+100,fs=Na.y+100;We.push(Ya,fs,yr,0);var hs=Ya-yr,cl=fs-yr,ps=Ya+yr,cu=fs+yr;if(cr=cr&&this.isOffscreen(hs,cl,ps,cu),$t=$t||this.isInsideGrid(hs,cl,ps,cu),!h&&this.grid.hitTestCircle(Ya,fs,yr,_e)&&(nr=!0,!G))return{circles:[],offscreen:!1,collisionDetected:nr}}}}return{circles:!G&&nr||!$t?[]:We,offscreen:cr,collisionDetected:nr}},Ra.prototype.queryRenderedSymbols=function(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var v=[],d=1/0,g=1/0,S=-1/0,C=-1/0,R=0,O=h;R<O.length;R+=1){var G=O[R],J=new y.Point(G.x+100,G.y+100);d=Math.min(d,J.x),g=Math.min(g,J.y),S=Math.max(S,J.x),C=Math.max(C,J.y),v.push(J)}for(var _e={},be={},Te=0,We=this.grid.query(d,g,S,C).concat(this.ignoredGrid.query(d,g,S,C));Te<We.length;Te+=1){var je=We[Te],at=je.key;if(_e[at.bucketInstanceId]===void 0&&(_e[at.bucketInstanceId]={}),!_e[at.bucketInstanceId][at.featureIndex]){var Fe=[new y.Point(je.x1,je.y1),new y.Point(je.x2,je.y1),new y.Point(je.x2,je.y2),new y.Point(je.x1,je.y2)];y.polygonIntersectsPolygon(v,Fe)&&(_e[at.bucketInstanceId][at.featureIndex]=!0,be[at.bucketInstanceId]===void 0&&(be[at.bucketInstanceId]=[]),be[at.bucketInstanceId].push(at.featureIndex))}}return be},Ra.prototype.insertCollisionBox=function(h,v,d,g,S){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:S},h[0],h[1],h[2],h[3])},Ra.prototype.insertCollisionCircles=function(h,v,d,g,S){for(var C=v?this.ignoredGrid:this.grid,R={bucketInstanceId:d,featureIndex:g,collisionGroupID:S},O=0;O<h.length;O+=4)C.insertCircle(R,h[O],h[O+1],h[O+2])},Ra.prototype.projectAndGetPerspectiveRatio=function(h,v,d){var g=[v,d,0,1];return ia(g,g,h),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},Ra.prototype.isOffscreen=function(h,v,d,g){return d<100||h>=this.screenRightBoundary||g<100||v>this.screenBottomBoundary},Ra.prototype.isInsideGrid=function(h,v,d,g){return d>=0&&h<this.gridRightBoundary&&g>=0&&v<this.gridBottomBoundary},Ra.prototype.getViewportMatrix=function(){var h=y.identity([]);return y.translate(h,h,[-100,-100,0]),h};var $o=function(h,v,d,g){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?v:-v))):g&&d?1:0,this.placed=d};$o.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Vo=function(h,v,d,g,S){this.text=new $o(h?h.text:null,v,d,S),this.icon=new $o(h?h.icon:null,v,g,S)};Vo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Du=function(h,v,d){this.text=h,this.icon=v,this.skipFade=d},ws=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},mc=function(h,v,d,g,S){this.bucketInstanceId=h,this.featureIndex=v,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=S},Da=function(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}};function zi(h,v,d,g,S){var C=y.getAnchorAlignment(h),R=-(C.horizontalAlign-.5)*v,O=-(C.verticalAlign-.5)*d,G=y.evaluateVariableOffset(h,g);return new y.Point(R+G[0]*S,O+G[1]*S)}function jo(h,v,d,g,S,C){var R=h.x1,O=h.x2,G=h.y1,J=h.y2,_e=h.anchorPointX,be=h.anchorPointY,Te=new y.Point(v,d);return g&&Te._rotate(S?C:-C),{x1:R+Te.x,y1:G+Te.y,x2:O+Te.x,y2:J+Te.y,anchorPointX:_e,anchorPointY:be}}Da.prototype.get=function(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){var v=++this.maxGroupID;this.collisionGroups[h]={ID:v,predicate:function(d){return d.collisionGroupID===v}}}return this.collisionGroups[h]};var Gt=function(h,v,d,g){this.transform=h.clone(),this.collisionIndex=new Ra(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=v,this.retainedQueryData={},this.collisionGroups=new Da(d),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function re(h,v,d,g,S){h.emplaceBack(v?1:0,d?1:0,g||0,S||0),h.emplaceBack(v?1:0,d?1:0,g||0,S||0),h.emplaceBack(v?1:0,d?1:0,g||0,S||0),h.emplaceBack(v?1:0,d?1:0,g||0,S||0)}Gt.prototype.getBucketParts=function(h,v,d,g){var S=d.getBucket(v),C=d.latestFeatureIndex;if(S&&C&&v.id===S.layerIds[0]){var R=d.collisionBoxArray,O=S.layers[0].layout,G=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),J=d.tileSize/y.EXTENT,_e=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),be=O.get("text-pitch-alignment")==="map",Te=O.get("text-rotation-alignment")==="map",We=aa(d,1,this.transform.zoom),je=Sa(_e,be,Te,this.transform,We),at=null;if(be){var Fe=Mi(_e,be,Te,this.transform,We);at=y.multiply([],this.transform.labelPlaneMatrix,Fe)}this.retainedQueryData[S.bucketInstanceId]=new mc(S.bucketInstanceId,C,S.sourceLayerIndex,S.index,d.tileID);var nt={bucket:S,layout:O,posMatrix:_e,textLabelPlaneMatrix:je,labelToScreenMatrix:at,scale:G,textPixelRatio:J,holdingForFade:d.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(g)for(var _t=0,Dt=S.sortKeyRanges;_t<Dt.length;_t+=1){var nr=Dt[_t];h.push({sortKey:nr.sortKey,symbolInstanceStart:nr.symbolInstanceStart,symbolInstanceEnd:nr.symbolInstanceEnd,parameters:nt})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:nt})}},Gt.prototype.attemptAnchorPlacement=function(h,v,d,g,S,C,R,O,G,J,_e,be,Te,We,je){var at,Fe=[be.textOffset0,be.textOffset1],nt=zi(h,d,g,Fe,S),_t=this.collisionIndex.placeCollisionBox(jo(v,nt.x,nt.y,C,R,this.transform.angle),_e,O,G,J.predicate);if(!je||this.collisionIndex.placeCollisionBox(jo(je,nt.x,nt.y,C,R,this.transform.angle),_e,O,G,J.predicate).box.length!==0)return _t.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[be.crossTileID]&&this.prevPlacement.placements[be.crossTileID]&&this.prevPlacement.placements[be.crossTileID].text&&(at=this.prevPlacement.variableOffsets[be.crossTileID].anchor),this.variableOffsets[be.crossTileID]={textOffset:Fe,width:d,height:g,anchor:h,textBoxScale:S,prevAnchor:at},this.markUsedJustification(Te,h,be,We),Te.allowVerticalPlacement&&(this.markUsedOrientation(Te,We,be),this.placedOrientations[be.crossTileID]=We),{shift:nt,placedGlyphBoxes:_t}):void 0},Gt.prototype.placeLayerBucketPart=function(h,v,d){var g=this,S=h.parameters,C=S.bucket,R=S.layout,O=S.posMatrix,G=S.textLabelPlaneMatrix,J=S.labelToScreenMatrix,_e=S.textPixelRatio,be=S.holdingForFade,Te=S.collisionBoxArray,We=S.partiallyEvaluatedTextSize,je=S.collisionGroup,at=R.get("text-optional"),Fe=R.get("icon-optional"),nt=R.get("text-allow-overlap"),_t=R.get("icon-allow-overlap"),Dt=R.get("text-rotation-alignment")==="map",nr=R.get("text-pitch-alignment")==="map",$t=R.get("icon-text-fit")!=="none",cr=R.get("symbol-z-order")==="viewport-y",yr=nt&&(_t||!C.hasIconData()||Fe),Hr=_t&&(nt||!C.hasTextData()||at);!C.collisionArrays&&Te&&C.deserializeCollisionBoxes(Te);var Nr=function(yn,ii){if(!v[yn.crossTileID])if(be)g.placements[yn.crossTileID]=new Du(!1,!1,!1);else{var pi,ti=!1,Jn=!1,fi=!0,ei=null,$n={box:null,offscreen:null},To={box:null,offscreen:null},$a=null,wo=null,fo=0,Na=0,Ya=0;ii.textFeatureIndex?fo=ii.textFeatureIndex:yn.useRuntimeCollisionCircles&&(fo=yn.featureIndex),ii.verticalTextFeatureIndex&&(Na=ii.verticalTextFeatureIndex);var fs=ii.textBox;if(fs){var hs=function(Li){var Go=y.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Li&&g.prevPlacement){var no=g.prevPlacement.placedOrientations[yn.crossTileID];no&&(g.placedOrientations[yn.crossTileID]=no,g.markUsedOrientation(C,Go=no,yn))}return Go},cl=function(Li,Go){if(C.allowVerticalPlacement&&yn.numVerticalGlyphVertices>0&&ii.verticalTextBox)for(var no=0,pu=C.writingModes;no<pu.length&&(pu[no]===y.WritingMode.vertical?($n=Go(),To=$n):$n=Li(),!($n&&$n.box&&$n.box.length));no+=1);else $n=Li()};if(R.get("text-variable-anchor")){var ps=R.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[yn.crossTileID]){var cu=g.prevPlacement.variableOffsets[yn.crossTileID];ps.indexOf(cu.anchor)>0&&(ps=ps.filter(function(Li){return Li!==cu.anchor})).unshift(cu.anchor)}var Ls=function(Li,Go,no){for(var pu=Li.x2-Li.x1,Rc=Li.y2-Li.y1,Wu=yn.textBoxScale,gh=$t&&!_t?Go:null,Ro={box:[],offscreen:!1},Dr=nt?2*ps.length:ps.length,Bs=0;Bs<Dr;++Bs){var _h=g.attemptAnchorPlacement(ps[Bs%ps.length],Li,pu,Rc,Wu,Dt,nr,_e,O,je,Bs>=ps.length,yn,C,no,gh);if(_h&&(Ro=_h.placedGlyphBoxes)&&Ro.box&&Ro.box.length){ti=!0,ei=_h.shift;break}}return Ro};cl(function(){return Ls(fs,ii.iconBox,y.WritingMode.horizontal)},function(){var Li=ii.verticalTextBox;return C.allowVerticalPlacement&&!($n&&$n.box&&$n.box.length)&&yn.numVerticalGlyphVertices>0&&Li?Ls(Li,ii.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),$n&&(ti=$n.box,fi=$n.offscreen);var Cc=hs($n&&$n.box);if(!ti&&g.prevPlacement){var Hu=g.prevPlacement.variableOffsets[yn.crossTileID];Hu&&(g.variableOffsets[yn.crossTileID]=Hu,g.markUsedJustification(C,Hu.anchor,yn,Cc))}}else{var wu=function(Li,Go){var no=g.collisionIndex.placeCollisionBox(Li,nt,_e,O,je.predicate);return no&&no.box&&no.box.length&&(g.markUsedOrientation(C,Go,yn),g.placedOrientations[yn.crossTileID]=Go),no};cl(function(){return wu(fs,y.WritingMode.horizontal)},function(){var Li=ii.verticalTextBox;return C.allowVerticalPlacement&&yn.numVerticalGlyphVertices>0&&Li?wu(Li,y.WritingMode.vertical):{box:null,offscreen:null}}),hs($n&&$n.box&&$n.box.length)}}if(ti=(pi=$n)&&pi.box&&pi.box.length>0,fi=pi&&pi.offscreen,yn.useRuntimeCollisionCircles){var ec=C.text.placedSymbolArray.get(yn.centerJustifiedTextSymbolIndex),fl=y.evaluateSizeForFeature(C.textSizeData,We,ec),fu=R.get("text-padding");$a=g.collisionIndex.placeCollisionCircles(nt,ec,C.lineVertexArray,C.glyphOffsetArray,fl,O,G,J,d,nr,je.predicate,yn.collisionCircleDiameter,fu),ti=nt||$a.circles.length>0&&!$a.collisionDetected,fi=fi&&$a.offscreen}if(ii.iconFeatureIndex&&(Ya=ii.iconFeatureIndex),ii.iconBox){var hl=function(Li){var Go=$t&&ei?jo(Li,ei.x,ei.y,Dt,nr,g.transform.angle):Li;return g.collisionIndex.placeCollisionBox(Go,_t,_e,O,je.predicate)};Jn=To&&To.box&&To.box.length&&ii.verticalIconBox?(wo=hl(ii.verticalIconBox)).box.length>0:(wo=hl(ii.iconBox)).box.length>0,fi=fi&&wo.offscreen}var Co=at||yn.numHorizontalGlyphVertices===0&&yn.numVerticalGlyphVertices===0,ro=Fe||yn.numIconVertices===0;if(Co||ro?ro?Co||(Jn=Jn&&ti):ti=Jn&&ti:Jn=ti=Jn&&ti,ti&&pi&&pi.box&&g.collisionIndex.insertCollisionBox(pi.box,R.get("text-ignore-placement"),C.bucketInstanceId,To&&To.box&&Na?Na:fo,je.ID),Jn&&wo&&g.collisionIndex.insertCollisionBox(wo.box,R.get("icon-ignore-placement"),C.bucketInstanceId,Ya,je.ID),$a&&(ti&&g.collisionIndex.insertCollisionCircles($a.circles,R.get("text-ignore-placement"),C.bucketInstanceId,fo,je.ID),d)){var Ss=C.bucketInstanceId,hu=g.collisionCircleArrays[Ss];hu===void 0&&(hu=g.collisionCircleArrays[Ss]=new ws);for(var Cu=0;Cu<$a.circles.length;Cu+=4)hu.circles.push($a.circles[Cu+0]),hu.circles.push($a.circles[Cu+1]),hu.circles.push($a.circles[Cu+2]),hu.circles.push($a.collisionDetected?1:0)}g.placements[yn.crossTileID]=new Du(ti||yr,Jn||Hr,fi||C.justReloaded),v[yn.crossTileID]=!0}};if(cr)for(var dn=C.getSortedSymbolIndexes(this.transform.angle),Nn=dn.length-1;Nn>=0;--Nn){var Bn=dn[Nn];Nr(C.symbolInstances.get(Bn),C.collisionArrays[Bn])}else for(var zn=h.symbolInstanceStart;zn<h.symbolInstanceEnd;zn++)Nr(C.symbolInstances.get(zn),C.collisionArrays[zn]);if(d&&C.bucketInstanceId in this.collisionCircleArrays){var Ni=this.collisionCircleArrays[C.bucketInstanceId];y.invert(Ni.invProjMatrix,O),Ni.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},Gt.prototype.markUsedJustification=function(h,v,d,g){var S;S=g===y.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(v)];for(var C=0,R=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];C<R.length;C+=1){var O=R[C];O>=0&&(h.text.placedSymbolArray.get(O).crossTileID=S>=0&&O!==S?0:d.crossTileID)}},Gt.prototype.markUsedOrientation=function(h,v,d){for(var g=v===y.WritingMode.horizontal||v===y.WritingMode.horizontalOnly?v:0,S=v===y.WritingMode.vertical?v:0,C=0,R=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];C<R.length;C+=1)h.text.placedSymbolArray.get(R[C]).placedOrientation=g;d.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=S)},Gt.prototype.commit=function(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;var v=this.prevPlacement,d=!1;this.prevZoomAdjustment=v?v.zoomAdjustment(this.transform.zoom):0;var g=v?v.symbolFadeChange(h):1,S=v?v.opacities:{},C=v?v.variableOffsets:{},R=v?v.placedOrientations:{};for(var O in this.placements){var G=this.placements[O],J=S[O];J?(this.opacities[O]=new Vo(J,g,G.text,G.icon),d=d||G.text!==J.text.placed||G.icon!==J.icon.placed):(this.opacities[O]=new Vo(null,g,G.text,G.icon,G.skipFade),d=d||G.text||G.icon)}for(var _e in S){var be=S[_e];if(!this.opacities[_e]){var Te=new Vo(be,g,!1,!1);Te.isHidden()||(this.opacities[_e]=Te,d=d||be.text.placed||be.icon.placed)}}for(var We in C)this.variableOffsets[We]||!this.opacities[We]||this.opacities[We].isHidden()||(this.variableOffsets[We]=C[We]);for(var je in R)this.placedOrientations[je]||!this.opacities[je]||this.opacities[je].isHidden()||(this.placedOrientations[je]=R[je]);d?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=v?v.lastPlacementChangeTime:h)},Gt.prototype.updateLayerOpacities=function(h,v){for(var d={},g=0,S=v;g<S.length;g+=1){var C=S[g],R=C.getBucket(h);R&&C.latestFeatureIndex&&h.id===R.layerIds[0]&&this.updateBucketOpacities(R,d,C.collisionBoxArray)}},Gt.prototype.updateBucketOpacities=function(h,v,d){var g=this;h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();var S=h.layers[0].layout,C=new Vo(null,0,!1,!1,!0),R=S.get("text-allow-overlap"),O=S.get("icon-allow-overlap"),G=S.get("text-variable-anchor"),J=S.get("text-rotation-alignment")==="map",_e=S.get("text-pitch-alignment")==="map",be=S.get("icon-text-fit")!=="none",Te=new Vo(null,0,R&&(O||!h.hasIconData()||S.get("icon-optional")),O&&(R||!h.hasTextData()||S.get("text-optional")),!0);!h.collisionArrays&&d&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(d);for(var We=function(nt,_t,Dt){for(var nr=0;nr<_t/4;nr++)nt.opacityVertexArray.emplaceBack(Dt)},je=function(nt){var _t=h.symbolInstances.get(nt),Dt=_t.numHorizontalGlyphVertices,nr=_t.numVerticalGlyphVertices,$t=_t.crossTileID,cr=g.opacities[$t];v[$t]?cr=C:cr||(g.opacities[$t]=cr=Te),v[$t]=!0;var yr=_t.numIconVertices>0,Hr=g.placedOrientations[_t.crossTileID],Nr=Hr===y.WritingMode.vertical,dn=Hr===y.WritingMode.horizontal||Hr===y.WritingMode.horizontalOnly;if(Dt>0||nr>0){var Nn=Eo(cr.text);We(h.text,Dt,Nr?ao:Nn),We(h.text,nr,dn?ao:Nn);var Bn=cr.text.isHidden();[_t.rightJustifiedTextSymbolIndex,_t.centerJustifiedTextSymbolIndex,_t.leftJustifiedTextSymbolIndex].forEach(function($n){$n>=0&&(h.text.placedSymbolArray.get($n).hidden=Bn||Nr?1:0)}),_t.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(_t.verticalPlacedTextSymbolIndex).hidden=Bn||dn?1:0);var zn=g.variableOffsets[_t.crossTileID];zn&&g.markUsedJustification(h,zn.anchor,_t,Hr);var Ni=g.placedOrientations[_t.crossTileID];Ni&&(g.markUsedJustification(h,"left",_t,Ni),g.markUsedOrientation(h,Ni,_t))}if(yr){var yn=Eo(cr.icon),ii=!(be&&_t.verticalPlacedIconSymbolIndex&&Nr);_t.placedIconSymbolIndex>=0&&(We(h.icon,_t.numIconVertices,ii?yn:ao),h.icon.placedSymbolArray.get(_t.placedIconSymbolIndex).hidden=cr.icon.isHidden()),_t.verticalPlacedIconSymbolIndex>=0&&(We(h.icon,_t.numVerticalIconVertices,ii?ao:yn),h.icon.placedSymbolArray.get(_t.verticalPlacedIconSymbolIndex).hidden=cr.icon.isHidden())}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){var pi=h.collisionArrays[nt];if(pi){var ti=new y.Point(0,0);if(pi.textBox||pi.verticalTextBox){var Jn=!0;if(G){var fi=g.variableOffsets[$t];fi?(ti=zi(fi.anchor,fi.width,fi.height,fi.textOffset,fi.textBoxScale),J&&ti._rotate(_e?g.transform.angle:-g.transform.angle)):Jn=!1}pi.textBox&&re(h.textCollisionBox.collisionVertexArray,cr.text.placed,!Jn||Nr,ti.x,ti.y),pi.verticalTextBox&&re(h.textCollisionBox.collisionVertexArray,cr.text.placed,!Jn||dn,ti.x,ti.y)}var ei=Boolean(!dn&&pi.verticalIconBox);pi.iconBox&&re(h.iconCollisionBox.collisionVertexArray,cr.icon.placed,ei,be?ti.x:0,be?ti.y:0),pi.verticalIconBox&&re(h.iconCollisionBox.collisionVertexArray,cr.icon.placed,!ei,be?ti.x:0,be?ti.y:0)}}},at=0;at<h.symbolInstances.length;at++)je(at);if(h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.bucketInstanceId in this.collisionCircleArrays){var Fe=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=Fe.invProjMatrix,h.placementViewportMatrix=Fe.viewportMatrix,h.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}},Gt.prototype.symbolFadeChange=function(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Gt.prototype.zoomAdjustment=function(h){return Math.max(0,(this.transform.zoom-h)/1.5)},Gt.prototype.hasTransitions=function(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration},Gt.prototype.stillRecent=function(h,v){var d=this.zoomAtLastRecencyCheck===v?1-this.zoomAdjustment(v):1;return this.zoomAtLastRecencyCheck=v,this.commitTime+this.fadeDuration*d>h},Gt.prototype.setStale=function(){this.stale=!0};var Oe=Math.pow(2,25),dt=Math.pow(2,24),lr=Math.pow(2,17),Kr=Math.pow(2,16),Pn=Math.pow(2,9),Zi=Math.pow(2,8),lo=Math.pow(2,1);function Eo(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;var v=h.placed?1:0,d=Math.floor(127*h.opacity);return d*Oe+v*dt+d*lr+v*Kr+d*Pn+v*Zi+d*lo+v}var ao=0,Cs=function(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&h.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Cs.prototype.continuePlacement=function(h,v,d,g,S){for(var C=this._bucketParts;this._currentTileIndex<h.length;)if(v.getBucketParts(C,g,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(R,O){return R.sortKey-O.sortKey}));this._currentPartIndex<C.length;)if(v.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,S())return!0;return!1};var Zc=function(h,v,d,g,S,C,R){this.placement=new Gt(h,S,C,R),this._currentPlacementIndex=v.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1};Zc.prototype.isDone=function(){return this._done},Zc.prototype.continuePlacement=function(h,v,d){for(var g=this,S=y.browser.now(),C=function(){var G=y.browser.now()-S;return!g._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var R=v[h[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=O)&&(!R.maxzoom||R.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new Cs(R)),this._inProgressLayer.continuePlacement(d[R.source],this.placement,this._showCollisionBoxes,R,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Zc.prototype.commit=function(h){return this.placement.commit(h),this.placement};var au=512/y.EXTENT/2,_f=function(h,v,d){this.tileID=h,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(var g=0;g<v.length;g++){var S=v.get(g),C=S.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,h)})}};_f.prototype.getScaledCoordinates=function(h,v){var d=au/Math.pow(2,v.canonical.z-this.tileID.canonical.z);return{x:Math.floor((v.canonical.x*y.EXTENT+h.anchorX)*d),y:Math.floor((v.canonical.y*y.EXTENT+h.anchorY)*d)}},_f.prototype.findMatches=function(h,v,d){for(var g=this.tileID.canonical.z<v.canonical.z?1:Math.pow(2,this.tileID.canonical.z-v.canonical.z),S=0;S<h.length;S++){var C=h.get(S);if(!C.crossTileID){var R=this.indexedSymbolInstances[C.key];if(R)for(var O=this.getScaledCoordinates(C,v),G=0,J=R;G<J.length;G+=1){var _e=J[G];if(Math.abs(_e.coord.x-O.x)<=g&&Math.abs(_e.coord.y-O.y)<=g&&!d[_e.crossTileID]){d[_e.crossTileID]=!0,C.crossTileID=_e.crossTileID;break}}}}};var Ho=function(){this.maxCrossTileID=0};Ho.prototype.generate=function(){return++this.maxCrossTileID};var Al=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Al.prototype.handleWrapJump=function(h){var v=Math.round((h-this.lng)/360);if(v!==0)for(var d in this.indexes){var g=this.indexes[d],S={};for(var C in g){var R=g[C];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+v),S[R.tileID.key]=R}this.indexes[d]=S}this.lng=h},Al.prototype.addBucket=function(h,v,d){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===v.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(var g=0;g<v.symbolInstances.length;g++)v.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});var S=this.usedCrossTileIDs[h.overscaledZ];for(var C in this.indexes){var R=this.indexes[C];if(Number(C)>h.overscaledZ)for(var O in R){var G=R[O];G.tileID.isChildOf(h)&&G.findMatches(v.symbolInstances,h,S)}else{var J=R[h.scaledTo(Number(C)).key];J&&J.findMatches(v.symbolInstances,h,S)}}for(var _e=0;_e<v.symbolInstances.length;_e++){var be=v.symbolInstances.get(_e);be.crossTileID||(be.crossTileID=d.generate(),S[be.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new _f(h,v.symbolInstances,v.bucketInstanceId),!0},Al.prototype.removeBucketCrossTileIDs=function(h,v){for(var d in v.indexedSymbolInstances)for(var g=0,S=v.indexedSymbolInstances[d];g<S.length;g+=1)delete this.usedCrossTileIDs[h][S[g].crossTileID]},Al.prototype.removeStaleBuckets=function(h){var v=!1;for(var d in this.indexes){var g=this.indexes[d];for(var S in g)h[g[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[S]),delete g[S],v=!0)}return v};var Tl=function(){this.layerIndexes={},this.crossTileIDs=new Ho,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Tl.prototype.addLayer=function(h,v,d){var g=this.layerIndexes[h.id];g===void 0&&(g=this.layerIndexes[h.id]=new Al);var S=!1,C={};g.handleWrapJump(d);for(var R=0,O=v;R<O.length;R+=1){var G=O[R],J=G.getBucket(h);J&&h.id===J.layerIds[0]&&(J.bucketInstanceId||(J.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(G.tileID,J,this.crossTileIDs)&&(S=!0),C[J.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(S=!0),S},Tl.prototype.pruneUnusedLayers=function(h){var v={};for(var d in h.forEach(function(g){v[g]=!0}),this.layerIndexes)v[d]||delete this.layerIndexes[d]};var Lu=function(h,v){return y.emitValidationErrors(h,v&&v.filter(function(d){return d.identifier!=="source.canvas"}))},Bu=y.pick(jr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),el=y.pick(jr,["setCenter","setZoom","setBearing","setPitch"]),Vc=function(){var h={},v=y.styleSpec.$version;for(var d in y.styleSpec.$root){var g,S=y.styleSpec.$root[d];S.required&&(g=d==="version"?v:S.type==="array"?[]:{})!=null&&(h[d]=g)}return h}(),Rs=function(h){function v(d,g){var S=this;g===void 0&&(g={}),h.call(this),this.map=d,this.dispatcher=new ur(Kt(),this),this.imageManager=new Xt,this.imageManager.setEventedParent(this),this.glyphManager=new dr(d._requestManager,g.localIdeographFontFamily),this.lineAtlas=new pt(256,512),this.crossTileSymbolIndex=new Tl,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var C=this;this._rtlTextPluginCallback=v.registerForPluginStateChange(function(R){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(O,G){if(y.triggerPluginCompletionEvent(O),G&&G.every(function(_e){return _e}))for(var J in C.sourceCaches)C.sourceCaches[J].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var O=S.sourceCaches[R.sourceId];if(O){var G=O.getSource();if(G&&G.vectorLayerIds)for(var J in S._layers){var _e=S._layers[J];_e.source===G.id&&S._validateLayer(_e)}}}})}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.loadURL=function(d,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var C=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(d);d=this.map._requestManager.normalizeStyleURL(d,g.accessToken);var R=this.map._requestManager.transformRequest(d,y.ResourceType.Style);this._request=y.getJSON(R,function(O,G){S._request=null,O?S.fire(new y.ErrorEvent(O)):G&&S._load(G,C)})},v.prototype.loadJSON=function(d,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){S._request=null,S._load(d,g.validate!==!1)})},v.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(Vc,!1)},v.prototype._load=function(d,g){if(!g||!Lu(this,y.validateStyle(d))){for(var S in this._loaded=!0,this.stylesheet=d,d.sources)this.addSource(S,d.sources[S],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs);var C=Br(this.stylesheet.layers);this._order=C.map(function(J){return J.id}),this._layers={},this._serializedLayers={};for(var R=0,O=C;R<O.length;R+=1){var G=O[R];(G=y.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Bt(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},v.prototype._loadSprite=function(d){var g=this;this._spriteRequest=function(S,C,R){var O,G,J,_e=y.browser.devicePixelRatio>1?"@2x":"",be=y.getJSON(C.transformRequest(C.normalizeSpriteURL(S,_e,".json"),y.ResourceType.SpriteJSON),function(je,at){be=null,J||(J=je,O=at,We())}),Te=y.getImage(C.transformRequest(C.normalizeSpriteURL(S,_e,".png"),y.ResourceType.SpriteImage),function(je,at){Te=null,J||(J=je,G=at,We())});function We(){if(J)R(J);else if(O&&G){var je=y.browser.getImageData(G),at={};for(var Fe in O){var nt=O[Fe],_t=nt.width,Dt=nt.height,nr=nt.x,$t=nt.y,cr=nt.sdf,yr=nt.pixelRatio,Hr=nt.stretchX,Nr=nt.stretchY,dn=nt.content,Nn=new y.RGBAImage({width:_t,height:Dt});y.RGBAImage.copy(je,Nn,{x:nr,y:$t},{x:0,y:0},{width:_t,height:Dt}),at[Fe]={data:Nn,pixelRatio:yr,sdf:cr,stretchX:Hr,stretchY:Nr,content:dn}}R(null,at)}}return{cancel:function(){be&&(be.cancel(),be=null),Te&&(Te.cancel(),Te=null)}}}(d,this.map._requestManager,function(S,C){if(g._spriteRequest=null,S)g.fire(new y.ErrorEvent(S));else if(C)for(var R in C)g.imageManager.addImage(R,C[R]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},v.prototype._validateLayer=function(d){var g=this.sourceCaches[d.source];if(g){var S=d.sourceLayer;if(S){var C=g.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(S)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+C.id+'" as specified by style layer "'+d.id+'"')))}}},v.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var d in this.sourceCaches)if(!this.sourceCaches[d].loaded())return!1;return!!this.imageManager.isLoaded()},v.prototype._serializeLayers=function(d){for(var g=[],S=0,C=d;S<C.length;S+=1){var R=this._layers[C[S]];R.type!=="custom"&&g.push(R.serialize())}return g},v.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},v.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},v.prototype.update=function(d){if(this._loaded){var g=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var R in(S.length||C.length)&&this._updateWorkerLayers(S,C),this._updatedSources){var O=this._updatedSources[R];O==="reload"?this._reloadSource(R):O==="clear"&&this._clearSource(R)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(d);this.light.updateTransitions(d),this._resetUpdates()}var J={};for(var _e in this.sourceCaches){var be=this.sourceCaches[_e];J[_e]=be.used,be.used=!1}for(var Te=0,We=this._order;Te<We.length;Te+=1){var je=this._layers[We[Te]];je.recalculate(d,this._availableImages),!je.isHidden(d.zoom)&&je.source&&(this.sourceCaches[je.source].used=!0)}for(var at in J){var Fe=this.sourceCaches[at];J[at]!==Fe.used&&Fe.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:at}))}this.light.recalculate(d),this.z=d.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},v.prototype._updateTilesForChangedImages=function(){var d=Object.keys(this._changedImages);if(d.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],d);this._changedImages={}}},v.prototype._updateWorkerLayers=function(d,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(d),removedIds:g})},v.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},v.prototype.setState=function(d){var g=this;if(this._checkLoaded(),Lu(this,y.validateStyle(d)))return!1;(d=y.clone$1(d)).layers=Br(d.layers);var S=function(R,O){if(!R)return[{command:jr.setStyle,args:[O]}];var G=[];try{if(!y.deepEqual(R.version,O.version))return[{command:jr.setStyle,args:[O]}];y.deepEqual(R.center,O.center)||G.push({command:jr.setCenter,args:[O.center]}),y.deepEqual(R.zoom,O.zoom)||G.push({command:jr.setZoom,args:[O.zoom]}),y.deepEqual(R.bearing,O.bearing)||G.push({command:jr.setBearing,args:[O.bearing]}),y.deepEqual(R.pitch,O.pitch)||G.push({command:jr.setPitch,args:[O.pitch]}),y.deepEqual(R.sprite,O.sprite)||G.push({command:jr.setSprite,args:[O.sprite]}),y.deepEqual(R.glyphs,O.glyphs)||G.push({command:jr.setGlyphs,args:[O.glyphs]}),y.deepEqual(R.transition,O.transition)||G.push({command:jr.setTransition,args:[O.transition]}),y.deepEqual(R.light,O.light)||G.push({command:jr.setLight,args:[O.light]});var J={},_e=[];(function(Te,We,je,at){var Fe;for(Fe in We=We||{},Te=Te||{})Te.hasOwnProperty(Fe)&&(We.hasOwnProperty(Fe)||on(Fe,je,at));for(Fe in We)We.hasOwnProperty(Fe)&&(Te.hasOwnProperty(Fe)?y.deepEqual(Te[Fe],We[Fe])||(Te[Fe].type==="geojson"&&We[Fe].type==="geojson"&&Fi(Te,We,Fe)?je.push({command:jr.setGeoJSONSourceData,args:[Fe,We[Fe].data]}):di(Fe,We,je,at)):ni(Fe,We,je))})(R.sources,O.sources,_e,J);var be=[];R.layers&&R.layers.forEach(function(Te){J[Te.source]?G.push({command:jr.removeLayer,args:[Te.id]}):be.push(Te)}),G=G.concat(_e),function(Te,We,je){We=We||[];var at,Fe,nt,_t,Dt,nr,$t,cr=(Te=Te||[]).map(Ci),yr=We.map(Ci),Hr=Te.reduce(Ri,{}),Nr=We.reduce(Ri,{}),dn=cr.slice(),Nn=Object.create(null);for(at=0,Fe=0;at<cr.length;at++)Nr.hasOwnProperty(nt=cr[at])?Fe++:(je.push({command:jr.removeLayer,args:[nt]}),dn.splice(dn.indexOf(nt,Fe),1));for(at=0,Fe=0;at<yr.length;at++)dn[dn.length-1-at]!==(nt=yr[yr.length-1-at])&&(Hr.hasOwnProperty(nt)?(je.push({command:jr.removeLayer,args:[nt]}),dn.splice(dn.lastIndexOf(nt,dn.length-Fe),1)):Fe++,je.push({command:jr.addLayer,args:[Nr[nt],nr=dn[dn.length-at]]}),dn.splice(dn.length-at,0,nt),Nn[nt]=!0);for(at=0;at<yr.length;at++)if(_t=Hr[nt=yr[at]],Dt=Nr[nt],!Nn[nt]&&!y.deepEqual(_t,Dt))if(y.deepEqual(_t.source,Dt.source)&&y.deepEqual(_t["source-layer"],Dt["source-layer"])&&y.deepEqual(_t.type,Dt.type)){for($t in mi(_t.layout,Dt.layout,je,nt,null,jr.setLayoutProperty),mi(_t.paint,Dt.paint,je,nt,null,jr.setPaintProperty),y.deepEqual(_t.filter,Dt.filter)||je.push({command:jr.setFilter,args:[nt,Dt.filter]}),y.deepEqual(_t.minzoom,Dt.minzoom)&&y.deepEqual(_t.maxzoom,Dt.maxzoom)||je.push({command:jr.setLayerZoomRange,args:[nt,Dt.minzoom,Dt.maxzoom]}),_t)_t.hasOwnProperty($t)&&$t!=="layout"&&$t!=="paint"&&$t!=="filter"&&$t!=="metadata"&&$t!=="minzoom"&&$t!=="maxzoom"&&($t.indexOf("paint.")===0?mi(_t[$t],Dt[$t],je,nt,$t.slice(6),jr.setPaintProperty):y.deepEqual(_t[$t],Dt[$t])||je.push({command:jr.setLayerProperty,args:[nt,$t,Dt[$t]]}));for($t in Dt)Dt.hasOwnProperty($t)&&!_t.hasOwnProperty($t)&&$t!=="layout"&&$t!=="paint"&&$t!=="filter"&&$t!=="metadata"&&$t!=="minzoom"&&$t!=="maxzoom"&&($t.indexOf("paint.")===0?mi(_t[$t],Dt[$t],je,nt,$t.slice(6),jr.setPaintProperty):y.deepEqual(_t[$t],Dt[$t])||je.push({command:jr.setLayerProperty,args:[nt,$t,Dt[$t]]}))}else je.push({command:jr.removeLayer,args:[nt]}),nr=dn[dn.lastIndexOf(nt)+1],je.push({command:jr.addLayer,args:[Dt,nr]})}(be,O.layers,G)}catch(Te){console.warn("Unable to compute style diff:",Te),G=[{command:jr.setStyle,args:[O]}]}return G}(this.serialize(),d).filter(function(R){return!(R.command in el)});if(S.length===0)return!1;var C=S.filter(function(R){return!(R.command in Bu)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(R){return R.command}).join(", ")+".");return S.forEach(function(R){R.command!=="setTransition"&&g[R.command].apply(g,R.args)}),this.stylesheet=d,!0},v.prototype.addImage=function(d,g){if(this.getImage(d))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(d,g),this._afterImageUpdated(d)},v.prototype.updateImage=function(d,g){this.imageManager.updateImage(d,g)},v.prototype.getImage=function(d){return this.imageManager.getImage(d)},v.prototype.removeImage=function(d){if(!this.getImage(d))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(d),this._afterImageUpdated(d)},v.prototype._afterImageUpdated=function(d){this._availableImages=this.imageManager.listImages(),this._changedImages[d]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},v.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},v.prototype.addSource=function(d,g,S){var C=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[d]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+d,g,null,S))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var R=this.sourceCaches[d]=new K(d,g,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:R.serialize(),sourceId:d}}),R.onAdd(this.map),this._changed=!0}},v.prototype.removeSource=function(d){if(this._checkLoaded(),this.sourceCaches[d]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===d)return this.fire(new y.ErrorEvent(new Error('Source "'+d+'" cannot be removed while layer "'+g+'" is using it.')));var S=this.sourceCaches[d];delete this.sourceCaches[d],delete this._updatedSources[d],S.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:d})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},v.prototype.setGeoJSONSourceData=function(d,g){this._checkLoaded(),this.sourceCaches[d].getSource().setData(g),this._changed=!0},v.prototype.getSource=function(d){return this.sourceCaches[d]&&this.sourceCaches[d].getSource()},v.prototype.addLayer=function(d,g,S){S===void 0&&(S={}),this._checkLoaded();var C=d.id;if(this.getLayer(C))this.fire(new y.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var R;if(d.type==="custom"){if(Lu(this,y.validateCustomStyleLayer(d)))return;R=y.createStyleLayer(d)}else{if(typeof d.source=="object"&&(this.addSource(C,d.source),d=y.clone$1(d),d=y.extend(d,{source:C})),this._validate(y.validateStyle.layer,"layers."+C,d,{arrayIndex:-1},S))return;R=y.createStyleLayer(d),this._validateLayer(R),R.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[R.id]=R.serialize()}var O=g?this._order.indexOf(g):this._order.length;if(g&&O===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(O,0,C),this._layerOrderChanged=!0,this._layers[C]=R,this._removedLayers[C]&&R.source&&R.type!=="custom"){var G=this._removedLayers[C];delete this._removedLayers[C],G.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},v.prototype.moveLayer=function(d,g){if(this._checkLoaded(),this._changed=!0,this._layers[d]){if(d!==g){var S=this._order.indexOf(d);this._order.splice(S,1);var C=g?this._order.indexOf(g):this._order.length;g&&C===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(C,0,d),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be moved.")))},v.prototype.removeLayer=function(d){this._checkLoaded();var g=this._layers[d];if(g){g.setEventedParent(null);var S=this._order.indexOf(d);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[d]=g,delete this._layers[d],delete this._serializedLayers[d],delete this._updatedLayers[d],delete this._updatedPaintProps[d],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be removed.")))},v.prototype.getLayer=function(d){return this._layers[d]},v.prototype.hasLayer=function(d){return d in this._layers},v.prototype.setLayerZoomRange=function(d,g,S){this._checkLoaded();var C=this.getLayer(d);C?C.minzoom===g&&C.maxzoom===S||(g!=null&&(C.minzoom=g),S!=null&&(C.maxzoom=S),this._updateLayer(C)):this.fire(new y.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot have zoom extent.")))},v.prototype.setFilter=function(d,g,S){S===void 0&&(S={}),this._checkLoaded();var C=this.getLayer(d);if(C){if(!y.deepEqual(C.filter,g))return g==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(y.validateStyle.filter,"layers."+C.id+".filter",g,null,S)||(C.filter=y.clone$1(g),this._updateLayer(C)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be filtered.")))},v.prototype.getFilter=function(d){return y.clone$1(this.getLayer(d).filter)},v.prototype.setLayoutProperty=function(d,g,S,C){C===void 0&&(C={}),this._checkLoaded();var R=this.getLayer(d);R?y.deepEqual(R.getLayoutProperty(g),S)||(R.setLayoutProperty(g,S,C),this._updateLayer(R)):this.fire(new y.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getLayoutProperty=function(d,g){var S=this.getLayer(d);if(S)return S.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style.")))},v.prototype.setPaintProperty=function(d,g,S,C){C===void 0&&(C={}),this._checkLoaded();var R=this.getLayer(d);R?y.deepEqual(R.getPaintProperty(g),S)||(R.setPaintProperty(g,S,C)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[d]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getPaintProperty=function(d,g){return this.getLayer(d).getPaintProperty(g)},v.prototype.setFeatureState=function(d,g){this._checkLoaded();var S=d.source,C=d.sourceLayer,R=this.sourceCaches[S];if(R!==void 0){var O=R.getSource().type;O==="geojson"&&C?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):O!=="vector"||C?(d.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(C,d.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.removeFeatureState=function(d,g){this._checkLoaded();var S=d.source,C=this.sourceCaches[S];if(C!==void 0){var R=C.getSource().type,O=R==="vector"?d.sourceLayer:void 0;R!=="vector"||O?g&&typeof d.id!="string"&&typeof d.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(O,d.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.getFeatureState=function(d){this._checkLoaded();var g=d.source,S=d.sourceLayer,C=this.sourceCaches[g];if(C!==void 0){if(C.getSource().type!=="vector"||S)return d.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(S,d.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},v.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},v.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(d){return d.serialize()}),layers:this._serializeLayers(this._order)},function(d){return d!==void 0})},v.prototype._updateLayer=function(d){this._updatedLayers[d.id]=!0,d.source&&!this._updatedSources[d.source]&&this.sourceCaches[d.source].getSource().type!=="raster"&&(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause()),this._changed=!0},v.prototype._flattenAndSortRenderedFeatures=function(d){for(var g=this,S=function(Hr){return g._layers[Hr].type==="fill-extrusion"},C={},R=[],O=this._order.length-1;O>=0;O--){var G=this._order[O];if(S(G)){C[G]=O;for(var J=0,_e=d;J<_e.length;J+=1){var be=_e[J][G];if(be)for(var Te=0,We=be;Te<We.length;Te+=1)R.push(We[Te])}}}R.sort(function(Hr,Nr){return Nr.intersectionZ-Hr.intersectionZ});for(var je=[],at=this._order.length-1;at>=0;at--){var Fe=this._order[at];if(S(Fe))for(var nt=R.length-1;nt>=0;nt--){var _t=R[nt].feature;if(C[_t.layer.id]<at)break;je.push(_t),R.pop()}else for(var Dt=0,nr=d;Dt<nr.length;Dt+=1){var $t=nr[Dt][Fe];if($t)for(var cr=0,yr=$t;cr<yr.length;cr+=1)je.push(yr[cr].feature)}}return je},v.prototype.queryRenderedFeatures=function(d,g,S){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var C={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,O=g.layers;R<O.length;R+=1){var G=O[R],J=this._layers[G];if(!J)return this.fire(new y.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];C[J.source]=!0}}var _e=[];for(var be in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!C[be]||_e.push(ar(this.sourceCaches[be],this._layers,this._serializedLayers,d,g,S));return this.placement&&_e.push(function(Te,We,je,at,Fe,nt,_t){for(var Dt={},nr=nt.queryRenderedSymbols(at),$t=[],cr=0,yr=Object.keys(nr).map(Number);cr<yr.length;cr+=1)$t.push(_t[yr[cr]]);$t.sort(Dn);for(var Hr=function(){var zn=dn[Nr],Ni=zn.featureIndex.lookupSymbolFeatures(nr[zn.bucketInstanceId],We,zn.bucketIndex,zn.sourceLayerIndex,Fe.filter,Fe.layers,Fe.availableImages,Te);for(var yn in Ni){var ii=Dt[yn]=Dt[yn]||[],pi=Ni[yn];pi.sort(function(fi,ei){var $n=zn.featureSortOrder;if($n){var To=$n.indexOf(fi.featureIndex);return $n.indexOf(ei.featureIndex)-To}return ei.featureIndex-fi.featureIndex});for(var ti=0,Jn=pi;ti<Jn.length;ti+=1)ii.push(Jn[ti])}},Nr=0,dn=$t;Nr<dn.length;Nr+=1)Hr();var Nn=function(zn){Dt[zn].forEach(function(Ni){var yn=Ni.feature,ii=je[Te[zn].source].getFeatureState(yn.layer["source-layer"],yn.id);yn.source=yn.layer.source,yn.layer["source-layer"]&&(yn.sourceLayer=yn.layer["source-layer"]),yn.state=ii})};for(var Bn in Dt)Nn(Bn);return Dt}(this._layers,this._serializedLayers,this.sourceCaches,d,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_e)},v.prototype.querySourceFeatures=function(d,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var S=this.sourceCaches[d];return S?function(C,R){for(var O=C.getRenderableIds().map(function(We){return C.getTileByID(We)}),G=[],J={},_e=0;_e<O.length;_e++){var be=O[_e],Te=be.tileID.canonical.key;J[Te]||(J[Te]=!0,be.querySourceFeatures(G,R))}return G}(S,g):[]},v.prototype.addSourceType=function(d,g,S){return v.getSourceType(d)?S(new Error('A source type called "'+d+'" already exists.')):(v.setSourceType(d,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:d,url:g.workerSourceURL},S):S(null,null))},v.prototype.getLight=function(){return this.light.getLight()},v.prototype.setLight=function(d,g){g===void 0&&(g={}),this._checkLoaded();var S=this.light.getLight(),C=!1;for(var R in d)if(!y.deepEqual(d[R],S[R])){C=!0;break}if(C){var O={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(d,g),this.light.updateTransitions(O)}},v.prototype._validate=function(d,g,S,C,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Lu(this,d.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:S,styleSpec:y.styleSpec},C)))},v.prototype._remove=function(){for(var d in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[d].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},v.prototype._clearSource=function(d){this.sourceCaches[d].clearTiles()},v.prototype._reloadSource=function(d){this.sourceCaches[d].resume(),this.sourceCaches[d].reload()},v.prototype._updateSources=function(d){for(var g in this.sourceCaches)this.sourceCaches[g].update(d)},v.prototype._generateCollisionBoxes=function(){for(var d in this.sourceCaches)this._reloadSource(d)},v.prototype._updatePlacement=function(d,g,S,C,R){R===void 0&&(R=!1);for(var O=!1,G=!1,J={},_e=0,be=this._order;_e<be.length;_e+=1){var Te=this._layers[be[_e]];if(Te.type==="symbol"){if(!J[Te.source]){var We=this.sourceCaches[Te.source];J[Te.source]=We.getRenderableIds(!0).map(function(_t){return We.getTileByID(_t)}).sort(function(_t,Dt){return Dt.tileID.overscaledZ-_t.tileID.overscaledZ||(_t.tileID.isLessThan(Dt.tileID)?-1:1)})}var je=this.crossTileSymbolIndex.addLayer(Te,J[Te.source],d.center.lng);O=O||je}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),d.zoom))&&(this.pauseablePlacement=new Zc(d,this._order,R,g,S,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,J),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),G=!0),O&&this.pauseablePlacement.placement.setStale()),G||O)for(var at=0,Fe=this._order;at<Fe.length;at+=1){var nt=this._layers[Fe[at]];nt.type==="symbol"&&this.placement.updateLayerOpacities(nt,J[nt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},v.prototype._releaseSymbolFadeTiles=function(){for(var d in this.sourceCaches)this.sourceCaches[d].releaseSymbolFadeTiles()},v.prototype.getImages=function(d,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();var C=this.sourceCaches[g.source];C&&C.setDependencies(g.tileID.key,g.type,g.icons)},v.prototype.getGlyphs=function(d,g,S){this.glyphManager.getGlyphs(g.stacks,S)},v.prototype.getResource=function(d,g,S){return y.makeRequest(g,S)},v}(y.Evented);Rs.getSourceType=function(h){return rr[h]},Rs.setSourceType=function(h,v){rr[h]=v},Rs.registerForPluginStateChange=y.registerForPluginStateChange;var Ga=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),wl=In(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),tl=In(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),yf=In(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),jh=In(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),xf=In("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),nh=In(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),ih=In(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),ah=In("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Hh=In("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Wh=In("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Np=In(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),jc=In(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Fu=In(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Gh=In(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Wo=In(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Hl=In(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Cl=In(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Xs=In(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Rl=In(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ou=In(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),vi=In(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),$s=In(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Nu=In(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),rl=In(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),oh=In(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Xh=In(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function In(h,v){var d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=v.match(/attribute ([\w]+) ([\w]+)/g),S=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=C?C.concat(S):S,O={};return{fragmentSource:h=h.replace(d,function(G,J,_e,be,Te){return O[Te]=!0,J==="define"?`
#ifndef HAS_UNIFORM_u_`+Te+`
varying `+_e+" "+be+" "+Te+`;
#else
uniform `+_e+" "+be+" u_"+Te+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Te+`
    `+_e+" "+be+" "+Te+" = u_"+Te+`;
#endif
`}),vertexSource:v=v.replace(d,function(G,J,_e,be,Te){var We=be==="float"?"vec2":"vec4",je=Te.match(/color/)?"color":We;return O[Te]?J==="define"?`
#ifndef HAS_UNIFORM_u_`+Te+`
uniform lowp float u_`+Te+`_t;
attribute `+_e+" "+We+" a_"+Te+`;
varying `+_e+" "+be+" "+Te+`;
#else
uniform `+_e+" "+be+" u_"+Te+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+Te+" = a_"+Te+`;
#else
    `+_e+" "+be+" "+Te+" = u_"+Te+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+Te+" = unpack_mix_"+je+"(a_"+Te+", u_"+Te+`_t);
#else
    `+_e+" "+be+" "+Te+" = u_"+Te+`;
#endif
`:J==="define"?`
#ifndef HAS_UNIFORM_u_`+Te+`
uniform lowp float u_`+Te+`_t;
attribute `+_e+" "+We+" a_"+Te+`;
#else
uniform `+_e+" "+be+" u_"+Te+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+_e+" "+be+" "+Te+" = a_"+Te+`;
#else
    `+_e+" "+be+" "+Te+" = u_"+Te+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+_e+" "+be+" "+Te+" = unpack_mix_"+je+"(a_"+Te+", u_"+Te+`_t);
#else
    `+_e+" "+be+" "+Te+" = u_"+Te+`;
#endif
`}),staticAttributes:g,staticUniforms:R}}var Ys=Object.freeze({__proto__:null,prelude:wl,background:tl,backgroundPattern:yf,circle:jh,clippingMask:xf,heatmap:nh,heatmapTexture:ih,collisionBox:ah,collisionCircle:Hh,debug:Wh,fill:Np,fillOutline:jc,fillOutlinePattern:Fu,fillPattern:Gh,fillExtrusion:Wo,fillExtrusionPattern:Hl,hillshadePrepare:Cl,hillshade:Xs,line:Rl,lineGradient:ou,linePattern:vi,lineSDF:$s,raster:Nu,symbolIcon:rl,symbolSDF:oh,symbolTextAndIcon:Xh}),Es=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Uu(h){for(var v=[],d=0;d<h.length;d++)if(h[d]!==null){var g=h[d].split(" ");v.push(g.pop())}return v}Es.prototype.bind=function(h,v,d,g,S,C,R,O){this.context=h;for(var G=this.boundPaintVertexBuffers.length!==g.length,J=0;!G&&J<g.length;J++)this.boundPaintVertexBuffers[J]!==g[J]&&(G=!0);h.extVertexArrayObject&&this.vao&&this.boundProgram===v&&this.boundLayoutVertexBuffer===d&&!G&&this.boundIndexBuffer===S&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===O?(h.bindVertexArrayOES.set(this.vao),R&&R.bind(),S&&S.dynamicDraw&&S.bind(),O&&O.bind()):this.freshBind(v,d,g,S,C,R,O)},Es.prototype.freshBind=function(h,v,d,g,S,C,R){var O,G=h.numAttributes,J=this.context,_e=J.gl;if(J.extVertexArrayObject)this.vao&&this.destroy(),this.vao=J.extVertexArrayObject.createVertexArrayOES(),J.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=h,this.boundLayoutVertexBuffer=v,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=R;else{O=J.currentNumAttributes||0;for(var be=G;be<O;be++)_e.disableVertexAttribArray(be)}v.enableAttributes(_e,h);for(var Te=0,We=d;Te<We.length;Te+=1)We[Te].enableAttributes(_e,h);C&&C.enableAttributes(_e,h),R&&R.enableAttributes(_e,h),v.bind(),v.setVertexAttribPointers(_e,h,S);for(var je=0,at=d;je<at.length;je+=1){var Fe=at[je];Fe.bind(),Fe.setVertexAttribPointers(_e,h,S)}C&&(C.bind(),C.setVertexAttribPointers(_e,h,S)),g&&g.bind(),R&&(R.bind(),R.setVertexAttribPointers(_e,h,S)),J.currentNumAttributes=G},Es.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Xa=function(h,v,d,g,S,C){var R=h.gl;this.program=R.createProgram();for(var O=Uu(d.staticAttributes),G=g?g.getBinderAttributes():[],J=O.concat(G),_e=d.staticUniforms?Uu(d.staticUniforms):[],be=g?g.getBinderUniforms():[],Te=[],We=0,je=_e.concat(be);We<je.length;We+=1){var at=je[We];Te.indexOf(at)<0&&Te.push(at)}var Fe=g?g.defines():[];C&&Fe.push("#define OVERDRAW_INSPECTOR;");var nt=Fe.concat(wl.fragmentSource,d.fragmentSource).join(`
`),_t=Fe.concat(wl.vertexSource,d.vertexSource).join(`
`),Dt=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(Dt,nt),R.compileShader(Dt),R.attachShader(this.program,Dt);var nr=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(nr,_t),R.compileShader(nr),R.attachShader(this.program,nr),this.attributes={};var $t={};this.numAttributes=J.length;for(var cr=0;cr<this.numAttributes;cr++)J[cr]&&(R.bindAttribLocation(this.program,cr,J[cr]),this.attributes[J[cr]]=cr);R.linkProgram(this.program),R.deleteShader(nr),R.deleteShader(Dt);for(var yr=0;yr<Te.length;yr++){var Hr=Te[yr];if(Hr&&!$t[Hr]){var Nr=R.getUniformLocation(this.program,Hr);Nr&&($t[Hr]=Nr)}}this.fixedUniforms=S(h,$t),this.binderUniforms=g?g.getUniforms(h,$t):[]}}};function bf(h,v,d){var g=1/aa(d,1,v.transform.tileZoom),S=Math.pow(2,d.tileID.overscaledZ),C=d.tileSize*Math.pow(2,v.transform.tileZoom)/S,R=C*(d.tileID.canonical.x+d.tileID.wrap*S),O=C*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[g,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[R>>16,O>>16],u_pixel_coord_lower:[65535&R,65535&O]}}Xa.prototype.draw=function(h,v,d,g,S,C,R,O,G,J,_e,be,Te,We,je,at){var Fe,nt=h.gl;if(!this.failedToCreate){for(var _t in h.program.set(this.program),h.setDepthMode(d),h.setStencilMode(g),h.setColorMode(S),h.setCullFace(C),this.fixedUniforms)this.fixedUniforms[_t].set(R[_t]);We&&We.setUniforms(h,this.binderUniforms,be,{zoom:Te});for(var Dt=(Fe={},Fe[nt.LINES]=2,Fe[nt.TRIANGLES]=3,Fe[nt.LINE_STRIP]=1,Fe)[v],nr=0,$t=_e.get();nr<$t.length;nr+=1){var cr=$t[nr],yr=cr.vaos||(cr.vaos={});(yr[O]||(yr[O]=new Es)).bind(h,this,G,We?We.getPaintVertexBuffers():[],J,cr.vertexOffset,je,at),nt.drawElements(v,cr.primitiveLength*Dt,nt.UNSIGNED_SHORT,cr.primitiveOffset*Dt*2)}}};var Ef=function(h,v,d,g){var S=v.style.light,C=S.properties.get("position"),R=[C.x,C.y,C.z],O=y.create$1();S.properties.get("anchor")==="viewport"&&y.fromRotation(O,-v.transform.angle),y.transformMat3(R,R,O);var G=S.properties.get("color");return{u_matrix:h,u_lightpos:R,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+d,u_opacity:g}},Ms=function(h,v,d,g,S,C,R){return y.extend(Ef(h,v,d,g),bf(C,v,R),{u_height_factor:-Math.pow(2,S.overscaledZ)/R.tileSize/8})},nl=function(h){return{u_matrix:h}},_u=function(h,v,d,g){return y.extend(nl(h),bf(d,v,g))},Ml=function(h,v){return{u_matrix:h,u_world:v}},sh=function(h,v,d,g,S){return y.extend(_u(h,v,d,g),{u_world:S})},gc=function(h,v,d,g){var S,C,R=h.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var O=aa(d,1,R.zoom);S=!0,C=[O,O]}else S=!1,C=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(v.posMatrix,d,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:C}},oa=function(h,v,d){var g=aa(d,1,v.zoom),S=Math.pow(2,v.zoom-d.tileID.overscaledZ),C=d.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:v.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[v.pixelsToGLUnits[0]/(g*S),v.pixelsToGLUnits[1]/(g*S)],u_overscale_factor:C}},_c=function(h,v,d){return{u_matrix:h,u_inv_matrix:v,u_camera_to_center_distance:d.cameraToCenterDistance,u_viewport_size:[d.width,d.height]}},il=function(h,v,d){return d===void 0&&(d=1),{u_matrix:h,u_color:v,u_overlay:0,u_overlay_scale:d}},Il=function(h){return{u_matrix:h}},uh=function(h,v,d,g){return{u_matrix:h,u_extrude_scale:aa(v,1,d),u_intensity:g}},Hc=function(h,v,d){var g=h.transform;return{u_matrix:Wc(h,v,d),u_ratio:1/aa(v,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ua=function(h,v,d,g){return y.extend(Hc(h,v,d),{u_image:0,u_image_height:g})},Pl=function(h,v,d,g){var S=h.transform,C=Is(v,S);return{u_matrix:Wc(h,v,d),u_texsize:v.imageAtlasTexture.size,u_ratio:1/aa(v,1,S.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[C,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},$h=function(h,v,d,g,S){var C=h.lineAtlas,R=Is(v,h.transform),O=d.layout.get("line-cap")==="round",G=C.getDash(g.from,O),J=C.getDash(g.to,O),_e=G.width*S.fromScale,be=J.width*S.toScale;return y.extend(Hc(h,v,d),{u_patternscale_a:[R/_e,-G.height/2],u_patternscale_b:[R/be,-J.height/2],u_sdfgamma:C.width/(256*Math.min(_e,be)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:J.y,u_mix:S.t})};function Is(h,v){return 1/aa(h,1,v.tileZoom)}function Wc(h,v,d){return h.translatePosMatrix(v.tileID.posMatrix,v,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}var Gc=function(h,v,d,g,S){return{u_matrix:h,u_tl_parent:v,u_scale_parent:d,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(R=S.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(C=S.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:Sf(S.paint.get("raster-hue-rotate"))};var C,R};function Sf(h){h*=Math.PI/180;var v=Math.sin(h),d=Math.cos(h);return[(2*d+1)/3,(-Math.sqrt(3)*v-d+1)/3,(Math.sqrt(3)*v-d+1)/3]}var al,Wl=function(h,v,d,g,S,C,R,O,G,J){var _e=S.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:v?v.uSizeT:0,u_size:v?v.uSize:0,u_camera_to_center_distance:_e.cameraToCenterDistance,u_pitch:_e.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:_e.width/_e.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:R,u_coord_matrix:O,u_is_text:+G,u_pitch_with_map:+g,u_texsize:J,u_texture:0}},zu=function(h,v,d,g,S,C,R,O,G,J,_e){var be=S.transform;return y.extend(Wl(h,v,d,g,S,C,R,O,G,J),{u_gamma_scale:g?Math.cos(be._pitch)*be.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+_e})},Xc=function(h,v,d,g,S,C,R,O,G,J){return y.extend(zu(h,v,d,g,S,C,R,O,!0,G,!0),{u_texsize_icon:J,u_texture_icon:1})},yc=function(h,v,d){return{u_matrix:h,u_opacity:v,u_color:d}},Gl=function(h,v,d,g,S,C){return y.extend(function(R,O,G,J){var _e=G.imageManager.getPattern(R.from.toString()),be=G.imageManager.getPattern(R.to.toString()),Te=G.imageManager.getPixelSize(),We=Te.width,je=Te.height,at=Math.pow(2,J.tileID.overscaledZ),Fe=J.tileSize*Math.pow(2,G.transform.tileZoom)/at,nt=Fe*(J.tileID.canonical.x+J.tileID.wrap*at),_t=Fe*J.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:_e.tl,u_pattern_br_a:_e.br,u_pattern_tl_b:be.tl,u_pattern_br_b:be.br,u_texsize:[We,je],u_mix:O.t,u_pattern_size_a:_e.displaySize,u_pattern_size_b:be.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/aa(J,1,G.transform.tileZoom),u_pixel_coord_upper:[nt>>16,_t>>16],u_pixel_coord_lower:[65535&nt,65535&_t]}}(g,C,d,S),{u_matrix:h,u_opacity:v})},Af={fillExtrusion:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_lightpos:new y.Uniform3f(h,v.u_lightpos),u_lightintensity:new y.Uniform1f(h,v.u_lightintensity),u_lightcolor:new y.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new y.Uniform1f(h,v.u_vertical_gradient),u_opacity:new y.Uniform1f(h,v.u_opacity)}},fillExtrusionPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_lightpos:new y.Uniform3f(h,v.u_lightpos),u_lightintensity:new y.Uniform1f(h,v.u_lightintensity),u_lightcolor:new y.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new y.Uniform1f(h,v.u_vertical_gradient),u_height_factor:new y.Uniform1f(h,v.u_height_factor),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade),u_opacity:new y.Uniform1f(h,v.u_opacity)}},fill:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},fillPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},fillOutline:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world)}},fillOutlinePattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},circle:function(h,v){return{u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(h,v.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(h,v.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},collisionBox:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(h,v.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(h,v.u_extrude_scale),u_overscale_factor:new y.Uniform1f(h,v.u_overscale_factor)}},collisionCircle:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_inv_matrix:new y.UniformMatrix4f(h,v.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(h,v.u_viewport_size)}},debug:function(h,v){return{u_color:new y.UniformColor(h,v.u_color),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_overlay:new y.Uniform1i(h,v.u_overlay),u_overlay_scale:new y.Uniform1f(h,v.u_overlay_scale)}},clippingMask:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},heatmap:function(h,v){return{u_extrude_scale:new y.Uniform1f(h,v.u_extrude_scale),u_intensity:new y.Uniform1f(h,v.u_intensity),u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},heatmapTexture:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world),u_image:new y.Uniform1i(h,v.u_image),u_color_ramp:new y.Uniform1i(h,v.u_color_ramp),u_opacity:new y.Uniform1f(h,v.u_opacity)}},hillshade:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_latrange:new y.Uniform2f(h,v.u_latrange),u_light:new y.Uniform2f(h,v.u_light),u_shadow:new y.UniformColor(h,v.u_shadow),u_highlight:new y.UniformColor(h,v.u_highlight),u_accent:new y.UniformColor(h,v.u_accent)}},hillshadePrepare:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_dimension:new y.Uniform2f(h,v.u_dimension),u_zoom:new y.Uniform1f(h,v.u_zoom),u_unpack:new y.Uniform4f(h,v.u_unpack)}},line:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels)}},lineGradient:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_image:new y.Uniform1i(h,v.u_image),u_image_height:new y.Uniform1f(h,v.u_image_height)}},linePattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_texsize:new y.Uniform2f(h,v.u_texsize),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_image:new y.Uniform1i(h,v.u_image),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},lineSDF:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(h,v.u_patternscale_a),u_patternscale_b:new y.Uniform2f(h,v.u_patternscale_b),u_sdfgamma:new y.Uniform1f(h,v.u_sdfgamma),u_image:new y.Uniform1i(h,v.u_image),u_tex_y_a:new y.Uniform1f(h,v.u_tex_y_a),u_tex_y_b:new y.Uniform1f(h,v.u_tex_y_b),u_mix:new y.Uniform1f(h,v.u_mix)}},raster:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_tl_parent:new y.Uniform2f(h,v.u_tl_parent),u_scale_parent:new y.Uniform1f(h,v.u_scale_parent),u_buffer_scale:new y.Uniform1f(h,v.u_buffer_scale),u_fade_t:new y.Uniform1f(h,v.u_fade_t),u_opacity:new y.Uniform1f(h,v.u_opacity),u_image0:new y.Uniform1i(h,v.u_image0),u_image1:new y.Uniform1i(h,v.u_image1),u_brightness_low:new y.Uniform1f(h,v.u_brightness_low),u_brightness_high:new y.Uniform1f(h,v.u_brightness_high),u_saturation_factor:new y.Uniform1f(h,v.u_saturation_factor),u_contrast_factor:new y.Uniform1f(h,v.u_contrast_factor),u_spin_weights:new y.Uniform3f(h,v.u_spin_weights)}},symbolIcon:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texture:new y.Uniform1i(h,v.u_texture)}},symbolSDF:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texture:new y.Uniform1i(h,v.u_texture),u_gamma_scale:new y.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(h,v.u_is_halo)}},symbolTextAndIcon:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texsize_icon:new y.Uniform2f(h,v.u_texsize_icon),u_texture:new y.Uniform1i(h,v.u_texture),u_texture_icon:new y.Uniform1i(h,v.u_texture_icon),u_gamma_scale:new y.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(h,v.u_is_halo)}},background:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_opacity:new y.Uniform1f(h,v.u_opacity),u_color:new y.UniformColor(h,v.u_color)}},backgroundPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_opacity:new y.Uniform1f(h,v.u_opacity),u_image:new y.Uniform1i(h,v.u_image),u_pattern_tl_a:new y.Uniform2f(h,v.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(h,v.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(h,v.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(h,v.u_pattern_br_b),u_texsize:new y.Uniform2f(h,v.u_texsize),u_mix:new y.Uniform1f(h,v.u_mix),u_pattern_size_a:new y.Uniform2f(h,v.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(h,v.u_pattern_size_b),u_scale_a:new y.Uniform1f(h,v.u_scale_a),u_scale_b:new y.Uniform1f(h,v.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(h,v.u_tile_units_to_pixels)}}};function xc(h,v,d,g,S,C,R){for(var O=h.context,G=O.gl,J=h.useProgram("collisionBox"),_e=[],be=0,Te=0,We=0;We<g.length;We++){var je=g[We],at=v.getTile(je),Fe=at.getBucket(d);if(Fe){var nt=je.posMatrix;S[0]===0&&S[1]===0||(nt=h.translatePosMatrix(je.posMatrix,at,S,C));var _t=R?Fe.textCollisionBox:Fe.iconCollisionBox,Dt=Fe.collisionCircleArray;if(Dt.length>0){var nr=y.create(),$t=nt;y.mul(nr,Fe.placementInvProjMatrix,h.transform.glCoordMatrix),y.mul(nr,nr,Fe.placementViewportMatrix),_e.push({circleArray:Dt,circleOffset:Te,transform:$t,invTransform:nr}),Te=be+=Dt.length/4}_t&&J.draw(O,G.LINES,ee.disabled,Se.disabled,h.colorModeForRenderPass(),Je.disabled,oa(nt,h.transform,at),d.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,null,h.transform.zoom,null,null,_t.collisionVertexBuffer)}}if(R&&_e.length){var cr=h.useProgram("collisionCircle"),yr=new y.StructArrayLayout2f1f2i16;yr.resize(4*be),yr._trim();for(var Hr=0,Nr=0,dn=_e;Nr<dn.length;Nr+=1)for(var Nn=dn[Nr],Bn=0;Bn<Nn.circleArray.length/4;Bn++){var zn=4*Bn,Ni=Nn.circleArray[zn+0],yn=Nn.circleArray[zn+1],ii=Nn.circleArray[zn+2],pi=Nn.circleArray[zn+3];yr.emplace(Hr++,Ni,yn,ii,pi,0),yr.emplace(Hr++,Ni,yn,ii,pi,1),yr.emplace(Hr++,Ni,yn,ii,pi,2),yr.emplace(Hr++,Ni,yn,ii,pi,3)}(!al||al.length<2*be)&&(al=function($a){var wo=2*$a,fo=new y.StructArrayLayout3ui6;fo.resize(wo),fo._trim();for(var Na=0;Na<wo;Na++){var Ya=6*Na;fo.uint16[Ya+0]=4*Na+0,fo.uint16[Ya+1]=4*Na+1,fo.uint16[Ya+2]=4*Na+2,fo.uint16[Ya+3]=4*Na+2,fo.uint16[Ya+4]=4*Na+3,fo.uint16[Ya+5]=4*Na+0}return fo}(be));for(var ti=O.createIndexBuffer(al,!0),Jn=O.createVertexBuffer(yr,y.collisionCircleLayout.members,!0),fi=0,ei=_e;fi<ei.length;fi+=1){var $n=ei[fi],To=_c($n.transform,$n.invTransform,h.transform);cr.draw(O,G.TRIANGLES,ee.disabled,Se.disabled,h.colorModeForRenderPass(),Je.disabled,To,d.id,Jn,ti,y.SegmentVector.simpleSegment(0,2*$n.circleOffset,$n.circleArray.length,$n.circleArray.length/2),null,h.transform.zoom,null,null,null)}Jn.destroy(),ti.destroy()}}var Ps=y.identity(new Float32Array(16));function lh(h,v,d,g,S,C){var R=y.getAnchorAlignment(h),O=-(R.horizontalAlign-.5)*v,G=-(R.verticalAlign-.5)*d,J=y.evaluateVariableOffset(h,g);return new y.Point((O/S+J[0])*C,(G/S+J[1])*C)}function $c(h,v,d,g,S,C,R,O,G,J,_e){var be=h.text.placedSymbolArray,Te=h.text.dynamicLayoutVertexArray,We=h.icon.dynamicLayoutVertexArray,je={};Te.clear();for(var at=0;at<be.length;at++){var Fe=be.get(at),nt=Fe.hidden||!Fe.crossTileID||h.allowVerticalPlacement&&!Fe.placedOrientation?null:g[Fe.crossTileID];if(nt){var _t=new y.Point(Fe.anchorX,Fe.anchorY),Dt=gi(_t,d?O:R),nr=Ei(C.cameraToCenterDistance,Dt.signedDistanceFromCamera),$t=S.evaluateSizeForFeature(h.textSizeData,J,Fe)*nr/y.ONE_EM;d&&($t*=h.tilePixelRatio/G);for(var cr=lh(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale,$t),yr=d?gi(_t.add(cr),R).point:Dt.point.add(v?cr.rotate(-C.angle):cr),Hr=h.allowVerticalPlacement&&Fe.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,Nr=0;Nr<Fe.numGlyphs;Nr++)y.addDynamicAttributes(Te,yr,Hr);_e&&Fe.associatedIconIndex>=0&&(je[Fe.associatedIconIndex]={shiftedAnchor:yr,angle:Hr})}else li(Fe.numGlyphs,Te)}if(_e){We.clear();for(var dn=h.icon.placedSymbolArray,Nn=0;Nn<dn.length;Nn++){var Bn=dn.get(Nn);if(Bn.hidden)li(Bn.numGlyphs,We);else{var zn=je[Nn];if(zn)for(var Ni=0;Ni<Bn.numGlyphs;Ni++)y.addDynamicAttributes(We,zn.shiftedAnchor,zn.angle);else li(Bn.numGlyphs,We)}}h.icon.dynamicLayoutVertexBuffer.updateData(We)}h.text.dynamicLayoutVertexBuffer.updateData(Te)}function bc(h,v,d){return d.iconsInText&&v?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Ol(h,v,d,g,S,C,R,O,G,J,_e,be){for(var Te=h.context,We=Te.gl,je=h.transform,at=O==="map",Fe=G==="map",nt=at&&d.layout.get("symbol-placement")!=="point",_t=at&&!Fe&&!nt,Dt=d.layout.get("symbol-sort-key").constantOr(1)!==void 0,nr=!1,$t=h.depthModeForSublayer(0,ee.ReadOnly),cr=d.layout.get("text-variable-anchor"),yr=[],Hr=0,Nr=g;Hr<Nr.length;Hr+=1){var dn=Nr[Hr],Nn=v.getTile(dn),Bn=Nn.getBucket(d);if(Bn){var zn=S?Bn.text:Bn.icon;if(zn&&zn.segments.get().length){var Ni=zn.programConfigurations.get(d.id),yn=S||Bn.sdfIcons,ii=S?Bn.textSizeData:Bn.iconSizeData,pi=Fe||je.pitch!==0,ti=h.useProgram(bc(yn,S,Bn),Ni),Jn=y.evaluateSizeForZoom(ii,je.zoom),fi=void 0,ei=[0,0],$n=void 0,To=void 0,$a=null,wo=void 0;if(S)$n=Nn.glyphAtlasTexture,To=We.LINEAR,fi=Nn.glyphAtlasTexture.size,Bn.iconsInText&&(ei=Nn.imageAtlasTexture.size,$a=Nn.imageAtlasTexture,wo=pi||h.options.rotating||h.options.zooming||ii.kind==="composite"||ii.kind==="camera"?We.LINEAR:We.NEAREST);else{var fo=d.layout.get("icon-size").constantOr(0)!==1||Bn.iconsNeedLinear;$n=Nn.imageAtlasTexture,To=yn||h.options.rotating||h.options.zooming||fo||pi?We.LINEAR:We.NEAREST,fi=Nn.imageAtlasTexture.size}var Na=aa(Nn,1,h.transform.zoom),Ya=Sa(dn.posMatrix,Fe,at,h.transform,Na),fs=Mi(dn.posMatrix,Fe,at,h.transform,Na),hs=cr&&Bn.hasTextData(),cl=d.layout.get("icon-text-fit")!=="none"&&hs&&Bn.hasIconData();nt&&Gs(Bn,dn.posMatrix,h,S,Ya,fs,Fe,J);var ps=h.translatePosMatrix(dn.posMatrix,Nn,C,R),cu=nt||S&&cr||cl?Ps:Ya,Ls=h.translatePosMatrix(fs,Nn,C,R,!0),Cc=yn&&d.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Hu={program:ti,buffers:zn,uniformValues:yn?Bn.iconsInText?Xc(ii.kind,Jn,_t,Fe,h,ps,cu,Ls,fi,ei):zu(ii.kind,Jn,_t,Fe,h,ps,cu,Ls,S,fi,!0):Wl(ii.kind,Jn,_t,Fe,h,ps,cu,Ls,S,fi),atlasTexture:$n,atlasTextureIcon:$a,atlasInterpolation:To,atlasInterpolationIcon:wo,isSDF:yn,hasHalo:Cc};if(Dt&&Bn.canOverlap){nr=!0;for(var wu=0,ec=zn.segments.get();wu<ec.length;wu+=1){var fl=ec[wu];yr.push({segments:new y.SegmentVector([fl]),sortKey:fl.sortKey,state:Hu})}}else yr.push({segments:zn.segments,sortKey:0,state:Hu})}}}nr&&yr.sort(function(hu,Cu){return hu.sortKey-Cu.sortKey});for(var fu=0,hl=yr;fu<hl.length;fu+=1){var Co=hl[fu],ro=Co.state;if(Te.activeTexture.set(We.TEXTURE0),ro.atlasTexture.bind(ro.atlasInterpolation,We.CLAMP_TO_EDGE),ro.atlasTextureIcon&&(Te.activeTexture.set(We.TEXTURE1),ro.atlasTextureIcon&&ro.atlasTextureIcon.bind(ro.atlasInterpolationIcon,We.CLAMP_TO_EDGE)),ro.isSDF){var Ss=ro.uniformValues;ro.hasHalo&&(Ss.u_is_halo=1,Zu(ro.buffers,Co.segments,d,h,ro.program,$t,_e,be,Ss)),Ss.u_is_halo=0}Zu(ro.buffers,Co.segments,d,h,ro.program,$t,_e,be,ro.uniformValues)}}function Zu(h,v,d,g,S,C,R,O,G){var J=g.context;S.draw(J,J.gl.TRIANGLES,C,R,O,Je.disabled,G,d.id,h.layoutVertexBuffer,h.indexBuffer,v,d.paint,g.transform.zoom,h.programConfigurations.get(d.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Xl(h,v,d,g,S,C,R){var O,G,J,_e,be,Te=h.context.gl,We=d.paint.get("fill-pattern"),je=We&&We.constantOr(1),at=d.getCrossfadeParameters();R?(G=je&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=Te.LINES):(G=je?"fillPattern":"fill",O=Te.TRIANGLES);for(var Fe=0,nt=g;Fe<nt.length;Fe+=1){var _t=nt[Fe],Dt=v.getTile(_t);if(!je||Dt.patternsLoaded()){var nr=Dt.getBucket(d);if(nr){var $t=nr.programConfigurations.get(d.id),cr=h.useProgram(G,$t);je&&(h.context.activeTexture.set(Te.TEXTURE0),Dt.imageAtlasTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),$t.updatePaintBuffers(at));var yr=We.constantOr(null);if(yr&&Dt.imageAtlas){var Hr=Dt.imageAtlas,Nr=Hr.patternPositions[yr.to.toString()],dn=Hr.patternPositions[yr.from.toString()];Nr&&dn&&$t.setConstantPatternPositions(Nr,dn)}var Nn=h.translatePosMatrix(_t.posMatrix,Dt,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(R){_e=nr.indexBuffer2,be=nr.segments2;var Bn=[Te.drawingBufferWidth,Te.drawingBufferHeight];J=G==="fillOutlinePattern"&&je?sh(Nn,h,at,Dt,Bn):Ml(Nn,Bn)}else _e=nr.indexBuffer,be=nr.segments,J=je?_u(Nn,h,at,Dt):nl(Nn);cr.draw(h.context,O,S,h.stencilModeForClipping(_t),C,Je.disabled,J,d.id,nr.layoutVertexBuffer,_e,be,d.paint,h.transform.zoom,$t)}}}}function Tf(h,v,d,g,S,C,R){for(var O=h.context,G=O.gl,J=d.paint.get("fill-extrusion-pattern"),_e=J.constantOr(1),be=d.getCrossfadeParameters(),Te=d.paint.get("fill-extrusion-opacity"),We=0,je=g;We<je.length;We+=1){var at=je[We],Fe=v.getTile(at),nt=Fe.getBucket(d);if(nt){var _t=nt.programConfigurations.get(d.id),Dt=h.useProgram(_e?"fillExtrusionPattern":"fillExtrusion",_t);_e&&(h.context.activeTexture.set(G.TEXTURE0),Fe.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),_t.updatePaintBuffers(be));var nr=J.constantOr(null);if(nr&&Fe.imageAtlas){var $t=Fe.imageAtlas,cr=$t.patternPositions[nr.to.toString()],yr=$t.patternPositions[nr.from.toString()];cr&&yr&&_t.setConstantPatternPositions(cr,yr)}var Hr=h.translatePosMatrix(at.posMatrix,Fe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Nr=d.paint.get("fill-extrusion-vertical-gradient"),dn=_e?Ms(Hr,h,Nr,Te,at,be,Fe):Ef(Hr,h,Nr,Te);Dt.draw(O,O.gl.TRIANGLES,S,C,R,Je.backCCW,dn,d.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,d.paint,h.transform.zoom,_t)}}}function ol(h,v,d,g,S,C){var R=h.context,O=R.gl,G=v.fbo;if(G){var J=h.useProgram("hillshade");R.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,G.colorAttachment.get());var _e=function(be,Te,We){var je=We.paint.get("hillshade-shadow-color"),at=We.paint.get("hillshade-highlight-color"),Fe=We.paint.get("hillshade-accent-color"),nt=We.paint.get("hillshade-illumination-direction")*(Math.PI/180);We.paint.get("hillshade-illumination-anchor")==="viewport"&&(nt-=be.transform.angle);var _t,Dt,nr,$t=!be.options.moving;return{u_matrix:be.transform.calculatePosMatrix(Te.tileID.toUnwrapped(),$t),u_image:0,u_latrange:(_t=Te.tileID,Dt=Math.pow(2,_t.canonical.z),nr=_t.canonical.y,[new y.MercatorCoordinate(0,nr/Dt).toLngLat().lat,new y.MercatorCoordinate(0,(nr+1)/Dt).toLngLat().lat]),u_light:[We.paint.get("hillshade-exaggeration"),nt],u_shadow:je,u_highlight:at,u_accent:Fe}}(h,v,d);J.draw(R,O.TRIANGLES,g,S,C,Je.disabled,_e,d.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}}function ch(h,v,d,g,S,C){var R=h.context,O=R.gl,G=v.dem;if(G&&G.data){var J=G.dim,_e=G.stride,be=G.getPixels();if(R.activeTexture.set(O.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),v.demTexture=v.demTexture||h.getTileTexture(_e),v.demTexture){var Te=v.demTexture;Te.update(be,{premultiply:!1}),Te.bind(O.NEAREST,O.CLAMP_TO_EDGE)}else v.demTexture=new y.Texture(R,be,O.RGBA,{premultiply:!1}),v.demTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE);R.activeTexture.set(O.TEXTURE0);var We=v.fbo;if(!We){var je=new y.Texture(R,{width:J,height:J,data:null},O.RGBA);je.bind(O.LINEAR,O.CLAMP_TO_EDGE),(We=v.fbo=R.createFramebuffer(J,J,!0)).colorAttachment.set(je.texture)}R.bindFramebuffer.set(We.framebuffer),R.viewport.set([0,0,J,J]),h.useProgram("hillshadePrepare").draw(R,O.TRIANGLES,g,S,C,Je.disabled,function(at,Fe){var nt=Fe.stride,_t=y.create();return y.ortho(_t,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(_t,_t,[0,-y.EXTENT,0]),{u_matrix:_t,u_image:1,u_dimension:[nt,nt],u_zoom:at.overscaledZ,u_unpack:Fe.getUnpackVector()}}(v.tileID,G),d.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),v.needsHillshadePrepare=!1}}function fh(h,v,d,g,S){var C=g.paint.get("raster-fade-duration");if(C>0){var R=y.browser.now(),O=(R-h.timeAdded)/C,G=v?(R-v.timeAdded)/C:-1,J=d.getSource(),_e=S.coveringZoomLevel({tileSize:J.tileSize,roundZoom:J.roundZoom}),be=!v||Math.abs(v.tileID.overscaledZ-_e)>Math.abs(h.tileID.overscaledZ-_e),Te=be&&h.refreshedUponExpiration?1:y.clamp(be?O:1-G,0,1);return h.refreshedUponExpiration&&O>=1&&(h.refreshedUponExpiration=!1),v?{opacity:1,mix:1-Te}:{opacity:Te,mix:0}}return{opacity:1,mix:0}}var hh=new y.Color(1,0,0,1),wf=new y.Color(0,1,0,1),Yh=new y.Color(0,0,1,1),La=new y.Color(1,0,1,1),qh=new y.Color(0,1,1,1);function Cf(h,v,d,g){$l(h,0,v+d/2,h.transform.width,d,g)}function Kh(h,v,d,g){$l(h,v-d/2,0,d,h.transform.height,g)}function $l(h,v,d,g,S,C){var R=h.context,O=R.gl;O.enable(O.SCISSOR_TEST),O.scissor(v*y.browser.devicePixelRatio,d*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,S*y.browser.devicePixelRatio),R.clear({color:C}),O.disable(O.SCISSOR_TEST)}function Qh(h,v,d){var g=h.context,S=g.gl,C=d.posMatrix,R=h.useProgram("debug"),O=ee.disabled,G=Se.disabled,J=h.colorModeForRenderPass();g.activeTexture.set(S.TEXTURE0),h.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),R.draw(g,S.LINE_STRIP,O,G,J,Je.disabled,il(C,y.Color.red),"$debug",h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments);var _e=v.getTileByID(d.key).latestRawTileData,be=Math.floor((_e&&_e.byteLength||0)/1024),Te=v.getTile(d).tileSize,We=512/Math.min(Te,512)*(d.overscaledZ/h.transform.zoom)*.5,je=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(je+=" => "+d.overscaledZ),function(at,Fe){at.initDebugOverlayCanvas();var nt=at.debugOverlayCanvas,_t=at.context.gl,Dt=at.debugOverlayCanvas.getContext("2d");Dt.clearRect(0,0,nt.width,nt.height),Dt.shadowColor="white",Dt.shadowBlur=2,Dt.lineWidth=1.5,Dt.strokeStyle="white",Dt.textBaseline="top",Dt.font="bold 36px Open Sans, sans-serif",Dt.fillText(Fe,5,5),Dt.strokeText(Fe,5,5),at.debugOverlayTexture.update(nt),at.debugOverlayTexture.bind(_t.LINEAR,_t.CLAMP_TO_EDGE)}(h,je+" "+be+"kb"),R.draw(g,S.TRIANGLES,O,G,Ue.alphaBlended,Je.disabled,il(C,y.Color.transparent,We),"$debug",h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}var su={symbol:function(h,v,d,g,S){if(h.renderPass==="translucent"){var C=Se.disabled,R=h.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(O,G,J,_e,be,Te,We){for(var je=G.transform,at=be==="map",Fe=Te==="map",nt=0,_t=O;nt<_t.length;nt+=1){var Dt=_t[nt],nr=_e.getTile(Dt),$t=nr.getBucket(J);if($t&&$t.text&&$t.text.segments.get().length){var cr=y.evaluateSizeForZoom($t.textSizeData,je.zoom),yr=aa(nr,1,G.transform.zoom),Hr=Sa(Dt.posMatrix,Fe,at,G.transform,yr),Nr=J.layout.get("icon-text-fit")!=="none"&&$t.hasIconData();if(cr){var dn=Math.pow(2,je.zoom-nr.tileID.overscaledZ);$c($t,at,Fe,We,y.symbolSize,je,Hr,Dt.posMatrix,dn,cr,Nr)}}}}(g,h,d,v,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),S),d.paint.get("icon-opacity").constantOr(1)!==0&&Ol(h,v,d,g,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),C,R),d.paint.get("text-opacity").constantOr(1)!==0&&Ol(h,v,d,g,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),C,R),v.map.showCollisionBoxes&&(xc(h,v,d,g,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),xc(h,v,d,g,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))}},circle:function(h,v,d,g){if(h.renderPass==="translucent"){var S=d.paint.get("circle-opacity"),C=d.paint.get("circle-stroke-width"),R=d.paint.get("circle-stroke-opacity"),O=d.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||C.constantOr(1)!==0&&R.constantOr(1)!==0){for(var G=h.context,J=G.gl,_e=h.depthModeForSublayer(0,ee.ReadOnly),be=Se.disabled,Te=h.colorModeForRenderPass(),We=[],je=0;je<g.length;je++){var at=g[je],Fe=v.getTile(at),nt=Fe.getBucket(d);if(nt){var _t=nt.programConfigurations.get(d.id),Dt={programConfiguration:_t,program:h.useProgram("circle",_t),layoutVertexBuffer:nt.layoutVertexBuffer,indexBuffer:nt.indexBuffer,uniformValues:gc(h,at,Fe,d)};if(O)for(var nr=0,$t=nt.segments.get();nr<$t.length;nr+=1){var cr=$t[nr];We.push({segments:new y.SegmentVector([cr]),sortKey:cr.sortKey,state:Dt})}else We.push({segments:nt.segments,sortKey:0,state:Dt})}}O&&We.sort(function(Nn,Bn){return Nn.sortKey-Bn.sortKey});for(var yr=0,Hr=We;yr<Hr.length;yr+=1){var Nr=Hr[yr],dn=Nr.state;dn.program.draw(G,J.TRIANGLES,_e,be,Te,Je.disabled,dn.uniformValues,d.id,dn.layoutVertexBuffer,dn.indexBuffer,Nr.segments,d.paint,h.transform.zoom,dn.programConfiguration)}}}},heatmap:function(h,v,d,g){if(d.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){var S=h.context,C=S.gl,R=Se.disabled,O=new Ue([C.ONE,C.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(We,je,at){var Fe=We.gl;We.activeTexture.set(Fe.TEXTURE1),We.viewport.set([0,0,je.width/4,je.height/4]);var nt=at.heatmapFbo;if(nt)Fe.bindTexture(Fe.TEXTURE_2D,nt.colorAttachment.get()),We.bindFramebuffer.set(nt.framebuffer);else{var _t=Fe.createTexture();Fe.bindTexture(Fe.TEXTURE_2D,_t),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_S,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_T,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MIN_FILTER,Fe.LINEAR),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MAG_FILTER,Fe.LINEAR),nt=at.heatmapFbo=We.createFramebuffer(je.width/4,je.height/4,!1),function(Dt,nr,$t,cr){var yr=Dt.gl;yr.texImage2D(yr.TEXTURE_2D,0,yr.RGBA,nr.width/4,nr.height/4,0,yr.RGBA,Dt.extRenderToTextureHalfFloat?Dt.extTextureHalfFloat.HALF_FLOAT_OES:yr.UNSIGNED_BYTE,null),cr.colorAttachment.set($t)}(We,je,_t,nt)}})(S,h,d),S.clear({color:y.Color.transparent});for(var G=0;G<g.length;G++){var J=g[G];if(!v.hasRenderableParent(J)){var _e=v.getTile(J),be=_e.getBucket(d);if(be){var Te=be.programConfigurations.get(d.id);h.useProgram("heatmap",Te).draw(S,C.TRIANGLES,ee.disabled,R,O,Je.disabled,uh(J.posMatrix,_e,h.transform.zoom,d.paint.get("heatmap-intensity")),d.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,d.paint,h.transform.zoom,Te)}}}S.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(We,je){var at=We.context,Fe=at.gl,nt=je.heatmapFbo;if(nt){at.activeTexture.set(Fe.TEXTURE0),Fe.bindTexture(Fe.TEXTURE_2D,nt.colorAttachment.get()),at.activeTexture.set(Fe.TEXTURE1);var _t=je.colorRampTexture;_t||(_t=je.colorRampTexture=new y.Texture(at,je.colorRamp,Fe.RGBA)),_t.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),We.useProgram("heatmapTexture").draw(at,Fe.TRIANGLES,ee.disabled,Se.disabled,We.colorModeForRenderPass(),Je.disabled,function(Dt,nr,$t,cr){var yr=y.create();y.ortho(yr,0,Dt.width,Dt.height,0,0,1);var Hr=Dt.context.gl;return{u_matrix:yr,u_world:[Hr.drawingBufferWidth,Hr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:nr.paint.get("heatmap-opacity")}}(We,je),je.id,We.viewportBuffer,We.quadTriangleIndexBuffer,We.viewportSegments,je.paint,We.transform.zoom)}}(h,d))},line:function(h,v,d,g){if(h.renderPass==="translucent"){var S=d.paint.get("line-opacity"),C=d.paint.get("line-width");if(S.constantOr(1)!==0&&C.constantOr(1)!==0)for(var R=h.depthModeForSublayer(0,ee.ReadOnly),O=h.colorModeForRenderPass(),G=d.paint.get("line-dasharray"),J=d.paint.get("line-pattern"),_e=J.constantOr(1),be=d.paint.get("line-gradient"),Te=d.getCrossfadeParameters(),We=_e?"linePattern":G?"lineSDF":be?"lineGradient":"line",je=h.context,at=je.gl,Fe=!0,nt=0,_t=g;nt<_t.length;nt+=1){var Dt=_t[nt],nr=v.getTile(Dt);if(!_e||nr.patternsLoaded()){var $t=nr.getBucket(d);if($t){var cr=$t.programConfigurations.get(d.id),yr=h.context.program.get(),Hr=h.useProgram(We,cr),Nr=Fe||Hr.program!==yr,dn=J.constantOr(null);if(dn&&nr.imageAtlas){var Nn=nr.imageAtlas,Bn=Nn.patternPositions[dn.to.toString()],zn=Nn.patternPositions[dn.from.toString()];Bn&&zn&&cr.setConstantPatternPositions(Bn,zn)}var Ni=_e?Pl(h,nr,d,Te):G?$h(h,nr,d,G,Te):be?ua(h,nr,d,$t.lineClipsArray.length):Hc(h,nr,d);if(_e)je.activeTexture.set(at.TEXTURE0),nr.imageAtlasTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE),cr.updatePaintBuffers(Te);else if(G&&(Nr||h.lineAtlas.dirty))je.activeTexture.set(at.TEXTURE0),h.lineAtlas.bind(je);else if(be){var yn=$t.gradients[d.id],ii=yn.texture;if(d.gradientVersion!==yn.version){var pi=256;if(d.stepInterpolant){var ti=v.getSource().maxzoom,Jn=Dt.canonical.z===ti?Math.ceil(1<<h.transform.maxZoom-Dt.canonical.z):1;pi=y.clamp(y.nextPowerOfTwo($t.maxLineLength/y.EXTENT*1024*Jn),256,je.maxTextureSize)}yn.gradient=y.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:pi,image:yn.gradient||void 0,clips:$t.lineClipsArray}),yn.texture?yn.texture.update(yn.gradient):yn.texture=new y.Texture(je,yn.gradient,at.RGBA),yn.version=d.gradientVersion,ii=yn.texture}je.activeTexture.set(at.TEXTURE0),ii.bind(d.stepInterpolant?at.NEAREST:at.LINEAR,at.CLAMP_TO_EDGE)}Hr.draw(je,at.TRIANGLES,R,h.stencilModeForClipping(Dt),O,Je.disabled,Ni,d.id,$t.layoutVertexBuffer,$t.indexBuffer,$t.segments,d.paint,h.transform.zoom,cr,$t.layoutVertexBuffer2),Fe=!1}}}}},fill:function(h,v,d,g){var S=d.paint.get("fill-color"),C=d.paint.get("fill-opacity");if(C.constantOr(1)!==0){var R=h.colorModeForRenderPass(),O=d.paint.get("fill-pattern"),G=h.opaquePassEnabledForLayer()&&!O.constantOr(1)&&S.constantOr(y.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===G){var J=h.depthModeForSublayer(1,h.renderPass==="opaque"?ee.ReadWrite:ee.ReadOnly);Xl(h,v,d,g,J,R,!1)}if(h.renderPass==="translucent"&&d.paint.get("fill-antialias")){var _e=h.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,ee.ReadOnly);Xl(h,v,d,g,_e,R,!0)}}},"fill-extrusion":function(h,v,d,g){var S=d.paint.get("fill-extrusion-opacity");if(S!==0&&h.renderPass==="translucent"){var C=new ee(h.context.gl.LEQUAL,ee.ReadWrite,h.depthRangeFor3D);if(S!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))Tf(h,v,d,g,C,Se.disabled,Ue.disabled),Tf(h,v,d,g,C,h.stencilModeFor3D(),h.colorModeForRenderPass());else{var R=h.colorModeForRenderPass();Tf(h,v,d,g,C,Se.disabled,R)}}},hillshade:function(h,v,d,g){if(h.renderPass==="offscreen"||h.renderPass==="translucent"){for(var S=h.context,C=h.depthModeForSublayer(0,ee.ReadOnly),R=h.colorModeForRenderPass(),O=h.renderPass==="translucent"?h.stencilConfigForOverlap(g):[{},g],G=O[0],J=0,_e=O[1];J<_e.length;J+=1){var be=_e[J],Te=v.getTile(be);Te.needsHillshadePrepare&&h.renderPass==="offscreen"?ch(h,Te,d,C,Se.disabled,R):h.renderPass==="translucent"&&ol(h,Te,d,C,G[be.overscaledZ],R)}S.viewport.set([0,0,h.width,h.height])}},raster:function(h,v,d,g){if(h.renderPass==="translucent"&&d.paint.get("raster-opacity")!==0&&g.length)for(var S=h.context,C=S.gl,R=v.getSource(),O=h.useProgram("raster"),G=h.colorModeForRenderPass(),J=R instanceof Et?[{},g]:h.stencilConfigForOverlap(g),_e=J[0],be=J[1],Te=be[be.length-1].overscaledZ,We=!h.options.moving,je=0,at=be;je<at.length;je+=1){var Fe=at[je],nt=h.depthModeForSublayer(Fe.overscaledZ-Te,d.paint.get("raster-opacity")===1?ee.ReadWrite:ee.ReadOnly,C.LESS),_t=v.getTile(Fe),Dt=h.transform.calculatePosMatrix(Fe.toUnwrapped(),We);_t.registerFadeDuration(d.paint.get("raster-fade-duration"));var nr=v.findLoadedParent(Fe,0),$t=fh(_t,nr,v,d,h.transform),cr=void 0,yr=void 0,Hr=d.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;S.activeTexture.set(C.TEXTURE0),_t.texture.bind(Hr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(C.TEXTURE1),nr?(nr.texture.bind(Hr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),cr=Math.pow(2,nr.tileID.overscaledZ-_t.tileID.overscaledZ),yr=[_t.tileID.canonical.x*cr%1,_t.tileID.canonical.y*cr%1]):_t.texture.bind(Hr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var Nr=Gc(Dt,yr||[0,0],cr||1,$t,d);R instanceof Et?O.draw(S,C.TRIANGLES,nt,Se.disabled,G,Je.disabled,Nr,d.id,R.boundsBuffer,h.quadTriangleIndexBuffer,R.boundsSegments):O.draw(S,C.TRIANGLES,nt,_e[Fe.overscaledZ],G,Je.disabled,Nr,d.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,v,d){var g=d.paint.get("background-color"),S=d.paint.get("background-opacity");if(S!==0){var C=h.context,R=C.gl,O=h.transform,G=O.tileSize,J=d.paint.get("background-pattern");if(!h.isPatternMissing(J)){var _e=!J&&g.a===1&&S===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass===_e){var be=Se.disabled,Te=h.depthModeForSublayer(0,_e==="opaque"?ee.ReadWrite:ee.ReadOnly),We=h.colorModeForRenderPass(),je=h.useProgram(J?"backgroundPattern":"background"),at=O.coveringTiles({tileSize:G});J&&(C.activeTexture.set(R.TEXTURE0),h.imageManager.bind(h.context));for(var Fe=d.getCrossfadeParameters(),nt=0,_t=at;nt<_t.length;nt+=1){var Dt=_t[nt],nr=h.transform.calculatePosMatrix(Dt.toUnwrapped()),$t=J?Gl(nr,S,h,J,{tileID:Dt,tileSize:G},Fe):yc(nr,S,g);je.draw(C,R.TRIANGLES,Te,be,We,Je.disabled,$t,d.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}}}},debug:function(h,v,d){for(var g=0;g<d.length;g++)Qh(h,v,d[g])},custom:function(h,v,d){var g=h.context,S=d.implementation;if(h.renderPass==="offscreen"){var C=S.prerender;C&&(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),C.call(S,g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(Se.disabled);var R=S.renderingMode==="3d"?new ee(h.context.gl.LEQUAL,ee.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,ee.ReadOnly);g.setDepthMode(R),S.render(g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}},la=function(h,v){this.context=new he(h),this.transform=v,this._tileTextures={},this.setup(),this.numSublayers=K.maxUnderzooming+K.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Tl,this.gpuTimers={}};la.prototype.resize=function(h,v){if(this.width=h*y.browser.devicePixelRatio,this.height=v*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var d=0,g=this.style._order;d<g.length;d+=1)this.style._layers[g[d]].resize()},la.prototype.setup=function(){var h=this.context,v=new y.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(y.EXTENT,0),v.emplaceBack(0,y.EXTENT),v.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(v,Ga.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var d=new y.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(y.EXTENT,0),d.emplaceBack(0,y.EXTENT),d.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=h.createVertexBuffer(d,Ga.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=h.createVertexBuffer(g,ct.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var S=new y.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(S,Ga.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var C=new y.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer(C);var R=new y.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(R),this.emptyTexture=new y.Texture(h,{width:1,height:1,data:new Uint8Array([0,0,0,0])},h.gl.RGBA);var O=this.context.gl;this.stencilClearMode=new Se({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO)},la.prototype.clearStencil=function(){var h=this.context,v=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var d=y.create();y.ortho(d,0,this.width,this.height,0,0,1),y.scale(d,d,[v.drawingBufferWidth,v.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,v.TRIANGLES,ee.disabled,this.stencilClearMode,Ue.disabled,Je.disabled,Il(d),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},la.prototype._renderTileClippingMasks=function(h,v){if(this.currentStencilSource!==h.source&&h.isTileClipped()&&v&&v.length){this.currentStencilSource=h.source;var d=this.context,g=d.gl;this.nextStencilID+v.length>256&&this.clearStencil(),d.setColorMode(Ue.disabled),d.setDepthMode(ee.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,R=v;C<R.length;C+=1){var O=R[C],G=this._tileClippingMaskIDs[O.key]=this.nextStencilID++;S.draw(d,g.TRIANGLES,ee.disabled,new Se({func:g.ALWAYS,mask:0},G,255,g.KEEP,g.KEEP,g.REPLACE),Ue.disabled,Je.disabled,Il(O.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},la.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var h=this.nextStencilID++,v=this.context.gl;return new Se({func:v.NOTEQUAL,mask:255},h,255,v.KEEP,v.KEEP,v.REPLACE)},la.prototype.stencilModeForClipping=function(h){var v=this.context.gl;return new Se({func:v.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,v.KEEP,v.KEEP,v.REPLACE)},la.prototype.stencilConfigForOverlap=function(h){var v,d=this.context.gl,g=h.sort(function(G,J){return J.overscaledZ-G.overscaledZ}),S=g[g.length-1].overscaledZ,C=g[0].overscaledZ-S+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var R={},O=0;O<C;O++)R[O+S]=new Se({func:d.GEQUAL,mask:255},O+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=C,[R,g]}return[(v={},v[S]=Se.disabled,v),g]},la.prototype.colorModeForRenderPass=function(){var h=this.context.gl;return this._showOverdrawInspector?new Ue([h.CONSTANT_COLOR,h.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ue.unblended:Ue.alphaBlended},la.prototype.depthModeForSublayer=function(h,v,d){if(!this.opaquePassEnabledForLayer())return ee.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new ee(d||this.context.gl.LEQUAL,v,[g,g])},la.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},la.prototype.render=function(h,v){var d=this;this.style=h,this.options=v,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,S=this.style.sourceCaches;for(var C in S){var R=S[C];R.used&&R.prepare(this.context)}var O,G,J={},_e={},be={};for(var Te in S){var We=S[Te];J[Te]=We.getVisibleCoordinates(),_e[Te]=J[Te].slice().reverse(),be[Te]=We.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var je=0;je<g.length;je++)if(this.style._layers[g[je]].is3D()){this.opaquePassCutoff=je;break}this.renderPass="offscreen";for(var at=0,Fe=g;at<Fe.length;at+=1){var nt=this.style._layers[Fe[at]];if(nt.hasOffscreenPass()&&!nt.isHidden(this.transform.zoom)){var _t=_e[nt.source];(nt.type==="custom"||_t.length)&&this.renderLayer(this,S[nt.source],nt,_t)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:v.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=v.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var Dt=this.style._layers[g[this.currentLayer]],nr=S[Dt.source],$t=J[Dt.source];this._renderTileClippingMasks(Dt,$t),this.renderLayer(this,nr,Dt,$t)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var cr=this.style._layers[g[this.currentLayer]],yr=S[cr.source],Hr=(cr.type==="symbol"?be:_e)[cr.source];this._renderTileClippingMasks(cr,J[cr.source]),this.renderLayer(this,yr,cr,Hr)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(Nr){Nr.source&&!Nr.isHidden(d.transform.zoom)&&(Nr.source!==(G&&G.id)&&(G=d.style.sourceCaches[Nr.source]),(!O||O.getSource().maxzoom<G.getSource().maxzoom)&&(O=G))}),O&&su.debug(this,O,O.getVisibleCoordinates())),this.options.showPadding&&function(Nr){var dn=Nr.transform.padding;Cf(Nr,Nr.transform.height-(dn.top||0),3,hh),Cf(Nr,dn.bottom||0,3,wf),Kh(Nr,dn.left||0,3,Yh),Kh(Nr,Nr.transform.width-(dn.right||0),3,La);var Nn=Nr.transform.centerPoint;(function(Bn,zn,Ni,yn){$l(Bn,zn-1,Ni-10,2,20,yn),$l(Bn,zn-10,Ni-1,20,2,yn)})(Nr,Nn.x,Nr.transform.height-Nn.y,qh)}(this),this.context.setDefault()},la.prototype.renderLayer=function(h,v,d,g){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="custom"||g.length)&&(this.id=d.id,this.gpuTimingStart(d),su[d.type](h,v,d,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},la.prototype.gpuTimingStart=function(h){if(this.options.gpuTiming){var v=this.context.extTimerQuery,d=this.gpuTimers[h.id];d||(d=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:v.createQueryEXT()}),d.calls++,v.beginQueryEXT(v.TIME_ELAPSED_EXT,d.query)}},la.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}},la.prototype.collectGpuTimers=function(){var h=this.gpuTimers;return this.gpuTimers={},h},la.prototype.queryGpuTimers=function(h){var v={};for(var d in h){var g=h[d],S=this.context.extTimerQuery,C=S.getQueryObjectEXT(g.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(g.query),v[d]=C}return v},la.prototype.translatePosMatrix=function(h,v,d,g,S){if(!d[0]&&!d[1])return h;var C=S?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(C){var R=Math.sin(C),O=Math.cos(C);d=[d[0]*O-d[1]*R,d[0]*R+d[1]*O]}var G=[S?d[0]:aa(v,d[0],this.transform.zoom),S?d[1]:aa(v,d[1],this.transform.zoom),0],J=new Float32Array(16);return y.translate(J,h,G),J},la.prototype.saveTileTexture=function(h){var v=this._tileTextures[h.size[0]];v?v.push(h):this._tileTextures[h.size[0]]=[h]},la.prototype.getTileTexture=function(h){var v=this._tileTextures[h];return v&&v.length>0?v.pop():null},la.prototype.isPatternMissing=function(h){if(!h)return!1;if(!h.from||!h.to)return!0;var v=this.imageManager.getPattern(h.from.toString()),d=this.imageManager.getPattern(h.to.toString());return!v||!d},la.prototype.useProgram=function(h,v){this.cache=this.cache||{};var d=""+h+(v?v.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[d]||(this.cache[d]=new Xa(this.context,h,Ys[h],v,Af[h],this._showOverdrawInspector)),this.cache[d]},la.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},la.prototype.setBaseState=function(){var h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)},la.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},la.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Yl=function(h,v){this.points=h,this.planes=v};Yl.fromInvProjectionMatrix=function(h,v,d){var g=Math.pow(2,d),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return y.transformMat4([],R,h)}).map(function(R){return y.scale$1([],R,1/R[3]/v*g)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var O=y.sub([],S[R[0]],S[R[1]]),G=y.sub([],S[R[2]],S[R[1]]),J=y.normalize([],y.cross([],O,G)),_e=-y.dot(J,S[R[1]]);return J.concat(_e)});return new Yl(S,C)};var Vu=function(h,v){this.min=h,this.max=v,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};Vu.prototype.quadrant=function(h){for(var v=[h%2==0,h<2],d=y.clone$2(this.min),g=y.clone$2(this.max),S=0;S<v.length;S++)d[S]=v[S]?this.min[S]:this.center[S],g[S]=v[S]?this.center[S]:this.max[S];return g[2]=this.max[2],new Vu(d,g)},Vu.prototype.distanceX=function(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]},Vu.prototype.distanceY=function(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]},Vu.prototype.intersects=function(h){for(var v=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],d=!0,g=0;g<h.planes.length;g++){for(var S=h.planes[g],C=0,R=0;R<v.length;R++)C+=y.dot$1(S,v[R])>=0;if(C===0)return 0;C!==v.length&&(d=!1)}if(d)return 2;for(var O=0;O<3;O++){for(var G=Number.MAX_VALUE,J=-Number.MAX_VALUE,_e=0;_e<h.points.length;_e++){var be=h.points[_e][O]-this.min[O];G=Math.min(G,be),J=Math.max(J,be)}if(J<0||G>this.max[O]-this.min[O])return 0}return 1};var sl=function(h,v,d,g){if(h===void 0&&(h=0),v===void 0&&(v=0),d===void 0&&(d=0),g===void 0&&(g=0),isNaN(h)||h<0||isNaN(v)||v<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=v,this.left=d,this.right=g};sl.prototype.interpolate=function(h,v,d){return v.top!=null&&h.top!=null&&(this.top=y.number(h.top,v.top,d)),v.bottom!=null&&h.bottom!=null&&(this.bottom=y.number(h.bottom,v.bottom,d)),v.left!=null&&h.left!=null&&(this.left=y.number(h.left,v.left,d)),v.right!=null&&h.right!=null&&(this.right=y.number(h.right,v.right,d)),this},sl.prototype.getCenter=function(h,v){var d=y.clamp((this.left+h-this.right)/2,0,h),g=y.clamp((this.top+v-this.bottom)/2,0,v);return new y.Point(d,g)},sl.prototype.equals=function(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right},sl.prototype.clone=function(){return new sl(this.top,this.bottom,this.left,this.right)},sl.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Di=function(h,v,d,g,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=h||0,this._maxZoom=v||22,this._minPitch=d==null?0:d,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new sl,this._posMatrixCache={},this._alignedPosMatrixCache={}},ha={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Di.prototype.clone=function(){var h=new Di(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.tileSize=this.tileSize,h.latRange=this.latRange,h.width=this.width,h.height=this.height,h._center=this._center,h.zoom=this.zoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._unmodified=this._unmodified,h._edgeInsets=this._edgeInsets.clone(),h._calcMatrices(),h},ha.minZoom.get=function(){return this._minZoom},ha.minZoom.set=function(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))},ha.maxZoom.get=function(){return this._maxZoom},ha.maxZoom.set=function(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))},ha.minPitch.get=function(){return this._minPitch},ha.minPitch.set=function(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))},ha.maxPitch.get=function(){return this._maxPitch},ha.maxPitch.set=function(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))},ha.renderWorldCopies.get=function(){return this._renderWorldCopies},ha.renderWorldCopies.set=function(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h},ha.worldSize.get=function(){return this.tileSize*this.scale},ha.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ha.size.get=function(){return new y.Point(this.width,this.height)},ha.bearing.get=function(){return-this.angle/Math.PI*180},ha.bearing.set=function(h){var v=-y.wrap(h,-180,180)*Math.PI/180;this.angle!==v&&(this._unmodified=!1,this.angle=v,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ha.pitch.get=function(){return this._pitch/Math.PI*180},ha.pitch.set=function(h){var v=y.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==v&&(this._unmodified=!1,this._pitch=v,this._calcMatrices())},ha.fov.get=function(){return this._fov/Math.PI*180},ha.fov.set=function(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())},ha.zoom.get=function(){return this._zoom},ha.zoom.set=function(h){var v=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==v&&(this._unmodified=!1,this._zoom=v,this.scale=this.zoomScale(v),this.tileZoom=Math.floor(v),this.zoomFraction=v-this.tileZoom,this._constrain(),this._calcMatrices())},ha.center.get=function(){return this._center},ha.center.set=function(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())},ha.padding.get=function(){return this._edgeInsets.toJSON()},ha.padding.set=function(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())},ha.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Di.prototype.isPaddingEqual=function(h){return this._edgeInsets.equals(h)},Di.prototype.interpolatePadding=function(h,v,d){this._unmodified=!1,this._edgeInsets.interpolate(h,v,d),this._constrain(),this._calcMatrices()},Di.prototype.coveringZoomLevel=function(h){var v=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,v)},Di.prototype.getVisibleUnwrappedCoordinates=function(h){var v=[new y.UnwrappedTileID(0,h)];if(this._renderWorldCopies)for(var d=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),S=this.pointCoordinate(new y.Point(this.width,this.height)),C=this.pointCoordinate(new y.Point(0,this.height)),R=Math.floor(Math.min(d.x,g.x,S.x,C.x)),O=Math.floor(Math.max(d.x,g.x,S.x,C.x)),G=R-1;G<=O+1;G++)G!==0&&v.push(new y.UnwrappedTileID(G,h));return v},Di.prototype.coveringTiles=function(h){var v=this.coveringZoomLevel(h),d=v;if(h.minzoom!==void 0&&v<h.minzoom)return[];h.maxzoom!==void 0&&v>h.maxzoom&&(v=h.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,v),C=[S*g.x,S*g.y,0],R=Yl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v),O=h.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(O=v);var G=function(Nr){return{aabb:new Vu([Nr*S,0,0],[(Nr+1)*S,S,0]),zoom:0,x:0,y:0,wrap:Nr,fullyVisible:!1}},J=[],_e=[],be=v,Te=h.reparseOverscaled?d:v;if(this._renderWorldCopies)for(var We=1;We<=3;We++)J.push(G(-We)),J.push(G(We));for(J.push(G(0));J.length>0;){var je=J.pop(),at=je.x,Fe=je.y,nt=je.fullyVisible;if(!nt){var _t=je.aabb.intersects(R);if(_t===0)continue;nt=_t===2}var Dt=je.aabb.distanceX(C),nr=je.aabb.distanceY(C),$t=Math.max(Math.abs(Dt),Math.abs(nr));if(je.zoom===be||$t>3+(1<<be-je.zoom)-2&&je.zoom>=O)_e.push({tileID:new y.OverscaledTileID(je.zoom===be?Te:je.zoom,je.wrap,je.zoom,at,Fe),distanceSq:y.sqrLen([C[0]-.5-at,C[1]-.5-Fe])});else for(var cr=0;cr<4;cr++){var yr=(at<<1)+cr%2,Hr=(Fe<<1)+(cr>>1);J.push({aabb:je.aabb.quadrant(cr),zoom:je.zoom+1,x:yr,y:Hr,wrap:je.wrap,fullyVisible:nt})}}return _e.sort(function(Nr,dn){return Nr.distanceSq-dn.distanceSq}).map(function(Nr){return Nr.tileID})},Di.prototype.resize=function(h,v){this.width=h,this.height=v,this.pixelsToGLUnits=[2/h,-2/v],this._constrain(),this._calcMatrices()},ha.unmodified.get=function(){return this._unmodified},Di.prototype.zoomScale=function(h){return Math.pow(2,h)},Di.prototype.scaleZoom=function(h){return Math.log(h)/Math.LN2},Di.prototype.project=function(h){var v=y.clamp(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(h.lng)*this.worldSize,y.mercatorYfromLat(v)*this.worldSize)},Di.prototype.unproject=function(h){return new y.MercatorCoordinate(h.x/this.worldSize,h.y/this.worldSize).toLngLat()},ha.point.get=function(){return this.project(this.center)},Di.prototype.setLocationAtPoint=function(h,v){var d=this.pointCoordinate(v),g=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(h),C=new y.MercatorCoordinate(S.x-(d.x-g.x),S.y-(d.y-g.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},Di.prototype.locationPoint=function(h){return this.coordinatePoint(this.locationCoordinate(h))},Di.prototype.pointLocation=function(h){return this.coordinateLocation(this.pointCoordinate(h))},Di.prototype.locationCoordinate=function(h){return y.MercatorCoordinate.fromLngLat(h)},Di.prototype.coordinateLocation=function(h){return h.toLngLat()},Di.prototype.pointCoordinate=function(h){var v=[h.x,h.y,0,1],d=[h.x,h.y,1,1];y.transformMat4(v,v,this.pixelMatrixInverse),y.transformMat4(d,d,this.pixelMatrixInverse);var g=v[3],S=d[3],C=v[1]/g,R=d[1]/S,O=v[2]/g,G=d[2]/S,J=O===G?0:(0-O)/(G-O);return new y.MercatorCoordinate(y.number(v[0]/g,d[0]/S,J)/this.worldSize,y.number(C,R,J)/this.worldSize)},Di.prototype.coordinatePoint=function(h){var v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return y.transformMat4(v,v,this.pixelMatrix),new y.Point(v[0]/v[3],v[1]/v[3])},Di.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Di.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Di.prototype.setMaxBounds=function(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Di.prototype.calculatePosMatrix=function(h,v){v===void 0&&(v=!1);var d=h.key,g=v?this._alignedPosMatrixCache:this._posMatrixCache;if(g[d])return g[d];var S=h.canonical,C=this.worldSize/this.zoomScale(S.z),R=S.x+Math.pow(2,S.z)*h.wrap,O=y.identity(new Float64Array(16));return y.translate(O,O,[R*C,S.y*C,0]),y.scale(O,O,[C/y.EXTENT,C/y.EXTENT,1]),y.multiply(O,v?this.alignedProjMatrix:this.projMatrix,O),g[d]=new Float32Array(O),g[d]},Di.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Di.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var h,v,d,g,S=-90,C=90,R=-180,O=180,G=this.size,J=this._unmodified;if(this.latRange){var _e=this.latRange;S=y.mercatorYfromLat(_e[1])*this.worldSize,h=(C=y.mercatorYfromLat(_e[0])*this.worldSize)-S<G.y?G.y/(C-S):0}if(this.lngRange){var be=this.lngRange;R=y.mercatorXfromLng(be[0])*this.worldSize,v=(O=y.mercatorXfromLng(be[1])*this.worldSize)-R<G.x?G.x/(O-R):0}var Te=this.point,We=Math.max(v||0,h||0);if(We)return this.center=this.unproject(new y.Point(v?(O+R)/2:Te.x,h?(C+S)/2:Te.y)),this.zoom+=this.scaleZoom(We),this._unmodified=J,void(this._constraining=!1);if(this.latRange){var je=Te.y,at=G.y/2;je-at<S&&(g=S+at),je+at>C&&(g=C-at)}if(this.lngRange){var Fe=Te.x,nt=G.x/2;Fe-nt<R&&(d=R+nt),Fe+nt>O&&(d=O-nt)}d===void 0&&g===void 0||(this.center=this.unproject(new y.Point(d!==void 0?d:Te.x,g!==void 0?g:Te.y))),this._unmodified=J,this._constraining=!1}},Di.prototype._calcMatrices=function(){if(this.height){var h=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var v=Math.PI/2+this._pitch,d=this._fov*(.5+h.y/this.height),g=Math.sin(d)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-v-d,.01,Math.PI-.01)),S=this.point,C=S.x,R=S.y,O=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),G=this.height/50,J=new Float64Array(16);y.perspective(J,this._fov,this.width/this.height,G,O),J[8]=2*-h.x/this.width,J[9]=2*h.y/this.height,y.scale(J,J,[1,-1,1]),y.translate(J,J,[0,0,-this.cameraToCenterDistance]),y.rotateX(J,J,this._pitch),y.rotateZ(J,J,this.angle),y.translate(J,J,[-C,-R,0]),this.mercatorMatrix=y.scale([],J,[this.worldSize,this.worldSize,this.worldSize]),y.scale(J,J,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=J,this.invProjMatrix=y.invert([],this.projMatrix);var _e=this.width%2/2,be=this.height%2/2,Te=Math.cos(this.angle),We=Math.sin(this.angle),je=C-Math.round(C)+Te*_e+We*be,at=R-Math.round(R)+Te*be+We*_e,Fe=new Float64Array(J);if(y.translate(Fe,Fe,[je>.5?je-1:je,at>.5?at-1:at,0]),this.alignedProjMatrix=Fe,J=y.create(),y.scale(J,J,[this.width/2,-this.height/2,1]),y.translate(J,J,[1,-1,0]),this.labelPlaneMatrix=J,J=y.create(),y.scale(J,J,[1,-1,1]),y.translate(J,J,[-1,-1,0]),y.scale(J,J,[2/this.width,2/this.height,1]),this.glCoordMatrix=J,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(J=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=J,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Di.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var h=this.pointCoordinate(new y.Point(0,0)),v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return y.transformMat4(v,v,this.pixelMatrix)[3]/this.cameraToCenterDistance},Di.prototype.getCameraPoint=function(){var h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,h))},Di.prototype.getCameraQueryGeometry=function(h){var v=this.getCameraPoint();if(h.length===1)return[h[0],v];for(var d=v.x,g=v.y,S=v.x,C=v.y,R=0,O=h;R<O.length;R+=1){var G=O[R];d=Math.min(d,G.x),g=Math.min(g,G.y),S=Math.max(S,G.x),C=Math.max(C,G.y)}return[new y.Point(d,g),new y.Point(S,g),new y.Point(S,C),new y.Point(d,C),new y.Point(d,g)]},Object.defineProperties(Di.prototype,ha);var uu=function(h){var v,d,g,S;this._hashName=h&&encodeURIComponent(h),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(v=this._updateHashUnthrottled.bind(this),d=!1,g=null,S=function(){g=null,d&&(v(),g=setTimeout(S,300),d=!1)},function(){return d=!0,g||S(),g})};uu.prototype.addTo=function(h){return this._map=h,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},uu.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},uu.prototype.getHashString=function(h){var v=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,g),C=Math.round(v.lng*S)/S,R=Math.round(v.lat*S)/S,O=this._map.getBearing(),G=this._map.getPitch(),J="";if(J+=h?"/"+C+"/"+R+"/"+d:d+"/"+R+"/"+C,(O||G)&&(J+="/"+Math.round(10*O)/10),G&&(J+="/"+Math.round(G)),this._hashName){var _e=this._hashName,be=!1,Te=y.window.location.hash.slice(1).split("&").map(function(We){var je=We.split("=")[0];return je===_e?(be=!0,je+"="+J):We}).filter(function(We){return We});return be||Te.push(_e+"="+J),"#"+Te.join("&")}return"#"+J},uu.prototype._getCurrentHash=function(){var h,v=this,d=y.window.location.hash.replace("#","");return this._hashName?(d.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===v._hashName&&(h=g)}),(h&&h[1]||"").split("/")):d.split("/")},uu.prototype._onHashChange=function(){var h=this._getCurrentHash();if(h.length>=3&&!h.some(function(d){return isNaN(d)})){var v=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:v,pitch:+(h[4]||0)}),!0}return!1},uu.prototype._updateHashUnthrottled=function(){var h=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,h)}catch(v){}};var Yc={linearity:.3,easing:y.bezier(0,0,.3,1)},qc=y.extend({deceleration:2500,maxSpeed:1400},Yc),qs=y.extend({deceleration:20,maxSpeed:1400},Yc),Jh=y.extend({deceleration:1e3,maxSpeed:360},Yc),Rf=y.extend({deceleration:1e3,maxSpeed:90},Yc),Mf=function(h){this._map=h,this.clear()};function ql(h,v){(!h.duration||h.duration<v.duration)&&(h.duration=v.duration,h.easing=v.easing)}function So(h,v,d){var g=d.maxSpeed,S=d.linearity,C=d.deceleration,R=y.clamp(h*S/(v/1e3),-g,g),O=Math.abs(R)/(C*S);return{easing:d.easing,duration:1e3*O,amount:R*(O/2)}}Mf.prototype.clear=function(){this._inertiaBuffer=[]},Mf.prototype.record=function(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:h})},Mf.prototype._drainInertiaBuffer=function(){for(var h=this._inertiaBuffer,v=y.browser.now();h.length>0&&v-h[0].time>160;)h.shift()},Mf.prototype._onMoveEnd=function(h){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var v={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},d=0,g=this._inertiaBuffer;d<g.length;d+=1){var S=g[d].settings;v.zoom+=S.zoomDelta||0,v.bearing+=S.bearingDelta||0,v.pitch+=S.pitchDelta||0,S.panDelta&&v.pan._add(S.panDelta),S.around&&(v.around=S.around),S.pinchAround&&(v.pinchAround=S.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(v.pan.mag()){var O=So(v.pan.mag(),C,y.extend({},qc,h||{}));R.offset=v.pan.mult(O.amount/v.pan.mag()),R.center=this._map.transform.center,ql(R,O)}if(v.zoom){var G=So(v.zoom,C,qs);R.zoom=this._map.transform.zoom+G.amount,ql(R,G)}if(v.bearing){var J=So(v.bearing,C,Jh);R.bearing=this._map.transform.bearing+y.clamp(J.amount,-179,179),ql(R,J)}if(v.pitch){var _e=So(v.pitch,C,Rf);R.pitch=this._map.transform.pitch+_e.amount,ql(R,_e)}if(R.zoom||R.bearing){var be=v.pinchAround===void 0?v.around:v.pinchAround;R.around=be?this._map.unproject(be):this._map.getCenter()}return this.clear(),y.extend(R,{noMoveStart:!0})}};var Ba=function(h){function v(g,S,C,R){R===void 0&&(R={});var O=V.mousePos(S.getCanvasContainer(),C),G=S.unproject(O);h.call(this,g,y.extend({point:O,lngLat:G,originalEvent:C},R)),this._defaultPrevented=!1,this.target=S}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var d={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},d.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,d),v}(y.Event),Kc=function(h){function v(g,S,C){var R=g==="touchend"?C.changedTouches:C.touches,O=V.touchPos(S.getCanvasContainer(),R),G=O.map(function(be){return S.unproject(be)}),J=O.reduce(function(be,Te,We,je){return be.add(Te.div(je.length))},new y.Point(0,0)),_e=S.unproject(J);h.call(this,g,{points:O,point:J,lngLats:G,lngLat:_e,originalEvent:C}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var d={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},d.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,d),v}(y.Event),Ec=function(h){function v(g,S,C){h.call(this,g,{originalEvent:C}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var d={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},d.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,d),v}(y.Event),to=function(h,v){this._map=h,this._clickTolerance=v.clickTolerance};to.prototype.reset=function(){delete this._mousedownPos},to.prototype.wheel=function(h){return this._firePreventable(new Ec(h.type,this._map,h))},to.prototype.mousedown=function(h,v){return this._mousedownPos=v,this._firePreventable(new Ba(h.type,this._map,h))},to.prototype.mouseup=function(h){this._map.fire(new Ba(h.type,this._map,h))},to.prototype.click=function(h,v){this._mousedownPos&&this._mousedownPos.dist(v)>=this._clickTolerance||this._map.fire(new Ba(h.type,this._map,h))},to.prototype.dblclick=function(h){return this._firePreventable(new Ba(h.type,this._map,h))},to.prototype.mouseover=function(h){this._map.fire(new Ba(h.type,this._map,h))},to.prototype.mouseout=function(h){this._map.fire(new Ba(h.type,this._map,h))},to.prototype.touchstart=function(h){return this._firePreventable(new Kc(h.type,this._map,h))},to.prototype.touchmove=function(h){this._map.fire(new Kc(h.type,this._map,h))},to.prototype.touchend=function(h){this._map.fire(new Kc(h.type,this._map,h))},to.prototype.touchcancel=function(h){this._map.fire(new Kc(h.type,this._map,h))},to.prototype._firePreventable=function(h){if(this._map.fire(h),h.defaultPrevented)return{}},to.prototype.isEnabled=function(){return!0},to.prototype.isActive=function(){return!1},to.prototype.enable=function(){},to.prototype.disable=function(){};var bn=function(h){this._map=h};bn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},bn.prototype.mousemove=function(h){this._map.fire(new Ba(h.type,this._map,h))},bn.prototype.mousedown=function(){this._delayContextMenu=!0},bn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ba("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},bn.prototype.contextmenu=function(h){this._delayContextMenu?this._contextMenuEvent=h:this._map.fire(new Ba(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()},bn.prototype.isEnabled=function(){return!0},bn.prototype.isActive=function(){return!1},bn.prototype.enable=function(){},bn.prototype.disable=function(){};var ss=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=v.clickTolerance||1};function If(h,v){for(var d={},g=0;g<h.length;g++)d[h[g].identifier]=v[g];return d}ss.prototype.isEnabled=function(){return!!this._enabled},ss.prototype.isActive=function(){return!!this._active},ss.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ss.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ss.prototype.mousedown=function(h,v){this.isEnabled()&&h.shiftKey&&h.button===0&&(V.disableDrag(),this._startPos=this._lastPos=v,this._active=!0)},ss.prototype.mousemoveWindow=function(h,v){if(this._active){var d=v;if(!(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=d,this._box||(this._box=V.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));var S=Math.min(g.x,d.x),C=Math.max(g.x,d.x),R=Math.min(g.y,d.y),O=Math.max(g.y,d.y);V.setTransform(this._box,"translate("+S+"px,"+R+"px)"),this._box.style.width=C-S+"px",this._box.style.height=O-R+"px"}}},ss.prototype.mouseupWindow=function(h,v){var d=this;if(this._active&&h.button===0){var g=this._startPos,S=v;if(this.reset(),V.suppressClick(),g.x!==S.x||g.y!==S.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:function(C){return C.fitScreenCoordinates(g,S,d._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",h)}},ss.prototype.keydown=function(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))},ss.prototype.blur=function(){this.reset()},ss.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos},ss.prototype._fireEvent=function(h,v){return this._map.fire(new y.Event(h,{originalEvent:v}))};var Sc=function(h){this.reset(),this.numTouches=h.numTouches};Sc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Sc.prototype.touchstart=function(h,v,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=h.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){for(var S=new y.Point(0,0),C=0,R=g;C<R.length;C+=1)S._add(R[C]);return S.div(g.length)}(v),this.touches=If(d,v)))},Sc.prototype.touchmove=function(h,v,d){if(!this.aborted&&this.centroid){var g=If(d,v);for(var S in this.touches){var C=g[S];(!C||C.dist(this.touches[S])>30)&&(this.aborted=!0)}}},Sc.prototype.touchend=function(h,v,d){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var Yo=function(h){this.singleTap=new Sc(h),this.numTaps=h.numTaps,this.reset()};Yo.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Yo.prototype.touchstart=function(h,v,d){this.singleTap.touchstart(h,v,d)},Yo.prototype.touchmove=function(h,v,d){this.singleTap.touchmove(h,v,d)},Yo.prototype.touchend=function(h,v,d){var g=this.singleTap.touchend(h,v,d);if(g){var S=h.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(g)<30;if(S&&C||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var ca=function(){this._zoomIn=new Yo({numTouches:1,numTaps:2}),this._zoomOut=new Yo({numTouches:2,numTaps:1}),this.reset()};ca.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ca.prototype.touchstart=function(h,v,d){this._zoomIn.touchstart(h,v,d),this._zoomOut.touchstart(h,v,d)},ca.prototype.touchmove=function(h,v,d){this._zoomIn.touchmove(h,v,d),this._zoomOut.touchmove(h,v,d)},ca.prototype.touchend=function(h,v,d){var g=this,S=this._zoomIn.touchend(h,v,d),C=this._zoomOut.touchend(h,v,d);return S?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(S)},{originalEvent:h})}}):C?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(C)},{originalEvent:h})}}):void 0},ca.prototype.touchcancel=function(){this.reset()},ca.prototype.enable=function(){this._enabled=!0},ca.prototype.disable=function(){this._enabled=!1,this.reset()},ca.prototype.isEnabled=function(){return this._enabled},ca.prototype.isActive=function(){return this._active};var Pf={0:1,2:2},sn=function(h){this.reset(),this._clickTolerance=h.clickTolerance||1};sn.prototype.blur=function(){this.reset()},sn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},sn.prototype._correctButton=function(h,v){return!1},sn.prototype._move=function(h,v){return{}},sn.prototype.mousedown=function(h,v){if(!this._lastPoint){var d=V.mouseButton(h);this._correctButton(h,d)&&(this._lastPoint=v,this._eventButton=d)}},sn.prototype.mousemoveWindow=function(h,v){var d=this._lastPoint;if(d){if(h.preventDefault(),function(g,S){var C=Pf[S];return g.buttons===void 0||(g.buttons&C)!==C}(h,this._eventButton))this.reset();else if(this._moved||!(v.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=v,this._move(d,v)}},sn.prototype.mouseupWindow=function(h){this._lastPoint&&V.mouseButton(h)===this._eventButton&&(this._moved&&V.suppressClick(),this.reset())},sn.prototype.enable=function(){this._enabled=!0},sn.prototype.disable=function(){this._enabled=!1,this.reset()},sn.prototype.isEnabled=function(){return this._enabled},sn.prototype.isActive=function(){return this._active};var ul=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.mousedown=function(d,g){h.prototype.mousedown.call(this,d,g),this._lastPoint&&(this._active=!0)},v.prototype._correctButton=function(d,g){return g===0&&!d.ctrlKey},v.prototype._move=function(d,g){return{around:g,panDelta:g.sub(d)}},v}(sn),Qc=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(d,g){return g===0&&d.ctrlKey||g===2},v.prototype._move=function(d,g){var S=.8*(g.x-d.x);if(S)return this._active=!0,{bearingDelta:S}},v.prototype.contextmenu=function(d){d.preventDefault()},v}(sn),Jc=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(d,g){return g===0&&d.ctrlKey||g===2},v.prototype._move=function(d,g){var S=-.5*(g.y-d.y);if(S)return this._active=!0,{pitchDelta:S}},v.prototype.contextmenu=function(d){d.preventDefault()},v}(sn),yu=function(h){this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset()};yu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},yu.prototype.touchstart=function(h,v,d){return this._calculateTransform(h,v,d)},yu.prototype.touchmove=function(h,v,d){if(this._active&&!(d.length<this._minTouches))return h.preventDefault(),this._calculateTransform(h,v,d)},yu.prototype.touchend=function(h,v,d){this._calculateTransform(h,v,d),this._active&&d.length<this._minTouches&&this.reset()},yu.prototype.touchcancel=function(){this.reset()},yu.prototype._calculateTransform=function(h,v,d){d.length>0&&(this._active=!0);var g=If(d,v),S=new y.Point(0,0),C=new y.Point(0,0),R=0;for(var O in g){var G=g[O],J=this._touches[O];J&&(S._add(G),C._add(G.sub(J)),R++,g[O]=G)}if(this._touches=g,!(R<this._minTouches)&&C.mag()){var _e=C.div(R);if(this._sum._add(_e),!(this._sum.mag()<this._clickTolerance))return{around:S.div(R),panDelta:_e}}},yu.prototype.enable=function(){this._enabled=!0},yu.prototype.disable=function(){this._enabled=!1,this.reset()},yu.prototype.isEnabled=function(){return this._enabled},yu.prototype.isActive=function(){return this._active};var Os=function(){this.reset()};function Of(h,v,d){for(var g=0;g<h.length;g++)if(h[g].identifier===d)return v[g]}function kf(h,v){return Math.log(h/v)/Math.LN2}Os.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Os.prototype._start=function(h){},Os.prototype._move=function(h,v,d){return{}},Os.prototype.touchstart=function(h,v,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([v[0],v[1]]))},Os.prototype.touchmove=function(h,v,d){if(this._firstTwoTouches){h.preventDefault();var g=this._firstTwoTouches,S=g[1],C=Of(d,v,g[0]),R=Of(d,v,S);if(C&&R){var O=this._aroundCenter?null:C.add(R).div(2);return this._move([C,R],O,h)}}},Os.prototype.touchend=function(h,v,d){if(this._firstTwoTouches){var g=this._firstTwoTouches,S=g[1],C=Of(d,v,g[0]),R=Of(d,v,S);C&&R||(this._active&&V.suppressClick(),this.reset())}},Os.prototype.touchcancel=function(){this.reset()},Os.prototype.enable=function(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"},Os.prototype.disable=function(){this._enabled=!1,this.reset()},Os.prototype.isEnabled=function(){return this._enabled},Os.prototype.isActive=function(){return this._active};var us=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._distance,delete this._startDistance},v.prototype._start=function(d){this._startDistance=this._distance=d[0].dist(d[1])},v.prototype._move=function(d,g){var S=this._distance;if(this._distance=d[0].dist(d[1]),this._active||!(Math.abs(kf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:kf(this._distance,S),pinchAround:g}},v}(Os);function xu(h,v){return 180*h.angleWith(v)/Math.PI}var ep=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},v.prototype._start=function(d){this._startVector=this._vector=d[0].sub(d[1]),this._minDiameter=d[0].dist(d[1])},v.prototype._move=function(d,g){var S=this._vector;if(this._vector=d[0].sub(d[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:xu(this._vector,S),pinchAround:g}},v.prototype._isBelowThreshold=function(d){this._minDiameter=Math.min(this._minDiameter,d.mag());var g=25/(Math.PI*this._minDiameter)*360,S=xu(d,this._startVector);return Math.abs(S)<g},v}(Os);function Ac(h){return Math.abs(h.y)>Math.abs(h.x)}var Tc=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},v.prototype._start=function(d){this._lastPoints=d,Ac(d[0].sub(d[1]))&&(this._valid=!1)},v.prototype._move=function(d,g,S){var C=d[0].sub(this._lastPoints[0]),R=d[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,R,S.timeStamp),this._valid)return this._lastPoints=d,this._active=!0,{pitchDelta:(C.y+R.y)/2*-.5}},v.prototype.gestureBeginsVertically=function(d,g,S){if(this._valid!==void 0)return this._valid;var C=d.mag()>=2,R=g.mag()>=2;if(C||R){if(!C||!R)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var O=d.y>0==g.y>0;return Ac(d)&&Ac(g)&&O}},v}(Os),ef={panStep:100,bearingStep:15,pitchStep:10},ks=function(){var h=ef;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1};function Nt(h){return h*(2-h)}ks.prototype.blur=function(){this.reset()},ks.prototype.reset=function(){this._active=!1},ks.prototype.keydown=function(h){var v=this;if(!(h.altKey||h.ctrlKey||h.metaKey)){var d=0,g=0,S=0,C=0,R=0;switch(h.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:h.shiftKey?g=-1:(h.preventDefault(),C=-1);break;case 39:h.shiftKey?g=1:(h.preventDefault(),C=1);break;case 38:h.shiftKey?S=1:(h.preventDefault(),R=-1);break;case 40:h.shiftKey?S=-1:(h.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(g=0,S=0),{cameraAnimation:function(O){var G=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:Nt,zoom:d?Math.round(G)+d*(h.shiftKey?2:1):G,bearing:O.getBearing()+g*v._bearingStep,pitch:O.getPitch()+S*v._pitchStep,offset:[-C*v._panStep,-R*v._panStep],center:O.getCenter()},{originalEvent:h})}}}},ks.prototype.enable=function(){this._enabled=!0},ks.prototype.disable=function(){this._enabled=!1,this.reset()},ks.prototype.isEnabled=function(){return this._enabled},ks.prototype.isActive=function(){return this._active},ks.prototype.disableRotation=function(){this._rotationDisabled=!0},ks.prototype.enableRotation=function(){this._rotationDisabled=!1};var we=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._handler=v,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};we.prototype.setZoomRate=function(h){this._defaultZoomRate=h},we.prototype.setWheelZoomRate=function(h){this._wheelZoomRate=h},we.prototype.isEnabled=function(){return!!this._enabled},we.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},we.prototype.isZooming=function(){return!!this._zooming},we.prototype.enable=function(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=h&&h.around==="center")},we.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},we.prototype.wheel=function(h){if(this.isEnabled()){var v=h.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,d=y.browser.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,v!==0&&v%4.000244140625==0?this._type="wheel":v!==0&&Math.abs(v)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=v,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(g*v)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,v+=this._lastValue)),h.shiftKey&&v&&(v/=4),this._type&&(this._lastWheelEvent=h,this._delta-=v,this._active||this._start(h)),h.preventDefault()}},we.prototype._onTimeout=function(h){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},we.prototype._start=function(h){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var v=V.mousePos(this._el,h);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(v)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},we.prototype.renderFrame=function(){var h=this;if(this._frameId&&(this._frameId=null,this.isActive())){var v=this._map.transform;if(this._delta!==0){var d=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*d)));this._delta<0&&g!==0&&(g=1/g);var S=typeof this._targetZoom=="number"?v.zoomScale(this._targetZoom):v.scale;this._targetZoom=Math.min(v.maxZoom,Math.max(v.minZoom,v.scaleZoom(S*g))),this._type==="wheel"&&(this._startZoom=v.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,R=typeof this._targetZoom=="number"?this._targetZoom:v.zoom,O=this._startZoom,G=this._easing,J=!1;if(this._type==="wheel"&&O&&G){var _e=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),be=G(_e);C=y.number(O,R,be),_e<1?this._frameId||(this._frameId=!0):J=!0}else C=R,J=!0;return this._active=!0,J&&(this._active=!1,this._finishTimeout=setTimeout(function(){h._zooming=!1,h._handler._triggerRenderFrame(),delete h._targetZoom,delete h._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!J,zoomDelta:C-v.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},we.prototype._smoothOutEasing=function(h){var v=y.ease;if(this._prevEase){var d=this._prevEase,g=(y.browser.now()-d.start)/d.duration,S=d.easing(g+.01)-d.easing(g),C=.27/Math.sqrt(S*S+1e-4)*.01,R=Math.sqrt(.0729-C*C);v=y.bezier(C,R,.25,1)}return this._prevEase={start:y.browser.now(),duration:h,easing:v},v},we.prototype.blur=function(){this.reset()},we.prototype.reset=function(){this._active=!1};var N=function(h,v){this._clickZoom=h,this._tapZoom=v};N.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},N.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},N.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},N.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Ks=function(){this.reset()};Ks.prototype.reset=function(){this._active=!1},Ks.prototype.blur=function(){this.reset()},Ks.prototype.dblclick=function(h,v){return h.preventDefault(),{cameraAnimation:function(d){d.easeTo({duration:300,zoom:d.getZoom()+(h.shiftKey?-1:1),around:d.unproject(v)},{originalEvent:h})}}},Ks.prototype.enable=function(){this._enabled=!0},Ks.prototype.disable=function(){this._enabled=!1,this.reset()},Ks.prototype.isEnabled=function(){return this._enabled},Ks.prototype.isActive=function(){return this._active};var xe=function(){this._tap=new Yo({numTouches:1,numTaps:1}),this.reset()};xe.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},xe.prototype.touchstart=function(h,v,d){this._swipePoint||(this._tapTime&&h.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=v[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(h,v,d))},xe.prototype.touchmove=function(h,v,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;var g=v[0],S=g.y-this._swipePoint.y;return this._swipePoint=g,h.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(h,v,d)},xe.prototype.touchend=function(h,v,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(h,v,d)&&(this._tapTime=h.timeStamp)},xe.prototype.touchcancel=function(){this.reset()},xe.prototype.enable=function(){this._enabled=!0},xe.prototype.disable=function(){this._enabled=!1,this.reset()},xe.prototype.isEnabled=function(){return this._enabled},xe.prototype.isActive=function(){return this._active};var kl=function(h,v,d){this._el=h,this._mousePan=v,this._touchPan=d};kl.prototype.enable=function(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},kl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},kl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},kl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Fa=function(h,v,d){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=v,this._mousePitch=d};Fa.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Fa.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Fa.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Fa.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Ds=function(h,v,d,g){this._el=h,this._touchZoom=v,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};Ds.prototype.enable=function(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Ds.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Ds.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Ds.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Ds.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Ds.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Ao=function(h){return h.zoom||h.drag||h.pitch||h.rotate},ls=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v}(y.Event);function Ln(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}var An=function(h,v){this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mf(h),this._bearingSnap=v.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(v),y.bindAll(["handleEvent","handleWindowEvent"],this);var d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,S=this._listeners;g<S.length;g+=1){var C=S[g],R=C[0];V.addEventListener(R,C[1],R===y.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};An.prototype.destroy=function(){for(var h=0,v=this._listeners;h<v.length;h+=1){var d=v[h],g=d[0];V.removeEventListener(g,d[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,d[2])}},An.prototype._addDefaultHandlers=function(h){var v=this._map,d=v.getCanvasContainer();this._add("mapEvent",new to(v,h));var g=v.boxZoom=new ss(v,h);this._add("boxZoom",g);var S=new ca,C=new Ks;v.doubleClickZoom=new N(C,S),this._add("tapZoom",S),this._add("clickZoom",C);var R=new xe;this._add("tapDragZoom",R);var O=v.touchPitch=new Tc;this._add("touchPitch",O);var G=new Qc(h),J=new Jc(h);v.dragRotate=new Fa(h,G,J),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]);var _e=new ul(h),be=new yu(h);v.dragPan=new kl(d,_e,be),this._add("mousePan",_e),this._add("touchPan",be,["touchZoom","touchRotate"]);var Te=new ep,We=new us;v.touchZoomRotate=new Ds(d,We,Te,R),this._add("touchRotate",Te,["touchPan","touchZoom"]),this._add("touchZoom",We,["touchPan","touchRotate"]);var je=v.scrollZoom=new we(v,this);this._add("scrollZoom",je,["mousePan"]);var at=v.keyboard=new ks;this._add("keyboard",at),this._add("blockableMapEvent",new bn(v));for(var Fe=0,nt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Fe<nt.length;Fe+=1){var _t=nt[Fe];h.interactive&&h[_t]&&v[_t].enable(h[_t])}},An.prototype._add=function(h,v,d){this._handlers.push({handlerName:h,handler:v,allowed:d}),this._handlersById[h]=v},An.prototype.stop=function(h){if(!this._updatingCamera){for(var v=0,d=this._handlers;v<d.length;v+=1)d[v].handler.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}},An.prototype.isActive=function(){for(var h=0,v=this._handlers;h<v.length;h+=1)if(v[h].handler.isActive())return!0;return!1},An.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},An.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},An.prototype.isMoving=function(){return Boolean(Ao(this._eventsInProgress))||this.isZooming()},An.prototype._blockedByActive=function(h,v,d){for(var g in h)if(g!==d&&(!v||v.indexOf(g)<0))return!0;return!1},An.prototype.handleWindowEvent=function(h){this.handleEvent(h,h.type+"Window")},An.prototype._getMapTouches=function(h){for(var v=[],d=0,g=h;d<g.length;d+=1){var S=g[d];this._el.contains(S.target)&&v.push(S)}return v},An.prototype.handleEvent=function(h,v){this._updatingCamera=!0;for(var d=h.type==="renderFrame"?void 0:h,g={needsRenderFrame:!1},S={},C={},R=h.touches?this._getMapTouches(h.touches):void 0,O=R?V.touchPos(this._el,R):V.mousePos(this._el,h),G=0,J=this._handlers;G<J.length;G+=1){var _e=J[G],be=_e.handlerName,Te=_e.handler,We=_e.allowed;if(Te.isEnabled()){var je=void 0;this._blockedByActive(C,We,be)?Te.reset():Te[v||h.type]&&(je=Te[v||h.type](h,O,R),this.mergeHandlerResult(g,S,je,be,d),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Te.isActive())&&(C[be]=Te)}}var at={};for(var Fe in this._previousActiveHandlers)C[Fe]||(at[Fe]=d);this._previousActiveHandlers=C,(Object.keys(at).length||Ln(g))&&(this._changes.push([g,S,at]),this._triggerRenderFrame()),(Object.keys(C).length||Ln(g))&&this._map._stop(!0),this._updatingCamera=!1;var nt=g.cameraAnimation;nt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],nt(this._map))},An.prototype.mergeHandlerResult=function(h,v,d,g,S){if(d){y.extend(h,d);var C={handlerName:g,originalEvent:d.originalEvent||S};d.zoomDelta!==void 0&&(v.zoom=C),d.panDelta!==void 0&&(v.drag=C),d.pitchDelta!==void 0&&(v.pitch=C),d.bearingDelta!==void 0&&(v.rotate=C)}},An.prototype._applyChanges=function(){for(var h={},v={},d={},g=0,S=this._changes;g<S.length;g+=1){var C=S[g],R=C[0],O=C[1],G=C[2];R.panDelta&&(h.panDelta=(h.panDelta||new y.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(h.around=R.around),R.pinchAround!==void 0&&(h.pinchAround=R.pinchAround),R.noInertia&&(h.noInertia=R.noInertia),y.extend(v,O),y.extend(d,G)}this._updateMapTransform(h,v,d),this._changes=[]},An.prototype._updateMapTransform=function(h,v,d){var g=this._map,S=g.transform;if(!Ln(h))return this._fireEvents(v,d,!0);var C=h.panDelta,R=h.zoomDelta,O=h.bearingDelta,G=h.pitchDelta,J=h.around,_e=h.pinchAround;_e!==void 0&&(J=_e),g._stop(!0),J=J||g.transform.centerPoint;var be=S.pointLocation(C?J.sub(C):J);O&&(S.bearing+=O),G&&(S.pitch+=G),R&&(S.zoom+=R),S.setLocationAtPoint(be,J),this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(v,d,!0)},An.prototype._fireEvents=function(h,v,d){var g=this,S=Ao(this._eventsInProgress),C=Ao(h),R={};for(var O in h)this._eventsInProgress[O]||(R[O+"start"]=h[O].originalEvent),this._eventsInProgress[O]=h[O];for(var G in!S&&C&&this._fireEvent("movestart",C.originalEvent),R)this._fireEvent(G,R[G]);for(var J in C&&this._fireEvent("move",C.originalEvent),h)this._fireEvent(J,h[J].originalEvent);var _e,be={};for(var Te in this._eventsInProgress){var We=this._eventsInProgress[Te],je=We.handlerName,at=We.originalEvent;this._handlersById[je].isActive()||(delete this._eventsInProgress[Te],be[Te+"end"]=_e=v[je]||at)}for(var Fe in be)this._fireEvent(Fe,be[Fe]);var nt=Ao(this._eventsInProgress);if(d&&(S||C)&&!nt){this._updatingCamera=!0;var _t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Dt=function(nr){return nr!==0&&-g._bearingSnap<nr&&nr<g._bearingSnap};_t?(Dt(_t.bearing||this._map.getBearing())&&(_t.bearing=0),this._map.easeTo(_t,{originalEvent:_e})):(this._map.fire(new y.Event("moveend",{originalEvent:_e})),Dt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},An.prototype._fireEvent=function(h,v){this._map.fire(new y.Event(h,v?{originalEvent:v}:{}))},An.prototype._requestFrame=function(){var h=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(v){delete h._frameId,h.handleEvent(new ls("renderFrame",{timeStamp:v})),h._applyChanges()})},An.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var qo=function(h){function v(d,g){h.call(this),this._moving=!1,this._zooming=!1,this.transform=d,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},v.prototype.setCenter=function(d,g){return this.jumpTo({center:d},g)},v.prototype.panBy=function(d,g,S){return d=y.Point.convert(d).mult(-1),this.panTo(this.transform.center,y.extend({offset:d},g),S)},v.prototype.panTo=function(d,g,S){return this.easeTo(y.extend({center:d},g),S)},v.prototype.getZoom=function(){return this.transform.zoom},v.prototype.setZoom=function(d,g){return this.jumpTo({zoom:d},g),this},v.prototype.zoomTo=function(d,g,S){return this.easeTo(y.extend({zoom:d},g),S)},v.prototype.zoomIn=function(d,g){return this.zoomTo(this.getZoom()+1,d,g),this},v.prototype.zoomOut=function(d,g){return this.zoomTo(this.getZoom()-1,d,g),this},v.prototype.getBearing=function(){return this.transform.bearing},v.prototype.setBearing=function(d,g){return this.jumpTo({bearing:d},g),this},v.prototype.getPadding=function(){return this.transform.padding},v.prototype.setPadding=function(d,g){return this.jumpTo({padding:d},g),this},v.prototype.rotateTo=function(d,g,S){return this.easeTo(y.extend({bearing:d},g),S)},v.prototype.resetNorth=function(d,g){return this.rotateTo(0,y.extend({duration:1e3},d),g),this},v.prototype.resetNorthPitch=function(d,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},d),g),this},v.prototype.snapToNorth=function(d,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(d,g):this},v.prototype.getPitch=function(){return this.transform.pitch},v.prototype.setPitch=function(d,g){return this.jumpTo({pitch:d},g),this},v.prototype.cameraForBounds=function(d,g){d=y.LngLatBounds.convert(d);var S=g&&g.bearing||0;return this._cameraForBoxAndBearing(d.getNorthWest(),d.getSouthEast(),S,g)},v.prototype._cameraForBoxAndBearing=function(d,g,S,C){var R={top:0,bottom:0,right:0,left:0};if(typeof(C=y.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var O=C.padding;C.padding={top:O,bottom:O,right:O,left:O}}C.padding=y.extend(R,C.padding);var G=this.transform,J=G.padding,_e=G.project(y.LngLat.convert(d)),be=G.project(y.LngLat.convert(g)),Te=_e.rotate(-S*Math.PI/180),We=be.rotate(-S*Math.PI/180),je=new y.Point(Math.max(Te.x,We.x),Math.max(Te.y,We.y)),at=new y.Point(Math.min(Te.x,We.x),Math.min(Te.y,We.y)),Fe=je.sub(at),nt=(G.width-(J.left+J.right+C.padding.left+C.padding.right))/Fe.x,_t=(G.height-(J.top+J.bottom+C.padding.top+C.padding.bottom))/Fe.y;if(!(_t<0||nt<0)){var Dt=Math.min(G.scaleZoom(G.scale*Math.min(nt,_t)),C.maxZoom),nr=typeof C.offset.x=="number"?new y.Point(C.offset.x,C.offset.y):y.Point.convert(C.offset),$t=new y.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(S*Math.PI/180),cr=nr.add($t).mult(G.scale/G.zoomScale(Dt));return{center:G.unproject(_e.add(be).div(2).sub(cr)),zoom:Dt,bearing:S}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},v.prototype.fitBounds=function(d,g,S){return this._fitInternal(this.cameraForBounds(d,g),g,S)},v.prototype.fitScreenCoordinates=function(d,g,S,C,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(d)),this.transform.pointLocation(y.Point.convert(g)),S,C),C,R)},v.prototype._fitInternal=function(d,g,S){return d?(delete(g=y.extend(d,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this},v.prototype.jumpTo=function(d,g){this.stop();var S=this.transform,C=!1,R=!1,O=!1;return"zoom"in d&&S.zoom!==+d.zoom&&(C=!0,S.zoom=+d.zoom),d.center!==void 0&&(S.center=y.LngLat.convert(d.center)),"bearing"in d&&S.bearing!==+d.bearing&&(R=!0,S.bearing=+d.bearing),"pitch"in d&&S.pitch!==+d.pitch&&(O=!0,S.pitch=+d.pitch),d.padding==null||S.isPaddingEqual(d.padding)||(S.padding=d.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),C&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),R&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),O&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},v.prototype.easeTo=function(d,g){var S=this;this._stop(!1,d.easeId),((d=y.extend({offset:[0,0],duration:500,easing:y.ease},d)).animate===!1||!d.essential&&y.browser.prefersReducedMotion)&&(d.duration=0);var C=this.transform,R=this.getZoom(),O=this.getBearing(),G=this.getPitch(),J=this.getPadding(),_e="zoom"in d?+d.zoom:R,be="bearing"in d?this._normalizeBearing(d.bearing,O):O,Te="pitch"in d?+d.pitch:G,We="padding"in d?d.padding:C.padding,je=y.Point.convert(d.offset),at=C.centerPoint.add(je),Fe=C.pointLocation(at),nt=y.LngLat.convert(d.center||Fe);this._normalizeCenter(nt);var _t,Dt,nr=C.project(Fe),$t=C.project(nt).sub(nr),cr=C.zoomScale(_e-R);d.around&&(_t=y.LngLat.convert(d.around),Dt=C.locationPoint(_t));var yr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||_e!==R,this._rotating=this._rotating||O!==be,this._pitching=this._pitching||Te!==G,this._padding=!C.isPaddingEqual(We),this._easeId=d.easeId,this._prepareEase(g,d.noMoveStart,yr),this._ease(function(Hr){if(S._zooming&&(C.zoom=y.number(R,_e,Hr)),S._rotating&&(C.bearing=y.number(O,be,Hr)),S._pitching&&(C.pitch=y.number(G,Te,Hr)),S._padding&&(C.interpolatePadding(J,We,Hr),at=C.centerPoint.add(je)),_t)C.setLocationAtPoint(_t,Dt);else{var Nr=C.zoomScale(C.zoom-R),dn=_e>R?Math.min(2,cr):Math.max(.5,cr),Nn=Math.pow(dn,1-Hr),Bn=C.unproject(nr.add($t.mult(Hr*Nn)).mult(Nr));C.setLocationAtPoint(C.renderWorldCopies?Bn.wrap():Bn,at)}S._fireMoveEvents(g)},function(Hr){S._afterEase(g,Hr)},d),this},v.prototype._prepareEase=function(d,g,S){S===void 0&&(S={}),this._moving=!0,g||S.moving||this.fire(new y.Event("movestart",d)),this._zooming&&!S.zooming&&this.fire(new y.Event("zoomstart",d)),this._rotating&&!S.rotating&&this.fire(new y.Event("rotatestart",d)),this._pitching&&!S.pitching&&this.fire(new y.Event("pitchstart",d))},v.prototype._fireMoveEvents=function(d){this.fire(new y.Event("move",d)),this._zooming&&this.fire(new y.Event("zoom",d)),this._rotating&&this.fire(new y.Event("rotate",d)),this._pitching&&this.fire(new y.Event("pitch",d))},v.prototype._afterEase=function(d,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var S=this._zooming,C=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new y.Event("zoomend",d)),C&&this.fire(new y.Event("rotateend",d)),R&&this.fire(new y.Event("pitchend",d)),this.fire(new y.Event("moveend",d))}},v.prototype.flyTo=function(d,g){var S=this;if(!d.essential&&y.browser.prefersReducedMotion){var C=y.pick(d,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,g)}this.stop(),d=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},d);var R=this.transform,O=this.getZoom(),G=this.getBearing(),J=this.getPitch(),_e=this.getPadding(),be="zoom"in d?y.clamp(+d.zoom,R.minZoom,R.maxZoom):O,Te="bearing"in d?this._normalizeBearing(d.bearing,G):G,We="pitch"in d?+d.pitch:J,je="padding"in d?d.padding:R.padding,at=R.zoomScale(be-O),Fe=y.Point.convert(d.offset),nt=R.centerPoint.add(Fe),_t=R.pointLocation(nt),Dt=y.LngLat.convert(d.center||_t);this._normalizeCenter(Dt);var nr=R.project(_t),$t=R.project(Dt).sub(nr),cr=d.curve,yr=Math.max(R.width,R.height),Hr=yr/at,Nr=$t.mag();if("minZoom"in d){var dn=y.clamp(Math.min(d.minZoom,O,be),R.minZoom,R.maxZoom),Nn=yr/R.zoomScale(dn-O);cr=Math.sqrt(Nn/Nr*2)}var Bn=cr*cr;function zn(ei){var $n=(Hr*Hr-yr*yr+(ei?-1:1)*Bn*Bn*Nr*Nr)/(2*(ei?Hr:yr)*Bn*Nr);return Math.log(Math.sqrt($n*$n+1)-$n)}function Ni(ei){return(Math.exp(ei)-Math.exp(-ei))/2}function yn(ei){return(Math.exp(ei)+Math.exp(-ei))/2}var ii=zn(0),pi=function(ei){return yn(ii)/yn(ii+cr*ei)},ti=function(ei){return yr*((yn(ii)*(Ni($n=ii+cr*ei)/yn($n))-Ni(ii))/Bn)/Nr;var $n},Jn=(zn(1)-ii)/cr;if(Math.abs(Nr)<1e-6||!isFinite(Jn)){if(Math.abs(yr-Hr)<1e-6)return this.easeTo(d,g);var fi=Hr<yr?-1:1;Jn=Math.abs(Math.log(Hr/yr))/cr,ti=function(){return 0},pi=function(ei){return Math.exp(fi*cr*ei)}}return d.duration="duration"in d?+d.duration:1e3*Jn/("screenSpeed"in d?+d.screenSpeed/cr:+d.speed),d.maxDuration&&d.duration>d.maxDuration&&(d.duration=0),this._zooming=!0,this._rotating=G!==Te,this._pitching=We!==J,this._padding=!R.isPaddingEqual(je),this._prepareEase(g,!1),this._ease(function(ei){var $n=ei*Jn,To=1/pi($n);R.zoom=ei===1?be:O+R.scaleZoom(To),S._rotating&&(R.bearing=y.number(G,Te,ei)),S._pitching&&(R.pitch=y.number(J,We,ei)),S._padding&&(R.interpolatePadding(_e,je,ei),nt=R.centerPoint.add(Fe));var $a=ei===1?Dt:R.unproject(nr.add($t.mult(ti($n))).mult(To));R.setLocationAtPoint(R.renderWorldCopies?$a.wrap():$a,nt),S._fireMoveEvents(g)},function(){return S._afterEase(g)},d),this},v.prototype.isEasing=function(){return!!this._easeFrameId},v.prototype.stop=function(){return this._stop()},v.prototype._stop=function(d,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!d){var C=this.handlers;C&&C.stop(!1)}return this},v.prototype._ease=function(d,g,S){S.animate===!1||S.duration===0?(d(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=S,this._onEaseFrame=d,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},v.prototype._renderFrameCallback=function(){var d=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},v.prototype._normalizeBearing=function(d,g){d=y.wrap(d,-180,180);var S=Math.abs(d-g);return Math.abs(d-360-g)<S&&(d-=360),Math.abs(d+360-g)<S&&(d+=360),d},v.prototype._normalizeCenter=function(d){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var S=d.lng-g.center.lng;d.lng+=S>180?-360:S<-180?360:0}},v}(y.Evented),Ko=function(h){h===void 0&&(h={}),this.options=h,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Ko.prototype.getDefaultPosition=function(){return"bottom-right"},Ko.prototype.onAdd=function(h){var v=this.options&&this.options.compact;return this._map=h,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),v&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),v===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Ko.prototype.onRemove=function(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Ko.prototype._setElementTitle=function(h,v){var d=this._map._getUIString("AttributionControl."+v);h.title=d,h.setAttribute("aria-label",d)},Ko.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Ko.prototype._updateEditLink=function(){var h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));var v=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(h){var d=v.reduce(function(g,S,C){return S.value&&(g+=S.key+"="+S.value+(C<v.length-1?"&":"")),g},"?");h.href=y.config.FEEDBACK_URL+"/"+d+(this._map._hash?this._map._hash.getHashString(!0):""),h.rel="noopener nofollow",this._setElementTitle(h,"MapFeedback")}},Ko.prototype._updateData=function(h){!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Ko.prototype._updateAttributions=function(){if(this._map.style){var h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(function(O){return typeof O!="string"?"":O})):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){var v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}var d=this._map.style.sourceCaches;for(var g in d){var S=d[g];if(S.used){var C=S.getSource();C.attribution&&h.indexOf(C.attribution)<0&&h.push(C.attribution)}}h.sort(function(O,G){return O.length-G.length});var R=(h=h.filter(function(O,G){for(var J=G+1;J<h.length;J++)if(h[J].indexOf(O)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,h.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Ko.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var bu=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};bu.prototype.onAdd=function(h){this._map=h,this._container=V.create("div","mapboxgl-ctrl");var v=V.create("a","mapboxgl-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://www.mapbox.com/",v.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),v.setAttribute("rel","noopener nofollow"),this._container.appendChild(v),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},bu.prototype.onRemove=function(){V.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},bu.prototype.getDefaultPosition=function(){return"bottom-left"},bu.prototype._updateLogo=function(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},bu.prototype._logoRequired=function(){if(this._map.style){var h=this._map.style.sourceCaches;for(var v in h)if(h[v].getSource().mapbox_logo)return!0;return!1}},bu.prototype._updateCompact=function(){var h=this._container.children;if(h.length){var v=h[0];this._map.getCanvasContainer().offsetWidth<250?v.classList.add("mapboxgl-compact"):v.classList.remove("mapboxgl-compact")}};var Ma=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ma.prototype.add=function(h){var v=++this._id;return this._queue.push({callback:h,id:v,cancelled:!1}),v},Ma.prototype.remove=function(h){for(var v=this._currentlyRunning,d=0,g=v?this._queue.concat(v):this._queue;d<g.length;d+=1){var S=g[d];if(S.id===h)return void(S.cancelled=!0)}},Ma.prototype.run=function(h){h===void 0&&(h=0);var v=this._currentlyRunning=this._queue;this._queue=[];for(var d=0,g=v;d<g.length;d+=1){var S=g[d];if(!S.cancelled&&(S.callback(h),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ma.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Qs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Eu=y.window.HTMLImageElement,Su=y.window.HTMLElement,ta=y.window.ImageBitmap,co={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},ph=function(h){function v(g){var S=this;if((g=y.extend({},co,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new Di(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(h.call(this,C,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Ma,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},Qs,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof Su))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new An(this,g),this._hash=g.hash&&new uu(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Ko({customAttribution:g.customAttribution})),this.addControl(new bu,g.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(R){S._update(R.dataType==="style"),S.fire(new y.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){S.fire(new y.Event(R.dataType+"dataloading",R))})}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var d={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return v.prototype._getMapId=function(){return this._mapId},v.prototype.addControl=function(g,S){if(S===void 0&&(S=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=g.onAdd(this);this._controls.push(g);var R=this._controlPositions[S];return S.indexOf("bottom")!==-1?R.insertBefore(C,R.firstChild):R.appendChild(C),this},v.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(g);return S>-1&&this._controls.splice(S,1),g.onRemove(this),this},v.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},v.prototype.resize=function(g){var S=this._containerDimensions(),C=S[0],R=S[1];if(C===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(C,R),this.transform.resize(C,R),this.painter.resize(C,R);var O=!this._moving;return O&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),O&&this.fire(new y.Event("moveend",g)),this},v.prototype.getBounds=function(){return this.transform.getBounds()},v.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},v.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},v.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},v.prototype.getMinZoom=function(){return this.transform.minZoom},v.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},v.prototype.getMaxZoom=function(){return this.transform.maxZoom},v.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},v.prototype.getMinPitch=function(){return this.transform.minPitch},v.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},v.prototype.getMaxPitch=function(){return this.transform.maxPitch},v.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},v.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},v.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},v.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},v.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},v.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},v.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},v.prototype._createDelegatedListener=function(g,S,C){var R,O=this;if(g==="mouseenter"||g==="mouseover"){var G=!1;return{layer:S,listener:C,delegates:{mousemove:function(_e){var be=O.getLayer(S)?O.queryRenderedFeatures(_e.point,{layers:[S]}):[];be.length?G||(G=!0,C.call(O,new Ba(g,O,_e.originalEvent,{features:be}))):G=!1},mouseout:function(){G=!1}}}}if(g==="mouseleave"||g==="mouseout"){var J=!1;return{layer:S,listener:C,delegates:{mousemove:function(_e){(O.getLayer(S)?O.queryRenderedFeatures(_e.point,{layers:[S]}):[]).length?J=!0:J&&(J=!1,C.call(O,new Ba(g,O,_e.originalEvent)))},mouseout:function(_e){J&&(J=!1,C.call(O,new Ba(g,O,_e.originalEvent)))}}}}return{layer:S,listener:C,delegates:(R={},R[g]=function(_e){var be=O.getLayer(S)?O.queryRenderedFeatures(_e.point,{layers:[S]}):[];be.length&&(_e.features=be,C.call(O,_e),delete _e.features)},R)}},v.prototype.on=function(g,S,C){if(C===void 0)return h.prototype.on.call(this,g,S);var R=this._createDelegatedListener(g,S,C);for(var O in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(R),R.delegates)this.on(O,R.delegates[O]);return this},v.prototype.once=function(g,S,C){if(C===void 0)return h.prototype.once.call(this,g,S);var R=this._createDelegatedListener(g,S,C);for(var O in R.delegates)this.once(O,R.delegates[O]);return this},v.prototype.off=function(g,S,C){var R=this;return C===void 0?h.prototype.off.call(this,g,S):(this._delegatedListeners&&this._delegatedListeners[g]&&function(O){for(var G=O[g],J=0;J<G.length;J++){var _e=G[J];if(_e.layer===S&&_e.listener===C){for(var be in _e.delegates)R.off(be,_e.delegates[be]);return G.splice(J,1),R}}}(this._delegatedListeners),this)},v.prototype.queryRenderedFeatures=function(g,S){if(!this.style)return[];var C;if(S!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(S=g,g=void 0),S=S||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")C=[y.Point.convert(g)];else{var R=y.Point.convert(g[0]),O=y.Point.convert(g[1]);C=[R,new y.Point(O.x,R.y),O,new y.Point(R.x,O.y),R]}return this.style.queryRenderedFeatures(C,S,this.transform)},v.prototype.querySourceFeatures=function(g,S){return this.style.querySourceFeatures(g,S)},v.prototype.setStyle=function(g,S){return(S=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(g,S))},v.prototype._getUIString=function(g){var S=this._locale[g];if(S==null)throw new Error("Missing UI string '"+g+"'");return S},v.prototype._updateStyle=function(g,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Rs(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},v.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Rs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},v.prototype._diffStyle=function(g,S){var C=this;if(typeof g=="string"){var R=this._requestManager.normalizeStyleURL(g),O=this._requestManager.transformRequest(R,y.ResourceType.Style);y.getJSON(O,function(G,J){G?C.fire(new y.ErrorEvent(G)):J&&C._updateDiff(J,S)})}else typeof g=="object"&&this._updateDiff(g,S)},v.prototype._updateDiff=function(g,S){try{this.style.setState(g)&&this._update(!0)}catch(C){y.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(g,S)}},v.prototype.getStyle=function(){if(this.style)return this.style.serialize()},v.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},v.prototype.addSource=function(g,S){return this._lazyInitEmptyStyle(),this.style.addSource(g,S),this._update(!0)},v.prototype.isSourceLoaded=function(g){var S=this.style&&this.style.sourceCaches[g];if(S!==void 0)return S.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},v.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var S in g){var C=g[S]._tiles;for(var R in C){var O=C[R];if(O.state!=="loaded"&&O.state!=="errored")return!1}}return!0},v.prototype.addSourceType=function(g,S,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,S,C)},v.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},v.prototype.getSource=function(g){return this.style.getSource(g)},v.prototype.addImage=function(g,S,C){C===void 0&&(C={});var R=C.pixelRatio;R===void 0&&(R=1);var O=C.sdf;O===void 0&&(O=!1);var G=C.stretchX,J=C.stretchY,_e=C.content;if(this._lazyInitEmptyStyle(),S instanceof Eu||ta&&S instanceof ta){var be=y.browser.getImageData(S);this.style.addImage(g,{data:new y.RGBAImage({width:be.width,height:be.height},be.data),pixelRatio:R,stretchX:G,stretchY:J,content:_e,sdf:O,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Te=S;this.style.addImage(g,{data:new y.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:R,stretchX:G,stretchY:J,content:_e,sdf:O,version:0,userImage:Te}),Te.onAdd&&Te.onAdd(this,g)}},v.prototype.updateImage=function(g,S){var C=this.style.getImage(g);if(!C)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=S instanceof Eu||ta&&S instanceof ta?y.browser.getImageData(S):S,O=R.width,G=R.height,J=R.data;return O===void 0||G===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):O!==C.data.width||G!==C.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace(J,!(S instanceof Eu||ta&&S instanceof ta)),void this.style.updateImage(g,C))},v.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},v.prototype.removeImage=function(g){this.style.removeImage(g)},v.prototype.loadImage=function(g,S){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),S)},v.prototype.listImages=function(){return this.style.listImages()},v.prototype.addLayer=function(g,S){return this._lazyInitEmptyStyle(),this.style.addLayer(g,S),this._update(!0)},v.prototype.moveLayer=function(g,S){return this.style.moveLayer(g,S),this._update(!0)},v.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},v.prototype.getLayer=function(g){return this.style.getLayer(g)},v.prototype.setLayerZoomRange=function(g,S,C){return this.style.setLayerZoomRange(g,S,C),this._update(!0)},v.prototype.setFilter=function(g,S,C){return C===void 0&&(C={}),this.style.setFilter(g,S,C),this._update(!0)},v.prototype.getFilter=function(g){return this.style.getFilter(g)},v.prototype.setPaintProperty=function(g,S,C,R){return R===void 0&&(R={}),this.style.setPaintProperty(g,S,C,R),this._update(!0)},v.prototype.getPaintProperty=function(g,S){return this.style.getPaintProperty(g,S)},v.prototype.setLayoutProperty=function(g,S,C,R){return R===void 0&&(R={}),this.style.setLayoutProperty(g,S,C,R),this._update(!0)},v.prototype.getLayoutProperty=function(g,S){return this.style.getLayoutProperty(g,S)},v.prototype.setLight=function(g,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(g,S),this._update(!0)},v.prototype.getLight=function(){return this.style.getLight()},v.prototype.setFeatureState=function(g,S){return this.style.setFeatureState(g,S),this._update()},v.prototype.removeFeatureState=function(g,S){return this.style.removeFeatureState(g,S),this._update()},v.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},v.prototype.getContainer=function(){return this._container},v.prototype.getCanvasContainer=function(){return this._canvasContainer},v.prototype.getCanvas=function(){return this._canvas},v.prototype._containerDimensions=function(){var g=0,S=0;return this._container&&(g=this._container.clientWidth||400,S=this._container.clientHeight||300),[g,S]},v.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},v.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=V.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=V.create("div","mapboxgl-canvas-container",g);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=V.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var R=this._controlContainer=V.create("div","mapboxgl-control-container",g),O=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){O[G]=V.create("div","mapboxgl-ctrl-"+G,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},v.prototype._resizeCanvas=function(g,S){var C=y.browser.devicePixelRatio||1;this._canvas.width=C*g,this._canvas.height=C*S,this._canvas.style.width=g+"px",this._canvas.style.height=S+"px"},v.prototype._setupPainter=function(){var g=y.extend({},de.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);S?(this.painter=new la(S,this.transform),y.webpSupported.testSupport(S)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},v.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},v.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},v.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},v.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},v.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},v.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},v.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},v.prototype._render=function(g){var S,C=this,R=0,O=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=O.createQueryEXT(),O.beginQueryEXT(O.TIME_ELAPSED_EXT,S),R=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var J=this.transform.zoom,_e=y.browser.now();this.style.zoomHistory.update(J,_e);var be=new y.EvaluationParameters(J,{now:_e,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Te=be.crossFadingFactor();Te===1&&Te===this._crossFadingFactor||(G=!0,this._crossFadingFactor=Te),this.style.update(be)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var We=y.browser.now()-R;O.endQueryEXT(O.TIME_ELAPSED_EXT,S),setTimeout(function(){var Fe=O.getQueryObjectEXT(S,O.QUERY_RESULT_EXT)/1e6;O.deleteQueryEXT(S),C.fire(new y.Event("gpu-timing-frame",{cpuTime:We,gpuTime:Fe}))},50)}if(this.listens("gpu-timing-layer")){var je=this.painter.collectGpuTimers();setTimeout(function(){var Fe=C.painter.queryGpuTimers(je);C.fire(new y.Event("gpu-timing-layer",{layerTimes:Fe}))},50)}var at=this._sourcesDirty||this._styleDirty||this._placementDirty;return at||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||at||(this._fullyLoaded=!0),this}},v.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,S=this._controls;g<S.length;g+=1)S[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),Dl(this._canvasContainer),Dl(this._controlContainer),Dl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},v.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(S){g._frame=null,g._render(S)}))},v.prototype._onWindowOnline=function(){this._update()},v.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},d.showTileBoundaries.get=function(){return!!this._showTileBoundaries},d.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},d.showPadding.get=function(){return!!this._showPadding},d.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},d.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},d.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},d.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},d.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},d.repaint.get=function(){return!!this._repaint},d.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},d.vertices.get=function(){return!!this._vertices},d.vertices.set=function(g){this._vertices=g,this._update()},v.prototype._setCacheLimits=function(g,S){y.setCacheLimits(g,S)},d.version.get=function(){return y.version},Object.defineProperties(v.prototype,d),v}(qo);function Dl(h){h.parentNode&&h.parentNode.removeChild(h)}var Df={showCompass:!0,showZoom:!0,visualizePitch:!1},ll=function(h){var v=this;this.options=y.extend({},Df,h),this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(d){return d.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(d){return v._map.zoomIn({},{originalEvent:d})}),V.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(d){return v._map.zoomOut({},{originalEvent:d})}),V.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(d){v.options.visualizePitch?v._map.resetNorthPitch({},{originalEvent:d}):v._map.resetNorth({},{originalEvent:d})}),this._compassIcon=V.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ll.prototype._updateZoomButtons=function(){var h=this._map.getZoom(),v=h===this._map.getMaxZoom(),d=h===this._map.getMinZoom();this._zoomInButton.disabled=v,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",v.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},ll.prototype._rotateCompassArrow=function(){var h=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=h},ll.prototype.onAdd=function(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cs(this._map,this._compass,this.options.visualizePitch)),this._container},ll.prototype.onRemove=function(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ll.prototype._createButton=function(h,v){var d=V.create("button",h,this._container);return d.type="button",d.addEventListener("click",v),d},ll.prototype._setButtonTitle=function(h,v){var d=this._map._getUIString("NavigationControl."+v);h.title=d,h.setAttribute("aria-label",d)};var cs=function(h,v,d){d===void 0&&(d=!1),this._clickTolerance=10,this.element=v,this.mouseRotate=new Qc({clickTolerance:h.dragRotate._mouseRotate._clickTolerance}),this.map=h,d&&(this.mousePitch=new Jc({clickTolerance:h.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),V.addEventListener(v,"mousedown",this.mousedown),V.addEventListener(v,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(v,"touchmove",this.touchmove),V.addEventListener(v,"touchend",this.touchend),V.addEventListener(v,"touchcancel",this.reset)};function Kl(h,v,d){if(h=new y.LngLat(h.lng,h.lat),v){var g=new y.LngLat(h.lng-360,h.lat),S=new y.LngLat(h.lng+360,h.lat),C=d.locationPoint(h).distSqr(v);d.locationPoint(g).distSqr(v)<C?h=g:d.locationPoint(S).distSqr(v)<C&&(h=S)}for(;Math.abs(h.lng-d.center.lng)>180;){var R=d.locationPoint(h);if(R.x>=0&&R.y>=0&&R.x<=d.width&&R.y<=d.height)break;h.lng>d.center.lng?h.lng-=360:h.lng+=360}return h}cs.prototype.down=function(h,v){this.mouseRotate.mousedown(h,v),this.mousePitch&&this.mousePitch.mousedown(h,v),V.disableDrag()},cs.prototype.move=function(h,v){var d=this.map,g=this.mouseRotate.mousemoveWindow(h,v);if(g&&g.bearingDelta&&d.setBearing(d.getBearing()+g.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(h,v);S&&S.pitchDelta&&d.setPitch(d.getPitch()+S.pitchDelta)}},cs.prototype.off=function(){var h=this.element;V.removeEventListener(h,"mousedown",this.mousedown),V.removeEventListener(h,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(h,"touchmove",this.touchmove),V.removeEventListener(h,"touchend",this.touchend),V.removeEventListener(h,"touchcancel",this.reset),this.offTemp()},cs.prototype.offTemp=function(){V.enableDrag(),V.removeEventListener(y.window,"mousemove",this.mousemove),V.removeEventListener(y.window,"mouseup",this.mouseup)},cs.prototype.mousedown=function(h){this.down(y.extend({},h,{ctrlKey:!0,preventDefault:function(){return h.preventDefault()}}),V.mousePos(this.element,h)),V.addEventListener(y.window,"mousemove",this.mousemove),V.addEventListener(y.window,"mouseup",this.mouseup)},cs.prototype.mousemove=function(h){this.move(h,V.mousePos(this.element,h))},cs.prototype.mouseup=function(h){this.mouseRotate.mouseupWindow(h),this.mousePitch&&this.mousePitch.mouseupWindow(h),this.offTemp()},cs.prototype.touchstart=function(h){h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,h.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return h.preventDefault()}},this._startPos))},cs.prototype.touchmove=function(h){h.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,h.targetTouches)[0],this.move({preventDefault:function(){return h.preventDefault()}},this._lastPos))},cs.prototype.touchend=function(h){h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},cs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Au={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Lf(h,v,d){var g=h.classList;for(var S in Au)g.remove("mapboxgl-"+d+"-anchor-"+S);g.add("mapboxgl-"+d+"-anchor-"+v)}var wc,tf=function(h){function v(d,g){if(h.call(this),(d instanceof y.window.HTMLElement||g)&&(d=y.extend({element:d},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=d&&d.anchor||"center",this._color=d&&d.color||"#3FB1CE",this._scale=d&&d.scale||1,this._draggable=d&&d.draggable||!1,this._clickTolerance=d&&d.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=d&&d.rotation||0,this._rotationAlignment=d&&d.rotationAlignment||"auto",this._pitchAlignment=d&&d.pitchAlignment&&d.pitchAlignment!=="auto"?d.pitchAlignment:this._rotationAlignment,d&&d.element)this._element=d.element,this._offset=y.Point.convert(d&&d.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div"),this._element.setAttribute("aria-label","Map marker");var S=V.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var C=V.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var R=V.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var O=V.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(3.0, 29.0)"),O.setAttributeNS(null,"fill","#000000");for(var G=0,J=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<J.length;G+=1){var _e=J[G],be=V.createNS("http://www.w3.org/2000/svg","ellipse");be.setAttributeNS(null,"opacity","0.04"),be.setAttributeNS(null,"cx","10.5"),be.setAttributeNS(null,"cy","5.80029008"),be.setAttributeNS(null,"rx",_e.rx),be.setAttributeNS(null,"ry",_e.ry),O.appendChild(be)}var Te=V.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"fill",this._color);var We=V.createNS("http://www.w3.org/2000/svg","path");We.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Te.appendChild(We);var je=V.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"opacity","0.25"),je.setAttributeNS(null,"fill","#000000");var at=V.createNS("http://www.w3.org/2000/svg","path");at.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),je.appendChild(at);var Fe=V.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Fe.setAttributeNS(null,"fill","#FFFFFF");var nt=V.createNS("http://www.w3.org/2000/svg","g");nt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _t=V.createNS("http://www.w3.org/2000/svg","circle");_t.setAttributeNS(null,"fill","#000000"),_t.setAttributeNS(null,"opacity","0.25"),_t.setAttributeNS(null,"cx","5.5"),_t.setAttributeNS(null,"cy","5.5"),_t.setAttributeNS(null,"r","5.4999962");var Dt=V.createNS("http://www.w3.org/2000/svg","circle");Dt.setAttributeNS(null,"fill","#FFFFFF"),Dt.setAttributeNS(null,"cx","5.5"),Dt.setAttributeNS(null,"cy","5.5"),Dt.setAttributeNS(null,"r","5.4999962"),nt.appendChild(_t),nt.appendChild(Dt),R.appendChild(O),R.appendChild(Te),R.appendChild(je),R.appendChild(Fe),R.appendChild(nt),S.appendChild(R),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=y.Point.convert(d&&d.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(nr){nr.preventDefault()}),this._element.addEventListener("mousedown",function(nr){nr.preventDefault()}),Lf(this._element,this._anchor,"marker"),this._popup=null}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(d){return this.remove(),this._map=d,d.getCanvasContainer().appendChild(this._element),d.on("move",this._update),d.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},v.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(d){return this._lngLat=y.LngLat.convert(d),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},v.prototype.getElement=function(){return this._element},v.prototype.setPopup=function(d){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),d){if(!("offset"in d.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);d.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=d,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},v.prototype._onKeyPress=function(d){var g=d.code,S=d.charCode||d.keyCode;g!=="Space"&&g!=="Enter"&&S!==32&&S!==13||this.togglePopup()},v.prototype._onMapClick=function(d){var g=d.originalEvent.target,S=this._element;this._popup&&(g===S||S.contains(g))&&this.togglePopup()},v.prototype.getPopup=function(){return this._popup},v.prototype.togglePopup=function(){var d=this._popup;return d?(d.isOpen()?d.remove():d.addTo(this._map),this):this},v.prototype._update=function(d){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Kl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),d&&d.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,Au[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+g)}},v.prototype.getOffset=function(){return this._offset},v.prototype.setOffset=function(d){return this._offset=y.Point.convert(d),this._update(),this},v.prototype._onMove=function(d){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},v.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},v.prototype._addDragHandler=function(d){this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},v.prototype.setDraggable=function(d){return this._draggable=!!d,this._map&&(d?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},v.prototype.isDraggable=function(){return this._draggable},v.prototype.setRotation=function(d){return this._rotation=d||0,this._update(),this},v.prototype.getRotation=function(){return this._rotation},v.prototype.setRotationAlignment=function(d){return this._rotationAlignment=d||"auto",this._update(),this},v.prototype.getRotationAlignment=function(){return this._rotationAlignment},v.prototype.setPitchAlignment=function(d){return this._pitchAlignment=d&&d!=="auto"?d:this._rotationAlignment,this._update(),this},v.prototype.getPitchAlignment=function(){return this._pitchAlignment},v}(y.Evented),Bf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ql=0,Jl=!1,dh=function(h){function v(d){h.call(this),this.options=y.extend({},Bf,d),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(d){var g;return this._map=d,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,wc!==void 0?g(wc):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(S){g(wc=S.state!=="denied")}):g(wc=!!y.window.navigator.geolocation),this._container},v.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ql=0,Jl=!1},v.prototype._isOutOfMapMaxBounds=function(d){var g=this._map.getMaxBounds(),S=d.coords;return g&&(S.longitude<g.getWest()||S.longitude>g.getEast()||S.latitude<g.getSouth()||S.latitude>g.getNorth())},v.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},v.prototype._onSuccess=function(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",d)),this._finish()}},v.prototype._updateCamera=function(d){var g=new y.LngLat(d.coords.longitude,d.coords.latitude),S=d.coords.accuracy,C=this._map.getBearing(),R=y.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(S),R,{geolocateSource:!0})},v.prototype._updateMarker=function(d){if(d){var g=new y.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},v.prototype._updateCircleRadius=function(){var d=this._map._container.clientHeight/2,g=this._map.unproject([0,d]),S=this._map.unproject([1,d]),C=g.distanceTo(S),R=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},v.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},v.prototype._onError=function(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&Jl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",d)),this._finish()}},v.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},v.prototype._setupUI=function(d){var g=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=V.create("button","mapboxgl-ctrl-geolocate",this._container),V.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",d===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new tf(this._dotElement),this._circleElement=V.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new tf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||g._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},v.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ql--,Jl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ql>1?(d={maximumAge:6e5,timeout:0},Jl=!0):(d=this.options.positionOptions,Jl=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},v.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},v}(y.Evented),Qo={maxWidth:100,unit:"metric"},Tu=function(h){this.options=y.extend({},Qo,h),y.bindAll(["_onMove","setUnit"],this)};function rf(h,v,d){var g=d&&d.maxWidth||100,S=h._container.clientHeight/2,C=h.unproject([0,S]),R=h.unproject([g,S]),O=C.distanceTo(R);if(d&&d.unit==="imperial"){var G=3.2808*O;G>5280?Ll(v,g,G/5280,h._getUIString("ScaleControl.Miles")):Ll(v,g,G,h._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Ll(v,g,O/1852,h._getUIString("ScaleControl.NauticalMiles")):O>=1e3?Ll(v,g,O/1e3,h._getUIString("ScaleControl.Kilometers")):Ll(v,g,O,h._getUIString("ScaleControl.Meters"))}function Ll(h,v,d,g){var S,C,R,O=(S=d,(C=Math.pow(10,(""+Math.floor(S)).length-1))*(R=(R=S/C)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(G){var J=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*J)/J}(R)));h.style.width=v*(O/d)+"px",h.innerHTML=O+"&nbsp;"+g}Tu.prototype.getDefaultPosition=function(){return"bottom-left"},Tu.prototype._onMove=function(){rf(this._map,this._container,this.options)},Tu.prototype.onAdd=function(h){return this._map=h,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Tu.prototype.onRemove=function(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Tu.prototype.setUnit=function(h){this.options.unit=h,rf(this._map,this._container,this.options)};var lu=function(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof y.window.HTMLElement?this._container=h.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};lu.prototype.onAdd=function(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},lu.prototype.onRemove=function(){V.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},lu.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},lu.prototype._setupUI=function(){var h=this._fullscreenButton=V.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},lu.prototype._updateTitle=function(){var h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h},lu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},lu.prototype._isFullscreen=function(){return this._fullscreen},lu.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},lu.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var vh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ju=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ff=function(h){function v(d){h.call(this),this.options=y.extend(Object.create(vh),d),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},v.prototype.isOpen=function(){return!!this._map},v.prototype.remove=function(){return this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(d){return this._lngLat=y.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},v.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},v.prototype.getElement=function(){return this._container},v.prototype.setText=function(d){return this.setDOMContent(y.window.document.createTextNode(d))},v.prototype.setHTML=function(d){var g,S=y.window.document.createDocumentFragment(),C=y.window.document.createElement("body");for(C.innerHTML=d;g=C.firstChild;)S.appendChild(g);return this.setDOMContent(S)},v.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},v.prototype.setMaxWidth=function(d){return this.options.maxWidth=d,this._update(),this},v.prototype.setDOMContent=function(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this},v.prototype.addClassName=function(d){this._container&&this._container.classList.add(d)},v.prototype.removeClassName=function(d){this._container&&this._container.classList.remove(d)},v.prototype.setOffset=function(d){return this.options.offset=d,this._update(),this},v.prototype.toggleClassName=function(d){if(this._container)return this._container.classList.toggle(d)},v.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=V.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},v.prototype._onMouseUp=function(d){this._update(d.point)},v.prototype._onMouseMove=function(d){this._update(d.point)},v.prototype._onDrag=function(d){this._update(d.point)},v.prototype._update=function(d){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=V.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=V.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(be){return g._container.classList.add(be)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Kl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||d)){var S=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat),C=this.options.anchor,R=function be(Te){if(Te){if(typeof Te=="number"){var We=Math.round(Math.sqrt(.5*Math.pow(Te,2)));return{center:new y.Point(0,0),top:new y.Point(0,Te),"top-left":new y.Point(We,We),"top-right":new y.Point(-We,We),bottom:new y.Point(0,-Te),"bottom-left":new y.Point(We,-We),"bottom-right":new y.Point(-We,-We),left:new y.Point(Te,0),right:new y.Point(-Te,0)}}if(Te instanceof y.Point||Array.isArray(Te)){var je=y.Point.convert(Te);return{center:je,top:je,"top-left":je,"top-right":je,bottom:je,"bottom-left":je,"bottom-right":je,left:je,right:je}}return{center:y.Point.convert(Te.center||[0,0]),top:y.Point.convert(Te.top||[0,0]),"top-left":y.Point.convert(Te["top-left"]||[0,0]),"top-right":y.Point.convert(Te["top-right"]||[0,0]),bottom:y.Point.convert(Te.bottom||[0,0]),"bottom-left":y.Point.convert(Te["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(Te["bottom-right"]||[0,0]),left:y.Point.convert(Te.left||[0,0]),right:y.Point.convert(Te.right||[0,0])}}return be(new y.Point(0,0))}(this.options.offset);if(!C){var O,G=this._container.offsetWidth,J=this._container.offsetHeight;O=S.y+R.bottom.y<J?["top"]:S.y>this._map.transform.height-J?["bottom"]:[],S.x<G/2?O.push("left"):S.x>this._map.transform.width-G/2&&O.push("right"),C=O.length===0?"bottom":O.join("-")}var _e=S.add(R[C]).round();V.setTransform(this._container,Au[C]+" translate("+_e.x+"px,"+_e.y+"px)"),Lf(this._container,C,"popup")}},v.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var d=this._container.querySelector(ju);d&&d.focus()}},v.prototype._onClose=function(){this.remove()},v}(y.Evented),mh={version:y.version,supported:de,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:ph,NavigationControl:ll,GeolocateControl:dh,AttributionControl:Ko,ScaleControl:Tu,FullscreenControl:lu,Popup:Ff,Marker:tf,Style:Rs,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){Kt().acquire(pe)},clearPrewarmedResources:function(){var h=en;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(pe),en=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(h){y.config.ACCESS_TOKEN=h},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(h){y.config.API_URL=h},get workerCount(){return vr.workerCount},set workerCount(h){vr.workerCount=h},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){y.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage:function(h){y.clearTileCache(h)},workerUrl:""};return mh}),ye})},3614:function(Sr,oe,Z){"use strict";Sr.exports=se;var ye=Z(80645);function se(te){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(te)?te:new Uint8Array(te||0),this.pos=0,this.type=0,this.length=this.buf.length}se.Varint=0,se.Fixed64=1,se.Bytes=2,se.Fixed32=5;var y=(1<<16)*(1<<16),de=1/y,V=12,ce=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");se.prototype={destroy:function(){this.buf=null},readFields:function(te,Ne,k){for(k=k||this.length;this.pos<k;){var ke=this.readVarint(),Re=ke>>3,ct=this.pos;this.type=ke&7,te(Re,Ne,this),this.pos===ct&&this.skip(ke)}return Ne},readMessage:function(te,Ne){return this.readFields(te,Ne,this.readVarint()+this.pos)},readFixed32:function(){var te=Mt(this.buf,this.pos);return this.pos+=4,te},readSFixed32:function(){var te=Bt(this.buf,this.pos);return this.pos+=4,te},readFixed64:function(){var te=Mt(this.buf,this.pos)+Mt(this.buf,this.pos+4)*y;return this.pos+=8,te},readSFixed64:function(){var te=Mt(this.buf,this.pos)+Bt(this.buf,this.pos+4)*y;return this.pos+=8,te},readFloat:function(){var te=ye.read(this.buf,this.pos,!0,23,4);return this.pos+=4,te},readDouble:function(){var te=ye.read(this.buf,this.pos,!0,52,8);return this.pos+=8,te},readVarint:function(te){var Ne=this.buf,k,ke;return ke=Ne[this.pos++],k=ke&127,ke<128||(ke=Ne[this.pos++],k|=(ke&127)<<7,ke<128)||(ke=Ne[this.pos++],k|=(ke&127)<<14,ke<128)||(ke=Ne[this.pos++],k|=(ke&127)<<21,ke<128)?k:(ke=Ne[this.pos],k|=(ke&15)<<28,ae(k,te,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var te=this.readVarint();return te%2==1?(te+1)/-2:te/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var te=this.readVarint()+this.pos,Ne=this.pos;return this.pos=te,te-Ne>=V&&ce?ur(this.buf,Ne,te):pt(this.buf,Ne,te)},readBytes:function(){var te=this.readVarint()+this.pos,Ne=this.buf.subarray(this.pos,te);return this.pos=te,Ne},readPackedVarint:function(te,Ne){if(this.type!==se.Bytes)return te.push(this.readVarint(Ne));var k=Be(this);for(te=te||[];this.pos<k;)te.push(this.readVarint(Ne));return te},readPackedSVarint:function(te){if(this.type!==se.Bytes)return te.push(this.readSVarint());var Ne=Be(this);for(te=te||[];this.pos<Ne;)te.push(this.readSVarint());return te},readPackedBoolean:function(te){if(this.type!==se.Bytes)return te.push(this.readBoolean());var Ne=Be(this);for(te=te||[];this.pos<Ne;)te.push(this.readBoolean());return te},readPackedFloat:function(te){if(this.type!==se.Bytes)return te.push(this.readFloat());var Ne=Be(this);for(te=te||[];this.pos<Ne;)te.push(this.readFloat());return te},readPackedDouble:function(te){if(this.type!==se.Bytes)return te.push(this.readDouble());var Ne=Be(this);for(te=te||[];this.pos<Ne;)te.push(this.readDouble());return te},readPackedFixed32:function(te){if(this.type!==se.Bytes)return te.push(this.readFixed32());var Ne=Be(this);for(te=te||[];this.pos<Ne;)te.push(this.readFixed32());return te},readPackedSFixed32:function(te){if(this.type!==se.Bytes)return te.push(this.readSFixed32());var Ne=Be(this);for(te=te||[];this.pos<Ne;)te.push(this.readSFixed32());return te},readPackedFixed64:function(te){if(this.type!==se.Bytes)return te.push(this.readFixed64());var Ne=Be(this);for(te=te||[];this.pos<Ne;)te.push(this.readFixed64());return te},readPackedSFixed64:function(te){if(this.type!==se.Bytes)return te.push(this.readSFixed64());var Ne=Be(this);for(te=te||[];this.pos<Ne;)te.push(this.readSFixed64());return te},skip:function(te){var Ne=te&7;if(Ne===se.Varint)for(;this.buf[this.pos++]>127;);else if(Ne===se.Bytes)this.pos=this.readVarint()+this.pos;else if(Ne===se.Fixed32)this.pos+=4;else if(Ne===se.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Ne)},writeTag:function(te,Ne){this.writeVarint(te<<3|Ne)},realloc:function(te){for(var Ne=this.length||16;Ne<this.pos+te;)Ne*=2;if(Ne!==this.length){var k=new Uint8Array(Ne);k.set(this.buf),this.buf=k,this.length=Ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(te){this.realloc(4),lt(this.buf,te,this.pos),this.pos+=4},writeSFixed32:function(te){this.realloc(4),lt(this.buf,te,this.pos),this.pos+=4},writeFixed64:function(te){this.realloc(8),lt(this.buf,te&-1,this.pos),lt(this.buf,Math.floor(te*de),this.pos+4),this.pos+=8},writeSFixed64:function(te){this.realloc(8),lt(this.buf,te&-1,this.pos),lt(this.buf,Math.floor(te*de),this.pos+4),this.pos+=8},writeVarint:function(te){if(te=+te||0,te>268435455||te<0){Ve(te,this);return}this.realloc(4),this.buf[this.pos++]=te&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=(te>>>=7)&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=(te>>>=7)&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=te>>>7&127)))},writeSVarint:function(te){this.writeVarint(te<0?-te*2-1:te*2)},writeBoolean:function(te){this.writeVarint(Boolean(te))},writeString:function(te){te=String(te),this.realloc(te.length*4),this.pos++;var Ne=this.pos;this.pos=Ar(this.buf,te,this.pos);var k=this.pos-Ne;k>=128&&Ct(Ne,k,this),this.pos=Ne-1,this.writeVarint(k),this.pos+=k},writeFloat:function(te){this.realloc(4),ye.write(this.buf,te,this.pos,!0,23,4),this.pos+=4},writeDouble:function(te){this.realloc(8),ye.write(this.buf,te,this.pos,!0,52,8),this.pos+=8},writeBytes:function(te){var Ne=te.length;this.writeVarint(Ne),this.realloc(Ne);for(var k=0;k<Ne;k++)this.buf[this.pos++]=te[k]},writeRawMessage:function(te,Ne){this.pos++;var k=this.pos;te(Ne,this);var ke=this.pos-k;ke>=128&&Ct(k,ke,this),this.pos=k-1,this.writeVarint(ke),this.pos+=ke},writeMessage:function(te,Ne,k){this.writeTag(te,se.Bytes),this.writeRawMessage(Ne,k)},writePackedVarint:function(te,Ne){Ne.length&&this.writeMessage(te,Tt,Ne)},writePackedSVarint:function(te,Ne){Ne.length&&this.writeMessage(te,Xt,Ne)},writePackedBoolean:function(te,Ne){Ne.length&&this.writeMessage(te,Rt,Ne)},writePackedFloat:function(te,Ne){Ne.length&&this.writeMessage(te,ir,Ne)},writePackedDouble:function(te,Ne){Ne.length&&this.writeMessage(te,Ft,Ne)},writePackedFixed32:function(te,Ne){Ne.length&&this.writeMessage(te,xt,Ne)},writePackedSFixed32:function(te,Ne){Ne.length&&this.writeMessage(te,Zr,Ne)},writePackedFixed64:function(te,Ne){Ne.length&&this.writeMessage(te,Tr,Ne)},writePackedSFixed64:function(te,Ne){Ne.length&&this.writeMessage(te,dr,Ne)},writeBytesField:function(te,Ne){this.writeTag(te,se.Bytes),this.writeBytes(Ne)},writeFixed32Field:function(te,Ne){this.writeTag(te,se.Fixed32),this.writeFixed32(Ne)},writeSFixed32Field:function(te,Ne){this.writeTag(te,se.Fixed32),this.writeSFixed32(Ne)},writeFixed64Field:function(te,Ne){this.writeTag(te,se.Fixed64),this.writeFixed64(Ne)},writeSFixed64Field:function(te,Ne){this.writeTag(te,se.Fixed64),this.writeSFixed64(Ne)},writeVarintField:function(te,Ne){this.writeTag(te,se.Varint),this.writeVarint(Ne)},writeSVarintField:function(te,Ne){this.writeTag(te,se.Varint),this.writeSVarint(Ne)},writeStringField:function(te,Ne){this.writeTag(te,se.Bytes),this.writeString(Ne)},writeFloatField:function(te,Ne){this.writeTag(te,se.Fixed32),this.writeFloat(Ne)},writeDoubleField:function(te,Ne){this.writeTag(te,se.Fixed64),this.writeDouble(Ne)},writeBooleanField:function(te,Ne){this.writeVarintField(te,Boolean(Ne))}};function ae(te,Ne,k){var ke=k.buf,Re,ct;if(ct=ke[k.pos++],Re=(ct&112)>>4,ct<128||(ct=ke[k.pos++],Re|=(ct&127)<<3,ct<128)||(ct=ke[k.pos++],Re|=(ct&127)<<10,ct<128)||(ct=ke[k.pos++],Re|=(ct&127)<<17,ct<128)||(ct=ke[k.pos++],Re|=(ct&127)<<24,ct<128)||(ct=ke[k.pos++],Re|=(ct&1)<<31,ct<128))return ie(te,Re,Ne);throw new Error("Expected varint not more than 10 bytes")}function Be(te){return te.type===se.Bytes?te.readVarint()+te.pos:te.pos+1}function ie(te,Ne,k){return k?Ne*4294967296+(te>>>0):(Ne>>>0)*4294967296+(te>>>0)}function Ve(te,Ne){var k,ke;if(te>=0?(k=te%4294967296|0,ke=te/4294967296|0):(k=~(-te%4294967296),ke=~(-te/4294967296),k^4294967295?k=k+1|0:(k=0,ke=ke+1|0)),te>=18446744073709552e3||te<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ne.realloc(10),rt(k,ke,Ne),it(ke,Ne)}function rt(te,Ne,k){k.buf[k.pos++]=te&127|128,te>>>=7,k.buf[k.pos++]=te&127|128,te>>>=7,k.buf[k.pos++]=te&127|128,te>>>=7,k.buf[k.pos++]=te&127|128,te>>>=7,k.buf[k.pos]=te&127}function it(te,Ne){var k=(te&7)<<4;Ne.buf[Ne.pos++]|=k|((te>>>=3)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127)))))}function Ct(te,Ne,k){var ke=Ne<=16383?1:Ne<=2097151?2:Ne<=268435455?3:Math.floor(Math.log(Ne)/(Math.LN2*7));k.realloc(ke);for(var Re=k.pos-1;Re>=te;Re--)k.buf[Re+ke]=k.buf[Re]}function Tt(te,Ne){for(var k=0;k<te.length;k++)Ne.writeVarint(te[k])}function Xt(te,Ne){for(var k=0;k<te.length;k++)Ne.writeSVarint(te[k])}function ir(te,Ne){for(var k=0;k<te.length;k++)Ne.writeFloat(te[k])}function Ft(te,Ne){for(var k=0;k<te.length;k++)Ne.writeDouble(te[k])}function Rt(te,Ne){for(var k=0;k<te.length;k++)Ne.writeBoolean(te[k])}function xt(te,Ne){for(var k=0;k<te.length;k++)Ne.writeFixed32(te[k])}function Zr(te,Ne){for(var k=0;k<te.length;k++)Ne.writeSFixed32(te[k])}function Tr(te,Ne){for(var k=0;k<te.length;k++)Ne.writeFixed64(te[k])}function dr(te,Ne){for(var k=0;k<te.length;k++)Ne.writeSFixed64(te[k])}function Mt(te,Ne){return(te[Ne]|te[Ne+1]<<8|te[Ne+2]<<16)+te[Ne+3]*16777216}function lt(te,Ne,k){te[k]=Ne,te[k+1]=Ne>>>8,te[k+2]=Ne>>>16,te[k+3]=Ne>>>24}function Bt(te,Ne){return(te[Ne]|te[Ne+1]<<8|te[Ne+2]<<16)+(te[Ne+3]<<24)}function pt(te,Ne,k){for(var ke="",Re=Ne;Re<k;){var ct=te[Re],Et=null,kt=ct>239?4:ct>223?3:ct>191?2:1;if(Re+kt>k)break;var er,rr,fn;kt===1?ct<128&&(Et=ct):kt===2?(er=te[Re+1],(er&192)==128&&(Et=(ct&31)<<6|er&63,Et<=127&&(Et=null))):kt===3?(er=te[Re+1],rr=te[Re+2],(er&192)==128&&(rr&192)==128&&(Et=(ct&15)<<12|(er&63)<<6|rr&63,(Et<=2047||Et>=55296&&Et<=57343)&&(Et=null))):kt===4&&(er=te[Re+1],rr=te[Re+2],fn=te[Re+3],(er&192)==128&&(rr&192)==128&&(fn&192)==128&&(Et=(ct&15)<<18|(er&63)<<12|(rr&63)<<6|fn&63,(Et<=65535||Et>=1114112)&&(Et=null))),Et===null?(Et=65533,kt=1):Et>65535&&(Et-=65536,ke+=String.fromCharCode(Et>>>10&1023|55296),Et=56320|Et&1023),ke+=String.fromCharCode(Et),Re+=kt}return ke}function ur(te,Ne,k){return ce.decode(te.subarray(Ne,k))}function Ar(te,Ne,k){for(var ke=0,Re,ct;ke<Ne.length;ke++){if(Re=Ne.charCodeAt(ke),Re>55295&&Re<57344)if(ct)if(Re<56320){te[k++]=239,te[k++]=191,te[k++]=189,ct=Re;continue}else Re=ct-55296<<10|Re-56320|65536,ct=null;else{Re>56319||ke+1===Ne.length?(te[k++]=239,te[k++]=191,te[k++]=189):ct=Re;continue}else ct&&(te[k++]=239,te[k++]=191,te[k++]=189,ct=null);Re<128?te[k++]=Re:(Re<2048?te[k++]=Re>>6|192:(Re<65536?te[k++]=Re>>12|224:(te[k++]=Re>>18|240,te[k++]=Re>>12&63|128),te[k++]=Re>>6&63|128),te[k++]=Re&63|128)}return k}},32676:function(Sr,oe,Z){var ye=Z(34155);(function(se,y){Sr.exports=y()})(this,function(){"use strict";/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function se(fe,D){var z={label:0,sent:function(){if(De[0]&1)throw De[1];return De[1]},trys:[],ops:[]},ne,Ae,De,Zt;return Zt={next:St(0),throw:St(1),return:St(2)},typeof Symbol=="function"&&(Zt[Symbol.iterator]=function(){return this}),Zt;function St(mt){return function(U){return At([mt,U])}}function At(mt){if(ne)throw new TypeError("Generator is already executing.");for(;z;)try{if(ne=1,Ae&&(De=mt[0]&2?Ae.return:mt[0]?Ae.throw||((De=Ae.return)&&De.call(Ae),0):Ae.next)&&!(De=De.call(Ae,mt[1])).done)return De;switch(Ae=0,De&&(mt=[mt[0]&2,De.value]),mt[0]){case 0:case 1:De=mt;break;case 4:return z.label++,{value:mt[1],done:!1};case 5:z.label++,Ae=mt[1],mt=[0];continue;case 7:mt=z.ops.pop(),z.trys.pop();continue;default:if(De=z.trys,!(De=De.length>0&&De[De.length-1])&&(mt[0]===6||mt[0]===2)){z=0;continue}if(mt[0]===3&&(!De||mt[1]>De[0]&&mt[1]<De[3])){z.label=mt[1];break}if(mt[0]===6&&z.label<De[1]){z.label=De[1],De=mt;break}if(De&&z.label<De[2]){z.label=De[2],z.ops.push(mt);break}De[2]&&z.ops.pop(),z.trys.pop();continue}mt=D.call(fe,z)}catch(U){mt=[6,U],Ae=0}finally{ne=De=0}if(mt[0]&5)throw mt[1];return{value:mt[0]?mt[1]:void 0,done:!0}}}var y=function(){function fe(D,z){this.next=null,this.key=D,this.data=z,this.left=null,this.right=null}return fe}();function de(fe,D){return fe>D?1:fe<D?-1:0}function V(fe,D,z){for(var ne=new y(null,null),Ae=ne,De=ne;;){var Zt=z(fe,D.key);if(Zt<0){if(D.left===null)break;if(z(fe,D.left.key)<0){var St=D.left;if(D.left=St.right,St.right=D,D=St,D.left===null)break}De.left=D,De=D,D=D.left}else if(Zt>0){if(D.right===null)break;if(z(fe,D.right.key)>0){var St=D.right;if(D.right=St.left,St.left=D,D=St,D.right===null)break}Ae.right=D,Ae=D,D=D.right}else break}return Ae.right=D.left,De.left=D.right,D.left=ne.right,D.right=ne.left,D}function ce(fe,D,z,ne){var Ae=new y(fe,D);if(z===null)return Ae.left=Ae.right=null,Ae;z=V(fe,z,ne);var De=ne(fe,z.key);return De<0?(Ae.left=z.left,Ae.right=z,z.left=null):De>=0&&(Ae.right=z.right,Ae.left=z,z.right=null),Ae}function ae(fe,D,z){var ne=null,Ae=null;if(D){D=V(fe,D,z);var De=z(D.key,fe);De===0?(ne=D.left,Ae=D.right):De<0?(Ae=D.right,D.right=null,ne=D):(ne=D.left,D.left=null,Ae=D)}return{left:ne,right:Ae}}function Be(fe,D,z){return D===null?fe:(fe===null||(D=V(fe.key,D,z),D.left=fe),D)}function ie(fe,D,z,ne,Ae){if(fe){ne(""+D+(z?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Ae(fe)+`
`);var De=D+(z?"    ":"\u2502   ");fe.left&&ie(fe.left,De,!1,ne,Ae),fe.right&&ie(fe.right,De,!0,ne,Ae)}}var Ve=function(){function fe(D){D===void 0&&(D=de),this._root=null,this._size=0,this._comparator=D}return fe.prototype.insert=function(D,z){return this._size++,this._root=ce(D,z,this._root,this._comparator)},fe.prototype.add=function(D,z){var ne=new y(D,z);this._root===null&&(ne.left=ne.right=null,this._size++,this._root=ne);var Ae=this._comparator,De=V(D,this._root,Ae),Zt=Ae(D,De.key);return Zt===0?this._root=De:(Zt<0?(ne.left=De.left,ne.right=De,De.left=null):Zt>0&&(ne.right=De.right,ne.left=De,De.right=null),this._size++,this._root=ne),this._root},fe.prototype.remove=function(D){this._root=this._remove(D,this._root,this._comparator)},fe.prototype._remove=function(D,z,ne){var Ae;if(z===null)return null;z=V(D,z,ne);var De=ne(D,z.key);return De===0?(z.left===null?Ae=z.right:(Ae=V(D,z.left,ne),Ae.right=z.right),this._size--,Ae):z},fe.prototype.pop=function(){var D=this._root;if(D){for(;D.left;)D=D.left;return this._root=V(D.key,this._root,this._comparator),this._root=this._remove(D.key,this._root,this._comparator),{key:D.key,data:D.data}}return null},fe.prototype.findStatic=function(D){for(var z=this._root,ne=this._comparator;z;){var Ae=ne(D,z.key);if(Ae===0)return z;Ae<0?z=z.left:z=z.right}return null},fe.prototype.find=function(D){return this._root&&(this._root=V(D,this._root,this._comparator),this._comparator(D,this._root.key)!==0)?null:this._root},fe.prototype.contains=function(D){for(var z=this._root,ne=this._comparator;z;){var Ae=ne(D,z.key);if(Ae===0)return!0;Ae<0?z=z.left:z=z.right}return!1},fe.prototype.forEach=function(D,z){for(var ne=this._root,Ae=[],De=!1;!De;)ne!==null?(Ae.push(ne),ne=ne.left):Ae.length!==0?(ne=Ae.pop(),D.call(z,ne),ne=ne.right):De=!0;return this},fe.prototype.range=function(D,z,ne,Ae){for(var De=[],Zt=this._comparator,St=this._root,At;De.length!==0||St;)if(St)De.push(St),St=St.left;else{if(St=De.pop(),At=Zt(St.key,z),At>0)break;if(Zt(St.key,D)>=0&&ne.call(Ae,St))return this;St=St.right}return this},fe.prototype.keys=function(){var D=[];return this.forEach(function(z){var ne=z.key;return D.push(ne)}),D},fe.prototype.values=function(){var D=[];return this.forEach(function(z){var ne=z.data;return D.push(ne)}),D},fe.prototype.min=function(){return this._root?this.minNode(this._root).key:null},fe.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},fe.prototype.minNode=function(D){if(D===void 0&&(D=this._root),D)for(;D.left;)D=D.left;return D},fe.prototype.maxNode=function(D){if(D===void 0&&(D=this._root),D)for(;D.right;)D=D.right;return D},fe.prototype.at=function(D){for(var z=this._root,ne=!1,Ae=0,De=[];!ne;)if(z)De.push(z),z=z.left;else if(De.length>0){if(z=De.pop(),Ae===D)return z;Ae++,z=z.right}else ne=!0;return null},fe.prototype.next=function(D){var z=this._root,ne=null;if(D.right){for(ne=D.right;ne.left;)ne=ne.left;return ne}for(var Ae=this._comparator;z;){var De=Ae(D.key,z.key);if(De===0)break;De<0?(ne=z,z=z.left):z=z.right}return ne},fe.prototype.prev=function(D){var z=this._root,ne=null;if(D.left!==null){for(ne=D.left;ne.right;)ne=ne.right;return ne}for(var Ae=this._comparator;z;){var De=Ae(D.key,z.key);if(De===0)break;De<0?z=z.left:(ne=z,z=z.right)}return ne},fe.prototype.clear=function(){return this._root=null,this._size=0,this},fe.prototype.toList=function(){return Ct(this._root)},fe.prototype.load=function(D,z,ne){z===void 0&&(z=[]),ne===void 0&&(ne=!1);var Ae=D.length,De=this._comparator;if(ne&&ir(D,z,0,Ae-1,De),this._root===null)this._root=rt(D,z,0,Ae),this._size=Ae;else{var Zt=Xt(this.toList(),it(D,z),De);Ae=this._size+Ae,this._root=Tt({head:Zt},0,Ae)}return this},fe.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(fe.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(fe.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),fe.prototype.toString=function(D){D===void 0&&(D=function(ne){return String(ne.key)});var z=[];return ie(this._root,"",!0,function(ne){return z.push(ne)},D),z.join("")},fe.prototype.update=function(D,z,ne){var Ae=this._comparator,De=ae(D,this._root,Ae),Zt=De.left,St=De.right;Ae(D,z)<0?St=ce(z,ne,St,Ae):Zt=ce(z,ne,Zt,Ae),this._root=Be(Zt,St,Ae)},fe.prototype.split=function(D){return ae(D,this._root,this._comparator)},fe.prototype[Symbol.iterator]=function(){var D,z,ne;return se(this,function(Ae){switch(Ae.label){case 0:D=this._root,z=[],ne=!1,Ae.label=1;case 1:return ne?[3,6]:D===null?[3,2]:(z.push(D),D=D.left,[3,5]);case 2:return z.length===0?[3,4]:(D=z.pop(),[4,D]);case 3:return Ae.sent(),D=D.right,[3,5];case 4:ne=!0,Ae.label=5;case 5:return[3,1];case 6:return[2]}})},fe}();function rt(fe,D,z,ne){var Ae=ne-z;if(Ae>0){var De=z+Math.floor(Ae/2),Zt=fe[De],St=D[De],At=new y(Zt,St);return At.left=rt(fe,D,z,De),At.right=rt(fe,D,De+1,ne),At}return null}function it(fe,D){for(var z=new y(null,null),ne=z,Ae=0;Ae<fe.length;Ae++)ne=ne.next=new y(fe[Ae],D[Ae]);return ne.next=null,z.next}function Ct(fe){for(var D=fe,z=[],ne=!1,Ae=new y(null,null),De=Ae;!ne;)D?(z.push(D),D=D.left):z.length>0?(D=De=De.next=z.pop(),D=D.right):ne=!0;return De.next=null,Ae.next}function Tt(fe,D,z){var ne=z-D;if(ne>0){var Ae=D+Math.floor(ne/2),De=Tt(fe,D,Ae),Zt=fe.head;return Zt.left=De,fe.head=fe.head.next,Zt.right=Tt(fe,Ae+1,z),Zt}return null}function Xt(fe,D,z){for(var ne=new y(null,null),Ae=ne,De=fe,Zt=D;De!==null&&Zt!==null;)z(De.key,Zt.key)<0?(Ae.next=De,De=De.next):(Ae.next=Zt,Zt=Zt.next),Ae=Ae.next;return De!==null?Ae.next=De:Zt!==null&&(Ae.next=Zt),ne.next}function ir(fe,D,z,ne,Ae){if(!(z>=ne)){for(var De=fe[z+ne>>1],Zt=z-1,St=ne+1;;){do Zt++;while(Ae(fe[Zt],De)<0);do St--;while(Ae(fe[St],De)>0);if(Zt>=St)break;var At=fe[Zt];fe[Zt]=fe[St],fe[St]=At,At=D[Zt],D[Zt]=D[St],D[St]=At}ir(fe,D,z,St,Ae),ir(fe,D,St+1,ne,Ae)}}const Ft=(fe,D)=>fe.ll.x<=D.x&&D.x<=fe.ur.x&&fe.ll.y<=D.y&&D.y<=fe.ur.y,Rt=(fe,D)=>{if(D.ur.x<fe.ll.x||fe.ur.x<D.ll.x||D.ur.y<fe.ll.y||fe.ur.y<D.ll.y)return null;const z=fe.ll.x<D.ll.x?D.ll.x:fe.ll.x,ne=fe.ur.x<D.ur.x?fe.ur.x:D.ur.x,Ae=fe.ll.y<D.ll.y?D.ll.y:fe.ll.y,De=fe.ur.y<D.ur.y?fe.ur.y:D.ur.y;return{ll:{x:z,y:Ae},ur:{x:ne,y:De}}};let xt=Number.EPSILON;xt===void 0&&(xt=Math.pow(2,-52));const Zr=xt*xt,Tr=(fe,D)=>{if(-xt<fe&&fe<xt&&-xt<D&&D<xt)return 0;const z=fe-D;return z*z<Zr*fe*D?0:fe<D?-1:1};class dr{constructor(){this.reset()}reset(){this.xRounder=new Mt,this.yRounder=new Mt}round(D,z){return{x:this.xRounder.round(D),y:this.yRounder.round(z)}}}class Mt{constructor(){this.tree=new Ve,this.round(0)}round(D){const z=this.tree.add(D),ne=this.tree.prev(z);if(ne!==null&&Tr(z.key,ne.key)===0)return this.tree.remove(D),ne.key;const Ae=this.tree.next(z);return Ae!==null&&Tr(z.key,Ae.key)===0?(this.tree.remove(D),Ae.key):D}}const lt=new dr,Bt=11102230246251565e-32,pt=134217729,ur=(3+8*Bt)*Bt;function Ar(fe,D,z,ne,Ae){let De,Zt,St,At,mt=D[0],U=ne[0],F=0,X=0;U>mt==U>-mt?(De=mt,mt=D[++F]):(De=U,U=ne[++X]);let ee=0;if(F<fe&&X<z)for(U>mt==U>-mt?(Zt=mt+De,St=De-(Zt-mt),mt=D[++F]):(Zt=U+De,St=De-(Zt-U),U=ne[++X]),De=Zt,St!==0&&(Ae[ee++]=St);F<fe&&X<z;)U>mt==U>-mt?(Zt=De+mt,At=Zt-De,St=De-(Zt-At)+(mt-At),mt=D[++F]):(Zt=De+U,At=Zt-De,St=De-(Zt-At)+(U-At),U=ne[++X]),De=Zt,St!==0&&(Ae[ee++]=St);for(;F<fe;)Zt=De+mt,At=Zt-De,St=De-(Zt-At)+(mt-At),mt=D[++F],De=Zt,St!==0&&(Ae[ee++]=St);for(;X<z;)Zt=De+U,At=Zt-De,St=De-(Zt-At)+(U-At),U=ne[++X],De=Zt,St!==0&&(Ae[ee++]=St);return(De!==0||ee===0)&&(Ae[ee++]=De),ee}function te(fe,D){let z=D[0];for(let ne=1;ne<fe;ne++)z+=D[ne];return z}function Ne(fe){return new Float64Array(fe)}const k=(3+16*Bt)*Bt,ke=(2+12*Bt)*Bt,Re=(9+64*Bt)*Bt*Bt,ct=Ne(4),Et=Ne(8),kt=Ne(12),er=Ne(16),rr=Ne(4);function fn(fe,D,z,ne,Ae,De,Zt){let St,At,mt,U,F,X,ee,Se,Ue,Je,he,K,ge,Qe,gt,pe,vr,en;const tn=fe-Ae,Kt=z-Ae,$r=D-De,Br=ne-De;Qe=tn*Br,X=pt*tn,ee=X-(X-tn),Se=tn-ee,X=pt*Br,Ue=X-(X-Br),Je=Br-Ue,gt=Se*Je-(Qe-ee*Ue-Se*Ue-ee*Je),pe=$r*Kt,X=pt*$r,ee=X-(X-$r),Se=$r-ee,X=pt*Kt,Ue=X-(X-Kt),Je=Kt-Ue,vr=Se*Je-(pe-ee*Ue-Se*Ue-ee*Je),he=gt-vr,F=gt-he,ct[0]=gt-(he+F)+(F-vr),K=Qe+he,F=K-Qe,ge=Qe-(K-F)+(he-F),he=ge-pe,F=ge-he,ct[1]=ge-(he+F)+(F-pe),en=K+he,F=en-K,ct[2]=K-(en-F)+(he-F),ct[3]=en;let jr=te(4,ct),ni=ke*Zt;if(jr>=ni||-jr>=ni||(F=fe-tn,St=fe-(tn+F)+(F-Ae),F=z-Kt,mt=z-(Kt+F)+(F-Ae),F=D-$r,At=D-($r+F)+(F-De),F=ne-Br,U=ne-(Br+F)+(F-De),St===0&&At===0&&mt===0&&U===0)||(ni=Re*Zt+ur*Math.abs(jr),jr+=tn*U+Br*St-($r*mt+Kt*At),jr>=ni||-jr>=ni))return jr;Qe=St*Br,X=pt*St,ee=X-(X-St),Se=St-ee,X=pt*Br,Ue=X-(X-Br),Je=Br-Ue,gt=Se*Je-(Qe-ee*Ue-Se*Ue-ee*Je),pe=At*Kt,X=pt*At,ee=X-(X-At),Se=At-ee,X=pt*Kt,Ue=X-(X-Kt),Je=Kt-Ue,vr=Se*Je-(pe-ee*Ue-Se*Ue-ee*Je),he=gt-vr,F=gt-he,rr[0]=gt-(he+F)+(F-vr),K=Qe+he,F=K-Qe,ge=Qe-(K-F)+(he-F),he=ge-pe,F=ge-he,rr[1]=ge-(he+F)+(F-pe),en=K+he,F=en-K,rr[2]=K-(en-F)+(he-F),rr[3]=en;const on=Ar(4,ct,4,rr,Et);Qe=tn*U,X=pt*tn,ee=X-(X-tn),Se=tn-ee,X=pt*U,Ue=X-(X-U),Je=U-Ue,gt=Se*Je-(Qe-ee*Ue-Se*Ue-ee*Je),pe=$r*mt,X=pt*$r,ee=X-(X-$r),Se=$r-ee,X=pt*mt,Ue=X-(X-mt),Je=mt-Ue,vr=Se*Je-(pe-ee*Ue-Se*Ue-ee*Je),he=gt-vr,F=gt-he,rr[0]=gt-(he+F)+(F-vr),K=Qe+he,F=K-Qe,ge=Qe-(K-F)+(he-F),he=ge-pe,F=ge-he,rr[1]=ge-(he+F)+(F-pe),en=K+he,F=en-K,rr[2]=K-(en-F)+(he-F),rr[3]=en;const di=Ar(on,Et,4,rr,kt);Qe=St*U,X=pt*St,ee=X-(X-St),Se=St-ee,X=pt*U,Ue=X-(X-U),Je=U-Ue,gt=Se*Je-(Qe-ee*Ue-Se*Ue-ee*Je),pe=At*mt,X=pt*At,ee=X-(X-At),Se=At-ee,X=pt*mt,Ue=X-(X-mt),Je=mt-Ue,vr=Se*Je-(pe-ee*Ue-Se*Ue-ee*Je),he=gt-vr,F=gt-he,rr[0]=gt-(he+F)+(F-vr),K=Qe+he,F=K-Qe,ge=Qe-(K-F)+(he-F),he=ge-pe,F=ge-he,rr[1]=ge-(he+F)+(F-pe),en=K+he,F=en-K,rr[2]=K-(en-F)+(he-F),rr[3]=en;const Fi=Ar(di,kt,4,rr,er);return er[Fi-1]}function ar(fe,D,z,ne,Ae,De){const Zt=(D-De)*(z-Ae),St=(fe-Ae)*(ne-De),At=Zt-St,mt=Math.abs(Zt+St);return Math.abs(At)>=k*mt?At:-fn(fe,D,z,ne,Ae,De,mt)}const Dn=(fe,D)=>fe.x*D.y-fe.y*D.x,hn=(fe,D)=>fe.x*D.x+fe.y*D.y,nn=(fe,D,z)=>{const ne=ar(fe.x,fe.y,D.x,D.y,z.x,z.y);return ne>0?-1:ne<0?1:0},ri=fe=>Math.sqrt(hn(fe,fe)),qn=(fe,D,z)=>{const ne={x:D.x-fe.x,y:D.y-fe.y},Ae={x:z.x-fe.x,y:z.y-fe.y};return Dn(Ae,ne)/ri(Ae)/ri(ne)},En=(fe,D,z)=>{const ne={x:D.x-fe.x,y:D.y-fe.y},Ae={x:z.x-fe.x,y:z.y-fe.y};return hn(Ae,ne)/ri(Ae)/ri(ne)},Ti=(fe,D,z)=>D.y===0?null:{x:fe.x+D.x/D.y*(z-fe.y),y:z},hi=(fe,D,z)=>D.x===0?null:{x:z,y:fe.y+D.y/D.x*(z-fe.x)},ea=(fe,D,z,ne)=>{if(D.x===0)return hi(z,ne,fe.x);if(ne.x===0)return hi(fe,D,z.x);if(D.y===0)return Ti(z,ne,fe.y);if(ne.y===0)return Ti(fe,D,z.y);const Ae=Dn(D,ne);if(Ae==0)return null;const De={x:z.x-fe.x,y:z.y-fe.y},Zt=Dn(De,D)/Ae,St=Dn(De,ne)/Ae,At=fe.x+St*D.x,mt=z.x+Zt*ne.x,U=fe.y+St*D.y,F=z.y+Zt*ne.y,X=(At+mt)/2,ee=(U+F)/2;return{x:X,y:ee}};class Tn{static compare(D,z){const ne=Tn.comparePoints(D.point,z.point);return ne!==0?ne:(D.point!==z.point&&D.link(z),D.isLeft!==z.isLeft?D.isLeft?1:-1:Ea.compare(D.segment,z.segment))}static comparePoints(D,z){return D.x<z.x?-1:D.x>z.x?1:D.y<z.y?-1:D.y>z.y?1:0}constructor(D,z){D.events===void 0?D.events=[this]:D.events.push(this),this.point=D,this.isLeft=z}link(D){if(D.point===this.point)throw new Error("Tried to link already linked events");const z=D.point.events;for(let ne=0,Ae=z.length;ne<Ae;ne++){const De=z[ne];this.point.events.push(De),De.point=this.point}this.checkForConsuming()}checkForConsuming(){const D=this.point.events.length;for(let z=0;z<D;z++){const ne=this.point.events[z];if(ne.segment.consumedBy===void 0)for(let Ae=z+1;Ae<D;Ae++){const De=this.point.events[Ae];De.consumedBy===void 0&&ne.otherSE.point.events===De.otherSE.point.events&&ne.segment.consume(De.segment)}}}getAvailableLinkedEvents(){const D=[];for(let z=0,ne=this.point.events.length;z<ne;z++){const Ae=this.point.events[z];Ae!==this&&!Ae.segment.ringOut&&Ae.segment.isInResult()&&D.push(Ae)}return D}getLeftmostComparator(D){const z=new Map,ne=Ae=>{const De=Ae.otherSE;z.set(Ae,{sine:qn(this.point,D.point,De.point),cosine:En(this.point,D.point,De.point)})};return(Ae,De)=>{z.has(Ae)||ne(Ae),z.has(De)||ne(De);const{sine:Zt,cosine:St}=z.get(Ae),{sine:At,cosine:mt}=z.get(De);return Zt>=0&&At>=0?St<mt?1:St>mt?-1:0:Zt<0&&At<0?St<mt?-1:St>mt?1:0:At<Zt?-1:At>Zt?1:0}}}let kn=0;class Ea{static compare(D,z){const ne=D.leftSE.point.x,Ae=z.leftSE.point.x,De=D.rightSE.point.x,Zt=z.rightSE.point.x;if(Zt<ne)return 1;if(De<Ae)return-1;const St=D.leftSE.point.y,At=z.leftSE.point.y,mt=D.rightSE.point.y,U=z.rightSE.point.y;if(ne<Ae){if(At<St&&At<mt)return 1;if(At>St&&At>mt)return-1;const F=D.comparePoint(z.leftSE.point);if(F<0)return 1;if(F>0)return-1;const X=z.comparePoint(D.rightSE.point);return X!==0?X:-1}if(ne>Ae){if(St<At&&St<U)return-1;if(St>At&&St>U)return 1;const F=z.comparePoint(D.leftSE.point);if(F!==0)return F;const X=D.comparePoint(z.rightSE.point);return X<0?1:X>0?-1:1}if(St<At)return-1;if(St>At)return 1;if(De<Zt){const F=z.comparePoint(D.rightSE.point);if(F!==0)return F}if(De>Zt){const F=D.comparePoint(z.rightSE.point);if(F<0)return 1;if(F>0)return-1}if(De!==Zt){const F=mt-St,X=De-ne,ee=U-At,Se=Zt-Ae;if(F>X&&ee<Se)return 1;if(F<X&&ee>Se)return-1}return De>Zt?1:De<Zt||mt<U?-1:mt>U?1:D.id<z.id?-1:D.id>z.id?1:0}constructor(D,z,ne,Ae){this.id=++kn,this.leftSE=D,D.segment=this,D.otherSE=z,this.rightSE=z,z.segment=this,z.otherSE=D,this.rings=ne,this.windings=Ae}static fromRing(D,z,ne){let Ae,De,Zt;const St=Tn.comparePoints(D,z);if(St<0)Ae=D,De=z,Zt=1;else if(St>0)Ae=z,De=D,Zt=-1;else throw new Error(`Tried to create degenerate segment at [${D.x}, ${D.y}]`);const At=new Tn(Ae,!0),mt=new Tn(De,!1);return new Ea(At,mt,[ne],[Zt])}replaceRightSE(D){this.rightSE=D,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const D=this.leftSE.point.y,z=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:D<z?D:z},ur:{x:this.rightSE.point.x,y:D>z?D:z}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(D){return D.x===this.leftSE.point.x&&D.y===this.leftSE.point.y||D.x===this.rightSE.point.x&&D.y===this.rightSE.point.y}comparePoint(D){if(this.isAnEndpoint(D))return 0;const z=this.leftSE.point,ne=this.rightSE.point,Ae=this.vector();if(z.x===ne.x)return D.x===z.x?0:D.x<z.x?1:-1;const De=(D.y-z.y)/Ae.y,Zt=z.x+De*Ae.x;if(D.x===Zt)return 0;const St=(D.x-z.x)/Ae.x,At=z.y+St*Ae.y;return D.y===At?0:D.y<At?-1:1}getIntersection(D){const z=this.bbox(),ne=D.bbox(),Ae=Rt(z,ne);if(Ae===null)return null;const De=this.leftSE.point,Zt=this.rightSE.point,St=D.leftSE.point,At=D.rightSE.point,mt=Ft(z,St)&&this.comparePoint(St)===0,U=Ft(ne,De)&&D.comparePoint(De)===0,F=Ft(z,At)&&this.comparePoint(At)===0,X=Ft(ne,Zt)&&D.comparePoint(Zt)===0;if(U&&mt)return X&&!F?Zt:!X&&F?At:null;if(U)return F&&De.x===At.x&&De.y===At.y?null:De;if(mt)return X&&Zt.x===St.x&&Zt.y===St.y?null:St;if(X&&F)return null;if(X)return Zt;if(F)return At;const ee=ea(De,this.vector(),St,D.vector());return ee===null||!Ft(Ae,ee)?null:lt.round(ee.x,ee.y)}split(D){const z=[],ne=D.events!==void 0,Ae=new Tn(D,!0),De=new Tn(D,!1),Zt=this.rightSE;this.replaceRightSE(De),z.push(De),z.push(Ae);const St=new Ea(Ae,Zt,this.rings.slice(),this.windings.slice());return Tn.comparePoints(St.leftSE.point,St.rightSE.point)>0&&St.swapEvents(),Tn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),ne&&(Ae.checkForConsuming(),De.checkForConsuming()),z}swapEvents(){const D=this.rightSE;this.rightSE=this.leftSE,this.leftSE=D,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let z=0,ne=this.windings.length;z<ne;z++)this.windings[z]*=-1}consume(D){let z=this,ne=D;for(;z.consumedBy;)z=z.consumedBy;for(;ne.consumedBy;)ne=ne.consumedBy;const Ae=Ea.compare(z,ne);if(Ae!==0){if(Ae>0){const De=z;z=ne,ne=De}if(z.prev===ne){const De=z;z=ne,ne=De}for(let De=0,Zt=ne.rings.length;De<Zt;De++){const St=ne.rings[De],At=ne.windings[De],mt=z.rings.indexOf(St);mt===-1?(z.rings.push(St),z.windings.push(At)):z.windings[mt]+=At}ne.rings=null,ne.windings=null,ne.consumedBy=z,ne.leftSE.consumedBy=z.leftSE,ne.rightSE.consumedBy=z.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const D=this.prev.consumedBy||this.prev;this._beforeState=D.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const D=this.beforeState();this._afterState={rings:D.rings.slice(0),windings:D.windings.slice(0),multiPolys:[]};const z=this._afterState.rings,ne=this._afterState.windings,Ae=this._afterState.multiPolys;for(let St=0,At=this.rings.length;St<At;St++){const mt=this.rings[St],U=this.windings[St],F=z.indexOf(mt);F===-1?(z.push(mt),ne.push(U)):ne[F]+=U}const De=[],Zt=[];for(let St=0,At=z.length;St<At;St++){if(ne[St]===0)continue;const mt=z[St],U=mt.poly;if(Zt.indexOf(U)===-1)if(mt.isExterior)De.push(U);else{Zt.indexOf(U)===-1&&Zt.push(U);const F=De.indexOf(mt.poly);F!==-1&&De.splice(F,1)}}for(let St=0,At=De.length;St<At;St++){const mt=De[St].multiPoly;Ae.indexOf(mt)===-1&&Ae.push(mt)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const D=this.beforeState().multiPolys,z=this.afterState().multiPolys;switch(Vt.type){case"union":{const ne=D.length===0,Ae=z.length===0;this._isInResult=ne!==Ae;break}case"intersection":{let ne,Ae;D.length<z.length?(ne=D.length,Ae=z.length):(ne=z.length,Ae=D.length),this._isInResult=Ae===Vt.numMultiPolys&&ne<Ae;break}case"xor":{const ne=Math.abs(D.length-z.length);this._isInResult=ne%2==1;break}case"difference":{const ne=Ae=>Ae.length===1&&Ae[0].isSubject;this._isInResult=ne(D)!==ne(z);break}default:throw new Error(`Unrecognized operation type found ${Vt.type}`)}return this._isInResult}}class ji{constructor(D,z,ne){if(!Array.isArray(D)||D.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=z,this.isExterior=ne,this.segments=[],typeof D[0][0]!="number"||typeof D[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const Ae=lt.round(D[0][0],D[0][1]);this.bbox={ll:{x:Ae.x,y:Ae.y},ur:{x:Ae.x,y:Ae.y}};let De=Ae;for(let Zt=1,St=D.length;Zt<St;Zt++){if(typeof D[Zt][0]!="number"||typeof D[Zt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let At=lt.round(D[Zt][0],D[Zt][1]);At.x===De.x&&At.y===De.y||(this.segments.push(Ea.fromRing(De,At,this)),At.x<this.bbox.ll.x&&(this.bbox.ll.x=At.x),At.y<this.bbox.ll.y&&(this.bbox.ll.y=At.y),At.x>this.bbox.ur.x&&(this.bbox.ur.x=At.x),At.y>this.bbox.ur.y&&(this.bbox.ur.y=At.y),De=At)}(Ae.x!==De.x||Ae.y!==De.y)&&this.segments.push(Ea.fromRing(De,Ae,this))}getSweepEvents(){const D=[];for(let z=0,ne=this.segments.length;z<ne;z++){const Ae=this.segments[z];D.push(Ae.leftSE),D.push(Ae.rightSE)}return D}}class ja{constructor(D,z){if(!Array.isArray(D))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ji(D[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let ne=1,Ae=D.length;ne<Ae;ne++){const De=new ji(D[ne],this,!1);De.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=De.bbox.ll.x),De.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=De.bbox.ll.y),De.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=De.bbox.ur.x),De.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=De.bbox.ur.y),this.interiorRings.push(De)}this.multiPoly=z}getSweepEvents(){const D=this.exteriorRing.getSweepEvents();for(let z=0,ne=this.interiorRings.length;z<ne;z++){const Ae=this.interiorRings[z].getSweepEvents();for(let De=0,Zt=Ae.length;De<Zt;De++)D.push(Ae[De])}return D}}class Ha{constructor(D,z){if(!Array.isArray(D))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof D[0][0][0]=="number"&&(D=[D])}catch(ne){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let ne=0,Ae=D.length;ne<Ae;ne++){const De=new ja(D[ne],this);De.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=De.bbox.ll.x),De.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=De.bbox.ll.y),De.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=De.bbox.ur.x),De.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=De.bbox.ur.y),this.polys.push(De)}this.isSubject=z}getSweepEvents(){const D=[];for(let z=0,ne=this.polys.length;z<ne;z++){const Ae=this.polys[z].getSweepEvents();for(let De=0,Zt=Ae.length;De<Zt;De++)D.push(Ae[De])}return D}}class Me{static factory(D){const z=[];for(let ne=0,Ae=D.length;ne<Ae;ne++){const De=D[ne];if(!De.isInResult()||De.ringOut)continue;let Zt=null,St=De.leftSE,At=De.rightSE;const mt=[St],U=St.point,F=[];for(;Zt=St,St=At,mt.push(St),St.point!==U;)for(;;){const X=St.getAvailableLinkedEvents();if(X.length===0){const Ue=mt[0].point,Je=mt[mt.length-1].point;throw new Error(`Unable to complete output ring starting at [${Ue.x}, ${Ue.y}]. Last matching segment found ends at [${Je.x}, ${Je.y}].`)}if(X.length===1){At=X[0].otherSE;break}let ee=null;for(let Ue=0,Je=F.length;Ue<Je;Ue++)if(F[Ue].point===St.point){ee=Ue;break}if(ee!==null){const Ue=F.splice(ee)[0],Je=mt.splice(Ue.index);Je.unshift(Je[0].otherSE),z.push(new Me(Je.reverse()));continue}F.push({index:mt.length,point:St.point});const Se=St.getLeftmostComparator(Zt);At=X.sort(Se)[0].otherSE;break}z.push(new Me(mt))}return z}constructor(D){this.events=D;for(let z=0,ne=D.length;z<ne;z++)D[z].segment.ringOut=this;this.poly=null}getGeom(){let D=this.events[0].point;const z=[D];for(let mt=1,U=this.events.length-1;mt<U;mt++){const F=this.events[mt].point,X=this.events[mt+1].point;nn(F,D,X)!==0&&(z.push(F),D=F)}if(z.length===1)return null;const ne=z[0],Ae=z[1];nn(ne,D,Ae)===0&&z.shift(),z.push(z[0]);const De=this.isExteriorRing()?1:-1,Zt=this.isExteriorRing()?0:z.length-1,St=this.isExteriorRing()?z.length:-1,At=[];for(let mt=Zt;mt!=St;mt+=De)At.push([z[mt].x,z[mt].y]);return At}isExteriorRing(){if(this._isExteriorRing===void 0){const D=this.enclosingRing();this._isExteriorRing=D?!D.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let D=this.events[0];for(let Ae=1,De=this.events.length;Ae<De;Ae++){const Zt=this.events[Ae];Tn.compare(D,Zt)>0&&(D=Zt)}let z=D.segment.prevInResult(),ne=z?z.prevInResult():null;for(;;){if(!z)return null;if(!ne)return z.ringOut;if(ne.ringOut!==z.ringOut)return ne.ringOut.enclosingRing()!==z.ringOut?z.ringOut:z.ringOut.enclosingRing();z=ne.prevInResult(),ne=z?z.prevInResult():null}}}class Wa{constructor(D){this.exteriorRing=D,D.poly=this,this.interiorRings=[]}addInterior(D){this.interiorRings.push(D),D.poly=this}getGeom(){const D=[this.exteriorRing.getGeom()];if(D[0]===null)return null;for(let z=0,ne=this.interiorRings.length;z<ne;z++){const Ae=this.interiorRings[z].getGeom();Ae!==null&&D.push(Ae)}return D}}class sa{constructor(D){this.rings=D,this.polys=this._composePolys(D)}getGeom(){const D=[];for(let z=0,ne=this.polys.length;z<ne;z++){const Ae=this.polys[z].getGeom();Ae!==null&&D.push(Ae)}return D}_composePolys(D){const z=[];for(let ne=0,Ae=D.length;ne<Ae;ne++){const De=D[ne];if(!De.poly)if(De.isExteriorRing())z.push(new Wa(De));else{const Zt=De.enclosingRing();Zt.poly||z.push(new Wa(Zt)),Zt.poly.addInterior(De)}}return z}}class eo{constructor(D){let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ea.compare;this.queue=D,this.tree=new Ve(z),this.segments=[]}process(D){const z=D.segment,ne=[];if(D.consumedBy)return D.isLeft?this.queue.remove(D.otherSE):this.tree.remove(z),ne;const Ae=D.isLeft?this.tree.add(z):this.tree.find(z);if(!Ae)throw new Error(`Unable to find segment #${z.id} [${z.leftSE.point.x}, ${z.leftSE.point.y}] -> [${z.rightSE.point.x}, ${z.rightSE.point.y}] in SweepLine tree.`);let De=Ae,Zt=Ae,St,At;for(;St===void 0;)De=this.tree.prev(De),De===null?St=null:De.key.consumedBy===void 0&&(St=De.key);for(;At===void 0;)Zt=this.tree.next(Zt),Zt===null?At=null:Zt.key.consumedBy===void 0&&(At=Zt.key);if(D.isLeft){let mt=null;if(St){const F=St.getIntersection(z);if(F!==null&&(z.isAnEndpoint(F)||(mt=F),!St.isAnEndpoint(F))){const X=this._splitSafely(St,F);for(let ee=0,Se=X.length;ee<Se;ee++)ne.push(X[ee])}}let U=null;if(At){const F=At.getIntersection(z);if(F!==null&&(z.isAnEndpoint(F)||(U=F),!At.isAnEndpoint(F))){const X=this._splitSafely(At,F);for(let ee=0,Se=X.length;ee<Se;ee++)ne.push(X[ee])}}if(mt!==null||U!==null){let F=null;mt===null?F=U:U===null?F=mt:F=Tn.comparePoints(mt,U)<=0?mt:U,this.queue.remove(z.rightSE),ne.push(z.rightSE);const X=z.split(F);for(let ee=0,Se=X.length;ee<Se;ee++)ne.push(X[ee])}ne.length>0?(this.tree.remove(z),ne.push(D)):(this.segments.push(z),z.prev=St)}else{if(St&&At){const mt=St.getIntersection(At);if(mt!==null){if(!St.isAnEndpoint(mt)){const U=this._splitSafely(St,mt);for(let F=0,X=U.length;F<X;F++)ne.push(U[F])}if(!At.isAnEndpoint(mt)){const U=this._splitSafely(At,mt);for(let F=0,X=U.length;F<X;F++)ne.push(U[F])}}}this.tree.remove(z)}return ne}_splitSafely(D,z){this.tree.remove(D);const ne=D.rightSE;this.queue.remove(ne);const Ae=D.split(z);return Ae.push(ne),D.consumedBy===void 0&&this.tree.add(D),Ae}}const Ws=typeof ye!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,xs=typeof ye!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class bs{run(D,z,ne){Vt.type=D,lt.reset();const Ae=[new Ha(z,!0)];for(let F=0,X=ne.length;F<X;F++)Ae.push(new Ha(ne[F],!1));if(Vt.numMultiPolys=Ae.length,Vt.type==="difference"){const F=Ae[0];let X=1;for(;X<Ae.length;)Rt(Ae[X].bbox,F.bbox)!==null?X++:Ae.splice(X,1)}if(Vt.type==="intersection")for(let F=0,X=Ae.length;F<X;F++){const ee=Ae[F];for(let Se=F+1,Ue=Ae.length;Se<Ue;Se++)if(Rt(ee.bbox,Ae[Se].bbox)===null)return[]}const De=new Ve(Tn.compare);for(let F=0,X=Ae.length;F<X;F++){const ee=Ae[F].getSweepEvents();for(let Se=0,Ue=ee.length;Se<Ue;Se++)if(De.insert(ee[Se]),De.size>Ws)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const Zt=new eo(De);let St=De.size,At=De.pop();for(;At;){const F=At.key;if(De.size===St){const ee=F.segment;throw new Error(`Unable to pop() ${F.isLeft?"left":"right"} SweepEvent [${F.point.x}, ${F.point.y}] from segment #${ee.id} [${ee.leftSE.point.x}, ${ee.leftSE.point.y}] -> [${ee.rightSE.point.x}, ${ee.rightSE.point.y}] from queue.`)}if(De.size>Ws)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(Zt.segments.length>xs)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const X=Zt.process(F);for(let ee=0,Se=X.length;ee<Se;ee++){const Ue=X[ee];Ue.consumedBy===void 0&&De.insert(Ue)}St=De.size,At=De.pop()}lt.reset();const mt=Me.factory(Zt.segments);return new sa(mt).getGeom()}}const Vt=new bs;var Hi={union:function(fe){for(var D=arguments.length,z=new Array(D>1?D-1:0),ne=1;ne<D;ne++)z[ne-1]=arguments[ne];return Vt.run("union",fe,z)},intersection:function(fe){for(var D=arguments.length,z=new Array(D>1?D-1:0),ne=1;ne<D;ne++)z[ne-1]=arguments[ne];return Vt.run("intersection",fe,z)},xor:function(fe){for(var D=arguments.length,z=new Array(D>1?D-1:0),ne=1;ne<D;ne++)z[ne-1]=arguments[ne];return Vt.run("xor",fe,z)},difference:function(fe){for(var D=arguments.length,z=new Array(D>1?D-1:0),ne=1;ne<D;ne++)z[ne-1]=arguments[ne];return Vt.run("difference",fe,z)}};return Hi})},28660:function(Sr,oe,Z){/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ye;(function(se){(function(y){var de=typeof globalThis=="object"?globalThis:typeof Z.g=="object"?Z.g:typeof self=="object"?self:typeof this=="object"?this:ie(),V=ce(se);typeof de.Reflect!="undefined"&&(V=ce(de.Reflect,V)),y(V,de),typeof de.Reflect=="undefined"&&(de.Reflect=se);function ce(Ve,rt){return function(it,Ct){Object.defineProperty(Ve,it,{configurable:!0,writable:!0,value:Ct}),rt&&rt(it,Ct)}}function ae(){try{return Function("return this;")()}catch(Ve){}}function Be(){try{return(0,eval)("(function() { return this; })()")}catch(Ve){}}function ie(){return ae()||Be()}})(function(y,de){var V=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",ae=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Be=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ie=typeof Object.create=="function",Ve={__proto__:[]}instanceof Array,rt=!ie&&!Ve,it={create:ie?function(){return Hi(Object.create(null))}:Ve?function(){return Hi({__proto__:null})}:function(){return Hi({})},has:rt?function(fe,D){return V.call(fe,D)}:function(fe,D){return D in fe},get:rt?function(fe,D){return V.call(fe,D)?fe[D]:void 0}:function(fe,D){return fe[D]}},Ct=Object.getPrototypeOf(Function),Tt=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Gr(),Xt=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:an(),ir=typeof WeakMap=="function"?WeakMap:Zn(),Ft=ce?Symbol.for("@reflect-metadata:registry"):void 0,Rt=xs(),xt=bs(Rt);function Zr(fe,D,z,ne){if(ar(z)){if(!ea(fe))throw new TypeError;if(!kn(D))throw new TypeError;return Ne(fe,D)}else{if(!ea(fe))throw new TypeError;if(!nn(D))throw new TypeError;if(!nn(ne)&&!ar(ne)&&!Dn(ne))throw new TypeError;return Dn(ne)&&(ne=void 0),z=hi(z),k(fe,D,z,ne)}}y("decorate",Zr);function Tr(fe,D){function z(ne,Ae){if(!nn(ne))throw new TypeError;if(!ar(Ae)&&!Ea(Ae))throw new TypeError;kt(fe,D,ne,Ae)}return z}y("metadata",Tr);function dr(fe,D,z,ne){if(!nn(z))throw new TypeError;return ar(ne)||(ne=hi(ne)),kt(fe,D,z,ne)}y("defineMetadata",dr);function Mt(fe,D,z){if(!nn(D))throw new TypeError;return ar(z)||(z=hi(z)),ke(fe,D,z)}y("hasMetadata",Mt);function lt(fe,D,z){if(!nn(D))throw new TypeError;return ar(z)||(z=hi(z)),Re(fe,D,z)}y("hasOwnMetadata",lt);function Bt(fe,D,z){if(!nn(D))throw new TypeError;return ar(z)||(z=hi(z)),ct(fe,D,z)}y("getMetadata",Bt);function pt(fe,D,z){if(!nn(D))throw new TypeError;return ar(z)||(z=hi(z)),Et(fe,D,z)}y("getOwnMetadata",pt);function ur(fe,D){if(!nn(fe))throw new TypeError;return ar(D)||(D=hi(D)),er(fe,D)}y("getMetadataKeys",ur);function Ar(fe,D){if(!nn(fe))throw new TypeError;return ar(D)||(D=hi(D)),rr(fe,D)}y("getOwnMetadataKeys",Ar);function te(fe,D,z){if(!nn(D))throw new TypeError;if(ar(z)||(z=hi(z)),!nn(D))throw new TypeError;ar(z)||(z=hi(z));var ne=gr(D,z,!1);return ar(ne)?!1:ne.OrdinaryDeleteMetadata(fe,D,z)}y("deleteMetadata",te);function Ne(fe,D){for(var z=fe.length-1;z>=0;--z){var ne=fe[z],Ae=ne(D);if(!ar(Ae)&&!Dn(Ae)){if(!kn(Ae))throw new TypeError;D=Ae}}return D}function k(fe,D,z,ne){for(var Ae=fe.length-1;Ae>=0;--Ae){var De=fe[Ae],Zt=De(D,z,ne);if(!ar(Zt)&&!Dn(Zt)){if(!nn(Zt))throw new TypeError;ne=Zt}}return ne}function ke(fe,D,z){var ne=Re(fe,D,z);if(ne)return!0;var Ae=eo(D);return Dn(Ae)?!1:ke(fe,Ae,z)}function Re(fe,D,z){var ne=gr(D,z,!1);return ar(ne)?!1:En(ne.OrdinaryHasOwnMetadata(fe,D,z))}function ct(fe,D,z){var ne=Re(fe,D,z);if(ne)return Et(fe,D,z);var Ae=eo(D);if(!Dn(Ae))return ct(fe,Ae,z)}function Et(fe,D,z){var ne=gr(D,z,!1);if(!ar(ne))return ne.OrdinaryGetOwnMetadata(fe,D,z)}function kt(fe,D,z,ne){var Ae=gr(z,ne,!0);Ae.OrdinaryDefineOwnMetadata(fe,D,z,ne)}function er(fe,D){var z=rr(fe,D),ne=eo(fe);if(ne===null)return z;var Ae=er(ne,D);if(Ae.length<=0)return z;if(z.length<=0)return Ae;for(var De=new Xt,Zt=[],St=0,At=z;St<At.length;St++){var mt=At[St],U=De.has(mt);U||(De.add(mt),Zt.push(mt))}for(var F=0,X=Ae;F<X.length;F++){var mt=X[F],U=De.has(mt);U||(De.add(mt),Zt.push(mt))}return Zt}function rr(fe,D){var z=gr(fe,D,!1);return z?z.OrdinaryOwnMetadataKeys(fe,D):[]}function fn(fe){if(fe===null)return 1;switch(typeof fe){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return fe===null?1:6;default:return 6}}function ar(fe){return fe===void 0}function Dn(fe){return fe===null}function hn(fe){return typeof fe=="symbol"}function nn(fe){return typeof fe=="object"?fe!==null:typeof fe=="function"}function ri(fe,D){switch(fn(fe)){case 0:return fe;case 1:return fe;case 2:return fe;case 3:return fe;case 4:return fe;case 5:return fe}var z=D===3?"string":D===5?"number":"default",ne=ja(fe,ae);if(ne!==void 0){var Ae=ne.call(fe,z);if(nn(Ae))throw new TypeError;return Ae}return qn(fe,z==="default"?"number":z)}function qn(fe,D){if(D==="string"){var z=fe.toString;if(Tn(z)){var ne=z.call(fe);if(!nn(ne))return ne}var Ae=fe.valueOf;if(Tn(Ae)){var ne=Ae.call(fe);if(!nn(ne))return ne}}else{var Ae=fe.valueOf;if(Tn(Ae)){var ne=Ae.call(fe);if(!nn(ne))return ne}var De=fe.toString;if(Tn(De)){var ne=De.call(fe);if(!nn(ne))return ne}}throw new TypeError}function En(fe){return!!fe}function Ti(fe){return""+fe}function hi(fe){var D=ri(fe,3);return hn(D)?D:Ti(D)}function ea(fe){return Array.isArray?Array.isArray(fe):fe instanceof Object?fe instanceof Array:Object.prototype.toString.call(fe)==="[object Array]"}function Tn(fe){return typeof fe=="function"}function kn(fe){return typeof fe=="function"}function Ea(fe){switch(fn(fe)){case 3:return!0;case 4:return!0;default:return!1}}function ji(fe,D){return fe===D||fe!==fe&&D!==D}function ja(fe,D){var z=fe[D];if(z!=null){if(!Tn(z))throw new TypeError;return z}}function Ha(fe){var D=ja(fe,Be);if(!Tn(D))throw new TypeError;var z=D.call(fe);if(!nn(z))throw new TypeError;return z}function Me(fe){return fe.value}function Wa(fe){var D=fe.next();return D.done?!1:D}function sa(fe){var D=fe.return;D&&D.call(fe)}function eo(fe){var D=Object.getPrototypeOf(fe);if(typeof fe!="function"||fe===Ct||D!==Ct)return D;var z=fe.prototype,ne=z&&Object.getPrototypeOf(z);if(ne==null||ne===Object.prototype)return D;var Ae=ne.constructor;return typeof Ae!="function"||Ae===fe?D:Ae}function Ws(){var fe;!ar(Ft)&&typeof de.Reflect!="undefined"&&!(Ft in de.Reflect)&&typeof de.Reflect.defineMetadata=="function"&&(fe=Vt(de.Reflect));var D,z,ne,Ae=new ir,De={registerProvider:Zt,getProvider:At,setProvider:U};return De;function Zt(F){if(!Object.isExtensible(De))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case fe===F:break;case ar(D):D=F;break;case D===F:break;case ar(z):z=F;break;case z===F:break;default:ne===void 0&&(ne=new Xt),ne.add(F);break}}function St(F,X){if(!ar(D)){if(D.isProviderFor(F,X))return D;if(!ar(z)){if(z.isProviderFor(F,X))return D;if(!ar(ne))for(var ee=Ha(ne);;){var Se=Wa(ee);if(!Se)return;var Ue=Me(Se);if(Ue.isProviderFor(F,X))return sa(ee),Ue}}}if(!ar(fe)&&fe.isProviderFor(F,X))return fe}function At(F,X){var ee=Ae.get(F),Se;return ar(ee)||(Se=ee.get(X)),ar(Se)&&(Se=St(F,X),ar(Se)||(ar(ee)&&(ee=new Tt,Ae.set(F,ee)),ee.set(X,Se))),Se}function mt(F){if(ar(F))throw new TypeError;return D===F||z===F||!ar(ne)&&ne.has(F)}function U(F,X,ee){if(!mt(ee))throw new Error("Metadata provider not registered.");var Se=At(F,X);if(Se!==ee){if(!ar(Se))return!1;var Ue=Ae.get(F);ar(Ue)&&(Ue=new Tt,Ae.set(F,Ue)),Ue.set(X,ee)}return!0}}function xs(){var fe;return!ar(Ft)&&nn(de.Reflect)&&Object.isExtensible(de.Reflect)&&(fe=de.Reflect[Ft]),ar(fe)&&(fe=Ws()),!ar(Ft)&&nn(de.Reflect)&&Object.isExtensible(de.Reflect)&&Object.defineProperty(de.Reflect,Ft,{enumerable:!1,configurable:!1,writable:!1,value:fe}),fe}function bs(fe){var D=new ir,z={isProviderFor:function(mt,U){var F=D.get(mt);return ar(F)?!1:F.has(U)},OrdinaryDefineOwnMetadata:Zt,OrdinaryHasOwnMetadata:Ae,OrdinaryGetOwnMetadata:De,OrdinaryOwnMetadataKeys:St,OrdinaryDeleteMetadata:At};return Rt.registerProvider(z),z;function ne(mt,U,F){var X=D.get(mt),ee=!1;if(ar(X)){if(!F)return;X=new Tt,D.set(mt,X),ee=!0}var Se=X.get(U);if(ar(Se)){if(!F)return;if(Se=new Tt,X.set(U,Se),!fe.setProvider(mt,U,z))throw X.delete(U),ee&&D.delete(mt),new Error("Wrong provider for target.")}return Se}function Ae(mt,U,F){var X=ne(U,F,!1);return ar(X)?!1:En(X.has(mt))}function De(mt,U,F){var X=ne(U,F,!1);if(!ar(X))return X.get(mt)}function Zt(mt,U,F,X){var ee=ne(F,X,!0);ee.set(mt,U)}function St(mt,U){var F=[],X=ne(mt,U,!1);if(ar(X))return F;for(var ee=X.keys(),Se=Ha(ee),Ue=0;;){var Je=Wa(Se);if(!Je)return F.length=Ue,F;var he=Me(Je);try{F[Ue]=he}catch(K){try{sa(Se)}finally{throw K}}Ue++}}function At(mt,U,F){var X=ne(U,F,!1);if(ar(X)||!X.delete(mt))return!1;if(X.size===0){var ee=D.get(U);ar(ee)||(ee.delete(F),ee.size===0&&D.delete(ee))}return!0}}function Vt(fe){var D=fe.defineMetadata,z=fe.hasOwnMetadata,ne=fe.getOwnMetadata,Ae=fe.getOwnMetadataKeys,De=fe.deleteMetadata,Zt=new ir,St={isProviderFor:function(At,mt){var U=Zt.get(At);return ar(U)?Ae(At,mt).length?(ar(U)&&(U=new Xt,Zt.set(At,U)),U.add(mt),!0):!1:U.has(mt)},OrdinaryDefineOwnMetadata:D,OrdinaryHasOwnMetadata:z,OrdinaryGetOwnMetadata:ne,OrdinaryOwnMetadataKeys:Ae,OrdinaryDeleteMetadata:De};return St}function gr(fe,D,z){var ne=Rt.getProvider(fe,D);if(!ar(ne))return ne;if(z){if(Rt.setProvider(fe,D,xt))return xt;throw new Error("Illegal state.")}}function Gr(){var fe={},D=[],z=function(){function St(At,mt,U){this._index=0,this._keys=At,this._values=mt,this._selector=U}return St.prototype["@@iterator"]=function(){return this},St.prototype[Be]=function(){return this},St.prototype.next=function(){var At=this._index;if(At>=0&&At<this._keys.length){var mt=this._selector(this._keys[At],this._values[At]);return At+1>=this._keys.length?(this._index=-1,this._keys=D,this._values=D):this._index++,{value:mt,done:!1}}return{value:void 0,done:!0}},St.prototype.throw=function(At){throw this._index>=0&&(this._index=-1,this._keys=D,this._values=D),At},St.prototype.return=function(At){return this._index>=0&&(this._index=-1,this._keys=D,this._values=D),{value:At,done:!0}},St}(),ne=function(){function St(){this._keys=[],this._values=[],this._cacheKey=fe,this._cacheIndex=-2}return Object.defineProperty(St.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),St.prototype.has=function(At){return this._find(At,!1)>=0},St.prototype.get=function(At){var mt=this._find(At,!1);return mt>=0?this._values[mt]:void 0},St.prototype.set=function(At,mt){var U=this._find(At,!0);return this._values[U]=mt,this},St.prototype.delete=function(At){var mt=this._find(At,!1);if(mt>=0){for(var U=this._keys.length,F=mt+1;F<U;F++)this._keys[F-1]=this._keys[F],this._values[F-1]=this._values[F];return this._keys.length--,this._values.length--,ji(At,this._cacheKey)&&(this._cacheKey=fe,this._cacheIndex=-2),!0}return!1},St.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=fe,this._cacheIndex=-2},St.prototype.keys=function(){return new z(this._keys,this._values,Ae)},St.prototype.values=function(){return new z(this._keys,this._values,De)},St.prototype.entries=function(){return new z(this._keys,this._values,Zt)},St.prototype["@@iterator"]=function(){return this.entries()},St.prototype[Be]=function(){return this.entries()},St.prototype._find=function(At,mt){if(!ji(this._cacheKey,At)){this._cacheIndex=-1;for(var U=0;U<this._keys.length;U++)if(ji(this._keys[U],At)){this._cacheIndex=U;break}}return this._cacheIndex<0&&mt&&(this._cacheIndex=this._keys.length,this._keys.push(At),this._values.push(void 0)),this._cacheIndex},St}();return ne;function Ae(St,At){return St}function De(St,At){return At}function Zt(St,At){return[St,At]}}function an(){var fe=function(){function D(){this._map=new Tt}return Object.defineProperty(D.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),D.prototype.has=function(z){return this._map.has(z)},D.prototype.add=function(z){return this._map.set(z,z),this},D.prototype.delete=function(z){return this._map.delete(z)},D.prototype.clear=function(){this._map.clear()},D.prototype.keys=function(){return this._map.keys()},D.prototype.values=function(){return this._map.keys()},D.prototype.entries=function(){return this._map.entries()},D.prototype["@@iterator"]=function(){return this.keys()},D.prototype[Be]=function(){return this.keys()},D}();return fe}function Zn(){var fe=16,D=it.create(),z=ne();return function(){function At(){this._key=ne()}return At.prototype.has=function(mt){var U=Ae(mt,!1);return U!==void 0?it.has(U,this._key):!1},At.prototype.get=function(mt){var U=Ae(mt,!1);return U!==void 0?it.get(U,this._key):void 0},At.prototype.set=function(mt,U){var F=Ae(mt,!0);return F[this._key]=U,this},At.prototype.delete=function(mt){var U=Ae(mt,!1);return U!==void 0?delete U[this._key]:!1},At.prototype.clear=function(){this._key=ne()},At}();function ne(){var At;do At="@@WeakMap@@"+St();while(it.has(D,At));return D[At]=!0,At}function Ae(At,mt){if(!V.call(At,z)){if(!mt)return;Object.defineProperty(At,z,{value:it.create()})}return At[z]}function De(At,mt){for(var U=0;U<mt;++U)At[U]=Math.random()*255|0;return At}function Zt(At){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(At)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(At)):De(new Uint8Array(At),At):De(new Array(At),At)}function St(){var At=Zt(fe);At[6]=At[6]&79|64,At[8]=At[8]&191|128;for(var mt="",U=0;U<fe;++U){var F=At[U];(U===4||U===6||U===8)&&(mt+="-"),F<16&&(mt+="0"),mt+=F.toString(16).toLowerCase()}return mt}}function Hi(fe){return fe.__=void 0,delete fe.__,fe}})})(ye||(ye={}))},81550:function(Sr){(function(oe,Z){Sr.exports=Z()})(this,function(){"use strict";var oe=function(W){return W instanceof Uint8Array||W instanceof Uint16Array||W instanceof Uint32Array||W instanceof Int8Array||W instanceof Int16Array||W instanceof Int32Array||W instanceof Float32Array||W instanceof Float64Array||W instanceof Uint8ClampedArray},Z=function(W,Ce){for(var Ke=Object.keys(Ce),Yt=0;Yt<Ke.length;++Yt)W[Ke[Yt]]=Ce[Ke[Yt]];return W},ye=`
`;function se(W){return typeof atob!="undefined"?atob(W):"base64:"+W}function y(W){var Ce=new Error("(regl) "+W);throw console.error(Ce),Ce}function de(W,Ce){W||y(Ce)}function V(W){return W?": "+W:""}function ce(W,Ce,Ke){W in Ce||y("unknown parameter ("+W+")"+V(Ke)+". possible values: "+Object.keys(Ce).join())}function ae(W,Ce){oe(W)||y("invalid parameter type"+V(Ce)+". must be a typed array")}function Be(W,Ce){switch(Ce){case"number":return typeof W=="number";case"object":return typeof W=="object";case"string":return typeof W=="string";case"boolean":return typeof W=="boolean";case"function":return typeof W=="function";case"undefined":return typeof W=="undefined";case"symbol":return typeof W=="symbol"}}function ie(W,Ce,Ke){Be(W,Ce)||y("invalid parameter type"+V(Ke)+". expected "+Ce+", got "+typeof W)}function Ve(W,Ce){W>=0&&(W|0)===W||y("invalid parameter type, ("+W+")"+V(Ce)+". must be a nonnegative integer")}function rt(W,Ce,Ke){Ce.indexOf(W)<0&&y("invalid value"+V(Ke)+". must be one of: "+Ce)}var it=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Ct(W){Object.keys(W).forEach(function(Ce){it.indexOf(Ce)<0&&y('invalid regl constructor argument "'+Ce+'". must be one of '+it)})}function Tt(W,Ce){for(W=W+"";W.length<Ce;)W=" "+W;return W}function Xt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ir(W,Ce){this.number=W,this.line=Ce,this.errors=[]}function Ft(W,Ce,Ke){this.file=W,this.line=Ce,this.message=Ke}function Rt(){var W=new Error,Ce=(W.stack||W).toString(),Ke=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Ce);if(Ke)return Ke[1];var Yt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Ce);return Yt?Yt[1]:"unknown"}function xt(){var W=new Error,Ce=(W.stack||W).toString(),Ke=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Ce);if(Ke)return Ke[1];var Yt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Ce);return Yt?Yt[1]:"unknown"}function Zr(W,Ce){var Ke=W.split(`
`),Yt=1,pr=0,Qt={unknown:new Xt,0:new Xt};Qt.unknown.name=Qt[0].name=Ce||Rt(),Qt.unknown.lines.push(new ir(0,""));for(var zt=0;zt<Ke.length;++zt){var Fr=Ke[zt],Ir=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Fr);if(Ir)switch(Ir[1]){case"line":var Yr=/(\d+)(\s+\d+)?/.exec(Ir[2]);Yr&&(Yt=Yr[1]|0,Yr[2]&&(pr=Yr[2]|0,pr in Qt||(Qt[pr]=new Xt)));break;case"define":var Ur=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Ir[2]);Ur&&(Qt[pr].name=Ur[1]?se(Ur[2]):Ur[2]);break}Qt[pr].lines.push(new ir(Yt++,Fr))}return Object.keys(Qt).forEach(function(Wr){var Qr=Qt[Wr];Qr.lines.forEach(function(Or){Qr.index[Or.number]=Or})}),Qt}function Tr(W){var Ce=[];return W.split(`
`).forEach(function(Ke){if(!(Ke.length<5)){var Yt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ke);Yt?Ce.push(new Ft(Yt[1]|0,Yt[2]|0,Yt[3].trim())):Ke.length>0&&Ce.push(new Ft("unknown",0,Ke))}}),Ce}function dr(W,Ce){Ce.forEach(function(Ke){var Yt=W[Ke.file];if(Yt){var pr=Yt.index[Ke.line];if(pr){pr.errors.push(Ke),Yt.hasErrors=!0;return}}W.unknown.hasErrors=!0,W.unknown.lines[0].errors.push(Ke)})}function Mt(W,Ce,Ke,Yt,pr){if(!W.getShaderParameter(Ce,W.COMPILE_STATUS)){var Qt=W.getShaderInfoLog(Ce),zt=Yt===W.FRAGMENT_SHADER?"fragment":"vertex";Ne(Ke,"string",zt+" shader source must be a string",pr);var Fr=Zr(Ke,pr),Ir=Tr(Qt);dr(Fr,Ir),Object.keys(Fr).forEach(function(Yr){var Ur=Fr[Yr];if(!Ur.hasErrors)return;var Wr=[""],Qr=[""];function Or(Xr,It){Wr.push(Xr),Qr.push(It||"")}Or("file number "+Yr+": "+Ur.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Ur.lines.forEach(function(Xr){if(Xr.errors.length>0){Or(Tt(Xr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Or(Xr.line+ye,"color:red; background-color:yellow; font-weight:bold");var It=0;Xr.errors.forEach(function(sr){var zr=sr.message,cn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(zr);if(cn){var Er=cn[1];switch(zr=cn[2],Er){case"assign":Er="=";break}It=Math.max(Xr.line.indexOf(Er,It),0)}else It=0;Or(Tt("| ",6)),Or(Tt("^^^",It+3)+ye,"font-weight:bold"),Or(Tt("| ",6)),Or(zr+ye,"font-weight:bold")}),Or(Tt("| ",6)+ye)}else Or(Tt(Xr.number,4)+"|  "),Or(Xr.line+ye,"color:red")}),typeof document!="undefined"&&!window.chrome?(Qr[0]=Wr.join("%c"),console.log.apply(console,Qr)):console.log(Wr.join(""))}),de.raise("Error compiling "+zt+" shader, "+Fr[0].name)}}function lt(W,Ce,Ke,Yt,pr){if(!W.getProgramParameter(Ce,W.LINK_STATUS)){var Qt=W.getProgramInfoLog(Ce),zt=Zr(Ke,pr),Fr=Zr(Yt,pr),Ir='Error linking program with vertex shader, "'+Fr[0].name+'", and fragment shader "'+zt[0].name+'"';typeof document!="undefined"?console.log("%c"+Ir+ye+"%c"+Qt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Ir+ye+Qt),de.raise(Ir)}}function Bt(W){W._commandRef=Rt()}function pt(W,Ce,Ke,Yt){Bt(W);function pr(Ir){return Ir?Yt.id(Ir):0}W._fragId=pr(W.static.frag),W._vertId=pr(W.static.vert);function Qt(Ir,Yr){Object.keys(Yr).forEach(function(Ur){Ir[Yt.id(Ur)]=!0})}var zt=W._uniformSet={};Qt(zt,Ce.static),Qt(zt,Ce.dynamic);var Fr=W._attributeSet={};Qt(Fr,Ke.static),Qt(Fr,Ke.dynamic),W._hasCount="count"in W.static||"count"in W.dynamic||"elements"in W.static||"elements"in W.dynamic}function ur(W,Ce){var Ke=xt();y(W+" in command "+(Ce||Rt())+(Ke==="unknown"?"":" called from "+Ke))}function Ar(W,Ce,Ke){W||ur(Ce,Ke||Rt())}function te(W,Ce,Ke,Yt){W in Ce||ur("unknown parameter ("+W+")"+V(Ke)+". possible values: "+Object.keys(Ce).join(),Yt||Rt())}function Ne(W,Ce,Ke,Yt){Be(W,Ce)||ur("invalid parameter type"+V(Ke)+". expected "+Ce+", got "+typeof W,Yt||Rt())}function k(W){W()}function ke(W,Ce,Ke){W.texture?rt(W.texture._texture.internalformat,Ce,"unsupported texture format for attachment"):rt(W.renderbuffer._renderbuffer.format,Ke,"unsupported renderbuffer format for attachment")}var Re=33071,ct=9728,Et=9984,kt=9985,er=9986,rr=9987,fn=5120,ar=5121,Dn=5122,hn=5123,nn=5124,ri=5125,qn=5126,En=32819,Ti=32820,hi=33635,ea=34042,Tn=36193,kn={};kn[fn]=kn[ar]=1,kn[Dn]=kn[hn]=kn[Tn]=kn[hi]=kn[En]=kn[Ti]=2,kn[nn]=kn[ri]=kn[qn]=kn[ea]=4;function Ea(W,Ce){return W===Ti||W===En||W===hi?2:W===ea?4:kn[W]*Ce}function ji(W){return!(W&W-1)&&!!W}function ja(W,Ce,Ke){var Yt,pr=Ce.width,Qt=Ce.height,zt=Ce.channels;de(pr>0&&pr<=Ke.maxTextureSize&&Qt>0&&Qt<=Ke.maxTextureSize,"invalid texture shape"),(W.wrapS!==Re||W.wrapT!==Re)&&de(ji(pr)&&ji(Qt),"incompatible wrap mode for texture, both width and height must be power of 2"),Ce.mipmask===1?pr!==1&&Qt!==1&&de(W.minFilter!==Et&&W.minFilter!==er&&W.minFilter!==kt&&W.minFilter!==rr,"min filter requires mipmap"):(de(ji(pr)&&ji(Qt),"texture must be a square power of 2 to support mipmapping"),de(Ce.mipmask===(pr<<1)-1,"missing or incomplete mipmap data")),Ce.type===qn&&(Ke.extensions.indexOf("oes_texture_float_linear")<0&&de(W.minFilter===ct&&W.magFilter===ct,"filter not supported, must enable oes_texture_float_linear"),de(!W.genMipmaps,"mipmap generation not supported with float textures"));var Fr=Ce.images;for(Yt=0;Yt<16;++Yt)if(Fr[Yt]){var Ir=pr>>Yt,Yr=Qt>>Yt;de(Ce.mipmask&1<<Yt,"missing mipmap data");var Ur=Fr[Yt];if(de(Ur.width===Ir&&Ur.height===Yr,"invalid shape for mip images"),de(Ur.format===Ce.format&&Ur.internalformat===Ce.internalformat&&Ur.type===Ce.type,"incompatible type for mip image"),!Ur.compressed)if(Ur.data){var Wr=Math.ceil(Ea(Ur.type,zt)*Ir/Ur.unpackAlignment)*Ur.unpackAlignment;de(Ur.data.byteLength===Wr*Yr,"invalid data for image, buffer size is inconsistent with image format")}else Ur.element||Ur.copy}else W.genMipmaps||de((Ce.mipmask&1<<Yt)==0,"extra mipmap data");Ce.compressed&&de(!W.genMipmaps,"mipmap generation for compressed images not supported")}function Ha(W,Ce,Ke,Yt){var pr=W.width,Qt=W.height,zt=W.channels;de(pr>0&&pr<=Yt.maxTextureSize&&Qt>0&&Qt<=Yt.maxTextureSize,"invalid texture shape"),de(pr===Qt,"cube map must be square"),de(Ce.wrapS===Re&&Ce.wrapT===Re,"wrap mode not supported by cube map");for(var Fr=0;Fr<Ke.length;++Fr){var Ir=Ke[Fr];de(Ir.width===pr&&Ir.height===Qt,"inconsistent cube map face shape"),Ce.genMipmaps&&(de(!Ir.compressed,"can not generate mipmap for compressed textures"),de(Ir.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Yr=Ir.images,Ur=0;Ur<16;++Ur){var Wr=Yr[Ur];if(Wr){var Qr=pr>>Ur,Or=Qt>>Ur;de(Ir.mipmask&1<<Ur,"missing mipmap data"),de(Wr.width===Qr&&Wr.height===Or,"invalid shape for mip images"),de(Wr.format===W.format&&Wr.internalformat===W.internalformat&&Wr.type===W.type,"incompatible type for mip image"),Wr.compressed||(Wr.data?de(Wr.data.byteLength===Qr*Or*Math.max(Ea(Wr.type,zt),Wr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Wr.element||Wr.copy)}}}}var Me=Z(de,{optional:k,raise:y,commandRaise:ur,command:Ar,parameter:ce,commandParameter:te,constructor:Ct,type:ie,commandType:Ne,isTypedArray:ae,nni:Ve,oneOf:rt,shaderError:Mt,linkError:lt,callSite:xt,saveCommandRef:Bt,saveDrawInfo:pt,framebufferFormat:ke,guessCommand:Rt,texture2D:ja,textureCube:Ha}),Wa=0,sa=0;function eo(W,Ce){this.id=Wa++,this.type=W,this.data=Ce}function Ws(W){return W.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function xs(W){if(W.length===0)return[];var Ce=W.charAt(0),Ke=W.charAt(W.length-1);if(W.length>1&&Ce===Ke&&(Ce==='"'||Ce==="'"))return['"'+Ws(W.substr(1,W.length-2))+'"'];var Yt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(W);if(Yt)return xs(W.substr(0,Yt.index)).concat(xs(Yt[1])).concat(xs(W.substr(Yt.index+Yt[0].length)));var pr=W.split(".");if(pr.length===1)return['"'+Ws(W)+'"'];for(var Qt=[],zt=0;zt<pr.length;++zt)Qt=Qt.concat(xs(pr[zt]));return Qt}function bs(W){return"["+xs(W).join("][")+"]"}function Vt(W,Ce){return new eo(W,bs(Ce+""))}function gr(W){return typeof W=="function"&&!W._reglType||W instanceof eo}function Gr(W,Ce){return typeof W=="function"?new eo(sa,W):W}var an={DynamicVariable:eo,define:Vt,isDynamic:gr,unbox:Gr,accessor:bs},Zn={next:typeof requestAnimationFrame=="function"?function(W){return requestAnimationFrame(W)}:function(W){return setTimeout(W,16)},cancel:typeof cancelAnimationFrame=="function"?function(W){return cancelAnimationFrame(W)}:clearTimeout},Hi=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function fe(){var W={"":0},Ce=[""];return{id:function(Ke){var Yt=W[Ke];return Yt||(Yt=W[Ke]=Ce.length,Ce.push(Ke),Yt)},str:function(Ke){return Ce[Ke]}}}function D(W,Ce,Ke){var Yt=document.createElement("canvas");Z(Yt.style,{border:0,margin:0,padding:0,top:0,left:0}),W.appendChild(Yt),W===document.body&&(Yt.style.position="absolute",Z(W.style,{margin:0,padding:0}));function pr(){var Fr=window.innerWidth,Ir=window.innerHeight;if(W!==document.body){var Yr=W.getBoundingClientRect();Fr=Yr.right-Yr.left,Ir=Yr.bottom-Yr.top}Yt.width=Ke*Fr,Yt.height=Ke*Ir,Z(Yt.style,{width:Fr+"px",height:Ir+"px"})}var Qt;W!==document.body&&typeof ResizeObserver=="function"?(Qt=new ResizeObserver(function(){setTimeout(pr)}),Qt.observe(W)):window.addEventListener("resize",pr,!1);function zt(){Qt?Qt.disconnect():window.removeEventListener("resize",pr),W.removeChild(Yt)}return pr(),{canvas:Yt,onDestroy:zt}}function z(W,Ce){function Ke(Yt){try{return W.getContext(Yt,Ce)}catch(pr){return null}}return Ke("webgl")||Ke("experimental-webgl")||Ke("webgl-experimental")}function ne(W){return typeof W.nodeName=="string"&&typeof W.appendChild=="function"&&typeof W.getBoundingClientRect=="function"}function Ae(W){return typeof W.drawArrays=="function"||typeof W.drawElements=="function"}function De(W){return typeof W=="string"?W.split():(Me(Array.isArray(W),"invalid extension array"),W)}function Zt(W){return typeof W=="string"?(Me(typeof document!="undefined","not supported outside of DOM"),document.querySelector(W)):W}function St(W){var Ce=W||{},Ke,Yt,pr,Qt,zt={},Fr=[],Ir=[],Yr=typeof window=="undefined"?1:window.devicePixelRatio,Ur=!1,Wr=function(Xr){Xr&&Me.raise(Xr)},Qr=function(){};if(typeof Ce=="string"?(Me(typeof document!="undefined","selector queries only supported in DOM enviroments"),Ke=document.querySelector(Ce),Me(Ke,"invalid query string for element")):typeof Ce=="object"?ne(Ce)?Ke=Ce:Ae(Ce)?(Qt=Ce,pr=Qt.canvas):(Me.constructor(Ce),"gl"in Ce?Qt=Ce.gl:"canvas"in Ce?pr=Zt(Ce.canvas):"container"in Ce&&(Yt=Zt(Ce.container)),"attributes"in Ce&&(zt=Ce.attributes,Me.type(zt,"object","invalid context attributes")),"extensions"in Ce&&(Fr=De(Ce.extensions)),"optionalExtensions"in Ce&&(Ir=De(Ce.optionalExtensions)),"onDone"in Ce&&(Me.type(Ce.onDone,"function","invalid or missing onDone callback"),Wr=Ce.onDone),"profile"in Ce&&(Ur=!!Ce.profile),"pixelRatio"in Ce&&(Yr=+Ce.pixelRatio,Me(Yr>0,"invalid pixel ratio"))):Me.raise("invalid arguments to regl"),Ke&&(Ke.nodeName.toLowerCase()==="canvas"?pr=Ke:Yt=Ke),!Qt){if(!pr){Me(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Or=D(Yt||document.body,Wr,Yr);if(!Or)return null;pr=Or.canvas,Qr=Or.onDestroy}zt.premultipliedAlpha===void 0&&(zt.premultipliedAlpha=!0),Qt=z(pr,zt)}return Qt?{gl:Qt,canvas:pr,container:Yt,extensions:Fr,optionalExtensions:Ir,pixelRatio:Yr,profile:Ur,onDone:Wr,onDestroy:Qr}:(Qr(),Wr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function At(W,Ce){var Ke={};function Yt(zt){Me.type(zt,"string","extension name must be string");var Fr=zt.toLowerCase(),Ir;try{Ir=Ke[Fr]=W.getExtension(Fr)}catch(Yr){}return!!Ir}for(var pr=0;pr<Ce.extensions.length;++pr){var Qt=Ce.extensions[pr];if(!Yt(Qt))return Ce.onDestroy(),Ce.onDone('"'+Qt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Ce.optionalExtensions.forEach(Yt),{extensions:Ke,restore:function(){Object.keys(Ke).forEach(function(zt){if(Ke[zt]&&!Yt(zt))throw new Error("(regl): error restoring extension "+zt)})}}}function mt(W,Ce){for(var Ke=Array(W),Yt=0;Yt<W;++Yt)Ke[Yt]=Ce(Yt);return Ke}var U=5120,F=5121,X=5122,ee=5123,Se=5124,Ue=5125,Je=5126;function he(W){for(var Ce=16;Ce<=1<<28;Ce*=16)if(W<=Ce)return Ce;return 0}function K(W){var Ce,Ke;return Ce=(W>65535)<<4,W>>>=Ce,Ke=(W>255)<<3,W>>>=Ke,Ce|=Ke,Ke=(W>15)<<2,W>>>=Ke,Ce|=Ke,Ke=(W>3)<<1,W>>>=Ke,Ce|=Ke,Ce|W>>1}function ge(){var W=mt(8,function(){return[]});function Ce(Qt){var zt=he(Qt),Fr=W[K(zt)>>2];return Fr.length>0?Fr.pop():new ArrayBuffer(zt)}function Ke(Qt){W[K(Qt.byteLength)>>2].push(Qt)}function Yt(Qt,zt){var Fr=null;switch(Qt){case U:Fr=new Int8Array(Ce(zt),0,zt);break;case F:Fr=new Uint8Array(Ce(zt),0,zt);break;case X:Fr=new Int16Array(Ce(2*zt),0,zt);break;case ee:Fr=new Uint16Array(Ce(2*zt),0,zt);break;case Se:Fr=new Int32Array(Ce(4*zt),0,zt);break;case Ue:Fr=new Uint32Array(Ce(4*zt),0,zt);break;case Je:Fr=new Float32Array(Ce(4*zt),0,zt);break;default:return null}return Fr.length!==zt?Fr.subarray(0,zt):Fr}function pr(Qt){Ke(Qt.buffer)}return{alloc:Ce,free:Ke,allocType:Yt,freeType:pr}}var Qe=ge();Qe.zero=ge();var gt=3408,pe=3410,vr=3411,en=3412,tn=3413,Kt=3414,$r=3415,Br=33901,jr=33902,ni=3379,on=3386,di=34921,Fi=36347,mi=36348,Ci=35661,Ri=35660,bo=34930,Ki=36349,Sa=34076,Mi=34024,gi=7936,Ei=7937,wa=7938,Gs=35724,fa=34047,Ca=36063,Ju=34852,iu=3553,_a=34067,os=34069,li=33984,ia=6408,Ra=5126,aa=5121,$o=36160,Vo=36053,Du=36064,ws=16384,mc=function(W,Ce){var Ke=1;Ce.ext_texture_filter_anisotropic&&(Ke=W.getParameter(fa));var Yt=1,pr=1;Ce.webgl_draw_buffers&&(Yt=W.getParameter(Ju),pr=W.getParameter(Ca));var Qt=!!Ce.oes_texture_float;if(Qt){var zt=W.createTexture();W.bindTexture(iu,zt),W.texImage2D(iu,0,ia,1,1,0,ia,Ra,null);var Fr=W.createFramebuffer();if(W.bindFramebuffer($o,Fr),W.framebufferTexture2D($o,Du,iu,zt,0),W.bindTexture(iu,null),W.checkFramebufferStatus($o)!==Vo)Qt=!1;else{W.viewport(0,0,1,1),W.clearColor(1,0,0,1),W.clear(ws);var Ir=Qe.allocType(Ra,4);W.readPixels(0,0,1,1,ia,Ra,Ir),W.getError()?Qt=!1:(W.deleteFramebuffer(Fr),W.deleteTexture(zt),Qt=Ir[0]===1),Qe.freeType(Ir)}}var Yr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Ur=!0;if(!Yr){var Wr=W.createTexture(),Qr=Qe.allocType(aa,36);W.activeTexture(li),W.bindTexture(_a,Wr),W.texImage2D(os,0,ia,3,3,0,ia,aa,Qr),Qe.freeType(Qr),W.bindTexture(_a,null),W.deleteTexture(Wr),Ur=!W.getError()}return{colorBits:[W.getParameter(pe),W.getParameter(vr),W.getParameter(en),W.getParameter(tn)],depthBits:W.getParameter(Kt),stencilBits:W.getParameter($r),subpixelBits:W.getParameter(gt),extensions:Object.keys(Ce).filter(function(Or){return!!Ce[Or]}),maxAnisotropic:Ke,maxDrawbuffers:Yt,maxColorAttachments:pr,pointSizeDims:W.getParameter(Br),lineWidthDims:W.getParameter(jr),maxViewportDims:W.getParameter(on),maxCombinedTextureUnits:W.getParameter(Ci),maxCubeMapSize:W.getParameter(Sa),maxRenderbufferSize:W.getParameter(Mi),maxTextureUnits:W.getParameter(bo),maxTextureSize:W.getParameter(ni),maxAttributes:W.getParameter(di),maxVertexUniforms:W.getParameter(Fi),maxVertexTextureUnits:W.getParameter(Ri),maxVaryingVectors:W.getParameter(mi),maxFragmentUniforms:W.getParameter(Ki),glsl:W.getParameter(Gs),renderer:W.getParameter(Ei),vendor:W.getParameter(gi),version:W.getParameter(wa),readFloat:Qt,npotTextureCube:Ur}};function Da(W){return!!W&&typeof W=="object"&&Array.isArray(W.shape)&&Array.isArray(W.stride)&&typeof W.offset=="number"&&W.shape.length===W.stride.length&&(Array.isArray(W.data)||oe(W.data))}var zi=function(W){return Object.keys(W).map(function(Ce){return W[Ce]})},jo={shape:Kr,flatten:lr};function Gt(W,Ce,Ke){for(var Yt=0;Yt<Ce;++Yt)Ke[Yt]=W[Yt]}function re(W,Ce,Ke,Yt){for(var pr=0,Qt=0;Qt<Ce;++Qt)for(var zt=W[Qt],Fr=0;Fr<Ke;++Fr)Yt[pr++]=zt[Fr]}function Oe(W,Ce,Ke,Yt,pr,Qt){for(var zt=Qt,Fr=0;Fr<Ce;++Fr)for(var Ir=W[Fr],Yr=0;Yr<Ke;++Yr)for(var Ur=Ir[Yr],Wr=0;Wr<Yt;++Wr)pr[zt++]=Ur[Wr]}function dt(W,Ce,Ke,Yt,pr){for(var Qt=1,zt=Ke+1;zt<Ce.length;++zt)Qt*=Ce[zt];var Fr=Ce[Ke];if(Ce.length-Ke==4){var Ir=Ce[Ke+1],Yr=Ce[Ke+2],Ur=Ce[Ke+3];for(zt=0;zt<Fr;++zt)Oe(W[zt],Ir,Yr,Ur,Yt,pr),pr+=Qt}else for(zt=0;zt<Fr;++zt)dt(W[zt],Ce,Ke+1,Yt,pr),pr+=Qt}function lr(W,Ce,Ke,Yt){var pr=1;if(Ce.length)for(var Qt=0;Qt<Ce.length;++Qt)pr*=Ce[Qt];else pr=0;var zt=Yt||Qe.allocType(Ke,pr);switch(Ce.length){case 0:break;case 1:Gt(W,Ce[0],zt);break;case 2:re(W,Ce[0],Ce[1],zt);break;case 3:Oe(W,Ce[0],Ce[1],Ce[2],zt,0);break;default:dt(W,Ce,0,zt,0)}return zt}function Kr(W){for(var Ce=[],Ke=W;Ke.length;Ke=Ke[0])Ce.push(Ke.length);return Ce}var Pn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Zi=5120,lo=5122,Eo=5124,ao=5121,Cs=5123,Zc=5125,au=5126,_f=5126,Ho={int8:Zi,int16:lo,int32:Eo,uint8:ao,uint16:Cs,uint32:Zc,float:au,float32:_f},Al=35048,Tl=35040,Lu={dynamic:Al,stream:Tl,static:35044},Bu=jo.flatten,el=jo.shape,Vc=35044,Rs=35040,Ga=5121,wl=5126,tl=[];tl[5120]=1,tl[5122]=2,tl[5124]=4,tl[5121]=1,tl[5123]=2,tl[5125]=4,tl[5126]=4;function yf(W){return Pn[Object.prototype.toString.call(W)]|0}function jh(W,Ce){for(var Ke=0;Ke<Ce.length;++Ke)W[Ke]=Ce[Ke]}function xf(W,Ce,Ke,Yt,pr,Qt,zt){for(var Fr=0,Ir=0;Ir<Ke;++Ir)for(var Yr=0;Yr<Yt;++Yr)W[Fr++]=Ce[pr*Ir+Qt*Yr+zt]}function nh(W,Ce,Ke,Yt){var pr=0,Qt={};function zt(It){this.id=pr++,this.buffer=W.createBuffer(),this.type=It,this.usage=Vc,this.byteLength=0,this.dimension=1,this.dtype=Ga,this.persistentData=null,Ke.profile&&(this.stats={size:0})}zt.prototype.bind=function(){W.bindBuffer(this.type,this.buffer)},zt.prototype.destroy=function(){Qr(this)};var Fr=[];function Ir(It,sr){var zr=Fr.pop();return zr||(zr=new zt(It)),zr.bind(),Wr(zr,sr,Rs,0,1,!1),zr}function Yr(It){Fr.push(It)}function Ur(It,sr,zr){It.byteLength=sr.byteLength,W.bufferData(It.type,sr,zr)}function Wr(It,sr,zr,cn,Er,vn){var kr;if(It.usage=zr,Array.isArray(sr)){if(It.dtype=cn||wl,sr.length>0){var pn;if(Array.isArray(sr[0])){kr=el(sr);for(var br=1,un=1;un<kr.length;++un)br*=kr[un];It.dimension=br,pn=Bu(sr,kr,It.dtype),Ur(It,pn,zr),vn?It.persistentData=pn:Qe.freeType(pn)}else if(typeof sr[0]=="number"){It.dimension=Er;var jn=Qe.allocType(It.dtype,sr.length);jh(jn,sr),Ur(It,jn,zr),vn?It.persistentData=jn:Qe.freeType(jn)}else oe(sr[0])?(It.dimension=sr[0].length,It.dtype=cn||yf(sr[0])||wl,pn=Bu(sr,[sr.length,sr[0].length],It.dtype),Ur(It,pn,zr),vn?It.persistentData=pn:Qe.freeType(pn)):Me.raise("invalid buffer data")}}else if(oe(sr))It.dtype=cn||yf(sr),It.dimension=Er,Ur(It,sr,zr),vn&&(It.persistentData=new Uint8Array(new Uint8Array(sr.buffer)));else if(Da(sr)){kr=sr.shape;var ai=sr.stride,rn=sr.offset,Lr=0,_r=0,Jt=0,Si=0;kr.length===1?(Lr=kr[0],_r=1,Jt=ai[0],Si=0):kr.length===2?(Lr=kr[0],_r=kr[1],Jt=ai[0],Si=ai[1]):Me.raise("invalid shape"),It.dtype=cn||yf(sr.data)||wl,It.dimension=_r;var Ye=Qe.allocType(It.dtype,Lr*_r);xf(Ye,sr.data,Lr,_r,Jt,Si,rn),Ur(It,Ye,zr),vn?It.persistentData=Ye:Qe.freeType(Ye)}else sr instanceof ArrayBuffer?(It.dtype=Ga,It.dimension=Er,Ur(It,sr,zr),vn&&(It.persistentData=new Uint8Array(new Uint8Array(sr)))):Me.raise("invalid buffer data")}function Qr(It){Ce.bufferCount--,Yt(It);var sr=It.buffer;Me(sr,"buffer must not be deleted already"),W.deleteBuffer(sr),It.buffer=null,delete Qt[It.id]}function Or(It,sr,zr,cn){Ce.bufferCount++;var Er=new zt(sr);Qt[Er.id]=Er;function vn(br){var un=Vc,jn=null,ai=0,rn=0,Lr=1;return Array.isArray(br)||oe(br)||Da(br)||br instanceof ArrayBuffer?jn=br:typeof br=="number"?ai=br|0:br&&(Me.type(br,"object","buffer arguments must be an object, a number or an array"),"data"in br&&(Me(jn===null||Array.isArray(jn)||oe(jn)||Da(jn),"invalid data for buffer"),jn=br.data),"usage"in br&&(Me.parameter(br.usage,Lu,"invalid buffer usage"),un=Lu[br.usage]),"type"in br&&(Me.parameter(br.type,Ho,"invalid buffer type"),rn=Ho[br.type]),"dimension"in br&&(Me.type(br.dimension,"number","invalid dimension"),Lr=br.dimension|0),"length"in br&&(Me.nni(ai,"buffer length must be a nonnegative integer"),ai=br.length|0)),Er.bind(),jn?Wr(Er,jn,un,rn,Lr,cn):(ai&&W.bufferData(Er.type,ai,un),Er.dtype=rn||Ga,Er.usage=un,Er.dimension=Lr,Er.byteLength=ai),Ke.profile&&(Er.stats.size=Er.byteLength*tl[Er.dtype]),vn}function kr(br,un){Me(un+br.byteLength<=Er.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+br.byteLength+" starting from offset "+un+" to a buffer of size "+Er.byteLength),W.bufferSubData(Er.type,un,br)}function pn(br,un){var jn=(un||0)|0,ai;if(Er.bind(),oe(br)||br instanceof ArrayBuffer)kr(br,jn);else if(Array.isArray(br)){if(br.length>0)if(typeof br[0]=="number"){var rn=Qe.allocType(Er.dtype,br.length);jh(rn,br),kr(rn,jn),Qe.freeType(rn)}else if(Array.isArray(br[0])||oe(br[0])){ai=el(br);var Lr=Bu(br,ai,Er.dtype);kr(Lr,jn),Qe.freeType(Lr)}else Me.raise("invalid buffer data")}else if(Da(br)){ai=br.shape;var _r=br.stride,Jt=0,Si=0,Ye=0,xi=0;ai.length===1?(Jt=ai[0],Si=1,Ye=_r[0],xi=0):ai.length===2?(Jt=ai[0],Si=ai[1],Ye=_r[0],xi=_r[1]):Me.raise("invalid shape");var ui=Array.isArray(br.data)?Er.dtype:yf(br.data),Kn=Qe.allocType(ui,Jt*Si);xf(Kn,br.data,Jt,Si,Ye,xi,br.offset),kr(Kn,jn),Qe.freeType(Kn)}else Me.raise("invalid data for buffer subdata");return vn}return zr||vn(It),vn._reglType="buffer",vn._buffer=Er,vn.subdata=pn,Ke.profile&&(vn.stats=Er.stats),vn.destroy=function(){Qr(Er)},vn}function Xr(){zi(Qt).forEach(function(It){It.buffer=W.createBuffer(),W.bindBuffer(It.type,It.buffer),W.bufferData(It.type,It.persistentData||It.byteLength,It.usage)})}return Ke.profile&&(Ce.getTotalBufferSize=function(){var It=0;return Object.keys(Qt).forEach(function(sr){It+=Qt[sr].stats.size}),It}),{create:Or,createStream:Ir,destroyStream:Yr,clear:function(){zi(Qt).forEach(Qr),Fr.forEach(Qr)},getBuffer:function(It){return It&&It._buffer instanceof zt?It._buffer:null},restore:Xr,_initBuffer:Wr}}var ih=0,ah=0,Hh=1,Wh=1,Np=4,jc=4,Fu={points:ih,point:ah,lines:Hh,line:Wh,triangles:Np,triangle:jc,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Gh=0,Wo=1,Hl=4,Cl=5120,Xs=5121,Rl=5122,ou=5123,vi=5124,$s=5125,Nu=34963,rl=35040,oh=35044;function Xh(W,Ce,Ke,Yt){var pr={},Qt=0,zt={uint8:Xs,uint16:ou};Ce.oes_element_index_uint&&(zt.uint32=$s);function Fr(Xr){this.id=Qt++,pr[this.id]=this,this.buffer=Xr,this.primType=Hl,this.vertCount=0,this.type=0}Fr.prototype.bind=function(){this.buffer.bind()};var Ir=[];function Yr(Xr){var It=Ir.pop();return It||(It=new Fr(Ke.create(null,Nu,!0,!1)._buffer)),Wr(It,Xr,rl,-1,-1,0,0),It}function Ur(Xr){Ir.push(Xr)}function Wr(Xr,It,sr,zr,cn,Er,vn){Xr.buffer.bind();var kr;if(It){var pn=vn;!vn&&(!oe(It)||Da(It)&&!oe(It.data))&&(pn=Ce.oes_element_index_uint?$s:ou),Ke._initBuffer(Xr.buffer,It,sr,pn,3)}else W.bufferData(Nu,Er,sr),Xr.buffer.dtype=kr||Xs,Xr.buffer.usage=sr,Xr.buffer.dimension=3,Xr.buffer.byteLength=Er;if(kr=vn,!vn){switch(Xr.buffer.dtype){case Xs:case Cl:kr=Xs;break;case ou:case Rl:kr=ou;break;case $s:case vi:kr=$s;break;default:Me.raise("unsupported type for element array")}Xr.buffer.dtype=kr}Xr.type=kr,Me(kr!==$s||!!Ce.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var br=cn;br<0&&(br=Xr.buffer.byteLength,kr===ou?br>>=1:kr===$s&&(br>>=2)),Xr.vertCount=br;var un=zr;if(zr<0){un=Hl;var jn=Xr.buffer.dimension;jn===1&&(un=Gh),jn===2&&(un=Wo),jn===3&&(un=Hl)}Xr.primType=un}function Qr(Xr){Yt.elementsCount--,Me(Xr.buffer!==null,"must not double destroy elements"),delete pr[Xr.id],Xr.buffer.destroy(),Xr.buffer=null}function Or(Xr,It){var sr=Ke.create(null,Nu,!0),zr=new Fr(sr._buffer);Yt.elementsCount++;function cn(Er){if(!Er)sr(),zr.primType=Hl,zr.vertCount=0,zr.type=Xs;else if(typeof Er=="number")sr(Er),zr.primType=Hl,zr.vertCount=Er|0,zr.type=Xs;else{var vn=null,kr=oh,pn=-1,br=-1,un=0,jn=0;Array.isArray(Er)||oe(Er)||Da(Er)?vn=Er:(Me.type(Er,"object","invalid arguments for elements"),"data"in Er&&(vn=Er.data,Me(Array.isArray(vn)||oe(vn)||Da(vn),"invalid data for element buffer")),"usage"in Er&&(Me.parameter(Er.usage,Lu,"invalid element buffer usage"),kr=Lu[Er.usage]),"primitive"in Er&&(Me.parameter(Er.primitive,Fu,"invalid element buffer primitive"),pn=Fu[Er.primitive]),"count"in Er&&(Me(typeof Er.count=="number"&&Er.count>=0,"invalid vertex count for elements"),br=Er.count|0),"type"in Er&&(Me.parameter(Er.type,zt,"invalid buffer type"),jn=zt[Er.type]),"length"in Er?un=Er.length|0:(un=br,jn===ou||jn===Rl?un*=2:(jn===$s||jn===vi)&&(un*=4))),Wr(zr,vn,kr,pn,br,un,jn)}return cn}return cn(Xr),cn._reglType="elements",cn._elements=zr,cn.subdata=function(Er,vn){return sr.subdata(Er,vn),cn},cn.destroy=function(){Qr(zr)},cn}return{create:Or,createStream:Yr,destroyStream:Ur,getElements:function(Xr){return typeof Xr=="function"&&Xr._elements instanceof Fr?Xr._elements:null},clear:function(){zi(pr).forEach(Qr)}}}var In=new Float32Array(1),Ys=new Uint32Array(In.buffer),Es=5123;function Uu(W){for(var Ce=Qe.allocType(Es,W.length),Ke=0;Ke<W.length;++Ke)if(isNaN(W[Ke]))Ce[Ke]=65535;else if(W[Ke]===Infinity)Ce[Ke]=31744;else if(W[Ke]===-Infinity)Ce[Ke]=64512;else{In[0]=W[Ke];var Yt=Ys[0],pr=Yt>>>31<<15,Qt=(Yt<<1>>>24)-127,zt=Yt>>13&(1<<10)-1;if(Qt<-24)Ce[Ke]=pr;else if(Qt<-14){var Fr=-14-Qt;Ce[Ke]=pr+(zt+(1<<10)>>Fr)}else Qt>15?Ce[Ke]=pr+31744:Ce[Ke]=pr+(Qt+15<<10)+zt}return Ce}function Xa(W){return Array.isArray(W)||oe(W)}var bf=function(W){return!(W&W-1)&&!!W},Ef=34467,Ms=3553,nl=34067,_u=34069,Ml=6408,sh=6406,gc=6407,oa=6409,_c=6410,il=32854,Il=32855,uh=36194,Hc=32819,ua=32820,Pl=33635,$h=34042,Is=6402,Wc=34041,Gc=35904,Sf=35906,al=36193,Wl=33776,zu=33777,Xc=33778,yc=33779,Gl=35986,Af=35987,xc=34798,Ps=35840,lh=35841,$c=35842,bc=35843,Ol=36196,Zu=5121,Xl=5123,Tf=5125,ol=5126,ch=10242,fh=10243,hh=10497,wf=33071,Yh=33648,La=10240,qh=10241,Cf=9728,Kh=9729,$l=9984,Qh=9985,su=9986,la=9987,Yl=33170,Vu=4352,sl=4353,Di=4354,ha=34046,uu=3317,Yc=37440,qc=37441,qs=37443,Jh=37444,Rf=33984,Mf=[$l,su,Qh,la],ql=[0,oa,_c,gc,Ml],So={};So[oa]=So[sh]=So[Is]=1,So[Wc]=So[_c]=2,So[gc]=So[Gc]=3,So[Ml]=So[Sf]=4;function Ba(W){return"[object "+W+"]"}var Kc=Ba("HTMLCanvasElement"),Ec=Ba("OffscreenCanvas"),to=Ba("CanvasRenderingContext2D"),bn=Ba("ImageBitmap"),ss=Ba("HTMLImageElement"),If=Ba("HTMLVideoElement"),Sc=Object.keys(Pn).concat([Kc,Ec,to,bn,ss,If]),Yo=[];Yo[Zu]=1,Yo[ol]=4,Yo[al]=2,Yo[Xl]=2,Yo[Tf]=4;var ca=[];ca[il]=2,ca[Il]=2,ca[uh]=2,ca[Wc]=4,ca[Wl]=.5,ca[zu]=.5,ca[Xc]=1,ca[yc]=1,ca[Gl]=.5,ca[Af]=1,ca[xc]=1,ca[Ps]=.5,ca[lh]=.25,ca[$c]=.5,ca[bc]=.25,ca[Ol]=.5;function Pf(W){return Array.isArray(W)&&(W.length===0||typeof W[0]=="number")}function sn(W){if(!Array.isArray(W))return!1;var Ce=W.length;return!(Ce===0||!Xa(W[0]))}function ul(W){return Object.prototype.toString.call(W)}function Qc(W){return ul(W)===Kc}function Jc(W){return ul(W)===Ec}function yu(W){return ul(W)===to}function Os(W){return ul(W)===bn}function Of(W){return ul(W)===ss}function kf(W){return ul(W)===If}function us(W){if(!W)return!1;var Ce=ul(W);return Sc.indexOf(Ce)>=0?!0:Pf(W)||sn(W)||Da(W)}function xu(W){return Pn[Object.prototype.toString.call(W)]|0}function ep(W,Ce){var Ke=Ce.length;switch(W.type){case Zu:case Xl:case Tf:case ol:var Yt=Qe.allocType(W.type,Ke);Yt.set(Ce),W.data=Yt;break;case al:W.data=Uu(Ce);break;default:Me.raise("unsupported texture type, must specify a typed array")}}function Ac(W,Ce){return Qe.allocType(W.type===al?ol:W.type,Ce)}function Tc(W,Ce){W.type===al?(W.data=Uu(Ce),Qe.freeType(Ce)):W.data=Ce}function ef(W,Ce,Ke,Yt,pr,Qt){for(var zt=W.width,Fr=W.height,Ir=W.channels,Yr=zt*Fr*Ir,Ur=Ac(W,Yr),Wr=0,Qr=0;Qr<Fr;++Qr)for(var Or=0;Or<zt;++Or)for(var Xr=0;Xr<Ir;++Xr)Ur[Wr++]=Ce[Ke*Or+Yt*Qr+pr*Xr+Qt];Tc(W,Ur)}function ks(W,Ce,Ke,Yt,pr,Qt){var zt;if(typeof ca[W]!="undefined"?zt=ca[W]:zt=So[W]*Yo[Ce],Qt&&(zt*=6),pr){for(var Fr=0,Ir=Ke;Ir>=1;)Fr+=zt*Ir*Ir,Ir/=2;return Fr}else return zt*Ke*Yt}function Nt(W,Ce,Ke,Yt,pr,Qt,zt){var Fr={"don't care":Vu,"dont care":Vu,nice:Di,fast:sl},Ir={repeat:hh,clamp:wf,mirror:Yh},Yr={nearest:Cf,linear:Kh},Ur=Z({mipmap:la,"nearest mipmap nearest":$l,"linear mipmap nearest":Qh,"nearest mipmap linear":su,"linear mipmap linear":la},Yr),Wr={none:0,browser:Jh},Qr={uint8:Zu,rgba4:Hc,rgb565:Pl,"rgb5 a1":ua},Or={alpha:sh,luminance:oa,"luminance alpha":_c,rgb:gc,rgba:Ml,rgba4:il,"rgb5 a1":Il,rgb565:uh},Xr={};Ce.ext_srgb&&(Or.srgb=Gc,Or.srgba=Sf),Ce.oes_texture_float&&(Qr.float32=Qr.float=ol),Ce.oes_texture_half_float&&(Qr.float16=Qr["half float"]=al),Ce.webgl_depth_texture&&(Z(Or,{depth:Is,"depth stencil":Wc}),Z(Qr,{uint16:Xl,uint32:Tf,"depth stencil":$h})),Ce.webgl_compressed_texture_s3tc&&Z(Xr,{"rgb s3tc dxt1":Wl,"rgba s3tc dxt1":zu,"rgba s3tc dxt3":Xc,"rgba s3tc dxt5":yc}),Ce.webgl_compressed_texture_atc&&Z(Xr,{"rgb atc":Gl,"rgba atc explicit alpha":Af,"rgba atc interpolated alpha":xc}),Ce.webgl_compressed_texture_pvrtc&&Z(Xr,{"rgb pvrtc 4bppv1":Ps,"rgb pvrtc 2bppv1":lh,"rgba pvrtc 4bppv1":$c,"rgba pvrtc 2bppv1":bc}),Ce.webgl_compressed_texture_etc1&&(Xr["rgb etc1"]=Ol);var It=Array.prototype.slice.call(W.getParameter(Ef));Object.keys(Xr).forEach(function(Ge){var tr=Xr[Ge];It.indexOf(tr)>=0&&(Or[Ge]=tr)});var sr=Object.keys(Or);Ke.textureFormats=sr;var zr=[];Object.keys(Or).forEach(function(Ge){var tr=Or[Ge];zr[tr]=Ge});var cn=[];Object.keys(Qr).forEach(function(Ge){var tr=Qr[Ge];cn[tr]=Ge});var Er=[];Object.keys(Yr).forEach(function(Ge){var tr=Yr[Ge];Er[tr]=Ge});var vn=[];Object.keys(Ur).forEach(function(Ge){var tr=Ur[Ge];vn[tr]=Ge});var kr=[];Object.keys(Ir).forEach(function(Ge){var tr=Ir[Ge];kr[tr]=Ge});var pn=sr.reduce(function(Ge,tr){var Ht=Or[tr];return Ht===oa||Ht===sh||Ht===oa||Ht===_c||Ht===Is||Ht===Wc||Ce.ext_srgb&&(Ht===Gc||Ht===Sf)?Ge[Ht]=Ht:Ht===Il||tr.indexOf("rgba")>=0?Ge[Ht]=Ml:Ge[Ht]=gc,Ge},{});function br(){this.internalformat=Ml,this.format=Ml,this.type=Zu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Jh,this.width=0,this.height=0,this.channels=0}function un(Ge,tr){Ge.internalformat=tr.internalformat,Ge.format=tr.format,Ge.type=tr.type,Ge.compressed=tr.compressed,Ge.premultiplyAlpha=tr.premultiplyAlpha,Ge.flipY=tr.flipY,Ge.unpackAlignment=tr.unpackAlignment,Ge.colorSpace=tr.colorSpace,Ge.width=tr.width,Ge.height=tr.height,Ge.channels=tr.channels}function jn(Ge,tr){if(!(typeof tr!="object"||!tr)){if("premultiplyAlpha"in tr&&(Me.type(tr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ge.premultiplyAlpha=tr.premultiplyAlpha),"flipY"in tr&&(Me.type(tr.flipY,"boolean","invalid texture flip"),Ge.flipY=tr.flipY),"alignment"in tr&&(Me.oneOf(tr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ge.unpackAlignment=tr.alignment),"colorSpace"in tr&&(Me.parameter(tr.colorSpace,Wr,"invalid colorSpace"),Ge.colorSpace=Wr[tr.colorSpace]),"type"in tr){var Ht=tr.type;Me(Ce.oes_texture_float||!(Ht==="float"||Ht==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),Me(Ce.oes_texture_half_float||!(Ht==="half float"||Ht==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),Me(Ce.webgl_depth_texture||!(Ht==="uint16"||Ht==="uint32"||Ht==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Me.parameter(Ht,Qr,"invalid texture type"),Ge.type=Qr[Ht]}var mn=Ge.width,bi=Ge.height,pa=Ge.channels,ve=!1;"shape"in tr?(Me(Array.isArray(tr.shape)&&tr.shape.length>=2,"shape must be an array"),mn=tr.shape[0],bi=tr.shape[1],tr.shape.length===3&&(pa=tr.shape[2],Me(pa>0&&pa<=4,"invalid number of channels"),ve=!0),Me(mn>=0&&mn<=Ke.maxTextureSize,"invalid width"),Me(bi>=0&&bi<=Ke.maxTextureSize,"invalid height")):("radius"in tr&&(mn=bi=tr.radius,Me(mn>=0&&mn<=Ke.maxTextureSize,"invalid radius")),"width"in tr&&(mn=tr.width,Me(mn>=0&&mn<=Ke.maxTextureSize,"invalid width")),"height"in tr&&(bi=tr.height,Me(bi>=0&&bi<=Ke.maxTextureSize,"invalid height")),"channels"in tr&&(pa=tr.channels,Me(pa>0&&pa<=4,"invalid number of channels"),ve=!0)),Ge.width=mn|0,Ge.height=bi|0,Ge.channels=pa|0;var Pe=!1;if("format"in tr){var qe=tr.format;Me(Ce.webgl_depth_texture||!(qe==="depth"||qe==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Me.parameter(qe,Or,"invalid texture format");var Wt=Ge.internalformat=Or[qe];Ge.format=pn[Wt],qe in Qr&&("type"in tr||(Ge.type=Qr[qe])),qe in Xr&&(Ge.compressed=!0),Pe=!0}!ve&&Pe?Ge.channels=So[Ge.format]:ve&&!Pe?Ge.channels!==ql[Ge.format]&&(Ge.format=Ge.internalformat=ql[Ge.channels]):Pe&&ve&&Me(Ge.channels===So[Ge.format],"number of channels inconsistent with specified format")}}function ai(Ge){W.pixelStorei(Yc,Ge.flipY),W.pixelStorei(qc,Ge.premultiplyAlpha),W.pixelStorei(qs,Ge.colorSpace),W.pixelStorei(uu,Ge.unpackAlignment)}function rn(){br.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Lr(Ge,tr){var Ht=null;if(us(tr)?Ht=tr:tr&&(Me.type(tr,"object","invalid pixel data type"),jn(Ge,tr),"x"in tr&&(Ge.xOffset=tr.x|0),"y"in tr&&(Ge.yOffset=tr.y|0),us(tr.data)&&(Ht=tr.data)),Me(!Ge.compressed||Ht instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),tr.copy){Me(!Ht,"can not specify copy and data field for the same texture");var mn=pr.viewportWidth,bi=pr.viewportHeight;Ge.width=Ge.width||mn-Ge.xOffset,Ge.height=Ge.height||bi-Ge.yOffset,Ge.needsCopy=!0,Me(Ge.xOffset>=0&&Ge.xOffset<mn&&Ge.yOffset>=0&&Ge.yOffset<bi&&Ge.width>0&&Ge.width<=mn&&Ge.height>0&&Ge.height<=bi,"copy texture read out of bounds")}else if(!Ht)Ge.width=Ge.width||1,Ge.height=Ge.height||1,Ge.channels=Ge.channels||4;else if(oe(Ht))Ge.channels=Ge.channels||4,Ge.data=Ht,!("type"in tr)&&Ge.type===Zu&&(Ge.type=xu(Ht));else if(Pf(Ht))Ge.channels=Ge.channels||4,ep(Ge,Ht),Ge.alignment=1,Ge.needsFree=!0;else if(Da(Ht)){var pa=Ht.data;!Array.isArray(pa)&&Ge.type===Zu&&(Ge.type=xu(pa));var ve=Ht.shape,Pe=Ht.stride,qe,Wt,Ut,ot,vt,yt;ve.length===3?(Ut=ve[2],yt=Pe[2]):(Me(ve.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ut=1,yt=1),qe=ve[0],Wt=ve[1],ot=Pe[0],vt=Pe[1],Ge.alignment=1,Ge.width=qe,Ge.height=Wt,Ge.channels=Ut,Ge.format=Ge.internalformat=ql[Ut],Ge.needsFree=!0,ef(Ge,pa,ot,vt,yt,Ht.offset)}else if(Qc(Ht)||Jc(Ht)||yu(Ht))Qc(Ht)||Jc(Ht)?Ge.element=Ht:Ge.element=Ht.canvas,Ge.width=Ge.element.width,Ge.height=Ge.element.height,Ge.channels=4;else if(Os(Ht))Ge.element=Ht,Ge.width=Ht.width,Ge.height=Ht.height,Ge.channels=4;else if(Of(Ht))Ge.element=Ht,Ge.width=Ht.naturalWidth,Ge.height=Ht.naturalHeight,Ge.channels=4;else if(kf(Ht))Ge.element=Ht,Ge.width=Ht.videoWidth,Ge.height=Ht.videoHeight,Ge.channels=4;else if(sn(Ht)){var Xe=Ge.width||Ht[0].length,ut=Ge.height||Ht.length,Ie=Ge.channels;Xa(Ht[0][0])?Ie=Ie||Ht[0][0].length:Ie=Ie||1;for(var ht=jo.shape(Ht),Ot=1,or=0;or<ht.length;++or)Ot*=ht[or];var wr=Ac(Ge,Ot);jo.flatten(Ht,ht,"",wr),Tc(Ge,wr),Ge.alignment=1,Ge.width=Xe,Ge.height=ut,Ge.channels=Ie,Ge.format=Ge.internalformat=ql[Ie],Ge.needsFree=!0}Ge.type===ol?Me(Ke.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ge.type===al&&Me(Ke.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function _r(Ge,tr,Ht){var mn=Ge.element,bi=Ge.data,pa=Ge.internalformat,ve=Ge.format,Pe=Ge.type,qe=Ge.width,Wt=Ge.height;ai(Ge),mn?W.texImage2D(tr,Ht,ve,ve,Pe,mn):Ge.compressed?W.compressedTexImage2D(tr,Ht,pa,qe,Wt,0,bi):Ge.needsCopy?(Yt(),W.copyTexImage2D(tr,Ht,ve,Ge.xOffset,Ge.yOffset,qe,Wt,0)):W.texImage2D(tr,Ht,ve,qe,Wt,0,ve,Pe,bi||null)}function Jt(Ge,tr,Ht,mn,bi){var pa=Ge.element,ve=Ge.data,Pe=Ge.internalformat,qe=Ge.format,Wt=Ge.type,Ut=Ge.width,ot=Ge.height;ai(Ge),pa?W.texSubImage2D(tr,bi,Ht,mn,qe,Wt,pa):Ge.compressed?W.compressedTexSubImage2D(tr,bi,Ht,mn,Pe,Ut,ot,ve):Ge.needsCopy?(Yt(),W.copyTexSubImage2D(tr,bi,Ht,mn,Ge.xOffset,Ge.yOffset,Ut,ot)):W.texSubImage2D(tr,bi,Ht,mn,Ut,ot,qe,Wt,ve)}var Si=[];function Ye(){return Si.pop()||new rn}function xi(Ge){Ge.needsFree&&Qe.freeType(Ge.data),rn.call(Ge),Si.push(Ge)}function ui(){br.call(this),this.genMipmaps=!1,this.mipmapHint=Vu,this.mipmask=0,this.images=Array(16)}function Kn(Ge,tr,Ht){var mn=Ge.images[0]=Ye();Ge.mipmask=1,mn.width=Ge.width=tr,mn.height=Ge.height=Ht,mn.channels=Ge.channels=4}function $i(Ge,tr){var Ht=null;if(us(tr))Ht=Ge.images[0]=Ye(),un(Ht,Ge),Lr(Ht,tr),Ge.mipmask=1;else if(jn(Ge,tr),Array.isArray(tr.mipmap))for(var mn=tr.mipmap,bi=0;bi<mn.length;++bi)Ht=Ge.images[bi]=Ye(),un(Ht,Ge),Ht.width>>=bi,Ht.height>>=bi,Lr(Ht,mn[bi]),Ge.mipmask|=1<<bi;else Ht=Ge.images[0]=Ye(),un(Ht,Ge),Lr(Ht,tr),Ge.mipmask=1;un(Ge,Ge.images[0]),Ge.compressed&&(Ge.internalformat===Wl||Ge.internalformat===zu||Ge.internalformat===Xc||Ge.internalformat===yc)&&Me(Ge.width%4==0&&Ge.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function oo(Ge,tr){for(var Ht=Ge.images,mn=0;mn<Ht.length;++mn){if(!Ht[mn])return;_r(Ht[mn],tr,mn)}}var so=[];function Oi(){var Ge=so.pop()||new ui;br.call(Ge),Ge.mipmask=0;for(var tr=0;tr<16;++tr)Ge.images[tr]=null;return Ge}function ho(Ge){for(var tr=Ge.images,Ht=0;Ht<tr.length;++Ht)tr[Ht]&&xi(tr[Ht]),tr[Ht]=null;so.push(Ge)}function ya(){this.minFilter=Cf,this.magFilter=Cf,this.wrapS=wf,this.wrapT=wf,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Vu}function po(Ge,tr){if("min"in tr){var Ht=tr.min;Me.parameter(Ht,Ur),Ge.minFilter=Ur[Ht],Mf.indexOf(Ge.minFilter)>=0&&!("faces"in tr)&&(Ge.genMipmaps=!0)}if("mag"in tr){var mn=tr.mag;Me.parameter(mn,Yr),Ge.magFilter=Yr[mn]}var bi=Ge.wrapS,pa=Ge.wrapT;if("wrap"in tr){var ve=tr.wrap;typeof ve=="string"?(Me.parameter(ve,Ir),bi=pa=Ir[ve]):Array.isArray(ve)&&(Me.parameter(ve[0],Ir),Me.parameter(ve[1],Ir),bi=Ir[ve[0]],pa=Ir[ve[1]])}else{if("wrapS"in tr){var Pe=tr.wrapS;Me.parameter(Pe,Ir),bi=Ir[Pe]}if("wrapT"in tr){var qe=tr.wrapT;Me.parameter(qe,Ir),pa=Ir[qe]}}if(Ge.wrapS=bi,Ge.wrapT=pa,"anisotropic"in tr){var Wt=tr.anisotropic;Me(typeof Wt=="number"&&Wt>=1&&Wt<=Ke.maxAnisotropic,"aniso samples must be between 1 and "),Ge.anisotropic=tr.anisotropic}if("mipmap"in tr){var Ut=!1;switch(typeof tr.mipmap){case"string":Me.parameter(tr.mipmap,Fr,"invalid mipmap hint"),Ge.mipmapHint=Fr[tr.mipmap],Ge.genMipmaps=!0,Ut=!0;break;case"boolean":Ut=Ge.genMipmaps=tr.mipmap;break;case"object":Me(Array.isArray(tr.mipmap),"invalid mipmap type"),Ge.genMipmaps=!1,Ut=!0;break;default:Me.raise("invalid mipmap type")}Ut&&!("min"in tr)&&(Ge.minFilter=$l)}}function vo(Ge,tr){W.texParameteri(tr,qh,Ge.minFilter),W.texParameteri(tr,La,Ge.magFilter),W.texParameteri(tr,ch,Ge.wrapS),W.texParameteri(tr,fh,Ge.wrapT),Ce.ext_texture_filter_anisotropic&&W.texParameteri(tr,ha,Ge.anisotropic),Ge.genMipmaps&&(W.hint(Yl,Ge.mipmapHint),W.generateMipmap(tr))}var Ua=0,Oo={},vs=Ke.maxTextureUnits,mo=Array(vs).map(function(){return null});function _i(Ge){br.call(this),this.mipmask=0,this.internalformat=Ml,this.id=Ua++,this.refCount=1,this.target=Ge,this.texture=W.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ya,zt.profile&&(this.stats={size:0})}function es(Ge){W.activeTexture(Rf),W.bindTexture(Ge.target,Ge.texture)}function Qi(){var Ge=mo[0];Ge?W.bindTexture(Ge.target,Ge.texture):W.bindTexture(Ms,null)}function Yn(Ge){var tr=Ge.texture;Me(tr,"must not double destroy texture");var Ht=Ge.unit,mn=Ge.target;Ht>=0&&(W.activeTexture(Rf+Ht),W.bindTexture(mn,null),mo[Ht]=null),W.deleteTexture(tr),Ge.texture=null,Ge.params=null,Ge.pixels=null,Ge.refCount=0,delete Oo[Ge.id],Qt.textureCount--}Z(_i.prototype,{bind:function(){var Ge=this;Ge.bindCount+=1;var tr=Ge.unit;if(tr<0){for(var Ht=0;Ht<vs;++Ht){var mn=mo[Ht];if(mn){if(mn.bindCount>0)continue;mn.unit=-1}mo[Ht]=Ge,tr=Ht;break}tr>=vs&&Me.raise("insufficient number of texture units"),zt.profile&&Qt.maxTextureUnits<tr+1&&(Qt.maxTextureUnits=tr+1),Ge.unit=tr,W.activeTexture(Rf+tr),W.bindTexture(Ge.target,Ge.texture)}return tr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Yn(this)}});function Ii(Ge,tr){var Ht=new _i(Ms);Oo[Ht.id]=Ht,Qt.textureCount++;function mn(ve,Pe){var qe=Ht.texInfo;ya.call(qe);var Wt=Oi();return typeof ve=="number"?typeof Pe=="number"?Kn(Wt,ve|0,Pe|0):Kn(Wt,ve|0,ve|0):ve?(Me.type(ve,"object","invalid arguments to regl.texture"),po(qe,ve),$i(Wt,ve)):Kn(Wt,1,1),qe.genMipmaps&&(Wt.mipmask=(Wt.width<<1)-1),Ht.mipmask=Wt.mipmask,un(Ht,Wt),Me.texture2D(qe,Wt,Ke),Ht.internalformat=Wt.internalformat,mn.width=Wt.width,mn.height=Wt.height,es(Ht),oo(Wt,Ms),vo(qe,Ms),Qi(),ho(Wt),zt.profile&&(Ht.stats.size=ks(Ht.internalformat,Ht.type,Wt.width,Wt.height,qe.genMipmaps,!1)),mn.format=zr[Ht.internalformat],mn.type=cn[Ht.type],mn.mag=Er[qe.magFilter],mn.min=vn[qe.minFilter],mn.wrapS=kr[qe.wrapS],mn.wrapT=kr[qe.wrapT],mn}function bi(ve,Pe,qe,Wt){Me(!!ve,"must specify image data");var Ut=Pe|0,ot=qe|0,vt=Wt|0,yt=Ye();return un(yt,Ht),yt.width=0,yt.height=0,Lr(yt,ve),yt.width=yt.width||(Ht.width>>vt)-Ut,yt.height=yt.height||(Ht.height>>vt)-ot,Me(Ht.type===yt.type&&Ht.format===yt.format&&Ht.internalformat===yt.internalformat,"incompatible format for texture.subimage"),Me(Ut>=0&&ot>=0&&Ut+yt.width<=Ht.width&&ot+yt.height<=Ht.height,"texture.subimage write out of bounds"),Me(Ht.mipmask&1<<vt,"missing mipmap data"),Me(yt.data||yt.element||yt.needsCopy,"missing image data"),es(Ht),Jt(yt,Ms,Ut,ot,vt),Qi(),xi(yt),mn}function pa(ve,Pe){var qe=ve|0,Wt=Pe|0||qe;if(qe===Ht.width&&Wt===Ht.height)return mn;mn.width=Ht.width=qe,mn.height=Ht.height=Wt,es(Ht);for(var Ut=0;Ht.mipmask>>Ut;++Ut){var ot=qe>>Ut,vt=Wt>>Ut;if(!ot||!vt)break;W.texImage2D(Ms,Ut,Ht.format,ot,vt,0,Ht.format,Ht.type,null)}return Qi(),zt.profile&&(Ht.stats.size=ks(Ht.internalformat,Ht.type,qe,Wt,!1,!1)),mn}return mn(Ge,tr),mn.subimage=bi,mn.resize=pa,mn._reglType="texture2d",mn._texture=Ht,zt.profile&&(mn.stats=Ht.stats),mn.destroy=function(){Ht.decRef()},mn}function Wi(Ge,tr,Ht,mn,bi,pa){var ve=new _i(nl);Oo[ve.id]=ve,Qt.cubeCount++;var Pe=new Array(6);function qe(ot,vt,yt,Xe,ut,Ie){var ht,Ot=ve.texInfo;for(ya.call(Ot),ht=0;ht<6;++ht)Pe[ht]=Oi();if(typeof ot=="number"||!ot){var or=ot|0||1;for(ht=0;ht<6;++ht)Kn(Pe[ht],or,or)}else if(typeof ot=="object")if(vt)$i(Pe[0],ot),$i(Pe[1],vt),$i(Pe[2],yt),$i(Pe[3],Xe),$i(Pe[4],ut),$i(Pe[5],Ie);else if(po(Ot,ot),jn(ve,ot),"faces"in ot){var wr=ot.faces;for(Me(Array.isArray(wr)&&wr.length===6,"cube faces must be a length 6 array"),ht=0;ht<6;++ht)Me(typeof wr[ht]=="object"&&!!wr[ht],"invalid input for cube map face"),un(Pe[ht],ve),$i(Pe[ht],wr[ht])}else for(ht=0;ht<6;++ht)$i(Pe[ht],ot);else Me.raise("invalid arguments to cube map");for(un(ve,Pe[0]),Ke.npotTextureCube||Me(bf(ve.width)&&bf(ve.height),"your browser does not support non power or two texture dimensions"),Ot.genMipmaps?ve.mipmask=(Pe[0].width<<1)-1:ve.mipmask=Pe[0].mipmask,Me.textureCube(ve,Ot,Pe,Ke),ve.internalformat=Pe[0].internalformat,qe.width=Pe[0].width,qe.height=Pe[0].height,es(ve),ht=0;ht<6;++ht)oo(Pe[ht],_u+ht);for(vo(Ot,nl),Qi(),zt.profile&&(ve.stats.size=ks(ve.internalformat,ve.type,qe.width,qe.height,Ot.genMipmaps,!0)),qe.format=zr[ve.internalformat],qe.type=cn[ve.type],qe.mag=Er[Ot.magFilter],qe.min=vn[Ot.minFilter],qe.wrapS=kr[Ot.wrapS],qe.wrapT=kr[Ot.wrapT],ht=0;ht<6;++ht)ho(Pe[ht]);return qe}function Wt(ot,vt,yt,Xe,ut){Me(!!vt,"must specify image data"),Me(typeof ot=="number"&&ot===(ot|0)&&ot>=0&&ot<6,"invalid face");var Ie=yt|0,ht=Xe|0,Ot=ut|0,or=Ye();return un(or,ve),or.width=0,or.height=0,Lr(or,vt),or.width=or.width||(ve.width>>Ot)-Ie,or.height=or.height||(ve.height>>Ot)-ht,Me(ve.type===or.type&&ve.format===or.format&&ve.internalformat===or.internalformat,"incompatible format for texture.subimage"),Me(Ie>=0&&ht>=0&&Ie+or.width<=ve.width&&ht+or.height<=ve.height,"texture.subimage write out of bounds"),Me(ve.mipmask&1<<Ot,"missing mipmap data"),Me(or.data||or.element||or.needsCopy,"missing image data"),es(ve),Jt(or,_u+ot,Ie,ht,Ot),Qi(),xi(or),qe}function Ut(ot){var vt=ot|0;if(vt!==ve.width){qe.width=ve.width=vt,qe.height=ve.height=vt,es(ve);for(var yt=0;yt<6;++yt)for(var Xe=0;ve.mipmask>>Xe;++Xe)W.texImage2D(_u+yt,Xe,ve.format,vt>>Xe,vt>>Xe,0,ve.format,ve.type,null);return Qi(),zt.profile&&(ve.stats.size=ks(ve.internalformat,ve.type,qe.width,qe.height,!1,!0)),qe}}return qe(Ge,tr,Ht,mn,bi,pa),qe.subimage=Wt,qe.resize=Ut,qe._reglType="textureCube",qe._texture=ve,zt.profile&&(qe.stats=ve.stats),qe.destroy=function(){ve.decRef()},qe}function go(){for(var Ge=0;Ge<vs;++Ge)W.activeTexture(Rf+Ge),W.bindTexture(Ms,null),mo[Ge]=null;zi(Oo).forEach(Yn),Qt.cubeCount=0,Qt.textureCount=0}zt.profile&&(Qt.getTotalTextureSize=function(){var Ge=0;return Object.keys(Oo).forEach(function(tr){Ge+=Oo[tr].stats.size}),Ge});function ml(){for(var Ge=0;Ge<vs;++Ge){var tr=mo[Ge];tr&&(tr.bindCount=0,tr.unit=-1,mo[Ge]=null)}zi(Oo).forEach(function(Ht){Ht.texture=W.createTexture(),W.bindTexture(Ht.target,Ht.texture);for(var mn=0;mn<32;++mn)if((Ht.mipmask&1<<mn)!=0)if(Ht.target===Ms)W.texImage2D(Ms,mn,Ht.internalformat,Ht.width>>mn,Ht.height>>mn,0,Ht.internalformat,Ht.type,null);else for(var bi=0;bi<6;++bi)W.texImage2D(_u+bi,mn,Ht.internalformat,Ht.width>>mn,Ht.height>>mn,0,Ht.internalformat,Ht.type,null);vo(Ht.texInfo,Ht.target)})}return{create2D:Ii,createCube:Wi,clear:go,getTexture:function(Ge){return null},restore:ml}}var we=36161,N=32854,Ks=32855,xe=36194,kl=33189,Fa=36168,Ds=34041,Ao=35907,ls=34836,Ln=34842,An=34843,qo=[];qo[N]=2,qo[Ks]=2,qo[xe]=2,qo[kl]=2,qo[Fa]=1,qo[Ds]=4,qo[Ao]=4,qo[ls]=16,qo[Ln]=8,qo[An]=6;function Ko(W,Ce,Ke){return qo[W]*Ce*Ke}var bu=function(W,Ce,Ke,Yt,pr){var Qt={rgba4:N,rgb565:xe,"rgb5 a1":Ks,depth:kl,stencil:Fa,"depth stencil":Ds};Ce.ext_srgb&&(Qt.srgba=Ao),Ce.ext_color_buffer_half_float&&(Qt.rgba16f=Ln,Qt.rgb16f=An),Ce.webgl_color_buffer_float&&(Qt.rgba32f=ls);var zt=[];Object.keys(Qt).forEach(function(Or){var Xr=Qt[Or];zt[Xr]=Or});var Fr=0,Ir={};function Yr(Or){this.id=Fr++,this.refCount=1,this.renderbuffer=Or,this.format=N,this.width=0,this.height=0,pr.profile&&(this.stats={size:0})}Yr.prototype.decRef=function(){--this.refCount<=0&&Ur(this)};function Ur(Or){var Xr=Or.renderbuffer;Me(Xr,"must not double destroy renderbuffer"),W.bindRenderbuffer(we,null),W.deleteRenderbuffer(Xr),Or.renderbuffer=null,Or.refCount=0,delete Ir[Or.id],Yt.renderbufferCount--}function Wr(Or,Xr){var It=new Yr(W.createRenderbuffer());Ir[It.id]=It,Yt.renderbufferCount++;function sr(cn,Er){var vn=0,kr=0,pn=N;if(typeof cn=="object"&&cn){var br=cn;if("shape"in br){var un=br.shape;Me(Array.isArray(un)&&un.length>=2,"invalid renderbuffer shape"),vn=un[0]|0,kr=un[1]|0}else"radius"in br&&(vn=kr=br.radius|0),"width"in br&&(vn=br.width|0),"height"in br&&(kr=br.height|0);"format"in br&&(Me.parameter(br.format,Qt,"invalid renderbuffer format"),pn=Qt[br.format])}else typeof cn=="number"?(vn=cn|0,typeof Er=="number"?kr=Er|0:kr=vn):cn?Me.raise("invalid arguments to renderbuffer constructor"):vn=kr=1;if(Me(vn>0&&kr>0&&vn<=Ke.maxRenderbufferSize&&kr<=Ke.maxRenderbufferSize,"invalid renderbuffer size"),!(vn===It.width&&kr===It.height&&pn===It.format))return sr.width=It.width=vn,sr.height=It.height=kr,It.format=pn,W.bindRenderbuffer(we,It.renderbuffer),W.renderbufferStorage(we,pn,vn,kr),Me(W.getError()===0,"invalid render buffer format"),pr.profile&&(It.stats.size=Ko(It.format,It.width,It.height)),sr.format=zt[It.format],sr}function zr(cn,Er){var vn=cn|0,kr=Er|0||vn;return vn===It.width&&kr===It.height||(Me(vn>0&&kr>0&&vn<=Ke.maxRenderbufferSize&&kr<=Ke.maxRenderbufferSize,"invalid renderbuffer size"),sr.width=It.width=vn,sr.height=It.height=kr,W.bindRenderbuffer(we,It.renderbuffer),W.renderbufferStorage(we,It.format,vn,kr),Me(W.getError()===0,"invalid render buffer format"),pr.profile&&(It.stats.size=Ko(It.format,It.width,It.height))),sr}return sr(Or,Xr),sr.resize=zr,sr._reglType="renderbuffer",sr._renderbuffer=It,pr.profile&&(sr.stats=It.stats),sr.destroy=function(){It.decRef()},sr}pr.profile&&(Yt.getTotalRenderbufferSize=function(){var Or=0;return Object.keys(Ir).forEach(function(Xr){Or+=Ir[Xr].stats.size}),Or});function Qr(){zi(Ir).forEach(function(Or){Or.renderbuffer=W.createRenderbuffer(),W.bindRenderbuffer(we,Or.renderbuffer),W.renderbufferStorage(we,Or.format,Or.width,Or.height)}),W.bindRenderbuffer(we,null)}return{create:Wr,clear:function(){zi(Ir).forEach(Ur)},restore:Qr}},Ma=36160,Qs=36161,Eu=3553,Su=34069,ta=36064,co=36096,ph=36128,Dl=33306,Df=36053,ll=36054,cs=36055,Kl=36057,Au=36061,Lf=36193,wc=5121,tf=5126,Bf=6407,Ql=6408,Jl=6402,dh=[Bf,Ql],Qo=[];Qo[Ql]=4,Qo[Bf]=3;var Tu=[];Tu[wc]=1,Tu[tf]=4,Tu[Lf]=2;var rf=32854,Ll=32855,lu=36194,vh=33189,ju=36168,Ff=34041,mh=35907,h=34836,v=34842,d=34843,g=[rf,Ll,lu,mh,v,d,h],S={};S[Df]="complete",S[ll]="incomplete attachment",S[Kl]="incomplete dimensions",S[cs]="incomplete, missing attachment",S[Au]="unsupported";function C(W,Ce,Ke,Yt,pr,Qt){var zt={cur:null,next:null,dirty:!1,setFBO:null},Fr=["rgba"],Ir=["rgba4","rgb565","rgb5 a1"];Ce.ext_srgb&&Ir.push("srgba"),Ce.ext_color_buffer_half_float&&Ir.push("rgba16f","rgb16f"),Ce.webgl_color_buffer_float&&Ir.push("rgba32f");var Yr=["uint8"];Ce.oes_texture_half_float&&Yr.push("half float","float16"),Ce.oes_texture_float&&Yr.push("float","float32");function Ur(rn,Lr,_r){this.target=rn,this.texture=Lr,this.renderbuffer=_r;var Jt=0,Si=0;Lr?(Jt=Lr.width,Si=Lr.height):_r&&(Jt=_r.width,Si=_r.height),this.width=Jt,this.height=Si}function Wr(rn){rn&&(rn.texture&&rn.texture._texture.decRef(),rn.renderbuffer&&rn.renderbuffer._renderbuffer.decRef())}function Qr(rn,Lr,_r){if(!!rn)if(rn.texture){var Jt=rn.texture._texture,Si=Math.max(1,Jt.width),Ye=Math.max(1,Jt.height);Me(Si===Lr&&Ye===_r,"inconsistent width/height for supplied texture"),Jt.refCount+=1}else{var xi=rn.renderbuffer._renderbuffer;Me(xi.width===Lr&&xi.height===_r,"inconsistent width/height for renderbuffer"),xi.refCount+=1}}function Or(rn,Lr){Lr&&(Lr.texture?W.framebufferTexture2D(Ma,rn,Lr.target,Lr.texture._texture.texture,0):W.framebufferRenderbuffer(Ma,rn,Qs,Lr.renderbuffer._renderbuffer.renderbuffer))}function Xr(rn){var Lr=Eu,_r=null,Jt=null,Si=rn;typeof rn=="object"&&(Si=rn.data,"target"in rn&&(Lr=rn.target|0)),Me.type(Si,"function","invalid attachment data");var Ye=Si._reglType;return Ye==="texture2d"?(_r=Si,Me(Lr===Eu)):Ye==="textureCube"?(_r=Si,Me(Lr>=Su&&Lr<Su+6,"invalid cube map target")):Ye==="renderbuffer"?(Jt=Si,Lr=Qs):Me.raise("invalid regl object for attachment"),new Ur(Lr,_r,Jt)}function It(rn,Lr,_r,Jt,Si){if(_r){var Ye=Yt.create2D({width:rn,height:Lr,format:Jt,type:Si});return Ye._texture.refCount=0,new Ur(Eu,Ye,null)}else{var xi=pr.create({width:rn,height:Lr,format:Jt});return xi._renderbuffer.refCount=0,new Ur(Qs,null,xi)}}function sr(rn){return rn&&(rn.texture||rn.renderbuffer)}function zr(rn,Lr,_r){rn&&(rn.texture?rn.texture.resize(Lr,_r):rn.renderbuffer&&rn.renderbuffer.resize(Lr,_r),rn.width=Lr,rn.height=_r)}var cn=0,Er={};function vn(){this.id=cn++,Er[this.id]=this,this.framebuffer=W.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function kr(rn){rn.colorAttachments.forEach(Wr),Wr(rn.depthAttachment),Wr(rn.stencilAttachment),Wr(rn.depthStencilAttachment)}function pn(rn){var Lr=rn.framebuffer;Me(Lr,"must not double destroy framebuffer"),W.deleteFramebuffer(Lr),rn.framebuffer=null,Qt.framebufferCount--,delete Er[rn.id]}function br(rn){var Lr;W.bindFramebuffer(Ma,rn.framebuffer);var _r=rn.colorAttachments;for(Lr=0;Lr<_r.length;++Lr)Or(ta+Lr,_r[Lr]);for(Lr=_r.length;Lr<Ke.maxColorAttachments;++Lr)W.framebufferTexture2D(Ma,ta+Lr,Eu,null,0);W.framebufferTexture2D(Ma,Dl,Eu,null,0),W.framebufferTexture2D(Ma,co,Eu,null,0),W.framebufferTexture2D(Ma,ph,Eu,null,0),Or(co,rn.depthAttachment),Or(ph,rn.stencilAttachment),Or(Dl,rn.depthStencilAttachment);var Jt=W.checkFramebufferStatus(Ma);!W.isContextLost()&&Jt!==Df&&Me.raise("framebuffer configuration not supported, status = "+S[Jt]),W.bindFramebuffer(Ma,zt.next?zt.next.framebuffer:null),zt.cur=zt.next,W.getError()}function un(rn,Lr){var _r=new vn;Qt.framebufferCount++;function Jt(Ye,xi){var ui;Me(zt.next!==_r,"can not update framebuffer which is currently in use");var Kn=0,$i=0,oo=!0,so=!0,Oi=null,ho=!0,ya="rgba",po="uint8",vo=1,Ua=null,Oo=null,vs=null,mo=!1;if(typeof Ye=="number")Kn=Ye|0,$i=xi|0||Kn;else if(!Ye)Kn=$i=1;else{Me.type(Ye,"object","invalid arguments for framebuffer");var _i=Ye;if("shape"in _i){var es=_i.shape;Me(Array.isArray(es)&&es.length>=2,"invalid shape for framebuffer"),Kn=es[0],$i=es[1]}else"radius"in _i&&(Kn=$i=_i.radius),"width"in _i&&(Kn=_i.width),"height"in _i&&($i=_i.height);("color"in _i||"colors"in _i)&&(Oi=_i.color||_i.colors,Array.isArray(Oi)&&Me(Oi.length===1||Ce.webgl_draw_buffers,"multiple render targets not supported")),Oi||("colorCount"in _i&&(vo=_i.colorCount|0,Me(vo>0,"invalid color buffer count")),"colorTexture"in _i&&(ho=!!_i.colorTexture,ya="rgba4"),"colorType"in _i&&(po=_i.colorType,ho?(Me(Ce.oes_texture_float||!(po==="float"||po==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),Me(Ce.oes_texture_half_float||!(po==="half float"||po==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):po==="half float"||po==="float16"?(Me(Ce.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ya="rgba16f"):(po==="float"||po==="float32")&&(Me(Ce.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ya="rgba32f"),Me.oneOf(po,Yr,"invalid color type")),"colorFormat"in _i&&(ya=_i.colorFormat,Fr.indexOf(ya)>=0?ho=!0:Ir.indexOf(ya)>=0?ho=!1:ho?Me.oneOf(_i.colorFormat,Fr,"invalid color format for texture"):Me.oneOf(_i.colorFormat,Ir,"invalid color format for renderbuffer"))),("depthTexture"in _i||"depthStencilTexture"in _i)&&(mo=!!(_i.depthTexture||_i.depthStencilTexture),Me(!mo||Ce.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in _i&&(typeof _i.depth=="boolean"?oo=_i.depth:(Ua=_i.depth,so=!1)),"stencil"in _i&&(typeof _i.stencil=="boolean"?so=_i.stencil:(Oo=_i.stencil,oo=!1)),"depthStencil"in _i&&(typeof _i.depthStencil=="boolean"?oo=so=_i.depthStencil:(vs=_i.depthStencil,oo=!1,so=!1))}var Qi=null,Yn=null,Ii=null,Wi=null;if(Array.isArray(Oi))Qi=Oi.map(Xr);else if(Oi)Qi=[Xr(Oi)];else for(Qi=new Array(vo),ui=0;ui<vo;++ui)Qi[ui]=It(Kn,$i,ho,ya,po);Me(Ce.webgl_draw_buffers||Qi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),Me(Qi.length<=Ke.maxColorAttachments,"too many color attachments, not supported"),Kn=Kn||Qi[0].width,$i=$i||Qi[0].height,Ua?Yn=Xr(Ua):oo&&!so&&(Yn=It(Kn,$i,mo,"depth","uint32")),Oo?Ii=Xr(Oo):so&&!oo&&(Ii=It(Kn,$i,!1,"stencil","uint8")),vs?Wi=Xr(vs):!Ua&&!Oo&&so&&oo&&(Wi=It(Kn,$i,mo,"depth stencil","depth stencil")),Me(!!Ua+!!Oo+!!vs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var go=null;for(ui=0;ui<Qi.length;++ui)if(Qr(Qi[ui],Kn,$i),Me(!Qi[ui]||Qi[ui].texture&&dh.indexOf(Qi[ui].texture._texture.format)>=0||Qi[ui].renderbuffer&&g.indexOf(Qi[ui].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ui+" is invalid"),Qi[ui]&&Qi[ui].texture){var ml=Qo[Qi[ui].texture._texture.format]*Tu[Qi[ui].texture._texture.type];go===null?go=ml:Me(go===ml,"all color attachments much have the same number of bits per pixel.")}return Qr(Yn,Kn,$i),Me(!Yn||Yn.texture&&Yn.texture._texture.format===Jl||Yn.renderbuffer&&Yn.renderbuffer._renderbuffer.format===vh,"invalid depth attachment for framebuffer object"),Qr(Ii,Kn,$i),Me(!Ii||Ii.renderbuffer&&Ii.renderbuffer._renderbuffer.format===ju,"invalid stencil attachment for framebuffer object"),Qr(Wi,Kn,$i),Me(!Wi||Wi.texture&&Wi.texture._texture.format===Ff||Wi.renderbuffer&&Wi.renderbuffer._renderbuffer.format===Ff,"invalid depth-stencil attachment for framebuffer object"),kr(_r),_r.width=Kn,_r.height=$i,_r.colorAttachments=Qi,_r.depthAttachment=Yn,_r.stencilAttachment=Ii,_r.depthStencilAttachment=Wi,Jt.color=Qi.map(sr),Jt.depth=sr(Yn),Jt.stencil=sr(Ii),Jt.depthStencil=sr(Wi),Jt.width=_r.width,Jt.height=_r.height,br(_r),Jt}function Si(Ye,xi){Me(zt.next!==_r,"can not resize a framebuffer which is currently in use");var ui=Math.max(Ye|0,1),Kn=Math.max(xi|0||ui,1);if(ui===_r.width&&Kn===_r.height)return Jt;for(var $i=_r.colorAttachments,oo=0;oo<$i.length;++oo)zr($i[oo],ui,Kn);return zr(_r.depthAttachment,ui,Kn),zr(_r.stencilAttachment,ui,Kn),zr(_r.depthStencilAttachment,ui,Kn),_r.width=Jt.width=ui,_r.height=Jt.height=Kn,br(_r),Jt}return Jt(rn,Lr),Z(Jt,{resize:Si,_reglType:"framebuffer",_framebuffer:_r,destroy:function(){pn(_r),kr(_r)},use:function(Ye){zt.setFBO({framebuffer:Jt},Ye)}})}function jn(rn){var Lr=Array(6);function _r(Si){var Ye;Me(Lr.indexOf(zt.next)<0,"can not update framebuffer which is currently in use");var xi={color:null},ui=0,Kn=null,$i="rgba",oo="uint8",so=1;if(typeof Si=="number")ui=Si|0;else if(!Si)ui=1;else{Me.type(Si,"object","invalid arguments for framebuffer");var Oi=Si;if("shape"in Oi){var ho=Oi.shape;Me(Array.isArray(ho)&&ho.length>=2,"invalid shape for framebuffer"),Me(ho[0]===ho[1],"cube framebuffer must be square"),ui=ho[0]}else"radius"in Oi&&(ui=Oi.radius|0),"width"in Oi?(ui=Oi.width|0,"height"in Oi&&Me(Oi.height===ui,"must be square")):"height"in Oi&&(ui=Oi.height|0);("color"in Oi||"colors"in Oi)&&(Kn=Oi.color||Oi.colors,Array.isArray(Kn)&&Me(Kn.length===1||Ce.webgl_draw_buffers,"multiple render targets not supported")),Kn||("colorCount"in Oi&&(so=Oi.colorCount|0,Me(so>0,"invalid color buffer count")),"colorType"in Oi&&(Me.oneOf(Oi.colorType,Yr,"invalid color type"),oo=Oi.colorType),"colorFormat"in Oi&&($i=Oi.colorFormat,Me.oneOf(Oi.colorFormat,Fr,"invalid color format for texture"))),"depth"in Oi&&(xi.depth=Oi.depth),"stencil"in Oi&&(xi.stencil=Oi.stencil),"depthStencil"in Oi&&(xi.depthStencil=Oi.depthStencil)}var ya;if(Kn)if(Array.isArray(Kn))for(ya=[],Ye=0;Ye<Kn.length;++Ye)ya[Ye]=Kn[Ye];else ya=[Kn];else{ya=Array(so);var po={radius:ui,format:$i,type:oo};for(Ye=0;Ye<so;++Ye)ya[Ye]=Yt.createCube(po)}for(xi.color=Array(ya.length),Ye=0;Ye<ya.length;++Ye){var vo=ya[Ye];Me(typeof vo=="function"&&vo._reglType==="textureCube","invalid cube map"),ui=ui||vo.width,Me(vo.width===ui&&vo.height===ui,"invalid cube map shape"),xi.color[Ye]={target:Su,data:ya[Ye]}}for(Ye=0;Ye<6;++Ye){for(var Ua=0;Ua<ya.length;++Ua)xi.color[Ua].target=Su+Ye;Ye>0&&(xi.depth=Lr[0].depth,xi.stencil=Lr[0].stencil,xi.depthStencil=Lr[0].depthStencil),Lr[Ye]?Lr[Ye](xi):Lr[Ye]=un(xi)}return Z(_r,{width:ui,height:ui,color:ya})}function Jt(Si){var Ye,xi=Si|0;if(Me(xi>0&&xi<=Ke.maxCubeMapSize,"invalid radius for cube fbo"),xi===_r.width)return _r;var ui=_r.color;for(Ye=0;Ye<ui.length;++Ye)ui[Ye].resize(xi);for(Ye=0;Ye<6;++Ye)Lr[Ye].resize(xi);return _r.width=_r.height=xi,_r}return _r(rn),Z(_r,{faces:Lr,resize:Jt,_reglType:"framebufferCube",destroy:function(){Lr.forEach(function(Si){Si.destroy()})}})}function ai(){zt.cur=null,zt.next=null,zt.dirty=!0,zi(Er).forEach(function(rn){rn.framebuffer=W.createFramebuffer(),br(rn)})}return Z(zt,{getFramebuffer:function(rn){if(typeof rn=="function"&&rn._reglType==="framebuffer"){var Lr=rn._framebuffer;if(Lr instanceof vn)return Lr}return null},create:un,createCube:jn,clear:function(){zi(Er).forEach(pn)},restore:ai})}var R=5126,O=34962;function G(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=R,this.offset=0,this.stride=0,this.divisor=0}function J(W,Ce,Ke,Yt,pr){for(var Qt=Ke.maxAttributes,zt=new Array(Qt),Fr=0;Fr<Qt;++Fr)zt[Fr]=new G;var Ir=0,Yr={},Ur={Record:G,scope:{},state:zt,currentVAO:null,targetVAO:null,restore:Qr()?Er:function(){},createVAO:vn,getVAO:Xr,destroyBuffer:Wr,setVAO:Qr()?It:sr,clear:Qr()?zr:function(){}};function Wr(kr){for(var pn=0;pn<zt.length;++pn){var br=zt[pn];br.buffer===kr&&(W.disableVertexAttribArray(pn),br.buffer=null)}}function Qr(){return Ce.oes_vertex_array_object}function Or(){return Ce.angle_instanced_arrays}function Xr(kr){return typeof kr=="function"&&kr._vao?kr._vao:null}function It(kr){if(kr!==Ur.currentVAO){var pn=Qr();kr?pn.bindVertexArrayOES(kr.vao):pn.bindVertexArrayOES(null),Ur.currentVAO=kr}}function sr(kr){if(kr!==Ur.currentVAO){if(kr)kr.bindAttrs();else for(var pn=Or(),br=0;br<zt.length;++br){var un=zt[br];un.buffer?(W.enableVertexAttribArray(br),W.vertexAttribPointer(br,un.size,un.type,un.normalized,un.stride,un.offfset),pn&&pn.vertexAttribDivisorANGLE(br,un.divisor)):(W.disableVertexAttribArray(br),W.vertexAttrib4f(br,un.x,un.y,un.z,un.w))}Ur.currentVAO=kr}}function zr(){zi(Yr).forEach(function(kr){kr.destroy()})}function cn(){this.id=++Ir,this.attributes=[];var kr=Qr();kr?this.vao=kr.createVertexArrayOES():this.vao=null,Yr[this.id]=this,this.buffers=[]}cn.prototype.bindAttrs=function(){for(var kr=Or(),pn=this.attributes,br=0;br<pn.length;++br){var un=pn[br];un.buffer?(W.enableVertexAttribArray(br),W.bindBuffer(O,un.buffer.buffer),W.vertexAttribPointer(br,un.size,un.type,un.normalized,un.stride,un.offset),kr&&kr.vertexAttribDivisorANGLE(br,un.divisor)):(W.disableVertexAttribArray(br),W.vertexAttrib4f(br,un.x,un.y,un.z,un.w))}for(var jn=pn.length;jn<Qt;++jn)W.disableVertexAttribArray(jn)},cn.prototype.refresh=function(){var kr=Qr();kr&&(kr.bindVertexArrayOES(this.vao),this.bindAttrs(),Ur.currentVAO=this)},cn.prototype.destroy=function(){if(this.vao){var kr=Qr();this===Ur.currentVAO&&(Ur.currentVAO=null,kr.bindVertexArrayOES(null)),kr.deleteVertexArrayOES(this.vao),this.vao=null}Yr[this.id]&&(delete Yr[this.id],Yt.vaoCount-=1)};function Er(){var kr=Qr();kr&&zi(Yr).forEach(function(pn){pn.refresh()})}function vn(kr){var pn=new cn;Yt.vaoCount+=1;function br(un){Me(Array.isArray(un),"arguments to vertex array constructor must be an array"),Me(un.length<Qt,"too many attributes"),Me(un.length>0,"must specify at least one attribute");for(var jn=0;jn<pn.buffers.length;++jn)pn.buffers[jn].destroy();pn.buffers.length=0;var ai=pn.attributes;ai.length=un.length;for(var rn=0;rn<un.length;++rn){var Lr=un[rn],_r=ai[rn]=new G;if(Array.isArray(Lr)||oe(Lr)||Da(Lr)){var Jt=pr.create(Lr,O,!1,!0);_r.buffer=pr.getBuffer(Jt),_r.size=_r.buffer.dimension|0,_r.normalized=!1,_r.type=_r.buffer.dtype,_r.offset=0,_r.stride=0,_r.divisor=0,_r.state=1,pn.buffers.push(Jt)}else pr.getBuffer(Lr)?(_r.buffer=pr.getBuffer(Lr),_r.size=_r.buffer.dimension|0,_r.normalized=!1,_r.type=_r.buffer.dtype,_r.offset=0,_r.stride=0,_r.divisor=0,_r.state=1):pr.getBuffer(Lr.buffer)?(_r.buffer=pr.getBuffer(Lr.buffer),_r.size=(+Lr.size||_r.buffer.dimension)|0,_r.normalized=!!Lr.normalized||!1,"type"in Lr?(Me.parameter(Lr.type,Ho,"invalid buffer type"),_r.type=Ho[Lr.type]):_r.type=_r.buffer.dtype,_r.offset=(Lr.offset||0)|0,_r.stride=(Lr.stride||0)|0,_r.divisor=(Lr.divisor||0)|0,_r.state=1,Me(_r.size>=1&&_r.size<=4,"size must be between 1 and 4"),Me(_r.offset>=0,"invalid offset"),Me(_r.stride>=0&&_r.stride<=255,"stride must be between 0 and 255"),Me(_r.divisor>=0,"divisor must be positive"),Me(!_r.divisor||!!Ce.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Lr?(Me(rn>0,"first attribute must not be a constant"),_r.x=+Lr.x||0,_r.y=+Lr.y||0,_r.z=+Lr.z||0,_r.w=+Lr.w||0,_r.state=2):Me(!1,"invalid attribute spec for location "+rn)}return pn.refresh(),br}return br.destroy=function(){pn.destroy()},br._vao=pn,br._reglType="vao",br(kr)}return Ur}var _e=35632,be=35633,Te=35718,We=35721;function je(W,Ce,Ke,Yt){var pr={},Qt={};function zt(It,sr,zr,cn){this.name=It,this.id=sr,this.location=zr,this.info=cn}function Fr(It,sr){for(var zr=0;zr<It.length;++zr)if(It[zr].id===sr.id){It[zr].location=sr.location;return}It.push(sr)}function Ir(It,sr,zr){var cn=It===_e?pr:Qt,Er=cn[sr];if(!Er){var vn=Ce.str(sr);Er=W.createShader(It),W.shaderSource(Er,vn),W.compileShader(Er),Me.shaderError(W,Er,vn,It,zr),cn[sr]=Er}return Er}var Yr={},Ur=[],Wr=0;function Qr(It,sr){this.id=Wr++,this.fragId=It,this.vertId=sr,this.program=null,this.uniforms=[],this.attributes=[],Yt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Or(It,sr,zr){var cn,Er,vn=Ir(_e,It.fragId),kr=Ir(be,It.vertId),pn=It.program=W.createProgram();if(W.attachShader(pn,vn),W.attachShader(pn,kr),zr)for(cn=0;cn<zr.length;++cn){var br=zr[cn];W.bindAttribLocation(pn,br[0],br[1])}W.linkProgram(pn),Me.linkError(W,pn,Ce.str(It.fragId),Ce.str(It.vertId),sr);var un=W.getProgramParameter(pn,Te);Yt.profile&&(It.stats.uniformsCount=un);var jn=It.uniforms;for(cn=0;cn<un;++cn)if(Er=W.getActiveUniform(pn,cn),Er)if(Er.size>1)for(var ai=0;ai<Er.size;++ai){var rn=Er.name.replace("[0]","["+ai+"]");Fr(jn,new zt(rn,Ce.id(rn),W.getUniformLocation(pn,rn),Er))}else Fr(jn,new zt(Er.name,Ce.id(Er.name),W.getUniformLocation(pn,Er.name),Er));var Lr=W.getProgramParameter(pn,We);Yt.profile&&(It.stats.attributesCount=Lr);var _r=It.attributes;for(cn=0;cn<Lr;++cn)Er=W.getActiveAttrib(pn,cn),Er&&Fr(_r,new zt(Er.name,Ce.id(Er.name),W.getAttribLocation(pn,Er.name),Er))}Yt.profile&&(Ke.getMaxUniformsCount=function(){var It=0;return Ur.forEach(function(sr){sr.stats.uniformsCount>It&&(It=sr.stats.uniformsCount)}),It},Ke.getMaxAttributesCount=function(){var It=0;return Ur.forEach(function(sr){sr.stats.attributesCount>It&&(It=sr.stats.attributesCount)}),It});function Xr(){pr={},Qt={};for(var It=0;It<Ur.length;++It)Or(Ur[It],null,Ur[It].attributes.map(function(sr){return[sr.location,sr.name]}))}return{clear:function(){var It=W.deleteShader.bind(W);zi(pr).forEach(It),pr={},zi(Qt).forEach(It),Qt={},Ur.forEach(function(sr){W.deleteProgram(sr.program)}),Ur.length=0,Yr={},Ke.shaderCount=0},program:function(It,sr,zr,cn){Me.command(It>=0,"missing vertex shader",zr),Me.command(sr>=0,"missing fragment shader",zr);var Er=Yr[sr];Er||(Er=Yr[sr]={});var vn=Er[It];if(vn&&!cn)return vn;var kr=new Qr(sr,It);return Ke.shaderCount++,Or(kr,zr,cn),vn||(Er[It]=kr),Ur.push(kr),kr},restore:Xr,shader:Ir,frag:-1,vert:-1}}var at=6408,Fe=5121,nt=3333,_t=5126;function Dt(W,Ce,Ke,Yt,pr,Qt,zt){function Fr(Ur){var Wr;Ce.next===null?(Me(pr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Wr=Fe):(Me(Ce.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Wr=Ce.next.colorAttachments[0].texture._texture.type,Qt.oes_texture_float?(Me(Wr===Fe||Wr===_t,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Wr===_t&&Me(zt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):Me(Wr===Fe,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Qr=0,Or=0,Xr=Yt.framebufferWidth,It=Yt.framebufferHeight,sr=null;oe(Ur)?sr=Ur:Ur&&(Me.type(Ur,"object","invalid arguments to regl.read()"),Qr=Ur.x|0,Or=Ur.y|0,Me(Qr>=0&&Qr<Yt.framebufferWidth,"invalid x offset for regl.read"),Me(Or>=0&&Or<Yt.framebufferHeight,"invalid y offset for regl.read"),Xr=(Ur.width||Yt.framebufferWidth-Qr)|0,It=(Ur.height||Yt.framebufferHeight-Or)|0,sr=Ur.data||null),sr&&(Wr===Fe?Me(sr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Wr===_t&&Me(sr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),Me(Xr>0&&Xr+Qr<=Yt.framebufferWidth,"invalid width for read pixels"),Me(It>0&&It+Or<=Yt.framebufferHeight,"invalid height for read pixels"),Ke();var zr=Xr*It*4;return sr||(Wr===Fe?sr=new Uint8Array(zr):Wr===_t&&(sr=sr||new Float32Array(zr))),Me.isTypedArray(sr,"data buffer for regl.read() must be a typedarray"),Me(sr.byteLength>=zr,"data buffer for regl.read() too small"),W.pixelStorei(nt,4),W.readPixels(Qr,Or,Xr,It,at,Wr,sr),sr}function Ir(Ur){var Wr;return Ce.setFBO({framebuffer:Ur.framebuffer},function(){Wr=Fr(Ur)}),Wr}function Yr(Ur){return!Ur||!("framebuffer"in Ur)?Fr(Ur):Ir(Ur)}return Yr}function nr(W){return Array.prototype.slice.call(W)}function $t(W){return nr(W).join("")}function cr(){var W=0,Ce=[],Ke=[];function Yt(Wr){for(var Qr=0;Qr<Ke.length;++Qr)if(Ke[Qr]===Wr)return Ce[Qr];var Or="g"+W++;return Ce.push(Or),Ke.push(Wr),Or}function pr(){var Wr=[];function Qr(){Wr.push.apply(Wr,nr(arguments))}var Or=[];function Xr(){var It="v"+W++;return Or.push(It),arguments.length>0&&(Wr.push(It,"="),Wr.push.apply(Wr,nr(arguments)),Wr.push(";")),It}return Z(Qr,{def:Xr,toString:function(){return $t([Or.length>0?"var "+Or.join(",")+";":"",$t(Wr)])}})}function Qt(){var Wr=pr(),Qr=pr(),Or=Wr.toString,Xr=Qr.toString;function It(sr,zr){Qr(sr,zr,"=",Wr.def(sr,zr),";")}return Z(function(){Wr.apply(Wr,nr(arguments))},{def:Wr.def,entry:Wr,exit:Qr,save:It,set:function(sr,zr,cn){It(sr,zr),Wr(sr,zr,"=",cn,";")},toString:function(){return Or()+Xr()}})}function zt(){var Wr=$t(arguments),Qr=Qt(),Or=Qt(),Xr=Qr.toString,It=Or.toString;return Z(Qr,{then:function(){return Qr.apply(Qr,nr(arguments)),this},else:function(){return Or.apply(Or,nr(arguments)),this},toString:function(){var sr=It();return sr&&(sr="else{"+sr+"}"),$t(["if(",Wr,"){",Xr(),"}",sr])}})}var Fr=pr(),Ir={};function Yr(Wr,Qr){var Or=[];function Xr(){var Er="a"+Or.length;return Or.push(Er),Er}Qr=Qr||0;for(var It=0;It<Qr;++It)Xr();var sr=Qt(),zr=sr.toString,cn=Ir[Wr]=Z(sr,{arg:Xr,toString:function(){return $t(["function(",Or.join(),"){",zr(),"}"])}});return cn}function Ur(){var Wr=['"use strict";',Fr,"return {"];Object.keys(Ir).forEach(function(Xr){Wr.push('"',Xr,'":',Ir[Xr].toString(),",")}),Wr.push("}");var Qr=$t(Wr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Or=Function.apply(null,Ce.concat(Qr));return Or.apply(null,Ke)}return{global:Fr,link:Yt,block:pr,proc:Yr,scope:Qt,cond:zt,compile:Ur}}var yr="xyzw".split(""),Hr=5121,Nr=1,dn=2,Nn=0,Bn=1,zn=2,Ni=3,yn=4,ii="dither",pi="blend.enable",ti="blend.color",Jn="blend.equation",fi="blend.func",ei="depth.enable",$n="depth.func",To="depth.range",$a="depth.mask",wo="colorMask",fo="cull.enable",Na="cull.face",Ya="frontFace",fs="lineWidth",hs="polygonOffset.enable",cl="polygonOffset.offset",ps="sample.alpha",cu="sample.enable",Ls="sample.coverage",Cc="stencil.enable",Hu="stencil.mask",wu="stencil.func",ec="stencil.opFront",fl="stencil.opBack",fu="scissor.enable",hl="scissor.box",Co="viewport",ro="profile",Ss="framebuffer",hu="vert",Cu="frag",Li="elements",Go="primitive",no="count",pu="offset",Rc="instances",Wu="vao",gh="Width",Ro="Height",Dr=Ss+gh,Bs=Ss+Ro,_h=Co+gh,Mo=Co+Ro,Js="drawingBuffer",Io=Js+gh,tp=Js+Ro,tc=[fi,Jn,wu,ec,fl,Ls,Co,hl,cl],pl=34962,Up=34963,l0=35632,Zv=35633,Nf=3553,rp=34067,yh=2884,Od=3042,Mc=3024,xh=2960,Vv=2929,kd=3089,c0=32823,zp=32926,Dd=32928,Ld=5126,Zp=35664,Bl=35665,np=35666,Ic=5124,Vp=35667,qa=35668,Uf=35669,zf=35670,dl=35671,nf=35672,Pc=35673,Zf=35674,Vf=35675,Oc=35676,kc=35678,rc=35680,jp=4,nc=1028,Fs=1029,ip=2304,Hp=2305,Wp=32775,bh=32776,vl=519,Gu=7680,Bd=0,ap=1,Fd=32774,Eh=513,Dc=36160,Gp=36064,Xu={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},op=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Lc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ns={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Nd={frag:l0,vert:Zv},ic={cw:ip,ccw:Hp};function Sh(W){return Array.isArray(W)||oe(W)||Da(W)}function jf(W){return W.sort(function(Ce,Ke){return Ce===Co?-1:Ke===Co?1:Ce<Ke?-1:1})}function Jo(W,Ce,Ke,Yt){this.thisDep=W,this.contextDep=Ce,this.propDep=Ke,this.append=Yt}function ds(W){return W&&!(W.thisDep||W.contextDep||W.propDep)}function Po(W){return new Jo(!1,!1,!1,W)}function du(W,Ce){var Ke=W.type;if(Ke===Nn){var Yt=W.data.length;return new Jo(!0,Yt>=1,Yt>=2,Ce)}else if(Ke===yn){var pr=W.data;return new Jo(pr.thisDep,pr.contextDep,pr.propDep,Ce)}else return new Jo(Ke===Ni,Ke===zn,Ke===Bn,Ce)}var Xp=new Jo(!1,!1,!1,function(){});function af(W,Ce,Ke,Yt,pr,Qt,zt,Fr,Ir,Yr,Ur,Wr,Qr,Or,Xr){var It=Yr.Record,sr={add:32774,subtract:32778,"reverse subtract":32779};Ke.ext_blend_minmax&&(sr.min=Wp,sr.max=bh);var zr=Ke.angle_instanced_arrays,cn=Ke.webgl_draw_buffers,Er={dirty:!0,profile:Xr.profile},vn={},kr=[],pn={},br={};function un(ve){return ve.replace(".","_")}function jn(ve,Pe,qe){var Wt=un(ve);kr.push(ve),vn[Wt]=Er[Wt]=!!qe,pn[Wt]=Pe}function ai(ve,Pe,qe){var Wt=un(ve);kr.push(ve),Array.isArray(qe)?(Er[Wt]=qe.slice(),vn[Wt]=qe.slice()):Er[Wt]=vn[Wt]=qe,br[Wt]=Pe}jn(ii,Mc),jn(pi,Od),ai(ti,"blendColor",[0,0,0,0]),ai(Jn,"blendEquationSeparate",[Fd,Fd]),ai(fi,"blendFuncSeparate",[ap,Bd,ap,Bd]),jn(ei,Vv,!0),ai($n,"depthFunc",Eh),ai(To,"depthRange",[0,1]),ai($a,"depthMask",!0),ai(wo,wo,[!0,!0,!0,!0]),jn(fo,yh),ai(Na,"cullFace",Fs),ai(Ya,Ya,Hp),ai(fs,fs,1),jn(hs,c0),ai(cl,"polygonOffset",[0,0]),jn(ps,zp),jn(cu,Dd),ai(Ls,"sampleCoverage",[1,!1]),jn(Cc,xh),ai(Hu,"stencilMask",-1),ai(wu,"stencilFunc",[vl,0,-1]),ai(ec,"stencilOpSeparate",[nc,Gu,Gu,Gu]),ai(fl,"stencilOpSeparate",[Fs,Gu,Gu,Gu]),jn(fu,kd),ai(hl,"scissor",[0,0,W.drawingBufferWidth,W.drawingBufferHeight]),ai(Co,Co,[0,0,W.drawingBufferWidth,W.drawingBufferHeight]);var rn={gl:W,context:Qr,strings:Ce,next:vn,current:Er,draw:Wr,elements:Qt,buffer:pr,shader:Ur,attributes:Yr.state,vao:Yr,uniforms:Ir,framebuffer:Fr,extensions:Ke,timer:Or,isBufferArgs:Sh},Lr={primTypes:Fu,compareFuncs:Lc,blendFuncs:Xu,blendEquations:sr,stencilOps:Ns,glTypes:Ho,orientationType:ic};Me.optional(function(){rn.isArrayLike=Xa}),cn&&(Lr.backBuffer=[Fs],Lr.drawBuffer=mt(Yt.maxDrawbuffers,function(ve){return ve===0?[0]:mt(ve,function(Pe){return Gp+Pe})}));var _r=0;function Jt(){var ve=cr(),Pe=ve.link,qe=ve.global;ve.id=_r++,ve.batchId="0";var Wt=Pe(rn),Ut=ve.shared={props:"a0"};Object.keys(rn).forEach(function(ut){Ut[ut]=qe.def(Wt,".",ut)}),Me.optional(function(){ve.CHECK=Pe(Me),ve.commandStr=Me.guessCommand(),ve.command=Pe(ve.commandStr),ve.assert=function(ut,Ie,ht){ut("if(!(",Ie,"))",this.CHECK,".commandRaise(",Pe(ht),",",this.command,");")},Lr.invalidBlendCombinations=op});var ot=ve.next={},vt=ve.current={};Object.keys(br).forEach(function(ut){Array.isArray(Er[ut])&&(ot[ut]=qe.def(Ut.next,".",ut),vt[ut]=qe.def(Ut.current,".",ut))});var yt=ve.constants={};Object.keys(Lr).forEach(function(ut){yt[ut]=qe.def(JSON.stringify(Lr[ut]))}),ve.invoke=function(ut,Ie){switch(Ie.type){case Nn:var ht=["this",Ut.context,Ut.props,ve.batchId];return ut.def(Pe(Ie.data),".call(",ht.slice(0,Math.max(Ie.data.length+1,4)),")");case Bn:return ut.def(Ut.props,Ie.data);case zn:return ut.def(Ut.context,Ie.data);case Ni:return ut.def("this",Ie.data);case yn:return Ie.data.append(ve,ut),Ie.data.ref}},ve.attribCache={};var Xe={};return ve.scopeAttrib=function(ut){var Ie=Ce.id(ut);if(Ie in Xe)return Xe[Ie];var ht=Yr.scope[Ie];ht||(ht=Yr.scope[Ie]=new It);var Ot=Xe[Ie]=Pe(ht);return Ot},ve}function Si(ve){var Pe=ve.static,qe=ve.dynamic,Wt;if(ro in Pe){var Ut=!!Pe[ro];Wt=Po(function(vt,yt){return Ut}),Wt.enable=Ut}else if(ro in qe){var ot=qe[ro];Wt=du(ot,function(vt,yt){return vt.invoke(yt,ot)})}return Wt}function Ye(ve,Pe){var qe=ve.static,Wt=ve.dynamic;if(Ss in qe){var Ut=qe[Ss];return Ut?(Ut=Fr.getFramebuffer(Ut),Me.command(Ut,"invalid framebuffer object"),Po(function(vt,yt){var Xe=vt.link(Ut),ut=vt.shared;yt.set(ut.framebuffer,".next",Xe);var Ie=ut.context;return yt.set(Ie,"."+Dr,Xe+".width"),yt.set(Ie,"."+Bs,Xe+".height"),Xe})):Po(function(vt,yt){var Xe=vt.shared;yt.set(Xe.framebuffer,".next","null");var ut=Xe.context;return yt.set(ut,"."+Dr,ut+"."+Io),yt.set(ut,"."+Bs,ut+"."+tp),"null"})}else if(Ss in Wt){var ot=Wt[Ss];return du(ot,function(vt,yt){var Xe=vt.invoke(yt,ot),ut=vt.shared,Ie=ut.framebuffer,ht=yt.def(Ie,".getFramebuffer(",Xe,")");Me.optional(function(){vt.assert(yt,"!"+Xe+"||"+ht,"invalid framebuffer object")}),yt.set(Ie,".next",ht);var Ot=ut.context;return yt.set(Ot,"."+Dr,ht+"?"+ht+".width:"+Ot+"."+Io),yt.set(Ot,"."+Bs,ht+"?"+ht+".height:"+Ot+"."+tp),ht})}else return null}function xi(ve,Pe,qe){var Wt=ve.static,Ut=ve.dynamic;function ot(Xe){if(Xe in Wt){var ut=Wt[Xe];Me.commandType(ut,"object","invalid "+Xe,qe.commandStr);var Ie=!0,ht=ut.x|0,Ot=ut.y|0,or,wr;return"width"in ut?(or=ut.width|0,Me.command(or>=0,"invalid "+Xe,qe.commandStr)):Ie=!1,"height"in ut?(wr=ut.height|0,Me.command(wr>=0,"invalid "+Xe,qe.commandStr)):Ie=!1,new Jo(!Ie&&Pe&&Pe.thisDep,!Ie&&Pe&&Pe.contextDep,!Ie&&Pe&&Pe.propDep,function(On,Sn){var wn=On.shared.context,Wn=or;"width"in ut||(Wn=Sn.def(wn,".",Dr,"-",ht));var oi=wr;return"height"in ut||(oi=Sn.def(wn,".",Bs,"-",Ot)),[ht,Ot,Wn,oi]})}else if(Xe in Ut){var xr=Ut[Xe],Pr=du(xr,function(On,Sn){var wn=On.invoke(Sn,xr);Me.optional(function(){On.assert(Sn,wn+"&&typeof "+wn+'==="object"',"invalid "+Xe)});var Wn=On.shared.context,oi=Sn.def(wn,".x|0"),Ji=Sn.def(wn,".y|0"),xa=Sn.def('"width" in ',wn,"?",wn,".width|0:","(",Wn,".",Dr,"-",oi,")"),eu=Sn.def('"height" in ',wn,"?",wn,".height|0:","(",Wn,".",Bs,"-",Ji,")");return Me.optional(function(){On.assert(Sn,xa+">=0&&"+eu+">=0","invalid "+Xe)}),[oi,Ji,xa,eu]});return Pe&&(Pr.thisDep=Pr.thisDep||Pe.thisDep,Pr.contextDep=Pr.contextDep||Pe.contextDep,Pr.propDep=Pr.propDep||Pe.propDep),Pr}else return Pe?new Jo(Pe.thisDep,Pe.contextDep,Pe.propDep,function(On,Sn){var wn=On.shared.context;return[0,0,Sn.def(wn,".",Dr),Sn.def(wn,".",Bs)]}):null}var vt=ot(Co);if(vt){var yt=vt;vt=new Jo(vt.thisDep,vt.contextDep,vt.propDep,function(Xe,ut){var Ie=yt.append(Xe,ut),ht=Xe.shared.context;return ut.set(ht,"."+_h,Ie[2]),ut.set(ht,"."+Mo,Ie[3]),Ie})}return{viewport:vt,scissor_box:ot(hl)}}function ui(ve,Pe){var qe=ve.static,Wt=typeof qe[Cu]=="string"&&typeof qe[hu]=="string";if(Wt){if(Object.keys(Pe.dynamic).length>0)return null;var Ut=Pe.static,ot=Object.keys(Ut);if(ot.length>0&&typeof Ut[ot[0]]=="number"){for(var vt=[],yt=0;yt<ot.length;++yt)Me(typeof Ut[ot[yt]]=="number","must specify all vertex attribute locations when using vaos"),vt.push([Ut[ot[yt]]|0,ot[yt]]);return vt}}return null}function Kn(ve,Pe,qe){var Wt=ve.static,Ut=ve.dynamic;function ot(Ie){if(Ie in Wt){var ht=Ce.id(Wt[Ie]);Me.optional(function(){Ur.shader(Nd[Ie],ht,Me.guessCommand())});var Ot=Po(function(){return ht});return Ot.id=ht,Ot}else if(Ie in Ut){var or=Ut[Ie];return du(or,function(wr,xr){var Pr=wr.invoke(xr,or),On=xr.def(wr.shared.strings,".id(",Pr,")");return Me.optional(function(){xr(wr.shared.shader,".shader(",Nd[Ie],",",On,",",wr.command,");")}),On})}return null}var vt=ot(Cu),yt=ot(hu),Xe=null,ut;return ds(vt)&&ds(yt)?(Xe=Ur.program(yt.id,vt.id,null,qe),ut=Po(function(Ie,ht){return Ie.link(Xe)})):ut=new Jo(vt&&vt.thisDep||yt&&yt.thisDep,vt&&vt.contextDep||yt&&yt.contextDep,vt&&vt.propDep||yt&&yt.propDep,function(Ie,ht){var Ot=Ie.shared.shader,or;vt?or=vt.append(Ie,ht):or=ht.def(Ot,".",Cu);var wr;yt?wr=yt.append(Ie,ht):wr=ht.def(Ot,".",hu);var xr=Ot+".program("+wr+","+or;return Me.optional(function(){xr+=","+Ie.command}),ht.def(xr+")")}),{frag:vt,vert:yt,progVar:ut,program:Xe}}function $i(ve,Pe){var qe=ve.static,Wt=ve.dynamic;function Ut(){if(Li in qe){var Ie=qe[Li];Sh(Ie)?Ie=Qt.getElements(Qt.create(Ie,!0)):Ie&&(Ie=Qt.getElements(Ie),Me.command(Ie,"invalid elements",Pe.commandStr));var ht=Po(function(or,wr){if(Ie){var xr=or.link(Ie);return or.ELEMENTS=xr,xr}return or.ELEMENTS=null,null});return ht.value=Ie,ht}else if(Li in Wt){var Ot=Wt[Li];return du(Ot,function(or,wr){var xr=or.shared,Pr=xr.isBufferArgs,On=xr.elements,Sn=or.invoke(wr,Ot),wn=wr.def("null"),Wn=wr.def(Pr,"(",Sn,")"),oi=or.cond(Wn).then(wn,"=",On,".createStream(",Sn,");").else(wn,"=",On,".getElements(",Sn,");");return Me.optional(function(){or.assert(oi.else,"!"+Sn+"||"+wn,"invalid elements")}),wr.entry(oi),wr.exit(or.cond(Wn).then(On,".destroyStream(",wn,");")),or.ELEMENTS=wn,wn})}return null}var ot=Ut();function vt(){if(Go in qe){var Ie=qe[Go];return Me.commandParameter(Ie,Fu,"invalid primitve",Pe.commandStr),Po(function(Ot,or){return Fu[Ie]})}else if(Go in Wt){var ht=Wt[Go];return du(ht,function(Ot,or){var wr=Ot.constants.primTypes,xr=Ot.invoke(or,ht);return Me.optional(function(){Ot.assert(or,xr+" in "+wr,"invalid primitive, must be one of "+Object.keys(Fu))}),or.def(wr,"[",xr,"]")})}else if(ot)return ds(ot)?ot.value?Po(function(Ot,or){return or.def(Ot.ELEMENTS,".primType")}):Po(function(){return jp}):new Jo(ot.thisDep,ot.contextDep,ot.propDep,function(Ot,or){var wr=Ot.ELEMENTS;return or.def(wr,"?",wr,".primType:",jp)});return null}function yt(Ie,ht){if(Ie in qe){var Ot=qe[Ie]|0;return Me.command(!ht||Ot>=0,"invalid "+Ie,Pe.commandStr),Po(function(wr,xr){return ht&&(wr.OFFSET=Ot),Ot})}else if(Ie in Wt){var or=Wt[Ie];return du(or,function(wr,xr){var Pr=wr.invoke(xr,or);return ht&&(wr.OFFSET=Pr,Me.optional(function(){wr.assert(xr,Pr+">=0","invalid "+Ie)})),Pr})}else if(ht&&ot)return Po(function(wr,xr){return wr.OFFSET="0",0});return null}var Xe=yt(pu,!0);function ut(){if(no in qe){var Ie=qe[no]|0;return Me.command(typeof Ie=="number"&&Ie>=0,"invalid vertex count",Pe.commandStr),Po(function(){return Ie})}else if(no in Wt){var ht=Wt[no];return du(ht,function(wr,xr){var Pr=wr.invoke(xr,ht);return Me.optional(function(){wr.assert(xr,"typeof "+Pr+'==="number"&&'+Pr+">=0&&"+Pr+"===("+Pr+"|0)","invalid vertex count")}),Pr})}else if(ot)if(ds(ot)){if(ot)return Xe?new Jo(Xe.thisDep,Xe.contextDep,Xe.propDep,function(wr,xr){var Pr=xr.def(wr.ELEMENTS,".vertCount-",wr.OFFSET);return Me.optional(function(){wr.assert(xr,Pr+">=0","invalid vertex offset/element buffer too small")}),Pr}):Po(function(wr,xr){return xr.def(wr.ELEMENTS,".vertCount")});var Ot=Po(function(){return-1});return Me.optional(function(){Ot.MISSING=!0}),Ot}else{var or=new Jo(ot.thisDep||Xe.thisDep,ot.contextDep||Xe.contextDep,ot.propDep||Xe.propDep,function(wr,xr){var Pr=wr.ELEMENTS;return wr.OFFSET?xr.def(Pr,"?",Pr,".vertCount-",wr.OFFSET,":-1"):xr.def(Pr,"?",Pr,".vertCount:-1")});return Me.optional(function(){or.DYNAMIC=!0}),or}return null}return{elements:ot,primitive:vt(),count:ut(),instances:yt(Rc,!1),offset:Xe}}function oo(ve,Pe){var qe=ve.static,Wt=ve.dynamic,Ut={};return kr.forEach(function(ot){var vt=un(ot);function yt(Xe,ut){if(ot in qe){var Ie=Xe(qe[ot]);Ut[vt]=Po(function(){return Ie})}else if(ot in Wt){var ht=Wt[ot];Ut[vt]=du(ht,function(Ot,or){return ut(Ot,or,Ot.invoke(or,ht))})}}switch(ot){case fo:case pi:case ii:case Cc:case ei:case fu:case hs:case ps:case cu:case $a:return yt(function(Xe){return Me.commandType(Xe,"boolean",ot,Pe.commandStr),Xe},function(Xe,ut,Ie){return Me.optional(function(){Xe.assert(ut,"typeof "+Ie+'==="boolean"',"invalid flag "+ot,Xe.commandStr)}),Ie});case $n:return yt(function(Xe){return Me.commandParameter(Xe,Lc,"invalid "+ot,Pe.commandStr),Lc[Xe]},function(Xe,ut,Ie){var ht=Xe.constants.compareFuncs;return Me.optional(function(){Xe.assert(ut,Ie+" in "+ht,"invalid "+ot+", must be one of "+Object.keys(Lc))}),ut.def(ht,"[",Ie,"]")});case To:return yt(function(Xe){return Me.command(Xa(Xe)&&Xe.length===2&&typeof Xe[0]=="number"&&typeof Xe[1]=="number"&&Xe[0]<=Xe[1],"depth range is 2d array",Pe.commandStr),Xe},function(Xe,ut,Ie){Me.optional(function(){Xe.assert(ut,Xe.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===2&&typeof "+Ie+'[0]==="number"&&typeof '+Ie+'[1]==="number"&&'+Ie+"[0]<="+Ie+"[1]","depth range must be a 2d array")});var ht=ut.def("+",Ie,"[0]"),Ot=ut.def("+",Ie,"[1]");return[ht,Ot]});case fi:return yt(function(Xe){Me.commandType(Xe,"object","blend.func",Pe.commandStr);var ut="srcRGB"in Xe?Xe.srcRGB:Xe.src,Ie="srcAlpha"in Xe?Xe.srcAlpha:Xe.src,ht="dstRGB"in Xe?Xe.dstRGB:Xe.dst,Ot="dstAlpha"in Xe?Xe.dstAlpha:Xe.dst;return Me.commandParameter(ut,Xu,vt+".srcRGB",Pe.commandStr),Me.commandParameter(Ie,Xu,vt+".srcAlpha",Pe.commandStr),Me.commandParameter(ht,Xu,vt+".dstRGB",Pe.commandStr),Me.commandParameter(Ot,Xu,vt+".dstAlpha",Pe.commandStr),Me.command(op.indexOf(ut+", "+ht)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+ut+", "+ht+")",Pe.commandStr),[Xu[ut],Xu[ht],Xu[Ie],Xu[Ot]]},function(Xe,ut,Ie){var ht=Xe.constants.blendFuncs;Me.optional(function(){Xe.assert(ut,Ie+"&&typeof "+Ie+'==="object"',"invalid blend func, must be an object")});function Ot(wn,Wn){var oi=ut.def('"',wn,Wn,'" in ',Ie,"?",Ie,".",wn,Wn,":",Ie,".",wn);return Me.optional(function(){Xe.assert(ut,oi+" in "+ht,"invalid "+ot+"."+wn+Wn+", must be one of "+Object.keys(Xu))}),oi}var or=Ot("src","RGB"),wr=Ot("dst","RGB");Me.optional(function(){var wn=Xe.constants.invalidBlendCombinations;Xe.assert(ut,wn+".indexOf("+or+'+", "+'+wr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var xr=ut.def(ht,"[",or,"]"),Pr=ut.def(ht,"[",Ot("src","Alpha"),"]"),On=ut.def(ht,"[",wr,"]"),Sn=ut.def(ht,"[",Ot("dst","Alpha"),"]");return[xr,On,Pr,Sn]});case Jn:return yt(function(Xe){if(typeof Xe=="string")return Me.commandParameter(Xe,sr,"invalid "+ot,Pe.commandStr),[sr[Xe],sr[Xe]];if(typeof Xe=="object")return Me.commandParameter(Xe.rgb,sr,ot+".rgb",Pe.commandStr),Me.commandParameter(Xe.alpha,sr,ot+".alpha",Pe.commandStr),[sr[Xe.rgb],sr[Xe.alpha]];Me.commandRaise("invalid blend.equation",Pe.commandStr)},function(Xe,ut,Ie){var ht=Xe.constants.blendEquations,Ot=ut.def(),or=ut.def(),wr=Xe.cond("typeof ",Ie,'==="string"');return Me.optional(function(){function xr(Pr,On,Sn){Xe.assert(Pr,Sn+" in "+ht,"invalid "+On+", must be one of "+Object.keys(sr))}xr(wr.then,ot,Ie),Xe.assert(wr.else,Ie+"&&typeof "+Ie+'==="object"',"invalid "+ot),xr(wr.else,ot+".rgb",Ie+".rgb"),xr(wr.else,ot+".alpha",Ie+".alpha")}),wr.then(Ot,"=",or,"=",ht,"[",Ie,"];"),wr.else(Ot,"=",ht,"[",Ie,".rgb];",or,"=",ht,"[",Ie,".alpha];"),ut(wr),[Ot,or]});case ti:return yt(function(Xe){return Me.command(Xa(Xe)&&Xe.length===4,"blend.color must be a 4d array",Pe.commandStr),mt(4,function(ut){return+Xe[ut]})},function(Xe,ut,Ie){return Me.optional(function(){Xe.assert(ut,Xe.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===4","blend.color must be a 4d array")}),mt(4,function(ht){return ut.def("+",Ie,"[",ht,"]")})});case Hu:return yt(function(Xe){return Me.commandType(Xe,"number",vt,Pe.commandStr),Xe|0},function(Xe,ut,Ie){return Me.optional(function(){Xe.assert(ut,"typeof "+Ie+'==="number"',"invalid stencil.mask")}),ut.def(Ie,"|0")});case wu:return yt(function(Xe){Me.commandType(Xe,"object",vt,Pe.commandStr);var ut=Xe.cmp||"keep",Ie=Xe.ref||0,ht="mask"in Xe?Xe.mask:-1;return Me.commandParameter(ut,Lc,ot+".cmp",Pe.commandStr),Me.commandType(Ie,"number",ot+".ref",Pe.commandStr),Me.commandType(ht,"number",ot+".mask",Pe.commandStr),[Lc[ut],Ie,ht]},function(Xe,ut,Ie){var ht=Xe.constants.compareFuncs;Me.optional(function(){function xr(){Xe.assert(ut,Array.prototype.join.call(arguments,""),"invalid stencil.func")}xr(Ie+"&&typeof ",Ie,'==="object"'),xr('!("cmp" in ',Ie,")||(",Ie,".cmp in ",ht,")")});var Ot=ut.def('"cmp" in ',Ie,"?",ht,"[",Ie,".cmp]",":",Gu),or=ut.def(Ie,".ref|0"),wr=ut.def('"mask" in ',Ie,"?",Ie,".mask|0:-1");return[Ot,or,wr]});case ec:case fl:return yt(function(Xe){Me.commandType(Xe,"object",vt,Pe.commandStr);var ut=Xe.fail||"keep",Ie=Xe.zfail||"keep",ht=Xe.zpass||"keep";return Me.commandParameter(ut,Ns,ot+".fail",Pe.commandStr),Me.commandParameter(Ie,Ns,ot+".zfail",Pe.commandStr),Me.commandParameter(ht,Ns,ot+".zpass",Pe.commandStr),[ot===fl?Fs:nc,Ns[ut],Ns[Ie],Ns[ht]]},function(Xe,ut,Ie){var ht=Xe.constants.stencilOps;Me.optional(function(){Xe.assert(ut,Ie+"&&typeof "+Ie+'==="object"',"invalid "+ot)});function Ot(or){return Me.optional(function(){Xe.assert(ut,'!("'+or+'" in '+Ie+")||("+Ie+"."+or+" in "+ht+")","invalid "+ot+"."+or+", must be one of "+Object.keys(Ns))}),ut.def('"',or,'" in ',Ie,"?",ht,"[",Ie,".",or,"]:",Gu)}return[ot===fl?Fs:nc,Ot("fail"),Ot("zfail"),Ot("zpass")]});case cl:return yt(function(Xe){Me.commandType(Xe,"object",vt,Pe.commandStr);var ut=Xe.factor|0,Ie=Xe.units|0;return Me.commandType(ut,"number",vt+".factor",Pe.commandStr),Me.commandType(Ie,"number",vt+".units",Pe.commandStr),[ut,Ie]},function(Xe,ut,Ie){Me.optional(function(){Xe.assert(ut,Ie+"&&typeof "+Ie+'==="object"',"invalid "+ot)});var ht=ut.def(Ie,".factor|0"),Ot=ut.def(Ie,".units|0");return[ht,Ot]});case Na:return yt(function(Xe){var ut=0;return Xe==="front"?ut=nc:Xe==="back"&&(ut=Fs),Me.command(!!ut,vt,Pe.commandStr),ut},function(Xe,ut,Ie){return Me.optional(function(){Xe.assert(ut,Ie+'==="front"||'+Ie+'==="back"',"invalid cull.face")}),ut.def(Ie,'==="front"?',nc,":",Fs)});case fs:return yt(function(Xe){return Me.command(typeof Xe=="number"&&Xe>=Yt.lineWidthDims[0]&&Xe<=Yt.lineWidthDims[1],"invalid line width, must be a positive number between "+Yt.lineWidthDims[0]+" and "+Yt.lineWidthDims[1],Pe.commandStr),Xe},function(Xe,ut,Ie){return Me.optional(function(){Xe.assert(ut,"typeof "+Ie+'==="number"&&'+Ie+">="+Yt.lineWidthDims[0]+"&&"+Ie+"<="+Yt.lineWidthDims[1],"invalid line width")}),Ie});case Ya:return yt(function(Xe){return Me.commandParameter(Xe,ic,vt,Pe.commandStr),ic[Xe]},function(Xe,ut,Ie){return Me.optional(function(){Xe.assert(ut,Ie+'==="cw"||'+Ie+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),ut.def(Ie+'==="cw"?'+ip+":"+Hp)});case wo:return yt(function(Xe){return Me.command(Xa(Xe)&&Xe.length===4,"color.mask must be length 4 array",Pe.commandStr),Xe.map(function(ut){return!!ut})},function(Xe,ut,Ie){return Me.optional(function(){Xe.assert(ut,Xe.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===4","invalid color.mask")}),mt(4,function(ht){return"!!"+Ie+"["+ht+"]"})});case Ls:return yt(function(Xe){Me.command(typeof Xe=="object"&&Xe,vt,Pe.commandStr);var ut="value"in Xe?Xe.value:1,Ie=!!Xe.invert;return Me.command(typeof ut=="number"&&ut>=0&&ut<=1,"sample.coverage.value must be a number between 0 and 1",Pe.commandStr),[ut,Ie]},function(Xe,ut,Ie){Me.optional(function(){Xe.assert(ut,Ie+"&&typeof "+Ie+'==="object"',"invalid sample.coverage")});var ht=ut.def('"value" in ',Ie,"?+",Ie,".value:1"),Ot=ut.def("!!",Ie,".invert");return[ht,Ot]})}}),Ut}function so(ve,Pe){var qe=ve.static,Wt=ve.dynamic,Ut={};return Object.keys(qe).forEach(function(ot){var vt=qe[ot],yt;if(typeof vt=="number"||typeof vt=="boolean")yt=Po(function(){return vt});else if(typeof vt=="function"){var Xe=vt._reglType;Xe==="texture2d"||Xe==="textureCube"?yt=Po(function(ut){return ut.link(vt)}):Xe==="framebuffer"||Xe==="framebufferCube"?(Me.command(vt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ot+'"',Pe.commandStr),yt=Po(function(ut){return ut.link(vt.color[0])})):Me.commandRaise('invalid data for uniform "'+ot+'"',Pe.commandStr)}else Xa(vt)?yt=Po(function(ut){var Ie=ut.global.def("[",mt(vt.length,function(ht){return Me.command(typeof vt[ht]=="number"||typeof vt[ht]=="boolean","invalid uniform "+ot,ut.commandStr),vt[ht]}),"]");return Ie}):Me.commandRaise('invalid or missing data for uniform "'+ot+'"',Pe.commandStr);yt.value=vt,Ut[ot]=yt}),Object.keys(Wt).forEach(function(ot){var vt=Wt[ot];Ut[ot]=du(vt,function(yt,Xe){return yt.invoke(Xe,vt)})}),Ut}function Oi(ve,Pe){var qe=ve.static,Wt=ve.dynamic,Ut={};return Object.keys(qe).forEach(function(ot){var vt=qe[ot],yt=Ce.id(ot),Xe=new It;if(Sh(vt))Xe.state=Nr,Xe.buffer=pr.getBuffer(pr.create(vt,pl,!1,!0)),Xe.type=0;else{var ut=pr.getBuffer(vt);if(ut)Xe.state=Nr,Xe.buffer=ut,Xe.type=0;else if(Me.command(typeof vt=="object"&&vt,"invalid data for attribute "+ot,Pe.commandStr),"constant"in vt){var Ie=vt.constant;Xe.buffer="null",Xe.state=dn,typeof Ie=="number"?Xe.x=Ie:(Me.command(Xa(Ie)&&Ie.length>0&&Ie.length<=4,"invalid constant for attribute "+ot,Pe.commandStr),yr.forEach(function(On,Sn){Sn<Ie.length&&(Xe[On]=Ie[Sn])}))}else{Sh(vt.buffer)?ut=pr.getBuffer(pr.create(vt.buffer,pl,!1,!0)):ut=pr.getBuffer(vt.buffer),Me.command(!!ut,'missing buffer for attribute "'+ot+'"',Pe.commandStr);var ht=vt.offset|0;Me.command(ht>=0,'invalid offset for attribute "'+ot+'"',Pe.commandStr);var Ot=vt.stride|0;Me.command(Ot>=0&&Ot<256,'invalid stride for attribute "'+ot+'", must be integer betweeen [0, 255]',Pe.commandStr);var or=vt.size|0;Me.command(!("size"in vt)||or>0&&or<=4,'invalid size for attribute "'+ot+'", must be 1,2,3,4',Pe.commandStr);var wr=!!vt.normalized,xr=0;"type"in vt&&(Me.commandParameter(vt.type,Ho,"invalid type for attribute "+ot,Pe.commandStr),xr=Ho[vt.type]);var Pr=vt.divisor|0;"divisor"in vt&&(Me.command(Pr===0||zr,'cannot specify divisor for attribute "'+ot+'", instancing not supported',Pe.commandStr),Me.command(Pr>=0,'invalid divisor for attribute "'+ot+'"',Pe.commandStr)),Me.optional(function(){var On=Pe.commandStr,Sn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(vt).forEach(function(wn){Me.command(Sn.indexOf(wn)>=0,'unknown parameter "'+wn+'" for attribute pointer "'+ot+'" (valid parameters are '+Sn+")",On)})}),Xe.buffer=ut,Xe.state=Nr,Xe.size=or,Xe.normalized=wr,Xe.type=xr||ut.dtype,Xe.offset=ht,Xe.stride=Ot,Xe.divisor=Pr}}Ut[ot]=Po(function(On,Sn){var wn=On.attribCache;if(yt in wn)return wn[yt];var Wn={isStream:!1};return Object.keys(Xe).forEach(function(oi){Wn[oi]=Xe[oi]}),Xe.buffer&&(Wn.buffer=On.link(Xe.buffer),Wn.type=Wn.type||Wn.buffer+".dtype"),wn[yt]=Wn,Wn})}),Object.keys(Wt).forEach(function(ot){var vt=Wt[ot];function yt(Xe,ut){var Ie=Xe.invoke(ut,vt),ht=Xe.shared,Ot=Xe.constants,or=ht.isBufferArgs,wr=ht.buffer;Me.optional(function(){Xe.assert(ut,Ie+"&&(typeof "+Ie+'==="object"||typeof '+Ie+'==="function")&&('+or+"("+Ie+")||"+wr+".getBuffer("+Ie+")||"+wr+".getBuffer("+Ie+".buffer)||"+or+"("+Ie+'.buffer)||("constant" in '+Ie+"&&(typeof "+Ie+'.constant==="number"||'+ht.isArrayLike+"("+Ie+".constant))))",'invalid dynamic attribute "'+ot+'"')});var xr={isStream:ut.def(!1)},Pr=new It;Pr.state=Nr,Object.keys(Pr).forEach(function(Wn){xr[Wn]=ut.def(""+Pr[Wn])});var On=xr.buffer,Sn=xr.type;ut("if(",or,"(",Ie,")){",xr.isStream,"=true;",On,"=",wr,".createStream(",pl,",",Ie,");",Sn,"=",On,".dtype;","}else{",On,"=",wr,".getBuffer(",Ie,");","if(",On,"){",Sn,"=",On,".dtype;",'}else if("constant" in ',Ie,"){",xr.state,"=",dn,";","if(typeof "+Ie+'.constant === "number"){',xr[yr[0]],"=",Ie,".constant;",yr.slice(1).map(function(Wn){return xr[Wn]}).join("="),"=0;","}else{",yr.map(function(Wn,oi){return xr[Wn]+"="+Ie+".constant.length>"+oi+"?"+Ie+".constant["+oi+"]:0;"}).join(""),"}}else{","if(",or,"(",Ie,".buffer)){",On,"=",wr,".createStream(",pl,",",Ie,".buffer);","}else{",On,"=",wr,".getBuffer(",Ie,".buffer);","}",Sn,'="type" in ',Ie,"?",Ot.glTypes,"[",Ie,".type]:",On,".dtype;",xr.normalized,"=!!",Ie,".normalized;");function wn(Wn){ut(xr[Wn],"=",Ie,".",Wn,"|0;")}return wn("size"),wn("offset"),wn("stride"),wn("divisor"),ut("}}"),ut.exit("if(",xr.isStream,"){",wr,".destroyStream(",On,");","}"),xr}Ut[ot]=du(vt,yt)}),Ut}function ho(ve,Pe){var qe=ve.static,Wt=ve.dynamic;if(Wu in qe){var Ut=qe[Wu];return Ut!==null&&Yr.getVAO(Ut)===null&&(Ut=Yr.createVAO(Ut)),Po(function(vt){return vt.link(Yr.getVAO(Ut))})}else if(Wu in Wt){var ot=Wt[Wu];return du(ot,function(vt,yt){var Xe=vt.invoke(yt,ot);return yt.def(vt.shared.vao+".getVAO("+Xe+")")})}return null}function ya(ve){var Pe=ve.static,qe=ve.dynamic,Wt={};return Object.keys(Pe).forEach(function(Ut){var ot=Pe[Ut];Wt[Ut]=Po(function(vt,yt){return typeof ot=="number"||typeof ot=="boolean"?""+ot:vt.link(ot)})}),Object.keys(qe).forEach(function(Ut){var ot=qe[Ut];Wt[Ut]=du(ot,function(vt,yt){return vt.invoke(yt,ot)})}),Wt}function po(ve,Pe,qe,Wt,Ut){var ot=ve.static,vt=ve.dynamic;Me.optional(function(){var wn=[Ss,hu,Cu,Li,Go,pu,no,Rc,ro,Wu].concat(kr);function Wn(oi){Object.keys(oi).forEach(function(Ji){Me.command(wn.indexOf(Ji)>=0,'unknown parameter "'+Ji+'"',Ut.commandStr)})}Wn(ot),Wn(vt)});var yt=ui(ve,Pe),Xe=Ye(ve,Ut),ut=xi(ve,Xe,Ut),Ie=$i(ve,Ut),ht=oo(ve,Ut),Ot=Kn(ve,Ut,yt);function or(wn){var Wn=ut[wn];Wn&&(ht[wn]=Wn)}or(Co),or(un(hl));var wr=Object.keys(ht).length>0,xr={framebuffer:Xe,draw:Ie,shader:Ot,state:ht,dirty:wr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(xr.profile=Si(ve,Ut),xr.uniforms=so(qe,Ut),xr.drawVAO=xr.scopeVAO=ho(ve,Ut),!xr.drawVAO&&Ot.program&&!yt&&Ke.angle_instanced_arrays){var Pr=!0,On=Ot.program.attributes.map(function(wn){var Wn=Pe.static[wn];return Pr=Pr&&!!Wn,Wn});if(Pr&&On.length>0){var Sn=Yr.getVAO(Yr.createVAO(On));xr.drawVAO=new Jo(null,null,null,function(wn,Wn){return wn.link(Sn)}),xr.useVAO=!0}}return yt?xr.useVAO=!0:xr.attributes=Oi(Pe,Ut),xr.context=ya(Wt,Ut),xr}function vo(ve,Pe,qe){var Wt=ve.shared,Ut=Wt.context,ot=ve.scope();Object.keys(qe).forEach(function(vt){Pe.save(Ut,"."+vt);var yt=qe[vt];ot(Ut,".",vt,"=",yt.append(ve,Pe),";")}),Pe(ot)}function Ua(ve,Pe,qe,Wt){var Ut=ve.shared,ot=Ut.gl,vt=Ut.framebuffer,yt;cn&&(yt=Pe.def(Ut.extensions,".webgl_draw_buffers"));var Xe=ve.constants,ut=Xe.drawBuffer,Ie=Xe.backBuffer,ht;qe?ht=qe.append(ve,Pe):ht=Pe.def(vt,".next"),Wt||Pe("if(",ht,"!==",vt,".cur){"),Pe("if(",ht,"){",ot,".bindFramebuffer(",Dc,",",ht,".framebuffer);"),cn&&Pe(yt,".drawBuffersWEBGL(",ut,"[",ht,".colorAttachments.length]);"),Pe("}else{",ot,".bindFramebuffer(",Dc,",null);"),cn&&Pe(yt,".drawBuffersWEBGL(",Ie,");"),Pe("}",vt,".cur=",ht,";"),Wt||Pe("}")}function Oo(ve,Pe,qe){var Wt=ve.shared,Ut=Wt.gl,ot=ve.current,vt=ve.next,yt=Wt.current,Xe=Wt.next,ut=ve.cond(yt,".dirty");kr.forEach(function(Ie){var ht=un(Ie);if(!(ht in qe.state)){var Ot,or;if(ht in vt){Ot=vt[ht],or=ot[ht];var wr=mt(Er[ht].length,function(Pr){return ut.def(Ot,"[",Pr,"]")});ut(ve.cond(wr.map(function(Pr,On){return Pr+"!=="+or+"["+On+"]"}).join("||")).then(Ut,".",br[ht],"(",wr,");",wr.map(function(Pr,On){return or+"["+On+"]="+Pr}).join(";"),";"))}else{Ot=ut.def(Xe,".",ht);var xr=ve.cond(Ot,"!==",yt,".",ht);ut(xr),ht in pn?xr(ve.cond(Ot).then(Ut,".enable(",pn[ht],");").else(Ut,".disable(",pn[ht],");"),yt,".",ht,"=",Ot,";"):xr(Ut,".",br[ht],"(",Ot,");",yt,".",ht,"=",Ot,";")}}}),Object.keys(qe.state).length===0&&ut(yt,".dirty=false;"),Pe(ut)}function vs(ve,Pe,qe,Wt){var Ut=ve.shared,ot=ve.current,vt=Ut.current,yt=Ut.gl;jf(Object.keys(qe)).forEach(function(Xe){var ut=qe[Xe];if(!(Wt&&!Wt(ut))){var Ie=ut.append(ve,Pe);if(pn[Xe]){var ht=pn[Xe];ds(ut)?Ie?Pe(yt,".enable(",ht,");"):Pe(yt,".disable(",ht,");"):Pe(ve.cond(Ie).then(yt,".enable(",ht,");").else(yt,".disable(",ht,");")),Pe(vt,".",Xe,"=",Ie,";")}else if(Xa(Ie)){var Ot=ot[Xe];Pe(yt,".",br[Xe],"(",Ie,");",Ie.map(function(or,wr){return Ot+"["+wr+"]="+or}).join(";"),";")}else Pe(yt,".",br[Xe],"(",Ie,");",vt,".",Xe,"=",Ie,";")}})}function mo(ve,Pe){zr&&(ve.instancing=Pe.def(ve.shared.extensions,".angle_instanced_arrays"))}function _i(ve,Pe,qe,Wt,Ut){var ot=ve.shared,vt=ve.stats,yt=ot.current,Xe=ot.timer,ut=qe.profile;function Ie(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var ht,Ot;function or(wn){ht=Pe.def(),wn(ht,"=",Ie(),";"),typeof Ut=="string"?wn(vt,".count+=",Ut,";"):wn(vt,".count++;"),Or&&(Wt?(Ot=Pe.def(),wn(Ot,"=",Xe,".getNumPendingQueries();")):wn(Xe,".beginQuery(",vt,");"))}function wr(wn){wn(vt,".cpuTime+=",Ie(),"-",ht,";"),Or&&(Wt?wn(Xe,".pushScopeStats(",Ot,",",Xe,".getNumPendingQueries(),",vt,");"):wn(Xe,".endQuery();"))}function xr(wn){var Wn=Pe.def(yt,".profile");Pe(yt,".profile=",wn,";"),Pe.exit(yt,".profile=",Wn,";")}var Pr;if(ut){if(ds(ut)){ut.enable?(or(Pe),wr(Pe.exit),xr("true")):xr("false");return}Pr=ut.append(ve,Pe),xr(Pr)}else Pr=Pe.def(yt,".profile");var On=ve.block();or(On),Pe("if(",Pr,"){",On,"}");var Sn=ve.block();wr(Sn),Pe.exit("if(",Pr,"){",Sn,"}")}function es(ve,Pe,qe,Wt,Ut){var ot=ve.shared;function vt(Xe){switch(Xe){case Zp:case Vp:case dl:return 2;case Bl:case qa:case nf:return 3;case np:case Uf:case Pc:return 4;default:return 1}}function yt(Xe,ut,Ie){var ht=ot.gl,Ot=Pe.def(Xe,".location"),or=Pe.def(ot.attributes,"[",Ot,"]"),wr=Ie.state,xr=Ie.buffer,Pr=[Ie.x,Ie.y,Ie.z,Ie.w],On=["buffer","normalized","offset","stride"];function Sn(){Pe("if(!",or,".buffer){",ht,".enableVertexAttribArray(",Ot,");}");var Wn=Ie.type,oi;if(Ie.size?oi=Pe.def(Ie.size,"||",ut):oi=ut,Pe("if(",or,".type!==",Wn,"||",or,".size!==",oi,"||",On.map(function(xa){return or+"."+xa+"!=="+Ie[xa]}).join("||"),"){",ht,".bindBuffer(",pl,",",xr,".buffer);",ht,".vertexAttribPointer(",[Ot,oi,Wn,Ie.normalized,Ie.stride,Ie.offset],");",or,".type=",Wn,";",or,".size=",oi,";",On.map(function(xa){return or+"."+xa+"="+Ie[xa]+";"}).join(""),"}"),zr){var Ji=Ie.divisor;Pe("if(",or,".divisor!==",Ji,"){",ve.instancing,".vertexAttribDivisorANGLE(",[Ot,Ji],");",or,".divisor=",Ji,";}")}}function wn(){Pe("if(",or,".buffer){",ht,".disableVertexAttribArray(",Ot,");",or,".buffer=null;","}if(",yr.map(function(Wn,oi){return or+"."+Wn+"!=="+Pr[oi]}).join("||"),"){",ht,".vertexAttrib4f(",Ot,",",Pr,");",yr.map(function(Wn,oi){return or+"."+Wn+"="+Pr[oi]+";"}).join(""),"}")}wr===Nr?Sn():wr===dn?wn():(Pe("if(",wr,"===",Nr,"){"),Sn(),Pe("}else{"),wn(),Pe("}"))}Wt.forEach(function(Xe){var ut=Xe.name,Ie=qe.attributes[ut],ht;if(Ie){if(!Ut(Ie))return;ht=Ie.append(ve,Pe)}else{if(!Ut(Xp))return;var Ot=ve.scopeAttrib(ut);Me.optional(function(){ve.assert(Pe,Ot+".state","missing attribute "+ut)}),ht={},Object.keys(new It).forEach(function(or){ht[or]=Pe.def(Ot,".",or)})}yt(ve.link(Xe),vt(Xe.info.type),ht)})}function Qi(ve,Pe,qe,Wt,Ut){for(var ot=ve.shared,vt=ot.gl,yt,Xe=0;Xe<Wt.length;++Xe){var ut=Wt[Xe],Ie=ut.name,ht=ut.info.type,Ot=qe.uniforms[Ie],or=ve.link(ut),wr=or+".location",xr;if(Ot){if(!Ut(Ot))continue;if(ds(Ot)){var Pr=Ot.value;if(Me.command(Pr!==null&&typeof Pr!="undefined",'missing uniform "'+Ie+'"',ve.commandStr),ht===kc||ht===rc){Me.command(typeof Pr=="function"&&(ht===kc&&(Pr._reglType==="texture2d"||Pr._reglType==="framebuffer")||ht===rc&&(Pr._reglType==="textureCube"||Pr._reglType==="framebufferCube")),"invalid texture for uniform "+Ie,ve.commandStr);var On=ve.link(Pr._texture||Pr.color[0]._texture);Pe(vt,".uniform1i(",wr,",",On+".bind());"),Pe.exit(On,".unbind();")}else if(ht===Zf||ht===Vf||ht===Oc){Me.optional(function(){Me.command(Xa(Pr),"invalid matrix for uniform "+Ie,ve.commandStr),Me.command(ht===Zf&&Pr.length===4||ht===Vf&&Pr.length===9||ht===Oc&&Pr.length===16,"invalid length for matrix uniform "+Ie,ve.commandStr)});var Sn=ve.global.def("new Float32Array(["+Array.prototype.slice.call(Pr)+"])"),wn=2;ht===Vf?wn=3:ht===Oc&&(wn=4),Pe(vt,".uniformMatrix",wn,"fv(",wr,",false,",Sn,");")}else{switch(ht){case Ld:Me.commandType(Pr,"number","uniform "+Ie,ve.commandStr),yt="1f";break;case Zp:Me.command(Xa(Pr)&&Pr.length===2,"uniform "+Ie,ve.commandStr),yt="2f";break;case Bl:Me.command(Xa(Pr)&&Pr.length===3,"uniform "+Ie,ve.commandStr),yt="3f";break;case np:Me.command(Xa(Pr)&&Pr.length===4,"uniform "+Ie,ve.commandStr),yt="4f";break;case zf:Me.commandType(Pr,"boolean","uniform "+Ie,ve.commandStr),yt="1i";break;case Ic:Me.commandType(Pr,"number","uniform "+Ie,ve.commandStr),yt="1i";break;case dl:Me.command(Xa(Pr)&&Pr.length===2,"uniform "+Ie,ve.commandStr),yt="2i";break;case Vp:Me.command(Xa(Pr)&&Pr.length===2,"uniform "+Ie,ve.commandStr),yt="2i";break;case nf:Me.command(Xa(Pr)&&Pr.length===3,"uniform "+Ie,ve.commandStr),yt="3i";break;case qa:Me.command(Xa(Pr)&&Pr.length===3,"uniform "+Ie,ve.commandStr),yt="3i";break;case Pc:Me.command(Xa(Pr)&&Pr.length===4,"uniform "+Ie,ve.commandStr),yt="4i";break;case Uf:Me.command(Xa(Pr)&&Pr.length===4,"uniform "+Ie,ve.commandStr),yt="4i";break}Pe(vt,".uniform",yt,"(",wr,",",Xa(Pr)?Array.prototype.slice.call(Pr):Pr,");")}continue}else xr=Ot.append(ve,Pe)}else{if(!Ut(Xp))continue;xr=Pe.def(ot.uniforms,"[",Ce.id(Ie),"]")}ht===kc?Pe("if(",xr,"&&",xr,'._reglType==="framebuffer"){',xr,"=",xr,".color[0];","}"):ht===rc&&Pe("if(",xr,"&&",xr,'._reglType==="framebufferCube"){',xr,"=",xr,".color[0];","}"),Me.optional(function(){function eu(gl,Th){ve.assert(Pe,gl,'bad data or missing for uniform "'+Ie+'".  '+Th)}function of(gl){eu("typeof "+xr+'==="'+gl+'"',"invalid type, expected "+gl)}function $u(gl,Th){eu(ot.isArrayLike+"("+xr+")&&"+xr+".length==="+gl,"invalid vector, should have length "+gl,ve.commandStr)}function Ah(gl){eu("typeof "+xr+'==="function"&&'+xr+'._reglType==="texture'+(gl===Nf?"2d":"Cube")+'"',"invalid texture type",ve.commandStr)}switch(ht){case Ic:of("number");break;case Vp:$u(2,"number");break;case qa:$u(3,"number");break;case Uf:$u(4,"number");break;case Ld:of("number");break;case Zp:$u(2,"number");break;case Bl:$u(3,"number");break;case np:$u(4,"number");break;case zf:of("boolean");break;case dl:$u(2,"boolean");break;case nf:$u(3,"boolean");break;case Pc:$u(4,"boolean");break;case Zf:$u(4,"number");break;case Vf:$u(9,"number");break;case Oc:$u(16,"number");break;case kc:Ah(Nf);break;case rc:Ah(rp);break}});var Wn=1;switch(ht){case kc:case rc:var oi=Pe.def(xr,"._texture");Pe(vt,".uniform1i(",wr,",",oi,".bind());"),Pe.exit(oi,".unbind();");continue;case Ic:case zf:yt="1i";break;case Vp:case dl:yt="2i",Wn=2;break;case qa:case nf:yt="3i",Wn=3;break;case Uf:case Pc:yt="4i",Wn=4;break;case Ld:yt="1f";break;case Zp:yt="2f",Wn=2;break;case Bl:yt="3f",Wn=3;break;case np:yt="4f",Wn=4;break;case Zf:yt="Matrix2fv";break;case Vf:yt="Matrix3fv";break;case Oc:yt="Matrix4fv";break}if(Pe(vt,".uniform",yt,"(",wr,","),yt.charAt(0)==="M"){var Ji=Math.pow(ht-Zf+2,2),xa=ve.global.def("new Float32Array(",Ji,")");Pe("false,(Array.isArray(",xr,")||",xr," instanceof Float32Array)?",xr,":(",mt(Ji,function(eu){return xa+"["+eu+"]="+xr+"["+eu+"]"}),",",xa,")")}else Wn>1?Pe(mt(Wn,function(eu){return xr+"["+eu+"]"})):Pe(xr);Pe(");")}}function Yn(ve,Pe,qe,Wt){var Ut=ve.shared,ot=Ut.gl,vt=Ut.draw,yt=Wt.draw;function Xe(){var oi=yt.elements,Ji,xa=Pe;return oi?((oi.contextDep&&Wt.contextDynamic||oi.propDep)&&(xa=qe),Ji=oi.append(ve,xa)):Ji=xa.def(vt,".",Li),Ji&&xa("if("+Ji+")"+ot+".bindBuffer("+Up+","+Ji+".buffer.buffer);"),Ji}function ut(){var oi=yt.count,Ji,xa=Pe;return oi?((oi.contextDep&&Wt.contextDynamic||oi.propDep)&&(xa=qe),Ji=oi.append(ve,xa),Me.optional(function(){oi.MISSING&&ve.assert(Pe,"false","missing vertex count"),oi.DYNAMIC&&ve.assert(xa,Ji+">=0","missing vertex count")})):(Ji=xa.def(vt,".",no),Me.optional(function(){ve.assert(xa,Ji+">=0","missing vertex count")})),Ji}var Ie=Xe();function ht(oi){var Ji=yt[oi];return Ji?Ji.contextDep&&Wt.contextDynamic||Ji.propDep?Ji.append(ve,qe):Ji.append(ve,Pe):Pe.def(vt,".",oi)}var Ot=ht(Go),or=ht(pu),wr=ut();if(typeof wr=="number"){if(wr===0)return}else qe("if(",wr,"){"),qe.exit("}");var xr,Pr;zr&&(xr=ht(Rc),Pr=ve.instancing);var On=Ie+".type",Sn=yt.elements&&ds(yt.elements);function wn(){function oi(){qe(Pr,".drawElementsInstancedANGLE(",[Ot,wr,On,or+"<<(("+On+"-"+Hr+")>>1)",xr],");")}function Ji(){qe(Pr,".drawArraysInstancedANGLE(",[Ot,or,wr,xr],");")}Ie?Sn?oi():(qe("if(",Ie,"){"),oi(),qe("}else{"),Ji(),qe("}")):Ji()}function Wn(){function oi(){qe(ot+".drawElements("+[Ot,wr,On,or+"<<(("+On+"-"+Hr+")>>1)"]+");")}function Ji(){qe(ot+".drawArrays("+[Ot,or,wr]+");")}Ie?Sn?oi():(qe("if(",Ie,"){"),oi(),qe("}else{"),Ji(),qe("}")):Ji()}zr&&(typeof xr!="number"||xr>=0)?typeof xr=="string"?(qe("if(",xr,">0){"),wn(),qe("}else if(",xr,"<0){"),Wn(),qe("}")):wn():Wn()}function Ii(ve,Pe,qe,Wt,Ut){var ot=Jt(),vt=ot.proc("body",Ut);return Me.optional(function(){ot.commandStr=Pe.commandStr,ot.command=ot.link(Pe.commandStr)}),zr&&(ot.instancing=vt.def(ot.shared.extensions,".angle_instanced_arrays")),ve(ot,vt,qe,Wt),ot.compile().body}function Wi(ve,Pe,qe,Wt){mo(ve,Pe),qe.useVAO?qe.drawVAO?Pe(ve.shared.vao,".setVAO(",qe.drawVAO.append(ve,Pe),");"):Pe(ve.shared.vao,".setVAO(",ve.shared.vao,".targetVAO);"):(Pe(ve.shared.vao,".setVAO(null);"),es(ve,Pe,qe,Wt.attributes,function(){return!0})),Qi(ve,Pe,qe,Wt.uniforms,function(){return!0}),Yn(ve,Pe,Pe,qe)}function go(ve,Pe){var qe=ve.proc("draw",1);mo(ve,qe),vo(ve,qe,Pe.context),Ua(ve,qe,Pe.framebuffer),Oo(ve,qe,Pe),vs(ve,qe,Pe.state),_i(ve,qe,Pe,!1,!0);var Wt=Pe.shader.progVar.append(ve,qe);if(qe(ve.shared.gl,".useProgram(",Wt,".program);"),Pe.shader.program)Wi(ve,qe,Pe,Pe.shader.program);else{qe(ve.shared.vao,".setVAO(null);");var Ut=ve.global.def("{}"),ot=qe.def(Wt,".id"),vt=qe.def(Ut,"[",ot,"]");qe(ve.cond(vt).then(vt,".call(this,a0);").else(vt,"=",Ut,"[",ot,"]=",ve.link(function(yt){return Ii(Wi,ve,Pe,yt,1)}),"(",Wt,");",vt,".call(this,a0);"))}Object.keys(Pe.state).length>0&&qe(ve.shared.current,".dirty=true;")}function ml(ve,Pe,qe,Wt){ve.batchId="a1",mo(ve,Pe);function Ut(){return!0}es(ve,Pe,qe,Wt.attributes,Ut),Qi(ve,Pe,qe,Wt.uniforms,Ut),Yn(ve,Pe,Pe,qe)}function Ge(ve,Pe,qe,Wt){mo(ve,Pe);var Ut=qe.contextDep,ot=Pe.def(),vt="a0",yt="a1",Xe=Pe.def();ve.shared.props=Xe,ve.batchId=ot;var ut=ve.scope(),Ie=ve.scope();Pe(ut.entry,"for(",ot,"=0;",ot,"<",yt,";++",ot,"){",Xe,"=",vt,"[",ot,"];",Ie,"}",ut.exit);function ht(On){return On.contextDep&&Ut||On.propDep}function Ot(On){return!ht(On)}if(qe.needsContext&&vo(ve,Ie,qe.context),qe.needsFramebuffer&&Ua(ve,Ie,qe.framebuffer),vs(ve,Ie,qe.state,ht),qe.profile&&ht(qe.profile)&&_i(ve,Ie,qe,!1,!0),Wt)qe.useVAO?qe.drawVAO?ht(qe.drawVAO)?Ie(ve.shared.vao,".setVAO(",qe.drawVAO.append(ve,Ie),");"):ut(ve.shared.vao,".setVAO(",qe.drawVAO.append(ve,ut),");"):ut(ve.shared.vao,".setVAO(",ve.shared.vao,".targetVAO);"):(ut(ve.shared.vao,".setVAO(null);"),es(ve,ut,qe,Wt.attributes,Ot),es(ve,Ie,qe,Wt.attributes,ht)),Qi(ve,ut,qe,Wt.uniforms,Ot),Qi(ve,Ie,qe,Wt.uniforms,ht),Yn(ve,ut,Ie,qe);else{var or=ve.global.def("{}"),wr=qe.shader.progVar.append(ve,Ie),xr=Ie.def(wr,".id"),Pr=Ie.def(or,"[",xr,"]");Ie(ve.shared.gl,".useProgram(",wr,".program);","if(!",Pr,"){",Pr,"=",or,"[",xr,"]=",ve.link(function(On){return Ii(ml,ve,qe,On,2)}),"(",wr,");}",Pr,".call(this,a0[",ot,"],",ot,");")}}function tr(ve,Pe){var qe=ve.proc("batch",2);ve.batchId="0",mo(ve,qe);var Wt=!1,Ut=!0;Object.keys(Pe.context).forEach(function(or){Wt=Wt||Pe.context[or].propDep}),Wt||(vo(ve,qe,Pe.context),Ut=!1);var ot=Pe.framebuffer,vt=!1;ot?(ot.propDep?Wt=vt=!0:ot.contextDep&&Wt&&(vt=!0),vt||Ua(ve,qe,ot)):Ua(ve,qe,null),Pe.state.viewport&&Pe.state.viewport.propDep&&(Wt=!0);function yt(or){return or.contextDep&&Wt||or.propDep}Oo(ve,qe,Pe),vs(ve,qe,Pe.state,function(or){return!yt(or)}),(!Pe.profile||!yt(Pe.profile))&&_i(ve,qe,Pe,!1,"a1"),Pe.contextDep=Wt,Pe.needsContext=Ut,Pe.needsFramebuffer=vt;var Xe=Pe.shader.progVar;if(Xe.contextDep&&Wt||Xe.propDep)Ge(ve,qe,Pe,null);else{var ut=Xe.append(ve,qe);if(qe(ve.shared.gl,".useProgram(",ut,".program);"),Pe.shader.program)Ge(ve,qe,Pe,Pe.shader.program);else{qe(ve.shared.vao,".setVAO(null);");var Ie=ve.global.def("{}"),ht=qe.def(ut,".id"),Ot=qe.def(Ie,"[",ht,"]");qe(ve.cond(Ot).then(Ot,".call(this,a0,a1);").else(Ot,"=",Ie,"[",ht,"]=",ve.link(function(or){return Ii(Ge,ve,Pe,or,2)}),"(",ut,");",Ot,".call(this,a0,a1);"))}}Object.keys(Pe.state).length>0&&qe(ve.shared.current,".dirty=true;")}function Ht(ve,Pe){var qe=ve.proc("scope",3);ve.batchId="a2";var Wt=ve.shared,Ut=Wt.current;vo(ve,qe,Pe.context),Pe.framebuffer&&Pe.framebuffer.append(ve,qe),jf(Object.keys(Pe.state)).forEach(function(vt){var yt=Pe.state[vt],Xe=yt.append(ve,qe);Xa(Xe)?Xe.forEach(function(ut,Ie){qe.set(ve.next[vt],"["+Ie+"]",ut)}):qe.set(Wt.next,"."+vt,Xe)}),_i(ve,qe,Pe,!0,!0),[Li,pu,no,Rc,Go].forEach(function(vt){var yt=Pe.draw[vt];!yt||qe.set(Wt.draw,"."+vt,""+yt.append(ve,qe))}),Object.keys(Pe.uniforms).forEach(function(vt){qe.set(Wt.uniforms,"["+Ce.id(vt)+"]",Pe.uniforms[vt].append(ve,qe))}),Object.keys(Pe.attributes).forEach(function(vt){var yt=Pe.attributes[vt].append(ve,qe),Xe=ve.scopeAttrib(vt);Object.keys(new It).forEach(function(ut){qe.set(Xe,"."+ut,yt[ut])})}),Pe.scopeVAO&&qe.set(Wt.vao,".targetVAO",Pe.scopeVAO.append(ve,qe));function ot(vt){var yt=Pe.shader[vt];yt&&qe.set(Wt.shader,"."+vt,yt.append(ve,qe))}ot(hu),ot(Cu),Object.keys(Pe.state).length>0&&(qe(Ut,".dirty=true;"),qe.exit(Ut,".dirty=true;")),qe("a1(",ve.shared.context,",a0,",ve.batchId,");")}function mn(ve){if(!(typeof ve!="object"||Xa(ve))){for(var Pe=Object.keys(ve),qe=0;qe<Pe.length;++qe)if(an.isDynamic(ve[Pe[qe]]))return!0;return!1}}function bi(ve,Pe,qe){var Wt=Pe.static[qe];if(!Wt||!mn(Wt))return;var Ut=ve.global,ot=Object.keys(Wt),vt=!1,yt=!1,Xe=!1,ut=ve.global.def("{}");ot.forEach(function(ht){var Ot=Wt[ht];if(an.isDynamic(Ot)){typeof Ot=="function"&&(Ot=Wt[ht]=an.unbox(Ot));var or=du(Ot,null);vt=vt||or.thisDep,Xe=Xe||or.propDep,yt=yt||or.contextDep}else{switch(Ut(ut,".",ht,"="),typeof Ot){case"number":Ut(Ot);break;case"string":Ut('"',Ot,'"');break;case"object":Array.isArray(Ot)&&Ut("[",Ot.join(),"]");break;default:Ut(ve.link(Ot));break}Ut(";")}});function Ie(ht,Ot){ot.forEach(function(or){var wr=Wt[or];if(!!an.isDynamic(wr)){var xr=ht.invoke(Ot,wr);Ot(ut,".",or,"=",xr,";")}})}Pe.dynamic[qe]=new an.DynamicVariable(yn,{thisDep:vt,contextDep:yt,propDep:Xe,ref:ut,append:Ie}),delete Pe.static[qe]}function pa(ve,Pe,qe,Wt,Ut){var ot=Jt();ot.stats=ot.link(Ut),Object.keys(Pe.static).forEach(function(yt){bi(ot,Pe,yt)}),tc.forEach(function(yt){bi(ot,ve,yt)});var vt=po(ve,Pe,qe,Wt,ot);return go(ot,vt),Ht(ot,vt),tr(ot,vt),ot.compile()}return{next:vn,current:Er,procs:function(){var ve=Jt(),Pe=ve.proc("poll"),qe=ve.proc("refresh"),Wt=ve.block();Pe(Wt),qe(Wt);var Ut=ve.shared,ot=Ut.gl,vt=Ut.next,yt=Ut.current;Wt(yt,".dirty=false;"),Ua(ve,Pe),Ua(ve,qe,null,!0);var Xe;zr&&(Xe=ve.link(zr)),Ke.oes_vertex_array_object&&qe(ve.link(Ke.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var ut=0;ut<Yt.maxAttributes;++ut){var Ie=qe.def(Ut.attributes,"[",ut,"]"),ht=ve.cond(Ie,".buffer");ht.then(ot,".enableVertexAttribArray(",ut,");",ot,".bindBuffer(",pl,",",Ie,".buffer.buffer);",ot,".vertexAttribPointer(",ut,",",Ie,".size,",Ie,".type,",Ie,".normalized,",Ie,".stride,",Ie,".offset);").else(ot,".disableVertexAttribArray(",ut,");",ot,".vertexAttrib4f(",ut,",",Ie,".x,",Ie,".y,",Ie,".z,",Ie,".w);",Ie,".buffer=null;"),qe(ht),zr&&qe(Xe,".vertexAttribDivisorANGLE(",ut,",",Ie,".divisor);")}return qe(ve.shared.vao,".currentVAO=null;",ve.shared.vao,".setVAO(",ve.shared.vao,".targetVAO);"),Object.keys(pn).forEach(function(Ot){var or=pn[Ot],wr=Wt.def(vt,".",Ot),xr=ve.block();xr("if(",wr,"){",ot,".enable(",or,")}else{",ot,".disable(",or,")}",yt,".",Ot,"=",wr,";"),qe(xr),Pe("if(",wr,"!==",yt,".",Ot,"){",xr,"}")}),Object.keys(br).forEach(function(Ot){var or=br[Ot],wr=Er[Ot],xr,Pr,On=ve.block();if(On(ot,".",or,"("),Xa(wr)){var Sn=wr.length;xr=ve.global.def(vt,".",Ot),Pr=ve.global.def(yt,".",Ot),On(mt(Sn,function(wn){return xr+"["+wn+"]"}),");",mt(Sn,function(wn){return Pr+"["+wn+"]="+xr+"["+wn+"];"}).join("")),Pe("if(",mt(Sn,function(wn){return xr+"["+wn+"]!=="+Pr+"["+wn+"]"}).join("||"),"){",On,"}")}else xr=Wt.def(vt,".",Ot),Pr=Wt.def(yt,".",Ot),On(xr,");",yt,".",Ot,"=",xr,";"),Pe("if(",xr,"!==",Pr,"){",On,"}");qe(On)}),ve.compile()}(),compile:pa}}function $p(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Ud=34918,jv=34919,zd=35007,Yp=function(W,Ce){if(!Ce.ext_disjoint_timer_query)return null;var Ke=[];function Yt(){return Ke.pop()||Ce.ext_disjoint_timer_query.createQueryEXT()}function pr(zr){Ke.push(zr)}var Qt=[];function zt(zr){var cn=Yt();Ce.ext_disjoint_timer_query.beginQueryEXT(zd,cn),Qt.push(cn),Or(Qt.length-1,Qt.length,zr)}function Fr(){Ce.ext_disjoint_timer_query.endQueryEXT(zd)}function Ir(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Yr=[];function Ur(){return Yr.pop()||new Ir}function Wr(zr){Yr.push(zr)}var Qr=[];function Or(zr,cn,Er){var vn=Ur();vn.startQueryIndex=zr,vn.endQueryIndex=cn,vn.sum=0,vn.stats=Er,Qr.push(vn)}var Xr=[],It=[];function sr(){var zr,cn,Er=Qt.length;if(Er!==0){It.length=Math.max(It.length,Er+1),Xr.length=Math.max(Xr.length,Er+1),Xr[0]=0,It[0]=0;var vn=0;for(zr=0,cn=0;cn<Qt.length;++cn){var kr=Qt[cn];Ce.ext_disjoint_timer_query.getQueryObjectEXT(kr,jv)?(vn+=Ce.ext_disjoint_timer_query.getQueryObjectEXT(kr,Ud),pr(kr)):Qt[zr++]=kr,Xr[cn+1]=vn,It[cn+1]=zr}for(Qt.length=zr,zr=0,cn=0;cn<Qr.length;++cn){var pn=Qr[cn],br=pn.startQueryIndex,un=pn.endQueryIndex;pn.sum+=Xr[un]-Xr[br];var jn=It[br],ai=It[un];ai===jn?(pn.stats.gpuTime+=pn.sum/1e6,Wr(pn)):(pn.startQueryIndex=jn,pn.endQueryIndex=ai,Qr[zr++]=pn)}Qr.length=zr}}return{beginQuery:zt,endQuery:Fr,pushScopeStats:Or,update:sr,getNumPendingQueries:function(){return Qt.length},clear:function(){Ke.push.apply(Ke,Qt);for(var zr=0;zr<Ke.length;zr++)Ce.ext_disjoint_timer_query.deleteQueryEXT(Ke[zr]);Qt.length=0,Ke.length=0},restore:function(){Qt.length=0,Ke.length=0}}},Zd=16384,As=256,sp=1024,up=34962,qp="webglcontextlost",Hf="webglcontextrestored",Kp=1,Hv=2,Wv=3;function Vd(W,Ce){for(var Ke=0;Ke<W.length;++Ke)if(W[Ke]===Ce)return Ke;return-1}function jd(W){var Ce=St(W);if(!Ce)return null;var Ke=Ce.gl,Yt=Ke.getContextAttributes(),pr=Ke.isContextLost(),Qt=At(Ke,Ce);if(!Qt)return null;var zt=fe(),Fr=$p(),Ir=Qt.extensions,Yr=Yp(Ke,Ir),Ur=Hi(),Wr=Ke.drawingBufferWidth,Qr=Ke.drawingBufferHeight,Or={tick:0,time:0,viewportWidth:Wr,viewportHeight:Qr,framebufferWidth:Wr,framebufferHeight:Qr,drawingBufferWidth:Wr,drawingBufferHeight:Qr,pixelRatio:Ce.pixelRatio},Xr={},It={elements:null,primitive:4,count:-1,offset:0,instances:-1},sr=mc(Ke,Ir),zr=nh(Ke,Fr,Ce,Er),cn=J(Ke,Ir,sr,Fr,zr);function Er(Yn){return cn.destroyBuffer(Yn)}var vn=Xh(Ke,Ir,zr,Fr),kr=je(Ke,zt,Fr,Ce),pn=Nt(Ke,Ir,sr,function(){jn.procs.poll()},Or,Fr,Ce),br=bu(Ke,Ir,sr,Fr,Ce),un=C(Ke,Ir,sr,pn,br,Fr),jn=af(Ke,zt,Ir,sr,zr,vn,pn,un,Xr,cn,kr,It,Or,Yr,Ce),ai=Dt(Ke,un,jn.procs.poll,Or,Yt,Ir,sr),rn=jn.next,Lr=Ke.canvas,_r=[],Jt=[],Si=[],Ye=[Ce.onDestroy],xi=null;function ui(){if(_r.length===0){Yr&&Yr.update(),xi=null;return}xi=Zn.next(ui),vs();for(var Yn=_r.length-1;Yn>=0;--Yn){var Ii=_r[Yn];Ii&&Ii(Or,null,0)}Ke.flush(),Yr&&Yr.update()}function Kn(){!xi&&_r.length>0&&(xi=Zn.next(ui))}function $i(){xi&&(Zn.cancel(ui),xi=null)}function oo(Yn){Yn.preventDefault(),pr=!0,$i(),Jt.forEach(function(Ii){Ii()})}function so(Yn){Ke.getError(),pr=!1,Qt.restore(),kr.restore(),zr.restore(),pn.restore(),br.restore(),un.restore(),cn.restore(),Yr&&Yr.restore(),jn.procs.refresh(),Kn(),Si.forEach(function(Ii){Ii()})}Lr&&(Lr.addEventListener(qp,oo,!1),Lr.addEventListener(Hf,so,!1));function Oi(){_r.length=0,$i(),Lr&&(Lr.removeEventListener(qp,oo),Lr.removeEventListener(Hf,so)),kr.clear(),un.clear(),br.clear(),pn.clear(),vn.clear(),zr.clear(),cn.clear(),Yr&&Yr.clear(),Ye.forEach(function(Yn){Yn()})}function ho(Yn){Me(!!Yn,"invalid args to regl({...})"),Me.type(Yn,"object","invalid args to regl({...})");function Ii(Ut){var ot=Z({},Ut);delete ot.uniforms,delete ot.attributes,delete ot.context,delete ot.vao,"stencil"in ot&&ot.stencil.op&&(ot.stencil.opBack=ot.stencil.opFront=ot.stencil.op,delete ot.stencil.op);function vt(yt){if(yt in ot){var Xe=ot[yt];delete ot[yt],Object.keys(Xe).forEach(function(ut){ot[yt+"."+ut]=Xe[ut]})}}return vt("blend"),vt("depth"),vt("cull"),vt("stencil"),vt("polygonOffset"),vt("scissor"),vt("sample"),"vao"in Ut&&(ot.vao=Ut.vao),ot}function Wi(Ut){var ot={},vt={};return Object.keys(Ut).forEach(function(yt){var Xe=Ut[yt];an.isDynamic(Xe)?vt[yt]=an.unbox(Xe,yt):ot[yt]=Xe}),{dynamic:vt,static:ot}}var go=Wi(Yn.context||{}),ml=Wi(Yn.uniforms||{}),Ge=Wi(Yn.attributes||{}),tr=Wi(Ii(Yn)),Ht={gpuTime:0,cpuTime:0,count:0},mn=jn.compile(tr,Ge,ml,go,Ht),bi=mn.draw,pa=mn.batch,ve=mn.scope,Pe=[];function qe(Ut){for(;Pe.length<Ut;)Pe.push(null);return Pe}function Wt(Ut,ot){var vt;if(pr&&Me.raise("context lost"),typeof Ut=="function")return ve.call(this,null,Ut,0);if(typeof ot=="function")if(typeof Ut=="number")for(vt=0;vt<Ut;++vt)ve.call(this,null,ot,vt);else if(Array.isArray(Ut))for(vt=0;vt<Ut.length;++vt)ve.call(this,Ut[vt],ot,vt);else return ve.call(this,Ut,ot,0);else if(typeof Ut=="number"){if(Ut>0)return pa.call(this,qe(Ut|0),Ut|0)}else if(Array.isArray(Ut)){if(Ut.length)return pa.call(this,Ut,Ut.length)}else return bi.call(this,Ut)}return Z(Wt,{stats:Ht})}var ya=un.setFBO=ho({framebuffer:an.define.call(null,Kp,"framebuffer")});function po(Yn,Ii){var Wi=0;jn.procs.poll();var go=Ii.color;go&&(Ke.clearColor(+go[0]||0,+go[1]||0,+go[2]||0,+go[3]||0),Wi|=Zd),"depth"in Ii&&(Ke.clearDepth(+Ii.depth),Wi|=As),"stencil"in Ii&&(Ke.clearStencil(Ii.stencil|0),Wi|=sp),Me(!!Wi,"called regl.clear with no buffer specified"),Ke.clear(Wi)}function vo(Yn){if(Me(typeof Yn=="object"&&Yn,"regl.clear() takes an object as input"),"framebuffer"in Yn)if(Yn.framebuffer&&Yn.framebuffer_reglType==="framebufferCube")for(var Ii=0;Ii<6;++Ii)ya(Z({framebuffer:Yn.framebuffer.faces[Ii]},Yn),po);else ya(Yn,po);else po(null,Yn)}function Ua(Yn){Me.type(Yn,"function","regl.frame() callback must be a function"),_r.push(Yn);function Ii(){var Wi=Vd(_r,Yn);Me(Wi>=0,"cannot cancel a frame twice");function go(){var ml=Vd(_r,go);_r[ml]=_r[_r.length-1],_r.length-=1,_r.length<=0&&$i()}_r[Wi]=go}return Kn(),{cancel:Ii}}function Oo(){var Yn=rn.viewport,Ii=rn.scissor_box;Yn[0]=Yn[1]=Ii[0]=Ii[1]=0,Or.viewportWidth=Or.framebufferWidth=Or.drawingBufferWidth=Yn[2]=Ii[2]=Ke.drawingBufferWidth,Or.viewportHeight=Or.framebufferHeight=Or.drawingBufferHeight=Yn[3]=Ii[3]=Ke.drawingBufferHeight}function vs(){Or.tick+=1,Or.time=_i(),Oo(),jn.procs.poll()}function mo(){Oo(),jn.procs.refresh(),Yr&&Yr.update()}function _i(){return(Hi()-Ur)/1e3}mo();function es(Yn,Ii){Me.type(Ii,"function","listener callback must be a function");var Wi;switch(Yn){case"frame":return Ua(Ii);case"lost":Wi=Jt;break;case"restore":Wi=Si;break;case"destroy":Wi=Ye;break;default:Me.raise("invalid event, must be one of frame,lost,restore,destroy")}return Wi.push(Ii),{cancel:function(){for(var go=0;go<Wi.length;++go)if(Wi[go]===Ii){Wi[go]=Wi[Wi.length-1],Wi.pop();return}}}}var Qi=Z(ho,{clear:vo,prop:an.define.bind(null,Kp),context:an.define.bind(null,Hv),this:an.define.bind(null,Wv),draw:ho({}),buffer:function(Yn){return zr.create(Yn,up,!1,!1)},elements:function(Yn){return vn.create(Yn,!1)},texture:pn.create2D,cube:pn.createCube,renderbuffer:br.create,framebuffer:un.create,framebufferCube:un.createCube,vao:cn.createVAO,attributes:Yt,frame:Ua,on:es,limits:sr,hasExtension:function(Yn){return sr.extensions.indexOf(Yn.toLowerCase())>=0},read:ai,destroy:Oi,_gl:Ke,_refresh:mo,poll:function(){vs(),Yr&&Yr.update()},now:_i,stats:Fr});return Ce.onDone(null,Qi),Qi}return jd})},69848:function(Sr){(function(oe,Z){Sr.exports=Z()})(this,function(){"use strict";function oe(Mt,lt,Bt,pt,ur,Ar){if(!(ur-pt<=Bt)){var te=pt+ur>>1;Z(Mt,lt,te,pt,ur,Ar%2),oe(Mt,lt,Bt,pt,te-1,Ar+1),oe(Mt,lt,Bt,te+1,ur,Ar+1)}}function Z(Mt,lt,Bt,pt,ur,Ar){for(;ur>pt;){if(ur-pt>600){var te=ur-pt+1,Ne=Bt-pt+1,k=Math.log(te),ke=.5*Math.exp(2*k/3),Re=.5*Math.sqrt(k*ke*(te-ke)/te)*(Ne-te/2<0?-1:1),ct=Math.max(pt,Math.floor(Bt-Ne*ke/te+Re)),Et=Math.min(ur,Math.floor(Bt+(te-Ne)*ke/te+Re));Z(Mt,lt,Bt,ct,Et,Ar)}var kt=lt[2*Bt+Ar],er=pt,rr=ur;for(ye(Mt,lt,pt,Bt),lt[2*ur+Ar]>kt&&ye(Mt,lt,pt,ur);er<rr;){for(ye(Mt,lt,er,rr),er++,rr--;lt[2*er+Ar]<kt;)er++;for(;lt[2*rr+Ar]>kt;)rr--}lt[2*pt+Ar]===kt?ye(Mt,lt,pt,rr):(rr++,ye(Mt,lt,rr,ur)),rr<=Bt&&(pt=rr+1),Bt<=rr&&(ur=rr-1)}}function ye(Mt,lt,Bt,pt){se(Mt,Bt,pt),se(lt,2*Bt,2*pt),se(lt,2*Bt+1,2*pt+1)}function se(Mt,lt,Bt){var pt=Mt[lt];Mt[lt]=Mt[Bt],Mt[Bt]=pt}function y(Mt,lt,Bt,pt,ur,Ar,te){for(var Ne=[0,Mt.length-1,0],k=[],ke,Re;Ne.length;){var ct=Ne.pop(),Et=Ne.pop(),kt=Ne.pop();if(Et-kt<=te){for(var er=kt;er<=Et;er++)ke=lt[2*er],Re=lt[2*er+1],ke>=Bt&&ke<=ur&&Re>=pt&&Re<=Ar&&k.push(Mt[er]);continue}var rr=Math.floor((kt+Et)/2);ke=lt[2*rr],Re=lt[2*rr+1],ke>=Bt&&ke<=ur&&Re>=pt&&Re<=Ar&&k.push(Mt[rr]);var fn=(ct+1)%2;(ct===0?Bt<=ke:pt<=Re)&&(Ne.push(kt),Ne.push(rr-1),Ne.push(fn)),(ct===0?ur>=ke:Ar>=Re)&&(Ne.push(rr+1),Ne.push(Et),Ne.push(fn))}return k}function de(Mt,lt,Bt,pt,ur,Ar){for(var te=[0,Mt.length-1,0],Ne=[],k=ur*ur;te.length;){var ke=te.pop(),Re=te.pop(),ct=te.pop();if(Re-ct<=Ar){for(var Et=ct;Et<=Re;Et++)V(lt[2*Et],lt[2*Et+1],Bt,pt)<=k&&Ne.push(Mt[Et]);continue}var kt=Math.floor((ct+Re)/2),er=lt[2*kt],rr=lt[2*kt+1];V(er,rr,Bt,pt)<=k&&Ne.push(Mt[kt]);var fn=(ke+1)%2;(ke===0?Bt-ur<=er:pt-ur<=rr)&&(te.push(ct),te.push(kt-1),te.push(fn)),(ke===0?Bt+ur>=er:pt+ur>=rr)&&(te.push(kt+1),te.push(Re),te.push(fn))}return Ne}function V(Mt,lt,Bt,pt){var ur=Mt-Bt,Ar=lt-pt;return ur*ur+Ar*Ar}var ce=function(Mt){return Mt[0]},ae=function(Mt){return Mt[1]},Be=function(lt,Bt,pt,ur,Ar){Bt===void 0&&(Bt=ce),pt===void 0&&(pt=ae),ur===void 0&&(ur=64),Ar===void 0&&(Ar=Float64Array),this.nodeSize=ur,this.points=lt;for(var te=lt.length<65536?Uint16Array:Uint32Array,Ne=this.ids=new te(lt.length),k=this.coords=new Ar(lt.length*2),ke=0;ke<lt.length;ke++)Ne[ke]=ke,k[2*ke]=Bt(lt[ke]),k[2*ke+1]=pt(lt[ke]);oe(Ne,k,ur,0,Ne.length-1,0)};Be.prototype.range=function(lt,Bt,pt,ur){return y(this.ids,this.coords,lt,Bt,pt,ur,this.nodeSize)},Be.prototype.within=function(lt,Bt,pt){return de(this.ids,this.coords,lt,Bt,pt,this.nodeSize)};var ie={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Mt){return Mt}},Ve=Math.fround||function(Mt){return function(lt){return Mt[0]=+lt,Mt[0]}}(new Float32Array(1)),rt=function(lt){this.options=Zr(Object.create(ie),lt),this.trees=new Array(this.options.maxZoom+1)};rt.prototype.load=function(lt){var Bt=this.options,pt=Bt.log,ur=Bt.minZoom,Ar=Bt.maxZoom,te=Bt.nodeSize;pt&&console.time("total time");var Ne="prepare "+lt.length+" points";pt&&console.time(Ne),this.points=lt;for(var k=[],ke=0;ke<lt.length;ke++)!lt[ke].geometry||k.push(Ct(lt[ke],ke));this.trees[Ar+1]=new Be(k,Tr,dr,te,Float32Array),pt&&console.timeEnd(Ne);for(var Re=Ar;Re>=ur;Re--){var ct=+Date.now();k=this._cluster(k,Re),this.trees[Re]=new Be(k,Tr,dr,te,Float32Array),pt&&console.log("z%d: %d clusters in %dms",Re,k.length,+Date.now()-ct)}return pt&&console.timeEnd("total time"),this},rt.prototype.getClusters=function(lt,Bt){var pt=((lt[0]+180)%360+360)%360-180,ur=Math.max(-90,Math.min(90,lt[1])),Ar=lt[2]===180?180:((lt[2]+180)%360+360)%360-180,te=Math.max(-90,Math.min(90,lt[3]));if(lt[2]-lt[0]>=360)pt=-180,Ar=180;else if(pt>Ar){var Ne=this.getClusters([pt,ur,180,te],Bt),k=this.getClusters([-180,ur,Ar,te],Bt);return Ne.concat(k)}for(var ke=this.trees[this._limitZoom(Bt)],Re=ke.range(ir(pt),Ft(te),ir(Ar),Ft(ur)),ct=[],Et=0,kt=Re;Et<kt.length;Et+=1){var er=kt[Et],rr=ke.points[er];ct.push(rr.numPoints?Tt(rr):this.points[rr.index])}return ct},rt.prototype.getChildren=function(lt){var Bt=this._getOriginId(lt),pt=this._getOriginZoom(lt),ur="No cluster with the specified id.",Ar=this.trees[pt];if(!Ar)throw new Error(ur);var te=Ar.points[Bt];if(!te)throw new Error(ur);for(var Ne=this.options.radius/(this.options.extent*Math.pow(2,pt-1)),k=Ar.within(te.x,te.y,Ne),ke=[],Re=0,ct=k;Re<ct.length;Re+=1){var Et=ct[Re],kt=Ar.points[Et];kt.parentId===lt&&ke.push(kt.numPoints?Tt(kt):this.points[kt.index])}if(ke.length===0)throw new Error(ur);return ke},rt.prototype.getLeaves=function(lt,Bt,pt){Bt=Bt||10,pt=pt||0;var ur=[];return this._appendLeaves(ur,lt,Bt,pt,0),ur},rt.prototype.getTile=function(lt,Bt,pt){var ur=this.trees[this._limitZoom(lt)],Ar=Math.pow(2,lt),te=this.options,Ne=te.extent,k=te.radius,ke=k/Ne,Re=(pt-ke)/Ar,ct=(pt+1+ke)/Ar,Et={features:[]};return this._addTileFeatures(ur.range((Bt-ke)/Ar,Re,(Bt+1+ke)/Ar,ct),ur.points,Bt,pt,Ar,Et),Bt===0&&this._addTileFeatures(ur.range(1-ke/Ar,Re,1,ct),ur.points,Ar,pt,Ar,Et),Bt===Ar-1&&this._addTileFeatures(ur.range(0,Re,ke/Ar,ct),ur.points,-1,pt,Ar,Et),Et.features.length?Et:null},rt.prototype.getClusterExpansionZoom=function(lt){for(var Bt=this._getOriginZoom(lt)-1;Bt<=this.options.maxZoom;){var pt=this.getChildren(lt);if(Bt++,pt.length!==1)break;lt=pt[0].properties.cluster_id}return Bt},rt.prototype._appendLeaves=function(lt,Bt,pt,ur,Ar){for(var te=this.getChildren(Bt),Ne=0,k=te;Ne<k.length;Ne+=1){var ke=k[Ne],Re=ke.properties;if(Re&&Re.cluster?Ar+Re.point_count<=ur?Ar+=Re.point_count:Ar=this._appendLeaves(lt,Re.cluster_id,pt,ur,Ar):Ar<ur?Ar++:lt.push(ke),lt.length===pt)break}return Ar},rt.prototype._addTileFeatures=function(lt,Bt,pt,ur,Ar,te){for(var Ne=0,k=lt;Ne<k.length;Ne+=1){var ke=k[Ne],Re=Bt[ke],ct=Re.numPoints,Et=void 0,kt=void 0,er=void 0;if(ct)Et=Xt(Re),kt=Re.x,er=Re.y;else{var rr=this.points[Re.index];Et=rr.properties,kt=ir(rr.geometry.coordinates[0]),er=Ft(rr.geometry.coordinates[1])}var fn={type:1,geometry:[[Math.round(this.options.extent*(kt*Ar-pt)),Math.round(this.options.extent*(er*Ar-ur))]],tags:Et},ar=void 0;ct?ar=Re.id:this.options.generateId?ar=Re.index:this.points[Re.index].id&&(ar=this.points[Re.index].id),ar!==void 0&&(fn.id=ar),te.features.push(fn)}},rt.prototype._limitZoom=function(lt){return Math.max(this.options.minZoom,Math.min(Math.floor(+lt),this.options.maxZoom+1))},rt.prototype._cluster=function(lt,Bt){for(var pt=[],ur=this.options,Ar=ur.radius,te=ur.extent,Ne=ur.reduce,k=ur.minPoints,ke=Ar/(te*Math.pow(2,Bt)),Re=0;Re<lt.length;Re++){var ct=lt[Re];if(!(ct.zoom<=Bt)){ct.zoom=Bt;for(var Et=this.trees[Bt+1],kt=Et.within(ct.x,ct.y,ke),er=ct.numPoints||1,rr=er,fn=0,ar=kt;fn<ar.length;fn+=1){var Dn=ar[fn],hn=Et.points[Dn];hn.zoom>Bt&&(rr+=hn.numPoints||1)}if(rr>er&&rr>=k){for(var nn=ct.x*er,ri=ct.y*er,qn=Ne&&er>1?this._map(ct,!0):null,En=(Re<<5)+(Bt+1)+this.points.length,Ti=0,hi=kt;Ti<hi.length;Ti+=1){var ea=hi[Ti],Tn=Et.points[ea];if(!(Tn.zoom<=Bt)){Tn.zoom=Bt;var kn=Tn.numPoints||1;nn+=Tn.x*kn,ri+=Tn.y*kn,Tn.parentId=En,Ne&&(qn||(qn=this._map(ct,!0)),Ne(qn,this._map(Tn)))}}ct.parentId=En,pt.push(it(nn/rr,ri/rr,En,rr,qn))}else if(pt.push(ct),rr>1)for(var Ea=0,ji=kt;Ea<ji.length;Ea+=1){var ja=ji[Ea],Ha=Et.points[ja];Ha.zoom<=Bt||(Ha.zoom=Bt,pt.push(Ha))}}}return pt},rt.prototype._getOriginId=function(lt){return lt-this.points.length>>5},rt.prototype._getOriginZoom=function(lt){return(lt-this.points.length)%32},rt.prototype._map=function(lt,Bt){if(lt.numPoints)return Bt?Zr({},lt.properties):lt.properties;var pt=this.points[lt.index].properties,ur=this.options.map(pt);return Bt&&ur===pt?Zr({},ur):ur};function it(Mt,lt,Bt,pt,ur){return{x:Ve(Mt),y:Ve(lt),zoom:Infinity,id:Bt,parentId:-1,numPoints:pt,properties:ur}}function Ct(Mt,lt){var Bt=Mt.geometry.coordinates,pt=Bt[0],ur=Bt[1];return{x:Ve(ir(pt)),y:Ve(Ft(ur)),zoom:Infinity,index:lt,parentId:-1}}function Tt(Mt){return{type:"Feature",id:Mt.id,properties:Xt(Mt),geometry:{type:"Point",coordinates:[Rt(Mt.x),xt(Mt.y)]}}}function Xt(Mt){var lt=Mt.numPoints,Bt=lt>=1e4?Math.round(lt/1e3)+"k":lt>=1e3?Math.round(lt/100)/10+"k":lt;return Zr(Zr({},Mt.properties),{cluster:!0,cluster_id:Mt.id,point_count:lt,point_count_abbreviated:Bt})}function ir(Mt){return Mt/360+.5}function Ft(Mt){var lt=Math.sin(Mt*Math.PI/180),Bt=.5-.25*Math.log((1+lt)/(1-lt))/Math.PI;return Bt<0?0:Bt>1?1:Bt}function Rt(Mt){return(Mt-.5)*360}function xt(Mt){var lt=(180-Mt*360)*Math.PI/180;return 360*Math.atan(Math.exp(lt))/Math.PI-90}function Zr(Mt,lt){for(var Bt in lt)Mt[Bt]=lt[Bt];return Mt}function Tr(Mt){return Mt.x}function dr(Mt){return Mt.y}return rt})}}]);

//# sourceMappingURL=4499.31bce187.async.js.map