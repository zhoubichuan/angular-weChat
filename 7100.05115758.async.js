(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7100],{64335:function(Sr,te,N){"use strict";var ye=N(67294),ee=(0,ye.createContext)({});te.Z=ee},21349:function(Sr,te,N){"use strict";var ye=N(84305),ee=N(39559),y=N(85893),le=N(94184),U=N.n(le),ce=N(67294),oe=N(64335),Ue=N(53645),se=N.n(Ue),ze=function(ut){var Ct=(0,ce.useContext)(oe.Z),Kt=ut.children,Yt=ut.contentWidth,nr=ut.className,Jt=ut.style,bt=(0,ce.useContext)(ee.ZP.ConfigContext),vt=bt.getPrefixCls,Dr=ut.prefixCls||vt("pro"),fr=Yt||Ct.contentWidth,sr="".concat(Dr,"-grid-content");return(0,y.jsx)("div",{className:U()(sr,nr,{wide:fr==="Fixed"}),style:Jt,children:(0,y.jsx)("div",{className:"".concat(Dr,"-grid-content-children"),children:Kt})})};te.Z=ze},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Sr){try{let se=function(){U||(U=!0,y())},ze=function(){try{le.documentElement.doScroll("left")}catch(et){return void setTimeout(ze,50)}se()};var oe=se,Ue=ze,te=(te=document.getElementsByTagName("script"))[te.length-1],N=te.getAttribute("data-injectcss"),te=te.getAttribute("data-disable-injectsvg");if(!te){var ye,ee,y,le,U,ce=function(ut,Ct){Ct.parentNode.insertBefore(ut,Ct)};if(N&&!Sr.__iconfont__svg__cssinject__){Sr.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(et){console&&console.log(et)}}ye=function(){var ut,Ct=document.createElement("div");Ct.innerHTML=Sr._iconfont_svg_string_3580659,(Ct=Ct.getElementsByTagName("svg")[0])&&(Ct.setAttribute("aria-hidden","true"),Ct.style.position="absolute",Ct.style.width=0,Ct.style.height=0,Ct.style.overflow="hidden",Ct=Ct,(ut=document.body).firstChild?ce(Ct,ut.firstChild):ut.appendChild(Ct))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(ye,0):(ee=function(){document.removeEventListener("DOMContentLoaded",ee,!1),ye()},document.addEventListener("DOMContentLoaded",ee,!1)):document.attachEvent&&(y=ye,le=Sr.document,U=!1,ze(),le.onreadystatechange=function(){le.readyState=="complete"&&(le.onreadystatechange=null,se())})}}catch(se){}}(window)},39144:function(Sr,te,N){"use strict";N.d(te,{zP:function(){return IL},JE:function(){return Tk},ns:function(){return ML}});var ye={};N.r(ye),N.d(ye,{add:function(){return Zp},adjoint:function(){return Dt},clone:function(){return ft},copy:function(){return Ee},create:function(){return He},determinant:function(){return er},equals:function(){return Vp},exactEquals:function(){return Gv},frob:function(){return Np},fromQuat:function(){return Zv},fromQuat2:function(){return Vf},fromRotation:function(){return Sh},fromRotationTranslation:function(){return ff},fromRotationTranslationScale:function(){return Co},fromRotationTranslationScaleOrigin:function(){return Aa},fromScaling:function(){return Cs},fromTranslation:function(){return Za},fromValues:function(){return Ge},fromXRotation:function(){return Js},fromYRotation:function(){return Kh},fromZRotation:function(){return yu},frustum:function(){return Uv},getRotation:function(){return Nv},getScaling:function(){return jf},getTranslation:function(){return Md},identity:function(){return pt},invert:function(){return ar},lookAt:function(){return To},mul:function(){return Gm},multiply:function(){return yr},multiplyScalar:function(){return wh},multiplyScalarAndAdd:function(){return Oc},ortho:function(){return Gf},orthoNO:function(){return hf},orthoZO:function(){return jv},perspective:function(){return Pd},perspectiveFromFieldOfView:function(){return kd},perspectiveNO:function(){return Id},perspectiveZO:function(){return Vv},rotate:function(){return bn},rotateX:function(){return zn},rotateY:function(){return ti},rotateZ:function(){return Ni},scale:function(){return ai},set:function(){return Se},str:function(){return Rc},sub:function(){return jo},subtract:function(){return Up},targetTo:function(){return Jh},translate:function(){return xn},transpose:function(){return xt}});var ee=N(67294),y=(0,ee.createContext)({});function le(){return(0,ee.useContext)(y)}var U={},ce={},oe=function(i){return ce[i]},Ue=function(i,r){ce[i]=r},se=function(i){return U[i]},ze=function(i,r){U[i]=r},et={},ut={},Ct=34,Kt=10,Yt=13;function nr(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Jt(e,i){var r=nr(e);return function(n,t){return i(r(n),t,e)}}function bt(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var t in n)t in i||r.push(i[t]=t)}),r}function vt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function Dr(e){return e<0?"-"+vt(-e,6):e>9999?"+"+vt(e,6):vt(e,4)}function fr(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),t=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Dr(e.getUTCFullYear(),4)+"-"+vt(e.getUTCMonth()+1,2)+"-"+vt(e.getUTCDate(),2)+(t?"T"+vt(i,2)+":"+vt(r,2)+":"+vt(n,2)+"."+vt(t,3)+"Z":n?"T"+vt(i,2)+":"+vt(r,2)+":"+vt(n,2)+"Z":r||i?"T"+vt(i,2)+":"+vt(r,2)+"Z":"")}function sr(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(S,A){var I,F,D=t(S,function(Z,Y){if(I)return I(Z,Y-1);F=Z,I=A?Jt(Z,A):nr(Z)});return D.columns=F||[],D}function t(S,A){var I=[],F=S.length,D=0,Z=0,Y,ve=F<=0,me=!1;S.charCodeAt(F-1)===Kt&&--F,S.charCodeAt(F-1)===Yt&&--F;function De(){if(ve)return ut;if(me)return me=!1,et;var Je,_t=D,Zt;if(S.charCodeAt(_t)===Ct){for(;D++<F&&S.charCodeAt(D)!==Ct||S.charCodeAt(++D)===Ct;);return(Je=D)>=F?ve=!0:(Zt=S.charCodeAt(D++))===Kt?me=!0:Zt===Yt&&(me=!0,S.charCodeAt(D)===Kt&&++D),S.slice(_t+1,Je-1).replace(/""/g,'"')}for(;D<F;){if((Zt=S.charCodeAt(Je=D++))===Kt)me=!0;else if(Zt===Yt)me=!0,S.charCodeAt(D)===Kt&&++D;else if(Zt!==r)continue;return S.slice(_t,Je)}return ve=!0,S.slice(_t,F)}for(;(Y=De())!==ut;){for(var Be=[];Y!==et&&Y!==ut;)Be.push(Y),Y=De();A&&(Be=A(Be,Z++))==null||I.push(Be)}return I}function o(S,A){return S.map(function(I){return A.map(function(F){return x(I[F])}).join(e)})}function u(S,A){return A==null&&(A=bt(S)),[A.map(x).join(e)].concat(o(S,A)).join(`
`)}function l(S,A){return A==null&&(A=bt(S)),o(S,A).join(`
`)}function p(S){return S.map(v).join(`
`)}function v(S){return S.map(x).join(e)}function x(S){return S==null?"":S instanceof Date?fr(S):i.test(S+="")?'"'+S.replace(/"/g,'""')+'"':S}return{parse:n,parseRows:t,format:u,formatBody:l,formatRows:p,formatRow:v,formatValue:x}}var mt=sr(","),nt=mt.parse,Lt=mt.parseRows,lt=mt.format,Xt=mt.formatBody,_r=mt.formatRows,J=mt.formatRow,Ie=mt.formatValue,V=N(85061),H=N(28991),be=N(38163),tt=N.n(be),ht=63710088e-1,St={centimeters:ht*100,centimetres:ht*100,degrees:ht/111325,feet:ht*3.28084,inches:ht*39.37,kilometers:ht/1e3,kilometres:ht/1e3,meters:ht,metres:ht,miles:ht/1609.344,millimeters:ht*1e3,millimetres:ht*1e3,nauticalmiles:ht/1852,radians:1,yards:ht*1.0936},jt={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ht,yards:1.0936133},tr={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Hr(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function Br(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return Bn(i).geometry;case"LineString":return Vn(i).geometry;case"Polygon":return gn(i).geometry;case"MultiPoint":return Ei(i).geometry;case"MultiLineString":return Mi(i).geometry;case"MultiPolygon":return Gn(i).geometry;default:throw new Error(e+" is invalid")}}function Bn(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!zt(e[0])||!zt(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Hr(n,i,r)}function tn(e,i,r){return r===void 0&&(r={}),bi(e.map(function(n){return Bn(n,i)}),r)}function gn(e,i,r){r===void 0&&(r={});for(var n=0,t=e;n<t.length;n++){var o=t[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return Hr(l,i,r)}function fi(e,i,r){return r===void 0&&(r={}),bi(e.map(function(n){return gn(n,i)}),r)}function Vn(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Hr(n,i,r)}function vn(e,i,r){return r===void 0&&(r={}),bi(e.map(function(n){return Vn(n,i)}),r)}function bi(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function Mi(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Hr(n,i,r)}function Ei(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Hr(n,i,r)}function Gn(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Hr(n,i,r)}function kn(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Hr(n,i,r)}function mo(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function Hi(e,i){i===void 0&&(i="kilometers");var r=St[i];if(!r)throw new Error(i+" units is invalid");return e*r}function ja(e,i){i===void 0&&(i="kilometers");var r=St[i];if(!r)throw new Error(i+" units is invalid");return e/r}function Tt(e,i){return ne(ja(e,i))}function R(e){var i=e%360;return i<0&&(i+=360),i}function ne(e){var i=e%(2*Math.PI);return i*180/Math.PI}function fe(e){var i=e%360;return i*Math.PI/180}function Fe(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Hi(ja(e,i),r)}function ct(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=tr[i];if(!n)throw new Error("invalid original units");var t=tr[r];if(!t)throw new Error("invalid final units");return e/n*t}function zt(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Er(e){return!!e&&e.constructor===Object}function Ne(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!zt(i))throw new Error("bbox must only contain numbers")})}function Et(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function ir(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function xr(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Wr(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Wr(e[0]);throw new Error("coordinates must only contain numbers")}function yn(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Sn(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function En(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,t=e.features;n<t.length;n++){var o=t[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+o.geometry.type)}}function pn(e){return e.type==="Feature"?e.geometry:e}function Kn(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Nn(e,i,r){if(e!==null)for(var n,t,o,u,l,p,v,x=0,S=0,A,I=e.type,F=I==="FeatureCollection",D=I==="Feature",Z=F?e.features.length:1,Y=0;Y<Z;Y++){v=F?e.features[Y].geometry:D?e.geometry:e,A=v?v.type==="GeometryCollection":!1,l=A?v.geometries.length:1;for(var ve=0;ve<l;ve++){var me=0,De=0;if(u=A?v.geometries[ve]:v,u!==null){p=u.coordinates;var Be=u.type;switch(x=r&&(Be==="Polygon"||Be==="MultiPolygon")?1:0,Be){case null:break;case"Point":if(i(p,S,Y,me,De)===!1)return!1;S++,me++;break;case"LineString":case"MultiPoint":for(n=0;n<p.length;n++){if(i(p[n],S,Y,me,De)===!1)return!1;S++,Be==="MultiPoint"&&me++}Be==="LineString"&&me++;break;case"Polygon":case"MultiLineString":for(n=0;n<p.length;n++){for(t=0;t<p[n].length-x;t++){if(i(p[n][t],S,Y,me,De)===!1)return!1;S++}Be==="MultiLineString"&&me++,Be==="Polygon"&&De++}Be==="Polygon"&&me++;break;case"MultiPolygon":for(n=0;n<p.length;n++){for(De=0,t=0;t<p[n].length;t++){for(o=0;o<p[n][t].length-x;o++){if(i(p[n][t][o],S,Y,me,De)===!1)return!1;S++}De++}me++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(Nn(u.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ji(e,i,r,n){var t=r;return Nn(e,function(o,u,l,p,v){u===0&&r===void 0?t=o:t=i(t,o,u,l,p,v)},n),t}function $i(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function go(e,i,r){var n=r;return $i(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function rs(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function qi(e,i,r){var n=r;return rs(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function W(e){var i=[];return Nn(e,function(r){i.push(r)}),i}function K(e,i){var r,n,t,o,u,l,p,v,x,S,A=0,I=e.type==="FeatureCollection",F=e.type==="Feature",D=I?e.features.length:1;for(r=0;r<D;r++){for(l=I?e.features[r].geometry:F?e.geometry:e,v=I?e.features[r].properties:F?e.properties:{},x=I?e.features[r].bbox:F?e.bbox:void 0,S=I?e.features[r].id:F?e.id:void 0,p=l?l.type==="GeometryCollection":!1,u=p?l.geometries.length:1,t=0;t<u;t++){if(o=p?l.geometries[t]:l,o===null){if(i(null,A,v,x,S)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(o,A,v,x,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(i(o.geometries[n],A,v,x,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function ie(e,i,r){var n=r;return K(e,function(t,o,u,l,p){o===0&&r===void 0?n=t:n=i(n,t,o,u,l,p)}),n}function _e(e,i){K(e,function(r,n,t,o,u){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return i(Hr(r,t,{bbox:o,id:u}),n,0)===!1?!1:void 0}var p;switch(l){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var v=0;v<r.coordinates.length;v++){var x=r.coordinates[v],S={type:p,coordinates:x};if(i(Hr(S,t),n,v)===!1)return!1}})}function Le(e,i,r){var n=r;return _e(e,function(t,o,u){o===0&&u===0&&r===void 0?n=t:n=i(n,t,o,u)}),n}function Ke(e,i){_e(e,function(r,n,t){var o=0;if(!!r.geometry){var u=r.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var l,p=0,v=0,x=0;if(Nn(r,function(S,A,I,F,D){if(l===void 0||n>p||F>v||D>x){l=S,p=n,v=F,x=D,o=0;return}var Z=lineString([l,S],r.properties);if(i(Z,n,t,D,o)===!1)return!1;o++,l=S})===!1)return!1}}})}function it(e,i,r){var n=r,t=!1;return Ke(e,function(o,u,l,p,v){t===!1&&r===void 0?n=o:n=i(n,o,u,l,p,v),t=!0}),n}function he(e,i){if(!e)throw new Error("geojson is required");_e(e,function(r,n,t){if(r.geometry!==null){var o=r.geometry.type,u=r.geometry.coordinates;switch(o){case"LineString":if(i(r,n,t,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<u.length;l++)if(i(lineString(u[l],r.properties),n,t,l)===!1)return!1;break}}})}function Oe(e,i,r){var n=r;return he(e,function(t,o,u,l){o===0&&r===void 0?n=t:n=i(n,t,o,u,l)}),n}function wt(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.segmentIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=p.length+o-1),lineString([p[o],p[o+1]],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o-1),lineString([p[t][o],p[t][o+1]],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o-1),lineString([p[n][o],p[n][o+1]],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o-1),lineString([p[n][t][o],p[n][t][o+1]],u,i)}throw new Error("geojson is invalid")}function br(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.coordIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":return point(p,u,i);case"MultiPoint":return n<0&&(n=p.length+n),point(p[n],u,i);case"LineString":return o<0&&(o=p.length+o),point(p[o],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o),point(p[t][o],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o),point(p[n][o],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o),point(p[n][t][o],u,i)}throw new Error("geojson is invalid")}function Mr(e,i){var r=i.x,n=i.y,t=i.x1,o=i.y1,u=i.coordinates,l=i.geometry,p=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(Y){return Y[l]&&Y[l].type&&Y[l].coordinates&&Y[l].coordinates.length>0}).forEach(function(Y,ve){var me=tt()((0,H.Z)({},Y[l]),!0);_e(me,function(De){var Be=xr(De),Je=(0,H.Z)((0,H.Z)({},Y),{},{_id:ve,coordinates:Be});p.push(Je)})}),{dataArray:p};for(var v=0;v<e.length;v++){var x=e[v],S=[];if(u){var A="Polygon";Array.isArray(u[0])||(A="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(A="LineString");var I=tt()({type:A,coordinates:(0,V.Z)(x[u])},!0);S=I.coordinates}else if(r&&n&&t&&o){var F=[parseFloat(x[r]),parseFloat(x[n])],D=[parseFloat(x[t]),parseFloat(x[o])];S=[F,D]}else r&&n&&(S=[parseFloat(x[r]),parseFloat(x[n])]);var Z=(0,H.Z)((0,H.Z)({},x),{},{_id:v,coordinates:S});p.push(Z)}return{dataArray:p}}function Rt(e,i){var r=nt(e);return Mr(r,i)}var mr=N(90484);function mn(e){for(var i=e.toString(),r=5381,n=i.length;n;)r=r*33^i.charCodeAt(--n);return r>>>0}function sn(e,i){return i===void 0?null:(0,mr.Z)(e.properties[i])*1==="number"?e.properties[i]*1:e.properties&&e.properties[i]?mn(e.properties[i]+"")%1000019:null}function Qt(e,i){var r=[],n={};return e.features?(e.features=e.features.filter(function(t){var o=t.geometry;return t!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),tt()(e,!0),e.features.length===0?{dataArray:[],featureKeys:n}:(_e(e,function(t,o){var u=sn(t,i==null?void 0:i.featureId);u===null&&(u=o);var l=u,p=xr(t),v=(0,H.Z)((0,H.Z)({},t.properties),{},{coordinates:p,_id:l});r.push(v)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}var je=N(92137),qr=N(87757),Q=N.n(qr);function ri(e,i,r,n){for(var t=n,o=r-i>>1,u=r-i,l,p=e[i],v=e[i+1],x=e[r],S=e[r+1],A=i+3;A<r;A+=3){var I=en(e[A],e[A+1],p,v,x,S);if(I>t)l=A,t=I;else if(I===t){var F=Math.abs(A-o);F<u&&(l=A,u=F)}}t>n&&(l-i>3&&ri(e,i,l,n),e[l+2]=t,r-l>3&&ri(e,l,r,n))}function en(e,i,r,n,t,o){var u=t-r,l=o-n;if(u!==0||l!==0){var p=((e-r)*u+(i-n)*l)/(u*u+l*l);p>1?(r=t,n=o):p>0&&(r+=u*p,n+=l*p)}return u=e-r,l=i-n,u*u+l*l}function Jn(e,i,r,n){var t={id:typeof e=="undefined"?null:e,type:i,geometry:r,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return Zi(t),t}function Zi(e){var i=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")ni(e,i);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<i.length;n++)ni(e,i[n]);else if(r==="MultiPolygon")for(n=0;n<i.length;n++)for(var t=0;t<i[n].length;t++)ni(e,i[n][t])}function ni(e,i){for(var r=0;r<i.length;r+=3)e.minX=Math.min(e.minX,i[r]),e.minY=Math.min(e.minY,i[r+1]),e.maxX=Math.max(e.maxX,i[r]),e.maxY=Math.max(e.maxY,i[r+1])}function Ii(e,i){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)hi(r,e.features[n],i,n);else e.type==="Feature"?hi(r,e,i):hi(r,{geometry:e},i);return r}function hi(e,i,r,n){if(!!i.geometry){var t=i.geometry.coordinates,o=i.geometry.type,u=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),l=[],p=i.id;if(r.promoteId?p=i.properties[r.promoteId]:r.generateId&&(p=n||0),o==="Point")yo(t,l);else if(o==="MultiPoint")for(var v=0;v<t.length;v++)yo(t[v],l);else if(o==="LineString")Fi(t,l,u,!1);else if(o==="MultiLineString")if(r.lineMetrics){for(v=0;v<t.length;v++)l=[],Fi(t[v],l,u,!1),e.push(Jn(p,"LineString",l,i.properties));return}else ea(t,l,u,!1);else if(o==="Polygon")ea(t,l,u,!0);else if(o==="MultiPolygon")for(v=0;v<t.length;v++){var x=[];ea(t[v],x,u,!0),l.push(x)}else if(o==="GeometryCollection"){for(v=0;v<i.geometry.geometries.length;v++)hi(e,{id:p,geometry:i.geometry.geometries[v],properties:i.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Jn(p,o,l,i.properties))}}function yo(e,i){i.push(vi(e[0])),i.push(si(e[1])),i.push(0)}function Fi(e,i,r,n){for(var t,o,u=0,l=0;l<e.length;l++){var p=vi(e[l][0]),v=si(e[l][1]);i.push(p),i.push(v),i.push(0),l>0&&(n?u+=(t*v-p*o)/2:u+=Math.sqrt(Math.pow(p-t,2)+Math.pow(v-o,2))),t=p,o=v}var x=i.length-3;i[2]=1,ri(i,0,x,r),i[x+2]=1,i.size=Math.abs(u),i.start=0,i.end=i.size}function ea(e,i,r,n){for(var t=0;t<e.length;t++){var o=[];Fi(e[t],o,r,n),i.push(o)}}function vi(e){return e/360+.5}function si(e){var i=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return r<0?0:r>1?1:r}function Qn(e,i,r,n,t,o,u,l){if(r/=i,n/=i,o>=r&&u<n)return e;if(u<r||o>=n)return null;for(var p=[],v=0;v<e.length;v++){var x=e[v],S=x.geometry,A=x.type,I=t===0?x.minX:x.minY,F=t===0?x.maxX:x.maxY;if(I>=r&&F<n){p.push(x);continue}else if(F<r||I>=n)continue;var D=[];if(A==="Point"||A==="MultiPoint")ba(S,D,r,n,t);else if(A==="LineString")Is(S,D,r,n,t,!1,l.lineMetrics);else if(A==="MultiLineString")fa(S,D,r,n,t,!1);else if(A==="Polygon")fa(S,D,r,n,t,!0);else if(A==="MultiPolygon")for(var Z=0;Z<S.length;Z++){var Y=[];fa(S[Z],Y,r,n,t,!0),Y.length&&D.push(Y)}if(D.length){if(l.lineMetrics&&A==="LineString"){for(Z=0;Z<D.length;Z++)p.push(Jn(x.id,A,D[Z],x.tags));continue}(A==="LineString"||A==="MultiLineString")&&(D.length===1?(A="LineString",D=D[0]):A="MultiLineString"),(A==="Point"||A==="MultiPoint")&&(A=D.length===3?"Point":"MultiPoint"),p.push(Jn(x.id,A,D,x.tags))}}return p.length?p:null}function ba(e,i,r,n,t){for(var o=0;o<e.length;o+=3){var u=e[o+t];u>=r&&u<=n&&(i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]))}}function Is(e,i,r,n,t,o,u){for(var l=Qi(e),p=t===0?Du:sa,v=e.start,x,S,A=0;A<e.length-3;A+=3){var I=e[A],F=e[A+1],D=e[A+2],Z=e[A+3],Y=e[A+4],ve=t===0?I:F,me=t===0?Z:Y,De=!1;u&&(x=Math.sqrt(Math.pow(I-Z,2)+Math.pow(F-Y,2))),ve<r?me>r&&(S=p(l,I,F,Z,Y,r),u&&(l.start=v+x*S)):ve>n?me<n&&(S=p(l,I,F,Z,Y,n),u&&(l.start=v+x*S)):Ou(l,I,F,D),me<r&&ve>=r&&(S=p(l,I,F,Z,Y,r),De=!0),me>n&&ve<=n&&(S=p(l,I,F,Z,Y,n),De=!0),!o&&De&&(u&&(l.end=v+x*S),i.push(l),l=Qi(e)),u&&(v+=x)}var Be=e.length-3;I=e[Be],F=e[Be+1],D=e[Be+2],ve=t===0?I:F,ve>=r&&ve<=n&&Ou(l,I,F,D),Be=l.length-3,o&&Be>=3&&(l[Be]!==l[0]||l[Be+1]!==l[1])&&Ou(l,l[0],l[1],l[2]),l.length&&i.push(l)}function Qi(e){var i=[];return i.size=e.size,i.start=e.start,i.end=e.end,i}function fa(e,i,r,n,t,o){for(var u=0;u<e.length;u++)Is(e[u],i,r,n,t,o,!1)}function Ou(e,i,r,n){e.push(i),e.push(r),e.push(n)}function Du(e,i,r,n,t,o){var u=(o-i)/(n-i);return e.push(o),e.push(r+(t-r)*u),e.push(1),u}function sa(e,i,r,n,t,o){var u=(o-r)/(t-r);return e.push(i+(n-i)*u),e.push(o),e.push(1),u}function oo(e,i){var r=i.buffer/i.extent,n=e,t=Qn(e,1,-1-r,r,0,-1,2,i),o=Qn(e,1,1-r,2+r,0,-1,2,i);return(t||o)&&(n=Qn(e,1,-r,1+r,0,-1,2,i)||[],t&&(n=Oa(t,1).concat(n)),o&&(n=n.concat(Oa(o,-1)))),n}function Oa(e,i){for(var r=[],n=0;n<e.length;n++){var t=e[n],o=t.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=Sa(t.geometry,i);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var l=0;l<t.geometry.length;l++)u.push(Sa(t.geometry[l],i))}else if(o==="MultiPolygon")for(u=[],l=0;l<t.geometry.length;l++){for(var p=[],v=0;v<t.geometry[l].length;v++)p.push(Sa(t.geometry[l][v],i));u.push(p)}r.push(Jn(t.id,o,u,t.tags))}return r}function Sa(e,i){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+i,e[n+1],e[n+2]);return r}function Ro(e,i){if(e.transformed)return e;var r=1<<e.z,n=e.x,t=e.y,o,u,l;for(o=0;o<e.features.length;o++){var p=e.features[o],v=p.geometry,x=p.type;if(p.geometry=[],x===1)for(u=0;u<v.length;u+=2)p.geometry.push(Vi(v[u],v[u+1],i,r,n,t));else for(u=0;u<v.length;u++){var S=[];for(l=0;l<v[u].length;l+=2)S.push(Vi(v[u][l],v[u][l+1],i,r,n,t));p.geometry.push(S)}}return e.transformed=!0,e}function Vi(e,i,r,n,t,o){return[Math.round(r*(e*n-t)),Math.round(r*(i*n-o))]}function Oo(e,i,r,n,t){for(var o=i===t.maxZoom?0:t.tolerance/((1<<i)*t.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:i,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){u.numFeatures++,_o(u,e[l],o,t);var p=e[l].minX,v=e[l].minY,x=e[l].maxX,S=e[l].maxY;p<u.minX&&(u.minX=p),v<u.minY&&(u.minY=v),x>u.maxX&&(u.maxX=x),S>u.maxY&&(u.maxY=S)}return u}function _o(e,i,r,n){var t=i.geometry,o=i.type,u=[];if(o==="Point"||o==="MultiPoint")for(var l=0;l<t.length;l+=3)u.push(t[l]),u.push(t[l+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")ns(u,t,e,r,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(l=0;l<t.length;l++)ns(u,t[l],e,r,o==="Polygon",l===0);else if(o==="MultiPolygon")for(var p=0;p<t.length;p++){var v=t[p];for(l=0;l<v.length;l++)ns(u,v[l],e,r,!0,l===0)}if(u.length){var x=i.tags||null;if(o==="LineString"&&n.lineMetrics){x={};for(var S in i.tags)x[S]=i.tags[S];x.mapbox_clip_start=t.start/t.size,x.mapbox_clip_end=t.end/t.size}var A={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:x};i.id!==null&&(A.id=i.id),e.features.push(A)}}function ns(e,i,r,n,t,o){var u=n*n;if(n>0&&i.size<(t?u:n)){r.numPoints+=i.length/3;return}for(var l=[],p=0;p<i.length;p+=3)(n===0||i[p+2]>u)&&(r.numSimplified++,l.push(i[p]),l.push(i[p+1])),r.numPoints++;t&&is(l,o),e.push(l)}function is(e,i){for(var r=0,n=0,t=e.length,o=t-2;n<t;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===i)for(n=0,t=e.length;n<t/2;n+=2){var u=e[n],l=e[n+1];e[n]=e[t-2-n],e[n+1]=e[t-1-n],e[t-2-n]=u,e[t-1-n]=l}}function Gc(e,i){return new Ho(e,i)}function Ho(e,i){i=this.options=Ga(Object.create(this.options),i);var r=i.debug;if(r&&console.time("preprocess data"),i.maxZoom<0||i.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(i.promoteId&&i.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Ii(e,i);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",i.indexMaxZoom,i.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=oo(n,i),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Ho.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ho.prototype.splitTile=function(e,i,r,n,t,o,u){for(var l=[e,i,r,n],p=this.options,v=p.debug;l.length;){n=l.pop(),r=l.pop(),i=l.pop(),e=l.pop();var x=1<<i,S=Da(i,r,n),A=this.tiles[S];if(!A&&(v>1&&console.time("creation"),A=this.tiles[S]=Oo(e,i,r,n,p),this.tileCoords.push({z:i,x:r,y:n}),v)){v>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",i,r,n,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var I="z"+i;this.stats[I]=(this.stats[I]||0)+1,this.total++}if(A.source=e,t){if(i===p.maxZoom||i===t)continue;var F=1<<t-i;if(r!==Math.floor(o/F)||n!==Math.floor(u/F))continue}else if(i===p.indexMaxZoom||A.numPoints<=p.indexMaxPoints)continue;if(A.source=null,e.length!==0){v>1&&console.time("clipping");var D=.5*p.buffer/p.extent,Z=.5-D,Y=.5+D,ve=1+D,me,De,Be,Je,_t,Zt;me=De=Be=Je=null,_t=Qn(e,x,r-D,r+Y,0,A.minX,A.maxX,p),Zt=Qn(e,x,r+Z,r+ve,0,A.minX,A.maxX,p),e=null,_t&&(me=Qn(_t,x,n-D,n+Y,1,A.minY,A.maxY,p),De=Qn(_t,x,n+Z,n+ve,1,A.minY,A.maxY,p),_t=null),Zt&&(Be=Qn(Zt,x,n-D,n+Y,1,A.minY,A.maxY,p),Je=Qn(Zt,x,n+Z,n+ve,1,A.minY,A.maxY,p),Zt=null),v>1&&console.timeEnd("clipping"),l.push(me||[],i+1,r*2,n*2),l.push(De||[],i+1,r*2,n*2+1),l.push(Be||[],i+1,r*2+1,n*2),l.push(Je||[],i+1,r*2+1,n*2+1)}}},Ho.prototype.getTile=function(e,i,r){var n=this.options,t=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;i=(i%u+u)%u;var l=Da(e,i,r);if(this.tiles[l])return Ro(this.tiles[l],t);o>1&&console.log("drilling down to z%d-%d-%d",e,i,r);for(var p=e,v=i,x=r,S;!S&&p>0;)p--,v=Math.floor(v/2),x=Math.floor(x/2),S=this.tiles[Da(p,v,x)];return!S||!S.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",p,v,x),o>1&&console.time("drilling down"),this.splitTile(S.source,p,v,x,e,i,r),o>1&&console.timeEnd("drilling down"),this.tiles[l]?Ro(this.tiles[l],t):null)};function Da(e,i,r){return((1<<e)*r+i)*32+e}function Ga(e,i){for(var r in i)e[r]=i[r];return e}var Mt=N(6610),j=N(5991),P=N(96156),rt=function(){function e(i,r,n,t){(0,Mt.Z)(this,e),(0,P.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=i}return(0,j.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),qt={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function jr(e){for(var i=0,r=0,n=e.length,t=n-1,o,u;r<n;t=r++)o=e[r],u=e[t],i+=(u.x-o.x)*(o.y+u.y);return i}function Tn(e){var i=e.length;if(i<=1)return[e];for(var r=[],n,t,o=0;o<i;o++){var u=jr(e[o]);u!==0&&(t===void 0&&(t=u<0),t===u<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}var Ri=["Unknown","Point","LineString","Polygon"];function Fa(e,i,r,n,t){var o=t.geometry,u=t.type,l=t.tags,p=t.id,v=e*Math.pow(2,n),x=e*i,S=e*r,A=Ri[u],I,F;function D(ve){for(var me=0;me<ve.length;me++){var De=ve[me];if(De[3])break;var Be=180-(De[1]+S)*360/v,Je=(De[0]+x)*360/v-180,_t=360/Math.PI*Math.atan(Math.exp(Be*Math.PI/180))-90;ve[me]=[Je,_t,0,1]}}switch(u){case 1:var Z=[];for(I=0;I<o.length;I++)Z[I]=o[I][0];o=Z,D(o);break;case 2:for(I=0;I<o.length;I++)D(o[I]);break;case 3:for(o=Tn(o),I=0;I<o.length;I++)for(F=0;F<o[I].length;F++)D(o[I][F]);break}o.length===1?o=o[0]:A="Multi"+A;var Y={type:"Feature",geometry:{type:A,coordinates:o},properties:l,id:p,tileOrigin:[0,0],coord:""};return Y}var so=function(){var e=(0,je.Z)(Q().mark(function i(r,n,t,o){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p){var v=n.getTile(r.z,r.x,r.y),x=v?v.features.map(function(I){return Fa(o,t.x,t.y,t.z,I)}):[],S={layers:{defaultLayer:{features:x}}},A=new rt(S,r.x,r.y,r.z);p(A)}));case 1:case"end":return l.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function Ha(e){var i={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?i:(0,H.Z)((0,H.Z)({},i),e.geojsonvtOptions)}function as(e,i){var r=Ha(i),n=r.extent||4096,t=Gc(e,r),o=function(p,v){return so(v,t,p,n)},u=(0,H.Z)((0,H.Z)((0,H.Z)({},qt),i),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}var Xr=N(10379),Jr=N(46070),Qe=N(77608),gs=N(14665);function Fu(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var os=N(51814);function iu(e,i,r){return(0,os.Z)()?iu=Reflect.construct.bind():iu=function(t,o,u){var l=[null];l.push.apply(l,o);var p=Function.bind.apply(t,l),v=new p;return u&&(0,gs.Z)(v,u.prototype),v},iu.apply(null,arguments)}function au(e){var i=typeof Map=="function"?new Map:void 0;return au=function(n){if(n===null||!Fu(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,t)}function t(){return iu(n,arguments,(0,Qe.Z)(this).constructor)}return t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),(0,gs.Z)(t,n)},au(e)}var ss={REGISTERED_PROTOCOLS:{}};function Dl(e){var i=Jo();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function Jo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wa=function(i){return ss.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]},Fl=function(e){(0,Xr.Z)(r,e);var i=Dl(r);function r(n,t,o,u){var l;return(0,Mt.Z)(this,r),l=i.call(this,"AJAXError: ".concat(t," (").concat(n,"): ").concat(o)),l.status=n,l.statusText=t,l.url=o,l.body=u,l}return(0,j.Z)(r)}(au(Error));function hc(e,i){var r=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(var t in e.headers)e.headers.hasOwnProperty(t)&&r.setRequestHeader(t,e.headers[t]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=function(){i(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){var o=r.response;if(e.type==="json")try{o=JSON.parse(r.response)}catch(l){return i(l)}i(null,o,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{var u=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});i(new Fl(r.status,r.statusText,n.toString(),u))}},r.cancel=r.abort,r.send(e.body),r}function Sf(e){return new Promise(function(i,r){hc(e,function(n,t,o,u,l){n?r({err:n,data:null,xhr:l}):i({err:null,data:t,cacheControl:o,expires:u,xhr:l})})})}function ou(e,i){return hc(e,i)}var Bl=function(i,r){var n=wa(i.url)||ou;return n((0,H.Z)((0,H.Z)({},i),{},{type:"json"}),r)},zl=function(i,r){var n=wa(i.url)||ou;return n((0,H.Z)((0,H.Z)({},i),{},{type:"arrayBuffer"}),r)},wf=function(i,r){return ou(_objectSpread(_objectSpread({},i),{},{method:"POST"}),r)};function sh(e){var i=window.document.createElement("a");return i.href=e,i.protocol===window.document.location.protocol&&i.host===window.document.location.host}var Ef="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Af(e,i){var r=new window.Image,n=window.URL||window.webkitURL;r.crossOrigin="anonymous",r.onload=function(){i(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(function(){r.src=Ef})},r.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var t=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(t):Ef}function uh(e,i){var r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(function(n){i(null,n)}).catch(function(n){i(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var ll=function(i,r,n){var t=function(u,l){if(u)r(u);else if(l){var p=typeof createImageBitmap=="function",v=n?n(l):l;p?uh(v,r):Af(v,r)}};return i.type==="json"?Bl(i,t):zl(i,t)},pc=function(i,r){var n=typeof createImageBitmap=="function";n?uh(i,r):Af(i,r)},Cf=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),ma={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hc(e,i,r){var n=e.classList;for(var t in ma)ma.hasOwnProperty(t)&&n.remove("l7-".concat(r,"-anchor-").concat(t));n.add("l7-".concat(r,"-anchor-").concat(i))}var Bu=N(2650);function Zs(e){return typeof e=="string"?!!d3.color(e):!1}function gi(e){var i=Bu.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Mo(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],t=i+r*256+n*65536-1;return t}function Do(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function us(e){var i=window.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=null,t=r.createLinearGradient(0,0,256,1),o=e.positions[0],u=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var p=(e.positions[l]-o)/(u-o);t.addColorStop(p,e.colors[l])}return r.fillStyle=t,r.fillRect(0,0,256,1),n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),i=null,r=null,{data:n,width:256,height:1}}function zu(e,i){var r=window.document.createElement("canvas"),n=r.getContext("2d");r.width=256,r.height=1;for(var t=n.createLinearGradient(0,0,256,1),o=i[1]-i[0],u=0;u<e.colors.length;++u){var l=Math.max((e.positions[u]-i[0])/o,0);t.addColorStop(l,e.colors[u])}n.fillStyle=t,n.fillRect(0,0,256,1);var p=n.getImageData(0,0,256,1).data,v=Ki(n,p);return r=null,n=null,v}function ls(e){var i=window.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;var n=r.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(t,o){var u=gi(e.colors[o]);n.data[t*4+0]=u[0]*255,n.data[t*4+1]=u[1]*255,n.data[t*4+2]=u[2]*255,n.data[t*4+3]=u[3]*255}),i=null,r=null,n}function Wc(e){var i=window.document.createElement("canvas"),r=i.getContext("2d");r.globalAlpha=1,i.width=256,i.height=1;for(var n=256/e.colors.length,t=0;t<e.colors.length;t++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[t],r.moveTo(t*n,0),r.lineTo((t+1)*n,0),r.stroke();var o=r.getImageData(0,0,256,1).data,u=Ki(r,o);return i=null,r=null,u}function lh(e,i){var r=window.document.createElement("canvas"),n=r.getContext("2d");n.globalAlpha=1,r.width=256,r.height=1;var t=i[1]-i[0];e.positions.length-e.colors.length!=1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var o=0;o<e.colors.length;o++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[o],n.moveTo((e.positions[o]-i[0])/t*255,0),n.lineTo((e.positions[o+1]-i[0])/t*255,0),n.stroke();var u=n.getImageData(0,0,256,1).data,l=Ki(n,u);return r=null,n=null,l}function Ki(e,i){for(var r=e.createImageData(256,1),n=0;n<r.data.length;n+=4)r.data[n+0]=i[n+0],r.data[n+1]=i[n+1],r.data[n+2]=i[n+2],r.data[n+3]=i[n+3];return r}function Tf(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var Us={BACK:1029,FRONT:1028};function dc(e){switch(e){case"GAODE1.x":return Us.BACK;case"GAODE2.x":return Us.BACK;case"MAPBOX":return Us.FRONT;case"SIMPLE":return Us.FRONT;case"GLOBEL":return Us.BACK;case"DEBAULT":return Us.FRONT;default:return Us.FRONT}}var Dn=N(28481),Mf=N(74691),Ta=N.n(Mf),Nu=N(50361),Zu=N.n(Nu),Wo=N(23279),$c=N.n(Wo),vc=N(27361),bu=N.n(vc),Su=N(51584),mc=N.n(Su),Vs=N(60442),uo=N.n(Vs),If=N(14293),cl=N.n(If),ta=N(81763),Yc=N.n(ta),Uh=N(68630),Nl=N.n(Uh),ch=N(47037),Pf=N.n(ch),gc=N(36719),Zl=N.n(gc),Uu=N(82492),su=N.n(Uu),Ul=N(30236),fl=N.n(Ul),Vu=N(97019),Xc=N.n(Vu),hl=N(23493),Ps=N.n(hl),kf=N(44908),Lf=N.n(kf),Rf=N(11700),ju=N.n(Rf),Vl=N(23560),yc=N.n(Vl),Gu=N(13218),jl=N.n(Gu),Of=N(52353),Hu=N.n(Of),Df=N(68929),fh=N.n(Df),yi={isNil:cl(),merge:su(),throttle:Ps(),isString:Pf(),debounce:$c(),pull:Xc(),isTypedArray:Zl(),isPlainObject:Nl(),isNumber:Yc(),isBoolean:mc(),isEqual:uo(),cloneDeep:Zu(),uniq:Lf(),clamp:Ta(),upperFirst:ju(),get:bu(),mergeWith:fl(),isFunction:yc(),isObject:jl(),isUndefined:Hu(),camelCase:fh()},Gl=yi.pull;function qc(e){var i=e;return typeof e=="string"&&(i=window.document.getElementById(e)),i}function Kc(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Jc(e){return Kc(e).split(/\s+/)}function pl(e){var i,r,n,t=(i=window)===null||i===void 0||(r=i.document)===null||r===void 0||(n=r.documentElement)===null||n===void 0?void 0:n.style;if(!t)return e[0];for(var o in e)if(e[o]&&e[o]in t)return e[o];return e[0]}function Ai(e,i,r){var n=window.document.createElement(e);return i&&(n.className=i||""),r&&r.appendChild(n),n}function qa(e){var i=e.parentNode;i&&i.removeChild(e)}function Bi(e,i){if(e.classList!==void 0)for(var r=Jc(i),n=0,t=r.length;n<t;n++)e.classList.add(r[n]);else if(!wu(e,i)){var o=mi(e);Eu(e,(o?o+" ":"")+i)}}function js(e,i){if(e.classList!==void 0){var r=Jc(i);r.forEach(function(n){e.classList.remove(n)})}else Eu(e,Kc((" "+mi(e)+" ").replace(" "+i+" "," ")))}function wu(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=mi(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Eu(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function mi(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ua(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var ys=pl(["transform","WebkitTransform"]);function Hl(e,i){e.style[ys]=i}function Wl(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function Qc(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Vh(){var e,i=window.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(t){var o=t.split("="),u=(0,Dn.Z)(o,1),l=u[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var Ba=Vh()<1?1:window.devicePixelRatio;function dl(e,i){e.setAttribute("style","".concat(e.style.cssText).concat(i))}function uu(e){return e.split(";").map(function(i){return i.trim()}).filter(function(i){return i})}function Wu(e,i){var r,n=uu((r=e.getAttribute("style"))!==null&&r!==void 0?r:""),t=uu(i),o=Gl.apply(void 0,[n].concat((0,V.Z)(t)));e.setAttribute("style",o.join(";"))}function Ma(e){return Object.entries(e).map(function(i){var r=(0,Dn.Z)(i,2),n=r[0],t=r[1];return"".concat(n,": ").concat(t)}).join(";")}function $o(e,i){return{left:e.left-i.left,top:e.top-i.top,right:i.left+i.width-e.left-e.width,bottom:i.top+i.height-e.top-e.height}}function Au(e,i){e.checked=i,i?e.setAttribute("checked","true"):e.removeAttribute("checked")}function ha(e){e.innerHTML=""}function cn(e){e.setAttribute("draggable","false")}function Ka(e,i){if(typeof i=="string"){var r=document.createElement("div");for(r.innerHTML=i;r.firstChild;)e.append(r.firstChild)}else Array.isArray(i)?e.append.apply(e,(0,V.Z)(i)):e.append(i)}var vl;function ml(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function ks(){return typeof importScripts=="function"}var _s=ks()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},Gs=(vl=navigator)===null||vl===void 0?void 0:vl.userAgent,Pr=!!Gs.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Ff=Gs.indexOf("Android")>-1||Gs.indexOf("Adr")>-1;function _c(){for(var e=Gs,i=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],r=!0,n=0,t=i;n<t.length;n++){var o=t[n];if(e.indexOf(o)>0){r=!1;break}}return r}function lu(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var Ls=null;function Fo(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return Nn(e,function(r){i[0]>r[0]&&(i[0]=r[0]),i[1]>r[1]&&(i[1]=r[1]),i[2]<r[0]&&(i[2]=r[0]),i[3]<r[1]&&(i[3]=r[1])}),i}Fo.default=Fo;var ef=Fo;function $l(e){return typeof e=="number"}var Bo=2*Math.PI*6378137/2;function Cu(e,i){var r=(0,Dn.Z)(i,4),n=r[0],t=r[1],o=r[2],u=r[3];return e.lng>n&&e.lng<=o&&e.lat>t&&e.lat<=u}function tf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;gl(i,n)}),i}function gl(e,i){return Array.isArray(i[0])?i.forEach(function(r){gl(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function hh(e,i){return xc(e,i)}function xc(e,i){return Array.isArray(e[0])?e.map(function(r){return xc(r,i)}):i(e)}function cs(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=xo(e,i);var n=e[0],t=e[1],o=n*Bo/180,u=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return u=u*Bo/180,r.enable&&(o=Number(o.toFixed(r.decimal)),u=Number(u.toFixed(r.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function Rs(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],t=r/Bo*180,o=n/Bo*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),i!=null&&(t=Number(t.toFixed(i)),o=Number(o.toFixed(i))),e.length===3?[t,o,e[2]]:[t,o]}function pi(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function cu(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function xo(e,i){if(i===!1)return e;var r=pi(e[0]),n=cu(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function zi(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,t=Math.PI/180,o=e[0]*t,u=r*t;u=Math.log(Math.tan(Math.PI/4+u/2));var l=.5/Math.PI,p=.5,v=-.5/Math.PI;return t=.5,o=n*(l*o+p),u=n*(v*u+t),[Math.floor(o),Math.floor(u)]}function yl(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,t=.5,o=256<<20,u=_slicedToArray(e,2),l=u[0],p=u[1];l=(l/o-r)/i,p=(p/o-t)/n,p=(Math.atan(Math.pow(Math.E,p))-Math.PI/4)*2,t=Math.PI/180;var v=p/t,x=l/t;return[x,v]}function $u(e,i){var r=85.0511287798,n=Math.PI/180,t=6378137;return i=Math.max(Math.min(r,i),-r),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*t,i*t]}function Hs(e,i){var r=Math.PI/180,n=6378137,t=e/n/r,o=2*(Math.atan(Math.exp(i/n))-Math.PI/4)/r;return[t,o]}function zo(e,i,r){var n=fe(i[1]-e[1]),t=fe(i[0]-e[0]),o=fe(e[1]),u=fe(i[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(t/2),2)*Math.cos(o)*Math.cos(u);return Hi(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),r="meters")}function bc(e){var i=Math.PI/180,r=85.0511287798,n=6378137,t=Math.max(Math.min(r,e[1]),-r),o=Math.sin(t*i),u=n*e[0]*i,l=n*Math.log((1+o)/(1-o))/2;return[u,l]}function An(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function dn(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Yu(e){return[[e[0],e[1]],[e[2],e[3]]]}function Io(e){var i=Wa(e,[0,0]);return[e[0]/i,e[1]/i]}function Wa(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function bo(e,i){return e[0]*i[0]+e[1]*i[1]}function Ws(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function fu(e,i){return Math.acos(bo(e,i)/(Ws(e)*Ws(i)))*180/Math.PI}function Yl(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function Oi(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,t=[],o=0;o<e.length-1;o++){var u=e[o],l=e[o+1],p=Wa(u,l);n+=p;var v=[u[0]-l[0],u[1]-l[1]],x=Yl(r,v);if(o>0){var S=t[o-1].rotation;S-x>360-S+x&&(x=x+360)}t.push({start:u,end:l,dis:p,rotation:x,duration:0})}return t.map(function(A){A.duration=i*(A.dis/n)}),t}}function ra(e){if($l(e[0]))return e;if($l(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if($l(e[0][0][0])){var i=e,r=0,n=0,t=0;return i.forEach(function(o){o.forEach(function(u){r+=u[0],n+=u[1],t++})}),[r/t,n/t,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Bf(e){for(var i=e[0],r=e[1],n=e[0],t=e[1],o=0,u=0,l=0,p=0;p<e.length;p+=2){var v=e[p],x=e[p+1];v&&x&&(i=Math.max(v,i),r=Math.max(x,r),n=Math.min(v,n),t=Math.min(x,t),o+=v,u+=x,l++)}return{center:[o/l,u/l],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-t,2))/2}}function Xu(e){return ef(bi([Vn(e)]))}function zf(e){var i=131,r=137,n=0;e+="x";for(var t=Math.floor(9007199254740991/r),o=0;o<e.length;o++)n>t&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(o);return n}function Tu(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}function Qo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=Math.random()*16|0,r=e==="x"?i:i&3|8;return r.toString(16)})}var Sc=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function Mu(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=r;return u&&(l=Math.round(r*(o-1))/(o-1)),n?rf(e,i,l,n,t):rf(e,i,l,.314,t)}function _l(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function Xl(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function ql(e,i,r){var n=[i[0]-e[0],i[1]-e[1]],t=Xl(n,[0,0]),o=Math.atan2(n[1],n[0]),u=t/2/Math.cos(r),l=o+r,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function rf(e,i,r,n,t){if(t===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(i[0],i[1]),l=ql(o,u,n),p=[o[0],l[0],u[0]],v=[o[1],l[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(_l(p,r),_l(v,r))),[0])}else{var x=ql(e,i,n),S=[e[0],x[0],i[0]],A=[e[1],x[1],i[1]];return[_l(S,r),_l(A,r),0]}}function wc(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=r;return u&&(l=Math.round(r*29)/29),Ju(e,i,l,t)}function qu(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=calDistance(r,[0,0]),t=Math.atan2(r[1],r[0]),o=.314,u=n/2/Math.cos(o),l=t+o,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function Ec(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function Ku(e,i){var r=[e[0]-i[0],e[1]-i[1]],n=[Math.sin(r[0]/2),Math.sin(r[1]/2)],t=n[1]*n[1]+Math.cos(e[1])*Math.cos(i[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t))}function Ju(e,i,r,n){var t=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(i[0]),degreesToRadians(i[1])];if(n==="GAODE2.x"){var u=qu(t,o),l=[t[0],u[0],o[0]],p=[t[1],u[1],o[1]];return[Ec(l,r),Ec(p,r),0]}else{var v=Ku(t,o);if(Math.abs(v-Math.PI)<.001)return[(1-r)*t[0]+r*o[0],(1-r)*t[1]+r*o[1]];var x=Math.sin((1-r)*v)/Math.sin(v),S=Math.sin(r*v)/Math.sin(v),A=[Math.sin(t[0]),Math.sin(t[1])],I=[Math.cos(t[0]),Math.cos(t[1])],F=[Math.sin(o[0]),Math.sin(o[1])],D=[Math.cos(o[0]),Math.cos(o[1])],Z=x*I[1]*I[0]+S*D[1]*D[0],Y=x*I[1]*A[0]+S*D[1]*F[0],ve=x*A[1]+S*F[1];return[radiansToDegrees(Math.atan2(Y,Z)),radiansToDegrees(Math.atan2(ve,Math.sqrt(Z*Z+Y*Y)))]}}function Ac(e,i){for(var r=0,n=[],t=0;t<e.length-1;t++){var o=e[t],u=e[t+1],l=Os(o,u),p=r;r+=l,n.push({p1:o,p2:u,totalDistance:r,distance:l,lastTotalDistance:p})}for(var v=r*i,x,S,A=0,I=n;A<I.length;A++){var F=I[A],D=F.totalDistance;if(D>v){var Z=F.p1,Y=F.p2,ve=(v-F.lastTotalDistance)/F.distance,me=$s(Y,Z,ve);x=me[0],S=me[1];break}}return{lng:x,lat:S,height:0}}function $s(e,i,r){return[e[0]*r+i[0]*(1-r),e[1]*r+i[1]*(1-r)]}function Os(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function nf(e,i){var r=i.featureId,n=e.data.dataArray;return typeof r=="number"&&(n=n.filter(function(t){var o=t.id;return o===r})),n.map(function(t){var o=Nf(t,i);return _objectSpread(_objectSpread({},t),o)})}function af(e,i){return new Promise(function(r){e.inited?r(nf(e,i)):e.once("update",function(){r(nf(e,i))})})}function Nf(e,i){var r=i.offset,n=i.shape,t=i.thetaOffset,o=i.mapVersion,u=i.segmentNumber,l=u===void 0?30:u,p=i.autoFit,v=p===void 0?!0:p,x=e.coordinates;if(n==="line")return pathLineAtOffset(x,r);var S=x[0],A=x[1],I=typeof t=="string"?e[t]||0:t,F;switch(n){case"arc":F=arcLineAtOffset;break;case"greatcircle":F=greatCircleLineAtOffset;break;default:F=arcLineAtOffset}var D=F(S,A,r,I,o,l,v),Z=_slicedToArray(D,3),Y=Z[0],ve=Z[1],me=Z[2];return{lng:Y,lat:ve,height:me}}var of=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,Mt.Z)(this,e),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,j.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(t){return t===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function f(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function d(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function h(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function g(e){if(e.length===0)throw new Error("mean requires at least one data point");return h(e)/e.length}function w(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,t=1,o=1;o<e.length+1;o++)e[o]!==i?(t>n&&(n=t,r=i),t=1,i=e[o]):t++;return r*1}var C={min:d,max:f,mean:g,sum:h,mode:w};function T(e,i){return e.map(function(r){return r[i]})}function L(e,i){return C[e](i)}var k=N(63349);function X(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),t=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[r,n],l=[r,o],p=[t,o],v=[t,n];return gn([[u,v,p,l,u]],i.properties,{bbox:e,id:i.id})}var ae=N(26729),de=N.n(ae),ge=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),Te=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),Re=0,We=1,Ae=2;function $e(e){e.forEach(function(i){i.isCurrent&&(i.isVisible=i.isLoaded)})}function ot(e){e.forEach(function(i){i.properties.state=Re}),e.forEach(function(i){i.isCurrent&&!Gt(i)&&Bt(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&Ae)})}function At(e){e.forEach(function(r){r.properties.state=Re}),e.forEach(function(r){r.isCurrent&&Gt(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&Ae),r.children.length&&(r.isVisible||r.properties.state&We)?r.children.forEach(function(n){n.properties.state=We}):r.isCurrent&&Bt(r)})}function Gt(e){for(;e;){if(e.isLoaded)return e.properties.state|=Ae,!0;e=e.parent}return!1}function Bt(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=Ae:Bt(i)})}var Ut,hr=256,Zr=[-Infinity,-Infinity,Infinity,Infinity],kr=.2,rn=5,Cn=(Ut={},(0,P.Z)(Ut,ge.Realtime,$e),(0,P.Z)(Ut,ge.Overlap,ot),(0,P.Z)(Ut,ge.Replace,At),Ut),Ln=function(){};function Mn(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),t=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,t]}function Ci(e,i,r){var n=e/Math.pow(2,r)*360-180,t=Math.PI-2*Math.PI*i/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)));return[n,o]}var nn=function(i,r,n){var t=Ci(i,r,n),o=(0,Dn.Z)(t,2),u=o[0],l=o[1],p=Ci(i+1,r+1,n),v=(0,Dn.Z)(p,2),x=v[0],S=v[1];return[u,S,x,l]};function $n(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,t=n===void 0?Infinity:n,o=e.minZoom,u=o===void 0?0:o,l=e.zoomOffset,p=l===void 0?0:l,v=e.extent,x=v===void 0?Zr:v,S=Math.ceil(i)+p;if(Number.isFinite(u)&&S<u)return[];Number.isFinite(t)&&S>t&&(S=t);for(var A=(0,Dn.Z)(r,4),I=A[0],F=A[1],D=A[2],Z=A[3],Y=[Math.max(I,x[0]),Math.max(F,x[1]),Math.min(D,x[2]),Math.min(Z,x[3])],ve=[],me=Mn(Y[0],Y[1],S),De=(0,Dn.Z)(me,2),Be=De[0],Je=De[1],_t=Mn(Y[2],Y[3],S),Zt=(0,Dn.Z)(_t,2),$t=Zt[0],dr=Zt[1],lr=Be;lr<=$t;lr++)for(var Yr=dr;Yr<=Je;Yr++)ve.push({x:lr,y:Yr,z:S});var un=($t+Be)/2,In=(Je+dr)/2,Gi=function(Va,ao){return Math.abs(Va-un)+Math.abs(ao-In)};return ve.sort(function(Ra,Va){return Gi(Ra.x,Ra.y)-Gi(Va.x,Va.y)}),ve}var ii=function(i,r,n){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,o=Math.pow(2,n),u=o-1,l=o,p=i,v=r;return t&&(p<0?p=p+l:p>u&&(p=p%l)),{warpX:p,warpY:v}};function Yn(e){var i=Wn();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function Wn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oi=function(e){(0,Xr.Z)(r,e);var i=Yn(r);function r(n){var t;(0,Mt.Z)(this,r),t=i.call(this),(0,P.Z)((0,k.Z)(t),"tileSize",256),(0,P.Z)((0,k.Z)(t),"isVisible",!1),(0,P.Z)((0,k.Z)(t),"isCurrent",!1),(0,P.Z)((0,k.Z)(t),"isVisibleChange",!1),(0,P.Z)((0,k.Z)(t),"loadedLayers",0),(0,P.Z)((0,k.Z)(t),"isLayerLoaded",!1),(0,P.Z)((0,k.Z)(t),"isLoad",!1),(0,P.Z)((0,k.Z)(t),"isChildLoad",!1),(0,P.Z)((0,k.Z)(t),"parent",null),(0,P.Z)((0,k.Z)(t),"children",[]),(0,P.Z)((0,k.Z)(t),"data",null),(0,P.Z)((0,k.Z)(t),"properties",{}),(0,P.Z)((0,k.Z)(t),"loadDataId",0);var o=n.x,u=n.y,l=n.z,p=n.tileSize,v=n.warp,x=v===void 0?!0:v;return t.x=o,t.y=u,t.z=l,t.warp=x||!0,t.tileSize=p,t}return(0,j.Z)(r,[{key:"isLoading",get:function(){return this.loadStatus===Te.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Te.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Te.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Te.Cancelled}},{key:"isDone",get:function(){return[Te.Loaded,Te.Cancelled,Te.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return nn(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,Dn.Z)(this.bounds,4),o=t[0],u=t[1],l=t[2],p=t[3],v=[(l-o)/2,(p-u)/2],x=X(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return x}},{key:"key",get:function(){var t="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return t}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,je.Z)(Q().mark(function o(u){var l,p,v,x,S,A,I,F,D,Z,Y,ve,me,De,Be,Je,_t;return Q().wrap(function($t){for(;;)switch($t.prev=$t.next){case 0:return l=u.getData,p=u.onLoad,v=u.onError,this.loadDataId++,x=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Te.Loading,S=null,$t.prev=7,I=this.x,F=this.y,D=this.z,Z=this.bounds,Y=this.tileSize,ve=this.warp,me=ii(I,F,D,ve),De=me.warpX,Be=me.warpY,Je=this.abortController.signal,_t={x:De,y:Be,z:D,bounds:Z,tileSize:Y,signal:Je,warp:ve},$t.next=14,l(_t,this);case 14:S=$t.sent,$t.next=20;break;case 17:$t.prev=17,$t.t0=$t.catch(7),A=$t.t0;case 20:if(x===this.loadDataId){$t.next=22;break}return $t.abrupt("return");case 22:if(!(this.isCancelled&&!S)){$t.next=24;break}return $t.abrupt("return");case 24:if(!(A||!S)){$t.next=28;break}return this.loadStatus=Te.Failure,v(A,this),$t.abrupt("return");case 28:this.loadStatus=Te.Loaded,this.data=S,p(this);case 31:case"end":return $t.stop()}},o,this,[[7,17]])}));function t(o){return n.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Te.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(ae.EventEmitter),Hn=function(i,r){var n=Yu(i),t=An(n,r),o=360*3-180,u=85.0511287798065,l=[Math.max(t[0][0],-o),Math.max(t[0][1],-u),Math.min(t[1][0],o),Math.min(t[1][1],u)];return l},Zn=function(i,r){var n=Yu(i),t=Yu(r),o=dn(n,t);return o};function aa(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ga(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function ga(e,i){if(!!e){if(typeof e=="string")return So(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return So(e,i)}}function So(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function lo(e){var i=ya();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function ya(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ia=yi.throttle,Ja=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),No=function(e){(0,Xr.Z)(r,e);var i=lo(r);function r(n){var t;return(0,Mt.Z)(this,r),t=i.call(this),(0,P.Z)((0,k.Z)(t),"currentTiles",[]),(0,P.Z)((0,k.Z)(t),"cacheTiles",new Map),(0,P.Z)((0,k.Z)(t),"throttleUpdate",Ia(function(o,u){t.update(o,u)},16)),(0,P.Z)((0,k.Z)(t),"onTileLoad",function(o){t.emit(Ja.TileLoaded,o),t.updateTileVisible(),t.loadFinished()}),(0,P.Z)((0,k.Z)(t),"onTileError",function(o,u){t.emit(Ja.TileError,{error:o,tile:u}),t.updateTileVisible(),t.loadFinished()}),(0,P.Z)((0,k.Z)(t),"onTileUnload",function(o){t.emit(Ja.TileUnload,o),t.loadFinished()}),t.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:Zr,getTileData:Ln,warp:!0,updateStrategy:ge.Overlap},t.updateOptions(n),t}return(0,j.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(t){return t.isDone})}},{key:"tiles",get:function(){var t=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return t}},{key:"updateOptions",value:function(t){var o=t.minZoom===void 0?this.options.minZoom:Math.ceil(t.minZoom),u=t.maxZoom===void 0?this.options.maxZoom:Math.floor(t.maxZoom);this.options=(0,H.Z)((0,H.Z)((0,H.Z)({},this.options),t),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(t,o){var u=this,l=Math.max(0,Math.ceil(t));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&Zn(this.lastViewStates.latLonBoundsBuffer,o))){var p=Hn(o,kr);this.lastViewStates={zoom:l,latLonBounds:o,latLonBoundsBuffer:p},this.currentZoom=l;var v=!1,x=this.getTileIndices(l,p).filter(function(S){return u.options.warp||S.x>=0&&S.x<Math.pow(2,l)});this.emit(Ja.TilesLoadStart),this.currentTiles=x.map(function(S){var A=S.x,I=S.y,F=S.z,D=u.getTile(A,I,F);if(D){var Z,Y,ve=((Z=D)===null||Z===void 0?void 0:Z.isFailure)||((Y=D)===null||Y===void 0?void 0:Y.isCancelled);return ve&&D.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),D}return D=u.createTile(A,I,F),v=!0,D}),v&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t=aa(this.cacheTiles),o;try{for(t.s();!(o=t.n()).done;){var u=(0,Dn.Z)(o.value,2),l=u[0],p=u[1];if(!this.currentTiles.includes(p)){this.cacheTiles.delete(l),this.onTileUnload(p);return}this.onTileUnload(p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(v){t.e(v)}finally{t.f()}}},{key:"reloadTileById",value:function(t,o,u){var l=this.cacheTiles.get("".concat(o,",").concat(u,",").concat(t));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(t,o,u){var l=this.getTileByLngLat(t,o,u);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(t,o){var u=this,l=this.getTileIndices(o,t);l.forEach(function(p){u.reloadTileById(p.z,p.x,p.y)})}},{key:"pruneRequests",value:function(){var t=[],o=aa(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&t.push(l)}}catch(v){o.e(v)}finally{o.f()}for(;t.length>0;){var p=t.shift();p.abortLoad()}}},{key:"getTileByLngLat",value:function(t,o,u){var l=this.options.zoomOffset,p=Math.ceil(u)+l,v=Mn(t,o,p),x=this.tiles.filter(function(S){return S.key==="".concat(v[0],"_").concat(v[1],"_").concat(p)});return x[0]}},{key:"getTileExtent",value:function(t,o){return this.getTileIndices(o,t)}},{key:"getTileByZXY",value:function(t,o,u){var l=this.tiles.filter(function(p){return p.key==="".concat(o,"_").concat(u,"_").concat(t)});return l[0]}},{key:"clear",value:function(){var t=aa(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.isLoading?u.abortLoad():this.onTileUnload(u)}}catch(l){t.e(l)}finally{t.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t=this.options.updateStrategy,o=new Map,u=aa(this.cacheTiles.values()),l;try{for(u.s();!(l=u.n()).done;){var p=l.value;o.set(p.key,p.isVisible),p.isCurrent=!1,p.isVisible=!1}}catch(F){u.e(F)}finally{u.f()}var v=aa(this.currentTiles),x;try{for(v.s();!(x=v.n()).done;){var S=x.value;S.isCurrent=!0,S.isVisible=!0}}catch(F){v.e(F)}finally{v.f()}var A=Array.from(this.cacheTiles.values());typeof t=="function"?t(A):Cn[t](A);var I=!1;Array.from(this.cacheTiles.values()).forEach(function(F){F.isVisible!==o.get(F.key)?(F.isVisibleChange=!0,I=!0):F.isVisibleChange=!1}),I&&this.emit(Ja.TileUpdate)}},{key:"getTileIndices",value:function(t,o){var u=this.options,l=u.tileSize,p=u.extent,v=u.zoomOffset,x=Math.floor(this.options.maxZoom),S=Math.ceil(this.options.minZoom),A=$n({maxZoom:x,minZoom:S,zoomOffset:v,tileSize:l,zoom:t,latLonBounds:o,extent:p});return A}},{key:"getTileId",value:function(t,o,u){var l="".concat(t,",").concat(o,",").concat(u);return l}},{key:"loadFinished",value:function(){var t=!this.currentTiles.some(function(o){return!o.isDone});return t&&this.emit(Ja.TilesLoadFinished),t}},{key:"getTile",value:function(t,o,u){var l=this.getTileId(t,o,u),p=this.cacheTiles.get(l);return p}},{key:"createTile",value:function(t,o,u){var l=this.getTileId(t,o,u),p=new oi({x:t,y:o,z:u,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),p}},{key:"resizeCacheTiles",value:function(){var t=rn*this.currentTiles.length,o=this.cacheTiles.size>t;if(o){var u=aa(this.cacheTiles),l;try{for(u.s();!(l=u.n()).done;){var p=(0,Dn.Z)(l.value,2),v=p[0],x=p[1];if(!x.isVisible&&!this.currentTiles.includes(x)&&(this.cacheTiles.delete(v),this.onTileUnload(x)),this.cacheTiles.size<=t)break}}catch(S){u.e(S)}finally{u.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var t=aa(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(S){t.e(S)}finally{t.f()}var l=aa(this.cacheTiles.values()),p;try{for(l.s();!(p=l.n()).done;){var v=p.value,x=this.getNearestAncestor(v.x,v.y,v.z);v.parent=x,x!=null&&x.children&&x.children.push(v)}}catch(S){l.e(S)}finally{l.f()}}},{key:"getNearestAncestor",value:function(t,o,u){for(;u>this.options.minZoom;){t=Math.floor(t/2),o=Math.floor(o/2),u=u-1;var l=this.getTile(t,o,u);if(l)return l}return null}}]),r}(de());function Qu(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Zo(e){var i=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),t=r[2].charCodeAt(0),o;for(o=n;o<=t;++o)i.push(e.replace(r[0],String.fromCharCode(o)));return i}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){for(var u=parseInt(r[2],10),l=parseInt(r[1],10);l<=u;l++)i.push(e.replace(r[0],l.toString()));return i}return i.push(e),i}function Uo(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,t=i.z,o=Zo(e),u=Math.abs(r+n)%o.length,l=wa(o[u])?"".concat(o[u],"/{z}/{x}/{y}"):o[u];return l.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,t.toString()).replace(/\{bbox\}/g,nn(r,n,t).join(",")).replace(/\{-y\}/g,(Math.pow(2,t)-n-1).toString())}function xs(e,i){var r=i.x,n=i.y,t=i.z,o=i.layer,u=i.version,l=u===void 0?"1.0.0":u,p=i.style,v=p===void 0?"default":p,x=i.format,S=i.service,A=S===void 0?"WMTS":S,I=i.tileMatrixset,F="".concat(e,"&SERVICE=").concat(A,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(o,"&STYLE=").concat(v,"&TILEMATRIXSET=").concat(I,"&FORMAT=").concat(x,"&TILECOL=").concat(r,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(t);return F}function Ys(e,i){if(!e)throw new Error(i||"web worker helper assertion failed.")}var bs={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},el=bs.self||bs.window||{},xl=bs.window||bs.self||{},Cc=bs.self||bs.window||{},hu=bs.document||{},Kl=typeof importScripts=="function",Ds=typeof window!="undefined"&&typeof window.orientation!="undefined",Pa=function(){function e(i,r){var n=this;this.name=i,this.workerThread=r,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(t,o){n.resolve=t,n.reject=o})}return e.prototype.postMessage=function(i,r){this.workerThread.postMessage({source:"Main thread",type:i,payload:r})},e.prototype.done=function(i){Ys(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(i)},e.prototype.error=function(i){Ys(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(i)},e}(),pu=Pa,Ss=new Map;function es(e){Ys(e.source&&!e.url||!e.source&&e.url);var i=Ss.get(e.source||e.url);return i||(e.url&&(i=ki(e.url),Ss.set(e.url,i)),e.source&&(i=co(e.source),Ss.set(e.source,i))),Ys(i),i}function ki(e){if(!e.startsWith("http"))return e;var i=wo(e);return co(i)}function co(e){var i=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(i)}function wo(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function ws(e,i,r){i===void 0&&(i=!0);var n=r||new Set;if(e){if(tl(e))n.add(e);else if(tl(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(i&&typeof e=="object")for(var t in e)ws(e[t],i,n)}}return r===void 0?Array.from(n):[]}function tl(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var Fs=function(){},bl=function(){function e(i){this.terminated=!1,this.loadableURL="";var r=i.name,n=i.source,t=i.url;Ys(n||t),this.name=r,this.source=n,this.url=t,this.onMessage=Fs,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=Fs,this.onError=Fs,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(i,r){r=r||ws(i),this.worker.postMessage(i,r)},e.prototype.getErrorFromErrorEvent=function(i){var r="Failed to load ";return r+="worker "+this.name+" from "+this.url+". ",i.message&&(r+=i.message+" in "),i.lineno&&(r+=":"+i.lineno+":"+i.colno),new Error(r)},e.prototype.createBrowserWorker=function(){var i=this;this.loadableURL=es({source:this.source,url:this.url});var r=new Worker(this.loadableURL,{name:this.name});return r.onmessage=function(n){n.data?i.onMessage(n.data):i.onError(new Error("No data received"))},r.onerror=function(n){i.onError(i.getErrorFromErrorEvent(n)),i.terminated=!0},r.onmessageerror=function(n){return console.error("worker "+i.name+", message error: "+n)},r},e}(),Iu=bl,rl=function(){return rl=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},rl.apply(this,arguments)},Xs=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},Sl=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Zf=function(){function e(i){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=i.source,this.url=i.url,this.setProps(i)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(i){return i.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(i){this.props=rl(rl({},this.props),i),i.name!==void 0&&(this.name=i.name),i.maxConcurrency!==void 0&&(this.maxConcurrency=i.maxConcurrency),i.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=i.maxMobileConcurrency),i.reuseWorkers!==void 0&&(this.reuseWorkers=i.reuseWorkers),i.onDebug!==void 0&&(this.onDebug=i.onDebug)},e.prototype.startJob=function(i,r,n){return r===void 0&&(r=function(t,o,u){return t.done(u)}),n===void 0&&(n=function(t,o){return t.error(o)}),Xs(this,void 0,void 0,function(){var t,o=this;return Sl(this,function(u){switch(u.label){case 0:return t=new Promise(function(l){return o.jobQueue.push({name:i,onMessage:r,onError:n,onStart:l}),o}),this.startQueuedJob(),[4,t];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return Xs(this,void 0,void 0,function(){var i,r,n;return Sl(this,function(t){switch(t.label){case 0:if(!this.jobQueue.length)return[2];if(i=this.getAvailableWorker(),!i)return[2];if(r=this.jobQueue.shift(),!r)return[3,4];this.onDebug({message:"Starting job",name:r.name,backlog:this.jobQueue.length,workerThread:i}),n=new pu(r.name,i),i.onMessage=function(o){return r.onMessage(n,o.type,o.payload)},i.onError=function(o){return r.onError(n,o)},r.onStart(n),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n.result];case 2:return t.sent(),[3,4];case 3:return this.returnWorkerToQueue(i),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(i){var r=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();r?(i.destroy(),this.count--):this.idleQueue.push(i),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var i=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Iu({name:i,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return Ds?this.maxMobileConcurrency:this.maxConcurrency},e}(),du=Zf,za=function(){return za=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},za.apply(this,arguments)},Mp=function(e){var i=typeof Symbol=="function"&&Symbol.iterator,r=i&&e[i],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},Ip={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},xd=function(){function e(i){this.workerPools=new Map,this.props=za({},Ip),this.setProps(i),this.workerPools=new Map}return e.isSupported=function(){return Iu.isSupported()},e.getWorkerFarm=function(i){return i===void 0&&(i={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(i),e.workerFarm},e.prototype.destroy=function(){var i,r;try{for(var n=Mp(this.workerPools.values()),t=n.next();!t.done;t=n.next()){var o=t.value;o.destroy()}}catch(u){i={error:u}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},e.prototype.setProps=function(i){var r,n;this.props=za(za({},this.props),i);try{for(var t=Mp(this.workerPools.values()),o=t.next();!o.done;o=t.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=t.return)&&n.call(t)}finally{if(r)throw r.error}}},e.prototype.getWorkerPool=function(i){var r=i.name,n=i.source,t=i.url,o=this.workerPools.get(r);return o||(o=new du({name:r,source:n,url:t}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(r,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),bd=null,ph=new Map,Pv=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(i){self.onmessage=function(r){if(!!Pp(r)){var n=r.data,t=n.type,o=n.payload;i(t,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(i){var r=ph.get(i);r||(r=function(n){if(!!Pp(n)){var t=n.data,o=t.type,u=t.payload;i(o,u)}}),self.addEventListener("message",r)},e.removeEventListener=function(i){var r=ph.get(i);ph.delete(i),self.removeEventListener("message",r)},e.postMessage=function(i,r){if(self){var n={source:"Worker thread",type:i,payload:r},t=ws(r);self.postMessage(n,t)}},e}(),Tc=null;function Pp(e){var i=e.type,r=e.data;return i==="message"&&r&&typeof r.source=="string"&&r.source==="Main thread"}function jh(e){return JSON.parse(kp(e))}function kp(e){var i=new Set;return JSON.stringify(e,function(r,n){if(typeof n=="object"&&n!==null){if(i.has(n))try{return JSON.parse(JSON.stringify(n))}catch(t){return}i.add(n)}return n})}function Jl(e){return""+e.name}function dh(e,i){i===void 0&&(i={});var r=i[e.id]||{},n=e.name+".worker.js",t=r.workerUrl;return i._workerType==="test"&&(t=e.module+"/dist/"+n),t||(t="https://unpkg.com/"+e.module+"/dist/"+n),assert(t),t}var Lp=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},Rp=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}};function kv(e,i){return WorkerFarm.isSupported()?e.worker&&(i==null?void 0:i.worker):!1}function Lv(e,i,r,n){return r===void 0&&(r={}),n===void 0&&(n={}),Lp(this,void 0,void 0,function(){var t,o,u,l,p,v,x,S;return Rp(this,function(A){switch(A.label){case 0:return t=getWorkerName(e),o=getWorkerURL(e,r),u=WorkerFarm.getWorkerFarm(r),l=u.getWorkerPool({name:t,url:o}),p=r.jobName||e.name,[4,l.startJob(p,Sd.bind(null,n))];case 1:return v=A.sent(),x=removeNontransferableOptions(r),v.postMessage("process",{input:i,options:x}),[4,v.result];case 2:return S=A.sent(),[2,S.result]}})})}function Sd(e,i,r,n){return Lp(this,void 0,void 0,function(){var t,o,u,l,p,v,x;return Rp(this,function(S){switch(S.label){case 0:switch(t=r,t){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return i.done(n),[3,9];case 2:return i.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,l=n.options,S.label=4;case 4:return S.trys.push([4,6,,7]),e.process?[4,e.process(u,l)]:(i.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return p=S.sent(),i.postMessage("done",{id:o,result:p}),[3,7];case 6:return v=S.sent(),x=v instanceof Error?v.message:"unknown error",i.postMessage("error",{id:o,error:x}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+r),S.label=9;case 9:return[2]}})})}var Rv=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(i){return this.enqueue(i)},e.prototype.enqueue=function(i){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var r=this._settlers.shift();i instanceof Error?r.reject(i):r.resolve({value:i})}else this._values.push(i)},e.prototype.close=function(){for(;this._settlers.length>0;){var i=this._settlers.shift();i.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var i=this;if(this._values.length>0){var r=this._values.shift();return r instanceof Error?Promise.reject(r):Promise.resolve({done:!1,value:r})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,t){i._settlers.push({resolve:n,reject:t})})},e}(),Ov=null,Gh=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},wd=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Ql=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e[Symbol.asyncIterator],r;return i?i.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(u){return new Promise(function(l,p){u=e[o](u),t(l,p,u.done,u.value)})}}function t(o,u,l,p){Promise.resolve(p).then(function(v){o({value:v,done:l})},u)}},vh=0,pa,ec;function Hh(e,i){var r=this;if(typeof self!="undefined"){var n={process:Mc};WorkerBody.onmessage=function(t,o){return Gh(r,void 0,void 0,function(){var u,l,p,v,x,S,A,I,F,D,Z;return wd(this,function(Y){switch(Y.label){case 0:switch(Y.trys.push([0,19,,20]),u=t,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return l=Y.sent(),WorkerBody.postMessage("done",{result:l}),[3,18];case 3:if(!i)throw new Error("Worker does not support batched processing");pa=new AsyncQueue,ec=o.options||{},p=i(pa,ec,n),Y.label=4;case 4:Y.trys.push([4,9,10,15]),v=Ql(p),Y.label=5;case 5:return[4,v.next()];case 6:if(x=Y.sent(),!!x.done)return[3,8];S=x.value,WorkerBody.postMessage("output-batch",{result:S}),Y.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return A=Y.sent(),D={error:A},[3,15];case 10:return Y.trys.push([10,,13,14]),x&&!x.done&&(Z=v.return)?[4,Z.call(v)]:[3,12];case 11:Y.sent(),Y.label=12;case 12:return[3,14];case 13:if(D)throw D.error;return[7];case 14:return[7];case 15:return WorkerBody.postMessage("done",{}),[3,18];case 16:return pa.push(o.input),[3,18];case 17:return pa.close(),[3,18];case 18:return[3,20];case 19:return I=Y.sent(),F=I instanceof Error?I.message:"",WorkerBody.postMessage("error",{error:F}),[3,20];case 20:return[2]}})})}}}function Mc(e,i){return i===void 0&&(i={}),new Promise(function(r,n){var t=vh++,o=function(l,p){if(p.id===t)switch(l){case"done":WorkerBody.removeEventListener(o),r(p.result);break;case"error":WorkerBody.removeEventListener(o),n(p.error);break;default:}};WorkerBody.addEventListener(o);var u={id:t,input:e,options:i};WorkerBody.postMessage("process",u)})}var tc=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},wl=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},sf={};function mh(e,i,r){return i===void 0&&(i=null),r===void 0&&(r={}),tc(this,void 0,void 0,function(){return wl(this,function(n){switch(n.label){case 0:return i&&(e=rc(e,i,r)),sf[e]=sf[e]||uf(e),[4,sf[e]];case 1:return[2,n.sent()]}})})}function rc(e,i,r){if(e.startsWith("http"))return e;var n=r.modules||{};return n[e]?n[e]:r.CDN?(assert(r.CDN.startsWith("http")),r.CDN+"/"+i+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+i+"/src/libs/"+e}function uf(e){return tc(this,void 0,void 0,function(){var i,r,n;return wl(this,function(t){switch(t.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return i=t.sent(),[4,i.arrayBuffer()];case 2:return[2,t.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return r=t.sent(),[4,r.text()];case 5:return n=t.sent(),[2,Ic(n,e)]}})})}function Ic(e,i){if(isWorker)return eval.call(global,e),null;var r=document.createElement("script");r.id=i;try{r.appendChild(document.createTextNode(e))}catch(n){r.text=e}return document.body.appendChild(r),null}var gh="0.0.3",nc={id:"null",name:"null",module:"web-worker-helper",options:{}};function Pc(e){var i=e.color;return!i||!i.length?[1,1,1,1]:i}function El(e,i,r){return r.length===2?[r[0],r[1],0]:[r[0],r[1],r[2]]}function yh(e){var i=e.filter;return i?[1]:[0]}function Al(e,i){return[i]}var Cl=N(9187),Qa=N.n(Cl),Lr=N(31437),_h=Lr.create(),Dv=Lr.create(),Po=Lr.create(),fs=Lr.create(),vu=Lr.create();function xh(e,i,r,n,t){Lr.add(e,r,n),Lr.normalize(e,e),i=Lr.fromValues(-e[1],e[0]);var o=Lr.fromValues(-r[1],r[0]);return[t/Lr.dot(i,o),i]}function Tl(e,i){return Lr.set(e,-i[1],i[0])}function kc(e,i,r){return Lr.sub(e,i,r),Lr.normalize(e,e),e}function Uf(e,i){return e[0]===i[0]&&e[1]===i[1]}function Fv(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var nl=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Mt.Z)(this,e),(0,P.Z)(this,"lastFlip",-1),(0,P.Z)(this,"miter",Lr.fromValues(0,0)),(0,P.Z)(this,"started",!1),(0,P.Z)(this,"dash",!1),(0,P.Z)(this,"totalDistance",0),(0,P.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,j.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],I=r[l];I.push((v=n[l][2])!==null&&v!==void 0?v:0);var F=n[l],D=l<r.length-1?[].concat((0,V.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,Z=l<n.length-1?n[l+1]:null,Y=this.segment_gaode2(t,u,S,I,D,A,F,Z);u+=Y}if(this.dash)for(var ve=0;ve<t.positions.length/6;ve++)t.positions[ve*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],I=r[l];I.push((v=n[l][2])!==null&&v!==void 0?v:0);var F=n[l],D=l<r.length-1?[].concat((0,V.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,Z=l<n.length-1?n[l+1]:null,Y=this.simpleSegment(t,u,S,I,D,A,F,Z);u+=Y}if(this.dash)for(var ve=0;ve<t.positions.length/6;ve++)t.positions[ve*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,t,o,u,l,p,v){var x=0,S=r.indices,A=r.positions,I=r.normals,F=this.cap==="square",D=this.join==="bevel",Z=zi([p[0],p[1]]),Y=zi([l[0],l[1]]);kc(Po,o,t);var ve=0;if(this.dash&&(ve=this.lineSegmentDistance(Z,Y),this.totalDistance+=ve),this.normal||(this.normal=Lr.create(),Tl(this.normal,Po)),!this.started)if(this.started=!0,F){var me=Lr.create(),De=Lr.create();Lr.add(me,this.normal,Po),Lr.add(De,this.normal,Po),I.push(De[0],De[1],0),I.push(me[0],me[1],0),A.push(t[0],t[1],t[2]|0,this.totalDistance-ve,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),A.push(t[0],t[1],t[2]|0,this.totalDistance-ve,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,I,t,this.normal,this.thickness,this.totalDistance-ve);if(S.push(n+0,n+1,n+2),u){Uf(o,u)&&Lr.add(u,o,Lr.normalize(u,Lr.subtract(u,o,t))),kc(fs,u,o);var _t=xh(vu,Lr.create(),Po,fs,this.thickness),Zt=(0,Dn.Z)(_t,2),$t=Zt[0],dr=Zt[1],lr=Lr.dot(vu,this.normal)<0?-1:1,Yr=D;if(!Yr&&this.join==="miter"){var un=$t;un>this.miterLimit&&(Yr=!0)}Yr?(I.push(this.normal[0],this.normal[1],0),I.push(dr[0],dr[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*lr,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*lr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,S.push.apply(S,(0,V.Z)(this.lastFlip!==-lr?[n,n+2,n+3]:[n+2,n+1,n+3])),S.push(n+2,n+3,n+4),Tl(_h,fs),Lr.copy(this.normal,_h),I.push(this.normal[0],this.normal[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*lr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(A,I,o,dr,$t,this.totalDistance),S.push.apply(S,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),lr=-1,Lr.copy(this.normal,dr),x+=2),this.lastFlip=lr}else{if(Tl(this.normal,Po),F){var Be=Lr.create(),Je=Lr.create();Lr.sub(Je,Po,this.normal),Lr.add(Be,Po,this.normal),I.push(Je[0],Je[1],0),I.push(Be[0],Be[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,I,o,this.normal,this.thickness,this.totalDistance);S.push.apply(S,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"simpleSegment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=zi([o[0],o[1]]),A=zi([t[0],t[1]]);kc(Po,S,A);var I=0;if(this.dash&&(I=this.lineSegmentDistance(S,A),this.totalDistance+=I),this.normal||(this.normal=Lr.create(),Tl(this.normal,Po)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-I)),p.push(n+0,n+1,n+2),!u)Tl(this.normal,Po),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var F=zi([u[0],u[1]]);Uf(S,F)&&Lr.add(F,S,Lr.normalize(F,Lr.subtract(F,S,A))),kc(fs,F,S);var D=xh(vu,Lr.create(),Po,fs,this.thickness),Z=(0,Dn.Z)(D,2),Y=Z[0],ve=Z[1],me=Lr.dot(vu,this.normal)<0?-1:1;this.extrusions(v,x,o,ve,Y,this.totalDistance),p.push.apply(p,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),me=-1,Lr.copy(this.normal,ve),l+=2,this.lastFlip=me}return l}},{key:"segment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=this.cap==="square",A=this.join==="bevel",I=zi([o[0],o[1]]),F=zi([t[0],t[1]]);kc(Po,I,F);var D=0;if(this.dash&&(D=this.lineSegmentDistance(I,F),this.totalDistance+=D),this.normal||(this.normal=Lr.create(),Tl(this.normal,Po)),!this.started)if(this.started=!0,S){var Z=Lr.create(),Y=Lr.create();Lr.add(Z,this.normal,Po),Lr.add(Y,this.normal,Po),x.push(Y[0],Y[1],0),x.push(Z[0],Z[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-D,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-D,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-D);if(p.push(n+0,n+1,n+2),u){var De=zi([u[0],u[1]]);Uf(I,De)&&Lr.add(De,I,Lr.normalize(De,Lr.subtract(De,I,F))),kc(fs,De,I);var Be=xh(vu,Lr.create(),Po,fs,this.thickness),Je=(0,Dn.Z)(Be,2),_t=Je[0],Zt=Je[1],$t=Lr.dot(vu,this.normal)<0?-1:1,dr=A;if(!dr&&this.join==="miter"){var lr=_t;lr>this.miterLimit&&(dr=!0)}dr?(x.push(this.normal[0],this.normal[1],0),x.push(Zt[0],Zt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,V.Z)(this.lastFlip!==-$t?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),Tl(_h,fs),Lr.copy(this.normal,_h),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Zt,_t,this.totalDistance),p.push.apply(p,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),$t=-1,Lr.copy(this.normal,Zt),l+=2),this.lastFlip=$t}else{if(Tl(this.normal,Po),S){var ve=Lr.create(),me=Lr.create();Lr.sub(me,Po,this.normal),Lr.add(ve,Po,this.normal),x.push(me[0],me[1],0),x.push(ve[0],ve[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,t,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,l,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,l,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}(),il=85.0511287798;function ic(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new nl({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(A){t.extrude(A)})}var S=t.complex;return{vertices:S.positions,indices:S.indices,normals:S.normals,indexes:S.indexes,size:6}}function qs(e){var i=ra(e.coordinates);return{vertices:[].concat((0,V.Z)(i),(0,V.Z)(i),(0,V.Z)(i),(0,V.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Lc(e){var i=e.coordinates,r=Qa().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes,u=Qa()(n,o,t);return{indices:u,vertices:n,size:t}}function mu(e,i){var r=i;return i>il&&(r=il),i<-il&&(r=-il),[Math.PI*e/180+Math.PI,Math.PI-Math.log(Math.tan(Math.PI*.25+Math.PI*r/180*.5))]}function Wh(e,i){return[(e-Math.PI)*180/Math.PI,(Math.atan(Math.exp(Math.PI-i))-Math.PI*.25)*2*180/Math.PI]}var Op=function(){var e=(0,je.Z)(Q().mark(function i(r){var n,t,o,u,l,p,v,x,S;return Q().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.iconMap,l={a_Color:Pc,a_Position:El,filter:yh,a_vertexId:Al,a_PickingColor:function(D){var Z=D.id;return o?Do(Z):[0,0,0]},a_DistanceAndIndex:function(D,Z,Y,ve,me,De){return De===void 0?[Y[3],10]:[Y[3],De]},a_Total_Distance:function(D,Z,Y){return[Y[5]]},a_Size:function(D){var Z=D.size,Y=Z===void 0?1:Z;return Array.isArray(Y)?[Y[0],Y[1]]:[Y,0]},a_Normal:function(D,Z,Y,ve,me){return me},a_Miter:function(D,Z,Y){return[Y[4]]},a_iconMapUV:function(D){var Z=D.texture,Y=u[Z]||{x:0,y:0},ve=Y.x,me=Y.y;return[ve,me]}},p={sizePerElement:0,elements:[]},v=0,x=[],S=3,t.forEach(function(F,D){var Z=ic(F),Y=Z.indices,ve=Z.vertices,me=Z.normals,De=Z.size,Be=Z.indexes;Y.forEach(function($t){x.push($t+v)}),S=De;var Je=ve.length/De;p.sizePerElement=S,p.elements.push({featureIdx:D,vertices:ve,normals:me,offset:v}),v+=Je;for(var _t=function(dr){var lr=(me==null?void 0:me.slice(dr*3,dr*3+3))||[],Yr=ve.slice(dr*De,dr*De+De),un=0;Be&&Be[dr]!==void 0&&(un=Be[dr]),n.forEach(function(In){if(In&&l[In.name]){var Gi;(Gi=In.buffer.data).push.apply(Gi,(0,V.Z)(l[In.name](F,D,Yr,dr,lr,un)))}})},Zt=0;Zt<Je;Zt++)_t(Zt)}),I.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return I.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),Es=function(){var e=(0,je.Z)(Q().mark(function i(r){var n,t,o,u,l,p,v,x,S;return Q().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.shape2d,l={a_Color:Pc,a_Position:El,filter:yh,a_vertexId:Al,a_PickingColor:function(D){var Z=D.id;return o?Do(Z):[0,0,0]},a_Shape:function(D){var Z=D.shape,Y=Z===void 0?2:Z,ve=u.indexOf(Y);return[ve]},a_Extrude:function(D,Z,Y,ve){var me=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],De=ve%4*3;return[me[De],me[De+1],me[De+2]]},a_Size:function(D){var Z=D.size,Y=Z===void 0?5:Z;return Array.isArray(Y)?[Y[0]]:[Y]}},p={sizePerElement:0,elements:[]},v=0,x=[],S=3,t.forEach(function(F,D){var Z=qs(F),Y=Z.indices,ve=Z.vertices,me=Z.normals,De=Z.size,Be=Z.indexes;Y.forEach(function($t){x.push($t+v)}),S=De;var Je=ve.length/De;p.sizePerElement=S,p.elements.push({featureIdx:D,vertices:ve,normals:me,offset:v}),v+=Je;for(var _t=function(dr){var lr=(me==null?void 0:me.slice(dr*3,dr*3+3))||[],Yr=ve.slice(dr*De,dr*De+De),un=0;Be&&Be[dr]!==void 0&&(un=Be[dr]),n.forEach(function(In){if(In&&l[In.name]){var Gi;(Gi=In.buffer.data).push.apply(Gi,(0,V.Z)(l[In.name](F,D,Yr,dr,lr,un)))}})},Zt=0;Zt<Je;Zt++)_t(Zt)}),I.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return I.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),gu=function(){var e=(0,je.Z)(Q().mark(function i(r){var n,t,o,u,l,p,v,x;return Q().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u={a_Color:Pc,a_Position:El,filter:yh,a_vertexId:Al,a_PickingColor:function(F){var D=F.id;return o?Do(D):[0,0,0]}},l={sizePerElement:0,elements:[]},p=0,v=[],x=3,t.forEach(function(I,F){var D=Lc(I),Z=D.indices,Y=D.vertices,ve=D.normals,me=D.size,De=D.indexes;Z.forEach(function(Zt){v.push(Zt+p)}),x=me;var Be=Y.length/me;l.sizePerElement=x,l.elements.push({featureIdx:F,vertices:Y,normals:ve,offset:p}),p+=Be;for(var Je=function($t){var dr=(ve==null?void 0:ve.slice($t*3,$t*3+3))||[],lr=Y.slice($t*me,$t*me+me),Yr=0;De&&De[$t]!==void 0&&(Yr=De[$t]),n.forEach(function(un){if(un&&u[un.name]){var In;(In=un.buffer.data).push.apply(In,(0,V.Z)(u[un.name](I,F,lr,$t,dr,Yr)))}})},_t=0;_t<Be;_t++)Je(_t)}),A.abrupt("return",{descriptors:n,featureLayout:l,indices:v});case 8:case"end":return A.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),eo={pointFill:Es,line:Op,polygonFill:gu},As=(0,H.Z)({},eo);function Ed(e){return $h.apply(this,arguments)}function $h(){return $h=_asyncToGenerator(_regeneratorRuntime.mark(function e(i){var r,n;return _regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=i.workerType,n=i.data,!As[r]){o.next=3;break}return o.abrupt("return",As[r](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(r,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),$h.apply(this,arguments)}var Dp=new Map;function Ad(e,i){Dp.set(e,i)}function hs(e){var i=Dp.get(e);return i}var lf="l7-worker",Fp=3,Bp=!0;function Bv(e){registerWorkerSource(lf,e)}function zp(){var e=getWorkerSource(lf);if(!e)throw new Error("get worker failed by workerName: ".concat(lf,"."));return e}function zv(e,i){return bh.apply(this,arguments)}function bh(){return bh=_asyncToGenerator(_regeneratorRuntime.mark(function e(i,r){var n,t,o,u,l;return _regeneratorRuntime.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=zp(),t=WorkerFarm.getWorkerFarm({maxConcurrency:Fp,reuseWorkers:Bp}),o=t.getWorkerPool({name:lf,source:n}),v.next=5,o.startJob(lf,function(x,S,A){return x.done(A)});case 5:return u=v.sent,u.postMessage("process",{input:{workerType:i,data:r}}),v.next=9,u.result;case 9:return l=v.sent,v.abrupt("return",l.result);case 11:case"end":return v.stop()}},e)})),bh.apply(this,arguments)}function Yh(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,t=new Promise(function(u){e instanceof HTMLImageElement||ml(e)?u([e]):Xh(e,function(l){u(l)})}),o={originData:e,images:t,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function Xh(e,i){var r=e,n=[];if(typeof r=="string")ll({url:r},function(u,l){l&&(n.push(l),i(n))});else{var t=r.length,o=0;r.forEach(function(u){ll({url:u},function(l,p){o++,p&&n.push(p),o===t&&i(n)})})}return Yh}var Cd=N(38929),Td=N(3614),cf=N.n(Td),qh=function(){function e(i,r,n,t){(0,Mt.Z)(this,e),(0,P.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=new Cd.VectorTile(new(cf())(i))}return(0,j.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];if(Array.isArray(n.features))return this.vectorLayerCache[r]=n.features,n.features;for(var t=[],o=0;o<n.length;o++){var u=n.feature(o),l=u.toGeoJSON(this.x,this.y,this.z);t.push((0,H.Z)((0,H.Z)({},l),{},{properties:(0,H.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[r]=t,t}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),z={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},xe=function(){var e=(0,je.Z)(Q().mark(function i(r,n,t,o,u){var l;return Q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=Uo(r,n),v.abrupt("return",new Promise(function(x){if(u)u({x:t.x,y:t.y,z:t.z},function(A,I){if(A||!I)x(void 0);else{var F=new qh(I,t.x,t.y,t.z);x(F)}});else{var S=zl((0,H.Z)((0,H.Z)({},o),{},{url:l}),function(A,I){if(A||!I)x(void 0);else{var F=new qh(I,t.x,t.y,t.z);x(F)}});t.xhrCancel=function(){return S.cancel()}}}));case 2:case"end":return v.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function Ce(e,i){var r=Array.isArray(e)?e[0]:e,n=function(u,l){return xe(r,u,l,i==null?void 0:i.requestParameters,i==null?void 0:i.getCustomData)},t=(0,H.Z)((0,H.Z)((0,H.Z)({},z),i),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:t,isTile:!0}}function Ft(e,i,r){switch(e){case"+":return i+r;case"-":return i-r;case"*":return i*r;case"/":return i/r;case"%":return i%r;case"^":return Math.pow(i,r);case"abs":return Math.abs(i);case"floor":return Math.floor(i);case"round":return Math.round(i);case"ceil":return Math.ceil(i);case"sin":return Math.sin(i);case"cos":return Math.cos(i);case"atan":return r===-1?Math.atan(i):Math.atan2(i,r);case"min":return Math.min(i,r);case"max":return Math.max(i,r);case"log10":return Math.log(i);case"log2":return Math.log2(i);default:return console.warn("Calculate symbol err! Return default 0"),0}}function rr(e,i){for(var r=i[0],n=r.width,t=r.height,o=i.map(function(I){return I.rasterData}),u=n*t,l=[],p=JSON.stringify(e),v=0;v<u;v++){var x=JSON.parse(p),S=kt(x,o,v);if(typeof S=="number")l.push(S);else{var A=wr(x);l.push(A)}}return l}function kt(e,i,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return i[e[1]][r]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,t){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[t]=i[n[1]][r]}catch(o){console.warn("Raster Data err!"),e[t]=0}break;default:kt(n,i,r)}})}function Wt(e){var i=(0,Dn.Z)(e,3),r=i[0],n=i[1],t=n===void 0?-1:n,o=i[2],u=o===void 0?-1:o;if(r===void 0)return console.warn("Express err!"),["+",0,0];var l=r.replace(/\s+/g,"");return[l,t,u]}function wr(e){var i=Wt(e),r=i[0],n=i[1],t=i[2];return Array.isArray(n)&&(n=wr(e[1])),Array.isArray(t)&&(t=wr(e[2])),Ft(r,n,t)}var Ir={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:Rr}};function Rr(e,i){for(var r=e[0].rasterData,n=e[1].rasterData,t=e[2].rasterData,o=[],u=(i==null?void 0:i.countCut)||[2,98],l=(0,Dn.Z)(u,2),p=l[0],v=l[1],x=(i==null?void 0:i.RMinMax)||Cr(r,p,v),S=(i==null?void 0:i.GMinMax)||Cr(n,p,v),A=(i==null?void 0:i.BMinMax)||Cr(t,p,v),I=0;I<r.length;I++)o.push(Math.max(0,r[I]-x[0])),o.push(Math.max(0,n[I]-S[0])),o.push(Math.max(0,t[I]-A[0]));return{rasterData:o,rMinMax:x,gMinMax:S,bMinMax:A}}function Cr(e,i,r){var n=e.slice().sort(function(l,p){return l-p}),t=n.length,o=n[Math.ceil(t*i/100)],u=n[Math.ceil(t*r/100)];return[o,u]}function zr(e,i,r){return $r.apply(this,arguments)}function $r(){return $r=(0,je.Z)(Q().mark(function e(i,r,n){var t,o,u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(i.length!==0){S.next=2;break}return S.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return S.next=4,Promise.all(i.map(function(A){var I=A.data,F=A.bands,D=F===void 0?[0]:F;return r(I,D)}));case 4:t=S.sent,o=[],t.forEach(function(A){Array.isArray(A)?o.push.apply(o,(0,V.Z)(A)):o.push(A)}),u=o[0],l=u.width,p=u.height,S.t0=(0,mr.Z)(n),S.next=S.t0==="function"?11:S.t0==="object"?13:15;break;case 11:return v=n(o),S.abrupt("break",16);case 13:return Array.isArray(n)?v={rasterData:rr(n,o)}:v=Ar(n,o),S.abrupt("break",16);case 15:v={rasterData:o[0].rasterData};case 16:return S.abrupt("return",(0,H.Z)((0,H.Z)({},v),{},{width:l,height:p}));case 17:case"end":return S.stop()}},e)})),$r.apply(this,arguments)}function Ar(e,i){var r=Ir[e.type];if(r.type==="function")return r.method(i,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?Ur(r.expression,i):{rasterData:rr(r.expression,i)}}function Ur(e,i){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var r=rr(e.r||["band",0],i),n=rr(e.g||["band",0],i),t=rr(e.b||["band",0],i);return[r,n,t]}function gt(e,i,r,n){return Vt.apply(this,arguments)}function Vt(){return Vt=(0,je.Z)(Q().mark(function e(i,r,n,t){var o;return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,zr(i,r,n);case 2:o=l.sent,t(null,{data:o});case 4:case"end":return l.stop()}},e)})),Vt.apply(this,arguments)}function Tr(e,i){return e.map(function(r){return r[i]*1})}function Qr(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function vr(e){return Array.isArray(e)?e.length===0?!1:!!Qr(e[0]):!1}function an(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function gr(e,i){var r=i.extent,n=i.width,t=i.height,o=i.min,u=i.max,l=i.format,p=i.operation,v,x,S;if(l===void 0||an(e))v=Array.from(e),x=n,S=t;else{var A=Array.isArray(e)?e:[e];v=zr(A,l,p)}var I={_id:1,dataArray:[{_id:1,data:v,width:x,height:S,min:o,max:u,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return I}var Gr=N(28660),at=N(86700),Nr=N(84879),qe={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Rn=N(49296),Vr=N.n(Rn);function pr(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ur(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function ur(e,i){if(!!e){if(typeof e=="string")return jn(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jn(e,i)}}function jn(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var On=30;function _n(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,t=e.buffer,o=e.maxCanvasWidth,u=e.mapping,l=u===void 0?{}:u,p=e.xOffset,v=p===void 0?0:p,x=e.yOffset,S=x===void 0?0:x,A=0,I=v;Array.from(i).forEach(function(D,Z){if(!l[D]){var Y=r(D,Z);I+On>o&&(I=0,A++),l[D]={x:I,y:S+A*On,width:On,height:On,advance:Y},I+=On}});var F=n+t*2;return{mapping:l,xOffset:I,yOffset:S+A*F,canvasHeight:li(S+(A+1)*F)}}function _i(e,i,r){var n=0,t=0,o=0,u=[],l={},p=pr(e),v;try{for(p.s();!(v=p.n()).done;){var x=v.value;if(!l[x.id]){var S=x.size;n+S+i>r&&(ei(l,u,t),n=0,t=o+t+i,o=0,u=[]),u.push({icon:x,xOffset:n}),n=n+S+i,o=Math.max(o,S)}}}catch(I){p.e(I)}finally{p.f()}u.length>0&&ei(l,u,t);var A=li(o+t+i);return{mapping:l,canvasHeight:A}}function ei(e,i,r){var n=pr(i),t;try{for(n.s();!(t=n.n()).done;){var o=t.value,u=o.icon,l=o.xOffset;e[u.id]=(0,H.Z)((0,H.Z)({},u),{},{x:l,y:r,image:u.image,width:u.width,height:u.height})}}catch(p){n.e(p)}finally{n.f()}}function li(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Di,Na;function Eo(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=wi(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function wi(e,i){if(!!e){if(typeof e=="string")return Ea(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ea(e,i)}}function Ea(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function la(e){var i=to();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function to(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fo=Ks(),Ao="sans-serif",ko="normal",Vo=24,$a=3,ui=.25,Yo=8,Wi=1024,Un=1,xi=1,Pi=3,ro=null;function Ks(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function Pu(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Pe(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var Ot=(Di=(0,at.b2)(),Di(Na=function(e){(0,Xr.Z)(r,e);var i=la(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"fontAtlas",void 0),(0,P.Z)((0,k.Z)(n),"iconFontMap",void 0),(0,P.Z)((0,k.Z)(n),"iconFontGlyphs",{}),(0,P.Z)((0,k.Z)(n),"fontOptions",void 0),(0,P.Z)((0,k.Z)(n),"key",void 0),(0,P.Z)((0,k.Z)(n),"cache",new of(Pi)),n}return(0,j.Z)(r,[{key:"scale",get:function(){return xi}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping||{}}},{key:"getCanvasByKey",value:function(t){var o=this.cache.get(t);return o&&o.data}},{key:"getMappingByKey",value:function(t){var o=this.cache.get(t);return o&&o.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Ao,fontWeight:ko,characterSet:fo,fontSize:Vo,buffer:$a,sdf:!0,cutoff:ui,radius:Yo,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var o=this;t.forEach(function(u){o.iconFontGlyphs[u.name]=u.unicode})}},{key:"addIconFont",value:function(t,o){this.iconFontMap.set(t,o)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,H.Z)((0,H.Z)({},this.fontOptions),t),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),u=this.cache.get(this.key);if(!(u&&o.length===0)){var l=this.generateFontAtlas(this.key,o,u);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(t,o){var u=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(t,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then(function(){u.emit("fontloaded",{fontFamily:t})})}catch(p){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,o,u){var l=this.fontOptions,p=l.fontFamily,v=l.fontWeight,x=l.fontSize,S=l.buffer,A=l.sdf,I=l.radius,F=l.cutoff,D=l.iconfont,Z=u&&u.data;Z||(Z=window.document.createElement("canvas"),Z.width=Wi);var Y=Z.getContext("2d",{willReadFrequently:!0});Pu(Y,p,x,v);var ve=_n((0,H.Z)({getFontWidth:function(Ko){return Y.measureText(Ko).width},fontHeight:x*xi,buffer:S,characterSet:o,maxCanvasWidth:Wi},u&&{mapping:u.mapping,xOffset:u.xOffset,yOffset:u.yOffset})),me=ve.mapping,De=ve.canvasHeight,Be=ve.xOffset,Je=ve.yOffset,_t=Y.getImageData(0,0,Z.width,Z.height);if(Z.height=De,Y.putImageData(_t,0,0),Pu(Y,p,x,v),A){var Zt=new(Vr())(x,S,I,F,p,v),$t=Y.getImageData(0,0,Zt.size,Zt.size),dr=Eo(o),lr;try{for(dr.s();!(lr=dr.n()).done;){var Yr=lr.value;if(D){var un=String.fromCharCode(parseInt(Yr.replace("&#x","").replace(";",""),16)),In=Zt.draw(un);Pe(In,$t)}else Pe(Zt.draw(Yr),$t);Y.putImageData($t,me[Yr].x,me[Yr].y)}}catch(ao){dr.e(ao)}finally{dr.f()}}else{var Gi=Eo(o),Ra;try{for(Gi.s();!(Ra=Gi.n()).done;){var Va=Ra.value;Y.fillText(Va,me[Va].x,me[Va].y+x*Un)}}catch(ao){Gi.e(ao)}finally{Gi.f()}}return{xOffset:Be,yOffset:Je,mapping:me,data:Z,width:Z.width,height:Z.height}}},{key:"getKey",value:function(){var t=this.fontOptions,o=t.fontFamily,u=t.fontWeight;return"".concat(o,"_").concat(u)}},{key:"getNewChars",value:function(t,o){var u=this.cache.get(t);if(!u)return o;var l=[],p=u.mapping,v=new Set(Object.keys(p)),x=new Set(o);return x.forEach(function(S){v.has(S)||l.push(S)}),l}}]),r}(ae.EventEmitter))||Na),Pt,fn;function Si(e){var i=we();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function we(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pe=3,Ye=1024,dt=64,yt=(Pt=(0,at.b2)(),Pt(fn=function(e){(0,Xr.Z)(r,e);var i=Si(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"canvasHeight",128),(0,P.Z)((0,k.Z)(n),"texture",void 0),(0,P.Z)((0,k.Z)(n),"canvas",void 0),(0,P.Z)((0,k.Z)(n),"iconData",void 0),(0,P.Z)((0,k.Z)(n),"iconMap",void 0),(0,P.Z)((0,k.Z)(n),"ctx",void 0),(0,P.Z)((0,k.Z)(n),"loadingImageCount",0),n}return(0,j.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,je.Z)(Q().mark(function o(u,l){var p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return p=new Image,this.loadingImageCount++,this.hasImage(u)?console.warn("Image Id already exists"):this.iconData.push({id:u,size:dt}),this.updateIconMap(),S.next=6,this.loadImage(l);case 6:p=S.sent,v=this.iconData.find(function(A){return A.id===u}),v&&(v.image=p,v.width=p.width,v.height=p.height),this.update();case 10:case"end":return S.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"addImageMini",value:function(t,o,u){var l=this,p=u.getSceneConfig().canvas,v=p.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:dt}),this.updateIconMap(),this.loadImageMini(o,p).then(function(x){v=x;var S=l.iconData.find(function(A){return A.id===t});S&&(S.image=v,S.width=v.width,S.height=v.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(function(o){return o.id!==t}),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise(function(o,u){if(t instanceof HTMLImageElement){o(t);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){o(l)},l.onerror=function(){u(new Error("Could not load image at "+t))},l.src=t instanceof File?URL.createObjectURL(t):t})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=Ye,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=t.iconMap[o],l=u.x,p=u.y,v=u.image,x=u.width,S=x===void 0?64:x,A=u.height,I=A===void 0?64:A,F=Math.max(S,I),D=F/dt,Z=I/D,Y=S/D;v&&t.ctx.drawImage(v,l+(dt-Y)/2,p+(dt-Z)/2,Y,Z)})}},{key:"updateIconMap",value:function(){var t=_i(this.iconData,pe,Ye),o=t.mapping,u=t.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(t,o){return new Promise(function(u,l){var p=o.createImage();p.crossOrigin="anonymous",p.onload=function(){u(p)},p.onerror=function(){l(new Error("Could not load image at "+t))},p.src=t})}}]),r}(ae.EventEmitter))||fn),Ze=N(49685);function He(){var e=new Ze.WT(16);return Ze.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function ft(e){var i=new Ze.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Ee(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Ge(e,i,r,n,t,o,u,l,p,v,x,S,A,I,F,D){var Z=new Ze.WT(16);return Z[0]=e,Z[1]=i,Z[2]=r,Z[3]=n,Z[4]=t,Z[5]=o,Z[6]=u,Z[7]=l,Z[8]=p,Z[9]=v,Z[10]=x,Z[11]=S,Z[12]=A,Z[13]=I,Z[14]=F,Z[15]=D,Z}function Se(e,i,r,n,t,o,u,l,p,v,x,S,A,I,F,D,Z){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e[4]=o,e[5]=u,e[6]=l,e[7]=p,e[8]=v,e[9]=x,e[10]=S,e[11]=A,e[12]=I,e[13]=F,e[14]=D,e[15]=Z,e}function pt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xt(e,i){if(e===i){var r=i[1],n=i[2],t=i[3],o=i[6],u=i[7],l=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=o,e[11]=i[14],e[12]=t,e[13]=u,e[14]=l}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function ar(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],S=i[9],A=i[10],I=i[11],F=i[12],D=i[13],Z=i[14],Y=i[15],ve=r*l-n*u,me=r*p-t*u,De=r*v-o*u,Be=n*p-t*l,Je=n*v-o*l,_t=t*v-o*p,Zt=x*D-S*F,$t=x*Z-A*F,dr=x*Y-I*F,lr=S*Z-A*D,Yr=S*Y-I*D,un=A*Y-I*Z,In=ve*un-me*Yr+De*lr+Be*dr-Je*$t+_t*Zt;return In?(In=1/In,e[0]=(l*un-p*Yr+v*lr)*In,e[1]=(t*Yr-n*un-o*lr)*In,e[2]=(D*_t-Z*Je+Y*Be)*In,e[3]=(A*Je-S*_t-I*Be)*In,e[4]=(p*dr-u*un-v*$t)*In,e[5]=(r*un-t*dr+o*$t)*In,e[6]=(Z*De-F*_t-Y*me)*In,e[7]=(x*_t-A*De+I*me)*In,e[8]=(u*Yr-l*dr+v*Zt)*In,e[9]=(n*dr-r*Yr-o*Zt)*In,e[10]=(F*Je-D*De+Y*ve)*In,e[11]=(S*De-x*Je-I*ve)*In,e[12]=(l*$t-u*lr-p*Zt)*In,e[13]=(r*lr-n*$t+t*Zt)*In,e[14]=(D*me-F*Be-Z*ve)*In,e[15]=(x*Be-S*me+A*ve)*In,e):null}function Dt(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],S=i[9],A=i[10],I=i[11],F=i[12],D=i[13],Z=i[14],Y=i[15];return e[0]=l*(A*Y-I*Z)-S*(p*Y-v*Z)+D*(p*I-v*A),e[1]=-(n*(A*Y-I*Z)-S*(t*Y-o*Z)+D*(t*I-o*A)),e[2]=n*(p*Y-v*Z)-l*(t*Y-o*Z)+D*(t*v-o*p),e[3]=-(n*(p*I-v*A)-l*(t*I-o*A)+S*(t*v-o*p)),e[4]=-(u*(A*Y-I*Z)-x*(p*Y-v*Z)+F*(p*I-v*A)),e[5]=r*(A*Y-I*Z)-x*(t*Y-o*Z)+F*(t*I-o*A),e[6]=-(r*(p*Y-v*Z)-u*(t*Y-o*Z)+F*(t*v-o*p)),e[7]=r*(p*I-v*A)-u*(t*I-o*A)+x*(t*v-o*p),e[8]=u*(S*Y-I*D)-x*(l*Y-v*D)+F*(l*I-v*S),e[9]=-(r*(S*Y-I*D)-x*(n*Y-o*D)+F*(n*I-o*S)),e[10]=r*(l*Y-v*D)-u*(n*Y-o*D)+F*(n*v-o*l),e[11]=-(r*(l*I-v*S)-u*(n*I-o*S)+x*(n*v-o*l)),e[12]=-(u*(S*Z-A*D)-x*(l*Z-p*D)+F*(l*A-p*S)),e[13]=r*(S*Z-A*D)-x*(n*Z-t*D)+F*(n*A-t*S),e[14]=-(r*(l*Z-p*D)-u*(n*Z-t*D)+F*(n*p-t*l)),e[15]=r*(l*A-p*S)-u*(n*A-t*S)+x*(n*p-t*l),e}function er(e){var i=e[0],r=e[1],n=e[2],t=e[3],o=e[4],u=e[5],l=e[6],p=e[7],v=e[8],x=e[9],S=e[10],A=e[11],I=e[12],F=e[13],D=e[14],Z=e[15],Y=i*u-r*o,ve=i*l-n*o,me=i*p-t*o,De=r*l-n*u,Be=r*p-t*u,Je=n*p-t*l,_t=v*F-x*I,Zt=v*D-S*I,$t=v*Z-A*I,dr=x*D-S*F,lr=x*Z-A*F,Yr=S*Z-A*D;return Y*Yr-ve*lr+me*dr+De*$t-Be*Zt+Je*_t}function yr(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],S=i[8],A=i[9],I=i[10],F=i[11],D=i[12],Z=i[13],Y=i[14],ve=i[15],me=r[0],De=r[1],Be=r[2],Je=r[3];return e[0]=me*n+De*l+Be*S+Je*D,e[1]=me*t+De*p+Be*A+Je*Z,e[2]=me*o+De*v+Be*I+Je*Y,e[3]=me*u+De*x+Be*F+Je*ve,me=r[4],De=r[5],Be=r[6],Je=r[7],e[4]=me*n+De*l+Be*S+Je*D,e[5]=me*t+De*p+Be*A+Je*Z,e[6]=me*o+De*v+Be*I+Je*Y,e[7]=me*u+De*x+Be*F+Je*ve,me=r[8],De=r[9],Be=r[10],Je=r[11],e[8]=me*n+De*l+Be*S+Je*D,e[9]=me*t+De*p+Be*A+Je*Z,e[10]=me*o+De*v+Be*I+Je*Y,e[11]=me*u+De*x+Be*F+Je*ve,me=r[12],De=r[13],Be=r[14],Je=r[15],e[12]=me*n+De*l+Be*S+Je*D,e[13]=me*t+De*p+Be*A+Je*Z,e[14]=me*o+De*v+Be*I+Je*Y,e[15]=me*u+De*x+Be*F+Je*ve,e}function xn(e,i,r){var n=r[0],t=r[1],o=r[2],u,l,p,v,x,S,A,I,F,D,Z,Y;return i===e?(e[12]=i[0]*n+i[4]*t+i[8]*o+i[12],e[13]=i[1]*n+i[5]*t+i[9]*o+i[13],e[14]=i[2]*n+i[6]*t+i[10]*o+i[14],e[15]=i[3]*n+i[7]*t+i[11]*o+i[15]):(u=i[0],l=i[1],p=i[2],v=i[3],x=i[4],S=i[5],A=i[6],I=i[7],F=i[8],D=i[9],Z=i[10],Y=i[11],e[0]=u,e[1]=l,e[2]=p,e[3]=v,e[4]=x,e[5]=S,e[6]=A,e[7]=I,e[8]=F,e[9]=D,e[10]=Z,e[11]=Y,e[12]=u*n+x*t+F*o+i[12],e[13]=l*n+S*t+D*o+i[13],e[14]=p*n+A*t+Z*o+i[14],e[15]=v*n+I*t+Y*o+i[15]),e}function ai(e,i,r){var n=r[0],t=r[1],o=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*t,e[5]=i[5]*t,e[6]=i[6]*t,e[7]=i[7]*t,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=i[11]*o,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function bn(e,i,r,n){var t=n[0],o=n[1],u=n[2],l=Math.hypot(t,o,u),p,v,x,S,A,I,F,D,Z,Y,ve,me,De,Be,Je,_t,Zt,$t,dr,lr,Yr,un,In,Gi;return l<Ze.Ib?null:(l=1/l,t*=l,o*=l,u*=l,p=Math.sin(r),v=Math.cos(r),x=1-v,S=i[0],A=i[1],I=i[2],F=i[3],D=i[4],Z=i[5],Y=i[6],ve=i[7],me=i[8],De=i[9],Be=i[10],Je=i[11],_t=t*t*x+v,Zt=o*t*x+u*p,$t=u*t*x-o*p,dr=t*o*x-u*p,lr=o*o*x+v,Yr=u*o*x+t*p,un=t*u*x+o*p,In=o*u*x-t*p,Gi=u*u*x+v,e[0]=S*_t+D*Zt+me*$t,e[1]=A*_t+Z*Zt+De*$t,e[2]=I*_t+Y*Zt+Be*$t,e[3]=F*_t+ve*Zt+Je*$t,e[4]=S*dr+D*lr+me*Yr,e[5]=A*dr+Z*lr+De*Yr,e[6]=I*dr+Y*lr+Be*Yr,e[7]=F*dr+ve*lr+Je*Yr,e[8]=S*un+D*In+me*Gi,e[9]=A*un+Z*In+De*Gi,e[10]=I*un+Y*In+Be*Gi,e[11]=F*un+ve*In+Je*Gi,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function zn(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[4],u=i[5],l=i[6],p=i[7],v=i[8],x=i[9],S=i[10],A=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=o*t+v*n,e[5]=u*t+x*n,e[6]=l*t+S*n,e[7]=p*t+A*n,e[8]=v*t-o*n,e[9]=x*t-u*n,e[10]=S*t-l*n,e[11]=A*t-p*n,e}function ti(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],l=i[2],p=i[3],v=i[8],x=i[9],S=i[10],A=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t-v*n,e[1]=u*t-x*n,e[2]=l*t-S*n,e[3]=p*t-A*n,e[8]=o*n+v*t,e[9]=u*n+x*t,e[10]=l*n+S*t,e[11]=p*n+A*t,e}function Ni(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],l=i[2],p=i[3],v=i[4],x=i[5],S=i[6],A=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t+v*n,e[1]=u*t+x*n,e[2]=l*t+S*n,e[3]=p*t+A*n,e[4]=v*t-o*n,e[5]=x*t-u*n,e[6]=S*t-l*n,e[7]=A*t-p*n,e}function Za(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Cs(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sh(e,i,r){var n=r[0],t=r[1],o=r[2],u=Math.hypot(n,t,o),l,p,v;return u<Ze.Ib?null:(u=1/u,n*=u,t*=u,o*=u,l=Math.sin(i),p=Math.cos(i),v=1-p,e[0]=n*n*v+p,e[1]=t*n*v+o*l,e[2]=o*n*v-t*l,e[3]=0,e[4]=n*t*v-o*l,e[5]=t*t*v+p,e[6]=o*t*v+n*l,e[7]=0,e[8]=n*o*v+t*l,e[9]=t*o*v-n*l,e[10]=o*o*v+p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Js(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Kh(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yu(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ff(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],l=n+n,p=t+t,v=o+o,x=n*l,S=n*p,A=n*v,I=t*p,F=t*v,D=o*v,Z=u*l,Y=u*p,ve=u*v;return e[0]=1-(I+D),e[1]=S+ve,e[2]=A-Y,e[3]=0,e[4]=S-ve,e[5]=1-(x+D),e[6]=F+Z,e[7]=0,e[8]=A+Y,e[9]=F-Z,e[10]=1-(x+I),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Vf(e,i){var r=new Ze.WT(3),n=-i[0],t=-i[1],o=-i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],S=n*n+t*t+o*o+u*u;return S>0?(r[0]=(l*u+x*n+p*o-v*t)*2/S,r[1]=(p*u+x*t+v*n-l*o)*2/S,r[2]=(v*u+x*o+l*t-p*n)*2/S):(r[0]=(l*u+x*n+p*o-v*t)*2,r[1]=(p*u+x*t+v*n-l*o)*2,r[2]=(v*u+x*o+l*t-p*n)*2),ff(e,i,r),e}function Md(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function jf(e,i){var r=i[0],n=i[1],t=i[2],o=i[4],u=i[5],l=i[6],p=i[8],v=i[9],x=i[10];return e[0]=Math.hypot(r,n,t),e[1]=Math.hypot(o,u,l),e[2]=Math.hypot(p,v,x),e}function Nv(e,i){var r=new Ze.WT(3);jf(r,i);var n=1/r[0],t=1/r[1],o=1/r[2],u=i[0]*n,l=i[1]*t,p=i[2]*o,v=i[4]*n,x=i[5]*t,S=i[6]*o,A=i[8]*n,I=i[9]*t,F=i[10]*o,D=u+x+F,Z=0;return D>0?(Z=Math.sqrt(D+1)*2,e[3]=.25*Z,e[0]=(S-I)/Z,e[1]=(A-p)/Z,e[2]=(l-v)/Z):u>x&&u>F?(Z=Math.sqrt(1+u-x-F)*2,e[3]=(S-I)/Z,e[0]=.25*Z,e[1]=(l+v)/Z,e[2]=(A+p)/Z):x>F?(Z=Math.sqrt(1+x-u-F)*2,e[3]=(A-p)/Z,e[0]=(l+v)/Z,e[1]=.25*Z,e[2]=(S+I)/Z):(Z=Math.sqrt(1+F-u-x)*2,e[3]=(l-v)/Z,e[0]=(A+p)/Z,e[1]=(S+I)/Z,e[2]=.25*Z),e}function Co(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=i[3],p=t+t,v=o+o,x=u+u,S=t*p,A=t*v,I=t*x,F=o*v,D=o*x,Z=u*x,Y=l*p,ve=l*v,me=l*x,De=n[0],Be=n[1],Je=n[2];return e[0]=(1-(F+Z))*De,e[1]=(A+me)*De,e[2]=(I-ve)*De,e[3]=0,e[4]=(A-me)*Be,e[5]=(1-(S+Z))*Be,e[6]=(D+Y)*Be,e[7]=0,e[8]=(I+ve)*Je,e[9]=(D-Y)*Je,e[10]=(1-(S+F))*Je,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Aa(e,i,r,n,t){var o=i[0],u=i[1],l=i[2],p=i[3],v=o+o,x=u+u,S=l+l,A=o*v,I=o*x,F=o*S,D=u*x,Z=u*S,Y=l*S,ve=p*v,me=p*x,De=p*S,Be=n[0],Je=n[1],_t=n[2],Zt=t[0],$t=t[1],dr=t[2],lr=(1-(D+Y))*Be,Yr=(I+De)*Be,un=(F-me)*Be,In=(I-De)*Je,Gi=(1-(A+Y))*Je,Ra=(Z+ve)*Je,Va=(F+me)*_t,ao=(Z-ve)*_t,Ko=(1-(A+D))*_t;return e[0]=lr,e[1]=Yr,e[2]=un,e[3]=0,e[4]=In,e[5]=Gi,e[6]=Ra,e[7]=0,e[8]=Va,e[9]=ao,e[10]=Ko,e[11]=0,e[12]=r[0]+Zt-(lr*Zt+In*$t+Va*dr),e[13]=r[1]+$t-(Yr*Zt+Gi*$t+ao*dr),e[14]=r[2]+dr-(un*Zt+Ra*$t+Ko*dr),e[15]=1,e}function Zv(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r+r,l=n+n,p=t+t,v=r*u,x=n*u,S=n*l,A=t*u,I=t*l,F=t*p,D=o*u,Z=o*l,Y=o*p;return e[0]=1-S-F,e[1]=x+Y,e[2]=A-Z,e[3]=0,e[4]=x-Y,e[5]=1-v-F,e[6]=I+D,e[7]=0,e[8]=A+Z,e[9]=I-D,e[10]=1-v-S,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Uv(e,i,r,n,t,o,u){var l=1/(r-i),p=1/(t-n),v=1/(o-u);return e[0]=o*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*p,e[6]=0,e[7]=0,e[8]=(r+i)*l,e[9]=(t+n)*p,e[10]=(u+o)*v,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*v,e[15]=0,e}function Id(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=(t+n)*u,e[14]=2*t*n*u):(e[10]=-1,e[14]=-2*n),e}var Pd=Id;function Vv(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=t*u,e[14]=t*n*u):(e[10]=-1,e[14]=-n),e}function kd(e,i,r,n){var t=Math.tan(i.upDegrees*Math.PI/180),o=Math.tan(i.downDegrees*Math.PI/180),u=Math.tan(i.leftDegrees*Math.PI/180),l=Math.tan(i.rightDegrees*Math.PI/180),p=2/(u+l),v=2/(t+o);return e[0]=p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=-((u-l)*p*.5),e[9]=(t-o)*v*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function hf(e,i,r,n,t,o,u){var l=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*v,e[11]=0,e[12]=(i+r)*l,e[13]=(t+n)*p,e[14]=(u+o)*v,e[15]=1,e}var Gf=hf;function jv(e,i,r,n,t,o,u){var l=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=v,e[11]=0,e[12]=(i+r)*l,e[13]=(t+n)*p,e[14]=o*v,e[15]=1,e}function To(e,i,r,n){var t,o,u,l,p,v,x,S,A,I,F=i[0],D=i[1],Z=i[2],Y=n[0],ve=n[1],me=n[2],De=r[0],Be=r[1],Je=r[2];return Math.abs(F-De)<Ze.Ib&&Math.abs(D-Be)<Ze.Ib&&Math.abs(Z-Je)<Ze.Ib?pt(e):(x=F-De,S=D-Be,A=Z-Je,I=1/Math.hypot(x,S,A),x*=I,S*=I,A*=I,t=ve*A-me*S,o=me*x-Y*A,u=Y*S-ve*x,I=Math.hypot(t,o,u),I?(I=1/I,t*=I,o*=I,u*=I):(t=0,o=0,u=0),l=S*u-A*o,p=A*t-x*u,v=x*o-S*t,I=Math.hypot(l,p,v),I?(I=1/I,l*=I,p*=I,v*=I):(l=0,p=0,v=0),e[0]=t,e[1]=l,e[2]=x,e[3]=0,e[4]=o,e[5]=p,e[6]=S,e[7]=0,e[8]=u,e[9]=v,e[10]=A,e[11]=0,e[12]=-(t*F+o*D+u*Z),e[13]=-(l*F+p*D+v*Z),e[14]=-(x*F+S*D+A*Z),e[15]=1,e)}function Jh(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=n[0],p=n[1],v=n[2],x=t-r[0],S=o-r[1],A=u-r[2],I=x*x+S*S+A*A;I>0&&(I=1/Math.sqrt(I),x*=I,S*=I,A*=I);var F=p*A-v*S,D=v*x-l*A,Z=l*S-p*x;return I=F*F+D*D+Z*Z,I>0&&(I=1/Math.sqrt(I),F*=I,D*=I,Z*=I),e[0]=F,e[1]=D,e[2]=Z,e[3]=0,e[4]=S*Z-A*D,e[5]=A*F-x*Z,e[6]=x*D-S*F,e[7]=0,e[8]=x,e[9]=S,e[10]=A,e[11]=0,e[12]=t,e[13]=o,e[14]=u,e[15]=1,e}function Rc(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Np(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Zp(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Up(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function wh(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Oc(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function Gv(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Vp(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8],S=e[9],A=e[10],I=e[11],F=e[12],D=e[13],Z=e[14],Y=e[15],ve=i[0],me=i[1],De=i[2],Be=i[3],Je=i[4],_t=i[5],Zt=i[6],$t=i[7],dr=i[8],lr=i[9],Yr=i[10],un=i[11],In=i[12],Gi=i[13],Ra=i[14],Va=i[15];return Math.abs(r-ve)<=Ze.Ib*Math.max(1,Math.abs(r),Math.abs(ve))&&Math.abs(n-me)<=Ze.Ib*Math.max(1,Math.abs(n),Math.abs(me))&&Math.abs(t-De)<=Ze.Ib*Math.max(1,Math.abs(t),Math.abs(De))&&Math.abs(o-Be)<=Ze.Ib*Math.max(1,Math.abs(o),Math.abs(Be))&&Math.abs(u-Je)<=Ze.Ib*Math.max(1,Math.abs(u),Math.abs(Je))&&Math.abs(l-_t)<=Ze.Ib*Math.max(1,Math.abs(l),Math.abs(_t))&&Math.abs(p-Zt)<=Ze.Ib*Math.max(1,Math.abs(p),Math.abs(Zt))&&Math.abs(v-$t)<=Ze.Ib*Math.max(1,Math.abs(v),Math.abs($t))&&Math.abs(x-dr)<=Ze.Ib*Math.max(1,Math.abs(x),Math.abs(dr))&&Math.abs(S-lr)<=Ze.Ib*Math.max(1,Math.abs(S),Math.abs(lr))&&Math.abs(A-Yr)<=Ze.Ib*Math.max(1,Math.abs(A),Math.abs(Yr))&&Math.abs(I-un)<=Ze.Ib*Math.max(1,Math.abs(I),Math.abs(un))&&Math.abs(F-In)<=Ze.Ib*Math.max(1,Math.abs(F),Math.abs(In))&&Math.abs(D-Gi)<=Ze.Ib*Math.max(1,Math.abs(D),Math.abs(Gi))&&Math.abs(Z-Ra)<=Ze.Ib*Math.max(1,Math.abs(Z),Math.abs(Ra))&&Math.abs(Y-Va)<=Ze.Ib*Math.max(1,Math.abs(Y),Math.abs(Va))}var Gm=yr,jo=Up,Dc,Ld,a=(Dc=(0,at.b2)(),Dc(Ld=function(){function e(){(0,Mt.Z)(this,e),(0,P.Z)(this,"viewport",void 0),(0,P.Z)(this,"overridedViewProjectionMatrix",void 0),(0,P.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,P.Z)(this,"jitteredProjectionMatrix",void 0),(0,P.Z)(this,"viewMatrixInverse",void 0),(0,P.Z)(this,"cameraPosition",void 0)}return(0,j.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=He(),ar(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,Dn.Z)(r,2),t=n[0],o=n[1];return[t,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var t=Za(He(),[r,n,0]);this.jitteredProjectionMatrix=yr(He(),t,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=yr(He(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Ld),s=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),c,m;function _(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=b(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function b(e,i){if(!!e){if(typeof e=="string")return E(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return E(e,i)}}function E(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var M={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},O=(c=(0,at.b2)(),c(m=function(){function e(){(0,Mt.Z)(this,e),(0,P.Z)(this,"container",void 0),(0,P.Z)(this,"controlCorners",void 0),(0,P.Z)(this,"controlContainer",void 0),(0,P.Z)(this,"scene",void 0),(0,P.Z)(this,"mapsService",void 0),(0,P.Z)(this,"controls",[]),(0,P.Z)(this,"unAddControls",[])}return(0,j.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(qe.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var t=n.get(qe.IMapService);t.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=_(this.controls),n;try{for(r.s();!(n=r.n()).done;){var t=n.value;t.remove()}}catch(o){r.e(o)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",t=this.controlContainer=Ai("div",n+"control-container",this.container);function o(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=l.map(function(v){return n+v}).join(" ");r[l.filter(function(v){return!["row","column"].includes(v)}).join("")]=Ai("div",p,t)}function u(l){var p=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,V.Z)(p),[M[l]])}Object.values(s).forEach(function(l){o(u(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&qa(this.controlCorners[r]);this.controlContainer&&qa(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var r=this,n=window.MutationObserver;if(!!n)for(var t=function(){var p=u[o],v=p.match(/^(top|bottom)(left|right)$/);if(v){var x=(0,Dn.Z)(v,3),S=x[1],A=x[2],I=r.controlCorners["".concat(S).concat(A)],F=new n(function(D){var Z=(0,Dn.Z)(D,1),Y=Z[0].target;I&&(I.style[S]=Y.clientHeight+"px")});F.observe(r.controlCorners["".concat(A).concat(S)],{childList:!0,attributes:!0})}},o=0,u=Object.keys(this.controlCorners);o<u.length;o++)t()}}]),e}())||m),B,G,$=(B=(0,at.b2)(),B(G=function(){function e(){(0,Mt.Z)(this,e),(0,P.Z)(this,"container",void 0),(0,P.Z)(this,"scene",void 0),(0,P.Z)(this,"mapsService",void 0),(0,P.Z)(this,"markers",[]),(0,P.Z)(this,"markerLayers",[]),(0,P.Z)(this,"unAddMarkers",[]),(0,P.Z)(this,"unAddMarkerLayers",[])}return(0,j.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(qe.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||G),re,ue,ke=(re=(0,at.b2)(),re(ue=function(){function e(){(0,Mt.Z)(this,e),(0,P.Z)(this,"scene",void 0),(0,P.Z)(this,"mapsService",void 0),(0,P.Z)(this,"popups",[]),(0,P.Z)(this,"unAddPopups",[])}return(0,j.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(r){r!=null&&r.isOpen()&&r.remove();var n=this.popups.indexOf(r);n>-1&&this.popups.splice(n,1);var t=this.unAddPopups.indexOf(r);t>-1&&this.unAddPopups.splice(t,1)}},{key:"destroy",value:function(){this.popups.forEach(function(r){return r.remove()})}},{key:"addPopup",value:function(r){var n=this;r&&r.getOptions().autoClose&&[].concat((0,V.Z)(this.popups),(0,V.Z)(this.unAddPopups)).forEach(function(t){t.getOptions().autoClose&&n.removePopup(t)}),this.isMarkerReady?(r.addTo(this.scene),this.popups.push(r)):this.unAddPopups.push(r),r.on("close",function(){n.removePopup(r)})}},{key:"initPopup",value:function(){var r=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){r.addPopup(n),r.unAddPopups=[]})}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(qe.IMapService)}}]),e}())||ue),Me=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),Xe=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),Ve=function(e){return e.AND="and",e.OR="or",e}({}),st=function(e){return e.INIT="init",e.UPDATE="update",e}({}),It={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Nt=It,Ht,or,Fr=yi.merge,Kr={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Pn={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Ve.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},on=(Ht=(0,at.b2)(),Ht(or=function(){function e(){(0,Mt.Z)(this,e),(0,P.Z)(this,"sceneConfigCache",{}),(0,P.Z)(this,"layerConfigCache",{}),(0,P.Z)(this,"layerAttributeConfigCache",{})}return(0,j.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Nt[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=(0,H.Z)((0,H.Z)({},Kr),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,t){this.layerConfigCache[n]=(0,H.Z)({},Fr({},this.sceneConfigCache[r],Pn,t))}},{key:"getAttributeConfig",value:function(r){return this.layerAttributeConfigCache[r]}},{key:"setAttributeConfig",value:function(r,n){this.layerAttributeConfigCache[r]=(0,H.Z)((0,H.Z)({},this.layerAttributeConfigCache[r]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||or);function Or(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function cr(e,i,r,n,t){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(u,l){return l(e,i,u)||u},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,i,o),o=null),o}function di(){var e=new Ze.WT(4);return Ze.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Xn(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function wn(e,i,r,n){var t=new Ze.WT(4);return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function Ti(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function ci(e,i,r,n,t){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e}function Ui(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function Fn(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function Yi(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function ka(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function no(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Ya(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function La(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function io(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function Go(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Lo(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function Ts(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function Xo(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return Math.hypot(r,n,t,o)}function Ms(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return r*r+n*n+t*t+o*o}function ho(e){var i=e[0],r=e[1],n=e[2],t=e[3];return Math.hypot(i,r,n,t)}function qo(e){var i=e[0],r=e[1],n=e[2],t=e[3];return i*i+r*r+n*n+t*t}function Li(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function ca(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function na(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r*r+n*n+t*t+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=r*u,e[1]=n*u,e[2]=t*u,e[3]=o*u,e}function ji(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function Bs(e,i,r,n){var t=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],u=r[0]*n[3]-r[3]*n[0],l=r[1]*n[2]-r[2]*n[1],p=r[1]*n[3]-r[3]*n[1],v=r[2]*n[3]-r[3]*n[2],x=i[0],S=i[1],A=i[2],I=i[3];return e[0]=S*v-A*p+I*l,e[1]=-(x*v)+A*u-I*o,e[2]=x*p-S*u+I*t,e[3]=-(x*l)+S*o-A*t,e}function ps(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=i[3];return e[0]=t+n*(r[0]-t),e[1]=o+n*(r[1]-o),e[2]=u+n*(r[2]-u),e[3]=l+n*(r[3]-l),e}function Ca(e,i){i=i||1;var r,n,t,o,u,l;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=r*r+n*n;while(u>=1);do t=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,l=t*t+o*o;while(l>=1);var p=Math.sqrt((1-u)/l);return e[0]=i*r,e[1]=i*n,e[2]=i*t*p,e[3]=i*o*p,e}function Xa(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3];return e[0]=r[0]*n+r[4]*t+r[8]*o+r[12]*u,e[1]=r[1]*n+r[5]*t+r[9]*o+r[13]*u,e[2]=r[2]*n+r[6]*t+r[10]*o+r[14]*u,e[3]=r[3]*n+r[7]*t+r[11]*o+r[15]*u,e}function ds(e,i,r){var n=i[0],t=i[1],o=i[2],u=r[0],l=r[1],p=r[2],v=r[3],x=v*n+l*o-p*t,S=v*t+p*n-u*o,A=v*o+u*t-l*n,I=-u*n-l*t-p*o;return e[0]=x*v+I*-u+S*-p-A*-l,e[1]=S*v+I*-l+A*-u-x*-p,e[2]=A*v+I*-p+x*-l-S*-u,e[3]=i[3],e}function Xi(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Fc(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function ku(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Bc(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=i[0],l=i[1],p=i[2],v=i[3];return Math.abs(r-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(t-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(p))&&Math.abs(o-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))}var po=null,zc=null,Ml=null,Qh=null,Eh=null,ep=null,pf=null,tp=function(){var e=di();return function(i,r,n,t,o,u){var l,p;for(r||(r=4),n||(n=0),t?p=Math.min(t*r+n,i.length):p=i.length,l=n;l<p;l+=r)e[0]=i[l],e[1]=i[l+1],e[2]=i[l+2],e[3]=i[l+3],o(e,e,u),i[l]=e[0],i[l+1]=e[1],i[l+2]=e[2],i[l+3]=e[3];return i}}(),Ah=Math.PI/180,Ch=512,Th=4003e4;function rp(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,t=n===void 0?0:n,o=e.scale,u=e.highPrecision,l=u===void 0?!1:u,p=e.flipY,v=p===void 0?!1:p;o=o!==void 0?o:Math.pow(2,t);var x={},S=Ch*o,A=Math.cos(r*Ah),I=S/360,F=I/A,D=S/Th/A;if(x.pixelsPerMeter=[D,-D,D],x.metersPerPixel=[1/D,-1/D,1/D],x.pixelsPerDegree=[I,-F,D],x.degreesPerPixel=[1/I,-1/F,1/D],l){var Z=Ah*Math.tan(r*Ah)/A,Y=I*Z/2,ve=S/Th*Z,me=ve/F*D;x.pixelsPerDegree2=[0,-Y,ve],x.pixelsPerMeter2=[me,0,me],v&&(x.pixelsPerDegree2[1]=-x.pixelsPerDegree2[1],x.pixelsPerMeter2[1]=-x.pixelsPerMeter2[1])}return v&&(x.pixelsPerMeter[1]=-x.pixelsPerMeter[1],x.metersPerPixel[1]=-x.metersPerPixel[1],x.pixelsPerDegree[1]=-x.pixelsPerDegree[1],x.degreesPerPixel[1]=-x.degreesPerPixel[1]),x}var Nc=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),Qs={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Mh,Hf,Zc,df,np,jp=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ip=(Mh=(0,at.b2)(),Hf=(0,at.f3)(qe.ICameraService),Mh(Zc=(df=function(){function e(){(0,Mt.Z)(this,e),(0,P.Z)(this,"needRefresh",!0),Or(this,"cameraService",np,this),(0,P.Z)(this,"coordinateSystem",void 0),(0,P.Z)(this,"viewportCenter",void 0),(0,P.Z)(this,"viewportCenterProjection",void 0),(0,P.Z)(this,"pixelsPerDegree",void 0),(0,P.Z)(this,"pixelsPerDegree2",void 0),(0,P.Z)(this,"pixelsPerMeter",void 0)}return(0,j.Z)(e,[{key:"refresh",value:function(r){var n=this.cameraService.getZoom(),t=this.cameraService.getZoomScale(),o=r||this.cameraService.getCenter(),u=rp({latitude:o[1],zoom:n}),l=u.pixelsPerMeter,p=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Nc.LNGLAT||this.coordinateSystem===Nc.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Nc.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===Nc.P20_OFFSET&&this.calculateLnglatOffset(o,n,t,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,t,o){var u=rp({latitude:r[1],zoom:n,scale:t,flipY:o,highPrecision:!0}),l=u.pixelsPerMeter,p=u.pixelsPerDegree,v=u.pixelsPerDegree2,x=this.cameraService.getViewMatrix(),S=this.cameraService.getProjectionMatrix(),A=yr([],S,x),I=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=Xa([],[I[0],I[1],0,1],A),x=this.cameraService.getViewMatrixUncentered()||x,A=yr([],S,x),A=yr([],A,jp),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=v}}]),e}(),np=cr(df.prototype,"cameraService",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),df))||Zc),Ih,ap;function op(e){var i=sp();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function sp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var up=(Ih=(0,at.b2)(),Ih(ap=function(e){(0,Xr.Z)(r,e);var i=op(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"renderMap",new Map),(0,P.Z)((0,k.Z)(n),"enable",!1),(0,P.Z)((0,k.Z)(n),"renderEnable",!1),(0,P.Z)((0,k.Z)(n),"cacheLogs",{}),n}return(0,j.Z)(r,[{key:"setEnable",value:function(t){this.enable=!!t}},{key:"log",value:function(t,o){var u=this;if(!!this.enable){var l=t.split("."),p=null;l.forEach(function(v,x){p!==null?(p[v]||(p[v]={}),x!==l.length-1&&(p=p[v])):(u.cacheLogs[v]||(u.cacheLogs[v]={}),x!==l.length-1&&(p=u.cacheLogs[v])),x===l.length-1&&(p[v]=(0,H.Z)((0,H.Z)({time:Date.now()},p[v]),o))})}}},{key:"getLog",value:function(t){var o=this;switch((0,mr.Z)(t)){case"string":return this.cacheLogs[t];case"object":return t.map(function(u){return o.cacheLogs[u]}).filter(function(u){return u!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(t){delete this.cacheLogs[t]}},{key:"generateRenderUid",value:function(){return this.renderEnable?Qo():""}},{key:"renderDebug",value:function(t){this.renderEnable=t}},{key:"renderStart",value:function(t){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(t)||{};this.renderMap.set(t,(0,H.Z)((0,H.Z)({},o),{},{renderUid:t,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(t){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(t);if(o){var u=o.renderStart,l=Date.now();this.emit("renderEnd",(0,H.Z)((0,H.Z)({},o),{},{renderEnd:l,renderDuration:l-u})),this.renderMap.delete(t)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),r}(ae.EventEmitter))||ap),Gp=N(50840),ac=N.n(Gp),vs=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),Wf,Ph,vf,$f,Yf;function Rd(e){var i=Hv();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function Hv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Od={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Wv=(Wf=(0,at.b2)(),Ph=(0,at.f3)(qe.IMapService),Wf(vf=($f=function(e){(0,Xr.Z)(r,e);var i=Rd(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"indragging",!1),Or((0,k.Z)(n),"mapService",Yf,(0,k.Z)(n)),(0,P.Z)((0,k.Z)(n),"hammertime",void 0),(0,P.Z)((0,k.Z)(n),"lastClickTime",0),(0,P.Z)((0,k.Z)(n),"lastClickXY",[-1,-1]),(0,P.Z)((0,k.Z)(n),"clickTimer",void 0),(0,P.Z)((0,k.Z)(n),"$containter",void 0),(0,P.Z)((0,k.Z)(n),"onDrag",function(l){var p=n.interactionEvent(l);p.type=Od[p.type],p.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(vs.Drag,p)}),(0,P.Z)((0,k.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var p=n.interactionEvent(l);n.emit(vs.Hover,p)}),(0,P.Z)((0,k.Z)(n),"onTouch",function(l){var p=l.touches[0];n.onHover({x:p.pageX,y:p.pageY,type:"touch"})}),(0,P.Z)((0,k.Z)(n),"onHover",function(l){var p=l.clientX,v=l.clientY,x=p,S=v,A=l.type,I=n.mapService.getMapContainer();if(I){var F=I.getBoundingClientRect(),D=F.top,Z=F.left;x=x-Z-I.clientLeft,S=S-D-I.clientTop}var Y=n.mapService.containerToLngLat([x,S]);if(A==="click"){n.isDoubleTap(x,S,Y);return}if(A==="touch"){n.isDoubleTap(x,S,Y);return}A!=="click"&&A!=="dblclick"&&n.emit(vs.Hover,{x,y:S,lngLat:Y,type:A,target:l})}),n}return(0,j.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(vs.Hover)}},{key:"triggerHover",value:function(t){var o=t.x,u=t.y;this.emit(vs.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(t){this.emit(vs.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(vs.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t){var o=new(ac()).Manager(t);o.add(new(ac()).Tap({event:"dblclick",taps:2})),o.add(new(ac()).Tap({event:"click"})),o.add(new(ac()).Pan({threshold:0,pointers:0})),o.add(new(ac()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(t){var o=t.type,u=t.pointerType,l,p;u==="touch"?(p=Math.floor(t.pointers[0].clientY),l=Math.floor(t.pointers[0].clientX)):(p=Math.floor(t.srcEvent.y),l=Math.floor(t.srcEvent.x));var v=this.mapService.getMapContainer();if(v){var x=v.getBoundingClientRect(),S=x.top,A=x.left;l-=A,p-=S}var I=this.mapService.containerToLngLat([l,p]);return{x:l,y:p,lngLat:I,type:o,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,o,u){var l=this,p=new Date().getTime(),v="click";p-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),v="dblclick",this.emit(vs.Hover,{x:t,y:o,lngLat:u,type:v})):(this.lastClickTime=p,this.lastClickXY=[t,o],this.clickTimer=setTimeout(function(){v="click",l.emit(vs.Hover,{x:t,y:o,lngLat:u,type:v})},400))}}]),r}(de()),Yf=cr($f.prototype,"mapService",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$f))||vf),Dd=0;function Hm(e){var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Dd++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function lp(e){var i,r=!0;if((e==null||(i=e.target)===null||i===void 0?void 0:i.target)instanceof HTMLElement)for(var n,t=e==null||(n=e.target)===null||n===void 0?void 0:n.target;t;){var o,u=Array.from(t.classList);if(u.includes("l7-marker")||u.includes("l7-popup")){r=!1;break}t=(o=t)===null||o===void 0?void 0:o.parentElement}return r}var q=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),al,$v,Uc,Hp,Fd,cp,Il,oc,kh,fp,hp,Wp,Bd,pp=(al=(0,at.b2)(),$v=(0,at.f3)(qe.IMapService),Uc=(0,at.f3)(qe.IRendererService),Hp=(0,at.f3)(qe.IGlobalConfigService),Fd=(0,at.f3)(qe.IInteractionService),cp=(0,at.f3)(qe.ILayerService),al(Il=(oc=function(){function e(){var i=this;(0,Mt.Z)(this,e),(0,P.Z)(this,"pickedColors",void 0),(0,P.Z)(this,"pickedTileLayers",[]),Or(this,"mapService",kh,this),Or(this,"rendererService",fp,this),Or(this,"configService",hp,this),Or(this,"interactionService",Wp,this),Or(this,"layerService",Bd,this),(0,P.Z)(this,"pickingFBO",void 0),(0,P.Z)(this,"width",0),(0,P.Z)(this,"height",0),(0,P.Z)(this,"alreadyInPicking",!1),(0,P.Z)(this,"pickBufferScale",1),(0,P.Z)(this,"pickFromPickingFBO",function(r,n){var t=n.x,o=n.y,u=n.lngLat,l=n.type,p=n.target,v=!1,x=i.rendererService,S=x.readPixels,A=x.getContainer,I=i.getContainerSize(A()),F=I.width,D=I.height;F*=Ba,D*=Ba;var Z=r.getLayerConfig(),Y=Z.enableHighlight,ve=Z.enableSelect,me=t*Ba,De=o*Ba;if(me>F-1*Ba||me<0||De>D-1*Ba||De<0)return!1;var Be=S({x:Math.floor(me/i.pickBufferScale),y:Math.floor((D-(o+1)*Ba)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO});if(i.pickedColors=Be,Be[0]!==0||Be[1]!==0||Be[2]!==0){var Je=Mo(Be),_t=r.layerPickService.getFeatureById(Je);Je!==r.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var Zt={x:t,y:o,type:l,lngLat:u,featureId:Je,feature:_t,target:p};_t&&(v=!0,r.setCurrentPickId(Je),i.triggerHoverOnLayer(r,Zt))}else{var $t={x:t,y:o,lngLat:u,type:r.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:p,feature:null};i.triggerHoverOnLayer(r,(0,H.Z)((0,H.Z)({},$t),{},{type:"unpick"})),i.triggerHoverOnLayer(r,$t),r.setCurrentPickId(null)}if(Y&&r.layerPickService.highlightPickedFeature(Be),ve&&l==="click"&&(Be==null?void 0:Be.toString())!==[0,0,0,0].toString()){var dr=Mo(Be);r.getCurrentSelectedId()===null||dr!==r.getCurrentSelectedId()?(r.layerPickService.selectFeature(Be),r.setCurrentSelectedId(dr)):(r.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return v})}return(0,j.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,t=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,l=this.getContainerSize(u()),p=l.width,v=l.height;p*=Ba,v*=Ba,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=o({color:t({width:Math.round(p/this.pickBufferScale),height:Math.round(v/this.pickBufferScale),wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.interactionService.on(vs.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,je.Z)(Q().mark(function n(t,o,u){var l=this,p,v,x;return Q().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:p=this.rendererService,v=p.useFramebuffer,x=p.clear,this.resizePickingFBO(),v(this.pickingFBO,function(){x({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels({ispick:!0}),t.hooks.afterPickingEncode.call();var I=l.pickBox(t,o);u(I)});case 3:case"end":return A.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var t=this,o=n.map(function(dr){var lr=dr<0?0:dr;return Math.floor(lr*Ba/t.pickBufferScale)}),u=(0,Dn.Z)(o,4),l=u[0],p=u[1],v=u[2],x=u[3],S=this.rendererService,A=S.readPixels,I=S.getContainer,F=this.getContainerSize(I()),D=F.width,Z=F.height;if(D*=Ba,Z*=Ba,l>(D-1)*Ba/this.pickBufferScale||v<0||p>(Z-1)*Ba/this.pickBufferScale||x<0)return[];for(var Y=Math.min(D/this.pickBufferScale,v)-l,ve=Math.min(Z/this.pickBufferScale,x)-p,me=A({x:l,y:Math.floor(Z/this.pickBufferScale-(x+1)),width:Y,height:ve,data:new Uint8Array(Y*ve*4),framebuffer:this.pickingFBO}),De=[],Be={},Je=0;Je<me.length/4;Je=Je+1){var _t=me.slice(Je*4,Je*4+4),Zt=Mo(_t);if(Zt!==-1&&!Be[Zt]){var $t=r.layerPickService.getFeatureById(Zt);De.push((0,H.Z)((0,H.Z)({},$t),{},{pickedFeatureIdx:Zt})),Be[Zt]=!0}}return De}},{key:"handleCursor",value:function(r,n){var t=r.getLayerConfig(),o=t.cursor,u=o===void 0?"":o,l=t.cursorEnabled;if(l){var p=this.mapService.version,v=p==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),x=v==null?void 0:v.style.getPropertyValue("cursor");n==="unmousemove"&&x!==""?v==null||v.style.setProperty("cursor",""):n==="mousemove"&&(v==null||v.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Ba,height:r.height/Ba}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,je.Z)(Q().mark(function n(t){return Q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(!this.layerService.needPick(t.type)||!this.isPickingAllLayer())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),t=n.width,o=n.height;t*=Ba,o*=Ba,(this.width!==t||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=t,this.height=o)}},{key:"pickingLayers",value:function(){var i=(0,je.Z)(Q().mark(function n(t){var o=this,u,l,p;return Q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=this.rendererService,l=u.useFramebuffer,p=u.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){var S=o.layerService.getRenderList();S.filter(function(A){return A.needPick(t.type)}).reverse().some(function(A){p({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),A.layerPickService.pickRender(t);var I=o.pickFromPickingFBO(A,t);return o.layerService.pickedLayerId=I?+A.id:-1,I&&!A.getLayerConfig().enablePropagation})});case 3:case"end":return x.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){lp(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}}]),e}(),kh=cr(oc.prototype,"mapService",[$v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fp=cr(oc.prototype,"rendererService",[Uc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hp=cr(oc.prototype,"configService",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wp=cr(oc.prototype,"interactionService",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd=cr(oc.prototype,"layerService",[cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oc))||Il),Yv=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,Mt.Z)(this,e),(0,P.Z)(this,"autoStart",void 0),(0,P.Z)(this,"startTime",0),(0,P.Z)(this,"oldTime",0),(0,P.Z)(this,"running",!1),(0,P.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,j.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),zd,Nd,Zd,Ud,eu,mf,Vd,Pl,Xv;function $p(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Xf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Xf(e,i){if(!!e){if(typeof e=="string")return qf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qf(e,i)}}function qf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Lh(e){var i=Rh();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function Rh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kf=yi.throttle,qv=(zd=(0,at.b2)(),Nd=(0,at.f3)(qe.IRendererService),Zd=(0,at.f3)(qe.IMapService),Ud=(0,at.f3)(qe.IDebugService),zd(eu=(mf=function(e){(0,Xr.Z)(r,e);var i=Lh(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"pickedLayerId",-1),(0,P.Z)((0,k.Z)(n),"clock",new Yv),(0,P.Z)((0,k.Z)(n),"alreadyInRendering",!1),(0,P.Z)((0,k.Z)(n),"layers",[]),(0,P.Z)((0,k.Z)(n),"layerList",[]),(0,P.Z)((0,k.Z)(n),"layerRenderID",void 0),(0,P.Z)((0,k.Z)(n),"sceneInited",!1),(0,P.Z)((0,k.Z)(n),"animateInstanceCount",0),(0,P.Z)((0,k.Z)(n),"shaderPicking",!0),(0,P.Z)((0,k.Z)(n),"enableRender",!0),Or((0,k.Z)(n),"renderService",Vd,(0,k.Z)(n)),Or((0,k.Z)(n),"mapService",Pl,(0,k.Z)(n)),Or((0,k.Z)(n),"debugService",Xv,(0,k.Z)(n)),(0,P.Z)((0,k.Z)(n),"reRender",Kf(function(){n.renderLayers()},32)),(0,P.Z)((0,k.Z)(n),"throttleRenderLayers",Kf(function(){n.renderLayers()},16)),n}return(0,j.Z)(r,[{key:"needPick",value:function(t){return this.layerList.some(function(o){return o.needPick(t)})}},{key:"add",value:function(t){var o=this;this.layers.push(t),this.sceneInited&&t.init().then(function(){o.renderLayers()})}},{key:"addMask",value:function(t){var o=this;this.sceneInited&&t.init().then(function(){o.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u=this;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var v=(0,je.Z)(Q().mark(function x(S){return Q().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(S.startInit){I.next=4;break}return I.next=3,S.init();case 3:u.updateLayerRenderList();case 4:case"end":return I.stop()}},x)}));return function(x){return v.apply(this,arguments)}}());case 2:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(o){return o.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(o){return o.name===t})}},{key:"remove",value:function(){var n=(0,je.Z)(Q().mark(function o(u,l){var p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:l?(p=l.layerChildren.indexOf(u),p>-1&&l.layerChildren.splice(p,1)):(v=this.layers.indexOf(u),v>-1&&this.layers.splice(v,1)),u.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return S.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"removeAllLayers",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S;return Q().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){I.next=2;break}return I.abrupt("return");case 2:this.updateLayerRenderList(),u=this.debugService.generateRenderUid(),this.debugService.renderStart(u),this.alreadyInRendering=!0,this.clear(),l=$p(this.layerList),I.prev=8,l.s();case 10:if((p=l.n()).done){I.next=23;break}if(v=p.value,x=v.getLayerConfig(),S=x.enableMask,v.masks.filter(function(F){return F.inited}).length>0&&S&&this.renderMask(v.masks),!v.getLayerConfig().enableMultiPassRenderer){I.next=19;break}return I.next=17,v.renderMultiPass();case 17:I.next=21;break;case 19:return I.next=21,v.render();case 21:I.next=10;break;case 23:I.next=28;break;case 25:I.prev=25,I.t0=I.catch(8),l.e(I.t0);case 28:return I.prev=28,l.f(),I.finish(28);case 31:this.debugService.renderEnd(u),this.alreadyInRendering=!1;case 33:case"end":return I.stop()}},o,this,[[8,25,28,31]])}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMask",value:function(t){var o=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var u=t.length>1?Xe.MULTIPLE:Xe.SINGLE,l=$p(t),p;try{for(l.s();!(p=l.n()).done;){var v=p.value;v.render({isStencil:!0,stencilType:u,stencilIndex:o++})}}catch(x){l.e(x)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=(0,je.Z)(Q().mark(function o(u){var l;return Q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,u.hooks.beforeRenderData.promise();case 2:l=v.sent,l&&this.renderLayers();case 4:case"end":return v.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderTileLayerMask",value:function(t){var o=0,u=t.getLayerConfig(),l=u.enableMask,p=l===void 0?!0:l,v=t.tileMask?1:0,x=t.masks.filter(function(D){return D.inited});v=v+(p?x.length:1);var S=v>1?Xe.MULTIPLE:Xe.SINGLE;if((t.tileMask||x.length&&p)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),x.length&&p){var A=$p(x),I;try{for(A.s();!(I=A.n()).done;){var F=I.value;F.render({isStencil:!0,stencilType:S,stencilIndex:o++})}}catch(D){A.e(D)}finally{A.f()}}t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:S,stencilIndex:o++,stencilOperation:Ve.OR})}},{key:"renderTileLayer",value:function(){var n=(0,je.Z)(Q().mark(function o(u){return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.renderTileLayerMask(u),!u.getLayerConfig().enableMultiPassRenderer){p.next=6;break}return p.next=4,u.renderMultiPass();case 4:p.next=8;break;case 6:return p.next=8,u.render();case 8:case"end":return p.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).sort(function(o,u){return o.zIndex-u.zIndex}).forEach(function(o){t.layerList.push(o)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=gi(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),r}(ae.EventEmitter),Vd=cr(mf.prototype,"renderService",[Nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pl=cr(mf.prototype,"mapService",[Zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xv=cr(mf.prototype,"debugService",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mf))||eu),ol=N(81253),Kv=yi.isNil,Jv=function(){function e(i){var r=this;(0,Mt.Z)(this,e),(0,P.Z)(this,"name",void 0),(0,P.Z)(this,"type",void 0),(0,P.Z)(this,"scale",void 0),(0,P.Z)(this,"descriptor",void 0),(0,P.Z)(this,"featureBufferLayout",[]),(0,P.Z)(this,"needRescale",!1),(0,P.Z)(this,"needRemapping",!1),(0,P.Z)(this,"needRegenerateVertices",!1),(0,P.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,P.Z)(this,"vertexAttribute",void 0),(0,P.Z)(this,"defaultCallback",function(n){if(n.length===0){var t;return((t=r.scale)===null||t===void 0?void 0:t.defaultValues)||[]}return n.map(function(o,u){var l,p=(l=r.scale)===null||l===void 0?void 0:l.scalers[u].func,v=p(o);return v})}),this.setProps(i)}return(0,j.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var t,o=(t=this.scale)===null||t===void 0?void 0:t.callback.apply(t,(0,V.Z)(r));if(!Kv(o))return[o]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),jd=["buffer","update","name"],Gd=["buffer","update","name"],Lu,Hd,Yp,Xp,qp,Kp,Qv=(Lu={},(0,P.Z)(Lu,q.FLOAT,4),(0,P.Z)(Lu,q.UNSIGNED_BYTE,1),(0,P.Z)(Lu,q.UNSIGNED_SHORT,2),Lu),em=(Hd=(0,at.b2)(),Yp=(0,at.f3)(qe.IRendererService),Hd(Xp=(qp=function(){function e(){(0,Mt.Z)(this,e),(0,P.Z)(this,"attributesAndIndices",void 0),Or(this,"rendererService",Kp,this),(0,P.Z)(this,"attributes",[]),(0,P.Z)(this,"triangulation",void 0),(0,P.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,j.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Jv(r),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(r){var n=this.attributes.findIndex(function(t){return t.name===r});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(r){this.attributes.forEach(function(n){var t,o=n.name,u=(t=n.scale)===null||t===void 0?void 0:t.field;(r[o]||u&&r[u])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(r,n,t){var o=this.getLayerStyleAttribute(r);o||(o=this.registerStyleAttribute((0,H.Z)((0,H.Z)({},n),{},{name:r})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,t&&t.featureRange&&(o.featureRange=t.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,t=this.getLayerStyleAttribute(r),o=t==null||(n=t.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(Be){return Be.name===r});if(l&&l.descriptor){var p=l.descriptor,v=p.update,x=p.buffer,S=p.size,A=S===void 0?0:S,I=Qv[x.type||q.FLOAT];if(v){var F=this.featureLayout,D=F.elements,Z=F.sizePerElement,Y=D.slice(t,o);if(!Y.length)return;var ve=Y[0].offset,me=ve*A*I,De=Y.map(function(Be,Je){for(var _t=Be.featureIdx,Zt=Be.vertices,$t=Be.normals,dr=Zt.length/Z,lr=[],Yr=0;Yr<dr;Yr++){var un=$t?$t.slice(Yr*3,Yr*3+3):[];lr.push.apply(lr,(0,V.Z)(v(n[_t],_t,Zt.slice(Yr*Z,Yr*Z+Z),Je,un)))}return lr}).reduce(function(Be,Je){return Be.push.apply(Be,(0,V.Z)(Je)),Be},[]);l.vertexAttribute.updateBuffer({data:De,offset:me}),u==null||u.emit("legend:".concat(r),{type:r,attr:l})}}}},{key:"createAttributesAndIndices",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(Y){return Y.resetDescriptor(),Y.descriptor}),l=0,p=0,v=[],x=3;r.forEach(function(Y,ve){var me=o.triangulation(Y,t),De=me.indices,Be=me.vertices,Je=me.normals,_t=me.size,Zt=me.indexes,$t=me.count;typeof $t=="number"&&(p+=$t),De.forEach(function(un){v.push(un+l)}),x=_t;var dr=Be.length/_t;o.featureLayout.sizePerElement=x,o.featureLayout.elements.push({featureIdx:ve,vertices:Be,normals:Je,offset:l}),l+=dr;for(var lr=function(In){var Gi=(Je==null?void 0:Je.slice(In*3,In*3+3))||[],Ra=Be.slice(In*_t,In*_t+_t),Va=0;Zt&&Zt[In]!==void 0&&(Va=Zt[In]),u.forEach(function(ao,Ko){if(ao&&ao.update){var oh;(oh=ao.buffer.data).push.apply(oh,(0,V.Z)(ao.update(Y,ve,Ra,In,Gi,Va)))}})},Yr=0;Yr<dr;Yr++)lr(Yr)});var S=this.rendererService,A=S.createAttribute,I=S.createBuffer,F=S.createElements,D={};u.forEach(function(Y,ve){if(Y){var me=Y.buffer,De=Y.update,Be=Y.name,Je=(0,ol.Z)(Y,jd),_t=A((0,H.Z)({buffer:I(me)},Je));D[Y.name||""]=_t,o.attributes[ve].vertexAttribute=_t}});var Z=F({data:v,type:q.UNSIGNED_INT,count:v.length});return this.attributesAndIndices={attributes:D,elements:Z,count:p},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var t=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(I){return I.resetDescriptor(),I.descriptor}),u=0,l=[],p=3;r.forEach(function(I,F){var D=t.triangulation(I),Z=D.indices,Y=D.vertices,ve=D.normals,me=D.size,De=D.indexes;Z.forEach(function(Zt){l.push(Zt+u)}),p=me;var Be=Y.length/me;t.featureLayout.sizePerElement=p,t.featureLayout.elements.push({featureIdx:F,vertices:Y,normals:ve,offset:u}),u+=Be;for(var Je=function($t){var dr=(ve==null?void 0:ve.slice($t*3,$t*3+3))||[],lr=Y.slice($t*me,$t*me+me),Yr=0;De&&De[$t]!==void 0&&(Yr=De[$t]),o.forEach(function(un,In){if(un&&un.update){var Gi;(Gi=un.buffer.data).push.apply(Gi,(0,V.Z)(un.update(I,F,lr,$t,dr,Yr)))}})},_t=0;_t<Be;_t++)Je(_t)});var v=this.rendererService,x=v.createAttribute,S=v.createBuffer,A={};return o.forEach(function(I,F){if(I){var D=I.buffer,Z=I.update,Y=I.name,ve=(0,ol.Z)(I,Gd),me=x((0,H.Z)({buffer:S(D)},ve));A[I.name||""]=me,t.attributes[F].vertexAttribute=me}}),{attributes:A}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Kp=cr(qp.prototype,"rendererService",[Yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qp))||Xp),dp=N(34155);function Jp(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})}function Jf(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function vp(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),t,o=[],u;try{for(;(i===void 0||i-- >0)&&!(t=n.next()).done;)o.push(t.value)}catch(l){u={error:l}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(u)throw u.error}}return o}function Qf(e,i,r){if(r||arguments.length===2)for(var n=0,t=i.length,o;n<t;n++)(o||!(n in i))&&(o||(o=Array.prototype.slice.call(i,0,n)),o[n]=i[n]);return e.concat(o||Array.prototype.slice.call(i))}function Wd(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Qp={exports:{}},ed={exports:{}},mp={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default})(mp,mp.exports);var _u={},$d={exports:{}},Yd={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];var o=n.pop();return r.call(this,n,o)}},e.exports=i.default})(Yd,Yd.exports);var gf={};Object.defineProperty(gf,"__esModule",{value:!0}),gf.fallback=gp,gf.wrap=Xd;var Wm=gf.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,$m=gf.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,sc=gf.hasNextTick=typeof dp=="object"&&typeof dp.nextTick=="function";function gp(e){setTimeout(e,0)}function Xd(e){return function(i){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return i.apply(void 0,r)})}}var Vc;Wm?Vc=queueMicrotask:$m?Vc=setImmediate:sc?Vc=dp.nextTick:Vc=gp,gf.default=Xd(Vc),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=p;var r=Yd.exports,n=l(r),t=gf,o=l(t),u=_u;function l(S){return S&&S.__esModule?S:{default:S}}function p(S){return(0,u.isAsync)(S)?function(){for(var A=[],I=arguments.length;I--;)A[I]=arguments[I];var F=A.pop(),D=S.apply(this,A);return v(D,F)}:(0,n.default)(function(A,I){var F;try{F=S.apply(this,A)}catch(D){return I(D)}if(F&&typeof F.then=="function")return v(F,I);I(null,F)})}function v(S,A){return S.then(function(I){x(A,null,I)},function(I){x(A,I&&I.message?I:new Error(I))})}function x(S,A,I){try{S(A,I)}catch(F){(0,o.default)(function(D){throw D},F)}}e.exports=i.default}($d,$d.exports),Object.defineProperty(_u,"__esModule",{value:!0}),_u.isAsyncIterable=_u.isAsyncGenerator=_u.isAsync=void 0;var tm=$d.exports,a2=o2(tm);function o2(e){return e&&e.__esModule?e:{default:e}}function eg(e){return e[Symbol.toStringTag]==="AsyncFunction"}function s2(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function u2(e){return typeof e[Symbol.asyncIterator]=="function"}function l2(e){if(typeof e!="function")throw new Error("expected a function");return eg(e)?(0,a2.default)(e):e}_u.default=l2,_u.isAsync=eg,_u.isAsyncGenerator=s2,_u.isAsyncIterable=u2;var yp={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,t){if(t===void 0&&(t=n.length),!t)throw new Error("arity is undefined");function o(){for(var u=this,l=[],p=arguments.length;p--;)l[p]=arguments[p];return typeof l[t-1]=="function"?n.apply(this,l):new Promise(function(v,x){l[t-1]=function(S){for(var A=[],I=arguments.length-1;I-- >0;)A[I]=arguments[I+1];if(S)return x(S);v(A.length>1?A:A[0])},n.apply(u,l)})}return o}e.exports=i.default})(yp,yp.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=mp.exports,n=p(r),t=_u,o=p(t),u=yp.exports,l=p(u);function p(v){return v&&v.__esModule?v:{default:v}}i.default=(0,l.default)(function(v,x,S){var A=(0,n.default)(x)?[]:{};v(x,function(I,F,D){(0,o.default)(I)(function(Z){for(var Y,ve=[],me=arguments.length-1;me-- >0;)ve[me]=arguments[me+1];ve.length<2&&(Y=ve,ve=Y[0]),A[F]=ve,D(Z)})},function(I){return S(I,A)})},3),e.exports=i.default}(ed,ed.exports);var Ym={exports:{}},rm={exports:{}},Xm={exports:{}},qd={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function t(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var l=n;n=null,l.apply(this,o)}}return Object.assign(t,n),t}e.exports=i.default})(qd,qd.exports);var qm={exports:{}},Km={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default})(Km,Km.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=x;var r=mp.exports,n=u(r),t=Km.exports,o=u(t);function u(S){return S&&S.__esModule?S:{default:S}}function l(S){var A=-1,I=S.length;return function(){return++A<I?{value:S[A],key:A}:null}}function p(S){var A=-1;return function(){var F=S.next();return F.done?null:(A++,{value:F.value,key:A})}}function v(S){var A=S?Object.keys(S):[],I=-1,F=A.length;return function D(){var Z=A[++I];return Z==="__proto__"?D():I<F?{value:S[Z],key:Z}:null}}function x(S){if((0,n.default)(S))return l(S);var A=(0,o.default)(S);return A?p(A):v(S)}e.exports=i.default}(qm,qm.exports);var Kd={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,t)}}e.exports=i.default})(Kd,Kd.exports);var Jm={exports:{}},Jd={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default})(Jd,Jd.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var r=Jd.exports,n=t(r);function t(u){return u&&u.__esModule?u:{default:u}}function o(u,l,p,v){var x=!1,S=!1,A=!1,I=0,F=0;function D(){I>=l||A||x||(A=!0,u.next().then(function(ve){var me=ve.value,De=ve.done;if(!(S||x)){if(A=!1,De){x=!0,I<=0&&v(null);return}I++,p(me,F,Z),F++,D()}}).catch(Y))}function Z(ve,me){if(I-=1,!S){if(ve)return Y(ve);if(ve===!1){x=!0,S=!0;return}if(me===n.default||x&&I<=0)return x=!0,v(null);D()}}function Y(ve){S||(A=!1,x=!0,v(ve))}D()}e.exports=i.default}(Jm,Jm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=qd.exports,n=I(r),t=qm.exports,o=I(t),u=Kd.exports,l=I(u),p=_u,v=Jm.exports,x=I(v),S=Jd.exports,A=I(S);function I(F){return F&&F.__esModule?F:{default:F}}i.default=function(F){return function(D,Z,Y){if(Y=(0,n.default)(Y),F<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!D)return Y(null);if((0,p.isAsyncGenerator)(D))return(0,x.default)(D,F,Z,Y);if((0,p.isAsyncIterable)(D))return(0,x.default)(D[Symbol.asyncIterator](),F,Z,Y);var ve=(0,o.default)(D),me=!1,De=!1,Be=0,Je=!1;function _t($t,dr){if(!De)if(Be-=1,$t)me=!0,Y($t);else if($t===!1)me=!0,De=!0;else{if(dr===A.default||me&&Be<=0)return me=!0,Y(null);Je||Zt()}}function Zt(){for(Je=!0;Be<F&&!me;){var $t=ve();if($t===null){me=!0,Be<=0&&Y(null);return}Be+=1,Z($t.value,$t.key,(0,l.default)(_t))}Je=!1}Zt()}},e.exports=i.default}(Xm,Xm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=Xm.exports,n=p(r),t=_u,o=p(t),u=yp.exports,l=p(u);function p(x){return x&&x.__esModule?x:{default:x}}function v(x,S,A,I){return(0,n.default)(S)(x,(0,o.default)(A),I)}i.default=(0,l.default)(v,4),e.exports=i.default}(rm,rm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=rm.exports,n=u(r),t=yp.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v,x){return(0,n.default)(p,1,v,x)}i.default=(0,o.default)(l,3),e.exports=i.default}(Ym,Ym.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var r=ed.exports,n=u(r),t=Ym.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,n.default)(o.default,p,v)}e.exports=i.default}(Qp,Qp.exports);var nm=Wd(Qp.exports),yf=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,nm(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(t){r.apply(void 0,Qf([],vp(n.args),!1)),t(null,i)})},e}(),Qm={exports:{}},e0={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=mp.exports,n=Z(r),t=Jd.exports,o=Z(t),u=rm.exports,l=Z(u),p=qd.exports,v=Z(p),x=Kd.exports,S=Z(x),A=_u,I=Z(A),F=yp.exports,D=Z(F);function Z(De){return De&&De.__esModule?De:{default:De}}function Y(De,Be,Je){Je=(0,v.default)(Je);var _t=0,Zt=0,$t=De.length,dr=!1;$t===0&&Je(null);function lr(Yr,un){Yr===!1&&(dr=!0),dr!==!0&&(Yr?Je(Yr):(++Zt===$t||un===o.default)&&Je(null))}for(;_t<$t;_t++)Be(De[_t],_t,(0,S.default)(lr))}function ve(De,Be,Je){return(0,l.default)(De,Infinity,Be,Je)}function me(De,Be,Je){var _t=(0,n.default)(De)?Y:ve;return _t(De,(0,I.default)(Be),Je)}i.default=(0,D.default)(me,3),e.exports=i.default})(e0,e0.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var r=e0.exports,n=u(r),t=ed.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,o.default)(n.default,p,v)}e.exports=i.default}(Qm,Qm.exports);var c2=Wd(Qm.exports),rR=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return c2(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return Jp(n,void 0,void 0,function(){return Jf(this,function(o){switch(o.label){case 0:return[4,r()];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),t0={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=qd.exports,n=x(r),t=Kd.exports,o=x(t),u=_u,l=x(u),p=yp.exports,v=x(p);function x(A){return A&&A.__esModule?A:{default:A}}function S(A,I){if(I=(0,n.default)(I),!Array.isArray(A))return I(new Error("First argument to waterfall must be an array of functions"));if(!A.length)return I();var F=0;function D(Y){var ve=(0,l.default)(A[F++]);ve.apply(void 0,Y.concat([(0,o.default)(Z)]))}function Z(Y){for(var ve=[],me=arguments.length-1;me-- >0;)ve[me]=arguments[me+1];if(Y!==!1){if(Y||F===A.length)return I.apply(void 0,[Y].concat(ve));D(ve)}}D([])}i.default=(0,v.default)(S),e.exports=i.default})(t0,t0.exports);var tg=Wd(t0.exports),nR=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return tg(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var t=r();n(t?null:!1,t)}):this.tasks.push(function(n,t){var o=r.apply(void 0,Qf([],vp(n),!1));t(o?null:!1,i)})},e}(),rg=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return nm(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var t=r();n(t,i)})},e}(),f2=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,nm(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return Jp(n,void 0,void 0,function(){return Jf(this,function(o){switch(o.label){case 0:return[4,r.apply(void 0,Qf([],vp(this.args),!1))];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),h2=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,nm(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return Jp(n,void 0,void 0,function(){var o;return Jf(this,function(u){switch(u.label){case 0:return[4,r.apply(void 0,Qf([],vp(this.args),!1))];case 1:return o=u.sent(),t(o,i),[2]}})})})},e}(),p2=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return tg(this.tasks)},e.prototype.tapPromise=function(i,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(t){n(null,t)})}):this.tasks.push(function(n,t){r(n).then(function(o){t(null,o)})})},e}(),ng=N(67709),d2=N.n(ng),ig,ag,og,sg,ug,lg,cg,fg,hg,pg,dg,vg,mg,gg,yg,_g,xg,bg,zs,Sg,wg,Eg,Ag,Cg,Tg,Mg,Ig,Pg,kg,Lg,Rg,Og,Dg,Fg,Bg;function v2(e){var i=m2();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function m2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g2=(ig=(0,at.b2)(),ag=(0,at.f3)(qe.SceneID),og=(0,at.f3)(qe.IIconService),sg=(0,at.f3)(qe.IFontService),ug=(0,at.f3)(qe.IControlService),lg=(0,at.f3)(qe.IGlobalConfigService),cg=(0,at.f3)(qe.IMapService),fg=(0,at.f3)(qe.ICoordinateSystemService),hg=(0,at.f3)(qe.IRendererService),pg=(0,at.f3)(qe.ILayerService),dg=(0,at.f3)(qe.IDebugService),vg=(0,at.f3)(qe.ICameraService),mg=(0,at.f3)(qe.IInteractionService),gg=(0,at.f3)(qe.IPickingService),yg=(0,at.f3)(qe.IShaderModuleService),_g=(0,at.f3)(qe.IMarkerService),xg=(0,at.f3)(qe.IPopupService),ig(bg=(zs=function(e){(0,Xr.Z)(r,e);var i=v2(r);function r(){var n;return(0,Mt.Z)(this,r),n=i.call(this),(0,P.Z)((0,k.Z)(n),"destroyed",!1),(0,P.Z)((0,k.Z)(n),"loaded",!1),Or((0,k.Z)(n),"id",Sg,(0,k.Z)(n)),Or((0,k.Z)(n),"iconService",wg,(0,k.Z)(n)),Or((0,k.Z)(n),"fontService",Eg,(0,k.Z)(n)),Or((0,k.Z)(n),"controlService",Ag,(0,k.Z)(n)),Or((0,k.Z)(n),"configService",Cg,(0,k.Z)(n)),Or((0,k.Z)(n),"map",Tg,(0,k.Z)(n)),Or((0,k.Z)(n),"coordinateSystemService",Mg,(0,k.Z)(n)),Or((0,k.Z)(n),"rendererService",Ig,(0,k.Z)(n)),Or((0,k.Z)(n),"layerService",Pg,(0,k.Z)(n)),Or((0,k.Z)(n),"debugService",kg,(0,k.Z)(n)),Or((0,k.Z)(n),"cameraService",Lg,(0,k.Z)(n)),Or((0,k.Z)(n),"interactionService",Rg,(0,k.Z)(n)),Or((0,k.Z)(n),"pickingService",Og,(0,k.Z)(n)),Or((0,k.Z)(n),"shaderModuleService",Dg,(0,k.Z)(n)),Or((0,k.Z)(n),"markerService",Fg,(0,k.Z)(n)),Or((0,k.Z)(n),"popupService",Bg,(0,k.Z)(n)),(0,P.Z)((0,k.Z)(n),"inited",!1),(0,P.Z)((0,k.Z)(n),"initPromise",void 0),(0,P.Z)((0,k.Z)(n),"rendering",!1),(0,P.Z)((0,k.Z)(n),"$container",void 0),(0,P.Z)((0,k.Z)(n),"canvas",void 0),(0,P.Z)((0,k.Z)(n),"markerContainer",void 0),(0,P.Z)((0,k.Z)(n),"hooks",void 0),(0,P.Z)((0,k.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),Wl(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,P.Z)((0,k.Z)(n),"handleMapCameraChanged",function(t){n.cameraService.update(t),n.render()}),n.hooks={init:new f2},n}return(0,j.Z)(r,[{key:"init",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,je.Z)(Q().mark(function u(){return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o.debugService.log("map.mapInitStart",{type:o.map.version}),p.next=3,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),v()}),o.map.init()});case 3:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(vs.Drag,o.addSceneEvent.bind(o));case 10:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,je.Z)(Q().mark(function u(){var l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(p=((l=o.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,p?o.$container=p:o.$container=Hm(o.configService.getSceneConfig(o.id).id||""),!o.$container){S.next=13;break}return o.canvas=Ai("canvas","",o.$container),o.setCanvas(),S.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),t.gl);case 7:o.registerContextLost(),o.initContainer(),d2()(o.$container,o.handleWindowResized),window.matchMedia&&((v=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||v===void 0||v.addListener(o.handleWindowResized)),S.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:o.pickingService.init(o.id);case 15:case"end":return S.stop()}},u)}))),this.render()}},{key:"registerContextLost",value:function(){var t=this,o=this.rendererService.getCanvas();o&&o.addEventListener("webglcontextlost",function(){return t.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,je.Z)(Q().mark(function u(){return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),o.map.version!=="GAODE2.x"&&v()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(vs.Drag,o.addSceneEvent.bind(o));case 5:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,je.Z)(Q().mark(function u(){var l;return Q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(l=t.canvas,o.$container=l||null,!o.$container){v.next=7;break}return v.next=5,o.rendererService.init(t.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:v.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return v.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addFontFace",value:function(t,o){this.fontService.addFontFace(t,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,je.Z)(Q().mark(function o(u){var l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return p=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],S.next=3,this.render();case 3:return v=u==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png"),S.abrupt("return",v);case 5:case"end":return S.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;t!==null&&(this.markerContainer=Ai("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t=this,o,u;if(!this.inited){this.destroyed=!0;return}if((0,ng.unbind)(this.$container,this.handleWindowResized),window.matchMedia){var l;(l=window.matchMedia("screen and (min-resolution: 2dppx)"))===null||l===void 0||l.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var p;(p=t.$container)===null||p===void 0||p.removeChild(t.canvas),t.canvas=null,t.rendererService.destroy()}),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var t,o,u=Ba,l=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v&&(v.width=l*u,v.height=p*u),this.rendererService.viewport({x:0,y:0,width:u*l,height:u*p})}},{key:"setCanvas",value:function(){var t,o,u=Ba,l=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v.width=l*u,v.height=p*u,v.style.width="100%",v.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),r}(ae.EventEmitter),Sg=cr(zs.prototype,"id",[ag],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wg=cr(zs.prototype,"iconService",[og],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eg=cr(zs.prototype,"fontService",[sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ag=cr(zs.prototype,"controlService",[ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cg=cr(zs.prototype,"configService",[lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tg=cr(zs.prototype,"map",[cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mg=cr(zs.prototype,"coordinateSystemService",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ig=cr(zs.prototype,"rendererService",[hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pg=cr(zs.prototype,"layerService",[pg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kg=cr(zs.prototype,"debugService",[dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lg=cr(zs.prototype,"cameraService",[vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rg=cr(zs.prototype,"interactionService",[mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Og=cr(zs.prototype,"pickingService",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dg=cr(zs.prototype,"shaderModuleService",[yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fg=cr(zs.prototype,"markerService",[_g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bg=cr(zs.prototype,"popupService",[xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zs))||bg);function y2(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var _2=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function r0(e){var i={};return e=e.replace(_2,function(r,n,t){var o=t.split(":"),u=o[0].trim(),l="";switch(o.length>1&&(l=o[1].trim()),n){case"bool":l=l==="true";break;case"float":case"int":l=Number(l);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":l?l=l.replace("[","").replace("]","").split(",").reduce(function(p,v){return p.push(Number(v.trim())),p},[]):l=new Array(y2(n)).fill(0);break;default:}return i[u]=l,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:i}}var zg,Ng,x2=yi.uniq,Zg="#define PI 3.14159265359",b2=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,S2=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,w2=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,E2=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,A2=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,C2=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,T2=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,M2=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,I2=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,P2=/precision\s+(high|low|medium)p\s+float/,k2=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,L2=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,R2=/void\s+main\s*\([^)]*\)\s*\{\n?/,iR=/}\n?[^{}]*$/,O2=(zg=(0,at.b2)(),zg(Ng=function(){function e(){(0,Mt.Z)(this,e),(0,P.Z)(this,"moduleCache",{}),(0,P.Z)(this,"rawContentCache",{})}return(0,j.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Zg,fs:Zg}),this.registerModule("decode",{vs:b2,fs:""}),this.registerModule("projection",{vs:T2,fs:""}),this.registerModule("project",{vs:C2,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:I2}),this.registerModule("lighting",{vs:w2,fs:""}),this.registerModule("light",{vs:S2,fs:""}),this.registerModule("picking",{vs:A2,fs:E2}),this.registerModule("rotation_2d",{vs:M2,fs:""})}},{key:"registerModule",value:function(r,n){var t=n.vs,o=n.fs,u=n.uniforms,l=n.inject,p=r0(t),v=p.content,x=p.uniforms,S=r0(o),A=S.content,I=S.uniforms;this.rawContentCache[r]={fs:A,inject:l,uniforms:(0,H.Z)((0,H.Z)((0,H.Z)({},x),I),u),vs:v}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this,t=this.rawContentCache[r].vs,o=this.rawContentCache[r].fs,u=this.rawContentCache[r].inject,l={};u!=null&&u["vs:#decl"]&&(t=(u==null?void 0:u["vs:#decl"])+t,l=r0(u==null?void 0:u["vs:#decl"]).uniforms),u!=null&&u["vs:#main-start"]&&(t=t.replace(R2,function(Z){return Z+(u==null?void 0:u["vs:#main-start"])}));var p=this.processModule(t,[],"vs"),v=p.content,x=p.includeList,S=this.processModule(o,[],"fs"),A=S.content,I=S.includeList,F="",D=x2(x.concat(I).concat(r)).reduce(function(Z,Y){return(0,H.Z)((0,H.Z)({},Z),n.rawContentCache[Y].uniforms)},(0,H.Z)({},l));return P2.test(A)||(F=F+k2),F=F+A,this.moduleCache[r]={fs:F.trim(),uniforms:D,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,t){var o=this,u=r.replace(L2,function(l,p){var v=p.split(" "),x=v[0].replace(/"/g,"");if(n.indexOf(x)>-1)return"";var S=o.rawContentCache[x][t];n.push(x);var A=o.processModule(S,n,t),I=A.content;return I});return{content:u,includeList:n}}},{key:"injectDefines",value:function(r){var n=Object.keys(r).reduce(function(t,o){return t+"#define ".concat(o.toUpperCase()," ").concat(r[o],`;
`)},`
`);return n}}]),e}())||Ng),oa=N(66213),td=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),Ug,Vg,im=(Ug=(0,at.b2)(),Ug(Vg=function(){function e(){(0,Mt.Z)(this,e),(0,P.Z)(this,"shaderModuleService",void 0),(0,P.Z)(this,"rendererService",void 0),(0,P.Z)(this,"cameraService",void 0),(0,P.Z)(this,"mapService",void 0),(0,P.Z)(this,"interactionService",void 0),(0,P.Z)(this,"layerService",void 0),(0,P.Z)(this,"config",void 0)}return(0,j.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return td.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(qe.IRendererService),this.cameraService=r.getContainer().get(qe.ICameraService),this.mapService=r.getContainer().get(qe.IMapService),this.interactionService=r.getContainer().get(qe.IInteractionService),this.layerService=r.getContainer().get(qe.ILayerService),this.shaderModuleService=r.getContainer().get(qe.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Vg),jg,Gg;function D2(e){var i=F2();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function F2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B2=(jg=(0,at.b2)(),jg(Gg=function(e){(0,Xr.Z)(r,e);var i=D2(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,o){(0,oa.Z)((0,Qe.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(im))||Gg),Hg,Wg,$g,n0,Yg;function z2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=N2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function N2(e,i){if(!!e){if(typeof e=="string")return Xg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xg(e,i)}}function Xg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Z2=(Hg=(0,at.b2)(),Wg=(0,at.f3)(qe.IPostProcessor),Hg($g=(n0=function(){function e(){(0,Mt.Z)(this,e),(0,P.Z)(this,"passes",[]),Or(this,"postProcessor",Yg,this),(0,P.Z)(this,"layer",void 0),(0,P.Z)(this,"renderFlag",void 0),(0,P.Z)(this,"width",0),(0,P.Z)(this,"height",0)}return(0,j.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,je.Z)(Q().mark(function n(){var t,o,u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=z2(this.passes),p.prev=1,t.s();case 3:if((o=t.n()).done){p.next=9;break}return u=o.value,p.next=7,u.render(this.layer);case 7:p.next=3;break;case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(1),t.e(p.t0);case 14:return p.prev=14,t.f(),p.finish(14);case 17:return p.next=19,this.postProcessor.render(this.layer);case 19:case"end":return p.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===td.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,t){r.init(this.layer,n),this.passes.splice(t,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Yg=cr(n0.prototype,"postProcessor",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n0))||$g),qg,Kg;function U2(e){var i=V2();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function V2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j2=(qg=(0,at.b2)(),qg(Kg=function(e){(0,Xr.Z)(r,e);var i=U2(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"pickingFBO",void 0),(0,P.Z)((0,k.Z)(n),"layer",void 0),(0,P.Z)((0,k.Z)(n),"width",0),(0,P.Z)((0,k.Z)(n),"height",0),(0,P.Z)((0,k.Z)(n),"alreadyInRendering",!1),(0,P.Z)((0,k.Z)(n),"pickFromPickingFBO",function(l){var p=l.x,v=l.y,x=l.lngLat,S=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(S))){var A=n.rendererService,I=A.getViewportSize,F=A.readPixels,D=A.useFramebuffer,Z=I(),Y=Z.width,ve=Z.height,me=n.layer.getLayerConfig(),De=me.enableHighlight,Be=me.enableSelect,Je=p*Ba,_t=v*Ba;if(!(Je>Y||Je<0||_t>ve||_t<0)){var Zt;D(n.pickingFBO,function(){var $t;if(Zt=F({x:Math.round(Je),y:Math.round(ve-(v+1)*Ba),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Zt[0]!==0||Zt[1]!==0||Zt[2]!==0){var dr=Mo(Zt),lr=n.layer.getSource().getFeatureById(dr),Yr={x:p,y:v,type:S,lngLat:x,featureId:dr,feature:lr};lr&&(n.layer.setCurrentPickId(dr),n.triggerHoverOnLayer(Yr))}else{var un={x:p,y:v,lngLat:x,type:n.layer.getCurrentPickId()===null?"un"+S:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,H.Z)((0,H.Z)({},un),{},{type:"unpick"})),n.triggerHoverOnLayer(un),n.layer.setCurrentPickId(null)}De&&n.highlightPickedFeature(Zt),Be&&S==="click"&&(($t=Zt)===null||$t===void 0?void 0:$t.toString())!==[0,0,0,0].toString()&&n.selectFeature(Zt)})}}}),n}return(0,j.Z)(r,[{key:"getType",value:function(){return td.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,o){(0,oa.Z)((0,Qe.Z)(r.prototype),"init",this).call(this,t,o),this.layer=t;var u=this.rendererService,l=u.createTexture2D,p=u.createFramebuffer,v=u.getViewportSize,x=v(),S=x.width,A=x.height;this.pickingFBO=p({color:l({width:S,height:A,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.interactionService.on(vs.Hover,this.pickFromPickingFBO),this.interactionService.on(vs.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(vs.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,l=u.getViewportSize,p=u.useFramebuffer,v=u.clear,x=l(),S=x.width,A=x.height;this.alreadyInRendering=!0,(this.width!==S||this.height!==A)&&(this.pickingFBO.resize({width:S,height:A}),this.width=S,this.height=A),p(this.pickingFBO,function(){v({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var I=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(I),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var o=(0,Dn.Z)(t,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeHighlight.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var o=(0,Dn.Z)(t,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeSelect.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var o=t.featureId,u=Do(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(t){var o=t.featureId,u=Do(o);this.highlightPickedFeature(new Uint8Array(u))}}]),r}(im))||Kg),Jg,Qg,ey,i0,ty,G2=yi.camelCase,H2=yi.isNil,W2=yi.upperFirst,$2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,eh=(Jg=(0,at.b2)(),Qg=(0,at.f3)(qe.IShaderModuleService),Jg(ey=(i0=function(){function e(){(0,Mt.Z)(this,e),Or(this,"shaderModuleService",ty,this),(0,P.Z)(this,"rendererService",void 0),(0,P.Z)(this,"config",void 0),(0,P.Z)(this,"quad",$2),(0,P.Z)(this,"enabled",!0),(0,P.Z)(this,"renderToScreen",!1),(0,P.Z)(this,"model",void 0),(0,P.Z)(this,"name",void 0),(0,P.Z)(this,"optionsToUpdate",{})}return(0,j.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return td.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(qe.IRendererService),this.shaderModuleService=r.getContainer().get(qe.IShaderModuleService);var t=this.rendererService,o=t.createAttribute,u=t.createBuffer,l=t.createModel,p=this.setupShaders(),v=p.vs,x=p.fs,S=p.uniforms;this.model=l({vs:v,fs:x,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:q.FLOAT}),size:2})},uniforms:(0,H.Z)((0,H.Z)({u_Texture:null},S),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var t=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,l=u.useFramebuffer,p=u.getViewportSize,v=u.clear,x=p(),S=x.width,A=x.height;l(this.renderToScreen?null:o.getWriteFBO(),function(){v({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var I=(0,H.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[S,A]},t.convertOptionsToUniforms(t.optionsToUpdate));n&&(I.u_BloomFinal=1,I.u_Texture2=n),t.model.draw({uniforms:I})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=(0,H.Z)((0,H.Z)({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(t){H2(r[t])||(n["u_".concat(W2(G2(t)))]=r[t])}),n}}]),e}(),ty=cr(i0.prototype,"shaderModuleService",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i0))||ey),ry,ny;function Y2(e){var i=X2();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function X2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q2=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,K2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,a0=yi.isNil,J2=(ry=(0,at.b2)(),ry(ny=function(e){(0,Xr.Z)(r,e);var i=Y2(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:K2,fs:q2});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return a0(t.bloomRadius)||(o.u_radius=t.bloomRadius),a0(t.bloomIntensity)||(o.u_intensity=t.bloomIntensity),a0(t.bloomBaseRadio)||(o.u_baseRadio=t.bloomBaseRadio),o}}]),r}(eh))||ny),iy,ay;function Q2(e){var i=eS();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function eS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,rS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nS=yi.isNil,iS=(iy=(0,at.b2)(),iy(ay=function(e){(0,Xr.Z)(r,e);var i=Q2(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:rS,fs:tS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return nS(t.blurRadius)||(o.u_BlurDir=[t.blurRadius,0]),o}}]),r}(eh))||ay),oy,sy;function aS(e){var i=oS();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function oS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,uS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lS=yi.isNil,cS=(oy=(0,at.b2)(),oy(sy=function(e){(0,Xr.Z)(r,e);var i=aS(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:uS,fs:sS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return lS(t.blurRadius)||(o.u_BlurDir=[0,t.blurRadius]),o}}]),r}(eh))||sy),uy,ly;function fS(e){var i=hS();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function hS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,dS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,vS=(uy=(0,at.b2)(),uy(ly=function(e){(0,Xr.Z)(r,e);var i=fS(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:dS,fs:pS});var t=this.shaderModuleService.getModule("colorhalftone-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(eh))||ly),cy,fy;function mS(e){var i=gS();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function gS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,_S=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xS=(cy=(0,at.b2)(),cy(fy=function(e){(0,Xr.Z)(r,e);var i=mS(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:_S,fs:yS}),this.shaderModuleService.getModule("copy-pass")}}]),r}(eh))||fy),hy,py;function bS(e){var i=SS();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function SS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,ES=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,AS=(hy=(0,at.b2)(),hy(py=function(e){(0,Xr.Z)(r,e);var i=bS(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:ES,fs:wS});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(eh))||py),dy,vy;function CS(e){var i=TS();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function TS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,IS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,PS=(dy=(0,at.b2)(),dy(vy=function(e){(0,Xr.Z)(r,e);var i=CS(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:IS,fs:MS});var t=this.shaderModuleService.getModule("ink-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,H.Z)((0,H.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(eh))||vy),gy,yy;function kS(e){var i=LS();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function LS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,OS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,DS=(gy=(0,at.b2)(),gy(yy=function(e){(0,Xr.Z)(r,e);var i=kS(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:OS,fs:RS}),this.shaderModuleService.getModule("noise-pass")}}]),r}(eh))||yy),_y,xy;function FS(e){var i=BS();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function BS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,NS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,ZS=(_y=(0,at.b2)(),_y(xy=function(e){(0,Xr.Z)(r,e);var i=FS(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:zS,fs:NS}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(eh))||xy),by,Sy,wy,Ey,rd,Ay,US=(by=(0,at.b2)(),Sy=(0,at.f3)(qe.IRendererService),wy=(0,at.zY)(),by(Ey=(rd=function(){function e(){(0,Mt.Z)(this,e),Or(this,"rendererService",Ay,this),(0,P.Z)(this,"passes",[]),(0,P.Z)(this,"readFBO",void 0),(0,P.Z)(this,"writeFBO",void 0)}return(0,j.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,t=r.createTexture2D,o=n(),u=o.width,l=o.height;return t({x:0,y:0,width:u,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(t){n(r.readFBO,(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:t(r.getCurrentFBOTex());case 1:case"end":return l.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var i=(0,je.Z)(Q().mark(function n(t,o){var u,l;return Q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.getReadFBOTex();case 2:u=v.sent,l=0;case 4:if(!(l<4)){v.next=11;break}return v.next=7,o.render(t,u);case 7:this.swap(),l++,v.next=4;break;case 11:case"end":return v.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,je.Z)(Q().mark(function n(t){var o,u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:o=0;case 1:if(!(o<this.passes.length)){p.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){p.next=9;break}return p.next=7,this.renderBloomPass(t,u);case 7:p.next=12;break;case 9:return p.next=11,u.render(t);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,p.next=1;break;case 15:case"end":return p.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,t){r.init(n,t),this.passes.push(r)}},{key:"insert",value:function(r,n,t,o){r.init(t,o),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,t=r.createTexture2D;this.readFBO=n({color:t({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.writeFBO=n({color:t({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),Ay=cr(rd.prototype,"rendererService",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cr(rd.prototype,"init",[wy],Object.getOwnPropertyDescriptor(rd.prototype,"init"),rd.prototype),rd))||Ey),Cy,Ty;function VS(e){var i=jS();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function jS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GS=(Cy=(0,at.b2)(),Cy(Ty=function(e){(0,Xr.Z)(r,e);var i=VS(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getType",value:function(){return td.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,o){(0,oa.Z)((0,Qe.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(t){var o=this.rendererService,u=o.useFramebuffer,l=o.clear,p=t.multiPassRenderer.getPostProcessor().getReadFBO();u(p,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:p}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(function(v){v.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}]),r}(im))||Ty),My,Iy,Py,o0,ky;function HS(e){var i=WS();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function WS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $S=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Ly=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,YS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Ry(e,i){for(var r=0,n=1/i,t=e;t>0;)r=r+n*(t%i),t=Math.floor(t/i),n=n/i;return r}var XS=1,qS=(My=(0,at.b2)(),Iy=(0,at.f3)(qe.IShaderModuleService),My(Py=(o0=function(e){(0,Xr.Z)(r,e);var i=HS(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),Or((0,k.Z)(n),"shaderModuleService",ky,(0,k.Z)(n)),(0,P.Z)((0,k.Z)(n),"haltonSequence",[]),(0,P.Z)((0,k.Z)(n),"accumulatingId",0),(0,P.Z)((0,k.Z)(n),"frame",0),(0,P.Z)((0,k.Z)(n),"timer",void 0),(0,P.Z)((0,k.Z)(n),"sampleRenderTarget",void 0),(0,P.Z)((0,k.Z)(n),"prevRenderTarget",void 0),(0,P.Z)((0,k.Z)(n),"outputRenderTarget",void 0),(0,P.Z)((0,k.Z)(n),"copyRenderTarget",void 0),(0,P.Z)((0,k.Z)(n),"blendModel",void 0),(0,P.Z)((0,k.Z)(n),"outputModel",void 0),(0,P.Z)((0,k.Z)(n),"copyModel",void 0),n}return(0,j.Z)(r,[{key:"getType",value:function(){return td.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,o){(0,oa.Z)((0,Qe.Z)(r.prototype),"init",this).call(this,t,o);var u=this.rendererService,l=u.createFramebuffer,p=u.createTexture2D;this.sampleRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})});for(var v=0;v<30;v++)this.haltonSequence.push([Ry(v,2),Ry(v,3)]);this.blendModel=this.createTriangleModel("blend-pass",$S),this.outputModel=this.createTriangleModel("copy-pass",Ly,{blend:{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE_MINUS_SRC_ALPHA,srcAlpha:q.ONE,dstAlpha:q.ONE_MINUS_SRC_ALPHA},equation:{rgb:q.FUNC_ADD,alpha:q.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Ly)}},{key:"render",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),S=x.width,A=x.height;this.sampleRenderTarget.resize({width:S,height:A}),this.prevRenderTarget.resize({width:S,height:A}),this.outputRenderTarget.resize({width:S,height:A}),this.copyRenderTarget.resize({width:S,height:A}),this.resetFrame(),this.stopAccumulating();var I=t.multiPassRenderer.getPostProcessor().getReadFBO();v(I,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:I}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)});var F=function D(Z){!o.accumulatingId||Z!==o.accumulatingId||o.isFinished()||(o.doRender(t),window.requestAnimationFrame(function(){D(Z)}))};this.accumulatingId=XS++,this.timer=window.setTimeout(function(){F(o.accumulatingId)},50)}},{key:"doRender",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),S=x.width,A=x.height,I=t.getLayerConfig(),F=I.jitterScale,D=F===void 0?1:F,Z=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Z[0]*2-1)/S*D,(Z[1]*2-1)/A*D),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),v(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),t.render()}),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var Y=t.getLayerConfig();v(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:Y.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?t.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(v(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),v(t.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),t.multiPassRenderer.getPostProcessor().render(t));var ve=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ve,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,o,u){this.shaderModuleService.registerModule(t,{vs:YS,fs:o});var l=this.shaderModuleService.getModule(t),p=l.vs,v=l.fs,x=l.uniforms,S=this.rendererService,A=S.createAttribute,I=S.createBuffer,F=S.createModel;return F((0,H.Z)({vs:p,fs:v,attributes:{a_Position:A({buffer:I({data:[-4,-4,4,-4,0,4],type:q.FLOAT}),size:2})},uniforms:(0,H.Z)({},x),depth:{enable:!1},count:3},u))}}]),r}(im),ky=cr(o0.prototype,"shaderModuleService",[Iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o0))||Py),Qd=new at.W2;Qd.bind(qe.IGlobalConfigService).to(on).inSingletonScope(),(0,at.GW)((0,at.b2)(),ae.EventEmitter),Qd.bind(qe.IEventEmitter).to(ae.EventEmitter);var Oy=(0,Nr.Z)(Qd,!1),s0=function(i){var r=Oy.lazyInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},aR=function(i){var r=Oy.lazyMultiInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},sl=Qd,KS=0;function JS(){var e=new at.W2;return e.parent=Qd,e.bind(qe.SceneID).toConstantValue("".concat(KS++)),e.bind(qe.IShaderModuleService).to(O2).inSingletonScope(),e.bind(qe.ILayerService).to(qv).inSingletonScope(),e.bind(qe.IDebugService).to(up).inSingletonScope(),e.bind(qe.ISceneService).to(g2).inSingletonScope(),e.bind(qe.ICameraService).to(a).inSingletonScope(),e.bind(qe.ICoordinateSystemService).to(ip).inSingletonScope(),e.bind(qe.IInteractionService).to(Wv).inSingletonScope(),e.bind(qe.IPickingService).to(pp).inSingletonScope(),e.bind(qe.IControlService).to(O).inSingletonScope(),e.bind(qe.IMarkerService).to($).inSingletonScope(),e.bind(qe.IIconService).to(yt).inSingletonScope(),e.bind(qe.IFontService).to(Ot).inSingletonScope(),e.bind(qe.IPopupService).to(ke).inSingletonScope(),e.bind(qe.INormalPass).to(B2).whenTargetNamed("clear"),e.bind(qe.INormalPass).to(j2).whenTargetNamed("pixelPicking"),e.bind(qe.INormalPass).to(GS).whenTargetNamed("render"),e.bind(qe.INormalPass).to(qS).whenTargetNamed("taa"),e.bind(qe.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(qe.INormalPass,r)}}),e.bind(qe.IPostProcessingPass).to(xS).whenTargetNamed("copy"),e.bind(qe.IPostProcessingPass).to(J2).whenTargetNamed("bloom"),e.bind(qe.IPostProcessingPass).to(iS).whenTargetNamed("blurH"),e.bind(qe.IPostProcessingPass).to(cS).whenTargetNamed("blurV"),e.bind(qe.IPostProcessingPass).to(DS).whenTargetNamed("noise"),e.bind(qe.IPostProcessingPass).to(ZS).whenTargetNamed("sepia"),e.bind(qe.IPostProcessingPass).to(vS).whenTargetNamed("colorHalftone"),e.bind(qe.IPostProcessingPass).to(AS).whenTargetNamed("hexagonalPixelate"),e.bind(qe.IPostProcessingPass).to(PS).whenTargetNamed("ink"),e.bind(qe.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(qe.IPostProcessingPass,r);return n.setName(r),n}}),e}function ev(e){var i=new at.W2;return i.parent=e,i.bind(qe.IStyleAttributeService).to(em).inSingletonScope(),i.bind(qe.IMultiPassRenderer).to(Z2).inSingletonScope(),i.bind(qe.IPostProcessor).to(US).inSingletonScope(),i}var QS=null;function oR(e){return QS.indexOf(e)}var Dy=yi.clamp,ew=2,sR=4,tw=64,uR=128,rw=256,nw=512,lR=8192,cR=16384,fR=32768,iw=null,Fy=131072,hR=262144,aw=524288,pR=1048576,ow=2097152,dR=4194304,sw=8388608,uw=16777216,lw=null;function am(e,i){return e=Dy(Math.floor(e),0,255),i=Dy(Math.floor(i),0,255),256*e+i}function vR(e){var i=e.color,r=e.radius,n=e.tileX,t=e.tileY,o=e.shape,u=e.opacity,l=e.stroke,p=e.strokeWidth,v=e.strokeOpacity,x=[],S=[],A=[],I=[am(i[0],i[1]),am(i[2],i[3])],F=[am(l[0],l[1]),am(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(D){var Z=_slicedToArray(D,2),Y=Z[0],ve=Z[1];x.push([].concat(I,[(Y+1)*sw+(ve+1)*ow+getShapeIndex(o)*Fy+r,(n+512)*aw+(t+512)*tw])),S.push([].concat(F,[p,v])),A.push([u,0,0,0])}),{packedBuffer:x,packedBuffer2:S,packedBuffer3:A}}function mR(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*lw+r*uw+n*Fy+r*iw+n*nw+r*rw+n*ew+r}var _p={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},ts={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},Ua=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),nd=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),hn=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),cw=["mapload","mapchange","mapAfterFrameChange"],om=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],tu=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),fw=function(){var e=(0,je.Z)(Q().mark(function i(r,n,t,o){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p,v){n({x:r.x,y:r.y,z:r.z},function(x,S){if(x||S.length===0){v(x);return}S&&gt([{data:S,bands:[0]}],t,o,function(A,I){A?v(A):I&&p(I)})})}));case 1:case"end":return l.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}(),hw=function(){var e=(0,je.Z)(Q().mark(function i(r,n){return Q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(u,l){n({x:r.x,y:r.y,z:r.z},function(p,v){if(p||!v){l(p);return}v instanceof ArrayBuffer?pc(v,function(x,S){x&&l(x),u(S)}):v instanceof HTMLImageElement?u(v):l(p)})}));case 1:case"end":return o.stop()}},i)}));return function(r,n){return e.apply(this,arguments)}}();function pw(e,i){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(r){return Uo(r,i)}):e.map(function(r){return{url:Uo(r.url,i),bands:r.bands||[0]}}):Uo(e,i)}function dw(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(i){return{url:i,bands:[0]}}):e}function By(e,i){e.xhrCancel=function(){i.map(function(r){r.abort()})}}var vw=function(){var e=(0,je.Z)(Q().mark(function i(r,n,t,o,u){var l,p,v,x,S,A;return Q().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(l=dw(n.url),!(l.length>1)){F.next=15;break}return F.next=4,mw(l,n);case 4:if(p=F.sent,v=p.rasterFiles,x=p.xhrList,S=p.errList,By(r,x),!(S.length>0)){F.next=12;break}return t(S,null),F.abrupt("return");case 12:gt(v,o,u,t),F.next=17;break;case 15:A=zl(n,function(D,Z){if(D)t(D);else if(Z){var Y=[{data:Z,bands:l[0].bands}];gt(Y,o,u,t)}}),By(r,[A]);case 17:case"end":return F.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function mw(e,i){return u0.apply(this,arguments)}function u0(){return u0=(0,je.Z)(Q().mark(function e(i,r){var n,t,o,u,l,p,v,x,S,A,I;return Q().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:n=[],t=[],o=[],u=0;case 4:if(!(u<i.length)){D.next=20;break}return l=i[u],p=(0,H.Z)((0,H.Z)({},r),{},{url:l.url}),v=l.bands,D.next=10,Sf((0,H.Z)((0,H.Z)({},p),{},{type:"arrayBuffer"}));case 10:x=D.sent,S=x.err,A=x.data,I=x.xhr,S&&o.push(S),t.push(I),n.push({data:A,bands:v});case 17:u++,D.next=4;break;case 20:return D.abrupt("return",{rasterFiles:n,xhrList:t,errList:o});case 21:case"end":return D.stop()}},e)})),u0.apply(this,arguments)}var gw=function(){var e=(0,je.Z)(Q().mark(function i(r,n,t,o,u){var l;return Q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l={url:pw(r,n)},v.abrupt("return",new Promise(function(x,S){vw(t,l,function(A,I){A?S(A):I&&x(I)},o,u)}));case 2:case"end":return v.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}(),zy=function(){var e=(0,je.Z)(Q().mark(function i(r,n,t,o){var u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return l=Array.isArray(r)?r[0]:r,o.wmtsOptions?(p=(o==null?void 0:o.getURLFromTemplate)||xs,u=p(l,(0,H.Z)((0,H.Z)({},n),o.wmtsOptions))):(v=(o==null?void 0:o.getURLFromTemplate)||Uo,u=v(l,n)),S.abrupt("return",new Promise(function(A,I){var F,D=ll({url:u,type:(o==null||(F=o.requestParameters)===null||F===void 0?void 0:F.type)||"arrayBuffer"},function(Z,Y){Z?I(Z):Y&&A(Y)},o.transformResponse);t.xhrCancel=function(){return D.cancel()}}));case 3:case"end":return S.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}(),Ny=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},yw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},gR=[tu.ARRAYBUFFER,tu.RGB];function _w(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function xw(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(_w(e))throw new Error("tile server url is error");var r=(i==null?void 0:i.dataType)||tu.IMAGE;r===tu.RGB&&(r=tu.ARRAYBUFFER);var n=function(u,l){switch(r){case tu.IMAGE:return zy(e,u,l,i);case tu.CUSTOMIMAGE:case tu.CUSTOMTERRAINRGB:return hw(l,i==null?void 0:i.getCustomData);case tu.ARRAYBUFFER:return gw(e,u,l,(i==null?void 0:i.format)||Ny,i==null?void 0:i.operation);case tu.CUSTOMARRAYBUFFER:case tu.CUSTOMRGB:return fw(l,i==null?void 0:i.getCustomData,(i==null?void 0:i.format)||Ny,i==null?void 0:i.operation);default:return zy(e,u,l,i)}},t=(0,H.Z)((0,H.Z)((0,H.Z)({},yw),i),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:t,isTile:!0}}var bw=["extent","min","max","width","height","format","operation"];function Sw(e,i){var r=i.extent,n=i.min,t=i.max,o=i.width,u=i.height,l=i.format,p=i.operation,v=(0,ol.Z)(i,bw),x;if(l===void 0||an(e))x=Array.from(e);else{var S=Array.isArray(e)?e:[e];x=zr(S,l,p)}var A={_id:1,dataArray:[(0,H.Z)((0,H.Z)({_id:1,data:x,width:o,height:u},v),{},{min:n,max:t,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return A}var ww={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Ew=function(){var e=(0,je.Z)(Q().mark(function i(r){return Q().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(o){var u=(0,Dn.Z)(r.bounds,4),l=u[0],p=u[1],v=u[2],x=u[3],S={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,x:(l+v)/2,y:(p+x)/2},geometry:{type:"LineString",coordinates:[[v,x],[v,p],[l,p],[l,p]]}}]}}};o(S)}));case 1:case"end":return t.stop()}},i)}));return function(r){return e.apply(this,arguments)}}();function Aw(e,i){var r=function(o){return Ew(o)},n=(0,H.Z)((0,H.Z)((0,H.Z)({},ww),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var Cw=N(69848),Zy=N.n(Cw);function Uy(e,i){var r=i.radius,n=r===void 0?40:r,t=i.maxZoom,o=t===void 0?18:t,u=i.minZoom,l=u===void 0?0:u,p=i.zoom,v=p===void 0?2:p;if(e.pointIndex){var x=e.pointIndex.getClusters(e.extent,Math.floor(v));return e.dataArray=Tw(x),e}var S=new(Zy())({radius:n,minZoom:l,maxZoom:o}),A={type:"FeatureCollection",features:[]};return A.features=e.dataArray.map(function(I){return{type:"Feature",geometry:{type:"Point",coordinates:I.coordinates},properties:(0,H.Z)({},I)}}),S.load(A.features),S}function Tw(e){return e.map(function(i,r){return(0,H.Z)({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Mw(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Iw(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Vy(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,t=1;t<e.length;t++)n=i+e[t]*1,Math.abs(i)>=Math.abs(e[t])?r+=i-n+e[t]:r+=e[t]-n+i,i=n;return i+r*1}function Pw(e){if(e.length===0)throw new Error("mean requires at least one data point");return Vy(e)/e.length}var kw={min:Iw,max:Mw,mean:Pw,sum:Vy};function Lw(e){var i=Rw();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function Rw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ow=yi.cloneDeep,jy=yi.isFunction,Dw=yi.isString,Fw=yi.mergeWith;function Bw(e,i){if(Array.isArray(i))return i}var zw=function(e){(0,Xr.Z)(r,e);var i=Lw(r);function r(n,t){var o;return(0,Mt.Z)(this,r),o=i.call(this),(0,P.Z)((0,k.Z)(o),"type","source"),(0,P.Z)((0,k.Z)(o),"isTile",!1),(0,P.Z)((0,k.Z)(o),"inited",!1),(0,P.Z)((0,k.Z)(o),"hooks",{init:new yf}),(0,P.Z)((0,k.Z)(o),"parser",{type:"geojson"}),(0,P.Z)((0,k.Z)(o),"transforms",[]),(0,P.Z)((0,k.Z)(o),"cluster",!1),(0,P.Z)((0,k.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,P.Z)((0,k.Z)(o),"invalidExtent",!1),(0,P.Z)((0,k.Z)(o),"dataArrayChanged",!1),(0,P.Z)((0,k.Z)(o),"cfg",{autoRender:!0}),o.originData=n,o.initCfg(t),o.init().then(function(){o.inited=!0,o.emit("update",{type:"inited"})}),o}return(0,j.Z)(r,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var o=this,u=this.clusterOptions,l=u.method,p=l===void 0?"sum":l,v=u.field,x=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,x.forEach(function(S){S.id||(S.properties.point_count=1)}),(v||jy(p))&&(x=x.map(function(S){var A=S.id;if(A){var I=o.clusterIndex.getLeaves(A,Infinity),F=I.map(function(Y){return Y.properties}),D;if(Dw(p)&&v){var Z=Tr(F,v);D=kw[p](Z)}jy(p)&&(D=p(F)),S.properties.stat=D}else S.properties.point_count=1;return S})),this.data=oe("geojson")({type:"FeatureCollection",features:x}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var o=this.parser,u=o.type,l=u===void 0?"geojson":u,p=o.geometry;if(l==="geojson"&&!this.cluster){var v=t<this.originData.features.length?this.originData.features[t]:"null",x=Ow(v);if(x!=null&&x.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var S=this.data.dataArray.find(function(A){return A._id===t});x.properties=S}return x}else return l==="json"&&p?this.data.dataArray.find(function(A){return A._id===t}):t<this.data.dataArray.length?this.data.dataArray[t]:"null"}},{key:"updateFeaturePropertiesById",value:function(t,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===t?(0,H.Z)((0,H.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(t,o){var u=this.data.dataArray.find(function(l){return l[t]===o});return u==null?void 0:u._id}},{key:"setData",value:function(t,o){var u=this;this.originData=t,this.dataArrayChanged=!1,this.initCfg(o),this.init().then(function(){u.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var t;(t=this.tileset)===null||t===void 0||t.reloadAll()}},{key:"reloadTilebyId",value:function(t,o,u){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(t,o,u)}},{key:"reloadTileByLnglat",value:function(t,o,u){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(t,o,u)}},{key:"getTileExtent",value:function(t,o){var u;return(u=this.tileset)===null||u===void 0?void 0:u.getTileExtent(t,o)}},{key:"getTileByZXY",value:function(t,o,u){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(t,o,u)}},{key:"reloadTileByExtent",value:function(t,o){var u;(u=this.tileset)===null||u===void 0||u.reloadTileByExtent(t,o)}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(t=this.tileset)===null||t===void 0||t.destroy()}},{key:"processData",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u=this;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",new Promise(function(v,x){try{u.excuteParser(),u.initCluster(),u.executeTrans(),v({})}catch(S){x(S)}}));case 1:case"end":return p.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"initCfg",value:function(t){this.cfg=Fw(this.cfg,t,Bw);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,H.Z)((0,H.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"excuteParser",value:function(){var t=this.parser,o=t.type||"geojson",u=oe(o);this.data=u(this.originData,t),this.tileset=this.initTileset(),!t.cancelExtent&&(this.extent=tf(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(!!t){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(t),this.tileset;var o=new No((0,H.Z)({},t));return o}}},{key:"executeTrans",value:function(){var t=this,o=this.transforms;o.forEach(function(u){var l=u.type,p=se(l)(t.data,u);Object.assign(t.data,p)})}},{key:"initCluster",value:function(){if(!!this.cluster){var t=this.clusterOptions||{};this.clusterIndex=Uy(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=An(Yu(this.extent),t)),o[0].concat(o[1])}}]),r}(ae.EventEmitter);function Nw(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Gy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Zw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Zw(e,i){if(!!e){if(typeof e=="string")return Hy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hy(e,i)}}function Hy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var l0=6378e3;function Uw(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=t/(2*Math.PI*l0)*(256<<20)/2,u=Vw(r,t),l=u.gridHash,p=u.gridOffset,v=Ww(l,p,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:v}}function Vw(e,i){var r=Infinity,n=-Infinity,t,o=Gy(e),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;t=l.coordinates[1],Number.isFinite(t)&&(r=t<r?t:r,n=t>n?t:n)}}catch(me){o.e(me)}finally{o.f()}var p=(r+n)/2,v=jw(i,p);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var x={},S=Gy(e),A;try{for(S.s();!(A=S.n()).done;){var I=A.value,F=I.coordinates[1],D=I.coordinates[0];if(Number.isFinite(F)&&Number.isFinite(D)){var Z=Math.floor((F+90)/v.yOffset),Y=Math.floor((D+180)/v.xOffset),ve="".concat(Z,"-").concat(Y);x[ve]=x[ve]||{count:0,points:[]},x[ve].count+=1,x[ve].points.push(I)}}}catch(me){S.e(me)}finally{S.f()}return{gridHash:x,gridOffset:v}}function jw(e,i){var r=Gw(e),n=Hw(i,e);return{yOffset:r,xOffset:n}}function Gw(e){return e/l0*(180/Math.PI)}function Hw(e,i){return i/l0*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Ww(e,i,r){return Object.keys(e).reduce(function(n,t,o){var u=t.split("-"),l=parseInt(u[0],10),p=parseInt(u[1],10),v={};if(r.field&&r.method){var x=T(e[t].points,r.field);v[r.method]=C[r.method](x)}return Object.assign(v,{_id:o,coordinates:zi([-180+i.xOffset*(p+.5),-90+i.yOffset*(l+.5)]),rawData:e[t].points,count:e[t].count}),n.push(v),n},[])}var id=Math.PI/3,$w=[0,id,2*id,3*id,4*id,5*id];function Yw(e){return e[0]}function Xw(e){return e[1]}function qw(){var e=0,i=0,r=1,n=1,t=Yw,o=Xw,u,l,p;function v(S){var A={},I=[],F,D=S.length;for(F=0;F<D;++F)if(!(isNaN(Y=+t.call(null,Z=S[F],F,S))||isNaN(ve=+o.call(null,Z,F,S)))){var Z,Y,ve,me=Math.round(ve=ve/p),De=Math.round(Y=Y/l-(me&1)/2),Be=ve-me;if(Math.abs(Be)*3>1){var Je=Y-De,_t=De+(Y<De?-1:1)/2,Zt=me+(ve<me?-1:1),$t=Y-_t,dr=ve-Zt;Je*Je+Be*Be>$t*$t+dr*dr&&(De=_t+(me&1?1:-1)/2,me=Zt)}var lr=De+"-"+me,Yr=A[lr];Yr?Yr.push(Z):(I.push(Yr=A[lr]=[Z]),Yr.x=(De+(me&1)/2)*l,Yr.y=me*p)}return I}function x(S){var A=0,I=0;return $w.map(function(F){var D=Math.sin(F)*S,Z=-Math.cos(F)*S,Y=D-A,ve=Z-I;return A=D,I=Z,[Y,ve]})}return v.hexagon=function(S){return"m"+x(S==null?u:+S).join("l")+"z"},v.centers=function(){for(var S=[],A=Math.round(i/p),I=Math.round(e/l),F=A*p;F<n+u;F+=p,++A)for(var D=I*l+(A&1)*l/2;D<r+l/2;D+=l)S.push([D,F]);return S},v.mesh=function(){var S=x(u).slice(0,4).join("l");return v.centers().map(function(A){return"M"+A+"m"+S}).join("")},v.x=function(S){return arguments.length?(t=S,v):t},v.y=function(S){return arguments.length?(o=S,v):o},v.radius=function(S){return arguments.length?(u=+S,l=u*2*Math.sin(id),p=u*1.5,v):u},v.size=function(S){return arguments.length?(e=i=0,r=+S[0],n=+S[1],v):[r-e,n-i]},v.extent=function(S){return arguments.length?(e=+S[0][0],i=+S[0][1],r=+S[1][0],n=+S[1][1],v):[[e,i],[r,n]]},v.radius(1)}var Kw=6378e3;function Jw(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=i.method,u=o===void 0?"sum":o,l=t/(2*Math.PI*Kw)*(256<<20)/2,p=r.map(function(A){var I=zi(A.coordinates),F=(0,Dn.Z)(I,2),D=F[0],Z=F[1];return(0,H.Z)((0,H.Z)({},A),{},{coordinates:[D,Z]})}),v=qw().radius(l).x(function(A){return A.coordinates[0]}).y(function(A){return A.coordinates[1]}),x=v(p),S={dataArray:x.map(function(A,I){var F;if(i.field&&u){var D=T(A,i.field);A[u]=C[u](D)}return F={},(0,P.Z)(F,i.method,A[u]),(0,P.Z)(F,"count",A.length),(0,P.Z)(F,"rawData",A),(0,P.Z)(F,"coordinates",[A.x,A.y]),(0,P.Z)(F,"_id",I),F}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return S}function Qw(e,i){var r=i.sourceField,n=i.targetField,t=i.data,o={};return t.forEach(function(u){o[u[r]]=u}),e.dataArray=e.dataArray.map(function(u){var l=u[n];return(0,H.Z)((0,H.Z)({},u),o[l])}),e}function eE(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Ue("rasterTile",xw),Ue("mvt",Ce),Ue("geojsonvt",as),Ue("testTile",Aw),Ue("geojson",Qt),Ue("image",Yh),Ue("csv",Rt),Ue("json",Mr),Ue("raster",gr),Ue("rasterRgb",Sw),ze("cluster",Uy),ze("filter",Nw),ze("join",Qw),ze("map",eE),ze("grid",Uw),ze("hexagon",Jw);var c0=zw;function tE(e){var i=rE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function rE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wy=function(e){(0,Xr.Z)(r,e);var i=tE(r);function r(n){var t;return(0,Mt.Z)(this,r),t=i.call(this),(0,P.Z)((0,k.Z)(t),"added",!1),(0,P.Z)((0,k.Z)(t),"eventHandle",function(o){t.polyfillEvent(o),t.emit(o.type,{target:o,data:t.markerOption.extData,lngLat:t.lngLat})}),t.markerOption=(0,H.Z)((0,H.Z)({},t.getDefault()),n),lu(["update","onMove","onMapClick"],(0,k.Z)(t)),t.init(),t}return(0,j.Z)(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Cf.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(qe.IMapService),this.sceneSerive=t.get(qe.ISceneService);var o=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&qa(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var o=this;if(!this.added)return this.once("added",function(){o.setElement(t)}),this;var u=this.markerOption.element;return u&&qa(u),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",function(){t.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",function(){t.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.anchor;this.updatePosition(),Hl(o,"".concat(ma[u]))}}},{key:"onMapClick",value:function(t){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.offsets,l=this.lngLat,p=l.lng,v=l.lat,x=this.mapsService.lngLatToContainer([p,v]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var S=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=S.containerHeight,I=S.containerWidth,F=S.bounds;if(!F)return;if(Math.abs(F[0][0])>180||Math.abs(F[1][0])>180){if(x.x>I){var D=this.mapsService.lngLatToContainer([p-360,v]);x.x=D.x}if(x.x<0){var Z=this.mapsService.lngLatToContainer([p+360,v]);x.x=Z.x}}(x.x>I||x.x<0||x.y>A||x.y<0)&&(o.style.display="none"),o.style.left=x.x+u[0]+"px",o.style.top=x.y-u[1]+"px"}}}},{key:"init",value:function(){var t=this,o=this.markerOption.element,u=this.markerOption,l=u.color,p=u.anchor;if(!o){this.defaultMarker=!0,o=Ai("div"),this.markerOption.element=o;var v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height","48px"),v.setAttributeNS(null,"width","48px"),v.setAttributeNS(null,"viewBox","0 0 1024 1024");var x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),x.setAttributeNS(null,"fill",l),v.appendChild(x),o.appendChild(v)}Bi(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(S){var A,I,F=((A=t.markerOption)===null||A===void 0?void 0:A.style)&&((I=t.markerOption)===null||I===void 0?void 0:I.style[S]);o&&(o.style[S]=F)}),Hc(o,p,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(t){!this.mapsService||this.mapsService.version!=="GAODE2.x"||_c()||(t.type==="touchstart"&&(this.touchStartTime=Date.now()),t.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(t){return null}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),r}(ae.EventEmitter);function nE(e){var i=iE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function iE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aE=yi.merge,yR=function(e){(0,Xr.Z)(r,e);var i=nE(r);function r(n){var t,o;return(0,Mt.Z)(this,r),o=i.call(this),(0,P.Z)((0,k.Z)(o),"markers",[]),(0,P.Z)((0,k.Z)(o),"points",[]),(0,P.Z)((0,k.Z)(o),"clusterMarkers",[]),o.markerLayerOption=aE(o.getDefault(),n),lu(["update"],(0,k.Z)(o)),o.zoom=((t=o.markerLayerOption.clusterOption)===null||t===void 0?void 0:t.zoom)||-99,o}return(0,j.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(qe.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var t=this.mapsService.getContainer();this.containerSize={containerWidth:(t==null?void 0:t.scrollWidth)||0,containerHeight:(t==null?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(t){var o=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(t,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=An(l,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var o=this.markers.indexOf(t);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(t){t.getElement().style.opacity="0"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(t){t.getElement().style.opacity="1"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var t=this.markerLayerOption.cluster;return t?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach(function(o){o.addTo(t.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(t){t.remove()}),this.clusterMarkers.forEach(function(t){t.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(t,o){var u=t.getLnglat(),l=u.lng,p=u.lat,v={geometry:{type:"Point",coordinates:[l,p]},properties:(0,H.Z)((0,H.Z)({},t.getExtData()),{},{marker_id:o})};this.points.push(v),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,o=t.radius,u=t.minZoom,l=u===void 0?0:u,p=t.maxZoom;this.clusterIndex=new(Zy())({radius:o,minZoom:l,maxZoom:p}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,o){var u=this,l=t[0].concat(t[1]),p=this.clusterIndex.getClusters(l,o);this.clusterMarkers.forEach(function(v){v.remove()}),this.clusterMarkers=[],p.forEach(function(v){var x,S=u.markerLayerOption.clusterOption,A=S.field,I=S.method;if((x=v.properties)!==null&&x!==void 0&&x.cluster_id){var F,D=u.getLeaves((F=v.properties)===null||F===void 0?void 0:F.cluster_id);if(v.properties.clusterData=D,A&&I){var Z=D==null?void 0:D.map(function(Be){var Je=(0,P.Z)({},A,Be.properties[A]);return Je}),Y=T(Z,A),ve=L(I,Y),me="point_"+I;v.properties[me]=ve.toFixed(2)}}var De=u.clusterMarker(v);u.clusterMarkers.push(De),De.addTo(u.scene)})}},{key:"getLeaves",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,o,u):null}},{key:"clusterMarker",value:function(t){var o=this.markerLayerOption.clusterOption,u=o,l=u.element,p=l===void 0?this.generateElement.bind(this):l,v=new Wy({element:p(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]});return v}},{key:"normalMarker",value:function(t){var o=t.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var t=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!dn(this.bbox,o))&&(this.bbox=An(o,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var o=Ai("div","l7-marker-cluster"),u=Ai("div","",o),l=Ai("span","",u),p=this.markerLayerOption.clusterOption,v=p.field,x=p.method;t.properties.point_count=t.properties.point_count||1;var S=v&&x?t.properties["point_"+x]||t.properties[v]:t.properties.point_count;return l.textContent=S,o}}]),r}(ae.EventEmitter),_R=N(4157);function oE(e){var i=sE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function sE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ad=function(e){(0,Xr.Z)(r,e);var i=oE(r);function r(n){var t;return(0,Mt.Z)(this,r),t=i.call(this),r.controlCount++,t.controlOption=(0,H.Z)((0,H.Z)({},t.getDefault(n)),n||{}),t}return(0,j.Z)(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(t){var o=this.getDefault(t);Object.entries(t).forEach(function(u){var l=(0,Dn.Z)(u,2),p=l[0],v=l[1];v===void 0&&(t[p]=o[p])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,H.Z)((0,H.Z)({},this.controlOption),t)}},{key:"addTo",value:function(t){this.mapsService=t.get(qe.IMapService),this.renderService=t.get(qe.IRendererService),this.layerService=t.get(qe.ILayerService),this.controlService=t.get(qe.IControlService),this.configService=t.get(qe.IGlobalConfigService),this.scene=t.get(qe.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),Bi(this.container,"l7-control");var o=this.controlOption,u=o.className,l=o.style;return u&&this.setClassName(u),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;qa(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Ai("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var t=this.container;js(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var t=this.container;Bi(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:s.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:s.TOPLEFT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=t,o&&o.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(t){var o=this.container,u=this.controlOption.className;u&&js(o,u),t&&Bi(o,t)}},{key:"setStyle",value:function(t){var o=this.container;t?o.setAttribute("style",t):o.removeAttribute("style")}},{key:"insertContainer",value:function(){var t=this.controlOption.position,o=this.container;if(t instanceof Element)t.appendChild(o);else{var u=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?u.insertBefore(o,u.firstChild):u.appendChild(o)}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(de());(0,P.Z)(ad,"controlCount",0);function uE(e){var i=lE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function lE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sm=function(e){(0,Xr.Z)(r,e);var i=uE(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"isDisable",!1),n}return(0,j.Z)(r,[{key:"setIsDisable",value:function(t){if(this.isDisable=t,t){var o;(o=this.button)===null||o===void 0||o.setAttribute("disabled","true")}else{var u;(u=this.button)===null||u===void 0||u.removeAttribute("disabled")}}},{key:"createButton",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Ai("button","l7-button-control ".concat(t))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var t=this.controlOption,o=t.title,u=t.btnText,l=t.btnIcon;return this.setBtnTitle(o),this.setBtnText(u),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(t){var o=t.title,u=t.btnText,l=t.btnIcon;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(o),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(u),(0,oa.Z)((0,Qe.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"setBtnTitle",value:function(t){var o;(o=this.button)===null||o===void 0||o.setAttribute("title",t!=null?t:"")}},{key:"setBtnIcon",value:function(t){if(this.buttonIcon&&qa(this.buttonIcon),t){var o,u=(o=this.button)===null||o===void 0?void 0:o.firstChild;if(u){var l;(l=this.button)===null||l===void 0||l.insertBefore(t,u)}else{var p;(p=this.button)===null||p===void 0||p.appendChild(t)}this.buttonIcon=t}}},{key:"setBtnText",value:function(t){if(!!this.button)if(js(this.button,"l7-button-control--row"),js(this.button,"l7-button-control--column"),t){var o=this.buttonText;if(!o){var u;o=Ai("div","l7-button-control__text"),(u=this.button)===null||u===void 0||u.appendChild(o),this.buttonText=o}o.innerText=t,Bi(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(qa(this.buttonText),this.buttonText=void 0)}}]),r}(ad);function cE(e){var i=fE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function fE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $y=function(e){(0,Xr.Z)(r,e);var i=cE(r);function r(n,t){var o;return(0,Mt.Z)(this,r),o=i.call(this),(0,P.Z)((0,k.Z)(o),"isShow",!1),(0,P.Z)((0,k.Z)(o),"timeout",null),(0,P.Z)((0,k.Z)(o),"show",function(){return o.isShow||!o.contentDOM.innerHTML||(o.resetPopperPosition(),js(o.popperDOM,"l7-popper-hide"),o.isShow=!0,o.option.unique&&r.conflictPopperList.forEach(function(u){u!==(0,k.Z)(o)&&u.isShow&&u.hide()}),o.emit("show")),(0,k.Z)(o)}),(0,P.Z)((0,k.Z)(o),"hide",function(){return o.isShow&&(Bi(o.popperDOM,"l7-popper-hide"),o.isShow=!1,o.emit("hide")),(0,k.Z)(o)}),(0,P.Z)((0,k.Z)(o),"setHideTimeout",function(){o.timeout||(o.timeout=window.setTimeout(function(){!o.isShow||(o.hide(),o.timeout=null)},300))}),(0,P.Z)((0,k.Z)(o),"clearHideTimeout",function(){o.timeout&&(window.clearTimeout(o.timeout),o.timeout=null)}),(0,P.Z)((0,k.Z)(o),"onBtnClick",function(){o.isShow?o.hide():o.show()}),(0,P.Z)((0,k.Z)(o),"onBtnMouseLeave",function(){o.setHideTimeout()}),(0,P.Z)((0,k.Z)(o),"onBtnMouseMove",function(){o.clearHideTimeout(),!o.isShow&&o.show()}),o.button=n,o.option=t,o.init(),t.unique&&r.conflictPopperList.push((0,k.Z)(o)),o}return(0,j.Z)(r,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(ha(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}},{key:"init",value:function(){var t=this.option.trigger;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),qa(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var t={},o=this.option,u=o.container,l=o.offset,p=l===void 0?[0,0]:l,v=o.placement,x=(0,Dn.Z)(p,2),S=x[0],A=x[1],I=this.button.getBoundingClientRect(),F=u.getBoundingClientRect(),D=$o(I,F),Z=D.left,Y=D.right,ve=D.top,me=D.bottom,De=!1,Be=!1;/^(left|right)/.test(v)?(v.includes("left")?t.right="".concat(I.width+Y,"px"):v.includes("right")&&(t.left="".concat(I.width+Z,"px")),v.includes("start")?t.top="".concat(ve,"px"):v.includes("end")?t.bottom="".concat(me,"px"):(t.top="".concat(ve+I.height/2,"px"),Be=!0,t.transform="translate(".concat(S,"px, calc(").concat(A,"px - 50%))"))):/^(top|bottom)/.test(v)&&(v.includes("top")?t.bottom="".concat(I.height+me,"px"):v.includes("bottom")&&(t.top="".concat(I.height+ve,"px")),v.includes("start")?t.left="".concat(Z,"px"):v.includes("end")?t.right="".concat(Y,"px"):(t.left="".concat(Z+I.width/2,"px"),De=!0,t.transform="translate(calc(".concat(S,"px - 50%), ").concat(A,"px)"))),t.transform="translate(calc(".concat(S,"px - ").concat(De?"50%":"0%","), calc(").concat(A,"px - ").concat(Be?"50%":"0%",")");var Je=v.split("-");Je.length&&Bi(this.popperDOM,Je.map(function(_t){return"l7-popper-".concat(_t)}).join(" ")),dl(this.popperDOM,Ma(t))}},{key:"createPopper",value:function(){var t=this.option,o=t.container,u=t.className,l=u===void 0?"":u,p=t.content,v=Ai("div","l7-popper l7-popper-hide ".concat(l)),x=Ai("div","l7-popper-content"),S=Ai("div","l7-popper-arrow");return v.appendChild(x),v.appendChild(S),o.appendChild(v),this.popperDOM=v,this.contentDOM=x,p&&this.setContent(p),v}}]),r}(ae.EventEmitter);(0,P.Z)($y,"conflictPopperList",[]);function hE(e){var i=pE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function pE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dE={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},vE=function(e){(0,Xr.Z)(r,e);var i=hE(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,oa.Z)((0,Qe.Z)(r.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(t){var o,u=(0,oa.Z)((0,Qe.Z)(r.prototype),"getDefault",this).call(this,t),l=(o=t==null?void 0:t.position)!==null&&o!==void 0?o:u.position;return(0,H.Z)((0,H.Z)({},(0,oa.Z)((0,Qe.Z)(r.prototype),"getDefault",this).call(this,t)),{},{popperPlacement:l instanceof Element?"bottom":dE[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var t=(0,oa.Z)((0,Qe.Z)(r.prototype),"onAdd",this).call(this);return this.initPopper(),t}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var t=this,o=this.controlOption,u=o.popperClassName,l=o.popperPlacement,p=o.popperTrigger,v=this.mapsService.getMapContainer();return this.popper=new $y(this.button,{className:u,placement:l,trigger:p,container:v,unique:!0}),this.popper.on("show",function(){t.emit("popperShow",t)}).on("hide",function(){t.emit("popperHide",t)}),this.popper}},{key:"setOptions",value:function(t){if((0,oa.Z)((0,Qe.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){var o=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(o)}}}]),r}(sm);function mE(e){var i=gE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function gE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Oh=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(Oh||{}),Yy=function(e){(0,Xr.Z)(r,e);var i=mE(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"selectValue",[]),(0,P.Z)((0,k.Z)(n),"createNormalOption",function(l){var p=n.selectValue.includes(l.value),v=Ai("div","l7-select-control-item ".concat(p?Oh.ActiveOptionClassName:""));n.getIsMultiple()&&v.appendChild(n.createCheckbox(p)),l.icon&&v.appendChild(l.icon);var x=Ai("span");return x.innerText=l.text,v.appendChild(x),v}),(0,P.Z)((0,k.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var p=n.selectValue.findIndex(function(v){return v===l.value});p>-1?n.selectValue.splice(p,1):n.selectValue=[].concat((0,V.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,j.Z)(r,[{key:"setOptions",value:function(t){(0,oa.Z)((0,Qe.Z)(r.prototype),"setOptions",this).call(this,t);var o=t.options;o&&this.popper.setContent(this.getPopperContent(o))}},{key:"onAdd",value:function(){var t=(0,oa.Z)((0,Qe.Z)(r.prototype),"onAdd",this).call(this),o=this.controlOption.defaultValue;return o&&(this.selectValue=this.transSelectValue(o)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(t){var o=this,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(t);this.optionDOMList.forEach(function(p){var v=p.getAttribute(Oh.OptionValueAttrKey),x=o.getIsMultiple()?p.querySelector("input[type=checkbox]"):void 0;l.includes(v)?(Bi(p,Oh.ActiveOptionClassName),x&&Au(x,!0)):(js(p,Oh.ActiveOptionClassName),x&&Au(x,!1))}),this.selectValue=l,u&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(t){var o=this,u=this.isImageOptions(),l=Ai("div",u?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Bi(l,"l7-select-control--multiple");var p=t.map(function(v,x){var S=u?o.createImageOption(v):o.createNormalOption(v);return S.setAttribute(Oh.OptionValueAttrKey,v.value),S.setAttribute(Oh.OptionIndexAttrKey,window.String(x)),S.addEventListener("click",o.onItemClick.bind(o,v)),S});return l.append.apply(l,(0,V.Z)(p)),this.optionDOMList=p,l}},{key:"createImageOption",value:function(t){var o=this.selectValue.includes(t.value),u=Ai("div","l7-select-control-item ".concat(o?Oh.ActiveOptionClassName:"")),l=Ai("img");l.setAttribute("src",t.img),cn(l),u.appendChild(l);var p=Ai("div","l7-select-control-item-row");this.getIsMultiple()&&u.appendChild(this.createCheckbox(o));var v=Ai("span");return v.innerText=t.text,p.appendChild(v),u.appendChild(p),u}},{key:"createCheckbox",value:function(t){var o=Ai("input");return o.setAttribute("type","checkbox"),t&&Au(o,!0),o}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(t){return t.img})}},{key:"transSelectValue",value:function(t){return Array.isArray(t)?t:[t]}}]),r}(vE),th=function(i){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("l7-iconfont"),r.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(i)),r.appendChild(n),r};function yE(e){var i=_E();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function _E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xE=function(e){(0,Xr.Z)(r,e);var i=yE(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"onClick",(0,je.Z)(Q().mark(function l(){var p;return Q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(p=n.controlOption.onExport,p!=null){x.next=5;break}x.next=10;break;case 5:return x.t0=p,x.next=8,n.getImage();case 8:x.t1=x.sent,(0,x.t0)(x.t1);case 10:case"end":return x.stop()}},l)}))),(0,P.Z)((0,k.Z)(n),"mergeImage",(0,je.Z)(Q().mark(function l(){var p,v,x,S,A,I,F,D,Z,Y,ve,me,De,Be,Je=arguments;return Q().wrap(function(Zt){for(;;)switch(Zt.prev=Zt.next){case 0:for(x=n.controlOption.imageType,S=(p=(v=n.mapsService.getContainer())===null||v===void 0?void 0:v.getBoundingClientRect())!==null&&p!==void 0?p:{},A=S.width,I=A===void 0?0:A,F=S.height,D=F===void 0?0:F,Z=document.createElement("canvas"),Z.width=I,Z.height=D,Y=Z.getContext("2d"),ve=Je.length,me=new Array(ve),De=0;De<ve;De++)me[De]=Je[De];return Zt.next=9,Promise.all(me.map(function($t){return new Promise(function(dr){var lr=new Image;lr.onload=function(){dr(lr)},lr.src=$t})}));case 9:return Be=Zt.sent,Be.forEach(function($t){Y==null||Y.drawImage($t,0,0,I,D)}),Zt.abrupt("return",Z.toDataURL("image/".concat(x)));case 12:case"end":return Zt.stop()}},l)}))),n}return(0,j.Z)(r,[{key:"onAdd",value:function(){var t=(0,oa.Z)((0,Qe.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}},{key:"getDefault",value:function(t){return(0,H.Z)((0,H.Z)({},(0,oa.Z)((0,Qe.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:th("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l;return Q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.mapsService.exportMap("png");case 2:return u=v.sent,v.next=5,this.scene.exportPng("png");case 5:return l=v.sent,v.abrupt("return",this.mergeImage.apply(this,(0,V.Z)([u,l].filter(function(x){return x}))));case 7:case"end":return v.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(sm);function bE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=SE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function SE(e,i){if(!!e){if(typeof e=="string")return Xy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xy(e,i)}}function Xy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var qy=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],rh=function(){if(typeof document=="undefined")return!1;for(var e=qy[0],i={},r=0,n=qy;r<n.length;r++){var t=n[r],o=t==null?void 0:t[1];if(o in document){var u=bE(t.entries()),l;try{for(u.s();!(l=u.n()).done;){var p=(0,Dn.Z)(l.value,2),v=p[0],x=p[1];i[e[v]]=x}}catch(S){u.e(S)}finally{u.f()}return i}}return!1}(),Ky={change:rh.fullscreenchange,error:rh.fullscreenerror},kl={request:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,r=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,t){var o=function l(){kl.off("change",l),n()};kl.on("change",o);var u=i[rh.requestFullscreen](r);u instanceof Promise&&u.then(o).catch(t)})},exit:function(){return new Promise(function(i,r){if(!kl.isFullscreen){i();return}var n=function o(){kl.off("change",o),i()};kl.on("change",n);var t=document[rh.exitFullscreen]();t instanceof Promise&&t.then(n).catch(r)})},toggle:function(i,r){return kl.isFullscreen?kl.exit():kl.request(i,r)},onchange:function(i){kl.on("change",i)},onerror:function(i){kl.on("error",i)},on:function(i,r){var n=Ky[i];n&&document.addEventListener(n,r,!1)},off:function(i,r){var n=Ky[i];n&&document.removeEventListener(n,r,!1)},raw:rh};Object.defineProperties(kl,{isFullscreen:{get:function(){return Boolean(document[rh.fullscreenElement])}},element:{enumerable:!0,get:function(){var i;return(i=document[rh.fullscreenElement])!==null&&i!==void 0?i:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[rh.fullscreenEnabled])}}}),rh||(kl={isEnabled:!1});var f0=kl;function wE(e){var i=EE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function EE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AE=function(e){(0,Xr.Z)(r,e);var i=wE(r);function r(n){var t;return(0,Mt.Z)(this,r),t=i.call(this,n),(0,P.Z)((0,k.Z)(t),"isFullscreen",!1),(0,P.Z)((0,k.Z)(t),"toggleFullscreen",(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!f0.isEnabled){l.next=3;break}return l.next=3,f0.toggle(t.mapContainer);case 3:case"end":return l.stop()}},o)}))),(0,P.Z)((0,k.Z)(t),"onClick",function(){t.toggleFullscreen()}),(0,P.Z)((0,k.Z)(t),"onFullscreenChange",function(){t.isFullscreen=!!document.fullscreenElement;var o=t.controlOption,u=o.btnText,l=o.btnIcon,p=o.title,v=o.exitBtnText,x=o.exitBtnIcon,S=o.exitTitle;t.isFullscreen?(t.setBtnTitle(S),t.setBtnText(v),t.setBtnIcon(x)):(t.setBtnTitle(p),t.setBtnText(u),t.setBtnIcon(l)),t.emit("fullscreenChange",t.isFullscreen)}),f0.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),t}return(0,j.Z)(r,[{key:"setOptions",value:function(t){var o=t.exitBtnText,u=t.exitBtnIcon,l=t.exitTitle;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(u),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(o),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(l)),(0,oa.Z)((0,Qe.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"onAdd",value:function(){var t=(0,oa.Z)((0,Qe.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),this.mapContainer=qc(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}},{key:"onRemove",value:function(){(0,oa.Z)((0,Qe.Z)(r.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(t){return(0,H.Z)((0,H.Z)({},(0,oa.Z)((0,Qe.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5168\u5C4F",btnIcon:th("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:th("l7-icon-exit-fullscreen")})}}]),r}(sm);function CE(e){var i=TE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function TE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ME=function(e){(0,Xr.Z)(r,e);var i=CE(r);function r(n){var t;return(0,Mt.Z)(this,r),t=i.call(this,n),(0,P.Z)((0,k.Z)(t),"getGeoLocation",function(){return new Promise(function(o,u){window.navigator.geolocation.getCurrentPosition(function(l){var p=l.coords,v=p!=null?p:{},x=v.longitude,S=v.latitude;!isNaN(x)&&!isNaN(S)?o([x,S]):u()},function(l){u(l)})})}),(0,P.Z)((0,k.Z)(t),"onClick",(0,je.Z)(Q().mark(function o(){var u,l,p;return Q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(window.navigator.geolocation){x.next=2;break}return x.abrupt("return");case 2:return u=t.controlOption.transform,x.next=5,t.getGeoLocation();case 5:if(l=x.sent,p=t.mapsService.getZoom(),x.t0=t.mapsService,x.t1=p>15?p:15,!u){x.next=15;break}return x.next=12,u(l);case 12:x.t2=x.sent,x.next=16;break;case 15:x.t2=l;case 16:x.t3=x.t2,x.t0.setZoomAndCenter.call(x.t0,x.t1,x.t3);case 18:case"end":return x.stop()}},o)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),t}return(0,j.Z)(r,[{key:"getDefault",value:function(t){return(0,H.Z)((0,H.Z)({},(0,oa.Z)((0,Qe.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5B9A\u4F4D",btnIcon:th("l7-icon-reposition")})}},{key:"onAdd",value:function(){var t=(0,oa.Z)((0,Qe.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}}]),r}(sm);function IE(e){var i=PE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function PE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jy=function(e){(0,Xr.Z)(r,e);var i=IE(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,P.Z)((0,k.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,P.Z)((0,k.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var p=n.selectValue.includes(l.name),v=l.isVisible();p&&!v&&l.show(),!p&&v&&l.hide()})}),n}return(0,j.Z)(r,[{key:"layers",get:function(){var t=this.layerService,o=this.controlOption.layers;if(Array.isArray(o)&&o.length){var u=[];return o.forEach(function(l){if(l instanceof Object&&u.push(l),typeof l=="string"){var p=t.getLayer(l)||t.getLayerByName(l);p&&u.push(p)}}),u}return t.getLayers()||[]}},{key:"getDefault",value:function(t){return(0,H.Z)((0,H.Z)({},(0,oa.Z)((0,Qe.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:th("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(t){return t.isVisible()}).map(function(t){return t.name})}},{key:"getLayerOptions",value:function(){return this.layers.map(function(t){return{text:t.name,value:t.name}})}},{key:"setOptions",value:function(t){var o=this.checkUpdateOption(t,["layers"]);(0,oa.Z)((0,Qe.Z)(r.prototype),"setOptions",this).call(this,t),o&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var t;return(t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,oa.Z)((0,Qe.Z)(r.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),r}(Yy);function kE(e){var i=LE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function LE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qy=function(e){(0,Xr.Z)(r,e);var i=kE(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getDefault",value:function(){return{position:s.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var t=Ai("div","l7-control-logo");return this.setLogoContent(t),t}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(t){(0,oa.Z)((0,Qe.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["img","href"])&&(ha(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(t){var o=this.controlOption,u=o.href,l=o.img,p=Ai("img");if(p.setAttribute("src",l),p.setAttribute("aria-label","AntV logo"),cn(p),u){var v=Ai("a","l7-control-logo-link");v.target="_blank",v.href=u,v.rel="noopener nofollow",v.setAttribute("rel","noopener nofollow"),v.appendChild(p),t.appendChild(v)}else t.appendChild(p)}}]),r}(ad),RE={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},OE={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function DE(e){var i=FE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function FE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BE=function(e){(0,Xr.Z)(r,e);var i=DE(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,j.Z)(r,[{key:"getDefault",value:function(t){return(0,H.Z)((0,H.Z)({},(0,oa.Z)((0,Qe.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:th("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var t=this.mapsService.getType()==="mapbox"?OE:RE;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(o){var u=(0,Dn.Z)(o,2),l=u[0],p=u[1];return typeof p=="string"&&l!=="blank"}).map(function(o){var u,l=(0,Dn.Z)(o,2),p=l[0],v=l[1],x=(u=t[p])!==null&&u!==void 0?u:{},S=x.text,A=x.img;return{text:S!=null?S:p,value:v,img:A,key:p}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var t,o=this;if((t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var u,l,p=this.controlOption.defaultValue;this.controlOption.defaultValue=(u=(l=this.controlOption.options.find(function(x){return x.key===p}))===null||l===void 0?void 0:l.value)!==null&&u!==void 0?u:p}else{var v=this.getMapStyle();v?this.controlOption.defaultValue=v:this.mapsService.map.once("styledata",function(){var x=o.mapsService.getMapStyle();o.controlOption.defaultValue=x,o.setSelectValue(x,!1)})}return this.on("selectChange",this.onMapThemeChange),(0,oa.Z)((0,Qe.Z)(r.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),r}(Yy);function zE(e){var i=NE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function NE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZE=function(e){(0,Xr.Z)(r,e);var i=zE(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"location",[0,0]),(0,P.Z)((0,k.Z)(n),"onMouseMove",function(l){var p=n.location,v=l.lngLat||l.lnglat,x=n.controlOption.transform;v&&(p=[v.lng,v.lat]),n.location=p,x&&(p=x(p)),n.insertLocation2HTML(p),n.emit("locationChange",p)}),n}return(0,j.Z)(r,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(t){return(0,H.Z)((0,H.Z)({},(0,oa.Z)((0,Qe.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:s.BOTTOMLEFT,transform:function(u){var l=(0,Dn.Z)(u,2),p=l[0],v=l[1];return[+(+p).toFixed(6),+(+v).toFixed(6)]}})}},{key:"onAdd",value:function(){var t=Ai("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(t){this.container.innerText=t.join(", ")}}]),r}(ad);function UE(e){var i=VE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function VE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jE=function(e){(0,Xr.Z)(r,e);var i=UE(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"update",function(){var l=n.mapsService,p=n.controlOption.maxWidth,v=l.getSize()[1]/2,x=l.containerToLngLat([0,v]),S=l.containerToLngLat([p,v]),A=zo([x.lng,x.lat],[S.lng,S.lat]);n.updateScales(A)}),n}return(0,j.Z)(r,[{key:"getDefault",value:function(t){return(0,H.Z)((0,H.Z)({},(0,oa.Z)((0,Qe.Z)(r.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:s.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var t="l7-control-scale",o=Ai("div",t);this.resetScaleLines(o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),o}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(t){(0,oa.Z)((0,Qe.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(t){var o=this.controlOption,u=o.metric,l=o.imperial;u&&t&&this.updateMetric(t),l&&t&&this.updateImperial(t)}},{key:"resetScaleLines",value:function(t){ha(t);var o=this.controlOption,u=o.metric,l=o.imperial,p=o.maxWidth,v=o.lockWidth;v&&dl(t,"width: ".concat(p,"px")),u&&(this.mScale=Ai("div","l7-control-scale-line",t)),l&&(this.iScale=Ai("div","l7-control-scale-line",t)),this.update()}},{key:"updateScale",value:function(t,o,u){var l=this.controlOption.maxWidth;t.style.width=Math.round(l*u)+"px",t.innerHTML=o}},{key:"getRoundNum",value:function(t){var o=Math.pow(10,(Math.floor(t)+"").length-1),u=t/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"updateMetric",value:function(t){var o=this.getRoundNum(t),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/t)}},{key:"updateImperial",value:function(t){var o=t*3.2808399,u,l,p;o>5280?(u=o/5280,l=this.getRoundNum(u),this.updateScale(this.iScale,l+" mi",l/u)):(p=this.getRoundNum(o),this.updateScale(this.iScale,p+" ft",p/o))}}]),r}(ad);function GE(e){var i=HE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function HE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WE=function(e){(0,Xr.Z)(r,e);var i=GE(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,P.Z)((0,k.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,P.Z)((0,k.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,j.Z)(r,[{key:"getDefault",value:function(t){return(0,H.Z)((0,H.Z)({},(0,oa.Z)((0,Qe.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:s.BOTTOMRIGHT,name:"zoom",zoomInText:th("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:th("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(t){(0,oa.Z)((0,Qe.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var t=Ai("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(t){ha(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",t)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(t,o,u,l,p){var v=Ai("button",u,l);return typeof t=="string"?v.innerHTML=t:v.append(t),v.title=o,p&&v.addEventListener("click",p),v}}]),r}(ad);function $E(e){var i=YE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function YE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h0=function(e){(0,Xr.Z)(r,e);var i=$E(r);function r(n){var t;(0,Mt.Z)(this,r),t=i.call(this),(0,P.Z)((0,k.Z)(t),"isShow",!0),(0,P.Z)((0,k.Z)(t),"onMouseMove",function(u){var l,p=t.mapsService.getMapContainer(),v=(l=p==null?void 0:p.getBoundingClientRect())!==null&&l!==void 0?l:{},x=v.left,S=x===void 0?0:x,A=v.top,I=A===void 0?0:A;t.setPopupPosition(u.clientX-S,u.clientY-I)}),(0,P.Z)((0,k.Z)(t),"updateLngLatPosition",function(){if(!(!t.mapsService||t.popupOption.followCursor)){var u=t.lngLat,l=u.lng,p=u.lat,v=t.mapsService.lngLatToContainer([l,p]),x=v.x,S=v.y;t.setPopupPosition(x,S)}}),(0,P.Z)((0,k.Z)(t),"onKeyDown",function(u){u.keyCode===27&&t.remove()}),(0,P.Z)((0,k.Z)(t),"onCloseButtonClick",function(u){u.stopPropagation&&u.stopPropagation(),t.hide()}),(0,P.Z)((0,k.Z)(t),"update",function(){var u=!!t.lngLat,l=t.popupOption,p=l.className,v=l.style,x=l.maxWidth,S=l.anchor,A=l.stopPropagation;if(!(!t.mapsService||!u||!t.content)){var I=t.mapsService.getMarkerContainer();if(!t.container&&I&&(t.container=Ai("div","l7-popup ".concat(p!=null?p:""," ").concat(t.isShow?"":"l7-popup-hide"),I),v&&t.container.setAttribute("style",v),t.tip=Ai("div","l7-popup-tip",t.container),t.container.appendChild(t.content),A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(Z){t.container.addEventListener(Z,function(Y){Y.stopPropagation()})}),t.container.style.whiteSpace="nowrap"),t.updateLngLatPosition(),Hl(t.container,"".concat(ma[S])),Hc(t.container,S,"popup"),x){var F=t.container.getBoundingClientRect(),D=F.width;D>parseFloat(x)&&(t.container.style.width=x)}else t.container.style.removeProperty("width")}}),t.popupOption=(0,H.Z)((0,H.Z)({},t.getDefault(n!=null?n:{})),n);var o=t.popupOption.lngLat;return o&&(t.lngLat=o),t}return(0,j.Z)(r,[{key:"lngLat",get:function(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}},set:function(t){this.popupOption.lngLat=t}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(t){this.mapsService=t.get(qe.IMapService),this.sceneService=t.get(qe.ISceneService),this.layerService=t.get(qe.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var o=this.popupOption,u=o.html,l=o.text,p=o.title;return u?this.setHTML(u):l&&this.setText(l),p&&this.setTitle(p),this.emit("open"),this}},{key:"remove",value:function(){if(!!(this!==null&&this!==void 0&&this.isOpen()))return this.content&&qa(this.content),this.container&&(qa(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(t){return this.show(),this.popupOption=(0,H.Z)((0,H.Z)({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(qa(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&js(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&Bi(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(t){return this.popupOption.html=t,this.setDOMContent(t)}},{key:"setText",value:function(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}},{key:"setTitle",value:function(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=Ai("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),ha(this.contentTitle),Ka(this.contentTitle,t)):this.contentTitle&&(qa(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var t=this.lngLat,o=t.lng,u=t.lat;return this.popupOption.autoPan&&this.mapsService.panTo([o,u]),this}},{key:"setLngLat",value:function(t){return this.setLnglat(t)}},{key:"setLnglat",value:function(t){var o=this;return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){o.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Cf.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(t){return this.show(),this.createContent(),Ka(this.contentPanel,t),this.update(),this}},{key:"updateCloseOnClick",value:function(t){var o=this,u=this.mapsService;u&&(u==null||u.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(function(){u==null||u.on("click",o.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(t){var o,u=(o=this.mapsService)===null||o===void 0?void 0:o.getContainer();u&&(u==null||u.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(u==null||u.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var t=this;if(this.content&&qa(this.content),this.contentTitle=void 0,this.content=Ai("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var o=th("l7-icon-guanbi");Bi(o,"l7-popup-close-button"),this.content.appendChild(o),this.popupOption.closeButtonOffsets&&(o.style.right=this.popupOption.closeButtonOffsets[0]+"px",o.style.top=this.popupOption.closeButtonOffsets[1]+"px"),o.setAttribute("aria-label","Close popup"),o.addEventListener("click",function(){t.hide()}),this.closeButton=o}else this.closeButton=void 0;this.contentPanel=Ai("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(t,o){if(this.container){var u=this.popupOption.offsets;this.container.style.left=t+u[0]+"px",this.container.style.top=o-u[1]+"px"}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(ae.EventEmitter);function XE(e){var i=qE();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function qE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KE=yi.get,xR=function(e){(0,Xr.Z)(r,e);var i=XE(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"layerConfigMap",new WeakMap),n}return(0,j.Z)(r,[{key:"layerConfigItems",get:function(){var t,o=this.popupOption,u=o.config,l=o.items;return(t=u!=null?u:l)!==null&&t!==void 0?t:[]}},{key:"addTo",value:function(t){return(0,oa.Z)((0,Qe.Z)(r.prototype),"addTo",this).call(this,t),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,oa.Z)((0,Qe.Z)(r.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(t){return this.unbindLayerEvent(),(0,oa.Z)((0,Qe.Z)(r.prototype),"setOptions",this).call(this,t),this.bindLayerEvent(),this}},{key:"getDefault",value:function(t){var o=t.trigger==="click";return(0,H.Z)((0,H.Z)({},(0,oa.Z)((0,Qe.Z)(r.prototype),"getDefault",this).call(this,t)),{},{trigger:"hover",followCursor:!o,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var t=this,o=this.popupOption.trigger;this.layerConfigItems.forEach(function(u){var l,p=t.getLayerByConfig(u);if(!!p){var v=(0,H.Z)({},u);if(o==="hover"){var x=t.onLayerMouseMove.bind(t,p),S=t.onLayerMouseOut.bind(t,p);v.onMouseMove=x,v.onMouseOut=S,p==null||p.on("mousemove",x),p==null||p.on("mouseout",S)}else{var A=t.onLayerClick.bind(t,p);v.onClick=A,p==null||p.on("click",A)}var I=p==null||(l=p.getSource)===null||l===void 0?void 0:l.call(p),F=t.onSourceUpdate.bind(t,p);I==null||I.on("update",F),v.onSourceUpdate=F,t.layerConfigMap.set(p,v)}})}},{key:"unbindLayerEvent",value:function(){var t=this;this.layerConfigItems.forEach(function(o){var u=t.getLayerByConfig(o),l=u&&t.layerConfigMap.get(u);if(!!l){var p=l.onMouseMove,v=l.onMouseOut,x=l.onClick,S=l.onSourceUpdate;if(p&&u.off("mousemove",p),v&&u.off("mouseout",v),x&&u.off("click",x),S){var A;u==null||(A=u.getSource())===null||A===void 0||A.off("update",S)}}})}},{key:"onLayerMouseMove",value:function(t,o){if(!this.isSameFeature(t,o.featureId)){var u=this.getLayerInfoFrag(t,o),l=u.title,p=u.content;this.setDOMContent(p),this.setTitle(l),this.displayFeatureInfo={layer:t,featureId:o.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(t,o){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(t,o){if(this.isShow&&this.isSameFeature(t,o.featureId))this.hide();else{var u=this.getLayerInfoFrag(t,o),l=u.title,p=u.content;this.setDOMContent(p),this.setLnglat(o.lngLat),this.setTitle(l),this.displayFeatureInfo={layer:t,featureId:o.featureId},this.show()}}},{key:"onSourceUpdate",value:function(t){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(t,o){var u=this.layerConfigMap.get(t),l,p=document.createDocumentFragment();if(u){var v=o.feature;v.type==="Feature"&&"properties"in v&&"geometry"in v&&(v=v.properties);var x=u.title,S=u.fields,A=u.customContent;if(x){l=document.createDocumentFragment();var I=x instanceof Function?x(v):x;Ka(l,I)}if(A){var F=A instanceof Function?A(v):A;Ka(p,F)}else S!=null&&S.length&&(S==null||S.forEach(function(D){var Z,Y,ve=typeof D=="string"?{field:D}:D,me=ve.field,De=ve.formatField,Be=ve.formatValue,Je=ve.getValue,_t=Ai("div","l7-layer-popup__row"),Zt=Je?Je(o.feature):KE(v,me),$t=(Z=De instanceof Function?De(me,v):De)!==null&&Z!==void 0?Z:me,dr=(Y=Be instanceof Function?Be(Zt,v):Be)!==null&&Y!==void 0?Y:Zt,lr=Ai("span","l7-layer-popup__key",_t);Ka(lr,$t),Ka(lr,document.createTextNode("\uFF1A"));var Yr=Ai("span","l7-layer-popup__value",_t);Array.isArray(dr)&&dr.every(function(un){return!(un instanceof Object)})&&(dr=dr.map(function(un){return String(un)}).join(",")),Ka(Yr,dr),p.appendChild(_t)}))}return{title:l,content:p}}},{key:"getLayerByConfig",value:function(t){var o=t.layer;if(o instanceof Object)return o;if(typeof o=="string")return this.layerService.getLayer(o)||this.layerService.getLayerByName(o)}},{key:"isSameFeature",value:function(t,o){var u=this.displayFeatureInfo;return u&&t===u.layer&&o===u.featureId}}]),r}(h0);function JE(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}JE(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var Dh,e_=(Dh={},(0,P.Z)(Dh,Me.additive,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE,srcAlpha:1,dstAlpha:1}}),(0,P.Z)(Dh,Me.none,{enable:!1}),(0,P.Z)(Dh,Me.normal,{enable:!0,func:{srcRGB:q.SRC_ALPHA,dstRGB:q.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,P.Z)(Dh,Me.subtractive,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE,srcAlpha:q.ZERO,dstAlpha:q.ONE_MINUS_SRC_COLOR},equation:{rgb:q.FUNC_SUBTRACT,alpha:q.FUNC_SUBTRACT}}),(0,P.Z)(Dh,Me.max,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE},equation:{rgb:q.MAX_EXT}}),(0,P.Z)(Dh,Me.min,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE},equation:{rgb:q.MIN_EXT}}),Dh),uc=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({}),t_=yi.cloneDeep;function QE(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=Io(r),t=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return t}function e3(e,i,r){if(e.length>0&&i.version===uc["GAODE2.x"]){var n=r.coordCenter;typeof e[0].coordinates[0]=="number"?e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=uc["GAODE2.x"],t.originCoordinates=t_(t.coordinates),t.coordinates=i.coordToAMap2RelativeCoordinates(t.coordinates,n)}):e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=uc["GAODE2.x"],t.originCoordinates=t_(t.coordinates),t.coordinates=i.coordToAMap2RelativeCoordinates(t.coordinates,n)})}}function t3(e,i){e.length>0&&i.version===uc.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=r3(r.coordinates,i),r.simpleCoordinate=!0)})}function r3(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(t){var o=[];t.map(function(u){o.push(i.simpleMapCoord.unproject(u))}),r.push(o)}),r}else{var n=[];return e.map(function(t){n.push(i.simpleMapCoord.unproject(t))}),n}}function n3(e,i){var r;if(!e.scale)return[];var n=(e==null||(r=e.scale)===null||r===void 0?void 0:r.scalers)||[],t=[];n.forEach(function(u){var l,p=u.field;(i.hasOwnProperty(p)||((l=e.scale)===null||l===void 0?void 0:l.type)==="variable")&&t.push(i[p])});var o=e.mapping?e.mapping(t):[];return o}function i3(e,i,r,n,t){var o=t==null?void 0:t.getLayerConfig(),u=o.arrow,l=u===void 0?{enable:!1}:u,p=i.map(function(v){var x={id:v._id,coordinates:v.coordinates};if(e.filter(function(I){return I.scale!==void 0}).forEach(function(I){var F=n3(I,v);I.needRemapping=!1,I.name==="color"&&(F=F.map(function(D){return gi(D)})),x[I.name]=Array.isArray(F)&&F.length===1?F[0]:F,I.name==="shape"&&(x.shape=r.getIconFontKey(x[I.name]))}),x.shape==="line"&&l.enable){var S=x.coordinates,A=QE(S[0],S[1]);x.coordinates.splice(1,0,A,A)}return x});return e3(p,n,t),t3(p,n),p}function a3(e,i,r,n,t,o){var u=new c0(t,o),l=n.getLayerStyleAttributes()||[],p=u.data.dataArray,v=p,x=i3(l,v,i,r,e);return u.destroy(),x}function r_(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function n_(e,i,r,n){var t=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enableTAA;return u?t.add(n("taa")):t.add(n("render")),r_(i).forEach(function(l){var p=(0,Dn.Z)(l,2),v=p[0],x=p[1];t.add(r(v),x)}),t.add(r("copy")),t}var o3=function(){function e(i){(0,Mt.Z)(this,e),this.layer=i}return(0,j.Z)(e,[{key:"pickRender",value:function(r){var n=this.layer.getContainer(),t=n.get(qe.ILayerService),o=this.layer;if(o.tileLayer)return o.tileLayer.pickRender(r);o.hooks.beforePickingEncode.call(),t.renderTileLayerMask(o),o.renderModels({ispick:!0}),o.hooks.afterPickingEncode.call()}},{key:"pick",value:function(r,n){var t=this.layer.getContainer(),o=t.get(qe.IPickingService);return r.type==="RasterLayer"?this.pickRasterLayer(r,n):(this.pickRender(n),o.pickFromPickingFBO(r,n))}},{key:"pickRasterLayer",value:function(r,n,t){var o=this.layer.getContainer(),u=o.get(qe.IPickingService),l=o.get(qe.IMapService),p=this.layer.getSource().extent,v=Cu(n.lngLat,p),x={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},S=t||r;if(v){var A=this.readRasterValue(r,p,l,n.x,n.y);return x.rasterValue=A,u.triggerHoverOnLayer(S,x),!0}else return x.type=n.type==="mousemove"?"mouseout":"un"+n.type,u.triggerHoverOnLayer(S,(0,H.Z)((0,H.Z)({},x),{},{type:"unpick"})),u.triggerHoverOnLayer(S,x),!1}},{key:"readRasterValue",value:function(r,n,t,o,u){var l=r.getSource().data.dataArray[0],p=(0,Dn.Z)(n,4),v=p[0],x=v===void 0?0:v,S=p[1],A=S===void 0?0:S,I=p[2],F=I===void 0?10:I,D=p[3],Z=D===void 0?-10:D,Y=t.lngLatToContainer([x,A]),ve=t.lngLatToContainer([F,Z]),me=ve.x-Y.x,De=Y.y-ve.y,Be=[(o-Y.x)/me,(u-ve.y)/De],Je=l.width||1,_t=l.height||1,Zt=Math.floor(Be[0]*Je),$t=Math.floor(Be[1]*_t),dr=Math.max(0,$t-1)*Je+Zt,lr=l.data[dr];return lr}},{key:"selectFeature",value:function(r){var n=this.layer,t=(0,Dn.Z)(r,3),o=t[0],u=t[1],l=t[2];n.hooks.beforeSelect.call([o,u,l])}},{key:"highlightPickedFeature",value:function(r){var n=(0,Dn.Z)(r,3),t=n[0],o=n[1],u=n[2];this.layer.hooks.beforeHighlight.call([t,o,u])}},{key:"getFeatureById",value:function(r){return this.layer.getSource().getFeatureById(r)}}]),e}(),s3=function(){function e(i){(0,Mt.Z)(this,e),this.layer=i;var r=this.layer.getContainer();this.rendererService=r.get(qe.IRendererService)}return(0,j.Z)(e,[{key:"getColorTexture",value:function(r,n){var t=this.getTextureKey(r,n);return this.key===t?this.colorTexture:(this.createColorTexture(r,n),this.key=t,this.colorTexture)}},{key:"createColorTexture",value:function(r,n){var t=this.rendererService.createTexture2D,o=this.getColorRampBar(r,n),u=t({data:new Uint8Array(o.data),width:o.width,height:o.height,flipY:!1});return this.colorTexture=u,u}},{key:"setColorTexture",value:function(r,n,t){this.key=this.getTextureKey(n,t),this.colorTexture=r}},{key:"destroy",value:function(){var r;(r=this.colorTexture)===null||r===void 0||r.destroy()}},{key:"getColorRampBar",value:function(r,n){switch(r.type){case"cat":return ls(r);case"quantize":return Wc(r);case"custom":return lh(r,n);case"linear":return zu(r,n);default:return us(r)}}},{key:"getTextureKey",value:function(r,n){var t;return"".concat(r.colors.join("_"),"_").concat(r==null||(t=r.positions)===null||t===void 0?void 0:t.join("_"),"_").concat(r.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),u3=["passes"],l3=["moduleName","vertexShader","fragmentShader","inject","triangulation","segmentNumber"],i_,p0,a_;function c3(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=f3(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function f3(e,i){if(!!e){if(typeof e=="string")return o_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o_(e,i)}}function o_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function h3(e){var i=p3();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function p3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d0=yi.isEqual,s_=yi.isFunction,u_=yi.isNumber,ru=yi.isObject,v3=yi.isPlainObject,m3=yi.isUndefined,l_=0,Fh=(i_=s0(qe.IGlobalConfigService),p0=function(e){(0,Xr.Z)(r,e);var i=h3(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Mt.Z)(this,r),n=i.call(this),(0,P.Z)((0,k.Z)(n),"id","".concat(l_++)),(0,P.Z)((0,k.Z)(n),"name","".concat(l_)),(0,P.Z)((0,k.Z)(n),"visible",!0),(0,P.Z)((0,k.Z)(n),"zIndex",0),(0,P.Z)((0,k.Z)(n),"inited",!1),(0,P.Z)((0,k.Z)(n),"layerModelNeedUpdate",!1),(0,P.Z)((0,k.Z)(n),"pickedFeatureID",null),(0,P.Z)((0,k.Z)(n),"selectedFeatureID",null),(0,P.Z)((0,k.Z)(n),"styleNeedUpdate",!1),(0,P.Z)((0,k.Z)(n),"forceRender",!1),(0,P.Z)((0,k.Z)(n),"clusterZoom",0),(0,P.Z)((0,k.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,P.Z)((0,k.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,P.Z)((0,k.Z)(n),"hooks",{init:new h2,afterInit:new rg,beforeRender:new rg,beforeRenderData:new p2,afterRender:new yf,beforePickingEncode:new yf,afterPickingEncode:new yf,beforeHighlight:new yf(["pickedColor"]),afterHighlight:new yf,beforeSelect:new yf(["pickedColor"]),afterSelect:new yf,beforeDestroy:new yf,afterDestroy:new yf}),(0,P.Z)((0,k.Z)(n),"models",[]),(0,P.Z)((0,k.Z)(n),"startInit",!1),(0,P.Z)((0,k.Z)(n),"layerChildren",[]),(0,P.Z)((0,k.Z)(n),"masks",[]),Or((0,k.Z)(n),"configService",a_,(0,k.Z)(n)),(0,P.Z)((0,k.Z)(n),"animateOptions",{enable:!1}),(0,P.Z)((0,k.Z)(n),"currentPickId",null),(0,P.Z)((0,k.Z)(n),"encodeStyleAttribute",{}),(0,P.Z)((0,k.Z)(n),"enableShaderEncodeStyles",[]),(0,P.Z)((0,k.Z)(n),"enableDataEncodeStyles",[]),(0,P.Z)((0,k.Z)(n),"enablg",[]),(0,P.Z)((0,k.Z)(n),"pendingStyleAttributes",[]),(0,P.Z)((0,k.Z)(n),"scaleOptions",{}),(0,P.Z)((0,k.Z)(n),"animateStatus",!1),(0,P.Z)((0,k.Z)(n),"isDestroyed",!1),(0,P.Z)((0,k.Z)(n),"encodeDataLength",0),(0,P.Z)((0,k.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions);var u=n.layerSource.getSourceCfg().autoRender;u&&n.reRender()}),n.name=t.name||n.id,n.zIndex=t.zIndex||0,n.rawConfig=t,n}return(0,j.Z)(r,[{key:"addMask",value:function(t){this.masks.push(t),this.enableMask()}},{key:"removeMask",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var o=this;if(Object.keys(t).map(function(l){l in o.rawConfig&&(o.rawConfig[l]=t[l])}),!this.startInit)this.needUpdateConfig=(0,H.Z)((0,H.Z)({},this.needUpdateConfig),t);else{var u=this.container.get(qe.SceneID);this.configService.setLayerConfig(u,this.id,(0,H.Z)((0,H.Z)((0,H.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(t,o){this.container=t,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u=this,l,p,v,x,S,A,I;return Q().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:l=this.container.get(qe.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(qe.IIconService),this.fontService=this.container.get(qe.IFontService),this.rendererService=this.container.get(qe.IRendererService),this.layerService=this.container.get(qe.ILayerService),this.debugService=this.container.get(qe.IDebugService),this.interactionService=this.container.get(qe.IInteractionService),this.pickingService=this.container.get(qe.IPickingService),this.mapService=this.container.get(qe.IMapService),p=this.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,v&&x!==null&&x!==void 0&&x.length&&x.length>0&&this.mapService.on("mapAfterFrameChange",function(){u.renderLayers()}),this.cameraService=this.container.get(qe.ICameraService),this.coordinateService=this.container.get(qe.ICoordinateSystemService),this.shaderModuleService=this.container.get(qe.IShaderModuleService),this.postProcessingPassFactory=this.container.get(qe.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(qe.IFactoryNormalPass),this.styleAttributeService=this.container.get(qe.IStyleAttributeService),v&&(this.multiPassRenderer=this.container.get(qe.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(Z){var Y=Z.attributeName,ve=Z.attributeField,me=Z.attributeValues,De=Z.updateOptions;u.styleAttributeService.updateStyleAttribute(Y,{scale:(0,H.Z)({field:ve},u.splitValuesAndCallbackInAttribute(me,u.getLayerConfig()[Y]))},De)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(qe.ILayerPlugin),S=c3(this.plugins);try{for(S.s();!(A=S.n()).done;)I=A.value,I.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(Z){S.e(Z)}finally{S.f()}return this.layerPickService=new o3(this),this.textureService=new s3(this),this.log(ts.LayerInitStart),D.next=31,this.hooks.init.promise();case 31:this.log(ts.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return D.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"log",value:function(t){var o,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(u,".").concat(t),p={id:this.id,type:this.type};(o=this.debugService)===null||o===void 0||o.log(l,p)}}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map(function(o){o.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}},{key:"createModelData",value:function(t,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var l=this.calculateEncodeData(t,o),p=this.triangulation;return l&&p?this.styleAttributeService.createAttributesAndIndices(l,p):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(t){this.layerPickService=t}},{key:"calculateEncodeData",value:function(t,o){return this.inited?a3(this,this.fontService,this.mapService,this.styleAttributeService,t,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var t=this.getLayerConfig(),o=t.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,o,u){return this.updateStyleAttribute("color",t,o,u),this}},{key:"texture",value:function(t,o,u){return this.updateStyleAttribute("texture",t,o,u),this}},{key:"rotate",value:function(t,o,u){return this.updateStyleAttribute("rotate",t,o,u),this}},{key:"size",value:function(t,o,u){return this.updateStyleAttribute("size",t,o,u),this}},{key:"filter",value:function(t,o,u){var l=this.updateStyleAttribute("filter",t,o,u);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(t,o,u){this.shapeOption={field:t,values:o};var l=this.updateStyleAttribute("shape",t,o,u);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(t,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(t){var o={};return ru(t)?(o.enable=!0,o=(0,H.Z)((0,H.Z)({},o),t)):o.enable=t,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(t,o){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(t,o){var u=this;return this.inited?(this.log(ts.SourceInitStart,st.UPDATE),this.layerSource.setData(t,o),this.log(ts.SourceInitEnd,st.UPDATE)):this.on("inited",function(){u.log(ts.SourceInitStart,st.UPDATE);var l=u.getSource();l?u.layerSource.setData(t,o):u.source(new c0(t,o)),u.layerSource.once("update",function(){u.log(ts.SourceInitEnd,st.UPDATE)})}),this}},{key:"style",value:function(t){var o=this,u=t.passes,l=(0,ol.Z)(t,u3);u&&r_(u).forEach(function(v){var x=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(v[0]);x&&x.updateOptions(v[1])});var p=l;return Object.keys(l).forEach(function(v){var x=l[v];Array.isArray(x)&&x.length===2&&!u_(x[0])&&!u_(x[1])&&(p[v]={field:x[0],value:x[1]})}),this.encodeStyle(p),this.updateLayerConfig(p),this}},{key:"encodeStyle",value:function(t){var o=this;Object.keys(t).forEach(function(u){[].concat((0,V.Z)(o.enableShaderEncodeStyles),(0,V.Z)(o.enableDataEncodeStyles)).includes(u)&&v3(t[u])&&(t[u].field||t[u].value)&&!d0(o.encodeStyleAttribute[u],t[u])?(o.encodeStyleAttribute[u]=t[u],o.updateStyleAttribute(u,t[u].field,t[u].value),o.inited&&(o.dataState.dataMappingNeedUpdate=!0)):o.encodeStyleAttribute[u]&&(delete o.encodeStyleAttribute[u],o.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(t,o){var u=(0,H.Z)({},this.scaleOptions);if(ru(t)?this.scaleOptions=(0,H.Z)((0,H.Z)({},this.scaleOptions),t):this.scaleOptions[t]=o,this.styleAttributeService&&!d0(u,this.scaleOptions)){var l=ru(t)?t:(0,P.Z)({},t,o);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(t),this))}},{key:"renderMultiPass",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"active",value:function(t){var o={};return o.enableHighlight=ru(t)?!0:t,ru(t)?(o.enableHighlight=!0,t.color&&(o.highlightColor=t.color),t.mix&&(o.activeMix=t.mix)):o.enableHighlight=!!t,this.updateLayerConfig(o),this}},{key:"setActive",value:function(t,o){var u=this;if(ru(t)){var l=t.x,p=l===void 0?0:l,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({highlightColor:ru(o)?o.color:this.getLayerConfig().highlightColor,activeMix:ru(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:ru(o)?o.color:this.getLayerConfig().highlightColor,activeMix:ru(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Do(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(t){var o={};return o.enableSelect=ru(t)?!0:t,ru(t)?(o.enableSelect=!0,t.color&&(o.selectColor=t.color),t.mix&&(o.selectMix=t.mix)):o.enableSelect=!!t,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(t,o){var u=this;if(ru(t)){var l=t.x,p=l===void 0?0:l,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({selectColor:ru(o)?o.color:this.getLayerConfig().selectColor,selectMix:ru(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:ru(o)?o.color:this.getLayerConfig().selectColor,selectMix:ru(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Do(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,l=o.minZoom,p=l===void 0?-Infinity:l,v=o.maxZoom,x=v===void 0?Infinity:v;return!!u&&t>=p&&t<x}},{key:"setMultiPass",value:function(t,o){if(this.updateLayerConfig({enableMultiPassRenderer:t}),o&&this.updateLayerConfig({passes:o}),t){var u=this.getLayerConfig(),l=u.passes,p=l===void 0?[]:l;this.multiPassRenderer=n_(this,p,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var v=this.rendererService.getViewportSize(),x=v.width,S=v.height;this.multiPassRenderer.resize(x,S)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){var t=this.getLayerConfig(),o=t.minZoom;return o}},{key:"getMaxZoom",value:function(){var t=this.getLayerConfig(),o=t.maxZoom;return o}},{key:"get",value:function(t){var o=this.getLayerConfig();return o[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,l=u.some(function(p){return Math.abs(p)===Infinity});return l?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],t),this)}},{key:"destroy",value:function(){var t,o,u,l,p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){this.layerChildren.map(function(S){return S.destroy(!1)}),this.layerChildren=[];var v=this.getLayerConfig(),x=v.maskfence;x&&(this.masks.map(function(S){return S.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(t=this.multiPassRenderer)===null||t===void 0||t.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(p),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],(l=this.debugService)===null||l===void 0||l.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach(function(o){return o.destroy()}),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices}).length}},{key:"setSource",value:function(t){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var p=l.type;if(o.coordCenter===void 0){var v,x=o.layerSource.center;o.coordCenter=x,(v=o.mapService)!==null&&v!==void 0&&v.setCoordCenter&&o.mapService.setCoordCenter(x)}if(p==="update"){if(o.tileLayer){o.tileLayer.reload();return}o.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var o,u,l,p=this.styleAttributeService.getLayerStyleAttribute(t),v=(p==null||(o=p.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(u=v[0].option)===null||u===void 0?void 0:u.type,field:p==null||(l=p.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var o=this.styleAttributeService.getLayerAttributeScale(t);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(v){return(0,P.Z)({value:o.invertExtent(v)},t,v)});return u}else if(o.ticks){var l=o.ticks().map(function(v){return(0,P.Z)({value:v},t,o(v))});return l}else if(o!=null&&o.domain){var p=o.domain().filter(function(v){return!m3(v)}).map(function(v){return(0,P.Z)({value:v},t,o(v))});return p}return[]}},{key:"pick",value:function(t){var o=t.x,u=t.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(t,o){this.pickingService.boxPickLayer(this,t,o)}},{key:"buildLayerModel",value:function(){var n=(0,je.Z)(Q().mark(function o(u){var l=this,p,v,x,S,A,I,F,D,Z,Y,ve,me;return Q().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return p=u.moduleName,v=u.vertexShader,x=u.fragmentShader,S=u.inject,A=u.triangulation,I=u.segmentNumber,F=(0,ol.Z)(u,l3),this.shaderModuleService.registerModule(p,{vs:v,fs:x,inject:S}),D=this.shaderModuleService.getModule(p),Z=D.vs,Y=D.fs,ve=D.uniforms,me=this.rendererService.createModel,Be.abrupt("return",new Promise(function(Je){var _t=l.styleAttributeService.createAttributesAndIndices(l.encodedData,A,I),Zt=_t.attributes,$t=_t.elements,dr=_t.count,lr=(0,H.Z)({attributes:Zt,uniforms:ve,fs:Y,vs:Z,elements:$t,blend:e_[Me.normal]},F);dr&&(lr.count=dr);var Yr=me(lr);Je(Yr)}));case 5:case"end":return Be.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"createAttributes",value:function(t){var o=t.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),l=u.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){var o=this.getLayerConfig(),u=o.enableHighlight,l=u===void 0?!0:u,p=o.enableSelect,v=p===void 0?!0:p,x=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&v&&(x=!0),t==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(x=!0),this.isVisible()&&x}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMulPass",value:function(){var n=(0,je.Z)(Q().mark(function o(u){return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,u.render();case 2:case"end":return p.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var t=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(u){u.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(o)},(o==null?void 0:o.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(t,o,u,l){var p=this.configService.getAttributeConfig(this.id)||{};return d0(p[t],{field:o,values:u})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,(0,P.Z)({},t,{field:o,values:u})),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,H.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},l):this.pendingStyleAttributes.push({attributeName:t,attributeField:o,attributeValues:u,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"processData",value:function(t){return t}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.models.forEach(function(p){return p.destroy()}),this.models=[],l.next=4,this.layerModel.initModels();case 4:this.models=l.sent;case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t,o){return{values:s_(t)?void 0:t||o,callback:s_(t)?t:void 0}}}]),r}(ae.EventEmitter),a_=cr(p0.prototype,"configService",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p0);function g3(e,i){return{enable:e,mask:255,func:{cmp:q.EQUAL,ref:i?1:0,mask:1}}}function c_(e){return e.maskOperation===Ve.OR?{enable:!0,mask:255,func:{cmp:q.ALWAYS,ref:1,mask:255},opFront:{fail:q.KEEP,zfail:q.REPLACE,zpass:q.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===Xe.SINGLE||e.stencilIndex===0?q.ALWAYS:q.LESS,ref:e.stencilType===Xe.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:q.KEEP,zfail:q.REPLACE,zpass:q.REPLACE}}}function y3(e){switch(e){case"rotation":return{name:"Rotation",type:hn.Attribute,descriptor:{name:"a_Rotation",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(r){var n=r.rotation,t=n===void 0?0:n;return Array.isArray(t)?[t[0]]:[t]}}};case"stroke":return{name:"stroke",type:hn.Attribute,descriptor:{name:"a_Stroke",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(r){var n=r.stroke,t=n===void 0?[1,1,1,1]:n;return t}}};case"opacity":return{name:"opacity",type:hn.Attribute,descriptor:{name:"a_Opacity",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(r){var n=r.opacity,t=n===void 0?1:n;return[t]}}};case"offsets":return{name:"offsets",type:hn.Attribute,descriptor:{name:"a_Offsets",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(r){var n=r.offsets;return n}}};default:return}}var f_,v0,h_,da=(f_=s0(qe.IGlobalConfigService),v0=function(){function e(i){(0,Mt.Z)(this,e),(0,P.Z)(this,"preStyleAttribute",{}),(0,P.Z)(this,"encodeStyleAttribute",{}),Or(this,"configService",h_,this),this.layer=i,this.rendererService=i.getContainer().get(qe.IRendererService),this.pickingService=i.getContainer().get(qe.IPickingService),this.shaderModuleService=i.getContainer().get(qe.IShaderModuleService),this.styleAttributeService=i.getContainer().get(qe.IStyleAttributeService),this.mapService=i.getContainer().get(qe.IMapService),this.iconService=i.getContainer().get(qe.IIconService),this.fontService=i.getContainer().get(qe.IFontService),this.cameraService=i.getContainer().get(qe.ICameraService),this.layerService=i.getContainer().get(qe.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r}return(0,j.Z)(e,[{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,t=n===void 0?"normal":n;return e_[Me[t]]}},{key:"getStencil",value:function(r){var n=this.layer.getLayerConfig(),t=n.mask,o=t===void 0?!1:t,u=n.maskInside,l=u===void 0?!0:u,p=n.enableMask,v=n.maskOperation,x=v===void 0?Ve.AND:v;if(this.layer.type==="MaskLayer")return c_({isStencil:!0,stencilType:Xe.SINGLE});if(r.isStencil)return c_((0,H.Z)((0,H.Z)({},r),{},{maskOperation:x}));var S=o||p&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return g3(S,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var i=(0,je.Z)(Q().mark(function n(){return Q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",!1);case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var i=(0,je.Z)(Q().mark(function n(){return Q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var i=(0,je.Z)(Q().mark(function n(){return Q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(r){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var r=this.layer.encodeStyleAttribute,n="",t={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float"};this.layer.enableShaderEncodeStyles.forEach(function(u){r[u]&&(n+="#define USE_ATTRIBUTE_".concat(u.toUpperCase(),` 0.0; 

`)),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(u.toUpperCase(),`
      attribute `).concat(t[u]," a_").concat(u.charAt(0).toUpperCase()+u.slice(1),`;
    #else
      uniform `).concat(t[u]," u_").concat(u,`;
    #endif

    `)});var o="";return this.layer.enableShaderEncodeStyles.forEach(function(u){o+=`

#ifdef USE_ATTRIBUTE_`.concat(u.toUpperCase(),`
  `).concat(t[u]," ").concat(u,"  = a_").concat(u.charAt(0).toUpperCase()+u.slice(1),`;
#else
  `).concat(t[u]," ").concat(u," = u_").concat(u,`;
#endif

`)}),{"vs:#decl":n,"vs:#main-start":o}}},{key:"getStyleAttribute",value:function(){var r=this,n={},t={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0};return this.layer.enableShaderEncodeStyles.forEach(function(o){if(!r.layer.encodeStyleAttribute[o]){var u=r.layer.getLayerConfig()[o],l=typeof u=="undefined"?t[o]:u;o==="stroke"&&(l=gi(l)),n["u_"+o]=l}}),n}},{key:"registerStyleAttribute",value:function(){var r=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var t=y3(n);t&&r.styleAttributeService.registerStyleAttribute(t)})}},{key:"updateEncodeAttribute",value:function(r,n){this.encodeStyleAttribute[r]=n}}]),e}(),h_=cr(v0.prototype,"configService",[f_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v0),m0=100,bR=36,SR=40;function p_(e){return e/180*Math.acos(-1)}function d_(e){var i=p_(e[0])+Math.PI/2,r=p_(e[1]),n=m0+Math.random()*.4,t=n*Math.cos(r)*Math.cos(i),o=n*Math.cos(r)*Math.sin(i),u=n*Math.sin(r);return[o,u,t]}function wR(e,i){var r=mat4.create(),n=mat4.create(),t=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var u=typeof i.segments!="undefined"?i.segments:32,l=2+u,p=2*l,v=[],x=[],S=[],A=[],I=[],F=[],D=0;D<=l;D++){for(var Z=D/l,Y=Z*Math.PI,ve=0;ve<=p;ve++){var me=ve/p,De=me*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Y),mat4.identity(r),mat4.rotateY(r,r,De),vec3.transformMat4(o,t,n),vec3.transformMat4(o,o,r),vec3.scale(o,o,-e),S.push(o.slice()),A.push.apply(A,_toConsumableArray(o.slice())),vec3.normalize(o,o),I.push.apply(I,_toConsumableArray(o.slice())),F.push([me,1-Z]),A.push(me,1-Z)}if(D>0)for(var Be=S.length,Je=Be-2*(p+1);Je+p+2<Be;Je++)v.push([Je,Je+1,Je+p+1]),x.push(Je,Je+1,Je+p+1),v.push([Je+p+1,Je+1,Je+p+2]),x.push(Je+p+1,Je+1,Je+p+2)}return{cells:v,positions:S,uvs:F,positionsArr:A,indicesArr:x,normalArr:I}}var um=Lr.create(),ER=Lr.create(),ms=Lr.create(),Bh=Lr.create(),od=Lr.create();function g0(e,i,r,n,t){Lr.add(e,r,n),Lr.normalize(e,e),i=Lr.fromValues(-e[1],e[0]);var o=Lr.fromValues(-r[1],r[0]);return[t/Lr.dot(i,o),i]}function zh(e,i){return Lr.set(e,-i[1],i[0])}function sd(e,i,r){return Lr.sub(e,i,r),Lr.normalize(e,e),e}function y0(e,i){return e[0]===i[0]&&e[1]===i[1]}function AR(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var _3=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Mt.Z)(this,e),(0,P.Z)(this,"lastFlip",-1),(0,P.Z)(this,"miter",Lr.fromValues(0,0)),(0,P.Z)(this,"started",!1),(0,P.Z)(this,"dash",!1),(0,P.Z)(this,"totalDistance",0),(0,P.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,j.Z)(e,[{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],I=r[l];I.push((v=n[l][2])!==null&&v!==void 0?v:0);var F=n[l],D=l<r.length-1?[].concat((0,V.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,Z=l<n.length-1?n[l+1]:null,Y=this.simpleSegment(t,u,S,I,D,A,F,Z);u+=Y}if(this.dash)for(var ve=0;ve<t.positions.length/6;ve++)t.positions[ve*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],I=r[l];I.push((v=n[l][2])!==null&&v!==void 0?v:0);var F=n[l],D=l<r.length-1?[].concat((0,V.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,Z=l<n.length-1?n[l+1]:null,Y=this.segment_gaode2(t,u,S,I,D,A,F,Z);u+=Y}if(this.dash)for(var ve=0;ve<t.positions.length/6;ve++)t.positions[ve*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=zi([o[0],o[1]]),A=zi([t[0],t[1]]);sd(ms,S,A);var I=0;if(this.dash&&(I=this.lineSegmentDistance(S,A),this.totalDistance+=I),this.normal||(this.normal=Lr.create(),zh(this.normal,ms)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-I)),p.push(n+0,n+1,n+2),!u)zh(this.normal,ms),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var F=zi([u[0],u[1]]);y0(S,F)&&Lr.add(F,S,Lr.normalize(F,Lr.subtract(F,S,A))),sd(Bh,F,S);var D=g0(od,Lr.create(),ms,Bh,this.thickness),Z=(0,Dn.Z)(D,2),Y=Z[0],ve=Z[1],me=Lr.dot(od,this.normal)<0?-1:1;this.extrusions(v,x,o,ve,Y,this.totalDistance),p.push.apply(p,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),me=-1,Lr.copy(this.normal,ve),l+=2,this.lastFlip=me}return l}},{key:"segment_gaode2",value:function(r,n,t,o,u,l,p,v){var x=0,S=r.indices,A=r.positions,I=r.normals,F=this.cap==="square",D=this.join==="bevel",Z=zi([p[0],p[1]]),Y=zi([l[0],l[1]]);sd(ms,o,t);var ve=0;if(this.dash&&(ve=this.lineSegmentDistance(Z,Y),this.totalDistance+=ve),this.normal||(this.normal=Lr.create(),zh(this.normal,ms)),!this.started)if(this.started=!0,F){var me=Lr.create(),De=Lr.create();Lr.add(me,this.normal,ms),Lr.add(De,this.normal,ms),I.push(De[0],De[1],0),I.push(me[0],me[1],0),A.push(t[0],t[1],t[2]|0,this.totalDistance-ve,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),A.push(t[0],t[1],t[2]|0,this.totalDistance-ve,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,I,t,this.normal,this.thickness,this.totalDistance-ve);if(S.push(n+0,n+1,n+2),u){y0(o,u)&&Lr.add(u,o,Lr.normalize(u,Lr.subtract(u,o,t))),sd(Bh,u,o);var _t=g0(od,Lr.create(),ms,Bh,this.thickness),Zt=(0,Dn.Z)(_t,2),$t=Zt[0],dr=Zt[1],lr=Lr.dot(od,this.normal)<0?-1:1,Yr=D;if(!Yr&&this.join==="miter"){var un=$t;un>this.miterLimit&&(Yr=!0)}Yr?(I.push(this.normal[0],this.normal[1],0),I.push(dr[0],dr[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*lr,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*lr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,S.push.apply(S,(0,V.Z)(this.lastFlip!==-lr?[n,n+2,n+3]:[n+2,n+1,n+3])),S.push(n+2,n+3,n+4),zh(um,Bh),Lr.copy(this.normal,um),I.push(this.normal[0],this.normal[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*lr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(A,I,o,dr,$t,this.totalDistance),S.push.apply(S,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),lr=-1,Lr.copy(this.normal,dr),x+=2),this.lastFlip=lr}else{if(zh(this.normal,ms),F){var Be=Lr.create(),Je=Lr.create();Lr.sub(Je,ms,this.normal),Lr.add(Be,ms,this.normal),I.push(Je[0],Je[1],0),I.push(Be[0],Be[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,I,o,this.normal,this.thickness,this.totalDistance);S.push.apply(S,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"segment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=this.cap==="square",A=this.join==="bevel",I=zi([o[0],o[1]]),F=zi([t[0],t[1]]);sd(ms,I,F);var D=0;if(this.dash&&(D=this.lineSegmentDistance(I,F),this.totalDistance+=D),this.normal||(this.normal=Lr.create(),zh(this.normal,ms)),!this.started)if(this.started=!0,S){var Z=Lr.create(),Y=Lr.create();Lr.add(Z,this.normal,ms),Lr.add(Y,this.normal,ms),x.push(Y[0],Y[1],0),x.push(Z[0],Z[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-D,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-D,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-D);if(p.push(n+0,n+1,n+2),u){var De=zi([u[0],u[1]]);y0(I,De)&&Lr.add(De,I,Lr.normalize(De,Lr.subtract(De,I,F))),sd(Bh,De,I);var Be=g0(od,Lr.create(),ms,Bh,this.thickness),Je=(0,Dn.Z)(Be,2),_t=Je[0],Zt=Je[1],$t=Lr.dot(od,this.normal)<0?-1:1,dr=A;if(!dr&&this.join==="miter"){var lr=_t;lr>this.miterLimit&&(dr=!0)}dr?(x.push(this.normal[0],this.normal[1],0),x.push(Zt[0],Zt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,V.Z)(this.lastFlip!==-$t?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),zh(um,Bh),Lr.copy(this.normal,um),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Zt,_t,this.totalDistance),p.push.apply(p,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),$t=-1,Lr.copy(this.normal,Zt),l+=2),this.lastFlip=$t}else{if(zh(this.normal,ms),S){var ve=Lr.create(),me=Lr.create();Lr.sub(me,ms,this.normal),Lr.add(ve,ms,this.normal),x.push(me[0],me[1],0),x.push(ve[0],ve[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,t,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,l,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,l,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}(),va=N(77160);function x3(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,t=Qa().flatten(e),o=t.vertices,u=t.dimensions,l=[],p=[],v=0;v<o.length/u;v++)u===2?l.push(o[v*2],o[v*2+1],1):l.push(o[v*3],o[v*3+1],1);var x=Qa()(t.vertices,t.holes,t.dimensions);p.push.apply(p,(0,V.Z)(x));for(var S=function(){var F=t.vertices.slice(A*u,(A+1)*u),D=t.vertices.slice((A+1)*u,(A+2)*u);D.length===0&&(D=t.vertices.slice(0,u));var Z=l.length/3;l.push(F[0],F[1],1,D[0],D[1],1,F[0],F[1],0,D[0],D[1],0),p.push.apply(p,(0,V.Z)([0,2,1,2,3,1].map(function(Y){return Y+Z})))},A=0;A<n;A++)S();return{positions:l,index:p}}function b3(e){var i=Qa().flatten(e),r=Qa()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function v_(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var t=e[0].length,o=Qa().flatten(e),u=o.vertices,l=o.dimensions,p=[],v=[],x=[],S=0;S<u.length/l;S++)p.push(u[S*l],u[S*l+1],1,-1,-1),x.push(0,0,1);var A=Qa()(o.vertices,o.holes,o.dimensions);v.push.apply(v,(0,V.Z)(A));for(var I=function(){var Z=o.vertices.slice(F*l,(F+1)*l),Y=o.vertices.slice((F+1)*l,(F+2)*l);Y.length===0&&(Y=o.vertices.slice(0,l));var ve=p.length/5;p.push(Z[0],Z[1],1,0,0,Y[0],Y[1],1,.1,0,Z[0],Z[1],0,0,.8,Y[0],Y[1],0,.1,.8);var me=S3([Y[0],Y[1],1],[Z[0],Z[1],0],[Z[0],Z[1],1],i);x.push.apply(x,(0,V.Z)(me).concat((0,V.Z)(me),(0,V.Z)(me),(0,V.Z)(me))),v.push.apply(v,(0,V.Z)([1,2,0,3,2,1].map(function(De){return De+ve})))},F=0;F<t;F++)I();return{positions:p,index:v,normals:x}}function S3(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=va.create(),o=va.create(),u=va.create();n&&(e=cs(e),i=cs(i),r=cs(r));var l=va.fromValues.apply(va,(0,V.Z)(e)),p=va.fromValues.apply(va,(0,V.Z)(i)),v=va.fromValues.apply(va,(0,V.Z)(r));va.sub(t,v,p),va.sub(o,l,p),va.cross(u,t,o);var x=va.create();return va.normalize(x,u),x}var lc,tv=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),rv=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function nv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],t=0;t<e;t++)n.push(r*t+i*Math.PI/12);var o=n.map(function(u){var l=Math.sin(u+Math.PI/4),p=Math.cos(u+Math.PI/4);return[l,p,0]});return o}function m_(){return nv(30)}function g_(){return nv(4)}function y_(){return nv(3)}function __(){return nv(6,1)}function x_(){return nv(5)}var ud=(lc={},(0,P.Z)(lc,rv.CIRCLE,m_),(0,P.Z)(lc,rv.HEXAGON,__),(0,P.Z)(lc,rv.TRIANGLE,y_),(0,P.Z)(lc,rv.SQUARE,g_),(0,P.Z)(lc,rv.PENTAGON,x_),(0,P.Z)(lc,tv.CYLINDER,m_),(0,P.Z)(lc,tv.HEXAGONCOLUMN,__),(0,P.Z)(lc,tv.TRIANGLECOLUMN,y_),(0,P.Z)(lc,tv.SQUARECOLUMN,g_),(0,P.Z)(lc,tv.PENTAGONCOLUMN,x_),lc),lm={};function cm(e){var i=ra(e.coordinates);return{vertices:[].concat((0,V.Z)(i),(0,V.Z)(i),(0,V.Z)(i),(0,V.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function b_(e){var i=ra(e.coordinates),r=d_(i);return{vertices:[].concat((0,V.Z)(r),(0,V.Z)(r),(0,V.Z)(r),(0,V.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function _0(e){var i=e.shape,r=P3(i,!1),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function w3(e){var i=ra(e.coordinates);return{vertices:(0,V.Z)(i),indices:[0],size:i.length}}function x0(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new _3({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(A){t.extrude(A)})}var S=t.complex;return{vertices:S.positions,indices:S.indices,normals:S.normals,indexes:S.indexes,size:6}}function E3(e){var i=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat((0,V.Z)(i),[1,2,-3],(0,V.Z)(i),[1,1,-3],(0,V.Z)(i),[0,1,0],(0,V.Z)(i),[0,0,0],(0,V.Z)(i),[1,0,0],(0,V.Z)(i),[1,2,-3],(0,V.Z)(i),[1,1,-3],(0,V.Z)(i),[0,1,0],(0,V.Z)(i),[0,0,0],(0,V.Z)(i)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function CR(e){var i=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat(_toConsumableArray(i),[1,2,-3],_toConsumableArray(i),[1,1,-3],_toConsumableArray(i),[0,1,0],_toConsumableArray(i),[0,0,0],_toConsumableArray(i)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1],indices:[0,1,1,2,2,3,3,4,4,0],size:7}}function A3(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=C3(i),t=n.results,o=n.totalDistance;return t.map(function(u){r.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:r,indices:[],normals:[],size:6,count:t.length}}function TR(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],size:4,count:0};var n=T3(i),t=n.results;return t.map(function(o){r.push(o[0],o[1],o[2],o[3])}),{vertices:r,indices:[],size:4,count:t.length}}function S_(e,i){var r=i[0]-e[0],n=i[1]-e[1];return Math.sqrt(r*r+n*n)}function ld(e,i){return e.length<3&&e.push(0),i!==void 0&&e.push(i),e}function C3(e){var i=e;Array.isArray(i)&&Array.isArray(i[0])&&Array.isArray(i[0][0])&&(i=e.flat());var r=0;if(i.length<2)return{results:i,totalDistance:0};var n=[],t=ld(i[0],r);n.push(t);for(var o=1;o<i.length-1;o++){var u=S_(i[o-1],i[o]);r+=u;var l=ld(i[o],r);n.push(l),n.push(l)}var p=S_(i[i.length-2],i[i.length-1]);return r+=p,n.push(ld(i[i.length-1],r)),{results:n,totalDistance:r}}function T3(e){if(e.length<2)return{results:e};var i=[],r=ld(e[0]);i.push(r);for(var n=1;n<e.length-1;n++){var t=ld(e[n]);i.push(t),i.push(t)}return i.push(ld(e[e.length-1])),{results:i}}function b0(e){var i=e.coordinates,r=Qa().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Qa()(n,o,t),vertices:n,size:t}}function M3(e){var i=e.coordinates,r=Qa().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Qa()(n,o,t),vertices:I3(n),size:t+4}}function I3(e){for(var i=[],r=Bf(e),n=r.center,t=r.radius,o=0;o<e.length;o+=2){var u=e[o],l=e[o+1];i.push.apply(i,[u,l,0].concat((0,V.Z)(n),[t]))}return i}function w_(e){var i=e.coordinates,r=v_(i,!0),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function E_(e){var i=e.shape,r=L3(i),n=r.positions,t=r.index;return{vertices:n,indices:t,size:3}}function fm(e){var i=e.coordinates,r=[].concat((0,V.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,V.Z)(i[1]),[0,1,0],(0,V.Z)(i[0]),[0,0,1],(0,V.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function hm(e,i){for(var r=i||30,n=e.coordinates,t=[],o=[],u=function(v){t.push(v,1,v,n[0][0],n[0][1],n[1][0],n[1][1],v,-1,v,n[0][0],n[0][1],n[1][0],n[1][1]),v!==r-1&&o.push.apply(o,(0,V.Z)([0,1,2,1,3,2].map(function(x){return v*2+x})))},l=0;l<r;l++)u(l);return{vertices:t,indices:o,size:7}}function A_(e){var i=e.coordinates;i.length===2&&i.push(0);var r=pm(-1,1),n=pm(1,1),t=pm(-1,-1),o=pm(1,-1),u=[].concat((0,V.Z)(i),(0,V.Z)(r),(0,V.Z)(i),(0,V.Z)(t),(0,V.Z)(i),(0,V.Z)(o),(0,V.Z)(i),(0,V.Z)(n)),l=[0,1,2,3,0,2];return{vertices:u,indices:l,size:5}}function P3(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(lm&&lm[e])return lm[e];var r=ud[e]?ud[e]():ud.cylinder(),n=v_([r],i);return lm[e]=n,n}function MR(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=new Float32Array(e.length/r*3),o,u,l,p=vec3.create(),v=vec3.create(),x=vec3.create(),S=0,A=i.length;S<A;S+=3){o=i[S+0]*3,u=i[S+1]*3,l=i[S+2]*3;var I=[e[o],e[o+1]],F=[e[u],e[u+1]],D=[e[l],e[l+1]];n&&(I=lngLatToMeters(I),F=lngLatToMeters(F),D=lngLatToMeters(D));var Z=I,Y=_slicedToArray(Z,2),ve=Y[0],me=Y[1],De=vec3.fromValues(ve,me,e[o+2]),Be=F,Je=_slicedToArray(Be,2),_t=Je[0],Zt=Je[1],$t=vec3.fromValues(_t,Zt,e[u+2]),dr=D,lr=_slicedToArray(dr,2),Yr=lr[0],un=lr[1],In=vec3.fromValues(Yr,un,e[l+2]);vec3.sub(p,In,$t),vec3.sub(v,De,$t),vec3.cross(x,p,v),t[o]+=p[0],t[o+1]+=p[1],t[o+2]+=p[2],t[u]+=p[0],t[u+1]+=p[1],t[u+2]+=p[2],t[l]+=p[0],t[l+1]+=p[1],t[l+2]+=p[2]}return k3(t),t}function k3(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),t=vec3.create();vec3.normalize(t,n),e.set(t,i)}}function IR(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function L3(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=ud[e]?ud[e]():ud.circle(),n=i.indexOf(e)===-1?b3([r]):x3([r]);return n}function pm(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function PR(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function kR(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function R3(e){var i=O3();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function O3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D3=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,F3=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,B3=function(e){(0,Xr.Z)(r,e);var i=R3(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.baseColor,p=l===void 0?"rgb(16,16,16)":l,v=t.brightColor,x=v===void 0?"rgb(255,176,38)":v,S=t.windowColor,A=S===void 0?"rgb(30,60,89)":S,I=t.time,F=I===void 0?0:I,D=t.sweep,Z=D===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:D;return{u_cityCenter:Z.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*Z.sweepRadius,u_circleSweep:Z.enable?1:0,u_circleSweepColor:gi(Z.sweepColor).slice(0,3),u_circleSweepSpeed:Z.sweepSpeed,u_opacity:u,u_baseColor:gi(p),u_brightColor:gi(x),u_windowColor:gi(A),u_time:this.layer.getLayerAnimateTime()||F}}},{key:"calCityGeo",value:function(){var t=(0,Dn.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],l=t[2],p=t[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+o)/2,(p+u)/2]);var v=this.mapService.lngLatToCoord([l,p]),x=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(v[0]-x[0],2)+Math.pow(v[1]-x[1],2))/4}else{var S=l-o,A=p-u;this.cityCenter=[(l+o)/2,(p+u)/2],this.cityMinSize=Math.sqrt(Math.pow(S,2)+Math.pow(A,2))/4}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:F3,fragmentShader:D3,triangulation:w_,depth:{enable:!0},cull:{enable:!0,face:q.BACK}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:hn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?10:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(da);function z3(e){var i=N3();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function N3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z3=function(e){(0,Xr.Z)(r,e);var i=z3(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"type","CityBuildingLayer"),n}return(0,j.Z)(r,[{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new B3(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Fh);function U3(e){var i=V3();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function V3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j3=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_sceneCenterMercator;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,G3=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,H3=function(e){(0,Xr.Z)(r,e);var i=U3(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:j3,fragmentShader:G3,triangulation:E_,primitive:q.TRIANGLES,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:hn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(da);function W3(e){var i=$3();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function $3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y3=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,X3=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,q3=function(e){(0,Xr.Z)(r,e);var i=W3(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:Y3,fragmentShader:X3,triangulation:_0,primitive:q.TRIANGLES,depth:{enable:!0}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:hn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(da);function K3(e,i){for(var r=[],n=[],t=[],o=e+1,u=i+1,l=e/2,p=i/2,v=0;v<u;v++)for(var x=v-p,S=0;S<o;S++){var A=S-l;n.push(A/l,-x/p,0),t.push(S/e),t.push(1-v/i)}for(var I=0;I<i;I++)for(var F=0;F<e;F++){var D=F+o*I,Z=F+o*(I+1),Y=F+1+o*(I+1),ve=F+1+o*I;r.push(D,Z,ve),r.push(Z,Y,ve)}return{vertices:n,indices:r,uvs:t}}var C_,T_;function J3(e){var i=Q3();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function Q3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eA=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,tA=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,rA=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,nA=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,iA=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,aA=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,oA=yi.isEqual,M_=(C_=(0,at.b2)(),C_(T_=function(e){(0,Xr.Z)(r,e);var i=J3(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"render",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.useFramebuffer,v=this.layer.getLayerConfig(),x=v.rampColors;p(this.heatmapFramerBuffer,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),oA(this.preRampColors,x)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode(t):this.draw3DHeatMap(t)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S,A,I,F,D;return Q().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return l=this.rendererService,p=l.createFramebuffer,v=l.getViewportSize,x=l.createTexture2D,S=this.styleAttributeService.getLayerStyleAttribute("shape"),A=(S==null||(u=S.scale)===null||u===void 0?void 0:u.field)||"heatmap",this.shapeType=A,Y.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=Y.sent,this.colorModel=A==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),I=v(),F=I.width,D=I.height,this.heatmapFramerBuffer=p({color:x({width:Math.floor(F/4),height:Math.floor(D/4),wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.LINEAR,mag:q.LINEAR}),depth:!1}),this.updateColorTexture(),Y.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return Y.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:hn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=A_,p.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:aA,fragmentShader:iA,triangulation:A_,depth:{enable:!1},cull:{enable:!0,face:dc(this.mapService.version)}});case 3:return u=p.sent,p.abrupt("return",u);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:nA,fs:rA});var t=this.shaderModuleService.getModule("heatmapColor"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService,v=p.createAttribute,x=p.createElements,S=p.createBuffer,A=p.createModel;return A({vs:o,fs:u,attributes:{a_Position:v({buffer:S({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:q.FLOAT}),size:3}),a_Uv:v({buffer:S({data:[0,1,1,1,0,0,1,0],type:q.FLOAT}),size:2})},uniforms:(0,H.Z)({},l),depth:{enable:!1},elements:x({data:[0,2,1,2,3,1],type:q.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,l=o.intensity,p=l===void 0?10:l,v=o.radius,x=v===void 0?5:v;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_radius:x,u_intensity:p},blend:{enable:!0,func:{srcRGB:q.ONE,srcAlpha:1,dstRGB:q.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(t){var o,u=this.layer.getLayerConfig(),l=u.opacity;(o=this.colorModel)===null||o===void 0||o.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(t)})}},{key:"draw3DHeatMap",value:function(t){var o,u=this.layer.getLayerConfig(),l=u.opacity,p=He();ar(p,this.cameraService.getViewProjectionMatrixUncentered()),(o=this.colorModel)===null||o===void 0||o.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,V.Z)(p)},blend:{enable:!0,func:{srcRGB:q.SRC_ALPHA,srcAlpha:1,dstRGB:q.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}},{key:"build3dHeatMap",value:function(){var t=this.rendererService.getViewportSize,o=t(),u=o.width,l=o.height,p=K3(u/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:tA,fs:eA});var v=this.shaderModuleService.getModule("heatmap3dColor"),x=v.vs,S=v.fs,A=v.uniforms,I=this.rendererService,F=I.createAttribute,D=I.createElements,Z=I.createBuffer,Y=I.createModel;return Y({vs:x,fs:S,attributes:{a_Position:F({buffer:Z({data:p.vertices,type:q.FLOAT}),size:3}),a_Uv:F({buffer:Z({data:p.uvs,type:q.FLOAT}),size:2})},primitive:q.TRIANGLES,uniforms:(0,H.Z)({},A),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:q.SRC_ALPHA,srcAlpha:1,dstRGB:q.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:D({data:p.indices,type:q.UNSIGNED_INT,count:p.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,l=us(u);this.colorTexture=t({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.NEAREST,mag:q.NEAREST,flipY:!1}),this.preRampColors=u}}]),r}(da))||T_);function sA(e){var i=uA();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function uA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,cA=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,fA=function(e){(0,Xr.Z)(r,e);var i=sA(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:cA,fragmentShader:lA,triangulation:E_,depth:{enable:!1},primitive:q.TRIANGLES});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:hn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(da),hA={heatmap:M_,heatmap3d:M_,grid:H3,grid3d:q3,hexagon:fA},pA=hA;function dA(e){var i=vA();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function vA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mA=function(e){(0,Xr.Z)(r,e);var i=dA(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"type","HeatMapLayer"),n}return(0,j.Z)(r,[{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new pA[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var t=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=this.getModelType();return u==="heatmap"?(this.layerModel&&this.layerModel.render(o),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(o)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),l=u.shape3d,p=this.getSource(),v=p.data.type,x=(o==null||(t=o.scale)===null||t===void 0?void 0:t.field)||"heatmap";return x==="heatmap"||x==="heatmap3d"?"heatmap":v==="hexagon"?(l==null?void 0:l.indexOf(x))===-1?"hexagon":"grid3d":v==="grid"?(l==null?void 0:l.indexOf(x))===-1?"grid":"grid3d":"heatmap"}}]),r}(Fh);function gA(e){var i=yA();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function yA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _A=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
  if(gl_FragColor.a < 0.01)
    discard;
}
`,xA=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,bA=function(e){(0,Xr.Z)(r,e);var i=gA(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,this.texture=l({height:0,width:0}),S.next=5,u.data.images;case 5:return p=S.sent,this.texture=l({data:p[0],width:p[0].width,height:p[0].height,mag:q.LINEAR,min:q.LINEAR}),S.next=9,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:xA,fragmentShader:_A,triangulation:fm,primitive:q.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 9:return v=S.sent,S.abrupt("return",[v]);case 11:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(da),SA={image:bA},wA=SA;function EA(e){var i=AA();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function AA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I_=function(e){(0,Xr.Z)(r,e);var i=EA(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"type","ImageLayer"),n}return(0,j.Z)(r,[{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new wA[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={image:{}};return o[t]}},{key:"getModelType",value:function(){return"image"}}]),r}(Fh);function CA(e){var i=TA();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function TA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MA=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_distance_ratio;

uniform float segmentNumber;


#pragma include "picking"

void main() {
  gl_FragColor = v_color;


  float flag = 0.;
  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,IA=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;
varying float v_distance_ratio;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));
 
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,PA=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_color;
  
  gl_FragColor.a *= u_opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,kA=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;
varying vec2 v_distance_ratio;

uniform float u_opacity: 1.0;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

 v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
 v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,LA=`varying vec4 v_color;

#pragma include "picking"

void main() {
// \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}`,RA=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;
varying float v_segmentIndex;

uniform float u_lineDir: 1.0;
uniform float u_opacity: 1.0;

uniform float u_thetaOffset: 0.314;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;




#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  v_color.a *= u_opacity;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,OA={solid:0,dash:1},DA=yi.isNumber,FA=function(e){(0,Xr.Z)(r,e);var i=CA(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,A=S===void 0?"solid":S,I=t.dashArray,F=I===void 0?[10,5]:I,D=t.forward,Z=D===void 0?!0:D,Y=t.lineTexture,ve=Y===void 0?!1:Y,me=t.iconStep,De=me===void 0?100:me,Be=t.segmentNumber,Je=Be===void 0?30:Be,_t=t.thetaOffset,Zt=_t===void 0?.314:_t;F.length===2&&F.push(0,0);var $t=0,dr=[0,0,0,0],lr=[0,0,0,0];return l&&p&&(dr=gi(l),lr=gi(p),$t=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:Zt,u_opacity:DA(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Je,u_line_type:OA[A||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:Z?1:-1,u_texture:this.texture,u_line_texture:ve?1:0,u_icon_step:De,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:$t,u_sourceColor:dr,u_targetColor:lr}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.lineType;return l==="dash"?{frag:MA,vert:IA,type:"Dash"}:o&&u?{frag:LA,vert:RA,type:"Linear"}:{frag:PA,vert:kA,type:""}}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S,A,I;return Q().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,D.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+A,vertexShader:S,fragmentShader:x,triangulation:hm,depth:{enable:!1},segmentNumber:p});case 4:return I=D.sent,D.abrupt("return",[I]);case 6:case"end":return D.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:hn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(da);function BA(e){var i=zA();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function zA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
uniform float u_opacity;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,ZA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,UA=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,VA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;


  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,jA={solid:0,dash:1},GA=function(e){(0,Xr.Z)(r,e);var i=BA(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.textureBlend,p=l===void 0?"normal":l,v=t.lineType,x=v===void 0?"solid":v,S=t.dashArray,A=S===void 0?[10,5]:S,I=t.lineTexture,F=I===void 0?!1:I,D=t.iconStep,Z=D===void 0?100:D,Y=t.segmentNumber,ve=Y===void 0?30:Y,me=t.globalArcHeight,De=me===void 0?10:me;A.length===2&&A.push(0,0);var Be=0,Je=[0,0,0,0],_t=[0,0,0,0];return o&&u&&(Je=gi(o),_t=gi(u),Be=1),this.rendererService.getDirty()&&this.texture.bind(),(0,H.Z)({u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:m0,u_global_height:De,u_textureBlend:p==="normal"?0:1,segmentNumber:ve,u_line_type:jA[x]||0,u_dash_array:A,u_texture:this.texture,u_line_texture:F?1:0,u_icon_step:Z,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Be,u_sourceColor:Je,u_targetColor:_t},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:UA,vert:VA,type:"Linear"}:{frag:NA,vert:ZA,type:""}}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S,A,I;return Q().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,D.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+A,vertexShader:S,fragmentShader:x,inject:this.getInject(),triangulation:hm,segmentNumber:p});case 4:return I=D.sent,D.abrupt("return",[I]);case 6:case"end":return D.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:hn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(da);function HA(e){var i=WA();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function WA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $A=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
uniform float u_opacity;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,YA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,XA=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,qA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;


  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,KA={solid:0,dash:1},JA=function(e){(0,Xr.Z)(r,e);var i=HA(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,A=S===void 0?"solid":S,I=t.dashArray,F=I===void 0?[10,5]:I,D=t.lineTexture,Z=D===void 0?!1:D,Y=t.iconStep,ve=Y===void 0?100:Y,me=t.segmentNumber,De=me===void 0?30:me,Be=t.globalArcHeight,Je=Be===void 0?10:Be;F.length===2&&F.push(0,0);var _t=0,Zt=[0,0,0,0],$t=[0,0,0,0];return l&&p&&(Zt=gi(l),$t=gi(p),_t=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:m0,u_global_height:Je,u_opacity:u,u_textureBlend:x==="normal"?0:1,segmentNumber:De,u_line_type:KA[A]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Z?1:0,u_icon_step:ve,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_t,u_sourceColor:Zt,u_targetColor:$t}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:XA,vert:qA,type:"Linear"}:{frag:$A,vert:YA,type:""}}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S,A,I;return Q().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,D.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+A,vertexShader:S,fragmentShader:x,triangulation:hm,depth:{enable:!0},segmentNumber:p});case 4:return I=D.sent,D.abrupt("return",[I]);case 6:case"end":return D.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:hn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(da);function QA(e){var i=eC();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function eC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tC=`#extension GL_OES_standard_derivatives : enable

varying vec4 v_color;


// line texture

#pragma include "picking"

void main() {
gl_FragColor = v_color;
gl_FragColor = filterColor(gl_FragColor);
}
`,rC=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec4 a_Instance;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"
varying vec4 v_color;
uniform float u_gap_width: 1.0;
uniform float u_stroke_width: 1.0;
uniform float u_stroke_opacity: 1.0;


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = normalize(target - source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);


  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel(a_Position.yz);
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.8), project_pixel(lengthCommon*.8)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel(a_Normal.xy);

  float gapCommon =  project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );


  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offsetCommon.xy, 0., 1.0);
  } else {
     gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));
  }



  setPickingColor(a_PickingColor);
}
`,nC=function(e){(0,Xr.Z)(r,e);var i=QA(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.gapWidth,u=o===void 0?2:o,l=t.strokeWidth,p=l===void 0?1:l,v=t.stroke,x=v===void 0?"#000":v,S=t.strokeOpacity,A=S===void 0?1:S;return(0,H.Z)({u_gap_width:u,u_stroke_width:p,u_stroke:gi(x),u_stroke_opacity:A},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:rC,fragmentShader:tC,inject:this.getInject(),triangulation:E3,primitive:q.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:hn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(o,u,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}})}}]),r}(da);function iC(e){var i=aC();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function aC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying vec4 v_line_data;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,sC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,uC={solid:0,dash:1},lC=function(e){(0,Xr.Z)(r,e);var i=iC(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,A=S===void 0?"solid":S,I=t.dashArray,F=I===void 0?[10,5]:I,D=t.lineTexture,Z=D===void 0?!1:D,Y=t.iconStep,ve=Y===void 0?100:Y,me=t.segmentNumber,De=me===void 0?30:me;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Be=0,Je=[0,0,0,0],_t=[0,0,0,0];return l&&p&&(Je=gi(l),_t=gi(p),Be=1),{u_opacity:u,u_textureBlend:x==="normal"?0:1,segmentNumber:De,u_line_type:uC[A]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Z?1:0,u_icon_step:ve,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Be,u_sourceColor:Je,u_targetColor:_t}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:sC,fragmentShader:oC,triangulation:hm,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:hn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(da),LR=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),dm=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),cC=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),S0=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),RR=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function fC(e){var i=hC();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function hC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pC=`#define LineTypeSolid 0.0
varying vec4 v_color;

// dash
varying vec4 v_dash_array;
varying float v_d_distance_ratio;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

// [animate, duration, interval, trailLength],
void main() {

  gl_FragColor = v_color;

 
  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,dC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying float v_d_distance_ratio;


void main() {

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;


  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,vC=`#extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying vec2 v_iconMapUV;
varying vec4 v_texture_data;


#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth / 2.0;


    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,P_=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

varying vec4 v_texture_data;

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,mC=`varying vec4 v_color;
varying vec4 v_texture_data;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity: 1.0;

#pragma include "picking"


void main() {
  float linearRadio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = v_texture_data.a;
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
    gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,gC={solid:0,dash:1},k_=function(e){(0,Xr.Z)(r,e);var i=fC(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"textureEventFlag",!1),(0,P.Z)((0,k.Z)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,P.Z)((0,k.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.textureBlend,p=l===void 0?"normal":l,v=t.lineType,x=v===void 0?"solid":v,S=t.dashArray,A=S===void 0?[10,5,0,0]:S,I=t.lineTexture,F=I===void 0?!1:I,D=t.iconStep,Z=D===void 0?100:D,Y=t.vertexHeightScale,ve=Y===void 0?20:Y,me=t.borderWidth,De=me===void 0?0:me,Be=t.borderColor,Je=Be===void 0?"#ccc":Be,_t=t.raisingHeight,Zt=_t===void 0?0:_t,$t=t.heightfixed,dr=$t===void 0?!1:$t,lr=t.linearDir,Yr=lr===void 0?dm.VERTICAL:lr,un=t.blur,In=un===void 0?[1,1,1]:un,Gi=t.arrow,Ra=Gi===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Gi;A.length===2&&A.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var Va=0,ao=[0,0,0,0],Ko=[0,0,0,0];return o&&u&&(ao=gi(o),Ko=gi(u),Va=1),(0,H.Z)({u_textureBlend:p===cC.NORMAL?0:1,u_line_type:gC[x],u_dash_array:A,u_blur:In,u_texture:this.texture,u_line_texture:F?1:0,u_icon_step:Z,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:De,u_borderColor:gi(Je),u_linearDir:Yr===dm.VERTICAL?1:0,u_linearColor:Va,u_sourceColor:ao,u_targetColor:Ko,u_heightfixed:Number(dr),u_vertexScale:ve,u_raisingHeight:Number(Zt),u_arrow:Number(Ra.enable),u_arrowHeight:Ra.arrowHeight||3,u_arrowWidth:Ra.arrowWidth||2,u_tailWidth:Ra.tailWidth===void 0?1:Ra.tailWidth},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S,A,I;return Q().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!1:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,this.layer.triangulation=ic,D.next=5,this.layer.buildLayerModel({moduleName:"line"+A,vertexShader:S,fragmentShader:x,triangulation:ic,inject:this.getInject(),depth:{enable:p}});case 5:return I=D.sent,D.abrupt("return",[I]);case 7:case"end":return D.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.lineType;return l==="dash"?{frag:pC,vert:dC,type:"Dash"}:o&&u?{frag:mC,vert:P_,type:"Linear"}:{frag:vC,vert:P_,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:hn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,l,p,v,x,S){return S===void 0?[p[3],10]:[p[3],S]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:hn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:hn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(da);function yC(e){var i=_C();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function _C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xC=`
varying vec4 v_Color;
#pragma include "picking"
void main() {

  gl_FragColor = v_Color; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,bC=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;
uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"


void main() {


  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  float linearRadio =currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = texV;
  }

  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));

  v_Color.a *= u_opacity; // \u5168\u5C40\u900F\u660E\u5EA6



  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,SC=yi.isNumber,wC=function(e){(0,Xr.Z)(r,e);var i=yC(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var p=n.layer.getLayerConfig(),v=p.rampColors,x=us(v);n.colorTexture=l({data:new Uint8Array(x.data),width:x.width,height:x.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.NEAREST,mag:q.NEAREST,flipY:!1})}),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.vertexHeightScale,p=l===void 0?20:l,v=t.raisingHeight,x=v===void 0?0:v,S=t.heightfixed,A=S===void 0?!1:S,I=t.linearDir,F=I===void 0?dm.VERTICAL:I;return this.rendererService.getDirty()&&this.colorTexture.bind(),{u_linearDir:F===dm.VERTICAL?1:0,u_opacity:SC(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(A),u_vertexScale:p,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!1:l,this.layer.triangulation=x0,S.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:bC,fragmentShader:xC,triangulation:x0,depth:{enable:p}});case 4:return v=S.sent,S.abrupt("return",[v]);case 6:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:hn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l,p,v,x){return x===void 0?[l[3],10]:[l[3],x]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:hn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:hn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[4]]}}})}}]),r}(da);function EC(e){var i=AC();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function AC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CC=`
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;

}
`,TC=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float opacity;
void main() {
  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,L_=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;



#pragma include "projection"

varying vec4 v_color;
varying float v_distanceScale;

void main() {

  v_color = a_Color; 
  v_distanceScale = a_Distance / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity); 
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,MC=yi.isNumber,IC=function(e){(0,Xr.Z)(r,e);var i=EC(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.vertexHeightScale,x=v===void 0?20:v,S=0,A=[0,0,0,0],I=[0,0,0,0];return l&&p&&(A=gi(l),I=gi(p),S=1),{u_opacity:MC(u)?u:1,u_linearColor:S,u_sourceColor:A,u_targetColor:I,u_vertexScale:x}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:TC,vert:L_,type:"lineSimpleLinear"}:{frag:CC,vert:L_,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x;return Q().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return u=this.getShaders(),l=u.frag,p=u.vert,v=u.type,A.next=3,this.layer.buildLayerModel({moduleName:v,vertexShader:p,fragmentShader:l,triangulation:A3,primitive:q.LINES,depth:{enable:!1},pick:!1});case 3:return x=A.sent,A.abrupt("return",[x]);case 5:case"end":return A.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:hn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:hn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}})}}]),r}(da);function PC(e){var i=kC();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LC=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,RC=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,OC=yi.isNumber,DC=function(e){(0,Xr.Z)(r,e);var i=PC(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.heightfixed,A=S===void 0?!1:S,I=t.lineTexture,F=I===void 0?!1:I,D=t.iconStep,Z=D===void 0?100:D,Y=t.iconStepCount,ve=Y===void 0?1:Y;this.rendererService.getDirty()&&this.texture.bind();var me=0,De=[0,0,0,0],Be=[0,0,0,0];return l&&p&&(De=gi(l),Be=gi(p),me=1),{u_heightfixed:Number(A),u_opacity:OC(u)?u:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:F?1:0,u_iconStepCount:ve,u_icon_step:Z,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:me,u_sourceColor:De,u_targetColor:Be}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:RC,fragmentShader:LC,triangulation:x0,depth:{enable:!1},blend:this.getBlend()});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:hn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:hn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:hn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(da),FC={arc:FA,arc3d:GA,greatcircle:lC,wall:DC,line:k_,simple:IC,linearline:wC,earthArc3d:JA,flowline:nC},BC=FC;function zC(e){var i=NC();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function NC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w0=function(e){(0,Xr.Z)(r,e);var i=zC(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"type","LineLayer"),(0,P.Z)((0,k.Z)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke"]),(0,P.Z)((0,k.Z)(n),"arrowInsertCount",0),(0,P.Z)((0,k.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,j.Z)(r,[{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new BC[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{}};return o[t]}},{key:"getModelType",value:function(){var t;if(this.layerType)return this.layerType;var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u||"line"}},{key:"processData",value:function(t){if(this.getModelType()!=="simple")return t;var o=[];return t.map(function(u){if(Array.isArray(u.coordinates)&&Array.isArray(u.coordinates[0])&&Array.isArray(u.coordinates[0][0])){var l=(0,H.Z)({},u);u.coordinates.map(function(p){o.push((0,H.Z)((0,H.Z)({},l),{},{coordinates:p}))})}else o.push(u)}),o}}]),r}(Fh);function ZC(e){var i=UC();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function UC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VC=`
uniform float u_additive;
uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,jC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying float v_blur;
varying float v_innerRadius;



#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function R_(e){var i=e.coordinates;return{vertices:(0,V.Z)(i),indices:[0],size:i.length}}var GC=function(e){(0,Xr.Z)(r,e);var i=ZC(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.blend,x=t.strokeOpacity,S=x===void 0?1:x,A=t.strokeWidth,I=A===void 0?0:A,F=t.stroke,D=F===void 0?"#fff":F;return{u_additive:v==="additive"?1:0,u_opacity:u,u_offsets:p,u_stroke_opacity:S,u_stroke_width:I,u_stroke_color:gi(D)}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=R_,p.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:jC,fragmentShader:VC,triangulation:R_,depth:{enable:!1},primitive:q.POINTS});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(da);function HC(e){var i=WC();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function WC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $C=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;
varying float v_lightWeight;
varying float v_barLinearZ;
void main() {

   gl_FragColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,YC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
varying float v_lightWeight;
varying float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,XC=yi.isNumber,qC=function(e){(0,Xr.Z)(r,e);var i=HC(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"raiseCount",0),(0,P.Z)((0,k.Z)(n),"raiseRepeat",0),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=t.opacity,p=l===void 0?1:l,v=t.sourceColor,x=t.targetColor,S=t.pickLight,A=S===void 0?!1:S,I=t.heightfixed,F=I===void 0?!1:I,D=t.opacityLinear,Z=D===void 0?{enable:!1,dir:"up"}:D,Y=t.lightEnable,ve=Y===void 0?!0:Y,me=0,De=[0,0,0,0],Be=[0,0,0,0];if(v&&x&&(De=gi(v),Be=gi(x),me=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var Je=u.speed,_t=Je===void 0?.01:Je;this.raiseCount+=_t,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(F),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:XC(p)?p:1,u_linearColor:me,u_sourceColor:De,u_targetColor:Be,u_opacitylinear:Number(Z.enable),u_opacitylinear_dir:Z.dir==="up"?1:0,u_lightEnable:Number(ve)}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getLayerConfig(),l=u.animateOption.repeat,p=l===void 0?1:l,this.raiseRepeat=p,S.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:YC,fragmentShader:$C,triangulation:_0,depth:{enable:!0},cull:{enable:!0,face:dc(this.mapService.version)},blend:this.getBlend()});case 4:return v=S.sent,S.abrupt("return",[v]);case 6:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:hn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=ra(o.coordinates);return d_([u[0],u[1]])}}})}}]),r}(da);function KC(e){var i=JC();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function JC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QC=`uniform float u_additive;
uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,eT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);

  setPickingColor(a_PickingColor);
}
`,tT=function(e){(0,Xr.Z)(r,e);var i=KC(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.strokeOpacity,p=l===void 0?1:l,v=t.strokeWidth,x=v===void 0?0:v,S=t.stroke,A=S===void 0?"rgba(0,0,0,0)":S,I=t.blend,F=t.blur,D=F===void 0?0:F;return{u_blur:D,u_additive:I==="additive"?1:0,u_opacity:u,u_stroke_opacity:p,u_stroke_width:x,u_stroke_color:gi(A)}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=b_,p.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:eT,fragmentShader:QC,triangulation:b_,depth:{enable:!0},blend:this.getBlend()});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:hn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v){var x=(0,Dn.Z)(p,3),S=x[0],A=x[1],I=x[2],F=va.fromValues(0,0,1),D=va.fromValues(S,0,I),Z=S>=0?va.angle(F,D):Math.PI*2-va.angle(F,D),Y=Math.PI*2-Math.asin(A/100),ve=He();ti(ve,ve,Z),zn(ve,ve,Y);var me=va.fromValues(1,1,0);va.transformMat4(me,me,ve),va.normalize(me,me);var De=va.fromValues(-1,1,0);va.transformMat4(De,De,ve),va.normalize(De,De);var Be=va.fromValues(-1,-1,0);va.transformMat4(Be,Be,ve),va.normalize(Be,Be);var Je=va.fromValues(1,-1,0);va.transformMat4(Je,Je,ve),va.normalize(Je,Je);var _t=[].concat((0,V.Z)(me),(0,V.Z)(De),(0,V.Z)(Be),(0,V.Z)(Je)),Zt=v%4*3;return[_t[Zt],_t[Zt+1],_t[Zt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:hn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.layer.getLayerConfig().shape2d,x=v.indexOf(p);return[x]}}})}}]),r}(da);function rT(e){var i=nT();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function nT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iT=`varying vec4 v_color;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"


void main() {

  gl_FragColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,aT=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;
varying float v_lightWeight;
varying float v_barLinearZ;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
uniform float u_opacitylinear: 0.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacitylinear_dir: 1.0;
uniform float  u_linearColor: 0.0;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * u_opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,O_=function(e){(0,Xr.Z)(r,e);var i=rT(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"raiseCount",0),(0,P.Z)((0,k.Z)(n),"raiseRepeat",0),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=t.opacity,p=l===void 0?1:l,v=t.sourceColor,x=t.targetColor,S=t.pickLight,A=S===void 0?!1:S,I=t.heightfixed,F=I===void 0?!1:I,D=t.opacityLinear,Z=D===void 0?{enable:!1,dir:"up"}:D,Y=t.lightEnable,ve=Y===void 0?!0:Y,me=0,De=[0,0,0,0],Be=[0,0,0,0];if(v&&x&&(De=gi(v),Be=gi(x),me=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var Je=u.speed,_t=Je===void 0?.01:Je;this.raiseCount+=_t,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(F),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:p,u_linearColor:me,u_sourceColor:De,u_targetColor:Be,u_opacitylinear:Number(Z.enable),u_opacitylinear_dir:Z.dir==="up"?1:0,u_lightEnable:Number(ve)}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S;return Q().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!0:l,v=u.animateOption.repeat,x=v===void 0?1:v,this.raiseRepeat=x,I.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:aT,fragmentShader:iT,triangulation:_0,cull:{enable:!0,face:dc(this.mapService.version)},depth:{enable:p}});case 4:return S=I.sent,I.abrupt("return",[S]);case 6:case"end":return I.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:hn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=ra(o.coordinates);return[u[0],u[1],0]}}})}}]),r}(da);function oT(e){var i=sT();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function sT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D_=`
uniform float u_additive;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = v_color;

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,uT=`uniform float u_additive;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec4 v_stroke;


#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    gl_FragColor = v_color;
  } else {
    gl_FragColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(gl_FragColor.a < 0.01) {
    discard;
  } 
}
`,E0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec4 v_stroke;
uniform float u_stroke_width: 2;
uniform vec3 u_blur_height_fixed: [0, 0, 0];


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"


void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position =  u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,F_=function(e){(0,Xr.Z)(r,e);var i=oT(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.strokeOpacity,u=o===void 0?1:o,l=t.strokeWidth,p=l===void 0?0:l,v=t.blend,x=t.blur,S=x===void 0?0:x,A=t.raisingHeight,I=A===void 0?0:A,F=t.heightfixed,D=F===void 0?!1:F,Z=t.unit,Y=Z===void 0?"pixel":Z;return(0,H.Z)({u_blur_height_fixed:[S,Number(I),Number(D)],u_additive:v==="additive"?1:0,u_stroke_opacity:u,u_stroke_width:p,u_size_unit:S0[Y]},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),qs)}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S,A,I;return Q().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return u=this.layer.getLayerConfig(),l=u.animateOption,p=l===void 0?{enable:!1}:l,v=this.getShaders(p),x=v.frag,S=v.vert,A=v.type,this.layer.triangulation=qs,D.next=5,this.layer.buildLayerModel({moduleName:A,vertexShader:S,fragmentShader:x,inject:this.getInject(),triangulation:qs,depth:{enable:!1}});case 5:return I=D.sent,D.abrupt("return",[I]);case 7:case"end":return D.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(t){if(t.enable)switch(t.type){case"wave":return{frag:D_,vert:E0,type:"pointWave"};default:return{frag:D_,vert:E0,type:"pointWave"}}else return{frag:uT,vert:E0,type:"pointFill"}}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:hn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],S=v%4*3;return[x[S],x[S+1],x[S+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:hn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.indexOf(p);return[v]}}})}}]),r}(da);function lT(e){var i=cT();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function cT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fT=`uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;
varying float v_opacity;

void main() {

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= v_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,hT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform int u_size_unit;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
varying float v_opacity;
// uniform vec2 u_offsets; // shader \u6CE8\u5165


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp *vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,pT=function(e){(0,Xr.Z)(r,e);var i=lT(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"meter2coord",1),(0,P.Z)((0,k.Z)(n),"isMeter",!1),(0,P.Z)((0,k.Z)(n),"radian",0),(0,P.Z)((0,k.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.LINEAR,min:q.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,l=t.heightfixed,p=l===void 0?!1:l,v=t.unit,x=v===void 0?"pixel":v;return this.rendererService.getDirty()&&this.texture.bind(),(0,H.Z)({u_raisingHeight:Number(u),u_heightfixed:Number(p),u_size_unit:S0[x],u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),cm)}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:hT,fragmentShader:fT,triangulation:cm,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:dc(this.mapService.version)}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.shape,v=l[p]||{x:-64,y:-64},x=v.x,S=v.y;return[x,S]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:hn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],S=v%4*3;return[x[S],x[S+1],x[S+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}})}}]),r}(da);function dT(e){var i=vT();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function vT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mT=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform vec2 u_textSize;

#pragma include "picking"

void main(){
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a *= v_opacity;
      if (gl_FragColor.a < 0.01) {
         discard;
      }
      gl_FragColor = filterColor(gl_FragColor);
}
`,gT=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,B_=function(e){(0,Xr.Z)(r,e);var i=dT(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:q.LINEAR,min:q.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.raisingHeight,x=v===void 0?0:v,S=t.heightfixed,A=S===void 0?!1:S;return this.rendererService.getDirty()&&this.texture.bind(),(0,H.Z)({u_raisingHeight:Number(x),u_heightfixed:Number(A),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:gT,fragmentShader:mT,triangulation:w3,inject:this.getInject(),depth:{enable:!1},primitive:q.POINTS});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.shape,v=l[p]||{x:-64,y:-64},x=v.x,S=v.y;return[x,S]}}})}}]),r}(da);function yT(e){var i=_T();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function _T(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xT=`varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
}
`,bT=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`,OR=yi.isNumber;function z_(e){var i=e.coordinates;return{vertices:(0,V.Z)(i),indices:[0],size:i.length}}var N_=function(e){(0,Xr.Z)(r,e);var i=yT(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o;return(0,H.Z)({},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=z_,p.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:bT,fragmentShader:xT,triangulation:z_,inject:this.getInject(),depth:{enable:!1},primitive:q.POINTS,pick:!1});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(da);function ST(e){var i=wT();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function wT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ET=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,AT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;



  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp *vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,CT=function(e){(0,Xr.Z)(r,e);var i=ST(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.blend,p=t.speed,v=p===void 0?1:p,x=t.unit,S=x===void 0?"pixel":x;return{u_size_unit:S0[S],u_speed:v,u_additive:l==="additive"?1:0,u_opacity:u}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),cm)}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:AT,fragmentShader:ET,triangulation:cm,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:hn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p){var v=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=p%4*3;return[v[x],v[x+1],v[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?5:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(da);function TT(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=MT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function MT(e,i){if(!!e){if(typeof e=="string")return Z_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Z_(e,i)}}function Z_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var IT=function(){function e(i,r,n){(0,Mt.Z)(this,e),(0,P.Z)(this,"boxCells",[]);var t=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)t.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,j.Z)(e,[{key:"insert",value:function(r,n,t,o,u){this.forEachCell(n,t,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!1,u)}},{key:"hitTest",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!0,u)}},{key:"insertBoxCell",value:function(r,n,t,o,u,l){this.boxCells[u].push(l)}},{key:"queryHitTest",value:function(r,n,t,o,u,l){if(t<0||r>this.width||o<0||n>this.height)return u?!1:[];var p=[];if(r<=0&&n<=0&&this.width<=t&&this.height<=o){if(u)return!0;for(var v=0;v<this.boxKeys.length;v++)p.push({key:this.boxKeys[v],x1:this.bboxes[v*4],y1:this.bboxes[v*4+1],x2:this.bboxes[v*4+2],y2:this.bboxes[v*4+3]});return l?p.filter(l):p}var x={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,t,o,this.queryCell,p,x,l),u?p.length>0:p}},{key:"queryCell",value:function(r,n,t,o,u,l,p,v){var x=p.seenUids,S=this.boxCells[u];if(S!==null){var A=this.bboxes,I=TT(S),F;try{for(I.s();!(F=I.n()).done;){var D=F.value;if(!x.box[D]){x.box[D]=!0;var Z=D*4;if(r<=A[Z+2]&&n<=A[Z+3]&&t>=A[Z+0]&&o>=A[Z+1]&&(!v||v(this.boxKeys[D]))){if(p.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[D],x1:A[Z],y1:A[Z+1],x2:A[Z+2],y2:A[Z+3]})}}}}catch(Y){I.e(Y)}finally{I.f()}}return!1}},{key:"forEachCell",value:function(r,n,t,o,u,l,p,v){for(var x=this.convertToXCellCoord(r),S=this.convertToYCellCoord(n),A=this.convertToXCellCoord(t),I=this.convertToYCellCoord(o),F=x;F<=A;F++)for(var D=S;D<=I;D++){var Z=this.xCellCount*D+F;if(u.call(this,r,n,t,o,Z,l,p,v))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),PT=IT,kT=function(){function e(i,r){(0,Mt.Z)(this,e),(0,P.Z)(this,"viewportPadding",100),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new PT(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,j.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,t=r.y1+r.anchorPointY+this.viewportPadding,o=r.x2+r.anchorPointX+this.viewportPadding,u=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,t,o,u)||this.grid.hitTest(n,t,o,u)?{box:[]}:{box:[n,t,o,u]}}},{key:"insertCollisionBox",value:function(r,n){var t={featureIndex:n};this.grid.insert(t,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,t){var o=wn(n,t,0,1),u=di(),l=Ge.apply(ye,(0,V.Z)(r));return Xa(u,o,l),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,t,o){return t>=0&&r<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function U_(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=LT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function LT(e,i){if(!!e){if(typeof e=="string")return V_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return V_(e,i)}}function V_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function j_(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function G_(e,i,r,n,t){if(!!t){var o=e[n],u=o.glyph;if(u)for(var l=i[u].advance*o.scale,p=(e[n].x+l)*t,v=r;v<=n;v++)e[v].x-=p}}function H_(e,i,r,n,t,o,u){var l=(i-r)*t,p=(-n*u+.5)*o,v=U_(e),x;try{for(v.s();!(x=v.n()).done;){var S=x.value;S.x+=l,S.y+=p}}catch(A){v.e(A)}finally{v.f()}}function RT(e,i,r,n,t,o,u){var l=-8,p=0,v=l,x=0,S=e.positionedGlyphs,A=o==="right"?1:o==="left"?0:.5,I=S.length;r.forEach(function(ve){if(ve.split("").forEach(function(De){var Be=i[De],Je=0;Be&&(S.push({glyph:De,x:p,y:v+Je,vertical:!1,scale:1,metrics:Be}),p+=Be.advance+u)}),S.length!==I){var me=p-u;x=Math.max(me,x),G_(S,i,I,S.length-1,A)}p=0,v-=n+5});var F=j_(t),D=F.horizontalAlign,Z=F.verticalAlign;H_(S,A,D,Z,x,n,r.length);var Y=v-l;e.top+=-Z*Y,e.bottom=e.top-Y,e.left+=-D*x,e.right=e.left+x}function OT(e,i,r,n,t,o,u){var l=-8,p=0,v=l,x=0,S=e.positionedGlyphs,A=o==="right"?1:o==="left"?0:.5,I=S.length;r.forEach(function(ve){var me=i[ve],De=0;if(me&&(S.push({glyph:ve,x:me.advance/2,y:v+De,vertical:!1,scale:1,metrics:me}),p+=me.advance+u),S.length!==I){var Be=p-u;x=Math.max(Be,x),G_(S,i,I,S.length-1,A)}p=0,v-=n+5});var F=j_(t),D=F.horizontalAlign,Z=F.verticalAlign;H_(S,A,D,Z,x,n,r.length);var Y=v-l;e.top+=-Z*Y,e.bottom=e.top-Y,e.left+=-D*x,e.right=e.left+x}function DT(e,i,r,n,t,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,p=e.split(`
`),v=[],x={positionedGlyphs:v,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:p.length,text:e};return l?OT(x,i,p,r,n,t,o):RT(x,i,p,r,n,t,o),v.length?x:!1}function FT(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,t=n===void 0?[]:n,o=[],u=U_(t),l;try{for(u.s();!(l=u.n()).done;){var p=l.value,v=p.metrics,x=4,S=v.advance*p.scale/2,A=r?[p.x+S,p.y]:[0,0],I=r?[0,0]:[p.x+S+i[0],p.y+i[1]],F=(0-x)*p.scale-S+I[0],D=(0-x)*p.scale+I[1],Z=F+v.width*p.scale,Y=D+v.height*p.scale,ve={x:F,y:D},me={x:Z,y:D},De={x:F,y:Y},Be={x:Z,y:Y};o.push({tl:ve,tr:me,bl:De,br:Be,tex:v,glyphOffset:A})}}catch(Je){u.e(Je)}finally{u.f()}return o}function BT(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=zT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function zT(e,i){if(!!e){if(typeof e=="string")return W_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W_(e,i)}}function W_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function NT(e){var i=ZT();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function ZT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec4 v_stroke_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;


#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  gl_FragColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (gl_FragColor.a < 0.01) {
    discard;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,Y_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying vec4 v_stroke_color;
varying float v_fontScale;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];



#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp *(vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,iv=yi.isEqual;function X_(e){var i=this,r=e.id,n=[],t=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[r].glyphQuads.forEach(function(l,p){n.push.apply(n,(0,V.Z)(u).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,V.Z)(u),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,V.Z)(u),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,V.Z)(u),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),t.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:t,size:7}}var q_=function(e){(0,Xr.Z)(r,e);var i=NT(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"glyphInfoMap",{}),(0,P.Z)((0,k.Z)(n),"currentZoom",-1),(0,P.Z)((0,k.Z)(n),"textureHeight",0),(0,P.Z)((0,k.Z)(n),"textCount",0),(0,P.Z)((0,k.Z)(n),"preTextStyle",{}),(0,P.Z)((0,k.Z)(n),"mapping",(0,je.Z)(Q().mark(function l(){return Q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n.initGlyph(),n.updateTexture(),v.next=4,n.reBuildModel();case 4:case"end":return v.stop()}},l)}))),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.stroke,u=o===void 0?"#fff":o,l=t.strokeWidth,p=l===void 0?0:l,v=t.halo,x=v===void 0?.5:v,S=t.gamma,A=S===void 0?2:S,I=t.raisingHeight,F=I===void 0?0:I,D=this.getFontServiceMapping(),Z=this.getFontServiceCanvas();return D&&Object.keys(D).length!==this.textCount&&Z&&(this.updateTexture(),this.textCount=Object.keys(D).length),this.preTextStyle=this.getTextStyle(),(0,H.Z)({u_raisingHeight:Number(F),u_stroke_width:p,u_stroke_color:gi(u),u_sdf_map:this.texture,u_halo_blur:x,u_gamma_scale:A,u_sdf_map_size:[(Z==null?void 0:Z.width)||1,(Z==null?void 0:Z.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),l.abrupt("return",this.buildModels());case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getLayerConfig(),l=u.textAllowOverlap,p=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),p||this.filterGlyphs(),S.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Y_,fragmentShader:$_,inject:this.getInject(),triangulation:X_.bind(this),depth:{enable:!1}});case 6:return v=S.sent,S.abrupt("return",[v]);case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"needUpdate",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S,A,I,F,D,Z,Y;return Q().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(u=this.getTextStyle(),l=u.textAllowOverlap,p=l===void 0?!1:l,v=u.textAnchor,x=v===void 0?"center":v,S=u.textOffset,A=u.padding,I=u.fontFamily,F=u.fontWeight,!(!iv(A,this.preTextStyle.padding)||!iv(S,this.preTextStyle.textOffset)||!iv(x,this.preTextStyle.textAnchor)||!iv(I,this.preTextStyle.fontFamily)||!iv(F,this.preTextStyle.fontWeight))){me.next=5;break}return me.next=4,this.mapping();case 4:return me.abrupt("return",!0);case 5:if(!p){me.next=7;break}return me.abrupt("return",!1);case 7:if(D=this.mapService.getZoom(),Z=this.mapService.getBounds(),Y=dn(this.extent,Z),!(Math.abs(this.currentZoom-D)>.5||!Y||p!==this.preTextStyle.textAllowOverlap)){me.next=14;break}return me.next=13,this.reBuildModel();case 13:return me.abrupt("return",!0);case 14:return me.abrupt("return",!1);case 15:case"end":return me.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:hn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?12:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:hn.Attribute,descriptor:{name:"a_tex",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return An(t,.5)}},{key:"initTextFont",value:function(){var t=this.getTextStyle(),o=t.fontWeight,u=t.fontFamily,l=this.rawEncodeData,p=[];l.forEach(function(v){var x=v.shape,S=x===void 0?"":x;S=S.toString();var A=BT(S),I;try{for(A.s();!(I=A.n()).done;){var F=I.value;p.indexOf(F)===-1&&p.push(F)}}catch(D){A.e(D)}finally{A.f()}}),this.fontService.setFontOptions({characterSet:p,fontWeight:o,fontFamily:u,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.getTextStyle(),o=t.fontWeight,u=t.fontFamily,l=this.rawEncodeData,p=[];l.forEach(function(v){var x=v.shape,S=x===void 0?"":x;S="".concat(S),p.indexOf(S)===-1&&p.push(S)}),this.fontService.setFontOptions({characterSet:p,fontWeight:o,fontFamily:u,iconfont:!0})}},{key:"getTextStyle",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l,v=t.textAllowOverlap,x=v===void 0?!1:v,S=t.padding,A=S===void 0?[0,0]:S,I=t.textAnchor,F=I===void 0?"center":I,D=t.textOffset,Z=D===void 0?[0,0]:D,Y=t.opacity,ve=Y===void 0?1:Y,me=t.strokeOpacity,De=me===void 0?1:me,Be=t.strokeWidth,Je=Be===void 0?0:Be,_t=t.stroke,Zt=_t===void 0?"#000":_t;return{fontWeight:u,fontFamily:p,textAllowOverlap:x,padding:A,textAnchor:F,textOffset:Z,opacity:ve,strokeOpacity:De,strokeWidth:Je,stroke:Zt}}},{key:"generateGlyphLayout",value:function(t){var o=this,u=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),p=l.spacing,v=p===void 0?2:p,x=l.textAnchor,S=x===void 0?"center":x,A=l.textOffset,I=this.rawEncodeData;this.glyphInfo=I.map(function(F){var D=F.shape,Z=D===void 0?"":D,Y=F.id,ve=F.size,me=ve===void 0?1:ve,De=F.textOffset?F.textOffset:A||[0,0],Be=F.textAnchor?F.textAnchor:S||"center",Je=DT(Z.toString(),u,me,Be,"left",v,De,t),_t=FT(Je,De,!1);return F.shaping=Je,F.glyphQuads=_t,F.centroid=ra(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?ra(F.originCoordinates):F.originCentroid=F.centroid,o.glyphInfoMap[Y]={shaping:Je,glyphQuads:_t,centroid:ra(F.coordinates)},F})}},{key:"getFontServiceMapping",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(p,"_").concat(u))}},{key:"getFontServiceCanvas",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(p,"_").concat(u))}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,l=u===void 0?[0,0]:u,p=o.textAllowOverlap,v=p===void 0?!1:p;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var x=this.rendererService.getViewportSize(),S=x.width,A=x.height,I=new kT(S,A),F=this.glyphInfo.filter(function(D){var Z=D.shaping,Y=D.id,ve=Y===void 0?0:Y,me=D.version==="GAODE2.x"?D.originCentroid:D.centroid,De=D.size,Be=De/16,Je=t.mapService.lngLatToContainer(me),_t=I.placeCollisionBox({x1:Z.left*Be-l[0],x2:Z.right*Be+l[0],y1:Z.top*Be-l[1],y2:Z.bottom*Be+l[1],anchorPointX:Je.x,anchorPointY:Je.y}),Zt=_t.box;return Zt&&Zt.length?(I.insertCollisionBox(Zt,ve),!0):!1});F.forEach(function(D){t.glyphInfoMap[D.id]=D})}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig(),o=t.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.getFontServiceCanvas();this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:q.LINEAR,min:q.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.filterGlyphs(),p.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Y_,fragmentShader:$_,triangulation:X_.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:u=p.sent,this.layer.models=[u];case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(da),UT={fillImage:pT,fill:F_,radar:CT,image:B_,normal:N_,simplePoint:GC,extrude:O_,text:q_,earthFill:tT,earthExtrude:qC},VT=UT;function jT(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=GT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function GT(e,i){if(!!e){if(typeof e=="string")return K_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return K_(e,i)}}function K_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function HT(e){var i=WT();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function WT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vm=function(e){(0,Xr.Z)(r,e);var i=HT(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"type","PointLayer"),(0,P.Z)((0,k.Z)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke","rotation"]),(0,P.Z)((0,k.Z)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,P.Z)((0,k.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,j.Z)(r,[{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new VT[u](this),p.next=5,this.initLayerModels();case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,o=t.field,u=t.values,l=this.getLayerConfig(),p=l.shape2d,v=this.iconService.getIconMap();if(o&&(p==null?void 0:p.indexOf(o))!==-1)return"fill";if(u==="text")return"text";if(u&&u instanceof Array){var x=jT(u),S;try{for(x.s();!(S=x.n()).done;){var A=S.value;if(typeof A=="string"&&v.hasOwnProperty(A))return"image"}}catch(I){x.e(I)}finally{x.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=o.billboard,v=p===void 0?!0:p,x=this.iconService.getIconMap(),S=t.find(function(I){return I.hasOwnProperty("shape")});if(S){var A=S.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"||v===!1?"fillImage":(u==null?void 0:u.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":x.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Fh);function $T(e){var i=YT();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function YT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XT=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;

#pragma include "picking"

void main() {


     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,qT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }



  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,KT=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
    // gl_FragColor = vec4(1.0, 0., 0., 1.0);
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,JT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform sampler2D u_texture;


uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;
varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_linearColor: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }




  setPickingColor(a_PickingColor);
}
`,QT=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,eM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,tM=function(e){(0,Xr.Z)(r,e);var i=$T(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.heightfixed,u=o===void 0?!1:o,l=t.raisingHeight,p=l===void 0?0:l,v=t.topsurface,x=v===void 0?!0:v,S=t.sidesurface,A=S===void 0?!0:S,I=t.sourceColor,F=t.targetColor,D=0,Z=[1,1,1,1],Y=[1,1,1,1];return I&&F&&(Z=gi(I),Y=gi(F),D=1),(0,H.Z)({u_topsurface:Number(x),u_sidesurface:Number(A),u_heightfixed:Number(u),u_raisingHeight:Number(p),u_linearColor:D,u_sourceColor:Z,u_targetColor:Y,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x;return Q().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return u=this.getShaders(),l=u.frag,p=u.vert,v=u.type,A.next=3,this.layer.buildLayerModel({moduleName:v,vertexShader:p,fragmentShader:l,inject:this.getInject(),triangulation:w_});case 3:return x=A.sent,A.abrupt("return",[x]);case 5:case"end":return A.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.pickLight,u=t.mapTexture;return u?{frag:KT,vert:JT,type:"polygonExtrudeTexture"}:o?{frag:QT,vert:eM,type:"polygonExtrudePickLight"}:{frag:XT,vert:qT,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=t,u=this.layer.coordCenter||this.layer.getSource().center,l=o[2]-o[0],p=o[3]-o[1];if(this.mapService.version==="GAODE2.x"){var v=this.mapService.coordToAMap2RelativeCoordinates([t[0],t[1]],u),x=(0,Dn.Z)(v,2),S=x[0],A=x[1],I=this.mapService.coordToAMap2RelativeCoordinates([t[2],t[3]],u),F=(0,Dn.Z)(I,2),D=F[0],Z=F[1];l=D-S,p=Z-A,o=[S,A,D,Z]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:hn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(ve,me,De){var Be=De[0],Je=De[1];return[(Be-o[0])/l,(Je-o[1])/p,De[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:hn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(ve,me,De,Be,Je){return Je}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:hn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(ve){var me=ve.size,De=me===void 0?10:me;return Array.isArray(De)?[De[0]]:[De]}}})}},{key:"loadTexture",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u=this,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(l=this.layer.getLayerConfig(),p=l.mapTexture,v=this.rendererService.createTexture2D,this.texture=v({height:0,width:0}),!p){S.next=5;break}return S.abrupt("return",new Promise(function(A,I){var F=new Image;F.crossOrigin="anonymous",F.src=p,F.onload=function(){return u.texture=v({data:F,width:F.width,height:F.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.LINEAR,mag:q.LINEAR}),A(null)},F.onerror=function(){I(new Error("image load error"))}}));case 5:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(da);function rM(e){var i=nM();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function nM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iM=`varying vec4 v_color;
#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,aM=`#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;
varying vec4 v_Color;


void main() {
   gl_FragColor = v_Color;
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,oM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,sM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_raisingHeight: 0.0;

varying vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,uM=function(e){(0,Xr.Z)(r,e);var i=rM(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,l=t.opacityLinear,p=l===void 0?{enable:!1,dir:"in"}:l;return(0,H.Z)({u_raisingHeight:Number(u),u_opacitylinear:Number(p.enable),u_dir:p.dir==="in"?1:0},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S,A,I,F,D;return Q().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return u=this.getModelParams(),l=u.frag,p=u.vert,v=u.triangulation,x=u.type,S=this.layer.getLayerConfig(),A=S.workerEnabled,I=A===void 0?!1:A,F=S.enablePicking,this.layer.triangulation=v,Y.next=5,this.layer.buildLayerModel({moduleName:x,vertexShader:p,fragmentShader:l,inject:this.getInject(),triangulation:v,primitive:q.TRIANGLES,depth:{enable:!1},workerEnabled:I,workerOptions:{modelType:x,enablePicking:F}});case 5:return D=Y.sent,Y.abrupt("return",[D]);case 7:case"end":return Y.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:hn.Attribute,descriptor:{name:"a_linear",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(p,v,x){return[x[3],x[4],x[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:aM,vert:oM,type:"polygonLinear",triangulation:M3}:{frag:iM,vert:sM,type:"polygonFill",triangulation:Lc}}}]),r}(da);function lM(e){var i=cM();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function cM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fM=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,hM=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,pM=yi.isNumber,dM=function(e){(0,Xr.Z)(r,e);var i=lM(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.watercolor,p=l===void 0?"#6D99A8":l,v=t.watercolor2,x=v===void 0?"#0F121C":v;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:gi(p),u_watercolor2:gi(x),u_opacity:pM(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:hM,fragmentShader:fM,triangulation:b0,primitive:q.TRIANGLES,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o,u;(t=this.texture1)===null||t===void 0||t.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,Dn.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,S=v-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:hn.Attribute,descriptor:{name:"a_uv",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(I,F,D,Z){var Y=I.version===uc["GAODE2.x"]?I.originCoordinates[0][Z]:D,ve=(0,Dn.Z)(Y,2),me=ve[0],De=ve[1];return[(me-u)/x,(De-l)/S]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),l(function(v){t.texture1=p(v[0]),t.texture2=p(v[1]),t.texture3=p(v[2]),t.layerService.reRender()});function l(v){var x=0,S=[],A=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];A.map(function(I){var F=new Image;F.crossOrigin="",F.src=I,S.push(F),F.onload=function(){x++,x===3&&v(S)}})}function p(v){return o({data:v,width:v.width,height:v.height,wrapS:q.MIRRORED_REPEAT,wrapT:q.MIRRORED_REPEAT,min:q.LINEAR,mag:q.LINEAR})}}}]),r}(da);function vM(e){var i=mM();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function mM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gM=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,yM=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,_M=yi.isNumber,xM=function(e){(0,Xr.Z)(r,e);var i=vM(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.speed,p=l===void 0?.5:l;return{u_texture:this.texture,u_speed:p,u_opacity:_M(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:yM,fragmentShader:gM,triangulation:b0,primitive:q.TRIANGLES,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,Dn.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,S=v-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:hn.Attribute,descriptor:{name:"a_uv",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(I,F,D,Z){var Y=I.version===uc["GAODE2.x"]?I.originCoordinates[0][Z]:D,ve=(0,Dn.Z)(Y,2),me=ve[0],De=ve[1];return[(me-u)/x,(De-l)/S]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var p=new Image;p.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),p.src=u):p.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",p.onload=function(){t.texture=l({data:p,width:p.width,height:p.height,wrapS:q.MIRRORED_REPEAT,wrapT:q.MIRRORED_REPEAT,min:q.LINEAR,mag:q.LINEAR}),t.layerService.reRender()}}}]),r}(da),bM={fill:uM,line:k_,extrude:tM,text:q_,point_fill:F_,point_image:B_,point_normal:N_,point_extrude:O_,water:xM,ocean:dM},SM=bM;function wM(e){var i=EM();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function EM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mm=function(e){(0,Xr.Z)(r,e);var i=wM(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"type","PolygonLayer"),(0,P.Z)((0,k.Z)(n),"enableShaderEncodeStyles",["opacity"]),n}return(0,j.Z)(r,[{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new SM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u==="fill"||!u?"fill":u==="extrude"?"extrude":u==="water"?"water":u==="ocean"?"ocean":u==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=this.iconService.getIconMap(),v=t.find(function(S){return S.hasOwnProperty("shape")});if(v){var x=v.shape;return x==="dot"?"point_normal":(u==null?void 0:u.indexOf(x))!==-1?"point_fill":(l==null?void 0:l.indexOf(x))!==-1?"point_extrude":p.hasOwnProperty(x)?"point_image":"text"}else return"fill"}}]),r}(Fh);function AM(e){var i=CM();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function CM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TM=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
      discard;
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
     discard;
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
    if(gl_FragColor.a < 0.01)
      discard;
   
  }
}
`,MM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,J_=function(e){(0,Xr.Z)(r,e);var i=AM(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.clampLow,p=l===void 0?!0:l,v=t.clampHigh,x=v===void 0?!0:v,S=t.noDataValue,A=S===void 0?-9999999:S,I=t.domain,F=t.rampColors,D=I||Tf(F);return this.colorTexture=this.layer.textureService.getColorTexture(F,D),{u_opacity:u||1,u_texture:this.texture,u_domain:D,u_clampLow:p,u_clampHigh:typeof x!="undefined"?x:p,u_noDataValue:A,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,je.Z)(Q().mark(function o(u){var l,p,v,x;return Q().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!Array.isArray(u.data)){A.next=4;break}return A.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return A.next=6,u.data;case 6:return l=A.sent,p=l.rasterData,v=l.width,x=l.height,A.abrupt("return",{data:Array.from(p),width:v,height:x});case 11:case"end":return A.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S,A,I;return Q().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,p=u.data.dataArray[0],D.next=5,this.getRasterData(p);case 5:return v=D.sent,x=v.data,S=v.width,A=v.height,this.texture=l({data:x,width:S,height:A,format:q.LUMINANCE,type:q.FLOAT}),D.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:MM,fragmentShader:TM,triangulation:fm,primitive:q.TRIANGLES,depth:{enable:!1}});case 12:return I=D.sent,D.abrupt("return",[I]);case 14:case"end":return D.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(da),IM=["data"],PM=["rasterData"];function kM(e){var i=LM();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function LM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,OM=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(gl_FragColor.a < 0.01)
    discard;
 
}`,DM=function(e){(0,Xr.Z)(r,e);var i=kM(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"dataOption",{}),n}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.noDataValue,p=l===void 0?0:l,v=this.dataOption,x=v.rMinMax,S=v.gMinMax,A=v.bMinMax;return{u_opacity:u||1,u_texture:this.texture,u_noDataValue:p,u_rminmax:x,u_gminmax:S,u_bminmax:A}}},{key:"getRasterData",value:function(){var n=(0,je.Z)(Q().mark(function o(u){var l,p,v,x,S;return Q().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!Array.isArray(u.data)){I.next=4;break}return l=u.data,p=(0,ol.Z)(u,IM),this.dataOption=p,I.abrupt("return",(0,H.Z)({data:l},p));case 4:return I.next=6,u.data;case 6:if(v=I.sent,x=v.rasterData,S=(0,ol.Z)(v,PM),this.dataOption=S,!Array.isArray(x)){I.next=14;break}return I.abrupt("return",(0,H.Z)({data:x},S));case 14:return I.abrupt("return",(0,H.Z)({data:Array.from(x)},S));case 15:case"end":return I.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S,A,I;return Q().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,p=u.data.dataArray[0],D.next=5,this.getRasterData(p);case 5:return v=D.sent,x=v.data,S=v.width,A=v.height,this.texture=l({data:x,width:S,height:A,format:q.RGB,type:q.FLOAT}),D.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:RM,fragmentShader:OM,triangulation:fm,primitive:q.TRIANGLES,depth:{enable:!1}});case 12:return I=D.sent,D.abrupt("return",[I]);case 14:case"end":return D.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(da);function FM(e){var i=BM();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function BM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zM=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,NM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,ZM=function(e){(0,Xr.Z)(r,e);var i=FM(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.clampLow,l=u===void 0?!0:u,p=t.clampHigh,v=p===void 0?!0:p,x=t.noDataValue,S=x===void 0?-9999999:x,A=t.domain,I=t.rampColors,F=t.colorTexture,D=t.rScaler,Z=D===void 0?6553.6:D,Y=t.gScaler,ve=Y===void 0?25.6:Y,me=t.bScaler,De=me===void 0?.1:me,Be=t.offset,Je=Be===void 0?1e4:Be,_t=A||Tf(I),Zt=F;return F?this.layer.textureService.setColorTexture(F,I,_t):Zt=this.layer.textureService.getColorTexture(I,_t),{u_opacity:o||1,u_texture:this.texture,u_domain:_t,u_clampLow:l,u_clampHigh:typeof v!="undefined"?v:l,u_noDataValue:S,u_unpack:[Z,ve,De,Je],u_colorTexture:Zt}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,S.next=4,u.data.images;case 4:return p=S.sent,this.texture=l({data:p[0],width:p[0].width,height:p[0].height,min:q.LINEAR,mag:q.LINEAR}),S.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:NM,fragmentShader:zM,triangulation:fm,primitive:q.TRIANGLES,depth:{enable:!1}});case 8:return v=S.sent,S.abrupt("return",[v]);case 10:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:hn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(da),UM={raster:J_,rasterRgb:DM,raster3d:J_,rasterTerrainRgb:ZM},VM=UM;function jM(e){var i=GM();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function GM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gm=function(e){(0,Xr.Z)(r,e);var i=jM(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"type","RasterLayer"),n}return(0,j.Z)(r,[{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new VM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();switch(t){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),r}(Fh);function HM(e){var i=WM();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function WM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $M=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,YM=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,XM=yi.isNumber,qM=function(e){(0,Xr.Z)(r,e);var i=HM(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.color,p=l===void 0?"#000":l;return{u_opacity:XM(u)?u:0,u_color:gi(p)}}},{key:"initModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:YM,fragmentShader:$M,triangulation:b0,depth:{enable:!1},pick:!1});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;t&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(da),KM={fill:qM},JM=KM;function QM(e){var i=e5();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function e5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Q_=function(e){(0,Xr.Z)(r,e);var i=QM(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"type","MaskLayer"),n}return(0,j.Z)(r,[{key:"buildModels",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new JM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){return"fill"}}]),r}(Fh),e1,t1,r1,n1,ym,i1,a1,t5=yi.cloneDeep,r5=(e1=(0,at.b2)(),t1=(0,at.f3)(qe.IMapService),r1=(0,at.f3)(qe.IFontService),e1(n1=(ym=function(){function e(){(0,Mt.Z)(this,e),Or(this,"mapService",i1,this),Or(this,"fontService",a1,this)}return(0,j.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("DataMappingPlugin",(0,je.Z)(Q().mark(function u(){return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:r.log(ts.MappingStart,st.INIT),t.generateMaping(r,{styleAttributeService:o}),r.log(ts.MappingEnd,st.INIT);case 3:case"end":return p.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var u=(0,je.Z)(Q().mark(function l(p){var v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(p){S.next=2;break}return S.abrupt("return",p);case 2:return r.dataState.dataMappingNeedUpdate=!1,r.log(ts.MappingStart,st.UPDATE),v=t.generateMaping(r,{styleAttributeService:o}),r.log(ts.MappingEnd,st.UPDATE),S.abrupt("return",v);case 7:case"end":return S.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=r.getSource();if(!(r.layerModelNeedUpdate||!u||!u.inited)){var l=o.getLayerStyleAttributes()||[],p=o.getLayerStyleAttribute("filter"),v=u.data.dataArray;if(!(Array.isArray(v)&&v.length===0)){var x=l.filter(function(I){return I.needRemapping}),S=v;if(p!=null&&p.needRemapping&&p!==null&&p!==void 0&&p.scale&&(S=v.filter(function(I){return t.applyAttributeMapping(p,I)[0]})),x.length){var A=t.mapping(r,x,S,r.getEncodedData());r.setEncodedData(A)}}}})}},{key:"generateMaping",value:function(r,n){var t=this,o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[],l=o.getLayerStyleAttribute("filter"),p=r.getSource().data.dataArray,v=p;l!=null&&l.scale&&(v=p.filter(function(S){return t.applyAttributeMapping(l,S)[0]})),v=r.processData(v);var x=this.mapping(r,u,v,void 0);return r.setEncodedData(x),p.length===0&&r.encodeDataLength===0?!1:(r.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(r,n,t,o){var u=this,l=r.getLayerConfig(),p=l.arrow,v=p===void 0?{enable:!1}:p,x=n.filter(function(A){return A.scale!==void 0}).filter(function(A){return A.name!=="filter"}),S=t.map(function(A,I){var F=o?o[I]:{},D=(0,H.Z)({id:A._id,coordinates:A.coordinates},F);if(x.forEach(function(ve){var me=u.applyAttributeMapping(ve,A);(ve.name==="color"||ve.name==="stroke")&&(me=me.map(function(De){return gi(De)})),D[ve.name]=Array.isArray(me)&&me.length===1?me[0]:me,ve.name==="shape"&&(D.shape=u.fontService.getIconFontKey(D[ve.name]))}),v.enable&&D.shape==="line"){var Z=D.coordinates;if(r.arrowInsertCount<r.encodeDataLength){var Y=u.getArrowPoints(Z[0],Z[1]);D.coordinates.splice(1,0,Y,Y),r.arrowInsertCount++}}return D});return n.forEach(function(A){A.needRemapping=!1}),this.adjustData2Amap2Coordinates(S,r),this.adjustData2SimpleCoordinates(S),S}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var t=this;if(r.length>0&&this.mapService.version===uc["GAODE2.x"]){var o=n.coordCenter||n.getSource().center;r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=uc["GAODE2.x"],u.originCoordinates=t5(u.coordinates),u.coordinates=t.mapService.coordToAMap2RelativeCoordinates(u.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===uc.SIMPLE&&r.map(function(t){t.simpleCoordinate||(t.coordinates=n.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var t=[];return r.map(function(u){var l=[];u.map(function(p){l.push(n.mapService.simpleMapCoord.unproject(p))}),t.push(l)}),t}else{var o=[];return r.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(r,n){var t;if(!r.scale)return[];var o=(r==null||(t=r.scale)===null||t===void 0?void 0:t.scalers)||[],u=[];o.forEach(function(p){var v,x=p.field;(n.hasOwnProperty(x)||((v=r.scale)===null||v===void 0?void 0:v.type)==="variable")&&u.push(n[x])});var l=r.mapping?r.mapping(u):[];return l}},{key:"getArrowPoints",value:function(r,n){var t=[n[0]-r[0],n[1]-r[1]],o=Io(t),u=[r[0]+o[0]*1e-4,r[1]+o[1]*1e-4];return u}}]),e}(),i1=cr(ym.prototype,"mapService",[t1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a1=cr(ym.prototype,"fontService",[r1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ym))||n1),o1,s1,n5=(o1=(0,at.b2)(),o1(s1=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(qe.IMapService),r.hooks.init.tapPromise("DataSourcePlugin",(0,je.Z)(Q().mark(function t(){var o,u,l,p;return Q().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(r.log(ts.SourceInitStart,st.INIT),o=r.getSource(),o||(u=r.sourceOption||r.defaultSourceConfig,l=u.data,p=u.options,o=new c0(l,p),r.setSource(o)),!o.inited){x.next=8;break}n.updateClusterData(r),r.log(ts.SourceInitEnd,st.INIT),x.next=10;break;case 8:return x.next=10,new Promise(function(S){o.on("update",function(A){A.type==="inited"&&(n.updateClusterData(r),r.log(ts.SourceInitEnd,st.INIT)),S(null)})});case 10:case"end":return x.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,je.Z)(Q().mark(function t(){var o,u,l;return Q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o=n.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate,r.dataState.dataSourceNeedUpdate=!1,l=o||u,v.abrupt("return",l);case 5:case"end":return v.stop()}},t)})))}},{key:"updateClusterData",value:function(r){if(r.isTileLayer||r.tileLayer||!r.getSource())return!1;var n=r.getSource(),t=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,l=this.mapService.getZoom()-1,p=r.dataState.dataSourceNeedUpdate;return t&&p&&n.updateClusterData(Math.floor(l)),t&&Math.abs(r.clusterZoom-l)>=1?(u!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),r.clusterZoom=l,!0):!1}}]),e}())||s1);function A0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function u1(e){return e.length===1&&(e=i5(e)),{left:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)<0?n=o+1:t=o}return n},right:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)>0?t=o:n=o+1}return n}}}function i5(e){return function(i,r){return A0(e(i),r)}}var l1=u1(A0),a5=l1.right,DR=l1.left,_m=a5;function c1(e,i){var r=e.length,n=-1,t,o,u;if(i==null){for(;++n<r;)if((t=e[n])!=null&&t>=t)for(o=u=t;++n<r;)(t=e[n])!=null&&(o>t&&(o=t),u<t&&(u=t))}else for(;++n<r;)if((t=i(e[n],n,e))!=null&&t>=t)for(o=u=t;++n<r;)(t=i(e[n],n,e))!=null&&(o>t&&(o=t),u<t&&(u=t));return[o,u]}var f1=Array.prototype,FR=f1.slice,BR=f1.map,C0=Math.sqrt(50),T0=Math.sqrt(10),M0=Math.sqrt(2);function h1(e,i,r){var n,t=-1,o,u,l;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(o=e,e=i,i=o),(l=xm(e,i,r))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),i=Math.floor(i/l),u=new Array(o=Math.ceil(i-e+1));++t<o;)u[t]=(e+t)*l;else for(e=Math.floor(e*l),i=Math.ceil(i*l),u=new Array(o=Math.ceil(e-i+1));++t<o;)u[t]=(e-t)/l;return n&&u.reverse(),u}function xm(e,i,r){var n=(i-e)/Math.max(0,r),t=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,t);return t>=0?(o>=C0?10:o>=T0?5:o>=M0?2:1)*Math.pow(10,t):-Math.pow(10,-t)/(o>=C0?10:o>=T0?5:o>=M0?2:1)}function I0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),t=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/t;return o>=C0?t*=10:o>=T0?t*=5:o>=M0&&(t*=2),i<e?-t:t}function zR(){var e=identity,i=extent,r=sturges;function n(t){var o,u=t.length,l,p=new Array(u);for(o=0;o<u;++o)p[o]=e(t[o],o,t);var v=i(p),x=v[0],S=v[1],A=r(p,x,S);Array.isArray(A)||(A=tickStep(x,S,A),A=range(Math.ceil(x/A)*A,S,A));for(var I=A.length;A[0]<=x;)A.shift(),--I;for(;A[I-1]>S;)A.pop(),--I;var F=new Array(I+1),D;for(o=0;o<=I;++o)D=F[o]=[],D.x0=o>0?A[o-1]:x,D.x1=o<I?A[o]:S;for(o=0;o<u;++o)l=p[o],x<=l&&l<=S&&F[bisect(A,l,0,I)].push(t[o]);return F}return n.value=function(t){return arguments.length?(e=typeof t=="function"?t:constant(t),n):e},n.domain=function(t){return arguments.length?(i=typeof t=="function"?t:constant([t[0],t[1]]),n):i},n.thresholds=function(t){return arguments.length?(r=typeof t=="function"?t:Array.isArray(t)?constant(slice.call(t)):constant(t),n):r},n}function NR(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function o5(e){return e===null?NaN:+e}function s5(e,i,r){if(r==null&&(r=o5),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,t=(n-1)*i,o=Math.floor(t),u=+r(e[o],o,e),l=+r(e[o+1],o+1,e);return u+(l-u)*(t-o)}}var u5=N(87765),cc="$";function bm(){}bm.prototype=p1.prototype={constructor:bm,has:function(e){return cc+e in this},get:function(e){return this[cc+e]},set:function(e,i){return this[cc+e]=i,this},remove:function(e){var i=cc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===cc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===cc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===cc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===cc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===cc&&++e;return e},empty:function(){for(var e in this)if(e[0]===cc)return!1;return!0},each:function(e){for(var i in this)i[0]===cc&&e(this[i],i.slice(1),this)}};function p1(e,i){var r=new bm;if(e instanceof bm)e.each(function(l,p){r.set(p,l)});else if(Array.isArray(e)){var n=-1,t=e.length,o;if(i==null)for(;++n<t;)r.set(n,e[n]);else for(;++n<t;)r.set(i(o=e[n],n,e),o)}else if(e)for(var u in e)r.set(u,e[u]);return r}var P0=p1;function ZR(){var e=[],i=[],r,n,t;function o(l,p,v,x){if(p>=e.length)return r!=null&&l.sort(r),n!=null?n(l):l;for(var S=-1,A=l.length,I=e[p++],F,D,Z=map(),Y,ve=v();++S<A;)(Y=Z.get(F=I(D=l[S])+""))?Y.push(D):Z.set(F,[D]);return Z.each(function(me,De){x(ve,De,o(me,p,v,x))}),ve}function u(l,p){if(++p>e.length)return l;var v,x=i[p-1];return n!=null&&p>=e.length?v=l.entries():(v=[],l.each(function(S,A){v.push({key:A,values:u(S,p)})})),x!=null?v.sort(function(S,A){return x(S.key,A.key)}):v}return t={object:function(l){return o(l,0,l5,c5)},map:function(l){return o(l,0,d1,v1)},entries:function(l){return u(o(l,0,d1,v1),0)},key:function(l){return e.push(l),t},sortKeys:function(l){return i[e.length-1]=l,t},sortValues:function(l){return r=l,t},rollup:function(l){return n=l,t}}}function l5(){return{}}function c5(e,i,r){e[i]=r}function d1(){return map()}function v1(e,i,r){e.set(i,r)}function Sm(){}var xp=P0.prototype;Sm.prototype=f5.prototype={constructor:Sm,has:xp.has,add:function(e){return e+="",this[cc+e]=e,this},remove:xp.remove,clear:xp.clear,values:xp.keys,size:xp.size,empty:xp.empty,each:xp.each};function f5(e,i){var r=new Sm;if(e instanceof Sm)e.each(function(o){r.add(o)});else if(e){var n=-1,t=e.length;if(i==null)for(;++n<t;)r.add(e[n]);else for(;++n<t;)r.add(i(e[n],n,e))}return r}var UR=null,m1=Array.prototype,g1=m1.map,bp=m1.slice;function Nh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function y1(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var _1={name:"implicit"};function wm(){var e=P0(),i=[],r=[],n=_1;function t(o){var u=o+"",l=e.get(u);if(!l){if(n!==_1)return n;e.set(u,l=i.push(o))}return r[(l-1)%r.length]}return t.domain=function(o){if(!arguments.length)return i.slice();i=[],e=P0();for(var u=-1,l=o.length,p,v;++u<l;)e.has(v=(p=o[u])+"")||e.set(v,i.push(p));return t},t.range=function(o){return arguments.length?(r=bp.call(o),t):r.slice()},t.unknown=function(o){return arguments.length?(n=o,t):n},t.copy=function(){return wm(i,r).unknown(n)},Nh.apply(t,arguments),t}function x1(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],t,o,u=!1,l=0,p=0,v=.5;delete e.unknown;function x(){var S=i().length,A=n[1]<n[0],I=n[A-0],F=n[1-A];t=(F-I)/Math.max(1,S-l+p*2),u&&(t=Math.floor(t)),I+=(F-I-t*(S-l))*v,o=t*(1-l),u&&(I=Math.round(I),o=Math.round(o));var D=sequence(S).map(function(Z){return I+t*Z});return r(A?D.reverse():D)}return e.domain=function(S){return arguments.length?(i(S),x()):i()},e.range=function(S){return arguments.length?(n=[+S[0],+S[1]],x()):n.slice()},e.rangeRound=function(S){return n=[+S[0],+S[1]],u=!0,x()},e.bandwidth=function(){return o},e.step=function(){return t},e.round=function(S){return arguments.length?(u=!!S,x()):u},e.padding=function(S){return arguments.length?(l=Math.min(1,p=+S),x()):l},e.paddingInner=function(S){return arguments.length?(l=Math.min(1,S),x()):l},e.paddingOuter=function(S){return arguments.length?(p=+S,x()):p},e.align=function(S){return arguments.length?(v=Math.max(0,Math.min(1,S)),x()):v},e.copy=function(){return x1(i(),n).round(u).paddingInner(l).paddingOuter(p).align(v)},initRange.apply(x(),arguments)}function b1(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return b1(i())},e}function VR(){return b1(x1.apply(null,arguments).paddingInner(1))}var h5=N(21775),p5=N(73626);function d5(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function v5(e){return function(){return e}}function m5(e){return+e}var S1=[0,1];function xu(e){return e}function k0(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:v5(isNaN(i)?NaN:.5)}function w1(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(t){return Math.max(i,Math.min(r,t))}}function g5(e,i,r){var n=e[0],t=e[1],o=i[0],u=i[1];return t<n?(n=k0(t,n),o=r(u,o)):(n=k0(n,t),o=r(o,u)),function(l){return o(n(l))}}function y5(e,i,r){var n=Math.min(e.length,i.length)-1,t=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++u<n;)t[u]=k0(e[u],e[u+1]),o[u]=r(i[u],i[u+1]);return function(l){var p=_m(e,l,1,n)-1;return o[p](t[p](l))}}function Em(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function L0(){var e=S1,i=S1,r=h5.Z,n,t,o,u=xu,l,p,v;function x(){return l=Math.min(e.length,i.length)>2?y5:g5,p=v=null,S}function S(A){return isNaN(A=+A)?o:(p||(p=l(e.map(n),i,r)))(n(u(A)))}return S.invert=function(A){return u(t((v||(v=l(i,e.map(n),p5.Z)))(A)))},S.domain=function(A){return arguments.length?(e=g1.call(A,m5),u===xu||(u=w1(e)),x()):e.slice()},S.range=function(A){return arguments.length?(i=bp.call(A),x()):i.slice()},S.rangeRound=function(A){return i=bp.call(A),r=d5,x()},S.clamp=function(A){return arguments.length?(u=A?w1(e):xu,S):u!==xu},S.interpolate=function(A){return arguments.length?(r=A,x()):r},S.unknown=function(A){return arguments.length?(o=A,S):o},function(A,I){return n=A,t=I,x()}}function E1(e,i){return L0()(e,i)}var _5=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Am(e){if(!(i=_5.exec(e)))throw new Error("invalid format: "+e);var i;return new R0({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}Am.prototype=R0.prototype;function R0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}R0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function x5(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Cm(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function cd(e){return e=Cm(Math.abs(e)),e?e[1]:NaN}function b5(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(cd(i)/3)))*3-cd(Math.abs(e)))}function S5(e,i){return function(r,n){for(var t=r.length,o=[],u=0,l=e[0],p=0;t>0&&l>0&&(p+l+1>n&&(l=Math.max(1,n-p)),o.push(r.substring(t-=l,t+l)),!((p+=l+1)>n));)l=e[u=(u+1)%e.length];return o.reverse().join(i)}}function w5(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function E5(e){e:for(var i=e.length,r=1,n=-1,t;r<i;++r)switch(e[r]){case".":n=t=r;break;case"0":n===0&&(n=r),t=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(t+1):e}var A1;function A5(e,i){var r=Cm(e,i);if(!r)return e+"";var n=r[0],t=r[1],o=t-(A1=Math.max(-8,Math.min(8,Math.floor(t/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+Cm(e,Math.max(0,i+o-1))[0]}function C1(e,i){var r=Cm(e,i);if(!r)return e+"";var n=r[0],t=r[1];return t<0?"0."+new Array(-t).join("0")+n:n.length>t+1?n.slice(0,t+1)+"."+n.slice(t+1):n+new Array(t-n.length+2).join("0")}var T1={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:x5,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return C1(e*100,i)},r:C1,s:A5,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function M1(e){return e}var I1=Array.prototype.map,P1=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function C5(e){var i=e.grouping===void 0||e.thousands===void 0?M1:S5(I1.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",t=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?M1:w5(I1.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",p=e.nan===void 0?"NaN":e.nan+"";function v(S){S=Am(S);var A=S.fill,I=S.align,F=S.sign,D=S.symbol,Z=S.zero,Y=S.width,ve=S.comma,me=S.precision,De=S.trim,Be=S.type;Be==="n"?(ve=!0,Be="g"):T1[Be]||(me===void 0&&(me=12),De=!0,Be="g"),(Z||A==="0"&&I==="=")&&(Z=!0,A="0",I="=");var Je=D==="$"?r:D==="#"&&/[boxX]/.test(Be)?"0"+Be.toLowerCase():"",_t=D==="$"?n:/[%p]/.test(Be)?u:"",Zt=T1[Be],$t=/[defgprs%]/.test(Be);me=me===void 0?6:/[gprs]/.test(Be)?Math.max(1,Math.min(21,me)):Math.max(0,Math.min(20,me));function dr(lr){var Yr=Je,un=_t,In,Gi,Ra;if(Be==="c")un=Zt(lr)+un,lr="";else{lr=+lr;var Va=lr<0||1/lr<0;if(lr=isNaN(lr)?p:Zt(Math.abs(lr),me),De&&(lr=E5(lr)),Va&&+lr==0&&F!=="+"&&(Va=!1),Yr=(Va?F==="("?F:l:F==="-"||F==="("?"":F)+Yr,un=(Be==="s"?P1[8+A1/3]:"")+un+(Va&&F==="("?")":""),$t){for(In=-1,Gi=lr.length;++In<Gi;)if(Ra=lr.charCodeAt(In),48>Ra||Ra>57){un=(Ra===46?t+lr.slice(In+1):lr.slice(In))+un,lr=lr.slice(0,In);break}}}ve&&!Z&&(lr=i(lr,Infinity));var ao=Yr.length+lr.length+un.length,Ko=ao<Y?new Array(Y-ao+1).join(A):"";switch(ve&&Z&&(lr=i(Ko+lr,Ko.length?Y-un.length:Infinity),Ko=""),I){case"<":lr=Yr+lr+un+Ko;break;case"=":lr=Yr+Ko+lr+un;break;case"^":lr=Ko.slice(0,ao=Ko.length>>1)+Yr+lr+un+Ko.slice(ao);break;default:lr=Ko+Yr+lr+un;break}return o(lr)}return dr.toString=function(){return S+""},dr}function x(S,A){var I=v((S=Am(S),S.type="f",S)),F=Math.max(-8,Math.min(8,Math.floor(cd(A)/3)))*3,D=Math.pow(10,-F),Z=P1[8+F/3];return function(Y){return I(D*Y)+Z}}return{format:v,formatPrefix:x}}var Tm,O0,k1;T5({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function T5(e){return Tm=C5(e),O0=Tm.format,k1=Tm.formatPrefix,Tm}function M5(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,cd(i)-cd(e))+1}function I5(e){return Math.max(0,-cd(Math.abs(e)))}function P5(e,i,r,n){var t=I0(e,i,r),o;switch(n=Am(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(o=b5(t,u))&&(n.precision=o),k1(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=M5(t,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=I5(t))&&(n.precision=o-(n.type==="%")*2);break}}return O0(n)}function av(e){var i=e.domain;return e.ticks=function(r){var n=i();return h1(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var t=i();return P5(t[0],t[t.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),t=0,o=n.length-1,u=n[t],l=n[o],p;return l<u&&(p=u,u=l,l=p,p=t,t=o,o=p),p=xm(u,l,r),p>0?(u=Math.floor(u/p)*p,l=Math.ceil(l/p)*p,p=xm(u,l,r)):p<0&&(u=Math.ceil(u*p)/p,l=Math.floor(l*p)/p,p=xm(u,l,r)),p>0?(n[t]=Math.floor(u/p)*p,n[o]=Math.ceil(l/p)*p,i(n)):p<0&&(n[t]=Math.ceil(u*p)/p,n[o]=Math.floor(l*p)/p,i(n)),e},e}function L1(){var e=E1(xu,xu);return e.copy=function(){return Em(e,L1())},Nh.apply(e,arguments),av(e)}function k5(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=map.call(n,number),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return k5(e).unknown(i)},e=arguments.length?map.call(e,number):[0,1],linearish(r)}function R1(e,i){e=e.slice();var r=0,n=e.length-1,t=e[r],o=e[n],u;return o<t&&(u=r,r=n,n=u,u=t,t=o,o=u),e[r]=i.floor(t),e[n]=i.ceil(o),e}function O1(e){return Math.log(e)}function D1(e){return Math.exp(e)}function L5(e){return-Math.log(-e)}function R5(e){return-Math.exp(-e)}function O5(e){return isFinite(e)?+("1e"+e):e<0?0:e}function D5(e){return e===10?O5:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function F5(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function F1(e){return function(i){return-e(-i)}}function B5(e){var i=e(O1,D1),r=i.domain,n=10,t,o;function u(){return t=F5(n),o=D5(n),r()[0]<0?(t=F1(t),o=F1(o),e(L5,R5)):e(O1,D1),i}return i.base=function(l){return arguments.length?(n=+l,u()):n},i.domain=function(l){return arguments.length?(r(l),u()):r()},i.ticks=function(l){var p=r(),v=p[0],x=p[p.length-1],S;(S=x<v)&&(A=v,v=x,x=A);var A=t(v),I=t(x),F,D,Z,Y=l==null?10:+l,ve=[];if(!(n%1)&&I-A<Y){if(A=Math.round(A)-1,I=Math.round(I)+1,v>0){for(;A<I;++A)for(D=1,F=o(A);D<n;++D)if(Z=F*D,!(Z<v)){if(Z>x)break;ve.push(Z)}}else for(;A<I;++A)for(D=n-1,F=o(A);D>=1;--D)if(Z=F*D,!(Z<v)){if(Z>x)break;ve.push(Z)}}else ve=h1(A,I,Math.min(I-A,Y)).map(o);return S?ve.reverse():ve},i.tickFormat=function(l,p){if(p==null&&(p=n===10?".0e":","),typeof p!="function"&&(p=O0(p)),l===Infinity)return p;l==null&&(l=10);var v=Math.max(1,n*l/i.ticks().length);return function(x){var S=x/o(Math.round(t(x)));return S*n<n-.5&&(S*=n),S<=v?p(x):""}},i.nice=function(){return r(R1(r(),{floor:function(l){return o(Math.floor(t(l)))},ceil:function(l){return o(Math.ceil(t(l)))}}))},i}function B1(){var e=B5(L0()).domain([1,10]);return e.copy=function(){return Em(e,B1()).base(e.base())},Nh.apply(e,arguments),e}function z1(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function N1(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function z5(e){var i=1,r=e(z1(i),N1(i));return r.constant=function(n){return arguments.length?e(z1(i=+n),N1(i)):i},linearish(r)}function N5(){var e=z5(transformer());return e.copy=function(){return copy(e,N5()).constant(e.constant())},initRange.apply(e,arguments)}function Z1(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function Z5(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function U5(e){return e<0?-e*e:e*e}function V5(e){var i=e(xu,xu),r=1;function n(){return r===1?e(xu,xu):r===.5?e(Z5,U5):e(Z1(r),Z1(1/r))}return i.exponent=function(t){return arguments.length?(r=+t,n()):r},av(i)}function D0(){var e=V5(L0());return e.copy=function(){return Em(e,D0()).exponent(e.exponent())},Nh.apply(e,arguments),e}function jR(){return D0.apply(null,arguments).exponent(.5)}function U1(){var e=[],i=[],r=[],n;function t(){var u=0,l=Math.max(1,i.length);for(r=new Array(l-1);++u<l;)r[u-1]=s5(e,u/l);return o}function o(u){return isNaN(u=+u)?n:i[_m(r,u)]}return o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var l=0,p=u.length,v;l<p;++l)v=u[l],v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(A0),t()},o.range=function(u){return arguments.length?(i=bp.call(u),t()):i.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return U1().domain(e).range(i).unknown(n)},Nh.apply(o,arguments)}function V1(){var e=0,i=1,r=1,n=[.5],t=[0,1],o;function u(p){return p<=p?t[_m(n,p,0,r)]:o}function l(){var p=-1;for(n=new Array(r);++p<r;)n[p]=((p+1)*i-(p-r)*e)/(r+1);return u}return u.domain=function(p){return arguments.length?(e=+p[0],i=+p[1],l()):[e,i]},u.range=function(p){return arguments.length?(r=(t=bp.call(p)).length-1,l()):t.slice()},u.invertExtent=function(p){var v=t.indexOf(p);return v<0?[NaN,NaN]:v<1?[e,n[0]]:v>=r?[n[r-1],i]:[n[v-1],n[v]]},u.unknown=function(p){return arguments.length&&(o=p),u},u.thresholds=function(){return n.slice()},u.copy=function(){return V1().domain([e,i]).range(t).unknown(o)},Nh.apply(av(u),arguments)}function j1(){var e=[.5],i=[0,1],r,n=1;function t(o){return o<=o?i[_m(e,o,0,n)]:r}return t.domain=function(o){return arguments.length?(e=bp.call(o),n=Math.min(e.length,i.length-1),t):e.slice()},t.range=function(o){return arguments.length?(i=bp.call(o),n=Math.min(e.length,i.length-1),t):i.slice()},t.invertExtent=function(o){var u=i.indexOf(o);return[e[u-1],e[u]]},t.unknown=function(o){return arguments.length?(r=o,t):r},t.copy=function(){return j1().domain(e).range(i).unknown(r)},Nh.apply(t,arguments)}var F0=new Date,B0=new Date;function Ru(e,i,r,n){function t(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return t.floor=function(o){return e(o=new Date(+o)),o},t.ceil=function(o){return e(o=new Date(o-1)),i(o,1),e(o),o},t.round=function(o){var u=t(o),l=t.ceil(o);return o-u<l-o?u:l},t.offset=function(o,u){return i(o=new Date(+o),u==null?1:Math.floor(u)),o},t.range=function(o,u,l){var p=[],v;if(o=t.ceil(o),l=l==null?1:Math.floor(l),!(o<u)||!(l>0))return p;do p.push(v=new Date(+o)),i(o,l),e(o);while(v<o&&o<u);return p},t.filter=function(o){return Ru(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,l){if(u>=u)if(l<0)for(;++l<=0;)for(;i(u,-1),!o(u););else for(;--l>=0;)for(;i(u,1),!o(u););})},r&&(t.count=function(o,u){return F0.setTime(+o),B0.setTime(+u),e(F0),e(B0),Math.floor(r(F0,B0))},t.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?t.filter(n?function(u){return n(u)%o==0}:function(u){return t.count(0,u)%o==0}):t}),t}var z0=Ru(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});z0.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ru(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var fd=z0,GR=z0.range,G1=Ru(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),j5=G1,HR=G1.range,Mm=1e3,ov=6e4,H1=36e5,W1=864e5,$1=6048e5;function Sp(e){return Ru(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*ov)/$1})}var N0=Sp(0),Im=Sp(1),G5=Sp(2),H5=Sp(3),hd=Sp(4),W5=Sp(5),$5=Sp(6),WR=N0.range,$R=Im.range,YR=G5.range,XR=H5.range,qR=hd.range,KR=W5.range,JR=$5.range,Y1=Ru(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*ov)/W1},function(e){return e.getDate()-1}),Z0=Y1,QR=Y1.range,X1=Ru(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Mm-e.getMinutes()*ov)},function(e,i){e.setTime(+e+i*H1)},function(e,i){return(i-e)/H1},function(e){return e.getHours()}),Y5=X1,e6=X1.range,q1=Ru(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Mm)},function(e,i){e.setTime(+e+i*ov)},function(e,i){return(i-e)/ov},function(e){return e.getMinutes()}),X5=q1,t6=q1.range,K1=Ru(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*Mm)},function(e,i){return(i-e)/Mm},function(e){return e.getUTCSeconds()}),q5=K1,r6=K1.range,Pm=Ru(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});Pm.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ru(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):Pm};var K5=Pm,n6=Pm.range;function wp(e){return Ru(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/$1})}var J1=wp(0),km=wp(1),J5=wp(2),Q5=wp(3),pd=wp(4),e4=wp(5),t4=wp(6),i6=J1.range,a6=km.range,o6=J5.range,s6=Q5.range,u6=pd.range,l6=e4.range,c6=t4.range,Q1=Ru(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/W1},function(e){return e.getUTCDate()-1}),ex=Q1,f6=Q1.range,U0=Ru(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});U0.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ru(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var sv=U0,h6=U0.range;function V0(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function j0(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function uv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function r4(e){var i=e.dateTime,r=e.date,n=e.time,t=e.periods,o=e.days,u=e.shortDays,l=e.months,p=e.shortMonths,v=lv(t),x=cv(t),S=lv(o),A=cv(o),I=lv(u),F=cv(u),D=lv(l),Z=cv(l),Y=lv(p),ve=cv(p),me={a:Va,A:ao,b:Ko,B:oh,c:null,d:ox,e:ox,f:A4,g:D4,G:B4,H:S4,I:w4,j:E4,L:sx,m:C4,M:T4,p:YL,q:XL,Q:px,s:dx,S:M4,u:I4,U:P4,V:k4,w:L4,W:R4,x:null,X:null,y:O4,Y:F4,Z:z4,"%":hx},De={a:qL,A:KL,b:JL,B:QL,c:null,d:lx,e:lx,f:V4,g:J4,G:eI,H:N4,I:Z4,j:U4,L:cx,m:j4,M:G4,p:eR,q:tR,Q:px,s:dx,S:H4,u:W4,U:$4,V:Y4,w:X4,W:q4,x:null,X:null,y:K4,Y:Q4,Z:tI,"%":hx},Be={a:dr,A:lr,b:Yr,B:un,c:In,d:ix,e:ix,f:y4,g:nx,G:rx,H:ax,I:ax,j:d4,L:g4,m:p4,M:v4,p:$t,q:h4,Q:x4,s:b4,S:m4,u:s4,U:u4,V:l4,w:o4,W:c4,x:Gi,X:Ra,y:nx,Y:rx,Z:f4,"%":_4};me.x=Je(r,me),me.X=Je(n,me),me.c=Je(i,me),De.x=Je(r,De),De.X=Je(n,De),De.c=Je(i,De);function Je(qn,ia){return function(xa){var ln=[],ul=-1,vo=0,Rl=qn.length,Ol,Tp,i2;for(xa instanceof Date||(xa=new Date(+xa));++ul<Rl;)qn.charCodeAt(ul)===37&&(ln.push(qn.slice(vo,ul)),(Tp=tx[Ol=qn.charAt(++ul)])!=null?Ol=qn.charAt(++ul):Tp=Ol==="e"?" ":"0",(i2=ia[Ol])&&(Ol=i2(xa,Tp)),ln.push(Ol),vo=ul+1);return ln.push(qn.slice(vo,ul)),ln.join("")}}function _t(qn,ia){return function(xa){var ln=uv(1900,void 0,1),ul=Zt(ln,qn,xa+="",0),vo,Rl;if(ul!=xa.length)return null;if("Q"in ln)return new Date(ln.Q);if("s"in ln)return new Date(ln.s*1e3+("L"in ln?ln.L:0));if(ia&&!("Z"in ln)&&(ln.Z=0),"p"in ln&&(ln.H=ln.H%12+ln.p*12),ln.m===void 0&&(ln.m="q"in ln?ln.q:0),"V"in ln){if(ln.V<1||ln.V>53)return null;"w"in ln||(ln.w=1),"Z"in ln?(vo=j0(uv(ln.y,0,1)),Rl=vo.getUTCDay(),vo=Rl>4||Rl===0?km.ceil(vo):km(vo),vo=ex.offset(vo,(ln.V-1)*7),ln.y=vo.getUTCFullYear(),ln.m=vo.getUTCMonth(),ln.d=vo.getUTCDate()+(ln.w+6)%7):(vo=V0(uv(ln.y,0,1)),Rl=vo.getDay(),vo=Rl>4||Rl===0?Im.ceil(vo):Im(vo),vo=Z0.offset(vo,(ln.V-1)*7),ln.y=vo.getFullYear(),ln.m=vo.getMonth(),ln.d=vo.getDate()+(ln.w+6)%7)}else("W"in ln||"U"in ln)&&("w"in ln||(ln.w="u"in ln?ln.u%7:"W"in ln?1:0),Rl="Z"in ln?j0(uv(ln.y,0,1)).getUTCDay():V0(uv(ln.y,0,1)).getDay(),ln.m=0,ln.d="W"in ln?(ln.w+6)%7+ln.W*7-(Rl+5)%7:ln.w+ln.U*7-(Rl+6)%7);return"Z"in ln?(ln.H+=ln.Z/100|0,ln.M+=ln.Z%100,j0(ln)):V0(ln)}}function Zt(qn,ia,xa,ln){for(var ul=0,vo=ia.length,Rl=xa.length,Ol,Tp;ul<vo;){if(ln>=Rl)return-1;if(Ol=ia.charCodeAt(ul++),Ol===37){if(Ol=ia.charAt(ul++),Tp=Be[Ol in tx?ia.charAt(ul++):Ol],!Tp||(ln=Tp(qn,xa,ln))<0)return-1}else if(Ol!=xa.charCodeAt(ln++))return-1}return ln}function $t(qn,ia,xa){var ln=v.exec(ia.slice(xa));return ln?(qn.p=x[ln[0].toLowerCase()],xa+ln[0].length):-1}function dr(qn,ia,xa){var ln=I.exec(ia.slice(xa));return ln?(qn.w=F[ln[0].toLowerCase()],xa+ln[0].length):-1}function lr(qn,ia,xa){var ln=S.exec(ia.slice(xa));return ln?(qn.w=A[ln[0].toLowerCase()],xa+ln[0].length):-1}function Yr(qn,ia,xa){var ln=Y.exec(ia.slice(xa));return ln?(qn.m=ve[ln[0].toLowerCase()],xa+ln[0].length):-1}function un(qn,ia,xa){var ln=D.exec(ia.slice(xa));return ln?(qn.m=Z[ln[0].toLowerCase()],xa+ln[0].length):-1}function In(qn,ia,xa){return Zt(qn,i,ia,xa)}function Gi(qn,ia,xa){return Zt(qn,r,ia,xa)}function Ra(qn,ia,xa){return Zt(qn,n,ia,xa)}function Va(qn){return u[qn.getDay()]}function ao(qn){return o[qn.getDay()]}function Ko(qn){return p[qn.getMonth()]}function oh(qn){return l[qn.getMonth()]}function YL(qn){return t[+(qn.getHours()>=12)]}function XL(qn){return 1+~~(qn.getMonth()/3)}function qL(qn){return u[qn.getUTCDay()]}function KL(qn){return o[qn.getUTCDay()]}function JL(qn){return p[qn.getUTCMonth()]}function QL(qn){return l[qn.getUTCMonth()]}function eR(qn){return t[+(qn.getUTCHours()>=12)]}function tR(qn){return 1+~~(qn.getUTCMonth()/3)}return{format:function(qn){var ia=Je(qn+="",me);return ia.toString=function(){return qn},ia},parse:function(qn){var ia=_t(qn+="",!1);return ia.toString=function(){return qn},ia},utcFormat:function(qn){var ia=Je(qn+="",De);return ia.toString=function(){return qn},ia},utcParse:function(qn){var ia=_t(qn+="",!0);return ia.toString=function(){return qn},ia}}}var tx={"-":"",_:" ","0":"0"},Ns=/^\s*\d+/,n4=/^%/,i4=/[\\^$*+?|[\]().{}]/g;function _a(e,i,r){var n=e<0?"-":"",t=(n?-e:e)+"",o=t.length;return n+(o<r?new Array(r-o+1).join(i)+t:t)}function a4(e){return e.replace(i4,"\\$&")}function lv(e){return new RegExp("^(?:"+e.map(a4).join("|")+")","i")}function cv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function o4(e,i,r){var n=Ns.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function s4(e,i,r){var n=Ns.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function u4(e,i,r){var n=Ns.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function l4(e,i,r){var n=Ns.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function c4(e,i,r){var n=Ns.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function rx(e,i,r){var n=Ns.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function nx(e,i,r){var n=Ns.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function f4(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function h4(e,i,r){var n=Ns.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function p4(e,i,r){var n=Ns.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function ix(e,i,r){var n=Ns.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function d4(e,i,r){var n=Ns.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function ax(e,i,r){var n=Ns.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function v4(e,i,r){var n=Ns.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function m4(e,i,r){var n=Ns.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function g4(e,i,r){var n=Ns.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function y4(e,i,r){var n=Ns.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function _4(e,i,r){var n=n4.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function x4(e,i,r){var n=Ns.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function b4(e,i,r){var n=Ns.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function ox(e,i){return _a(e.getDate(),i,2)}function S4(e,i){return _a(e.getHours(),i,2)}function w4(e,i){return _a(e.getHours()%12||12,i,2)}function E4(e,i){return _a(1+Z0.count(fd(e),e),i,3)}function sx(e,i){return _a(e.getMilliseconds(),i,3)}function A4(e,i){return sx(e,i)+"000"}function C4(e,i){return _a(e.getMonth()+1,i,2)}function T4(e,i){return _a(e.getMinutes(),i,2)}function M4(e,i){return _a(e.getSeconds(),i,2)}function I4(e){var i=e.getDay();return i===0?7:i}function P4(e,i){return _a(N0.count(fd(e)-1,e),i,2)}function ux(e){var i=e.getDay();return i>=4||i===0?hd(e):hd.ceil(e)}function k4(e,i){return e=ux(e),_a(hd.count(fd(e),e)+(fd(e).getDay()===4),i,2)}function L4(e){return e.getDay()}function R4(e,i){return _a(Im.count(fd(e)-1,e),i,2)}function O4(e,i){return _a(e.getFullYear()%100,i,2)}function D4(e,i){return e=ux(e),_a(e.getFullYear()%100,i,2)}function F4(e,i){return _a(e.getFullYear()%1e4,i,4)}function B4(e,i){var r=e.getDay();return e=r>=4||r===0?hd(e):hd.ceil(e),_a(e.getFullYear()%1e4,i,4)}function z4(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+_a(i/60|0,"0",2)+_a(i%60,"0",2)}function lx(e,i){return _a(e.getUTCDate(),i,2)}function N4(e,i){return _a(e.getUTCHours(),i,2)}function Z4(e,i){return _a(e.getUTCHours()%12||12,i,2)}function U4(e,i){return _a(1+ex.count(sv(e),e),i,3)}function cx(e,i){return _a(e.getUTCMilliseconds(),i,3)}function V4(e,i){return cx(e,i)+"000"}function j4(e,i){return _a(e.getUTCMonth()+1,i,2)}function G4(e,i){return _a(e.getUTCMinutes(),i,2)}function H4(e,i){return _a(e.getUTCSeconds(),i,2)}function W4(e){var i=e.getUTCDay();return i===0?7:i}function $4(e,i){return _a(J1.count(sv(e)-1,e),i,2)}function fx(e){var i=e.getUTCDay();return i>=4||i===0?pd(e):pd.ceil(e)}function Y4(e,i){return e=fx(e),_a(pd.count(sv(e),e)+(sv(e).getUTCDay()===4),i,2)}function X4(e){return e.getUTCDay()}function q4(e,i){return _a(km.count(sv(e)-1,e),i,2)}function K4(e,i){return _a(e.getUTCFullYear()%100,i,2)}function J4(e,i){return e=fx(e),_a(e.getUTCFullYear()%100,i,2)}function Q4(e,i){return _a(e.getUTCFullYear()%1e4,i,4)}function eI(e,i){var r=e.getUTCDay();return e=r>=4||r===0?pd(e):pd.ceil(e),_a(e.getUTCFullYear()%1e4,i,4)}function tI(){return"+0000"}function hx(){return"%"}function px(e){return+e}function dx(e){return Math.floor(+e/1e3)}var dd,vx,rI,nI,iI;aI({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function aI(e){return dd=r4(e),vx=dd.format,rI=dd.parse,nI=dd.utcFormat,iI=dd.utcParse,dd}var fv=1e3,hv=fv*60,pv=hv*60,dv=pv*24,oI=dv*7,mx=dv*30,G0=dv*365;function sI(e){return new Date(e)}function uI(e){return e instanceof Date?+e:+new Date(+e)}function gx(e,i,r,n,t,o,u,l,p){var v=E1(xu,xu),x=v.invert,S=v.domain,A=p(".%L"),I=p(":%S"),F=p("%I:%M"),D=p("%I %p"),Z=p("%a %d"),Y=p("%b %d"),ve=p("%B"),me=p("%Y"),De=[[u,1,fv],[u,5,5*fv],[u,15,15*fv],[u,30,30*fv],[o,1,hv],[o,5,5*hv],[o,15,15*hv],[o,30,30*hv],[t,1,pv],[t,3,3*pv],[t,6,6*pv],[t,12,12*pv],[n,1,dv],[n,2,2*dv],[r,1,oI],[i,1,mx],[i,3,3*mx],[e,1,G0]];function Be(_t){return(u(_t)<_t?A:o(_t)<_t?I:t(_t)<_t?F:n(_t)<_t?D:i(_t)<_t?r(_t)<_t?Z:Y:e(_t)<_t?ve:me)(_t)}function Je(_t,Zt,$t,dr){if(_t==null&&(_t=10),typeof _t=="number"){var lr=Math.abs($t-Zt)/_t,Yr=u1(function(un){return un[2]}).right(De,lr);Yr===De.length?(dr=I0(Zt/G0,$t/G0,_t),_t=e):Yr?(Yr=De[lr/De[Yr-1][2]<De[Yr][2]/lr?Yr-1:Yr],dr=Yr[1],_t=Yr[0]):(dr=Math.max(I0(Zt,$t,_t),1),_t=l)}return dr==null?_t:_t.every(dr)}return v.invert=function(_t){return new Date(x(_t))},v.domain=function(_t){return arguments.length?S(g1.call(_t,uI)):S().map(sI)},v.ticks=function(_t,Zt){var $t=S(),dr=$t[0],lr=$t[$t.length-1],Yr=lr<dr,un;return Yr&&(un=dr,dr=lr,lr=un),un=Je(_t,dr,lr,Zt),un=un?un.range(dr,lr+1):[],Yr?un.reverse():un},v.tickFormat=function(_t,Zt){return Zt==null?Be:p(Zt)},v.nice=function(_t,Zt){var $t=S();return(_t=Je(_t,$t[0],$t[$t.length-1],Zt))?S(R1($t,_t)):v},v.copy=function(){return Em(v,gx(e,i,r,n,t,o,u,l,p))},v}function lI(){return Nh.apply(gx(fd,j5,N0,Z0,Y5,X5,q5,K5,vx).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function p6(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Lm(){var e=0,i=1,r,n,t,o,u=xu,l=!1,p;function v(x){return isNaN(x=+x)?p:u(t===0?.5:(x=(o(x)-r)*t,l?Math.max(0,Math.min(1,x)):x))}return v.domain=function(x){return arguments.length?(r=o(e=+x[0]),n=o(i=+x[1]),t=r===n?0:1/(n-r),v):[e,i]},v.clamp=function(x){return arguments.length?(l=!!x,v):l},v.interpolator=function(x){return arguments.length?(u=x,v):u},v.unknown=function(x){return arguments.length?(p=x,v):p},function(x){return o=x,r=x(e),n=x(i),t=r===n?0:1/(n-r),v}}function vv(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function yx(){var e=av(Lm()(xu));return e.copy=function(){return vv(e,yx())},y1.apply(e,arguments)}function cI(){var e=loggish(Lm()).domain([1,10]);return e.copy=function(){return vv(e,cI()).base(e.base())},initInterpolator.apply(e,arguments)}function fI(){var e=symlogish(Lm());return e.copy=function(){return vv(e,fI()).constant(e.constant())},initInterpolator.apply(e,arguments)}function _x(){var e=powish(Lm());return e.copy=function(){return vv(e,_x()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function d6(){return _x.apply(null,arguments).exponent(.5)}function hI(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var t=0,o=n.length,u;t<o;++t)u=n[t],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return hI(i).domain(e)},initInterpolator.apply(r,arguments)}function Rm(){var e=0,i=.5,r=1,n,t,o,u,l,p=xu,v,x=!1,S;function A(I){return isNaN(I=+I)?S:(I=.5+((I=+v(I))-t)*(I<t?u:l),p(x?Math.max(0,Math.min(1,I)):I))}return A.domain=function(I){return arguments.length?(n=v(e=+I[0]),t=v(i=+I[1]),o=v(r=+I[2]),u=n===t?0:.5/(t-n),l=t===o?0:.5/(o-t),A):[e,i,r]},A.clamp=function(I){return arguments.length?(x=!!I,A):x},A.interpolator=function(I){return arguments.length?(p=I,A):p},A.unknown=function(I){return arguments.length?(S=I,A):S},function(I){return v=I,n=I(e),t=I(i),o=I(r),u=n===t?0:.5/(t-n),l=t===o?0:.5/(o-t),A}}function xx(){var e=av(Rm()(xu));return e.copy=function(){return vv(e,xx())},y1.apply(e,arguments)}function pI(){var e=loggish(Rm()).domain([.1,1,10]);return e.copy=function(){return copy(e,pI()).base(e.base())},initInterpolator.apply(e,arguments)}function dI(){var e=symlogish(Rm());return e.copy=function(){return copy(e,dI()).constant(e.constant())},initInterpolator.apply(e,arguments)}function bx(){var e=powish(Rm());return e.copy=function(){return copy(e,bx()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function v6(){return bx.apply(null,arguments).exponent(.5)}function Sx(e){var i,r=[];function n(t){return t==null?i:t}return n.invert=n,n.domain=n.range=function(t){return t?(r=t,t):r},n.unknown=function(t){return t?(i=t,t):i},n.copy=function(){return Sx(e).unknown(i)},n}var Ll,Ex,Ax,H0=yi.isNil,vI=yi.isString,mI=yi.uniq,gI=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,yI=(Ll={},(0,P.Z)(Ll,Ua.LINEAR,L1),(0,P.Z)(Ll,Ua.POWER,D0),(0,P.Z)(Ll,Ua.LOG,B1),(0,P.Z)(Ll,Ua.IDENTITY,Sx),(0,P.Z)(Ll,Ua.SEQUENTIAL,yx),(0,P.Z)(Ll,Ua.TIME,lI),(0,P.Z)(Ll,Ua.QUANTILE,U1),(0,P.Z)(Ll,Ua.QUANTIZE,V1),(0,P.Z)(Ll,Ua.THRESHOLD,j1),(0,P.Z)(Ll,Ua.CAT,wm),(0,P.Z)(Ll,Ua.DIVERGING,xx),Ll),_I=(Ex=(0,at.b2)(),Ex(Ax=function(){function e(){(0,Mt.Z)(this,e),(0,P.Z)(this,"scaleOptions",{})}return(0,j.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("FeatureScalePlugin",(0,je.Z)(Q().mark(function u(){var l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(r.log(ts.ScaleInitStart,st.INIT),t.scaleOptions=r.getScaleOptions(),p=o.getLayerStyleAttributes(),v=(l=r.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(v)&&v.length===0)){S.next=8;break}return S.abrupt("return");case 8:t.caculateScalesForAttributes(p||[],v);case 9:r.log(ts.ScaleInitEnd,st.INIT);case 10:case"end":return S.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var u=(0,je.Z)(Q().mark(function l(p){var v,x;return Q().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(p){A.next=2;break}return A.abrupt("return",p);case 2:if(r.log(ts.ScaleInitStart,st.UPDATE),t.scaleOptions=r.getScaleOptions(),v=o.getLayerStyleAttributes(),x=r.getSource().data.dataArray,!(Array.isArray(x)&&x.length===0)){A.next=8;break}return A.abrupt("return",!0);case 8:return t.caculateScalesForAttributes(v||[],x),r.log(ts.ScaleInitEnd,st.UPDATE),r.layerModelNeedUpdate=!0,A.abrupt("return",!0);case 12:case"end":return A.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){t.scaleOptions=r.getScaleOptions();var u=o.getLayerStyleAttributes(),l=r.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&u){var p=u.filter(function(v){return v.needRescale});p.length&&t.caculateScalesForAttributes(p,l)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var t=this;r.forEach(function(o){if(o.scale){var u=o.scale,l=o.scale.field;u.names=t.parseFields(H0(l)?[]:l);var p=[];u.names.forEach(function(v){var x;p.push(t.createScale(v,o.name,(x=o.scale)===null||x===void 0?void 0:x.values,n))}),p.some(function(v){return v.type===nd.VARIABLE})?(u.type=nd.VARIABLE,p.forEach(function(v){if(!u.callback&&u.values!=="text"){var x;switch((x=v.option)===null||x===void 0?void 0:x.type){case Ua.LOG:case Ua.LINEAR:case Ua.POWER:if(u.values&&u.values.length>2){var S=v.scale.ticks(u.values.length);v.scale.domain(S)}u.values?v.scale.range(u.values):v.scale.range(v.option.domain);break;case Ua.QUANTILE:case Ua.QUANTIZE:case Ua.THRESHOLD:v.scale.range(u.values);break;case Ua.IDENTITY:break;case Ua.CAT:u.values?v.scale.range(u.values):v.scale.range(v.option.domain);break;case Ua.DIVERGING:case Ua.SEQUENTIAL:v.scale.interpolator(u5.hD(u.values));break}}if(u.values==="text"){var A;v.scale.range((A=v.option)===null||A===void 0?void 0:A.domain)}})):(u.type=nd.CONSTANT,u.defaultValues=p.map(function(v,x){return v.scale(u.names[x])})),u.scalers=p.map(function(v){return{field:v.field,func:v.scale,option:v.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:vI(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,t,o){var u,l,p=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===r?this.scaleOptions[n]:this.scaleOptions[r],v={field:r,scale:void 0,type:nd.VARIABLE,option:p};if(!o||!o.length)return p&&p.type?v.scale=this.createDefaultScale(p):(v.scale=wm([r]),v.type=nd.CONSTANT),v;var x=(l=o.find(function(I){return!H0(I[r])}))===null||l===void 0?void 0:l[r];if(this.isNumber(r)||H0(x)&&!p)v.scale=wm([r]),v.type=nd.CONSTANT;else{var S=p&&p.type||this.getDefaultType(x);t==="text"&&(S=Ua.CAT);var A=this.createScaleConfig(S,r,p,o);v.scale=this.createDefaultScale(A),v.option=A}return v}},{key:"getDefaultType",value:function(r){var n=Ua.LINEAR;return typeof r=="string"&&(n=gI.test(r)?Ua.TIME:Ua.CAT),n}},{key:"createScaleConfig",value:function(r,n,t,o){var u={type:r},l=(o==null?void 0:o.map(function(x){return x[n]}))||[];if(t!=null&&t.domain)u.domain=t==null?void 0:t.domain;else if(r===Ua.CAT||r===Ua.IDENTITY)u.domain=mI(l);else if(r===Ua.QUANTILE)u.domain=l;else if(r===Ua.DIVERGING){var p=c1(l),v=(t==null?void 0:t.neutral)!==void 0?t==null?void 0:t.neutral:(p[0]+p[1])/2;u.domain=[p[0],v,p[1]]}else u.domain=c1(l);return(0,H.Z)((0,H.Z)({},u),t)}},{key:"createDefaultScale",value:function(r){var n=r.type,t=r.domain,o=r.unknown,u=r.clamp,l=r.nice,p=yI[n]();return t&&p.domain&&p.domain(t),o&&p.unknown(o),u!==void 0&&p.clamp&&p.clamp(u),l!==void 0&&p.nice&&p.nice(l),p}}]),e}())||Ax),Cx,Tx,xI=(Cx=(0,at.b2)(),Cx(Tx=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=r.animateStatus;n&&r.models.forEach(function(t){t.addUniforms((0,H.Z)({},r.layerModel.getAnimateUniforms()))})})}}]),e}())||Tx),Mx,Ix,bI=(Mx=(0,at.b2)(),Mx(Ix=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=r.getLayerConfig(),t=n.maskLayers,o=n.enableMask;if(!r.tileLayer&&t&&t.length>0){var u;(u=r.masks).push.apply(u,(0,V.Z)(t)),r.updateLayerConfig({mask:o})}})}}]),e}())||Ix),SI=function(){function e(i){var r=i.rendererService,n=i.layerService,t=i.parent;(0,Mt.Z)(this,e),(0,P.Z)(this,"tileResource",new Map),(0,P.Z)(this,"layerTiles",[]),this.rendererService=r,this.layerService=n,this.parent=t}return(0,j.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(r){return this.layerTiles.some(function(n){return n.key===r})}},{key:"addTile",value:function(r){this.layerTiles.push(r)}},{key:"getTile",value:function(r){return this.layerTiles.find(function(n){return n.key===r})}},{key:"getVisibleTileBylngLat",value:function(r){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(r)})}},{key:"removeTile",value:function(r){var n=this.layerTiles.findIndex(function(o){return o.key===r}),t=this.layerTiles.splice(n,1);t[0]&&t[0].destroy()}},{key:"updateTileVisible",value:function(r){var n=this.getTile(r.key);n==null||n.updateVisible(r.isVisible)}},{key:"isParentLoaded",value:function(r){var n=r.parent;if(!n)return!0;var t=this.getTile(n==null?void 0:n.key);return!!(t!=null&&t.isLoaded)}},{key:"isChildrenLoaded",value:function(r){var n=this,t=r==null?void 0:r.children;return t.length===0?!0:t.some(function(o){var u=n.getTile(o==null?void 0:o.key);return(u==null?void 0:u.isLoaded)===!1})}},{key:"render",value:function(){var i=(0,je.Z)(Q().mark(function n(){var t=this,o,u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=this.getRenderLayers(),u=o.map(function(){var v=(0,je.Z)(Q().mark(function x(S){return Q().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,t.layerService.renderTileLayer(S);case 2:case"end":return I.stop()}},x)}));return function(x){return v.apply(this,arguments)}}()),p.next=4,Promise.all(u);case 4:case"end":return p.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"getRenderLayers",value:function(){var r=this.layerTiles.filter(function(t){return t.visible&&t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,V.Z)(t.getLayers()))}),n}},{key:"getLayers",value:function(){var r=this.layerTiles.filter(function(t){return t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,V.Z)(t.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(r){return r.destroy()}),this.tileResource.clear()}}]),e}(),wI=N(32676);function EI(e,i,r){r===void 0&&(r={});var n=pn(e),t=pn(i),o=wI.union(n.coordinates,t.coordinates);return o.length===0?null:o.length===1?gn(o[0],r.properties):Gn(o,r.properties)}var AI=EI,CI=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"getCombineFeature",value:function(r){var n=null,t=r[0];return r.map(function(o){var u=gn(o.coordinates);n===null?n=u:n=AI(n,u)}),t&&(n.properties=(0,H.Z)({},t)),n}}]),e}(),mv="select",gv="active",TI=function(){function e(i){var r=i.layerService,n=i.tileLayerService,t=i.parent;(0,Mt.Z)(this,e),(0,P.Z)(this,"tilePickID",new Map),this.layerService=r,this.tileLayerService=n,this.parent=t,this.tileSourceService=new CI}return(0,j.Z)(e,[{key:"pickRender",value:function(r){var n=this.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(n){var t=n.getMainLayer();t==null||t.layerPickService.pickRender(r)}}},{key:"pick",value:function(r,n){var t=this.parent.getContainer(),o=t.get(qe.IPickingService);if(r.type==="RasterLayer"){var u=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(u&&u.getMainLayer()!==void 0){var l=u.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),o.pickFromPickingFBO(r,n)}},{key:"selectFeature",value:function(r){var n=(0,Dn.Z)(r,3),t=n[0],o=n[1],u=n[2],l=this.color2PickId(t,o,u);this.tilePickID.set(mv,l),this.updateHighLight(t,o,u,mv)}},{key:"highlightPickedFeature",value:function(r){var n=(0,Dn.Z)(r,3),t=n[0],o=n[1],u=n[2],l=this.color2PickId(t,o,u);this.tilePickID.set(gv,l),this.updateHighLight(t,o,u,gv)}},{key:"updateHighLight",value:function(r,n,t,o){this.tileLayerService.tiles.map(function(u){var l=u.getMainLayer();switch(o){case mv:l==null||l.hooks.beforeSelect.call([r,n,t]);break;case gv:l==null||l.hooks.beforeHighlight.call([r,n,t]);break}})}},{key:"setPickState",value:function(){var r=this.tilePickID.get(mv),n=this.tilePickID.get(gv);if(r){var t=this.pickId2Color(r),o=(0,Dn.Z)(t,3),u=o[0],l=o[1],p=o[2];this.updateHighLight(u,l,p,mv);return}if(n){var v=this.pickId2Color(n),x=(0,Dn.Z)(v,3),S=x[0],A=x[1],I=x[2];this.updateHighLight(S,A,I,gv);return}}},{key:"color2PickId",value:function(r,n,t){return Mo(new Uint8Array([r,n,t]))}},{key:"pickId2Color",value:function(r){return Do(r)}},{key:"getFeatureById",value:function(r){var n=this.tileLayerService.getTiles().filter(function(o){return o.visible}),t=[];return n.forEach(function(o){t.push.apply(t,(0,V.Z)(o.getFeatureById(r)))}),t}},{key:"pickRasterLayer",value:function(r,n,t){return!1}}]),e}(),MI=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"];function II(e){return e==="PolygonLayer"?mm:e==="LineLayer"?w0:vm}function PI(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}var Ep=function(){function e(i,r){(0,Mt.Z)(this,e),(0,P.Z)(this,"visible",!0),(0,P.Z)(this,"layers",[]),(0,P.Z)(this,"isLoaded",!1),(0,P.Z)(this,"tileMaskLayers",[]),this.parent=r,this.sourceTile=i,this.x=i.x,this.y=i.y,this.z=i.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}return(0,j.Z)(e,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(r){var n=(0,Dn.Z)(this.sourceTile.bounds,4),t=n[0],o=n[1],u=n[2],l=n[3],p=r.lng,v=r.lat;return p>=t&&p<=u&&v>=o&&v<=l}},{key:"getLayerOptions",value:function(){var r,n=this.parent.getLayerConfig();return(0,H.Z)((0,H.Z)({},n),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:PI(this.parent.type),mask:n.mask||((r=n.maskLayers)===null||r===void 0?void 0:r.length)!==0&&n.enableMask})}},{key:"getMaskLayer",value:function(){var r=this,n=this.parent.getLayerConfig(),t=n.maskLayers,o=[];return t==null||t.forEach(function(u){if(!u.tileLayer)return o.push(u),u;var l=u.tileLayer,p=l.getTile(r.sourceTile.key),v=p==null?void 0:p.getLayers()[0];v&&o.push(v)}),o}},{key:"addTileMask",value:function(){var i=(0,je.Z)(Q().mark(function n(){var t,o,u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return t=new mm({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill"),o=ev(this.parent.sceneContainer),t.setContainer(o,this.parent.sceneContainer),p.next=5,t.init();case 5:return this.tileMask=t,u=this.getMainLayer(),u!==void 0&&(u.tileMask=t),p.abrupt("return",t);case 9:case"end":return p.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"addMask",value:function(){var i=(0,je.Z)(Q().mark(function n(t,o){var u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=ev(this.parent.sceneContainer),o.setContainer(u,this.parent.sceneContainer),p.next=4,o.init();case 4:t.addMask(o),this.tileMaskLayers.push(o);case 6:case"end":return p.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"addLayer",value:function(){var i=(0,je.Z)(Q().mark(function n(t){var o;return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t.isTileLayer=!0,o=ev(this.parent.sceneContainer),t.setContainer(o,this.parent.sceneContainer),this.layers.push(t),l.next=6,t.init();case 6:case"end":return l.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"updateVisible",value:function(r){this.visible=r,this.updateOptions("visible",r)}},{key:"updateOptions",value:function(r,n){this.layers.forEach(function(t){t.updateLayerConfig((0,P.Z)({},r,n))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(r){return[]}},{key:"getFeatureById",value:function(r){return[]}},{key:"destroy",value:function(){var r;(r=this.tileMask)===null||r===void 0||r.destroy(),this.layers.forEach(function(n){return n.destroy()})}}]),e}();function kI(e){var i=LI();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function LI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RI=function(e){(0,Xr.Z)(r,e);var i=kI(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.getSourceOption(),l=u.data.features[0].properties,p=new w0().source(u.data,u.options).size(1).shape("line").color("red"),v=new vm({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),S.next=6,this.addLayer(p);case 6:return S.next=8,this.addLayer(v);case 8:this.isLoaded=!0;case 9:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:o},options:{parser:{type:"geojson"},transforms:t.transforms}}}}]),r}(Ep);function OI(e){var i=DI();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function DI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FI=function(e){(0,Xr.Z)(r,e);var i=OI(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new I_((0,H.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var I,F,D=A;v[D]((I=u[D])===null||I===void 0?void 0:I.field,(F=u[D])===null||F===void 0?void 0:F.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(Ep);function BI(e){var i=zI();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function zI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NI=function(e){(0,Xr.Z)(r,e);var i=BI(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new Q_((0,H.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var I,F,D=A;v[D]((I=u[D])===null||I===void 0?void 0:I.field,(F=u[D])===null||F===void 0?void 0:F.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getFeatures",value:function(t){if(!t)return[];var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=o.featureId,p=this.getFeatures(u);return{data:{type:"FeatureCollection",features:p},options:{parser:{type:"geojson",featureId:l},transforms:t.transforms}}}}]),r}(Ep),ZI=["rasterData"];function UI(e){var i=VI();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function VI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jI=function(e){(0,Xr.Z)(r,e);var i=UI(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new gm((0,H.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var I,F,D=A;v[D]((I=u[D])===null||I===void 0?void 0:I.field,(F=u[D])===null||F===void 0?void 0:F.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,ol.Z)(o,ZI);return{data:u,options:{parser:(0,H.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:t.transforms}}}}]),r}(Ep);function GI(e){var i=HI();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function HI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WI=function(e){(0,Xr.Z)(r,e);var i=GI(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v;return Q().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new gm((0,H.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var I,F,D=A;v[D]((I=u[D])===null||I===void 0?void 0:I.field,(F=u[D])===null||F===void 0?void 0:F.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(Ep),$I=["rasterData"];function YI(e){var i=XI();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function XI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qI={positions:[0,1],colors:["#000","#fff"]},KI=function(e){(0,Xr.Z)(r,e);var i=YI(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x,S,A;return Q().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=this.getLayerOptions(),x=v.rampColors,S=v.domain,this.colorTexture=this.parent.textureService.getColorTexture(x,S),A=new gm((0,H.Z)((0,H.Z)({},l),{},{colorTexture:this.colorTexture})).source(p.data,p.options),u&&Object.keys(u).forEach(function(D){var Z,Y,ve=D;A[ve]((Z=u[ve])===null||Z===void 0?void 0:Z.field,(Y=u[ve])===null||Y===void 0?void 0:Y.values)}),F.next=9,this.addLayer(A);case 9:this.isLoaded=!0;case 10:case"end":return F.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,ol.Z)(o,$I);return{data:u,options:{parser:(0,H.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:t.transforms}}}},{key:"styleUpdate",value:function(){for(var t=this,o=arguments.length,u=new Array(o),l=0;l<o;l++)u[l]=arguments[l];var p=u,v=p.rampColors,x=v===void 0?qI:v,S=p.domain;this.colorTexture=this.parent.textureService.getColorTexture(x,S||Tf(x)),this.layers.forEach(function(A){return A.style({colorTexture:t.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(t){return t.destroy()})}}]),r}(Ep);function JI(e){var i=QI();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function QI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Om=function(e){(0,Xr.Z)(r,e);var i=JI(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u,l,p,v,x;return Q().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=II(this.parent.type),v=this.getSourceOption(),v){A.next=7;break}return this.isLoaded=!0,A.abrupt("return");case 7:return x=new p((0,H.Z)({},l)).source(v.data,v.options),Object.keys(u).forEach(function(I){var F,D,Z=I;x[Z]((F=u[Z])===null||F===void 0?void 0:F.field,(D=u[Z])===null||D===void 0?void 0:D.values)}),A.next=11,this.addLayer(x);case 11:if(!l.tileMask){A.next=14;break}return A.next=14,this.addTileMask();case 14:this.setLayerMinMaxZoom(x),this.isLoaded=!0;case 16:case"end":return A.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=u===void 0?"defaultLayer":u,p=o.featureId,v=p===void 0?"id":p,x=this.getFeatures(l);return{data:{type:"FeatureCollection",features:x},options:{parser:{type:"geojson",featureId:v},transforms:t.transforms}}}},{key:"setLayerMinMaxZoom",value:function(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(t){var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getFeatureById",value:function(t){var o=this.getMainLayer();if(!o)return[];var u=o.getSource().data.dataArray.filter(function(l){return l._id===t});return u}}]),r}(Ep);function eP(e){var i=e.type;switch(i){case"PolygonLayer":return Om;case"LineLayer":return Om;case"PointLayer":return Om;case"TileDebugLayer":return RI;case"MaskLayer":return NI;case"RasterLayer":var r=e.getSource().parser.dataType;switch(r){case tu.RGB:case tu.CUSTOMRGB:return jI;case tu.ARRAYBUFFER:case tu.CUSTOMARRAYBUFFER:return KI;case tu.TERRAINRGB:case tu.CUSTOMTERRAINRGB:return WI;default:return FI}default:return Om}}var tP=yi.debounce,Px=function(){function e(i){var r=this;(0,Mt.Z)(this,e),(0,P.Z)(this,"initedTileset",!1),(0,P.Z)(this,"mapchange",function(){var t;if(r.parent.isVisible()!==!1){var o=r.getCurrentView(),u=o.latLonBounds,l=o.zoom;if(r.mapService.version==="GAODE1.x"){var p=r.parent.getLayerConfig(),v=p.visible;l<2&&v?(r.parent.updateLayerConfig({visible:!1}),r.layerService.reRender()):l>=2&&!v&&(r.parent.updateLayerConfig({visible:!0}),r.layerService.reRender())}r.lastViewStates&&r.lastViewStates.zoom===l&&r.lastViewStates.latLonBounds.toString()===u.toString()||(r.lastViewStates={zoom:l,latLonBounds:u},(t=r.tilesetManager)===null||t===void 0||t.throttleUpdate(l,u))}}),(0,P.Z)(this,"viewchange",tP(this.mapchange,24)),this.parent=i;var n=this.parent.getContainer();this.rendererService=n.get(qe.IRendererService),this.layerService=n.get(qe.ILayerService),this.mapService=n.get(qe.IMapService),this.pickingService=n.get(qe.IPickingService),this.tileLayerService=new SI({rendererService:this.rendererService,layerService:this.layerService,parent:i}),this.tilePickService=new TI({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:i}),this.parent.setLayerPickService(this.tilePickService),this.proxy(i),this.initTileSetManager()}return(0,j.Z)(e,[{key:"initTileSetManager",value:function(){var r,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var t=this.getCurrentView(),o=t.latLonBounds,u=t.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(u,o)}}},{key:"getCurrentView",value:function(){var r=this.mapService.getBounds(),n=[r[0][0],r[0][1],r[1][0],r[1][1]],t=this.mapService.getZoom();return{latLonBounds:n,zoom:t}}},{key:"bindTilesetEvent",value:function(){var r=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){r.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,t){r.tileError(n)}),this.tilesetManager.on("tile-update",function(){r.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(r){return this.tileLayerService.getTile(r)}},{key:"tileLoaded",value:function(r){}},{key:"tileError",value:function(r){console.warn("error:",r)}},{key:"destroy",value:function(){var r;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(r=this.tilesetManager)===null||r===void 0||r.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var r;this.tilesetManager.clear();var n=this.getCurrentView(),t=n.latLonBounds,o=n.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(o,t)}},{key:"tileUnLoad",value:function(r){this.tileLayerService.removeTile(r.key)}},{key:"tileUpdate",value:function(){var i=(0,je.Z)(Q().mark(function n(){var t=this,o,u;return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.tilesetManager){p.next=2;break}return p.abrupt("return");case 2:return o=this.parent.getMinZoom(),u=this.parent.getMaxZoom(),p.next=6,Promise.all(this.tilesetManager.tiles.filter(function(v){return v.isLoaded}).filter(function(v){return v.isVisibleChange}).filter(function(v){return v.data}).filter(function(v){return v.z>=o&&v.z<u}).map(function(){var v=(0,je.Z)(Q().mark(function x(S){var A,I;return Q().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(t.tileLayerService.hasTile(S.key)){D.next=9;break}return A=eP(t.parent),I=new A(S,t.parent),D.next=5,I.initTileLayer();case 5:t.tilePickService.setPickState(),I.getLayers().length!==0&&(t.tileLayerService.addTile(I),t.tileLayerService.updateTileVisible(S),t.layerService.reRender()),D.next=12;break;case 9:t.tileLayerService.updateTileVisible(S),t.tilePickService.setPickState(),t.layerService.reRender();case 12:case"end":return D.stop()}},x)}));return function(x){return v.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return p.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"setPickState",value:function(r){}},{key:"pickRender",value:function(r){this.tilePickService.pickRender(r)}},{key:"selectFeature",value:function(r){this.tilePickService.selectFeature(r)}},{key:"highlightPickedFeature",value:function(r){this.tilePickService.highlightPickedFeature(r)}},{key:"proxy",value:function(r){var n=this;MI.forEach(function(t){var o=r[t].bind(r);r[t]=function(){for(var u=arguments.length,l=new Array(u),p=0;p<u;p++)l[p]=arguments[p];return o.apply(void 0,l),n.getLayers().map(function(v){v[t].apply(v,l)}),t==="style"&&n.getTiles().forEach(function(v){return v.styleUpdate.apply(v,l)}),r}})}}]),e}(),kx,Lx,rP=(kx=(0,at.b2)(),kx(Lx=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"build",value:function(){var i=(0,je.Z)(Q().mark(function n(t){return Q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return t.prepareBuildModel(),u.next=3,t.buildModels();case 3:case"end":return u.stop()}},n)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"initLayerModel",value:function(){var i=(0,je.Z)(Q().mark(function n(t){return Q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"prepareLayerModel",value:function(){var i=(0,je.Z)(Q().mark(function n(t){return Q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"apply",value:function(r){var n=this;r.hooks.init.tapPromise("LayerModelPlugin",(0,je.Z)(Q().mark(function t(){return Q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!r.getSource().isTile){u.next=4;break}return r.prepareBuildModel(),r.tileLayer=new Px(r),u.abrupt("return");case 4:return r.log(ts.BuildModelStart,st.INIT),u.next=7,n.initLayerModel(r);case 7:r.log(ts.BuildModelEnd,st.INIT);case 8:case"end":return u.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var t=(0,je.Z)(Q().mark(function o(u){return Q().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(u){p.next=2;break}return p.abrupt("return",!1);case 2:if(!r.getSource().isTile){p.next=5;break}return r.tileLayer=new Px(r),p.abrupt("return",!1);case 5:return r.log(ts.BuildModelStart,st.UPDATE),p.next=8,n.prepareLayerModel(r);case 8:return r.log(ts.BuildModelEnd,st.UPDATE),p.abrupt("return",!0);case 10:case"end":return p.stop()}},o)}));return function(o){return t.apply(this,arguments)}}())}}]),e}())||Lx),Rx,Ox,nP=(Rx=(0,at.b2)(),Rx(Ox=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){var n=r.getLayerConfig(),t=n.autoFit,o=n.fitBoundsOptions;t&&r.fitBounds(o),r.styleNeedUpdate=!1})}}]),e}())||Ox),Dx,Fx,iP=["type"],Bx={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},aP={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},oP={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},sP={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function uP(e){var i={u_DirectionalLights:new Array(3).fill((0,H.Z)({},oP)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,H.Z)({},sP)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[aP]),e.forEach(function(r){var n=r.type,t=n===void 0?"directional":n,o=(0,ol.Z)(r,iP),u=Bx[t].lights,l=Bx[t].num,p=i[l];i[u][p]=(0,H.Z)((0,H.Z)({},i[u][p]),o),i[l]++}),i}var lP=(Dx=(0,at.b2)(),Dx(Fx=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),t=n.enableLighting;t&&r.models.forEach(function(o){return o.addUniforms((0,H.Z)({},uP()))})})}}]),e}())||Fx),zx,Nx,cP=(zx=(0,at.b2)(),zx(Nx=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.rendererService,u=n.postProcessingPassFactory,l=n.normalPassFactory;r.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var p=r.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,S=x===void 0?[]:x;t.enabled=!!v&&r.getLayerConfig().enableMultiPassRenderer!==!1,t.enabled&&(r.multiPassRenderer=n_(r,S,u,l),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(t.enabled){var p=o.getViewportSize(),v=p.width,x=p.height;r.multiPassRenderer.resize(v,x)}})}}]),e}())||Nx),Zx,Ux,Dm={NONE:0,ENCODE:1,HIGHLIGHT:2},fP=(Zx=(0,at.b2)(),Zx(Ux=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(r,n){var t=n.styleAttributeService;r.hooks.init.tapPromise("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;t.registerStyleAttribute({name:"pickingColor",type:hn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:q.FLOAT},size:3,update:function(p){var v=p.id;return u?Do(v):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(l){return l.addUniforms({u_PickingStage:Dm.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(l){return l.addUniforms({u_PickingStage:Dm.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),l=u.highlightColor,p=u.activeMix,v=p===void 0?0:p,x=typeof l=="string"?gi(l):l||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Mo(new Uint8Array(o))}),r.models.forEach(function(S){return S.addUniforms({u_PickingStage:Dm.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(A){return A*255}),u_activeMix:v})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),l=u.selectColor,p=u.selectMix,v=p===void 0?0:p,x=typeof l=="string"?gi(l):l||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Mo(new Uint8Array(o))}),r.models.forEach(function(S){return S.addUniforms({u_PickingStage:Dm.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(A){return A*255}),u_activeMix:v,u_CurrentSelectedId:o,u_SelectColor:x.map(function(A){return A*255}),u_EnableSelect:1})})})}}]),e}())||Ux),hP=["mvt","geojsonvt","testTile"];function pP(e){var i=e.getSource();return hP.includes(i.parser.type)}function m6(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var Vx,jx,dP=(Vx=(0,at.b2)(),Vx(jx=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){pP(r)||t.registerBuiltinAttributes(o,r)})}},{key:"registerBuiltinAttributes",value:function(r,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(r);return}this.registerPositionAttribute(r),this.registerColorAttribute(r),this.registerVertexIdAttribute(r)}},{key:"registerPositionAttribute",value:function(r){r.registerStyleAttribute({name:"position",type:hn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:q.FLOAT},size:3,update:function(t,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}})}},{key:"registerFilterAttribute",value:function(r){r.registerStyleAttribute({name:"filter",type:hn.Attribute,descriptor:{name:"filter",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(t){var o=t.filter;return o?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(r){r.registerStyleAttribute({name:"color",type:hn.Attribute,descriptor:{name:"a_Color",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(t){var o=t.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(r){r.registerStyleAttribute({name:"vertexId",type:hn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(t,o){return[o]}}})}}]),e}())||jx),Gx,Hx,Wx,$x,Yx,Xx,vd,qx,Kx,Jx,Qx,vP=(Gx=(0,at.b2)(),Hx=(0,at.f3)(qe.ICameraService),Wx=(0,at.f3)(qe.ICoordinateSystemService),$x=(0,at.f3)(qe.IRendererService),Yx=(0,at.f3)(qe.IMapService),Gx(Xx=(vd=function(){function e(){(0,Mt.Z)(this,e),Or(this,"cameraService",qx,this),Or(this,"coordinateSystemService",Kx,this),Or(this,"rendererService",Jx,this),Or(this,"mapService",Qx,this)}return(0,j.Z)(e,[{key:"apply",value:function(r){var n=this,t=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var l=r.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(l),t==="GAODE2.x"&&(n.setLayerCenter(r),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter());var p=n.rendererService.getViewportSize(),v=p.width,x=p.height;r.models.forEach(function(S){var A;S.addUniforms((A={},(0,P.Z)(A,_p.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,P.Z)(A,_p.ViewMatrix,n.cameraService.getViewMatrix()),(0,P.Z)(A,_p.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,P.Z)(A,_p.Zoom,n.cameraService.getZoom()),(0,P.Z)(A,_p.ZoomScale,n.cameraService.getZoomScale()),(0,P.Z)(A,_p.FocalDistance,n.cameraService.getFocalDistance()),(0,P.Z)(A,_p.CameraPosition,n.cameraService.getCameraPosition()),(0,P.Z)(A,Qs.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,P.Z)(A,Qs.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,P.Z)(A,Qs.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,P.Z)(A,Qs.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,P.Z)(A,Qs.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,P.Z)(A,Qs.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,P.Z)(A,Qs.Mvp,o),(0,P.Z)(A,"u_sceneCenterMercator",u),(0,P.Z)(A,"u_ViewportSize",[v,x]),(0,P.Z)(A,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,P.Z)(A,"u_DevicePixelRatio",window.devicePixelRatio),(0,P.Z)(A,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,P.Z)(A,"u_shaderPick",Number(r.getShaderPickStat())),A))})})}},{key:"setLayerCenter",value:function(r){r.coordCenter===void 0&&(r.coordCenter=r.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(r.coordCenter)}}]),e}(),qx=cr(vd.prototype,"cameraService",[Hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kx=cr(vd.prototype,"coordinateSystemService",[Wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jx=cr(vd.prototype,"rendererService",[$x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qx=cr(vd.prototype,"mapService",[Yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vd))||Xx),eb,tb,mP=(eb=(0,at.b2)(),eb(tb=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate().then(function(n){n&&r.renderLayers()})}),r.hooks.afterRender.tap("UpdateModelPlugin",function(){r.layerModelNeedUpdate=!1})}}]),e}())||tb),rb,nb,gP=(rb=(0,at.b2)(),rb(nb=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){t.initStyleAttribute(r,{styleAttributeService:o})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||r.inited&&t.updateStyleAttribute(r,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[],u=t.getLayerStyleAttribute("filter");if(u&&u.needRegenerateVertices){r.layerModelNeedUpdate=!0,o.forEach(function(l){return l.needRegenerateVertices=!1});return}o.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){t.updateAttributeByFeatureRange(l.name,r.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,r),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){t.updateAttributeByFeatureRange(u.name,r.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||nb);sl.bind(qe.ILayerPlugin).to(n5).inRequestScope(),sl.bind(qe.ILayerPlugin).to(dP).inRequestScope(),sl.bind(qe.ILayerPlugin).to(_I).inRequestScope(),sl.bind(qe.ILayerPlugin).to(r5).inRequestScope(),sl.bind(qe.ILayerPlugin).to(nP).inRequestScope(),sl.bind(qe.ILayerPlugin).to(bI).inRequestScope(),sl.bind(qe.ILayerPlugin).to(gP).inRequestScope(),sl.bind(qe.ILayerPlugin).to(mP).inRequestScope(),sl.bind(qe.ILayerPlugin).to(cP).inRequestScope(),sl.bind(qe.ILayerPlugin).to(vP).inRequestScope(),sl.bind(qe.ILayerPlugin).to(xI).inRequestScope(),sl.bind(qe.ILayerPlugin).to(lP).inRequestScope(),sl.bind(qe.ILayerPlugin).to(fP).inRequestScope(),sl.bind(qe.ILayerPlugin).to(rP).inRequestScope();var yP=N(81550),_P=N.n(yP),xP=function(){function e(i,r){(0,Mt.Z)(this,e);var n=r.buffer,t=r.offset,o=r.stride,u=r.normalized,l=r.size,p=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:t||0,stride:o||0,normalized:u||!1,divisor:p||0},l&&(this.attribute.size=l)}return(0,j.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),nh,yv,ih,fc,_v,Zh,xv,Fm,_f,Ap,nu,xf,bf,Bm,bP=(nh={},(0,P.Z)(nh,q.POINTS,"points"),(0,P.Z)(nh,q.LINES,"lines"),(0,P.Z)(nh,q.LINE_LOOP,"line loop"),(0,P.Z)(nh,q.LINE_STRIP,"line strip"),(0,P.Z)(nh,q.TRIANGLES,"triangles"),(0,P.Z)(nh,q.TRIANGLE_FAN,"triangle fan"),(0,P.Z)(nh,q.TRIANGLE_STRIP,"triangle strip"),nh),ib=(yv={},(0,P.Z)(yv,q.STATIC_DRAW,"static"),(0,P.Z)(yv,q.DYNAMIC_DRAW,"dynamic"),(0,P.Z)(yv,q.STREAM_DRAW,"stream"),yv),W0=(ih={},(0,P.Z)(ih,q.BYTE,"int8"),(0,P.Z)(ih,q.UNSIGNED_INT,"int16"),(0,P.Z)(ih,q.INT,"int32"),(0,P.Z)(ih,q.UNSIGNED_BYTE,"uint8"),(0,P.Z)(ih,q.UNSIGNED_SHORT,"uint16"),(0,P.Z)(ih,q.UNSIGNED_INT,"uint32"),(0,P.Z)(ih,q.FLOAT,"float"),ih),SP=(fc={},(0,P.Z)(fc,q.ALPHA,"alpha"),(0,P.Z)(fc,q.LUMINANCE,"luminance"),(0,P.Z)(fc,q.LUMINANCE_ALPHA,"luminance alpha"),(0,P.Z)(fc,q.RGB,"rgb"),(0,P.Z)(fc,q.RGBA,"rgba"),(0,P.Z)(fc,q.RGBA4,"rgba4"),(0,P.Z)(fc,q.RGB5_A1,"rgb5 a1"),(0,P.Z)(fc,q.RGB565,"rgb565"),(0,P.Z)(fc,q.DEPTH_COMPONENT,"depth"),(0,P.Z)(fc,q.DEPTH_STENCIL,"depth stencil"),fc),wP=(_v={},(0,P.Z)(_v,q.DONT_CARE,"dont care"),(0,P.Z)(_v,q.NICEST,"nice"),(0,P.Z)(_v,q.FASTEST,"fast"),_v),ab=(Zh={},(0,P.Z)(Zh,q.NEAREST,"nearest"),(0,P.Z)(Zh,q.LINEAR,"linear"),(0,P.Z)(Zh,q.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,P.Z)(Zh,q.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,P.Z)(Zh,q.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,P.Z)(Zh,q.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Zh),ob=(xv={},(0,P.Z)(xv,q.REPEAT,"repeat"),(0,P.Z)(xv,q.CLAMP_TO_EDGE,"clamp"),(0,P.Z)(xv,q.MIRRORED_REPEAT,"mirror"),xv),EP=(Fm={},(0,P.Z)(Fm,q.NONE,"none"),(0,P.Z)(Fm,q.BROWSER_DEFAULT_WEBGL,"browser"),Fm),AP=(_f={},(0,P.Z)(_f,q.NEVER,"never"),(0,P.Z)(_f,q.ALWAYS,"always"),(0,P.Z)(_f,q.LESS,"less"),(0,P.Z)(_f,q.LEQUAL,"lequal"),(0,P.Z)(_f,q.GREATER,"greater"),(0,P.Z)(_f,q.GEQUAL,"gequal"),(0,P.Z)(_f,q.EQUAL,"equal"),(0,P.Z)(_f,q.NOTEQUAL,"notequal"),_f),sb=(Ap={},(0,P.Z)(Ap,q.FUNC_ADD,"add"),(0,P.Z)(Ap,q.MIN_EXT,"min"),(0,P.Z)(Ap,q.MAX_EXT,"max"),(0,P.Z)(Ap,q.FUNC_SUBTRACT,"subtract"),(0,P.Z)(Ap,q.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ap),zm=(nu={},(0,P.Z)(nu,q.ZERO,"zero"),(0,P.Z)(nu,q.ONE,"one"),(0,P.Z)(nu,q.SRC_COLOR,"src color"),(0,P.Z)(nu,q.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,P.Z)(nu,q.SRC_ALPHA,"src alpha"),(0,P.Z)(nu,q.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,P.Z)(nu,q.DST_COLOR,"dst color"),(0,P.Z)(nu,q.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,P.Z)(nu,q.DST_ALPHA,"dst alpha"),(0,P.Z)(nu,q.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,P.Z)(nu,q.CONSTANT_COLOR,"constant color"),(0,P.Z)(nu,q.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,P.Z)(nu,q.CONSTANT_ALPHA,"constant alpha"),(0,P.Z)(nu,q.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,P.Z)(nu,q.SRC_ALPHA_SATURATE,"src alpha saturate"),nu),CP=(xf={},(0,P.Z)(xf,q.NEVER,"never"),(0,P.Z)(xf,q.ALWAYS,"always"),(0,P.Z)(xf,q.LESS,"less"),(0,P.Z)(xf,q.LEQUAL,"lequal"),(0,P.Z)(xf,q.GREATER,"greater"),(0,P.Z)(xf,q.GEQUAL,"gequal"),(0,P.Z)(xf,q.EQUAL,"equal"),(0,P.Z)(xf,q.NOTEQUAL,"notequal"),xf),md=(bf={},(0,P.Z)(bf,q.ZERO,"zero"),(0,P.Z)(bf,q.KEEP,"keep"),(0,P.Z)(bf,q.REPLACE,"replace"),(0,P.Z)(bf,q.INVERT,"invert"),(0,P.Z)(bf,q.INCR,"increment"),(0,P.Z)(bf,q.DECR,"decrement"),(0,P.Z)(bf,q.INCR_WRAP,"increment wrap"),(0,P.Z)(bf,q.DECR_WRAP,"decrement wrap"),bf),TP=(Bm={},(0,P.Z)(Bm,q.FRONT,"front"),(0,P.Z)(Bm,q.BACK,"back"),Bm),MP=function(){function e(i,r){(0,Mt.Z)(this,e),(0,P.Z)(this,"isDestroyed",!1);var n=r.data,t=r.usage,o=r.type;this.buffer=i.buffer({data:n,usage:ib[t||q.STATIC_DRAW],type:W0[o||q.UNSIGNED_BYTE]})}return(0,j.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(r){var n=r.data,t=r.offset;this.buffer.subdata(n,t)}}]),e}(),IP=function(){function e(i,r){(0,Mt.Z)(this,e);var n=r.data,t=r.usage,o=r.type,u=r.count;this.elements=i.elements({data:n,usage:ib[t||q.STATIC_DRAW],type:W0[o||q.UNSIGNED_BYTE],count:u})}return(0,j.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),PP=function(){function e(i,r){(0,Mt.Z)(this,e);var n=r.width,t=r.height,o=r.color,u=r.colors,l={width:n,height:t};Array.isArray(u)&&(l.colors=u.map(function(p){return p.get()})),o&&typeof o!="boolean"&&(l.color=o.get()),this.framebuffer=i.framebuffer(l)}return(0,j.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.framebuffer.resize(n,t)}}]),e}(),kP=yi.isPlainObject,LP=yi.isTypedArray,RP=function(){function e(i,r){(0,Mt.Z)(this,e),(0,P.Z)(this,"destroyed",!1),(0,P.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,t=r.fs,o=r.attributes,u=r.uniforms,l=r.primitive,p=r.count,v=r.elements,x=r.depth,S=r.cull,A=r.instances,I={};this.options=r,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(function(Z){I[Z]=i.prop(Z)}));var F={};Object.keys(o).forEach(function(Z){F[Z]=o[Z].get()});var D={attributes:F,frag:t,uniforms:I,vert:n,colorMask:i.prop("colorMask"),lineWidth:1,blend:{enable:i.prop("blend.enable"),func:i.prop("blend.func"),equation:i.prop("blend.equation"),color:i.prop("blend.color")},stencil:{enable:i.prop("stencil.enable"),mask:i.prop("stencil.mask"),func:i.prop("stencil.func"),opFront:i.prop("stencil.opFront"),opBack:i.prop("stencil.opBack")},primitive:bP[l===void 0?q.TRIANGLES:l]};A&&(D.instances=A),p?D.count=p:v&&(D.elements=v.get()),this.initDepthDrawParams({depth:x},D),this.initCullDrawParams({cull:S},D),this.drawCommand=i(D),this.drawParams=D}return(0,j.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var t={};Object.keys(r).forEach(function(o){t[o]=r[o].get()}),this.drawParams.attributes=t,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(t){n[t]=r[t].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(r){this.uniforms=(0,H.Z)((0,H.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var t=(0,H.Z)((0,H.Z)({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(t).forEach(function(u){var l=(0,mr.Z)(t[u]);l==="boolean"||l==="number"||Array.isArray(t[u])||t[u].BYTES_PER_ELEMENT?o[u]=t[u]:o[u]=t[u].get()}),o.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(r),o.stencil=this.getStencilDrawParams(r),o.colorMask=this.getColorMaskDrawParams(r,n),this.drawCommand(o)}}},{key:"destroy",value:function(){var r,n;(r=this.drawParams)===null||r===void 0||(n=r.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t==null||t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var t=r.depth;t&&(n.depth={enable:t.enable===void 0?!0:!!t.enable,mask:t.mask===void 0?!0:!!t.mask,func:AP[t.func||q.LESS],range:t.range||[0,1]})}},{key:"getBlendDrawParams",value:function(r){var n=r.blend,t=n||{},o=t.enable,u=t.func,l=t.equation,p=t.color,v=p===void 0?[0,0,0,0]:p;return{enable:!!o,func:{srcRGB:zm[u&&u.srcRGB||q.SRC_ALPHA],srcAlpha:zm[u&&u.srcAlpha||q.SRC_ALPHA],dstRGB:zm[u&&u.dstRGB||q.ONE_MINUS_SRC_ALPHA],dstAlpha:zm[u&&u.dstAlpha||q.ONE_MINUS_SRC_ALPHA]},equation:{rgb:sb[l&&l.rgb||q.FUNC_ADD],alpha:sb[l&&l.alpha||q.FUNC_ADD]},color:v}}},{key:"getStencilDrawParams",value:function(r){var n=r.stencil,t=n||{},o=t.enable,u=t.mask,l=u===void 0?-1:u,p=t.func,v=p===void 0?{cmp:q.ALWAYS,ref:0,mask:-1}:p,x=t.opFront,S=x===void 0?{fail:q.KEEP,zfail:q.KEEP,zpass:q.KEEP}:x,A=t.opBack,I=A===void 0?{fail:q.KEEP,zfail:q.KEEP,zpass:q.KEEP}:A;return{enable:!!o,mask:l,func:(0,H.Z)((0,H.Z)({},v),{},{cmp:CP[v.cmp]}),opFront:{fail:md[S.fail],zfail:md[S.zfail],zpass:md[S.zpass]},opBack:{fail:md[I.fail],zfail:md[I.zfail],zpass:md[I.zpass]}}}},{key:"getColorMaskDrawParams",value:function(r,n){var t=r.stencil,o=t!=null&&t.enable&&t.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return o}},{key:"initCullDrawParams",value:function(r,n){var t=r.cull;if(t){var o=t.enable,u=t.face,l=u===void 0?q.BACK:u;n.cull={enable:!!o,face:TP[l]}}}},{key:"extractUniforms",value:function(r){var n=this,t={};return Object.keys(r).forEach(function(o){n.extractUniformsRecursively(o,r[o],t,"")}),t}},{key:"extractUniformsRecursively",value:function(r,n,t,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||LP(n)||n===""||"resize"in n){t["".concat(o&&o+".").concat(r)]=n;return}kP(n)&&Object.keys(n).forEach(function(l){u.extractUniformsRecursively(l,n[l],t,"".concat(o&&o+".").concat(r))}),Array.isArray(n)&&n.forEach(function(l,p){Object.keys(l).forEach(function(v){u.extractUniformsRecursively(v,l[v],t,"".concat(o&&o+".").concat(r,"[").concat(p,"]"))})})}}]),e}(),OP=function(){function e(i,r){(0,Mt.Z)(this,e),(0,P.Z)(this,"isDestroy",!1);var n=r.data,t=r.type,o=t===void 0?q.UNSIGNED_BYTE:t,u=r.width,l=r.height,p=r.flipY,v=p===void 0?!1:p,x=r.format,S=x===void 0?q.RGBA:x,A=r.mipmap,I=A===void 0?!1:A,F=r.wrapS,D=F===void 0?q.CLAMP_TO_EDGE:F,Z=r.wrapT,Y=Z===void 0?q.CLAMP_TO_EDGE:Z,ve=r.aniso,me=ve===void 0?0:ve,De=r.alignment,Be=De===void 0?1:De,Je=r.premultiplyAlpha,_t=Je===void 0?!1:Je,Zt=r.mag,$t=Zt===void 0?q.NEAREST:Zt,dr=r.min,lr=dr===void 0?q.NEAREST:dr,Yr=r.colorSpace,un=Yr===void 0?q.BROWSER_DEFAULT_WEBGL:Yr,In=r.x,Gi=In===void 0?0:In,Ra=r.y,Va=Ra===void 0?0:Ra,ao=r.copy,Ko=ao===void 0?!1:ao;this.width=u,this.height=l;var oh={width:u,height:l,type:W0[o],format:SP[S],wrapS:ob[D],wrapT:ob[Y],mag:ab[$t],min:ab[lr],alignment:Be,flipY:v,colorSpace:EP[un],premultiplyAlpha:_t,aniso:me,x:Gi,y:Va,copy:Ko};n&&(oh.data=n),typeof I=="number"?oh.mipmap=wP[I]:typeof I=="boolean"&&(oh.mipmap=I),this.texture=i.texture(oh)}return(0,j.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.texture.resize(n,t),this.width=n,this.height=t}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDestroy=!0}}]),e}(),ub,lb,DP=(ub=(0,at.b2)(),ub(lb=function(){function e(){var i=this;(0,Mt.Z)(this,e),(0,P.Z)(this,"createModel",function(r){return new RP(i.gl,r)}),(0,P.Z)(this,"createAttribute",function(r){return new xP(i.gl,r)}),(0,P.Z)(this,"createBuffer",function(r){return new MP(i.gl,r)}),(0,P.Z)(this,"createElements",function(r){return new IP(i.gl,r)}),(0,P.Z)(this,"createTexture2D",function(r){return new OP(i.gl,r)}),(0,P.Z)(this,"createFramebuffer",function(r){return new PP(i.gl,r)}),(0,P.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,P.Z)(this,"clear",function(r){var n,t=r.color,o=r.depth,u=r.stencil,l=r.framebuffer,p=l===void 0?null:l,v={color:t,depth:o,stencil:u};v.framebuffer=p===null?p:p.get(),(n=i.gl)===null||n===void 0||n.clear(v)}),(0,P.Z)(this,"viewport",function(r){var n=r.x,t=r.y,o=r.width,u=r.height;i.gl._gl.viewport(n,t,o,u),i.width=o,i.height=u,i.gl._refresh()}),(0,P.Z)(this,"readPixels",function(r){var n=r.framebuffer,t=r.x,o=r.y,u=r.width,l=r.height,p={x:t,y:o,width:u,height:l};return n&&(p.framebuffer=n.get()),i.gl.read(p)}),(0,P.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,P.Z)(this,"getContainer",function(){var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,P.Z)(this,"getCanvas",function(){return i.canvas}),(0,P.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,P.Z)(this,"destroy",function(){var r,n,t;i.canvas=null,(r=i.gl)===null||r===void 0||(n=r._gl)===null||n===void 0||(t=n.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),i.gl.destroy(),i.gl=null})}return(0,j.Z)(e,[{key:"init",value:function(){var i=(0,je.Z)(Q().mark(function n(t,o,u){var l=this;return Q().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.canvas=t,!u){v.next=5;break}this.gl=u,v.next=8;break;case 5:return v.next=7,new Promise(function(x,S){_P()({canvas:l.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(I,F){(I||!F)&&S(I),x(F)}})});case 7:this.gl=v.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return v.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||lb);function FP(e){var i=BP();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function BP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $0=["selectstart","selecting","selectend"],zP=function(e){(0,Xr.Z)(r,e);var i=FP(r);function r(n){var t,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,Mt.Z)(this,r),t=i.call(this),(0,P.Z)((0,k.Z)(t),"isEnable",!1),(0,P.Z)((0,k.Z)(t),"onDragStart",function(u){t.box.style.display="block",t.startEvent=t.endEvent=u,t.syncBoxBound(),t.emit("selectstart",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,P.Z)((0,k.Z)(t),"onDragging",function(u){t.endEvent=u,t.syncBoxBound(),t.emit("selecting",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,P.Z)((0,k.Z)(t),"onDragEnd",function(u){t.endEvent=u,t.box.style.display="none",t.emit("selectend",t.getLngLatBox(),t.startEvent,t.endEvent)}),t.scene=n,t.options=o,t}return(0,j.Z)(r,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var t=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var o=Ai("div",void 0,this.container);o.classList.add("l7-select-box"),t&&o.classList.add(t),o.style.display="none",this.box=o}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var t=this.startEvent,o=t.x,u=t.y,l=this.endEvent,p=l.x,v=l.y,x=Math.min(o,p),S=Math.min(u,v),A=Math.abs(o-p),I=Math.abs(u-v);this.box.style.top="".concat(S,"px"),this.box.style.left="".concat(x,"px"),this.box.style.width="".concat(A,"px"),this.box.style.height="".concat(I,"px")}},{key:"getLngLatBox",value:function(){var t=this.startEvent.lngLat,o=t.lng,u=t.lat,l=this.endEvent.lngLat,p=l.lng,v=l.lat;return Xu([[o,u],[p,v]])}}]),r}(ae.EventEmitter),NP=function(){function e(i){(0,Mt.Z)(this,e);var r=i.id,n=i.map,t=i.canvas,o=i.hasBaseMap,u=JS();this.container=u,n.setContainer(u,r,t,o),u.bind(qe.IRendererService).to(DP).inSingletonScope(),this.sceneService=u.get(qe.ISceneService),this.mapService=u.get(qe.IMapService),this.iconService=u.get(qe.IIconService),this.fontService=u.get(qe.IFontService),this.controlService=u.get(qe.IControlService),this.layerService=u.get(qe.ILayerService),this.debugService=u.get(qe.IDebugService),this.debugService.setEnable(i.debug),this.markerService=u.get(qe.IMarkerService),this.interactionService=u.get(qe.IInteractionService),this.popupService=u.get(qe.IPopupService),this.boxSelect=new zP(this,{}),this.initComponent(r),this.sceneService.init(i),this.initControl()}return(0,j.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var i=(0,je.Z)(Q().mark(function n(t){return Q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"exportMap",value:function(){var i=(0,je.Z)(Q().mark(function n(t){return Q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var t=new r(this);t.init()}else this.on("loaded",function(){var o=new r(n);o.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=this,t=ev(this.container);if(r.setContainer(t,this.container),this.sceneService.addLayer(r),r.inited){var o=this.initMask(r);this.addMask(o,r.id)}else r.on("inited",function(){var u=n.initMask(r);n.addMask(u,r.id)})}},{key:"initMask",value:function(r){var n=r.getLayerConfig(),t=n.mask,o=n.maskfence,u=n.maskColor,l=u===void 0?"#000":u,p=n.maskOpacity,v=p===void 0?0:p;if(!(!t||!o)){var x=new Q_().source(o).shape("fill").style({color:l,opacity:v});return x}}},{key:"addMask",value:function(r,n){if(!!r){var t=this.getLayer(n);if(t){var o=ev(this.container);r.setContainer(o,this.container),t.addMaskLayer(r),this.sceneService.addMask(r)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(){var i=(0,je.Z)(Q().mark(function n(t,o){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(t,o);case 2:case"end":return l.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"removeAllLayer",value:function(){var i=(0,je.Z)(Q().mark(function n(){return Q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.layerService.removeAllLayers();case 2:case"end":return o.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(t){var o=(0,Dn.Z)(t,2),u=o[0],l=o[1];n.fontService.addIconFont(u,l)})}},{key:"addFontFace",value:function(r,n){var t=this;this.fontService.once("fontloaded",function(o){t.emit("fontloaded",o)}),this.fontService.addFontFace(r,n)}},{key:"addImage",value:function(){var i=(0,je.Z)(Q().mark(function n(t,o){return Q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(t,o);case 2:case"end":return l.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"removePopup",value:function(r){this.popupService.removePopup(r)}},{key:"on",value:function(r,n){if($0.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.on(r,n)}else om.includes(r)?this.sceneService.on(r,n):this.mapService.on(r,n)}},{key:"once",value:function(r,n){if($0.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.once(r,n)}else om.includes(r)?this.sceneService.once(r,n):this.mapService.once(r,n)}},{key:"emit",value:function(r,n){om.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.emit(r,n)}},{key:"off",value:function(r,n){if($0.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.off(r,n)}else om.includes(r)?this.sceneService.off(r,n):this.mapService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var t=this.sceneService.getSceneConfig(),o=t.fitBoundsOptions,u=t.animate;this.mapService.fitBounds(r,n||(0,H.Z)((0,H.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(qe.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){r.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(r){return ss.REGISTERED_PROTOCOLS[r]}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:qc(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,t=r.logoPosition;n&&this.addControl(new Qy({position:t}))}}],[{key:"addProtocol",value:function(r,n){ss.REGISTERED_PROTOCOLS[r]=n}},{key:"removeProtocol",value:function(r){delete ss.REGISTERED_PROTOCOLS[r]}}]),e}(),g6="2.17.11";function bv(e){return bv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},bv(e)}function cb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function y6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cb(Object(r),!0).forEach(function(n){ZP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ZP(e,i,r){return i=UP(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function UP(e){var i=VP(e,"string");return bv(i)==="symbol"?i:String(i)}function VP(e,i){if(bv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(bv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function _6(e,i){return WP(e)||HP(e,i)||GP(e,i)||jP()}function jP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GP(e,i){if(!!e){if(typeof e=="string")return fb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fb(e,i)}}function fb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function HP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function WP(e){if(Array.isArray(e))return e}var x6=null,b6=null,hb,Y0,pb,$P=(hb=s0(qe.IGlobalConfigService),Y0=function(){function e(i){(0,Mt.Z)(this,e),Or(this,"configService",pb,this),this.config=i}return(0,j.Z)(e,[{key:"setContainer",value:function(r,n,t,o){r.bind(qe.MapConfig).toConstantValue((0,H.Z)((0,H.Z)({},this.config),{},{id:n,canvas:t,hasBaseMap:o})),r.bind(qe.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),pb=cr(Y0.prototype,"configService",[hb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y0),YP=N(6158),Sv=N.n(YP),XP=function(){function e(i){(0,Mt.Z)(this,e),(0,P.Z)(this,"size",1e4),this.size=i||1e4}return(0,j.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),t=this.mercatorYfromLat(r[1]);return[n,t]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),t=this.latFromMercatorY(r[1]);return[n,t]}}]),e}(),qP={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},db,vb,mb,gb,yb,_b,gd,xb,bb,Sb,wb,Eb={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},KP=12,JP=(db=(0,at.b2)(),vb=(0,at.f3)(qe.MapConfig),mb=(0,at.f3)(qe.IGlobalConfigService),gb=(0,at.f3)(qe.ICoordinateSystemService),yb=(0,at.f3)(qe.IEventEmitter),db(_b=(gd=function(){function e(){var i=this;(0,Mt.Z)(this,e),(0,P.Z)(this,"version",uc.DEFUALT),(0,P.Z)(this,"simpleMapCoord",new XP),(0,P.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Or(this,"config",xb,this),Or(this,"configService",bb,this),Or(this,"coordinateSystemService",Sb,this),Or(this,"eventEmitter",wb,this),(0,P.Z)(this,"handleCameraChanged",function(r){var n=i.map.getCenter(),t=n.lat,o=n.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,t],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0}),i.updateCoordinateSystemService(),i.cameraChangedCallback(i.viewport)})}return(0,j.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Ai("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(r,n){cw.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(Eb[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(Eb[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===uc.SIMPLE)return this.simpleMapCoord.getSize();var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.dragEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyleValue(r))}},{key:"meterToCoord",value:function(r,n){return 1}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"getMapStyle",value:function(){try{var r,n=(r=this.map.getStyle().sprite)!==null&&r!==void 0?r:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(t){return""}}},{key:"getMapStyleConfig",value:function(){return qP}},{key:"getMapStyleValue",value:function(r){var n;return(n=this.getMapStyleConfig()[r])!==null&&n!==void 0?n:r}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[r].concat(o))}},{key:"once",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[r].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),t=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return t}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatMapContainer",value:function(r){var n=r;return typeof r=="string"&&(n=document.getElementById(r)),n}},{key:"updateView",value:function(r){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:r.bearing,center:r.center,viewportHeight:r.viewportHeight,pitch:r.pitch,viewportWidth:r.viewportWidth,zoom:r.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var r=this.config.offsetCoordinate,n=r===void 0?!0:r;this.viewport.getZoom()>KP&&n?this.coordinateSystemService.setCoordinateSystem(Nc.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Nc.LNGLAT)}}]),e}(),xb=cr(gd.prototype,"config",[vb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bb=cr(gd.prototype,"configService",[mb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sb=cr(gd.prototype,"coordinateSystemService",[gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wb=cr(gd.prototype,"eventEmitter",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd))||_b);function wv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Nm(e,i){var r=Xa([],i,e);return Lo(r,r,1/r[3]),r}function S6(e,i){var r=e%i;return r<0?i+r:r}function w6(e,i,r){return r*i+(1-r)*e}function Cp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var jc=Math.PI,Ab=jc/4,ah=jc/180,Cb=180/jc,X0=512,q0=4003e4,QP=1.5;function Tb(e){return Math.pow(2,e)}function ek(e){return Math.log2(e)}function Zm(e,i){var r=(0,Dn.Z)(e,2),n=r[0],t=r[1];Cp(Number.isFinite(n)&&Number.isFinite(i)),Cp(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude"),i*=X0;var o=n*ah,u=t*ah,l=i*(o+jc)/(2*jc),p=i*(jc-Math.log(Math.tan(Ab+u*.5)))/(2*jc);return[l,p]}function K0(e,i){var r=(0,Dn.Z)(e,2),n=r[0],t=r[1];i*=X0;var o=n/i*(2*jc)-jc,u=2*(Math.atan(Math.exp(jc-t/i*(2*jc)))-Ab);return[o*Cb,u*Cb]}function E6(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*ah);return ek(q0*r)-9}function Mb(e){var i=e.latitude,r=e.longitude,n=e.zoom,t=e.scale,o=e.highPrecision,u=o===void 0?!1:o;t=t!==void 0?t:Tb(n),Cp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(t));var l={},p=X0*t,v=Math.cos(i*ah),x=p/360,S=x/v,A=p/q0/v;if(l.pixelsPerMeter=[A,-A,A],l.metersPerPixel=[1/A,-1/A,1/A],l.pixelsPerDegree=[x,-S,A],l.degreesPerPixel=[1/x,-1/S,1/A],u){var I=ah*Math.tan(i*ah)/v,F=x*I/2,D=p/q0*I,Z=D/S*A;l.pixelsPerDegree2=[0,-F,D],l.pixelsPerMeter2=[Z,0,Z]}return l}function A6(e,i){var r=_slicedToArray(e,3),n=r[0],t=r[1],o=r[2],u=_slicedToArray(i,3),l=u[0],p=u[1],v=u[2],x=1,S=Mb({longitude:n,latitude:t,scale:x,highPrecision:!0}),A=S.pixelsPerMeter,I=S.pixelsPerMeter2,F=Zm(e,x);F[0]+=l*(A[0]+I[0]*p),F[1]+=p*(A[1]+I[1]*p);var D=K0(F,x),Z=(o||0)+(v||0);return Number.isFinite(o)||Number.isFinite(v)?[D[0],D[1],Z]:D}function tk(e){var i=e.height,r=e.pitch,n=e.bearing,t=e.altitude,o=e.center,u=o===void 0?null:o,l=e.flipY,p=l===void 0?!1:l,v=wv();return xn(v,v,[0,0,-t]),ai(v,v,[1,1,1/i]),zn(v,v,-r*ah),Ni(v,v,n*ah),p&&ai(v,v,[1,-1,1]),u&&xn(v,v,va.negate([],u)),v}function rk(e){var i=e.width,r=e.height,n=e.altitude,t=n===void 0?QP:n,o=e.pitch,u=o===void 0?0:o,l=e.nearZMultiplier,p=l===void 0?1:l,v=e.farZMultiplier,x=v===void 0?1:v,S=u*ah,A=Math.atan(.5/t),I=Math.sin(A)*t/Math.sin(Math.PI/2-S-A),F=Math.cos(Math.PI/2-S)*I+t;return{fov:2*Math.atan(r/2/t),aspect:i/r,focalDistance:t,near:p,far:F*x}}function nk(e){var i=e.width,r=e.height,n=e.pitch,t=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,l=rk({width:i,height:r,altitude:t,pitch:n,nearZMultiplier:o,farZMultiplier:u}),p=l.fov,v=l.aspect,x=l.near,S=l.far,A=Pd([],p,v,x,S);return A}function ik(e,i){var r=(0,Dn.Z)(e,3),n=r[0],t=r[1],o=r[2],u=o===void 0?0:o;return Cp(Number.isFinite(n)&&Number.isFinite(t)&&Number.isFinite(u)),Nm(i,[n,t,u,1])}function Ib(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Dn.Z)(e,3),t=n[0],o=n[1],u=n[2];if(Cp(Number.isFinite(t)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var l=Nm(i,[t,o,u,1]);return l}var p=Nm(i,[t,o,0,1]),v=Nm(i,[t,o,1,1]),x=p[2],S=v[2],A=x===S?0:((r||0)-x)/(S-x);return Lr.lerp([],p,v,A)}var Pb=wv(),ak=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,t=i.viewMatrix,o=t===void 0?Pb:t,u=i.projectionMatrix,l=u===void 0?Pb:u;(0,Mt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=l;var p=wv();yr(p,p,this.projectionMatrix),yr(p,p,this.viewMatrix),this.viewProjectionMatrix=p;var v=wv();ai(v,v,[this.width/2,-this.height/2,1]),xn(v,v,[1,-1,0]),yr(v,v,this.viewProjectionMatrix);var x=ar(wv(),v);if(!x)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=x,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,j.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Vp(r.projectionMatrix,this.projectionMatrix)&&Vp(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=this.projectPosition(r),l=ik(u,this.pixelProjectionMatrix),p=(0,Dn.Z)(l,2),v=p[0],x=p[1],S=o?x:this.height-x;return r.length===2?[v,S]:[v,S,l[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=n.targetZ,l=(0,Dn.Z)(r,3),p=l[0],v=l[1],x=l[2],S=o?v:this.height-v,A=u&&u*this.pixelsPerMeter,I=Ib([p,S,x],this.pixelUnprojectionMatrix,A),F=this.unprojectPosition(I),D=(0,Dn.Z)(F,3),Z=D[0],Y=D[1],ve=D[2];return Number.isFinite(x)?[Z,Y,ve]:Number.isFinite(u)?[Z,Y,u]:[Z,Y]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),t=(0,Dn.Z)(n,2),o=t[0],u=t[1],l=(r[2]||0)*this.pixelsPerMeter;return[o,u,l]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),t=(0,Dn.Z)(n,2),o=t[0],u=t[1],l=(r[2]||0)/this.pixelsPerMeter;return[o,u,l]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function ok(e){var i=e.width,r=e.height,n=e.bounds,t=e.minExtent,o=t===void 0?0:t,u=e.maxZoom,l=u===void 0?24:u,p=e.padding,v=p===void 0?0:p,x=e.offset,S=x===void 0?[0,0]:x,A=(0,Dn.Z)(n,2),I=(0,Dn.Z)(A[0],2),F=I[0],D=I[1],Z=(0,Dn.Z)(A[1],2),Y=Z[0],ve=Z[1];if(Number.isFinite(v)){var me=v;v={top:me,bottom:me,left:me,right:me}}else Cp(Number.isFinite(v.top)&&Number.isFinite(v.bottom)&&Number.isFinite(v.left)&&Number.isFinite(v.right));var De=new kb({width:i,height:r,longitude:0,latitude:0,zoom:0}),Be=De.project([F,ve]),Je=De.project([Y,D]),_t=[Math.max(Math.abs(Je[0]-Be[0]),o),Math.max(Math.abs(Je[1]-Be[1]),o)],Zt=[i-v.left-v.right-Math.abs(S[0])*2,r-v.top-v.bottom-Math.abs(S[1])*2];Cp(Zt[0]>0&&Zt[1]>0);var $t=Zt[0]/_t[0],dr=Zt[1]/_t[1],lr=(v.right-v.left)/2/$t,Yr=(v.bottom-v.top)/2/dr,un=[(Je[0]+Be[0])/2+lr,(Je[1]+Be[1])/2+Yr],In=De.unproject(un),Gi=De.zoom+Math.log2(Math.abs(Math.min($t,dr)));return{longitude:In[0],latitude:In[1],zoom:Math.min(Gi,l)}}var kb=function(e){(0,Xr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.width,o=n.height,u=n.latitude,l=u===void 0?0:u,p=n.longitude,v=p===void 0?0:p,x=n.zoom,S=x===void 0?0:x,A=n.pitch,I=A===void 0?0:A,F=n.bearing,D=F===void 0?0:F,Z=n.altitude,Y=Z===void 0?1.5:Z,ve=n.nearZMultiplier,me=n.farZMultiplier;(0,Mt.Z)(this,i),t=t||1,o=o||1;var De=Tb(S);Y=Math.max(.75,Y);var Be=Zm([v,l],De);Be[2]=0;var Je=nk({width:t,height:o,pitch:I,bearing:D,altitude:Y,nearZMultiplier:ve||1/o,farZMultiplier:me||1.01}),_t=tk({height:o,center:Be,pitch:I,bearing:D,altitude:Y,flipY:!0});return r=(0,Jr.Z)(this,(0,Qe.Z)(i).call(this,{width:t,height:o,viewMatrix:_t,projectionMatrix:Je})),r.latitude=l,r.longitude=v,r.zoom=S,r.pitch=I,r.bearing=D,r.altitude=Y,r.scale=De,r.center=Be,r.pixelsPerMeter=Mb((0,k.Z)((0,k.Z)(r))).pixelsPerMeter[2],Object.freeze((0,k.Z)((0,k.Z)(r))),r}return(0,j.Z)(i,[{key:"projectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Zm(n,t)}},{key:"unprojectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return K0(n,t)}},{key:"getMapCenterByLngLatPosition",value:function(n){var t=n.lngLat,o=n.pos,u=Ib(o,this.pixelUnprojectionMatrix),l=Zm(t,this.scale),p=Lr.add([],l,Lr.negate([],u)),v=Lr.add([],this.center,p);return K0(v,this.scale)}},{key:"getLocationAtPoint",value:function(n){var t=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:o})}},{key:"fitBounds",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,l=ok(Object.assign({width:o,height:u,bounds:n},t)),p=l.longitude,v=l.latitude,x=l.zoom;return new i({width:o,height:u,longitude:p,latitude:v,zoom:x})}}]),i}(ak),sk=function(){function e(){(0,Mt.Z)(this,e)}return(0,j.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,t=r.zoom,o=r.pitch,u=r.bearing,l=r.viewportHeight,p=r.viewportWidth;this.viewport=new kb({width:p,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:t,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),uk=["id","attributionControl","style","token","rotation","mapInstance"],Lb,Rb;function lk(e){var i=ck();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function ck(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function fk(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}fk(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Sv();var hk=0,Ob="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",pk=(Lb=(0,at.b2)(),Lb(Rb=function(e){(0,Xr.Z)(r,e);var i=lk(r);function r(){var n;(0,Mt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,P.Z)((0,k.Z)(n),"version",uc.MAPBOX),n}return(0,j.Z)(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(t,0),l=u.x,p=u.y;return[l-o.x,p-o.y]}},{key:"lngLatToMercator",value:function(t,o){var u=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),l=u.x,p=l===void 0?0:l,v=u.y,x=v===void 0?0:v,S=u.z,A=S===void 0?0:S;return{x:p,y:x,z:A}}},{key:"getModelMatrix",value:function(t,o,u){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),x=v.meterInMercatorCoordinateUnits(),S=He();return xn(S,S,va.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),ai(S,S,va.fromValues(x*l[0],-x*l[1],x*l[2])),zn(S,S,u[0]),ti(S,S,u[1]),Ni(S,S,u[2]),S}},{key:"init",value:function(){var n=(0,je.Z)(Q().mark(function o(){var u=this,l,p,v,x,S,A,I,F,D,Z,Y,ve,me;return Q().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:l=this.config,p=l.id,v=p===void 0?"map":p,x=l.attributionControl,S=x===void 0?!1:x,A=l.style,I=A===void 0?"light":A,F=l.token,D=F===void 0?Ob:F,Z=l.rotation,Y=Z===void 0?0:Z,ve=l.mapInstance,me=(0,ol.Z)(l,uk),this.viewport=new sk,!ve&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),D===Ob&&I!=="blank"&&!window.mapboxgl.accessToken&&!ve&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ve&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=D),ve?(this.map=ve,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(v),this.map=new window.mapboxgl.Map((0,H.Z)({container:this.$mapContainer,style:this.getMapStyleValue(I),attributionControl:S,bearing:Y},me))),this.map.on("load",function(){u.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Be.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,o;(t=this.$mapContainer)===null||t===void 0||(o=t.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).emit.apply(o,[t].concat(l))}},{key:"once",value:function(t){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).once.apply(o,[t].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,o){var u=new(Sv()).LngLat(t[0],t[1]),l=new(Sv()).LngLat(o[0],o[1]),p=u.distanceTo(l),v=Sv().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),x=Sv().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),S=v.x,A=v.y,I=x.x,F=x.y,D=Math.sqrt(Math.pow(S-I,2)+Math.pow(A-F,2))*4194304*2;return D/p}},{key:"exportMap",value:function(t){var o=this.map.getCanvas(),u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"creatMapContainer",value:function(t){var o=t;typeof t=="string"&&(o=document.getElementById(t));var u=document.createElement("div");return u.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,u.id="l7_mapbox_div"+hk++,o.appendChild(u),u}}]),r}(JP))||Rb);function dk(e){var i=vk();return function(){var n=(0,Qe.Z)(e),t;if(i){var o=(0,Qe.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,Jr.Z)(this,t)}}function vk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function mk(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}mk(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var gk=function(e){(0,Xr.Z)(r,e);var i=dk(r);function r(){return(0,Mt.Z)(this,r),i.apply(this,arguments)}return(0,j.Z)(r,[{key:"getServiceConstructor",value:function(){return pk}}]),r}($P);function Ev(e){return Ev=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Ev(e)}function Db(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Fb(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Db(Object(r),!0).forEach(function(n){yk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Db(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yk(e,i,r){return i=_k(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function _k(e){var i=xk(e,"string");return Ev(i)==="symbol"?i:String(i)}function xk(e,i){if(Ev(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Ev(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function bk(e,i){return Ak(e)||Ek(e,i)||wk(e,i)||Sk()}function Sk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wk(e,i){if(!!e){if(typeof e=="string")return Bb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bb(e,i)}}function Bb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Ek(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function Ak(e){if(Array.isArray(e))return e}var Ck=ee.memo(function(e){var i=e.style,r=e.className,n=e.map,t=e.option,o=e.onSceneLoaded,u=(0,ee.createRef)(),l=(0,ee.useState)(),p=bk(l,2),v=p[0],x=p[1];return(0,ee.useEffect)(function(){var S=new NP(Fb(Fb({id:u.current},t),{},{map:new gk(n)}));return S.on("loaded",function(){x(S),o&&o(S)}),function(){S.destroy()}},[]),(0,ee.useEffect)(function(){v&&n.style&&v.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ee.useEffect)(function(){v&&n.zoom&&v.setZoom(n.zoom)},[n.zoom]),(0,ee.useEffect)(function(){v&&n.center&&v.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ee.useEffect)(function(){v&&n.pitch!==void 0&&v.setPitch(n.pitch||0)},[n.pitch]),(0,ee.useEffect)(function(){v&&n.rotation&&v.setRotation(n.rotation)},[n.rotation]),ee.createElement(y.Provider,{value:v},(0,ee.createElement)("div",{ref:u,style:i,className:r},v&&e.children))}),Tk=Ck;function Av(e){return Av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Av(e)}function zb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function C6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zb(Object(r),!0).forEach(function(n){Mk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Mk(e,i,r){return i=Ik(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function Ik(e){var i=Pk(e,"string");return Av(i)==="symbol"?i:String(i)}function Pk(e,i){if(Av(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Av(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function T6(e,i){return Ok(e)||Rk(e,i)||Lk(e,i)||kk()}function kk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Lk(e,i){if(!!e){if(typeof e=="string")return Nb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nb(e,i)}}function Nb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Rk(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function Ok(e){if(Array.isArray(e))return e}var M6=null,I6=null;function Cv(e){return Cv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Cv(e)}function Zb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function P6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zb(Object(r),!0).forEach(function(n){Dk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Dk(e,i,r){return i=Fk(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function Fk(e){var i=Bk(e,"string");return Cv(i)==="symbol"?i:String(i)}function Bk(e,i){if(Cv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Cv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function k6(e,i){return Uk(e)||Zk(e,i)||Nk(e,i)||zk()}function zk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Nk(e,i){if(!!e){if(typeof e=="string")return Ub(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ub(e,i)}}function Ub(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Zk(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function Uk(e){if(Array.isArray(e))return e}var L6=null,R6=null;function Tv(e){return Tv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Tv(e)}function Vb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function O6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vb(Object(r),!0).forEach(function(n){Vk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Vk(e,i,r){return i=jk(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function jk(e){var i=Gk(e,"string");return Tv(i)==="symbol"?i:String(i)}function Gk(e,i){if(Tv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Tv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function D6(e,i){return Yk(e)||$k(e,i)||Wk(e,i)||Hk()}function Hk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wk(e,i){if(!!e){if(typeof e=="string")return jb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jb(e,i)}}function jb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $k(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function Yk(e){if(Array.isArray(e))return e}var F6=null,B6=null;function z6(e,i){return Jk(e)||Kk(e,i)||qk(e,i)||Xk()}function Xk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qk(e,i){if(!!e){if(typeof e=="string")return Gb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gb(e,i)}}function Gb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Kk(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function Jk(e){if(Array.isArray(e))return e}var N6=null;function Mv(e){return Mv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Mv(e)}var Z6=null;function Hb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function U6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hb(Object(r),!0).forEach(function(n){Qk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Qk(e,i,r){return i=eL(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function eL(e){var i=tL(e,"string");return Mv(i)==="symbol"?i:String(i)}function tL(e,i){if(Mv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Mv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function V6(e,i){if(e==null)return{};var r=rL(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function rL(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var j6={exportImage:xE,fullscreen:AE,geoLocate:ME,layer:Jy,layerSwitch:Jy,logo:Qy,mapTheme:BE,mouseLocation:ZE,zoom:WE,scale:jE},G6=null,Wb=N(73935);function $b(e,i){return oL(e)||aL(e,i)||iL(e,i)||nL()}function nL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iL(e,i){if(!!e){if(typeof e=="string")return Yb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yb(e,i)}}function Yb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function aL(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function oL(e){if(Array.isArray(e))return e}var Xb=ee.useEffect,qb=ee.useState,sL=/\B([A-Z])/g,uL=function(i){return i.replace(sL,"-$1").toLowerCase()};function H6(e){var i=e.className,r=e.style,n=e.children,t=e.position,o=qb(),u=$b(o,2),l=u[0],p=u[1],v=useSceneValue(),x=qb(function(){return document.createElement("div")}),S=$b(x,1),A=S[0];return Xb(function(){var I=new Control({position:t});return I.onAdd=function(){if(i&&(A.className=i),r){var F=Object.keys(r).map(function(D){return"".concat(uL(D),":").concat(r[D])}).join(";");A.style.cssText=F}return A},I.onRemove=function(){},p(I),v.addControl(I),function(){v.removeControl(I)}},[]),Xb(function(){l&&l.setPosition(t||"bottomleft")},[t]),createPortal(n,A)}var Kb=(0,ee.createContext)({});function W6(){return useContext(Kb)}var lL=ee.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},uo()),cL=ee.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},uo()),fL=ee.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},uo()),hL=ee.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},uo()),pL=ee.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},uo()),dL=ee.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},uo()),vL=ee.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},uo()),mL=ee.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},uo()),gL=["data"];function yL(e,i){if(e==null)return{};var r=_L(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function _L(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var xL=ee.memo(function(i){var r=i.layer,n=i.source,t=n.data,o=yL(n,gL);return r.inited?r.setData(t,o):r.source(t,o),o.autoFit&&r.fitBounds(o&&o.fitBoundsOptions),null},uo()),$6=ee.useEffect,bL=ee.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},uo());function SL(e,i){return CL(e)||AL(e,i)||EL(e,i)||wL()}function wL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EL(e,i){if(!!e){if(typeof e=="string")return Jb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Jb(e,i)}}function Jb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function AL(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function CL(e){if(Array.isArray(e))return e}var Iv=ee.useEffect,TL=ee.useState;function Qb(e,i){var r=i.source,n=i.color,t=i.shape,o=i.style,u=i.size,l=i.scale,p=i.active,v=i.select,x=i.filter,S=i.animate,A=i.options,I=i.onLayerLoaded,F=le(),D=TL(function(){var ve;switch(e){case"polygonLayer":ve=new mm(A);break;case"lineLayer":ve=new w0(A);break;case"pointLayer":ve=new vm(A);break;case"heatmapLayer":ve=new mA(A);break;case"rasterLayer":ve=new gm(A);break;case"imageLayer":ve=new I_(A);break;case"citybuildingLayer":ve=new Z3(A);break;default:ve=new mm(A)}return ve.on("inited",function(){I&&I(ve,F)}),ve}),Z=SL(D,1),Y=Z[0];return Iv(function(){return F.addLayer(Y),function(){F.removeLayer(Y)}},[]),Iv(function(){Y.inited&&A&&Y.updateLayerConfig(A)},[A==null?void 0:A.minZoom,A==null?void 0:A.maxZoom,A==null?void 0:A.visible]),Iv(function(){Y.inited&&(A==null?void 0:A.zIndex)&&Y.setIndex(A.zIndex)},[A==null?void 0:A.zIndex]),Iv(function(){Y.inited&&(A==null?void 0:A.blend)&&Y.setBlend(A.blend)},[A==null?void 0:A.blend]),Iv(function(){F.render()}),ee.createElement(Kb.Provider,{value:Y},ee.createElement(xL,{layer:Y,source:r}),l&&ee.createElement(pL,{layer:Y,scale:l}),n&&ee.createElement(fL,{layer:Y,color:n}),u&&ee.createElement(mL,{layer:Y,size:u}),t&&ee.createElement(vL,{layer:Y,shape:t}),o&&ee.createElement(bL,{layer:Y,style:o}),p&&ee.createElement(lL,{layer:Y,active:p}),v&&ee.createElement(dL,{layer:Y,select:v}),x&&ee.createElement(hL,{layer:Y,filter:x}),S&&ee.createElement(cL,{layer:Y,animate:S}),i.children)}var Y6=null,X6=null,ML=ee.memo(function(i){return Qb("pointLayer",i)}),IL=ee.memo(function(i){return Qb("heatmapLayer",i)}),q6=null,K6=null,J6=null,Q6=ee.useEffect,eO=null,tO=null;function yd(e){return yd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},yd(e)}function e2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Um(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?e2(Object(r),!0).forEach(function(n){PL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function PL(e,i,r){return i=r2(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function kL(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function t2(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,r2(n.key),n)}}function LL(e,i,r){return i&&t2(e.prototype,i),r&&t2(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function r2(e){var i=RL(e,"string");return yd(i)==="symbol"?i:String(i)}function RL(e,i){if(yd(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(yd(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function OL(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&J0(e,i)}function J0(e,i){return J0=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},J0(e,i)}function DL(e){var i=zL();return function(){var n=Vm(e),t;if(i){var o=Vm(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return FL(this,t)}}function FL(e,i){if(i&&(yd(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return BL(e)}function BL(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Vm(e){return Vm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Vm(e)}var rO=function(e){OL(r,e);var i=DL(r);function r(n){var t;return kL(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.popup=void 0,t.el=document.createElement("div"),t}return LL(r,[{key:"componentDidMount",value:function(){var t,o=this.props,u=o.lnglat,l=o.children,p=o.option,v=o.lngLat,x=new h0(Um(Um({},p),{},{stopPropagation:(t=this.props.option)===null||t===void 0?void 0:t.stopPropagation}));u&&x.setLnglat(u),v&&x.setLnglat(v),l&&x.setHTML(this.el),this.popup=x,this.scene.addPopup(x)}},{key:"componentDidUpdate",value:function(t){var o,u,l,p,v,x,S=Array.isArray(t.lnglat)?t.lnglat:[t==null||(o=t.lnglat)===null||o===void 0?void 0:o.lng,t==null||(u=t.lnglat)===null||u===void 0?void 0:u.lat],A=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(p=l.lnglat)===null||p===void 0?void 0:p.lng,(v=this.props)===null||v===void 0||(x=v.lnglat)===null||x===void 0?void 0:x.lat],I=S.toString()!==A.toString();if(I){var F;this.popup.remove(),this.popup=new h0(Um(Um({},this.props.option),{},{stopPropagation:(F=this.props.option)===null||F===void 0?void 0:F.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var t=this;return ee.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,Wb.createPortal)(t.props.children,t.el)})}}]),r}(ee.PureComponent);function _d(e){return _d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_d(e)}function NL(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function n2(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,UL(n.key),n)}}function ZL(e,i,r){return i&&n2(e.prototype,i),r&&n2(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function UL(e){var i=VL(e,"string");return _d(i)==="symbol"?i:String(i)}function VL(e,i){if(_d(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(_d(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function jL(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Q0(e,i)}function Q0(e,i){return Q0=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},Q0(e,i)}function GL(e){var i=$L();return function(){var n=jm(e),t;if(i){var o=jm(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return HL(this,t)}}function HL(e,i){if(i&&(_d(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WL(e)}function WL(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $L(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function jm(e){return jm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},jm(e)}var nO=function(e){jL(r,e);var i=GL(r);function r(n){var t;return NL(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.marker=void 0,t.el=document.createElement("div"),t}return ZL(r,[{key:"componentDidMount",value:function(){var t=this.props,o=t.lnglat,u=t.children,l=t.option,p=t.onMarkerLoaded,v=new Wy(l);o&&v.setLnglat(o),u&&v.setElement(this.el),this.marker=v,p&&p(v),this.scene.addMarker(v)}},{key:"componentDidUpdate",value:function(t){var o,u=JSON.stringify(t==null?void 0:t.lnglat)!==JSON.stringify((o=this.props)===null||o===void 0?void 0:o.lnglat);u&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var t=this;return ee.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,Wb.createPortal)(t.props.children,t.el)})}}]),r}(ee.PureComponent),iO=ee.useEffect,aO=null,oO=null,sO=ee.useEffect,uO=null},66213:function(Sr,te,N){"use strict";N.d(te,{Z:function(){return y}});var ye=N(77608);function ee(le,U){for(;!Object.prototype.hasOwnProperty.call(le,U)&&(le=(0,ye.Z)(le),le!==null););return le}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(U,ce,oe){var Ue=ee(U,ce);if(!!Ue){var se=Object.getOwnPropertyDescriptor(Ue,ce);return se.get?se.get.call(arguments.length<3?U:oe):se.value}},y.apply(this,arguments)}},38163:function(Sr){Sr.exports=te;function te(ee,y){var le=ee&&ee.type,U;if(le==="FeatureCollection")for(U=0;U<ee.features.length;U++)te(ee.features[U],y);else if(le==="GeometryCollection")for(U=0;U<ee.geometries.length;U++)te(ee.geometries[U],y);else if(le==="Feature")te(ee.geometry,y);else if(le==="Polygon")N(ee.coordinates,y);else if(le==="MultiPolygon")for(U=0;U<ee.coordinates.length;U++)N(ee.coordinates[U],y);return ee}function N(ee,y){if(ee.length!==0){ye(ee[0],y);for(var le=1;le<ee.length;le++)ye(ee[le],!y)}}function ye(ee,y){for(var le=0,U=0,ce=0,oe=ee.length,Ue=oe-1;ce<oe;Ue=ce++){var se=(ee[ce][0]-ee[Ue][0])*(ee[Ue][1]+ee[ce][1]),ze=le+se;U+=Math.abs(le)>=Math.abs(se)?le-ze+se:se-ze+le,le=ze}le+U>=0!=!!y&&ee.reverse()}},75550:function(Sr){"use strict";Sr.exports=te;function te(N,ye){this.x=N,this.y=ye}te.prototype={clone:function(){return new te(this.x,this.y)},add:function(N){return this.clone()._add(N)},sub:function(N){return this.clone()._sub(N)},multByPoint:function(N){return this.clone()._multByPoint(N)},divByPoint:function(N){return this.clone()._divByPoint(N)},mult:function(N){return this.clone()._mult(N)},div:function(N){return this.clone()._div(N)},rotate:function(N){return this.clone()._rotate(N)},rotateAround:function(N,ye){return this.clone()._rotateAround(N,ye)},matMult:function(N){return this.clone()._matMult(N)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(N){return this.x===N.x&&this.y===N.y},dist:function(N){return Math.sqrt(this.distSqr(N))},distSqr:function(N){var ye=N.x-this.x,ee=N.y-this.y;return ye*ye+ee*ee},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(N){return Math.atan2(this.y-N.y,this.x-N.x)},angleWith:function(N){return this.angleWithSep(N.x,N.y)},angleWithSep:function(N,ye){return Math.atan2(this.x*ye-this.y*N,this.x*N+this.y*ye)},_matMult:function(N){var ye=N[0]*this.x+N[1]*this.y,ee=N[2]*this.x+N[3]*this.y;return this.x=ye,this.y=ee,this},_add:function(N){return this.x+=N.x,this.y+=N.y,this},_sub:function(N){return this.x-=N.x,this.y-=N.y,this},_mult:function(N){return this.x*=N,this.y*=N,this},_div:function(N){return this.x/=N,this.y/=N,this},_multByPoint:function(N){return this.x*=N.x,this.y*=N.y,this},_divByPoint:function(N){return this.x/=N.x,this.y/=N.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var N=this.y;return this.y=this.x,this.x=-N,this},_rotate:function(N){var ye=Math.cos(N),ee=Math.sin(N),y=ye*this.x-ee*this.y,le=ee*this.x+ye*this.y;return this.x=y,this.y=le,this},_rotateAround:function(N,ye){var ee=Math.cos(N),y=Math.sin(N),le=ye.x+ee*(this.x-ye.x)-y*(this.y-ye.y),U=ye.y+y*(this.x-ye.x)+ee*(this.y-ye.y);return this.x=le,this.y=U,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},te.convert=function(N){return N instanceof te?N:Array.isArray(N)?new te(N[0],N[1]):N}},49296:function(Sr){"use strict";Sr.exports=N,Sr.exports.default=N;var te=1e20;function N(U,ce,oe,Ue,se,ze){this.fontSize=U||24,this.buffer=ce===void 0?3:ce,this.cutoff=Ue||.25,this.fontFamily=se||"sans-serif",this.fontWeight=ze||"normal",this.radius=oe||8;var et=this.size=this.fontSize+this.buffer*2,ut=et+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=et,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(ut*ut),this.gridInner=new Float64Array(ut*ut),this.f=new Float64Array(ut),this.z=new Float64Array(ut+1),this.v=new Uint16Array(ut),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(et/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ye(U,ce,oe,Ue,se,ze,et){ze.fill(te,0,ce*oe),et.fill(0,0,ce*oe);for(var ut=(ce-Ue)/2,Ct=0;Ct<se;Ct++)for(var Kt=0;Kt<Ue;Kt++){var Yt=(Ct+ut)*ce+Kt+ut,nr=U.data[4*(Ct*Ue+Kt)+3]/255;if(nr===1)ze[Yt]=0,et[Yt]=te;else if(nr===0)ze[Yt]=te,et[Yt]=0;else{var Jt=Math.max(0,.5-nr),bt=Math.max(0,nr-.5);ze[Yt]=Jt*Jt,et[Yt]=bt*bt}}}function ee(U,ce,oe,Ue,se,ze,et){for(var ut=0;ut<ce*oe;ut++){var Ct=Math.sqrt(Ue[ut])-Math.sqrt(se[ut]);U[ut]=Math.round(255-255*(Ct/ze+et))}}N.prototype._draw=function(U,ce){var oe=this.ctx.measureText(U),Ue=oe.width,se=2*this.buffer,ze,et,ut,Ct,Kt,Yt,nr,Jt;ce&&this.useMetrics?(Kt=Math.floor(oe.actualBoundingBoxAscent),Jt=this.buffer+Math.ceil(oe.actualBoundingBoxAscent),Yt=this.buffer,nr=this.buffer,et=Math.min(this.size,Math.ceil(oe.actualBoundingBoxRight-oe.actualBoundingBoxLeft)),Ct=Math.min(this.size-Yt,Math.ceil(oe.actualBoundingBoxAscent+oe.actualBoundingBoxDescent)),ze=et+se,ut=Ct+se,this.ctx.textBaseline="alphabetic"):(ze=et=this.size,ut=Ct=this.size,Kt=19*this.fontSize/24,Yt=nr=0,Jt=this.middle,this.ctx.textBaseline="middle");var bt;et&&Ct&&(this.ctx.clearRect(nr,Yt,et,Ct),this.ctx.fillText(U,this.buffer,Jt),bt=this.ctx.getImageData(nr,Yt,et,Ct));var vt=new Uint8ClampedArray(ze*ut);return ye(bt,ze,ut,et,Ct,this.gridOuter,this.gridInner),y(this.gridOuter,ze,ut,this.f,this.v,this.z),y(this.gridInner,ze,ut,this.f,this.v,this.z),ee(vt,ze,ut,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:vt,metrics:{width:et,height:Ct,sdfWidth:ze,sdfHeight:ut,top:Kt,left:0,advance:Ue}}},N.prototype.draw=function(U){return this._draw(U,!1).data},N.prototype.drawWithMetrics=function(U){return this._draw(U,!0)};function y(U,ce,oe,Ue,se,ze){for(var et=0;et<ce;et++)le(U,et,ce,oe,Ue,se,ze);for(var ut=0;ut<oe;ut++)le(U,ut*ce,1,ce,Ue,se,ze)}function le(U,ce,oe,Ue,se,ze,et){var ut,Ct,Kt,Yt;for(ze[0]=0,et[0]=-te,et[1]=te,ut=0;ut<Ue;ut++)se[ut]=U[ce+ut*oe];for(ut=1,Ct=0,Kt=0;ut<Ue;ut++){do Yt=ze[Ct],Kt=(se[ut]-se[Yt]+ut*ut-Yt*Yt)/(ut-Yt)/2;while(Kt<=et[Ct]&&--Ct>-1);Ct++,ze[Ct]=ut,et[Ct]=Kt,et[Ct+1]=te}for(ut=0,Ct=0;ut<Ue;ut++){for(;et[Ct+1]<ut;)Ct++;Yt=ze[Ct],U[ce+ut*oe]=se[Yt]+(ut-Yt)*(ut-Yt)}}},38929:function(Sr,te,N){Sr.exports.VectorTile=N(22779),N(66024),N(59701)},22779:function(Sr,te,N){"use strict";var ye=N(59701);Sr.exports=ee;function ee(le,U){this.layers=le.readFields(y,{},U)}function y(le,U,ce){if(le===3){var oe=new ye(ce,ce.readVarint()+ce.pos);oe.length&&(U[oe.name]=oe)}}},66024:function(Sr,te,N){"use strict";var ye=N(75550);Sr.exports=ee;function ee(oe,Ue,se,ze,et){this.properties={},this.extent=se,this.type=0,this._pbf=oe,this._geometry=-1,this._keys=ze,this._values=et,oe.readFields(y,this,Ue)}function y(oe,Ue,se){oe==1?Ue.id=se.readVarint():oe==2?le(se,Ue):oe==3?Ue.type=se.readVarint():oe==4&&(Ue._geometry=se.pos)}function le(oe,Ue){for(var se=oe.readVarint()+oe.pos;oe.pos<se;){var ze=Ue._keys[oe.readVarint()],et=Ue._values[oe.readVarint()];Ue.properties[ze]=et}}ee.types=["Unknown","Point","LineString","Polygon"],ee.prototype.loadGeometry=function(){var oe=this._pbf;oe.pos=this._geometry;for(var Ue=oe.readVarint()+oe.pos,se=1,ze=0,et=0,ut=0,Ct=[],Kt;oe.pos<Ue;){if(ze<=0){var Yt=oe.readVarint();se=Yt&7,ze=Yt>>3}if(ze--,se===1||se===2)et+=oe.readSVarint(),ut+=oe.readSVarint(),se===1&&(Kt&&Ct.push(Kt),Kt=[]),Kt.push(new ye(et,ut));else if(se===7)Kt&&Kt.push(Kt[0].clone());else throw new Error("unknown command "+se)}return Kt&&Ct.push(Kt),Ct},ee.prototype.bbox=function(){var oe=this._pbf;oe.pos=this._geometry;for(var Ue=oe.readVarint()+oe.pos,se=1,ze=0,et=0,ut=0,Ct=Infinity,Kt=-Infinity,Yt=Infinity,nr=-Infinity;oe.pos<Ue;){if(ze<=0){var Jt=oe.readVarint();se=Jt&7,ze=Jt>>3}if(ze--,se===1||se===2)et+=oe.readSVarint(),ut+=oe.readSVarint(),et<Ct&&(Ct=et),et>Kt&&(Kt=et),ut<Yt&&(Yt=ut),ut>nr&&(nr=ut);else if(se!==7)throw new Error("unknown command "+se)}return[Ct,Yt,Kt,nr]},ee.prototype.toGeoJSON=function(oe,Ue,se){var ze=this.extent*Math.pow(2,se),et=this.extent*oe,ut=this.extent*Ue,Ct=this.loadGeometry(),Kt=ee.types[this.type],Yt,nr;function Jt(Dr){for(var fr=0;fr<Dr.length;fr++){var sr=Dr[fr],mt=180-(sr.y+ut)*360/ze;Dr[fr]=[(sr.x+et)*360/ze-180,360/Math.PI*Math.atan(Math.exp(mt*Math.PI/180))-90]}}switch(this.type){case 1:var bt=[];for(Yt=0;Yt<Ct.length;Yt++)bt[Yt]=Ct[Yt][0];Ct=bt,Jt(Ct);break;case 2:for(Yt=0;Yt<Ct.length;Yt++)Jt(Ct[Yt]);break;case 3:for(Ct=U(Ct),Yt=0;Yt<Ct.length;Yt++)for(nr=0;nr<Ct[Yt].length;nr++)Jt(Ct[Yt][nr]);break}Ct.length===1?Ct=Ct[0]:Kt="Multi"+Kt;var vt={type:"Feature",geometry:{type:Kt,coordinates:Ct},properties:this.properties};return"id"in this&&(vt.id=this.id),vt};function U(oe){var Ue=oe.length;if(Ue<=1)return[oe];for(var se=[],ze,et,ut=0;ut<Ue;ut++){var Ct=ce(oe[ut]);Ct!==0&&(et===void 0&&(et=Ct<0),et===Ct<0?(ze&&se.push(ze),ze=[oe[ut]]):ze.push(oe[ut]))}return ze&&se.push(ze),se}function ce(oe){for(var Ue=0,se=0,ze=oe.length,et=ze-1,ut,Ct;se<ze;et=se++)ut=oe[se],Ct=oe[et],Ue+=(Ct.x-ut.x)*(ut.y+Ct.y);return Ue}},59701:function(Sr,te,N){"use strict";var ye=N(66024);Sr.exports=ee;function ee(U,ce){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=U,this._keys=[],this._values=[],this._features=[],U.readFields(y,this,ce),this.length=this._features.length}function y(U,ce,oe){U===15?ce.version=oe.readVarint():U===1?ce.name=oe.readString():U===5?ce.extent=oe.readVarint():U===2?ce._features.push(oe.pos):U===3?ce._keys.push(oe.readString()):U===4&&ce._values.push(le(oe))}function le(U){for(var ce=null,oe=U.readVarint()+U.pos;U.pos<oe;){var Ue=U.readVarint()>>3;ce=Ue===1?U.readString():Ue===2?U.readFloat():Ue===3?U.readDouble():Ue===4?U.readVarint64():Ue===5?U.readVarint():Ue===6?U.readSVarint():Ue===7?U.readBoolean():null}return ce}ee.prototype.feature=function(U){if(U<0||U>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[U];var ce=this._pbf.readVarint()+this._pbf.pos;return new ye(this._pbf,ce,this.extent,this._keys,this._values)}},53645:function(){},81903:function(){},7277:function(Sr,te,N){"use strict";N.d(te,{Z:function(){return Xt}});var ye=N(22122),ee=N(67294),y=N(57838),le=N(96159),U=N(96156),ce=N(94184),oe=N.n(ce),Ue=N(53124),se=N(90860),ze=N(11726),et=N.n(ze),ut=function(J){var Ie=J.value,V=J.formatter,H=J.precision,be=J.decimalSeparator,tt=J.groupSeparator,ht=tt===void 0?"":tt,St=J.prefixCls,jt;if(typeof V=="function")jt=V(Ie);else{var tr=String(Ie),Hr=tr.match(/^(-?)(\d*)(\.(\d+))?$/);if(!Hr||tr==="-")jt=tr;else{var Br=Hr[1],Bn=Hr[2]||"0",tn=Hr[4]||"";Bn=Bn.replace(/\B(?=(\d{3})+(?!\d))/g,ht),typeof H=="number"&&(tn=et()(tn,H,"0").slice(0,H>0?H:0)),tn&&(tn="".concat(be).concat(tn)),jt=[ee.createElement("span",{key:"int",className:"".concat(St,"-content-value-int")},Br,Bn),tn&&ee.createElement("span",{key:"decimal",className:"".concat(St,"-content-value-decimal")},tn)]}}return ee.createElement("span",{className:"".concat(St,"-content-value")},jt)},Ct=ut,Kt=function(J){var Ie=J.prefixCls,V=J.className,H=J.style,be=J.valueStyle,tt=J.value,ht=tt===void 0?0:tt,St=J.title,jt=J.valueRender,tr=J.prefix,Hr=J.suffix,Br=J.loading,Bn=Br===void 0?!1:Br,tn=J.direction,gn=J.onMouseEnter,fi=J.onMouseLeave,Vn=J.decimalSeparator,vn=Vn===void 0?".":Vn,bi=J.groupSeparator,Mi=bi===void 0?",":bi,Ei=ee.createElement(Ct,(0,ye.Z)({decimalSeparator:vn,groupSeparator:Mi},J,{value:ht})),Gn=oe()(Ie,(0,U.Z)({},"".concat(Ie,"-rtl"),tn==="rtl"),V);return ee.createElement("div",{className:Gn,style:H,onMouseEnter:gn,onMouseLeave:fi},St&&ee.createElement("div",{className:"".concat(Ie,"-title")},St),ee.createElement(se.Z,{paragraph:!1,loading:Bn,className:"".concat(Ie,"-skeleton")},ee.createElement("div",{style:be,className:"".concat(Ie,"-content")},tr&&ee.createElement("span",{className:"".concat(Ie,"-content-prefix")},tr),jt?jt(Ei):Ei,Hr&&ee.createElement("span",{className:"".concat(Ie,"-content-suffix")},Hr))))},Yt=(0,Ue.PG)({prefixCls:"statistic"})(Kt),nr=Yt,Jt=N(28481),bt=N(32475),vt=N.n(bt),Dr=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function fr(_r,J){var Ie=_r,V=/\[[^\]]*]/g,H=(J.match(V)||[]).map(function(St){return St.slice(1,-1)}),be=J.replace(V,"[]"),tt=Dr.reduce(function(St,jt){var tr=(0,Jt.Z)(jt,2),Hr=tr[0],Br=tr[1];if(St.includes(Hr)){var Bn=Math.floor(Ie/Br);return Ie-=Bn*Br,St.replace(new RegExp("".concat(Hr,"+"),"g"),function(tn){var gn=tn.length;return vt()(Bn.toString(),gn,"0")})}return St},be),ht=0;return tt.replace(V,function(){var St=H[ht];return ht+=1,St})}function sr(_r,J){var Ie=J.format,V=Ie===void 0?"":Ie,H=new Date(_r).getTime(),be=Date.now(),tt=Math.max(H-be,0);return fr(tt,V)}var mt=1e3/30;function nt(_r){return new Date(_r).getTime()}var Lt=function(J){var Ie=J.value,V=J.format,H=V===void 0?"HH:mm:ss":V,be=J.onChange,tt=J.onFinish,ht=(0,y.Z)(),St=ee.useRef(null),jt=function(){tt==null||tt(),St.current&&(clearInterval(St.current),St.current=null)},tr=function(){var tn=nt(Ie);tn>=Date.now()&&(St.current=setInterval(function(){ht(),be==null||be(tn-Date.now()),tn<Date.now()&&jt()},mt))};ee.useEffect(function(){return tr(),function(){St.current&&(clearInterval(St.current),St.current=null)}},[Ie]);var Hr=function(tn,gn){return sr(tn,(0,ye.Z)((0,ye.Z)({},gn),{format:H}))},Br=function(tn){return(0,le.Tm)(tn,{title:void 0})};return ee.createElement(nr,(0,ye.Z)({},J,{valueRender:Br,formatter:Hr}))},lt=ee.memo(Lt);nr.Countdown=lt;var Xt=nr},95300:function(Sr,te,N){"use strict";var ye=N(38663),ee=N.n(ye),y=N(81903),le=N.n(y),U=N(18446)},9187:function(Sr){"use strict";Sr.exports=te,Sr.exports.default=te;function te(V,H,be){be=be||2;var tt=H&&H.length,ht=tt?H[0]*be:V.length,St=N(V,0,ht,be,!0),jt=[];if(!St||St.next===St.prev)return jt;var tr,Hr,Br,Bn,tn,gn,fi;if(tt&&(St=oe(V,H,St,be)),V.length>80*be){tr=Br=V[0],Hr=Bn=V[1];for(var Vn=be;Vn<ht;Vn+=be)tn=V[Vn],gn=V[Vn+1],tn<tr&&(tr=tn),gn<Hr&&(Hr=gn),tn>Br&&(Br=tn),gn>Bn&&(Bn=gn);fi=Math.max(Br-tr,Bn-Hr),fi=fi!==0?32767/fi:0}return ee(St,jt,be,tr,Hr,fi,0),jt}function N(V,H,be,tt,ht){var St,jt;if(ht===Ie(V,H,be,tt)>0)for(St=H;St<be;St+=tt)jt=Xt(St,V[St],V[St+1],jt);else for(St=be-tt;St>=H;St-=tt)jt=Xt(St,V[St],V[St+1],jt);return jt&&vt(jt,jt.next)&&(_r(jt),jt=jt.next),jt}function ye(V,H){if(!V)return V;H||(H=V);var be=V,tt;do if(tt=!1,!be.steiner&&(vt(be,be.next)||bt(be.prev,be,be.next)===0)){if(_r(be),be=H=be.prev,be===be.next)break;tt=!0}else be=be.next;while(tt||be!==H);return H}function ee(V,H,be,tt,ht,St,jt){if(!!V){!jt&&St&&ut(V,tt,ht,St);for(var tr=V,Hr,Br;V.prev!==V.next;){if(Hr=V.prev,Br=V.next,St?le(V,tt,ht,St):y(V)){H.push(Hr.i/be|0),H.push(V.i/be|0),H.push(Br.i/be|0),_r(V),V=Br.next,tr=Br.next;continue}if(V=Br,V===tr){jt?jt===1?(V=U(ye(V),H,be),ee(V,H,be,tt,ht,St,2)):jt===2&&ce(V,H,be,tt,ht,St):ee(ye(V),H,be,tt,ht,St,1);break}}}}function y(V){var H=V.prev,be=V,tt=V.next;if(bt(H,be,tt)>=0)return!1;for(var ht=H.x,St=be.x,jt=tt.x,tr=H.y,Hr=be.y,Br=tt.y,Bn=ht<St?ht<jt?ht:jt:St<jt?St:jt,tn=tr<Hr?tr<Br?tr:Br:Hr<Br?Hr:Br,gn=ht>St?ht>jt?ht:jt:St>jt?St:jt,fi=tr>Hr?tr>Br?tr:Br:Hr>Br?Hr:Br,Vn=tt.next;Vn!==H;){if(Vn.x>=Bn&&Vn.x<=gn&&Vn.y>=tn&&Vn.y<=fi&&nr(ht,tr,St,Hr,jt,Br,Vn.x,Vn.y)&&bt(Vn.prev,Vn,Vn.next)>=0)return!1;Vn=Vn.next}return!0}function le(V,H,be,tt){var ht=V.prev,St=V,jt=V.next;if(bt(ht,St,jt)>=0)return!1;for(var tr=ht.x,Hr=St.x,Br=jt.x,Bn=ht.y,tn=St.y,gn=jt.y,fi=tr<Hr?tr<Br?tr:Br:Hr<Br?Hr:Br,Vn=Bn<tn?Bn<gn?Bn:gn:tn<gn?tn:gn,vn=tr>Hr?tr>Br?tr:Br:Hr>Br?Hr:Br,bi=Bn>tn?Bn>gn?Bn:gn:tn>gn?tn:gn,Mi=Kt(fi,Vn,H,be,tt),Ei=Kt(vn,bi,H,be,tt),Gn=V.prevZ,kn=V.nextZ;Gn&&Gn.z>=Mi&&kn&&kn.z<=Ei;){if(Gn.x>=fi&&Gn.x<=vn&&Gn.y>=Vn&&Gn.y<=bi&&Gn!==ht&&Gn!==jt&&nr(tr,Bn,Hr,tn,Br,gn,Gn.x,Gn.y)&&bt(Gn.prev,Gn,Gn.next)>=0||(Gn=Gn.prevZ,kn.x>=fi&&kn.x<=vn&&kn.y>=Vn&&kn.y<=bi&&kn!==ht&&kn!==jt&&nr(tr,Bn,Hr,tn,Br,gn,kn.x,kn.y)&&bt(kn.prev,kn,kn.next)>=0))return!1;kn=kn.nextZ}for(;Gn&&Gn.z>=Mi;){if(Gn.x>=fi&&Gn.x<=vn&&Gn.y>=Vn&&Gn.y<=bi&&Gn!==ht&&Gn!==jt&&nr(tr,Bn,Hr,tn,Br,gn,Gn.x,Gn.y)&&bt(Gn.prev,Gn,Gn.next)>=0)return!1;Gn=Gn.prevZ}for(;kn&&kn.z<=Ei;){if(kn.x>=fi&&kn.x<=vn&&kn.y>=Vn&&kn.y<=bi&&kn!==ht&&kn!==jt&&nr(tr,Bn,Hr,tn,Br,gn,kn.x,kn.y)&&bt(kn.prev,kn,kn.next)>=0)return!1;kn=kn.nextZ}return!0}function U(V,H,be){var tt=V;do{var ht=tt.prev,St=tt.next.next;!vt(ht,St)&&Dr(ht,tt,tt.next,St)&&nt(ht,St)&&nt(St,ht)&&(H.push(ht.i/be|0),H.push(tt.i/be|0),H.push(St.i/be|0),_r(tt),_r(tt.next),tt=V=St),tt=tt.next}while(tt!==V);return ye(tt)}function ce(V,H,be,tt,ht,St){var jt=V;do{for(var tr=jt.next.next;tr!==jt.prev;){if(jt.i!==tr.i&&Jt(jt,tr)){var Hr=lt(jt,tr);jt=ye(jt,jt.next),Hr=ye(Hr,Hr.next),ee(jt,H,be,tt,ht,St,0),ee(Hr,H,be,tt,ht,St,0);return}tr=tr.next}jt=jt.next}while(jt!==V)}function oe(V,H,be,tt){var ht=[],St,jt,tr,Hr,Br;for(St=0,jt=H.length;St<jt;St++)tr=H[St]*tt,Hr=St<jt-1?H[St+1]*tt:V.length,Br=N(V,tr,Hr,tt,!1),Br===Br.next&&(Br.steiner=!0),ht.push(Yt(Br));for(ht.sort(Ue),St=0;St<ht.length;St++)be=se(ht[St],be);return be}function Ue(V,H){return V.x-H.x}function se(V,H){var be=ze(V,H);if(!be)return H;var tt=lt(be,V);return ye(tt,tt.next),ye(be,be.next)}function ze(V,H){var be=H,tt=V.x,ht=V.y,St=-Infinity,jt;do{if(ht<=be.y&&ht>=be.next.y&&be.next.y!==be.y){var tr=be.x+(ht-be.y)*(be.next.x-be.x)/(be.next.y-be.y);if(tr<=tt&&tr>St&&(St=tr,jt=be.x<be.next.x?be:be.next,tr===tt))return jt}be=be.next}while(be!==H);if(!jt)return null;var Hr=jt,Br=jt.x,Bn=jt.y,tn=Infinity,gn;be=jt;do tt>=be.x&&be.x>=Br&&tt!==be.x&&nr(ht<Bn?tt:St,ht,Br,Bn,ht<Bn?St:tt,ht,be.x,be.y)&&(gn=Math.abs(ht-be.y)/(tt-be.x),nt(be,V)&&(gn<tn||gn===tn&&(be.x>jt.x||be.x===jt.x&&et(jt,be)))&&(jt=be,tn=gn)),be=be.next;while(be!==Hr);return jt}function et(V,H){return bt(V.prev,V,H.prev)<0&&bt(H.next,V,V.next)<0}function ut(V,H,be,tt){var ht=V;do ht.z===0&&(ht.z=Kt(ht.x,ht.y,H,be,tt)),ht.prevZ=ht.prev,ht.nextZ=ht.next,ht=ht.next;while(ht!==V);ht.prevZ.nextZ=null,ht.prevZ=null,Ct(ht)}function Ct(V){var H,be,tt,ht,St,jt,tr,Hr,Br=1;do{for(be=V,V=null,St=null,jt=0;be;){for(jt++,tt=be,tr=0,H=0;H<Br&&(tr++,tt=tt.nextZ,!!tt);H++);for(Hr=Br;tr>0||Hr>0&&tt;)tr!==0&&(Hr===0||!tt||be.z<=tt.z)?(ht=be,be=be.nextZ,tr--):(ht=tt,tt=tt.nextZ,Hr--),St?St.nextZ=ht:V=ht,ht.prevZ=St,St=ht;be=tt}St.nextZ=null,Br*=2}while(jt>1);return V}function Kt(V,H,be,tt,ht){return V=(V-be)*ht|0,H=(H-tt)*ht|0,V=(V|V<<8)&16711935,V=(V|V<<4)&252645135,V=(V|V<<2)&858993459,V=(V|V<<1)&1431655765,H=(H|H<<8)&16711935,H=(H|H<<4)&252645135,H=(H|H<<2)&858993459,H=(H|H<<1)&1431655765,V|H<<1}function Yt(V){var H=V,be=V;do(H.x<be.x||H.x===be.x&&H.y<be.y)&&(be=H),H=H.next;while(H!==V);return be}function nr(V,H,be,tt,ht,St,jt,tr){return(ht-jt)*(H-tr)>=(V-jt)*(St-tr)&&(V-jt)*(tt-tr)>=(be-jt)*(H-tr)&&(be-jt)*(St-tr)>=(ht-jt)*(tt-tr)}function Jt(V,H){return V.next.i!==H.i&&V.prev.i!==H.i&&!mt(V,H)&&(nt(V,H)&&nt(H,V)&&Lt(V,H)&&(bt(V.prev,V,H.prev)||bt(V,H.prev,H))||vt(V,H)&&bt(V.prev,V,V.next)>0&&bt(H.prev,H,H.next)>0)}function bt(V,H,be){return(H.y-V.y)*(be.x-H.x)-(H.x-V.x)*(be.y-H.y)}function vt(V,H){return V.x===H.x&&V.y===H.y}function Dr(V,H,be,tt){var ht=sr(bt(V,H,be)),St=sr(bt(V,H,tt)),jt=sr(bt(be,tt,V)),tr=sr(bt(be,tt,H));return!!(ht!==St&&jt!==tr||ht===0&&fr(V,be,H)||St===0&&fr(V,tt,H)||jt===0&&fr(be,V,tt)||tr===0&&fr(be,H,tt))}function fr(V,H,be){return H.x<=Math.max(V.x,be.x)&&H.x>=Math.min(V.x,be.x)&&H.y<=Math.max(V.y,be.y)&&H.y>=Math.min(V.y,be.y)}function sr(V){return V>0?1:V<0?-1:0}function mt(V,H){var be=V;do{if(be.i!==V.i&&be.next.i!==V.i&&be.i!==H.i&&be.next.i!==H.i&&Dr(be,be.next,V,H))return!0;be=be.next}while(be!==V);return!1}function nt(V,H){return bt(V.prev,V,V.next)<0?bt(V,H,V.next)>=0&&bt(V,V.prev,H)>=0:bt(V,H,V.prev)<0||bt(V,V.next,H)<0}function Lt(V,H){var be=V,tt=!1,ht=(V.x+H.x)/2,St=(V.y+H.y)/2;do be.y>St!=be.next.y>St&&be.next.y!==be.y&&ht<(be.next.x-be.x)*(St-be.y)/(be.next.y-be.y)+be.x&&(tt=!tt),be=be.next;while(be!==V);return tt}function lt(V,H){var be=new J(V.i,V.x,V.y),tt=new J(H.i,H.x,H.y),ht=V.next,St=H.prev;return V.next=H,H.prev=V,be.next=ht,ht.prev=be,tt.next=be,be.prev=tt,St.next=tt,tt.prev=St,tt}function Xt(V,H,be,tt){var ht=new J(V,H,be);return tt?(ht.next=tt.next,ht.prev=tt,tt.next.prev=ht,tt.next=ht):(ht.prev=ht,ht.next=ht),ht}function _r(V){V.next.prev=V.prev,V.prev.next=V.next,V.prevZ&&(V.prevZ.nextZ=V.nextZ),V.nextZ&&(V.nextZ.prevZ=V.prevZ)}function J(V,H,be){this.i=V,this.x=H,this.y=be,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}te.deviation=function(V,H,be,tt){var ht=H&&H.length,St=ht?H[0]*be:V.length,jt=Math.abs(Ie(V,0,St,be));if(ht)for(var tr=0,Hr=H.length;tr<Hr;tr++){var Br=H[tr]*be,Bn=tr<Hr-1?H[tr+1]*be:V.length;jt-=Math.abs(Ie(V,Br,Bn,be))}var tn=0;for(tr=0;tr<tt.length;tr+=3){var gn=tt[tr]*be,fi=tt[tr+1]*be,Vn=tt[tr+2]*be;tn+=Math.abs((V[gn]-V[Vn])*(V[fi+1]-V[gn+1])-(V[gn]-V[fi])*(V[Vn+1]-V[gn+1]))}return jt===0&&tn===0?0:Math.abs((tn-jt)/jt)};function Ie(V,H,be,tt){for(var ht=0,St=H,jt=be-tt;St<be;St+=tt)ht+=(V[jt]-V[St])*(V[St+1]+V[jt+1]),jt=St;return ht}te.flatten=function(V){for(var H=V[0][0].length,be={vertices:[],holes:[],dimensions:H},tt=0,ht=0;ht<V.length;ht++){for(var St=0;St<V[ht].length;St++)for(var jt=0;jt<H;jt++)be.vertices.push(V[ht][St][jt]);ht>0&&(tt+=V[ht-1].length,be.holes.push(tt))}return be}},67709:function(Sr){function te(ye){var ee=ye.target||ye.srcElement;ee.__resizeRAF__&&cancelAnimationFrame(ee.__resizeRAF__),ee.__resizeRAF__=requestAnimationFrame(function(){var y=ee.__resizeTrigger__,le=y&&y.__resizeListeners__;le&&le.forEach(function(U){U.call(y,ye)})})}var N=function(ee,y){var le=this,U=le.document,ce,oe=U.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ue(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",te)}if(!ee.__resizeListeners__)if(ee.__resizeListeners__=[],oe)ee.__resizeTrigger__=ee,ee.attachEvent("onresize",te);else{getComputedStyle(ee).position==="static"&&(ee.style.position="relative");var se=ee.__resizeTrigger__=U.createElement("object");se.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),se.setAttribute("class","resize-sensor"),se.setAttribute("tabindex","-1"),se.setAttribute("title",""),se.__resizeElement__=ee,se.onload=Ue,se.type="text/html",ce&&ee.appendChild(se),se.data="about:blank",ce||ee.appendChild(se)}ee.__resizeListeners__.push(y)};Sr.exports=typeof window=="undefined"?N:N.bind(window),Sr.exports.unbind=function(ye,ee){var y=document.attachEvent,le=ye.__resizeListeners__||[];if(ee){var U=le.indexOf(ee);U!==-1&&le.splice(U,1)}else le=ye.__resizeListeners__=[];if(!le.length){if(y)ye.detachEvent("onresize",te);else if(ye.__resizeTrigger__){var ce=ye.__resizeTrigger__.contentDocument,oe=ce&&ce.defaultView;oe&&(oe.removeEventListener("resize",te),delete oe.__resizeTrigger__),ye.__resizeTrigger__=!ye.removeChild(ye.__resizeTrigger__)}delete ye.__resizeListeners__}}},26729:function(Sr){"use strict";var te=Object.prototype.hasOwnProperty,N="~";function ye(){}Object.create&&(ye.prototype=Object.create(null),new ye().__proto__||(N=!1));function ee(ce,oe,Ue){this.fn=ce,this.context=oe,this.once=Ue||!1}function y(ce,oe,Ue,se,ze){if(typeof Ue!="function")throw new TypeError("The listener must be a function");var et=new ee(Ue,se||ce,ze),ut=N?N+oe:oe;return ce._events[ut]?ce._events[ut].fn?ce._events[ut]=[ce._events[ut],et]:ce._events[ut].push(et):(ce._events[ut]=et,ce._eventsCount++),ce}function le(ce,oe){--ce._eventsCount==0?ce._events=new ye:delete ce._events[oe]}function U(){this._events=new ye,this._eventsCount=0}U.prototype.eventNames=function(){var oe=[],Ue,se;if(this._eventsCount===0)return oe;for(se in Ue=this._events)te.call(Ue,se)&&oe.push(N?se.slice(1):se);return Object.getOwnPropertySymbols?oe.concat(Object.getOwnPropertySymbols(Ue)):oe},U.prototype.listeners=function(oe){var Ue=N?N+oe:oe,se=this._events[Ue];if(!se)return[];if(se.fn)return[se.fn];for(var ze=0,et=se.length,ut=new Array(et);ze<et;ze++)ut[ze]=se[ze].fn;return ut},U.prototype.listenerCount=function(oe){var Ue=N?N+oe:oe,se=this._events[Ue];return se?se.fn?1:se.length:0},U.prototype.emit=function(oe,Ue,se,ze,et,ut){var Ct=N?N+oe:oe;if(!this._events[Ct])return!1;var Kt=this._events[Ct],Yt=arguments.length,nr,Jt;if(Kt.fn){switch(Kt.once&&this.removeListener(oe,Kt.fn,void 0,!0),Yt){case 1:return Kt.fn.call(Kt.context),!0;case 2:return Kt.fn.call(Kt.context,Ue),!0;case 3:return Kt.fn.call(Kt.context,Ue,se),!0;case 4:return Kt.fn.call(Kt.context,Ue,se,ze),!0;case 5:return Kt.fn.call(Kt.context,Ue,se,ze,et),!0;case 6:return Kt.fn.call(Kt.context,Ue,se,ze,et,ut),!0}for(Jt=1,nr=new Array(Yt-1);Jt<Yt;Jt++)nr[Jt-1]=arguments[Jt];Kt.fn.apply(Kt.context,nr)}else{var bt=Kt.length,vt;for(Jt=0;Jt<bt;Jt++)switch(Kt[Jt].once&&this.removeListener(oe,Kt[Jt].fn,void 0,!0),Yt){case 1:Kt[Jt].fn.call(Kt[Jt].context);break;case 2:Kt[Jt].fn.call(Kt[Jt].context,Ue);break;case 3:Kt[Jt].fn.call(Kt[Jt].context,Ue,se);break;case 4:Kt[Jt].fn.call(Kt[Jt].context,Ue,se,ze);break;default:if(!nr)for(vt=1,nr=new Array(Yt-1);vt<Yt;vt++)nr[vt-1]=arguments[vt];Kt[Jt].fn.apply(Kt[Jt].context,nr)}}return!0},U.prototype.on=function(oe,Ue,se){return y(this,oe,Ue,se,!1)},U.prototype.once=function(oe,Ue,se){return y(this,oe,Ue,se,!0)},U.prototype.removeListener=function(oe,Ue,se,ze){var et=N?N+oe:oe;if(!this._events[et])return this;if(!Ue)return le(this,et),this;var ut=this._events[et];if(ut.fn)ut.fn===Ue&&(!ze||ut.once)&&(!se||ut.context===se)&&le(this,et);else{for(var Ct=0,Kt=[],Yt=ut.length;Ct<Yt;Ct++)(ut[Ct].fn!==Ue||ze&&!ut[Ct].once||se&&ut[Ct].context!==se)&&Kt.push(ut[Ct]);Kt.length?this._events[et]=Kt.length===1?Kt[0]:Kt:le(this,et)}return this},U.prototype.removeAllListeners=function(oe){var Ue;return oe?(Ue=N?N+oe:oe,this._events[Ue]&&le(this,Ue)):(this._events=new ye,this._eventsCount=0),this},U.prototype.off=U.prototype.removeListener,U.prototype.addListener=U.prototype.on,U.prefixed=N,U.EventEmitter=U,Sr.exports=U},50840:function(Sr,te,N){var ye;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ee,y,le,U){"use strict";var ce=["","webkit","Moz","MS","ms","o"],oe=y.createElement("div"),Ue="function",se=Math.round,ze=Math.abs,et=Date.now;function ut(j,P,rt){return setTimeout(Dr(j,rt),P)}function Ct(j,P,rt){return Array.isArray(j)?(Kt(j,rt[P],rt),!0):!1}function Kt(j,P,rt){var qt;if(!!j)if(j.forEach)j.forEach(P,rt);else if(j.length!==U)for(qt=0;qt<j.length;)P.call(rt,j[qt],qt,j),qt++;else for(qt in j)j.hasOwnProperty(qt)&&P.call(rt,j[qt],qt,j)}function Yt(j,P,rt){var qt="DEPRECATED METHOD: "+P+`
`+rt+` AT 
`;return function(){var jr=new Error("get-stack-trace"),Tn=jr&&jr.stack?jr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ri=ee.console&&(ee.console.warn||ee.console.log);return Ri&&Ri.call(ee.console,qt,Tn),j.apply(this,arguments)}}var nr;typeof Object.assign!="function"?nr=function(P){if(P===U||P===null)throw new TypeError("Cannot convert undefined or null to object");for(var rt=Object(P),qt=1;qt<arguments.length;qt++){var jr=arguments[qt];if(jr!==U&&jr!==null)for(var Tn in jr)jr.hasOwnProperty(Tn)&&(rt[Tn]=jr[Tn])}return rt}:nr=Object.assign;var Jt=Yt(function(P,rt,qt){for(var jr=Object.keys(rt),Tn=0;Tn<jr.length;)(!qt||qt&&P[jr[Tn]]===U)&&(P[jr[Tn]]=rt[jr[Tn]]),Tn++;return P},"extend","Use `assign`."),bt=Yt(function(P,rt){return Jt(P,rt,!0)},"merge","Use `assign`.");function vt(j,P,rt){var qt=P.prototype,jr;jr=j.prototype=Object.create(qt),jr.constructor=j,jr._super=qt,rt&&nr(jr,rt)}function Dr(j,P){return function(){return j.apply(P,arguments)}}function fr(j,P){return typeof j==Ue?j.apply(P&&P[0]||U,P):j}function sr(j,P){return j===U?P:j}function mt(j,P,rt){Kt(Xt(P),function(qt){j.addEventListener(qt,rt,!1)})}function nt(j,P,rt){Kt(Xt(P),function(qt){j.removeEventListener(qt,rt,!1)})}function Lt(j,P){for(;j;){if(j==P)return!0;j=j.parentNode}return!1}function lt(j,P){return j.indexOf(P)>-1}function Xt(j){return j.trim().split(/\s+/g)}function _r(j,P,rt){if(j.indexOf&&!rt)return j.indexOf(P);for(var qt=0;qt<j.length;){if(rt&&j[qt][rt]==P||!rt&&j[qt]===P)return qt;qt++}return-1}function J(j){return Array.prototype.slice.call(j,0)}function Ie(j,P,rt){for(var qt=[],jr=[],Tn=0;Tn<j.length;){var Ri=P?j[Tn][P]:j[Tn];_r(jr,Ri)<0&&qt.push(j[Tn]),jr[Tn]=Ri,Tn++}return rt&&(P?qt=qt.sort(function(so,Ha){return so[P]>Ha[P]}):qt=qt.sort()),qt}function V(j,P){for(var rt,qt,jr=P[0].toUpperCase()+P.slice(1),Tn=0;Tn<ce.length;){if(rt=ce[Tn],qt=rt?rt+jr:P,qt in j)return qt;Tn++}return U}var H=1;function be(){return H++}function tt(j){var P=j.ownerDocument||j;return P.defaultView||P.parentWindow||ee}var ht=/mobile|tablet|ip(ad|hone|od)|android/i,St="ontouchstart"in ee,jt=V(ee,"PointerEvent")!==U,tr=St&&ht.test(navigator.userAgent),Hr="touch",Br="pen",Bn="mouse",tn="kinect",gn=25,fi=1,Vn=2,vn=4,bi=8,Mi=1,Ei=2,Gn=4,kn=8,mo=16,Hi=Ei|Gn,ja=kn|mo,Tt=Hi|ja,R=["x","y"],ne=["clientX","clientY"];function fe(j,P){var rt=this;this.manager=j,this.callback=P,this.element=j.element,this.target=j.options.inputTarget,this.domHandler=function(qt){fr(j.options.enable,[j])&&rt.handler(qt)},this.init()}fe.prototype={handler:function(){},init:function(){this.evEl&&mt(this.element,this.evEl,this.domHandler),this.evTarget&&mt(this.target,this.evTarget,this.domHandler),this.evWin&&mt(tt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&nt(this.element,this.evEl,this.domHandler),this.evTarget&&nt(this.target,this.evTarget,this.domHandler),this.evWin&&nt(tt(this.element),this.evWin,this.domHandler)}};function Fe(j){var P,rt=j.options.inputClass;return rt?P=rt:jt?P=K:tr?P=wt:St?P=mr:P=$i,new P(j,ct)}function ct(j,P,rt){var qt=rt.pointers.length,jr=rt.changedPointers.length,Tn=P&fi&&qt-jr==0,Ri=P&(vn|bi)&&qt-jr==0;rt.isFirst=!!Tn,rt.isFinal=!!Ri,Tn&&(j.session={}),rt.eventType=P,zt(j,rt),j.emit("hammer.input",rt),j.recognize(rt),j.session.prevInput=rt}function zt(j,P){var rt=j.session,qt=P.pointers,jr=qt.length;rt.firstInput||(rt.firstInput=Et(P)),jr>1&&!rt.firstMultiple?rt.firstMultiple=Et(P):jr===1&&(rt.firstMultiple=!1);var Tn=rt.firstInput,Ri=rt.firstMultiple,Fa=Ri?Ri.center:Tn.center,so=P.center=ir(qt);P.timeStamp=et(),P.deltaTime=P.timeStamp-Tn.timeStamp,P.angle=Sn(Fa,so),P.distance=yn(Fa,so),Er(rt,P),P.offsetDirection=Wr(P.deltaX,P.deltaY);var Ha=xr(P.deltaTime,P.deltaX,P.deltaY);P.overallVelocityX=Ha.x,P.overallVelocityY=Ha.y,P.overallVelocity=ze(Ha.x)>ze(Ha.y)?Ha.x:Ha.y,P.scale=Ri?pn(Ri.pointers,qt):1,P.rotation=Ri?En(Ri.pointers,qt):0,P.maxPointers=rt.prevInput?P.pointers.length>rt.prevInput.maxPointers?P.pointers.length:rt.prevInput.maxPointers:P.pointers.length,Ne(rt,P);var as=j.element;Lt(P.srcEvent.target,as)&&(as=P.srcEvent.target),P.target=as}function Er(j,P){var rt=P.center,qt=j.offsetDelta||{},jr=j.prevDelta||{},Tn=j.prevInput||{};(P.eventType===fi||Tn.eventType===vn)&&(jr=j.prevDelta={x:Tn.deltaX||0,y:Tn.deltaY||0},qt=j.offsetDelta={x:rt.x,y:rt.y}),P.deltaX=jr.x+(rt.x-qt.x),P.deltaY=jr.y+(rt.y-qt.y)}function Ne(j,P){var rt=j.lastInterval||P,qt=P.timeStamp-rt.timeStamp,jr,Tn,Ri,Fa;if(P.eventType!=bi&&(qt>gn||rt.velocity===U)){var so=P.deltaX-rt.deltaX,Ha=P.deltaY-rt.deltaY,as=xr(qt,so,Ha);Tn=as.x,Ri=as.y,jr=ze(as.x)>ze(as.y)?as.x:as.y,Fa=Wr(so,Ha),j.lastInterval=P}else jr=rt.velocity,Tn=rt.velocityX,Ri=rt.velocityY,Fa=rt.direction;P.velocity=jr,P.velocityX=Tn,P.velocityY=Ri,P.direction=Fa}function Et(j){for(var P=[],rt=0;rt<j.pointers.length;)P[rt]={clientX:se(j.pointers[rt].clientX),clientY:se(j.pointers[rt].clientY)},rt++;return{timeStamp:et(),pointers:P,center:ir(P),deltaX:j.deltaX,deltaY:j.deltaY}}function ir(j){var P=j.length;if(P===1)return{x:se(j[0].clientX),y:se(j[0].clientY)};for(var rt=0,qt=0,jr=0;jr<P;)rt+=j[jr].clientX,qt+=j[jr].clientY,jr++;return{x:se(rt/P),y:se(qt/P)}}function xr(j,P,rt){return{x:P/j||0,y:rt/j||0}}function Wr(j,P){return j===P?Mi:ze(j)>=ze(P)?j<0?Ei:Gn:P<0?kn:mo}function yn(j,P,rt){rt||(rt=R);var qt=P[rt[0]]-j[rt[0]],jr=P[rt[1]]-j[rt[1]];return Math.sqrt(qt*qt+jr*jr)}function Sn(j,P,rt){rt||(rt=R);var qt=P[rt[0]]-j[rt[0]],jr=P[rt[1]]-j[rt[1]];return Math.atan2(jr,qt)*180/Math.PI}function En(j,P){return Sn(P[1],P[0],ne)+Sn(j[1],j[0],ne)}function pn(j,P){return yn(P[0],P[1],ne)/yn(j[0],j[1],ne)}var Kn={mousedown:fi,mousemove:Vn,mouseup:vn},Nn="mousedown",Ji="mousemove mouseup";function $i(){this.evEl=Nn,this.evWin=Ji,this.pressed=!1,fe.apply(this,arguments)}vt($i,fe,{handler:function(P){var rt=Kn[P.type];rt&fi&&P.button===0&&(this.pressed=!0),rt&Vn&&P.which!==1&&(rt=vn),!!this.pressed&&(rt&vn&&(this.pressed=!1),this.callback(this.manager,rt,{pointers:[P],changedPointers:[P],pointerType:Bn,srcEvent:P}))}});var go={pointerdown:fi,pointermove:Vn,pointerup:vn,pointercancel:bi,pointerout:bi},rs={2:Hr,3:Br,4:Bn,5:tn},qi="pointerdown",W="pointermove pointerup pointercancel";ee.MSPointerEvent&&!ee.PointerEvent&&(qi="MSPointerDown",W="MSPointerMove MSPointerUp MSPointerCancel");function K(){this.evEl=qi,this.evWin=W,fe.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}vt(K,fe,{handler:function(P){var rt=this.store,qt=!1,jr=P.type.toLowerCase().replace("ms",""),Tn=go[jr],Ri=rs[P.pointerType]||P.pointerType,Fa=Ri==Hr,so=_r(rt,P.pointerId,"pointerId");Tn&fi&&(P.button===0||Fa)?so<0&&(rt.push(P),so=rt.length-1):Tn&(vn|bi)&&(qt=!0),!(so<0)&&(rt[so]=P,this.callback(this.manager,Tn,{pointers:rt,changedPointers:[P],pointerType:Ri,srcEvent:P}),qt&&rt.splice(so,1))}});var ie={touchstart:fi,touchmove:Vn,touchend:vn,touchcancel:bi},_e="touchstart",Le="touchstart touchmove touchend touchcancel";function Ke(){this.evTarget=_e,this.evWin=Le,this.started=!1,fe.apply(this,arguments)}vt(Ke,fe,{handler:function(P){var rt=ie[P.type];if(rt===fi&&(this.started=!0),!!this.started){var qt=it.call(this,P,rt);rt&(vn|bi)&&qt[0].length-qt[1].length==0&&(this.started=!1),this.callback(this.manager,rt,{pointers:qt[0],changedPointers:qt[1],pointerType:Hr,srcEvent:P})}}});function it(j,P){var rt=J(j.touches),qt=J(j.changedTouches);return P&(vn|bi)&&(rt=Ie(rt.concat(qt),"identifier",!0)),[rt,qt]}var he={touchstart:fi,touchmove:Vn,touchend:vn,touchcancel:bi},Oe="touchstart touchmove touchend touchcancel";function wt(){this.evTarget=Oe,this.targetIds={},fe.apply(this,arguments)}vt(wt,fe,{handler:function(P){var rt=he[P.type],qt=br.call(this,P,rt);!qt||this.callback(this.manager,rt,{pointers:qt[0],changedPointers:qt[1],pointerType:Hr,srcEvent:P})}});function br(j,P){var rt=J(j.touches),qt=this.targetIds;if(P&(fi|Vn)&&rt.length===1)return qt[rt[0].identifier]=!0,[rt,rt];var jr,Tn,Ri=J(j.changedTouches),Fa=[],so=this.target;if(Tn=rt.filter(function(Ha){return Lt(Ha.target,so)}),P===fi)for(jr=0;jr<Tn.length;)qt[Tn[jr].identifier]=!0,jr++;for(jr=0;jr<Ri.length;)qt[Ri[jr].identifier]&&Fa.push(Ri[jr]),P&(vn|bi)&&delete qt[Ri[jr].identifier],jr++;if(!!Fa.length)return[Ie(Tn.concat(Fa),"identifier",!0),Fa]}var Mr=2500,Rt=25;function mr(){fe.apply(this,arguments);var j=Dr(this.handler,this);this.touch=new wt(this.manager,j),this.mouse=new $i(this.manager,j),this.primaryTouch=null,this.lastTouches=[]}vt(mr,fe,{handler:function(P,rt,qt){var jr=qt.pointerType==Hr,Tn=qt.pointerType==Bn;if(!(Tn&&qt.sourceCapabilities&&qt.sourceCapabilities.firesTouchEvents)){if(jr)mn.call(this,rt,qt);else if(Tn&&Qt.call(this,qt))return;this.callback(P,rt,qt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function mn(j,P){j&fi?(this.primaryTouch=P.changedPointers[0].identifier,sn.call(this,P)):j&(vn|bi)&&sn.call(this,P)}function sn(j){var P=j.changedPointers[0];if(P.identifier===this.primaryTouch){var rt={x:P.clientX,y:P.clientY};this.lastTouches.push(rt);var qt=this.lastTouches,jr=function(){var Tn=qt.indexOf(rt);Tn>-1&&qt.splice(Tn,1)};setTimeout(jr,Mr)}}function Qt(j){for(var P=j.srcEvent.clientX,rt=j.srcEvent.clientY,qt=0;qt<this.lastTouches.length;qt++){var jr=this.lastTouches[qt],Tn=Math.abs(P-jr.x),Ri=Math.abs(rt-jr.y);if(Tn<=Rt&&Ri<=Rt)return!0}return!1}var je=V(oe.style,"touchAction"),qr=je!==U,Q="compute",ri="auto",en="manipulation",Jn="none",Zi="pan-x",ni="pan-y",Ii=Fi();function hi(j,P){this.manager=j,this.set(P)}hi.prototype={set:function(j){j==Q&&(j=this.compute()),qr&&this.manager.element.style&&Ii[j]&&(this.manager.element.style[je]=j),this.actions=j.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var j=[];return Kt(this.manager.recognizers,function(P){fr(P.options.enable,[P])&&(j=j.concat(P.getTouchAction()))}),yo(j.join(" "))},preventDefaults:function(j){var P=j.srcEvent,rt=j.offsetDirection;if(this.manager.session.prevented){P.preventDefault();return}var qt=this.actions,jr=lt(qt,Jn)&&!Ii[Jn],Tn=lt(qt,ni)&&!Ii[ni],Ri=lt(qt,Zi)&&!Ii[Zi];if(jr){var Fa=j.pointers.length===1,so=j.distance<2,Ha=j.deltaTime<250;if(Fa&&so&&Ha)return}if(!(Ri&&Tn)&&(jr||Tn&&rt&Hi||Ri&&rt&ja))return this.preventSrc(P)},preventSrc:function(j){this.manager.session.prevented=!0,j.preventDefault()}};function yo(j){if(lt(j,Jn))return Jn;var P=lt(j,Zi),rt=lt(j,ni);return P&&rt?Jn:P||rt?P?Zi:ni:lt(j,en)?en:ri}function Fi(){if(!qr)return!1;var j={},P=ee.CSS&&ee.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(rt){j[rt]=P?ee.CSS.supports("touch-action",rt):!0}),j}var ea=1,vi=2,si=4,Qn=8,ba=Qn,Is=16,Qi=32;function fa(j){this.options=nr({},this.defaults,j||{}),this.id=be(),this.manager=null,this.options.enable=sr(this.options.enable,!0),this.state=ea,this.simultaneous={},this.requireFail=[]}fa.prototype={defaults:{},set:function(j){return nr(this.options,j),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(j){if(Ct(j,"recognizeWith",this))return this;var P=this.simultaneous;return j=sa(j,this),P[j.id]||(P[j.id]=j,j.recognizeWith(this)),this},dropRecognizeWith:function(j){return Ct(j,"dropRecognizeWith",this)?this:(j=sa(j,this),delete this.simultaneous[j.id],this)},requireFailure:function(j){if(Ct(j,"requireFailure",this))return this;var P=this.requireFail;return j=sa(j,this),_r(P,j)===-1&&(P.push(j),j.requireFailure(this)),this},dropRequireFailure:function(j){if(Ct(j,"dropRequireFailure",this))return this;j=sa(j,this);var P=_r(this.requireFail,j);return P>-1&&this.requireFail.splice(P,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(j){return!!this.simultaneous[j.id]},emit:function(j){var P=this,rt=this.state;function qt(jr){P.manager.emit(jr,j)}rt<Qn&&qt(P.options.event+Ou(rt)),qt(P.options.event),j.additionalEvent&&qt(j.additionalEvent),rt>=Qn&&qt(P.options.event+Ou(rt))},tryEmit:function(j){if(this.canEmit())return this.emit(j);this.state=Qi},canEmit:function(){for(var j=0;j<this.requireFail.length;){if(!(this.requireFail[j].state&(Qi|ea)))return!1;j++}return!0},recognize:function(j){var P=nr({},j);if(!fr(this.options.enable,[this,P])){this.reset(),this.state=Qi;return}this.state&(ba|Is|Qi)&&(this.state=ea),this.state=this.process(P),this.state&(vi|si|Qn|Is)&&this.tryEmit(P)},process:function(j){},getTouchAction:function(){},reset:function(){}};function Ou(j){return j&Is?"cancel":j&Qn?"end":j&si?"move":j&vi?"start":""}function Du(j){return j==mo?"down":j==kn?"up":j==Ei?"left":j==Gn?"right":""}function sa(j,P){var rt=P.manager;return rt?rt.get(j):j}function oo(){fa.apply(this,arguments)}vt(oo,fa,{defaults:{pointers:1},attrTest:function(j){var P=this.options.pointers;return P===0||j.pointers.length===P},process:function(j){var P=this.state,rt=j.eventType,qt=P&(vi|si),jr=this.attrTest(j);return qt&&(rt&bi||!jr)?P|Is:qt||jr?rt&vn?P|Qn:P&vi?P|si:vi:Qi}});function Oa(){oo.apply(this,arguments),this.pX=null,this.pY=null}vt(Oa,oo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Tt},getTouchAction:function(){var j=this.options.direction,P=[];return j&Hi&&P.push(ni),j&ja&&P.push(Zi),P},directionTest:function(j){var P=this.options,rt=!0,qt=j.distance,jr=j.direction,Tn=j.deltaX,Ri=j.deltaY;return jr&P.direction||(P.direction&Hi?(jr=Tn===0?Mi:Tn<0?Ei:Gn,rt=Tn!=this.pX,qt=Math.abs(j.deltaX)):(jr=Ri===0?Mi:Ri<0?kn:mo,rt=Ri!=this.pY,qt=Math.abs(j.deltaY))),j.direction=jr,rt&&qt>P.threshold&&jr&P.direction},attrTest:function(j){return oo.prototype.attrTest.call(this,j)&&(this.state&vi||!(this.state&vi)&&this.directionTest(j))},emit:function(j){this.pX=j.deltaX,this.pY=j.deltaY;var P=Du(j.direction);P&&(j.additionalEvent=this.options.event+P),this._super.emit.call(this,j)}});function Sa(){oo.apply(this,arguments)}vt(Sa,oo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Jn]},attrTest:function(j){return this._super.attrTest.call(this,j)&&(Math.abs(j.scale-1)>this.options.threshold||this.state&vi)},emit:function(j){if(j.scale!==1){var P=j.scale<1?"in":"out";j.additionalEvent=this.options.event+P}this._super.emit.call(this,j)}});function Ro(){fa.apply(this,arguments),this._timer=null,this._input=null}vt(Ro,fa,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ri]},process:function(j){var P=this.options,rt=j.pointers.length===P.pointers,qt=j.distance<P.threshold,jr=j.deltaTime>P.time;if(this._input=j,!qt||!rt||j.eventType&(vn|bi)&&!jr)this.reset();else if(j.eventType&fi)this.reset(),this._timer=ut(function(){this.state=ba,this.tryEmit()},P.time,this);else if(j.eventType&vn)return ba;return Qi},reset:function(){clearTimeout(this._timer)},emit:function(j){this.state===ba&&(j&&j.eventType&vn?this.manager.emit(this.options.event+"up",j):(this._input.timeStamp=et(),this.manager.emit(this.options.event,this._input)))}});function Vi(){oo.apply(this,arguments)}vt(Vi,oo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Jn]},attrTest:function(j){return this._super.attrTest.call(this,j)&&(Math.abs(j.rotation)>this.options.threshold||this.state&vi)}});function Oo(){oo.apply(this,arguments)}vt(Oo,oo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Hi|ja,pointers:1},getTouchAction:function(){return Oa.prototype.getTouchAction.call(this)},attrTest:function(j){var P=this.options.direction,rt;return P&(Hi|ja)?rt=j.overallVelocity:P&Hi?rt=j.overallVelocityX:P&ja&&(rt=j.overallVelocityY),this._super.attrTest.call(this,j)&&P&j.offsetDirection&&j.distance>this.options.threshold&&j.maxPointers==this.options.pointers&&ze(rt)>this.options.velocity&&j.eventType&vn},emit:function(j){var P=Du(j.offsetDirection);P&&this.manager.emit(this.options.event+P,j),this.manager.emit(this.options.event,j)}});function _o(){fa.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}vt(_o,fa,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[en]},process:function(j){var P=this.options,rt=j.pointers.length===P.pointers,qt=j.distance<P.threshold,jr=j.deltaTime<P.time;if(this.reset(),j.eventType&fi&&this.count===0)return this.failTimeout();if(qt&&jr&&rt){if(j.eventType!=vn)return this.failTimeout();var Tn=this.pTime?j.timeStamp-this.pTime<P.interval:!0,Ri=!this.pCenter||yn(this.pCenter,j.center)<P.posThreshold;this.pTime=j.timeStamp,this.pCenter=j.center,!Ri||!Tn?this.count=1:this.count+=1,this._input=j;var Fa=this.count%P.taps;if(Fa===0)return this.hasRequireFailures()?(this._timer=ut(function(){this.state=ba,this.tryEmit()},P.interval,this),vi):ba}return Qi},failTimeout:function(){return this._timer=ut(function(){this.state=Qi},this.options.interval,this),Qi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ba&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ns(j,P){return P=P||{},P.recognizers=sr(P.recognizers,ns.defaults.preset),new Ho(j,P)}ns.VERSION="2.0.7",ns.defaults={domEvents:!1,touchAction:Q,enable:!0,inputTarget:null,inputClass:null,preset:[[Vi,{enable:!1}],[Sa,{enable:!1},["rotate"]],[Oo,{direction:Hi}],[Oa,{direction:Hi},["swipe"]],[_o],[_o,{event:"doubletap",taps:2},["tap"]],[Ro]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var is=1,Gc=2;function Ho(j,P){this.options=nr({},ns.defaults,P||{}),this.options.inputTarget=this.options.inputTarget||j,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=j,this.input=Fe(this),this.touchAction=new hi(this,this.options.touchAction),Da(this,!0),Kt(this.options.recognizers,function(rt){var qt=this.add(new rt[0](rt[1]));rt[2]&&qt.recognizeWith(rt[2]),rt[3]&&qt.requireFailure(rt[3])},this)}Ho.prototype={set:function(j){return nr(this.options,j),j.touchAction&&this.touchAction.update(),j.inputTarget&&(this.input.destroy(),this.input.target=j.inputTarget,this.input.init()),this},stop:function(j){this.session.stopped=j?Gc:is},recognize:function(j){var P=this.session;if(!P.stopped){this.touchAction.preventDefaults(j);var rt,qt=this.recognizers,jr=P.curRecognizer;(!jr||jr&&jr.state&ba)&&(jr=P.curRecognizer=null);for(var Tn=0;Tn<qt.length;)rt=qt[Tn],P.stopped!==Gc&&(!jr||rt==jr||rt.canRecognizeWith(jr))?rt.recognize(j):rt.reset(),!jr&&rt.state&(vi|si|Qn)&&(jr=P.curRecognizer=rt),Tn++}},get:function(j){if(j instanceof fa)return j;for(var P=this.recognizers,rt=0;rt<P.length;rt++)if(P[rt].options.event==j)return P[rt];return null},add:function(j){if(Ct(j,"add",this))return this;var P=this.get(j.options.event);return P&&this.remove(P),this.recognizers.push(j),j.manager=this,this.touchAction.update(),j},remove:function(j){if(Ct(j,"remove",this))return this;if(j=this.get(j),j){var P=this.recognizers,rt=_r(P,j);rt!==-1&&(P.splice(rt,1),this.touchAction.update())}return this},on:function(j,P){if(j!==U&&P!==U){var rt=this.handlers;return Kt(Xt(j),function(qt){rt[qt]=rt[qt]||[],rt[qt].push(P)}),this}},off:function(j,P){if(j!==U){var rt=this.handlers;return Kt(Xt(j),function(qt){P?rt[qt]&&rt[qt].splice(_r(rt[qt],P),1):delete rt[qt]}),this}},emit:function(j,P){this.options.domEvents&&Ga(j,P);var rt=this.handlers[j]&&this.handlers[j].slice();if(!(!rt||!rt.length)){P.type=j,P.preventDefault=function(){P.srcEvent.preventDefault()};for(var qt=0;qt<rt.length;)rt[qt](P),qt++}},destroy:function(){this.element&&Da(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Da(j,P){var rt=j.element;if(!!rt.style){var qt;Kt(j.options.cssProps,function(jr,Tn){qt=V(rt.style,Tn),P?(j.oldCssProps[qt]=rt.style[qt],rt.style[qt]=jr):rt.style[qt]=j.oldCssProps[qt]||""}),P||(j.oldCssProps={})}}function Ga(j,P){var rt=y.createEvent("Event");rt.initEvent(j,!0,!0),rt.gesture=P,P.target.dispatchEvent(rt)}nr(ns,{INPUT_START:fi,INPUT_MOVE:Vn,INPUT_END:vn,INPUT_CANCEL:bi,STATE_POSSIBLE:ea,STATE_BEGAN:vi,STATE_CHANGED:si,STATE_ENDED:Qn,STATE_RECOGNIZED:ba,STATE_CANCELLED:Is,STATE_FAILED:Qi,DIRECTION_NONE:Mi,DIRECTION_LEFT:Ei,DIRECTION_RIGHT:Gn,DIRECTION_UP:kn,DIRECTION_DOWN:mo,DIRECTION_HORIZONTAL:Hi,DIRECTION_VERTICAL:ja,DIRECTION_ALL:Tt,Manager:Ho,Input:fe,TouchAction:hi,TouchInput:wt,MouseInput:$i,PointerEventInput:K,TouchMouseInput:mr,SingleTouchInput:Ke,Recognizer:fa,AttrRecognizer:oo,Tap:_o,Pan:Oa,Swipe:Oo,Pinch:Sa,Rotate:Vi,Press:Ro,on:mt,off:nt,each:Kt,merge:bt,extend:Jt,assign:nr,inherit:vt,bindFn:Dr,prefixed:V});var Mt=typeof ee!="undefined"?ee:typeof self!="undefined"?self:{};Mt.Hammer=ns,ye=function(){return ns}.call(te,N,te,Sr),ye!==U&&(Sr.exports=ye)})(window,document,"Hammer")},80645:function(Sr,te){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */te.read=function(N,ye,ee,y,le){var U,ce,oe=le*8-y-1,Ue=(1<<oe)-1,se=Ue>>1,ze=-7,et=ee?le-1:0,ut=ee?-1:1,Ct=N[ye+et];for(et+=ut,U=Ct&(1<<-ze)-1,Ct>>=-ze,ze+=oe;ze>0;U=U*256+N[ye+et],et+=ut,ze-=8);for(ce=U&(1<<-ze)-1,U>>=-ze,ze+=y;ze>0;ce=ce*256+N[ye+et],et+=ut,ze-=8);if(U===0)U=1-se;else{if(U===Ue)return ce?NaN:(Ct?-1:1)*Infinity;ce=ce+Math.pow(2,y),U=U-se}return(Ct?-1:1)*ce*Math.pow(2,U-y)},te.write=function(N,ye,ee,y,le,U){var ce,oe,Ue,se=U*8-le-1,ze=(1<<se)-1,et=ze>>1,ut=le===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ct=y?0:U-1,Kt=y?1:-1,Yt=ye<0||ye===0&&1/ye<0?1:0;for(ye=Math.abs(ye),isNaN(ye)||ye===Infinity?(oe=isNaN(ye)?1:0,ce=ze):(ce=Math.floor(Math.log(ye)/Math.LN2),ye*(Ue=Math.pow(2,-ce))<1&&(ce--,Ue*=2),ce+et>=1?ye+=ut/Ue:ye+=ut*Math.pow(2,1-et),ye*Ue>=2&&(ce++,Ue/=2),ce+et>=ze?(oe=0,ce=ze):ce+et>=1?(oe=(ye*Ue-1)*Math.pow(2,le),ce=ce+et):(oe=ye*Math.pow(2,et-1)*Math.pow(2,le),ce=0));le>=8;N[ee+Ct]=oe&255,Ct+=Kt,oe/=256,le-=8);for(ce=ce<<le|oe,se+=le;se>0;N[ee+Ct]=ce&255,Ct+=Kt,ce/=256,se-=8);N[ee+Ct-Kt]|=Yt*128}},7375:function(Sr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0});var N=Symbol.for("INJECTION");function ye(ce,oe,Ue,se){function ze(){return se&&!Reflect.hasMetadata(N,this,oe)&&Reflect.defineMetadata(N,Ue(),this,oe),Reflect.hasMetadata(N,this,oe)?Reflect.getMetadata(N,this,oe):Ue()}function et(ut){Reflect.defineMetadata(N,ut,this,oe)}Object.defineProperty(ce,oe,{configurable:!0,enumerable:!0,get:ze,set:et})}function ee(ce,oe){return function(Ue){return function(se,ze){var et=function(){return ce.get(Ue)};ye(se,ze,et,oe)}}}te.makePropertyInjectDecorator=ee;function y(ce,oe){return function(Ue,se){return function(ze,et){var ut=function(){return ce.getNamed(Ue,se)};ye(ze,et,ut,oe)}}}te.makePropertyInjectNamedDecorator=y;function le(ce,oe){return function(Ue,se,ze){return function(et,ut){var Ct=function(){return ce.getTagged(Ue,se,ze)};ye(et,ut,Ct,oe)}}}te.makePropertyInjectTaggedDecorator=le;function U(ce,oe){return function(Ue){return function(se,ze){var et=function(){return ce.getAll(Ue)};ye(se,ze,et,oe)}}}te.makePropertyMultiInjectDecorator=U},84879:function(Sr,te,N){"use strict";var ye;ye={value:!0};var ee=N(7375);function y(le,U){U===void 0&&(U=!0);var ce=ee.makePropertyInjectDecorator(le,U),oe=ee.makePropertyInjectNamedDecorator(le,U),Ue=ee.makePropertyInjectTaggedDecorator(le,U),se=ee.makePropertyMultiInjectDecorator(le,U);return{lazyInject:ce,lazyInjectNamed:oe,lazyInjectTagged:Ue,lazyMultiInject:se}}te.Z=y},99934:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.tagProperty=te.tagParameter=te.decorate=void 0;var ye=N(16674),ee=N(6867);function y(se,ze,et,ut){var Ct=ee.TAGGED;U(Ct,se,ze,ut,et)}te.tagParameter=y;function le(se,ze,et){var ut=ee.TAGGED_PROP;U(ut,se.constructor,ze,et)}te.tagProperty=le;function U(se,ze,et,ut,Ct){var Kt={},Yt=typeof Ct=="number",nr=Ct!==void 0&&Yt?Ct.toString():et;if(Yt&&et!==void 0)throw new Error(ye.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(se,ze)&&(Kt=Reflect.getMetadata(se,ze));var Jt=Kt[nr];if(!Array.isArray(Jt))Jt=[];else for(var bt=0,vt=Jt;bt<vt.length;bt++){var Dr=vt[bt];if(Dr.key===ut.key)throw new Error(ye.DUPLICATED_METADATA+" "+Dr.key.toString())}Jt.push(ut),Kt[nr]=Jt,Reflect.defineMetadata(se,Kt,ze)}function ce(se,ze){Reflect.decorate(se,ze)}function oe(se,ze){return function(et,ut){ze(et,ut,se)}}function Ue(se,ze,et){typeof et=="number"?ce([oe(et,se)],ze):typeof et=="string"?Reflect.decorate([se],ze,et):ce([se],ze)}te.decorate=Ue},5744:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.inject=te.LazyServiceIdentifer=void 0;var ye=N(16674),ee=N(6867),y=N(47738),le=N(99934),U=function(){function oe(Ue){this._cb=Ue}return oe.prototype.unwrap=function(){return this._cb()},oe}();te.LazyServiceIdentifer=U;function ce(oe){return function(Ue,se,ze){if(oe===void 0)throw new Error(ye.UNDEFINED_INJECT_ANNOTATION(Ue.name));var et=new y.Metadata(ee.INJECT_TAG,oe);typeof ze=="number"?le.tagParameter(Ue,se,ze,et):le.tagProperty(Ue,se,et)}}te.inject=ce},64315:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.injectable=void 0;var ye=N(16674),ee=N(6867);function y(){return function(le){if(Reflect.hasOwnMetadata(ee.PARAM_TYPES,le))throw new Error(ye.DUPLICATED_INJECTABLE_DECORATOR);var U=Reflect.getMetadata(ee.DESIGN_PARAM_TYPES,le)||[];return Reflect.defineMetadata(ee.PARAM_TYPES,U,le),le}}te.injectable=y},71693:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.multiInject=void 0;var ye=N(6867),ee=N(47738),y=N(99934);function le(U){return function(ce,oe,Ue){var se=new ee.Metadata(ye.MULTI_INJECT_TAG,U);typeof Ue=="number"?y.tagParameter(ce,oe,Ue,se):y.tagProperty(ce,oe,se)}}te.multiInject=le},38085:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.named=void 0;var ye=N(6867),ee=N(47738),y=N(99934);function le(U){return function(ce,oe,Ue){var se=new ee.Metadata(ye.NAMED_TAG,U);typeof Ue=="number"?y.tagParameter(ce,oe,Ue,se):y.tagProperty(ce,oe,se)}}te.named=le},6515:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.optional=void 0;var ye=N(6867),ee=N(47738),y=N(99934);function le(){return function(U,ce,oe){var Ue=new ee.Metadata(ye.OPTIONAL_TAG,!0);typeof oe=="number"?y.tagParameter(U,ce,oe,Ue):y.tagProperty(U,ce,Ue)}}te.optional=le},7014:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.postConstruct=void 0;var ye=N(16674),ee=N(6867),y=N(47738);function le(){return function(U,ce,oe){var Ue=new y.Metadata(ee.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(ee.POST_CONSTRUCT,U.constructor))throw new Error(ye.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ee.POST_CONSTRUCT,Ue,U.constructor)}}te.postConstruct=le},32052:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.tagged=void 0;var ye=N(47738),ee=N(99934);function y(le,U){return function(ce,oe,Ue){var se=new ye.Metadata(le,U);typeof Ue=="number"?ee.tagParameter(ce,oe,Ue,se):ee.tagProperty(ce,oe,se)}}te.tagged=y},55638:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.targetName=void 0;var ye=N(6867),ee=N(47738),y=N(99934);function le(U){return function(ce,oe,Ue){var se=new ee.Metadata(ye.NAME_TAG,U);y.tagParameter(ce,oe,Ue,se)}}te.targetName=le},86757:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.unmanaged=void 0;var ye=N(6867),ee=N(47738),y=N(99934);function le(){return function(U,ce,oe){var Ue=new ee.Metadata(ye.UNMANAGED_TAG,!0);y.tagParameter(U,ce,oe,Ue)}}te.unmanaged=le},44290:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Binding=void 0;var ye=N(28421),ee=N(37791),y=function(){function le(U,ce){this.id=ee.id(),this.activated=!1,this.serviceIdentifier=U,this.scope=ce,this.type=ye.BindingTypeEnum.Invalid,this.constraint=function(oe){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return le.prototype.clone=function(){var U=new le(this.serviceIdentifier,this.scope);return U.activated=U.scope===ye.BindingScopeEnum.Singleton?this.activated:!1,U.implementationType=this.implementationType,U.dynamicValue=this.dynamicValue,U.scope=this.scope,U.type=this.type,U.factory=this.factory,U.provider=this.provider,U.constraint=this.constraint,U.onActivation=this.onActivation,U.cache=this.cache,U},le}();te.Binding=y},23184:function(Sr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingCount=void 0;var N={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};te.BindingCount=N},16674:function(Sr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.STACK_OVERFLOW=te.CIRCULAR_DEPENDENCY_IN_FACTORY=te.POST_CONSTRUCT_ERROR=te.MULTIPLE_POST_CONSTRUCT_METHODS=te.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=te.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=te.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=te.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=te.ARGUMENTS_LENGTH_MISMATCH=te.INVALID_DECORATOR_OPERATION=te.INVALID_TO_SELF_VALUE=te.INVALID_FUNCTION_BINDING=te.INVALID_MIDDLEWARE_RETURN=te.NO_MORE_SNAPSHOTS_AVAILABLE=te.INVALID_BINDING_TYPE=te.NOT_IMPLEMENTED=te.CIRCULAR_DEPENDENCY=te.UNDEFINED_INJECT_ANNOTATION=te.MISSING_INJECT_ANNOTATION=te.MISSING_INJECTABLE_ANNOTATION=te.NOT_REGISTERED=te.CANNOT_UNBIND=te.AMBIGUOUS_MATCH=te.KEY_NOT_FOUND=te.NULL_ARGUMENT=te.DUPLICATED_METADATA=te.DUPLICATED_INJECTABLE_DECORATOR=void 0,te.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",te.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",te.NULL_ARGUMENT="NULL argument",te.KEY_NOT_FOUND="Key Not Found",te.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",te.CANNOT_UNBIND="Could not unbind serviceIdentifier:",te.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",te.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",te.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var N=function(le){return"@inject called with undefined this could mean that the class "+le+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};te.UNDEFINED_INJECT_ANNOTATION=N,te.CIRCULAR_DEPENDENCY="Circular dependency found:",te.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",te.INVALID_BINDING_TYPE="Invalid binding type:",te.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",te.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",te.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",te.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",te.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ye=function(){for(var le=[],U=0;U<arguments.length;U++)le[U]=arguments[U];return"The number of constructor arguments in the derived class "+(le[0]+" must be >= than the number of constructor arguments of its base class.")};te.ARGUMENTS_LENGTH_MISMATCH=ye,te.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",te.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",te.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",te.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",te.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ee=function(){for(var le=[],U=0;U<arguments.length;U++)le[U]=arguments[U];return"@postConstruct error in class "+le[0]+": "+le[1]};te.POST_CONSTRUCT_ERROR=ee;var y=function(){for(var le=[],U=0;U<arguments.length;U++)le[U]=arguments[U];return"It looks like there is a circular dependency "+("in one of the '"+le[0]+"' bindings. Please investigate bindings with")+("service identifier '"+le[1]+"'.")};te.CIRCULAR_DEPENDENCY_IN_FACTORY=y,te.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Sr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.TargetTypeEnum=te.BindingTypeEnum=te.BindingScopeEnum=void 0;var N={Request:"Request",Singleton:"Singleton",Transient:"Transient"};te.BindingScopeEnum=N;var ye={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};te.BindingTypeEnum=ye;var ee={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};te.TargetTypeEnum=ee},6867:function(Sr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.NON_CUSTOM_TAG_KEYS=te.POST_CONSTRUCT=te.DESIGN_PARAM_TYPES=te.PARAM_TYPES=te.TAGGED_PROP=te.TAGGED=te.MULTI_INJECT_TAG=te.INJECT_TAG=te.OPTIONAL_TAG=te.UNMANAGED_TAG=te.NAME_TAG=te.NAMED_TAG=void 0,te.NAMED_TAG="named",te.NAME_TAG="name",te.UNMANAGED_TAG="unmanaged",te.OPTIONAL_TAG="optional",te.INJECT_TAG="inject",te.MULTI_INJECT_TAG="multi_inject",te.TAGGED="inversify:tagged",te.TAGGED_PROP="inversify:tagged_props",te.PARAM_TYPES="inversify:paramtypes",te.DESIGN_PARAM_TYPES="design:paramtypes",te.POST_CONSTRUCT="post_construct";function N(){return[te.INJECT_TAG,te.MULTI_INJECT_TAG,te.NAME_TAG,te.UNMANAGED_TAG,te.NAMED_TAG,te.OPTIONAL_TAG]}te.NON_CUSTOM_TAG_KEYS=N()},51389:function(Sr,te,N){"use strict";var ye=this&&this.__awaiter||function(Jt,bt,vt,Dr){function fr(sr){return sr instanceof vt?sr:new vt(function(mt){mt(sr)})}return new(vt||(vt=Promise))(function(sr,mt){function nt(Xt){try{lt(Dr.next(Xt))}catch(_r){mt(_r)}}function Lt(Xt){try{lt(Dr.throw(Xt))}catch(_r){mt(_r)}}function lt(Xt){Xt.done?sr(Xt.value):fr(Xt.value).then(nt,Lt)}lt((Dr=Dr.apply(Jt,bt||[])).next())})},ee=this&&this.__generator||function(Jt,bt){var vt={label:0,sent:function(){if(sr[0]&1)throw sr[1];return sr[1]},trys:[],ops:[]},Dr,fr,sr,mt;return mt={next:nt(0),throw:nt(1),return:nt(2)},typeof Symbol=="function"&&(mt[Symbol.iterator]=function(){return this}),mt;function nt(lt){return function(Xt){return Lt([lt,Xt])}}function Lt(lt){if(Dr)throw new TypeError("Generator is already executing.");for(;vt;)try{if(Dr=1,fr&&(sr=lt[0]&2?fr.return:lt[0]?fr.throw||((sr=fr.return)&&sr.call(fr),0):fr.next)&&!(sr=sr.call(fr,lt[1])).done)return sr;switch(fr=0,sr&&(lt=[lt[0]&2,sr.value]),lt[0]){case 0:case 1:sr=lt;break;case 4:return vt.label++,{value:lt[1],done:!1};case 5:vt.label++,fr=lt[1],lt=[0];continue;case 7:lt=vt.ops.pop(),vt.trys.pop();continue;default:if(sr=vt.trys,!(sr=sr.length>0&&sr[sr.length-1])&&(lt[0]===6||lt[0]===2)){vt=0;continue}if(lt[0]===3&&(!sr||lt[1]>sr[0]&&lt[1]<sr[3])){vt.label=lt[1];break}if(lt[0]===6&&vt.label<sr[1]){vt.label=sr[1],sr=lt;break}if(sr&&vt.label<sr[2]){vt.label=sr[2],vt.ops.push(lt);break}sr[2]&&vt.ops.pop(),vt.trys.pop();continue}lt=bt.call(Jt,vt)}catch(Xt){lt=[6,Xt],fr=0}finally{Dr=sr=0}if(lt[0]&5)throw lt[1];return{value:lt[0]?lt[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(Jt,bt){for(var vt=0,Dr=bt.length,fr=Jt.length;vt<Dr;vt++,fr++)Jt[fr]=bt[vt];return Jt};Object.defineProperty(te,"__esModule",{value:!0}),te.Container=void 0;var le=N(44290),U=N(16674),ce=N(28421),oe=N(6867),Ue=N(51377),se=N(86311),ze=N(31927),et=N(15451),ut=N(37791),Ct=N(55800),Kt=N(85700),Yt=N(80175),nr=function(){function Jt(bt){this._appliedMiddleware=[];var vt=bt||{};if(typeof vt!="object")throw new Error(""+U.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(vt.defaultScope===void 0)vt.defaultScope=ce.BindingScopeEnum.Transient;else if(vt.defaultScope!==ce.BindingScopeEnum.Singleton&&vt.defaultScope!==ce.BindingScopeEnum.Transient&&vt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+U.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(vt.autoBindInjectable===void 0)vt.autoBindInjectable=!1;else if(typeof vt.autoBindInjectable!="boolean")throw new Error(""+U.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(vt.skipBaseClassChecks===void 0)vt.skipBaseClassChecks=!1;else if(typeof vt.skipBaseClassChecks!="boolean")throw new Error(""+U.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:vt.autoBindInjectable,defaultScope:vt.defaultScope,skipBaseClassChecks:vt.skipBaseClassChecks},this.id=ut.id(),this._bindingDictionary=new Yt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ue.MetadataReader}return Jt.merge=function(bt,vt){for(var Dr=[],fr=2;fr<arguments.length;fr++)Dr[fr-2]=arguments[fr];var sr=new Jt,mt=y([bt,vt],Dr).map(function(lt){return se.getBindingDictionary(lt)}),nt=se.getBindingDictionary(sr);function Lt(lt,Xt){lt.traverse(function(_r,J){J.forEach(function(Ie){Xt.add(Ie.serviceIdentifier,Ie.clone())})})}return mt.forEach(function(lt){Lt(lt,nt)}),sr},Jt.prototype.load=function(){for(var bt=[],vt=0;vt<arguments.length;vt++)bt[vt]=arguments[vt];for(var Dr=this._getContainerModuleHelpersFactory(),fr=0,sr=bt;fr<sr.length;fr++){var mt=sr[fr],nt=Dr(mt.id);mt.registry(nt.bindFunction,nt.unbindFunction,nt.isboundFunction,nt.rebindFunction)}},Jt.prototype.loadAsync=function(){for(var bt=[],vt=0;vt<arguments.length;vt++)bt[vt]=arguments[vt];return ye(this,void 0,void 0,function(){var Dr,fr,sr,mt,nt;return ee(this,function(Lt){switch(Lt.label){case 0:Dr=this._getContainerModuleHelpersFactory(),fr=0,sr=bt,Lt.label=1;case 1:return fr<sr.length?(mt=sr[fr],nt=Dr(mt.id),[4,mt.registry(nt.bindFunction,nt.unbindFunction,nt.isboundFunction,nt.rebindFunction)]):[3,4];case 2:Lt.sent(),Lt.label=3;case 3:return fr++,[3,1];case 4:return[2]}})})},Jt.prototype.unload=function(){for(var bt=this,vt=[],Dr=0;Dr<arguments.length;Dr++)vt[Dr]=arguments[Dr];var fr=function(sr){return function(mt){return mt.moduleId===sr}};vt.forEach(function(sr){var mt=fr(sr.id);bt._bindingDictionary.removeByCondition(mt)})},Jt.prototype.bind=function(bt){var vt=this.options.defaultScope||ce.BindingScopeEnum.Transient,Dr=new le.Binding(bt,vt);return this._bindingDictionary.add(bt,Dr),new et.BindingToSyntax(Dr)},Jt.prototype.rebind=function(bt){return this.unbind(bt),this.bind(bt)},Jt.prototype.unbind=function(bt){try{this._bindingDictionary.remove(bt)}catch(vt){throw new Error(U.CANNOT_UNBIND+" "+Ct.getServiceIdentifierAsString(bt))}},Jt.prototype.unbindAll=function(){this._bindingDictionary=new Yt.Lookup},Jt.prototype.isBound=function(bt){var vt=this._bindingDictionary.hasKey(bt);return!vt&&this.parent&&(vt=this.parent.isBound(bt)),vt},Jt.prototype.isBoundNamed=function(bt,vt){return this.isBoundTagged(bt,oe.NAMED_TAG,vt)},Jt.prototype.isBoundTagged=function(bt,vt,Dr){var fr=!1;if(this._bindingDictionary.hasKey(bt)){var sr=this._bindingDictionary.get(bt),mt=se.createMockRequest(this,bt,vt,Dr);fr=sr.some(function(nt){return nt.constraint(mt)})}return!fr&&this.parent&&(fr=this.parent.isBoundTagged(bt,vt,Dr)),fr},Jt.prototype.snapshot=function(){this._snapshots.push(Kt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Jt.prototype.restore=function(){var bt=this._snapshots.pop();if(bt===void 0)throw new Error(U.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=bt.bindings,this._middleware=bt.middleware},Jt.prototype.createChild=function(bt){var vt=new Jt(bt||this.options);return vt.parent=this,vt},Jt.prototype.applyMiddleware=function(){for(var bt=[],vt=0;vt<arguments.length;vt++)bt[vt]=arguments[vt];this._appliedMiddleware=this._appliedMiddleware.concat(bt);var Dr=this._middleware?this._middleware:this._planAndResolve();this._middleware=bt.reduce(function(fr,sr){return sr(fr)},Dr)},Jt.prototype.applyCustomMetadataReader=function(bt){this._metadataReader=bt},Jt.prototype.get=function(bt){return this._get(!1,!1,ce.TargetTypeEnum.Variable,bt)},Jt.prototype.getTagged=function(bt,vt,Dr){return this._get(!1,!1,ce.TargetTypeEnum.Variable,bt,vt,Dr)},Jt.prototype.getNamed=function(bt,vt){return this.getTagged(bt,oe.NAMED_TAG,vt)},Jt.prototype.getAll=function(bt){return this._get(!0,!0,ce.TargetTypeEnum.Variable,bt)},Jt.prototype.getAllTagged=function(bt,vt,Dr){return this._get(!1,!0,ce.TargetTypeEnum.Variable,bt,vt,Dr)},Jt.prototype.getAllNamed=function(bt,vt){return this.getAllTagged(bt,oe.NAMED_TAG,vt)},Jt.prototype.resolve=function(bt){var vt=this.createChild();return vt.bind(bt).toSelf(),this._appliedMiddleware.forEach(function(Dr){vt.applyMiddleware(Dr)}),vt.get(bt)},Jt.prototype._getContainerModuleHelpersFactory=function(){var bt=this,vt=function(nt,Lt){nt._binding.moduleId=Lt},Dr=function(nt){return function(Lt){var lt=bt.bind.bind(bt),Xt=lt(Lt);return vt(Xt,nt),Xt}},fr=function(nt){return function(Lt){var lt=bt.unbind.bind(bt);lt(Lt)}},sr=function(nt){return function(Lt){var lt=bt.isBound.bind(bt);return lt(Lt)}},mt=function(nt){return function(Lt){var lt=bt.rebind.bind(bt),Xt=lt(Lt);return vt(Xt,nt),Xt}};return function(nt){return{bindFunction:Dr(nt),isboundFunction:sr(nt),rebindFunction:mt(nt),unbindFunction:fr(nt)}}},Jt.prototype._get=function(bt,vt,Dr,fr,sr,mt){var nt=null,Lt={avoidConstraints:bt,contextInterceptor:function(lt){return lt},isMultiInject:vt,key:sr,serviceIdentifier:fr,targetType:Dr,value:mt};if(this._middleware){if(nt=this._middleware(Lt),nt==null)throw new Error(U.INVALID_MIDDLEWARE_RETURN)}else nt=this._planAndResolve()(Lt);return nt},Jt.prototype._planAndResolve=function(){var bt=this;return function(vt){var Dr=se.plan(bt._metadataReader,bt,vt.isMultiInject,vt.targetType,vt.serviceIdentifier,vt.key,vt.value,vt.avoidConstraints);Dr=vt.contextInterceptor(Dr);var fr=ze.resolve(Dr);return fr}},Jt}();te.Container=nr},33244:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.AsyncContainerModule=te.ContainerModule=void 0;var ye=N(37791),ee=function(){function le(U){this.id=ye.id(),this.registry=U}return le}();te.ContainerModule=ee;var y=function(){function le(U){this.id=ye.id(),this.registry=U}return le}();te.AsyncContainerModule=y},85700:function(Sr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.ContainerSnapshot=void 0;var N=function(){function ye(){}return ye.of=function(ee,y){var le=new ye;return le.bindings=ee,le.middleware=y,le},ye}();te.ContainerSnapshot=N},80175:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Lookup=void 0;var ye=N(16674),ee=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(le,U){if(le==null)throw new Error(ye.NULL_ARGUMENT);if(U==null)throw new Error(ye.NULL_ARGUMENT);var ce=this._map.get(le);ce!==void 0?(ce.push(U),this._map.set(le,ce)):this._map.set(le,[U])},y.prototype.get=function(le){if(le==null)throw new Error(ye.NULL_ARGUMENT);var U=this._map.get(le);if(U!==void 0)return U;throw new Error(ye.KEY_NOT_FOUND)},y.prototype.remove=function(le){if(le==null)throw new Error(ye.NULL_ARGUMENT);if(!this._map.delete(le))throw new Error(ye.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(le){var U=this;this._map.forEach(function(ce,oe){var Ue=ce.filter(function(se){return!le(se)});Ue.length>0?U._map.set(oe,Ue):U._map.delete(oe)})},y.prototype.hasKey=function(le){if(le==null)throw new Error(ye.NULL_ARGUMENT);return this._map.has(le)},y.prototype.clone=function(){var le=new y;return this._map.forEach(function(U,ce){U.forEach(function(oe){return le.add(ce,oe.clone())})}),le},y.prototype.traverse=function(le){this._map.forEach(function(U,ce){le(ce,U)})},y}();te.Lookup=ee},86700:function(Sr,te,N){"use strict";var ye;ye={value:!0},ye=ye=ye=ye=ye=ye=te.GW=ye=ye=te.zY=ye=ye=ye=ye=ye=te.f3=ye=ye=te.b2=ye=ye=ye=ye=ye=te.W2=ye=void 0;var ee=N(6867);ye=ee;var y=N(51389);Object.defineProperty(te,"W2",{enumerable:!0,get:function(){return y.Container}});var le=N(28421);ye={enumerable:!0,get:function(){return le.BindingScopeEnum}},ye={enumerable:!0,get:function(){return le.BindingTypeEnum}},ye={enumerable:!0,get:function(){return le.TargetTypeEnum}};var U=N(33244);ye={enumerable:!0,get:function(){return U.AsyncContainerModule}},ye={enumerable:!0,get:function(){return U.ContainerModule}};var ce=N(64315);Object.defineProperty(te,"b2",{enumerable:!0,get:function(){return ce.injectable}});var oe=N(32052);ye={enumerable:!0,get:function(){return oe.tagged}};var Ue=N(38085);ye={enumerable:!0,get:function(){return Ue.named}};var se=N(5744);Object.defineProperty(te,"f3",{enumerable:!0,get:function(){return se.inject}}),ye={enumerable:!0,get:function(){return se.LazyServiceIdentifer}};var ze=N(6515);ye={enumerable:!0,get:function(){return ze.optional}};var et=N(86757);ye={enumerable:!0,get:function(){return et.unmanaged}};var ut=N(71693);ye={enumerable:!0,get:function(){return ut.multiInject}};var Ct=N(55638);ye={enumerable:!0,get:function(){return Ct.targetName}};var Kt=N(7014);Object.defineProperty(te,"zY",{enumerable:!0,get:function(){return Kt.postConstruct}});var Yt=N(51377);ye={enumerable:!0,get:function(){return Yt.MetadataReader}};var nr=N(37791);ye={enumerable:!0,get:function(){return nr.id}};var Jt=N(99934);Object.defineProperty(te,"GW",{enumerable:!0,get:function(){return Jt.decorate}});var bt=N(80758);ye={enumerable:!0,get:function(){return bt.traverseAncerstors}},ye={enumerable:!0,get:function(){return bt.taggedConstraint}},ye={enumerable:!0,get:function(){return bt.namedConstraint}},ye={enumerable:!0,get:function(){return bt.typeConstraint}};var vt=N(55800);ye={enumerable:!0,get:function(){return vt.getServiceIdentifierAsString}};var Dr=N(70600);ye={enumerable:!0,get:function(){return Dr.multiBindToService}}},95228:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Context=void 0;var ye=N(37791),ee=function(){function y(le){this.id=ye.id(),this.container=le}return y.prototype.addPlan=function(le){this.plan=le},y.prototype.setCurrentRequest=function(le){this.currentRequest=le},y}();te.Context=ee},47738:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Metadata=void 0;var ye=N(6867),ee=function(){function y(le,U){this.key=le,this.value=U}return y.prototype.toString=function(){return this.key===ye.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();te.Metadata=ee},51377:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.MetadataReader=void 0;var ye=N(6867),ee=function(){function y(){}return y.prototype.getConstructorMetadata=function(le){var U=Reflect.getMetadata(ye.PARAM_TYPES,le),ce=Reflect.getMetadata(ye.TAGGED,le);return{compilerGeneratedMetadata:U,userGeneratedMetadata:ce||{}}},y.prototype.getPropertiesMetadata=function(le){var U=Reflect.getMetadata(ye.TAGGED_PROP,le)||[];return U},y}();te.MetadataReader=ee},55314:function(Sr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Plan=void 0;var N=function(){function ye(ee,y){this.parentContext=ee,this.rootRequest=y}return ye}();te.Plan=N},86311:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.getBindingDictionary=te.createMockRequest=te.plan=void 0;var ye=N(23184),ee=N(16674),y=N(28421),le=N(6867),U=N(85265),ce=N(55800),oe=N(95228),Ue=N(47738),se=N(55314),ze=N(6e3),et=N(6748),ut=N(18924);function Ct(fr){return fr._bindingDictionary}te.getBindingDictionary=Ct;function Kt(fr,sr,mt,nt,Lt,lt){var Xt=fr?le.MULTI_INJECT_TAG:le.INJECT_TAG,_r=new Ue.Metadata(Xt,mt),J=new ut.Target(sr,nt,mt,_r);if(Lt!==void 0){var Ie=new Ue.Metadata(Lt,lt);J.metadata.push(Ie)}return J}function Yt(fr,sr,mt,nt,Lt){var lt=bt(mt.container,Lt.serviceIdentifier),Xt=[];return lt.length===ye.BindingCount.NoBindingsAvailable&&mt.container.options.autoBindInjectable&&typeof Lt.serviceIdentifier=="function"&&fr.getConstructorMetadata(Lt.serviceIdentifier).compilerGeneratedMetadata&&(mt.container.bind(Lt.serviceIdentifier).toSelf(),lt=bt(mt.container,Lt.serviceIdentifier)),sr?Xt=lt:Xt=lt.filter(function(_r){var J=new et.Request(_r.serviceIdentifier,mt,nt,_r,Lt);return _r.constraint(J)}),nr(Lt.serviceIdentifier,Xt,Lt,mt.container),Xt}function nr(fr,sr,mt,nt){switch(sr.length){case ye.BindingCount.NoBindingsAvailable:if(mt.isOptional())return sr;var Lt=ce.getServiceIdentifierAsString(fr),lt=ee.NOT_REGISTERED;throw lt+=ce.listMetadataForTarget(Lt,mt),lt+=ce.listRegisteredBindingsForServiceIdentifier(nt,Lt,bt),new Error(lt);case ye.BindingCount.OnlyOneBindingAvailable:if(!mt.isArray())return sr;case ye.BindingCount.MultipleBindingsAvailable:default:if(mt.isArray())return sr;var Lt=ce.getServiceIdentifierAsString(fr),lt=ee.AMBIGUOUS_MATCH+" "+Lt;throw lt+=ce.listRegisteredBindingsForServiceIdentifier(nt,Lt,bt),new Error(lt)}}function Jt(fr,sr,mt,nt,Lt,lt){var Xt,_r;if(Lt===null){Xt=Yt(fr,sr,nt,null,lt),_r=new et.Request(mt,nt,null,Xt,lt);var J=new se.Plan(nt,_r);nt.addPlan(J)}else Xt=Yt(fr,sr,nt,Lt,lt),_r=Lt.addChildRequest(lt.serviceIdentifier,Xt,lt);Xt.forEach(function(Ie){var V=null;if(lt.isArray())V=_r.addChildRequest(Ie.serviceIdentifier,Ie,lt);else{if(Ie.cache)return;V=_r}if(Ie.type===y.BindingTypeEnum.Instance&&Ie.implementationType!==null){var H=ze.getDependencies(fr,Ie.implementationType);if(!nt.container.options.skipBaseClassChecks){var be=ze.getBaseClassDependencyCount(fr,Ie.implementationType);if(H.length<be){var tt=ee.ARGUMENTS_LENGTH_MISMATCH(ze.getFunctionName(Ie.implementationType));throw new Error(tt)}}H.forEach(function(ht){Jt(fr,!1,ht.serviceIdentifier,nt,V,ht)})}})}function bt(fr,sr){var mt=[],nt=Ct(fr);return nt.hasKey(sr)?mt=nt.get(sr):fr.parent!==null&&(mt=bt(fr.parent,sr)),mt}function vt(fr,sr,mt,nt,Lt,lt,Xt,_r){_r===void 0&&(_r=!1);var J=new oe.Context(sr),Ie=Kt(mt,nt,Lt,"",lt,Xt);try{return Jt(fr,_r,Lt,J,null,Ie),J}catch(V){throw U.isStackOverflowExeption(V)&&J.plan&&ce.circularDependencyToException(J.plan.rootRequest),V}}te.plan=vt;function Dr(fr,sr,mt,nt){var Lt=new ut.Target(y.TargetTypeEnum.Variable,"",sr,new Ue.Metadata(mt,nt)),lt=new oe.Context(fr),Xt=new et.Request(sr,lt,null,[],Lt);return Xt}te.createMockRequest=Dr},88460:function(Sr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.QueryableString=void 0;var N=function(){function ye(ee){this.str=ee}return ye.prototype.startsWith=function(ee){return this.str.indexOf(ee)===0},ye.prototype.endsWith=function(ee){var y="",le=ee.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},le)},ye.prototype.contains=function(ee){return this.str.indexOf(ee)!==-1},ye.prototype.equals=function(ee){return this.str===ee},ye.prototype.value=function(){return this.str},ye}();te.QueryableString=N},6e3:function(Sr,te,N){"use strict";var ye=this&&this.__spreadArray||function(Yt,nr){for(var Jt=0,bt=nr.length,vt=Yt.length;Jt<bt;Jt++,vt++)Yt[vt]=nr[Jt];return Yt};Object.defineProperty(te,"__esModule",{value:!0}),te.getFunctionName=te.getBaseClassDependencyCount=te.getDependencies=void 0;var ee=N(5744),y=N(16674),le=N(28421),U=N(6867),ce=N(55800);Object.defineProperty(te,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var oe=N(18924);function Ue(Yt,nr){var Jt=ce.getFunctionName(nr),bt=se(Yt,Jt,nr,!1);return bt}te.getDependencies=Ue;function se(Yt,nr,Jt,bt){var vt=Yt.getConstructorMetadata(Jt),Dr=vt.compilerGeneratedMetadata;if(Dr===void 0){var fr=y.MISSING_INJECTABLE_ANNOTATION+" "+nr+".";throw new Error(fr)}var sr=vt.userGeneratedMetadata,mt=Object.keys(sr),nt=Jt.length===0&&mt.length>0,Lt=mt.length>Jt.length,lt=nt||Lt?mt.length:Jt.length,Xt=et(bt,nr,Dr,sr,lt),_r=ut(Yt,Jt),J=ye(ye([],Xt),_r);return J}function ze(Yt,nr,Jt,bt,vt){var Dr=vt[Yt.toString()]||[],fr=Kt(Dr),sr=fr.unmanaged!==!0,mt=bt[Yt],nt=fr.inject||fr.multiInject;if(mt=nt||mt,mt instanceof ee.LazyServiceIdentifer&&(mt=mt.unwrap()),sr){var Lt=mt===Object,lt=mt===Function,Xt=mt===void 0,_r=Lt||lt||Xt;if(!nr&&_r){var J=y.MISSING_INJECT_ANNOTATION+" argument "+Yt+" in class "+Jt+".";throw new Error(J)}var Ie=new oe.Target(le.TargetTypeEnum.ConstructorArgument,fr.targetName,mt);return Ie.metadata=Dr,Ie}return null}function et(Yt,nr,Jt,bt,vt){for(var Dr=[],fr=0;fr<vt;fr++){var sr=fr,mt=ze(sr,Yt,nr,Jt,bt);mt!==null&&Dr.push(mt)}return Dr}function ut(Yt,nr){for(var Jt=Yt.getPropertiesMetadata(nr),bt=[],vt=Object.keys(Jt),Dr=0,fr=vt;Dr<fr.length;Dr++){var sr=fr[Dr],mt=Jt[sr],nt=Kt(Jt[sr]),Lt=nt.targetName||sr,lt=nt.inject||nt.multiInject,Xt=new oe.Target(le.TargetTypeEnum.ClassProperty,Lt,lt);Xt.metadata=mt,bt.push(Xt)}var _r=Object.getPrototypeOf(nr.prototype).constructor;if(_r!==Object){var J=ut(Yt,_r);bt=ye(ye([],bt),J)}return bt}function Ct(Yt,nr){var Jt=Object.getPrototypeOf(nr.prototype).constructor;if(Jt!==Object){var bt=ce.getFunctionName(Jt),vt=se(Yt,bt,Jt,!0),Dr=vt.map(function(mt){return mt.metadata.filter(function(nt){return nt.key===U.UNMANAGED_TAG})}),fr=[].concat.apply([],Dr).length,sr=vt.length-fr;return sr>0?sr:Ct(Yt,Jt)}else return 0}te.getBaseClassDependencyCount=Ct;function Kt(Yt){var nr={};return Yt.forEach(function(Jt){nr[Jt.key.toString()]=Jt.value}),{inject:nr[U.INJECT_TAG],multiInject:nr[U.MULTI_INJECT_TAG],targetName:nr[U.NAME_TAG],unmanaged:nr[U.UNMANAGED_TAG]}}},6748:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Request=void 0;var ye=N(37791),ee=function(){function y(le,U,ce,oe,Ue){this.id=ye.id(),this.serviceIdentifier=le,this.parentContext=U,this.parentRequest=ce,this.target=Ue,this.childRequests=[],this.bindings=Array.isArray(oe)?oe:[oe],this.requestScope=ce===null?new Map:null}return y.prototype.addChildRequest=function(le,U,ce){var oe=new y(le,this.parentContext,this,U,ce);return this.childRequests.push(oe),oe},y}();te.Request=ee},18924:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Target=void 0;var ye=N(6867),ee=N(37791),y=N(47738),le=N(88460),U=function(){function ce(oe,Ue,se,ze){this.id=ee.id(),this.type=oe,this.serviceIdentifier=se,this.name=new le.QueryableString(Ue||""),this.metadata=new Array;var et=null;typeof ze=="string"?et=new y.Metadata(ye.NAMED_TAG,ze):ze instanceof y.Metadata&&(et=ze),et!==null&&this.metadata.push(et)}return ce.prototype.hasTag=function(oe){for(var Ue=0,se=this.metadata;Ue<se.length;Ue++){var ze=se[Ue];if(ze.key===oe)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(ye.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(oe){return this.matchesTag(ye.MULTI_INJECT_TAG)(oe)},ce.prototype.isNamed=function(){return this.hasTag(ye.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(oe){return ye.NON_CUSTOM_TAG_KEYS.every(function(Ue){return oe.key!==Ue})})},ce.prototype.isOptional=function(){return this.matchesTag(ye.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(oe){return oe.key===ye.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(oe){return ye.NON_CUSTOM_TAG_KEYS.every(function(Ue){return oe.key!==Ue})}):null},ce.prototype.matchesNamedTag=function(oe){return this.matchesTag(ye.NAMED_TAG)(oe)},ce.prototype.matchesTag=function(oe){var Ue=this;return function(se){for(var ze=0,et=Ue.metadata;ze<et.length;ze++){var ut=et[ze];if(ut.key===oe&&ut.value===se)return!0}return!1}},ce}();te.Target=U},52279:function(Sr,te,N){"use strict";var ye=this&&this.__spreadArray||function(se,ze){for(var et=0,ut=ze.length,Ct=se.length;et<ut;et++,Ct++)se[Ct]=ze[et];return se};Object.defineProperty(te,"__esModule",{value:!0}),te.resolveInstance=void 0;var ee=N(16674),y=N(28421),le=N(6867);function U(se,ze,et){var ut=ze.filter(function(Kt){return Kt.target!==null&&Kt.target.type===y.TargetTypeEnum.ClassProperty}),Ct=ut.map(et);return ut.forEach(function(Kt,Yt){var nr="";nr=Kt.target.name.value();var Jt=Ct[Yt];se[nr]=Jt}),se}function ce(se,ze){return new(se.bind.apply(se,ye([void 0],ze)))}function oe(se,ze){if(Reflect.hasMetadata(le.POST_CONSTRUCT,se)){var et=Reflect.getMetadata(le.POST_CONSTRUCT,se);try{ze[et.value]()}catch(ut){throw new Error(ee.POST_CONSTRUCT_ERROR(se.name,ut.message))}}}function Ue(se,ze,et){var ut=null;if(ze.length>0){var Ct=ze.filter(function(Yt){return Yt.target!==null&&Yt.target.type===y.TargetTypeEnum.ConstructorArgument}),Kt=Ct.map(et);ut=ce(se,Kt),ut=U(ut,ze,et)}else ut=new se;return oe(se,ut),ut}te.resolveInstance=Ue},31927:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.resolve=void 0;var ye=N(16674),ee=N(28421),y=N(85265),le=N(55800),U=N(52279),ce=function(se,ze,et){try{return et()}catch(ut){throw y.isStackOverflowExeption(ut)?new Error(ye.CIRCULAR_DEPENDENCY_IN_FACTORY(se,ze.toString())):ut}},oe=function(se){return function(ze){ze.parentContext.setCurrentRequest(ze);var et=ze.bindings,ut=ze.childRequests,Ct=ze.target&&ze.target.isArray(),Kt=!ze.parentRequest||!ze.parentRequest.target||!ze.target||!ze.parentRequest.target.matchesArray(ze.target.serviceIdentifier);if(Ct&&Kt)return ut.map(function(Dr){var fr=oe(se);return fr(Dr)});var Yt=null;if(ze.target.isOptional()&&et.length===0)return;var nr=et[0],Jt=nr.scope===ee.BindingScopeEnum.Singleton,bt=nr.scope===ee.BindingScopeEnum.Request;if(Jt&&nr.activated)return nr.cache;if(bt&&se!==null&&se.has(nr.id))return se.get(nr.id);if(nr.type===ee.BindingTypeEnum.ConstantValue)Yt=nr.cache,nr.activated=!0;else if(nr.type===ee.BindingTypeEnum.Function)Yt=nr.cache,nr.activated=!0;else if(nr.type===ee.BindingTypeEnum.Constructor)Yt=nr.implementationType;else if(nr.type===ee.BindingTypeEnum.DynamicValue&&nr.dynamicValue!==null)Yt=ce("toDynamicValue",nr.serviceIdentifier,function(){return nr.dynamicValue(ze.parentContext)});else if(nr.type===ee.BindingTypeEnum.Factory&&nr.factory!==null)Yt=ce("toFactory",nr.serviceIdentifier,function(){return nr.factory(ze.parentContext)});else if(nr.type===ee.BindingTypeEnum.Provider&&nr.provider!==null)Yt=ce("toProvider",nr.serviceIdentifier,function(){return nr.provider(ze.parentContext)});else if(nr.type===ee.BindingTypeEnum.Instance&&nr.implementationType!==null)Yt=U.resolveInstance(nr.implementationType,ut,oe(se));else{var vt=le.getServiceIdentifierAsString(ze.serviceIdentifier);throw new Error(ye.INVALID_BINDING_TYPE+" "+vt)}return typeof nr.onActivation=="function"&&(Yt=nr.onActivation(ze.parentContext,Yt)),Jt&&(nr.cache=Yt,nr.activated=!0),bt&&se!==null&&!se.has(nr.id)&&se.set(nr.id,Yt),Yt}};function Ue(se){var ze=oe(se.plan.rootRequest.requestScope);return ze(se.plan.rootRequest)}te.resolve=Ue},83366:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingInSyntax=void 0;var ye=N(28421),ee=N(71325),y=function(){function le(U){this._binding=U}return le.prototype.inRequestScope=function(){return this._binding.scope=ye.BindingScopeEnum.Request,new ee.BindingWhenOnSyntax(this._binding)},le.prototype.inSingletonScope=function(){return this._binding.scope=ye.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},le.prototype.inTransientScope=function(){return this._binding.scope=ye.BindingScopeEnum.Transient,new ee.BindingWhenOnSyntax(this._binding)},le}();te.BindingInSyntax=y},74889:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingInWhenOnSyntax=void 0;var ye=N(83366),ee=N(51811),y=N(98370),le=function(){function U(ce){this._binding=ce,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ee.BindingOnSyntax(this._binding),this._bindingInSyntax=new ye.BindingInSyntax(ce)}return U.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},U.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},U.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},U.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},U.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},U.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},U.prototype.whenTargetTagged=function(ce,oe){return this._bindingWhenSyntax.whenTargetTagged(ce,oe)},U.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},U.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},U.prototype.whenParentTagged=function(ce,oe){return this._bindingWhenSyntax.whenParentTagged(ce,oe)},U.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},U.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},U.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},U.prototype.whenAnyAncestorTagged=function(ce,oe){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,oe)},U.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},U.prototype.whenNoAncestorTagged=function(ce,oe){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,oe)},U.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},U.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},U.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},U}();te.BindingInWhenOnSyntax=le},51811:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingOnSyntax=void 0;var ye=N(98370),ee=function(){function y(le){this._binding=le}return y.prototype.onActivation=function(le){return this._binding.onActivation=le,new ye.BindingWhenSyntax(this._binding)},y}();te.BindingOnSyntax=ee},15451:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingToSyntax=void 0;var ye=N(16674),ee=N(28421),y=N(74889),le=N(71325),U=function(){function ce(oe){this._binding=oe}return ce.prototype.to=function(oe){return this._binding.type=ee.BindingTypeEnum.Instance,this._binding.implementationType=oe,new y.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ye.INVALID_TO_SELF_VALUE);var oe=this._binding.serviceIdentifier;return this.to(oe)},ce.prototype.toConstantValue=function(oe){return this._binding.type=ee.BindingTypeEnum.ConstantValue,this._binding.cache=oe,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ee.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(oe){return this._binding.type=ee.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=oe,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(oe){return this._binding.type=ee.BindingTypeEnum.Constructor,this._binding.implementationType=oe,this._binding.scope=ee.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(oe){return this._binding.type=ee.BindingTypeEnum.Factory,this._binding.factory=oe,this._binding.scope=ee.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(oe){if(typeof oe!="function")throw new Error(ye.INVALID_FUNCTION_BINDING);var Ue=this.toConstantValue(oe);return this._binding.type=ee.BindingTypeEnum.Function,this._binding.scope=ee.BindingScopeEnum.Singleton,Ue},ce.prototype.toAutoFactory=function(oe){return this._binding.type=ee.BindingTypeEnum.Factory,this._binding.factory=function(Ue){var se=function(){return Ue.container.get(oe)};return se},this._binding.scope=ee.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(oe){return this._binding.type=ee.BindingTypeEnum.Provider,this._binding.provider=oe,this._binding.scope=ee.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(oe){this.toDynamicValue(function(Ue){return Ue.container.get(oe)})},ce}();te.BindingToSyntax=U},71325:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingWhenOnSyntax=void 0;var ye=N(51811),ee=N(98370),y=function(){function le(U){this._binding=U,this._bindingWhenSyntax=new ee.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ye.BindingOnSyntax(this._binding)}return le.prototype.when=function(U){return this._bindingWhenSyntax.when(U)},le.prototype.whenTargetNamed=function(U){return this._bindingWhenSyntax.whenTargetNamed(U)},le.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},le.prototype.whenTargetTagged=function(U,ce){return this._bindingWhenSyntax.whenTargetTagged(U,ce)},le.prototype.whenInjectedInto=function(U){return this._bindingWhenSyntax.whenInjectedInto(U)},le.prototype.whenParentNamed=function(U){return this._bindingWhenSyntax.whenParentNamed(U)},le.prototype.whenParentTagged=function(U,ce){return this._bindingWhenSyntax.whenParentTagged(U,ce)},le.prototype.whenAnyAncestorIs=function(U){return this._bindingWhenSyntax.whenAnyAncestorIs(U)},le.prototype.whenNoAncestorIs=function(U){return this._bindingWhenSyntax.whenNoAncestorIs(U)},le.prototype.whenAnyAncestorNamed=function(U){return this._bindingWhenSyntax.whenAnyAncestorNamed(U)},le.prototype.whenAnyAncestorTagged=function(U,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(U,ce)},le.prototype.whenNoAncestorNamed=function(U){return this._bindingWhenSyntax.whenNoAncestorNamed(U)},le.prototype.whenNoAncestorTagged=function(U,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(U,ce)},le.prototype.whenAnyAncestorMatches=function(U){return this._bindingWhenSyntax.whenAnyAncestorMatches(U)},le.prototype.whenNoAncestorMatches=function(U){return this._bindingWhenSyntax.whenNoAncestorMatches(U)},le.prototype.onActivation=function(U){return this._bindingOnSyntax.onActivation(U)},le}();te.BindingWhenOnSyntax=y},98370:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingWhenSyntax=void 0;var ye=N(51811),ee=N(80758),y=function(){function le(U){this._binding=U}return le.prototype.when=function(U){return this._binding.constraint=U,new ye.BindingOnSyntax(this._binding)},le.prototype.whenTargetNamed=function(U){return this._binding.constraint=ee.namedConstraint(U),new ye.BindingOnSyntax(this._binding)},le.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(U){var ce=U.target!==null&&!U.target.isNamed()&&!U.target.isTagged();return ce},new ye.BindingOnSyntax(this._binding)},le.prototype.whenTargetTagged=function(U,ce){return this._binding.constraint=ee.taggedConstraint(U)(ce),new ye.BindingOnSyntax(this._binding)},le.prototype.whenInjectedInto=function(U){return this._binding.constraint=function(ce){return ee.typeConstraint(U)(ce.parentRequest)},new ye.BindingOnSyntax(this._binding)},le.prototype.whenParentNamed=function(U){return this._binding.constraint=function(ce){return ee.namedConstraint(U)(ce.parentRequest)},new ye.BindingOnSyntax(this._binding)},le.prototype.whenParentTagged=function(U,ce){return this._binding.constraint=function(oe){return ee.taggedConstraint(U)(ce)(oe.parentRequest)},new ye.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorIs=function(U){return this._binding.constraint=function(ce){return ee.traverseAncerstors(ce,ee.typeConstraint(U))},new ye.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorIs=function(U){return this._binding.constraint=function(ce){return!ee.traverseAncerstors(ce,ee.typeConstraint(U))},new ye.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorNamed=function(U){return this._binding.constraint=function(ce){return ee.traverseAncerstors(ce,ee.namedConstraint(U))},new ye.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorNamed=function(U){return this._binding.constraint=function(ce){return!ee.traverseAncerstors(ce,ee.namedConstraint(U))},new ye.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorTagged=function(U,ce){return this._binding.constraint=function(oe){return ee.traverseAncerstors(oe,ee.taggedConstraint(U)(ce))},new ye.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorTagged=function(U,ce){return this._binding.constraint=function(oe){return!ee.traverseAncerstors(oe,ee.taggedConstraint(U)(ce))},new ye.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorMatches=function(U){return this._binding.constraint=function(ce){return ee.traverseAncerstors(ce,U)},new ye.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorMatches=function(U){return this._binding.constraint=function(ce){return!ee.traverseAncerstors(ce,U)},new ye.BindingOnSyntax(this._binding)},le}();te.BindingWhenSyntax=y},80758:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.typeConstraint=te.namedConstraint=te.taggedConstraint=te.traverseAncerstors=void 0;var ye=N(6867),ee=N(47738),y=function(oe,Ue){var se=oe.parentRequest;return se!==null?Ue(se)?!0:y(se,Ue):!1};te.traverseAncerstors=y;var le=function(oe){return function(Ue){var se=function(ze){return ze!==null&&ze.target!==null&&ze.target.matchesTag(oe)(Ue)};return se.metaData=new ee.Metadata(oe,Ue),se}};te.taggedConstraint=le;var U=le(ye.NAMED_TAG);te.namedConstraint=U;var ce=function(oe){return function(Ue){var se=null;if(Ue!==null)if(se=Ue.bindings[0],typeof oe=="string"){var ze=se.serviceIdentifier;return ze===oe}else{var et=Ue.bindings[0].implementationType;return oe===et}return!1}};te.typeConstraint=ce},70600:function(Sr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.multiBindToService=void 0;var N=function(ye){return function(ee){return function(){for(var y=[],le=0;le<arguments.length;le++)y[le]=arguments[le];return y.forEach(function(U){return ye.bind(U).toService(ee)})}}};te.multiBindToService=N},85265:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.isStackOverflowExeption=void 0;var ye=N(16674);function ee(y){return y instanceof RangeError||y.message===ye.STACK_OVERFLOW}te.isStackOverflowExeption=ee},37791:function(Sr,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.id=void 0;var N=0;function ye(){return N++}te.id=ye},55800:function(Sr,te,N){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.circularDependencyToException=te.listMetadataForTarget=te.listRegisteredBindingsForServiceIdentifier=te.getServiceIdentifierAsString=te.getFunctionName=void 0;var ye=N(16674);function ee(se){if(typeof se=="function"){var ze=se;return ze.name}else{if(typeof se=="symbol")return se.toString();var ze=se;return ze}}te.getServiceIdentifierAsString=ee;function y(se,ze,et){var ut="",Ct=et(se,ze);return Ct.length!==0&&(ut=`
Registered bindings:`,Ct.forEach(function(Kt){var Yt="Object";Kt.implementationType!==null&&(Yt=Ue(Kt.implementationType)),ut=ut+`
 `+Yt,Kt.constraint.metaData&&(ut=ut+" - "+Kt.constraint.metaData)})),ut}te.listRegisteredBindingsForServiceIdentifier=y;function le(se,ze){return se.parentRequest===null?!1:se.parentRequest.serviceIdentifier===ze?!0:le(se.parentRequest,ze)}function U(se){function ze(ut,Ct){Ct===void 0&&(Ct=[]);var Kt=ee(ut.serviceIdentifier);return Ct.push(Kt),ut.parentRequest!==null?ze(ut.parentRequest,Ct):Ct}var et=ze(se);return et.reverse().join(" --> ")}function ce(se){se.childRequests.forEach(function(ze){if(le(ze,ze.serviceIdentifier)){var et=U(ze);throw new Error(ye.CIRCULAR_DEPENDENCY+" "+et)}else ce(ze)})}te.circularDependencyToException=ce;function oe(se,ze){if(ze.isTagged()||ze.isNamed()){var et="",ut=ze.getNamedTag(),Ct=ze.getCustomTags();return ut!==null&&(et+=ut.toString()+`
`),Ct!==null&&Ct.forEach(function(Kt){et+=Kt.toString()+`
`})," "+se+`
 `+se+" - "+et}else return" "+se}te.listMetadataForTarget=oe;function Ue(se){if(se.name)return se.name;var ze=se.toString(),et=ze.match(/^function\s*([^\s(]+)/);return et?et[1]:"Anonymous function: "+ze}te.getFunctionName=Ue},29750:function(Sr){function te(N,ye,ee){return N===N&&(ee!==void 0&&(N=N<=ee?N:ee),ye!==void 0&&(N=N>=ye?N:ye)),N}Sr.exports=te},74221:function(Sr){function te(N,ye,ee,y){for(var le=ee-1,U=N.length;++le<U;)if(y(N[le],ye))return le;return-1}Sr.exports=te},65464:function(Sr,te,N){var ye=N(29932),ee=N(42118),y=N(74221),le=N(7518),U=N(278),ce=Array.prototype,oe=ce.splice;function Ue(se,ze,et,ut){var Ct=ut?y:ee,Kt=-1,Yt=ze.length,nr=se;for(se===ze&&(ze=U(ze)),et&&(nr=ye(se,le(et)));++Kt<Yt;)for(var Jt=0,bt=ze[Kt],vt=et?et(bt):bt;(Jt=Ct(nr,vt,Jt,ut))>-1;)nr!==se&&oe.call(nr,Jt,1),oe.call(se,Jt,1);return se}Sr.exports=Ue},18190:function(Sr){var te=9007199254740991,N=Math.floor;function ye(ee,y){var le="";if(!ee||y<1||y>te)return le;do y%2&&(le+=ee),y=N(y/2),y&&(ee+=ee);while(y);return le}Sr.exports=ye},78302:function(Sr,te,N){var ye=N(18190),ee=N(80531),y=N(40180),le=N(62689),U=N(88016),ce=N(83140),oe=Math.ceil;function Ue(se,ze){ze=ze===void 0?" ":ee(ze);var et=ze.length;if(et<2)return et?ye(ze,se):ze;var ut=ye(ze,oe(se/U(ze)));return le(ze)?y(ce(ut),0,se).join(""):ut.slice(0,se)}Sr.exports=Ue},74691:function(Sr,te,N){var ye=N(29750),ee=N(14841);function y(le,U,ce){return ce===void 0&&(ce=U,U=void 0),ce!==void 0&&(ce=ee(ce),ce=ce===ce?ce:0),U!==void 0&&(U=ee(U),U=U===U?U:0),ye(ee(le),U,ce)}Sr.exports=y},51584:function(Sr,te,N){var ye=N(44239),ee=N(37005),y="[object Boolean]";function le(U){return U===!0||U===!1||ee(U)&&ye(U)==y}Sr.exports=le},60442:function(Sr,te,N){var ye=N(90939);function ee(y,le){return ye(y,le)}Sr.exports=ee},14293:function(Sr){function te(N){return N==null}Sr.exports=te},81763:function(Sr,te,N){var ye=N(44239),ee=N(37005),y="[object Number]";function le(U){return typeof U=="number"||ee(U)&&ye(U)==y}Sr.exports=le},30236:function(Sr,te,N){var ye=N(42980),ee=N(21463),y=ee(function(le,U,ce,oe){ye(le,U,ce,oe)});Sr.exports=y},11726:function(Sr,te,N){var ye=N(78302),ee=N(88016),y=N(40554),le=N(79833);function U(ce,oe,Ue){ce=le(ce),oe=y(oe);var se=oe?ee(ce):0;return oe&&se<oe?ce+ye(oe-se,Ue):ce}Sr.exports=U},32475:function(Sr,te,N){var ye=N(78302),ee=N(88016),y=N(40554),le=N(79833);function U(ce,oe,Ue){ce=le(ce),oe=y(oe);var se=oe?ee(ce):0;return oe&&se<oe?ye(oe-se,Ue)+ce:ce}Sr.exports=U},97019:function(Sr,te,N){var ye=N(5976),ee=N(45604),y=ye(ee);Sr.exports=y},45604:function(Sr,te,N){var ye=N(65464);function ee(y,le){return y&&y.length&&le&&le.length?ye(y,le):y}Sr.exports=ee},23493:function(Sr,te,N){var ye=N(23279),ee=N(13218),y="Expected a function";function le(U,ce,oe){var Ue=!0,se=!0;if(typeof U!="function")throw new TypeError(y);return ee(oe)&&(Ue="leading"in oe?!!oe.leading:Ue,se="trailing"in oe?!!oe.trailing:se),ye(U,ce,{leading:Ue,maxWait:ce,trailing:se})}Sr.exports=le},44908:function(Sr,te,N){var ye=N(45652);function ee(y){return y&&y.length?ye(y):[]}Sr.exports=ee},6158:function(Sr){(function(te,N){Sr.exports=N()})(this,function(){"use strict";var te,N,ye;function ee(y,le){if(!te)te=le;else if(!N)N=le;else{var U="var sharedChunk = {}; ("+te+")(sharedChunk); ("+N+")(sharedChunk);",ce={};te(ce),ye=le(ce),typeof window!="undefined"&&(ye.workerUrl=window.URL.createObjectURL(new Blob([U],{type:"text/javascript"})))}}return ee(["exports"],function(y){"use strict";function le(a,s){return a(s={exports:{}},s.exports),s.exports}var U=ce;function ce(a,s,c,m){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=m,this.p2x=c,this.p2y=m}ce.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},ce.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},ce.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},ce.prototype.solveCurveX=function(a,s){var c,m,_,b,E;for(s===void 0&&(s=1e-6),_=a,E=0;E<8;E++){if(b=this.sampleCurveX(_)-a,Math.abs(b)<s)return _;var M=this.sampleCurveDerivativeX(_);if(Math.abs(M)<1e-6)break;_-=b/M}if((_=a)<(c=0))return c;if(_>(m=1))return m;for(;c<m;){if(b=this.sampleCurveX(_),Math.abs(b-a)<s)return _;a>b?c=_:m=_,_=.5*(m-c)+c}return _},ce.prototype.solve=function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))};var oe=Ue;function Ue(a,s){this.x=a,this.y=s}Ue.prototype={clone:function(){return new Ue(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,s){return this.clone()._rotateAround(a,s)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var s=a.x-this.x,c=a.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,s){return Math.atan2(this.x*s-this.y*a,this.x*a+this.y*s)},_matMult:function(a){var s=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=s,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var s=Math.cos(a),c=Math.sin(a),m=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=m,this},_rotateAround:function(a,s){var c=Math.cos(a),m=Math.sin(a),_=s.y+m*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-m*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ue.convert=function(a){return a instanceof Ue?a:Array.isArray(a)?new Ue(a[0],a[1]):a};var se=typeof self!="undefined"?self:{},ze=Math.pow(2,53)-1;function et(a,s,c,m){var _=new U(a,s,c,m);return function(b){return _.solve(b)}}var ut=et(.25,.1,.25,1);function Ct(a,s,c){return Math.min(c,Math.max(s,a))}function Kt(a,s,c){var m=c-s,_=((a-s)%m+m)%m+s;return _===s?c:_}function Yt(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var b=_[m];for(var E in b)a[E]=b[E]}return a}var nr=1;function Jt(){return nr++}function bt(){return function a(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function vt(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Dr(a,s){a.forEach(function(c){s[c]&&(s[c]=s[c].bind(s))})}function fr(a,s){return a.indexOf(s,a.length-s.length)!==-1}function sr(a,s,c){var m={};for(var _ in a)m[_]=s.call(c||this,a[_],_,a);return m}function mt(a,s,c){var m={};for(var _ in a)s.call(c||this,a[_],_,a)&&(m[_]=a[_]);return m}function nt(a){return Array.isArray(a)?a.map(nt):typeof a=="object"&&a?sr(a,nt):a}var Lt={};function lt(a){Lt[a]||(typeof console!="undefined"&&console.warn(a),Lt[a]=!0)}function Xt(a,s,c){return(c.y-a.y)*(s.x-a.x)>(s.y-a.y)*(c.x-a.x)}function _r(a){for(var s=0,c=0,m=a.length,_=m-1,b=void 0,E=void 0;c<m;_=c++)s+=((E=a[_]).x-(b=a[c]).x)*(b.y+E.y);return s}function J(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ie(a){var s={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,_,b,E){var M=b||E;return s[_]=!M||M.toLowerCase(),""}),s["max-age"]){var c=parseInt(s["max-age"],10);isNaN(c)?delete s["max-age"]:s["max-age"]=c}return s}var V=null;function H(a){if(V==null){var s=a.navigator?a.navigator.userAgent:null;V=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return V}function be(a){try{var s=se[a];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var tt,ht,St,jt,tr=se.performance&&se.performance.now?se.performance.now.bind(se.performance):Date.now.bind(Date),Hr=se.requestAnimationFrame||se.mozRequestAnimationFrame||se.webkitRequestAnimationFrame||se.msRequestAnimationFrame,Br=se.cancelAnimationFrame||se.mozCancelAnimationFrame||se.webkitCancelAnimationFrame||se.msCancelAnimationFrame,Bn={now:tr,frame:function(a){var s=Hr(a);return{cancel:function(){return Br(s)}}},getImageData:function(a,s){s===void 0&&(s=0);var c=se.document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,m.drawImage(a,0,0,a.width,a.height),m.getImageData(-s,-s,a.width+2*s,a.height+2*s)},resolveURL:function(a){return tt||(tt=se.document.createElement("a")),tt.href=a,tt.href},hardwareConcurrency:se.navigator&&se.navigator.hardwareConcurrency||4,get devicePixelRatio(){return se.devicePixelRatio},get prefersReducedMotion(){return!!se.matchMedia&&(ht==null&&(ht=se.matchMedia("(prefers-reduced-motion: reduce)")),ht.matches)}},tn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},gn={supported:!1,testSupport:function(a){!fi&&jt&&(Vn?vn(a):St=a)}},fi=!1,Vn=!1;function vn(a){var s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,jt),a.isContextLost())return;gn.supported=!0}catch(c){}a.deleteTexture(s),fi=!0}se.document&&((jt=se.document.createElement("img")).onload=function(){St&&vn(St),St=null,Vn=!0},jt.onerror=function(){fi=!0,St=null},jt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var bi="01",Mi=function(a,s){this._transformRequestFn=a,this._customAccessToken=s,this._createSkuToken()};function Ei(a){return a.indexOf("mapbox:")===0}Mi.prototype._createSkuToken=function(){var a=function(){for(var s="",c=0;c<10;c++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",bi,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},Mi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Mi.prototype.transformRequest=function(a,s){return this._transformRequestFn&&this._transformRequestFn(a,s)||{url:a}},Mi.prototype.normalizeStyleURL=function(a,s){if(!Ei(a))return a;var c=Hi(a);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},Mi.prototype.normalizeGlyphsURL=function(a,s){if(!Ei(a))return a;var c=Hi(a);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},Mi.prototype.normalizeSourceURL=function(a,s){if(!Ei(a))return a;var c=Hi(a);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||s)},Mi.prototype.normalizeSpriteURL=function(a,s,c,m){var _=Hi(a);return Ei(a)?(_.path="/styles/v1"+_.path+"/sprite"+s+c,this._makeAPIURL(_,this._customAccessToken||m)):(_.path+=""+s+c,ja(_))},Mi.prototype.normalizeTileURL=function(a,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Ei(a))return a;var c=Hi(a);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Bn.devicePixelRatio>=2||s===512?"@2x":"")+(gn.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var m=this._customAccessToken||function(_){for(var b=0,E=_;b<E.length;b+=1){var M=E[b].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(c.params)||tn.ACCESS_TOKEN;return tn.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,m)},Mi.prototype.canonicalizeTileURL=function(a,s){var c=Hi(a);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return a;var m="mapbox://tiles/";m+=c.path.replace("/v4/","");var _=c.params;return s&&(_=_.filter(function(b){return!b.match(/^access_token=/)})),_.length&&(m+="?"+_.join("&")),m},Mi.prototype.canonicalizeTileset=function(a,s){for(var c=!!s&&Ei(s),m=[],_=0,b=a.tiles||[];_<b.length;_+=1){var E=b[_];kn(E)?m.push(this.canonicalizeTileURL(E,c)):m.push(E)}return m},Mi.prototype._makeAPIURL=function(a,s){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=Hi(tn.API_URL);if(a.protocol=m.protocol,a.authority=m.authority,a.protocol==="http"){var _=a.params.indexOf("secure");_>=0&&a.params.splice(_,1)}if(m.path!=="/"&&(a.path=""+m.path+a.path),!tn.REQUIRE_ACCESS_TOKEN)return ja(a);if(!(s=s||tn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return a.params=a.params.filter(function(b){return b.indexOf("access_token")===-1}),a.params.push("access_token="+s),ja(a)};var Gn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function kn(a){return Gn.test(a)}var mo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Hi(a){var s=a.match(mo);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function ja(a){var s=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+s}function Tt(a){if(!a)return null;var s=a.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(se.atob(s[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var R=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};R.prototype.getStorageKey=function(a){var s,c=Tt(tn.ACCESS_TOKEN);return s=c&&c.u?se.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(m,_){return String.fromCharCode(Number("0x"+_))})):tn.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+s:"mapbox.eventData:"+s},R.prototype.fetchEventData=function(){var a=be("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{var m=se.localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));var _=se.localStorage.getItem(c);_&&(this.anonId=_)}catch(b){lt("Unable to read from LocalStorage")}},R.prototype.saveEventData=function(){var a=be("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{se.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&se.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(m){lt("Unable to write to LocalStorage")}},R.prototype.processRequests=function(a){},R.prototype.postEvent=function(a,s,c,m){var _=this;if(tn.EVENTS_URL){var b=Hi(tn.EVENTS_URL);b.params.push("access_token="+(m||tn.ACCESS_TOKEN||""));var E={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:bi,userId:this.anonId},M=s?Yt(E,s):E,O={url:ja(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=qi(O,function(B){_.pendingRequest=null,c(B),_.saveEventData(),_.processRequests(m)})}},R.prototype.queueRequest=function(a,s){this.queue.push(a),this.processRequests(s)};var ne,fe,Fe=function(a){function s(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(c,m,_,b){this.skuToken=_;var E=!(!b&&!tn.ACCESS_TOKEN),M=Array.isArray(c)&&c.some(function(O){return Ei(O)||kn(O)});tn.EVENTS_URL&&E&&M&&this.queueRequest({id:m,timestamp:Date.now()},b)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),b=_.id,E=_.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),vt(this.anonId)||(this.anonId=bt()),this.postEvent(E,{skuToken:this.skuToken},function(M){M||b&&(m.success[b]=!0)},c))}},s}(R),ct=new(function(a){function s(c){a.call(this,"appUserTurnstile"),this._customAccessToken=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(c,m){tn.EVENTS_URL&&tn.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(_){return Ei(_)||kn(_)})&&this.queueRequest(Date.now(),m)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=Tt(tn.ACCESS_TOKEN),b=_?_.u:tn.ACCESS_TOKEN,E=b!==this.eventData.tokenU;vt(this.anonId)||(this.anonId=bt(),E=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var O=new Date(this.eventData.lastSuccess),B=new Date(M),G=(M-this.eventData.lastSuccess)/864e5;E=E||G>=1||G<-1||O.getDate()!==B.getDate()}else E=!0;if(!E)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function($){$||(m.eventData.lastSuccess=M,m.eventData.tokenU=b)},c)}},s}(R)),zt=ct.postTurnstileEvent.bind(ct),Er=new Fe,Ne=Er.postMapLoadEvent.bind(Er),Et=500,ir=50;function xr(){se.caches&&!ne&&(ne=se.caches.open("mapbox-tiles"))}function Wr(a){var s=a.indexOf("?");return s<0?a:a.slice(0,s)}var yn,Sn=1/0;function En(){return yn==null&&(yn=se.OffscreenCanvas&&new se.OffscreenCanvas(1,1).getContext("2d")&&typeof se.createImageBitmap=="function"),yn}var pn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(pn);var Kn=function(a){function s(c,m,_){m===401&&kn(_)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,c),this.status=m,this.url=_,this.name=this.constructor.name,this.message=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),Nn=J()?function(){return self.worker&&self.worker.referrer}:function(){return(se.location.protocol==="blob:"?se.parent:se).location.href},Ji,$i,go=function(a,s){if(!(/^file:/.test(c=a.url)||/^file:/.test(Nn())&&!/^\w+:/.test(c))){if(se.fetch&&se.Request&&se.AbortController&&se.Request.prototype.hasOwnProperty("signal"))return function(m,_){var b,E=new se.AbortController,M=new se.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:Nn(),signal:E.signal}),O=!1,B=!1,G=(b=M.url).indexOf("sku=")>0&&kn(b);m.type==="json"&&M.headers.set("Accept","application/json");var $=function(ue,ke,Me){if(!B){if(ue&&ue.message!=="SecurityError"&&lt(ue),ke&&Me)return re(ke);var Xe=Date.now();se.fetch(M).then(function(Ve){if(Ve.ok){var st=G?Ve.clone():null;return re(Ve,st,Xe)}return _(new Kn(Ve.statusText,Ve.status,m.url))}).catch(function(Ve){Ve.code!==20&&_(new Error(Ve.message))})}},re=function(ue,ke,Me){(m.type==="arrayBuffer"?ue.arrayBuffer():m.type==="json"?ue.json():ue.text()).then(function(Xe){B||(ke&&Me&&function(Ve,st,It){if(xr(),ne){var Nt={status:st.status,statusText:st.statusText,headers:new se.Headers};st.headers.forEach(function(or,Fr){return Nt.headers.set(Fr,or)});var Ht=Ie(st.headers.get("Cache-Control")||"");Ht["no-store"]||(Ht["max-age"]&&Nt.headers.set("Expires",new Date(It+1e3*Ht["max-age"]).toUTCString()),new Date(Nt.headers.get("Expires")).getTime()-It<42e4||function(or,Fr){if(fe===void 0)try{new Response(new ReadableStream),fe=!0}catch(Kr){fe=!1}fe?Fr(or.body):or.blob().then(Fr)}(st,function(or){var Fr=new se.Response(or,Nt);xr(),ne&&ne.then(function(Kr){return Kr.put(Wr(Ve.url),Fr)}).catch(function(Kr){return lt(Kr.message)})}))}}(M,ke,Me),O=!0,_(null,Xe,ue.headers.get("Cache-Control"),ue.headers.get("Expires")))}).catch(function(Xe){B||_(new Error(Xe.message))})};return G?function(ue,ke){if(xr(),!ne)return ke(null);var Me=Wr(ue.url);ne.then(function(Xe){Xe.match(Me).then(function(Ve){var st=function(It){if(!It)return!1;var Nt=new Date(It.headers.get("Expires")||0),Ht=Ie(It.headers.get("Cache-Control")||"");return Nt>Date.now()&&!Ht["no-cache"]}(Ve);Xe.delete(Me),st&&Xe.put(Me,Ve.clone()),ke(null,Ve,st)}).catch(ke)}).catch(ke)}(M,$):$(null,null),{cancel:function(){B=!0,O||E.abort()}}}(a,s);if(J()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,s,void 0,!0)}var c;return function(m,_){var b=new se.XMLHttpRequest;for(var E in b.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(b.responseType="arraybuffer"),m.headers)b.setRequestHeader(E,m.headers[E]);return m.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=m.credentials==="include",b.onerror=function(){_(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var M=b.response;if(m.type==="json")try{M=JSON.parse(b.response)}catch(O){return _(O)}_(null,M,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else _(new Kn(b.statusText,b.status,m.url))},b.send(m.body),{cancel:function(){return b.abort()}}}(a,s)},rs=function(a,s){return go(Yt(a,{type:"arrayBuffer"}),s)},qi=function(a,s){return go(Yt(a,{method:"POST"}),s)},W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ji=[],$i=0;var K=function(a,s){if(gn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),$i>=tn.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:a,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ji.push(c),c}$i++;var m=!1,_=function(){if(!m)for(m=!0,$i--;Ji.length&&$i<tn.MAX_PARALLEL_IMAGE_REQUESTS;){var E=Ji.shift();E.cancelled||(E.cancel=K(E.requestParameters,E.callback).cancel)}},b=rs(a,function(E,M,O,B){_(),E?s(E):M&&(En()?function(G,$){var re=new se.Blob([new Uint8Array(G)],{type:"image/png"});se.createImageBitmap(re).then(function(ue){$(null,ue)}).catch(function(ue){$(new Error("Could not load image because of "+ue.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,s):function(G,$,re,ue){var ke=new se.Image,Me=se.URL;ke.onload=function(){$(null,ke),Me.revokeObjectURL(ke.src),ke.onload=null,se.requestAnimationFrame(function(){ke.src=W})},ke.onerror=function(){return $(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Xe=new se.Blob([new Uint8Array(G)],{type:"image/png"});ke.cacheControl=re,ke.expires=ue,ke.src=G.byteLength?Me.createObjectURL(Xe):W}(M,s,O,B))});return{cancel:function(){b.cancel(),_()}}};function ie(a,s,c){c[a]&&c[a].indexOf(s)!==-1||(c[a]=c[a]||[],c[a].push(s))}function _e(a,s,c){if(c&&c[a]){var m=c[a].indexOf(s);m!==-1&&c[a].splice(m,1)}}var Le=function(a,s){s===void 0&&(s={}),Yt(this,s),this.type=a},Ke=function(a){function s(c,m){m===void 0&&(m={}),a.call(this,"error",Yt({error:c},m))}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Le),it=function(){};it.prototype.on=function(a,s){return this._listeners=this._listeners||{},ie(a,s,this._listeners),this},it.prototype.off=function(a,s){return _e(a,s,this._listeners),_e(a,s,this._oneTimeListeners),this},it.prototype.once=function(a,s){return this._oneTimeListeners=this._oneTimeListeners||{},ie(a,s,this._oneTimeListeners),this},it.prototype.fire=function(a,s){typeof a=="string"&&(a=new Le(a,s||{}));var c=a.type;if(this.listens(c)){a.target=this;for(var m=0,_=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];m<_.length;m+=1)_[m].call(this,a);for(var b=0,E=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];b<E.length;b+=1){var M=E[b];_e(c,M,this._oneTimeListeners),M.call(this,a)}var O=this._eventedParent;O&&(Yt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),O.fire(a))}else a instanceof Ke&&console.error(a.error);return this},it.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},it.prototype.setEventedParent=function(a,s){return this._eventedParent=a,this._eventedParentData=s,this};var he={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Oe=function(a,s,c,m){this.message=(a?a+": ":"")+c,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)};function wt(a){var s=a.value;return s?[new Oe(a.key,s,"constants have been deprecated as of v8")]:[]}function br(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var b=_[m];for(var E in b)a[E]=b[E]}return a}function Mr(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Rt(a){if(Array.isArray(a))return a.map(Rt);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var s={};for(var c in a)s[c]=Rt(a[c]);return s}return Mr(a)}var mr=function(a){function s(c,m){a.call(this,m),this.message=m,this.key=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Error),mn=function(a,s){s===void 0&&(s=[]),this.parent=a,this.bindings={};for(var c=0,m=s;c<m.length;c+=1){var _=m[c];this.bindings[_[0]]=_[1]}};mn.prototype.concat=function(a){return new mn(this,a)},mn.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},mn.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var sn={kind:"null"},Qt={kind:"number"},je={kind:"string"},qr={kind:"boolean"},Q={kind:"color"},ri={kind:"object"},en={kind:"value"},Jn={kind:"collator"},Zi={kind:"formatted"},ni={kind:"resolvedImage"};function Ii(a,s){return{kind:"array",itemType:a,N:s}}function hi(a){if(a.kind==="array"){var s=hi(a.itemType);return typeof a.N=="number"?"array<"+s+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+s+">"}return a.kind}var yo=[sn,Qt,je,qr,Q,Zi,ri,Ii(en),ni];function Fi(a,s){if(s.kind==="error")return null;if(a.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Fi(a.itemType,s.itemType))&&(typeof a.N!="number"||a.N===s.N))return null}else{if(a.kind===s.kind)return null;if(a.kind==="value"){for(var c=0,m=yo;c<m.length;c+=1)if(!Fi(m[c],s))return null}}return"Expected "+hi(a)+" but found "+hi(s)+" instead."}function ea(a,s){return s.some(function(c){return c.kind===a.kind})}function vi(a,s){return s.some(function(c){return c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a})}var si=le(function(a,s){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(M){return(M=Math.round(M))<0?0:M>255?255:M}function _(M){return m(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function b(M){return(O=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:O>1?1:O;var O}function E(M,O,B){return B<0?B+=1:B>1&&(B-=1),6*B<1?M+(O-M)*B*6:2*B<1?O:3*B<2?M+(O-M)*(2/3-B)*6:M}try{s.parseCSSColor=function(M){var O,B=M.replace(/ /g,"").toLowerCase();if(B in c)return c[B].slice();if(B[0]==="#")return B.length===4?(O=parseInt(B.substr(1),16))>=0&&O<=4095?[(3840&O)>>4|(3840&O)>>8,240&O|(240&O)>>4,15&O|(15&O)<<4,1]:null:B.length===7&&(O=parseInt(B.substr(1),16))>=0&&O<=16777215?[(16711680&O)>>16,(65280&O)>>8,255&O,1]:null;var G=B.indexOf("("),$=B.indexOf(")");if(G!==-1&&$+1===B.length){var re=B.substr(0,G),ue=B.substr(G+1,$-(G+1)).split(","),ke=1;switch(re){case"rgba":if(ue.length!==4)return null;ke=b(ue.pop());case"rgb":return ue.length!==3?null:[_(ue[0]),_(ue[1]),_(ue[2]),ke];case"hsla":if(ue.length!==4)return null;ke=b(ue.pop());case"hsl":if(ue.length!==3)return null;var Me=(parseFloat(ue[0])%360+360)%360/360,Xe=b(ue[1]),Ve=b(ue[2]),st=Ve<=.5?Ve*(Xe+1):Ve+Xe-Ve*Xe,It=2*Ve-st;return[m(255*E(It,st,Me+1/3)),m(255*E(It,st,Me)),m(255*E(It,st,Me-1/3)),ke];default:return null}}return null}}catch(M){}}).parseCSSColor,Qn=function(a,s,c,m){m===void 0&&(m=1),this.r=a,this.g=s,this.b=c,this.a=m};Qn.parse=function(a){if(a){if(a instanceof Qn)return a;if(typeof a=="string"){var s=si(a);if(s)return new Qn(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},Qn.prototype.toString=function(){var a=this.toArray(),s=a[1],c=a[2],m=a[3];return"rgba("+Math.round(a[0])+","+Math.round(s)+","+Math.round(c)+","+m+")"},Qn.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},Qn.black=new Qn(0,0,0,1),Qn.white=new Qn(1,1,1,1),Qn.transparent=new Qn(0,0,0,0),Qn.red=new Qn(1,0,0,1);var ba=function(a,s,c){this.sensitivity=a?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ba.prototype.compare=function(a,s){return this.collator.compare(a,s)},ba.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Is=function(a,s,c,m,_){this.text=a,this.image=s,this.scale=c,this.fontStack=m,this.textColor=_},Qi=function(a){this.sections=a};Qi.fromString=function(a){return new Qi([new Is(a,null,null,null,null)])},Qi.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},Qi.factory=function(a){return a instanceof Qi?a:Qi.fromString(a)},Qi.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},Qi.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];if(m.image)a.push(["image",m.image.name]);else{a.push(m.text);var _={};m.fontStack&&(_["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(_["font-scale"]=m.scale),m.textColor&&(_["text-color"]=["rgba"].concat(m.textColor.toArray())),a.push(_)}}return a};var fa=function(a){this.name=a.name,this.available=a.available};function Ou(a,s,c,m){return typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof c=="number"&&c>=0&&c<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[a,s,c,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[a,s,c,m]:[a,s,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Du(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Qn||a instanceof ba||a instanceof Qi||a instanceof fa)return!0;if(Array.isArray(a)){for(var s=0,c=a;s<c.length;s+=1)if(!Du(c[s]))return!1;return!0}if(typeof a=="object"){for(var m in a)if(!Du(a[m]))return!1;return!0}return!1}function sa(a){if(a===null)return sn;if(typeof a=="string")return je;if(typeof a=="boolean")return qr;if(typeof a=="number")return Qt;if(a instanceof Qn)return Q;if(a instanceof ba)return Jn;if(a instanceof Qi)return Zi;if(a instanceof fa)return ni;if(Array.isArray(a)){for(var s,c=a.length,m=0,_=a;m<_.length;m+=1){var b=sa(_[m]);if(s){if(s===b)continue;s=en;break}s=b}return Ii(s||en,c)}return ri}function oo(a){var s=typeof a;return a===null?"":s==="string"||s==="number"||s==="boolean"?String(a):a instanceof Qn||a instanceof Qi||a instanceof fa?a.toString():JSON.stringify(a)}fa.prototype.toString=function(){return this.name},fa.fromString=function(a){return a?new fa({name:a,available:!1}):null},fa.prototype.serialize=function(){return["image",this.name]};var Oa=function(a,s){this.type=a,this.value=s};Oa.parse=function(a,s){if(a.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!Du(a[1]))return s.error("invalid value");var c=a[1],m=sa(c),_=s.expectedType;return m.kind!=="array"||m.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(m=_),new Oa(m,c)},Oa.prototype.evaluate=function(){return this.value},Oa.prototype.eachChild=function(){},Oa.prototype.outputDefined=function(){return!0},Oa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Qn?["rgba"].concat(this.value.toArray()):this.value instanceof Qi?this.value.serialize():this.value};var Sa=function(a){this.name="ExpressionEvaluationError",this.message=a};Sa.prototype.toJSON=function(){return this.message};var Ro={string:je,number:Qt,boolean:qr,object:ri},Vi=function(a,s){this.type=a,this.args=s};Vi.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c,m=1,_=a[0];if(_==="array"){var b,E;if(a.length>2){var M=a[1];if(typeof M!="string"||!(M in Ro)||M==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ro[M],m++}else b=en;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=a[2],m++}c=Ii(b,E)}else c=Ro[_];for(var O=[];m<a.length;m++){var B=s.parse(a[m],m,en);if(!B)return null;O.push(B)}return new Vi(c,O)},Vi.prototype.evaluate=function(a){for(var s=0;s<this.args.length;s++){var c=this.args[s].evaluate(a);if(!Fi(this.type,sa(c)))return c;if(s===this.args.length-1)throw new Sa("Expected value to be of type "+hi(this.type)+", but found "+hi(sa(c))+" instead.")}return null},Vi.prototype.eachChild=function(a){this.args.forEach(a)},Vi.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Vi.prototype.serialize=function(){var a=this.type,s=[a.kind];if(a.kind==="array"){var c=a.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);var m=a.N;(typeof m=="number"||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(function(_){return _.serialize()}))};var Oo=function(a){this.type=Zi,this.sections=a};Oo.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");for(var m=[],_=!1,b=1;b<=a.length-1;++b){var E=a[b];if(_&&typeof E=="object"&&!Array.isArray(E)){_=!1;var M=null;if(E["font-scale"]&&!(M=s.parse(E["font-scale"],1,Qt)))return null;var O=null;if(E["text-font"]&&!(O=s.parse(E["text-font"],1,Ii(je))))return null;var B=null;if(E["text-color"]&&!(B=s.parse(E["text-color"],1,Q)))return null;var G=m[m.length-1];G.scale=M,G.font=O,G.textColor=B}else{var $=s.parse(a[b],1,en);if(!$)return null;var re=$.type.kind;if(re!=="string"&&re!=="value"&&re!=="null"&&re!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,m.push({content:$,scale:null,font:null,textColor:null})}}return new Oo(m)},Oo.prototype.evaluate=function(a){return new Qi(this.sections.map(function(s){var c=s.content.evaluate(a);return sa(c)===ni?new Is("",c,null,null,null):new Is(oo(c),null,s.scale?s.scale.evaluate(a):null,s.font?s.font.evaluate(a).join(","):null,s.textColor?s.textColor.evaluate(a):null)}))},Oo.prototype.eachChild=function(a){for(var s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a(m.content),m.scale&&a(m.scale),m.font&&a(m.font),m.textColor&&a(m.textColor)}},Oo.prototype.outputDefined=function(){return!1},Oo.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a.push(m.content.serialize());var _={};m.scale&&(_["font-scale"]=m.scale.serialize()),m.font&&(_["text-font"]=m.font.serialize()),m.textColor&&(_["text-color"]=m.textColor.serialize()),a.push(_)}return a};var _o=function(a){this.type=ni,this.input=a};_o.parse=function(a,s){if(a.length!==2)return s.error("Expected two arguments.");var c=s.parse(a[1],1,je);return c?new _o(c):s.error("No image name provided.")},_o.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=fa.fromString(s);return c&&a.availableImages&&(c.available=a.availableImages.indexOf(s)>-1),c},_o.prototype.eachChild=function(a){a(this.input)},_o.prototype.outputDefined=function(){return!1},_o.prototype.serialize=function(){return["image",this.input.serialize()]};var ns={"to-boolean":qr,"to-color":Q,"to-number":Qt,"to-string":je},is=function(a,s){this.type=a,this.args=s};is.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[0];if((c==="to-boolean"||c==="to-string")&&a.length!==2)return s.error("Expected one argument.");for(var m=ns[c],_=[],b=1;b<a.length;b++){var E=s.parse(a[b],b,en);if(!E)return null;_.push(E)}return new is(m,_)},is.prototype.evaluate=function(a){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(a));if(this.type.kind==="color"){for(var s,c,m=0,_=this.args;m<_.length;m+=1){if(c=null,(s=_[m].evaluate(a))instanceof Qn)return s;if(typeof s=="string"){var b=a.parseColor(s);if(b)return b}else if(Array.isArray(s)&&!(c=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":Ou(s[0],s[1],s[2],s[3])))return new Qn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Sa(c||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var E=null,M=0,O=this.args;M<O.length;M+=1){if((E=O[M].evaluate(a))===null)return 0;var B=Number(E);if(!isNaN(B))return B}throw new Sa("Could not convert "+JSON.stringify(E)+" to number.")}return this.type.kind==="formatted"?Qi.fromString(oo(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?fa.fromString(oo(this.args[0].evaluate(a))):oo(this.args[0].evaluate(a))},is.prototype.eachChild=function(a){this.args.forEach(a)},is.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},is.prototype.serialize=function(){if(this.type.kind==="formatted")return new Oo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new _o(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(s){a.push(s.serialize())}),a};var Gc=["Unknown","Point","LineString","Polygon"],Ho=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Ho.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ho.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Gc[this.feature.type]:this.feature.type:null},Ho.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Ho.prototype.canonicalID=function(){return this.canonical},Ho.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ho.prototype.parseColor=function(a){var s=this._parseColorCache[a];return s||(s=this._parseColorCache[a]=Qn.parse(a)),s};var Da=function(a,s,c,m){this.name=a,this.type=s,this._evaluate=c,this.args=m};Da.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Da.prototype.eachChild=function(a){this.args.forEach(a)},Da.prototype.outputDefined=function(){return!1},Da.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},Da.parse=function(a,s){var c,m=a[0],_=Da.definitions[m];if(!_)return s.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(_)?_[0]:_.type,E=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,M=E.filter(function(Or){var cr=Or[0];return!Array.isArray(cr)||cr.length===a.length-1}),O=null,B=0,G=M;B<G.length;B+=1){var $=G[B],re=$[0],ue=$[1];O=new ss(s.registry,s.path,null,s.scope);for(var ke=[],Me=!1,Xe=1;Xe<a.length;Xe++){var Ve=a[Xe],st=Array.isArray(re)?re[Xe-1]:re.type,It=O.parse(Ve,1+ke.length,st);if(!It){Me=!0;break}ke.push(It)}if(!Me)if(Array.isArray(re)&&re.length!==ke.length)O.error("Expected "+re.length+" arguments, but found "+ke.length+" instead.");else{for(var Nt=0;Nt<ke.length;Nt++){var Ht=Array.isArray(re)?re[Nt]:re.type,or=ke[Nt];O.concat(Nt+1).checkSubtype(Ht,or.type)}if(O.errors.length===0)return new Da(m,b,ue,ke)}}if(M.length===1)(c=s.errors).push.apply(c,O.errors);else{for(var Fr=(M.length?M:E).map(function(Or){var cr;return cr=Or[0],Array.isArray(cr)?"("+cr.map(hi).join(", ")+")":"("+hi(cr.type)+"...)"}).join(" | "),Kr=[],Pn=1;Pn<a.length;Pn++){var on=s.parse(a[Pn],1+Kr.length);if(!on)return null;Kr.push(hi(on.type))}s.error("Expected arguments of type "+Fr+", but found ("+Kr.join(", ")+") instead.")}return null},Da.register=function(a,s){for(var c in Da.definitions=s,s)a[c]=Da};var Ga=function(a,s,c){this.type=Jn,this.locale=c,this.caseSensitive=a,this.diacriticSensitive=s};function Mt(a,s){a[0]=Math.min(a[0],s[0]),a[1]=Math.min(a[1],s[1]),a[2]=Math.max(a[2],s[0]),a[3]=Math.max(a[3],s[1])}function j(a,s){return!(a[0]<=s[0]||a[2]>=s[2]||a[1]<=s[1]||a[3]>=s[3])}function P(a,s){var c=(180+a[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(c*_*8192),Math.round(m*_*8192)]}function rt(a,s,c){return s[1]>a[1]!=c[1]>a[1]&&a[0]<(c[0]-s[0])*(a[1]-s[1])/(c[1]-s[1])+s[0]}function qt(a,s){for(var c,m,_,b,E,M,O,B=!1,G=0,$=s.length;G<$;G++)for(var re=s[G],ue=0,ke=re.length;ue<ke-1;ue++){if((b=(c=a)[0]-(m=re[ue])[0])*(O=c[1]-(_=re[ue+1])[1])-(M=c[0]-_[0])*(E=c[1]-m[1])==0&&b*M<=0&&E*O<=0)return!1;rt(a,re[ue],re[ue+1])&&(B=!B)}return B}function jr(a,s){for(var c=0;c<s.length;c++)if(qt(a,s[c]))return!0;return!1}function Tn(a,s,c,m){var _=m[0]-c[0],b=m[1]-c[1],E=(a[0]-c[0])*b-_*(a[1]-c[1]),M=(s[0]-c[0])*b-_*(s[1]-c[1]);return E>0&&M<0||E<0&&M>0}function Ri(a,s,c){for(var m=0,_=c;m<_.length;m+=1)for(var b=_[m],E=0;E<b.length-1;++E)if(($=[(G=b[E+1])[0]-(B=b[E])[0],G[1]-B[1]])[0]*(re=[(O=s)[0]-(M=a)[0],O[1]-M[1]])[1]-$[1]*re[0]!=0&&Tn(M,O,B,G)&&Tn(B,G,M,O))return!0;var M,O,B,G,$,re;return!1}function Fa(a,s){for(var c=0;c<a.length;++c)if(!qt(a[c],s))return!1;for(var m=0;m<a.length-1;++m)if(Ri(a[m],a[m+1],s))return!1;return!0}function so(a,s){for(var c=0;c<s.length;c++)if(Fa(a,s[c]))return!0;return!1}function Ha(a,s,c){for(var m=[],_=0;_<a.length;_++){for(var b=[],E=0;E<a[_].length;E++){var M=P(a[_][E],c);Mt(s,M),b.push(M)}m.push(b)}return m}function as(a,s,c){for(var m=[],_=0;_<a.length;_++){var b=Ha(a[_],s,c);m.push(b)}return m}function Xr(a,s,c,m){if(a[0]<c[0]||a[0]>c[2]){var _=.5*m,b=a[0]-c[0]>_?-m:c[0]-a[0]>_?m:0;b===0&&(b=a[0]-c[2]>_?-m:c[2]-a[0]>_?m:0),a[0]+=b}Mt(s,a)}function Jr(a,s,c,m){for(var _=8192*Math.pow(2,m.z),b=[8192*m.x,8192*m.y],E=[],M=0,O=a;M<O.length;M+=1)for(var B=0,G=O[M];B<G.length;B+=1){var $=G[B],re=[$.x+b[0],$.y+b[1]];Xr(re,s,c,_),E.push(re)}return E}function Qe(a,s,c,m){for(var _,b=8192*Math.pow(2,m.z),E=[8192*m.x,8192*m.y],M=[],O=0,B=a;O<B.length;O+=1){for(var G=[],$=0,re=B[O];$<re.length;$+=1){var ue=re[$],ke=[ue.x+E[0],ue.y+E[1]];Mt(s,ke),G.push(ke)}M.push(G)}if(s[2]-s[0]<=b/2){(_=s)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var Me=0,Xe=M;Me<Xe.length;Me+=1)for(var Ve=0,st=Xe[Me];Ve<st.length;Ve+=1)Xr(st[Ve],s,c,b)}return M}Ga.parse=function(a,s){if(a.length!==2)return s.error("Expected one argument.");var c=a[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");var m=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,qr);if(!m)return null;var _=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,qr);if(!_)return null;var b=null;return c.locale&&!(b=s.parse(c.locale,1,je))?null:new Ga(m,_,b)},Ga.prototype.evaluate=function(a){return new ba(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Ga.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Ga.prototype.outputDefined=function(){return!1},Ga.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var gs=function(a,s){this.type=qr,this.geojson=a,this.geometries=s};function Fu(a){if(a instanceof Da&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof gs)return!1;var s=!0;return a.eachChild(function(c){s&&!Fu(c)&&(s=!1)}),s}function os(a){if(a instanceof Da&&a.name==="feature-state")return!1;var s=!0;return a.eachChild(function(c){s&&!os(c)&&(s=!1)}),s}function iu(a,s){if(a instanceof Da&&s.indexOf(a.name)>=0)return!1;var c=!0;return a.eachChild(function(m){c&&!iu(m,s)&&(c=!1)}),c}gs.parse=function(a,s){if(a.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(Du(a[1])){var c=a[1];if(c.type==="FeatureCollection")for(var m=0;m<c.features.length;++m){var _=c.features[m].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new gs(c,c.features[m].geometry)}else if(c.type==="Feature"){var b=c.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new gs(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new gs(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},gs.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=s.canonicalID();if(c.type==="Polygon"){var E=Ha(c.coordinates,_,b),M=Jr(s.geometry(),m,_,b);if(!j(m,_))return!1;for(var O=0,B=M;O<B.length;O+=1)if(!qt(B[O],E))return!1}if(c.type==="MultiPolygon"){var G=as(c.coordinates,_,b),$=Jr(s.geometry(),m,_,b);if(!j(m,_))return!1;for(var re=0,ue=$;re<ue.length;re+=1)if(!jr(ue[re],G))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=s.canonicalID();if(c.type==="Polygon"){var E=Ha(c.coordinates,_,b),M=Qe(s.geometry(),m,_,b);if(!j(m,_))return!1;for(var O=0,B=M;O<B.length;O+=1)if(!Fa(B[O],E))return!1}if(c.type==="MultiPolygon"){var G=as(c.coordinates,_,b),$=Qe(s.geometry(),m,_,b);if(!j(m,_))return!1;for(var re=0,ue=$;re<ue.length;re+=1)if(!so(ue[re],G))return!1}return!0}(a,this.geometries)}return!1},gs.prototype.eachChild=function(){},gs.prototype.outputDefined=function(){return!0},gs.prototype.serialize=function(){return["within",this.geojson]};var au=function(a,s){this.type=s.type,this.name=a,this.boundExpression=s};au.parse=function(a,s){if(a.length!==2||typeof a[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var c=a[1];return s.scope.has(c)?new au(c,s.scope.get(c)):s.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},au.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},au.prototype.eachChild=function(){},au.prototype.outputDefined=function(){return!1},au.prototype.serialize=function(){return["var",this.name]};var ss=function(a,s,c,m,_){s===void 0&&(s=[]),m===void 0&&(m=new mn),_===void 0&&(_=[]),this.registry=a,this.path=s,this.key=s.map(function(b){return"["+b+"]"}).join(""),this.scope=m,this.errors=_,this.expectedType=c};function Dl(a,s){for(var c,m=a.length-1,_=0,b=m,E=0;_<=b;)if((c=a[E=Math.floor((_+b)/2)])<=s){if(E===m||s<a[E+1])return E;_=E+1}else{if(!(c>s))throw new Sa("Input is not a number.");b=E-1}return 0}ss.prototype.parse=function(a,s,c,m,_){return _===void 0&&(_={}),s?this.concat(s,c,m)._parse(a,_):this._parse(a,_)},ss.prototype._parse=function(a,s){function c(B,G,$){return $==="assert"?new Vi(G,[B]):$==="coerce"?new is(G,[B]):B}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=a[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[m];if(_){var b=_.parse(a,this);if(!b)return null;if(this.expectedType){var E=this.expectedType,M=b.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||M.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(E,M))return null}else b=c(b,E,s.typeAnnotation||"coerce");else b=c(b,E,s.typeAnnotation||"assert")}if(!(b instanceof Oa)&&b.type.kind!=="resolvedImage"&&function B(G){if(G instanceof au)return B(G.boundExpression);if(G instanceof Da&&G.name==="error"||G instanceof Ga||G instanceof gs)return!1;var $=G instanceof is||G instanceof Vi,re=!0;return G.eachChild(function(ue){re=$?re&&B(ue):re&&ue instanceof Oa}),!!re&&Fu(G)&&iu(G,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var O=new Ho;try{b=new Oa(b.type,b.evaluate(O))}catch(B){return this.error(B.message),null}}return b}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},ss.prototype.concat=function(a,s,c){var m=typeof a=="number"?this.path.concat(a):this.path,_=c?this.scope.concat(c):this.scope;return new ss(this.registry,m,s||null,_,this.errors)},ss.prototype.error=function(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];var m=""+this.key+s.map(function(_){return"["+_+"]"}).join("");this.errors.push(new mr(m,a))},ss.prototype.checkSubtype=function(a,s){var c=Fi(a,s);return c&&this.error(c),c};var Jo=function(a,s,c){this.type=a,this.input=s,this.labels=[],this.outputs=[];for(var m=0,_=c;m<_.length;m+=1){var b=_[m],E=b[1];this.labels.push(b[0]),this.outputs.push(E)}};function wa(a,s,c){return a*(1-c)+s*c}Jo.parse=function(a,s){if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");var c=s.parse(a[1],1,Qt);if(!c)return null;var m=[],_=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(var b=1;b<a.length;b+=2){var E=b===1?-1/0:a[b],M=a[b+1],O=b,B=b+1;if(typeof E!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(m.length&&m[m.length-1][0]>=E)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);var G=s.parse(M,B,_);if(!G)return null;_=_||G.type,m.push([E,G])}return new Jo(_,c,m)},Jo.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;return m>=s[_-1]?c[_-1].evaluate(a):c[Dl(s,m)].evaluate(a)},Jo.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},Jo.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Jo.prototype.serialize=function(){for(var a=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&a.push(this.labels[s]),a.push(this.outputs[s].serialize());return a};var Fl=Object.freeze({__proto__:null,number:wa,color:function(a,s,c){return new Qn(wa(a.r,s.r,c),wa(a.g,s.g,c),wa(a.b,s.b,c),wa(a.a,s.a,c))},array:function(a,s,c){return a.map(function(m,_){return wa(m,s[_],c)})}}),hc=6/29*3*(6/29),Sf=Math.PI/180,ou=180/Math.PI;function Bl(a){return a>.008856451679035631?Math.pow(a,1/3):a/hc+4/29}function zl(a){return a>6/29?a*a*a:hc*(a-4/29)}function wf(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function sh(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Ef(a){var s=sh(a.r),c=sh(a.g),m=sh(a.b),_=Bl((.4124564*s+.3575761*c+.1804375*m)/.95047),b=Bl((.2126729*s+.7151522*c+.072175*m)/1);return{l:116*b-16,a:500*(_-b),b:200*(b-Bl((.0193339*s+.119192*c+.9503041*m)/1.08883)),alpha:a.a}}function Af(a){var s=(a.l+16)/116,c=isNaN(a.a)?s:s+a.a/500,m=isNaN(a.b)?s:s-a.b/200;return s=1*zl(s),c=.95047*zl(c),m=1.08883*zl(m),new Qn(wf(3.2404542*c-1.5371385*s-.4985314*m),wf(-.969266*c+1.8760108*s+.041556*m),wf(.0556434*c-.2040259*s+1.0572252*m),a.alpha)}function uh(a,s,c){var m=s-a;return a+c*(m>180||m<-180?m-360*Math.round(m/360):m)}var ll={forward:Ef,reverse:Af,interpolate:function(a,s,c){return{l:wa(a.l,s.l,c),a:wa(a.a,s.a,c),b:wa(a.b,s.b,c),alpha:wa(a.alpha,s.alpha,c)}}},pc={forward:function(a){var s=Ef(a),c=s.l,m=s.a,_=s.b,b=Math.atan2(_,m)*ou;return{h:b<0?b+360:b,c:Math.sqrt(m*m+_*_),l:c,alpha:a.a}},reverse:function(a){var s=a.h*Sf,c=a.c;return Af({l:a.l,a:Math.cos(s)*c,b:Math.sin(s)*c,alpha:a.alpha})},interpolate:function(a,s,c){return{h:uh(a.h,s.h,c),c:wa(a.c,s.c,c),l:wa(a.l,s.l,c),alpha:wa(a.alpha,s.alpha,c)}}},Cf=Object.freeze({__proto__:null,lab:ll,hcl:pc}),ma=function(a,s,c,m,_){this.type=a,this.operator=s,this.interpolation=c,this.input=m,this.labels=[],this.outputs=[];for(var b=0,E=_;b<E.length;b+=1){var M=E[b],O=M[1];this.labels.push(M[0]),this.outputs.push(O)}};function Hc(a,s,c,m){var _=m-c,b=a-c;return _===0?0:s===1?b/_:(Math.pow(s,b)-1)/(Math.pow(s,_)-1)}ma.interpolationFactor=function(a,s,c,m){var _=0;if(a.name==="exponential")_=Hc(s,a.base,c,m);else if(a.name==="linear")_=Hc(s,1,c,m);else if(a.name==="cubic-bezier"){var b=a.controlPoints;_=new U(b[0],b[1],b[2],b[3]).solve(Hc(s,1,c,m))}return _},ma.parse=function(a,s){var c=a[0],m=a[1],_=a[2],b=a.slice(3);if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var E=m[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:E}}else{if(m[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(m[0]),1,0);var M=m.slice(1);if(M.length!==4||M.some(function(Xe){return typeof Xe!="number"||Xe<0||Xe>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(_=s.parse(_,2,Qt)))return null;var O=[],B=null;c==="interpolate-hcl"||c==="interpolate-lab"?B=Q:s.expectedType&&s.expectedType.kind!=="value"&&(B=s.expectedType);for(var G=0;G<b.length;G+=2){var $=b[G],re=b[G+1],ue=G+3,ke=G+4;if(typeof $!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ue);if(O.length&&O[O.length-1][0]>=$)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ue);var Me=s.parse(re,ke,B);if(!Me)return null;B=B||Me.type,O.push([$,Me])}return B.kind==="number"||B.kind==="color"||B.kind==="array"&&B.itemType.kind==="number"&&typeof B.N=="number"?new ma(B,c,m,_,O):s.error("Type "+hi(B)+" is not interpolatable.")},ma.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;if(m>=s[_-1])return c[_-1].evaluate(a);var b=Dl(s,m),E=ma.interpolationFactor(this.interpolation,m,s[b],s[b+1]),M=c[b].evaluate(a),O=c[b+1].evaluate(a);return this.operator==="interpolate"?Fl[this.type.kind.toLowerCase()](M,O,E):this.operator==="interpolate-hcl"?pc.reverse(pc.interpolate(pc.forward(M),pc.forward(O),E)):ll.reverse(ll.interpolate(ll.forward(M),ll.forward(O),E))},ma.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},ma.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},ma.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,a,this.input.serialize()],c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s};var Bu=function(a,s){this.type=a,this.args=s};Bu.parse=function(a,s){if(a.length<2)return s.error("Expectected at least one argument.");var c=null,m=s.expectedType;m&&m.kind!=="value"&&(c=m);for(var _=[],b=0,E=a.slice(1);b<E.length;b+=1){var M=s.parse(E[b],1+_.length,c,void 0,{typeAnnotation:"omit"});if(!M)return null;c=c||M.type,_.push(M)}var O=m&&_.some(function(B){return Fi(m,B.type)});return new Bu(O?en:c,_)},Bu.prototype.evaluate=function(a){for(var s,c=null,m=0,_=0,b=this.args;_<b.length&&(m++,(c=b[_].evaluate(a))&&c instanceof fa&&!c.available&&(s||(s=c.name),c=null,m===this.args.length&&(c=s)),c===null);_+=1);return c},Bu.prototype.eachChild=function(a){this.args.forEach(a)},Bu.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Bu.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Zs=function(a,s){this.type=s.type,this.bindings=[].concat(a),this.result=s};Zs.prototype.evaluate=function(a){return this.result.evaluate(a)},Zs.prototype.eachChild=function(a){for(var s=0,c=this.bindings;s<c.length;s+=1)a(c[s][1]);a(this.result)},Zs.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var c=[],m=1;m<a.length-1;m+=2){var _=a[m];if(typeof _!="string")return s.error("Expected string, but found "+typeof _+" instead.",m);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);var b=s.parse(a[m+1],m+1);if(!b)return null;c.push([_,b])}var E=s.parse(a[a.length-1],a.length-1,s.expectedType,c);return E?new Zs(c,E):null},Zs.prototype.outputDefined=function(){return this.result.outputDefined()},Zs.prototype.serialize=function(){for(var a=["let"],s=0,c=this.bindings;s<c.length;s+=1){var m=c[s];a.push(m[0],m[1].serialize())}return a.push(this.result.serialize()),a};var gi=function(a,s,c){this.type=a,this.index=s,this.input=c};gi.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,Qt),m=s.parse(a[2],2,Ii(s.expectedType||en));return c&&m?new gi(m.type.itemType,c,m):null},gi.prototype.evaluate=function(a){var s=this.index.evaluate(a),c=this.input.evaluate(a);if(s<0)throw new Sa("Array index out of bounds: "+s+" < 0.");if(s>=c.length)throw new Sa("Array index out of bounds: "+s+" > "+(c.length-1)+".");if(s!==Math.floor(s))throw new Sa("Array index must be an integer, but found "+s+" instead.");return c[s]},gi.prototype.eachChild=function(a){a(this.index),a(this.input)},gi.prototype.outputDefined=function(){return!1},gi.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Mo=function(a,s){this.type=qr,this.needle=a,this.haystack=s};Mo.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,en),m=s.parse(a[2],2,en);return c&&m?ea(c.type,[qr,je,Qt,sn,en])?new Mo(c,m):s.error("Expected first argument to be of type boolean, string, number or null, but found "+hi(c.type)+" instead"):null},Mo.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!c)return!1;if(!vi(s,["boolean","string","number","null"]))throw new Sa("Expected first argument to be of type boolean, string, number or null, but found "+hi(sa(s))+" instead.");if(!vi(c,["string","array"]))throw new Sa("Expected second argument to be of type array or string, but found "+hi(sa(c))+" instead.");return c.indexOf(s)>=0},Mo.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Mo.prototype.outputDefined=function(){return!0},Mo.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Do=function(a,s,c){this.type=Qt,this.needle=a,this.haystack=s,this.fromIndex=c};Do.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,en),m=s.parse(a[2],2,en);if(!c||!m)return null;if(!ea(c.type,[qr,je,Qt,sn,en]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+hi(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,Qt);return _?new Do(c,m,_):null}return new Do(c,m)},Do.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!vi(s,["boolean","string","number","null"]))throw new Sa("Expected first argument to be of type boolean, string, number or null, but found "+hi(sa(s))+" instead.");if(!vi(c,["string","array"]))throw new Sa("Expected second argument to be of type array or string, but found "+hi(sa(c))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(a);return c.indexOf(s,m)}return c.indexOf(s)},Do.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},Do.prototype.outputDefined=function(){return!1},Do.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var us=function(a,s,c,m,_,b){this.inputType=a,this.type=s,this.input=c,this.cases=m,this.outputs=_,this.otherwise=b};us.parse=function(a,s){if(a.length<5)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return s.error("Expected an even number of arguments.");var c,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);for(var _={},b=[],E=2;E<a.length-1;E+=2){var M=a[E],O=a[E+1];Array.isArray(M)||(M=[M]);var B=s.concat(E);if(M.length===0)return B.error("Expected at least one branch label.");for(var G=0,$=M;G<$.length;G+=1){var re=$[G];if(typeof re!="number"&&typeof re!="string")return B.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return B.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof re=="number"&&Math.floor(re)!==re)return B.error("Numeric branch labels must be integer values.");if(c){if(B.checkSubtype(c,sa(re)))return null}else c=sa(re);if(_[String(re)]!==void 0)return B.error("Branch labels must be unique.");_[String(re)]=b.length}var ue=s.parse(O,E,m);if(!ue)return null;m=m||ue.type,b.push(ue)}var ke=s.parse(a[1],1,en);if(!ke)return null;var Me=s.parse(a[a.length-1],a.length-1,m);return Me?ke.type.kind!=="value"&&s.concat(1).checkSubtype(c,ke.type)?null:new us(c,m,ke,_,b,Me):null},us.prototype.evaluate=function(a){var s=this.input.evaluate(a);return(sa(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(a)},us.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},us.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},us.prototype.serialize=function(){for(var a=this,s=["match",this.input.serialize()],c=[],m={},_=0,b=Object.keys(this.cases).sort();_<b.length;_+=1){var E=b[_];($=m[this.cases[E]])===void 0?(m[this.cases[E]]=c.length,c.push([this.cases[E],[E]])):c[$][1].push(E)}for(var M=function(ue){return a.inputType.kind==="number"?Number(ue):ue},O=0,B=c;O<B.length;O+=1){var G=B[O],$=G[0],re=G[1];s.push(re.length===1?M(re[0]):re.map(M)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var zu=function(a,s,c){this.type=a,this.branches=s,this.otherwise=c};zu.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return s.error("Expected an odd number of arguments.");var c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);for(var m=[],_=1;_<a.length-1;_+=2){var b=s.parse(a[_],_,qr);if(!b)return null;var E=s.parse(a[_+1],_+1,c);if(!E)return null;m.push([b,E]),c=c||E.type}var M=s.parse(a[a.length-1],a.length-1,c);return M?new zu(c,m,M):null},zu.prototype.evaluate=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];if(m[0].evaluate(a))return _.evaluate(a)}return this.otherwise.evaluate(a)},zu.prototype.eachChild=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];a(m[0]),a(_)}a(this.otherwise)},zu.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},zu.prototype.serialize=function(){var a=["case"];return this.eachChild(function(s){a.push(s.serialize())}),a};var ls=function(a,s,c,m){this.type=a,this.input=s,this.beginIndex=c,this.endIndex=m};function Wc(a,s){return a==="=="||a==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function lh(a,s,c,m){return m.compare(s,c)===0}function Ki(a,s,c){var m=a!=="=="&&a!=="!=";return function(){function _(b,E,M){this.type=qr,this.lhs=b,this.rhs=E,this.collator=M,this.hasUntypedArgument=b.type.kind==="value"||E.type.kind==="value"}return _.parse=function(b,E){if(b.length!==3&&b.length!==4)return E.error("Expected two or three arguments.");var M=b[0],O=E.parse(b[1],1,en);if(!O)return null;if(!Wc(M,O.type))return E.concat(1).error('"'+M+`" comparisons are not supported for type '`+hi(O.type)+"'.");var B=E.parse(b[2],2,en);if(!B)return null;if(!Wc(M,B.type))return E.concat(2).error('"'+M+`" comparisons are not supported for type '`+hi(B.type)+"'.");if(O.type.kind!==B.type.kind&&O.type.kind!=="value"&&B.type.kind!=="value")return E.error("Cannot compare types '"+hi(O.type)+"' and '"+hi(B.type)+"'.");m&&(O.type.kind==="value"&&B.type.kind!=="value"?O=new Vi(B.type,[O]):O.type.kind!=="value"&&B.type.kind==="value"&&(B=new Vi(O.type,[B])));var G=null;if(b.length===4){if(O.type.kind!=="string"&&B.type.kind!=="string"&&O.type.kind!=="value"&&B.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(!(G=E.parse(b[3],3,Jn)))return null}return new _(O,B,G)},_.prototype.evaluate=function(b){var E=this.lhs.evaluate(b),M=this.rhs.evaluate(b);if(m&&this.hasUntypedArgument){var O=sa(E),B=sa(M);if(O.kind!==B.kind||O.kind!=="string"&&O.kind!=="number")throw new Sa('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+O.kind+", "+B.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var G=sa(E),$=sa(M);if(G.kind!=="string"||$.kind!=="string")return s(b,E,M)}return this.collator?c(b,E,M,this.collator.evaluate(b)):s(b,E,M)},_.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var b=[a];return this.eachChild(function(E){b.push(E.serialize())}),b},_}()}ls.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,en),m=s.parse(a[2],2,Qt);if(!c||!m)return null;if(!ea(c.type,[Ii(en),je,en]))return s.error("Expected first argument to be of type array or string, but found "+hi(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,Qt);return _?new ls(c.type,c,m,_):null}return new ls(c.type,c,m)},ls.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=this.beginIndex.evaluate(a);if(!vi(s,["string","array"]))throw new Sa("Expected first argument to be of type array or string, but found "+hi(sa(s))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(a);return s.slice(c,m)}return s.slice(c)},ls.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},ls.prototype.outputDefined=function(){return!1},ls.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Tf=Ki("==",function(a,s,c){return s===c},lh),Us=Ki("!=",function(a,s,c){return s!==c},function(a,s,c,m){return!lh(0,s,c,m)}),dc=Ki("<",function(a,s,c){return s<c},function(a,s,c,m){return m.compare(s,c)<0}),Dn=Ki(">",function(a,s,c){return s>c},function(a,s,c,m){return m.compare(s,c)>0}),Mf=Ki("<=",function(a,s,c){return s<=c},function(a,s,c,m){return m.compare(s,c)<=0}),Ta=Ki(">=",function(a,s,c){return s>=c},function(a,s,c,m){return m.compare(s,c)>=0}),Nu=function(a,s,c,m,_){this.type=je,this.number=a,this.locale=s,this.currency=c,this.minFractionDigits=m,this.maxFractionDigits=_};Nu.parse=function(a,s){if(a.length!==3)return s.error("Expected two arguments.");var c=s.parse(a[1],1,Qt);if(!c)return null;var m=a[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");var _=null;if(m.locale&&!(_=s.parse(m.locale,1,je)))return null;var b=null;if(m.currency&&!(b=s.parse(m.currency,1,je)))return null;var E=null;if(m["min-fraction-digits"]&&!(E=s.parse(m["min-fraction-digits"],1,Qt)))return null;var M=null;return m["max-fraction-digits"]&&!(M=s.parse(m["max-fraction-digits"],1,Qt))?null:new Nu(c,_,b,E,M)},Nu.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Nu.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Nu.prototype.outputDefined=function(){return!1},Nu.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var Zu=function(a){this.type=Qt,this.input=a};Zu.parse=function(a,s){if(a.length!==2)return s.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+hi(c.type)+" instead."):new Zu(c):null},Zu.prototype.evaluate=function(a){var s=this.input.evaluate(a);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Sa("Expected value to be of type string or array, but found "+hi(sa(s))+" instead.")},Zu.prototype.eachChild=function(a){a(this.input)},Zu.prototype.outputDefined=function(){return!1},Zu.prototype.serialize=function(){var a=["length"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Wo={"==":Tf,"!=":Us,">":Dn,"<":dc,">=":Ta,"<=":Mf,array:Vi,at:gi,boolean:Vi,case:zu,coalesce:Bu,collator:Ga,format:Oo,image:_o,in:Mo,"index-of":Do,interpolate:ma,"interpolate-hcl":ma,"interpolate-lab":ma,length:Zu,let:Zs,literal:Oa,match:us,number:Vi,"number-format":Nu,object:Vi,slice:ls,step:Jo,string:Vi,"to-boolean":is,"to-color":is,"to-number":is,"to-string":is,var:au,within:gs};function $c(a,s){var c=s[0],m=s[1],_=s[2],b=s[3];c=c.evaluate(a),m=m.evaluate(a),_=_.evaluate(a);var E=b?b.evaluate(a):1,M=Ou(c,m,_,E);if(M)throw new Sa(M);return new Qn(c/255*E,m/255*E,_/255*E,E)}function vc(a,s){return a in s}function bu(a,s){var c=s[a];return c===void 0?null:c}function Su(a){return{type:a}}function mc(a){return{result:"success",value:a}}function Vs(a){return{result:"error",value:a}}function uo(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function If(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function cl(a){return!!a.expression&&a.expression.interpolated}function ta(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Yc(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Uh(a){return a}function Nl(a,s,c){return a!==void 0?a:s!==void 0?s:c!==void 0?c:void 0}function ch(a,s,c,m,_){return Nl(typeof c===_?m[c]:void 0,a.default,s.default)}function Pf(a,s,c){if(ta(c)!=="number")return Nl(a.default,s.default);var m=a.stops.length;if(m===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[m-1][0])return a.stops[m-1][1];var _=Dl(a.stops.map(function(b){return b[0]}),c);return a.stops[_][1]}function gc(a,s,c){var m=a.base!==void 0?a.base:1;if(ta(c)!=="number")return Nl(a.default,s.default);var _=a.stops.length;if(_===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[_-1][0])return a.stops[_-1][1];var b=Dl(a.stops.map(function($){return $[0]}),c),E=function($,re,ue,ke){var Me=ke-ue,Xe=$-ue;return Me===0?0:re===1?Xe/Me:(Math.pow(re,Xe)-1)/(Math.pow(re,Me)-1)}(c,m,a.stops[b][0],a.stops[b+1][0]),M=a.stops[b][1],O=a.stops[b+1][1],B=Fl[s.type]||Uh;if(a.colorSpace&&a.colorSpace!=="rgb"){var G=Cf[a.colorSpace];B=function($,re){return G.reverse(G.interpolate(G.forward($),G.forward(re),E))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var $=[],re=arguments.length;re--;)$[re]=arguments[re];var ue=M.evaluate.apply(void 0,$),ke=O.evaluate.apply(void 0,$);if(ue!==void 0&&ke!==void 0)return B(ue,ke,E)}}:B(M,O,E)}function Zl(a,s,c){return s.type==="color"?c=Qn.parse(c):s.type==="formatted"?c=Qi.fromString(c.toString()):s.type==="resolvedImage"?c=fa.fromString(c.toString()):ta(c)===s.type||s.type==="enum"&&s.values[c]||(c=void 0),Nl(c,a.default,s.default)}Da.register(Wo,{error:[{kind:"error"},[je],function(a,s){throw new Sa(s[0].evaluate(a))}],typeof:[je,[en],function(a,s){return hi(sa(s[0].evaluate(a)))}],"to-rgba":[Ii(Qt,4),[Q],function(a,s){return s[0].evaluate(a).toArray()}],rgb:[Q,[Qt,Qt,Qt],$c],rgba:[Q,[Qt,Qt,Qt,Qt],$c],has:{type:qr,overloads:[[[je],function(a,s){return vc(s[0].evaluate(a),a.properties())}],[[je,ri],function(a,s){var c=s[1];return vc(s[0].evaluate(a),c.evaluate(a))}]]},get:{type:en,overloads:[[[je],function(a,s){return bu(s[0].evaluate(a),a.properties())}],[[je,ri],function(a,s){var c=s[1];return bu(s[0].evaluate(a),c.evaluate(a))}]]},"feature-state":[en,[je],function(a,s){return bu(s[0].evaluate(a),a.featureState||{})}],properties:[ri,[],function(a){return a.properties()}],"geometry-type":[je,[],function(a){return a.geometryType()}],id:[en,[],function(a){return a.id()}],zoom:[Qt,[],function(a){return a.globals.zoom}],"heatmap-density":[Qt,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[Qt,[],function(a){return a.globals.lineProgress||0}],accumulated:[en,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[Qt,Su(Qt),function(a,s){for(var c=0,m=0,_=s;m<_.length;m+=1)c+=_[m].evaluate(a);return c}],"*":[Qt,Su(Qt),function(a,s){for(var c=1,m=0,_=s;m<_.length;m+=1)c*=_[m].evaluate(a);return c}],"-":{type:Qt,overloads:[[[Qt,Qt],function(a,s){var c=s[1];return s[0].evaluate(a)-c.evaluate(a)}],[[Qt],function(a,s){return-s[0].evaluate(a)}]]},"/":[Qt,[Qt,Qt],function(a,s){var c=s[1];return s[0].evaluate(a)/c.evaluate(a)}],"%":[Qt,[Qt,Qt],function(a,s){var c=s[1];return s[0].evaluate(a)%c.evaluate(a)}],ln2:[Qt,[],function(){return Math.LN2}],pi:[Qt,[],function(){return Math.PI}],e:[Qt,[],function(){return Math.E}],"^":[Qt,[Qt,Qt],function(a,s){var c=s[1];return Math.pow(s[0].evaluate(a),c.evaluate(a))}],sqrt:[Qt,[Qt],function(a,s){return Math.sqrt(s[0].evaluate(a))}],log10:[Qt,[Qt],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN10}],ln:[Qt,[Qt],function(a,s){return Math.log(s[0].evaluate(a))}],log2:[Qt,[Qt],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN2}],sin:[Qt,[Qt],function(a,s){return Math.sin(s[0].evaluate(a))}],cos:[Qt,[Qt],function(a,s){return Math.cos(s[0].evaluate(a))}],tan:[Qt,[Qt],function(a,s){return Math.tan(s[0].evaluate(a))}],asin:[Qt,[Qt],function(a,s){return Math.asin(s[0].evaluate(a))}],acos:[Qt,[Qt],function(a,s){return Math.acos(s[0].evaluate(a))}],atan:[Qt,[Qt],function(a,s){return Math.atan(s[0].evaluate(a))}],min:[Qt,Su(Qt),function(a,s){return Math.min.apply(Math,s.map(function(c){return c.evaluate(a)}))}],max:[Qt,Su(Qt),function(a,s){return Math.max.apply(Math,s.map(function(c){return c.evaluate(a)}))}],abs:[Qt,[Qt],function(a,s){return Math.abs(s[0].evaluate(a))}],round:[Qt,[Qt],function(a,s){var c=s[0].evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[Qt,[Qt],function(a,s){return Math.floor(s[0].evaluate(a))}],ceil:[Qt,[Qt],function(a,s){return Math.ceil(s[0].evaluate(a))}],"filter-==":[qr,[je,en],function(a,s){var c=s[0],m=s[1];return a.properties()[c.value]===m.value}],"filter-id-==":[qr,[en],function(a,s){var c=s[0];return a.id()===c.value}],"filter-type-==":[qr,[je],function(a,s){var c=s[0];return a.geometryType()===c.value}],"filter-<":[qr,[je,en],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_<b}],"filter-id-<":[qr,[en],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<_}],"filter->":[qr,[je,en],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_>b}],"filter-id->":[qr,[en],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>_}],"filter-<=":[qr,[je,en],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_<=b}],"filter-id-<=":[qr,[en],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<=_}],"filter->=":[qr,[je,en],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_>=b}],"filter-id->=":[qr,[en],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>=_}],"filter-has":[qr,[en],function(a,s){return s[0].value in a.properties()}],"filter-has-id":[qr,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[qr,[Ii(je)],function(a,s){return s[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[qr,[Ii(en)],function(a,s){return s[0].value.indexOf(a.id())>=0}],"filter-in-small":[qr,[je,Ii(en)],function(a,s){var c=s[0];return s[1].value.indexOf(a.properties()[c.value])>=0}],"filter-in-large":[qr,[je,Ii(en)],function(a,s){var c=s[0],m=s[1];return function(_,b,E,M){for(;E<=M;){var O=E+M>>1;if(b[O]===_)return!0;b[O]>_?M=O-1:E=O+1}return!1}(a.properties()[c.value],m.value,0,m.value.length-1)}],all:{type:qr,overloads:[[[qr,qr],function(a,s){var c=s[1];return s[0].evaluate(a)&&c.evaluate(a)}],[Su(qr),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(!m[c].evaluate(a))return!1;return!0}]]},any:{type:qr,overloads:[[[qr,qr],function(a,s){var c=s[1];return s[0].evaluate(a)||c.evaluate(a)}],[Su(qr),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(m[c].evaluate(a))return!0;return!1}]]},"!":[qr,[qr],function(a,s){return!s[0].evaluate(a)}],"is-supported-script":[qr,[je],function(a,s){var c=a.globals&&a.globals.isSupportedScript;return!c||c(s[0].evaluate(a))}],upcase:[je,[je],function(a,s){return s[0].evaluate(a).toUpperCase()}],downcase:[je,[je],function(a,s){return s[0].evaluate(a).toLowerCase()}],concat:[je,Su(en),function(a,s){return s.map(function(c){return oo(c.evaluate(a))}).join("")}],"resolved-locale":[je,[Jn],function(a,s){return s[0].evaluate(a).resolvedLocale()}]});var Uu=function(a,s){this.expression=a,this._warningHistory={},this._evaluator=new Ho,this._defaultValue=s?function(c){return c.type==="color"&&Yc(c.default)?new Qn(0,0,0,0):c.type==="color"?Qn.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function su(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Wo}function Ul(a,s){var c=new ss(Wo,[],s?function(_){var b={color:Q,string:je,number:Qt,enum:je,boolean:qr,formatted:Zi,resolvedImage:ni};return _.type==="array"?Ii(b[_.value]||en,_.length):b[_.type]}(s):void 0),m=c.parse(a,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?mc(new Uu(m,s)):Vs(c.errors)}Uu.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,b){return this._evaluator.globals=a,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},Uu.prototype.evaluate=function(a,s,c,m,_,b){this._evaluator.globals=a,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b||null;try{var E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Sa("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(E)+" instead.");return E}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var fl=function(a,s){this.kind=a,this._styleExpression=s,this.isStateDependent=a!=="constant"&&!os(s.expression)};fl.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,b){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,b)},fl.prototype.evaluate=function(a,s,c,m,_,b){return this._styleExpression.evaluate(a,s,c,m,_,b)};var Vu=function(a,s,c,m){this.kind=a,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=a!=="camera"&&!os(s.expression),this.interpolationType=m};function Xc(a,s){if((a=Ul(a,s)).result==="error")return a;var c=a.value.expression,m=Fu(c);if(!m&&!uo(s))return Vs([new mr("","data expressions not supported")]);var _=iu(c,["zoom"]);if(!_&&!If(s))return Vs([new mr("","zoom expressions not supported")]);var b=function E(M){var O=null;if(M instanceof Zs)O=E(M.result);else if(M instanceof Bu)for(var B=0,G=M.args;B<G.length&&!(O=E(G[B]));B+=1);else(M instanceof Jo||M instanceof ma)&&M.input instanceof Da&&M.input.name==="zoom"&&(O=M);return O instanceof mr||M.eachChild(function($){var re=E($);re instanceof mr?O=re:!O&&re?O=new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):O&&re&&O!==re&&(O=new mr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),O}(c);return b||_?b instanceof mr?Vs([b]):b instanceof ma&&!cl(s)?Vs([new mr("",'"interpolate" expressions cannot be used with this property')]):mc(b?new Vu(m?"camera":"composite",a.value,b.labels,b instanceof ma?b.interpolation:void 0):new fl(m?"constant":"source",a.value)):Vs([new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Vu.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,b){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,b)},Vu.prototype.evaluate=function(a,s,c,m,_,b){return this._styleExpression.evaluate(a,s,c,m,_,b)},Vu.prototype.interpolationFactor=function(a,s,c){return this.interpolationType?ma.interpolationFactor(this.interpolationType,a,s,c):0};var hl=function(a,s){this._parameters=a,this._specification=s,br(this,function c(m,_){var b,E,M,O=_.type==="color",B=m.stops&&typeof m.stops[0][0]=="object",G=B||!(B||m.property!==void 0),$=m.type||(cl(_)?"exponential":"interval");if(O&&((m=br({},m)).stops&&(m.stops=m.stops.map(function(on){return[on[0],Qn.parse(on[1])]})),m.default=Qn.parse(m.default?m.default:_.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!Cf[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if($==="exponential")b=gc;else if($==="interval")b=Pf;else if($==="categorical"){b=ch,E=Object.create(null);for(var re=0,ue=m.stops;re<ue.length;re+=1){var ke=ue[re];E[ke[0]]=ke[1]}M=typeof m.stops[0][0]}else{if($!=="identity")throw new Error('Unknown function type "'+$+'"');b=Zl}if(B){for(var Me={},Xe=[],Ve=0;Ve<m.stops.length;Ve++){var st=m.stops[Ve],It=st[0].zoom;Me[It]===void 0&&(Me[It]={zoom:It,type:m.type,property:m.property,default:m.default,stops:[]},Xe.push(It)),Me[It].stops.push([st[0].value,st[1]])}for(var Nt=[],Ht=0,or=Xe;Ht<or.length;Ht+=1){var Fr=or[Ht];Nt.push([Me[Fr].zoom,c(Me[Fr],_)])}var Kr={name:"linear"};return{kind:"composite",interpolationType:Kr,interpolationFactor:ma.interpolationFactor.bind(void 0,Kr),zoomStops:Nt.map(function(on){return on[0]}),evaluate:function(on,Or){var cr=on.zoom;return gc({stops:Nt,base:m.base},_,cr).evaluate(cr,Or)}}}if(G){var Pn=$==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:Pn,interpolationFactor:ma.interpolationFactor.bind(void 0,Pn),zoomStops:m.stops.map(function(on){return on[0]}),evaluate:function(on){return b(m,_,on.zoom,E,M)}}}return{kind:"source",evaluate:function(on,Or){var cr=Or&&Or.properties?Or.properties[m.property]:void 0;return cr===void 0?Nl(m.default,_.default):b(m,_,cr,E,M)}}}(this._parameters,this._specification))};function Ps(a){var s=a.key,c=a.value,m=a.valueSpec||{},_=a.objectElementValidators||{},b=a.style,E=a.styleSpec,M=[],O=ta(c);if(O!=="object")return[new Oe(s,c,"object expected, "+O+" found")];for(var B in c){var G=B.split(".")[0],$=m[G]||m["*"],re=void 0;if(_[G])re=_[G];else if(m[G])re=mi;else if(_["*"])re=_["*"];else{if(!m["*"]){M.push(new Oe(s,c[B],'unknown property "'+B+'"'));continue}re=mi}M=M.concat(re({key:(s&&s+".")+B,value:c[B],valueSpec:$,style:b,styleSpec:E,object:c,objectKey:B},c))}for(var ue in m)_[ue]||m[ue].required&&m[ue].default===void 0&&c[ue]===void 0&&M.push(new Oe(s,c,'missing required property "'+ue+'"'));return M}function kf(a){var s=a.value,c=a.valueSpec,m=a.style,_=a.styleSpec,b=a.key,E=a.arrayElementValidator||mi;if(ta(s)!=="array")return[new Oe(b,s,"array expected, "+ta(s)+" found")];if(c.length&&s.length!==c.length)return[new Oe(b,s,"array length "+c.length+" expected, length "+s.length+" found")];if(c["min-length"]&&s.length<c["min-length"])return[new Oe(b,s,"array length at least "+c["min-length"]+" expected, length "+s.length+" found")];var M={type:c.value,values:c.values};_.$version<7&&(M.function=c.function),ta(c.value)==="object"&&(M=c.value);for(var O=[],B=0;B<s.length;B++)O=O.concat(E({array:s,arrayIndex:B,value:s[B],valueSpec:M,style:m,styleSpec:_,key:b+"["+B+"]"}));return O}function Lf(a){var s=a.key,c=a.value,m=a.valueSpec,_=ta(c);return _==="number"&&c!=c&&(_="NaN"),_!=="number"?[new Oe(s,c,"number expected, "+_+" found")]:"minimum"in m&&c<m.minimum?[new Oe(s,c,c+" is less than the minimum value "+m.minimum)]:"maximum"in m&&c>m.maximum?[new Oe(s,c,c+" is greater than the maximum value "+m.maximum)]:[]}function Rf(a){var s,c,m,_=a.valueSpec,b=Mr(a.value.type),E={},M=b!=="categorical"&&a.value.property===void 0,O=!M,B=ta(a.value.stops)==="array"&&ta(a.value.stops[0])==="array"&&ta(a.value.stops[0][0])==="object",G=Ps({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(ue){if(b==="identity")return[new Oe(ue.key,ue.value,'identity function may not have a "stops" property')];var ke=[],Me=ue.value;return ke=ke.concat(kf({key:ue.key,value:Me,valueSpec:ue.valueSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:$})),ta(Me)==="array"&&Me.length===0&&ke.push(new Oe(ue.key,Me,"array must have at least one stop")),ke},default:function(ue){return mi({key:ue.key,value:ue.value,valueSpec:_,style:ue.style,styleSpec:ue.styleSpec})}}});return b==="identity"&&M&&G.push(new Oe(a.key,a.value,'missing required property "property"')),b==="identity"||a.value.stops||G.push(new Oe(a.key,a.value,'missing required property "stops"')),b==="exponential"&&a.valueSpec.expression&&!cl(a.valueSpec)&&G.push(new Oe(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(O&&!uo(a.valueSpec)?G.push(new Oe(a.key,a.value,"property functions not supported")):M&&!If(a.valueSpec)&&G.push(new Oe(a.key,a.value,"zoom functions not supported"))),b!=="categorical"&&!B||a.value.property!==void 0||G.push(new Oe(a.key,a.value,'"property" property is required')),G;function $(ue){var ke=[],Me=ue.value,Xe=ue.key;if(ta(Me)!=="array")return[new Oe(Xe,Me,"array expected, "+ta(Me)+" found")];if(Me.length!==2)return[new Oe(Xe,Me,"array length 2 expected, length "+Me.length+" found")];if(B){if(ta(Me[0])!=="object")return[new Oe(Xe,Me,"object expected, "+ta(Me[0])+" found")];if(Me[0].zoom===void 0)return[new Oe(Xe,Me,"object stop key must have zoom")];if(Me[0].value===void 0)return[new Oe(Xe,Me,"object stop key must have value")];if(m&&m>Mr(Me[0].zoom))return[new Oe(Xe,Me[0].zoom,"stop zoom values must appear in ascending order")];Mr(Me[0].zoom)!==m&&(m=Mr(Me[0].zoom),c=void 0,E={}),ke=ke.concat(Ps({key:Xe+"[0]",value:Me[0],valueSpec:{zoom:{}},style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:Lf,value:re}}))}else ke=ke.concat(re({key:Xe+"[0]",value:Me[0],valueSpec:{},style:ue.style,styleSpec:ue.styleSpec},Me));return su(Rt(Me[1]))?ke.concat([new Oe(Xe+"[1]",Me[1],"expressions are not allowed in function stops.")]):ke.concat(mi({key:Xe+"[1]",value:Me[1],valueSpec:_,style:ue.style,styleSpec:ue.styleSpec}))}function re(ue,ke){var Me=ta(ue.value),Xe=Mr(ue.value),Ve=ue.value!==null?ue.value:ke;if(s){if(Me!==s)return[new Oe(ue.key,Ve,Me+" stop domain type must match previous stop domain type "+s)]}else s=Me;if(Me!=="number"&&Me!=="string"&&Me!=="boolean")return[new Oe(ue.key,Ve,"stop domain value must be a number, string, or boolean")];if(Me!=="number"&&b!=="categorical"){var st="number expected, "+Me+" found";return uo(_)&&b===void 0&&(st+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Oe(ue.key,Ve,st)]}return b!=="categorical"||Me!=="number"||isFinite(Xe)&&Math.floor(Xe)===Xe?b!=="categorical"&&Me==="number"&&c!==void 0&&Xe<c?[new Oe(ue.key,Ve,"stop domain values must appear in ascending order")]:(c=Xe,b==="categorical"&&Xe in E?[new Oe(ue.key,Ve,"stop domain values must be unique")]:(E[Xe]=!0,[])):[new Oe(ue.key,Ve,"integer expected, found "+Xe)]}}function ju(a){var s=(a.expressionContext==="property"?Xc:Ul)(Rt(a.value),a.valueSpec);if(s.result==="error")return s.value.map(function(m){return new Oe(""+a.key+m.key,a.value,m.message)});var c=s.value.expression||s.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new Oe(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!os(c))return[new Oe(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!os(c))return[new Oe(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!iu(c,["zoom","feature-state"]))return[new Oe(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Fu(c))return[new Oe(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vl(a){var s=a.key,c=a.value,m=a.valueSpec,_=[];return Array.isArray(m.values)?m.values.indexOf(Mr(c))===-1&&_.push(new Oe(s,c,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(m.values).indexOf(Mr(c))===-1&&_.push(new Oe(s,c,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(c)+" found")),_}function yc(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var s=0,c=a.slice(1);s<c.length;s+=1){var m=c[s];if(!yc(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}hl.deserialize=function(a){return new hl(a._parameters,a._specification)},hl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var Gu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function jl(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};yc(a)||(a=Hu(a));var s=Ul(a,Gu);if(s.result==="error")throw new Error(s.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,m,_){return s.value.evaluate(c,m,{},_)},needGeometry:function c(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var _=1;_<m.length;_++)if(c(m[_]))return!0;return!1}(a)}}function Of(a,s){return a<s?-1:a>s?1:0}function Hu(a){if(!a)return!0;var s,c=a[0];return a.length<=1?c!=="any":c==="=="?Df(a[1],a[2],"=="):c==="!="?Gl(Df(a[1],a[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Df(a[1],a[2],c):c==="any"?(s=a.slice(1),["any"].concat(s.map(Hu))):c==="all"?["all"].concat(a.slice(1).map(Hu)):c==="none"?["all"].concat(a.slice(1).map(Hu).map(Gl)):c==="in"?fh(a[1],a.slice(2)):c==="!in"?Gl(fh(a[1],a.slice(2))):c==="has"?yi(a[1]):c==="!has"?Gl(yi(a[1])):c!=="within"||a}function Df(a,s,c){switch(a){case"$type":return["filter-type-"+c,s];case"$id":return["filter-id-"+c,s];default:return["filter-"+c,a,s]}}function fh(a,s){if(s.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(c){return typeof c!=typeof s[0]})?["filter-in-large",a,["literal",s.sort(Of)]]:["filter-in-small",a,["literal",s]]}}function yi(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Gl(a){return["!",a]}function qc(a){return yc(Rt(a.value))?ju(br({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(c){var m=c.value,_=c.key;if(ta(m)!=="array")return[new Oe(_,m,"array expected, "+ta(m)+" found")];var b,E=c.styleSpec,M=[];if(m.length<1)return[new Oe(_,m,"filter array must have at least 1 element")];switch(M=M.concat(Vl({key:_+"[0]",value:m[0],valueSpec:E.filter_operator,style:c.style,styleSpec:c.styleSpec})),Mr(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&Mr(m[1])==="$type"&&M.push(new Oe(_,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&M.push(new Oe(_,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(b=ta(m[1]))!=="string"&&M.push(new Oe(_+"[1]",m[1],"string expected, "+b+" found"));for(var O=2;O<m.length;O++)b=ta(m[O]),Mr(m[1])==="$type"?M=M.concat(Vl({key:_+"["+O+"]",value:m[O],valueSpec:E.geometry_type,style:c.style,styleSpec:c.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&M.push(new Oe(_+"["+O+"]",m[O],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var B=1;B<m.length;B++)M=M.concat(s({key:_+"["+B+"]",value:m[B],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":b=ta(m[1]),m.length!==2?M.push(new Oe(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):b!=="string"&&M.push(new Oe(_+"[1]",m[1],"string expected, "+b+" found"));break;case"within":b=ta(m[1]),m.length!==2?M.push(new Oe(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):b!=="object"&&M.push(new Oe(_+"[1]",m[1],"object expected, "+b+" found"))}return M}(a)}function Kc(a,s){var c=a.key,m=a.style,_=a.styleSpec,b=a.value,E=a.objectKey,M=_[s+"_"+a.layerType];if(!M)return[];var O=E.match(/^(.*)-transition$/);if(s==="paint"&&O&&M[O[1]]&&M[O[1]].transition)return mi({key:c,value:b,valueSpec:_.transition,style:m,styleSpec:_});var B,G=a.valueSpec||M[E];if(!G)return[new Oe(c,b,'unknown property "'+E+'"')];if(ta(b)==="string"&&uo(G)&&!G.tokens&&(B=/^{([^}]+)}$/.exec(b)))return[new Oe(c,b,'"'+E+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(B[1])+" }`.")];var $=[];return a.layerType==="symbol"&&(E==="text-field"&&m&&!m.glyphs&&$.push(new Oe(c,b,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&Yc(Rt(b))&&Mr(b.type)==="identity"&&$.push(new Oe(c,b,'"text-font" does not support identity functions'))),$.concat(mi({key:a.key,value:b,valueSpec:G,style:m,styleSpec:_,expressionContext:"property",propertyType:s,propertyKey:E}))}function Jc(a){return Kc(a,"paint")}function pl(a){return Kc(a,"layout")}function Ai(a){var s=[],c=a.value,m=a.key,_=a.style,b=a.styleSpec;c.type||c.ref||s.push(new Oe(m,c,'either "type" or "ref" is required'));var E,M=Mr(c.type),O=Mr(c.ref);if(c.id)for(var B=Mr(c.id),G=0;G<a.arrayIndex;G++){var $=_.layers[G];Mr($.id)===B&&s.push(new Oe(m,c.id,'duplicate layer id "'+c.id+'", previously used at line '+$.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function(ke){ke in c&&s.push(new Oe(m,c[ke],'"'+ke+'" is prohibited for ref layers'))}),_.layers.forEach(function(ke){Mr(ke.id)===O&&(E=ke)}),E?E.ref?s.push(new Oe(m,c.ref,"ref cannot reference another ref layer")):M=Mr(E.type):s.push(new Oe(m,c.ref,'ref layer "'+O+'" not found'));else if(M!=="background")if(c.source){var re=_.sources&&_.sources[c.source],ue=re&&Mr(re.type);re?ue==="vector"&&M==="raster"?s.push(new Oe(m,c.source,'layer "'+c.id+'" requires a raster source')):ue==="raster"&&M!=="raster"?s.push(new Oe(m,c.source,'layer "'+c.id+'" requires a vector source')):ue!=="vector"||c["source-layer"]?ue==="raster-dem"&&M!=="hillshade"?s.push(new Oe(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!c.paint||!c.paint["line-gradient"]||ue==="geojson"&&re.lineMetrics||s.push(new Oe(m,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new Oe(m,c,'layer "'+c.id+'" must specify a "source-layer"')):s.push(new Oe(m,c.source,'source "'+c.source+'" not found'))}else s.push(new Oe(m,c,'missing required property "source"'));return s=s.concat(Ps({key:m,value:c,valueSpec:b.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return mi({key:m+".type",value:c.type,valueSpec:b.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"})},filter:qc,layout:function(ke){return Ps({layer:c,key:ke.key,value:ke.value,style:ke.style,styleSpec:ke.styleSpec,objectElementValidators:{"*":function(Me){return pl(br({layerType:M},Me))}}})},paint:function(ke){return Ps({layer:c,key:ke.key,value:ke.value,style:ke.style,styleSpec:ke.styleSpec,objectElementValidators:{"*":function(Me){return Jc(br({layerType:M},Me))}}})}}}))}function qa(a){var s=a.value,c=a.key,m=ta(s);return m!=="string"?[new Oe(c,s,"string expected, "+m+" found")]:[]}var Bi={promoteId:function(a){var s=a.key,c=a.value;if(ta(c)==="string")return qa({key:s,value:c});var m=[];for(var _ in c)m.push.apply(m,qa({key:s+"."+_,value:c[_]}));return m}};function js(a){var s=a.value,c=a.key,m=a.styleSpec,_=a.style;if(!s.type)return[new Oe(c,s,'"type" is required')];var b,E=Mr(s.type);switch(E){case"vector":case"raster":case"raster-dem":return Ps({key:c,value:s,valueSpec:m["source_"+E.replace("-","_")],style:a.style,styleSpec:m,objectElementValidators:Bi});case"geojson":if(b=Ps({key:c,value:s,valueSpec:m.source_geojson,style:_,styleSpec:m,objectElementValidators:Bi}),s.cluster)for(var M in s.clusterProperties){var O=s.clusterProperties[M],B=O[0],G=typeof B=="string"?[B,["accumulated"],["get",M]]:B;b.push.apply(b,ju({key:c+"."+M+".map",value:O[1],expressionContext:"cluster-map"})),b.push.apply(b,ju({key:c+"."+M+".reduce",value:G,expressionContext:"cluster-reduce"}))}return b;case"video":return Ps({key:c,value:s,valueSpec:m.source_video,style:_,styleSpec:m});case"image":return Ps({key:c,value:s,valueSpec:m.source_image,style:_,styleSpec:m});case"canvas":return[new Oe(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vl({key:c+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:m})}}function wu(a){var s=a.value,c=a.styleSpec,m=c.light,_=a.style,b=[],E=ta(s);if(s===void 0)return b;if(E!=="object")return b.concat([new Oe("light",s,"object expected, "+E+" found")]);for(var M in s){var O=M.match(/^(.*)-transition$/);b=b.concat(O&&m[O[1]]&&m[O[1]].transition?mi({key:M,value:s[M],valueSpec:c.transition,style:_,styleSpec:c}):m[M]?mi({key:M,value:s[M],valueSpec:m[M],style:_,styleSpec:c}):[new Oe(M,s[M],'unknown property "'+M+'"')])}return b}var Eu={"*":function(){return[]},array:kf,boolean:function(a){var s=a.value,c=a.key,m=ta(s);return m!=="boolean"?[new Oe(c,s,"boolean expected, "+m+" found")]:[]},number:Lf,color:function(a){var s=a.key,c=a.value,m=ta(c);return m!=="string"?[new Oe(s,c,"color expected, "+m+" found")]:si(c)===null?[new Oe(s,c,'color expected, "'+c+'" found')]:[]},constants:wt,enum:Vl,filter:qc,function:Rf,layer:Ai,object:Ps,source:js,light:wu,string:qa,formatted:function(a){return qa(a).length===0?[]:ju(a)},resolvedImage:function(a){return qa(a).length===0?[]:ju(a)}};function mi(a){var s=a.value,c=a.valueSpec,m=a.styleSpec;return c.expression&&Yc(Mr(s))?Rf(a):c.expression&&su(Rt(s))?ju(a):c.type&&Eu[c.type]?Eu[c.type](a):Ps(br({},a,{valueSpec:c.type?m[c.type]:c}))}function ua(a){var s=a.value,c=a.key,m=qa(a);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new Oe(c,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new Oe(c,s,'"glyphs" url must include a "{range}" token'))),m}function ys(a,s){s===void 0&&(s=he);var c=[];return c=c.concat(mi({key:"",value:a,valueSpec:s.$root,styleSpec:s,style:a,objectElementValidators:{glyphs:ua,"*":function(){return[]}}})),a.constants&&(c=c.concat(wt({key:"constants",value:a.constants,style:a,styleSpec:s}))),Hl(c)}function Hl(a){return[].concat(a).sort(function(s,c){return s.line-c.line})}function Wl(a){return function(){for(var s=[],c=arguments.length;c--;)s[c]=arguments[c];return Hl(a.apply(this,s))}}ys.source=Wl(js),ys.light=Wl(wu),ys.layer=Wl(Ai),ys.filter=Wl(qc),ys.paintProperty=Wl(Jc),ys.layoutProperty=Wl(pl);var Qc=ys,Vh=Qc.light,Ba=Qc.paintProperty,dl=Qc.layoutProperty;function uu(a,s){var c=!1;if(s&&s.length)for(var m=0,_=s;m<_.length;m+=1)a.fire(new Ke(new Error(_[m].message))),c=!0;return c}var Wu=Ma;function Ma(a,s,c){var m=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(s=_[1])+2*(c=_[2]);for(var b=0;b<this.d*this.d;b++){var E=_[3+b],M=_[3+b+1];m.push(E===M?null:_.subarray(E,M))}var O=_[3+m.length+1];this.keys=_.subarray(_[3+m.length],O),this.bboxes=_.subarray(O),this.insert=this._insertReadonly}else{this.d=s+2*c;for(var B=0;B<this.d*this.d;B++)m.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=a,this.padding=c,this.scale=s/a,this.uid=0;var G=c/s*a;this.min=-G,this.max=a+G}Ma.prototype.insert=function(a,s,c,m,_){this._forEachCell(s,c,m,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(_)},Ma.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ma.prototype._insertCell=function(a,s,c,m,_,b){this.cells[_].push(b)},Ma.prototype.query=function(a,s,c,m,_){var b=this.min,E=this.max;if(a<=b&&s<=b&&E<=c&&E<=m&&!_)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(a,s,c,m,this._queryCell,M,{},_),M},Ma.prototype._queryCell=function(a,s,c,m,_,b,E,M){var O=this.cells[_];if(O!==null)for(var B=this.keys,G=this.bboxes,$=0;$<O.length;$++){var re=O[$];if(E[re]===void 0){var ue=4*re;(M?M(G[ue+0],G[ue+1],G[ue+2],G[ue+3]):a<=G[ue+2]&&s<=G[ue+3]&&c>=G[ue+0]&&m>=G[ue+1])?(E[re]=!0,b.push(B[re])):E[re]=!1}}},Ma.prototype._forEachCell=function(a,s,c,m,_,b,E,M){for(var O=this._convertToCellCoord(a),B=this._convertToCellCoord(s),G=this._convertToCellCoord(c),$=this._convertToCellCoord(m),re=O;re<=G;re++)for(var ue=B;ue<=$;ue++){var ke=this.d*ue+re;if((!M||M(this._convertFromCellCoord(re),this._convertFromCellCoord(ue),this._convertFromCellCoord(re+1),this._convertFromCellCoord(ue+1)))&&_.call(this,a,s,c,m,ke,b,E,M))return}},Ma.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ma.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ma.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,s=3+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var _=new Int32Array(s+c+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var b=s,E=0;E<a.length;E++){var M=a[E];_[3+E]=b,_.set(M,b),b+=M.length}return _[3+a.length]=b,_.set(this.keys,b),_[3+a.length+1]=b+=this.keys.length,_.set(this.bboxes,b),b+=this.bboxes.length,_.buffer};var $o=se.ImageData,Au=se.ImageBitmap,ha={};function cn(a,s,c){c===void 0&&(c={}),Object.defineProperty(s,"_classRegistryKey",{value:a,writeable:!1}),ha[a]={klass:s,omit:c.omit||[],shallow:c.shallow||[]}}for(var Ka in cn("Object",Object),Wu.serialize=function(a,s){var c=a.toArrayBuffer();return s&&s.push(c),{buffer:c}},Wu.deserialize=function(a){return new Wu(a.buffer)},cn("Grid",Wu),cn("Color",Qn),cn("Error",Error),cn("ResolvedImage",fa),cn("StylePropertyFunction",hl),cn("StyleExpression",Uu,{omit:["_evaluator"]}),cn("ZoomDependentExpression",Vu),cn("ZoomConstantExpression",fl),cn("CompoundExpression",Da,{omit:["_evaluate"]}),Wo)Wo[Ka]._classRegistryKey||cn("Expression_"+Ka,Wo[Ka]);function vl(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function ml(a){return Au&&a instanceof Au}function ks(a,s){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(vl(a)||ml(a))return s&&s.push(a),a;if(ArrayBuffer.isView(a)){var c=a;return s&&s.push(c.buffer),c}if(a instanceof $o)return s&&s.push(a.data.buffer),a;if(Array.isArray(a)){for(var m=[],_=0,b=a;_<b.length;_+=1)m.push(ks(b[_],s));return m}if(typeof a=="object"){var E=a.constructor,M=E._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var O=E.serialize?E.serialize(a,s):{};if(!E.serialize){for(var B in a)if(a.hasOwnProperty(B)&&!(ha[M].omit.indexOf(B)>=0)){var G=a[B];O[B]=ha[M].shallow.indexOf(B)>=0?G:ks(G,s)}a instanceof Error&&(O.message=a.message)}if(O.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(O.$name=M),O}throw new Error("can't serialize object of type "+typeof a)}function _s(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||vl(a)||ml(a)||ArrayBuffer.isView(a)||a instanceof $o)return a;if(Array.isArray(a))return a.map(_s);if(typeof a=="object"){var s=a.$name||"Object",c=ha[s].klass;if(!c)throw new Error("can't deserialize unregistered class "+s);if(c.deserialize)return c.deserialize(a);for(var m=Object.create(c.prototype),_=0,b=Object.keys(a);_<b.length;_+=1){var E=b[_];if(E!=="$name"){var M=a[E];m[E]=ha[s].shallow.indexOf(E)>=0?M:_s(M)}}return m}throw new Error("can't deserialize object of type "+typeof a)}var Gs=function(){this.first=!0};Gs.prototype.update=function(a,s){var c=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=c,!0))};var Pr={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function Ff(a){for(var s=0,c=a;s<c.length;s+=1)if(_c(c[s].charCodeAt(0)))return!0;return!1}function _c(a){return!(a!==746&&a!==747&&(a<4352||!(Pr["Bopomofo Extended"](a)||Pr.Bopomofo(a)||Pr["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Pr["CJK Compatibility Ideographs"](a)||Pr["CJK Compatibility"](a)||Pr["CJK Radicals Supplement"](a)||Pr["CJK Strokes"](a)||!(!Pr["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Pr["CJK Unified Ideographs Extension A"](a)||Pr["CJK Unified Ideographs"](a)||Pr["Enclosed CJK Letters and Months"](a)||Pr["Hangul Compatibility Jamo"](a)||Pr["Hangul Jamo Extended-A"](a)||Pr["Hangul Jamo Extended-B"](a)||Pr["Hangul Jamo"](a)||Pr["Hangul Syllables"](a)||Pr.Hiragana(a)||Pr["Ideographic Description Characters"](a)||Pr.Kanbun(a)||Pr["Kangxi Radicals"](a)||Pr["Katakana Phonetic Extensions"](a)||Pr.Katakana(a)&&a!==12540||!(!Pr["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Pr["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Pr["Unified Canadian Aboriginal Syllabics"](a)||Pr["Unified Canadian Aboriginal Syllabics Extended"](a)||Pr["Vertical Forms"](a)||Pr["Yijing Hexagram Symbols"](a)||Pr["Yi Syllables"](a)||Pr["Yi Radicals"](a))))}function lu(a){return!(_c(a)||function(s){return!!(Pr["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Pr["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Pr["Letterlike Symbols"](s)||Pr["Number Forms"](s)||Pr["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Pr["Control Pictures"](s)&&s!==9251||Pr["Optical Character Recognition"](s)||Pr["Enclosed Alphanumerics"](s)||Pr["Geometric Shapes"](s)||Pr["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Pr["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Pr["CJK Symbols and Punctuation"](s)||Pr.Katakana(s)||Pr["Private Use Area"](s)||Pr["CJK Compatibility Forms"](s)||Pr["Small Form Variants"](s)||Pr["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(a))}function Ls(a){return a>=1424&&a<=2303||Pr["Arabic Presentation Forms-A"](a)||Pr["Arabic Presentation Forms-B"](a)}function Fo(a,s){return!(!s&&Ls(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Pr.Khmer(a))}function ef(a){for(var s=0,c=a;s<c.length;s+=1)if(Ls(c[s].charCodeAt(0)))return!0;return!1}var $l=null,Bo="unavailable",Cu=null,tf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Bo="error"),$l&&$l(a)};function gl(){hh.fire(new Le("pluginStateChange",{pluginStatus:Bo,pluginURL:Cu}))}var hh=new it,xc=function(){return Bo},cs=function(){if(Bo!=="deferred"||!Cu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bo="loading",gl(),Cu&&rs({url:Cu},function(a){a?tf(a):(Bo="loaded",gl())})},Rs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Bo==="loaded"||Rs.applyArabicShaping!=null},isLoading:function(){return Bo==="loading"},setState:function(a){Bo=a.pluginStatus,Cu=a.pluginURL},isParsed:function(){return Rs.applyArabicShaping!=null&&Rs.processBidirectionalText!=null&&Rs.processStyledBidirectionalText!=null},getPluginURL:function(){return Cu}},pi=function(a,s){this.zoom=a,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Gs,this.transition={})};pi.prototype.isSupportedScript=function(a){return function(s,c){for(var m=0,_=s;m<_.length;m+=1)if(!Fo(_[m].charCodeAt(0),c))return!1;return!0}(a,Rs.isLoaded())},pi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},pi.prototype.getCrossfadeParameters=function(){var a=this.zoom,s=a-Math.floor(a),c=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}};var cu=function(a,s){this.property=a,this.value=s,this.expression=function(c,m){if(Yc(c))return new hl(c,m);if(su(c)){var _=Xc(c,m);if(_.result==="error")throw new Error(_.value.map(function(E){return E.key+": "+E.message}).join(", "));return _.value}var b=c;return typeof c=="string"&&m.type==="color"&&(b=Qn.parse(c)),{kind:"constant",evaluate:function(){return b}}}(s===void 0?a.specification.default:s,a.specification)};cu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},cu.prototype.possiblyEvaluate=function(a,s,c){return this.property.possiblyEvaluate(this,a,s,c)};var xo=function(a){this.property=a,this.value=new cu(a,void 0)};xo.prototype.transitioned=function(a,s){return new yl(this.property,this.value,s,Yt({},a.transition,this.transition),a.now)},xo.prototype.untransitioned=function(){return new yl(this.property,this.value,null,{},0)};var zi=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};zi.prototype.getValue=function(a){return nt(this._values[a].value.value)},zi.prototype.setValue=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new xo(this._values[a].property)),this._values[a].value=new cu(this._values[a].property,s===null?void 0:nt(s))},zi.prototype.getTransition=function(a){return nt(this._values[a].transition)},zi.prototype.setTransition=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new xo(this._values[a].property)),this._values[a].transition=nt(s)||void 0},zi.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_);var b=this.getTransition(m);b!==void 0&&(a[m+"-transition"]=b)}return a},zi.prototype.transitioned=function(a,s){for(var c=new $u(this._properties),m=0,_=Object.keys(this._values);m<_.length;m+=1){var b=_[m];c._values[b]=this._values[b].transitioned(a,s._values[b])}return c},zi.prototype.untransitioned=function(){for(var a=new $u(this._properties),s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s];a._values[m]=this._values[m].untransitioned()}return a};var yl=function(a,s,c,m,_){this.property=a,this.value=s,this.begin=_+m.delay||0,this.end=this.begin+m.duration||0,a.specification.transition&&(m.delay||m.duration)&&(this.prior=c)};yl.prototype.possiblyEvaluate=function(a,s,c){var m=a.now||0,_=this.value.possiblyEvaluate(a,s,c),b=this.prior;if(b){if(m>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(m<this.begin)return b.possiblyEvaluate(a,s,c);var E=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(a,s,c),_,function(M){if(M<=0)return 0;if(M>=1)return 1;var O=M*M,B=O*M;return 4*(M<.5?B:3*(M-O)+B-.75)}(E))}return _};var $u=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};$u.prototype.possiblyEvaluate=function(a,s,c){for(var m=new bc(this._properties),_=0,b=Object.keys(this._values);_<b.length;_+=1){var E=b[_];m._values[E]=this._values[E].possiblyEvaluate(a,s,c)}return m},$u.prototype.hasTransition=function(){for(var a=0,s=Object.keys(this._values);a<s.length;a+=1)if(this._values[s[a]].prior)return!0;return!1};var Hs=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};Hs.prototype.getValue=function(a){return nt(this._values[a].value)},Hs.prototype.setValue=function(a,s){this._values[a]=new cu(this._values[a].property,s===null?void 0:nt(s))},Hs.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_)}return a},Hs.prototype.possiblyEvaluate=function(a,s,c){for(var m=new bc(this._properties),_=0,b=Object.keys(this._values);_<b.length;_+=1){var E=b[_];m._values[E]=this._values[E].possiblyEvaluate(a,s,c)}return m};var zo=function(a,s,c){this.property=a,this.value=s,this.parameters=c};zo.prototype.isConstant=function(){return this.value.kind==="constant"},zo.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},zo.prototype.evaluate=function(a,s,c,m){return this.property.evaluate(this.value,this.parameters,a,s,c,m)};var bc=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};bc.prototype.get=function(a){return this._values[a]};var An=function(a){this.specification=a};An.prototype.possiblyEvaluate=function(a,s){return a.expression.evaluate(s)},An.prototype.interpolate=function(a,s,c){var m=Fl[this.specification.type];return m?m(a,s,c):a};var dn=function(a,s){this.specification=a,this.overrides=s};dn.prototype.possiblyEvaluate=function(a,s,c,m){return new zo(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(s,null,{},c,m)}:a.expression,s)},dn.prototype.interpolate=function(a,s,c){if(a.value.kind!=="constant"||s.value.kind!=="constant")return a;if(a.value.value===void 0||s.value.value===void 0)return new zo(this,{kind:"constant",value:void 0},a.parameters);var m=Fl[this.specification.type];return m?new zo(this,{kind:"constant",value:m(a.value.value,s.value.value,c)},a.parameters):a},dn.prototype.evaluate=function(a,s,c,m,_,b){return a.kind==="constant"?a.value:a.evaluate(s,c,m,_,b)};var Yu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m,_,b){if(c.value===void 0)return new zo(this,{kind:"constant",value:void 0},m);if(c.expression.kind==="constant"){var E=c.expression.evaluate(m,null,{},_,b),M=c.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,O=this._calculate(M,M,M,m);return new zo(this,{kind:"constant",value:O},m)}if(c.expression.kind==="camera"){var B=this._calculate(c.expression.evaluate({zoom:m.zoom-1}),c.expression.evaluate({zoom:m.zoom}),c.expression.evaluate({zoom:m.zoom+1}),m);return new zo(this,{kind:"constant",value:B},m)}return new zo(this,c.expression,m)},s.prototype.evaluate=function(c,m,_,b,E,M){if(c.kind==="source"){var O=c.evaluate(m,_,b,E,M);return this._calculate(O,O,O,m)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(m.zoom)-1},_,b),c.evaluate({zoom:Math.floor(m.zoom)},_,b),c.evaluate({zoom:Math.floor(m.zoom)+1},_,b),m):c.value},s.prototype._calculate=function(c,m,_,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:m}:{from:_,to:m}},s.prototype.interpolate=function(c){return c},s}(dn),Io=function(a){this.specification=a};Io.prototype.possiblyEvaluate=function(a,s,c,m){if(a.value!==void 0){if(a.expression.kind==="constant"){var _=a.expression.evaluate(s,null,{},c,m);return this._calculate(_,_,_,s)}return this._calculate(a.expression.evaluate(new pi(Math.floor(s.zoom-1),s)),a.expression.evaluate(new pi(Math.floor(s.zoom),s)),a.expression.evaluate(new pi(Math.floor(s.zoom+1),s)),s)}},Io.prototype._calculate=function(a,s,c,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:a,to:s}:{from:c,to:s}},Io.prototype.interpolate=function(a){return a};var Wa=function(a){this.specification=a};Wa.prototype.possiblyEvaluate=function(a,s,c,m){return!!a.expression.evaluate(s,null,{},c,m)},Wa.prototype.interpolate=function(){return!1};var bo=function(a){for(var s in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var c=a[s];c.specification.overridable&&this.overridableProperties.push(s);var m=this.defaultPropertyValues[s]=new cu(c,void 0),_=this.defaultTransitionablePropertyValues[s]=new xo(c);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=m.possiblyEvaluate({})}};cn("DataDrivenProperty",dn),cn("DataConstantProperty",An),cn("CrossFadedDataDrivenProperty",Yu),cn("CrossFadedProperty",Io),cn("ColorRampProperty",Wa);var Ws=function(a){function s(c,m){if(a.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),m.layout&&(this._unevaluatedLayout=new Hs(m.layout)),m.paint)){for(var _ in this._transitionablePaint=new zi(m.paint),c.paint)this.setPaintProperty(_,c.paint[_],{validate:!1});for(var b in c.layout)this.setLayoutProperty(b,c.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new bc(m.paint)}}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},s.prototype.setLayoutProperty=function(c,m,_){_===void 0&&(_={}),m!=null&&this._validate(dl,"layers."+this.id+".layout."+c,c,m,_)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,m):this.visibility=m)},s.prototype.getPaintProperty=function(c){return fr(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-"-transition".length)):this._transitionablePaint.getValue(c)},s.prototype.setPaintProperty=function(c,m,_){if(_===void 0&&(_={}),m!=null&&this._validate(Ba,"layers."+this.id+".paint."+c,c,m,_))return!1;if(fr(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-"-transition".length),m||void 0),!1;var b=this._transitionablePaint._values[c],E=b.property.specification["property-type"]==="cross-faded-data-driven",M=b.value.isDataDriven(),O=b.value;this._transitionablePaint.setValue(c,m),this._handleSpecialPaintPropertyUpdate(c);var B=this._transitionablePaint._values[c].value;return B.isDataDriven()||M||E||this._handleOverridablePaintPropertyUpdate(c,O,B)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!1},s.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(c,m){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,m)},s.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),mt(c,function(m,_){return!(m===void 0||_==="layout"&&!Object.keys(m).length||_==="paint"&&!Object.keys(m).length)})},s.prototype._validate=function(c,m,_,b,E){return E===void 0&&(E={}),(!E||E.validate!==!1)&&uu(this,c.call(Qc,{key:m,layerType:this.type,objectKey:_,value:b,styleSpec:he,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var c in this.paint._values){var m=this.paint.get(c);if(m instanceof zo&&uo(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},s}(it),fu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Yl=function(a,s){this._structArray=a,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Oi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function ra(a,s){s===void 0&&(s=1);var c=0,m=0;return{members:a.map(function(_){var b=fu[_.type].BYTES_PER_ELEMENT,E=c=Bf(c,Math.max(s,b)),M=_.components||1;return m=Math.max(m,b),c+=b*M,{name:_.name,type:_.type,components:M,offset:E}}),size:Bf(c,Math.max(m,s)),alignment:s}}function Bf(a,s){return Math.ceil(a/s)*s}Oi.serialize=function(a,s){return a._trim(),s&&(a.isTransferred=!0,s.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Oi.deserialize=function(a){var s=Object.create(this.prototype);return s.arrayBuffer=a.arrayBuffer,s.length=a.length,s.capacity=a.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},Oi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Oi.prototype.clear=function(){this.length=0},Oi.prototype.resize=function(a){this.reserve(a),this.length=a},Oi.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},Oi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Xu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var b=2*c;return this.int16[b+0]=m,this.int16[b+1]=_,c},s}(Oi);Xu.prototype.bytesPerElement=4,cn("StructArrayLayout2i4",Xu);var zf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,_,b)},s.prototype.emplace=function(c,m,_,b,E){var M=4*c;return this.int16[M+0]=m,this.int16[M+1]=_,this.int16[M+2]=b,this.int16[M+3]=E,c},s}(Oi);zf.prototype.bytesPerElement=8,cn("StructArrayLayout4i8",zf);var Tu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M){var O=this.length;return this.resize(O+1),this.emplace(O,c,m,_,b,E,M)},s.prototype.emplace=function(c,m,_,b,E,M,O){var B=6*c;return this.int16[B+0]=m,this.int16[B+1]=_,this.int16[B+2]=b,this.int16[B+3]=E,this.int16[B+4]=M,this.int16[B+5]=O,c},s}(Oi);Tu.prototype.bytesPerElement=12,cn("StructArrayLayout2i4i12",Tu);var Qo=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M){var O=this.length;return this.resize(O+1),this.emplace(O,c,m,_,b,E,M)},s.prototype.emplace=function(c,m,_,b,E,M,O){var B=4*c,G=8*c;return this.int16[B+0]=m,this.int16[B+1]=_,this.uint8[G+4]=b,this.uint8[G+5]=E,this.uint8[G+6]=M,this.uint8[G+7]=O,c},s}(Oi);Qo.prototype.bytesPerElement=8,cn("StructArrayLayout2i4ub8",Qo);var Sc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var b=2*c;return this.float32[b+0]=m,this.float32[b+1]=_,c},s}(Oi);Sc.prototype.bytesPerElement=8,cn("StructArrayLayout2f8",Sc);var Mu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,O,B,G,$){var re=this.length;return this.resize(re+1),this.emplace(re,c,m,_,b,E,M,O,B,G,$)},s.prototype.emplace=function(c,m,_,b,E,M,O,B,G,$,re){var ue=10*c;return this.uint16[ue+0]=m,this.uint16[ue+1]=_,this.uint16[ue+2]=b,this.uint16[ue+3]=E,this.uint16[ue+4]=M,this.uint16[ue+5]=O,this.uint16[ue+6]=B,this.uint16[ue+7]=G,this.uint16[ue+8]=$,this.uint16[ue+9]=re,c},s}(Oi);Mu.prototype.bytesPerElement=20,cn("StructArrayLayout10ui20",Mu);var _l=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,O,B,G,$,re,ue){var ke=this.length;return this.resize(ke+1),this.emplace(ke,c,m,_,b,E,M,O,B,G,$,re,ue)},s.prototype.emplace=function(c,m,_,b,E,M,O,B,G,$,re,ue,ke){var Me=12*c;return this.int16[Me+0]=m,this.int16[Me+1]=_,this.int16[Me+2]=b,this.int16[Me+3]=E,this.uint16[Me+4]=M,this.uint16[Me+5]=O,this.uint16[Me+6]=B,this.uint16[Me+7]=G,this.int16[Me+8]=$,this.int16[Me+9]=re,this.int16[Me+10]=ue,this.int16[Me+11]=ke,c},s}(Oi);_l.prototype.bytesPerElement=24,cn("StructArrayLayout4i4ui4i24",_l);var Xl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=3*c;return this.float32[E+0]=m,this.float32[E+1]=_,this.float32[E+2]=b,c},s}(Oi);Xl.prototype.bytesPerElement=12,cn("StructArrayLayout3f12",Xl);var ql=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint32[1*c+0]=m,c},s}(Oi);ql.prototype.bytesPerElement=4,cn("StructArrayLayout1ul4",ql);var rf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,O,B,G){var $=this.length;return this.resize($+1),this.emplace($,c,m,_,b,E,M,O,B,G)},s.prototype.emplace=function(c,m,_,b,E,M,O,B,G,$){var re=10*c,ue=5*c;return this.int16[re+0]=m,this.int16[re+1]=_,this.int16[re+2]=b,this.int16[re+3]=E,this.int16[re+4]=M,this.int16[re+5]=O,this.uint32[ue+3]=B,this.uint16[re+8]=G,this.uint16[re+9]=$,c},s}(Oi);rf.prototype.bytesPerElement=20,cn("StructArrayLayout6i1ul2ui20",rf);var wc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M){var O=this.length;return this.resize(O+1),this.emplace(O,c,m,_,b,E,M)},s.prototype.emplace=function(c,m,_,b,E,M,O){var B=6*c;return this.int16[B+0]=m,this.int16[B+1]=_,this.int16[B+2]=b,this.int16[B+3]=E,this.int16[B+4]=M,this.int16[B+5]=O,c},s}(Oi);wc.prototype.bytesPerElement=12,cn("StructArrayLayout2i2i2i12",wc);var qu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E){var M=this.length;return this.resize(M+1),this.emplace(M,c,m,_,b,E)},s.prototype.emplace=function(c,m,_,b,E,M){var O=4*c,B=8*c;return this.float32[O+0]=m,this.float32[O+1]=_,this.float32[O+2]=b,this.int16[B+6]=E,this.int16[B+7]=M,c},s}(Oi);qu.prototype.bytesPerElement=16,cn("StructArrayLayout2f1f2i16",qu);var Ec=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,_,b)},s.prototype.emplace=function(c,m,_,b,E){var M=12*c,O=3*c;return this.uint8[M+0]=m,this.uint8[M+1]=_,this.float32[O+1]=b,this.float32[O+2]=E,c},s}(Oi);Ec.prototype.bytesPerElement=12,cn("StructArrayLayout2ub2f12",Ec);var Ku=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=3*c;return this.uint16[E+0]=m,this.uint16[E+1]=_,this.uint16[E+2]=b,c},s}(Oi);Ku.prototype.bytesPerElement=6,cn("StructArrayLayout3ui6",Ku);var Ju=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,O,B,G,$,re,ue,ke,Me,Xe,Ve,st){var It=this.length;return this.resize(It+1),this.emplace(It,c,m,_,b,E,M,O,B,G,$,re,ue,ke,Me,Xe,Ve,st)},s.prototype.emplace=function(c,m,_,b,E,M,O,B,G,$,re,ue,ke,Me,Xe,Ve,st,It){var Nt=24*c,Ht=12*c,or=48*c;return this.int16[Nt+0]=m,this.int16[Nt+1]=_,this.uint16[Nt+2]=b,this.uint16[Nt+3]=E,this.uint32[Ht+2]=M,this.uint32[Ht+3]=O,this.uint32[Ht+4]=B,this.uint16[Nt+10]=G,this.uint16[Nt+11]=$,this.uint16[Nt+12]=re,this.float32[Ht+7]=ue,this.float32[Ht+8]=ke,this.uint8[or+36]=Me,this.uint8[or+37]=Xe,this.uint8[or+38]=Ve,this.uint32[Ht+10]=st,this.int16[Nt+22]=It,c},s}(Oi);Ju.prototype.bytesPerElement=48,cn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ju);var Ac=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,O,B,G,$,re,ue,ke,Me,Xe,Ve,st,It,Nt,Ht,or,Fr,Kr,Pn,on,Or,cr,di){var Xn=this.length;return this.resize(Xn+1),this.emplace(Xn,c,m,_,b,E,M,O,B,G,$,re,ue,ke,Me,Xe,Ve,st,It,Nt,Ht,or,Fr,Kr,Pn,on,Or,cr,di)},s.prototype.emplace=function(c,m,_,b,E,M,O,B,G,$,re,ue,ke,Me,Xe,Ve,st,It,Nt,Ht,or,Fr,Kr,Pn,on,Or,cr,di,Xn){var wn=34*c,Ti=17*c;return this.int16[wn+0]=m,this.int16[wn+1]=_,this.int16[wn+2]=b,this.int16[wn+3]=E,this.int16[wn+4]=M,this.int16[wn+5]=O,this.int16[wn+6]=B,this.int16[wn+7]=G,this.uint16[wn+8]=$,this.uint16[wn+9]=re,this.uint16[wn+10]=ue,this.uint16[wn+11]=ke,this.uint16[wn+12]=Me,this.uint16[wn+13]=Xe,this.uint16[wn+14]=Ve,this.uint16[wn+15]=st,this.uint16[wn+16]=It,this.uint16[wn+17]=Nt,this.uint16[wn+18]=Ht,this.uint16[wn+19]=or,this.uint16[wn+20]=Fr,this.uint16[wn+21]=Kr,this.uint16[wn+22]=Pn,this.uint32[Ti+12]=on,this.float32[Ti+13]=Or,this.float32[Ti+14]=cr,this.float32[Ti+15]=di,this.float32[Ti+16]=Xn,c},s}(Oi);Ac.prototype.bytesPerElement=68,cn("StructArrayLayout8i15ui1ul4f68",Ac);var $s=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.float32[1*c+0]=m,c},s}(Oi);$s.prototype.bytesPerElement=4,cn("StructArrayLayout1f4",$s);var Os=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=3*c;return this.int16[E+0]=m,this.int16[E+1]=_,this.int16[E+2]=b,c},s}(Oi);Os.prototype.bytesPerElement=6,cn("StructArrayLayout3i6",Os);var nf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=4*c;return this.uint32[2*c+0]=m,this.uint16[E+2]=_,this.uint16[E+3]=b,c},s}(Oi);nf.prototype.bytesPerElement=8,cn("StructArrayLayout1ul2ui8",nf);var af=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var b=2*c;return this.uint16[b+0]=m,this.uint16[b+1]=_,c},s}(Oi);af.prototype.bytesPerElement=4,cn("StructArrayLayout2ui4",af);var Nf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint16[1*c+0]=m,c},s}(Oi);Nf.prototype.bytesPerElement=2,cn("StructArrayLayout1ui2",Nf);var of=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,_,b)},s.prototype.emplace=function(c,m,_,b,E){var M=4*c;return this.float32[M+0]=m,this.float32[M+1]=_,this.float32[M+2]=b,this.float32[M+3]=E,c},s}(Oi);of.prototype.bytesPerElement=16,cn("StructArrayLayout4f16",of);var f=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new oe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,c),s}(Yl);f.prototype.size=20;var d=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new f(this,c)},s}(rf);cn("CollisionBoxArray",d);var h=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,c),s}(Yl);h.prototype.size=48;var g=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new h(this,c)},s}(Ju);cn("PlacedSymbolArray",g);var w=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,c),s}(Yl);w.prototype.size=68;var C=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new w(this,c)},s}(Ac);cn("SymbolInstanceArray",C);var T=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getoffsetX=function(c){return this.float32[1*c+0]},s}($s);cn("GlyphOffsetArray",T);var L=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getx=function(c){return this.int16[3*c+0]},s.prototype.gety=function(c){return this.int16[3*c+1]},s.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},s}(Os);cn("SymbolLineVertexArray",L);var k=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,c),s}(Yl);k.prototype.size=8;var X=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new k(this,c)},s}(nf);cn("FeatureIndexArray",X);var ae=ra([{name:"a_pos",components:2,type:"Int16"}],4).members,de=function(a){a===void 0&&(a=[]),this.segments=a};function ge(a,s){return 256*(a=Ct(Math.floor(a),0,255))+Ct(Math.floor(s),0,255)}de.prototype.prepareSegment=function(a,s,c,m){var _=this.segments[this.segments.length-1];return a>de.MAX_VERTEX_ARRAY_LENGTH&&lt("Max vertices per segment is "+de.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!_||_.vertexLength+a>de.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==m)&&(_={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},m!==void 0&&(_.sortKey=m),this.segments.push(_)),_},de.prototype.get=function(){return this.segments},de.prototype.destroy=function(){for(var a=0,s=this.segments;a<s.length;a+=1){var c=s[a];for(var m in c.vaos)c.vaos[m].destroy()}},de.simpleSegment=function(a,s,c,m){return new de([{vertexOffset:a,primitiveOffset:s,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])},de.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,cn("SegmentVector",de);var Te=ra([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Re=le(function(a){a.exports=function(s,c){var m,_,b,E,M,O,B,G;for(_=s.length-(m=3&s.length),b=c,M=3432918353,O=461845907,G=0;G<_;)B=255&s.charCodeAt(G)|(255&s.charCodeAt(++G))<<8|(255&s.charCodeAt(++G))<<16|(255&s.charCodeAt(++G))<<24,++G,b=27492+(65535&(E=5*(65535&(b=(b^=B=(65535&(B=(B=(65535&B)*M+(((B>>>16)*M&65535)<<16)&4294967295)<<15|B>>>17))*O+(((B>>>16)*O&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(B=0,m){case 3:B^=(255&s.charCodeAt(G+2))<<16;case 2:B^=(255&s.charCodeAt(G+1))<<8;case 1:b^=B=(65535&(B=(B=(65535&(B^=255&s.charCodeAt(G)))*M+(((B>>>16)*M&65535)<<16)&4294967295)<<15|B>>>17))*O+(((B>>>16)*O&65535)<<16)&4294967295}return b^=s.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),We=le(function(a){a.exports=function(s,c){for(var m,_=s.length,b=c^_,E=0;_>=4;)m=1540483477*(65535&(m=255&s.charCodeAt(E)|(255&s.charCodeAt(++E))<<8|(255&s.charCodeAt(++E))<<16|(255&s.charCodeAt(++E))<<24))+((1540483477*(m>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),_-=4,++E;switch(_){case 3:b^=(255&s.charCodeAt(E+2))<<16;case 2:b^=(255&s.charCodeAt(E+1))<<8;case 1:b=1540483477*(65535&(b^=255&s.charCodeAt(E)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Ae=Re,$e=We;Ae.murmur3=Re,Ae.murmur2=$e;var ot=function(){this.ids=[],this.positions=[],this.indexed=!1};ot.prototype.add=function(a,s,c,m){this.ids.push(Gt(a)),this.positions.push(s,c,m)},ot.prototype.getPositions=function(a){for(var s=Gt(a),c=0,m=this.ids.length-1;c<m;){var _=c+m>>1;this.ids[_]>=s?m=_:c=_+1}for(var b=[];this.ids[c]===s;)b.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return b},ot.serialize=function(a,s){var c=new Float64Array(a.ids),m=new Uint32Array(a.positions);return function _(b,E,M,O){for(;M<O;){for(var B=b[M+O>>1],G=M-1,$=O+1;;){do G++;while(b[G]<B);do $--;while(b[$]>B);if(G>=$)break;Bt(b,G,$),Bt(E,3*G,3*$),Bt(E,3*G+1,3*$+1),Bt(E,3*G+2,3*$+2)}$-M<O-$?(_(b,E,M,$),M=$+1):(_(b,E,$+1,O),O=$)}}(c,m,0,c.length-1),s&&s.push(c.buffer,m.buffer),{ids:c,positions:m}},ot.deserialize=function(a){var s=new ot;return s.ids=a.ids,s.positions=a.positions,s.indexed=!0,s};var At=Math.pow(2,53)-1;function Gt(a){var s=+a;return!isNaN(s)&&s<=At?s:Ae(String(a))}function Bt(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}cn("FeaturePositionMap",ot);var Ut=function(a,s){this.gl=a.gl,this.location=s},hr=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},s}(Ut),Zr=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},s}(Ut),kr=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},s}(Ut),rn=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},s}(Ut),Cn=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},s}(Ut),Ln=function(a){function s(c,m){a.call(this,c,m),this.current=Qn.transparent}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},s}(Ut),Mn=new Float32Array(16),Ci=function(a){function s(c,m){a.call(this,c,m),this.current=Mn}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},s}(Ut);function nn(a){return[ge(255*a.r,255*a.g),ge(255*a.b,255*a.a)]}var $n=function(a,s,c){this.value=a,this.uniformNames=s.map(function(m){return"u_"+m}),this.type=c};$n.prototype.setUniform=function(a,s,c){a.set(c.constantOr(this.value))},$n.prototype.getBinding=function(a,s,c){return this.type==="color"?new Ln(a,s):new Zr(a,s)};var ii=function(a,s){this.uniformNames=s.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ii.prototype.setConstantPatternPositions=function(a,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=a.tlbr},ii.prototype.setUniform=function(a,s,c,m){var _=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&a.set(_)},ii.prototype.getBinding=function(a,s,c){return c.substr(0,9)==="u_pattern"?new Cn(a,s):new Zr(a,s)};var Yn=function(a,s,c,m){this.expression=a,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(function(_){return{name:"a_"+_,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new m};Yn.prototype.populatePaintArray=function(a,s,c,m,_){var b=this.paintVertexArray.length,E=this.expression.evaluate(new pi(0),s,{},m,[],_);this.paintVertexArray.resize(a),this._setPaintValue(b,a,E)},Yn.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:0},c,m);this._setPaintValue(a,s,_)},Yn.prototype._setPaintValue=function(a,s,c){if(this.type==="color")for(var m=nn(c),_=a;_<s;_++)this.paintVertexArray.emplace(_,m[0],m[1]);else{for(var b=a;b<s;b++)this.paintVertexArray.emplace(b,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},Yn.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Yn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Wn=function(a,s,c,m,_,b){this.expression=a,this.uniformNames=s.map(function(E){return"u_"+E+"_t"}),this.type=c,this.useIntegerZoom=m,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(function(E){return{name:"a_"+E,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Wn.prototype.populatePaintArray=function(a,s,c,m,_){var b=this.expression.evaluate(new pi(this.zoom),s,{},m,[],_),E=this.expression.evaluate(new pi(this.zoom+1),s,{},m,[],_),M=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(M,a,b,E)},Wn.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:this.zoom},c,m),b=this.expression.evaluate({zoom:this.zoom+1},c,m);this._setPaintValue(a,s,_,b)},Wn.prototype._setPaintValue=function(a,s,c,m){if(this.type==="color")for(var _=nn(c),b=nn(m),E=a;E<s;E++)this.paintVertexArray.emplace(E,_[0],_[1],b[0],b[1]);else{for(var M=a;M<s;M++)this.paintVertexArray.emplace(M,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}},Wn.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Wn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Wn.prototype.setUniform=function(a,s){var c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,m=Ct(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);a.set(m)},Wn.prototype.getBinding=function(a,s,c){return new Zr(a,s)};var oi=function(a,s,c,m,_,b){this.expression=a,this.type=s,this.useIntegerZoom=c,this.zoom=m,this.layerId=b,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};oi.prototype.populatePaintArray=function(a,s,c){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(m,a,s.patterns&&s.patterns[this.layerId],c)},oi.prototype.updatePaintArray=function(a,s,c,m,_){this._setPaintValues(a,s,c.patterns&&c.patterns[this.layerId],_)},oi.prototype._setPaintValues=function(a,s,c,m){if(m&&c){var _=m[c.min],b=m[c.mid],E=m[c.max];if(_&&b&&E)for(var M=a;M<s;M++)this.zoomInPaintVertexArray.emplace(M,b.tl[0],b.tl[1],b.br[0],b.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],b.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,b.tl[0],b.tl[1],b.br[0],b.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],b.pixelRatio,E.pixelRatio)}},oi.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,Te.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,Te.members,this.expression.isStateDependent))},oi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Hn=function(a,s,c){this.binders={},this._buffers=[];var m=[];for(var _ in a.paint._values)if(c(_)){var b=a.paint.get(_);if(b instanceof zo&&uo(b.property.specification)){var E=aa(_,a.type),M=b.value,O=b.property.specification.type,B=b.property.useIntegerZoom,G=b.property.specification["property-type"],$=G==="cross-faded"||G==="cross-faded-data-driven";if(M.kind==="constant")this.binders[_]=$?new ii(M.value,E):new $n(M.value,E,O),m.push("/u_"+_);else if(M.kind==="source"||$){var re=ga(_,O,"source");this.binders[_]=$?new oi(M,O,B,s,re,a.id):new Yn(M,E,O,re),m.push("/a_"+_)}else{var ue=ga(_,O,"composite");this.binders[_]=new Wn(M,E,O,B,s,ue),m.push("/z_"+_)}}}this.cacheKey=m.sort().join("")};Hn.prototype.getMaxValue=function(a){var s=this.binders[a];return s instanceof Yn||s instanceof Wn?s.maxValue:0},Hn.prototype.populatePaintArrays=function(a,s,c,m,_){for(var b in this.binders){var E=this.binders[b];(E instanceof Yn||E instanceof Wn||E instanceof oi)&&E.populatePaintArray(a,s,c,m,_)}},Hn.prototype.setConstantPatternPositions=function(a,s){for(var c in this.binders){var m=this.binders[c];m instanceof ii&&m.setConstantPatternPositions(a,s)}},Hn.prototype.updatePaintArrays=function(a,s,c,m,_){var b=!1;for(var E in a)for(var M=0,O=s.getPositions(E);M<O.length;M+=1){var B=O[M],G=c.feature(B.index);for(var $ in this.binders){var re=this.binders[$];if((re instanceof Yn||re instanceof Wn||re instanceof oi)&&re.expression.isStateDependent===!0){var ue=m.paint.get($);re.expression=ue.value,re.updatePaintArray(B.start,B.end,G,a[E],_),b=!0}}}return b},Hn.prototype.defines=function(){var a=[];for(var s in this.binders){var c=this.binders[s];(c instanceof $n||c instanceof ii)&&a.push.apply(a,c.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return a},Hn.prototype.getBinderAttributes=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof Yn||c instanceof Wn)for(var m=0;m<c.paintVertexAttributes.length;m++)a.push(c.paintVertexAttributes[m].name);else if(c instanceof oi)for(var _=0;_<Te.members.length;_++)a.push(Te.members[_].name)}return a},Hn.prototype.getBinderUniforms=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof $n||c instanceof ii||c instanceof Wn)for(var m=0,_=c.uniformNames;m<_.length;m+=1)a.push(_[m])}return a},Hn.prototype.getPaintVertexBuffers=function(){return this._buffers},Hn.prototype.getUniforms=function(a,s){var c=[];for(var m in this.binders){var _=this.binders[m];if(_ instanceof $n||_ instanceof ii||_ instanceof Wn)for(var b=0,E=_.uniformNames;b<E.length;b+=1){var M=E[b];if(s[M]){var O=_.getBinding(a,s[M],M);c.push({name:M,property:m,binding:O})}}}return c},Hn.prototype.setUniforms=function(a,s,c,m){for(var _=0,b=s;_<b.length;_+=1){var E=b[_],M=E.name,O=E.property;this.binders[O].setUniform(E.binding,m,c.get(O),M)}},Hn.prototype.updatePaintBuffers=function(a){for(var s in this._buffers=[],this.binders){var c=this.binders[s];if(a&&c instanceof oi){var m=a.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(c instanceof Yn||c instanceof Wn)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},Hn.prototype.upload=function(a){for(var s in this.binders){var c=this.binders[s];(c instanceof Yn||c instanceof Wn||c instanceof oi)&&c.upload(a)}this.updatePaintBuffers()},Hn.prototype.destroy=function(){for(var a in this.binders){var s=this.binders[a];(s instanceof Yn||s instanceof Wn||s instanceof oi)&&s.destroy()}};var Zn=function(a,s,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var m=0,_=a;m<_.length;m+=1){var b=_[m];this.programConfigurations[b.id]=new Hn(b,s,c)}this.needsUpload=!1,this._featureMap=new ot,this._bufferOffset=0};function aa(a,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(s+"-","").replace(/-/g,"_")]}function ga(a,s,c){var m={color:{source:Sc,composite:of},number:{source:$s,composite:Sc}},_=function(b){return{"line-pattern":{source:Mu,composite:Mu},"fill-pattern":{source:Mu,composite:Mu},"fill-extrusion-pattern":{source:Mu,composite:Mu}}[b]}(a);return _&&_[c]||m[s][c]}Zn.prototype.populatePaintArrays=function(a,s,c,m,_,b){for(var E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(a,s,m,_,b);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Zn.prototype.updatePaintArrays=function(a,s,c,m){for(var _=0,b=c;_<b.length;_+=1){var E=b[_];this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(a,this._featureMap,s,E,m)||this.needsUpload}},Zn.prototype.get=function(a){return this.programConfigurations[a]},Zn.prototype.upload=function(a){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(a);this.needsUpload=!1}},Zn.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},cn("ConstantBinder",$n),cn("CrossFadedConstantBinder",ii),cn("SourceExpressionBinder",Yn),cn("CrossFadedCompositeBinder",oi),cn("CompositeExpressionBinder",Wn),cn("ProgramConfiguration",Hn,{omit:["_buffers"]}),cn("ProgramConfigurationSet",Zn);var So=Math.pow(2,14)-1,lo=-So-1;function ya(a){for(var s=8192/a.extent,c=a.loadGeometry(),m=0;m<c.length;m++)for(var _=c[m],b=0;b<_.length;b++){var E=_[b],M=Math.round(E.x*s),O=Math.round(E.y*s);E.x=Ct(M,lo,So),E.y=Ct(O,lo,So),(M<E.x||M>E.x+1||O<E.y||O>E.y+1)&&lt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function Ia(a,s){return{type:a.type,id:a.id,properties:a.properties,geometry:s?ya(a):[]}}function Ja(a,s,c,m,_){a.emplaceBack(2*s+(m+1)/2,2*c+(_+1)/2)}var No=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Xu,this.indexArray=new Ku,this.segments=new de,this.programConfigurations=new Zn(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Qu(a,s){for(var c=0;c<a.length;c++)if(hu(s,a[c]))return!0;for(var m=0;m<s.length;m++)if(hu(a,s[m]))return!0;return!!Ys(a,s)}function Zo(a,s,c){return!!hu(a,s)||!!el(s,a,c)}function Uo(a,s){if(a.length===1)return Cc(s,a[0]);for(var c=0;c<s.length;c++)for(var m=s[c],_=0;_<m.length;_++)if(hu(a,m[_]))return!0;for(var b=0;b<a.length;b++)if(Cc(s,a[b]))return!0;for(var E=0;E<s.length;E++)if(Ys(a,s[E]))return!0;return!1}function xs(a,s,c){if(a.length>1){if(Ys(a,s))return!0;for(var m=0;m<s.length;m++)if(el(s[m],a,c))return!0}for(var _=0;_<a.length;_++)if(el(a[_],s,c))return!0;return!1}function Ys(a,s){if(a.length===0||s.length===0)return!1;for(var c=0;c<a.length-1;c++)for(var m=a[c],_=a[c+1],b=0;b<s.length-1;b++)if(bs(m,_,s[b],s[b+1]))return!0;return!1}function bs(a,s,c,m){return Xt(a,c,m)!==Xt(s,c,m)&&Xt(a,s,c)!==Xt(a,s,m)}function el(a,s,c){var m=c*c;if(s.length===1)return a.distSqr(s[0])<m;for(var _=1;_<s.length;_++)if(xl(a,s[_-1],s[_])<m)return!0;return!1}function xl(a,s,c){var m=s.distSqr(c);if(m===0)return a.distSqr(s);var _=((a.x-s.x)*(c.x-s.x)+(a.y-s.y)*(c.y-s.y))/m;return a.distSqr(_<0?s:_>1?c:c.sub(s)._mult(_)._add(s))}function Cc(a,s){for(var c,m,_,b=!1,E=0;E<a.length;E++)for(var M=0,O=(c=a[E]).length-1;M<c.length;O=M++)(m=c[M]).y>s.y!=(_=c[O]).y>s.y&&s.x<(_.x-m.x)*(s.y-m.y)/(_.y-m.y)+m.x&&(b=!b);return b}function hu(a,s){for(var c=!1,m=0,_=a.length-1;m<a.length;_=m++){var b=a[m],E=a[_];b.y>s.y!=E.y>s.y&&s.x<(E.x-b.x)*(s.y-b.y)/(E.y-b.y)+b.x&&(c=!c)}return c}function Kl(a,s,c){var m=c[0],_=c[2];if(a.x<m.x&&s.x<m.x||a.x>_.x&&s.x>_.x||a.y<m.y&&s.y<m.y||a.y>_.y&&s.y>_.y)return!1;var b=Xt(a,s,c[0]);return b!==Xt(a,s,c[1])||b!==Xt(a,s,c[2])||b!==Xt(a,s,c[3])}function Ds(a,s,c){var m=s.paint.get(a).value;return m.kind==="constant"?m.value:c.programConfigurations.get(s.id).getMaxValue(a)}function Pa(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function pu(a,s,c,m,_){if(!s[0]&&!s[1])return a;var b=oe.convert(s)._mult(_);c==="viewport"&&b._rotate(-m);for(var E=[],M=0;M<a.length;M++)E.push(a[M].sub(b));return E}No.prototype.populate=function(a,s,c){var m=this.layers[0],_=[],b=null;m.type==="circle"&&(b=m.layout.get("circle-sort-key"));for(var E=0,M=a;E<M.length;E+=1){var O=M[E],B=O.feature,G=O.id,$=O.index,re=O.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,ke=Ia(B,ue);if(this.layers[0]._featureFilter.filter(new pi(this.zoom),ke,c)){var Me=b?b.evaluate(ke,{},c):void 0,Xe={id:G,properties:B.properties,type:B.type,sourceLayerIndex:re,index:$,geometry:ue?ke.geometry:ya(B),patterns:{},sortKey:Me};_.push(Xe)}}b&&_.sort(function(Kr,Pn){return Kr.sortKey-Pn.sortKey});for(var Ve=0,st=_;Ve<st.length;Ve+=1){var It=st[Ve],Nt=It.geometry,Ht=It.index,or=It.sourceLayerIndex,Fr=a[Ht].feature;this.addFeature(It,Nt,Ht,c),s.featureIndex.insert(Fr,Nt,Ht,or,this.index)}},No.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},No.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},No.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},No.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ae),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},No.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},No.prototype.addFeature=function(a,s,c,m){for(var _=0,b=s;_<b.length;_+=1)for(var E=0,M=b[_];E<M.length;E+=1){var O=M[E],B=O.x,G=O.y;if(!(B<0||B>=8192||G<0||G>=8192)){var $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),re=$.vertexLength;Ja(this.layoutVertexArray,B,G,-1,-1),Ja(this.layoutVertexArray,B,G,1,-1),Ja(this.layoutVertexArray,B,G,1,1),Ja(this.layoutVertexArray,B,G,-1,1),this.indexArray.emplaceBack(re,re+1,re+2),this.indexArray.emplaceBack(re,re+3,re+2),$.vertexLength+=4,$.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,{},m)},cn("CircleBucket",No,{omit:["layers"]});var Ss=new bo({"circle-sort-key":new dn(he.layout_circle["circle-sort-key"])}),es={paint:new bo({"circle-radius":new dn(he.paint_circle["circle-radius"]),"circle-color":new dn(he.paint_circle["circle-color"]),"circle-blur":new dn(he.paint_circle["circle-blur"]),"circle-opacity":new dn(he.paint_circle["circle-opacity"]),"circle-translate":new An(he.paint_circle["circle-translate"]),"circle-translate-anchor":new An(he.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new An(he.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new An(he.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new dn(he.paint_circle["circle-stroke-width"]),"circle-stroke-color":new dn(he.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new dn(he.paint_circle["circle-stroke-opacity"])}),layout:Ss},ki=typeof Float32Array!="undefined"?Float32Array:Array;function co(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function wo(a,s,c){var m=s[0],_=s[1],b=s[2],E=s[3],M=s[4],O=s[5],B=s[6],G=s[7],$=s[8],re=s[9],ue=s[10],ke=s[11],Me=s[12],Xe=s[13],Ve=s[14],st=s[15],It=c[0],Nt=c[1],Ht=c[2],or=c[3];return a[0]=It*m+Nt*M+Ht*$+or*Me,a[1]=It*_+Nt*O+Ht*re+or*Xe,a[2]=It*b+Nt*B+Ht*ue+or*Ve,a[3]=It*E+Nt*G+Ht*ke+or*st,a[4]=(It=c[4])*m+(Nt=c[5])*M+(Ht=c[6])*$+(or=c[7])*Me,a[5]=It*_+Nt*O+Ht*re+or*Xe,a[6]=It*b+Nt*B+Ht*ue+or*Ve,a[7]=It*E+Nt*G+Ht*ke+or*st,a[8]=(It=c[8])*m+(Nt=c[9])*M+(Ht=c[10])*$+(or=c[11])*Me,a[9]=It*_+Nt*O+Ht*re+or*Xe,a[10]=It*b+Nt*B+Ht*ue+or*Ve,a[11]=It*E+Nt*G+Ht*ke+or*st,a[12]=(It=c[12])*m+(Nt=c[13])*M+(Ht=c[14])*$+(or=c[15])*Me,a[13]=It*_+Nt*O+Ht*re+or*Xe,a[14]=It*b+Nt*B+Ht*ue+or*Ve,a[15]=It*E+Nt*G+Ht*ke+or*st,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,s=0,c=arguments.length;c--;)s+=a[c]*a[c];return Math.sqrt(s)});var ws,tl=wo;function Fs(a,s,c){var m=s[0],_=s[1],b=s[2],E=s[3];return a[0]=c[0]*m+c[4]*_+c[8]*b+c[12]*E,a[1]=c[1]*m+c[5]*_+c[9]*b+c[13]*E,a[2]=c[2]*m+c[6]*_+c[10]*b+c[14]*E,a[3]=c[3]*m+c[7]*_+c[11]*b+c[15]*E,a}ws=new ki(3),ki!=Float32Array&&(ws[0]=0,ws[1]=0,ws[2]=0),function(){var a=new ki(4);ki!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var bl=(function(){var a=new ki(2);ki!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function s(c){a.call(this,c,es)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new No(c)},s.prototype.queryRadius=function(c){var m=c;return Ds("circle-radius",this,m)+Ds("circle-stroke-width",this,m)+Pa(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,O,B){for(var G=pu(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,O),$=this.paint.get("circle-radius").evaluate(m,_)+this.paint.get("circle-stroke-width").evaluate(m,_),re=this.paint.get("circle-pitch-alignment")==="map",ue=re?G:function(Fr,Kr){return Fr.map(function(Pn){return Iu(Pn,Kr)})}(G,B),ke=re?$*O:$,Me=0,Xe=b;Me<Xe.length;Me+=1)for(var Ve=0,st=Xe[Me];Ve<st.length;Ve+=1){var It=st[Ve],Nt=re?It:Iu(It,B),Ht=ke,or=Fs([],[It.x,It.y,0,1],B);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ht*=or[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ht*=M.cameraToCenterDistance/or[3]),Zo(ue,Nt,Ht))return!0}return!1},s}(Ws));function Iu(a,s){var c=Fs([],[a.x,a.y,0,1],s);return new oe(c[0]/c[3],c[1]/c[3])}var rl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(No);function Xs(a,s,c,m){var _=s.width,b=s.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==_*b*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(_*b*c);return a.width=_,a.height=b,a.data=m,a}function Sl(a,s,c){var m=s.width,_=s.height;if(m!==a.width||_!==a.height){var b=Xs({},{width:m,height:_},c);Zf(a,b,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,m),height:Math.min(a.height,_)},c),a.width=m,a.height=_,a.data=b.data}}function Zf(a,s,c,m,_,b){if(_.width===0||_.height===0)return s;if(_.width>a.width||_.height>a.height||c.x>a.width-_.width||c.y>a.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||m.x>s.width-_.width||m.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var E=a.data,M=s.data,O=0;O<_.height;O++)for(var B=((c.y+O)*a.width+c.x)*b,G=((m.y+O)*s.width+m.x)*b,$=0;$<_.width*b;$++)M[G+$]=E[B+$];return s}cn("HeatmapBucket",rl,{omit:["layers"]});var du=function(a,s){Xs(this,a,1,s)};du.prototype.resize=function(a){Sl(this,a,1)},du.prototype.clone=function(){return new du({width:this.width,height:this.height},new Uint8Array(this.data))},du.copy=function(a,s,c,m,_){Zf(a,s,c,m,_,1)};var za=function(a,s){Xs(this,a,4,s)};za.prototype.resize=function(a){Sl(this,a,4)},za.prototype.replace=function(a,s){s?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},za.prototype.clone=function(){return new za({width:this.width,height:this.height},new Uint8Array(this.data))},za.copy=function(a,s,c,m,_){Zf(a,s,c,m,_,4)},cn("AlphaImage",du),cn("RGBAImage",za);var Mp={paint:new bo({"heatmap-radius":new dn(he.paint_heatmap["heatmap-radius"]),"heatmap-weight":new dn(he.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new An(he.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Wa(he.paint_heatmap["heatmap-color"]),"heatmap-opacity":new An(he.paint_heatmap["heatmap-opacity"])})};function Ip(a){var s={},c=a.resolution||256,m=a.clips?a.clips.length:1,_=a.image||new za({width:c,height:m}),b=function(ke,Me,Xe){s[a.evaluationKey]=Xe;var Ve=a.expression.evaluate(s);_.data[ke+Me+0]=Math.floor(255*Ve.r/Ve.a),_.data[ke+Me+1]=Math.floor(255*Ve.g/Ve.a),_.data[ke+Me+2]=Math.floor(255*Ve.b/Ve.a),_.data[ke+Me+3]=Math.floor(255*Ve.a)};if(a.clips)for(var E=0,M=0;E<m;++E,M+=4*c)for(var O=0,B=0;O<c;O++,B+=4){var G=O/(c-1),$=a.clips[E];b(M,B,$.start*(1-G)+$.end*G)}else for(var re=0,ue=0;re<c;re++,ue+=4)b(0,ue,re/(c-1));return _}var xd=function(a){function s(c){a.call(this,c,Mp),this._updateColorRamp()}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new rl(c)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Ip({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(Ws),bd={paint:new bo({"hillshade-illumination-direction":new An(he.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new An(he.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new An(he.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new An(he.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new An(he.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new An(he.paint_hillshade["hillshade-accent-color"])})},ph=function(a){function s(c){a.call(this,c,bd)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(Ws),Pv=ra([{name:"a_pos",components:2,type:"Int16"}],4).members,Tc=jh,Pp=jh;function jh(a,s,c){c=c||2;var m,_,b,E,M,O,B,G=s&&s.length,$=G?s[0]*c:a.length,re=kp(a,0,$,c,!0),ue=[];if(!re||re.next===re.prev)return ue;if(G&&(re=function(Me,Xe,Ve,st){var It,Nt,Ht,or=[];for(It=0,Nt=Xe.length;It<Nt;It++)(Ht=kp(Me,Xe[It]*st,It<Nt-1?Xe[It+1]*st:Me.length,st,!1))===Ht.next&&(Ht.steiner=!0),or.push(wd(Ht));for(or.sort(Sd),It=0;It<or.length;It++)Rv(or[It],Ve),Ve=Jl(Ve,Ve.next);return Ve}(a,s,re,c)),a.length>80*c){m=b=a[0],_=E=a[1];for(var ke=c;ke<$;ke+=c)(M=a[ke])<m&&(m=M),(O=a[ke+1])<_&&(_=O),M>b&&(b=M),O>E&&(E=O);B=(B=Math.max(b-m,E-_))!==0?1/B:0}return dh(re,ue,c,m,_,B),ue}function kp(a,s,c,m,_){var b,E;if(_===Ic(a,s,c,m)>0)for(b=s;b<c;b+=m)E=mh(b,a[b],a[b+1],E);else for(b=c-m;b>=s;b-=m)E=mh(b,a[b],a[b+1],E);return E&&ec(E,E.next)&&(rc(E),E=E.next),E}function Jl(a,s){if(!a)return a;s||(s=a);var c,m=a;do if(c=!1,m.steiner||!ec(m,m.next)&&pa(m.prev,m,m.next)!==0)m=m.next;else{if(rc(m),(m=s=m.prev)===m.next)break;c=!0}while(c||m!==s);return s}function dh(a,s,c,m,_,b,E){if(a){!E&&b&&function(G,$,re,ue){var ke=G;do ke.z===null&&(ke.z=Gh(ke.x,ke.y,$,re,ue)),ke.prevZ=ke.prev,ke.nextZ=ke.next,ke=ke.next;while(ke!==G);ke.prevZ.nextZ=null,ke.prevZ=null,function(Me){var Xe,Ve,st,It,Nt,Ht,or,Fr,Kr=1;do{for(Ve=Me,Me=null,Nt=null,Ht=0;Ve;){for(Ht++,st=Ve,or=0,Xe=0;Xe<Kr&&(or++,st=st.nextZ);Xe++);for(Fr=Kr;or>0||Fr>0&&st;)or!==0&&(Fr===0||!st||Ve.z<=st.z)?(It=Ve,Ve=Ve.nextZ,or--):(It=st,st=st.nextZ,Fr--),Nt?Nt.nextZ=It:Me=It,It.prevZ=Nt,Nt=It;Ve=st}Nt.nextZ=null,Kr*=2}while(Ht>1)}(ke)}(a,m,_,b);for(var M,O,B=a;a.prev!==a.next;)if(M=a.prev,O=a.next,b?Rp(a,m,_,b):Lp(a))s.push(M.i/c),s.push(a.i/c),s.push(O.i/c),rc(a),a=O.next,B=O.next;else if((a=O)===B){E?E===1?dh(a=kv(Jl(a),s,c),s,c,m,_,b,2):E===2&&Lv(a,s,c,m,_,b):dh(Jl(a),s,c,m,_,b,1);break}}}function Lp(a){var s=a.prev,c=a,m=a.next;if(pa(s,c,m)>=0)return!1;for(var _=a.next.next;_!==a.prev;){if(Ql(s.x,s.y,c.x,c.y,m.x,m.y,_.x,_.y)&&pa(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function Rp(a,s,c,m){var _=a.prev,b=a,E=a.next;if(pa(_,b,E)>=0)return!1;for(var M=_.x>b.x?_.x>E.x?_.x:E.x:b.x>E.x?b.x:E.x,O=_.y>b.y?_.y>E.y?_.y:E.y:b.y>E.y?b.y:E.y,B=Gh(_.x<b.x?_.x<E.x?_.x:E.x:b.x<E.x?b.x:E.x,_.y<b.y?_.y<E.y?_.y:E.y:b.y<E.y?b.y:E.y,s,c,m),G=Gh(M,O,s,c,m),$=a.prevZ,re=a.nextZ;$&&$.z>=B&&re&&re.z<=G;){if($!==a.prev&&$!==a.next&&Ql(_.x,_.y,b.x,b.y,E.x,E.y,$.x,$.y)&&pa($.prev,$,$.next)>=0||($=$.prevZ,re!==a.prev&&re!==a.next&&Ql(_.x,_.y,b.x,b.y,E.x,E.y,re.x,re.y)&&pa(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;$&&$.z>=B;){if($!==a.prev&&$!==a.next&&Ql(_.x,_.y,b.x,b.y,E.x,E.y,$.x,$.y)&&pa($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;re&&re.z<=G;){if(re!==a.prev&&re!==a.next&&Ql(_.x,_.y,b.x,b.y,E.x,E.y,re.x,re.y)&&pa(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function kv(a,s,c){var m=a;do{var _=m.prev,b=m.next.next;!ec(_,b)&&Hh(_,m,m.next,b)&&wl(_,b)&&wl(b,_)&&(s.push(_.i/c),s.push(m.i/c),s.push(b.i/c),rc(m),rc(m.next),m=a=b),m=m.next}while(m!==a);return Jl(m)}function Lv(a,s,c,m,_,b){var E=a;do{for(var M=E.next.next;M!==E.prev;){if(E.i!==M.i&&vh(E,M)){var O=sf(E,M);return E=Jl(E,E.next),O=Jl(O,O.next),dh(E,s,c,m,_,b),void dh(O,s,c,m,_,b)}M=M.next}E=E.next}while(E!==a)}function Sd(a,s){return a.x-s.x}function Rv(a,s){if(s=function(m,_){var b,E=_,M=m.x,O=m.y,B=-1/0;do{if(O<=E.y&&O>=E.next.y&&E.next.y!==E.y){var G=E.x+(O-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(G<=M&&G>B){if(B=G,G===M){if(O===E.y)return E;if(O===E.next.y)return E.next}b=E.x<E.next.x?E:E.next}}E=E.next}while(E!==_);if(!b)return null;if(M===B)return b;var $,re=b,ue=b.x,ke=b.y,Me=1/0;E=b;do M>=E.x&&E.x>=ue&&M!==E.x&&Ql(O<ke?M:B,O,ue,ke,O<ke?B:M,O,E.x,E.y)&&($=Math.abs(O-E.y)/(M-E.x),wl(E,m)&&($<Me||$===Me&&(E.x>b.x||E.x===b.x&&Ov(b,E)))&&(b=E,Me=$)),E=E.next;while(E!==re);return b}(a,s)){var c=sf(s,a);Jl(s,s.next),Jl(c,c.next)}}function Ov(a,s){return pa(a.prev,a,s.prev)<0&&pa(s.next,a,a.next)<0}function Gh(a,s,c,m,_){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-c)*_)|a<<8))|a<<4))|a<<2))|a<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-m)*_)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function wd(a){var s=a,c=a;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==a);return c}function Ql(a,s,c,m,_,b,E,M){return(_-E)*(s-M)-(a-E)*(b-M)>=0&&(a-E)*(m-M)-(c-E)*(s-M)>=0&&(c-E)*(b-M)-(_-E)*(m-M)>=0}function vh(a,s){return a.next.i!==s.i&&a.prev.i!==s.i&&!function(c,m){var _=c;do{if(_.i!==c.i&&_.next.i!==c.i&&_.i!==m.i&&_.next.i!==m.i&&Hh(_,_.next,c,m))return!0;_=_.next}while(_!==c);return!1}(a,s)&&(wl(a,s)&&wl(s,a)&&function(c,m){var _=c,b=!1,E=(c.x+m.x)/2,M=(c.y+m.y)/2;do _.y>M!=_.next.y>M&&_.next.y!==_.y&&E<(_.next.x-_.x)*(M-_.y)/(_.next.y-_.y)+_.x&&(b=!b),_=_.next;while(_!==c);return b}(a,s)&&(pa(a.prev,a,s.prev)||pa(a,s.prev,s))||ec(a,s)&&pa(a.prev,a,a.next)>0&&pa(s.prev,s,s.next)>0)}function pa(a,s,c){return(s.y-a.y)*(c.x-s.x)-(s.x-a.x)*(c.y-s.y)}function ec(a,s){return a.x===s.x&&a.y===s.y}function Hh(a,s,c,m){var _=tc(pa(a,s,c)),b=tc(pa(a,s,m)),E=tc(pa(c,m,a)),M=tc(pa(c,m,s));return _!==b&&E!==M||!(_!==0||!Mc(a,c,s))||!(b!==0||!Mc(a,m,s))||!(E!==0||!Mc(c,a,m))||!(M!==0||!Mc(c,s,m))}function Mc(a,s,c){return s.x<=Math.max(a.x,c.x)&&s.x>=Math.min(a.x,c.x)&&s.y<=Math.max(a.y,c.y)&&s.y>=Math.min(a.y,c.y)}function tc(a){return a>0?1:a<0?-1:0}function wl(a,s){return pa(a.prev,a,a.next)<0?pa(a,s,a.next)>=0&&pa(a,a.prev,s)>=0:pa(a,s,a.prev)<0||pa(a,a.next,s)<0}function sf(a,s){var c=new uf(a.i,a.x,a.y),m=new uf(s.i,s.x,s.y),_=a.next,b=s.prev;return a.next=s,s.prev=a,c.next=_,_.prev=c,m.next=c,c.prev=m,b.next=m,m.prev=b,m}function mh(a,s,c,m){var _=new uf(a,s,c);return m?(_.next=m.next,_.prev=m,m.next.prev=_,m.next=_):(_.prev=_,_.next=_),_}function rc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function uf(a,s,c){this.i=a,this.x=s,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ic(a,s,c,m){for(var _=0,b=s,E=c-m;b<c;b+=m)_+=(a[E]-a[b])*(a[b+1]+a[E+1]),E=b;return _}function gh(a,s,c,m,_){(function b(E,M,O,B,G){for(;B>O;){if(B-O>600){var $=B-O+1,re=M-O+1,ue=Math.log($),ke=.5*Math.exp(2*ue/3),Me=.5*Math.sqrt(ue*ke*($-ke)/$)*(re-$/2<0?-1:1);b(E,M,Math.max(O,Math.floor(M-re*ke/$+Me)),Math.min(B,Math.floor(M+($-re)*ke/$+Me)),G)}var Xe=E[M],Ve=O,st=B;for(nc(E,O,M),G(E[B],Xe)>0&&nc(E,O,B);Ve<st;){for(nc(E,Ve,st),Ve++,st--;G(E[Ve],Xe)<0;)Ve++;for(;G(E[st],Xe)>0;)st--}G(E[O],Xe)===0?nc(E,O,st):nc(E,++st,B),st<=M&&(O=st+1),M<=st&&(B=st-1)}})(a,s,c||0,m||a.length-1,_||Pc)}function nc(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}function Pc(a,s){return a<s?-1:a>s?1:0}function El(a,s){var c=a.length;if(c<=1)return[a];for(var m,_,b=[],E=0;E<c;E++){var M=_r(a[E]);M!==0&&(a[E].area=Math.abs(M),_===void 0&&(_=M<0),_===M<0?(m&&b.push(m),m=[a[E]]):m.push(a[E]))}if(m&&b.push(m),s>1)for(var O=0;O<b.length;O++)b[O].length<=s||(gh(b[O],s,1,b[O].length-1,yh),b[O]=b[O].slice(0,s));return b}function yh(a,s){return s.area-a.area}function Al(a,s,c){for(var m=c.patternDependencies,_=!1,b=0,E=s;b<E.length;b+=1){var M=E[b].paint.get(a+"-pattern");M.isConstant()||(_=!0);var O=M.constantOr(null);O&&(_=!0,m[O.to]=!0,m[O.from]=!0)}return _}function Cl(a,s,c,m,_){for(var b=_.patternDependencies,E=0,M=s;E<M.length;E+=1){var O=M[E],B=O.paint.get(a+"-pattern").value;if(B.kind!=="constant"){var G=B.evaluate({zoom:m-1},c,{},_.availableImages),$=B.evaluate({zoom:m},c,{},_.availableImages),re=B.evaluate({zoom:m+1},c,{},_.availableImages);$=$&&$.name?$.name:$,re=re&&re.name?re.name:re,b[G=G&&G.name?G.name:G]=!0,b[$]=!0,b[re]=!0,c.patterns[O.id]={min:G,mid:$,max:re}}}return c}jh.deviation=function(a,s,c,m){var _=s&&s.length,b=Math.abs(Ic(a,0,_?s[0]*c:a.length,c));if(_)for(var E=0,M=s.length;E<M;E++)b-=Math.abs(Ic(a,s[E]*c,E<M-1?s[E+1]*c:a.length,c));var O=0;for(E=0;E<m.length;E+=3){var B=m[E]*c,G=m[E+1]*c,$=m[E+2]*c;O+=Math.abs((a[B]-a[$])*(a[G+1]-a[B+1])-(a[B]-a[G])*(a[$+1]-a[B+1]))}return b===0&&O===0?0:Math.abs((O-b)/b)},jh.flatten=function(a){for(var s=a[0][0].length,c={vertices:[],holes:[],dimensions:s},m=0,_=0;_<a.length;_++){for(var b=0;b<a[_].length;b++)for(var E=0;E<s;E++)c.vertices.push(a[_][b][E]);_>0&&c.holes.push(m+=a[_-1].length)}return c},Tc.default=Pp;var Qa=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xu,this.indexArray=new Ku,this.indexArray2=new af,this.programConfigurations=new Zn(a.layers,a.zoom),this.segments=new de,this.segments2=new de,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};Qa.prototype.populate=function(a,s,c){this.hasPattern=Al("fill",this.layers,s);for(var m=this.layers[0].layout.get("fill-sort-key"),_=[],b=0,E=a;b<E.length;b+=1){var M=E[b],O=M.feature,B=M.id,G=M.index,$=M.sourceLayerIndex,re=this.layers[0]._featureFilter.needGeometry,ue=Ia(O,re);if(this.layers[0]._featureFilter.filter(new pi(this.zoom),ue,c)){var ke=m?m.evaluate(ue,{},c,s.availableImages):void 0,Me={id:B,properties:O.properties,type:O.type,sourceLayerIndex:$,index:G,geometry:re?ue.geometry:ya(O),patterns:{},sortKey:ke};_.push(Me)}}m&&_.sort(function(Fr,Kr){return Fr.sortKey-Kr.sortKey});for(var Xe=0,Ve=_;Xe<Ve.length;Xe+=1){var st=Ve[Xe],It=st.geometry,Nt=st.index,Ht=st.sourceLayerIndex;if(this.hasPattern){var or=Cl("fill",this.layers,st,this.zoom,s);this.patternFeatures.push(or)}else this.addFeature(st,It,Nt,c,{});s.featureIndex.insert(a[Nt].feature,It,Nt,Ht,this.index)}},Qa.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},Qa.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var b=_[m];this.addFeature(b,b.geometry,b.index,s,c)}},Qa.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Qa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Qa.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Pv),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},Qa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Qa.prototype.addFeature=function(a,s,c,m,_){for(var b=0,E=El(s,500);b<E.length;b+=1){for(var M=E[b],O=0,B=0,G=M;B<G.length;B+=1)O+=G[B].length;for(var $=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray),re=$.vertexLength,ue=[],ke=[],Me=0,Xe=M;Me<Xe.length;Me+=1){var Ve=Xe[Me];if(Ve.length!==0){Ve!==M[0]&&ke.push(ue.length/2);var st=this.segments2.prepareSegment(Ve.length,this.layoutVertexArray,this.indexArray2),It=st.vertexLength;this.layoutVertexArray.emplaceBack(Ve[0].x,Ve[0].y),this.indexArray2.emplaceBack(It+Ve.length-1,It),ue.push(Ve[0].x),ue.push(Ve[0].y);for(var Nt=1;Nt<Ve.length;Nt++)this.layoutVertexArray.emplaceBack(Ve[Nt].x,Ve[Nt].y),this.indexArray2.emplaceBack(It+Nt-1,It+Nt),ue.push(Ve[Nt].x),ue.push(Ve[Nt].y);st.vertexLength+=Ve.length,st.primitiveLength+=Ve.length}}for(var Ht=Tc(ue,ke),or=0;or<Ht.length;or+=3)this.indexArray.emplaceBack(re+Ht[or],re+Ht[or+1],re+Ht[or+2]);$.vertexLength+=O,$.primitiveLength+=Ht.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},cn("FillBucket",Qa,{omit:["layers","patternFeatures"]});var Lr=new bo({"fill-sort-key":new dn(he.layout_fill["fill-sort-key"])}),_h={paint:new bo({"fill-antialias":new An(he.paint_fill["fill-antialias"]),"fill-opacity":new dn(he.paint_fill["fill-opacity"]),"fill-color":new dn(he.paint_fill["fill-color"]),"fill-outline-color":new dn(he.paint_fill["fill-outline-color"]),"fill-translate":new An(he.paint_fill["fill-translate"]),"fill-translate-anchor":new An(he.paint_fill["fill-translate-anchor"]),"fill-pattern":new Yu(he.paint_fill["fill-pattern"])}),layout:Lr},Dv=function(a){function s(c){a.call(this,c,_h)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(c){return new Qa(c)},s.prototype.queryRadius=function(){return Pa(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,O){return Uo(pu(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,O),b)},s.prototype.isTileClipped=function(){return!0},s}(Ws),Po=ra([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,fs=vu;function vu(a,s,c,m,_){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=m,this._values=_,a.readFields(xh,this,s)}function xh(a,s,c){a==1?s.id=c.readVarint():a==2?function(m,_){for(var b=m.readVarint()+m.pos;m.pos<b;){var E=_._keys[m.readVarint()],M=_._values[m.readVarint()];_.properties[E]=M}}(c,s):a==3?s.type=c.readVarint():a==4&&(s._geometry=c.pos)}function Tl(a){for(var s,c,m=0,_=0,b=a.length,E=b-1;_<b;E=_++)m+=((c=a[E]).x-(s=a[_]).x)*(s.y+c.y);return m}vu.types=["Unknown","Point","LineString","Polygon"],vu.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var s,c=a.readVarint()+a.pos,m=1,_=0,b=0,E=0,M=[];a.pos<c;){if(_<=0){var O=a.readVarint();m=7&O,_=O>>3}if(_--,m===1||m===2)b+=a.readSVarint(),E+=a.readSVarint(),m===1&&(s&&M.push(s),s=[]),s.push(new oe(b,E));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&M.push(s),M},vu.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var s=a.readVarint()+a.pos,c=1,m=0,_=0,b=0,E=1/0,M=-1/0,O=1/0,B=-1/0;a.pos<s;){if(m<=0){var G=a.readVarint();c=7&G,m=G>>3}if(m--,c===1||c===2)(_+=a.readSVarint())<E&&(E=_),_>M&&(M=_),(b+=a.readSVarint())<O&&(O=b),b>B&&(B=b);else if(c!==7)throw new Error("unknown command "+c)}return[E,O,M,B]},vu.prototype.toGeoJSON=function(a,s,c){var m,_,b=this.extent*Math.pow(2,c),E=this.extent*a,M=this.extent*s,O=this.loadGeometry(),B=vu.types[this.type];function G(ue){for(var ke=0;ke<ue.length;ke++){var Me=ue[ke];ue[ke]=[360*(Me.x+E)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Me.y+M)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(m=0;m<O.length;m++)$[m]=O[m][0];G(O=$);break;case 2:for(m=0;m<O.length;m++)G(O[m]);break;case 3:for(O=function(ue){var ke=ue.length;if(ke<=1)return[ue];for(var Me,Xe,Ve=[],st=0;st<ke;st++){var It=Tl(ue[st]);It!==0&&(Xe===void 0&&(Xe=It<0),Xe===It<0?(Me&&Ve.push(Me),Me=[ue[st]]):Me.push(ue[st]))}return Me&&Ve.push(Me),Ve}(O),m=0;m<O.length;m++)for(_=0;_<O[m].length;_++)G(O[m][_])}O.length===1?O=O[0]:B="Multi"+B;var re={type:"Feature",geometry:{type:B,coordinates:O},properties:this.properties};return"id"in this&&(re.id=this.id),re};var kc=Uf;function Uf(a,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Fv,this,s),this.length=this._features.length}function Fv(a,s,c){a===15?s.version=c.readVarint():a===1?s.name=c.readString():a===5?s.extent=c.readVarint():a===2?s._features.push(c.pos):a===3?s._keys.push(c.readString()):a===4&&s._values.push(function(m){for(var _=null,b=m.readVarint()+m.pos;m.pos<b;){var E=m.readVarint()>>3;_=E===1?m.readString():E===2?m.readFloat():E===3?m.readDouble():E===4?m.readVarint64():E===5?m.readVarint():E===6?m.readSVarint():E===7?m.readBoolean():null}return _}(c))}function nl(a,s,c){if(a===3){var m=new kc(c,c.readVarint()+c.pos);m.length&&(s[m.name]=m)}}Uf.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var s=this._pbf.readVarint()+this._pbf.pos;return new fs(this._pbf,s,this.extent,this._keys,this._values)};var il={VectorTile:function(a,s){this.layers=a.readFields(nl,{},s)},VectorTileFeature:fs,VectorTileLayer:kc},ic=il.VectorTileFeature.types,qs=Math.pow(2,13);function Lc(a,s,c,m,_,b,E,M){a.emplaceBack(s,c,2*Math.floor(m*qs)+E,_*qs*2,b*qs*2,Math.round(M))}var mu=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Tu,this.indexArray=new Ku,this.programConfigurations=new Zn(a.layers,a.zoom),this.segments=new de,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Wh(a,s){return a.x===s.x&&(a.x<0||a.x>8192)||a.y===s.y&&(a.y<0||a.y>8192)}mu.prototype.populate=function(a,s,c){this.features=[],this.hasPattern=Al("fill-extrusion",this.layers,s);for(var m=0,_=a;m<_.length;m+=1){var b=_[m],E=b.feature,M=b.id,O=b.index,B=b.sourceLayerIndex,G=this.layers[0]._featureFilter.needGeometry,$=Ia(E,G);if(this.layers[0]._featureFilter.filter(new pi(this.zoom),$,c)){var re={id:M,sourceLayerIndex:B,index:O,geometry:G?$.geometry:ya(E),properties:E.properties,type:E.type,patterns:{}};this.hasPattern?this.features.push(Cl("fill-extrusion",this.layers,re,this.zoom,s)):this.addFeature(re,re.geometry,O,c,{}),s.featureIndex.insert(E,re.geometry,O,B,this.index,!0)}}},mu.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.features;m<_.length;m+=1){var b=_[m];this.addFeature(b,b.geometry,b.index,s,c)}},mu.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},mu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},mu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},mu.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Po),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},mu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},mu.prototype.addFeature=function(a,s,c,m,_){for(var b=0,E=El(s,500);b<E.length;b+=1){for(var M=E[b],O=0,B=0,G=M;B<G.length;B+=1)O+=G[B].length;for(var $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),re=0,ue=M;re<ue.length;re+=1){var ke=ue[re];if(ke.length!==0&&!((Ti=ke).every(function(ci){return ci.x<0})||Ti.every(function(ci){return ci.x>8192})||Ti.every(function(ci){return ci.y<0})||Ti.every(function(ci){return ci.y>8192})))for(var Me=0,Xe=0;Xe<ke.length;Xe++){var Ve=ke[Xe];if(Xe>=1){var st=ke[Xe-1];if(!Wh(Ve,st)){$.vertexLength+4>de.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var It=Ve.sub(st)._perp()._unit(),Nt=st.dist(Ve);Me+Nt>32768&&(Me=0),Lc(this.layoutVertexArray,Ve.x,Ve.y,It.x,It.y,0,0,Me),Lc(this.layoutVertexArray,Ve.x,Ve.y,It.x,It.y,0,1,Me),Lc(this.layoutVertexArray,st.x,st.y,It.x,It.y,0,0,Me+=Nt),Lc(this.layoutVertexArray,st.x,st.y,It.x,It.y,0,1,Me);var Ht=$.vertexLength;this.indexArray.emplaceBack(Ht,Ht+2,Ht+1),this.indexArray.emplaceBack(Ht+1,Ht+2,Ht+3),$.vertexLength+=4,$.primitiveLength+=2}}}}if($.vertexLength+O>de.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray)),ic[a.type]==="Polygon"){for(var or=[],Fr=[],Kr=$.vertexLength,Pn=0,on=M;Pn<on.length;Pn+=1){var Or=on[Pn];if(Or.length!==0){Or!==M[0]&&Fr.push(or.length/2);for(var cr=0;cr<Or.length;cr++){var di=Or[cr];Lc(this.layoutVertexArray,di.x,di.y,0,0,1,1,0),or.push(di.x),or.push(di.y)}}}for(var Xn=Tc(or,Fr),wn=0;wn<Xn.length;wn+=3)this.indexArray.emplaceBack(Kr+Xn[wn],Kr+Xn[wn+2],Kr+Xn[wn+1]);$.primitiveLength+=Xn.length/3,$.vertexLength+=O}}var Ti;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},cn("FillExtrusionBucket",mu,{omit:["layers","features"]});var Op={paint:new bo({"fill-extrusion-opacity":new An(he["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new dn(he["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new An(he["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new An(he["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Yu(he["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new dn(he["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new dn(he["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new An(he["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Es=function(a){function s(c){a.call(this,c,Op)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new mu(c)},s.prototype.queryRadius=function(){return Pa(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,O,B){var G=pu(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,O),$=this.paint.get("fill-extrusion-height").evaluate(m,_),re=this.paint.get("fill-extrusion-base").evaluate(m,_),ue=function(Me,Xe,Ve,st){for(var It=[],Nt=0,Ht=Me;Nt<Ht.length;Nt+=1){var or=Ht[Nt],Fr=[or.x,or.y,0,1];Fs(Fr,Fr,Xe),It.push(new oe(Fr[0]/Fr[3],Fr[1]/Fr[3]))}return It}(G,B),ke=function(Me,Xe,Ve,st){for(var It=[],Nt=[],Ht=st[8]*Xe,or=st[9]*Xe,Fr=st[10]*Xe,Kr=st[11]*Xe,Pn=st[8]*Ve,on=st[9]*Ve,Or=st[10]*Ve,cr=st[11]*Ve,di=0,Xn=Me;di<Xn.length;di+=1){for(var wn=[],Ti=[],ci=0,Ui=Xn[di];ci<Ui.length;ci+=1){var Fn=Ui[ci],Yi=Fn.x,ka=Fn.y,no=st[0]*Yi+st[4]*ka+st[12],Ya=st[1]*Yi+st[5]*ka+st[13],La=st[2]*Yi+st[6]*ka+st[14],io=st[3]*Yi+st[7]*ka+st[15],Go=La+Fr,Lo=io+Kr,Ts=no+Pn,Xo=Ya+on,Ms=La+Or,ho=io+cr,qo=new oe((no+Ht)/Lo,(Ya+or)/Lo);qo.z=Go/Lo,wn.push(qo);var Li=new oe(Ts/ho,Xo/ho);Li.z=Ms/ho,Ti.push(Li)}It.push(wn),Nt.push(Ti)}return[It,Nt]}(b,re,$,B);return function(Me,Xe,Ve){var st=1/0;Uo(Ve,Xe)&&(st=eo(Ve,Xe[0]));for(var It=0;It<Xe.length;It++)for(var Nt=Xe[It],Ht=Me[It],or=0;or<Nt.length-1;or++){var Fr=Nt[or],Kr=[Fr,Nt[or+1],Ht[or+1],Ht[or],Fr];Qu(Ve,Kr)&&(st=Math.min(st,eo(Ve,Kr)))}return st!==1/0&&st}(ke[0],ke[1],ue)},s}(Ws);function gu(a,s){return a.x*s.x+a.y*s.y}function eo(a,s){if(a.length===1){for(var c,m=0,_=s[m++];!c||_.equals(c);)if(!(c=s[m++]))return 1/0;for(;m<s.length;m++){var b=s[m],E=a[0],M=c.sub(_),O=b.sub(_),B=E.sub(_),G=gu(M,M),$=gu(M,O),re=gu(O,O),ue=gu(B,M),ke=gu(B,O),Me=G*re-$*$,Xe=(re*ue-$*ke)/Me,Ve=(G*ke-$*ue)/Me,st=_.z*(1-Xe-Ve)+c.z*Xe+b.z*Ve;if(isFinite(st))return st}return 1/0}for(var It=1/0,Nt=0,Ht=s;Nt<Ht.length;Nt+=1)It=Math.min(It,Ht[Nt].z);return It}var As=ra([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ed=ra([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,$h=il.VectorTileFeature.types,Dp=Math.cos(Math.PI/180*37.5),Ad=Math.pow(2,14)/.5,hs=function(a){var s=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){s.gradients[c.id]={}}),this.layoutVertexArray=new Qo,this.layoutVertexArray2=new Sc,this.indexArray=new Ku,this.programConfigurations=new Zn(a.layers,a.zoom),this.segments=new de,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};hs.prototype.populate=function(a,s,c){this.hasPattern=Al("line",this.layers,s);for(var m=this.layers[0].layout.get("line-sort-key"),_=[],b=0,E=a;b<E.length;b+=1){var M=E[b],O=M.feature,B=M.id,G=M.index,$=M.sourceLayerIndex,re=this.layers[0]._featureFilter.needGeometry,ue=Ia(O,re);if(this.layers[0]._featureFilter.filter(new pi(this.zoom),ue,c)){var ke=m?m.evaluate(ue,{},c):void 0,Me={id:B,properties:O.properties,type:O.type,sourceLayerIndex:$,index:G,geometry:re?ue.geometry:ya(O),patterns:{},sortKey:ke};_.push(Me)}}m&&_.sort(function(Fr,Kr){return Fr.sortKey-Kr.sortKey});for(var Xe=0,Ve=_;Xe<Ve.length;Xe+=1){var st=Ve[Xe],It=st.geometry,Nt=st.index,Ht=st.sourceLayerIndex;if(this.hasPattern){var or=Cl("line",this.layers,st,this.zoom,s);this.patternFeatures.push(or)}else this.addFeature(st,It,Nt,c,{});s.featureIndex.insert(a[Nt].feature,It,Nt,Ht,this.index)}},hs.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},hs.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var b=_[m];this.addFeature(b,b.geometry,b.index,s,c)}},hs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},hs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},hs.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Ed)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,As),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},hs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},hs.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},hs.prototype.addFeature=function(a,s,c,m,_){var b=this.layers[0].layout,E=b.get("line-join").evaluate(a,{}),M=b.get("line-cap"),O=b.get("line-miter-limit"),B=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var G=0,$=s;G<$.length;G+=1)this.addLine($[G],a,E,M,O,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},hs.prototype.addLine=function(a,s,c,m,_,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var E=0;E<a.length-1;E++)this.totalDistance+=a[E].dist(a[E+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=$h[s.type]==="Polygon",O=a.length;O>=2&&a[O-1].equals(a[O-2]);)O--;for(var B=0;B<O-1&&a[B].equals(a[B+1]);)B++;if(!(O<(M?3:2))){c==="bevel"&&(_=1.05);var G,$=this.overscaling<=16?122880/(512*this.overscaling):0,re=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray),ue=void 0,ke=void 0,Me=void 0,Xe=void 0;this.e1=this.e2=-1,M&&(Xe=a[B].sub(G=a[O-2])._unit()._perp());for(var Ve=B;Ve<O;Ve++)if(!(ke=Ve===O-1?M?a[B+1]:void 0:a[Ve+1])||!a[Ve].equals(ke)){Xe&&(Me=Xe),G&&(ue=G),G=a[Ve],Xe=ke?ke.sub(G)._unit()._perp():Me;var st=(Me=Me||Xe).add(Xe);st.x===0&&st.y===0||st._unit();var It=Me.x*Xe.x+Me.y*Xe.y,Nt=st.x*Xe.x+st.y*Xe.y,Ht=Nt!==0?1/Nt:1/0,or=2*Math.sqrt(2-2*Nt),Fr=Nt<Dp&&ue&&ke,Kr=Me.x*Xe.y-Me.y*Xe.x>0;if(Fr&&Ve>B){var Pn=G.dist(ue);if(Pn>2*$){var on=G.sub(G.sub(ue)._mult($/Pn)._round());this.updateDistance(ue,on),this.addCurrentVertex(on,Me,0,0,re),ue=on}}var Or=ue&&ke,cr=Or?c:M?"butt":m;if(Or&&cr==="round"&&(Ht<b?cr="miter":Ht<=2&&(cr="fakeround")),cr==="miter"&&Ht>_&&(cr="bevel"),cr==="bevel"&&(Ht>2&&(cr="flipbevel"),Ht<_&&(cr="miter")),ue&&this.updateDistance(ue,G),cr==="miter")st._mult(Ht),this.addCurrentVertex(G,st,0,0,re);else if(cr==="flipbevel"){if(Ht>100)st=Xe.mult(-1);else{var di=Ht*Me.add(Xe).mag()/Me.sub(Xe).mag();st._perp()._mult(di*(Kr?-1:1))}this.addCurrentVertex(G,st,0,0,re),this.addCurrentVertex(G,st.mult(-1),0,0,re)}else if(cr==="bevel"||cr==="fakeround"){var Xn=-Math.sqrt(Ht*Ht-1),wn=Kr?Xn:0,Ti=Kr?0:Xn;if(ue&&this.addCurrentVertex(G,Me,wn,Ti,re),cr==="fakeround")for(var ci=Math.round(180*or/Math.PI/20),Ui=1;Ui<ci;Ui++){var Fn=Ui/ci;if(Fn!==.5){var Yi=Fn-.5;Fn+=Fn*Yi*(Fn-1)*((1.0904+It*(It*(3.55645-1.43519*It)-3.2452))*Yi*Yi+(.848013+It*(.215638*It-1.06021)))}var ka=Xe.sub(Me)._mult(Fn)._add(Me)._unit()._mult(Kr?-1:1);this.addHalfVertex(G,ka.x,ka.y,!1,Kr,0,re)}ke&&this.addCurrentVertex(G,Xe,-wn,-Ti,re)}else if(cr==="butt")this.addCurrentVertex(G,st,0,0,re);else if(cr==="square"){var no=ue?1:-1;this.addCurrentVertex(G,st,no,no,re)}else cr==="round"&&(ue&&(this.addCurrentVertex(G,Me,0,0,re),this.addCurrentVertex(G,Me,1,1,re,!0)),ke&&(this.addCurrentVertex(G,Xe,-1,-1,re,!0),this.addCurrentVertex(G,Xe,0,0,re)));if(Fr&&Ve<O-1){var Ya=G.dist(ke);if(Ya>2*$){var La=G.add(ke.sub(G)._mult($/Ya)._round());this.updateDistance(G,La),this.addCurrentVertex(La,Xe,0,0,re),G=La}}}}},hs.prototype.addCurrentVertex=function(a,s,c,m,_,b){b===void 0&&(b=!1);var E=s.y*m-s.x,M=-s.y-s.x*m;this.addHalfVertex(a,s.x+s.y*c,s.y-s.x*c,b,!1,c,_),this.addHalfVertex(a,E,M,b,!0,-m,_),this.distance>Ad/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,s,c,m,_,b))},hs.prototype.addHalfVertex=function(a,s,c,m,_,b,E){var M=.5*(this.lineClips?this.scaledDistance*(Ad-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(m?1:0),(a.y<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(b===0?0:b<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var O=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),E.primitiveLength++),_?this.e2=O:this.e1=O},hs.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},hs.prototype.updateDistance=function(a,s){this.distance+=a.dist(s),this.updateScaledDistance()},cn("LineBucket",hs,{omit:["layers","patternFeatures"]});var lf=new bo({"line-cap":new An(he.layout_line["line-cap"]),"line-join":new dn(he.layout_line["line-join"]),"line-miter-limit":new An(he.layout_line["line-miter-limit"]),"line-round-limit":new An(he.layout_line["line-round-limit"]),"line-sort-key":new dn(he.layout_line["line-sort-key"])}),Fp={paint:new bo({"line-opacity":new dn(he.paint_line["line-opacity"]),"line-color":new dn(he.paint_line["line-color"]),"line-translate":new An(he.paint_line["line-translate"]),"line-translate-anchor":new An(he.paint_line["line-translate-anchor"]),"line-width":new dn(he.paint_line["line-width"]),"line-gap-width":new dn(he.paint_line["line-gap-width"]),"line-offset":new dn(he.paint_line["line-offset"]),"line-blur":new dn(he.paint_line["line-blur"]),"line-dasharray":new Io(he.paint_line["line-dasharray"]),"line-pattern":new Yu(he.paint_line["line-pattern"]),"line-gradient":new Wa(he.paint_line["line-gradient"])}),layout:lf},Bp=new(function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m){return m=new pi(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),a.prototype.possiblyEvaluate.call(this,c,m)},s.prototype.evaluate=function(c,m,_,b){return m=Yt({},m,{zoom:Math.floor(m.zoom)}),a.prototype.evaluate.call(this,c,m,_,b)},s}(dn))(Fp.paint.properties["line-width"].specification);Bp.useIntegerZoom=!0;var Bv=function(a){function s(c){a.call(this,c,Fp),this.gradientVersion=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Jo,this.gradientVersion=(this.gradientVersion+1)%ze)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m),this.paint._values["line-floorwidth"]=Bp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},s.prototype.createBucket=function(c){return new hs(c)},s.prototype.queryRadius=function(c){var m=c,_=zp(Ds("line-width",this,m),Ds("line-gap-width",this,m)),b=Ds("line-offset",this,m);return _/2+Math.abs(b)+Pa(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,O){var B=pu(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,O),G=O/2*zp(this.paint.get("line-width").evaluate(m,_),this.paint.get("line-gap-width").evaluate(m,_)),$=this.paint.get("line-offset").evaluate(m,_);return $&&(b=function(re,ue){for(var ke=[],Me=new oe(0,0),Xe=0;Xe<re.length;Xe++){for(var Ve=re[Xe],st=[],It=0;It<Ve.length;It++){var Nt=Ve[It],Ht=Ve[It+1],or=It===0?Me:Nt.sub(Ve[It-1])._unit()._perp(),Fr=It===Ve.length-1?Me:Ht.sub(Nt)._unit()._perp(),Kr=or._add(Fr)._unit();Kr._mult(1/(Kr.x*Fr.x+Kr.y*Fr.y)),st.push(Kr._mult(ue)._add(Nt))}ke.push(st)}return ke}(b,$*O)),function(re,ue,ke){for(var Me=0;Me<ue.length;Me++){var Xe=ue[Me];if(re.length>=3){for(var Ve=0;Ve<Xe.length;Ve++)if(hu(re,Xe[Ve]))return!0}if(xs(re,Xe,ke))return!0}return!1}(B,b,G)},s.prototype.isTileClipped=function(){return!0},s}(Ws);function zp(a,s){return s>0?s+2*a:a}var zv=ra([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),bh=ra([{name:"a_projected_pos",components:3,type:"Float32"}],4),Yh=(ra([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),ra([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Xh=(ra([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),ra([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Cd=ra([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Td(a,s,c){return a.sections.forEach(function(m){m.text=function(_,b,E){var M=b.layout.get("text-transform").evaluate(E,{});return M==="uppercase"?_=_.toLocaleUpperCase():M==="lowercase"&&(_=_.toLocaleLowerCase()),Rs.applyArabicShaping&&(_=Rs.applyArabicShaping(_)),_}(m.text,s,c)}),a}ra([{name:"triangle",components:3,type:"Uint16"}]),ra([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ra([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ra([{type:"Float32",name:"offsetX"}]),ra([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var cf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},qh=function(a,s,c,m,_){var b,E,M=8*_-m-1,O=(1<<M)-1,B=O>>1,G=-7,$=c?_-1:0,re=c?-1:1,ue=a[s+$];for($+=re,b=ue&(1<<-G)-1,ue>>=-G,G+=M;G>0;b=256*b+a[s+$],$+=re,G-=8);for(E=b&(1<<-G)-1,b>>=-G,G+=m;G>0;E=256*E+a[s+$],$+=re,G-=8);if(b===0)b=1-B;else{if(b===O)return E?NaN:1/0*(ue?-1:1);E+=Math.pow(2,m),b-=B}return(ue?-1:1)*E*Math.pow(2,b-m)},z=function(a,s,c,m,_,b){var E,M,O,B=8*b-_-1,G=(1<<B)-1,$=G>>1,re=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,ue=m?0:b-1,ke=m?1:-1,Me=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(M=isNaN(s)?1:0,E=G):(E=Math.floor(Math.log(s)/Math.LN2),s*(O=Math.pow(2,-E))<1&&(E--,O*=2),(s+=E+$>=1?re/O:re*Math.pow(2,1-$))*O>=2&&(E++,O/=2),E+$>=G?(M=0,E=G):E+$>=1?(M=(s*O-1)*Math.pow(2,_),E+=$):(M=s*Math.pow(2,$-1)*Math.pow(2,_),E=0));_>=8;a[c+ue]=255&M,ue+=ke,M/=256,_-=8);for(E=E<<_|M,B+=_;B>0;a[c+ue]=255&E,ue+=ke,E/=256,B-=8);a[c+ue-ke]|=128*Me},xe=Ce;function Ce(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Ce.Varint=0,Ce.Fixed64=1,Ce.Bytes=2,Ce.Fixed32=5;var Ft=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function rr(a){return a.type===Ce.Bytes?a.readVarint()+a.pos:a.pos+1}function kt(a,s,c){return c?4294967296*s+(a>>>0):4294967296*(s>>>0)+(a>>>0)}function Wt(a,s,c){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));c.realloc(m);for(var _=c.pos-1;_>=a;_--)c.buf[_+m]=c.buf[_]}function wr(a,s){for(var c=0;c<a.length;c++)s.writeVarint(a[c])}function Ir(a,s){for(var c=0;c<a.length;c++)s.writeSVarint(a[c])}function Rr(a,s){for(var c=0;c<a.length;c++)s.writeFloat(a[c])}function Cr(a,s){for(var c=0;c<a.length;c++)s.writeDouble(a[c])}function zr(a,s){for(var c=0;c<a.length;c++)s.writeBoolean(a[c])}function $r(a,s){for(var c=0;c<a.length;c++)s.writeFixed32(a[c])}function Ar(a,s){for(var c=0;c<a.length;c++)s.writeSFixed32(a[c])}function Ur(a,s){for(var c=0;c<a.length;c++)s.writeFixed64(a[c])}function gt(a,s){for(var c=0;c<a.length;c++)s.writeSFixed64(a[c])}function Vt(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+16777216*a[s+3]}function Tr(a,s,c){a[c]=s,a[c+1]=s>>>8,a[c+2]=s>>>16,a[c+3]=s>>>24}function Qr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+(a[s+3]<<24)}function vr(a,s,c){a===1&&c.readMessage(an,s)}function an(a,s,c){if(a===3){var m=c.readMessage(gr,{}),_=m.width,b=m.height,E=m.left,M=m.top,O=m.advance;s.push({id:m.id,bitmap:new du({width:_+6,height:b+6},m.bitmap),metrics:{width:_,height:b,left:E,top:M,advance:O}})}}function gr(a,s,c){a===1?s.id=c.readVarint():a===2?s.bitmap=c.readBytes():a===3?s.width=c.readVarint():a===4?s.height=c.readVarint():a===5?s.left=c.readSVarint():a===6?s.top=c.readSVarint():a===7&&(s.advance=c.readVarint())}function Gr(a){for(var s=0,c=0,m=0,_=a;m<_.length;m+=1){var b=_[m];s+=b.w*b.h,c=Math.max(c,b.w)}a.sort(function(Me,Xe){return Xe.h-Me.h});for(var E=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),c),h:1/0}],M=0,O=0,B=0,G=a;B<G.length;B+=1)for(var $=G[B],re=E.length-1;re>=0;re--){var ue=E[re];if(!($.w>ue.w||$.h>ue.h)){if($.x=ue.x,$.y=ue.y,O=Math.max(O,$.y+$.h),M=Math.max(M,$.x+$.w),$.w===ue.w&&$.h===ue.h){var ke=E.pop();re<E.length&&(E[re]=ke)}else $.h===ue.h?(ue.x+=$.w,ue.w-=$.w):$.w===ue.w?(ue.y+=$.h,ue.h-=$.h):(E.push({x:ue.x+$.w,y:ue.y,w:ue.w-$.w,h:$.h}),ue.y+=$.h,ue.h-=$.h);break}}return{w:M,h:O,fill:s/(M*O)||0}}Ce.prototype={destroy:function(){this.buf=null},readFields:function(a,s,c){for(c=c||this.length;this.pos<c;){var m=this.readVarint(),_=m>>3,b=this.pos;this.type=7&m,a(_,s,this),this.pos===b&&this.skip(m)}return s},readMessage:function(a,s){return this.readFields(a,s,this.readVarint()+this.pos)},readFixed32:function(){var a=Vt(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Qr(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Vt(this.buf,this.pos)+4294967296*Vt(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=Vt(this.buf,this.pos)+4294967296*Qr(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=qh(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=qh(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var s,c,m=this.buf;return s=127&(c=m[this.pos++]),c<128?s:(s|=(127&(c=m[this.pos++]))<<7,c<128?s:(s|=(127&(c=m[this.pos++]))<<14,c<128?s:(s|=(127&(c=m[this.pos++]))<<21,c<128?s:function(_,b,E){var M,O,B=E.buf;if(M=(112&(O=B[E.pos++]))>>4,O<128||(M|=(127&(O=B[E.pos++]))<<3,O<128)||(M|=(127&(O=B[E.pos++]))<<10,O<128)||(M|=(127&(O=B[E.pos++]))<<17,O<128)||(M|=(127&(O=B[E.pos++]))<<24,O<128)||(M|=(1&(O=B[E.pos++]))<<31,O<128))return kt(_,M,b);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(c=m[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,s=this.pos;return this.pos=a,a-s>=12&&Ft?function(c,m,_){return Ft.decode(c.subarray(m,_))}(this.buf,s,a):function(c,m,_){for(var b="",E=m;E<_;){var M,O,B,G=c[E],$=null,re=G>239?4:G>223?3:G>191?2:1;if(E+re>_)break;re===1?G<128&&($=G):re===2?(192&(M=c[E+1]))==128&&($=(31&G)<<6|63&M)<=127&&($=null):re===3?(O=c[E+2],(192&(M=c[E+1]))==128&&(192&O)==128&&(($=(15&G)<<12|(63&M)<<6|63&O)<=2047||$>=55296&&$<=57343)&&($=null)):re===4&&(O=c[E+2],B=c[E+3],(192&(M=c[E+1]))==128&&(192&O)==128&&(192&B)==128&&(($=(15&G)<<18|(63&M)<<12|(63&O)<<6|63&B)<=65535||$>=1114112)&&($=null)),$===null?($=65533,re=1):$>65535&&($-=65536,b+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),b+=String.fromCharCode($),E+=re}return b}(this.buf,s,a)},readBytes:function(){var a=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,a);return this.pos=a,s},readPackedVarint:function(a,s){if(this.type!==Ce.Bytes)return a.push(this.readVarint(s));var c=rr(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(s));return a},readPackedSVarint:function(a){if(this.type!==Ce.Bytes)return a.push(this.readSVarint());var s=rr(this);for(a=a||[];this.pos<s;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Ce.Bytes)return a.push(this.readBoolean());var s=rr(this);for(a=a||[];this.pos<s;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Ce.Bytes)return a.push(this.readFloat());var s=rr(this);for(a=a||[];this.pos<s;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Ce.Bytes)return a.push(this.readDouble());var s=rr(this);for(a=a||[];this.pos<s;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Ce.Bytes)return a.push(this.readFixed32());var s=rr(this);for(a=a||[];this.pos<s;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Ce.Bytes)return a.push(this.readSFixed32());var s=rr(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Ce.Bytes)return a.push(this.readFixed64());var s=rr(this);for(a=a||[];this.pos<s;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Ce.Bytes)return a.push(this.readSFixed64());var s=rr(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed64());return a},skip:function(a){var s=7&a;if(s===Ce.Varint)for(;this.buf[this.pos++]>127;);else if(s===Ce.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Ce.Fixed32)this.pos+=4;else{if(s!==Ce.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(a,s){this.writeVarint(a<<3|s)},realloc:function(a){for(var s=this.length||16;s<this.pos+a;)s*=2;if(s!==this.length){var c=new Uint8Array(s);c.set(this.buf),this.buf=c,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Tr(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Tr(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Tr(this.buf,-1&a,this.pos),Tr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Tr(this.buf,-1&a,this.pos),Tr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(s,c){var m,_;if(s>=0?(m=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(b,E,M){M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,M.buf[M.pos]=127&(b>>>=7)}(m,0,c),function(b,E){var M=(7&b)<<4;E.buf[E.pos++]|=M|((b>>>=3)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b)))))}(_,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var s=this.pos;this.pos=function(m,_,b){for(var E,M,O=0;O<_.length;O++){if((E=_.charCodeAt(O))>55295&&E<57344){if(!M){E>56319||O+1===_.length?(m[b++]=239,m[b++]=191,m[b++]=189):M=E;continue}if(E<56320){m[b++]=239,m[b++]=191,m[b++]=189,M=E;continue}E=M-55296<<10|E-56320|65536,M=null}else M&&(m[b++]=239,m[b++]=191,m[b++]=189,M=null);E<128?m[b++]=E:(E<2048?m[b++]=E>>6|192:(E<65536?m[b++]=E>>12|224:(m[b++]=E>>18|240,m[b++]=E>>12&63|128),m[b++]=E>>6&63|128),m[b++]=63&E|128)}return b}(this.buf,a,this.pos);var c=this.pos-s;c>=128&&Wt(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),z(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),z(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var s=a.length;this.writeVarint(s),this.realloc(s);for(var c=0;c<s;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,s){this.pos++;var c=this.pos;a(s,this);var m=this.pos-c;m>=128&&Wt(c,m,this),this.pos=c-1,this.writeVarint(m),this.pos+=m},writeMessage:function(a,s,c){this.writeTag(a,Ce.Bytes),this.writeRawMessage(s,c)},writePackedVarint:function(a,s){s.length&&this.writeMessage(a,wr,s)},writePackedSVarint:function(a,s){s.length&&this.writeMessage(a,Ir,s)},writePackedBoolean:function(a,s){s.length&&this.writeMessage(a,zr,s)},writePackedFloat:function(a,s){s.length&&this.writeMessage(a,Rr,s)},writePackedDouble:function(a,s){s.length&&this.writeMessage(a,Cr,s)},writePackedFixed32:function(a,s){s.length&&this.writeMessage(a,$r,s)},writePackedSFixed32:function(a,s){s.length&&this.writeMessage(a,Ar,s)},writePackedFixed64:function(a,s){s.length&&this.writeMessage(a,Ur,s)},writePackedSFixed64:function(a,s){s.length&&this.writeMessage(a,gt,s)},writeBytesField:function(a,s){this.writeTag(a,Ce.Bytes),this.writeBytes(s)},writeFixed32Field:function(a,s){this.writeTag(a,Ce.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(a,s){this.writeTag(a,Ce.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(a,s){this.writeTag(a,Ce.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(a,s){this.writeTag(a,Ce.Fixed64),this.writeSFixed64(s)},writeVarintField:function(a,s){this.writeTag(a,Ce.Varint),this.writeVarint(s)},writeSVarintField:function(a,s){this.writeTag(a,Ce.Varint),this.writeSVarint(s)},writeStringField:function(a,s){this.writeTag(a,Ce.Bytes),this.writeString(s)},writeFloatField:function(a,s){this.writeTag(a,Ce.Fixed32),this.writeFloat(s)},writeDoubleField:function(a,s){this.writeTag(a,Ce.Fixed64),this.writeDouble(s)},writeBooleanField:function(a,s){this.writeVarintField(a,Boolean(s))}};var at=function(a,s){var c=s.pixelRatio,m=s.version,_=s.stretchX,b=s.stretchY,E=s.content;this.paddedRect=a,this.pixelRatio=c,this.stretchX=_,this.stretchY=b,this.content=E,this.version=m},Nr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Nr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Nr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Nr.tlbr.get=function(){return this.tl.concat(this.br)},Nr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(at.prototype,Nr);var qe=function(a,s){var c={},m={};this.haveRenderCallbacks=[];var _=[];this.addImages(a,c,_),this.addImages(s,m,_);var b=Gr(_),E=new za({width:b.w||1,height:b.h||1});for(var M in a){var O=a[M],B=c[M].paddedRect;za.copy(O.data,E,{x:0,y:0},{x:B.x+1,y:B.y+1},O.data)}for(var G in s){var $=s[G],re=m[G].paddedRect,ue=re.x+1,ke=re.y+1,Me=$.data.width,Xe=$.data.height;za.copy($.data,E,{x:0,y:0},{x:ue,y:ke},$.data),za.copy($.data,E,{x:0,y:Xe-1},{x:ue,y:ke-1},{width:Me,height:1}),za.copy($.data,E,{x:0,y:0},{x:ue,y:ke+Xe},{width:Me,height:1}),za.copy($.data,E,{x:Me-1,y:0},{x:ue-1,y:ke},{width:1,height:Xe}),za.copy($.data,E,{x:0,y:0},{x:ue+Me,y:ke},{width:1,height:Xe})}this.image=E,this.iconPositions=c,this.patternPositions=m};qe.prototype.addImages=function(a,s,c){for(var m in a){var _=a[m],b={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(b),s[m]=new at(b,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},qe.prototype.patchUpdatedImages=function(a,s){for(var c in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[c],a.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],a.getImage(c),s)},qe.prototype.patchUpdatedImage=function(a,s,c){if(a&&s&&a.version!==s.version){a.version=s.version;var m=a.tl;c.update(s.data,void 0,{x:m[0],y:m[1]})}},cn("ImagePosition",at),cn("ImageAtlas",qe);var Rn={horizontal:1,vertical:2,horizontalOnly:3},Vr=function(){this.scale=1,this.fontStack="",this.imageName=null};Vr.forText=function(a,s){var c=new Vr;return c.scale=a||1,c.fontStack=s,c},Vr.forImage=function(a){var s=new Vr;return s.imageName=a,s};var pr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function ur(a,s,c,m,_,b,E,M,O,B,G,$,re,ue,ke,Me){var Xe,Ve=pr.fromFeature(a,_);$===Rn.vertical&&Ve.verticalizePunctuation();var st=Rs.processBidirectionalText,It=Rs.processStyledBidirectionalText;if(st&&Ve.sections.length===1){Xe=[];for(var Nt=0,Ht=st(Ve.toString(),Di(Ve,B,b,s,m,ue,ke));Nt<Ht.length;Nt+=1){var or=Ht[Nt],Fr=new pr;Fr.text=or,Fr.sections=Ve.sections;for(var Kr=0;Kr<or.length;Kr++)Fr.sectionIndex.push(0);Xe.push(Fr)}}else if(It){Xe=[];for(var Pn=0,on=It(Ve.text,Ve.sectionIndex,Di(Ve,B,b,s,m,ue,ke));Pn<on.length;Pn+=1){var Or=on[Pn],cr=new pr;cr.text=Or[0],cr.sectionIndex=Or[1],cr.sections=Ve.sections,Xe.push(cr)}}else Xe=function(wn,Ti){for(var ci=[],Ui=wn.text,Fn=0,Yi=0,ka=Ti;Yi<ka.length;Yi+=1){var no=ka[Yi];ci.push(wn.substring(Fn,no)),Fn=no}return Fn<Ui.length&&ci.push(wn.substring(Fn,Ui.length)),ci}(Ve,Di(Ve,B,b,s,m,ue,ke));var di=[],Xn={positionedLines:di,text:Ve.toString(),top:G[1],bottom:G[1],left:G[0],right:G[0],writingMode:$,iconsInText:!1,verticalizable:!1};return function(wn,Ti,ci,Ui,Fn,Yi,ka,no,Ya,La,io,Go){for(var Lo=0,Ts=-17,Xo=0,Ms=0,ho=no==="right"?1:no==="left"?0:.5,qo=0,Li=0,ca=Fn;Li<ca.length;Li+=1){var na=ca[Li];na.trim();var ji=na.getMaxScale(),Bs=24*(ji-1),ps={positionedGlyphs:[],lineOffset:0};wn.positionedLines[qo]=ps;var Ca=ps.positionedGlyphs,Xa=0;if(na.length()){for(var ds=0;ds<na.length();ds++){var Xi=na.getSection(ds),Fc=na.getSectionIndex(ds),ku=na.getCharCode(ds),Bc=0,po=null,zc=null,Ml=null,Qh=24,Eh=!(Ya===Rn.horizontal||!io&&!_c(ku)||io&&(jn[ku]||(Qs=ku,Pr.Arabic(Qs)||Pr["Arabic Supplement"](Qs)||Pr["Arabic Extended-A"](Qs)||Pr["Arabic Presentation Forms-A"](Qs)||Pr["Arabic Presentation Forms-B"](Qs))));if(Xi.imageName){var ep=Ui[Xi.imageName];if(!ep)continue;Ml=Xi.imageName,wn.iconsInText=wn.iconsInText||!0,zc=ep.paddedRect;var pf=ep.displaySize;Xi.scale=24*Xi.scale/Go,Bc=Bs+(24-pf[1]*Xi.scale),Qh=(po={width:pf[0],height:pf[1],left:1,top:-3,advance:Eh?pf[1]:pf[0]}).advance;var tp=Eh?pf[0]*Xi.scale-24*ji:pf[1]*Xi.scale-24*ji;tp>0&&tp>Xa&&(Xa=tp)}else{var Ah=ci[Xi.fontStack],Ch=Ah&&Ah[ku];if(Ch&&Ch.rect)zc=Ch.rect,po=Ch.metrics;else{var Th=Ti[Xi.fontStack],rp=Th&&Th[ku];if(!rp)continue;po=rp.metrics}Bc=24*(ji-Xi.scale)}Eh?(wn.verticalizable=!0,Ca.push({glyph:ku,imageName:Ml,x:Lo,y:Ts+Bc,vertical:Eh,scale:Xi.scale,fontStack:Xi.fontStack,sectionIndex:Fc,metrics:po,rect:zc}),Lo+=Qh*Xi.scale+La):(Ca.push({glyph:ku,imageName:Ml,x:Lo,y:Ts+Bc,vertical:Eh,scale:Xi.scale,fontStack:Xi.fontStack,sectionIndex:Fc,metrics:po,rect:zc}),Lo+=po.advance*Xi.scale+La)}Ca.length!==0&&(Xo=Math.max(Lo-La,Xo),Eo(Ca,0,Ca.length-1,ho,Xa)),Lo=0;var Nc=Yi*ji+Xa;ps.lineOffset=Math.max(Xa,Bs),Ts+=Nc,Ms=Math.max(Nc,Ms),++qo}else Ts+=Yi,++qo}var Qs,Mh=Ts- -17,Hf=Na(ka),Zc=Hf.horizontalAlign,df=Hf.verticalAlign;(function(np,jp,ip,Ih,ap,op,sp,up,Gp){var ac,vs=(jp-ip)*ap;ac=op!==sp?-up*Ih- -17:(-Ih*Gp+.5)*sp;for(var Wf=0,Ph=np;Wf<Ph.length;Wf+=1)for(var vf=0,$f=Ph[Wf].positionedGlyphs;vf<$f.length;vf+=1){var Yf=$f[vf];Yf.x+=vs,Yf.y+=ac}})(wn.positionedLines,ho,Zc,df,Xo,Ms,Yi,Mh,Fn.length),wn.top+=-df*Mh,wn.bottom=wn.top+Mh,wn.left+=-Zc*Xo,wn.right=wn.left+Xo}(Xn,s,c,m,Xe,E,M,O,$,B,re,Me),!function(wn){for(var Ti=0,ci=wn;Ti<ci.length;Ti+=1)if(ci[Ti].positionedGlyphs.length!==0)return!1;return!0}(di)&&Xn}pr.fromFeature=function(a,s){for(var c=new pr,m=0;m<a.sections.length;m++){var _=a.sections[m];_.image?c.addImageSection(_):c.addTextSection(_,s)}return c},pr.prototype.length=function(){return this.text.length},pr.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},pr.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},pr.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},pr.prototype.verticalizePunctuation=function(){this.text=function(a){for(var s="",c=0;c<a.length;c++){var m=a.charCodeAt(c+1)||null,_=a.charCodeAt(c-1)||null;s+=m&&lu(m)&&!cf[a[c+1]]||_&&lu(_)&&!cf[a[c-1]]||!cf[a[c]]?a[c]:cf[a[c]]}return s}(this.text)},pr.prototype.trim=function(){for(var a=0,s=0;s<this.text.length&&jn[this.text.charCodeAt(s)];s++)a++;for(var c=this.text.length,m=this.text.length-1;m>=0&&m>=a&&jn[this.text.charCodeAt(m)];m--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)},pr.prototype.substring=function(a,s){var c=new pr;return c.text=this.text.substring(a,s),c.sectionIndex=this.sectionIndex.slice(a,s),c.sections=this.sections,c},pr.prototype.toString=function(){return this.text},pr.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(s,c){return Math.max(s,a.sections[c].scale)},0)},pr.prototype.addTextSection=function(a,s){this.text+=a.text,this.sections.push(Vr.forText(a.scale,a.fontStack||s));for(var c=this.sections.length-1,m=0;m<a.text.length;++m)this.sectionIndex.push(c)},pr.prototype.addImageSection=function(a){var s=a.image?a.image.name:"";if(s.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Vr.forImage(s)),this.sectionIndex.push(this.sections.length-1)):lt("Reached maximum number of images 6401")}else lt("Can't add FormattedSection with an empty image.")},pr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var jn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},On={};function _n(a,s,c,m,_,b){if(s.imageName){var E=m[s.imageName];return E?E.displaySize[0]*s.scale*24/b+_:0}var M=c[s.fontStack],O=M&&M[a];return O?O.metrics.advance*s.scale+_:0}function _i(a,s,c,m){var _=Math.pow(a-s,2);return m?a<s?_/2:2*_:_+Math.abs(c)*c}function ei(a,s,c){var m=0;return a===10&&(m-=1e4),c&&(m+=150),a!==40&&a!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function li(a,s,c,m,_,b){for(var E=null,M=_i(s,c,_,b),O=0,B=m;O<B.length;O+=1){var G=B[O],$=_i(s-G.x,c,_,b)+G.badness;$<=M&&(E=G,M=$)}return{index:a,x:s,priorBreak:E,badness:M}}function Di(a,s,c,m,_,b,E){if(b!=="point")return[];if(!a)return[];for(var M,O=[],B=function(Xe,Ve,st,It,Nt,Ht){for(var or=0,Fr=0;Fr<Xe.length();Fr++){var Kr=Xe.getSection(Fr);or+=_n(Xe.getCharCode(Fr),Kr,It,Nt,Ve,Ht)}return or/Math.max(1,Math.ceil(or/st))}(a,s,c,m,_,E),G=a.text.indexOf("\u200B")>=0,$=0,re=0;re<a.length();re++){var ue=a.getSection(re),ke=a.getCharCode(re);if(jn[ke]||($+=_n(ke,ue,m,_,s,E)),re<a.length()-1){var Me=!((M=ke)<11904||!(Pr["Bopomofo Extended"](M)||Pr.Bopomofo(M)||Pr["CJK Compatibility Forms"](M)||Pr["CJK Compatibility Ideographs"](M)||Pr["CJK Compatibility"](M)||Pr["CJK Radicals Supplement"](M)||Pr["CJK Strokes"](M)||Pr["CJK Symbols and Punctuation"](M)||Pr["CJK Unified Ideographs Extension A"](M)||Pr["CJK Unified Ideographs"](M)||Pr["Enclosed CJK Letters and Months"](M)||Pr["Halfwidth and Fullwidth Forms"](M)||Pr.Hiragana(M)||Pr["Ideographic Description Characters"](M)||Pr["Kangxi Radicals"](M)||Pr["Katakana Phonetic Extensions"](M)||Pr.Katakana(M)||Pr["Vertical Forms"](M)||Pr["Yi Radicals"](M)||Pr["Yi Syllables"](M)));(On[ke]||Me||ue.imageName)&&O.push(li(re+1,$,B,O,ei(ke,a.getCharCode(re+1),Me&&G),!1))}}return function Xe(Ve){return Ve?Xe(Ve.priorBreak).concat(Ve.index):[]}(li(a.length(),$,B,O,0,!0))}function Na(a){var s=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:s,verticalAlign:c}}function Eo(a,s,c,m,_){if(m||_)for(var b=a[c],E=(a[c].x+b.metrics.advance*b.scale)*m,M=s;M<=c;M++)a[M].x-=E,a[M].y+=_}function wi(a,s,c,m,_,b){var E,M=a.image;if(M.content){var O=M.content,B=M.pixelRatio||1;E=[O[0]/B,O[1]/B,M.displaySize[0]-O[2]/B,M.displaySize[1]-O[3]/B]}var G,$,re,ue,ke=s.left*b,Me=s.right*b;c==="width"||c==="both"?(ue=_[0]+ke-m[3],$=_[0]+Me+m[1]):$=(ue=_[0]+(ke+Me-M.displaySize[0])/2)+M.displaySize[0];var Xe=s.top*b,Ve=s.bottom*b;return c==="height"||c==="both"?(G=_[1]+Xe-m[0],re=_[1]+Ve+m[2]):re=(G=_[1]+(Xe+Ve-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:G,right:$,bottom:re,left:ue,collisionPadding:E}}On[10]=!0,On[32]=!0,On[38]=!0,On[40]=!0,On[41]=!0,On[43]=!0,On[45]=!0,On[47]=!0,On[173]=!0,On[183]=!0,On[8203]=!0,On[8208]=!0,On[8211]=!0,On[8231]=!0;var Ea=function(a){function s(c,m,_,b){a.call(this,c,m),this.angle=_,b!==void 0&&(this.segment=b)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(oe);function la(a,s){var c=s.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new pi(a+1))};if(c.kind==="source")return{kind:"source"};for(var m=c.zoomStops,_=c.interpolationType,b=0;b<m.length&&m[b]<=a;)b++;for(var E=b=Math.max(0,b-1);E<m.length&&m[E]<a+1;)E++;E=Math.min(m.length-1,E);var M=m[b],O=m[E];return c.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:O,interpolationType:_}:{kind:"camera",minZoom:M,maxZoom:O,minSize:c.evaluate(new pi(M)),maxSize:c.evaluate(new pi(O)),interpolationType:_}}function to(a,s,c){var m=s.uSize,_=c.lowerSize;return a.kind==="source"?_/128:a.kind==="composite"?wa(_/128,c.upperSize/128,s.uSizeT):m}function fo(a,s){var c=0,m=0;if(a.kind==="constant")m=a.layoutSize;else if(a.kind!=="source"){var _=a.interpolationType,b=_?Ct(ma.interpolationFactor(_,s,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?m=wa(a.minSize,a.maxSize,b):c=b}return{uSizeT:c,uSize:m}}cn("Anchor",Ea);var Ao=Object.freeze({__proto__:null,getSizeData:la,evaluateSizeForFeature:to,evaluateSizeForZoom:fo,SIZE_PACK_FACTOR:128});function ko(a,s,c,m,_){if(s.segment===void 0)return!0;for(var b=s,E=s.segment+1,M=0;M>-c/2;){if(--E<0)return!1;M-=a[E].dist(b),b=a[E]}M+=a[E].dist(a[E+1]),E++;for(var O=[],B=0;M<c/2;){var G=a[E],$=a[E+1];if(!$)return!1;var re=a[E-1].angleTo(G)-G.angleTo($);for(re=Math.abs((re+3*Math.PI)%(2*Math.PI)-Math.PI),O.push({distance:M,angleDelta:re}),B+=re;M-O[0].distance>m;)B-=O.shift().angleDelta;if(B>_)return!1;E++,M+=G.dist($)}return!0}function Vo(a){for(var s=0,c=0;c<a.length-1;c++)s+=a[c].dist(a[c+1]);return s}function $a(a,s,c){return a?.6*s*c:0}function ui(a,s){return Math.max(a?a.right-a.left:0,s?s.right-s.left:0)}function Yo(a,s,c,m,_,b){for(var E=$a(c,_,b),M=ui(c,m)*b,O=0,B=Vo(a)/2,G=0;G<a.length-1;G++){var $=a[G],re=a[G+1],ue=$.dist(re);if(O+ue>B){var ke=(B-O)/ue,Me=wa($.x,re.x,ke),Xe=wa($.y,re.y,ke),Ve=new Ea(Me,Xe,re.angleTo($),G);return Ve._round(),!E||ko(a,Ve,M,E,s)?Ve:void 0}O+=ue}}function Wi(a,s,c,m,_,b,E,M,O){var B=$a(m,b,E),G=ui(m,_),$=G*E,re=a[0].x===0||a[0].x===O||a[0].y===0||a[0].y===O;return s-$<s/4&&(s=$+s/4),function ue(ke,Me,Xe,Ve,st,It,Nt,Ht,or){for(var Fr=It/2,Kr=Vo(ke),Pn=0,on=Me-Xe,Or=[],cr=0;cr<ke.length-1;cr++){for(var di=ke[cr],Xn=ke[cr+1],wn=di.dist(Xn),Ti=Xn.angleTo(di);on+Xe<Pn+wn;){var ci=((on+=Xe)-Pn)/wn,Ui=wa(di.x,Xn.x,ci),Fn=wa(di.y,Xn.y,ci);if(Ui>=0&&Ui<or&&Fn>=0&&Fn<or&&on-Fr>=0&&on+Fr<=Kr){var Yi=new Ea(Ui,Fn,Ti,cr);Yi._round(),Ve&&!ko(ke,Yi,It,Ve,st)||Or.push(Yi)}}Pn+=wn}return Ht||Or.length||Nt||(Or=ue(ke,Pn/2,Xe,Ve,st,It,Nt,!0,or)),Or}(a,re?s/2*M%s:(G/2+2*b)*E*M%s,s,B,c,$,re,!1,O)}function Un(a,s,c,m,_){for(var b=[],E=0;E<a.length;E++)for(var M=a[E],O=void 0,B=0;B<M.length-1;B++){var G=M[B],$=M[B+1];G.x<s&&$.x<s||(G.x<s?G=new oe(s,G.y+(s-G.x)/($.x-G.x)*($.y-G.y))._round():$.x<s&&($=new oe(s,G.y+(s-G.x)/($.x-G.x)*($.y-G.y))._round()),G.y<c&&$.y<c||(G.y<c?G=new oe(G.x+(c-G.y)/($.y-G.y)*($.x-G.x),c)._round():$.y<c&&($=new oe(G.x+(c-G.y)/($.y-G.y)*($.x-G.x),c)._round()),G.x>=m&&$.x>=m||(G.x>=m?G=new oe(m,G.y+(m-G.x)/($.x-G.x)*($.y-G.y))._round():$.x>=m&&($=new oe(m,G.y+(m-G.x)/($.x-G.x)*($.y-G.y))._round()),G.y>=_&&$.y>=_||(G.y>=_?G=new oe(G.x+(_-G.y)/($.y-G.y)*($.x-G.x),_)._round():$.y>=_&&($=new oe(G.x+(_-G.y)/($.y-G.y)*($.x-G.x),_)._round()),O&&G.equals(O[O.length-1])||b.push(O=[G]),O.push($)))))}return b}function xi(a,s,c,m){var _=[],b=a.image,E=b.pixelRatio,M=b.paddedRect.w-2,O=b.paddedRect.h-2,B=a.right-a.left,G=a.bottom-a.top,$=b.stretchX||[[0,M]],re=b.stretchY||[[0,O]],ue=function(Ui,Fn){return Ui+Fn[1]-Fn[0]},ke=$.reduce(ue,0),Me=re.reduce(ue,0),Xe=M-ke,Ve=O-Me,st=0,It=ke,Nt=0,Ht=Me,or=0,Fr=Xe,Kr=0,Pn=Ve;if(b.content&&m){var on=b.content;st=Pi($,0,on[0]),Nt=Pi(re,0,on[1]),It=Pi($,on[0],on[2]),Ht=Pi(re,on[1],on[3]),or=on[0]-st,Kr=on[1]-Nt,Fr=on[2]-on[0]-It,Pn=on[3]-on[1]-Ht}var Or=function(Ui,Fn,Yi,ka){var no=Ks(Ui.stretch-st,It,B,a.left),Ya=Pu(Ui.fixed-or,Fr,Ui.stretch,ke),La=Ks(Fn.stretch-Nt,Ht,G,a.top),io=Pu(Fn.fixed-Kr,Pn,Fn.stretch,Me),Go=Ks(Yi.stretch-st,It,B,a.left),Lo=Pu(Yi.fixed-or,Fr,Yi.stretch,ke),Ts=Ks(ka.stretch-Nt,Ht,G,a.top),Xo=Pu(ka.fixed-Kr,Pn,ka.stretch,Me),Ms=new oe(no,La),ho=new oe(Go,La),qo=new oe(Go,Ts),Li=new oe(no,Ts),ca=new oe(Ya/E,io/E),na=new oe(Lo/E,Xo/E),ji=s*Math.PI/180;if(ji){var Bs=Math.sin(ji),ps=Math.cos(ji),Ca=[ps,-Bs,Bs,ps];Ms._matMult(Ca),ho._matMult(Ca),Li._matMult(Ca),qo._matMult(Ca)}var Xa=Ui.stretch+Ui.fixed,ds=Fn.stretch+Fn.fixed;return{tl:Ms,tr:ho,bl:Li,br:qo,tex:{x:b.paddedRect.x+1+Xa,y:b.paddedRect.y+1+ds,w:Yi.stretch+Yi.fixed-Xa,h:ka.stretch+ka.fixed-ds},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ca,pixelOffsetBR:na,minFontScaleX:Fr/E/B,minFontScaleY:Pn/E/G,isSDF:c}};if(m&&(b.stretchX||b.stretchY))for(var cr=ro($,Xe,ke),di=ro(re,Ve,Me),Xn=0;Xn<cr.length-1;Xn++)for(var wn=cr[Xn],Ti=cr[Xn+1],ci=0;ci<di.length-1;ci++)_.push(Or(wn,di[ci],Ti,di[ci+1]));else _.push(Or({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:O+1}));return _}function Pi(a,s,c){for(var m=0,_=0,b=a;_<b.length;_+=1){var E=b[_];m+=Math.max(s,Math.min(c,E[1]))-Math.max(s,Math.min(c,E[0]))}return m}function ro(a,s,c){for(var m=[{fixed:-1,stretch:0}],_=0,b=a;_<b.length;_+=1){var E=b[_],M=E[0],O=E[1],B=m[m.length-1];m.push({fixed:M-B.stretch,stretch:B.stretch}),m.push({fixed:M-B.stretch,stretch:B.stretch+(O-M)})}return m.push({fixed:s+1,stretch:c}),m}function Ks(a,s,c,m){return a/s*c+m}function Pu(a,s,c,m){return a-s*c/m}var Pe=function(a,s,c,m,_,b,E,M,O,B){if(this.boxStartIndex=a.length,O){var G=b.top,$=b.bottom,re=b.collisionPadding;re&&(G-=re[1],$+=re[3]);var ue=$-G;ue>0&&(ue=Math.max(10,ue),this.circleDiameter=ue)}else{var ke=b.top*E-M,Me=b.bottom*E+M,Xe=b.left*E-M,Ve=b.right*E+M,st=b.collisionPadding;if(st&&(Xe-=st[0]*E,ke-=st[1]*E,Ve+=st[2]*E,Me+=st[3]*E),B){var It=new oe(Xe,ke),Nt=new oe(Ve,ke),Ht=new oe(Xe,Me),or=new oe(Ve,Me),Fr=B*Math.PI/180;It._rotate(Fr),Nt._rotate(Fr),Ht._rotate(Fr),or._rotate(Fr),Xe=Math.min(It.x,Nt.x,Ht.x,or.x),Ve=Math.max(It.x,Nt.x,Ht.x,or.x),ke=Math.min(It.y,Nt.y,Ht.y,or.y),Me=Math.max(It.y,Nt.y,Ht.y,or.y)}a.emplaceBack(s.x,s.y,Xe,ke,Ve,Me,c,m,_)}this.boxEndIndex=a.length},Ot=function(a,s){if(a===void 0&&(a=[]),s===void 0&&(s=Pt),this.data=a,this.length=this.data.length,this.compare=s,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function Pt(a,s){return a<s?-1:a>s?1:0}function fn(a,s,c){s===void 0&&(s=1),c===void 0&&(c=!1);for(var m=1/0,_=1/0,b=-1/0,E=-1/0,M=a[0],O=0;O<M.length;O++){var B=M[O];(!O||B.x<m)&&(m=B.x),(!O||B.y<_)&&(_=B.y),(!O||B.x>b)&&(b=B.x),(!O||B.y>E)&&(E=B.y)}var G=Math.min(b-m,E-_),$=G/2,re=new Ot([],Si);if(G===0)return new oe(m,_);for(var ue=m;ue<b;ue+=G)for(var ke=_;ke<E;ke+=G)re.push(new we(ue+$,ke+$,$,a));for(var Me=function(st){for(var It=0,Nt=0,Ht=0,or=st[0],Fr=0,Kr=or.length,Pn=Kr-1;Fr<Kr;Pn=Fr++){var on=or[Fr],Or=or[Pn],cr=on.x*Or.y-Or.x*on.y;Nt+=(on.x+Or.x)*cr,Ht+=(on.y+Or.y)*cr,It+=3*cr}return new we(Nt/It,Ht/It,0,st)}(a),Xe=re.length;re.length;){var Ve=re.pop();(Ve.d>Me.d||!Me.d)&&(Me=Ve,c&&console.log("found best %d after %d probes",Math.round(1e4*Ve.d)/1e4,Xe)),Ve.max-Me.d<=s||(re.push(new we(Ve.p.x-($=Ve.h/2),Ve.p.y-$,$,a)),re.push(new we(Ve.p.x+$,Ve.p.y-$,$,a)),re.push(new we(Ve.p.x-$,Ve.p.y+$,$,a)),re.push(new we(Ve.p.x+$,Ve.p.y+$,$,a)),Xe+=4)}return c&&(console.log("num probes: "+Xe),console.log("best distance: "+Me.d)),Me.p}function Si(a,s){return s.max-a.max}function we(a,s,c,m){this.p=new oe(a,s),this.h=c,this.d=function(_,b){for(var E=!1,M=1/0,O=0;O<b.length;O++)for(var B=b[O],G=0,$=B.length,re=$-1;G<$;re=G++){var ue=B[G],ke=B[re];ue.y>_.y!=ke.y>_.y&&_.x<(ke.x-ue.x)*(_.y-ue.y)/(ke.y-ue.y)+ue.x&&(E=!E),M=Math.min(M,xl(_,ue,ke))}return(E?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}Ot.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},Ot.prototype.pop=function(){if(this.length!==0){var a=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),a}},Ot.prototype.peek=function(){return this.data[0]},Ot.prototype._up=function(a){for(var s=this.data,c=this.compare,m=s[a];a>0;){var _=a-1>>1,b=s[_];if(c(m,b)>=0)break;s[a]=b,a=_}s[a]=m},Ot.prototype._down=function(a){for(var s=this.data,c=this.compare,m=this.length>>1,_=s[a];a<m;){var b=1+(a<<1),E=s[b],M=b+1;if(M<this.length&&c(s[M],E)<0&&(b=M,E=s[M]),c(E,_)>=0)break;s[a]=E,a=b}s[a]=_};var pe=Number.POSITIVE_INFINITY;function Ye(a,s){return s[1]!==pe?function(c,m,_){var b=0,E=0;switch(m=Math.abs(m),_=Math.abs(_),c){case"top-right":case"top-left":case"top":E=_-7;break;case"bottom-right":case"bottom-left":case"bottom":E=7-_}switch(c){case"top-right":case"bottom-right":case"right":b=-m;break;case"top-left":case"bottom-left":case"left":b=m}return[b,E]}(a,s[0],s[1]):function(c,m){var _=0,b=0;m<0&&(m=0);var E=m/Math.sqrt(2);switch(c){case"top-right":case"top-left":b=E-7;break;case"bottom-right":case"bottom-left":b=7-E;break;case"bottom":b=7-m;break;case"top":b=m-7}switch(c){case"top-right":case"bottom-right":_=-E;break;case"top-left":case"bottom-left":_=E;break;case"left":_=m;break;case"right":_=-m}return[_,b]}(a,s[0])}function dt(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function yt(a,s,c,m,_,b,E,M,O,B,G,$,re,ue,ke){var Me=function(Nt,Ht,or,Fr,Kr,Pn,on,Or){for(var cr=Fr.layout.get("text-rotate").evaluate(Pn,{})*Math.PI/180,di=[],Xn=0,wn=Ht.positionedLines;Xn<wn.length;Xn+=1)for(var Ti=wn[Xn],ci=0,Ui=Ti.positionedGlyphs;ci<Ui.length;ci+=1){var Fn=Ui[ci];if(Fn.rect){var Yi=Fn.rect||{},ka=4,no=!0,Ya=1,La=0,io=(Kr||Or)&&Fn.vertical,Go=Fn.metrics.advance*Fn.scale/2;if(Or&&Ht.verticalizable&&(La=Ti.lineOffset/2-(Fn.imageName?-(24-Fn.metrics.width*Fn.scale)/2:24*(Fn.scale-1))),Fn.imageName){var Lo=on[Fn.imageName];no=Lo.sdf,ka=1/(Ya=Lo.pixelRatio)}var Ts=Kr?[Fn.x+Go,Fn.y]:[0,0],Xo=Kr?[0,0]:[Fn.x+Go+or[0],Fn.y+or[1]-La],Ms=[0,0];io&&(Ms=Xo,Xo=[0,0]);var ho=(Fn.metrics.left-ka)*Fn.scale-Go+Xo[0],qo=(-Fn.metrics.top-ka)*Fn.scale+Xo[1],Li=ho+Yi.w*Fn.scale/Ya,ca=qo+Yi.h*Fn.scale/Ya,na=new oe(ho,qo),ji=new oe(Li,qo),Bs=new oe(ho,ca),ps=new oe(Li,ca);if(io){var Ca=new oe(-Go,Go- -17),Xa=-Math.PI/2,ds=12-Go,Xi=new oe(22-ds,-(Fn.imageName?ds:0)),Fc=new(Function.prototype.bind.apply(oe,[null].concat(Ms)));na._rotateAround(Xa,Ca)._add(Xi)._add(Fc),ji._rotateAround(Xa,Ca)._add(Xi)._add(Fc),Bs._rotateAround(Xa,Ca)._add(Xi)._add(Fc),ps._rotateAround(Xa,Ca)._add(Xi)._add(Fc)}if(cr){var ku=Math.sin(cr),Bc=Math.cos(cr),po=[Bc,-ku,ku,Bc];na._matMult(po),ji._matMult(po),Bs._matMult(po),ps._matMult(po)}var zc=new oe(0,0),Ml=new oe(0,0);di.push({tl:na,tr:ji,bl:Bs,br:ps,tex:Yi,writingMode:Ht.writingMode,glyphOffset:Ts,sectionIndex:Fn.sectionIndex,isSDF:no,pixelOffsetTL:zc,pixelOffsetBR:Ml,minFontScaleX:0,minFontScaleY:0})}}return di}(0,c,M,_,b,E,m,a.allowVerticalPlacement),Xe=a.textSizeData,Ve=null;Xe.kind==="source"?(Ve=[128*_.layout.get("text-size").evaluate(E,{})])[0]>32640&&lt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Xe.kind==="composite"&&((Ve=[128*ue.compositeTextSizes[0].evaluate(E,{},ke),128*ue.compositeTextSizes[1].evaluate(E,{},ke)])[0]>32640||Ve[1]>32640)&&lt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Me,Ve,M,b,E,B,s,O.lineStartIndex,O.lineLength,re,ke);for(var st=0,It=G;st<It.length;st+=1)$[It[st]]=a.text.placedSymbolArray.length-1;return 4*Me.length}function Ze(a){for(var s in a)return a[s];return null}function He(a,s,c,m){var _=a.compareText;if(s in _){for(var b=_[s],E=b.length-1;E>=0;E--)if(m.dist(b[E])<c)return!0}else _[s]=[];return _[s].push(m),!1}var ft=il.VectorTileFeature.types,Ee=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ge(a,s,c,m,_,b,E,M,O,B,G,$,re){var ue=M?Math.min(32640,Math.round(M[0])):0,ke=M?Math.min(32640,Math.round(M[1])):0;a.emplaceBack(s,c,Math.round(32*m),Math.round(32*_),b,E,(ue<<1)+(O?1:0),ke,16*B,16*G,256*$,256*re)}function Se(a,s,c){a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c)}function pt(a){for(var s=0,c=a.sections;s<c.length;s+=1)if(ef(c[s].text))return!0;return!1}var xt=function(a){this.layoutVertexArray=new _l,this.indexArray=new Ku,this.programConfigurations=a,this.segments=new de,this.dynamicLayoutVertexArray=new Xl,this.opacityVertexArray=new ql,this.placedSymbolArray=new g};xt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},xt.prototype.upload=function(a,s,c,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,zv.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,bh.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Ee,!0),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(a))},xt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},cn("SymbolBuffers",xt);var ar=function(a,s,c){this.layoutVertexArray=new a,this.layoutAttributes=s,this.indexArray=new c,this.segments=new de,this.collisionVertexArray=new Ec};ar.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Yh.members,!0)},ar.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},cn("CollisionBuffers",ar);var Dt=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=co([]),this.placementViewportMatrix=co([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=la(this.zoom,s["text-size"]),this.iconSizeData=la(this.zoom,s["icon-size"]);var c=this.layers[0].layout,m=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(b){return Rn[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=a.sourceID};Dt.prototype.createArrays=function(){this.text=new xt(new Zn(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new xt(new Zn(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new T,this.lineVertexArray=new L,this.symbolInstances=new C},Dt.prototype.calculateGlyphDependencies=function(a,s,c,m,_){for(var b=0;b<a.length;b++)if(s[a.charCodeAt(b)]=!0,(c||m)&&_){var E=cf[a.charAt(b)];E&&(s[E.charCodeAt(0)]=!0)}},Dt.prototype.populate=function(a,s,c){var m=this.layers[0],_=m.layout,b=_.get("text-font"),E=_.get("text-field"),M=_.get("icon-image"),O=(E.value.kind!=="constant"||E.value.value instanceof Qi&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),B=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,G=_.get("symbol-sort-key");if(this.features=[],O||B){for(var $=s.iconDependencies,re=s.glyphDependencies,ue=s.availableImages,ke=new pi(this.zoom),Me=0,Xe=a;Me<Xe.length;Me+=1){var Ve=Xe[Me],st=Ve.feature,It=Ve.id,Nt=Ve.index,Ht=Ve.sourceLayerIndex,or=m._featureFilter.needGeometry,Fr=Ia(st,or);if(m._featureFilter.filter(ke,Fr,c)){or||(Fr.geometry=ya(st));var Kr=void 0;if(O){var Pn=m.getValueAndResolveTokens("text-field",Fr,c,ue),on=Qi.factory(Pn);pt(on)&&(this.hasRTLText=!0),(!this.hasRTLText||xc()==="unavailable"||this.hasRTLText&&Rs.isParsed())&&(Kr=Td(on,m,Fr))}var Or=void 0;if(B){var cr=m.getValueAndResolveTokens("icon-image",Fr,c,ue);Or=cr instanceof fa?cr:fa.fromString(cr)}if(Kr||Or){var di=this.sortFeaturesByKey?G.evaluate(Fr,{},c):void 0;if(this.features.push({id:It,text:Kr,icon:Or,index:Nt,sourceLayerIndex:Ht,geometry:Fr.geometry,properties:st.properties,type:ft[st.type],sortKey:di}),Or&&($[Or.name]=!0),Kr){var Xn=b.evaluate(Fr,{},c).join(","),wn=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Rn.vertical)>=0;for(var Ti=0,ci=Kr.sections;Ti<ci.length;Ti+=1){var Ui=ci[Ti];if(Ui.image)$[Ui.image.name]=!0;else{var Fn=Ff(Kr.toString()),Yi=Ui.fontStack||Xn,ka=re[Yi]=re[Yi]||{};this.calculateGlyphDependencies(Ui.text,ka,wn,this.allowVerticalPlacement,Fn)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(no){var Ya={},La={},io=[],Go=0;function Lo(Ca){io.push(no[Ca]),Go++}function Ts(Ca,Xa,ds){var Xi=La[Ca];return delete La[Ca],La[Xa]=Xi,io[Xi].geometry[0].pop(),io[Xi].geometry[0]=io[Xi].geometry[0].concat(ds[0]),Xi}function Xo(Ca,Xa,ds){var Xi=Ya[Xa];return delete Ya[Xa],Ya[Ca]=Xi,io[Xi].geometry[0].shift(),io[Xi].geometry[0]=ds[0].concat(io[Xi].geometry[0]),Xi}function Ms(Ca,Xa,ds){var Xi=ds?Xa[0][Xa[0].length-1]:Xa[0][0];return Ca+":"+Xi.x+":"+Xi.y}for(var ho=0;ho<no.length;ho++){var qo=no[ho],Li=qo.geometry,ca=qo.text?qo.text.toString():null;if(ca){var na=Ms(ca,Li),ji=Ms(ca,Li,!0);if(na in La&&ji in Ya&&La[na]!==Ya[ji]){var Bs=Xo(na,ji,Li),ps=Ts(na,ji,io[Bs].geometry);delete Ya[na],delete La[ji],La[Ms(ca,io[ps].geometry,!0)]=ps,io[Bs].geometry=null}else na in La?Ts(na,ji,Li):ji in Ya?Xo(na,ji,Li):(Lo(ho),Ya[na]=Go-1,La[ji]=Go-1)}else Lo(ho)}return io.filter(function(Ca){return Ca.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(no,Ya){return no.sortKey-Ya.sortKey})}},Dt.prototype.update=function(a,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(a,s,this.layers,c))},Dt.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Dt.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Dt.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Dt.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Dt.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Dt.prototype.addToLineVertexArray=function(a,s){var c=this.lineVertexArray.length;if(a.segment!==void 0){for(var m=a.dist(s[a.segment+1]),_=a.dist(s[a.segment]),b={},E=a.segment+1;E<s.length;E++)b[E]={x:s[E].x,y:s[E].y,tileUnitDistanceFromAnchor:m},E<s.length-1&&(m+=s[E+1].dist(s[E]));for(var M=a.segment||0;M>=0;M--)b[M]={x:s[M].x,y:s[M].y,tileUnitDistanceFromAnchor:_},M>0&&(_+=s[M-1].dist(s[M]));for(var O=0;O<s.length;O++){var B=b[O];this.lineVertexArray.emplaceBack(B.x,B.y,B.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},Dt.prototype.addSymbols=function(a,s,c,m,_,b,E,M,O,B,G,$){for(var re=a.indexArray,ue=a.layoutVertexArray,ke=a.segments.prepareSegment(4*s.length,ue,re,this.canOverlap?b.sortKey:void 0),Me=this.glyphOffsetArray.length,Xe=ke.vertexLength,Ve=this.allowVerticalPlacement&&E===Rn.vertical?Math.PI/2:0,st=b.text&&b.text.sections,It=0;It<s.length;It++){var Nt=s[It],Ht=Nt.tl,or=Nt.tr,Fr=Nt.bl,Kr=Nt.br,Pn=Nt.tex,on=Nt.pixelOffsetTL,Or=Nt.pixelOffsetBR,cr=Nt.minFontScaleX,di=Nt.minFontScaleY,Xn=Nt.glyphOffset,wn=Nt.isSDF,Ti=Nt.sectionIndex,ci=ke.vertexLength,Ui=Xn[1];Ge(ue,M.x,M.y,Ht.x,Ui+Ht.y,Pn.x,Pn.y,c,wn,on.x,on.y,cr,di),Ge(ue,M.x,M.y,or.x,Ui+or.y,Pn.x+Pn.w,Pn.y,c,wn,Or.x,on.y,cr,di),Ge(ue,M.x,M.y,Fr.x,Ui+Fr.y,Pn.x,Pn.y+Pn.h,c,wn,on.x,Or.y,cr,di),Ge(ue,M.x,M.y,Kr.x,Ui+Kr.y,Pn.x+Pn.w,Pn.y+Pn.h,c,wn,Or.x,Or.y,cr,di),Se(a.dynamicLayoutVertexArray,M,Ve),re.emplaceBack(ci,ci+1,ci+2),re.emplaceBack(ci+1,ci+2,ci+3),ke.vertexLength+=4,ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xn[0]),It!==s.length-1&&Ti===s[It+1].sectionIndex||a.programConfigurations.populatePaintArrays(ue.length,b,b.index,{},$,st&&st[Ti])}a.placedSymbolArray.emplaceBack(M.x,M.y,Me,this.glyphOffsetArray.length-Me,Xe,O,B,M.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],E,0,!1,0,G)},Dt.prototype._addCollisionDebugVertex=function(a,s,c,m,_,b){return s.emplaceBack(0,0),a.emplaceBack(c.x,c.y,m,_,Math.round(b.x),Math.round(b.y))},Dt.prototype.addCollisionDebugVertices=function(a,s,c,m,_,b,E){var M=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),O=M.vertexLength,B=_.layoutVertexArray,G=_.collisionVertexArray,$=E.anchorX,re=E.anchorY;this._addCollisionDebugVertex(B,G,b,$,re,new oe(a,s)),this._addCollisionDebugVertex(B,G,b,$,re,new oe(c,s)),this._addCollisionDebugVertex(B,G,b,$,re,new oe(c,m)),this._addCollisionDebugVertex(B,G,b,$,re,new oe(a,m)),M.vertexLength+=4;var ue=_.indexArray;ue.emplaceBack(O,O+1),ue.emplaceBack(O+1,O+2),ue.emplaceBack(O+2,O+3),ue.emplaceBack(O+3,O),M.primitiveLength+=4},Dt.prototype.addDebugCollisionBoxes=function(a,s,c,m){for(var _=a;_<s;_++){var b=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,m?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,c)}},Dt.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ar(wc,Xh.members,af),this.iconCollisionBox=new ar(wc,Xh.members,af);for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},Dt.prototype._deserializeCollisionBoxesForSymbol=function(a,s,c,m,_,b,E,M,O){for(var B={},G=s;G<c;G++){var $=a.get(G);B.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},B.textFeatureIndex=$.featureIndex;break}for(var re=m;re<_;re++){var ue=a.get(re);B.verticalTextBox={x1:ue.x1,y1:ue.y1,x2:ue.x2,y2:ue.y2,anchorPointX:ue.anchorPointX,anchorPointY:ue.anchorPointY},B.verticalTextFeatureIndex=ue.featureIndex;break}for(var ke=b;ke<E;ke++){var Me=a.get(ke);B.iconBox={x1:Me.x1,y1:Me.y1,x2:Me.x2,y2:Me.y2,anchorPointX:Me.anchorPointX,anchorPointY:Me.anchorPointY},B.iconFeatureIndex=Me.featureIndex;break}for(var Xe=M;Xe<O;Xe++){var Ve=a.get(Xe);B.verticalIconBox={x1:Ve.x1,y1:Ve.y1,x2:Ve.x2,y2:Ve.y2,anchorPointX:Ve.anchorPointX,anchorPointY:Ve.anchorPointY},B.verticalIconFeatureIndex=Ve.featureIndex;break}return B},Dt.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},Dt.prototype.hasTextData=function(){return this.text.segments.get().length>0},Dt.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Dt.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Dt.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Dt.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Dt.prototype.addIndicesForPlacedSymbol=function(a,s){for(var c=a.placedSymbolArray.get(s),m=c.vertexStartIndex+4*c.numGlyphs,_=c.vertexStartIndex;_<m;_+=4)a.indexArray.emplaceBack(_,_+1,_+2),a.indexArray.emplaceBack(_+1,_+2,_+3)},Dt.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(a),c=Math.cos(a),m=[],_=[],b=[],E=0;E<this.symbolInstances.length;++E){b.push(E);var M=this.symbolInstances.get(E);m.push(0|Math.round(s*M.anchorX+c*M.anchorY)),_.push(M.featureIndex)}return b.sort(function(O,B){return m[O]-m[B]||_[B]-_[O]}),b},Dt.prototype.addToSortKeyRanges=function(a,s){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:a,symbolInstanceEnd:a+1})},Dt.prototype.sortFeatures=function(a){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,m=this.symbolInstanceIndexes;c<m.length;c+=1){var _=this.symbolInstances.get(m[c]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(b,E,M){b>=0&&M.indexOf(b)===E&&s.addIndicesForPlacedSymbol(s.text,b)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},cn("SymbolBucket",Dt,{omit:["layers","collisionBoxArray","features","compareText"]}),Dt.MAX_GLYPHS=65535,Dt.addDynamicAttributes=Se;var er=new bo({"symbol-placement":new An(he.layout_symbol["symbol-placement"]),"symbol-spacing":new An(he.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new An(he.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new dn(he.layout_symbol["symbol-sort-key"]),"symbol-z-order":new An(he.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new An(he.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new An(he.layout_symbol["icon-ignore-placement"]),"icon-optional":new An(he.layout_symbol["icon-optional"]),"icon-rotation-alignment":new An(he.layout_symbol["icon-rotation-alignment"]),"icon-size":new dn(he.layout_symbol["icon-size"]),"icon-text-fit":new An(he.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new An(he.layout_symbol["icon-text-fit-padding"]),"icon-image":new dn(he.layout_symbol["icon-image"]),"icon-rotate":new dn(he.layout_symbol["icon-rotate"]),"icon-padding":new An(he.layout_symbol["icon-padding"]),"icon-keep-upright":new An(he.layout_symbol["icon-keep-upright"]),"icon-offset":new dn(he.layout_symbol["icon-offset"]),"icon-anchor":new dn(he.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new An(he.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new An(he.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new An(he.layout_symbol["text-rotation-alignment"]),"text-field":new dn(he.layout_symbol["text-field"]),"text-font":new dn(he.layout_symbol["text-font"]),"text-size":new dn(he.layout_symbol["text-size"]),"text-max-width":new dn(he.layout_symbol["text-max-width"]),"text-line-height":new An(he.layout_symbol["text-line-height"]),"text-letter-spacing":new dn(he.layout_symbol["text-letter-spacing"]),"text-justify":new dn(he.layout_symbol["text-justify"]),"text-radial-offset":new dn(he.layout_symbol["text-radial-offset"]),"text-variable-anchor":new An(he.layout_symbol["text-variable-anchor"]),"text-anchor":new dn(he.layout_symbol["text-anchor"]),"text-max-angle":new An(he.layout_symbol["text-max-angle"]),"text-writing-mode":new An(he.layout_symbol["text-writing-mode"]),"text-rotate":new dn(he.layout_symbol["text-rotate"]),"text-padding":new An(he.layout_symbol["text-padding"]),"text-keep-upright":new An(he.layout_symbol["text-keep-upright"]),"text-transform":new dn(he.layout_symbol["text-transform"]),"text-offset":new dn(he.layout_symbol["text-offset"]),"text-allow-overlap":new An(he.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new An(he.layout_symbol["text-ignore-placement"]),"text-optional":new An(he.layout_symbol["text-optional"])}),yr={paint:new bo({"icon-opacity":new dn(he.paint_symbol["icon-opacity"]),"icon-color":new dn(he.paint_symbol["icon-color"]),"icon-halo-color":new dn(he.paint_symbol["icon-halo-color"]),"icon-halo-width":new dn(he.paint_symbol["icon-halo-width"]),"icon-halo-blur":new dn(he.paint_symbol["icon-halo-blur"]),"icon-translate":new An(he.paint_symbol["icon-translate"]),"icon-translate-anchor":new An(he.paint_symbol["icon-translate-anchor"]),"text-opacity":new dn(he.paint_symbol["text-opacity"]),"text-color":new dn(he.paint_symbol["text-color"],{runtimeType:Q,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new dn(he.paint_symbol["text-halo-color"]),"text-halo-width":new dn(he.paint_symbol["text-halo-width"]),"text-halo-blur":new dn(he.paint_symbol["text-halo-blur"]),"text-translate":new An(he.paint_symbol["text-translate"]),"text-translate-anchor":new An(he.paint_symbol["text-translate-anchor"])}),layout:er},xn=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:sn,this.defaultValue=a};xn.prototype.evaluate=function(a){if(a.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(a.formattedSection))return s.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},xn.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},xn.prototype.outputDefined=function(){return!1},xn.prototype.serialize=function(){return null},cn("FormatSectionOverride",xn,{omit:["defaultValue"]});var ai=function(a){function s(c){a.call(this,c,yr)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){if(a.prototype.recalculate.call(this,c,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var b=[],E=0,M=_;E<M.length;E+=1){var O=M[E];b.indexOf(O)<0&&b.push(O)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(c,m,_,b){var E=this.layout.get(c).evaluate(m,{},_,b),M=this._unevaluatedLayout._values[c];return M.isDataDriven()||su(M.value)||!E?E:function(O,B){return B.replace(/{([^{}]+)}/g,function(G,$){return $ in O?String(O[$]):""})}(m.properties,E)},s.prototype.createBucket=function(c){return new Dt(c)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var c=0,m=yr.paint.overridableProperties;c<m.length;c+=1){var _=m[c];if(s.hasPaintOverride(this.layout,_)){var b,E=this.paint.get(_),M=new xn(E),O=new Uu(M,E.property.specification);b=E.value.kind==="constant"||E.value.kind==="source"?new fl("source",O):new Vu("composite",O,E.value.zoomStops,E.value._interpolationType),this.paint._values[_]=new zo(E.property,b,E.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!(!this.layout||m.isDataDriven()||_.isDataDriven())&&s.hasPaintOverride(this.layout,c)},s.hasPaintOverride=function(c,m){var _=c.get("text-field"),b=yr.paint.properties[m],E=!1,M=function(G){for(var $=0,re=G;$<re.length;$+=1)if(b.overrides&&b.overrides.hasOverride(re[$]))return void(E=!0)};if(_.value.kind==="constant"&&_.value.value instanceof Qi)M(_.value.value.sections);else if(_.value.kind==="source"){var O=function(G){E||(G instanceof Oa&&sa(G.value)===Zi?M(G.value.sections):G instanceof Oo?M(G.sections):G.eachChild(O))},B=_.value;B._styleExpression&&O(B._styleExpression.expression)}return E},s}(Ws),bn={paint:new bo({"background-color":new An(he.paint_background["background-color"]),"background-pattern":new Io(he.paint_background["background-pattern"]),"background-opacity":new An(he.paint_background["background-opacity"])})},zn=function(a){function s(c){a.call(this,c,bn)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Ws),ti={paint:new bo({"raster-opacity":new An(he.paint_raster["raster-opacity"]),"raster-hue-rotate":new An(he.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new An(he.paint_raster["raster-brightness-min"]),"raster-brightness-max":new An(he.paint_raster["raster-brightness-max"]),"raster-saturation":new An(he.paint_raster["raster-saturation"]),"raster-contrast":new An(he.paint_raster["raster-contrast"]),"raster-resampling":new An(he.paint_raster["raster-resampling"]),"raster-fade-duration":new An(he.paint_raster["raster-fade-duration"])})},Ni=function(a){function s(c){a.call(this,c,ti)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Ws),Za=function(a){function s(c){a.call(this,c,{}),this.implementation=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},s.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},s}(Ws),Cs={circle:bl,heatmap:xd,hillshade:ph,fill:Dv,"fill-extrusion":Es,line:Bv,symbol:ai,background:zn,raster:Ni},Sh=se.HTMLImageElement,Js=se.HTMLCanvasElement,Kh=se.HTMLVideoElement,yu=se.ImageData,ff=se.ImageBitmap,Vf=function(a,s,c,m){this.context=a,this.format=c,this.texture=a.gl.createTexture(),this.update(s,m)};Vf.prototype.update=function(a,s,c){var m=a.width,_=a.height,b=!(this.size&&this.size[0]===m&&this.size[1]===_||c),E=this.context,M=E.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!s||s.premultiply!==!1)),b)this.size=[m,_],a instanceof Sh||a instanceof Js||a instanceof Kh||a instanceof yu||ff&&a instanceof ff?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,a):M.texImage2D(M.TEXTURE_2D,0,this.format,m,_,0,this.format,M.UNSIGNED_BYTE,a.data);else{var O=c||{x:0,y:0},B=O.x,G=O.y;a instanceof Sh||a instanceof Js||a instanceof Kh||a instanceof yu||ff&&a instanceof ff?M.texSubImage2D(M.TEXTURE_2D,0,B,G,M.RGBA,M.UNSIGNED_BYTE,a):M.texSubImage2D(M.TEXTURE_2D,0,B,G,m,_,M.RGBA,M.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},Vf.prototype.bind=function(a,s,c){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),a!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||a),this.filter=a),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)},Vf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Vf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Md=function(a){var s=this;this._callback=a,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};Md.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Md.prototype.remove=function(){delete this._channel,this._callback=function(){}};var jf=function(a,s,c){this.target=a,this.parent=s,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Dr(["receive","process"],this),this.invoker=new Md(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=J()?a:se};function Nv(a,s,c){var m=2*Math.PI*6378137/256/Math.pow(2,c);return[a*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}jf.prototype.send=function(a,s,c,m,_){var b=this;_===void 0&&(_=!1);var E=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[E]=c);var M=H(this.globalScope)?void 0:[];return this.target.postMessage({id:E,type:a,hasCallback:!!c,targetMapId:m,mustQueue:_,sourceMapId:this.mapId,data:ks(s,M)},M),{cancel:function(){c&&delete b.callbacks[E],b.target.postMessage({id:E,type:"<cancel>",targetMapId:m,sourceMapId:b.mapId})}}},jf.prototype.receive=function(a){var s=a.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[c];var m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m()}else J()||s.mustQueue?(this.tasks[c]=s,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,s)},jf.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),s=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(a,s)}},jf.prototype.processTask=function(a,s){var c=this;if(s.type==="<response>"){var m=this.callbacks[a];delete this.callbacks[a],m&&(s.error?m(_s(s.error)):m(null,_s(s.data)))}else{var _=!1,b=H(this.globalScope)?void 0:[],E=s.hasCallback?function(G,$){_=!0,delete c.cancelCallbacks[a],c.target.postMessage({id:a,type:"<response>",sourceMapId:c.mapId,error:G?ks(G):null,data:ks($,b)},b)}:function(G){_=!0},M=null,O=_s(s.data);if(this.parent[s.type])M=this.parent[s.type](s.sourceMapId,O,E);else if(this.parent.getWorkerSource){var B=s.type.split(".");M=this.parent.getWorkerSource(s.sourceMapId,B[0],O.source)[B[1]](O,E)}else E(new Error("Could not find function "+s.type));!_&&M&&M.cancel&&(this.cancelCallbacks[a]=M.cancel)}},jf.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Co=function(a,s){a&&(s?this.setSouthWest(a).setNorthEast(s):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};Co.prototype.setNorthEast=function(a){return this._ne=a instanceof Aa?new Aa(a.lng,a.lat):Aa.convert(a),this},Co.prototype.setSouthWest=function(a){return this._sw=a instanceof Aa?new Aa(a.lng,a.lat):Aa.convert(a),this},Co.prototype.extend=function(a){var s,c,m=this._sw,_=this._ne;if(a instanceof Aa)s=a,c=a;else{if(!(a instanceof Co))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Co.convert(a)):this.extend(Aa.convert(a)):this;if(c=a._ne,!(s=a._sw)||!c)return this}return m||_?(m.lng=Math.min(s.lng,m.lng),m.lat=Math.min(s.lat,m.lat),_.lng=Math.max(c.lng,_.lng),_.lat=Math.max(c.lat,_.lat)):(this._sw=new Aa(s.lng,s.lat),this._ne=new Aa(c.lng,c.lat)),this},Co.prototype.getCenter=function(){return new Aa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Co.prototype.getSouthWest=function(){return this._sw},Co.prototype.getNorthEast=function(){return this._ne},Co.prototype.getNorthWest=function(){return new Aa(this.getWest(),this.getNorth())},Co.prototype.getSouthEast=function(){return new Aa(this.getEast(),this.getSouth())},Co.prototype.getWest=function(){return this._sw.lng},Co.prototype.getSouth=function(){return this._sw.lat},Co.prototype.getEast=function(){return this._ne.lng},Co.prototype.getNorth=function(){return this._ne.lat},Co.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Co.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Co.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Co.prototype.contains=function(a){var s=Aa.convert(a),c=s.lng,m=s.lat,_=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&_},Co.convert=function(a){return!a||a instanceof Co?a:new Co(a)};var Aa=function(a,s){if(isNaN(a)||isNaN(s))throw new Error("Invalid LngLat object: ("+a+", "+s+")");if(this.lng=+a,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Aa.prototype.wrap=function(){return new Aa(Kt(this.lng,-180,180),this.lat)},Aa.prototype.toArray=function(){return[this.lng,this.lat]},Aa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Aa.prototype.distanceTo=function(a){var s=Math.PI/180,c=this.lat*s,m=a.lat*s,_=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((a.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(_,1))},Aa.prototype.toBounds=function(a){a===void 0&&(a=0);var s=360*a/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Co(new Aa(this.lng-c,this.lat-s),new Aa(this.lng+c,this.lat+s))},Aa.convert=function(a){if(a instanceof Aa)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Aa(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Aa(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Zv=2*Math.PI*63710088e-1;function Uv(a){return Zv*Math.cos(a*Math.PI/180)}function Id(a){return(180+a)/360}function Pd(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Vv(a,s){return a/Uv(s)}function kd(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var hf=function(a,s,c){c===void 0&&(c=0),this.x=+a,this.y=+s,this.z=+c};hf.fromLngLat=function(a,s){s===void 0&&(s=0);var c=Aa.convert(a);return new hf(Id(c.lng),Pd(c.lat),Vv(s,c.lat))},hf.prototype.toLngLat=function(){return new Aa(360*this.x-180,kd(this.y))},hf.prototype.toAltitude=function(){return this.z*Uv(kd(this.y))},hf.prototype.meterInMercatorCoordinateUnits=function(){return 1/Zv*(a=kd(this.y),1/Math.cos(a*Math.PI/180));var a};var Gf=function(a,s,c){this.z=a,this.x=s,this.y=c,this.key=Jh(0,a,a,s,c)};Gf.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},Gf.prototype.url=function(a,s){var c,m,_,b,E,M=(m=this.y,_=this.z,b=Nv(256*(c=this.x),256*(m=Math.pow(2,_)-m-1),_),E=Nv(256*(c+1),256*(m+1),_),b[0]+","+b[1]+","+E[0]+","+E[1]),O=function(B,G,$){for(var re,ue="",ke=B;ke>0;ke--)ue+=(G&(re=1<<ke-1)?1:0)+($&re?2:0);return ue}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",O).replace("{bbox-epsg-3857}",M)},Gf.prototype.getTilePoint=function(a){var s=Math.pow(2,this.z);return new oe(8192*(a.x*s-this.x),8192*(a.y*s-this.y))},Gf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var jv=function(a,s){this.wrap=a,this.canonical=s,this.key=Jh(a,s.z,s.z,s.x,s.y)},To=function(a,s,c,m,_){this.overscaledZ=a,this.wrap=s,this.canonical=new Gf(c,+m,+_),this.key=Jh(s,a,c,m,_)};function Jh(a,s,c,m,_){(a*=2)<0&&(a=-1*a-1);var b=1<<c;return(b*b*a+b*_+m).toString(36)+c.toString(36)+s.toString(36)}To.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},To.prototype.scaledTo=function(a){var s=this.canonical.z-a;return a>this.canonical.z?new To(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new To(a,this.wrap,a,this.canonical.x>>s,this.canonical.y>>s)},To.prototype.calculateScaledKey=function(a,s){var c=this.canonical.z-a;return a>this.canonical.z?Jh(this.wrap*+s,a,this.canonical.z,this.canonical.x,this.canonical.y):Jh(this.wrap*+s,a,a,this.canonical.x>>c,this.canonical.y>>c)},To.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var s=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>s&&a.canonical.y===this.canonical.y>>s},To.prototype.children=function(a){if(this.overscaledZ>=a)return[new To(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new To(s,this.wrap,s,c,m),new To(s,this.wrap,s,c+1,m),new To(s,this.wrap,s,c,m+1),new To(s,this.wrap,s,c+1,m+1)]},To.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},To.prototype.wrapped=function(){return new To(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},To.prototype.unwrapTo=function(a){return new To(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},To.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},To.prototype.toUnwrapped=function(){return new jv(this.wrap,this.canonical)},To.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},To.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new hf(a.x-this.wrap,a.y))},cn("CanonicalTileID",Gf),cn("OverscaledTileID",To,{omit:["posMatrix"]});var Rc=function(a,s,c){if(this.uid=a,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return lt('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var m=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=c||"mapbox";for(var _=0;_<m;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(m,_)]=this.data[this._idx(m-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,m)]=this.data[this._idx(_,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};Rc.prototype.get=function(a,s){var c=new Uint8Array(this.data.buffer),m=4*this._idx(a,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[m],c[m+1],c[m+2])},Rc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Rc.prototype._idx=function(a,s){if(a<-1||a>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(a+1)},Rc.prototype._unpackMapbox=function(a,s,c){return(256*a*256+256*s+c)/10-1e4},Rc.prototype._unpackTerrarium=function(a,s,c){return 256*a+s+c/256-32768},Rc.prototype.getPixels=function(){return new za({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Rc.prototype.backfillBorder=function(a,s,c){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var m=s*this.dim,_=s*this.dim+this.dim,b=c*this.dim,E=c*this.dim+this.dim;switch(s){case-1:m=_-1;break;case 1:_=m+1}switch(c){case-1:b=E-1;break;case 1:E=b+1}for(var M=-s*this.dim,O=-c*this.dim,B=b;B<E;B++)for(var G=m;G<_;G++)this.data[this._idx(G,B)]=a.data[this._idx(G+M,B+O)]},cn("DEMData",Rc);var Np=function(a){this._stringToNumber={},this._numberToString=[];for(var s=0;s<a.length;s++){var c=a[s];this._stringToNumber[c]=s,this._numberToString[s]=c}};Np.prototype.encode=function(a){return this._stringToNumber[a]},Np.prototype.decode=function(a){return this._numberToString[a]};var Zp=function(a,s,c,m,_){this.type="Feature",this._vectorTileFeature=a,a._z=s,a._x=c,a._y=m,this.properties=a.properties,this.id=_},Up={geometry:{configurable:!0}};Up.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Up.geometry.set=function(a){this._geometry=a},Zp.prototype.toJSON=function(){var a={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(a[s]=this[s]);return a},Object.defineProperties(Zp.prototype,Up);var wh=function(){this.state={},this.stateChanges={},this.deletedStates={}};wh.prototype.updateState=function(a,s,c){var m=String(s);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][m]=this.stateChanges[a][m]||{},Yt(this.stateChanges[a][m],c),this.deletedStates[a]===null)for(var _ in this.deletedStates[a]={},this.state[a])_!==m&&(this.deletedStates[a][_]=null);else if(this.deletedStates[a]&&this.deletedStates[a][m]===null)for(var b in this.deletedStates[a][m]={},this.state[a][m])c[b]||(this.deletedStates[a][m][b]=null);else for(var E in c)this.deletedStates[a]&&this.deletedStates[a][m]&&this.deletedStates[a][m][E]===null&&delete this.deletedStates[a][m][E]},wh.prototype.removeFeatureState=function(a,s,c){if(this.deletedStates[a]!==null){var m=String(s);if(this.deletedStates[a]=this.deletedStates[a]||{},c&&s!==void 0)this.deletedStates[a][m]!==null&&(this.deletedStates[a][m]=this.deletedStates[a][m]||{},this.deletedStates[a][m][c]=null);else if(s!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][m])for(c in this.deletedStates[a][m]={},this.stateChanges[a][m])this.deletedStates[a][m][c]=null;else this.deletedStates[a][m]=null;else this.deletedStates[a]=null}},wh.prototype.getState=function(a,s){var c=String(s),m=Yt({},(this.state[a]||{})[c],(this.stateChanges[a]||{})[c]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var _=this.deletedStates[a][s];if(_===null)return{};for(var b in _)delete m[b]}return m},wh.prototype.initializeTileState=function(a,s){a.setFeatureState(this.state,s)},wh.prototype.coalesceChanges=function(a,s){var c={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var _={};for(var b in this.stateChanges[m])this.state[m][b]||(this.state[m][b]={}),Yt(this.state[m][b],this.stateChanges[m][b]),_[b]=this.state[m][b];c[m]=_}for(var E in this.deletedStates){this.state[E]=this.state[E]||{};var M={};if(this.deletedStates[E]===null)for(var O in this.state[E])M[O]={},this.state[E][O]={};else for(var B in this.deletedStates[E]){if(this.deletedStates[E][B]===null)this.state[E][B]={};else for(var G=0,$=Object.keys(this.deletedStates[E][B]);G<$.length;G+=1)delete this.state[E][B][$[G]];M[B]=this.state[E][B]}c[E]=c[E]||{},Yt(c[E],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var re in a)a[re].setFeatureState(c,s)};var Oc=function(a,s){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Wu(8192,16,0),this.grid3D=new Wu(8192,16,0),this.featureIndexArray=new X,this.promoteId=s};function Gv(a,s,c,m,_){return sr(a,function(b,E){var M=s instanceof bc?s.get(E):null;return M&&M.evaluate?M.evaluate(c,m,_):M})}function Vp(a){for(var s=1/0,c=1/0,m=-1/0,_=-1/0,b=0,E=a;b<E.length;b+=1){var M=E[b];s=Math.min(s,M.x),c=Math.min(c,M.y),m=Math.max(m,M.x),_=Math.max(_,M.y)}return{minX:s,minY:c,maxX:m,maxY:_}}function Gm(a,s){return s-a}Oc.prototype.insert=function(a,s,c,m,_,b){var E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,_);for(var M=b?this.grid3D:this.grid,O=0;O<s.length;O++){for(var B=s[O],G=[1/0,1/0,-1/0,-1/0],$=0;$<B.length;$++){var re=B[$];G[0]=Math.min(G[0],re.x),G[1]=Math.min(G[1],re.y),G[2]=Math.max(G[2],re.x),G[3]=Math.max(G[3],re.y)}G[0]<8192&&G[1]<8192&&G[2]>=0&&G[3]>=0&&M.insert(E,G[0],G[1],G[2],G[3])}},Oc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new il.VectorTile(new xe(this.rawTileData)).layers,this.sourceLayerCoder=new Np(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Oc.prototype.query=function(a,s,c,m){var _=this;this.loadVTLayers();for(var b=a.params||{},E=8192/a.tileSize/a.scale,M=jl(b.filter),O=a.queryGeometry,B=a.queryPadding*E,G=Vp(O),$=this.grid.query(G.minX-B,G.minY-B,G.maxX+B,G.maxY+B),re=Vp(a.cameraQueryGeometry),ue=this.grid3D.query(re.minX-B,re.minY-B,re.maxX+B,re.maxY+B,function(Nt,Ht,or,Fr){return function(Kr,Pn,on,Or,cr){for(var di=0,Xn=Kr;di<Xn.length;di+=1){var wn=Xn[di];if(Pn<=wn.x&&on<=wn.y&&Or>=wn.x&&cr>=wn.y)return!0}var Ti=[new oe(Pn,on),new oe(Pn,cr),new oe(Or,cr),new oe(Or,on)];if(Kr.length>2){for(var ci=0,Ui=Ti;ci<Ui.length;ci+=1)if(hu(Kr,Ui[ci]))return!0}for(var Fn=0;Fn<Kr.length-1;Fn++)if(Kl(Kr[Fn],Kr[Fn+1],Ti))return!0;return!1}(a.cameraQueryGeometry,Nt-B,Ht-B,or+B,Fr+B)}),ke=0,Me=ue;ke<Me.length;ke+=1)$.push(Me[ke]);$.sort(Gm);for(var Xe,Ve={},st=function(Nt){var Ht=$[Nt];if(Ht!==Xe){Xe=Ht;var or=_.featureIndexArray.get(Ht),Fr=null;_.loadMatchingFeature(Ve,or.bucketIndex,or.sourceLayerIndex,or.featureIndex,M,b.layers,b.availableImages,s,c,m,function(Kr,Pn,on){return Fr||(Fr=ya(Kr)),Pn.queryIntersectsFeature(O,Kr,on,Fr,_.z,a.transform,E,a.pixelPosMatrix)})}},It=0;It<$.length;It++)st(It);return Ve},Oc.prototype.loadMatchingFeature=function(a,s,c,m,_,b,E,M,O,B,G){var $=this.bucketLayerIDs[s];if(!b||function(Kr,Pn){for(var on=0;on<Kr.length;on++)if(Pn.indexOf(Kr[on])>=0)return!0;return!1}(b,$)){var re=this.sourceLayerCoder.decode(c),ue=this.vtLayers[re].feature(m);if(_.needGeometry){var ke=Ia(ue,!0);if(!_.filter(new pi(this.tileID.overscaledZ),ke,this.tileID.canonical))return}else if(!_.filter(new pi(this.tileID.overscaledZ),ue))return;for(var Me=this.getId(ue,re),Xe=0;Xe<$.length;Xe++){var Ve=$[Xe];if(!(b&&b.indexOf(Ve)<0)){var st=M[Ve];if(st){var It={};Me!==void 0&&B&&(It=B.getState(st.sourceLayer||"_geojsonTileLayer",Me));var Nt=Yt({},O[Ve]);Nt.paint=Gv(Nt.paint,st.paint,ue,It,E),Nt.layout=Gv(Nt.layout,st.layout,ue,It,E);var Ht=!G||G(ue,st,It);if(Ht){var or=new Zp(ue,this.z,this.x,this.y,Me);or.layer=Nt;var Fr=a[Ve];Fr===void 0&&(Fr=a[Ve]=[]),Fr.push({featureIndex:m,feature:or,intersectionZ:Ht})}}}}}},Oc.prototype.lookupSymbolFeatures=function(a,s,c,m,_,b,E,M){var O={};this.loadVTLayers();for(var B=jl(_),G=0,$=a;G<$.length;G+=1)this.loadMatchingFeature(O,c,m,$[G],B,b,E,M,s);return O},Oc.prototype.hasLayer=function(a){for(var s=0,c=this.bucketLayerIDs;s<c.length;s+=1)for(var m=0,_=c[s];m<_.length;m+=1)if(a===_[m])return!0;return!1},Oc.prototype.getId=function(a,s){var c=a.id;return this.promoteId&&typeof(c=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(c=Number(c)),c},cn("FeatureIndex",Oc,{omit:["rawTileData","sourceLayerCoder"]});var jo=function(a,s){this.tileID=a,this.uid=Jt(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};jo.prototype.registerFadeDuration=function(a){var s=a+this.timeAdded;s<Bn.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},jo.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},jo.prototype.loadVectorData=function(a,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var m in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(B,G){var $={};if(!G)return $;for(var re=function(){var Me=ke[ue],Xe=Me.layerIds.map(function(It){return G.getLayer(It)}).filter(Boolean);if(Xe.length!==0){Me.layers=Xe,Me.stateDependentLayerIds&&(Me.stateDependentLayers=Me.stateDependentLayerIds.map(function(It){return Xe.filter(function(Nt){return Nt.id===It})[0]}));for(var Ve=0,st=Xe;Ve<st.length;Ve+=1)$[st[Ve].id]=Me}},ue=0,ke=B;ue<ke.length;ue+=1)re();return $}(a.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[m];if(_ instanceof Dt){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var E=this.buckets[b];if(E instanceof Dt&&E.hasRTLText){this.hasRTLText=!0,Rs.isLoading()||Rs.isLoaded()||xc()!=="deferred"||cs();break}}for(var M in this.queryPadding=0,this.buckets){var O=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(M).queryRadius(O))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},jo.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},jo.prototype.getBucket=function(a){return this.buckets[a.id]},jo.prototype.upload=function(a){for(var s in this.buckets){var c=this.buckets[s];c.uploadPending()&&c.upload(a)}var m=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Vf(a,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Vf(a,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},jo.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},jo.prototype.queryRenderedFeatures=function(a,s,c,m,_,b,E,M,O,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:_,scale:b,tileSize:this.tileSize,pixelPosMatrix:B,transform:M,params:E,queryPadding:this.queryPadding*O},a,s,c):{}},jo.prototype.querySourceFeatures=function(a,s){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var m=c.loadVTLayers(),_=s?s.sourceLayer:"",b=m._geojsonTileLayer||m[_];if(b)for(var E=jl(s&&s.filter),M=this.tileID.canonical,O=M.z,B=M.x,G=M.y,$={z:O,x:B,y:G},re=0;re<b.length;re++){var ue=b.feature(re);if(E.needGeometry){var ke=Ia(ue,!0);if(!E.filter(new pi(this.tileID.overscaledZ),ke,this.tileID.canonical))continue}else if(!E.filter(new pi(this.tileID.overscaledZ),ue))continue;var Me=c.getId(ue,_),Xe=new Zp(ue,O,B,G,Me);Xe.tile=$,a.push(Xe)}}},jo.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},jo.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},jo.prototype.setExpiryData=function(a){var s=this.expirationTime;if(a.cacheControl){var c=Ie(a.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var m=Date.now(),_=!1;if(this.expirationTime>m)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{var b=this.expirationTime-s;b?this.expirationTime=m+Math.max(b,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},jo.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},jo.prototype.setFeatureState=function(a,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(s.style.hasLayer(m)){var _=this.buckets[m],b=_.layers[0].sourceLayer||"_geojsonTileLayer",E=c[b],M=a[b];if(E&&M&&Object.keys(M).length!==0){_.update(M,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});var O=s&&s.style&&s.style.getLayer(m);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(_)))}}}},jo.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},jo.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Bn.now()},jo.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},jo.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Bn.now()+a},jo.prototype.setDependencies=function(a,s){for(var c={},m=0,_=s;m<_.length;m+=1)c[_[m]]=!0;this.dependencies[a]=c},jo.prototype.hasDependency=function(a,s){for(var c=0,m=a;c<m.length;c+=1){var _=this.dependencies[m[c]];if(_){for(var b=0,E=s;b<E.length;b+=1)if(_[E[b]])return!0}}return!1};var Dc=se.performance,Ld=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Dc.mark(this._marks.start)};Ld.prototype.finish=function(){Dc.mark(this._marks.end);var a=Dc.getEntriesByName(this._marks.measure);return a.length===0&&(Dc.measure(this._marks.measure,this._marks.start,this._marks.end),a=Dc.getEntriesByName(this._marks.measure),Dc.clearMarks(this._marks.start),Dc.clearMarks(this._marks.end),Dc.clearMeasures(this._marks.measure)),a},y.Actor=jf,y.AlphaImage=du,y.CanonicalTileID=Gf,y.CollisionBoxArray=d,y.Color=Qn,y.DEMData=Rc,y.DataConstantProperty=An,y.DictionaryCoder=Np,y.EXTENT=8192,y.ErrorEvent=Ke,y.EvaluationParameters=pi,y.Event=Le,y.Evented=it,y.FeatureIndex=Oc,y.FillBucket=Qa,y.FillExtrusionBucket=mu,y.ImageAtlas=qe,y.ImagePosition=at,y.LineBucket=hs,y.LngLat=Aa,y.LngLatBounds=Co,y.MercatorCoordinate=hf,y.ONE_EM=24,y.OverscaledTileID=To,y.Point=oe,y.Point$1=oe,y.Properties=bo,y.Protobuf=xe,y.RGBAImage=za,y.RequestManager=Mi,y.RequestPerformance=Ld,y.ResourceType=pn,y.SegmentVector=de,y.SourceFeatureState=wh,y.StructArrayLayout1ui2=Nf,y.StructArrayLayout2f1f2i16=qu,y.StructArrayLayout2i4=Xu,y.StructArrayLayout3ui6=Ku,y.StructArrayLayout4i8=zf,y.SymbolBucket=Dt,y.Texture=Vf,y.Tile=jo,y.Transitionable=zi,y.Uniform1f=Zr,y.Uniform1i=hr,y.Uniform2f=kr,y.Uniform3f=rn,y.Uniform4f=Cn,y.UniformColor=Ln,y.UniformMatrix4f=Ci,y.UnwrappedTileID=jv,y.ValidationError=Oe,y.WritingMode=Rn,y.ZoomHistory=Gs,y.add=function(a,s,c){return a[0]=s[0]+c[0],a[1]=s[1]+c[1],a[2]=s[2]+c[2],a},y.addDynamicAttributes=Se,y.asyncAll=function(a,s,c){if(!a.length)return c(null,[]);var m=a.length,_=new Array(a.length),b=null;a.forEach(function(E,M){s(E,function(O,B){O&&(b=O),_[M]=B,--m==0&&c(b,_)})})},y.bezier=et,y.bindAll=Dr,y.browser=Bn,y.cacheEntryPossiblyAdded=function(a){++Sn>ir&&(a.getActor().send("enforceCacheSizeLimit",Et),Sn=0)},y.clamp=Ct,y.clearTileCache=function(a){var s=se.caches.delete("mapbox-tiles");a&&s.catch(a).then(function(){return a()})},y.clipLine=Un,y.clone=function(a){var s=new ki(16);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s},y.clone$1=nt,y.clone$2=function(a){var s=new ki(3);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s},y.collisionCircleLayout=Cd,y.config=tn,y.create=function(){var a=new ki(16);return ki!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},y.create$1=function(){var a=new ki(9);return ki!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},y.create$2=function(){var a=new ki(4);return ki!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},y.createCommonjsModule=le,y.createExpression=Ul,y.createLayout=ra,y.createStyleLayer=function(a){return a.type==="custom"?new Za(a):new Cs[a.type](a)},y.cross=function(a,s,c){var m=s[0],_=s[1],b=s[2],E=c[0],M=c[1],O=c[2];return a[0]=_*O-b*M,a[1]=b*E-m*O,a[2]=m*M-_*E,a},y.deepEqual=function a(s,c){if(Array.isArray(s)){if(!Array.isArray(c)||s.length!==c.length)return!1;for(var m=0;m<s.length;m++)if(!a(s[m],c[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&c!==null){if(typeof c!="object"||Object.keys(s).length!==Object.keys(c).length)return!1;for(var _ in s)if(!a(s[_],c[_]))return!1;return!0}return s===c},y.dot=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]},y.dot$1=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]+a[3]*s[3]},y.ease=ut,y.emitValidationErrors=uu,y.endsWith=fr,y.enforceCacheSizeLimit=function(a){xr(),ne&&ne.then(function(s){s.keys().then(function(c){for(var m=0;m<c.length-a;m++)s.delete(c[m])})})},y.evaluateSizeForFeature=to,y.evaluateSizeForZoom=fo,y.evaluateVariableOffset=Ye,y.evented=hh,y.extend=Yt,y.featureFilter=jl,y.filterObject=mt,y.fromRotation=function(a,s){var c=Math.sin(s),m=Math.cos(s);return a[0]=m,a[1]=c,a[2]=0,a[3]=-c,a[4]=m,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},y.getAnchorAlignment=Na,y.getAnchorJustification=dt,y.getArrayBuffer=rs,y.getImage=K,y.getJSON=function(a,s){return go(Yt(a,{type:"json"}),s)},y.getRTLTextPluginStatus=xc,y.getReferrer=Nn,y.getVideo=function(a,s){var c,m,_=se.document.createElement("video");_.muted=!0,_.onloadstart=function(){s(null,_)};for(var b=0;b<a.length;b++){var E=se.document.createElement("source");c=a[b],m=void 0,(m=se.document.createElement("a")).href=c,(m.protocol!==se.document.location.protocol||m.host!==se.document.location.host)&&(_.crossOrigin="Anonymous"),E.src=a[b],_.appendChild(E)}return{cancel:function(){}}},y.identity=co,y.invert=function(a,s){var c=s[0],m=s[1],_=s[2],b=s[3],E=s[4],M=s[5],O=s[6],B=s[7],G=s[8],$=s[9],re=s[10],ue=s[11],ke=s[12],Me=s[13],Xe=s[14],Ve=s[15],st=c*M-m*E,It=c*O-_*E,Nt=c*B-b*E,Ht=m*O-_*M,or=m*B-b*M,Fr=_*B-b*O,Kr=G*Me-$*ke,Pn=G*Xe-re*ke,on=G*Ve-ue*ke,Or=$*Xe-re*Me,cr=$*Ve-ue*Me,di=re*Ve-ue*Xe,Xn=st*di-It*cr+Nt*Or+Ht*on-or*Pn+Fr*Kr;return Xn?(a[0]=(M*di-O*cr+B*Or)*(Xn=1/Xn),a[1]=(_*cr-m*di-b*Or)*Xn,a[2]=(Me*Fr-Xe*or+Ve*Ht)*Xn,a[3]=(re*or-$*Fr-ue*Ht)*Xn,a[4]=(O*on-E*di-B*Pn)*Xn,a[5]=(c*di-_*on+b*Pn)*Xn,a[6]=(Xe*Nt-ke*Fr-Ve*It)*Xn,a[7]=(G*Fr-re*Nt+ue*It)*Xn,a[8]=(E*cr-M*on+B*Kr)*Xn,a[9]=(m*on-c*cr-b*Kr)*Xn,a[10]=(ke*or-Me*Nt+Ve*st)*Xn,a[11]=($*Nt-G*or-ue*st)*Xn,a[12]=(M*Pn-E*Or-O*Kr)*Xn,a[13]=(c*Or-m*Pn+_*Kr)*Xn,a[14]=(Me*It-ke*Ht-Xe*st)*Xn,a[15]=(G*Ht-$*It+re*st)*Xn,a):null},y.isChar=Pr,y.isMapboxURL=Ei,y.keysDifference=function(a,s){var c=[];for(var m in a)m in s||c.push(m);return c},y.makeRequest=go,y.mapObject=sr,y.mercatorXfromLng=Id,y.mercatorYfromLat=Pd,y.mercatorZfromAltitude=Vv,y.mul=tl,y.multiply=wo,y.mvt=il,y.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},y.normalize=function(a,s){var c=s[0],m=s[1],_=s[2],b=c*c+m*m+_*_;return b>0&&(b=1/Math.sqrt(b)),a[0]=s[0]*b,a[1]=s[1]*b,a[2]=s[2]*b,a},y.number=wa,y.offscreenCanvasSupported=En,y.ortho=function(a,s,c,m,_,b,E){var M=1/(s-c),O=1/(m-_),B=1/(b-E);return a[0]=-2*M,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*O,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*B,a[11]=0,a[12]=(s+c)*M,a[13]=(_+m)*O,a[14]=(E+b)*B,a[15]=1,a},y.parseGlyphPBF=function(a){return new xe(a).readFields(vr,[])},y.pbf=xe,y.performSymbolLayout=function(a,s,c,m,_,b,E){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var M=a.layers[0].layout,O=a.layers[0]._unevaluatedLayout._values,B={};if(a.textSizeData.kind==="composite"){var G=a.textSizeData,$=G.maxZoom;B.compositeTextSizes=[O["text-size"].possiblyEvaluate(new pi(G.minZoom),E),O["text-size"].possiblyEvaluate(new pi($),E)]}if(a.iconSizeData.kind==="composite"){var re=a.iconSizeData,ue=re.maxZoom;B.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new pi(re.minZoom),E),O["icon-size"].possiblyEvaluate(new pi(ue),E)]}B.layoutTextSize=O["text-size"].possiblyEvaluate(new pi(a.zoom+1),E),B.layoutIconSize=O["icon-size"].possiblyEvaluate(new pi(a.zoom+1),E),B.textMaxSize=O["text-size"].possiblyEvaluate(new pi(18));for(var ke=24*M.get("text-line-height"),Me=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Xe=M.get("text-keep-upright"),Ve=M.get("text-size"),st=function(){var Ht=Nt[It],or=M.get("text-font").evaluate(Ht,{},E).join(","),Fr=Ve.evaluate(Ht,{},E),Kr=B.layoutTextSize.evaluate(Ht,{},E),Pn=B.layoutIconSize.evaluate(Ht,{},E),on={horizontal:{},vertical:void 0},Or=Ht.text,cr=[0,0];if(Or){var di=Or.toString(),Xn=24*M.get("text-letter-spacing").evaluate(Ht,{},E),wn=function(Li){for(var ca=0,na=Li;ca<na.length;ca+=1)if(ji=na[ca].charCodeAt(0),Pr.Arabic(ji)||Pr["Arabic Supplement"](ji)||Pr["Arabic Extended-A"](ji)||Pr["Arabic Presentation Forms-A"](ji)||Pr["Arabic Presentation Forms-B"](ji))return!1;var ji;return!0}(di)?Xn:0,Ti=M.get("text-anchor").evaluate(Ht,{},E),ci=M.get("text-variable-anchor");if(!ci){var Ui=M.get("text-radial-offset").evaluate(Ht,{},E);cr=Ui?Ye(Ti,[24*Ui,pe]):M.get("text-offset").evaluate(Ht,{},E).map(function(Li){return 24*Li})}var Fn=Me?"center":M.get("text-justify").evaluate(Ht,{},E),Yi=M.get("symbol-placement"),ka=Yi==="point"?24*M.get("text-max-width").evaluate(Ht,{},E):0,no=function(){a.allowVerticalPlacement&&Ff(di)&&(on.vertical=ur(Or,s,c,_,or,ka,ke,Ti,"left",wn,cr,Rn.vertical,!0,Yi,Kr,Fr))};if(!Me&&ci){for(var Ya=Fn==="auto"?ci.map(function(Li){return dt(Li)}):[Fn],La=!1,io=0;io<Ya.length;io++){var Go=Ya[io];if(!on.horizontal[Go])if(La)on.horizontal[Go]=on.horizontal[0];else{var Lo=ur(Or,s,c,_,or,ka,ke,"center",Go,wn,cr,Rn.horizontal,!1,Yi,Kr,Fr);Lo&&(on.horizontal[Go]=Lo,La=Lo.positionedLines.length===1)}}no()}else{Fn==="auto"&&(Fn=dt(Ti));var Ts=ur(Or,s,c,_,or,ka,ke,Ti,Fn,wn,cr,Rn.horizontal,!1,Yi,Kr,Fr);Ts&&(on.horizontal[Fn]=Ts),no(),Ff(di)&&Me&&Xe&&(on.vertical=ur(Or,s,c,_,or,ka,ke,Ti,Fn,wn,cr,Rn.vertical,!1,Yi,Kr,Fr))}}var Xo=void 0,Ms=!1;if(Ht.icon&&Ht.icon.name){var ho=m[Ht.icon.name];ho&&(Xo=function(Li,ca,na){var ji=Na(na),Bs=ca[0]-Li.displaySize[0]*ji.horizontalAlign,ps=ca[1]-Li.displaySize[1]*ji.verticalAlign;return{image:Li,top:ps,bottom:ps+Li.displaySize[1],left:Bs,right:Bs+Li.displaySize[0]}}(_[Ht.icon.name],M.get("icon-offset").evaluate(Ht,{},E),M.get("icon-anchor").evaluate(Ht,{},E)),Ms=ho.sdf,a.sdfIcons===void 0?a.sdfIcons=ho.sdf:a.sdfIcons!==ho.sdf&&lt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ho.pixelRatio!==a.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var qo=Ze(on.horizontal)||on.vertical;a.iconsInText=!!qo&&qo.iconsInText,(qo||Xo)&&function(Li,ca,na,ji,Bs,ps,Ca,Xa,ds,Xi,Fc){var ku=ps.textMaxSize.evaluate(ca,{});ku===void 0&&(ku=Ca);var Bc,po=Li.layers[0].layout,zc=po.get("icon-offset").evaluate(ca,{},Fc),Ml=Ze(na.horizontal),Qh=Ca/24,Eh=Li.tilePixelRatio*Qh,ep=Li.tilePixelRatio*ku/24,pf=Li.tilePixelRatio*Xa,tp=Li.tilePixelRatio*po.get("symbol-spacing"),Ah=po.get("text-padding")*Li.tilePixelRatio,Ch=po.get("icon-padding")*Li.tilePixelRatio,Th=po.get("text-max-angle")/180*Math.PI,rp=po.get("text-rotation-alignment")==="map"&&po.get("symbol-placement")!=="point",Nc=po.get("icon-rotation-alignment")==="map"&&po.get("symbol-placement")!=="point",Qs=po.get("symbol-placement"),Mh=tp/2,Hf=po.get("icon-text-fit");ji&&Hf!=="none"&&(Li.allowVerticalPlacement&&na.vertical&&(Bc=wi(ji,na.vertical,Hf,po.get("icon-text-fit-padding"),zc,Qh)),Ml&&(ji=wi(ji,Ml,Hf,po.get("icon-text-fit-padding"),zc,Qh)));var Zc=function(Hm,lp){lp.x<0||lp.x>=8192||lp.y<0||lp.y>=8192||function(q,al,$v,Uc,Hp,Fd,cp,Il,oc,kh,fp,hp,Wp,Bd,pp,Yv,zd,Nd,Zd,Ud,eu,mf,Vd,Pl,Xv){var $p,Xf,qf,Lh,Rh,Kf=q.addToLineVertexArray(al,$v),qv=0,ol=0,Kv=0,Jv=0,jd=-1,Gd=-1,Lu={},Hd=Ae(""),Yp=0,Xp=0;if(Il._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Yp=($p=Il.layout.get("text-offset").evaluate(eu,{},Pl).map(function(Vc){return 24*Vc}))[0],Xp=$p[1]):(Yp=24*Il.layout.get("text-radial-offset").evaluate(eu,{},Pl),Xp=pe),q.allowVerticalPlacement&&Uc.vertical){var qp=Il.layout.get("text-rotate").evaluate(eu,{},Pl)+90;Lh=new Pe(oc,al,kh,fp,hp,Uc.vertical,Wp,Bd,pp,qp),cp&&(Rh=new Pe(oc,al,kh,fp,hp,cp,zd,Nd,pp,qp))}if(Hp){var Kp=Il.layout.get("icon-rotate").evaluate(eu,{}),Qv=Il.layout.get("icon-text-fit")!=="none",em=xi(Hp,Kp,Vd,Qv),dp=cp?xi(cp,Kp,Vd,Qv):void 0;qf=new Pe(oc,al,kh,fp,hp,Hp,zd,Nd,!1,Kp),qv=4*em.length;var Jp=q.iconSizeData,Jf=null;Jp.kind==="source"?(Jf=[128*Il.layout.get("icon-size").evaluate(eu,{})])[0]>32640&&lt(q.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Jp.kind==="composite"&&((Jf=[128*mf.compositeIconSizes[0].evaluate(eu,{},Pl),128*mf.compositeIconSizes[1].evaluate(eu,{},Pl)])[0]>32640||Jf[1]>32640)&&lt(q.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),q.addSymbols(q.icon,em,Jf,Ud,Zd,eu,!1,al,Kf.lineStartIndex,Kf.lineLength,-1,Pl),jd=q.icon.placedSymbolArray.length-1,dp&&(ol=4*dp.length,q.addSymbols(q.icon,dp,Jf,Ud,Zd,eu,Rn.vertical,al,Kf.lineStartIndex,Kf.lineLength,-1,Pl),Gd=q.icon.placedSymbolArray.length-1)}for(var vp in Uc.horizontal){var Qf=Uc.horizontal[vp];if(!Xf){Hd=Ae(Qf.text);var Wd=Il.layout.get("text-rotate").evaluate(eu,{},Pl);Xf=new Pe(oc,al,kh,fp,hp,Qf,Wp,Bd,pp,Wd)}var Qp=Qf.positionedLines.length===1;if(Kv+=yt(q,al,Qf,Fd,Il,pp,eu,Yv,Kf,Uc.vertical?Rn.horizontal:Rn.horizontalOnly,Qp?Object.keys(Uc.horizontal):[vp],Lu,jd,mf,Pl),Qp)break}Uc.vertical&&(Jv+=yt(q,al,Uc.vertical,Fd,Il,pp,eu,Yv,Kf,Rn.vertical,["vertical"],Lu,Gd,mf,Pl));var ed=Xf?Xf.boxStartIndex:q.collisionBoxArray.length,mp=Xf?Xf.boxEndIndex:q.collisionBoxArray.length,_u=Lh?Lh.boxStartIndex:q.collisionBoxArray.length,$d=Lh?Lh.boxEndIndex:q.collisionBoxArray.length,Yd=qf?qf.boxStartIndex:q.collisionBoxArray.length,gf=qf?qf.boxEndIndex:q.collisionBoxArray.length,Wm=Rh?Rh.boxStartIndex:q.collisionBoxArray.length,$m=Rh?Rh.boxEndIndex:q.collisionBoxArray.length,sc=-1,gp=function(Vc,tm){return Vc&&Vc.circleDiameter?Math.max(Vc.circleDiameter,tm):tm};sc=gp(Xf,sc),sc=gp(Lh,sc),sc=gp(qf,sc);var Xd=(sc=gp(Rh,sc))>-1?1:0;Xd&&(sc*=Xv/24),q.glyphOffsetArray.length>=Dt.MAX_GLYPHS&&lt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),eu.sortKey!==void 0&&q.addToSortKeyRanges(q.symbolInstances.length,eu.sortKey),q.symbolInstances.emplaceBack(al.x,al.y,Lu.right>=0?Lu.right:-1,Lu.center>=0?Lu.center:-1,Lu.left>=0?Lu.left:-1,Lu.vertical||-1,jd,Gd,Hd,ed,mp,_u,$d,Yd,gf,Wm,$m,kh,Kv,Jv,qv,ol,Xd,0,Wp,Yp,Xp,sc)}(Li,lp,Hm,na,ji,Bs,Bc,Li.layers[0],Li.collisionBoxArray,ca.index,ca.sourceLayerIndex,Li.index,Eh,Ah,rp,ds,pf,Ch,Nc,zc,ca,ps,Xi,Fc,Ca)};if(Qs==="line")for(var df=0,np=Un(ca.geometry,0,0,8192,8192);df<np.length;df+=1)for(var jp=np[df],ip=0,Ih=Wi(jp,tp,Th,na.vertical||Ml,ji,24,ep,Li.overscaling,8192);ip<Ih.length;ip+=1){var ap=Ih[ip];Ml&&He(Li,Ml.text,Mh,ap)||Zc(jp,ap)}else if(Qs==="line-center")for(var op=0,sp=ca.geometry;op<sp.length;op+=1){var up=sp[op];if(up.length>1){var Gp=Yo(up,Th,na.vertical||Ml,ji,24,ep);Gp&&Zc(up,Gp)}}else if(ca.type==="Polygon")for(var ac=0,vs=El(ca.geometry,0);ac<vs.length;ac+=1){var Wf=vs[ac],Ph=fn(Wf,16);Zc(Wf[0],new Ea(Ph.x,Ph.y,0))}else if(ca.type==="LineString")for(var vf=0,$f=ca.geometry;vf<$f.length;vf+=1){var Yf=$f[vf];Zc(Yf,new Ea(Yf[0].x,Yf[0].y,0))}else if(ca.type==="Point")for(var Rd=0,Hv=ca.geometry;Rd<Hv.length;Rd+=1)for(var Od=0,Wv=Hv[Rd];Od<Wv.length;Od+=1){var Dd=Wv[Od];Zc([Dd],new Ea(Dd.x,Dd.y,0))}}(a,Ht,on,Xo,m,B,Kr,Pn,cr,Ms,E)},It=0,Nt=a.features;It<Nt.length;It+=1)st();b&&a.generateCollisionDebugBuffers()},y.perspective=function(a,s,c,m,_){var b,E=1/Math.tan(s/2);return a[0]=E/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=E,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,_!=null&&_!==1/0?(a[10]=(_+m)*(b=1/(m-_)),a[14]=2*_*m*b):(a[10]=-1,a[14]=-2*m),a},y.pick=function(a,s){for(var c={},m=0;m<s.length;m++){var _=s[m];_ in a&&(c[_]=a[_])}return c},y.plugin=Rs,y.polygonIntersectsPolygon=Qu,y.postMapLoadEvent=Ne,y.postTurnstileEvent=zt,y.potpack=Gr,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=cn,y.registerForPluginStateChange=function(a){return a({pluginStatus:Bo,pluginURL:Cu}),hh.on("pluginStateChange",a),a},y.renderColorRamp=Ip,y.rotate=function(a,s,c){var m=s[0],_=s[1],b=s[2],E=s[3],M=Math.sin(c),O=Math.cos(c);return a[0]=m*O+b*M,a[1]=_*O+E*M,a[2]=m*-M+b*O,a[3]=_*-M+E*O,a},y.rotateX=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),b=s[4],E=s[5],M=s[6],O=s[7],B=s[8],G=s[9],$=s[10],re=s[11];return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[4]=b*_+B*m,a[5]=E*_+G*m,a[6]=M*_+$*m,a[7]=O*_+re*m,a[8]=B*_-b*m,a[9]=G*_-E*m,a[10]=$*_-M*m,a[11]=re*_-O*m,a},y.rotateZ=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),b=s[0],E=s[1],M=s[2],O=s[3],B=s[4],G=s[5],$=s[6],re=s[7];return s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[0]=b*_+B*m,a[1]=E*_+G*m,a[2]=M*_+$*m,a[3]=O*_+re*m,a[4]=B*_-b*m,a[5]=G*_-E*m,a[6]=$*_-M*m,a[7]=re*_-O*m,a},y.scale=function(a,s,c){var m=c[0],_=c[1],b=c[2];return a[0]=s[0]*m,a[1]=s[1]*m,a[2]=s[2]*m,a[3]=s[3]*m,a[4]=s[4]*_,a[5]=s[5]*_,a[6]=s[6]*_,a[7]=s[7]*_,a[8]=s[8]*b,a[9]=s[9]*b,a[10]=s[10]*b,a[11]=s[11]*b,a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},y.scale$1=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a[3]=s[3]*c,a},y.scale$2=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a},y.setCacheLimits=function(a,s){Et=a,ir=s},y.setRTLTextPlugin=function(a,s,c){if(c===void 0&&(c=!1),Bo==="deferred"||Bo==="loading"||Bo==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Cu=Bn.resolveURL(a),Bo="deferred",$l=s,gl(),c||cs()},y.sphericalToCartesian=function(a){var s=a[0],c=a[1],m=a[2];return c+=90,c*=Math.PI/180,m*=Math.PI/180,{x:s*Math.cos(c)*Math.sin(m),y:s*Math.sin(c)*Math.sin(m),z:s*Math.cos(m)}},y.sqrLen=function(a){var s=a[0],c=a[1];return s*s+c*c},y.styleSpec=he,y.sub=function(a,s,c){return a[0]=s[0]-c[0],a[1]=s[1]-c[1],a[2]=s[2]-c[2],a},y.symbolSize=Ao,y.transformMat3=function(a,s,c){var m=s[0],_=s[1],b=s[2];return a[0]=m*c[0]+_*c[3]+b*c[6],a[1]=m*c[1]+_*c[4]+b*c[7],a[2]=m*c[2]+_*c[5]+b*c[8],a},y.transformMat4=Fs,y.translate=function(a,s,c){var m,_,b,E,M,O,B,G,$,re,ue,ke,Me=c[0],Xe=c[1],Ve=c[2];return s===a?(a[12]=s[0]*Me+s[4]*Xe+s[8]*Ve+s[12],a[13]=s[1]*Me+s[5]*Xe+s[9]*Ve+s[13],a[14]=s[2]*Me+s[6]*Xe+s[10]*Ve+s[14],a[15]=s[3]*Me+s[7]*Xe+s[11]*Ve+s[15]):(_=s[1],b=s[2],E=s[3],M=s[4],O=s[5],B=s[6],G=s[7],$=s[8],re=s[9],ue=s[10],ke=s[11],a[0]=m=s[0],a[1]=_,a[2]=b,a[3]=E,a[4]=M,a[5]=O,a[6]=B,a[7]=G,a[8]=$,a[9]=re,a[10]=ue,a[11]=ke,a[12]=m*Me+M*Xe+$*Ve+s[12],a[13]=_*Me+O*Xe+re*Ve+s[13],a[14]=b*Me+B*Xe+ue*Ve+s[14],a[15]=E*Me+G*Xe+ke*Ve+s[15]),a},y.triggerPluginCompletionEvent=tf,y.uniqueId=Jt,y.validateCustomStyleLayer=function(a){var s=[],c=a.id;return c===void 0&&s.push({message:"layers."+c+': missing required property "id"'}),a.render===void 0&&s.push({message:"layers."+c+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&s.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=Vh,y.validateStyle=Qc,y.values=function(a){var s=[];for(var c in a)s.push(a[c]);return s},y.vectorTile=il,y.version="1.13.3",y.warnOnce=lt,y.webpSupported=gn,y.window=se,y.wrap=Kt}),ee(["./shared"],function(y){"use strict";function le(W){var K=typeof W;if(K==="number"||K==="boolean"||K==="string"||W==null)return JSON.stringify(W);if(Array.isArray(W)){for(var ie="[",_e=0,Le=W;_e<Le.length;_e+=1)ie+=le(Le[_e])+",";return ie+"]"}for(var Ke=Object.keys(W).sort(),it="{",he=0;he<Ke.length;he++)it+=JSON.stringify(Ke[he])+":"+le(W[Ke[he]])+",";return it+"}"}function U(W){for(var K="",ie=0,_e=y.refProperties;ie<_e.length;ie+=1)K+="/"+le(W[_e[ie]]);return K}var ce=function(W){this.keyCache={},W&&this.replace(W)};ce.prototype.replace=function(W){this._layerConfigs={},this._layers={},this.update(W,[])},ce.prototype.update=function(W,K){for(var ie=this,_e=0,Le=W;_e<Le.length;_e+=1){var Ke=Le[_e];this._layerConfigs[Ke.id]=Ke;var it=this._layers[Ke.id]=y.createStyleLayer(Ke);it._featureFilter=y.featureFilter(it.filter),this.keyCache[Ke.id]&&delete this.keyCache[Ke.id]}for(var he=0,Oe=K;he<Oe.length;he+=1){var wt=Oe[he];delete this.keyCache[wt],delete this._layerConfigs[wt],delete this._layers[wt]}this.familiesBySource={};for(var br=0,Mr=function(qr,Q){for(var ri={},en=0;en<qr.length;en++){var Jn=Q&&Q[qr[en].id]||U(qr[en]);Q&&(Q[qr[en].id]=Jn);var Zi=ri[Jn];Zi||(Zi=ri[Jn]=[]),Zi.push(qr[en])}var ni=[];for(var Ii in ri)ni.push(ri[Ii]);return ni}(y.values(this._layerConfigs),this.keyCache);br<Mr.length;br+=1){var Rt=Mr[br].map(function(qr){return ie._layers[qr.id]}),mr=Rt[0];if(mr.visibility!=="none"){var mn=mr.source||"",sn=this.familiesBySource[mn];sn||(sn=this.familiesBySource[mn]={});var Qt=mr.sourceLayer||"_geojsonTileLayer",je=sn[Qt];je||(je=sn[Qt]=[]),je.push(Rt)}}};var oe=function(W){var K={},ie=[];for(var _e in W){var Le=W[_e],Ke=K[_e]={};for(var it in Le){var he=Le[+it];if(he&&he.bitmap.width!==0&&he.bitmap.height!==0){var Oe={x:0,y:0,w:he.bitmap.width+2,h:he.bitmap.height+2};ie.push(Oe),Ke[it]={rect:Oe,metrics:he.metrics}}}}var wt=y.potpack(ie),br=new y.AlphaImage({width:wt.w||1,height:wt.h||1});for(var Mr in W){var Rt=W[Mr];for(var mr in Rt){var mn=Rt[+mr];if(mn&&mn.bitmap.width!==0&&mn.bitmap.height!==0){var sn=K[Mr][mr].rect;y.AlphaImage.copy(mn.bitmap,br,{x:0,y:0},{x:sn.x+1,y:sn.y+1},mn.bitmap)}}}this.image=br,this.positions=K};y.register("GlyphAtlas",oe);var Ue=function(W){this.tileID=new y.OverscaledTileID(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId};function se(W,K,ie){for(var _e=new y.EvaluationParameters(K),Le=0,Ke=W;Le<Ke.length;Le+=1)Ke[Le].recalculate(_e,ie)}function ze(W,K){var ie=y.getArrayBuffer(W.request,function(_e,Le,Ke,it){_e?K(_e):Le&&K(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(Le)),rawData:Le,cacheControl:Ke,expires:it})});return function(){ie.cancel(),K()}}Ue.prototype.parse=function(W,K,ie,_e,Le){var Ke=this;this.status="parsing",this.data=W,this.collisionBoxArray=new y.CollisionBoxArray;var it=new y.DictionaryCoder(Object.keys(W.layers).sort()),he=new y.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];var Oe,wt,br,Mr,Rt={},mr={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ie},mn=K.familiesBySource[this.source];for(var sn in mn){var Qt=W.layers[sn];if(Qt){Qt.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+sn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var je=it.encode(sn),qr=[],Q=0;Q<Qt.length;Q++){var ri=Qt.feature(Q),en=he.getId(ri,sn);qr.push({feature:ri,id:en,index:Q,sourceLayerIndex:je})}for(var Jn=0,Zi=mn[sn];Jn<Zi.length;Jn+=1){var ni=Zi[Jn],Ii=ni[0];Ii.minzoom&&this.zoom<Math.floor(Ii.minzoom)||Ii.maxzoom&&this.zoom>=Ii.maxzoom||Ii.visibility!=="none"&&(se(ni,this.zoom,ie),(Rt[Ii.id]=Ii.createBucket({index:he.bucketLayerIDs.length,layers:ni,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:je,sourceID:this.source})).populate(qr,mr,this.tileID.canonical),he.bucketLayerIDs.push(ni.map(function(vi){return vi.id})))}}}var hi=y.mapObject(mr.glyphDependencies,function(vi){return Object.keys(vi).map(Number)});Object.keys(hi).length?_e.send("getGlyphs",{uid:this.uid,stacks:hi},function(vi,si){Oe||(Oe=vi,wt=si,ea.call(Ke))}):wt={};var yo=Object.keys(mr.iconDependencies);yo.length?_e.send("getImages",{icons:yo,source:this.source,tileID:this.tileID,type:"icons"},function(vi,si){Oe||(Oe=vi,br=si,ea.call(Ke))}):br={};var Fi=Object.keys(mr.patternDependencies);function ea(){if(Oe)return Le(Oe);if(wt&&br&&Mr){var vi=new oe(wt),si=new y.ImageAtlas(br,Mr);for(var Qn in Rt){var ba=Rt[Qn];ba instanceof y.SymbolBucket?(se(ba.layers,this.zoom,ie),y.performSymbolLayout(ba,wt,vi.positions,br,si.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ba.hasPattern&&(ba instanceof y.LineBucket||ba instanceof y.FillBucket||ba instanceof y.FillExtrusionBucket)&&(se(ba.layers,this.zoom,ie),ba.addFeatures(mr,this.tileID.canonical,si.patternPositions))}this.status="done",Le(null,{buckets:y.values(Rt).filter(function(Is){return!Is.isEmpty()}),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vi.image,imageAtlas:si,glyphMap:this.returnDependencies?wt:null,iconMap:this.returnDependencies?br:null,glyphPositions:this.returnDependencies?vi.positions:null})}}Fi.length?_e.send("getImages",{icons:Fi,source:this.source,tileID:this.tileID,type:"patterns"},function(vi,si){Oe||(Oe=vi,Mr=si,ea.call(Ke))}):Mr={},ea.call(this)};var et=function(W,K,ie,_e){this.actor=W,this.layerIndex=K,this.availableImages=ie,this.loadVectorData=_e||ze,this.loading={},this.loaded={}};et.prototype.loadTile=function(W,K){var ie=this,_e=W.uid;this.loading||(this.loading={});var Le=!!(W&&W.request&&W.request.collectResourceTiming)&&new y.RequestPerformance(W.request),Ke=this.loading[_e]=new Ue(W);Ke.abort=this.loadVectorData(W,function(it,he){if(delete ie.loading[_e],it||!he)return Ke.status="done",ie.loaded[_e]=Ke,K(it);var Oe=he.rawData,wt={};he.expires&&(wt.expires=he.expires),he.cacheControl&&(wt.cacheControl=he.cacheControl);var br={};if(Le){var Mr=Le.finish();Mr&&(br.resourceTiming=JSON.parse(JSON.stringify(Mr)))}Ke.vectorTile=he.vectorTile,Ke.parse(he.vectorTile,ie.layerIndex,ie.availableImages,ie.actor,function(Rt,mr){if(Rt||!mr)return K(Rt);K(null,y.extend({rawTileData:Oe.slice(0)},mr,wt,br))}),ie.loaded=ie.loaded||{},ie.loaded[_e]=Ke})},et.prototype.reloadTile=function(W,K){var ie=this,_e=this.loaded,Le=W.uid,Ke=this;if(_e&&_e[Le]){var it=_e[Le];it.showCollisionBoxes=W.showCollisionBoxes;var he=function(Oe,wt){var br=it.reloadCallback;br&&(delete it.reloadCallback,it.parse(it.vectorTile,Ke.layerIndex,ie.availableImages,Ke.actor,br)),K(Oe,wt)};it.status==="parsing"?it.reloadCallback=he:it.status==="done"&&(it.vectorTile?it.parse(it.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}},et.prototype.abortTile=function(W,K){var ie=this.loading,_e=W.uid;ie&&ie[_e]&&ie[_e].abort&&(ie[_e].abort(),delete ie[_e]),K()},et.prototype.removeTile=function(W,K){var ie=this.loaded,_e=W.uid;ie&&ie[_e]&&delete ie[_e],K()};var ut=y.window.ImageBitmap,Ct=function(){this.loaded={}};function Kt(W,K){if(W.length!==0){Yt(W[0],K);for(var ie=1;ie<W.length;ie++)Yt(W[ie],!K)}}function Yt(W,K){for(var ie=0,_e=0,Le=0,Ke=W.length,it=Ke-1;Le<Ke;it=Le++){var he=(W[Le][0]-W[it][0])*(W[it][1]+W[Le][1]),Oe=ie+he;_e+=Math.abs(ie)>=Math.abs(he)?ie-Oe+he:he-Oe+ie,ie=Oe}ie+_e>=0!=!!K&&W.reverse()}Ct.prototype.loadTile=function(W,K){var ie=W.uid,_e=W.encoding,Le=W.rawImageData,Ke=ut&&Le instanceof ut?this.getImageData(Le):Le,it=new y.DEMData(ie,Ke,_e);this.loaded=this.loaded||{},this.loaded[ie]=it,K(null,it)},Ct.prototype.getImageData=function(W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);var K=this.offscreenCanvasContext.getImageData(-1,-1,W.width+2,W.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:K.width,height:K.height},K.data)},Ct.prototype.removeTile=function(W){var K=this.loaded,ie=W.uid;K&&K[ie]&&delete K[ie]};var nr=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,Jt=function(W){this._feature=W,this.extent=y.EXTENT,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))};Jt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var W=[],K=0,ie=this._feature.geometry;K<ie.length;K+=1){var _e=ie[K];W.push([new y.Point$1(_e[0],_e[1])])}return W}for(var Le=[],Ke=0,it=this._feature.geometry;Ke<it.length;Ke+=1){for(var he=[],Oe=0,wt=it[Ke];Oe<wt.length;Oe+=1){var br=wt[Oe];he.push(new y.Point$1(br[0],br[1]))}Le.push(he)}return Le},Jt.prototype.toGeoJSON=function(W,K,ie){return nr.call(this,W,K,ie)};var bt=function(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=W.length,this._features=W};bt.prototype.feature=function(W){return new Jt(this._features[W])};var vt=y.vectorTile.VectorTileFeature,Dr=fr;function fr(W,K){this.options=K||{},this.features=W,this.length=W.length}function sr(W,K){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=K||4096}fr.prototype.feature=function(W){return new sr(this.features[W],this.options.extent)},sr.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var K=0;K<W.length;K++){for(var ie=W[K],_e=[],Le=0;Le<ie.length;Le++)_e.push(new y.Point$1(ie[Le][0],ie[Le][1]));this.geometry.push(_e)}return this.geometry},sr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,K=1/0,ie=-1/0,_e=1/0,Le=-1/0,Ke=0;Ke<W.length;Ke++)for(var it=W[Ke],he=0;he<it.length;he++){var Oe=it[he];K=Math.min(K,Oe.x),ie=Math.max(ie,Oe.x),_e=Math.min(_e,Oe.y),Le=Math.max(Le,Oe.y)}return[K,_e,ie,Le]},sr.prototype.toGeoJSON=vt.prototype.toGeoJSON;var mt=Lt,nt=Dr;function Lt(W){var K=new y.pbf;return function(ie,_e){for(var Le in ie.layers)_e.writeMessage(3,lt,ie.layers[Le])}(W,K),K.finish()}function lt(W,K){var ie;K.writeVarintField(15,W.version||1),K.writeStringField(1,W.name||""),K.writeVarintField(5,W.extent||4096);var _e={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<W.length;ie++)_e.feature=W.feature(ie),K.writeMessage(2,Xt,_e);var Le=_e.keys;for(ie=0;ie<Le.length;ie++)K.writeStringField(3,Le[ie]);var Ke=_e.values;for(ie=0;ie<Ke.length;ie++)K.writeMessage(4,H,Ke[ie])}function Xt(W,K){var ie=W.feature;ie.id!==void 0&&K.writeVarintField(1,ie.id),K.writeMessage(2,_r,W),K.writeVarintField(3,ie.type),K.writeMessage(4,V,ie)}function _r(W,K){var ie=W.feature,_e=W.keys,Le=W.values,Ke=W.keycache,it=W.valuecache;for(var he in ie.properties){var Oe=Ke[he];Oe===void 0&&(_e.push(he),Ke[he]=Oe=_e.length-1),K.writeVarint(Oe);var wt=ie.properties[he],br=typeof wt;br!=="string"&&br!=="boolean"&&br!=="number"&&(wt=JSON.stringify(wt));var Mr=br+":"+wt,Rt=it[Mr];Rt===void 0&&(Le.push(wt),it[Mr]=Rt=Le.length-1),K.writeVarint(Rt)}}function J(W,K){return(K<<3)+(7&W)}function Ie(W){return W<<1^W>>31}function V(W,K){for(var ie=W.loadGeometry(),_e=W.type,Le=0,Ke=0,it=ie.length,he=0;he<it;he++){var Oe=ie[he],wt=1;_e===1&&(wt=Oe.length),K.writeVarint(J(1,wt));for(var br=_e===3?Oe.length-1:Oe.length,Mr=0;Mr<br;Mr++){Mr===1&&_e!==1&&K.writeVarint(J(2,br-1));var Rt=Oe[Mr].x-Le,mr=Oe[Mr].y-Ke;K.writeVarint(Ie(Rt)),K.writeVarint(Ie(mr)),Le+=Rt,Ke+=mr}_e===3&&K.writeVarint(J(7,1))}}function H(W,K){var ie=typeof W;ie==="string"?K.writeStringField(1,W):ie==="boolean"?K.writeBooleanField(7,W):ie==="number"&&(W%1!=0?K.writeDoubleField(3,W):W<0?K.writeSVarintField(6,W):K.writeVarintField(5,W))}function be(W,K,ie,_e){tt(W,ie,_e),tt(K,2*ie,2*_e),tt(K,2*ie+1,2*_e+1)}function tt(W,K,ie){var _e=W[K];W[K]=W[ie],W[ie]=_e}function ht(W,K,ie,_e){var Le=W-ie,Ke=K-_e;return Le*Le+Ke*Ke}mt.fromVectorTileJs=Lt,mt.fromGeojsonVt=function(W,K){K=K||{};var ie={};for(var _e in W)ie[_e]=new Dr(W[_e].features,K),ie[_e].name=_e,ie[_e].version=K.version,ie[_e].extent=K.extent;return Lt({layers:ie})},mt.GeoJSONWrapper=nt;var St=function(W){return W[0]},jt=function(W){return W[1]},tr=function(W,K,ie,_e,Le){K===void 0&&(K=St),ie===void 0&&(ie=jt),_e===void 0&&(_e=64),Le===void 0&&(Le=Float64Array),this.nodeSize=_e,this.points=W;for(var Ke=W.length<65536?Uint16Array:Uint32Array,it=this.ids=new Ke(W.length),he=this.coords=new Le(2*W.length),Oe=0;Oe<W.length;Oe++)it[Oe]=Oe,he[2*Oe]=K(W[Oe]),he[2*Oe+1]=ie(W[Oe]);(function wt(br,Mr,Rt,mr,mn,sn){if(!(mn-mr<=Rt)){var Qt=mr+mn>>1;(function je(qr,Q,ri,en,Jn,Zi){for(;Jn>en;){if(Jn-en>600){var ni=Jn-en+1,Ii=ri-en+1,hi=Math.log(ni),yo=.5*Math.exp(2*hi/3),Fi=.5*Math.sqrt(hi*yo*(ni-yo)/ni)*(Ii-ni/2<0?-1:1);je(qr,Q,ri,Math.max(en,Math.floor(ri-Ii*yo/ni+Fi)),Math.min(Jn,Math.floor(ri+(ni-Ii)*yo/ni+Fi)),Zi)}var ea=Q[2*ri+Zi],vi=en,si=Jn;for(be(qr,Q,en,ri),Q[2*Jn+Zi]>ea&&be(qr,Q,en,Jn);vi<si;){for(be(qr,Q,vi,si),vi++,si--;Q[2*vi+Zi]<ea;)vi++;for(;Q[2*si+Zi]>ea;)si--}Q[2*en+Zi]===ea?be(qr,Q,en,si):be(qr,Q,++si,Jn),si<=ri&&(en=si+1),ri<=si&&(Jn=si-1)}})(br,Mr,Qt,mr,mn,sn%2),wt(br,Mr,Rt,mr,Qt-1,sn+1),wt(br,Mr,Rt,Qt+1,mn,sn+1)}})(it,he,_e,0,it.length-1,0)};tr.prototype.range=function(W,K,ie,_e){return function(Le,Ke,it,he,Oe,wt,br){for(var Mr,Rt,mr=[0,Le.length-1,0],mn=[];mr.length;){var sn=mr.pop(),Qt=mr.pop(),je=mr.pop();if(Qt-je<=br)for(var qr=je;qr<=Qt;qr++)Rt=Ke[2*qr+1],(Mr=Ke[2*qr])>=it&&Mr<=Oe&&Rt>=he&&Rt<=wt&&mn.push(Le[qr]);else{var Q=Math.floor((je+Qt)/2);Rt=Ke[2*Q+1],(Mr=Ke[2*Q])>=it&&Mr<=Oe&&Rt>=he&&Rt<=wt&&mn.push(Le[Q]);var ri=(sn+1)%2;(sn===0?it<=Mr:he<=Rt)&&(mr.push(je),mr.push(Q-1),mr.push(ri)),(sn===0?Oe>=Mr:wt>=Rt)&&(mr.push(Q+1),mr.push(Qt),mr.push(ri))}}return mn}(this.ids,this.coords,W,K,ie,_e,this.nodeSize)},tr.prototype.within=function(W,K,ie){return function(_e,Le,Ke,it,he,Oe){for(var wt=[0,_e.length-1,0],br=[],Mr=he*he;wt.length;){var Rt=wt.pop(),mr=wt.pop(),mn=wt.pop();if(mr-mn<=Oe)for(var sn=mn;sn<=mr;sn++)ht(Le[2*sn],Le[2*sn+1],Ke,it)<=Mr&&br.push(_e[sn]);else{var Qt=Math.floor((mn+mr)/2),je=Le[2*Qt],qr=Le[2*Qt+1];ht(je,qr,Ke,it)<=Mr&&br.push(_e[Qt]);var Q=(Rt+1)%2;(Rt===0?Ke-he<=je:it-he<=qr)&&(wt.push(mn),wt.push(Qt-1),wt.push(Q)),(Rt===0?Ke+he>=je:it+he>=qr)&&(wt.push(Qt+1),wt.push(mr),wt.push(Q))}}return br}(this.ids,this.coords,W,K,ie,this.nodeSize)};var Hr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(W){return W}},Br=function(W){this.options=bi(Object.create(Hr),W),this.trees=new Array(this.options.maxZoom+1)};function Bn(W,K,ie,_e,Le){return{x:W,y:K,zoom:1/0,id:ie,parentId:-1,numPoints:_e,properties:Le}}function tn(W,K){var ie=W.geometry.coordinates,_e=ie[1];return{x:Vn(ie[0]),y:vn(_e),zoom:1/0,index:K,parentId:-1}}function gn(W){return{type:"Feature",id:W.id,properties:fi(W),geometry:{type:"Point",coordinates:[(_e=W.x,360*(_e-.5)),(K=W.y,ie=(180-360*K)*Math.PI/180,360*Math.atan(Math.exp(ie))/Math.PI-90)]}};var K,ie,_e}function fi(W){var K=W.numPoints,ie=K>=1e4?Math.round(K/1e3)+"k":K>=1e3?Math.round(K/100)/10+"k":K;return bi(bi({},W.properties),{cluster:!0,cluster_id:W.id,point_count:K,point_count_abbreviated:ie})}function Vn(W){return W/360+.5}function vn(W){var K=Math.sin(W*Math.PI/180),ie=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return ie<0?0:ie>1?1:ie}function bi(W,K){for(var ie in K)W[ie]=K[ie];return W}function Mi(W){return W.x}function Ei(W){return W.y}function Gn(W,K,ie,_e,Le,Ke){var it=Le-ie,he=Ke-_e;if(it!==0||he!==0){var Oe=((W-ie)*it+(K-_e)*he)/(it*it+he*he);Oe>1?(ie=Le,_e=Ke):Oe>0&&(ie+=it*Oe,_e+=he*Oe)}return(it=W-ie)*it+(he=K-_e)*he}function kn(W,K,ie,_e){var Le={id:W===void 0?null:W,type:K,geometry:ie,tags:_e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ke){var it=Ke.geometry,he=Ke.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")mo(Ke,it);else if(he==="Polygon"||he==="MultiLineString")for(var Oe=0;Oe<it.length;Oe++)mo(Ke,it[Oe]);else if(he==="MultiPolygon")for(Oe=0;Oe<it.length;Oe++)for(var wt=0;wt<it[Oe].length;wt++)mo(Ke,it[Oe][wt])}(Le),Le}function mo(W,K){for(var ie=0;ie<K.length;ie+=3)W.minX=Math.min(W.minX,K[ie]),W.minY=Math.min(W.minY,K[ie+1]),W.maxX=Math.max(W.maxX,K[ie]),W.maxY=Math.max(W.maxY,K[ie+1])}function Hi(W,K,ie,_e){if(K.geometry){var Le=K.geometry.coordinates,Ke=K.geometry.type,it=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2),he=[],Oe=K.id;if(ie.promoteId?Oe=K.properties[ie.promoteId]:ie.generateId&&(Oe=_e||0),Ke==="Point")ja(Le,he);else if(Ke==="MultiPoint")for(var wt=0;wt<Le.length;wt++)ja(Le[wt],he);else if(Ke==="LineString")Tt(Le,he,it,!1);else if(Ke==="MultiLineString"){if(ie.lineMetrics){for(wt=0;wt<Le.length;wt++)Tt(Le[wt],he=[],it,!1),W.push(kn(Oe,"LineString",he,K.properties));return}R(Le,he,it,!1)}else if(Ke==="Polygon")R(Le,he,it,!0);else{if(Ke!=="MultiPolygon"){if(Ke==="GeometryCollection"){for(wt=0;wt<K.geometry.geometries.length;wt++)Hi(W,{id:Oe,geometry:K.geometry.geometries[wt],properties:K.properties},ie,_e);return}throw new Error("Input data is not a valid GeoJSON object.")}for(wt=0;wt<Le.length;wt++){var br=[];R(Le[wt],br,it,!0),he.push(br)}}W.push(kn(Oe,Ke,he,K.properties))}}function ja(W,K){K.push(ne(W[0])),K.push(fe(W[1])),K.push(0)}function Tt(W,K,ie,_e){for(var Le,Ke,it=0,he=0;he<W.length;he++){var Oe=ne(W[he][0]),wt=fe(W[he][1]);K.push(Oe),K.push(wt),K.push(0),he>0&&(it+=_e?(Le*wt-Oe*Ke)/2:Math.sqrt(Math.pow(Oe-Le,2)+Math.pow(wt-Ke,2))),Le=Oe,Ke=wt}var br=K.length-3;K[2]=1,function Mr(Rt,mr,mn,sn){for(var Qt,je=sn,qr=mn-mr>>1,Q=mn-mr,ri=Rt[mr],en=Rt[mr+1],Jn=Rt[mn],Zi=Rt[mn+1],ni=mr+3;ni<mn;ni+=3){var Ii=Gn(Rt[ni],Rt[ni+1],ri,en,Jn,Zi);if(Ii>je)Qt=ni,je=Ii;else if(Ii===je){var hi=Math.abs(ni-qr);hi<Q&&(Qt=ni,Q=hi)}}je>sn&&(Qt-mr>3&&Mr(Rt,mr,Qt,sn),Rt[Qt+2]=je,mn-Qt>3&&Mr(Rt,Qt,mn,sn))}(K,0,br,ie),K[br+2]=1,K.size=Math.abs(it),K.start=0,K.end=K.size}function R(W,K,ie,_e){for(var Le=0;Le<W.length;Le++){var Ke=[];Tt(W[Le],Ke,ie,_e),K.push(Ke)}}function ne(W){return W/360+.5}function fe(W){var K=Math.sin(W*Math.PI/180),ie=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return ie<0?0:ie>1?1:ie}function Fe(W,K,ie,_e,Le,Ke,it,he){if(_e/=K,Ke>=(ie/=K)&&it<_e)return W;if(it<ie||Ke>=_e)return null;for(var Oe=[],wt=0;wt<W.length;wt++){var br=W[wt],Mr=br.geometry,Rt=br.type,mr=Le===0?br.minX:br.minY,mn=Le===0?br.maxX:br.maxY;if(mr>=ie&&mn<_e)Oe.push(br);else if(!(mn<ie||mr>=_e)){var sn=[];if(Rt==="Point"||Rt==="MultiPoint")ct(Mr,sn,ie,_e,Le);else if(Rt==="LineString")zt(Mr,sn,ie,_e,Le,!1,he.lineMetrics);else if(Rt==="MultiLineString")Ne(Mr,sn,ie,_e,Le,!1);else if(Rt==="Polygon")Ne(Mr,sn,ie,_e,Le,!0);else if(Rt==="MultiPolygon")for(var Qt=0;Qt<Mr.length;Qt++){var je=[];Ne(Mr[Qt],je,ie,_e,Le,!0),je.length&&sn.push(je)}if(sn.length){if(he.lineMetrics&&Rt==="LineString"){for(Qt=0;Qt<sn.length;Qt++)Oe.push(kn(br.id,Rt,sn[Qt],br.tags));continue}Rt!=="LineString"&&Rt!=="MultiLineString"||(sn.length===1?(Rt="LineString",sn=sn[0]):Rt="MultiLineString"),Rt!=="Point"&&Rt!=="MultiPoint"||(Rt=sn.length===3?"Point":"MultiPoint"),Oe.push(kn(br.id,Rt,sn,br.tags))}}}return Oe.length?Oe:null}function ct(W,K,ie,_e,Le){for(var Ke=0;Ke<W.length;Ke+=3){var it=W[Ke+Le];it>=ie&&it<=_e&&(K.push(W[Ke]),K.push(W[Ke+1]),K.push(W[Ke+2]))}}function zt(W,K,ie,_e,Le,Ke,it){for(var he,Oe,wt=Er(W),br=Le===0?ir:xr,Mr=W.start,Rt=0;Rt<W.length-3;Rt+=3){var mr=W[Rt],mn=W[Rt+1],sn=W[Rt+2],Qt=W[Rt+3],je=W[Rt+4],qr=Le===0?mr:mn,Q=Le===0?Qt:je,ri=!1;it&&(he=Math.sqrt(Math.pow(mr-Qt,2)+Math.pow(mn-je,2))),qr<ie?Q>ie&&(Oe=br(wt,mr,mn,Qt,je,ie),it&&(wt.start=Mr+he*Oe)):qr>_e?Q<_e&&(Oe=br(wt,mr,mn,Qt,je,_e),it&&(wt.start=Mr+he*Oe)):Et(wt,mr,mn,sn),Q<ie&&qr>=ie&&(Oe=br(wt,mr,mn,Qt,je,ie),ri=!0),Q>_e&&qr<=_e&&(Oe=br(wt,mr,mn,Qt,je,_e),ri=!0),!Ke&&ri&&(it&&(wt.end=Mr+he*Oe),K.push(wt),wt=Er(W)),it&&(Mr+=he)}var en=W.length-3;mr=W[en],mn=W[en+1],sn=W[en+2],(qr=Le===0?mr:mn)>=ie&&qr<=_e&&Et(wt,mr,mn,sn),en=wt.length-3,Ke&&en>=3&&(wt[en]!==wt[0]||wt[en+1]!==wt[1])&&Et(wt,wt[0],wt[1],wt[2]),wt.length&&K.push(wt)}function Er(W){var K=[];return K.size=W.size,K.start=W.start,K.end=W.end,K}function Ne(W,K,ie,_e,Le,Ke){for(var it=0;it<W.length;it++)zt(W[it],K,ie,_e,Le,Ke,!1)}function Et(W,K,ie,_e){W.push(K),W.push(ie),W.push(_e)}function ir(W,K,ie,_e,Le,Ke){var it=(Ke-K)/(_e-K);return W.push(Ke),W.push(ie+(Le-ie)*it),W.push(1),it}function xr(W,K,ie,_e,Le,Ke){var it=(Ke-ie)/(Le-ie);return W.push(K+(_e-K)*it),W.push(Ke),W.push(1),it}function Wr(W,K){for(var ie=[],_e=0;_e<W.length;_e++){var Le,Ke=W[_e],it=Ke.type;if(it==="Point"||it==="MultiPoint"||it==="LineString")Le=yn(Ke.geometry,K);else if(it==="MultiLineString"||it==="Polygon"){Le=[];for(var he=0;he<Ke.geometry.length;he++)Le.push(yn(Ke.geometry[he],K))}else if(it==="MultiPolygon")for(Le=[],he=0;he<Ke.geometry.length;he++){for(var Oe=[],wt=0;wt<Ke.geometry[he].length;wt++)Oe.push(yn(Ke.geometry[he][wt],K));Le.push(Oe)}ie.push(kn(Ke.id,it,Le,Ke.tags))}return ie}function yn(W,K){var ie=[];ie.size=W.size,W.start!==void 0&&(ie.start=W.start,ie.end=W.end);for(var _e=0;_e<W.length;_e+=3)ie.push(W[_e]+K,W[_e+1],W[_e+2]);return ie}function Sn(W,K){if(W.transformed)return W;var ie,_e,Le,Ke=1<<W.z,it=W.x,he=W.y;for(ie=0;ie<W.features.length;ie++){var Oe=W.features[ie],wt=Oe.geometry,br=Oe.type;if(Oe.geometry=[],br===1)for(_e=0;_e<wt.length;_e+=2)Oe.geometry.push(En(wt[_e],wt[_e+1],K,Ke,it,he));else for(_e=0;_e<wt.length;_e++){var Mr=[];for(Le=0;Le<wt[_e].length;Le+=2)Mr.push(En(wt[_e][Le],wt[_e][Le+1],K,Ke,it,he));Oe.geometry.push(Mr)}}return W.transformed=!0,W}function En(W,K,ie,_e,Le,Ke){return[Math.round(ie*(W*_e-Le)),Math.round(ie*(K*_e-Ke))]}function pn(W,K,ie,_e,Le){for(var Ke=K===Le.maxZoom?0:Le.tolerance/((1<<K)*Le.extent),it={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ie,y:_e,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<W.length;he++){it.numFeatures++,Kn(it,W[he],Ke,Le);var Oe=W[he].minX,wt=W[he].minY,br=W[he].maxX,Mr=W[he].maxY;Oe<it.minX&&(it.minX=Oe),wt<it.minY&&(it.minY=wt),br>it.maxX&&(it.maxX=br),Mr>it.maxY&&(it.maxY=Mr)}return it}function Kn(W,K,ie,_e){var Le=K.geometry,Ke=K.type,it=[];if(Ke==="Point"||Ke==="MultiPoint")for(var he=0;he<Le.length;he+=3)it.push(Le[he]),it.push(Le[he+1]),W.numPoints++,W.numSimplified++;else if(Ke==="LineString")Nn(it,Le,W,ie,!1,!1);else if(Ke==="MultiLineString"||Ke==="Polygon")for(he=0;he<Le.length;he++)Nn(it,Le[he],W,ie,Ke==="Polygon",he===0);else if(Ke==="MultiPolygon")for(var Oe=0;Oe<Le.length;Oe++){var wt=Le[Oe];for(he=0;he<wt.length;he++)Nn(it,wt[he],W,ie,!0,he===0)}if(it.length){var br=K.tags||null;if(Ke==="LineString"&&_e.lineMetrics){for(var Mr in br={},K.tags)br[Mr]=K.tags[Mr];br.mapbox_clip_start=Le.start/Le.size,br.mapbox_clip_end=Le.end/Le.size}var Rt={geometry:it,type:Ke==="Polygon"||Ke==="MultiPolygon"?3:Ke==="LineString"||Ke==="MultiLineString"?2:1,tags:br};K.id!==null&&(Rt.id=K.id),W.features.push(Rt)}}function Nn(W,K,ie,_e,Le,Ke){var it=_e*_e;if(_e>0&&K.size<(Le?it:_e))ie.numPoints+=K.length/3;else{for(var he=[],Oe=0;Oe<K.length;Oe+=3)(_e===0||K[Oe+2]>it)&&(ie.numSimplified++,he.push(K[Oe]),he.push(K[Oe+1])),ie.numPoints++;Le&&function(wt,br){for(var Mr=0,Rt=0,mr=wt.length,mn=mr-2;Rt<mr;mn=Rt,Rt+=2)Mr+=(wt[Rt]-wt[mn])*(wt[Rt+1]+wt[mn+1]);if(Mr>0===br)for(Rt=0,mr=wt.length;Rt<mr/2;Rt+=2){var sn=wt[Rt],Qt=wt[Rt+1];wt[Rt]=wt[mr-2-Rt],wt[Rt+1]=wt[mr-1-Rt],wt[mr-2-Rt]=sn,wt[mr-1-Rt]=Qt}}(he,Ke),W.push(he)}}function Ji(W,K){var ie=(K=this.options=function(Le,Ke){for(var it in Ke)Le[it]=Ke[it];return Le}(Object.create(this.options),K)).debug;if(ie&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");var _e=function(Le,Ke){var it=[];if(Le.type==="FeatureCollection")for(var he=0;he<Le.features.length;he++)Hi(it,Le.features[he],Ke,he);else Hi(it,Le.type==="Feature"?Le:{geometry:Le},Ke);return it}(W,K);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(_e=function(Le,Ke){var it=Ke.buffer/Ke.extent,he=Le,Oe=Fe(Le,1,-1-it,it,0,-1,2,Ke),wt=Fe(Le,1,1-it,2+it,0,-1,2,Ke);return(Oe||wt)&&(he=Fe(Le,1,-it,1+it,0,-1,2,Ke)||[],Oe&&(he=Wr(Oe,1).concat(he)),wt&&(he=he.concat(Wr(wt,-1)))),he}(_e,K)).length&&this.splitTile(_e,0,0,0),ie&&(_e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $i(W,K,ie){return 32*((1<<W)*ie+K)+W}function go(W,K){var ie=W.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);var _e=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!_e)return K(null,null);var Le=new bt(_e.features),Ke=mt(Le);Ke.byteOffset===0&&Ke.byteLength===Ke.buffer.byteLength||(Ke=new Uint8Array(Ke)),K(null,{vectorTile:Le,rawData:Ke.buffer})}Br.prototype.load=function(W){var K=this.options,ie=K.log,_e=K.minZoom,Le=K.maxZoom,Ke=K.nodeSize;ie&&console.time("total time");var it="prepare "+W.length+" points";ie&&console.time(it),this.points=W;for(var he=[],Oe=0;Oe<W.length;Oe++)W[Oe].geometry&&he.push(tn(W[Oe],Oe));this.trees[Le+1]=new tr(he,Mi,Ei,Ke,Float32Array),ie&&console.timeEnd(it);for(var wt=Le;wt>=_e;wt--){var br=+Date.now();he=this._cluster(he,wt),this.trees[wt]=new tr(he,Mi,Ei,Ke,Float32Array),ie&&console.log("z%d: %d clusters in %dms",wt,he.length,+Date.now()-br)}return ie&&console.timeEnd("total time"),this},Br.prototype.getClusters=function(W,K){var ie=((W[0]+180)%360+360)%360-180,_e=Math.max(-90,Math.min(90,W[1])),Le=W[2]===180?180:((W[2]+180)%360+360)%360-180,Ke=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)ie=-180,Le=180;else if(ie>Le){var it=this.getClusters([ie,_e,180,Ke],K),he=this.getClusters([-180,_e,Le,Ke],K);return it.concat(he)}for(var Oe=this.trees[this._limitZoom(K)],wt=[],br=0,Mr=Oe.range(Vn(ie),vn(Ke),Vn(Le),vn(_e));br<Mr.length;br+=1){var Rt=Oe.points[Mr[br]];wt.push(Rt.numPoints?gn(Rt):this.points[Rt.index])}return wt},Br.prototype.getChildren=function(W){var K=this._getOriginId(W),ie=this._getOriginZoom(W),_e="No cluster with the specified id.",Le=this.trees[ie];if(!Le)throw new Error(_e);var Ke=Le.points[K];if(!Ke)throw new Error(_e);for(var it=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),he=[],Oe=0,wt=Le.within(Ke.x,Ke.y,it);Oe<wt.length;Oe+=1){var br=Le.points[wt[Oe]];br.parentId===W&&he.push(br.numPoints?gn(br):this.points[br.index])}if(he.length===0)throw new Error(_e);return he},Br.prototype.getLeaves=function(W,K,ie){var _e=[];return this._appendLeaves(_e,W,K=K||10,ie=ie||0,0),_e},Br.prototype.getTile=function(W,K,ie){var _e=this.trees[this._limitZoom(W)],Le=Math.pow(2,W),Ke=this.options,it=Ke.radius/Ke.extent,he=(ie-it)/Le,Oe=(ie+1+it)/Le,wt={features:[]};return this._addTileFeatures(_e.range((K-it)/Le,he,(K+1+it)/Le,Oe),_e.points,K,ie,Le,wt),K===0&&this._addTileFeatures(_e.range(1-it/Le,he,1,Oe),_e.points,Le,ie,Le,wt),K===Le-1&&this._addTileFeatures(_e.range(0,he,it/Le,Oe),_e.points,-1,ie,Le,wt),wt.features.length?wt:null},Br.prototype.getClusterExpansionZoom=function(W){for(var K=this._getOriginZoom(W)-1;K<=this.options.maxZoom;){var ie=this.getChildren(W);if(K++,ie.length!==1)break;W=ie[0].properties.cluster_id}return K},Br.prototype._appendLeaves=function(W,K,ie,_e,Le){for(var Ke=0,it=this.getChildren(K);Ke<it.length;Ke+=1){var he=it[Ke],Oe=he.properties;if(Oe&&Oe.cluster?Le+Oe.point_count<=_e?Le+=Oe.point_count:Le=this._appendLeaves(W,Oe.cluster_id,ie,_e,Le):Le<_e?Le++:W.push(he),W.length===ie)break}return Le},Br.prototype._addTileFeatures=function(W,K,ie,_e,Le,Ke){for(var it=0,he=W;it<he.length;it+=1){var Oe=K[he[it]],wt=Oe.numPoints,br={type:1,geometry:[[Math.round(this.options.extent*(Oe.x*Le-ie)),Math.round(this.options.extent*(Oe.y*Le-_e))]],tags:wt?fi(Oe):this.points[Oe.index].properties},Mr=void 0;wt?Mr=Oe.id:this.options.generateId?Mr=Oe.index:this.points[Oe.index].id&&(Mr=this.points[Oe.index].id),Mr!==void 0&&(br.id=Mr),Ke.features.push(br)}},Br.prototype._limitZoom=function(W){return Math.max(this.options.minZoom,Math.min(+W,this.options.maxZoom+1))},Br.prototype._cluster=function(W,K){for(var ie=[],_e=this.options,Le=_e.reduce,Ke=_e.minPoints,it=_e.radius/(_e.extent*Math.pow(2,K)),he=0;he<W.length;he++){var Oe=W[he];if(!(Oe.zoom<=K)){Oe.zoom=K;for(var wt=this.trees[K+1],br=wt.within(Oe.x,Oe.y,it),Mr=Oe.numPoints||1,Rt=Mr,mr=0,mn=br;mr<mn.length;mr+=1){var sn=wt.points[mn[mr]];sn.zoom>K&&(Rt+=sn.numPoints||1)}if(Rt>=Ke){for(var Qt=Oe.x*Mr,je=Oe.y*Mr,qr=Le&&Mr>1?this._map(Oe,!0):null,Q=(he<<5)+(K+1)+this.points.length,ri=0,en=br;ri<en.length;ri+=1){var Jn=wt.points[en[ri]];if(!(Jn.zoom<=K)){Jn.zoom=K;var Zi=Jn.numPoints||1;Qt+=Jn.x*Zi,je+=Jn.y*Zi,Jn.parentId=Q,Le&&(qr||(qr=this._map(Oe,!0)),Le(qr,this._map(Jn)))}}Oe.parentId=Q,ie.push(Bn(Qt/Rt,je/Rt,Q,Rt,qr))}else if(ie.push(Oe),Rt>1)for(var ni=0,Ii=br;ni<Ii.length;ni+=1){var hi=wt.points[Ii[ni]];hi.zoom<=K||(hi.zoom=K,ie.push(hi))}}}return ie},Br.prototype._getOriginId=function(W){return W-this.points.length>>5},Br.prototype._getOriginZoom=function(W){return(W-this.points.length)%32},Br.prototype._map=function(W,K){if(W.numPoints)return K?bi({},W.properties):W.properties;var ie=this.points[W.index].properties,_e=this.options.map(ie);return K&&_e===ie?bi({},_e):_e},Ji.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ji.prototype.splitTile=function(W,K,ie,_e,Le,Ke,it){for(var he=[W,K,ie,_e],Oe=this.options,wt=Oe.debug;he.length;){_e=he.pop(),ie=he.pop(),K=he.pop(),W=he.pop();var br=1<<K,Mr=$i(K,ie,_e),Rt=this.tiles[Mr];if(!Rt&&(wt>1&&console.time("creation"),Rt=this.tiles[Mr]=pn(W,K,ie,_e,Oe),this.tileCoords.push({z:K,x:ie,y:_e}),wt)){wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ie,_e,Rt.numFeatures,Rt.numPoints,Rt.numSimplified),console.timeEnd("creation"));var mr="z"+K;this.stats[mr]=(this.stats[mr]||0)+1,this.total++}if(Rt.source=W,Le){if(K===Oe.maxZoom||K===Le)continue;var mn=1<<Le-K;if(ie!==Math.floor(Ke/mn)||_e!==Math.floor(it/mn))continue}else if(K===Oe.indexMaxZoom||Rt.numPoints<=Oe.indexMaxPoints)continue;if(Rt.source=null,W.length!==0){wt>1&&console.time("clipping");var sn,Qt,je,qr,Q,ri,en=.5*Oe.buffer/Oe.extent,Jn=.5-en,Zi=.5+en,ni=1+en;sn=Qt=je=qr=null,Q=Fe(W,br,ie-en,ie+Zi,0,Rt.minX,Rt.maxX,Oe),ri=Fe(W,br,ie+Jn,ie+ni,0,Rt.minX,Rt.maxX,Oe),W=null,Q&&(sn=Fe(Q,br,_e-en,_e+Zi,1,Rt.minY,Rt.maxY,Oe),Qt=Fe(Q,br,_e+Jn,_e+ni,1,Rt.minY,Rt.maxY,Oe),Q=null),ri&&(je=Fe(ri,br,_e-en,_e+Zi,1,Rt.minY,Rt.maxY,Oe),qr=Fe(ri,br,_e+Jn,_e+ni,1,Rt.minY,Rt.maxY,Oe),ri=null),wt>1&&console.timeEnd("clipping"),he.push(sn||[],K+1,2*ie,2*_e),he.push(Qt||[],K+1,2*ie,2*_e+1),he.push(je||[],K+1,2*ie+1,2*_e),he.push(qr||[],K+1,2*ie+1,2*_e+1)}}},Ji.prototype.getTile=function(W,K,ie){var _e=this.options,Le=_e.extent,Ke=_e.debug;if(W<0||W>24)return null;var it=1<<W,he=$i(W,K=(K%it+it)%it,ie);if(this.tiles[he])return Sn(this.tiles[he],Le);Ke>1&&console.log("drilling down to z%d-%d-%d",W,K,ie);for(var Oe,wt=W,br=K,Mr=ie;!Oe&&wt>0;)wt--,br=Math.floor(br/2),Mr=Math.floor(Mr/2),Oe=this.tiles[$i(wt,br,Mr)];return Oe&&Oe.source?(Ke>1&&console.log("found parent tile z%d-%d-%d",wt,br,Mr),Ke>1&&console.time("drilling down"),this.splitTile(Oe.source,wt,br,Mr,W,K,ie),Ke>1&&console.timeEnd("drilling down"),this.tiles[he]?Sn(this.tiles[he],Le):null):null};var rs=function(W){function K(ie,_e,Le,Ke){W.call(this,ie,_e,Le,go),Ke&&(this.loadGeoJSON=Ke)}return W&&(K.__proto__=W),(K.prototype=Object.create(W&&W.prototype)).constructor=K,K.prototype.loadData=function(ie,_e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=_e,this._pendingLoadDataParams=ie,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},K.prototype._loadData=function(){var ie=this;if(this._pendingCallback&&this._pendingLoadDataParams){var _e=this._pendingCallback,Le=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ke=!!(Le&&Le.request&&Le.request.collectResourceTiming)&&new y.RequestPerformance(Le.request);this.loadGeoJSON(Le,function(it,he){if(it||!he)return _e(it);if(typeof he!="object")return _e(new Error("Input data given to '"+Le.source+"' is not a valid GeoJSON object."));(function Rt(mr,mn){var sn,Qt=mr&&mr.type;if(Qt==="FeatureCollection")for(sn=0;sn<mr.features.length;sn++)Rt(mr.features[sn],mn);else if(Qt==="GeometryCollection")for(sn=0;sn<mr.geometries.length;sn++)Rt(mr.geometries[sn],mn);else if(Qt==="Feature")Rt(mr.geometry,mn);else if(Qt==="Polygon")Kt(mr.coordinates,mn);else if(Qt==="MultiPolygon")for(sn=0;sn<mr.coordinates.length;sn++)Kt(mr.coordinates[sn],mn);return mr})(he,!0);try{if(Le.filter){var Oe=y.createExpression(Le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(function(Rt){return Rt.key+": "+Rt.message}).join(", "));var wt=he.features.filter(function(Rt){return Oe.value.evaluate({zoom:0},Rt)});he={type:"FeatureCollection",features:wt}}ie._geoJSONIndex=Le.cluster?new Br(function(Rt){var mr=Rt.superclusterOptions,mn=Rt.clusterProperties;if(!mn||!mr)return mr;for(var sn={},Qt={},je={accumulated:null,zoom:0},qr={properties:null},Q=Object.keys(mn),ri=0,en=Q;ri<en.length;ri+=1){var Jn=en[ri],Zi=mn[Jn],ni=Zi[0],Ii=y.createExpression(Zi[1]),hi=y.createExpression(typeof ni=="string"?[ni,["accumulated"],["get",Jn]]:ni);sn[Jn]=Ii.value,Qt[Jn]=hi.value}return mr.map=function(yo){qr.properties=yo;for(var Fi={},ea=0,vi=Q;ea<vi.length;ea+=1){var si=vi[ea];Fi[si]=sn[si].evaluate(je,qr)}return Fi},mr.reduce=function(yo,Fi){qr.properties=Fi;for(var ea=0,vi=Q;ea<vi.length;ea+=1){var si=vi[ea];je.accumulated=yo[si],yo[si]=Qt[si].evaluate(je,qr)}},mr}(Le)).load(he.features):function(Rt,mr){return new Ji(Rt,mr)}(he,Le.geojsonVtOptions)}catch(Rt){return _e(Rt)}ie.loaded={};var br={};if(Ke){var Mr=Ke.finish();Mr&&(br.resourceTiming={},br.resourceTiming[Le.source]=JSON.parse(JSON.stringify(Mr)))}_e(null,br)})}},K.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},K.prototype.reloadTile=function(ie,_e){var Le=this.loaded;return Le&&Le[ie.uid]?W.prototype.reloadTile.call(this,ie,_e):this.loadTile(ie,_e)},K.prototype.loadGeoJSON=function(ie,_e){if(ie.request)y.getJSON(ie.request,_e);else{if(typeof ie.data!="string")return _e(new Error("Input data given to '"+ie.source+"' is not a valid GeoJSON object."));try{return _e(null,JSON.parse(ie.data))}catch(Le){return _e(new Error("Input data given to '"+ie.source+"' is not a valid GeoJSON object."))}}},K.prototype.removeSource=function(ie,_e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),_e()},K.prototype.getClusterExpansionZoom=function(ie,_e){try{_e(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(Le){_e(Le)}},K.prototype.getClusterChildren=function(ie,_e){try{_e(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(Le){_e(Le)}},K.prototype.getClusterLeaves=function(ie,_e){try{_e(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(Le){_e(Le)}},K}(et),qi=function(W){var K=this;this.self=W,this.actor=new y.Actor(W,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:et,geojson:rs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ie,_e){if(K.workerSourceTypes[ie])throw new Error('Worker source with name "'+ie+'" already registered.');K.workerSourceTypes[ie]=_e},this.self.registerRTLTextPlugin=function(ie){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=ie.applyArabicShaping,y.plugin.processBidirectionalText=ie.processBidirectionalText,y.plugin.processStyledBidirectionalText=ie.processStyledBidirectionalText}};return qi.prototype.setReferrer=function(W,K){this.referrer=K},qi.prototype.setImages=function(W,K,ie){for(var _e in this.availableImages[W]=K,this.workerSources[W]){var Le=this.workerSources[W][_e];for(var Ke in Le)Le[Ke].availableImages=K}ie()},qi.prototype.setLayers=function(W,K,ie){this.getLayerIndex(W).replace(K),ie()},qi.prototype.updateLayers=function(W,K,ie){this.getLayerIndex(W).update(K.layers,K.removedIds),ie()},qi.prototype.loadTile=function(W,K,ie){this.getWorkerSource(W,K.type,K.source).loadTile(K,ie)},qi.prototype.loadDEMTile=function(W,K,ie){this.getDEMWorkerSource(W,K.source).loadTile(K,ie)},qi.prototype.reloadTile=function(W,K,ie){this.getWorkerSource(W,K.type,K.source).reloadTile(K,ie)},qi.prototype.abortTile=function(W,K,ie){this.getWorkerSource(W,K.type,K.source).abortTile(K,ie)},qi.prototype.removeTile=function(W,K,ie){this.getWorkerSource(W,K.type,K.source).removeTile(K,ie)},qi.prototype.removeDEMTile=function(W,K){this.getDEMWorkerSource(W,K.source).removeTile(K)},qi.prototype.removeSource=function(W,K,ie){if(this.workerSources[W]&&this.workerSources[W][K.type]&&this.workerSources[W][K.type][K.source]){var _e=this.workerSources[W][K.type][K.source];delete this.workerSources[W][K.type][K.source],_e.removeSource!==void 0?_e.removeSource(K,ie):ie()}},qi.prototype.loadWorkerSource=function(W,K,ie){try{this.self.importScripts(K.url),ie()}catch(_e){ie(_e.toString())}},qi.prototype.syncRTLPluginState=function(W,K,ie){try{y.plugin.setState(K);var _e=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&_e!=null){this.self.importScripts(_e);var Le=y.plugin.isParsed();ie(Le?void 0:new Error("RTL Text Plugin failed to import scripts from "+_e),Le)}}catch(Ke){ie(Ke.toString())}},qi.prototype.getAvailableImages=function(W){var K=this.availableImages[W];return K||(K=[]),K},qi.prototype.getLayerIndex=function(W){var K=this.layerIndexes[W];return K||(K=this.layerIndexes[W]=new ce),K},qi.prototype.getWorkerSource=function(W,K,ie){var _e=this;return this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][K]||(this.workerSources[W][K]={}),this.workerSources[W][K][ie]||(this.workerSources[W][K][ie]=new this.workerSourceTypes[K]({send:function(Le,Ke,it){_e.actor.send(Le,Ke,it,W)}},this.getLayerIndex(W),this.getAvailableImages(W))),this.workerSources[W][K][ie]},qi.prototype.getDEMWorkerSource=function(W,K){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][K]||(this.demWorkerSources[W][K]=new Ct),this.demWorkerSources[W][K]},qi.prototype.enforceCacheSizeLimit=function(W,K){y.enforceCacheSizeLimit(K)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new qi(self)),qi}),ee(["./shared"],function(y){"use strict";var le=y.createCommonjsModule(function(f){function d(w){return!h(w)}function h(w){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,L,k=new Blob([""],{type:"text/javascript"}),X=URL.createObjectURL(k);try{L=new Worker(X),T=!0}catch(ae){T=!1}return L&&L.terminate(),URL.revokeObjectURL(X),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var L=T.getContext("2d");if(!L)return!1;var k=L.getImageData(0,0,1,1);return k&&k.width===T.width}()?(g[C=w&&w.failIfMajorPerformanceCaveat]===void 0&&(g[C]=function(T){var L=function(X){var ae=document.createElement("canvas"),de=Object.create(d.webGLContextAttributes);return de.failIfMajorPerformanceCaveat=X,ae.probablySupportsContext?ae.probablySupportsContext("webgl",de)||ae.probablySupportsContext("experimental-webgl",de):ae.supportsContext?ae.supportsContext("webgl",de)||ae.supportsContext("experimental-webgl",de):ae.getContext("webgl",de)||ae.getContext("experimental-webgl",de)}(T);if(!L)return!1;var k=L.createShader(L.VERTEX_SHADER);return!(!k||L.isContextLost())&&(L.shaderSource(k,"void main() {}"),L.compileShader(k),L.getShaderParameter(k,L.COMPILE_STATUS)===!0)}(C)),g[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}f.exports?f.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var g={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),U={create:function(f,d,h){var g=y.window.document.createElement(f);return d!==void 0&&(g.className=d),h&&h.appendChild(g),g},createNS:function(f,d){return y.window.document.createElementNS(f,d)}},ce=y.window.document&&y.window.document.documentElement.style;function oe(f){if(!ce)return f[0];for(var d=0;d<f.length;d++)if(f[d]in ce)return f[d];return f[0]}var Ue,se=oe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);U.disableDrag=function(){ce&&se&&(Ue=ce[se],ce[se]="none")},U.enableDrag=function(){ce&&se&&(ce[se]=Ue)};var ze=oe(["transform","WebkitTransform"]);U.setTransform=function(f,d){f.style[ze]=d};var et=!1;try{var ut=Object.defineProperty({},"passive",{get:function(){et=!0}});y.window.addEventListener("test",ut,ut),y.window.removeEventListener("test",ut,ut)}catch(f){et=!1}U.addEventListener=function(f,d,h,g){g===void 0&&(g={}),f.addEventListener(d,h,"passive"in g&&et?g:g.capture)},U.removeEventListener=function(f,d,h,g){g===void 0&&(g={}),f.removeEventListener(d,h,"passive"in g&&et?g:g.capture)};var Ct=function(f){f.preventDefault(),f.stopPropagation(),y.window.removeEventListener("click",Ct,!0)};function Kt(f){var d=f.userImage;return!!(d&&d.render&&d.render())&&(f.data.replace(new Uint8Array(d.data.buffer)),!0)}U.suppressClick=function(){y.window.addEventListener("click",Ct,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",Ct,!0)},0)},U.mousePos=function(f,d){var h=f.getBoundingClientRect();return new y.Point(d.clientX-h.left-f.clientLeft,d.clientY-h.top-f.clientTop)},U.touchPos=function(f,d){for(var h=f.getBoundingClientRect(),g=[],w=0;w<d.length;w++)g.push(new y.Point(d[w].clientX-h.left-f.clientLeft,d[w].clientY-h.top-f.clientTop));return g},U.mouseButton=function(f){return y.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},U.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};var Yt=function(f){function d(){f.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var g=0,w=this.requestors;g<w.length;g+=1){var C=w[g];this._notify(C.ids,C.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,g){this._validate(h,g)&&(this.images[h]=g)},d.prototype._validate=function(h,g){var w=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),w=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),w=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),w=!1),w},d.prototype._validateStretch=function(h,g){if(!h)return!0;for(var w=0,C=0,T=h;C<T.length;C+=1){var L=T[C];if(L[0]<w||L[1]<L[0]||g<L[1])return!1;w=L[1]}return!0},d.prototype._validateContent=function(h,g){return!(h&&(h.length!==4||h[0]<0||g.data.width<h[0]||h[1]<0||g.data.height<h[1]||h[2]<0||g.data.width<h[2]||h[3]<0||g.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,g){g.version=this.images[h].version+1,this.images[h]=g,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var g=this.images[h];delete this.images[h],delete this.patterns[h],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,g){var w=!0;if(!this.isLoaded())for(var C=0,T=h;C<T.length;C+=1)this.images[T[C]]||(w=!1);this.isLoaded()||w?this._notify(h,g):this.requestors.push({ids:h,callback:g})},d.prototype._notify=function(h,g){for(var w={},C=0,T=h;C<T.length;C+=1){var L=T[C];this.images[L]||this.fire(new y.Event("styleimagemissing",{id:L}));var k=this.images[L];k?w[L]={data:k.data.clone(),pixelRatio:k.pixelRatio,sdf:k.sdf,version:k.version,stretchX:k.stretchX,stretchY:k.stretchY,content:k.content,hasRenderCallback:Boolean(k.userImage&&k.userImage.render)}:y.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,w)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var g=this.patterns[h],w=this.getImage(h);if(!w)return null;if(g&&g.position.version===w.version)return g.position;if(g)g.position.version=w.version;else{var C={w:w.data.width+2,h:w.data.height+2,x:0,y:0},T=new y.ImagePosition(C,w);this.patterns[h]={bin:C,position:T}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var g=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(h,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var g in this.patterns)h.push(this.patterns[g].bin);var w=y.potpack(h),C=w.w,T=w.h,L=this.atlasImage;for(var k in L.resize({width:C||1,height:T||1}),this.patterns){var X=this.patterns[k].bin,ae=X.x+1,de=X.y+1,ge=this.images[k].data,Te=ge.width,Re=ge.height;y.RGBAImage.copy(ge,L,{x:0,y:0},{x:ae,y:de},{width:Te,height:Re}),y.RGBAImage.copy(ge,L,{x:0,y:Re-1},{x:ae,y:de-1},{width:Te,height:1}),y.RGBAImage.copy(ge,L,{x:0,y:0},{x:ae,y:de+Re},{width:Te,height:1}),y.RGBAImage.copy(ge,L,{x:Te-1,y:0},{x:ae-1,y:de},{width:1,height:Re}),y.RGBAImage.copy(ge,L,{x:0,y:0},{x:ae+Te,y:de},{width:1,height:Re})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var g=0,w=h;g<w.length;g+=1){var C=w[g];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var T=this.images[C];Kt(T)&&this.updateImage(C,T)}}},d}(y.Evented),nr=vt,Jt=vt,bt=1e20;function vt(f,d,h,g,w,C){this.fontSize=f||24,this.buffer=d===void 0?3:d,this.cutoff=g||.25,this.fontFamily=w||"sans-serif",this.fontWeight=C||"normal",this.radius=h||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Dr(f,d,h,g,w,C,T){for(var L=0;L<d;L++){for(var k=0;k<h;k++)g[k]=f[k*d+L];for(fr(g,w,C,T,h),k=0;k<h;k++)f[k*d+L]=w[k]}for(k=0;k<h;k++){for(L=0;L<d;L++)g[L]=f[k*d+L];for(fr(g,w,C,T,d),L=0;L<d;L++)f[k*d+L]=Math.sqrt(w[L])}}function fr(f,d,h,g,w){h[0]=0,g[0]=-bt,g[1]=+bt;for(var C=1,T=0;C<w;C++){for(var L=(f[C]+C*C-(f[h[T]]+h[T]*h[T]))/(2*C-2*h[T]);L<=g[T];)T--,L=(f[C]+C*C-(f[h[T]]+h[T]*h[T]))/(2*C-2*h[T]);h[++T]=C,g[T]=L,g[T+1]=+bt}for(C=0,T=0;C<w;C++){for(;g[T+1]<C;)T++;d[C]=(C-h[T])*(C-h[T])+f[h[T]]}}vt.prototype.draw=function(f){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(f,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var w=d.data[4*g+3]/255;this.gridOuter[g]=w===1?0:w===0?bt:Math.pow(Math.max(0,.5-w),2),this.gridInner[g]=w===1?bt:w===0?0:Math.pow(Math.max(0,w-.5),2)}for(Dr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Dr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)h[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return h},nr.default=Jt;var sr=function(f,d){this.requestManager=f,this.localIdeographFontFamily=d,this.entries={}};sr.prototype.setURL=function(f){this.url=f},sr.prototype.getGlyphs=function(f,d){var h=this,g=[];for(var w in f)for(var C=0,T=f[w];C<T.length;C+=1)g.push({stack:w,id:T[C]});y.asyncAll(g,function(L,k){var X=L.stack,ae=L.id,de=h.entries[X];de||(de=h.entries[X]={glyphs:{},requests:{},ranges:{}});var ge=de.glyphs[ae];if(ge===void 0){if(ge=h._tinySDF(de,X,ae))return de.glyphs[ae]=ge,void k(null,{stack:X,id:ae,glyph:ge});var Te=Math.floor(ae/256);if(256*Te>65535)k(new Error("glyphs > 65535 not supported"));else if(de.ranges[Te])k(null,{stack:X,id:ae,glyph:ge});else{var Re=de.requests[Te];Re||(Re=de.requests[Te]=[],sr.loadGlyphRange(X,Te,h.url,h.requestManager,function(We,Ae){if(Ae){for(var $e in Ae)h._doesCharSupportLocalGlyph(+$e)||(de.glyphs[+$e]=Ae[+$e]);de.ranges[Te]=!0}for(var ot=0,At=Re;ot<At.length;ot+=1)(0,At[ot])(We,Ae);delete de.requests[Te]})),Re.push(function(We,Ae){We?k(We):Ae&&k(null,{stack:X,id:ae,glyph:Ae[ae]||null})})}}else k(null,{stack:X,id:ae,glyph:ge})},function(L,k){if(L)d(L);else if(k){for(var X={},ae=0,de=k;ae<de.length;ae+=1){var ge=de[ae],Te=ge.stack,Re=ge.id,We=ge.glyph;(X[Te]||(X[Te]={}))[Re]=We&&{id:We.id,bitmap:We.bitmap.clone(),metrics:We.metrics}}d(null,X)}})},sr.prototype._doesCharSupportLocalGlyph=function(f){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](f)||y.isChar["Hangul Syllables"](f)||y.isChar.Hiragana(f)||y.isChar.Katakana(f))},sr.prototype._tinySDF=function(f,d,h){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(h)){var w=f.tinySDF;if(!w){var C="400";/bold/i.test(d)?C="900":/medium/i.test(d)?C="500":/light/i.test(d)&&(C="200"),w=f.tinySDF=new sr.TinySDF(24,3,8,.25,g,C)}return{id:h,bitmap:new y.AlphaImage({width:30,height:30},w.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},sr.loadGlyphRange=function(f,d,h,g,w){var C=256*d,T=C+255,L=g.transformRequest(g.normalizeGlyphsURL(h).replace("{fontstack}",f).replace("{range}",C+"-"+T),y.ResourceType.Glyphs);y.getArrayBuffer(L,function(k,X){if(k)w(k);else if(X){for(var ae={},de=0,ge=y.parseGlyphPBF(X);de<ge.length;de+=1){var Te=ge[de];ae[Te.id]=Te}w(null,ae)}})},sr.TinySDF=nr;var mt=function(){this.specification=y.styleSpec.light.position};mt.prototype.possiblyEvaluate=function(f,d){return y.sphericalToCartesian(f.expression.evaluate(d))},mt.prototype.interpolate=function(f,d,h){return{x:y.number(f.x,d.x,h),y:y.number(f.y,d.y,h),z:y.number(f.z,d.z,h)}};var nt=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new mt,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Lt=function(f){function d(h){f.call(this),this._transitionable=new y.Transitionable(nt),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,h,g))for(var w in h){var C=h[w];y.endsWith(w,"-transition")?this._transitionable.setTransition(w.slice(0,-"-transition".length),C):this._transitionable.setValue(w,C)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,g,w){return(!w||w.validate!==!1)&&y.emitValidationErrors(this,h.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},d}(y.Evented),lt=function(f,d){this.width=f,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};lt.prototype.getDash=function(f,d){var h=f.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(f,d)),this.dashEntry[h]},lt.prototype.getDashRanges=function(f,d,h){var g=[],w=f.length%2==1?-f[f.length-1]*h:0,C=f[0]*h,T=!0;g.push({left:w,right:C,isDash:T,zeroLength:f[0]===0});for(var L=f[0],k=1;k<f.length;k++){var X=f[k];g.push({left:w=L*h,right:C=(L+=X)*h,isDash:T=!T,zeroLength:X===0})}return g},lt.prototype.addRoundDash=function(f,d,h){for(var g=d/2,w=-h;w<=h;w++)for(var C=this.width*(this.nextRow+h+w),T=0,L=f[T],k=0;k<this.width;k++){k/L.right>1&&(L=f[++T]);var X=Math.abs(k-L.left),ae=Math.abs(k-L.right),de=Math.min(X,ae),ge=void 0,Te=w/h*(g+1);if(L.isDash){var Re=g-Math.abs(Te);ge=Math.sqrt(de*de+Re*Re)}else ge=g-Math.sqrt(de*de+Te*Te);this.data[C+k]=Math.max(0,Math.min(255,ge+128))}},lt.prototype.addRegularDash=function(f){for(var d=f.length-1;d>=0;--d){var h=f[d],g=f[d+1];h.zeroLength?f.splice(d,1):g&&g.isDash===h.isDash&&(g.left=h.left,f.splice(d,1))}var w=f[0],C=f[f.length-1];w.isDash===C.isDash&&(w.left=C.left-this.width,C.right=w.right+this.width);for(var T=this.width*this.nextRow,L=0,k=f[L],X=0;X<this.width;X++){X/k.right>1&&(k=f[++L]);var ae=Math.abs(X-k.left),de=Math.abs(X-k.right),ge=Math.min(ae,de);this.data[T+X]=Math.max(0,Math.min(255,(k.isDash?ge:-ge)+128))}},lt.prototype.addDash=function(f,d){var h=d?7:0,g=2*h+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var w=0,C=0;C<f.length;C++)w+=f[C];if(w!==0){var T=this.width/w,L=this.getDashRanges(f,this.width,T);d?this.addRoundDash(L,T,h):this.addRegularDash(L)}var k={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:w};return this.nextRow+=g,this.dirty=!0,k},lt.prototype.bind=function(f){var d=f.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var Xt=function f(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),w=0;w<g.length;w++){var C=new f.Actor(g[w],h,this.id);C.name="Worker "+w,this.actors.push(C)}};function _r(f,d,h){var g=function(w,C){if(w)return h(w);if(C){var T=y.pick(y.extend(C,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(T.vectorLayers=C.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(L){return L.id})),T.tiles=d.canonicalizeTileset(T,f.url),h(null,T)}};return f.url?y.getJSON(d.transformRequest(d.normalizeSourceURL(f.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,f)})}Xt.prototype.broadcast=function(f,d,h){y.asyncAll(this.actors,function(g,w){g.send(f,d,w)},h=h||function(){})},Xt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Xt.prototype.remove=function(){this.actors.forEach(function(f){f.remove()}),this.actors=[],this.workerPool.release(this.id)},Xt.Actor=y.Actor;var J=function(f,d,h){this.bounds=y.LngLatBounds.convert(this.validateBounds(f)),this.minzoom=d||0,this.maxzoom=h||24};J.prototype.validateBounds=function(f){return Array.isArray(f)&&f.length===4?[Math.max(-180,f[0]),Math.max(-90,f[1]),Math.min(180,f[2]),Math.min(90,f[3])]:[-180,-90,180,90]},J.prototype.contains=function(f){var d=Math.pow(2,f.z),h=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*d),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*d),w=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*d),C=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*d);return f.x>=h&&f.x<w&&f.y>=g&&f.y<C};var Ie=function(f){function d(h,g,w,C){if(f.call(this),this.id=h,this.dispatcher=w,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_r(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new J(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles,h.map._requestManager._customAccessToken),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var g=this;return this.setSourceProperty(function(){g._options.tiles=h}),this},d.prototype.setUrl=function(h){var g=this;return this.setSourceProperty(function(){g.url=h,g._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(w,y.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(L,k){return delete h.request,h.aborted?g(null):L&&L.status!==404?g(L):(k&&k.resourceTiming&&(h.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&h.setExpiryData(k),h.loadVectorData(k,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=g:h.request=h.actor.send("reloadTile",C,T.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",C,T.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(y.Evented),V=function(f){function d(h,g,w,C){f.call(this),this.id=h,this.dispatcher=w,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_r(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new J(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,g){var w=this,C=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=y.getImage(this.map._requestManager.transformRequest(C,y.ResourceType.Tile),function(T,L){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(T)h.state="errored",g(T);else if(L){w.map._refreshExpiredTiles&&h.setExpiryData(L),delete L.cacheControl,delete L.expires;var k=w.map.painter.context,X=k.gl;h.texture=w.map.painter.getTileTexture(L.width),h.texture?h.texture.update(L,{useMipmap:!0}):(h.texture=new y.Texture(k,L,X.RGBA,{useMipmap:!0}),h.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),k.extTextureFilterAnisotropic&&X.texParameterf(X.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax)),h.state="loaded",y.cacheEntryPossiblyAdded(w.dispatcher),g(null)}})},d.prototype.abortTile=function(h,g){h.request&&(h.request.cancel(),delete h.request),g()},d.prototype.unloadTile=function(h,g){h.texture&&this.map.painter.saveTileTexture(h.texture),g()},d.prototype.hasTransition=function(){return!1},d}(y.Evented),H=function(f){function d(h,g,w,C){f.call(this,h,g,w,C),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(T,L){T&&(h.state="errored",g(T)),L&&(h.dem=L,h.needsHillshadePrepare=!0,h.state="loaded",g(null))}h.request=y.getImage(this.map._requestManager.transformRequest(w,y.ResourceType.Tile),function(T,L){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(T)h.state="errored",g(T);else if(L){this.map._refreshExpiredTiles&&h.setExpiryData(L),delete L.cacheControl,delete L.expires;var k=y.window.ImageBitmap&&L instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?L:y.browser.getImageData(L,1),X={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:k,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",X,C.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var g=h.canonical,w=Math.pow(2,g.z),C=(g.x-1+w)%w,T=g.x===0?h.wrap-1:h.wrap,L=(g.x+1+w)%w,k=g.x+1===w?h.wrap+1:h.wrap,X={};return X[new y.OverscaledTileID(h.overscaledZ,T,g.z,C,g.y).key]={backfilled:!1},X[new y.OverscaledTileID(h.overscaledZ,k,g.z,L,g.y).key]={backfilled:!1},g.y>0&&(X[new y.OverscaledTileID(h.overscaledZ,T,g.z,C,g.y-1).key]={backfilled:!1},X[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},X[new y.OverscaledTileID(h.overscaledZ,k,g.z,L,g.y-1).key]={backfilled:!1}),g.y+1<w&&(X[new y.OverscaledTileID(h.overscaledZ,T,g.z,C,g.y+1).key]={backfilled:!1},X[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},X[new y.OverscaledTileID(h.overscaledZ,k,g.z,L,g.y+1).key]={backfilled:!1}),X},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(V),be=function(f){function d(h,g,w,C){f.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=w.getActor(),this.setEventedParent(C),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var T=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*T,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*T,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*T,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new y.ErrorEvent(g));else{var w={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(w.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new y.Event("data",w))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var g=this;return this._data=h,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(w){if(w)g.fire(new y.ErrorEvent(w));else{var C={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(C.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",C))}}),this},d.prototype.getClusterExpansionZoom=function(h,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},g),this},d.prototype.getClusterChildren=function(h,g){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},g),this},d.prototype.getClusterLeaves=function(h,g,w,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:g,offset:w},C),this},d.prototype._updateWorkerData=function(h){var g=this;this._loaded=!1;var w=y.extend({},this.workerOptions),C=this._data;typeof C=="string"?(w.request=this.map._requestManager.transformRequest(y.browser.resolveURL(C),y.ResourceType.Source),w.request.collectResourceTiming=this._collectResourceTiming):w.data=JSON.stringify(C),this.actor.send(this.type+".loadData",w,function(T,L){g._removed||L&&L.abandoned||(g._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[g.id]&&(g._resourceTiming=L.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:w.source},null),h(T))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,g){var w=this,C=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(C,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,L){return delete h.request,h.unloadVectorData(),h.aborted?g(null):T?g(T):(h.loadVectorData(L,w.map.painter,C==="reloadTile"),g(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(y.Evented),tt=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ht=function(f){function d(h,g,w,C){f.call(this),this.id=h,this.dispatcher=w,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(h,g){var w=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(C,T){w._loaded=!0,C?w.fire(new y.ErrorEvent(C)):T&&(w.image=T,h&&(w.coordinates=h),g&&g(),w._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var g=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){g.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var g=this;this.coordinates=h;var w=h.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var L=1/0,k=1/0,X=-1/0,ae=-1/0,de=0,ge=T;de<ge.length;de+=1){var Te=ge[de];L=Math.min(L,Te.x),k=Math.min(k,Te.y),X=Math.max(X,Te.x),ae=Math.max(ae,Te.y)}var Re=Math.max(X-L,ae-k),We=Math.max(0,Math.floor(-Math.log(Re)/Math.LN2)),Ae=Math.pow(2,We);return new y.CanonicalTileID(We,Math.floor((L+X)/2*Ae),Math.floor((k+ae)/2*Ae))}(w),this.minzoom=this.maxzoom=this.tileID.z;var C=w.map(function(T){return g.tileID.getTilePoint(T)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(h,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},d.prototype.loadTile=function(h,g){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},g(null)):(h.state="errored",g(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(y.Evented),St=function(f){function d(h,g,w,C){f.call(this,h,g,w,C),this.roundZoom=!0,this.type="video",this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var g=this.options;this.urls=[];for(var w=0,C=g.urls;w<C.length;w+=1)this.urls.push(this.map._requestManager.transformRequest(C[w],y.ResourceType.Source).url);y.getVideo(this.urls,function(T,L){h._loaded=!0,T?h.fire(new y.ErrorEvent(T)):L&&(h.video=L,h.video.loop=!0,h.video.setAttribute("playsinline",""),h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var g=this.video.seekable;h<g.start(0)||h>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(h,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(ht),jt=function(f){function d(h,g,w,C){f.call(this,h,g,w,C),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(L){return typeof L!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,w=g.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,w.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[C];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,g=[this.canvas.width,this.canvas.height];h<g.length;h+=1){var w=g[h];if(isNaN(w)||w<=0)return!0}return!1},d}(ht),tr={vector:Ie,raster:V,"raster-dem":H,geojson:be,video:St,image:ht,canvas:jt};function Hr(f,d){var h=y.identity([]);return y.translate(h,h,[1,1,0]),y.scale(h,h,[.5*f.width,.5*f.height,1]),y.multiply(h,h,f.calculatePosMatrix(d.toUnwrapped()))}function Br(f,d,h,g,w,C){var T=function(We,Ae,$e){if(We)for(var ot=0,At=We;ot<At.length;ot+=1){var Gt=Ae[At[ot]];if(Gt&&Gt.source===$e&&Gt.type==="fill-extrusion")return!0}else for(var Bt in Ae){var Ut=Ae[Bt];if(Ut.source===$e&&Ut.type==="fill-extrusion")return!0}return!1}(w&&w.layers,d,f.id),L=C.maxPitchScaleFactor(),k=f.tilesIn(g,L,T);k.sort(Bn);for(var X=[],ae=0,de=k;ae<de.length;ae+=1){var ge=de[ae];X.push({wrappedTileID:ge.tileID.wrapped().key,queryResults:ge.tile.queryRenderedFeatures(d,h,f._state,ge.queryGeometry,ge.cameraQueryGeometry,ge.scale,w,C,L,Hr(f.transform,ge.tileID))})}var Te=function(We){for(var Ae={},$e={},ot=0,At=We;ot<At.length;ot+=1){var Gt=At[ot],Bt=Gt.queryResults,Ut=Gt.wrappedTileID,hr=$e[Ut]=$e[Ut]||{};for(var Zr in Bt)for(var kr=Bt[Zr],rn=hr[Zr]=hr[Zr]||{},Cn=Ae[Zr]=Ae[Zr]||[],Ln=0,Mn=kr;Ln<Mn.length;Ln+=1){var Ci=Mn[Ln];rn[Ci.featureIndex]||(rn[Ci.featureIndex]=!0,Cn.push(Ci))}}return Ae}(X);for(var Re in Te)Te[Re].forEach(function(We){var Ae=We.feature,$e=f.getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=$e});return Te}function Bn(f,d){var h=f.tileID,g=d.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}var tn=function(f,d){this.max=f,this.onRemove=d,this.reset()};tn.prototype.reset=function(){for(var f in this.data)for(var d=0,h=this.data[f];d<h.length;d+=1){var g=h[d];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},tn.prototype.add=function(f,d,h){var g=this,w=f.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);var C={value:d,timeout:void 0};if(h!==void 0&&(C.timeout=setTimeout(function(){g.remove(f,C)},h)),this.data[w].push(C),this.order.push(w),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},tn.prototype.has=function(f){return f.wrapped().key in this.data},tn.prototype.getAndRemove=function(f){return this.has(f)?this._getAndRemoveByKey(f.wrapped().key):null},tn.prototype._getAndRemoveByKey=function(f){var d=this.data[f].shift();return d.timeout&&clearTimeout(d.timeout),this.data[f].length===0&&delete this.data[f],this.order.splice(this.order.indexOf(f),1),d.value},tn.prototype.getByKey=function(f){var d=this.data[f];return d?d[0].value:null},tn.prototype.get=function(f){return this.has(f)?this.data[f.wrapped().key][0].value:null},tn.prototype.remove=function(f,d){if(!this.has(f))return this;var h=f.wrapped().key,g=d===void 0?0:this.data[h].indexOf(d),w=this.data[h][g];return this.data[h].splice(g,1),w.timeout&&clearTimeout(w.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(w.value),this.order.splice(this.order.indexOf(h),1),this},tn.prototype.setMaxSize=function(f){for(this.max=f;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},tn.prototype.filter=function(f){var d=[];for(var h in this.data)for(var g=0,w=this.data[h];g<w.length;g+=1){var C=w[g];f(C.value)||d.push(C)}for(var T=0,L=d;T<L.length;T+=1){var k=L[T];this.remove(k.value.tileID,k)}};var gn=function(f,d,h){this.context=f;var g=f.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),f.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};gn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},gn.prototype.updateData=function(f){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,f.arrayBuffer)},gn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var fi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Vn=function(f,d,h,g){this.length=d.length,this.attributes=h,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=f;var w=f.gl;this.buffer=w.createBuffer(),f.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Vn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Vn.prototype.updateData=function(f){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,f.arrayBuffer)},Vn.prototype.enableAttributes=function(f,d){for(var h=0;h<this.attributes.length;h++){var g=d.attributes[this.attributes[h].name];g!==void 0&&f.enableVertexAttribArray(g)}},Vn.prototype.setVertexAttribPointers=function(f,d,h){for(var g=0;g<this.attributes.length;g++){var w=this.attributes[g],C=d.attributes[w.name];C!==void 0&&f.vertexAttribPointer(C,w.components,f[fi[w.type]],!1,this.itemSize,w.offset+this.itemSize*(h||0))}},Vn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var vn=function(f){this.gl=f.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};vn.prototype.get=function(){return this.current},vn.prototype.set=function(f){},vn.prototype.getDefault=function(){return this.default},vn.prototype.setDefault=function(){this.set(this.default)};var bi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(vn),Mi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(vn),Ei=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(vn),Gn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(vn),kn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(vn),mo=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(vn),Hi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var g=this.current;(h.func!==g.func||h.ref!==g.ref||h.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(vn),ja=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(vn),Tt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(vn),R=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(vn),ne=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(vn),fe=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(vn),Fe=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.BLEND):g.disable(g.BLEND),this.current=h,this.dirty=!1}},d}(vn),ct=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(vn),zt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(vn),Er=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(vn),Ne=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=h,this.dirty=!1}},d}(vn),Et=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(vn),ir=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(vn),xr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(vn),Wr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(vn),yn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(vn),Sn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(vn),En=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(vn),pn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(vn),Kn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(vn),Nn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(vn),Ji=function(f){function d(h){f.call(this,h),this.vao=h.extVertexArrayObject}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(vn),$i=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(vn),go=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(vn),rs=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(vn),qi=function(f){function d(h,g){f.call(this,h),this.context=h,this.parent=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(vn),W=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(qi),K=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(qi),ie=function(f,d,h,g){this.context=f,this.width=d,this.height=h;var w=this.framebuffer=f.gl.createFramebuffer();this.colorAttachment=new W(f,w),g&&(this.depthAttachment=new K(f,w))};ie.prototype.destroy=function(){var f=this.context.gl,d=this.colorAttachment.get();if(d&&f.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&f.deleteRenderbuffer(h)}f.deleteFramebuffer(this.framebuffer)};var _e=function(f,d,h){this.func=f,this.mask=d,this.range=h};_e.ReadOnly=!1,_e.ReadWrite=!0,_e.disabled=new _e(519,_e.ReadOnly,[0,1]);var Le=function(f,d,h,g,w,C){this.test=f,this.ref=d,this.mask=h,this.fail=g,this.depthFail=w,this.pass=C};Le.disabled=new Le({func:519,mask:0},0,0,7680,7680,7680);var Ke=function(f,d,h){this.blendFunction=f,this.blendColor=d,this.mask=h};Ke.disabled=new Ke(Ke.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),Ke.unblended=new Ke(Ke.Replace,y.Color.transparent,[!0,!0,!0,!0]),Ke.alphaBlended=new Ke([1,771],y.Color.transparent,[!0,!0,!0,!0]);var it=function(f,d,h){this.enable=f,this.mode=d,this.frontFace=h};it.disabled=new it(!1,1029,2305),it.backCCW=new it(!0,1029,2305);var he=function(f){this.gl=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new bi(this),this.clearDepth=new Mi(this),this.clearStencil=new Ei(this),this.colorMask=new Gn(this),this.depthMask=new kn(this),this.stencilMask=new mo(this),this.stencilFunc=new Hi(this),this.stencilOp=new ja(this),this.stencilTest=new Tt(this),this.depthRange=new R(this),this.depthTest=new ne(this),this.depthFunc=new fe(this),this.blend=new Fe(this),this.blendFunc=new ct(this),this.blendColor=new zt(this),this.blendEquation=new Er(this),this.cullFace=new Ne(this),this.cullFaceSide=new Et(this),this.frontFace=new ir(this),this.program=new xr(this),this.activeTexture=new Wr(this),this.viewport=new yn(this),this.bindFramebuffer=new Sn(this),this.bindRenderbuffer=new En(this),this.bindTexture=new pn(this),this.bindVertexBuffer=new Kn(this),this.bindElementBuffer=new Nn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ji(this),this.pixelStoreUnpack=new $i(this),this.pixelStoreUnpackPremultiplyAlpha=new go(this),this.pixelStoreUnpackFlipY=new rs(this),this.extTextureFilterAnisotropic=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=f.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=f.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(f.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=f.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=f.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE)};he.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},he.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},he.prototype.createIndexBuffer=function(f,d){return new gn(this,f,d)},he.prototype.createVertexBuffer=function(f,d,h){return new Vn(this,f,d,h)},he.prototype.createRenderbuffer=function(f,d,h){var g=this.gl,w=g.createRenderbuffer();return this.bindRenderbuffer.set(w),g.renderbufferStorage(g.RENDERBUFFER,f,d,h),this.bindRenderbuffer.set(null),w},he.prototype.createFramebuffer=function(f,d,h){return new ie(this,f,d,h)},he.prototype.clear=function(f){var d=f.color,h=f.depth,g=this.gl,w=0;d&&(w|=g.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g.clear(w)},he.prototype.setCullFace=function(f){f.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(f.mode),this.frontFace.set(f.frontFace))},he.prototype.setDepthMode=function(f){f.func!==this.gl.ALWAYS||f.mask?(this.depthTest.set(!0),this.depthFunc.set(f.func),this.depthMask.set(f.mask),this.depthRange.set(f.range)):this.depthTest.set(!1)},he.prototype.setStencilMode=function(f){f.test.func!==this.gl.ALWAYS||f.mask?(this.stencilTest.set(!0),this.stencilMask.set(f.mask),this.stencilOp.set([f.fail,f.depthFail,f.pass]),this.stencilFunc.set({func:f.test.func,ref:f.ref,mask:f.test.mask})):this.stencilTest.set(!1)},he.prototype.setColorMode=function(f){y.deepEqual(f.blendFunction,Ke.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(f.blendFunction),this.blendColor.set(f.blendColor)),this.colorMask.set(f.mask)},he.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Oe=function(f){function d(h,g,w){var C=this;f.call(this),this.id=h,this.dispatcher=w,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(T,L,k,X){var ae=new tr[L.type](T,L,k,X);if(ae.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+ae.id);return y.bindAll(["load","abort","unload","serialize","prepare"],ae),ae}(h,g,w,this),this._tiles={},this._cache=new tn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var g=this._tiles[h];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,g){return this._source.loadTile(h,g)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var w=this._tiles[g];w.upload(h),w.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return y.values(this._tiles).map(function(h){return h.tileID}).sort(wt).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var g=this,w=[];for(var C in this._tiles)this._isIdRenderable(C,h)&&w.push(this._tiles[C]);return h?w.sort(function(T,L){var k=T.tileID,X=L.tileID,ae=new y.Point(k.canonical.x,k.canonical.y)._rotate(g.transform.angle),de=new y.Point(X.canonical.x,X.canonical.y)._rotate(g.transform.angle);return k.overscaledZ-X.overscaledZ||de.y-ae.y||de.x-ae.x}).map(function(T){return T.tileID.key}):w.map(function(T){return T.tileID}).sort(wt).map(function(T){return T.key})},d.prototype.hasRenderableParent=function(h){var g=this.findLoadedParent(h,0);return!!g&&this._isIdRenderable(g.tileID.key)},d.prototype._isIdRenderable=function(h,g){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(g||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,g){var w=this._tiles[h];w&&(w.state!=="loading"&&(w.state=g),this._loadTile(w,this._tileLoaded.bind(this,w,h,g)))},d.prototype._tileLoaded=function(h,g,w,C){if(C)return h.state="errored",void(C.status!==404?this._source.fire(new y.ErrorEvent(C,{tile:h})):this.update(this.transform));h.timeAdded=y.browser.now(),w==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(g,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var g=this.getRenderableIds(),w=0;w<g.length;w++){var C=g[w];if(h.neighboringTiles&&h.neighboringTiles[C]){var T=this.getTileByID(C);L(h,T),L(T,h)}}function L(k,X){k.needsHillshadePrepare=!0;var ae=X.tileID.canonical.x-k.tileID.canonical.x,de=X.tileID.canonical.y-k.tileID.canonical.y,ge=Math.pow(2,k.tileID.canonical.z),Te=X.tileID.key;ae===0&&de===0||Math.abs(de)>1||(Math.abs(ae)>1&&(Math.abs(ae+ge)===1?ae+=ge:Math.abs(ae-ge)===1&&(ae-=ge)),X.dem&&k.dem&&(k.dem.backfillBorder(X.dem,ae,de),k.neighboringTiles&&k.neighboringTiles[Te]&&(k.neighboringTiles[Te].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,g,w,C){for(var T in this._tiles){var L=this._tiles[T];if(!(C[T]||!L.hasData()||L.tileID.overscaledZ<=g||L.tileID.overscaledZ>w)){for(var k=L.tileID;L&&L.tileID.overscaledZ>g+1;){var X=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[X.key])&&L.hasData()&&(k=X)}for(var ae=k;ae.overscaledZ>g;)if(h[(ae=ae.scaledTo(ae.overscaledZ-1)).key]){C[k.key]=k;break}}}},d.prototype.findLoadedParent=function(h,g){if(h.key in this._loadedParentTiles){var w=this._loadedParentTiles[h.key];return w&&w.tileID.overscaledZ>=g?w:null}for(var C=h.overscaledZ-1;C>=g;C--){var T=h.scaledTo(C),L=this._getLoadedTile(T);if(L)return L}},d.prototype._getLoadedTile=function(h){var g=this._tiles[h.key];return g&&g.hasData()?g:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var g=Math.ceil(h.width/this._source.tileSize)+1,w=Math.ceil(h.height/this._source.tileSize)+1,C=Math.floor(g*w*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(T)},d.prototype.handleWrapJump=function(h){var g=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,g){var w={};for(var C in this._tiles){var T=this._tiles[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+g),w[T.tileID.key]=T}for(var L in this._tiles=w,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var k in this._tiles)this._setTileReloadTimer(k,this._tiles[k])}},d.prototype.update=function(h){var g=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var w;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?w=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(hr){return new y.OverscaledTileID(hr.canonical.z,hr.wrap,hr.canonical.z,hr.canonical.x,hr.canonical.y)}):(w=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(w=w.filter(function(hr){return g._source.hasTile(hr)}))):w=[];var C=h.coveringZoomLevel(this._source),T=Math.max(C-d.maxOverzooming,this._source.minzoom),L=Math.max(C+d.maxUnderzooming,this._source.minzoom),k=this._updateRetainedTiles(w,C);if(br(this._source.type)){for(var X={},ae={},de=0,ge=Object.keys(k);de<ge.length;de+=1){var Te=ge[de],Re=k[Te],We=this._tiles[Te];if(We&&!(We.fadeEndTime&&We.fadeEndTime<=y.browser.now())){var Ae=this.findLoadedParent(Re,T);Ae&&(this._addTile(Ae.tileID),X[Ae.tileID.key]=Ae.tileID),ae[Te]=Re}}for(var $e in this._retainLoadedChildren(ae,C,L,k),X)k[$e]||(this._coveredTiles[$e]=!0,k[$e]=X[$e])}for(var ot in k)this._tiles[ot].clearFadeHold();for(var At=0,Gt=y.keysDifference(this._tiles,k);At<Gt.length;At+=1){var Bt=Gt[At],Ut=this._tiles[Bt];Ut.hasSymbolBuckets&&!Ut.holdingForFade()?Ut.setHoldDuration(this.map._fadeDuration):Ut.hasSymbolBuckets&&!Ut.symbolFadeFinished()||this._removeTile(Bt)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,g){for(var w={},C={},T=Math.max(g-d.maxOverzooming,this._source.minzoom),L=Math.max(g+d.maxUnderzooming,this._source.minzoom),k={},X=0,ae=h;X<ae.length;X+=1){var de=ae[X],ge=this._addTile(de);w[de.key]=de,ge.hasData()||g<this._source.maxzoom&&(k[de.key]=de)}this._retainLoadedChildren(k,g,L,w);for(var Te=0,Re=h;Te<Re.length;Te+=1){var We=Re[Te],Ae=this._tiles[We.key];if(!Ae.hasData()){if(g+1>this._source.maxzoom){var $e=We.children(this._source.maxzoom)[0],ot=this.getTile($e);if(ot&&ot.hasData()){w[$e.key]=$e;continue}}else{var At=We.children(this._source.maxzoom);if(w[At[0].key]&&w[At[1].key]&&w[At[2].key]&&w[At[3].key])continue}for(var Gt=Ae.wasRequested(),Bt=We.overscaledZ-1;Bt>=T;--Bt){var Ut=We.scaledTo(Bt);if(C[Ut.key]||(C[Ut.key]=!0,!(Ae=this.getTile(Ut))&&Gt&&(Ae=this._addTile(Ut)),Ae&&(w[Ut.key]=Ut,Gt=Ae.wasRequested(),Ae.hasData())))break}}}return w},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var g=[],w=void 0,C=this._tiles[h].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){w=this._loadedParentTiles[C.key];break}g.push(C.key);var T=C.scaledTo(C.overscaledZ-1);if(w=this._getLoadedTile(T))break;C=T}for(var L=0,k=g;L<k.length;L+=1)this._loadedParentTiles[k[L]]=w}},d.prototype._addTile=function(h){var g=this._tiles[h.key];if(g)return g;(g=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,g),g.tileID=h,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,g)));var w=Boolean(g);return w||(g=new y.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,h.key,g.state))),g?(g.uses++,this._tiles[h.key]=g,w||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},d.prototype._setTileReloadTimer=function(h,g){var w=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var C=g.getExpiryTimeout();C&&(this._timers[h]=setTimeout(function(){w._reloadTile(h,"expired"),delete w._timers[h]},C))},d.prototype._removeTile=function(h){var g=this._tiles[h];g&&(g.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,g,w){var C=this,T=[],L=this.transform;if(!L)return T;for(var k=w?L.getCameraQueryGeometry(h):h,X=h.map(function(Bt){return L.pointCoordinate(Bt)}),ae=k.map(function(Bt){return L.pointCoordinate(Bt)}),de=this.getIds(),ge=1/0,Te=1/0,Re=-1/0,We=-1/0,Ae=0,$e=ae;Ae<$e.length;Ae+=1){var ot=$e[Ae];ge=Math.min(ge,ot.x),Te=Math.min(Te,ot.y),Re=Math.max(Re,ot.x),We=Math.max(We,ot.y)}for(var At=function(Bt){var Ut=C._tiles[de[Bt]];if(!Ut.holdingForFade()){var hr=Ut.tileID,Zr=Math.pow(2,L.zoom-Ut.tileID.overscaledZ),kr=g*Ut.queryPadding*y.EXTENT/Ut.tileSize/Zr,rn=[hr.getTilePoint(new y.MercatorCoordinate(ge,Te)),hr.getTilePoint(new y.MercatorCoordinate(Re,We))];if(rn[0].x-kr<y.EXTENT&&rn[0].y-kr<y.EXTENT&&rn[1].x+kr>=0&&rn[1].y+kr>=0){var Cn=X.map(function(Mn){return hr.getTilePoint(Mn)}),Ln=ae.map(function(Mn){return hr.getTilePoint(Mn)});T.push({tile:Ut,tileID:hr,queryGeometry:Cn,cameraQueryGeometry:Ln,scale:Zr})}}},Gt=0;Gt<de.length;Gt++)At(Gt);return T},d.prototype.getVisibleCoordinates=function(h){for(var g=this,w=this.getRenderableIds(h).map(function(k){return g._tiles[k].tileID}),C=0,T=w;C<T.length;C+=1){var L=T[C];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return w},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(br(this._source.type))for(var h in this._tiles){var g=this._tiles[h];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,g,w){this._state.updateState(h=h||"_geojsonTileLayer",g,w)},d.prototype.removeFeatureState=function(h,g,w){this._state.removeFeatureState(h=h||"_geojsonTileLayer",g,w)},d.prototype.getFeatureState=function(h,g){return this._state.getState(h=h||"_geojsonTileLayer",g)},d.prototype.setDependencies=function(h,g,w){var C=this._tiles[h];C&&C.setDependencies(g,w)},d.prototype.reloadTilesForDependencies=function(h,g){for(var w in this._tiles)this._tiles[w].hasDependency(h,g)&&this._reloadTile(w,"reloading");this._cache.filter(function(C){return!C.hasDependency(h,g)})},d}(y.Evented);function wt(f,d){var h=Math.abs(2*f.wrap)-+(f.wrap<0),g=Math.abs(2*d.wrap)-+(d.wrap<0);return f.overscaledZ-d.overscaledZ||g-h||d.canonical.y-f.canonical.y||d.canonical.x-f.canonical.x}function br(f){return f==="raster"||f==="image"||f==="video"}function Mr(){return new y.window.Worker(of.workerUrl)}Oe.maxOverzooming=10,Oe.maxUnderzooming=3;var Rt="mapboxgl_preloaded_worker_pool",mr=function(){this.active={}};mr.prototype.acquire=function(f){if(!this.workers)for(this.workers=[];this.workers.length<mr.workerCount;)this.workers.push(new Mr);return this.active[f]=!0,this.workers.slice()},mr.prototype.release=function(f){delete this.active[f],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},mr.prototype.isPreloaded=function(){return!!this.active[Rt]},mr.prototype.numActive=function(){return Object.keys(this.active).length};var mn,sn=Math.floor(y.browser.hardwareConcurrency/2);function Qt(){return mn||(mn=new mr),mn}function je(f,d){var h={};for(var g in f)g!=="ref"&&(h[g]=f[g]);return y.refProperties.forEach(function(w){w in d&&(h[w]=d[w])}),h}function qr(f){f=f.slice();for(var d=Object.create(null),h=0;h<f.length;h++)d[f[h].id]=f[h];for(var g=0;g<f.length;g++)"ref"in f[g]&&(f[g]=je(f[g],d[f[g].ref]));return f}mr.workerCount=Math.max(Math.min(sn,6),1);var Q={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ri(f,d,h){h.push({command:Q.addSource,args:[f,d[f]]})}function en(f,d,h){d.push({command:Q.removeSource,args:[f]}),h[f]=!0}function Jn(f,d,h,g){en(f,h,g),ri(f,d,h)}function Zi(f,d,h){var g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;for(g in d[h])if(d[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;return!0}function ni(f,d,h,g,w,C){var T;for(T in d=d||{},f=f||{})f.hasOwnProperty(T)&&(y.deepEqual(f[T],d[T])||h.push({command:C,args:[g,T,d[T],w]}));for(T in d)d.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(y.deepEqual(f[T],d[T])||h.push({command:C,args:[g,T,d[T],w]}))}function Ii(f){return f.id}function hi(f,d){return f[d.id]=d,f}var yo=function(f,d){this.reset(f,d)};yo.prototype.reset=function(f,d){this.points=f||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},yo.prototype.lerp=function(f){if(this.points.length===1)return this.points[0];f=y.clamp(f,0,1);for(var d=1,h=this._distances[d],g=f*this.paddedLength+this.padding;h<g&&d<this._distances.length;)h=this._distances[++d];var w=d-1,C=this._distances[w],T=h-C,L=T>0?(g-C)/T:0;return this.points[w].mult(1-L).add(this.points[d].mult(L))};var Fi=function(f,d,h){var g=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(f/h),this.yCellCount=Math.ceil(d/h);for(var C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=f,this.height=d,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function ea(f,d,h,g,w){var C=y.create();return d?(y.scale(C,C,[1/w,1/w,1]),h||y.rotateZ(C,C,g.angle)):y.multiply(C,g.labelPlaneMatrix,f),C}function vi(f,d,h,g,w){if(d){var C=y.clone(f);return y.scale(C,C,[w,w,1]),h||y.rotateZ(C,C,-g.angle),C}return g.glCoordMatrix}function si(f,d){var h=[f.x,f.y,0,1];Sa(h,h,d);var g=h[3];return{point:new y.Point(h[0]/g,h[1]/g),signedDistanceFromCamera:g}}function Qn(f,d){return .5+f/d*.5}function ba(f,d){var h=f[0]/f[3],g=f[1]/f[3];return h>=-d[0]&&h<=d[0]&&g>=-d[1]&&g<=d[1]}function Is(f,d,h,g,w,C,T,L){var k=g?f.textSizeData:f.iconSizeData,X=y.evaluateSizeForZoom(k,h.transform.zoom),ae=[256/h.width*2+1,256/h.height*2+1],de=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;de.clear();for(var ge=f.lineVertexArray,Te=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,Re=h.transform.width/h.transform.height,We=!1,Ae=0;Ae<Te.length;Ae++){var $e=Te.get(Ae);if($e.hidden||$e.writingMode===y.WritingMode.vertical&&!We)Oa($e.numGlyphs,de);else{We=!1;var ot=[$e.anchorX,$e.anchorY,0,1];if(y.transformMat4(ot,ot,d),ba(ot,ae)){var At=Qn(h.transform.cameraToCenterDistance,ot[3]),Gt=y.evaluateSizeForFeature(k,X,$e),Bt=T?Gt/At:Gt*At,Ut=new y.Point($e.anchorX,$e.anchorY),hr=si(Ut,w).point,Zr={},kr=Ou($e,Bt,!1,L,d,w,C,f.glyphOffsetArray,ge,de,hr,Ut,Zr,Re);We=kr.useVertical,(kr.notEnoughRoom||We||kr.needsFlipping&&Ou($e,Bt,!0,L,d,w,C,f.glyphOffsetArray,ge,de,hr,Ut,Zr,Re).notEnoughRoom)&&Oa($e.numGlyphs,de)}else Oa($e.numGlyphs,de)}}g?f.text.dynamicLayoutVertexBuffer.updateData(de):f.icon.dynamicLayoutVertexBuffer.updateData(de)}function Qi(f,d,h,g,w,C,T,L,k,X,ae){var de=L.glyphStartIndex+L.numGlyphs,ge=L.lineStartIndex,Te=L.lineStartIndex+L.lineLength,Re=d.getoffsetX(L.glyphStartIndex),We=d.getoffsetX(de-1),Ae=sa(f*Re,h,g,w,C,T,L.segment,ge,Te,k,X,ae);if(!Ae)return null;var $e=sa(f*We,h,g,w,C,T,L.segment,ge,Te,k,X,ae);return $e?{first:Ae,last:$e}:null}function fa(f,d,h,g){return f===y.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*g?{useVertical:!0}:(f===y.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function Ou(f,d,h,g,w,C,T,L,k,X,ae,de,ge,Te){var Re,We=d/24,Ae=f.lineOffsetX*We,$e=f.lineOffsetY*We;if(f.numGlyphs>1){var ot=f.glyphStartIndex+f.numGlyphs,At=f.lineStartIndex,Gt=f.lineStartIndex+f.lineLength,Bt=Qi(We,L,Ae,$e,h,ae,de,f,k,C,ge);if(!Bt)return{notEnoughRoom:!0};var Ut=si(Bt.first.point,T).point,hr=si(Bt.last.point,T).point;if(g&&!h){var Zr=fa(f.writingMode,Ut,hr,Te);if(Zr)return Zr}Re=[Bt.first];for(var kr=f.glyphStartIndex+1;kr<ot-1;kr++)Re.push(sa(We*L.getoffsetX(kr),Ae,$e,h,ae,de,f.segment,At,Gt,k,C,ge));Re.push(Bt.last)}else{if(g&&!h){var rn=si(de,w).point,Cn=f.lineStartIndex+f.segment+1,Ln=new y.Point(k.getx(Cn),k.gety(Cn)),Mn=si(Ln,w),Ci=Mn.signedDistanceFromCamera>0?Mn.point:Du(de,Ln,rn,1,w),nn=fa(f.writingMode,rn,Ci,Te);if(nn)return nn}var $n=sa(We*L.getoffsetX(f.glyphStartIndex),Ae,$e,h,ae,de,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,k,C,ge);if(!$n)return{notEnoughRoom:!0};Re=[$n]}for(var ii=0,Yn=Re;ii<Yn.length;ii+=1){var Wn=Yn[ii];y.addDynamicAttributes(X,Wn.point,Wn.angle)}return{}}function Du(f,d,h,g,w){var C=si(f.add(f.sub(d)._unit()),w).point,T=h.sub(C);return h.add(T._mult(g/T.mag()))}function sa(f,d,h,g,w,C,T,L,k,X,ae,de){var ge=g?f-d:f+d,Te=ge>0?1:-1,Re=0;g&&(Te*=-1,Re=Math.PI),Te<0&&(Re+=Math.PI);for(var We=Te>0?L+T:L+T+1,Ae=w,$e=w,ot=0,At=0,Gt=Math.abs(ge),Bt=[];ot+At<=Gt;){if((We+=Te)<L||We>=k)return null;if($e=Ae,Bt.push(Ae),(Ae=de[We])===void 0){var Ut=new y.Point(X.getx(We),X.gety(We)),hr=si(Ut,ae);if(hr.signedDistanceFromCamera>0)Ae=de[We]=hr.point;else{var Zr=We-Te;Ae=Du(ot===0?C:new y.Point(X.getx(Zr),X.gety(Zr)),Ut,$e,Gt-ot+1,ae)}}ot+=At,At=$e.dist(Ae)}var kr=(Gt-ot)/At,rn=Ae.sub($e),Cn=rn.mult(kr)._add($e);Cn._add(rn._unit()._perp()._mult(h*Te));var Ln=Re+Math.atan2(Ae.y-$e.y,Ae.x-$e.x);return Bt.push(Cn),{point:Cn,angle:Ln,path:Bt}}Fi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Fi.prototype.insert=function(f,d,h,g,w){this._forEachCell(d,h,g,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(f),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(w)},Fi.prototype.insertCircle=function(f,d,h,g){this._forEachCell(d-g,h-g,d+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(f),this.circles.push(d),this.circles.push(h),this.circles.push(g)},Fi.prototype._insertBoxCell=function(f,d,h,g,w,C){this.boxCells[w].push(C)},Fi.prototype._insertCircleCell=function(f,d,h,g,w,C){this.circleCells[w].push(C)},Fi.prototype._query=function(f,d,h,g,w,C){if(h<0||f>this.width||g<0||d>this.height)return!w&&[];var T=[];if(f<=0&&d<=0&&this.width<=h&&this.height<=g){if(w)return!0;for(var L=0;L<this.boxKeys.length;L++)T.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var k=0;k<this.circleKeys.length;k++){var X=this.circles[3*k],ae=this.circles[3*k+1],de=this.circles[3*k+2];T.push({key:this.circleKeys[k],x1:X-de,y1:ae-de,x2:X+de,y2:ae+de})}return C?T.filter(C):T}return this._forEachCell(f,d,h,g,this._queryCell,T,{hitTest:w,seenUids:{box:{},circle:{}}},C),w?T.length>0:T},Fi.prototype._queryCircle=function(f,d,h,g,w){var C=f-h,T=f+h,L=d-h,k=d+h;if(T<0||C>this.width||k<0||L>this.height)return!g&&[];var X=[];return this._forEachCell(C,L,T,k,this._queryCellCircle,X,{hitTest:g,circle:{x:f,y:d,radius:h},seenUids:{box:{},circle:{}}},w),g?X.length>0:X},Fi.prototype.query=function(f,d,h,g,w){return this._query(f,d,h,g,!1,w)},Fi.prototype.hitTest=function(f,d,h,g,w){return this._query(f,d,h,g,!0,w)},Fi.prototype.hitTestCircle=function(f,d,h,g){return this._queryCircle(f,d,h,!0,g)},Fi.prototype._queryCell=function(f,d,h,g,w,C,T,L){var k=T.seenUids,X=this.boxCells[w];if(X!==null)for(var ae=this.bboxes,de=0,ge=X;de<ge.length;de+=1){var Te=ge[de];if(!k.box[Te]){k.box[Te]=!0;var Re=4*Te;if(f<=ae[Re+2]&&d<=ae[Re+3]&&h>=ae[Re+0]&&g>=ae[Re+1]&&(!L||L(this.boxKeys[Te]))){if(T.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Te],x1:ae[Re],y1:ae[Re+1],x2:ae[Re+2],y2:ae[Re+3]})}}}var We=this.circleCells[w];if(We!==null)for(var Ae=this.circles,$e=0,ot=We;$e<ot.length;$e+=1){var At=ot[$e];if(!k.circle[At]){k.circle[At]=!0;var Gt=3*At;if(this._circleAndRectCollide(Ae[Gt],Ae[Gt+1],Ae[Gt+2],f,d,h,g)&&(!L||L(this.circleKeys[At]))){if(T.hitTest)return C.push(!0),!0;var Bt=Ae[Gt],Ut=Ae[Gt+1],hr=Ae[Gt+2];C.push({key:this.circleKeys[At],x1:Bt-hr,y1:Ut-hr,x2:Bt+hr,y2:Ut+hr})}}}},Fi.prototype._queryCellCircle=function(f,d,h,g,w,C,T,L){var k=T.circle,X=T.seenUids,ae=this.boxCells[w];if(ae!==null)for(var de=this.bboxes,ge=0,Te=ae;ge<Te.length;ge+=1){var Re=Te[ge];if(!X.box[Re]){X.box[Re]=!0;var We=4*Re;if(this._circleAndRectCollide(k.x,k.y,k.radius,de[We+0],de[We+1],de[We+2],de[We+3])&&(!L||L(this.boxKeys[Re])))return C.push(!0),!0}}var Ae=this.circleCells[w];if(Ae!==null)for(var $e=this.circles,ot=0,At=Ae;ot<At.length;ot+=1){var Gt=At[ot];if(!X.circle[Gt]){X.circle[Gt]=!0;var Bt=3*Gt;if(this._circlesCollide($e[Bt],$e[Bt+1],$e[Bt+2],k.x,k.y,k.radius)&&(!L||L(this.circleKeys[Gt])))return C.push(!0),!0}}},Fi.prototype._forEachCell=function(f,d,h,g,w,C,T,L){for(var k=this._convertToXCellCoord(f),X=this._convertToYCellCoord(d),ae=this._convertToXCellCoord(h),de=this._convertToYCellCoord(g),ge=k;ge<=ae;ge++)for(var Te=X;Te<=de;Te++)if(w.call(this,f,d,h,g,this.xCellCount*Te+ge,C,T,L))return},Fi.prototype._convertToXCellCoord=function(f){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(f*this.xScale)))},Fi.prototype._convertToYCellCoord=function(f){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(f*this.yScale)))},Fi.prototype._circlesCollide=function(f,d,h,g,w,C){var T=g-f,L=w-d,k=h+C;return k*k>T*T+L*L},Fi.prototype._circleAndRectCollide=function(f,d,h,g,w,C,T){var L=(C-g)/2,k=Math.abs(f-(g+L));if(k>L+h)return!1;var X=(T-w)/2,ae=Math.abs(d-(w+X));if(ae>X+h)return!1;if(k<=L||ae<=X)return!0;var de=k-L,ge=ae-X;return de*de+ge*ge<=h*h};var oo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oa(f,d){for(var h=0;h<f;h++){var g=d.length;d.resize(g+4),d.float32.set(oo,3*g)}}function Sa(f,d,h){var g=d[0],w=d[1];return f[0]=h[0]*g+h[4]*w+h[12],f[1]=h[1]*g+h[5]*w+h[13],f[3]=h[3]*g+h[7]*w+h[15],f}var Ro=function(f,d,h){d===void 0&&(d=new Fi(f.width+200,f.height+200,25)),h===void 0&&(h=new Fi(f.width+200,f.height+200,25)),this.transform=f,this.grid=d,this.ignoredGrid=h,this.pitchfactor=Math.cos(f._pitch)*f.cameraToCenterDistance,this.screenRightBoundary=f.width+100,this.screenBottomBoundary=f.height+100,this.gridRightBoundary=f.width+200,this.gridBottomBoundary=f.height+200};function Vi(f,d,h){return d*(y.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}Ro.prototype.placeCollisionBox=function(f,d,h,g,w){var C=this.projectAndGetPerspectiveRatio(g,f.anchorPointX,f.anchorPointY),T=h*C.perspectiveRatio,L=f.x1*T+C.point.x,k=f.y1*T+C.point.y,X=f.x2*T+C.point.x,ae=f.y2*T+C.point.y;return!this.isInsideGrid(L,k,X,ae)||!d&&this.grid.hitTest(L,k,X,ae,w)?{box:[],offscreen:!1}:{box:[L,k,X,ae],offscreen:this.isOffscreen(L,k,X,ae)}},Ro.prototype.placeCollisionCircles=function(f,d,h,g,w,C,T,L,k,X,ae,de,ge){var Te=[],Re=new y.Point(d.anchorX,d.anchorY),We=si(Re,C),Ae=Qn(this.transform.cameraToCenterDistance,We.signedDistanceFromCamera),$e=(X?w/Ae:w*Ae)/y.ONE_EM,ot=si(Re,T).point,At=Qi($e,g,d.lineOffsetX*$e,d.lineOffsetY*$e,!1,ot,Re,d,h,T,{}),Gt=!1,Bt=!1,Ut=!0;if(At){for(var hr=.5*de*Ae+ge,Zr=new y.Point(-100,-100),kr=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),rn=new yo,Cn=At.first,Ln=At.last,Mn=[],Ci=Cn.path.length-1;Ci>=1;Ci--)Mn.push(Cn.path[Ci]);for(var nn=1;nn<Ln.path.length;nn++)Mn.push(Ln.path[nn]);var $n=2.5*hr;if(L){var ii=Mn.map(function(xs){return si(xs,L)});Mn=ii.some(function(xs){return xs.signedDistanceFromCamera<=0})?[]:ii.map(function(xs){return xs.point})}var Yn=[];if(Mn.length>0){for(var Wn=Mn[0].clone(),oi=Mn[0].clone(),Hn=1;Hn<Mn.length;Hn++)Wn.x=Math.min(Wn.x,Mn[Hn].x),Wn.y=Math.min(Wn.y,Mn[Hn].y),oi.x=Math.max(oi.x,Mn[Hn].x),oi.y=Math.max(oi.y,Mn[Hn].y);Yn=Wn.x>=Zr.x&&oi.x<=kr.x&&Wn.y>=Zr.y&&oi.y<=kr.y?[Mn]:oi.x<Zr.x||Wn.x>kr.x||oi.y<Zr.y||Wn.y>kr.y?[]:y.clipLine([Mn],Zr.x,Zr.y,kr.x,kr.y)}for(var Zn=0,aa=Yn;Zn<aa.length;Zn+=1){var ga;rn.reset(aa[Zn],.25*hr),ga=rn.length<=.5*hr?1:Math.ceil(rn.paddedLength/$n)+1;for(var So=0;So<ga;So++){var lo=So/Math.max(ga-1,1),ya=rn.lerp(lo),Ia=ya.x+100,Ja=ya.y+100;Te.push(Ia,Ja,hr,0);var No=Ia-hr,Qu=Ja-hr,Zo=Ia+hr,Uo=Ja+hr;if(Ut=Ut&&this.isOffscreen(No,Qu,Zo,Uo),Bt=Bt||this.isInsideGrid(No,Qu,Zo,Uo),!f&&this.grid.hitTestCircle(Ia,Ja,hr,ae)&&(Gt=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Gt}}}}return{circles:!k&&Gt||!Bt?[]:Te,offscreen:Ut,collisionDetected:Gt}},Ro.prototype.queryRenderedSymbols=function(f){if(f.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,g=1/0,w=-1/0,C=-1/0,T=0,L=f;T<L.length;T+=1){var k=L[T],X=new y.Point(k.x+100,k.y+100);h=Math.min(h,X.x),g=Math.min(g,X.y),w=Math.max(w,X.x),C=Math.max(C,X.y),d.push(X)}for(var ae={},de={},ge=0,Te=this.grid.query(h,g,w,C).concat(this.ignoredGrid.query(h,g,w,C));ge<Te.length;ge+=1){var Re=Te[ge],We=Re.key;if(ae[We.bucketInstanceId]===void 0&&(ae[We.bucketInstanceId]={}),!ae[We.bucketInstanceId][We.featureIndex]){var Ae=[new y.Point(Re.x1,Re.y1),new y.Point(Re.x2,Re.y1),new y.Point(Re.x2,Re.y2),new y.Point(Re.x1,Re.y2)];y.polygonIntersectsPolygon(d,Ae)&&(ae[We.bucketInstanceId][We.featureIndex]=!0,de[We.bucketInstanceId]===void 0&&(de[We.bucketInstanceId]=[]),de[We.bucketInstanceId].push(We.featureIndex))}}return de},Ro.prototype.insertCollisionBox=function(f,d,h,g,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:w},f[0],f[1],f[2],f[3])},Ro.prototype.insertCollisionCircles=function(f,d,h,g,w){for(var C=d?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:g,collisionGroupID:w},L=0;L<f.length;L+=4)C.insertCircle(T,f[L],f[L+1],f[L+2])},Ro.prototype.projectAndGetPerspectiveRatio=function(f,d,h){var g=[d,h,0,1];return Sa(g,g,f),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},Ro.prototype.isOffscreen=function(f,d,h,g){return h<100||f>=this.screenRightBoundary||g<100||d>this.screenBottomBoundary},Ro.prototype.isInsideGrid=function(f,d,h,g){return h>=0&&f<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary},Ro.prototype.getViewportMatrix=function(){var f=y.identity([]);return y.translate(f,f,[-100,-100,0]),f};var Oo=function(f,d,h,g){this.opacity=f?Math.max(0,Math.min(1,f.opacity+(f.placed?d:-d))):g&&h?1:0,this.placed=h};Oo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var _o=function(f,d,h,g,w){this.text=new Oo(f?f.text:null,d,h,w),this.icon=new Oo(f?f.icon:null,d,g,w)};_o.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ns=function(f,d,h){this.text=f,this.icon=d,this.skipFade=h},is=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},Gc=function(f,d,h,g,w){this.bucketInstanceId=f,this.featureIndex=d,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=w},Ho=function(f){this.crossSourceCollisions=f,this.maxGroupID=0,this.collisionGroups={}};function Da(f,d,h,g,w){var C=y.getAnchorAlignment(f),T=-(C.horizontalAlign-.5)*d,L=-(C.verticalAlign-.5)*h,k=y.evaluateVariableOffset(f,g);return new y.Point(T+k[0]*w,L+k[1]*w)}function Ga(f,d,h,g,w,C){var T=f.x1,L=f.x2,k=f.y1,X=f.y2,ae=f.anchorPointX,de=f.anchorPointY,ge=new y.Point(d,h);return g&&ge._rotate(w?C:-C),{x1:T+ge.x,y1:k+ge.y,x2:L+ge.x,y2:X+ge.y,anchorPointX:ae,anchorPointY:de}}Ho.prototype.get=function(f){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[f]){var d=++this.maxGroupID;this.collisionGroups[f]={ID:d,predicate:function(h){return h.collisionGroupID===d}}}return this.collisionGroups[f]};var Mt=function(f,d,h,g){this.transform=f.clone(),this.collisionIndex=new Ro(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ho(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function j(f,d,h,g,w){f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0)}Mt.prototype.getBucketParts=function(f,d,h,g){var w=h.getBucket(d),C=h.latestFeatureIndex;if(w&&C&&d.id===w.layerIds[0]){var T=h.collisionBoxArray,L=w.layers[0].layout,k=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),X=h.tileSize/y.EXTENT,ae=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),de=L.get("text-pitch-alignment")==="map",ge=L.get("text-rotation-alignment")==="map",Te=Vi(h,1,this.transform.zoom),Re=ea(ae,de,ge,this.transform,Te),We=null;if(de){var Ae=vi(ae,de,ge,this.transform,Te);We=y.multiply([],this.transform.labelPlaneMatrix,Ae)}this.retainedQueryData[w.bucketInstanceId]=new Gc(w.bucketInstanceId,C,w.sourceLayerIndex,w.index,h.tileID);var $e={bucket:w,layout:L,posMatrix:ae,textLabelPlaneMatrix:Re,labelToScreenMatrix:We,scale:k,textPixelRatio:X,holdingForFade:h.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(g)for(var ot=0,At=w.sortKeyRanges;ot<At.length;ot+=1){var Gt=At[ot];f.push({sortKey:Gt.sortKey,symbolInstanceStart:Gt.symbolInstanceStart,symbolInstanceEnd:Gt.symbolInstanceEnd,parameters:$e})}else f.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:$e})}},Mt.prototype.attemptAnchorPlacement=function(f,d,h,g,w,C,T,L,k,X,ae,de,ge,Te,Re){var We,Ae=[de.textOffset0,de.textOffset1],$e=Da(f,h,g,Ae,w),ot=this.collisionIndex.placeCollisionBox(Ga(d,$e.x,$e.y,C,T,this.transform.angle),ae,L,k,X.predicate);if(!Re||this.collisionIndex.placeCollisionBox(Ga(Re,$e.x,$e.y,C,T,this.transform.angle),ae,L,k,X.predicate).box.length!==0)return ot.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[de.crossTileID]&&this.prevPlacement.placements[de.crossTileID]&&this.prevPlacement.placements[de.crossTileID].text&&(We=this.prevPlacement.variableOffsets[de.crossTileID].anchor),this.variableOffsets[de.crossTileID]={textOffset:Ae,width:h,height:g,anchor:f,textBoxScale:w,prevAnchor:We},this.markUsedJustification(ge,f,de,Te),ge.allowVerticalPlacement&&(this.markUsedOrientation(ge,Te,de),this.placedOrientations[de.crossTileID]=Te),{shift:$e,placedGlyphBoxes:ot}):void 0},Mt.prototype.placeLayerBucketPart=function(f,d,h){var g=this,w=f.parameters,C=w.bucket,T=w.layout,L=w.posMatrix,k=w.textLabelPlaneMatrix,X=w.labelToScreenMatrix,ae=w.textPixelRatio,de=w.holdingForFade,ge=w.collisionBoxArray,Te=w.partiallyEvaluatedTextSize,Re=w.collisionGroup,We=T.get("text-optional"),Ae=T.get("icon-optional"),$e=T.get("text-allow-overlap"),ot=T.get("icon-allow-overlap"),At=T.get("text-rotation-alignment")==="map",Gt=T.get("text-pitch-alignment")==="map",Bt=T.get("icon-text-fit")!=="none",Ut=T.get("symbol-z-order")==="viewport-y",hr=$e&&(ot||!C.hasIconData()||Ae),Zr=ot&&($e||!C.hasTextData()||We);!C.collisionArrays&&ge&&C.deserializeCollisionBoxes(ge);var kr=function(nn,$n){if(!d[nn.crossTileID])if(de)g.placements[nn.crossTileID]=new ns(!1,!1,!1);else{var ii,Yn=!1,Wn=!1,oi=!0,Hn=null,Zn={box:null,offscreen:null},aa={box:null,offscreen:null},ga=null,So=null,lo=0,ya=0,Ia=0;$n.textFeatureIndex?lo=$n.textFeatureIndex:nn.useRuntimeCollisionCircles&&(lo=nn.featureIndex),$n.verticalTextFeatureIndex&&(ya=$n.verticalTextFeatureIndex);var Ja=$n.textBox;if(Ja){var No=function(ki){var co=y.WritingMode.horizontal;if(C.allowVerticalPlacement&&!ki&&g.prevPlacement){var wo=g.prevPlacement.placedOrientations[nn.crossTileID];wo&&(g.placedOrientations[nn.crossTileID]=wo,g.markUsedOrientation(C,co=wo,nn))}return co},Qu=function(ki,co){if(C.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&$n.verticalTextBox)for(var wo=0,ws=C.writingModes;wo<ws.length&&(ws[wo]===y.WritingMode.vertical?(Zn=co(),aa=Zn):Zn=ki(),!(Zn&&Zn.box&&Zn.box.length));wo+=1);else Zn=ki()};if(T.get("text-variable-anchor")){var Zo=T.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[nn.crossTileID]){var Uo=g.prevPlacement.variableOffsets[nn.crossTileID];Zo.indexOf(Uo.anchor)>0&&(Zo=Zo.filter(function(ki){return ki!==Uo.anchor})).unshift(Uo.anchor)}var xs=function(ki,co,wo){for(var ws=ki.x2-ki.x1,tl=ki.y2-ki.y1,Fs=nn.textBoxScale,bl=Bt&&!ot?co:null,Iu={box:[],offscreen:!1},rl=$e?2*Zo.length:Zo.length,Xs=0;Xs<rl;++Xs){var Sl=g.attemptAnchorPlacement(Zo[Xs%Zo.length],ki,ws,tl,Fs,At,Gt,ae,L,Re,Xs>=Zo.length,nn,C,wo,bl);if(Sl&&(Iu=Sl.placedGlyphBoxes)&&Iu.box&&Iu.box.length){Yn=!0,Hn=Sl.shift;break}}return Iu};Qu(function(){return xs(Ja,$n.iconBox,y.WritingMode.horizontal)},function(){var ki=$n.verticalTextBox;return C.allowVerticalPlacement&&!(Zn&&Zn.box&&Zn.box.length)&&nn.numVerticalGlyphVertices>0&&ki?xs(ki,$n.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),Zn&&(Yn=Zn.box,oi=Zn.offscreen);var Ys=No(Zn&&Zn.box);if(!Yn&&g.prevPlacement){var bs=g.prevPlacement.variableOffsets[nn.crossTileID];bs&&(g.variableOffsets[nn.crossTileID]=bs,g.markUsedJustification(C,bs.anchor,nn,Ys))}}else{var el=function(ki,co){var wo=g.collisionIndex.placeCollisionBox(ki,$e,ae,L,Re.predicate);return wo&&wo.box&&wo.box.length&&(g.markUsedOrientation(C,co,nn),g.placedOrientations[nn.crossTileID]=co),wo};Qu(function(){return el(Ja,y.WritingMode.horizontal)},function(){var ki=$n.verticalTextBox;return C.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&ki?el(ki,y.WritingMode.vertical):{box:null,offscreen:null}}),No(Zn&&Zn.box&&Zn.box.length)}}if(Yn=(ii=Zn)&&ii.box&&ii.box.length>0,oi=ii&&ii.offscreen,nn.useRuntimeCollisionCircles){var xl=C.text.placedSymbolArray.get(nn.centerJustifiedTextSymbolIndex),Cc=y.evaluateSizeForFeature(C.textSizeData,Te,xl),hu=T.get("text-padding");ga=g.collisionIndex.placeCollisionCircles($e,xl,C.lineVertexArray,C.glyphOffsetArray,Cc,L,k,X,h,Gt,Re.predicate,nn.collisionCircleDiameter,hu),Yn=$e||ga.circles.length>0&&!ga.collisionDetected,oi=oi&&ga.offscreen}if($n.iconFeatureIndex&&(Ia=$n.iconFeatureIndex),$n.iconBox){var Kl=function(ki){var co=Bt&&Hn?Ga(ki,Hn.x,Hn.y,At,Gt,g.transform.angle):ki;return g.collisionIndex.placeCollisionBox(co,ot,ae,L,Re.predicate)};Wn=aa&&aa.box&&aa.box.length&&$n.verticalIconBox?(So=Kl($n.verticalIconBox)).box.length>0:(So=Kl($n.iconBox)).box.length>0,oi=oi&&So.offscreen}var Ds=We||nn.numHorizontalGlyphVertices===0&&nn.numVerticalGlyphVertices===0,Pa=Ae||nn.numIconVertices===0;if(Ds||Pa?Pa?Ds||(Wn=Wn&&Yn):Yn=Wn&&Yn:Wn=Yn=Wn&&Yn,Yn&&ii&&ii.box&&g.collisionIndex.insertCollisionBox(ii.box,T.get("text-ignore-placement"),C.bucketInstanceId,aa&&aa.box&&ya?ya:lo,Re.ID),Wn&&So&&g.collisionIndex.insertCollisionBox(So.box,T.get("icon-ignore-placement"),C.bucketInstanceId,Ia,Re.ID),ga&&(Yn&&g.collisionIndex.insertCollisionCircles(ga.circles,T.get("text-ignore-placement"),C.bucketInstanceId,lo,Re.ID),h)){var pu=C.bucketInstanceId,Ss=g.collisionCircleArrays[pu];Ss===void 0&&(Ss=g.collisionCircleArrays[pu]=new is);for(var es=0;es<ga.circles.length;es+=4)Ss.circles.push(ga.circles[es+0]),Ss.circles.push(ga.circles[es+1]),Ss.circles.push(ga.circles[es+2]),Ss.circles.push(ga.collisionDetected?1:0)}g.placements[nn.crossTileID]=new ns(Yn||hr,Wn||Zr,oi||C.justReloaded),d[nn.crossTileID]=!0}};if(Ut)for(var rn=C.getSortedSymbolIndexes(this.transform.angle),Cn=rn.length-1;Cn>=0;--Cn){var Ln=rn[Cn];kr(C.symbolInstances.get(Ln),C.collisionArrays[Ln])}else for(var Mn=f.symbolInstanceStart;Mn<f.symbolInstanceEnd;Mn++)kr(C.symbolInstances.get(Mn),C.collisionArrays[Mn]);if(h&&C.bucketInstanceId in this.collisionCircleArrays){var Ci=this.collisionCircleArrays[C.bucketInstanceId];y.invert(Ci.invProjMatrix,L),Ci.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},Mt.prototype.markUsedJustification=function(f,d,h,g){var w;w=g===y.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(d)];for(var C=0,T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];C<T.length;C+=1){var L=T[C];L>=0&&(f.text.placedSymbolArray.get(L).crossTileID=w>=0&&L!==w?0:h.crossTileID)}},Mt.prototype.markUsedOrientation=function(f,d,h){for(var g=d===y.WritingMode.horizontal||d===y.WritingMode.horizontalOnly?d:0,w=d===y.WritingMode.vertical?d:0,C=0,T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];C<T.length;C+=1)f.text.placedSymbolArray.get(T[C]).placedOrientation=g;h.verticalPlacedTextSymbolIndex&&(f.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=w)},Mt.prototype.commit=function(f){this.commitTime=f,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var g=d?d.symbolFadeChange(f):1,w=d?d.opacities:{},C=d?d.variableOffsets:{},T=d?d.placedOrientations:{};for(var L in this.placements){var k=this.placements[L],X=w[L];X?(this.opacities[L]=new _o(X,g,k.text,k.icon),h=h||k.text!==X.text.placed||k.icon!==X.icon.placed):(this.opacities[L]=new _o(null,g,k.text,k.icon,k.skipFade),h=h||k.text||k.icon)}for(var ae in w){var de=w[ae];if(!this.opacities[ae]){var ge=new _o(de,g,!1,!1);ge.isHidden()||(this.opacities[ae]=ge,h=h||de.text.placed||de.icon.placed)}}for(var Te in C)this.variableOffsets[Te]||!this.opacities[Te]||this.opacities[Te].isHidden()||(this.variableOffsets[Te]=C[Te]);for(var Re in T)this.placedOrientations[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.placedOrientations[Re]=T[Re]);h?this.lastPlacementChangeTime=f:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:f)},Mt.prototype.updateLayerOpacities=function(f,d){for(var h={},g=0,w=d;g<w.length;g+=1){var C=w[g],T=C.getBucket(f);T&&C.latestFeatureIndex&&f.id===T.layerIds[0]&&this.updateBucketOpacities(T,h,C.collisionBoxArray)}},Mt.prototype.updateBucketOpacities=function(f,d,h){var g=this;f.hasTextData()&&f.text.opacityVertexArray.clear(),f.hasIconData()&&f.icon.opacityVertexArray.clear(),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexArray.clear(),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexArray.clear();var w=f.layers[0].layout,C=new _o(null,0,!1,!1,!0),T=w.get("text-allow-overlap"),L=w.get("icon-allow-overlap"),k=w.get("text-variable-anchor"),X=w.get("text-rotation-alignment")==="map",ae=w.get("text-pitch-alignment")==="map",de=w.get("icon-text-fit")!=="none",ge=new _o(null,0,T&&(L||!f.hasIconData()||w.get("icon-optional")),L&&(T||!f.hasTextData()||w.get("text-optional")),!0);!f.collisionArrays&&h&&(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData())&&f.deserializeCollisionBoxes(h);for(var Te=function($e,ot,At){for(var Gt=0;Gt<ot/4;Gt++)$e.opacityVertexArray.emplaceBack(At)},Re=function($e){var ot=f.symbolInstances.get($e),At=ot.numHorizontalGlyphVertices,Gt=ot.numVerticalGlyphVertices,Bt=ot.crossTileID,Ut=g.opacities[Bt];d[Bt]?Ut=C:Ut||(g.opacities[Bt]=Ut=ge),d[Bt]=!0;var hr=ot.numIconVertices>0,Zr=g.placedOrientations[ot.crossTileID],kr=Zr===y.WritingMode.vertical,rn=Zr===y.WritingMode.horizontal||Zr===y.WritingMode.horizontalOnly;if(At>0||Gt>0){var Cn=so(Ut.text);Te(f.text,At,kr?Ha:Cn),Te(f.text,Gt,rn?Ha:Cn);var Ln=Ut.text.isHidden();[ot.rightJustifiedTextSymbolIndex,ot.centerJustifiedTextSymbolIndex,ot.leftJustifiedTextSymbolIndex].forEach(function(Zn){Zn>=0&&(f.text.placedSymbolArray.get(Zn).hidden=Ln||kr?1:0)}),ot.verticalPlacedTextSymbolIndex>=0&&(f.text.placedSymbolArray.get(ot.verticalPlacedTextSymbolIndex).hidden=Ln||rn?1:0);var Mn=g.variableOffsets[ot.crossTileID];Mn&&g.markUsedJustification(f,Mn.anchor,ot,Zr);var Ci=g.placedOrientations[ot.crossTileID];Ci&&(g.markUsedJustification(f,"left",ot,Ci),g.markUsedOrientation(f,Ci,ot))}if(hr){var nn=so(Ut.icon),$n=!(de&&ot.verticalPlacedIconSymbolIndex&&kr);ot.placedIconSymbolIndex>=0&&(Te(f.icon,ot.numIconVertices,$n?nn:Ha),f.icon.placedSymbolArray.get(ot.placedIconSymbolIndex).hidden=Ut.icon.isHidden()),ot.verticalPlacedIconSymbolIndex>=0&&(Te(f.icon,ot.numVerticalIconVertices,$n?Ha:nn),f.icon.placedSymbolArray.get(ot.verticalPlacedIconSymbolIndex).hidden=Ut.icon.isHidden())}if(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData()){var ii=f.collisionArrays[$e];if(ii){var Yn=new y.Point(0,0);if(ii.textBox||ii.verticalTextBox){var Wn=!0;if(k){var oi=g.variableOffsets[Bt];oi?(Yn=Da(oi.anchor,oi.width,oi.height,oi.textOffset,oi.textBoxScale),X&&Yn._rotate(ae?g.transform.angle:-g.transform.angle)):Wn=!1}ii.textBox&&j(f.textCollisionBox.collisionVertexArray,Ut.text.placed,!Wn||kr,Yn.x,Yn.y),ii.verticalTextBox&&j(f.textCollisionBox.collisionVertexArray,Ut.text.placed,!Wn||rn,Yn.x,Yn.y)}var Hn=Boolean(!rn&&ii.verticalIconBox);ii.iconBox&&j(f.iconCollisionBox.collisionVertexArray,Ut.icon.placed,Hn,de?Yn.x:0,de?Yn.y:0),ii.verticalIconBox&&j(f.iconCollisionBox.collisionVertexArray,Ut.icon.placed,!Hn,de?Yn.x:0,de?Yn.y:0)}}},We=0;We<f.symbolInstances.length;We++)Re(We);if(f.sortFeatures(this.transform.angle),this.retainedQueryData[f.bucketInstanceId]&&(this.retainedQueryData[f.bucketInstanceId].featureSortOrder=f.featureSortOrder),f.hasTextData()&&f.text.opacityVertexBuffer&&f.text.opacityVertexBuffer.updateData(f.text.opacityVertexArray),f.hasIconData()&&f.icon.opacityVertexBuffer&&f.icon.opacityVertexBuffer.updateData(f.icon.opacityVertexArray),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexBuffer&&f.iconCollisionBox.collisionVertexBuffer.updateData(f.iconCollisionBox.collisionVertexArray),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexBuffer&&f.textCollisionBox.collisionVertexBuffer.updateData(f.textCollisionBox.collisionVertexArray),f.bucketInstanceId in this.collisionCircleArrays){var Ae=this.collisionCircleArrays[f.bucketInstanceId];f.placementInvProjMatrix=Ae.invProjMatrix,f.placementViewportMatrix=Ae.viewportMatrix,f.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[f.bucketInstanceId]}},Mt.prototype.symbolFadeChange=function(f){return this.fadeDuration===0?1:(f-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Mt.prototype.zoomAdjustment=function(f){return Math.max(0,(this.transform.zoom-f)/1.5)},Mt.prototype.hasTransitions=function(f){return this.stale||f-this.lastPlacementChangeTime<this.fadeDuration},Mt.prototype.stillRecent=function(f,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>f},Mt.prototype.setStale=function(){this.stale=!0};var P=Math.pow(2,25),rt=Math.pow(2,24),qt=Math.pow(2,17),jr=Math.pow(2,16),Tn=Math.pow(2,9),Ri=Math.pow(2,8),Fa=Math.pow(2,1);function so(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;var d=f.placed?1:0,h=Math.floor(127*f.opacity);return h*P+d*rt+h*qt+d*jr+h*Tn+d*Ri+h*Fa+d}var Ha=0,as=function(f){this._sortAcrossTiles=f.layout.get("symbol-z-order")!=="viewport-y"&&f.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};as.prototype.continuePlacement=function(f,d,h,g,w){for(var C=this._bucketParts;this._currentTileIndex<f.length;)if(d.getBucketParts(C,g,f[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(T,L){return T.sortKey-L.sortKey}));this._currentPartIndex<C.length;)if(d.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,w())return!0;return!1};var Xr=function(f,d,h,g,w,C,T){this.placement=new Mt(f,w,C,T),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1};Xr.prototype.isDone=function(){return this._done},Xr.prototype.continuePlacement=function(f,d,h){for(var g=this,w=y.browser.now(),C=function(){var k=y.browser.now()-w;return!g._forceFullPlacement&&k>2};this._currentPlacementIndex>=0;){var T=d[f[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=L)&&(!T.maxzoom||T.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new as(T)),this._inProgressLayer.continuePlacement(h[T.source],this.placement,this._showCollisionBoxes,T,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Xr.prototype.commit=function(f){return this.placement.commit(f),this.placement};var Jr=512/y.EXTENT/2,Qe=function(f,d,h){this.tileID=f,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var g=0;g<d.length;g++){var w=d.get(g),C=w.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,f)})}};Qe.prototype.getScaledCoordinates=function(f,d){var h=Jr/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*y.EXTENT+f.anchorX)*h),y:Math.floor((d.canonical.y*y.EXTENT+f.anchorY)*h)}},Qe.prototype.findMatches=function(f,d,h){for(var g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),w=0;w<f.length;w++){var C=f.get(w);if(!C.crossTileID){var T=this.indexedSymbolInstances[C.key];if(T)for(var L=this.getScaledCoordinates(C,d),k=0,X=T;k<X.length;k+=1){var ae=X[k];if(Math.abs(ae.coord.x-L.x)<=g&&Math.abs(ae.coord.y-L.y)<=g&&!h[ae.crossTileID]){h[ae.crossTileID]=!0,C.crossTileID=ae.crossTileID;break}}}}};var gs=function(){this.maxCrossTileID=0};gs.prototype.generate=function(){return++this.maxCrossTileID};var Fu=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Fu.prototype.handleWrapJump=function(f){var d=Math.round((f-this.lng)/360);if(d!==0)for(var h in this.indexes){var g=this.indexes[h],w={};for(var C in g){var T=g[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+d),w[T.tileID.key]=T}this.indexes[h]=w}this.lng=f},Fu.prototype.addBucket=function(f,d,h){if(this.indexes[f.overscaledZ]&&this.indexes[f.overscaledZ][f.key]){if(this.indexes[f.overscaledZ][f.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(f.overscaledZ,this.indexes[f.overscaledZ][f.key])}for(var g=0;g<d.symbolInstances.length;g++)d.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[f.overscaledZ]||(this.usedCrossTileIDs[f.overscaledZ]={});var w=this.usedCrossTileIDs[f.overscaledZ];for(var C in this.indexes){var T=this.indexes[C];if(Number(C)>f.overscaledZ)for(var L in T){var k=T[L];k.tileID.isChildOf(f)&&k.findMatches(d.symbolInstances,f,w)}else{var X=T[f.scaledTo(Number(C)).key];X&&X.findMatches(d.symbolInstances,f,w)}}for(var ae=0;ae<d.symbolInstances.length;ae++){var de=d.symbolInstances.get(ae);de.crossTileID||(de.crossTileID=h.generate(),w[de.crossTileID]=!0)}return this.indexes[f.overscaledZ]===void 0&&(this.indexes[f.overscaledZ]={}),this.indexes[f.overscaledZ][f.key]=new Qe(f,d.symbolInstances,d.bucketInstanceId),!0},Fu.prototype.removeBucketCrossTileIDs=function(f,d){for(var h in d.indexedSymbolInstances)for(var g=0,w=d.indexedSymbolInstances[h];g<w.length;g+=1)delete this.usedCrossTileIDs[f][w[g].crossTileID]},Fu.prototype.removeStaleBuckets=function(f){var d=!1;for(var h in this.indexes){var g=this.indexes[h];for(var w in g)f[g[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[w]),delete g[w],d=!0)}return d};var os=function(){this.layerIndexes={},this.crossTileIDs=new gs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};os.prototype.addLayer=function(f,d,h){var g=this.layerIndexes[f.id];g===void 0&&(g=this.layerIndexes[f.id]=new Fu);var w=!1,C={};g.handleWrapJump(h);for(var T=0,L=d;T<L.length;T+=1){var k=L[T],X=k.getBucket(f);X&&f.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(k.tileID,X,this.crossTileIDs)&&(w=!0),C[X.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(w=!0),w},os.prototype.pruneUnusedLayers=function(f){var d={};for(var h in f.forEach(function(g){d[g]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var iu=function(f,d){return y.emitValidationErrors(f,d&&d.filter(function(h){return h.identifier!=="source.canvas"}))},au=y.pick(Q,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ss=y.pick(Q,["setCenter","setZoom","setBearing","setPitch"]),Dl=function(){var f={},d=y.styleSpec.$version;for(var h in y.styleSpec.$root){var g,w=y.styleSpec.$root[h];w.required&&(g=h==="version"?d:w.type==="array"?[]:{})!=null&&(f[h]=g)}return f}(),Jo=function(f){function d(h,g){var w=this;g===void 0&&(g={}),f.call(this),this.map=h,this.dispatcher=new Xt(Qt(),this),this.imageManager=new Yt,this.imageManager.setEventedParent(this),this.glyphManager=new sr(h._requestManager,g.localIdeographFontFamily),this.lineAtlas=new lt(256,512),this.crossTileSymbolIndex=new os,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var C=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(T){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(L,k){if(y.triggerPluginCompletionEvent(L),k&&k.every(function(ae){return ae}))for(var X in C.sourceCaches)C.sourceCaches[X].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var L=w.sourceCaches[T.sourceId];if(L){var k=L.getSource();if(k&&k.vectorLayerIds)for(var X in w._layers){var ae=w._layers[X];ae.source===k.id&&w._validateLayer(ae)}}}})}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.loadURL=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var C=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,g.accessToken);var T=this.map._requestManager.transformRequest(h,y.ResourceType.Style);this._request=y.getJSON(T,function(L,k){w._request=null,L?w.fire(new y.ErrorEvent(L)):k&&w._load(k,C)})},d.prototype.loadJSON=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){w._request=null,w._load(h,g.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(Dl,!1)},d.prototype._load=function(h,g){if(!g||!iu(this,y.validateStyle(h))){for(var w in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(w,h.sources[w],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var C=qr(this.stylesheet.layers);this._order=C.map(function(X){return X.id}),this._layers={},this._serializedLayers={};for(var T=0,L=C;T<L.length;T+=1){var k=L[T];(k=y.createStyleLayer(k)).setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Lt(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},d.prototype._loadSprite=function(h){var g=this;this._spriteRequest=function(w,C,T){var L,k,X,ae=y.browser.devicePixelRatio>1?"@2x":"",de=y.getJSON(C.transformRequest(C.normalizeSpriteURL(w,ae,".json"),y.ResourceType.SpriteJSON),function(Re,We){de=null,X||(X=Re,L=We,Te())}),ge=y.getImage(C.transformRequest(C.normalizeSpriteURL(w,ae,".png"),y.ResourceType.SpriteImage),function(Re,We){ge=null,X||(X=Re,k=We,Te())});function Te(){if(X)T(X);else if(L&&k){var Re=y.browser.getImageData(k),We={};for(var Ae in L){var $e=L[Ae],ot=$e.width,At=$e.height,Gt=$e.x,Bt=$e.y,Ut=$e.sdf,hr=$e.pixelRatio,Zr=$e.stretchX,kr=$e.stretchY,rn=$e.content,Cn=new y.RGBAImage({width:ot,height:At});y.RGBAImage.copy(Re,Cn,{x:Gt,y:Bt},{x:0,y:0},{width:ot,height:At}),We[Ae]={data:Cn,pixelRatio:hr,sdf:Ut,stretchX:Zr,stretchY:kr,content:rn}}T(null,We)}}return{cancel:function(){de&&(de.cancel(),de=null),ge&&(ge.cancel(),ge=null)}}}(h,this.map._requestManager,function(w,C){if(g._spriteRequest=null,w)g.fire(new y.ErrorEvent(w));else if(C)for(var T in C)g.imageManager.addImage(T,C[T]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var g=this.sourceCaches[h.source];if(g){var w=h.sourceLayer;if(w){var C=g.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(w)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+w+'" does not exist on source "'+C.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var g=[],w=0,C=h;w<C.length;w+=1){var T=this._layers[C[w]];T.type!=="custom"&&g.push(T.serialize())}return g},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var g=this._changed;if(this._changed){var w=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var T in(w.length||C.length)&&this._updateWorkerLayers(w,C),this._updatedSources){var L=this._updatedSources[T];L==="reload"?this._reloadSource(T):L==="clear"&&this._clearSource(T)}for(var k in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[k].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var X={};for(var ae in this.sourceCaches){var de=this.sourceCaches[ae];X[ae]=de.used,de.used=!1}for(var ge=0,Te=this._order;ge<Te.length;ge+=1){var Re=this._layers[Te[ge]];Re.recalculate(h,this._availableImages),!Re.isHidden(h.zoom)&&Re.source&&(this.sourceCaches[Re.source].used=!0)}for(var We in X){var Ae=this.sourceCaches[We];X[We]!==Ae.used&&Ae.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:We}))}this.light.recalculate(h),this.z=h.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:g})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var g=this;if(this._checkLoaded(),iu(this,y.validateStyle(h)))return!1;(h=y.clone$1(h)).layers=qr(h.layers);var w=function(T,L){if(!T)return[{command:Q.setStyle,args:[L]}];var k=[];try{if(!y.deepEqual(T.version,L.version))return[{command:Q.setStyle,args:[L]}];y.deepEqual(T.center,L.center)||k.push({command:Q.setCenter,args:[L.center]}),y.deepEqual(T.zoom,L.zoom)||k.push({command:Q.setZoom,args:[L.zoom]}),y.deepEqual(T.bearing,L.bearing)||k.push({command:Q.setBearing,args:[L.bearing]}),y.deepEqual(T.pitch,L.pitch)||k.push({command:Q.setPitch,args:[L.pitch]}),y.deepEqual(T.sprite,L.sprite)||k.push({command:Q.setSprite,args:[L.sprite]}),y.deepEqual(T.glyphs,L.glyphs)||k.push({command:Q.setGlyphs,args:[L.glyphs]}),y.deepEqual(T.transition,L.transition)||k.push({command:Q.setTransition,args:[L.transition]}),y.deepEqual(T.light,L.light)||k.push({command:Q.setLight,args:[L.light]});var X={},ae=[];(function(ge,Te,Re,We){var Ae;for(Ae in Te=Te||{},ge=ge||{})ge.hasOwnProperty(Ae)&&(Te.hasOwnProperty(Ae)||en(Ae,Re,We));for(Ae in Te)Te.hasOwnProperty(Ae)&&(ge.hasOwnProperty(Ae)?y.deepEqual(ge[Ae],Te[Ae])||(ge[Ae].type==="geojson"&&Te[Ae].type==="geojson"&&Zi(ge,Te,Ae)?Re.push({command:Q.setGeoJSONSourceData,args:[Ae,Te[Ae].data]}):Jn(Ae,Te,Re,We)):ri(Ae,Te,Re))})(T.sources,L.sources,ae,X);var de=[];T.layers&&T.layers.forEach(function(ge){X[ge.source]?k.push({command:Q.removeLayer,args:[ge.id]}):de.push(ge)}),k=k.concat(ae),function(ge,Te,Re){Te=Te||[];var We,Ae,$e,ot,At,Gt,Bt,Ut=(ge=ge||[]).map(Ii),hr=Te.map(Ii),Zr=ge.reduce(hi,{}),kr=Te.reduce(hi,{}),rn=Ut.slice(),Cn=Object.create(null);for(We=0,Ae=0;We<Ut.length;We++)kr.hasOwnProperty($e=Ut[We])?Ae++:(Re.push({command:Q.removeLayer,args:[$e]}),rn.splice(rn.indexOf($e,Ae),1));for(We=0,Ae=0;We<hr.length;We++)rn[rn.length-1-We]!==($e=hr[hr.length-1-We])&&(Zr.hasOwnProperty($e)?(Re.push({command:Q.removeLayer,args:[$e]}),rn.splice(rn.lastIndexOf($e,rn.length-Ae),1)):Ae++,Re.push({command:Q.addLayer,args:[kr[$e],Gt=rn[rn.length-We]]}),rn.splice(rn.length-We,0,$e),Cn[$e]=!0);for(We=0;We<hr.length;We++)if(ot=Zr[$e=hr[We]],At=kr[$e],!Cn[$e]&&!y.deepEqual(ot,At))if(y.deepEqual(ot.source,At.source)&&y.deepEqual(ot["source-layer"],At["source-layer"])&&y.deepEqual(ot.type,At.type)){for(Bt in ni(ot.layout,At.layout,Re,$e,null,Q.setLayoutProperty),ni(ot.paint,At.paint,Re,$e,null,Q.setPaintProperty),y.deepEqual(ot.filter,At.filter)||Re.push({command:Q.setFilter,args:[$e,At.filter]}),y.deepEqual(ot.minzoom,At.minzoom)&&y.deepEqual(ot.maxzoom,At.maxzoom)||Re.push({command:Q.setLayerZoomRange,args:[$e,At.minzoom,At.maxzoom]}),ot)ot.hasOwnProperty(Bt)&&Bt!=="layout"&&Bt!=="paint"&&Bt!=="filter"&&Bt!=="metadata"&&Bt!=="minzoom"&&Bt!=="maxzoom"&&(Bt.indexOf("paint.")===0?ni(ot[Bt],At[Bt],Re,$e,Bt.slice(6),Q.setPaintProperty):y.deepEqual(ot[Bt],At[Bt])||Re.push({command:Q.setLayerProperty,args:[$e,Bt,At[Bt]]}));for(Bt in At)At.hasOwnProperty(Bt)&&!ot.hasOwnProperty(Bt)&&Bt!=="layout"&&Bt!=="paint"&&Bt!=="filter"&&Bt!=="metadata"&&Bt!=="minzoom"&&Bt!=="maxzoom"&&(Bt.indexOf("paint.")===0?ni(ot[Bt],At[Bt],Re,$e,Bt.slice(6),Q.setPaintProperty):y.deepEqual(ot[Bt],At[Bt])||Re.push({command:Q.setLayerProperty,args:[$e,Bt,At[Bt]]}))}else Re.push({command:Q.removeLayer,args:[$e]}),Gt=rn[rn.lastIndexOf($e)+1],Re.push({command:Q.addLayer,args:[At,Gt]})}(de,L.layers,k)}catch(ge){console.warn("Unable to compute style diff:",ge),k=[{command:Q.setStyle,args:[L]}]}return k}(this.serialize(),h).filter(function(T){return!(T.command in ss)});if(w.length===0)return!1;var C=w.filter(function(T){return!(T.command in au)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(T){return T.command}).join(", ")+".");return w.forEach(function(T){T.command!=="setTransition"&&g[T.command].apply(g,T.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,g){if(this.getImage(h))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,g),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,g){this.imageManager.updateImage(h,g)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,g,w){var C=this;if(w===void 0&&(w={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+h,g,null,w))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var T=this.sourceCaches[h]=new Oe(h,g,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:T.serialize(),sourceId:h}}),T.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===h)return this.fire(new y.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+g+'" is using it.')));var w=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],w.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),w.setEventedParent(null),w.clearTiles(),w.onRemove&&w.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,g){this._checkLoaded(),this.sourceCaches[h].getSource().setData(g),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var C=h.id;if(this.getLayer(C))this.fire(new y.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var T;if(h.type==="custom"){if(iu(this,y.validateCustomStyleLayer(h)))return;T=y.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(C,h.source),h=y.clone$1(h),h=y.extend(h,{source:C})),this._validate(y.validateStyle.layer,"layers."+C,h,{arrayIndex:-1},w))return;T=y.createStyleLayer(h),this._validateLayer(T),T.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[T.id]=T.serialize()}var L=g?this._order.indexOf(g):this._order.length;if(g&&L===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(L,0,C),this._layerOrderChanged=!0,this._layers[C]=T,this._removedLayers[C]&&T.source&&T.type!=="custom"){var k=this._removedLayers[C];delete this._removedLayers[C],k.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},d.prototype.moveLayer=function(h,g){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==g){var w=this._order.indexOf(h);this._order.splice(w,1);var C=g?this._order.indexOf(g):this._order.length;g&&C===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(C,0,h),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var g=this._layers[h];if(g){g.setEventedParent(null);var w=this._order.indexOf(h);this._order.splice(w,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=g,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,g,w){this._checkLoaded();var C=this.getLayer(h);C?C.minzoom===g&&C.maxzoom===w||(g!=null&&(C.minzoom=g),w!=null&&(C.maxzoom=w),this._updateLayer(C)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var C=this.getLayer(h);if(C){if(!y.deepEqual(C.filter,g))return g==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(y.validateStyle.filter,"layers."+C.id+".filter",g,null,w)||(C.filter=y.clone$1(g),this._updateLayer(C)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return y.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,g,w,C){C===void 0&&(C={}),this._checkLoaded();var T=this.getLayer(h);T?y.deepEqual(T.getLayoutProperty(g),w)||(T.setLayoutProperty(g,w,C),this._updateLayer(T)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,g){var w=this.getLayer(h);if(w)return w.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,g,w,C){C===void 0&&(C={}),this._checkLoaded();var T=this.getLayer(h);T?y.deepEqual(T.getPaintProperty(g),w)||(T.setPaintProperty(g,w,C)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,g){return this.getLayer(h).getPaintProperty(g)},d.prototype.setFeatureState=function(h,g){this._checkLoaded();var w=h.source,C=h.sourceLayer,T=this.sourceCaches[w];if(T!==void 0){var L=T.getSource().type;L==="geojson"&&C?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||C?(h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(C,h.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,g){this._checkLoaded();var w=h.source,C=this.sourceCaches[w];if(C!==void 0){var T=C.getSource().type,L=T==="vector"?h.sourceLayer:void 0;T!=="vector"||L?g&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(L,h.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var g=h.source,w=h.sourceLayer,C=this.sourceCaches[g];if(C!==void 0){if(C.getSource().type!=="vector"||w)return h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(w,h.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var g=this,w=function(Zr){return g._layers[Zr].type==="fill-extrusion"},C={},T=[],L=this._order.length-1;L>=0;L--){var k=this._order[L];if(w(k)){C[k]=L;for(var X=0,ae=h;X<ae.length;X+=1){var de=ae[X][k];if(de)for(var ge=0,Te=de;ge<Te.length;ge+=1)T.push(Te[ge])}}}T.sort(function(Zr,kr){return kr.intersectionZ-Zr.intersectionZ});for(var Re=[],We=this._order.length-1;We>=0;We--){var Ae=this._order[We];if(w(Ae))for(var $e=T.length-1;$e>=0;$e--){var ot=T[$e].feature;if(C[ot.layer.id]<We)break;Re.push(ot),T.pop()}else for(var At=0,Gt=h;At<Gt.length;At+=1){var Bt=Gt[At][Ae];if(Bt)for(var Ut=0,hr=Bt;Ut<hr.length;Ut+=1)Re.push(hr[Ut].feature)}}return Re},d.prototype.queryRenderedFeatures=function(h,g,w){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var C={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,L=g.layers;T<L.length;T+=1){var k=L[T],X=this._layers[k];if(!X)return this.fire(new y.ErrorEvent(new Error("The layer '"+k+"' does not exist in the map's style and cannot be queried for features."))),[];C[X.source]=!0}}var ae=[];for(var de in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!C[de]||ae.push(Br(this.sourceCaches[de],this._layers,this._serializedLayers,h,g,w));return this.placement&&ae.push(function(ge,Te,Re,We,Ae,$e,ot){for(var At={},Gt=$e.queryRenderedSymbols(We),Bt=[],Ut=0,hr=Object.keys(Gt).map(Number);Ut<hr.length;Ut+=1)Bt.push(ot[hr[Ut]]);Bt.sort(Bn);for(var Zr=function(){var Mn=rn[kr],Ci=Mn.featureIndex.lookupSymbolFeatures(Gt[Mn.bucketInstanceId],Te,Mn.bucketIndex,Mn.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,ge);for(var nn in Ci){var $n=At[nn]=At[nn]||[],ii=Ci[nn];ii.sort(function(oi,Hn){var Zn=Mn.featureSortOrder;if(Zn){var aa=Zn.indexOf(oi.featureIndex);return Zn.indexOf(Hn.featureIndex)-aa}return Hn.featureIndex-oi.featureIndex});for(var Yn=0,Wn=ii;Yn<Wn.length;Yn+=1)$n.push(Wn[Yn])}},kr=0,rn=Bt;kr<rn.length;kr+=1)Zr();var Cn=function(Mn){At[Mn].forEach(function(Ci){var nn=Ci.feature,$n=Re[ge[Mn].source].getFeatureState(nn.layer["source-layer"],nn.id);nn.source=nn.layer.source,nn.layer["source-layer"]&&(nn.sourceLayer=nn.layer["source-layer"]),nn.state=$n})};for(var Ln in At)Cn(Ln);return At}(this._layers,this._serializedLayers,this.sourceCaches,h,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ae)},d.prototype.querySourceFeatures=function(h,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var w=this.sourceCaches[h];return w?function(C,T){for(var L=C.getRenderableIds().map(function(Te){return C.getTileByID(Te)}),k=[],X={},ae=0;ae<L.length;ae++){var de=L[ae],ge=de.tileID.canonical.key;X[ge]||(X[ge]=!0,de.querySourceFeatures(k,T))}return k}(w,g):[]},d.prototype.addSourceType=function(h,g,w){return d.getSourceType(h)?w(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:g.workerSourceURL},w):w(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,g){g===void 0&&(g={}),this._checkLoaded();var w=this.light.getLight(),C=!1;for(var T in h)if(!y.deepEqual(h[T],w[T])){C=!0;break}if(C){var L={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,g),this.light.updateTransitions(L)}},d.prototype._validate=function(h,g,w,C,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&iu(this,h.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:w,styleSpec:y.styleSpec},C)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var g in this.sourceCaches)this.sourceCaches[g].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,g,w,C,T){T===void 0&&(T=!1);for(var L=!1,k=!1,X={},ae=0,de=this._order;ae<de.length;ae+=1){var ge=this._layers[de[ae]];if(ge.type==="symbol"){if(!X[ge.source]){var Te=this.sourceCaches[ge.source];X[ge.source]=Te.getRenderableIds(!0).map(function(ot){return Te.getTileByID(ot)}).sort(function(ot,At){return At.tileID.overscaledZ-ot.tileID.overscaledZ||(ot.tileID.isLessThan(At.tileID)?-1:1)})}var Re=this.crossTileSymbolIndex.addLayer(ge,X[ge.source],h.center.lng);L=L||Re}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||w===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),h.zoom))&&(this.pauseablePlacement=new Xr(h,this._order,T,g,w,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,X),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),k=!0),L&&this.pauseablePlacement.placement.setStale()),k||L)for(var We=0,Ae=this._order;We<Ae.length;We+=1){var $e=this._layers[Ae[We]];$e.type==="symbol"&&this.placement.updateLayerOpacities($e,X[$e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,g,w){this.imageManager.getImages(g.icons,w),this._updateTilesForChangedImages();var C=this.sourceCaches[g.source];C&&C.setDependencies(g.tileID.key,g.type,g.icons)},d.prototype.getGlyphs=function(h,g,w){this.glyphManager.getGlyphs(g.stacks,w)},d.prototype.getResource=function(h,g,w){return y.makeRequest(g,w)},d}(y.Evented);Jo.getSourceType=function(f){return tr[f]},Jo.setSourceType=function(f,d){tr[f]=d},Jo.registerForPluginStateChange=y.registerForPluginStateChange;var wa=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),Fl=Ki(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),hc=Ki(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Sf=Ki(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),ou=Ki(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Bl=Ki("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),zl=Ki(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),wf=Ki(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),sh=Ki("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Ef=Ki("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Af=Ki("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),uh=Ki(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),ll=Ki(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),pc=Ki(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Cf=Ki(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ma=Ki(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Hc=Ki(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Bu=Ki(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Zs=Ki(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),gi=Ki(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Mo=Ki(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Do=Ki(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),us=Ki(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),zu=Ki(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ls=Ki(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Wc=Ki(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),lh=Ki(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ki(f,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=d.match(/attribute ([\w]+) ([\w]+)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=C?C.concat(w):w,L={};return{fragmentSource:f=f.replace(h,function(k,X,ae,de,ge){return L[ge]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_`+ge+`
varying `+ae+" "+de+" "+ge+`;
#else
uniform `+ae+" "+de+" u_"+ge+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ge+`
    `+ae+" "+de+" "+ge+" = u_"+ge+`;
#endif
`}),vertexSource:d=d.replace(h,function(k,X,ae,de,ge){var Te=de==="float"?"vec2":"vec4",Re=ge.match(/color/)?"color":Te;return L[ge]?X==="define"?`
#ifndef HAS_UNIFORM_u_`+ge+`
uniform lowp float u_`+ge+`_t;
attribute `+ae+" "+Te+" a_"+ge+`;
varying `+ae+" "+de+" "+ge+`;
#else
uniform `+ae+" "+de+" u_"+ge+`;
#endif
`:Re==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ge+`
    `+ge+" = a_"+ge+`;
#else
    `+ae+" "+de+" "+ge+" = u_"+ge+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ge+`
    `+ge+" = unpack_mix_"+Re+"(a_"+ge+", u_"+ge+`_t);
#else
    `+ae+" "+de+" "+ge+" = u_"+ge+`;
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_`+ge+`
uniform lowp float u_`+ge+`_t;
attribute `+ae+" "+Te+" a_"+ge+`;
#else
uniform `+ae+" "+de+" u_"+ge+`;
#endif
`:Re==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ge+`
    `+ae+" "+de+" "+ge+" = a_"+ge+`;
#else
    `+ae+" "+de+" "+ge+" = u_"+ge+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ge+`
    `+ae+" "+de+" "+ge+" = unpack_mix_"+Re+"(a_"+ge+", u_"+ge+`_t);
#else
    `+ae+" "+de+" "+ge+" = u_"+ge+`;
#endif
`}),staticAttributes:g,staticUniforms:T}}var Tf=Object.freeze({__proto__:null,prelude:Fl,background:hc,backgroundPattern:Sf,circle:ou,clippingMask:Bl,heatmap:zl,heatmapTexture:wf,collisionBox:sh,collisionCircle:Ef,debug:Af,fill:uh,fillOutline:ll,fillOutlinePattern:pc,fillPattern:Cf,fillExtrusion:ma,fillExtrusionPattern:Hc,hillshadePrepare:Bu,hillshade:Zs,line:gi,lineGradient:Mo,linePattern:Do,lineSDF:us,raster:zu,symbolIcon:ls,symbolSDF:Wc,symbolTextAndIcon:lh}),Us=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function dc(f){for(var d=[],h=0;h<f.length;h++)if(f[h]!==null){var g=f[h].split(" ");d.push(g.pop())}return d}Us.prototype.bind=function(f,d,h,g,w,C,T,L){this.context=f;for(var k=this.boundPaintVertexBuffers.length!==g.length,X=0;!k&&X<g.length;X++)this.boundPaintVertexBuffers[X]!==g[X]&&(k=!0);f.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!k&&this.boundIndexBuffer===w&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===L?(f.bindVertexArrayOES.set(this.vao),T&&T.bind(),w&&w.dynamicDraw&&w.bind(),L&&L.bind()):this.freshBind(d,h,g,w,C,T,L)},Us.prototype.freshBind=function(f,d,h,g,w,C,T){var L,k=f.numAttributes,X=this.context,ae=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=f,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=T;else{L=X.currentNumAttributes||0;for(var de=k;de<L;de++)ae.disableVertexAttribArray(de)}d.enableAttributes(ae,f);for(var ge=0,Te=h;ge<Te.length;ge+=1)Te[ge].enableAttributes(ae,f);C&&C.enableAttributes(ae,f),T&&T.enableAttributes(ae,f),d.bind(),d.setVertexAttribPointers(ae,f,w);for(var Re=0,We=h;Re<We.length;Re+=1){var Ae=We[Re];Ae.bind(),Ae.setVertexAttribPointers(ae,f,w)}C&&(C.bind(),C.setVertexAttribPointers(ae,f,w)),g&&g.bind(),T&&(T.bind(),T.setVertexAttribPointers(ae,f,w)),X.currentNumAttributes=k},Us.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Dn=function(f,d,h,g,w,C){var T=f.gl;this.program=T.createProgram();for(var L=dc(h.staticAttributes),k=g?g.getBinderAttributes():[],X=L.concat(k),ae=h.staticUniforms?dc(h.staticUniforms):[],de=g?g.getBinderUniforms():[],ge=[],Te=0,Re=ae.concat(de);Te<Re.length;Te+=1){var We=Re[Te];ge.indexOf(We)<0&&ge.push(We)}var Ae=g?g.defines():[];C&&Ae.push("#define OVERDRAW_INSPECTOR;");var $e=Ae.concat(Fl.fragmentSource,h.fragmentSource).join(`
`),ot=Ae.concat(Fl.vertexSource,h.vertexSource).join(`
`),At=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(At,$e),T.compileShader(At),T.attachShader(this.program,At);var Gt=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Gt,ot),T.compileShader(Gt),T.attachShader(this.program,Gt),this.attributes={};var Bt={};this.numAttributes=X.length;for(var Ut=0;Ut<this.numAttributes;Ut++)X[Ut]&&(T.bindAttribLocation(this.program,Ut,X[Ut]),this.attributes[X[Ut]]=Ut);T.linkProgram(this.program),T.deleteShader(Gt),T.deleteShader(At);for(var hr=0;hr<ge.length;hr++){var Zr=ge[hr];if(Zr&&!Bt[Zr]){var kr=T.getUniformLocation(this.program,Zr);kr&&(Bt[Zr]=kr)}}this.fixedUniforms=w(f,Bt),this.binderUniforms=g?g.getUniforms(f,Bt):[]}}};function Mf(f,d,h){var g=1/Vi(h,1,d.transform.tileZoom),w=Math.pow(2,h.tileID.overscaledZ),C=h.tileSize*Math.pow(2,d.transform.tileZoom)/w,T=C*(h.tileID.canonical.x+h.tileID.wrap*w),L=C*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[T>>16,L>>16],u_pixel_coord_lower:[65535&T,65535&L]}}Dn.prototype.draw=function(f,d,h,g,w,C,T,L,k,X,ae,de,ge,Te,Re,We){var Ae,$e=f.gl;if(!this.failedToCreate){for(var ot in f.program.set(this.program),f.setDepthMode(h),f.setStencilMode(g),f.setColorMode(w),f.setCullFace(C),this.fixedUniforms)this.fixedUniforms[ot].set(T[ot]);Te&&Te.setUniforms(f,this.binderUniforms,de,{zoom:ge});for(var At=(Ae={},Ae[$e.LINES]=2,Ae[$e.TRIANGLES]=3,Ae[$e.LINE_STRIP]=1,Ae)[d],Gt=0,Bt=ae.get();Gt<Bt.length;Gt+=1){var Ut=Bt[Gt],hr=Ut.vaos||(Ut.vaos={});(hr[L]||(hr[L]=new Us)).bind(f,this,k,Te?Te.getPaintVertexBuffers():[],X,Ut.vertexOffset,Re,We),$e.drawElements(d,Ut.primitiveLength*At,$e.UNSIGNED_SHORT,Ut.primitiveOffset*At*2)}}};var Ta=function(f,d,h,g){var w=d.style.light,C=w.properties.get("position"),T=[C.x,C.y,C.z],L=y.create$1();w.properties.get("anchor")==="viewport"&&y.fromRotation(L,-d.transform.angle),y.transformMat3(T,T,L);var k=w.properties.get("color");return{u_matrix:f,u_lightpos:T,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+h,u_opacity:g}},Nu=function(f,d,h,g,w,C,T){return y.extend(Ta(f,d,h,g),Mf(C,d,T),{u_height_factor:-Math.pow(2,w.overscaledZ)/T.tileSize/8})},Zu=function(f){return{u_matrix:f}},Wo=function(f,d,h,g){return y.extend(Zu(f),Mf(h,d,g))},$c=function(f,d){return{u_matrix:f,u_world:d}},vc=function(f,d,h,g,w){return y.extend(Wo(f,d,h,g),{u_world:w})},bu=function(f,d,h,g){var w,C,T=f.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var L=Vi(h,1,T.zoom);w=!0,C=[L,L]}else w=!1,C=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(d.posMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:C}},Su=function(f,d,h){var g=Vi(h,1,d.zoom),w=Math.pow(2,d.zoom-h.tileID.overscaledZ),C=h.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[d.pixelsToGLUnits[0]/(g*w),d.pixelsToGLUnits[1]/(g*w)],u_overscale_factor:C}},mc=function(f,d,h){return{u_matrix:f,u_inv_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},Vs=function(f,d,h){return h===void 0&&(h=1),{u_matrix:f,u_color:d,u_overlay:0,u_overlay_scale:h}},uo=function(f){return{u_matrix:f}},If=function(f,d,h,g){return{u_matrix:f,u_extrude_scale:Vi(d,1,h),u_intensity:g}},cl=function(f,d,h){var g=f.transform;return{u_matrix:ch(f,d,h),u_ratio:1/Vi(d,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ta=function(f,d,h,g){return y.extend(cl(f,d,h),{u_image:0,u_image_height:g})},Yc=function(f,d,h,g){var w=f.transform,C=Nl(d,w);return{u_matrix:ch(f,d,h),u_texsize:d.imageAtlasTexture.size,u_ratio:1/Vi(d,1,w.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[C,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},Uh=function(f,d,h,g,w){var C=f.lineAtlas,T=Nl(d,f.transform),L=h.layout.get("line-cap")==="round",k=C.getDash(g.from,L),X=C.getDash(g.to,L),ae=k.width*w.fromScale,de=X.width*w.toScale;return y.extend(cl(f,d,h),{u_patternscale_a:[T/ae,-k.height/2],u_patternscale_b:[T/de,-X.height/2],u_sdfgamma:C.width/(256*Math.min(ae,de)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:X.y,u_mix:w.t})};function Nl(f,d){return 1/Vi(f,1,d.tileZoom)}function ch(f,d,h){return f.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var Pf=function(f,d,h,g,w){return{u_matrix:f,u_tl_parent:d,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(T=w.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(C=w.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:gc(w.paint.get("raster-hue-rotate"))};var C,T};function gc(f){f*=Math.PI/180;var d=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var Zl,Uu=function(f,d,h,g,w,C,T,L,k,X){var ae=w.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:ae.cameraToCenterDistance,u_pitch:ae.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:ae.width/ae.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:T,u_coord_matrix:L,u_is_text:+k,u_pitch_with_map:+g,u_texsize:X,u_texture:0}},su=function(f,d,h,g,w,C,T,L,k,X,ae){var de=w.transform;return y.extend(Uu(f,d,h,g,w,C,T,L,k,X),{u_gamma_scale:g?Math.cos(de._pitch)*de.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+ae})},Ul=function(f,d,h,g,w,C,T,L,k,X){return y.extend(su(f,d,h,g,w,C,T,L,!0,k,!0),{u_texsize_icon:X,u_texture_icon:1})},fl=function(f,d,h){return{u_matrix:f,u_opacity:d,u_color:h}},Vu=function(f,d,h,g,w,C){return y.extend(function(T,L,k,X){var ae=k.imageManager.getPattern(T.from.toString()),de=k.imageManager.getPattern(T.to.toString()),ge=k.imageManager.getPixelSize(),Te=ge.width,Re=ge.height,We=Math.pow(2,X.tileID.overscaledZ),Ae=X.tileSize*Math.pow(2,k.transform.tileZoom)/We,$e=Ae*(X.tileID.canonical.x+X.tileID.wrap*We),ot=Ae*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ae.tl,u_pattern_br_a:ae.br,u_pattern_tl_b:de.tl,u_pattern_br_b:de.br,u_texsize:[Te,Re],u_mix:L.t,u_pattern_size_a:ae.displaySize,u_pattern_size_b:de.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Vi(X,1,k.transform.tileZoom),u_pixel_coord_upper:[$e>>16,ot>>16],u_pixel_coord_lower:[65535&$e,65535&ot]}}(g,C,h,w),{u_matrix:f,u_opacity:d})},Xc={fillExtrusion:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fillExtrusionPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_height_factor:new y.Uniform1f(f,d.u_height_factor),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fill:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},fillPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},fillOutline:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world)}},fillOutlinePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},circle:function(f,d){return{u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(f,d.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},collisionBox:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(f,d.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_overscale_factor:new y.Uniform1f(f,d.u_overscale_factor)}},collisionCircle:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_inv_matrix:new y.UniformMatrix4f(f,d.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(f,d.u_viewport_size)}},debug:function(f,d){return{u_color:new y.UniformColor(f,d.u_color),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_overlay:new y.Uniform1i(f,d.u_overlay),u_overlay_scale:new y.Uniform1f(f,d.u_overlay_scale)}},clippingMask:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmap:function(f,d){return{u_extrude_scale:new y.Uniform1f(f,d.u_extrude_scale),u_intensity:new y.Uniform1f(f,d.u_intensity),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmapTexture:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_color_ramp:new y.Uniform1i(f,d.u_color_ramp),u_opacity:new y.Uniform1f(f,d.u_opacity)}},hillshade:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_latrange:new y.Uniform2f(f,d.u_latrange),u_light:new y.Uniform2f(f,d.u_light),u_shadow:new y.UniformColor(f,d.u_shadow),u_highlight:new y.UniformColor(f,d.u_highlight),u_accent:new y.UniformColor(f,d.u_accent)}},hillshadePrepare:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_dimension:new y.Uniform2f(f,d.u_dimension),u_zoom:new y.Uniform1f(f,d.u_zoom),u_unpack:new y.Uniform4f(f,d.u_unpack)}},line:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels)}},lineGradient:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_image:new y.Uniform1i(f,d.u_image),u_image_height:new y.Uniform1f(f,d.u_image_height)}},linePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_texsize:new y.Uniform2f(f,d.u_texsize),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_image:new y.Uniform1i(f,d.u_image),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},lineSDF:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(f,d.u_patternscale_a),u_patternscale_b:new y.Uniform2f(f,d.u_patternscale_b),u_sdfgamma:new y.Uniform1f(f,d.u_sdfgamma),u_image:new y.Uniform1i(f,d.u_image),u_tex_y_a:new y.Uniform1f(f,d.u_tex_y_a),u_tex_y_b:new y.Uniform1f(f,d.u_tex_y_b),u_mix:new y.Uniform1f(f,d.u_mix)}},raster:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_tl_parent:new y.Uniform2f(f,d.u_tl_parent),u_scale_parent:new y.Uniform1f(f,d.u_scale_parent),u_buffer_scale:new y.Uniform1f(f,d.u_buffer_scale),u_fade_t:new y.Uniform1f(f,d.u_fade_t),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image0:new y.Uniform1i(f,d.u_image0),u_image1:new y.Uniform1i(f,d.u_image1),u_brightness_low:new y.Uniform1f(f,d.u_brightness_low),u_brightness_high:new y.Uniform1f(f,d.u_brightness_high),u_saturation_factor:new y.Uniform1f(f,d.u_saturation_factor),u_contrast_factor:new y.Uniform1f(f,d.u_contrast_factor),u_spin_weights:new y.Uniform3f(f,d.u_spin_weights)}},symbolIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture)}},symbolSDF:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},symbolTextAndIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texsize_icon:new y.Uniform2f(f,d.u_texsize_icon),u_texture:new y.Uniform1i(f,d.u_texture),u_texture_icon:new y.Uniform1i(f,d.u_texture_icon),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},background:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_color:new y.UniformColor(f,d.u_color)}},backgroundPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image:new y.Uniform1i(f,d.u_image),u_pattern_tl_a:new y.Uniform2f(f,d.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(f,d.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(f,d.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(f,d.u_pattern_br_b),u_texsize:new y.Uniform2f(f,d.u_texsize),u_mix:new y.Uniform1f(f,d.u_mix),u_pattern_size_a:new y.Uniform2f(f,d.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(f,d.u_pattern_size_b),u_scale_a:new y.Uniform1f(f,d.u_scale_a),u_scale_b:new y.Uniform1f(f,d.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(f,d.u_tile_units_to_pixels)}}};function hl(f,d,h,g,w,C,T){for(var L=f.context,k=L.gl,X=f.useProgram("collisionBox"),ae=[],de=0,ge=0,Te=0;Te<g.length;Te++){var Re=g[Te],We=d.getTile(Re),Ae=We.getBucket(h);if(Ae){var $e=Re.posMatrix;w[0]===0&&w[1]===0||($e=f.translatePosMatrix(Re.posMatrix,We,w,C));var ot=T?Ae.textCollisionBox:Ae.iconCollisionBox,At=Ae.collisionCircleArray;if(At.length>0){var Gt=y.create(),Bt=$e;y.mul(Gt,Ae.placementInvProjMatrix,f.transform.glCoordMatrix),y.mul(Gt,Gt,Ae.placementViewportMatrix),ae.push({circleArray:At,circleOffset:ge,transform:Bt,invTransform:Gt}),ge=de+=At.length/4}ot&&X.draw(L,k.LINES,_e.disabled,Le.disabled,f.colorModeForRenderPass(),it.disabled,Su($e,f.transform,We),h.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,null,f.transform.zoom,null,null,ot.collisionVertexBuffer)}}if(T&&ae.length){var Ut=f.useProgram("collisionCircle"),hr=new y.StructArrayLayout2f1f2i16;hr.resize(4*de),hr._trim();for(var Zr=0,kr=0,rn=ae;kr<rn.length;kr+=1)for(var Cn=rn[kr],Ln=0;Ln<Cn.circleArray.length/4;Ln++){var Mn=4*Ln,Ci=Cn.circleArray[Mn+0],nn=Cn.circleArray[Mn+1],$n=Cn.circleArray[Mn+2],ii=Cn.circleArray[Mn+3];hr.emplace(Zr++,Ci,nn,$n,ii,0),hr.emplace(Zr++,Ci,nn,$n,ii,1),hr.emplace(Zr++,Ci,nn,$n,ii,2),hr.emplace(Zr++,Ci,nn,$n,ii,3)}(!Zl||Zl.length<2*de)&&(Zl=function(ga){var So=2*ga,lo=new y.StructArrayLayout3ui6;lo.resize(So),lo._trim();for(var ya=0;ya<So;ya++){var Ia=6*ya;lo.uint16[Ia+0]=4*ya+0,lo.uint16[Ia+1]=4*ya+1,lo.uint16[Ia+2]=4*ya+2,lo.uint16[Ia+3]=4*ya+2,lo.uint16[Ia+4]=4*ya+3,lo.uint16[Ia+5]=4*ya+0}return lo}(de));for(var Yn=L.createIndexBuffer(Zl,!0),Wn=L.createVertexBuffer(hr,y.collisionCircleLayout.members,!0),oi=0,Hn=ae;oi<Hn.length;oi+=1){var Zn=Hn[oi],aa=mc(Zn.transform,Zn.invTransform,f.transform);Ut.draw(L,k.TRIANGLES,_e.disabled,Le.disabled,f.colorModeForRenderPass(),it.disabled,aa,h.id,Wn,Yn,y.SegmentVector.simpleSegment(0,2*Zn.circleOffset,Zn.circleArray.length,Zn.circleArray.length/2),null,f.transform.zoom,null,null,null)}Wn.destroy(),Yn.destroy()}}var Ps=y.identity(new Float32Array(16));function kf(f,d,h,g,w,C){var T=y.getAnchorAlignment(f),L=-(T.horizontalAlign-.5)*d,k=-(T.verticalAlign-.5)*h,X=y.evaluateVariableOffset(f,g);return new y.Point((L/w+X[0])*C,(k/w+X[1])*C)}function Lf(f,d,h,g,w,C,T,L,k,X,ae){var de=f.text.placedSymbolArray,ge=f.text.dynamicLayoutVertexArray,Te=f.icon.dynamicLayoutVertexArray,Re={};ge.clear();for(var We=0;We<de.length;We++){var Ae=de.get(We),$e=Ae.hidden||!Ae.crossTileID||f.allowVerticalPlacement&&!Ae.placedOrientation?null:g[Ae.crossTileID];if($e){var ot=new y.Point(Ae.anchorX,Ae.anchorY),At=si(ot,h?L:T),Gt=Qn(C.cameraToCenterDistance,At.signedDistanceFromCamera),Bt=w.evaluateSizeForFeature(f.textSizeData,X,Ae)*Gt/y.ONE_EM;h&&(Bt*=f.tilePixelRatio/k);for(var Ut=kf($e.anchor,$e.width,$e.height,$e.textOffset,$e.textBoxScale,Bt),hr=h?si(ot.add(Ut),T).point:At.point.add(d?Ut.rotate(-C.angle):Ut),Zr=f.allowVerticalPlacement&&Ae.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,kr=0;kr<Ae.numGlyphs;kr++)y.addDynamicAttributes(ge,hr,Zr);ae&&Ae.associatedIconIndex>=0&&(Re[Ae.associatedIconIndex]={shiftedAnchor:hr,angle:Zr})}else Oa(Ae.numGlyphs,ge)}if(ae){Te.clear();for(var rn=f.icon.placedSymbolArray,Cn=0;Cn<rn.length;Cn++){var Ln=rn.get(Cn);if(Ln.hidden)Oa(Ln.numGlyphs,Te);else{var Mn=Re[Cn];if(Mn)for(var Ci=0;Ci<Ln.numGlyphs;Ci++)y.addDynamicAttributes(Te,Mn.shiftedAnchor,Mn.angle);else Oa(Ln.numGlyphs,Te)}}f.icon.dynamicLayoutVertexBuffer.updateData(Te)}f.text.dynamicLayoutVertexBuffer.updateData(ge)}function Rf(f,d,h){return h.iconsInText&&d?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function ju(f,d,h,g,w,C,T,L,k,X,ae,de){for(var ge=f.context,Te=ge.gl,Re=f.transform,We=L==="map",Ae=k==="map",$e=We&&h.layout.get("symbol-placement")!=="point",ot=We&&!Ae&&!$e,At=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Gt=!1,Bt=f.depthModeForSublayer(0,_e.ReadOnly),Ut=h.layout.get("text-variable-anchor"),hr=[],Zr=0,kr=g;Zr<kr.length;Zr+=1){var rn=kr[Zr],Cn=d.getTile(rn),Ln=Cn.getBucket(h);if(Ln){var Mn=w?Ln.text:Ln.icon;if(Mn&&Mn.segments.get().length){var Ci=Mn.programConfigurations.get(h.id),nn=w||Ln.sdfIcons,$n=w?Ln.textSizeData:Ln.iconSizeData,ii=Ae||Re.pitch!==0,Yn=f.useProgram(Rf(nn,w,Ln),Ci),Wn=y.evaluateSizeForZoom($n,Re.zoom),oi=void 0,Hn=[0,0],Zn=void 0,aa=void 0,ga=null,So=void 0;if(w)Zn=Cn.glyphAtlasTexture,aa=Te.LINEAR,oi=Cn.glyphAtlasTexture.size,Ln.iconsInText&&(Hn=Cn.imageAtlasTexture.size,ga=Cn.imageAtlasTexture,So=ii||f.options.rotating||f.options.zooming||$n.kind==="composite"||$n.kind==="camera"?Te.LINEAR:Te.NEAREST);else{var lo=h.layout.get("icon-size").constantOr(0)!==1||Ln.iconsNeedLinear;Zn=Cn.imageAtlasTexture,aa=nn||f.options.rotating||f.options.zooming||lo||ii?Te.LINEAR:Te.NEAREST,oi=Cn.imageAtlasTexture.size}var ya=Vi(Cn,1,f.transform.zoom),Ia=ea(rn.posMatrix,Ae,We,f.transform,ya),Ja=vi(rn.posMatrix,Ae,We,f.transform,ya),No=Ut&&Ln.hasTextData(),Qu=h.layout.get("icon-text-fit")!=="none"&&No&&Ln.hasIconData();$e&&Is(Ln,rn.posMatrix,f,w,Ia,Ja,Ae,X);var Zo=f.translatePosMatrix(rn.posMatrix,Cn,C,T),Uo=$e||w&&Ut||Qu?Ps:Ia,xs=f.translatePosMatrix(Ja,Cn,C,T,!0),Ys=nn&&h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0,bs={program:Yn,buffers:Mn,uniformValues:nn?Ln.iconsInText?Ul($n.kind,Wn,ot,Ae,f,Zo,Uo,xs,oi,Hn):su($n.kind,Wn,ot,Ae,f,Zo,Uo,xs,w,oi,!0):Uu($n.kind,Wn,ot,Ae,f,Zo,Uo,xs,w,oi),atlasTexture:Zn,atlasTextureIcon:ga,atlasInterpolation:aa,atlasInterpolationIcon:So,isSDF:nn,hasHalo:Ys};if(At&&Ln.canOverlap){Gt=!0;for(var el=0,xl=Mn.segments.get();el<xl.length;el+=1){var Cc=xl[el];hr.push({segments:new y.SegmentVector([Cc]),sortKey:Cc.sortKey,state:bs})}}else hr.push({segments:Mn.segments,sortKey:0,state:bs})}}}Gt&&hr.sort(function(Ss,es){return Ss.sortKey-es.sortKey});for(var hu=0,Kl=hr;hu<Kl.length;hu+=1){var Ds=Kl[hu],Pa=Ds.state;if(ge.activeTexture.set(Te.TEXTURE0),Pa.atlasTexture.bind(Pa.atlasInterpolation,Te.CLAMP_TO_EDGE),Pa.atlasTextureIcon&&(ge.activeTexture.set(Te.TEXTURE1),Pa.atlasTextureIcon&&Pa.atlasTextureIcon.bind(Pa.atlasInterpolationIcon,Te.CLAMP_TO_EDGE)),Pa.isSDF){var pu=Pa.uniformValues;Pa.hasHalo&&(pu.u_is_halo=1,Vl(Pa.buffers,Ds.segments,h,f,Pa.program,Bt,ae,de,pu)),pu.u_is_halo=0}Vl(Pa.buffers,Ds.segments,h,f,Pa.program,Bt,ae,de,Pa.uniformValues)}}function Vl(f,d,h,g,w,C,T,L,k){var X=g.context;w.draw(X,X.gl.TRIANGLES,C,T,L,it.disabled,k,h.id,f.layoutVertexBuffer,f.indexBuffer,d,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function yc(f,d,h,g,w,C,T){var L,k,X,ae,de,ge=f.context.gl,Te=h.paint.get("fill-pattern"),Re=Te&&Te.constantOr(1),We=h.getCrossfadeParameters();T?(k=Re&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=ge.LINES):(k=Re?"fillPattern":"fill",L=ge.TRIANGLES);for(var Ae=0,$e=g;Ae<$e.length;Ae+=1){var ot=$e[Ae],At=d.getTile(ot);if(!Re||At.patternsLoaded()){var Gt=At.getBucket(h);if(Gt){var Bt=Gt.programConfigurations.get(h.id),Ut=f.useProgram(k,Bt);Re&&(f.context.activeTexture.set(ge.TEXTURE0),At.imageAtlasTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Bt.updatePaintBuffers(We));var hr=Te.constantOr(null);if(hr&&At.imageAtlas){var Zr=At.imageAtlas,kr=Zr.patternPositions[hr.to.toString()],rn=Zr.patternPositions[hr.from.toString()];kr&&rn&&Bt.setConstantPatternPositions(kr,rn)}var Cn=f.translatePosMatrix(ot.posMatrix,At,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(T){ae=Gt.indexBuffer2,de=Gt.segments2;var Ln=[ge.drawingBufferWidth,ge.drawingBufferHeight];X=k==="fillOutlinePattern"&&Re?vc(Cn,f,We,At,Ln):$c(Cn,Ln)}else ae=Gt.indexBuffer,de=Gt.segments,X=Re?Wo(Cn,f,We,At):Zu(Cn);Ut.draw(f.context,L,w,f.stencilModeForClipping(ot),C,it.disabled,X,h.id,Gt.layoutVertexBuffer,ae,de,h.paint,f.transform.zoom,Bt)}}}}function Gu(f,d,h,g,w,C,T){for(var L=f.context,k=L.gl,X=h.paint.get("fill-extrusion-pattern"),ae=X.constantOr(1),de=h.getCrossfadeParameters(),ge=h.paint.get("fill-extrusion-opacity"),Te=0,Re=g;Te<Re.length;Te+=1){var We=Re[Te],Ae=d.getTile(We),$e=Ae.getBucket(h);if($e){var ot=$e.programConfigurations.get(h.id),At=f.useProgram(ae?"fillExtrusionPattern":"fillExtrusion",ot);ae&&(f.context.activeTexture.set(k.TEXTURE0),Ae.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ot.updatePaintBuffers(de));var Gt=X.constantOr(null);if(Gt&&Ae.imageAtlas){var Bt=Ae.imageAtlas,Ut=Bt.patternPositions[Gt.to.toString()],hr=Bt.patternPositions[Gt.from.toString()];Ut&&hr&&ot.setConstantPatternPositions(Ut,hr)}var Zr=f.translatePosMatrix(We.posMatrix,Ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),kr=h.paint.get("fill-extrusion-vertical-gradient"),rn=ae?Nu(Zr,f,kr,ge,We,de,Ae):Ta(Zr,f,kr,ge);At.draw(L,L.gl.TRIANGLES,w,C,T,it.backCCW,rn,h.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,h.paint,f.transform.zoom,ot)}}}function jl(f,d,h,g,w,C){var T=f.context,L=T.gl,k=d.fbo;if(k){var X=f.useProgram("hillshade");T.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,k.colorAttachment.get());var ae=function(de,ge,Te){var Re=Te.paint.get("hillshade-shadow-color"),We=Te.paint.get("hillshade-highlight-color"),Ae=Te.paint.get("hillshade-accent-color"),$e=Te.paint.get("hillshade-illumination-direction")*(Math.PI/180);Te.paint.get("hillshade-illumination-anchor")==="viewport"&&($e-=de.transform.angle);var ot,At,Gt,Bt=!de.options.moving;return{u_matrix:de.transform.calculatePosMatrix(ge.tileID.toUnwrapped(),Bt),u_image:0,u_latrange:(ot=ge.tileID,At=Math.pow(2,ot.canonical.z),Gt=ot.canonical.y,[new y.MercatorCoordinate(0,Gt/At).toLngLat().lat,new y.MercatorCoordinate(0,(Gt+1)/At).toLngLat().lat]),u_light:[Te.paint.get("hillshade-exaggeration"),$e],u_shadow:Re,u_highlight:We,u_accent:Ae}}(f,d,h);X.draw(T,L.TRIANGLES,g,w,C,it.disabled,ae,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}}function Of(f,d,h,g,w,C){var T=f.context,L=T.gl,k=d.dem;if(k&&k.data){var X=k.dim,ae=k.stride,de=k.getPixels();if(T.activeTexture.set(L.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||f.getTileTexture(ae),d.demTexture){var ge=d.demTexture;ge.update(de,{premultiply:!1}),ge.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else d.demTexture=new y.Texture(T,de,L.RGBA,{premultiply:!1}),d.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);T.activeTexture.set(L.TEXTURE0);var Te=d.fbo;if(!Te){var Re=new y.Texture(T,{width:X,height:X,data:null},L.RGBA);Re.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Te=d.fbo=T.createFramebuffer(X,X,!0)).colorAttachment.set(Re.texture)}T.bindFramebuffer.set(Te.framebuffer),T.viewport.set([0,0,X,X]),f.useProgram("hillshadePrepare").draw(T,L.TRIANGLES,g,w,C,it.disabled,function(We,Ae){var $e=Ae.stride,ot=y.create();return y.ortho(ot,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(ot,ot,[0,-y.EXTENT,0]),{u_matrix:ot,u_image:1,u_dimension:[$e,$e],u_zoom:We.overscaledZ,u_unpack:Ae.getUnpackVector()}}(d.tileID,k),h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function Hu(f,d,h,g,w){var C=g.paint.get("raster-fade-duration");if(C>0){var T=y.browser.now(),L=(T-f.timeAdded)/C,k=d?(T-d.timeAdded)/C:-1,X=h.getSource(),ae=w.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),de=!d||Math.abs(d.tileID.overscaledZ-ae)>Math.abs(f.tileID.overscaledZ-ae),ge=de&&f.refreshedUponExpiration?1:y.clamp(de?L:1-k,0,1);return f.refreshedUponExpiration&&L>=1&&(f.refreshedUponExpiration=!1),d?{opacity:1,mix:1-ge}:{opacity:ge,mix:0}}return{opacity:1,mix:0}}var Df=new y.Color(1,0,0,1),fh=new y.Color(0,1,0,1),yi=new y.Color(0,0,1,1),Gl=new y.Color(1,0,1,1),qc=new y.Color(0,1,1,1);function Kc(f,d,h,g){pl(f,0,d+h/2,f.transform.width,h,g)}function Jc(f,d,h,g){pl(f,d-h/2,0,h,f.transform.height,g)}function pl(f,d,h,g,w,C){var T=f.context,L=T.gl;L.enable(L.SCISSOR_TEST),L.scissor(d*y.browser.devicePixelRatio,h*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,w*y.browser.devicePixelRatio),T.clear({color:C}),L.disable(L.SCISSOR_TEST)}function Ai(f,d,h){var g=f.context,w=g.gl,C=h.posMatrix,T=f.useProgram("debug"),L=_e.disabled,k=Le.disabled,X=f.colorModeForRenderPass();g.activeTexture.set(w.TEXTURE0),f.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),T.draw(g,w.LINE_STRIP,L,k,X,it.disabled,Vs(C,y.Color.red),"$debug",f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments);var ae=d.getTileByID(h.key).latestRawTileData,de=Math.floor((ae&&ae.byteLength||0)/1024),ge=d.getTile(h).tileSize,Te=512/Math.min(ge,512)*(h.overscaledZ/f.transform.zoom)*.5,Re=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Re+=" => "+h.overscaledZ),function(We,Ae){We.initDebugOverlayCanvas();var $e=We.debugOverlayCanvas,ot=We.context.gl,At=We.debugOverlayCanvas.getContext("2d");At.clearRect(0,0,$e.width,$e.height),At.shadowColor="white",At.shadowBlur=2,At.lineWidth=1.5,At.strokeStyle="white",At.textBaseline="top",At.font="bold 36px Open Sans, sans-serif",At.fillText(Ae,5,5),At.strokeText(Ae,5,5),We.debugOverlayTexture.update($e),We.debugOverlayTexture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE)}(f,Re+" "+de+"kb"),T.draw(g,w.TRIANGLES,L,k,Ke.alphaBlended,it.disabled,Vs(C,y.Color.transparent,Te),"$debug",f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}var qa={symbol:function(f,d,h,g,w){if(f.renderPass==="translucent"){var C=Le.disabled,T=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(L,k,X,ae,de,ge,Te){for(var Re=k.transform,We=de==="map",Ae=ge==="map",$e=0,ot=L;$e<ot.length;$e+=1){var At=ot[$e],Gt=ae.getTile(At),Bt=Gt.getBucket(X);if(Bt&&Bt.text&&Bt.text.segments.get().length){var Ut=y.evaluateSizeForZoom(Bt.textSizeData,Re.zoom),hr=Vi(Gt,1,k.transform.zoom),Zr=ea(At.posMatrix,Ae,We,k.transform,hr),kr=X.layout.get("icon-text-fit")!=="none"&&Bt.hasIconData();if(Ut){var rn=Math.pow(2,Re.zoom-Gt.tileID.overscaledZ);Lf(Bt,We,Ae,Te,y.symbolSize,Re,Zr,At.posMatrix,rn,Ut,kr)}}}}(g,f,h,d,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),h.paint.get("icon-opacity").constantOr(1)!==0&&ju(f,d,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),C,T),h.paint.get("text-opacity").constantOr(1)!==0&&ju(f,d,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),C,T),d.map.showCollisionBoxes&&(hl(f,d,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),hl(f,d,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),L=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(w.constantOr(1)!==0||C.constantOr(1)!==0&&T.constantOr(1)!==0){for(var k=f.context,X=k.gl,ae=f.depthModeForSublayer(0,_e.ReadOnly),de=Le.disabled,ge=f.colorModeForRenderPass(),Te=[],Re=0;Re<g.length;Re++){var We=g[Re],Ae=d.getTile(We),$e=Ae.getBucket(h);if($e){var ot=$e.programConfigurations.get(h.id),At={programConfiguration:ot,program:f.useProgram("circle",ot),layoutVertexBuffer:$e.layoutVertexBuffer,indexBuffer:$e.indexBuffer,uniformValues:bu(f,We,Ae,h)};if(L)for(var Gt=0,Bt=$e.segments.get();Gt<Bt.length;Gt+=1){var Ut=Bt[Gt];Te.push({segments:new y.SegmentVector([Ut]),sortKey:Ut.sortKey,state:At})}else Te.push({segments:$e.segments,sortKey:0,state:At})}}L&&Te.sort(function(Cn,Ln){return Cn.sortKey-Ln.sortKey});for(var hr=0,Zr=Te;hr<Zr.length;hr+=1){var kr=Zr[hr],rn=kr.state;rn.program.draw(k,X.TRIANGLES,ae,de,ge,it.disabled,rn.uniformValues,h.id,rn.layoutVertexBuffer,rn.indexBuffer,kr.segments,h.paint,f.transform.zoom,rn.programConfiguration)}}}},heatmap:function(f,d,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){var w=f.context,C=w.gl,T=Le.disabled,L=new Ke([C.ONE,C.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(Te,Re,We){var Ae=Te.gl;Te.activeTexture.set(Ae.TEXTURE1),Te.viewport.set([0,0,Re.width/4,Re.height/4]);var $e=We.heatmapFbo;if($e)Ae.bindTexture(Ae.TEXTURE_2D,$e.colorAttachment.get()),Te.bindFramebuffer.set($e.framebuffer);else{var ot=Ae.createTexture();Ae.bindTexture(Ae.TEXTURE_2D,ot),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),$e=We.heatmapFbo=Te.createFramebuffer(Re.width/4,Re.height/4,!1),function(At,Gt,Bt,Ut){var hr=At.gl;hr.texImage2D(hr.TEXTURE_2D,0,hr.RGBA,Gt.width/4,Gt.height/4,0,hr.RGBA,At.extRenderToTextureHalfFloat?At.extTextureHalfFloat.HALF_FLOAT_OES:hr.UNSIGNED_BYTE,null),Ut.colorAttachment.set(Bt)}(Te,Re,ot,$e)}})(w,f,h),w.clear({color:y.Color.transparent});for(var k=0;k<g.length;k++){var X=g[k];if(!d.hasRenderableParent(X)){var ae=d.getTile(X),de=ae.getBucket(h);if(de){var ge=de.programConfigurations.get(h.id);f.useProgram("heatmap",ge).draw(w,C.TRIANGLES,_e.disabled,T,L,it.disabled,If(X.posMatrix,ae,f.transform.zoom,h.paint.get("heatmap-intensity")),h.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,h.paint,f.transform.zoom,ge)}}}w.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(Te,Re){var We=Te.context,Ae=We.gl,$e=Re.heatmapFbo;if($e){We.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_2D,$e.colorAttachment.get()),We.activeTexture.set(Ae.TEXTURE1);var ot=Re.colorRampTexture;ot||(ot=Re.colorRampTexture=new y.Texture(We,Re.colorRamp,Ae.RGBA)),ot.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Te.useProgram("heatmapTexture").draw(We,Ae.TRIANGLES,_e.disabled,Le.disabled,Te.colorModeForRenderPass(),it.disabled,function(At,Gt,Bt,Ut){var hr=y.create();y.ortho(hr,0,At.width,At.height,0,0,1);var Zr=At.context.gl;return{u_matrix:hr,u_world:[Zr.drawingBufferWidth,Zr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Gt.paint.get("heatmap-opacity")}}(Te,Re),Re.id,Te.viewportBuffer,Te.quadTriangleIndexBuffer,Te.viewportSegments,Re.paint,Te.transform.zoom)}}(f,h))},line:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(w.constantOr(1)!==0&&C.constantOr(1)!==0)for(var T=f.depthModeForSublayer(0,_e.ReadOnly),L=f.colorModeForRenderPass(),k=h.paint.get("line-dasharray"),X=h.paint.get("line-pattern"),ae=X.constantOr(1),de=h.paint.get("line-gradient"),ge=h.getCrossfadeParameters(),Te=ae?"linePattern":k?"lineSDF":de?"lineGradient":"line",Re=f.context,We=Re.gl,Ae=!0,$e=0,ot=g;$e<ot.length;$e+=1){var At=ot[$e],Gt=d.getTile(At);if(!ae||Gt.patternsLoaded()){var Bt=Gt.getBucket(h);if(Bt){var Ut=Bt.programConfigurations.get(h.id),hr=f.context.program.get(),Zr=f.useProgram(Te,Ut),kr=Ae||Zr.program!==hr,rn=X.constantOr(null);if(rn&&Gt.imageAtlas){var Cn=Gt.imageAtlas,Ln=Cn.patternPositions[rn.to.toString()],Mn=Cn.patternPositions[rn.from.toString()];Ln&&Mn&&Ut.setConstantPatternPositions(Ln,Mn)}var Ci=ae?Yc(f,Gt,h,ge):k?Uh(f,Gt,h,k,ge):de?ta(f,Gt,h,Bt.lineClipsArray.length):cl(f,Gt,h);if(ae)Re.activeTexture.set(We.TEXTURE0),Gt.imageAtlasTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE),Ut.updatePaintBuffers(ge);else if(k&&(kr||f.lineAtlas.dirty))Re.activeTexture.set(We.TEXTURE0),f.lineAtlas.bind(Re);else if(de){var nn=Bt.gradients[h.id],$n=nn.texture;if(h.gradientVersion!==nn.version){var ii=256;if(h.stepInterpolant){var Yn=d.getSource().maxzoom,Wn=At.canonical.z===Yn?Math.ceil(1<<f.transform.maxZoom-At.canonical.z):1;ii=y.clamp(y.nextPowerOfTwo(Bt.maxLineLength/y.EXTENT*1024*Wn),256,Re.maxTextureSize)}nn.gradient=y.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:ii,image:nn.gradient||void 0,clips:Bt.lineClipsArray}),nn.texture?nn.texture.update(nn.gradient):nn.texture=new y.Texture(Re,nn.gradient,We.RGBA),nn.version=h.gradientVersion,$n=nn.texture}Re.activeTexture.set(We.TEXTURE0),$n.bind(h.stepInterpolant?We.NEAREST:We.LINEAR,We.CLAMP_TO_EDGE)}Zr.draw(Re,We.TRIANGLES,T,f.stencilModeForClipping(At),L,it.disabled,Ci,h.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,h.paint,f.transform.zoom,Ut,Bt.layoutVertexBuffer2),Ae=!1}}}}},fill:function(f,d,h,g){var w=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(C.constantOr(1)!==0){var T=f.colorModeForRenderPass(),L=h.paint.get("fill-pattern"),k=f.opaquePassEnabledForLayer()&&!L.constantOr(1)&&w.constantOr(y.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===k){var X=f.depthModeForSublayer(1,f.renderPass==="opaque"?_e.ReadWrite:_e.ReadOnly);yc(f,d,h,g,X,T,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){var ae=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,_e.ReadOnly);yc(f,d,h,g,ae,T,!0)}}},"fill-extrusion":function(f,d,h,g){var w=h.paint.get("fill-extrusion-opacity");if(w!==0&&f.renderPass==="translucent"){var C=new _e(f.context.gl.LEQUAL,_e.ReadWrite,f.depthRangeFor3D);if(w!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))Gu(f,d,h,g,C,Le.disabled,Ke.disabled),Gu(f,d,h,g,C,f.stencilModeFor3D(),f.colorModeForRenderPass());else{var T=f.colorModeForRenderPass();Gu(f,d,h,g,C,Le.disabled,T)}}},hillshade:function(f,d,h,g){if(f.renderPass==="offscreen"||f.renderPass==="translucent"){for(var w=f.context,C=f.depthModeForSublayer(0,_e.ReadOnly),T=f.colorModeForRenderPass(),L=f.renderPass==="translucent"?f.stencilConfigForOverlap(g):[{},g],k=L[0],X=0,ae=L[1];X<ae.length;X+=1){var de=ae[X],ge=d.getTile(de);ge.needsHillshadePrepare&&f.renderPass==="offscreen"?Of(f,ge,h,C,Le.disabled,T):f.renderPass==="translucent"&&jl(f,ge,h,C,k[de.overscaledZ],T)}w.viewport.set([0,0,f.width,f.height])}},raster:function(f,d,h,g){if(f.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&g.length)for(var w=f.context,C=w.gl,T=d.getSource(),L=f.useProgram("raster"),k=f.colorModeForRenderPass(),X=T instanceof ht?[{},g]:f.stencilConfigForOverlap(g),ae=X[0],de=X[1],ge=de[de.length-1].overscaledZ,Te=!f.options.moving,Re=0,We=de;Re<We.length;Re+=1){var Ae=We[Re],$e=f.depthModeForSublayer(Ae.overscaledZ-ge,h.paint.get("raster-opacity")===1?_e.ReadWrite:_e.ReadOnly,C.LESS),ot=d.getTile(Ae),At=f.transform.calculatePosMatrix(Ae.toUnwrapped(),Te);ot.registerFadeDuration(h.paint.get("raster-fade-duration"));var Gt=d.findLoadedParent(Ae,0),Bt=Hu(ot,Gt,d,h,f.transform),Ut=void 0,hr=void 0,Zr=h.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;w.activeTexture.set(C.TEXTURE0),ot.texture.bind(Zr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(C.TEXTURE1),Gt?(Gt.texture.bind(Zr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),Ut=Math.pow(2,Gt.tileID.overscaledZ-ot.tileID.overscaledZ),hr=[ot.tileID.canonical.x*Ut%1,ot.tileID.canonical.y*Ut%1]):ot.texture.bind(Zr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var kr=Pf(At,hr||[0,0],Ut||1,Bt,h);T instanceof ht?L.draw(w,C.TRIANGLES,$e,Le.disabled,k,it.disabled,kr,h.id,T.boundsBuffer,f.quadTriangleIndexBuffer,T.boundsSegments):L.draw(w,C.TRIANGLES,$e,ae[Ae.overscaledZ],k,it.disabled,kr,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,d,h){var g=h.paint.get("background-color"),w=h.paint.get("background-opacity");if(w!==0){var C=f.context,T=C.gl,L=f.transform,k=L.tileSize,X=h.paint.get("background-pattern");if(!f.isPatternMissing(X)){var ae=!X&&g.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass===ae){var de=Le.disabled,ge=f.depthModeForSublayer(0,ae==="opaque"?_e.ReadWrite:_e.ReadOnly),Te=f.colorModeForRenderPass(),Re=f.useProgram(X?"backgroundPattern":"background"),We=L.coveringTiles({tileSize:k});X&&(C.activeTexture.set(T.TEXTURE0),f.imageManager.bind(f.context));for(var Ae=h.getCrossfadeParameters(),$e=0,ot=We;$e<ot.length;$e+=1){var At=ot[$e],Gt=f.transform.calculatePosMatrix(At.toUnwrapped()),Bt=X?Vu(Gt,w,f,X,{tileID:At,tileSize:k},Ae):fl(Gt,w,g);Re.draw(C,T.TRIANGLES,ge,de,Te,it.disabled,Bt,h.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}}}},debug:function(f,d,h){for(var g=0;g<h.length;g++)Ai(f,d,h[g])},custom:function(f,d,h){var g=f.context,w=h.implementation;if(f.renderPass==="offscreen"){var C=w.prerender;C&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),C.call(w,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(Le.disabled);var T=w.renderingMode==="3d"?new _e(f.context.gl.LEQUAL,_e.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,_e.ReadOnly);g.setDepthMode(T),w.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}},Bi=function(f,d){this.context=new he(f),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=Oe.maxUnderzooming+Oe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new os,this.gpuTimers={}};Bi.prototype.resize=function(f,d){if(this.width=f*y.browser.devicePixelRatio,this.height=d*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,g=this.style._order;h<g.length;h+=1)this.style._layers[g[h]].resize()},Bi.prototype.setup=function(){var f=this.context,d=new y.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(y.EXTENT,0),d.emplaceBack(0,y.EXTENT),d.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(d,wa.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var h=new y.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(y.EXTENT,0),h.emplaceBack(0,y.EXTENT),h.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=f.createVertexBuffer(h,wa.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=f.createVertexBuffer(g,tt.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var w=new y.StructArrayLayout2i4;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(w,wa.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var C=new y.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=f.createIndexBuffer(C);var T=new y.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(T),this.emptyTexture=new y.Texture(f,{width:1,height:1,data:new Uint8Array([0,0,0,0])},f.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Le({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Bi.prototype.clearStencil=function(){var f=this.context,d=f.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=y.create();y.ortho(h,0,this.width,this.height,0,0,1),y.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(f,d.TRIANGLES,_e.disabled,this.stencilClearMode,Ke.disabled,it.disabled,uo(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Bi.prototype._renderTileClippingMasks=function(f,d){if(this.currentStencilSource!==f.source&&f.isTileClipped()&&d&&d.length){this.currentStencilSource=f.source;var h=this.context,g=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(Ke.disabled),h.setDepthMode(_e.disabled);var w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,T=d;C<T.length;C+=1){var L=T[C],k=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;w.draw(h,g.TRIANGLES,_e.disabled,new Le({func:g.ALWAYS,mask:0},k,255,g.KEEP,g.KEEP,g.REPLACE),Ke.disabled,it.disabled,uo(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Bi.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var f=this.nextStencilID++,d=this.context.gl;return new Le({func:d.NOTEQUAL,mask:255},f,255,d.KEEP,d.KEEP,d.REPLACE)},Bi.prototype.stencilModeForClipping=function(f){var d=this.context.gl;return new Le({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[f.key],0,d.KEEP,d.KEEP,d.REPLACE)},Bi.prototype.stencilConfigForOverlap=function(f){var d,h=this.context.gl,g=f.sort(function(k,X){return X.overscaledZ-k.overscaledZ}),w=g[g.length-1].overscaledZ,C=g[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var T={},L=0;L<C;L++)T[L+w]=new Le({func:h.GEQUAL,mask:255},L+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[T,g]}return[(d={},d[w]=Le.disabled,d),g]},Bi.prototype.colorModeForRenderPass=function(){var f=this.context.gl;return this._showOverdrawInspector?new Ke([f.CONSTANT_COLOR,f.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ke.unblended:Ke.alphaBlended},Bi.prototype.depthModeForSublayer=function(f,d,h){if(!this.opaquePassEnabledForLayer())return _e.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+f)*this.depthEpsilon;return new _e(h||this.context.gl.LEQUAL,d,[g,g])},Bi.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Bi.prototype.render=function(f,d){var h=this;this.style=f,this.options=d,this.lineAtlas=f.lineAtlas,this.imageManager=f.imageManager,this.glyphManager=f.glyphManager,this.symbolFadeChange=f.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,w=this.style.sourceCaches;for(var C in w){var T=w[C];T.used&&T.prepare(this.context)}var L,k,X={},ae={},de={};for(var ge in w){var Te=w[ge];X[ge]=Te.getVisibleCoordinates(),ae[ge]=X[ge].slice().reverse(),de[ge]=Te.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Re=0;Re<g.length;Re++)if(this.style._layers[g[Re]].is3D()){this.opaquePassCutoff=Re;break}this.renderPass="offscreen";for(var We=0,Ae=g;We<Ae.length;We+=1){var $e=this.style._layers[Ae[We]];if($e.hasOffscreenPass()&&!$e.isHidden(this.transform.zoom)){var ot=ae[$e.source];($e.type==="custom"||ot.length)&&this.renderLayer(this,w[$e.source],$e,ot)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(f._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var At=this.style._layers[g[this.currentLayer]],Gt=w[At.source],Bt=X[At.source];this._renderTileClippingMasks(At,Bt),this.renderLayer(this,Gt,At,Bt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var Ut=this.style._layers[g[this.currentLayer]],hr=w[Ut.source],Zr=(Ut.type==="symbol"?de:ae)[Ut.source];this._renderTileClippingMasks(Ut,X[Ut.source]),this.renderLayer(this,hr,Ut,Zr)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(kr){kr.source&&!kr.isHidden(h.transform.zoom)&&(kr.source!==(k&&k.id)&&(k=h.style.sourceCaches[kr.source]),(!L||L.getSource().maxzoom<k.getSource().maxzoom)&&(L=k))}),L&&qa.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(kr){var rn=kr.transform.padding;Kc(kr,kr.transform.height-(rn.top||0),3,Df),Kc(kr,rn.bottom||0,3,fh),Jc(kr,rn.left||0,3,yi),Jc(kr,kr.transform.width-(rn.right||0),3,Gl);var Cn=kr.transform.centerPoint;(function(Ln,Mn,Ci,nn){pl(Ln,Mn-1,Ci-10,2,20,nn),pl(Ln,Mn-10,Ci-1,20,2,nn)})(kr,Cn.x,kr.transform.height-Cn.y,qc)}(this),this.context.setDefault()},Bi.prototype.renderLayer=function(f,d,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||g.length)&&(this.id=h.id,this.gpuTimingStart(h),qa[h.type](f,d,h,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},Bi.prototype.gpuTimingStart=function(f){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[f.id];h||(h=this.gpuTimers[f.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},Bi.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var f=this.context.extTimerQuery;f.endQueryEXT(f.TIME_ELAPSED_EXT)}},Bi.prototype.collectGpuTimers=function(){var f=this.gpuTimers;return this.gpuTimers={},f},Bi.prototype.queryGpuTimers=function(f){var d={};for(var h in f){var g=f[h],w=this.context.extTimerQuery,C=w.getQueryObjectEXT(g.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(g.query),d[h]=C}return d},Bi.prototype.translatePosMatrix=function(f,d,h,g,w){if(!h[0]&&!h[1])return f;var C=w?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(C){var T=Math.sin(C),L=Math.cos(C);h=[h[0]*L-h[1]*T,h[0]*T+h[1]*L]}var k=[w?h[0]:Vi(d,h[0],this.transform.zoom),w?h[1]:Vi(d,h[1],this.transform.zoom),0],X=new Float32Array(16);return y.translate(X,f,k),X},Bi.prototype.saveTileTexture=function(f){var d=this._tileTextures[f.size[0]];d?d.push(f):this._tileTextures[f.size[0]]=[f]},Bi.prototype.getTileTexture=function(f){var d=this._tileTextures[f];return d&&d.length>0?d.pop():null},Bi.prototype.isPatternMissing=function(f){if(!f)return!1;if(!f.from||!f.to)return!0;var d=this.imageManager.getPattern(f.from.toString()),h=this.imageManager.getPattern(f.to.toString());return!d||!h},Bi.prototype.useProgram=function(f,d){this.cache=this.cache||{};var h=""+f+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new Dn(this.context,f,Tf[f],d,Xc[f],this._showOverdrawInspector)),this.cache[h]},Bi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Bi.prototype.setBaseState=function(){var f=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(f.FUNC_ADD)},Bi.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Bi.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var js=function(f,d){this.points=f,this.planes=d};js.fromInvProjectionMatrix=function(f,d,h){var g=Math.pow(2,h),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return y.transformMat4([],T,f)}).map(function(T){return y.scale$1([],T,1/T[3]/d*g)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var L=y.sub([],w[T[0]],w[T[1]]),k=y.sub([],w[T[2]],w[T[1]]),X=y.normalize([],y.cross([],L,k)),ae=-y.dot(X,w[T[1]]);return X.concat(ae)});return new js(w,C)};var wu=function(f,d){this.min=f,this.max=d,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};wu.prototype.quadrant=function(f){for(var d=[f%2==0,f<2],h=y.clone$2(this.min),g=y.clone$2(this.max),w=0;w<d.length;w++)h[w]=d[w]?this.min[w]:this.center[w],g[w]=d[w]?this.center[w]:this.max[w];return g[2]=this.max[2],new wu(h,g)},wu.prototype.distanceX=function(f){return Math.max(Math.min(this.max[0],f[0]),this.min[0])-f[0]},wu.prototype.distanceY=function(f){return Math.max(Math.min(this.max[1],f[1]),this.min[1])-f[1]},wu.prototype.intersects=function(f){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,g=0;g<f.planes.length;g++){for(var w=f.planes[g],C=0,T=0;T<d.length;T++)C+=y.dot$1(w,d[T])>=0;if(C===0)return 0;C!==d.length&&(h=!1)}if(h)return 2;for(var L=0;L<3;L++){for(var k=Number.MAX_VALUE,X=-Number.MAX_VALUE,ae=0;ae<f.points.length;ae++){var de=f.points[ae][L]-this.min[L];k=Math.min(k,de),X=Math.max(X,de)}if(X<0||k>this.max[L]-this.min[L])return 0}return 1};var Eu=function(f,d,h,g){if(f===void 0&&(f=0),d===void 0&&(d=0),h===void 0&&(h=0),g===void 0&&(g=0),isNaN(f)||f<0||isNaN(d)||d<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=f,this.bottom=d,this.left=h,this.right=g};Eu.prototype.interpolate=function(f,d,h){return d.top!=null&&f.top!=null&&(this.top=y.number(f.top,d.top,h)),d.bottom!=null&&f.bottom!=null&&(this.bottom=y.number(f.bottom,d.bottom,h)),d.left!=null&&f.left!=null&&(this.left=y.number(f.left,d.left,h)),d.right!=null&&f.right!=null&&(this.right=y.number(f.right,d.right,h)),this},Eu.prototype.getCenter=function(f,d){var h=y.clamp((this.left+f-this.right)/2,0,f),g=y.clamp((this.top+d-this.bottom)/2,0,d);return new y.Point(h,g)},Eu.prototype.equals=function(f){return this.top===f.top&&this.bottom===f.bottom&&this.left===f.left&&this.right===f.right},Eu.prototype.clone=function(){return new Eu(this.top,this.bottom,this.left,this.right)},Eu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var mi=function(f,d,h,g,w){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=w===void 0||w,this._minZoom=f||0,this._maxZoom=d||22,this._minPitch=h==null?0:h,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Eu,this._posMatrixCache={},this._alignedPosMatrixCache={}},ua={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};mi.prototype.clone=function(){var f=new mi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return f.tileSize=this.tileSize,f.latRange=this.latRange,f.width=this.width,f.height=this.height,f._center=this._center,f.zoom=this.zoom,f.angle=this.angle,f._fov=this._fov,f._pitch=this._pitch,f._unmodified=this._unmodified,f._edgeInsets=this._edgeInsets.clone(),f._calcMatrices(),f},ua.minZoom.get=function(){return this._minZoom},ua.minZoom.set=function(f){this._minZoom!==f&&(this._minZoom=f,this.zoom=Math.max(this.zoom,f))},ua.maxZoom.get=function(){return this._maxZoom},ua.maxZoom.set=function(f){this._maxZoom!==f&&(this._maxZoom=f,this.zoom=Math.min(this.zoom,f))},ua.minPitch.get=function(){return this._minPitch},ua.minPitch.set=function(f){this._minPitch!==f&&(this._minPitch=f,this.pitch=Math.max(this.pitch,f))},ua.maxPitch.get=function(){return this._maxPitch},ua.maxPitch.set=function(f){this._maxPitch!==f&&(this._maxPitch=f,this.pitch=Math.min(this.pitch,f))},ua.renderWorldCopies.get=function(){return this._renderWorldCopies},ua.renderWorldCopies.set=function(f){f===void 0?f=!0:f===null&&(f=!1),this._renderWorldCopies=f},ua.worldSize.get=function(){return this.tileSize*this.scale},ua.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ua.size.get=function(){return new y.Point(this.width,this.height)},ua.bearing.get=function(){return-this.angle/Math.PI*180},ua.bearing.set=function(f){var d=-y.wrap(f,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ua.pitch.get=function(){return this._pitch/Math.PI*180},ua.pitch.set=function(f){var d=y.clamp(f,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},ua.fov.get=function(){return this._fov/Math.PI*180},ua.fov.set=function(f){f=Math.max(.01,Math.min(60,f)),this._fov!==f&&(this._unmodified=!1,this._fov=f/180*Math.PI,this._calcMatrices())},ua.zoom.get=function(){return this._zoom},ua.zoom.set=function(f){var d=Math.min(Math.max(f,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},ua.center.get=function(){return this._center},ua.center.set=function(f){f.lat===this._center.lat&&f.lng===this._center.lng||(this._unmodified=!1,this._center=f,this._constrain(),this._calcMatrices())},ua.padding.get=function(){return this._edgeInsets.toJSON()},ua.padding.set=function(f){this._edgeInsets.equals(f)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,f,1),this._calcMatrices())},ua.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},mi.prototype.isPaddingEqual=function(f){return this._edgeInsets.equals(f)},mi.prototype.interpolatePadding=function(f,d,h){this._unmodified=!1,this._edgeInsets.interpolate(f,d,h),this._constrain(),this._calcMatrices()},mi.prototype.coveringZoomLevel=function(f){var d=(f.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/f.tileSize));return Math.max(0,d)},mi.prototype.getVisibleUnwrappedCoordinates=function(f){var d=[new y.UnwrappedTileID(0,f)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),w=this.pointCoordinate(new y.Point(this.width,this.height)),C=this.pointCoordinate(new y.Point(0,this.height)),T=Math.floor(Math.min(h.x,g.x,w.x,C.x)),L=Math.floor(Math.max(h.x,g.x,w.x,C.x)),k=T-1;k<=L+1;k++)k!==0&&d.push(new y.UnwrappedTileID(k,f));return d},mi.prototype.coveringTiles=function(f){var d=this.coveringZoomLevel(f),h=d;if(f.minzoom!==void 0&&d<f.minzoom)return[];f.maxzoom!==void 0&&d>f.maxzoom&&(d=f.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),w=Math.pow(2,d),C=[w*g.x,w*g.y,0],T=js.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),L=f.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=d);var k=function(kr){return{aabb:new wu([kr*w,0,0],[(kr+1)*w,w,0]),zoom:0,x:0,y:0,wrap:kr,fullyVisible:!1}},X=[],ae=[],de=d,ge=f.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var Te=1;Te<=3;Te++)X.push(k(-Te)),X.push(k(Te));for(X.push(k(0));X.length>0;){var Re=X.pop(),We=Re.x,Ae=Re.y,$e=Re.fullyVisible;if(!$e){var ot=Re.aabb.intersects(T);if(ot===0)continue;$e=ot===2}var At=Re.aabb.distanceX(C),Gt=Re.aabb.distanceY(C),Bt=Math.max(Math.abs(At),Math.abs(Gt));if(Re.zoom===de||Bt>3+(1<<de-Re.zoom)-2&&Re.zoom>=L)ae.push({tileID:new y.OverscaledTileID(Re.zoom===de?ge:Re.zoom,Re.wrap,Re.zoom,We,Ae),distanceSq:y.sqrLen([C[0]-.5-We,C[1]-.5-Ae])});else for(var Ut=0;Ut<4;Ut++){var hr=(We<<1)+Ut%2,Zr=(Ae<<1)+(Ut>>1);X.push({aabb:Re.aabb.quadrant(Ut),zoom:Re.zoom+1,x:hr,y:Zr,wrap:Re.wrap,fullyVisible:$e})}}return ae.sort(function(kr,rn){return kr.distanceSq-rn.distanceSq}).map(function(kr){return kr.tileID})},mi.prototype.resize=function(f,d){this.width=f,this.height=d,this.pixelsToGLUnits=[2/f,-2/d],this._constrain(),this._calcMatrices()},ua.unmodified.get=function(){return this._unmodified},mi.prototype.zoomScale=function(f){return Math.pow(2,f)},mi.prototype.scaleZoom=function(f){return Math.log(f)/Math.LN2},mi.prototype.project=function(f){var d=y.clamp(f.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(f.lng)*this.worldSize,y.mercatorYfromLat(d)*this.worldSize)},mi.prototype.unproject=function(f){return new y.MercatorCoordinate(f.x/this.worldSize,f.y/this.worldSize).toLngLat()},ua.point.get=function(){return this.project(this.center)},mi.prototype.setLocationAtPoint=function(f,d){var h=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(f),C=new y.MercatorCoordinate(w.x-(h.x-g.x),w.y-(h.y-g.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},mi.prototype.locationPoint=function(f){return this.coordinatePoint(this.locationCoordinate(f))},mi.prototype.pointLocation=function(f){return this.coordinateLocation(this.pointCoordinate(f))},mi.prototype.locationCoordinate=function(f){return y.MercatorCoordinate.fromLngLat(f)},mi.prototype.coordinateLocation=function(f){return f.toLngLat()},mi.prototype.pointCoordinate=function(f){var d=[f.x,f.y,0,1],h=[f.x,f.y,1,1];y.transformMat4(d,d,this.pixelMatrixInverse),y.transformMat4(h,h,this.pixelMatrixInverse);var g=d[3],w=h[3],C=d[1]/g,T=h[1]/w,L=d[2]/g,k=h[2]/w,X=L===k?0:(0-L)/(k-L);return new y.MercatorCoordinate(y.number(d[0]/g,h[0]/w,X)/this.worldSize,y.number(C,T,X)/this.worldSize)},mi.prototype.coordinatePoint=function(f){var d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix),new y.Point(d[0]/d[3],d[1]/d[3])},mi.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},mi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},mi.prototype.setMaxBounds=function(f){f?(this.lngRange=[f.getWest(),f.getEast()],this.latRange=[f.getSouth(),f.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},mi.prototype.calculatePosMatrix=function(f,d){d===void 0&&(d=!1);var h=f.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[h])return g[h];var w=f.canonical,C=this.worldSize/this.zoomScale(w.z),T=w.x+Math.pow(2,w.z)*f.wrap,L=y.identity(new Float64Array(16));return y.translate(L,L,[T*C,w.y*C,0]),y.scale(L,L,[C/y.EXTENT,C/y.EXTENT,1]),y.multiply(L,d?this.alignedProjMatrix:this.projMatrix,L),g[h]=new Float32Array(L),g[h]},mi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},mi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var f,d,h,g,w=-90,C=90,T=-180,L=180,k=this.size,X=this._unmodified;if(this.latRange){var ae=this.latRange;w=y.mercatorYfromLat(ae[1])*this.worldSize,f=(C=y.mercatorYfromLat(ae[0])*this.worldSize)-w<k.y?k.y/(C-w):0}if(this.lngRange){var de=this.lngRange;T=y.mercatorXfromLng(de[0])*this.worldSize,d=(L=y.mercatorXfromLng(de[1])*this.worldSize)-T<k.x?k.x/(L-T):0}var ge=this.point,Te=Math.max(d||0,f||0);if(Te)return this.center=this.unproject(new y.Point(d?(L+T)/2:ge.x,f?(C+w)/2:ge.y)),this.zoom+=this.scaleZoom(Te),this._unmodified=X,void(this._constraining=!1);if(this.latRange){var Re=ge.y,We=k.y/2;Re-We<w&&(g=w+We),Re+We>C&&(g=C-We)}if(this.lngRange){var Ae=ge.x,$e=k.x/2;Ae-$e<T&&(h=T+$e),Ae+$e>L&&(h=L-$e)}h===void 0&&g===void 0||(this.center=this.unproject(new y.Point(h!==void 0?h:ge.x,g!==void 0?g:ge.y))),this._unmodified=X,this._constraining=!1}},mi.prototype._calcMatrices=function(){if(this.height){var f=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+f.y/this.height),g=Math.sin(h)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-d-h,.01,Math.PI-.01)),w=this.point,C=w.x,T=w.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),k=this.height/50,X=new Float64Array(16);y.perspective(X,this._fov,this.width/this.height,k,L),X[8]=2*-f.x/this.width,X[9]=2*f.y/this.height,y.scale(X,X,[1,-1,1]),y.translate(X,X,[0,0,-this.cameraToCenterDistance]),y.rotateX(X,X,this._pitch),y.rotateZ(X,X,this.angle),y.translate(X,X,[-C,-T,0]),this.mercatorMatrix=y.scale([],X,[this.worldSize,this.worldSize,this.worldSize]),y.scale(X,X,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=X,this.invProjMatrix=y.invert([],this.projMatrix);var ae=this.width%2/2,de=this.height%2/2,ge=Math.cos(this.angle),Te=Math.sin(this.angle),Re=C-Math.round(C)+ge*ae+Te*de,We=T-Math.round(T)+ge*de+Te*ae,Ae=new Float64Array(X);if(y.translate(Ae,Ae,[Re>.5?Re-1:Re,We>.5?We-1:We,0]),this.alignedProjMatrix=Ae,X=y.create(),y.scale(X,X,[this.width/2,-this.height/2,1]),y.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=y.create(),y.scale(X,X,[1,-1,1]),y.translate(X,X,[-1,-1,0]),y.scale(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(X=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=X,this._posMatrixCache={},this._alignedPosMatrixCache={}}},mi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var f=this.pointCoordinate(new y.Point(0,0)),d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},mi.prototype.getCameraPoint=function(){var f=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,f))},mi.prototype.getCameraQueryGeometry=function(f){var d=this.getCameraPoint();if(f.length===1)return[f[0],d];for(var h=d.x,g=d.y,w=d.x,C=d.y,T=0,L=f;T<L.length;T+=1){var k=L[T];h=Math.min(h,k.x),g=Math.min(g,k.y),w=Math.max(w,k.x),C=Math.max(C,k.y)}return[new y.Point(h,g),new y.Point(w,g),new y.Point(w,C),new y.Point(h,C),new y.Point(h,g)]},Object.defineProperties(mi.prototype,ua);var ys=function(f){var d,h,g,w;this._hashName=f&&encodeURIComponent(f),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),h=!1,g=null,w=function(){g=null,h&&(d(),g=setTimeout(w,300),h=!1)},function(){return h=!0,g||w(),g})};ys.prototype.addTo=function(f){return this._map=f,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ys.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ys.prototype.getHashString=function(f){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,g),C=Math.round(d.lng*w)/w,T=Math.round(d.lat*w)/w,L=this._map.getBearing(),k=this._map.getPitch(),X="";if(X+=f?"/"+C+"/"+T+"/"+h:h+"/"+T+"/"+C,(L||k)&&(X+="/"+Math.round(10*L)/10),k&&(X+="/"+Math.round(k)),this._hashName){var ae=this._hashName,de=!1,ge=y.window.location.hash.slice(1).split("&").map(function(Te){var Re=Te.split("=")[0];return Re===ae?(de=!0,Re+"="+X):Te}).filter(function(Te){return Te});return de||ge.push(ae+"="+X),"#"+ge.join("&")}return"#"+X},ys.prototype._getCurrentHash=function(){var f,d=this,h=y.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===d._hashName&&(f=g)}),(f&&f[1]||"").split("/")):h.split("/")},ys.prototype._onHashChange=function(){var f=this._getCurrentHash();if(f.length>=3&&!f.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:d,pitch:+(f[4]||0)}),!0}return!1},ys.prototype._updateHashUnthrottled=function(){var f=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,f)}catch(d){}};var Hl={linearity:.3,easing:y.bezier(0,0,.3,1)},Wl=y.extend({deceleration:2500,maxSpeed:1400},Hl),Qc=y.extend({deceleration:20,maxSpeed:1400},Hl),Vh=y.extend({deceleration:1e3,maxSpeed:360},Hl),Ba=y.extend({deceleration:1e3,maxSpeed:90},Hl),dl=function(f){this._map=f,this.clear()};function uu(f,d){(!f.duration||f.duration<d.duration)&&(f.duration=d.duration,f.easing=d.easing)}function Wu(f,d,h){var g=h.maxSpeed,w=h.linearity,C=h.deceleration,T=y.clamp(f*w/(d/1e3),-g,g),L=Math.abs(T)/(C*w);return{easing:h.easing,duration:1e3*L,amount:T*(L/2)}}dl.prototype.clear=function(){this._inertiaBuffer=[]},dl.prototype.record=function(f){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:f})},dl.prototype._drainInertiaBuffer=function(){for(var f=this._inertiaBuffer,d=y.browser.now();f.length>0&&d-f[0].time>160;)f.shift()},dl.prototype._onMoveEnd=function(f){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},h=0,g=this._inertiaBuffer;h<g.length;h+=1){var w=g[h].settings;d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(d.pan.mag()){var L=Wu(d.pan.mag(),C,y.extend({},Wl,f||{}));T.offset=d.pan.mult(L.amount/d.pan.mag()),T.center=this._map.transform.center,uu(T,L)}if(d.zoom){var k=Wu(d.zoom,C,Qc);T.zoom=this._map.transform.zoom+k.amount,uu(T,k)}if(d.bearing){var X=Wu(d.bearing,C,Vh);T.bearing=this._map.transform.bearing+y.clamp(X.amount,-179,179),uu(T,X)}if(d.pitch){var ae=Wu(d.pitch,C,Ba);T.pitch=this._map.transform.pitch+ae.amount,uu(T,ae)}if(T.zoom||T.bearing){var de=d.pinchAround===void 0?d.around:d.pinchAround;T.around=de?this._map.unproject(de):this._map.getCenter()}return this.clear(),y.extend(T,{noMoveStart:!0})}};var Ma=function(f){function d(g,w,C,T){T===void 0&&(T={});var L=U.mousePos(w.getCanvasContainer(),C),k=w.unproject(L);f.call(this,g,y.extend({point:L,lngLat:k,originalEvent:C},T)),this._defaultPrevented=!1,this.target=w}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),$o=function(f){function d(g,w,C){var T=g==="touchend"?C.changedTouches:C.touches,L=U.touchPos(w.getCanvasContainer(),T),k=L.map(function(de){return w.unproject(de)}),X=L.reduce(function(de,ge,Te,Re){return de.add(ge.div(Re.length))},new y.Point(0,0)),ae=w.unproject(X);f.call(this,g,{points:L,point:X,lngLats:k,lngLat:ae,originalEvent:C}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Au=function(f){function d(g,w,C){f.call(this,g,{originalEvent:C}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),ha=function(f,d){this._map=f,this._clickTolerance=d.clickTolerance};ha.prototype.reset=function(){delete this._mousedownPos},ha.prototype.wheel=function(f){return this._firePreventable(new Au(f.type,this._map,f))},ha.prototype.mousedown=function(f,d){return this._mousedownPos=d,this._firePreventable(new Ma(f.type,this._map,f))},ha.prototype.mouseup=function(f){this._map.fire(new Ma(f.type,this._map,f))},ha.prototype.click=function(f,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ma(f.type,this._map,f))},ha.prototype.dblclick=function(f){return this._firePreventable(new Ma(f.type,this._map,f))},ha.prototype.mouseover=function(f){this._map.fire(new Ma(f.type,this._map,f))},ha.prototype.mouseout=function(f){this._map.fire(new Ma(f.type,this._map,f))},ha.prototype.touchstart=function(f){return this._firePreventable(new $o(f.type,this._map,f))},ha.prototype.touchmove=function(f){this._map.fire(new $o(f.type,this._map,f))},ha.prototype.touchend=function(f){this._map.fire(new $o(f.type,this._map,f))},ha.prototype.touchcancel=function(f){this._map.fire(new $o(f.type,this._map,f))},ha.prototype._firePreventable=function(f){if(this._map.fire(f),f.defaultPrevented)return{}},ha.prototype.isEnabled=function(){return!0},ha.prototype.isActive=function(){return!1},ha.prototype.enable=function(){},ha.prototype.disable=function(){};var cn=function(f){this._map=f};cn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},cn.prototype.mousemove=function(f){this._map.fire(new Ma(f.type,this._map,f))},cn.prototype.mousedown=function(){this._delayContextMenu=!0},cn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ma("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},cn.prototype.contextmenu=function(f){this._delayContextMenu?this._contextMenuEvent=f:this._map.fire(new Ma(f.type,this._map,f)),this._map.listens("contextmenu")&&f.preventDefault()},cn.prototype.isEnabled=function(){return!0},cn.prototype.isActive=function(){return!1},cn.prototype.enable=function(){},cn.prototype.disable=function(){};var Ka=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._container=f.getContainer(),this._clickTolerance=d.clickTolerance||1};function vl(f,d){for(var h={},g=0;g<f.length;g++)h[f[g].identifier]=d[g];return h}Ka.prototype.isEnabled=function(){return!!this._enabled},Ka.prototype.isActive=function(){return!!this._active},Ka.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Ka.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ka.prototype.mousedown=function(f,d){this.isEnabled()&&f.shiftKey&&f.button===0&&(U.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},Ka.prototype.mousemoveWindow=function(f,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=h,this._box||(this._box=U.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",f));var w=Math.min(g.x,h.x),C=Math.max(g.x,h.x),T=Math.min(g.y,h.y),L=Math.max(g.y,h.y);U.setTransform(this._box,"translate("+w+"px,"+T+"px)"),this._box.style.width=C-w+"px",this._box.style.height=L-T+"px"}}},Ka.prototype.mouseupWindow=function(f,d){var h=this;if(this._active&&f.button===0){var g=this._startPos,w=d;if(this.reset(),U.suppressClick(),g.x!==w.x||g.y!==w.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:f})),{cameraAnimation:function(C){return C.fitScreenCoordinates(g,w,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",f)}},Ka.prototype.keydown=function(f){this._active&&f.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",f))},Ka.prototype.blur=function(){this.reset()},Ka.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos},Ka.prototype._fireEvent=function(f,d){return this._map.fire(new y.Event(f,{originalEvent:d}))};var ml=function(f){this.reset(),this.numTouches=f.numTouches};ml.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ml.prototype.touchstart=function(f,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=f.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){for(var w=new y.Point(0,0),C=0,T=g;C<T.length;C+=1)w._add(T[C]);return w.div(g.length)}(d),this.touches=vl(h,d)))},ml.prototype.touchmove=function(f,d,h){if(!this.aborted&&this.centroid){var g=vl(h,d);for(var w in this.touches){var C=g[w];(!C||C.dist(this.touches[w])>30)&&(this.aborted=!0)}}},ml.prototype.touchend=function(f,d,h){if((!this.centroid||f.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var ks=function(f){this.singleTap=new ml(f),this.numTaps=f.numTaps,this.reset()};ks.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ks.prototype.touchstart=function(f,d,h){this.singleTap.touchstart(f,d,h)},ks.prototype.touchmove=function(f,d,h){this.singleTap.touchmove(f,d,h)},ks.prototype.touchend=function(f,d,h){var g=this.singleTap.touchend(f,d,h);if(g){var w=f.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(g)<30;if(w&&C||this.reset(),this.count++,this.lastTime=f.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var _s=function(){this._zoomIn=new ks({numTouches:1,numTaps:2}),this._zoomOut=new ks({numTouches:2,numTaps:1}),this.reset()};_s.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},_s.prototype.touchstart=function(f,d,h){this._zoomIn.touchstart(f,d,h),this._zoomOut.touchstart(f,d,h)},_s.prototype.touchmove=function(f,d,h){this._zoomIn.touchmove(f,d,h),this._zoomOut.touchmove(f,d,h)},_s.prototype.touchend=function(f,d,h){var g=this,w=this._zoomIn.touchend(f,d,h),C=this._zoomOut.touchend(f,d,h);return w?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(w)},{originalEvent:f})}}):C?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(C)},{originalEvent:f})}}):void 0},_s.prototype.touchcancel=function(){this.reset()},_s.prototype.enable=function(){this._enabled=!0},_s.prototype.disable=function(){this._enabled=!1,this.reset()},_s.prototype.isEnabled=function(){return this._enabled},_s.prototype.isActive=function(){return this._active};var Gs={0:1,2:2},Pr=function(f){this.reset(),this._clickTolerance=f.clickTolerance||1};Pr.prototype.blur=function(){this.reset()},Pr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Pr.prototype._correctButton=function(f,d){return!1},Pr.prototype._move=function(f,d){return{}},Pr.prototype.mousedown=function(f,d){if(!this._lastPoint){var h=U.mouseButton(f);this._correctButton(f,h)&&(this._lastPoint=d,this._eventButton=h)}},Pr.prototype.mousemoveWindow=function(f,d){var h=this._lastPoint;if(h){if(f.preventDefault(),function(g,w){var C=Gs[w];return g.buttons===void 0||(g.buttons&C)!==C}(f,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},Pr.prototype.mouseupWindow=function(f){this._lastPoint&&U.mouseButton(f)===this._eventButton&&(this._moved&&U.suppressClick(),this.reset())},Pr.prototype.enable=function(){this._enabled=!0},Pr.prototype.disable=function(){this._enabled=!1,this.reset()},Pr.prototype.isEnabled=function(){return this._enabled},Pr.prototype.isActive=function(){return this._active};var Ff=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.mousedown=function(h,g){f.prototype.mousedown.call(this,h,g),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,g){return g===0&&!h.ctrlKey},d.prototype._move=function(h,g){return{around:g,panDelta:g.sub(h)}},d}(Pr),_c=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=.8*(g.x-h.x);if(w)return this._active=!0,{bearingDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Pr),lu=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=-.5*(g.y-h.y);if(w)return this._active=!0,{pitchDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Pr),Ls=function(f){this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset()};Ls.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},Ls.prototype.touchstart=function(f,d,h){return this._calculateTransform(f,d,h)},Ls.prototype.touchmove=function(f,d,h){if(this._active&&!(h.length<this._minTouches))return f.preventDefault(),this._calculateTransform(f,d,h)},Ls.prototype.touchend=function(f,d,h){this._calculateTransform(f,d,h),this._active&&h.length<this._minTouches&&this.reset()},Ls.prototype.touchcancel=function(){this.reset()},Ls.prototype._calculateTransform=function(f,d,h){h.length>0&&(this._active=!0);var g=vl(h,d),w=new y.Point(0,0),C=new y.Point(0,0),T=0;for(var L in g){var k=g[L],X=this._touches[L];X&&(w._add(k),C._add(k.sub(X)),T++,g[L]=k)}if(this._touches=g,!(T<this._minTouches)&&C.mag()){var ae=C.div(T);if(this._sum._add(ae),!(this._sum.mag()<this._clickTolerance))return{around:w.div(T),panDelta:ae}}},Ls.prototype.enable=function(){this._enabled=!0},Ls.prototype.disable=function(){this._enabled=!1,this.reset()},Ls.prototype.isEnabled=function(){return this._enabled},Ls.prototype.isActive=function(){return this._active};var Fo=function(){this.reset()};function ef(f,d,h){for(var g=0;g<f.length;g++)if(f[g].identifier===h)return d[g]}function $l(f,d){return Math.log(f/d)/Math.LN2}Fo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Fo.prototype._start=function(f){},Fo.prototype._move=function(f,d,h){return{}},Fo.prototype.touchstart=function(f,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},Fo.prototype.touchmove=function(f,d,h){if(this._firstTwoTouches){f.preventDefault();var g=this._firstTwoTouches,w=g[1],C=ef(h,d,g[0]),T=ef(h,d,w);if(C&&T){var L=this._aroundCenter?null:C.add(T).div(2);return this._move([C,T],L,f)}}},Fo.prototype.touchend=function(f,d,h){if(this._firstTwoTouches){var g=this._firstTwoTouches,w=g[1],C=ef(h,d,g[0]),T=ef(h,d,w);C&&T||(this._active&&U.suppressClick(),this.reset())}},Fo.prototype.touchcancel=function(){this.reset()},Fo.prototype.enable=function(f){this._enabled=!0,this._aroundCenter=!!f&&f.around==="center"},Fo.prototype.disable=function(){this._enabled=!1,this.reset()},Fo.prototype.isEnabled=function(){return this._enabled},Fo.prototype.isActive=function(){return this._active};var Bo=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs($l(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$l(this._distance,w),pinchAround:g}},d}(Fo);function Cu(f,d){return 180*f.angleWith(d)/Math.PI}var tf=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Cu(this._vector,w),pinchAround:g}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var g=25/(Math.PI*this._minDiameter)*360,w=Cu(h,this._startVector);return Math.abs(w)<g},d}(Fo);function gl(f){return Math.abs(f.y)>Math.abs(f.x)}var hh=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,gl(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,g,w){var C=h[0].sub(this._lastPoints[0]),T=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,T,w.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(C.y+T.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,g,w){if(this._valid!==void 0)return this._valid;var C=h.mag()>=2,T=g.mag()>=2;if(C||T){if(!C||!T)return this._firstMove===void 0&&(this._firstMove=w),w-this._firstMove<100&&void 0;var L=h.y>0==g.y>0;return gl(h)&&gl(g)&&L}},d}(Fo),xc={panStep:100,bearingStep:15,pitchStep:10},cs=function(){var f=xc;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1};function Rs(f){return f*(2-f)}cs.prototype.blur=function(){this.reset()},cs.prototype.reset=function(){this._active=!1},cs.prototype.keydown=function(f){var d=this;if(!(f.altKey||f.ctrlKey||f.metaKey)){var h=0,g=0,w=0,C=0,T=0;switch(f.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:f.shiftKey?g=-1:(f.preventDefault(),C=-1);break;case 39:f.shiftKey?g=1:(f.preventDefault(),C=1);break;case 38:f.shiftKey?w=1:(f.preventDefault(),T=-1);break;case 40:f.shiftKey?w=-1:(f.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(g=0,w=0),{cameraAnimation:function(L){var k=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Rs,zoom:h?Math.round(k)+h*(f.shiftKey?2:1):k,bearing:L.getBearing()+g*d._bearingStep,pitch:L.getPitch()+w*d._pitchStep,offset:[-C*d._panStep,-T*d._panStep],center:L.getCenter()},{originalEvent:f})}}}},cs.prototype.enable=function(){this._enabled=!0},cs.prototype.disable=function(){this._enabled=!1,this.reset()},cs.prototype.isEnabled=function(){return this._enabled},cs.prototype.isActive=function(){return this._active},cs.prototype.disableRotation=function(){this._rotationDisabled=!0},cs.prototype.enableRotation=function(){this._rotationDisabled=!1};var pi=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};pi.prototype.setZoomRate=function(f){this._defaultZoomRate=f},pi.prototype.setWheelZoomRate=function(f){this._wheelZoomRate=f},pi.prototype.isEnabled=function(){return!!this._enabled},pi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},pi.prototype.isZooming=function(){return!!this._zooming},pi.prototype.enable=function(f){this.isEnabled()||(this._enabled=!0,this._aroundCenter=f&&f.around==="center")},pi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},pi.prototype.wheel=function(f){if(this.isEnabled()){var d=f.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*f.deltaY:f.deltaY,h=y.browser.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,f)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),f.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=f,this._delta-=d,this._active||this._start(f)),f.preventDefault()}},pi.prototype._onTimeout=function(f){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},pi.prototype._start=function(f){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=U.mousePos(this._el,f);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},pi.prototype.renderFrame=function(){var f=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&g!==0&&(g=1/g);var w=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(w*g))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,T=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,L=this._startZoom,k=this._easing,X=!1;if(this._type==="wheel"&&L&&k){var ae=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),de=k(ae);C=y.number(L,T,de),ae<1?this._frameId||(this._frameId=!0):X=!0}else C=T,X=!0;return this._active=!0,X&&(this._active=!1,this._finishTimeout=setTimeout(function(){f._zooming=!1,f._handler._triggerRenderFrame(),delete f._targetZoom,delete f._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!X,zoomDelta:C-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},pi.prototype._smoothOutEasing=function(f){var d=y.ease;if(this._prevEase){var h=this._prevEase,g=(y.browser.now()-h.start)/h.duration,w=h.easing(g+.01)-h.easing(g),C=.27/Math.sqrt(w*w+1e-4)*.01,T=Math.sqrt(.0729-C*C);d=y.bezier(C,T,.25,1)}return this._prevEase={start:y.browser.now(),duration:f,easing:d},d},pi.prototype.blur=function(){this.reset()},pi.prototype.reset=function(){this._active=!1};var cu=function(f,d){this._clickZoom=f,this._tapZoom=d};cu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},cu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},cu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},cu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var xo=function(){this.reset()};xo.prototype.reset=function(){this._active=!1},xo.prototype.blur=function(){this.reset()},xo.prototype.dblclick=function(f,d){return f.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(f.shiftKey?-1:1),around:h.unproject(d)},{originalEvent:f})}}},xo.prototype.enable=function(){this._enabled=!0},xo.prototype.disable=function(){this._enabled=!1,this.reset()},xo.prototype.isEnabled=function(){return this._enabled},xo.prototype.isActive=function(){return this._active};var zi=function(){this._tap=new ks({numTouches:1,numTaps:1}),this.reset()};zi.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},zi.prototype.touchstart=function(f,d,h){this._swipePoint||(this._tapTime&&f.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(f,d,h))},zi.prototype.touchmove=function(f,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var g=d[0],w=g.y-this._swipePoint.y;return this._swipePoint=g,f.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(f,d,h)},zi.prototype.touchend=function(f,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(f,d,h)&&(this._tapTime=f.timeStamp)},zi.prototype.touchcancel=function(){this.reset()},zi.prototype.enable=function(){this._enabled=!0},zi.prototype.disable=function(){this._enabled=!1,this.reset()},zi.prototype.isEnabled=function(){return this._enabled},zi.prototype.isActive=function(){return this._active};var yl=function(f,d,h){this._el=f,this._mousePan=d,this._touchPan=h};yl.prototype.enable=function(f){this._inertiaOptions=f||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},yl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},yl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},yl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var $u=function(f,d,h){this._pitchWithRotate=f.pitchWithRotate,this._mouseRotate=d,this._mousePitch=h};$u.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},$u.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},$u.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},$u.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Hs=function(f,d,h,g){this._el=f,this._touchZoom=d,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};Hs.prototype.enable=function(f){this._touchZoom.enable(f),this._rotationDisabled||this._touchRotate.enable(f),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Hs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Hs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Hs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Hs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Hs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var zo=function(f){return f.zoom||f.drag||f.pitch||f.rotate},bc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(y.Event);function An(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}var dn=function(f,d){this._map=f,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dl(f),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),y.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,w=this._listeners;g<w.length;g+=1){var C=w[g],T=C[0];U.addEventListener(T,C[1],T===y.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};dn.prototype.destroy=function(){for(var f=0,d=this._listeners;f<d.length;f+=1){var h=d[f],g=h[0];U.removeEventListener(g,h[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},dn.prototype._addDefaultHandlers=function(f){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new ha(d,f));var g=d.boxZoom=new Ka(d,f);this._add("boxZoom",g);var w=new _s,C=new xo;d.doubleClickZoom=new cu(C,w),this._add("tapZoom",w),this._add("clickZoom",C);var T=new zi;this._add("tapDragZoom",T);var L=d.touchPitch=new hh;this._add("touchPitch",L);var k=new _c(f),X=new lu(f);d.dragRotate=new $u(f,k,X),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);var ae=new Ff(f),de=new Ls(f);d.dragPan=new yl(h,ae,de),this._add("mousePan",ae),this._add("touchPan",de,["touchZoom","touchRotate"]);var ge=new tf,Te=new Bo;d.touchZoomRotate=new Hs(h,Te,ge,T),this._add("touchRotate",ge,["touchPan","touchZoom"]),this._add("touchZoom",Te,["touchPan","touchRotate"]);var Re=d.scrollZoom=new pi(d,this);this._add("scrollZoom",Re,["mousePan"]);var We=d.keyboard=new cs;this._add("keyboard",We),this._add("blockableMapEvent",new cn(d));for(var Ae=0,$e=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ae<$e.length;Ae+=1){var ot=$e[Ae];f.interactive&&f[ot]&&d[ot].enable(f[ot])}},dn.prototype._add=function(f,d,h){this._handlers.push({handlerName:f,handler:d,allowed:h}),this._handlersById[f]=d},dn.prototype.stop=function(f){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},f),this._changes=[]}},dn.prototype.isActive=function(){for(var f=0,d=this._handlers;f<d.length;f+=1)if(d[f].handler.isActive())return!0;return!1},dn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},dn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},dn.prototype.isMoving=function(){return Boolean(zo(this._eventsInProgress))||this.isZooming()},dn.prototype._blockedByActive=function(f,d,h){for(var g in f)if(g!==h&&(!d||d.indexOf(g)<0))return!0;return!1},dn.prototype.handleWindowEvent=function(f){this.handleEvent(f,f.type+"Window")},dn.prototype._getMapTouches=function(f){for(var d=[],h=0,g=f;h<g.length;h+=1){var w=g[h];this._el.contains(w.target)&&d.push(w)}return d},dn.prototype.handleEvent=function(f,d){this._updatingCamera=!0;for(var h=f.type==="renderFrame"?void 0:f,g={needsRenderFrame:!1},w={},C={},T=f.touches?this._getMapTouches(f.touches):void 0,L=T?U.touchPos(this._el,T):U.mousePos(this._el,f),k=0,X=this._handlers;k<X.length;k+=1){var ae=X[k],de=ae.handlerName,ge=ae.handler,Te=ae.allowed;if(ge.isEnabled()){var Re=void 0;this._blockedByActive(C,Te,de)?ge.reset():ge[d||f.type]&&(Re=ge[d||f.type](f,L,T),this.mergeHandlerResult(g,w,Re,de,h),Re&&Re.needsRenderFrame&&this._triggerRenderFrame()),(Re||ge.isActive())&&(C[de]=ge)}}var We={};for(var Ae in this._previousActiveHandlers)C[Ae]||(We[Ae]=h);this._previousActiveHandlers=C,(Object.keys(We).length||An(g))&&(this._changes.push([g,w,We]),this._triggerRenderFrame()),(Object.keys(C).length||An(g))&&this._map._stop(!0),this._updatingCamera=!1;var $e=g.cameraAnimation;$e&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$e(this._map))},dn.prototype.mergeHandlerResult=function(f,d,h,g,w){if(h){y.extend(f,h);var C={handlerName:g,originalEvent:h.originalEvent||w};h.zoomDelta!==void 0&&(d.zoom=C),h.panDelta!==void 0&&(d.drag=C),h.pitchDelta!==void 0&&(d.pitch=C),h.bearingDelta!==void 0&&(d.rotate=C)}},dn.prototype._applyChanges=function(){for(var f={},d={},h={},g=0,w=this._changes;g<w.length;g+=1){var C=w[g],T=C[0],L=C[1],k=C[2];T.panDelta&&(f.panDelta=(f.panDelta||new y.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(f.zoomDelta=(f.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(f.bearingDelta=(f.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(f.pitchDelta=(f.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(f.around=T.around),T.pinchAround!==void 0&&(f.pinchAround=T.pinchAround),T.noInertia&&(f.noInertia=T.noInertia),y.extend(d,L),y.extend(h,k)}this._updateMapTransform(f,d,h),this._changes=[]},dn.prototype._updateMapTransform=function(f,d,h){var g=this._map,w=g.transform;if(!An(f))return this._fireEvents(d,h,!0);var C=f.panDelta,T=f.zoomDelta,L=f.bearingDelta,k=f.pitchDelta,X=f.around,ae=f.pinchAround;ae!==void 0&&(X=ae),g._stop(!0),X=X||g.transform.centerPoint;var de=w.pointLocation(C?X.sub(C):X);L&&(w.bearing+=L),k&&(w.pitch+=k),T&&(w.zoom+=T),w.setLocationAtPoint(de,X),this._map._update(),f.noInertia||this._inertia.record(f),this._fireEvents(d,h,!0)},dn.prototype._fireEvents=function(f,d,h){var g=this,w=zo(this._eventsInProgress),C=zo(f),T={};for(var L in f)this._eventsInProgress[L]||(T[L+"start"]=f[L].originalEvent),this._eventsInProgress[L]=f[L];for(var k in!w&&C&&this._fireEvent("movestart",C.originalEvent),T)this._fireEvent(k,T[k]);for(var X in C&&this._fireEvent("move",C.originalEvent),f)this._fireEvent(X,f[X].originalEvent);var ae,de={};for(var ge in this._eventsInProgress){var Te=this._eventsInProgress[ge],Re=Te.handlerName,We=Te.originalEvent;this._handlersById[Re].isActive()||(delete this._eventsInProgress[ge],de[ge+"end"]=ae=d[Re]||We)}for(var Ae in de)this._fireEvent(Ae,de[Ae]);var $e=zo(this._eventsInProgress);if(h&&(w||C)&&!$e){this._updatingCamera=!0;var ot=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),At=function(Gt){return Gt!==0&&-g._bearingSnap<Gt&&Gt<g._bearingSnap};ot?(At(ot.bearing||this._map.getBearing())&&(ot.bearing=0),this._map.easeTo(ot,{originalEvent:ae})):(this._map.fire(new y.Event("moveend",{originalEvent:ae})),At(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},dn.prototype._fireEvent=function(f,d){this._map.fire(new y.Event(f,d?{originalEvent:d}:{}))},dn.prototype._requestFrame=function(){var f=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete f._frameId,f.handleEvent(new bc("renderFrame",{timeStamp:d})),f._applyChanges()})},dn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Yu=function(f){function d(h,g){f.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,g){return this.jumpTo({center:h},g)},d.prototype.panBy=function(h,g,w){return h=y.Point.convert(h).mult(-1),this.panTo(this.transform.center,y.extend({offset:h},g),w)},d.prototype.panTo=function(h,g,w){return this.easeTo(y.extend({center:h},g),w)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,g){return this.jumpTo({zoom:h},g),this},d.prototype.zoomTo=function(h,g,w){return this.easeTo(y.extend({zoom:h},g),w)},d.prototype.zoomIn=function(h,g){return this.zoomTo(this.getZoom()+1,h,g),this},d.prototype.zoomOut=function(h,g){return this.zoomTo(this.getZoom()-1,h,g),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,g){return this.jumpTo({bearing:h},g),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,g){return this.jumpTo({padding:h},g),this},d.prototype.rotateTo=function(h,g,w){return this.easeTo(y.extend({bearing:h},g),w)},d.prototype.resetNorth=function(h,g){return this.rotateTo(0,y.extend({duration:1e3},h),g),this},d.prototype.resetNorthPitch=function(h,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},h),g),this},d.prototype.snapToNorth=function(h,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,g):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,g){return this.jumpTo({pitch:h},g),this},d.prototype.cameraForBounds=function(h,g){h=y.LngLatBounds.convert(h);var w=g&&g.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),w,g)},d.prototype._cameraForBoxAndBearing=function(h,g,w,C){var T={top:0,bottom:0,right:0,left:0};if(typeof(C=y.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var L=C.padding;C.padding={top:L,bottom:L,right:L,left:L}}C.padding=y.extend(T,C.padding);var k=this.transform,X=k.padding,ae=k.project(y.LngLat.convert(h)),de=k.project(y.LngLat.convert(g)),ge=ae.rotate(-w*Math.PI/180),Te=de.rotate(-w*Math.PI/180),Re=new y.Point(Math.max(ge.x,Te.x),Math.max(ge.y,Te.y)),We=new y.Point(Math.min(ge.x,Te.x),Math.min(ge.y,Te.y)),Ae=Re.sub(We),$e=(k.width-(X.left+X.right+C.padding.left+C.padding.right))/Ae.x,ot=(k.height-(X.top+X.bottom+C.padding.top+C.padding.bottom))/Ae.y;if(!(ot<0||$e<0)){var At=Math.min(k.scaleZoom(k.scale*Math.min($e,ot)),C.maxZoom),Gt=typeof C.offset.x=="number"?new y.Point(C.offset.x,C.offset.y):y.Point.convert(C.offset),Bt=new y.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(w*Math.PI/180),Ut=Gt.add(Bt).mult(k.scale/k.zoomScale(At));return{center:k.unproject(ae.add(de).div(2).sub(Ut)),zoom:At,bearing:w}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,g,w){return this._fitInternal(this.cameraForBounds(h,g),g,w)},d.prototype.fitScreenCoordinates=function(h,g,w,C,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(h)),this.transform.pointLocation(y.Point.convert(g)),w,C),C,T)},d.prototype._fitInternal=function(h,g,w){return h?(delete(g=y.extend(h,g)).padding,g.linear?this.easeTo(g,w):this.flyTo(g,w)):this},d.prototype.jumpTo=function(h,g){this.stop();var w=this.transform,C=!1,T=!1,L=!1;return"zoom"in h&&w.zoom!==+h.zoom&&(C=!0,w.zoom=+h.zoom),h.center!==void 0&&(w.center=y.LngLat.convert(h.center)),"bearing"in h&&w.bearing!==+h.bearing&&(T=!0,w.bearing=+h.bearing),"pitch"in h&&w.pitch!==+h.pitch&&(L=!0,w.pitch=+h.pitch),h.padding==null||w.isPaddingEqual(h.padding)||(w.padding=h.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),C&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),T&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),L&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},d.prototype.easeTo=function(h,g){var w=this;this._stop(!1,h.easeId),((h=y.extend({offset:[0,0],duration:500,easing:y.ease},h)).animate===!1||!h.essential&&y.browser.prefersReducedMotion)&&(h.duration=0);var C=this.transform,T=this.getZoom(),L=this.getBearing(),k=this.getPitch(),X=this.getPadding(),ae="zoom"in h?+h.zoom:T,de="bearing"in h?this._normalizeBearing(h.bearing,L):L,ge="pitch"in h?+h.pitch:k,Te="padding"in h?h.padding:C.padding,Re=y.Point.convert(h.offset),We=C.centerPoint.add(Re),Ae=C.pointLocation(We),$e=y.LngLat.convert(h.center||Ae);this._normalizeCenter($e);var ot,At,Gt=C.project(Ae),Bt=C.project($e).sub(Gt),Ut=C.zoomScale(ae-T);h.around&&(ot=y.LngLat.convert(h.around),At=C.locationPoint(ot));var hr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ae!==T,this._rotating=this._rotating||L!==de,this._pitching=this._pitching||ge!==k,this._padding=!C.isPaddingEqual(Te),this._easeId=h.easeId,this._prepareEase(g,h.noMoveStart,hr),this._ease(function(Zr){if(w._zooming&&(C.zoom=y.number(T,ae,Zr)),w._rotating&&(C.bearing=y.number(L,de,Zr)),w._pitching&&(C.pitch=y.number(k,ge,Zr)),w._padding&&(C.interpolatePadding(X,Te,Zr),We=C.centerPoint.add(Re)),ot)C.setLocationAtPoint(ot,At);else{var kr=C.zoomScale(C.zoom-T),rn=ae>T?Math.min(2,Ut):Math.max(.5,Ut),Cn=Math.pow(rn,1-Zr),Ln=C.unproject(Gt.add(Bt.mult(Zr*Cn)).mult(kr));C.setLocationAtPoint(C.renderWorldCopies?Ln.wrap():Ln,We)}w._fireMoveEvents(g)},function(Zr){w._afterEase(g,Zr)},h),this},d.prototype._prepareEase=function(h,g,w){w===void 0&&(w={}),this._moving=!0,g||w.moving||this.fire(new y.Event("movestart",h)),this._zooming&&!w.zooming&&this.fire(new y.Event("zoomstart",h)),this._rotating&&!w.rotating&&this.fire(new y.Event("rotatestart",h)),this._pitching&&!w.pitching&&this.fire(new y.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new y.Event("move",h)),this._zooming&&this.fire(new y.Event("zoom",h)),this._rotating&&this.fire(new y.Event("rotate",h)),this._pitching&&this.fire(new y.Event("pitch",h))},d.prototype._afterEase=function(h,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var w=this._zooming,C=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,w&&this.fire(new y.Event("zoomend",h)),C&&this.fire(new y.Event("rotateend",h)),T&&this.fire(new y.Event("pitchend",h)),this.fire(new y.Event("moveend",h))}},d.prototype.flyTo=function(h,g){var w=this;if(!h.essential&&y.browser.prefersReducedMotion){var C=y.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,g)}this.stop(),h=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},h);var T=this.transform,L=this.getZoom(),k=this.getBearing(),X=this.getPitch(),ae=this.getPadding(),de="zoom"in h?y.clamp(+h.zoom,T.minZoom,T.maxZoom):L,ge="bearing"in h?this._normalizeBearing(h.bearing,k):k,Te="pitch"in h?+h.pitch:X,Re="padding"in h?h.padding:T.padding,We=T.zoomScale(de-L),Ae=y.Point.convert(h.offset),$e=T.centerPoint.add(Ae),ot=T.pointLocation($e),At=y.LngLat.convert(h.center||ot);this._normalizeCenter(At);var Gt=T.project(ot),Bt=T.project(At).sub(Gt),Ut=h.curve,hr=Math.max(T.width,T.height),Zr=hr/We,kr=Bt.mag();if("minZoom"in h){var rn=y.clamp(Math.min(h.minZoom,L,de),T.minZoom,T.maxZoom),Cn=hr/T.zoomScale(rn-L);Ut=Math.sqrt(Cn/kr*2)}var Ln=Ut*Ut;function Mn(Hn){var Zn=(Zr*Zr-hr*hr+(Hn?-1:1)*Ln*Ln*kr*kr)/(2*(Hn?Zr:hr)*Ln*kr);return Math.log(Math.sqrt(Zn*Zn+1)-Zn)}function Ci(Hn){return(Math.exp(Hn)-Math.exp(-Hn))/2}function nn(Hn){return(Math.exp(Hn)+Math.exp(-Hn))/2}var $n=Mn(0),ii=function(Hn){return nn($n)/nn($n+Ut*Hn)},Yn=function(Hn){return hr*((nn($n)*(Ci(Zn=$n+Ut*Hn)/nn(Zn))-Ci($n))/Ln)/kr;var Zn},Wn=(Mn(1)-$n)/Ut;if(Math.abs(kr)<1e-6||!isFinite(Wn)){if(Math.abs(hr-Zr)<1e-6)return this.easeTo(h,g);var oi=Zr<hr?-1:1;Wn=Math.abs(Math.log(Zr/hr))/Ut,Yn=function(){return 0},ii=function(Hn){return Math.exp(oi*Ut*Hn)}}return h.duration="duration"in h?+h.duration:1e3*Wn/("screenSpeed"in h?+h.screenSpeed/Ut:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=k!==ge,this._pitching=Te!==X,this._padding=!T.isPaddingEqual(Re),this._prepareEase(g,!1),this._ease(function(Hn){var Zn=Hn*Wn,aa=1/ii(Zn);T.zoom=Hn===1?de:L+T.scaleZoom(aa),w._rotating&&(T.bearing=y.number(k,ge,Hn)),w._pitching&&(T.pitch=y.number(X,Te,Hn)),w._padding&&(T.interpolatePadding(ae,Re,Hn),$e=T.centerPoint.add(Ae));var ga=Hn===1?At:T.unproject(Gt.add(Bt.mult(Yn(Zn))).mult(aa));T.setLocationAtPoint(T.renderWorldCopies?ga.wrap():ga,$e),w._fireMoveEvents(g)},function(){return w._afterEase(g)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var w=this._onEaseEnd;delete this._onEaseEnd,w.call(this,g)}if(!h){var C=this.handlers;C&&C.stop(!1)}return this},d.prototype._ease=function(h,g,w){w.animate===!1||w.duration===0?(h(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=w,this._onEaseFrame=h,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,g){h=y.wrap(h,-180,180);var w=Math.abs(h-g);return Math.abs(h-360-g)<w&&(h-=360),Math.abs(h+360-g)<w&&(h+=360),h},d.prototype._normalizeCenter=function(h){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var w=h.lng-g.center.lng;h.lng+=w>180?-360:w<-180?360:0}},d}(y.Evented),Io=function(f){f===void 0&&(f={}),this.options=f,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Io.prototype.getDefaultPosition=function(){return"bottom-right"},Io.prototype.onAdd=function(f){var d=this.options&&this.options.compact;return this._map=f,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Io.prototype.onRemove=function(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Io.prototype._setElementTitle=function(f,d){var h=this._map._getUIString("AttributionControl."+d);f.title=h,f.setAttribute("aria-label",h)},Io.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Io.prototype._updateEditLink=function(){var f=this._editLink;f||(f=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(f){var h=d.reduce(function(g,w,C){return w.value&&(g+=w.key+"="+w.value+(C<d.length-1?"&":"")),g},"?");f.href=y.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),f.rel="noopener nofollow",this._setElementTitle(f,"MapFeedback")}},Io.prototype._updateData=function(f){!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Io.prototype._updateAttributions=function(){if(this._map.style){var f=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?f=f.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&f.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var g in h){var w=h[g];if(w.used){var C=w.getSource();C.attribution&&f.indexOf(C.attribution)<0&&f.push(C.attribution)}}f.sort(function(L,k){return L.length-k.length});var T=(f=f.filter(function(L,k){for(var X=k+1;X<f.length;X++)if(f[X].indexOf(L)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,f.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Io.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Wa=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};Wa.prototype.onAdd=function(f){this._map=f,this._container=U.create("div","mapboxgl-ctrl");var d=U.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Wa.prototype.onRemove=function(){U.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Wa.prototype.getDefaultPosition=function(){return"bottom-left"},Wa.prototype._updateLogo=function(f){f&&f.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Wa.prototype._logoRequired=function(){if(this._map.style){var f=this._map.style.sourceCaches;for(var d in f)if(f[d].getSource().mapbox_logo)return!0;return!1}},Wa.prototype._updateCompact=function(){var f=this._container.children;if(f.length){var d=f[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var bo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};bo.prototype.add=function(f){var d=++this._id;return this._queue.push({callback:f,id:d,cancelled:!1}),d},bo.prototype.remove=function(f){for(var d=this._currentlyRunning,h=0,g=d?this._queue.concat(d):this._queue;h<g.length;h+=1){var w=g[h];if(w.id===f)return void(w.cancelled=!0)}},bo.prototype.run=function(f){f===void 0&&(f=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,g=d;h<g.length;h+=1){var w=g[h];if(!w.cancelled&&(w.callback(f),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},bo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ws={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},fu=y.window.HTMLImageElement,Yl=y.window.HTMLElement,Oi=y.window.ImageBitmap,ra={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Bf=function(f){function d(g){var w=this;if((g=y.extend({},ra,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new mi(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(f.call(this,C,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new bo,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},Ws,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof Yl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return w._update(!1)}),this.on("moveend",function(){return w._update(!1)}),this.on("zoom",function(){return w._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new dn(this,g),this._hash=g.hash&&new ys(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Io({customAttribution:g.customAttribution})),this.addControl(new Wa,g.logoPosition),this.on("style.load",function(){w.transform.unmodified&&w.jumpTo(w.style.stylesheet)}),this.on("data",function(T){w._update(T.dataType==="style"),w.fire(new y.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){w.fire(new y.Event(T.dataType+"dataloading",T))})}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(g,w){if(w===void 0&&(w=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=g.onAdd(this);this._controls.push(g);var T=this._controlPositions[w];return w.indexOf("bottom")!==-1?T.insertBefore(C,T.firstChild):T.appendChild(C),this},d.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var w=this._controls.indexOf(g);return w>-1&&this._controls.splice(w,1),g.onRemove(this),this},d.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},d.prototype.resize=function(g){var w=this._containerDimensions(),C=w[0],T=w[1];if(C===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(C,T),this.transform.resize(C,T),this.painter.resize(C,T);var L=!this._moving;return L&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),L&&this.fire(new y.Event("moveend",g)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},d.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},d.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},d.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(g,w,C){var T,L=this;if(g==="mouseenter"||g==="mouseover"){var k=!1;return{layer:w,listener:C,delegates:{mousemove:function(ae){var de=L.getLayer(w)?L.queryRenderedFeatures(ae.point,{layers:[w]}):[];de.length?k||(k=!0,C.call(L,new Ma(g,L,ae.originalEvent,{features:de}))):k=!1},mouseout:function(){k=!1}}}}if(g==="mouseleave"||g==="mouseout"){var X=!1;return{layer:w,listener:C,delegates:{mousemove:function(ae){(L.getLayer(w)?L.queryRenderedFeatures(ae.point,{layers:[w]}):[]).length?X=!0:X&&(X=!1,C.call(L,new Ma(g,L,ae.originalEvent)))},mouseout:function(ae){X&&(X=!1,C.call(L,new Ma(g,L,ae.originalEvent)))}}}}return{layer:w,listener:C,delegates:(T={},T[g]=function(ae){var de=L.getLayer(w)?L.queryRenderedFeatures(ae.point,{layers:[w]}):[];de.length&&(ae.features=de,C.call(L,ae),delete ae.features)},T)}},d.prototype.on=function(g,w,C){if(C===void 0)return f.prototype.on.call(this,g,w);var T=this._createDelegatedListener(g,w,C);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(T),T.delegates)this.on(L,T.delegates[L]);return this},d.prototype.once=function(g,w,C){if(C===void 0)return f.prototype.once.call(this,g,w);var T=this._createDelegatedListener(g,w,C);for(var L in T.delegates)this.once(L,T.delegates[L]);return this},d.prototype.off=function(g,w,C){var T=this;return C===void 0?f.prototype.off.call(this,g,w):(this._delegatedListeners&&this._delegatedListeners[g]&&function(L){for(var k=L[g],X=0;X<k.length;X++){var ae=k[X];if(ae.layer===w&&ae.listener===C){for(var de in ae.delegates)T.off(de,ae.delegates[de]);return k.splice(X,1),T}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(g,w){if(!this.style)return[];var C;if(w!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(w=g,g=void 0),w=w||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")C=[y.Point.convert(g)];else{var T=y.Point.convert(g[0]),L=y.Point.convert(g[1]);C=[T,new y.Point(L.x,T.y),L,new y.Point(T.x,L.y),T]}return this.style.queryRenderedFeatures(C,w,this.transform)},d.prototype.querySourceFeatures=function(g,w){return this.style.querySourceFeatures(g,w)},d.prototype.setStyle=function(g,w){return(w=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},w)).diff!==!1&&w.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,w),this):(this._localIdeographFontFamily=w.localIdeographFontFamily,this._updateStyle(g,w))},d.prototype._getUIString=function(g){var w=this._locale[g];if(w==null)throw new Error("Missing UI string '"+g+"'");return w},d.prototype._updateStyle=function(g,w){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Jo(this,w||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Jo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(g,w){var C=this;if(typeof g=="string"){var T=this._requestManager.normalizeStyleURL(g),L=this._requestManager.transformRequest(T,y.ResourceType.Style);y.getJSON(L,function(k,X){k?C.fire(new y.ErrorEvent(k)):X&&C._updateDiff(X,w)})}else typeof g=="object"&&this._updateDiff(g,w)},d.prototype._updateDiff=function(g,w){try{this.style.setState(g)&&this._update(!0)}catch(C){y.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(g,w)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(g,w){return this._lazyInitEmptyStyle(),this.style.addSource(g,w),this._update(!0)},d.prototype.isSourceLoaded=function(g){var w=this.style&&this.style.sourceCaches[g];if(w!==void 0)return w.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},d.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var w in g){var C=g[w]._tiles;for(var T in C){var L=C[T];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(g,w,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,w,C)},d.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},d.prototype.getSource=function(g){return this.style.getSource(g)},d.prototype.addImage=function(g,w,C){C===void 0&&(C={});var T=C.pixelRatio;T===void 0&&(T=1);var L=C.sdf;L===void 0&&(L=!1);var k=C.stretchX,X=C.stretchY,ae=C.content;if(this._lazyInitEmptyStyle(),w instanceof fu||Oi&&w instanceof Oi){var de=y.browser.getImageData(w);this.style.addImage(g,{data:new y.RGBAImage({width:de.width,height:de.height},de.data),pixelRatio:T,stretchX:k,stretchY:X,content:ae,sdf:L,version:0})}else{if(w.width===void 0||w.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ge=w;this.style.addImage(g,{data:new y.RGBAImage({width:w.width,height:w.height},new Uint8Array(w.data)),pixelRatio:T,stretchX:k,stretchY:X,content:ae,sdf:L,version:0,userImage:ge}),ge.onAdd&&ge.onAdd(this,g)}},d.prototype.updateImage=function(g,w){var C=this.style.getImage(g);if(!C)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=w instanceof fu||Oi&&w instanceof Oi?y.browser.getImageData(w):w,L=T.width,k=T.height,X=T.data;return L===void 0||k===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==C.data.width||k!==C.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace(X,!(w instanceof fu||Oi&&w instanceof Oi)),void this.style.updateImage(g,C))},d.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(g){this.style.removeImage(g)},d.prototype.loadImage=function(g,w){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),w)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(g,w){return this._lazyInitEmptyStyle(),this.style.addLayer(g,w),this._update(!0)},d.prototype.moveLayer=function(g,w){return this.style.moveLayer(g,w),this._update(!0)},d.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},d.prototype.getLayer=function(g){return this.style.getLayer(g)},d.prototype.setLayerZoomRange=function(g,w,C){return this.style.setLayerZoomRange(g,w,C),this._update(!0)},d.prototype.setFilter=function(g,w,C){return C===void 0&&(C={}),this.style.setFilter(g,w,C),this._update(!0)},d.prototype.getFilter=function(g){return this.style.getFilter(g)},d.prototype.setPaintProperty=function(g,w,C,T){return T===void 0&&(T={}),this.style.setPaintProperty(g,w,C,T),this._update(!0)},d.prototype.getPaintProperty=function(g,w){return this.style.getPaintProperty(g,w)},d.prototype.setLayoutProperty=function(g,w,C,T){return T===void 0&&(T={}),this.style.setLayoutProperty(g,w,C,T),this._update(!0)},d.prototype.getLayoutProperty=function(g,w){return this.style.getLayoutProperty(g,w)},d.prototype.setLight=function(g,w){return w===void 0&&(w={}),this._lazyInitEmptyStyle(),this.style.setLight(g,w),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(g,w){return this.style.setFeatureState(g,w),this._update()},d.prototype.removeFeatureState=function(g,w){return this.style.removeFeatureState(g,w),this._update()},d.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var g=0,w=0;return this._container&&(g=this._container.clientWidth||400,w=this._container.clientHeight||300),[g,w]},d.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=U.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var w=this._canvasContainer=U.create("div","mapboxgl-canvas-container",g);this._interactive&&w.classList.add("mapboxgl-interactive"),this._canvas=U.create("canvas","mapboxgl-canvas",w),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var T=this._controlContainer=U.create("div","mapboxgl-control-container",g),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(k){L[k]=U.create("div","mapboxgl-ctrl-"+k,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(g,w){var C=y.browser.devicePixelRatio||1;this._canvas.width=C*g,this._canvas.height=C*w,this._canvas.style.width=g+"px",this._canvas.style.height=w+"px"},d.prototype._setupPainter=function(){var g=y.extend({},le.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),w=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);w?(this.painter=new Bi(w,this.transform),y.webpSupported.testSupport(w)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},d.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},d.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},d.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},d.prototype._render=function(g){var w,C=this,T=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(w=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,w),T=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var k=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var X=this.transform.zoom,ae=y.browser.now();this.style.zoomHistory.update(X,ae);var de=new y.EvaluationParameters(X,{now:ae,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ge=de.crossFadingFactor();ge===1&&ge===this._crossFadingFactor||(k=!0,this._crossFadingFactor=ge),this.style.update(de)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||k)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Te=y.browser.now()-T;L.endQueryEXT(L.TIME_ELAPSED_EXT,w),setTimeout(function(){var Ae=L.getQueryObjectEXT(w,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(w),C.fire(new y.Event("gpu-timing-frame",{cpuTime:Te,gpuTime:Ae}))},50)}if(this.listens("gpu-timing-layer")){var Re=this.painter.collectGpuTimers();setTimeout(function(){var Ae=C.painter.queryGpuTimers(Re);C.fire(new y.Event("gpu-timing-layer",{layerTimes:Ae}))},50)}var We=this._sourcesDirty||this._styleDirty||this._placementDirty;return We||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||We||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,w=this._controls;g<w.length;g+=1)w[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),Xu(this._canvasContainer),Xu(this._controlContainer),Xu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},d.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(w){g._frame=null,g._render(w)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(g){this._vertices=g,this._update()},d.prototype._setCacheLimits=function(g,w){y.setCacheLimits(g,w)},h.version.get=function(){return y.version},Object.defineProperties(d.prototype,h),d}(Yu);function Xu(f){f.parentNode&&f.parentNode.removeChild(f)}var zf={showCompass:!0,showZoom:!0,visualizePitch:!1},Tu=function(f){var d=this;this.options=y.extend({},zf,f),this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return d._map.zoomIn({},{originalEvent:h})}),U.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return d._map.zoomOut({},{originalEvent:h})}),U.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:h}):d._map.resetNorth({},{originalEvent:h})}),this._compassIcon=U.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Tu.prototype._updateZoomButtons=function(){var f=this._map.getZoom(),d=f===this._map.getMaxZoom(),h=f===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},Tu.prototype._rotateCompassArrow=function(){var f=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=f},Tu.prototype.onAdd=function(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qo(this._map,this._compass,this.options.visualizePitch)),this._container},Tu.prototype.onRemove=function(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Tu.prototype._createButton=function(f,d){var h=U.create("button",f,this._container);return h.type="button",h.addEventListener("click",d),h},Tu.prototype._setButtonTitle=function(f,d){var h=this._map._getUIString("NavigationControl."+d);f.title=h,f.setAttribute("aria-label",h)};var Qo=function(f,d,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new _c({clickTolerance:f.dragRotate._mouseRotate._clickTolerance}),this.map=f,h&&(this.mousePitch=new lu({clickTolerance:f.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),U.addEventListener(d,"mousedown",this.mousedown),U.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(d,"touchmove",this.touchmove),U.addEventListener(d,"touchend",this.touchend),U.addEventListener(d,"touchcancel",this.reset)};function Sc(f,d,h){if(f=new y.LngLat(f.lng,f.lat),d){var g=new y.LngLat(f.lng-360,f.lat),w=new y.LngLat(f.lng+360,f.lat),C=h.locationPoint(f).distSqr(d);h.locationPoint(g).distSqr(d)<C?f=g:h.locationPoint(w).distSqr(d)<C&&(f=w)}for(;Math.abs(f.lng-h.center.lng)>180;){var T=h.locationPoint(f);if(T.x>=0&&T.y>=0&&T.x<=h.width&&T.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}Qo.prototype.down=function(f,d){this.mouseRotate.mousedown(f,d),this.mousePitch&&this.mousePitch.mousedown(f,d),U.disableDrag()},Qo.prototype.move=function(f,d){var h=this.map,g=this.mouseRotate.mousemoveWindow(f,d);if(g&&g.bearingDelta&&h.setBearing(h.getBearing()+g.bearingDelta),this.mousePitch){var w=this.mousePitch.mousemoveWindow(f,d);w&&w.pitchDelta&&h.setPitch(h.getPitch()+w.pitchDelta)}},Qo.prototype.off=function(){var f=this.element;U.removeEventListener(f,"mousedown",this.mousedown),U.removeEventListener(f,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(f,"touchmove",this.touchmove),U.removeEventListener(f,"touchend",this.touchend),U.removeEventListener(f,"touchcancel",this.reset),this.offTemp()},Qo.prototype.offTemp=function(){U.enableDrag(),U.removeEventListener(y.window,"mousemove",this.mousemove),U.removeEventListener(y.window,"mouseup",this.mouseup)},Qo.prototype.mousedown=function(f){this.down(y.extend({},f,{ctrlKey:!0,preventDefault:function(){return f.preventDefault()}}),U.mousePos(this.element,f)),U.addEventListener(y.window,"mousemove",this.mousemove),U.addEventListener(y.window,"mouseup",this.mouseup)},Qo.prototype.mousemove=function(f){this.move(f,U.mousePos(this.element,f))},Qo.prototype.mouseup=function(f){this.mouseRotate.mouseupWindow(f),this.mousePitch&&this.mousePitch.mouseupWindow(f),this.offTemp()},Qo.prototype.touchstart=function(f){f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,f.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return f.preventDefault()}},this._startPos))},Qo.prototype.touchmove=function(f){f.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,f.targetTouches)[0],this.move({preventDefault:function(){return f.preventDefault()}},this._lastPos))},Qo.prototype.touchend=function(f){f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Qo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Mu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function _l(f,d,h){var g=f.classList;for(var w in Mu)g.remove("mapboxgl-"+h+"-anchor-"+w);g.add("mapboxgl-"+h+"-anchor-"+d)}var Xl,ql=function(f){function d(h,g){if(f.call(this),(h instanceof y.window.HTMLElement||g)&&(h=y.extend({element:h},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=y.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div"),this._element.setAttribute("aria-label","Map marker");var w=U.createNS("http://www.w3.org/2000/svg","svg");w.setAttributeNS(null,"display","block"),w.setAttributeNS(null,"height","41px"),w.setAttributeNS(null,"width","27px"),w.setAttributeNS(null,"viewBox","0 0 27 41");var C=U.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var T=U.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var L=U.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var k=0,X=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];k<X.length;k+=1){var ae=X[k],de=U.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",ae.rx),de.setAttributeNS(null,"ry",ae.ry),L.appendChild(de)}var ge=U.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"fill",this._color);var Te=U.createNS("http://www.w3.org/2000/svg","path");Te.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ge.appendChild(Te);var Re=U.createNS("http://www.w3.org/2000/svg","g");Re.setAttributeNS(null,"opacity","0.25"),Re.setAttributeNS(null,"fill","#000000");var We=U.createNS("http://www.w3.org/2000/svg","path");We.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Re.appendChild(We);var Ae=U.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");var $e=U.createNS("http://www.w3.org/2000/svg","g");$e.setAttributeNS(null,"transform","translate(8.0, 8.0)");var ot=U.createNS("http://www.w3.org/2000/svg","circle");ot.setAttributeNS(null,"fill","#000000"),ot.setAttributeNS(null,"opacity","0.25"),ot.setAttributeNS(null,"cx","5.5"),ot.setAttributeNS(null,"cy","5.5"),ot.setAttributeNS(null,"r","5.4999962");var At=U.createNS("http://www.w3.org/2000/svg","circle");At.setAttributeNS(null,"fill","#FFFFFF"),At.setAttributeNS(null,"cx","5.5"),At.setAttributeNS(null,"cy","5.5"),At.setAttributeNS(null,"r","5.4999962"),$e.appendChild(ot),$e.appendChild(At),T.appendChild(L),T.appendChild(ge),T.appendChild(Re),T.appendChild(Ae),T.appendChild($e),w.appendChild(T),w.setAttributeNS(null,"height",41*this._scale+"px"),w.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(w),this._offset=y.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Gt){Gt.preventDefault()}),this._element.addEventListener("mousedown",function(Gt){Gt.preventDefault()}),_l(this._element,this._anchor,"marker"),this._popup=null}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var g=h.code,w=h.charCode||h.keyCode;g!=="Space"&&g!=="Enter"&&w!==32&&w!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var g=h.originalEvent.target,w=this._element;this._popup&&(g===w||w.contains(g))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Sc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,Mu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+w+" "+g)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=y.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(y.Evented),rf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},wc=0,qu=!1,Ec=function(f){function d(h){f.call(this),this.options=y.extend({},rf,h),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){var g;return this._map=h,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Xl!==void 0?g(Xl):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(w){g(Xl=w.state!=="denied")}):g(Xl=!!y.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,wc=0,qu=!1},d.prototype._isOutOfMapMaxBounds=function(h){var g=this._map.getMaxBounds(),w=h.coords;return g&&(w.longitude<g.getWest()||w.longitude>g.getEast()||w.latitude<g.getSouth()||w.latitude>g.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude),w=h.coords.accuracy,C=this._map.getBearing(),T=y.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(w),T,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,g=this._map.unproject([0,h]),w=this._map.unproject([1,h]),C=g.distanceTo(w),T=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&qu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var g=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=U.create("button","mapboxgl-ctrl-geolocate",this._container),U.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var w=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new ql(this._dotElement),this._circleElement=U.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ql({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||g._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":wc--,qu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++wc>1?(h={maximumAge:6e5,timeout:0},qu=!0):(h=this.options.positionOptions,qu=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(y.Evented),Ku={maxWidth:100,unit:"metric"},Ju=function(f){this.options=y.extend({},Ku,f),y.bindAll(["_onMove","setUnit"],this)};function Ac(f,d,h){var g=h&&h.maxWidth||100,w=f._container.clientHeight/2,C=f.unproject([0,w]),T=f.unproject([g,w]),L=C.distanceTo(T);if(h&&h.unit==="imperial"){var k=3.2808*L;k>5280?$s(d,g,k/5280,f._getUIString("ScaleControl.Miles")):$s(d,g,k,f._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?$s(d,g,L/1852,f._getUIString("ScaleControl.NauticalMiles")):L>=1e3?$s(d,g,L/1e3,f._getUIString("ScaleControl.Kilometers")):$s(d,g,L,f._getUIString("ScaleControl.Meters"))}function $s(f,d,h,g){var w,C,T,L=(w=h,(C=Math.pow(10,(""+Math.floor(w)).length-1))*(T=(T=w/C)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(k){var X=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*X)/X}(T)));f.style.width=d*(L/h)+"px",f.innerHTML=L+"&nbsp;"+g}Ju.prototype.getDefaultPosition=function(){return"bottom-left"},Ju.prototype._onMove=function(){Ac(this._map,this._container,this.options)},Ju.prototype.onAdd=function(f){return this._map=f,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Ju.prototype.onRemove=function(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Ju.prototype.setUnit=function(f){this.options.unit=f,Ac(this._map,this._container,this.options)};var Os=function(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof y.window.HTMLElement?this._container=f.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};Os.prototype.onAdd=function(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Os.prototype.onRemove=function(){U.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Os.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},Os.prototype._setupUI=function(){var f=this._fullscreenButton=U.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Os.prototype._updateTitle=function(){var f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f},Os.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Os.prototype._isFullscreen=function(){return this._fullscreen},Os.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Os.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var nf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},af=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Nf=function(f){function d(h){f.call(this),this.options=y.extend(Object.create(nf),h),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(y.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var g,w=y.window.document.createDocumentFragment(),C=y.window.document.createElement("body");for(C.innerHTML=h;g=C.firstChild;)w.appendChild(g);return this.setDOMContent(w)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=U.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=U.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=U.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(de){return g._container.classList.add(de)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Sc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var w=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),C=this.options.anchor,T=function de(ge){if(ge){if(typeof ge=="number"){var Te=Math.round(Math.sqrt(.5*Math.pow(ge,2)));return{center:new y.Point(0,0),top:new y.Point(0,ge),"top-left":new y.Point(Te,Te),"top-right":new y.Point(-Te,Te),bottom:new y.Point(0,-ge),"bottom-left":new y.Point(Te,-Te),"bottom-right":new y.Point(-Te,-Te),left:new y.Point(ge,0),right:new y.Point(-ge,0)}}if(ge instanceof y.Point||Array.isArray(ge)){var Re=y.Point.convert(ge);return{center:Re,top:Re,"top-left":Re,"top-right":Re,bottom:Re,"bottom-left":Re,"bottom-right":Re,left:Re,right:Re}}return{center:y.Point.convert(ge.center||[0,0]),top:y.Point.convert(ge.top||[0,0]),"top-left":y.Point.convert(ge["top-left"]||[0,0]),"top-right":y.Point.convert(ge["top-right"]||[0,0]),bottom:y.Point.convert(ge.bottom||[0,0]),"bottom-left":y.Point.convert(ge["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(ge["bottom-right"]||[0,0]),left:y.Point.convert(ge.left||[0,0]),right:y.Point.convert(ge.right||[0,0])}}return de(new y.Point(0,0))}(this.options.offset);if(!C){var L,k=this._container.offsetWidth,X=this._container.offsetHeight;L=w.y+T.bottom.y<X?["top"]:w.y>this._map.transform.height-X?["bottom"]:[],w.x<k/2?L.push("left"):w.x>this._map.transform.width-k/2&&L.push("right"),C=L.length===0?"bottom":L.join("-")}var ae=w.add(T[C]).round();U.setTransform(this._container,Mu[C]+" translate("+ae.x+"px,"+ae.y+"px)"),_l(this._container,C,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(af);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(y.Evented),of={version:y.version,supported:le,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:Bf,NavigationControl:Tu,GeolocateControl:Ec,AttributionControl:Io,ScaleControl:Ju,FullscreenControl:Os,Popup:Nf,Marker:ql,Style:Jo,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){Qt().acquire(Rt)},clearPrewarmedResources:function(){var f=mn;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Rt),mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(f){y.config.ACCESS_TOKEN=f},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(f){y.config.API_URL=f},get workerCount(){return mr.workerCount},set workerCount(f){mr.workerCount=f},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){y.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage:function(f){y.clearTileCache(f)},workerUrl:""};return of}),ye})},3614:function(Sr,te,N){"use strict";Sr.exports=ee;var ye=N(80645);function ee(J){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(J)?J:new Uint8Array(J||0),this.pos=0,this.type=0,this.length=this.buf.length}ee.Varint=0,ee.Fixed64=1,ee.Bytes=2,ee.Fixed32=5;var y=(1<<16)*(1<<16),le=1/y,U=12,ce=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");ee.prototype={destroy:function(){this.buf=null},readFields:function(J,Ie,V){for(V=V||this.length;this.pos<V;){var H=this.readVarint(),be=H>>3,tt=this.pos;this.type=H&7,J(be,Ie,this),this.pos===tt&&this.skip(H)}return Ie},readMessage:function(J,Ie){return this.readFields(J,Ie,this.readVarint()+this.pos)},readFixed32:function(){var J=mt(this.buf,this.pos);return this.pos+=4,J},readSFixed32:function(){var J=Lt(this.buf,this.pos);return this.pos+=4,J},readFixed64:function(){var J=mt(this.buf,this.pos)+mt(this.buf,this.pos+4)*y;return this.pos+=8,J},readSFixed64:function(){var J=mt(this.buf,this.pos)+Lt(this.buf,this.pos+4)*y;return this.pos+=8,J},readFloat:function(){var J=ye.read(this.buf,this.pos,!0,23,4);return this.pos+=4,J},readDouble:function(){var J=ye.read(this.buf,this.pos,!0,52,8);return this.pos+=8,J},readVarint:function(J){var Ie=this.buf,V,H;return H=Ie[this.pos++],V=H&127,H<128||(H=Ie[this.pos++],V|=(H&127)<<7,H<128)||(H=Ie[this.pos++],V|=(H&127)<<14,H<128)||(H=Ie[this.pos++],V|=(H&127)<<21,H<128)?V:(H=Ie[this.pos],V|=(H&15)<<28,oe(V,J,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var J=this.readVarint();return J%2==1?(J+1)/-2:J/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var J=this.readVarint()+this.pos,Ie=this.pos;return this.pos=J,J-Ie>=U&&ce?Xt(this.buf,Ie,J):lt(this.buf,Ie,J)},readBytes:function(){var J=this.readVarint()+this.pos,Ie=this.buf.subarray(this.pos,J);return this.pos=J,Ie},readPackedVarint:function(J,Ie){if(this.type!==ee.Bytes)return J.push(this.readVarint(Ie));var V=Ue(this);for(J=J||[];this.pos<V;)J.push(this.readVarint(Ie));return J},readPackedSVarint:function(J){if(this.type!==ee.Bytes)return J.push(this.readSVarint());var Ie=Ue(this);for(J=J||[];this.pos<Ie;)J.push(this.readSVarint());return J},readPackedBoolean:function(J){if(this.type!==ee.Bytes)return J.push(this.readBoolean());var Ie=Ue(this);for(J=J||[];this.pos<Ie;)J.push(this.readBoolean());return J},readPackedFloat:function(J){if(this.type!==ee.Bytes)return J.push(this.readFloat());var Ie=Ue(this);for(J=J||[];this.pos<Ie;)J.push(this.readFloat());return J},readPackedDouble:function(J){if(this.type!==ee.Bytes)return J.push(this.readDouble());var Ie=Ue(this);for(J=J||[];this.pos<Ie;)J.push(this.readDouble());return J},readPackedFixed32:function(J){if(this.type!==ee.Bytes)return J.push(this.readFixed32());var Ie=Ue(this);for(J=J||[];this.pos<Ie;)J.push(this.readFixed32());return J},readPackedSFixed32:function(J){if(this.type!==ee.Bytes)return J.push(this.readSFixed32());var Ie=Ue(this);for(J=J||[];this.pos<Ie;)J.push(this.readSFixed32());return J},readPackedFixed64:function(J){if(this.type!==ee.Bytes)return J.push(this.readFixed64());var Ie=Ue(this);for(J=J||[];this.pos<Ie;)J.push(this.readFixed64());return J},readPackedSFixed64:function(J){if(this.type!==ee.Bytes)return J.push(this.readSFixed64());var Ie=Ue(this);for(J=J||[];this.pos<Ie;)J.push(this.readSFixed64());return J},skip:function(J){var Ie=J&7;if(Ie===ee.Varint)for(;this.buf[this.pos++]>127;);else if(Ie===ee.Bytes)this.pos=this.readVarint()+this.pos;else if(Ie===ee.Fixed32)this.pos+=4;else if(Ie===ee.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Ie)},writeTag:function(J,Ie){this.writeVarint(J<<3|Ie)},realloc:function(J){for(var Ie=this.length||16;Ie<this.pos+J;)Ie*=2;if(Ie!==this.length){var V=new Uint8Array(Ie);V.set(this.buf),this.buf=V,this.length=Ie}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(J){this.realloc(4),nt(this.buf,J,this.pos),this.pos+=4},writeSFixed32:function(J){this.realloc(4),nt(this.buf,J,this.pos),this.pos+=4},writeFixed64:function(J){this.realloc(8),nt(this.buf,J&-1,this.pos),nt(this.buf,Math.floor(J*le),this.pos+4),this.pos+=8},writeSFixed64:function(J){this.realloc(8),nt(this.buf,J&-1,this.pos),nt(this.buf,Math.floor(J*le),this.pos+4),this.pos+=8},writeVarint:function(J){if(J=+J||0,J>268435455||J<0){ze(J,this);return}this.realloc(4),this.buf[this.pos++]=J&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=(J>>>=7)&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=(J>>>=7)&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=J>>>7&127)))},writeSVarint:function(J){this.writeVarint(J<0?-J*2-1:J*2)},writeBoolean:function(J){this.writeVarint(Boolean(J))},writeString:function(J){J=String(J),this.realloc(J.length*4),this.pos++;var Ie=this.pos;this.pos=_r(this.buf,J,this.pos);var V=this.pos-Ie;V>=128&&Ct(Ie,V,this),this.pos=Ie-1,this.writeVarint(V),this.pos+=V},writeFloat:function(J){this.realloc(4),ye.write(this.buf,J,this.pos,!0,23,4),this.pos+=4},writeDouble:function(J){this.realloc(8),ye.write(this.buf,J,this.pos,!0,52,8),this.pos+=8},writeBytes:function(J){var Ie=J.length;this.writeVarint(Ie),this.realloc(Ie);for(var V=0;V<Ie;V++)this.buf[this.pos++]=J[V]},writeRawMessage:function(J,Ie){this.pos++;var V=this.pos;J(Ie,this);var H=this.pos-V;H>=128&&Ct(V,H,this),this.pos=V-1,this.writeVarint(H),this.pos+=H},writeMessage:function(J,Ie,V){this.writeTag(J,ee.Bytes),this.writeRawMessage(Ie,V)},writePackedVarint:function(J,Ie){Ie.length&&this.writeMessage(J,Kt,Ie)},writePackedSVarint:function(J,Ie){Ie.length&&this.writeMessage(J,Yt,Ie)},writePackedBoolean:function(J,Ie){Ie.length&&this.writeMessage(J,bt,Ie)},writePackedFloat:function(J,Ie){Ie.length&&this.writeMessage(J,nr,Ie)},writePackedDouble:function(J,Ie){Ie.length&&this.writeMessage(J,Jt,Ie)},writePackedFixed32:function(J,Ie){Ie.length&&this.writeMessage(J,vt,Ie)},writePackedSFixed32:function(J,Ie){Ie.length&&this.writeMessage(J,Dr,Ie)},writePackedFixed64:function(J,Ie){Ie.length&&this.writeMessage(J,fr,Ie)},writePackedSFixed64:function(J,Ie){Ie.length&&this.writeMessage(J,sr,Ie)},writeBytesField:function(J,Ie){this.writeTag(J,ee.Bytes),this.writeBytes(Ie)},writeFixed32Field:function(J,Ie){this.writeTag(J,ee.Fixed32),this.writeFixed32(Ie)},writeSFixed32Field:function(J,Ie){this.writeTag(J,ee.Fixed32),this.writeSFixed32(Ie)},writeFixed64Field:function(J,Ie){this.writeTag(J,ee.Fixed64),this.writeFixed64(Ie)},writeSFixed64Field:function(J,Ie){this.writeTag(J,ee.Fixed64),this.writeSFixed64(Ie)},writeVarintField:function(J,Ie){this.writeTag(J,ee.Varint),this.writeVarint(Ie)},writeSVarintField:function(J,Ie){this.writeTag(J,ee.Varint),this.writeSVarint(Ie)},writeStringField:function(J,Ie){this.writeTag(J,ee.Bytes),this.writeString(Ie)},writeFloatField:function(J,Ie){this.writeTag(J,ee.Fixed32),this.writeFloat(Ie)},writeDoubleField:function(J,Ie){this.writeTag(J,ee.Fixed64),this.writeDouble(Ie)},writeBooleanField:function(J,Ie){this.writeVarintField(J,Boolean(Ie))}};function oe(J,Ie,V){var H=V.buf,be,tt;if(tt=H[V.pos++],be=(tt&112)>>4,tt<128||(tt=H[V.pos++],be|=(tt&127)<<3,tt<128)||(tt=H[V.pos++],be|=(tt&127)<<10,tt<128)||(tt=H[V.pos++],be|=(tt&127)<<17,tt<128)||(tt=H[V.pos++],be|=(tt&127)<<24,tt<128)||(tt=H[V.pos++],be|=(tt&1)<<31,tt<128))return se(J,be,Ie);throw new Error("Expected varint not more than 10 bytes")}function Ue(J){return J.type===ee.Bytes?J.readVarint()+J.pos:J.pos+1}function se(J,Ie,V){return V?Ie*4294967296+(J>>>0):(Ie>>>0)*4294967296+(J>>>0)}function ze(J,Ie){var V,H;if(J>=0?(V=J%4294967296|0,H=J/4294967296|0):(V=~(-J%4294967296),H=~(-J/4294967296),V^4294967295?V=V+1|0:(V=0,H=H+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ie.realloc(10),et(V,H,Ie),ut(H,Ie)}function et(J,Ie,V){V.buf[V.pos++]=J&127|128,J>>>=7,V.buf[V.pos++]=J&127|128,J>>>=7,V.buf[V.pos++]=J&127|128,J>>>=7,V.buf[V.pos++]=J&127|128,J>>>=7,V.buf[V.pos]=J&127}function ut(J,Ie){var V=(J&7)<<4;Ie.buf[Ie.pos++]|=V|((J>>>=3)?128:0),!!J&&(Ie.buf[Ie.pos++]=J&127|((J>>>=7)?128:0),!!J&&(Ie.buf[Ie.pos++]=J&127|((J>>>=7)?128:0),!!J&&(Ie.buf[Ie.pos++]=J&127|((J>>>=7)?128:0),!!J&&(Ie.buf[Ie.pos++]=J&127|((J>>>=7)?128:0),!!J&&(Ie.buf[Ie.pos++]=J&127)))))}function Ct(J,Ie,V){var H=Ie<=16383?1:Ie<=2097151?2:Ie<=268435455?3:Math.floor(Math.log(Ie)/(Math.LN2*7));V.realloc(H);for(var be=V.pos-1;be>=J;be--)V.buf[be+H]=V.buf[be]}function Kt(J,Ie){for(var V=0;V<J.length;V++)Ie.writeVarint(J[V])}function Yt(J,Ie){for(var V=0;V<J.length;V++)Ie.writeSVarint(J[V])}function nr(J,Ie){for(var V=0;V<J.length;V++)Ie.writeFloat(J[V])}function Jt(J,Ie){for(var V=0;V<J.length;V++)Ie.writeDouble(J[V])}function bt(J,Ie){for(var V=0;V<J.length;V++)Ie.writeBoolean(J[V])}function vt(J,Ie){for(var V=0;V<J.length;V++)Ie.writeFixed32(J[V])}function Dr(J,Ie){for(var V=0;V<J.length;V++)Ie.writeSFixed32(J[V])}function fr(J,Ie){for(var V=0;V<J.length;V++)Ie.writeFixed64(J[V])}function sr(J,Ie){for(var V=0;V<J.length;V++)Ie.writeSFixed64(J[V])}function mt(J,Ie){return(J[Ie]|J[Ie+1]<<8|J[Ie+2]<<16)+J[Ie+3]*16777216}function nt(J,Ie,V){J[V]=Ie,J[V+1]=Ie>>>8,J[V+2]=Ie>>>16,J[V+3]=Ie>>>24}function Lt(J,Ie){return(J[Ie]|J[Ie+1]<<8|J[Ie+2]<<16)+(J[Ie+3]<<24)}function lt(J,Ie,V){for(var H="",be=Ie;be<V;){var tt=J[be],ht=null,St=tt>239?4:tt>223?3:tt>191?2:1;if(be+St>V)break;var jt,tr,Hr;St===1?tt<128&&(ht=tt):St===2?(jt=J[be+1],(jt&192)==128&&(ht=(tt&31)<<6|jt&63,ht<=127&&(ht=null))):St===3?(jt=J[be+1],tr=J[be+2],(jt&192)==128&&(tr&192)==128&&(ht=(tt&15)<<12|(jt&63)<<6|tr&63,(ht<=2047||ht>=55296&&ht<=57343)&&(ht=null))):St===4&&(jt=J[be+1],tr=J[be+2],Hr=J[be+3],(jt&192)==128&&(tr&192)==128&&(Hr&192)==128&&(ht=(tt&15)<<18|(jt&63)<<12|(tr&63)<<6|Hr&63,(ht<=65535||ht>=1114112)&&(ht=null))),ht===null?(ht=65533,St=1):ht>65535&&(ht-=65536,H+=String.fromCharCode(ht>>>10&1023|55296),ht=56320|ht&1023),H+=String.fromCharCode(ht),be+=St}return H}function Xt(J,Ie,V){return ce.decode(J.subarray(Ie,V))}function _r(J,Ie,V){for(var H=0,be,tt;H<Ie.length;H++){if(be=Ie.charCodeAt(H),be>55295&&be<57344)if(tt)if(be<56320){J[V++]=239,J[V++]=191,J[V++]=189,tt=be;continue}else be=tt-55296<<10|be-56320|65536,tt=null;else{be>56319||H+1===Ie.length?(J[V++]=239,J[V++]=191,J[V++]=189):tt=be;continue}else tt&&(J[V++]=239,J[V++]=191,J[V++]=189,tt=null);be<128?J[V++]=be:(be<2048?J[V++]=be>>6|192:(be<65536?J[V++]=be>>12|224:(J[V++]=be>>18|240,J[V++]=be>>12&63|128),J[V++]=be>>6&63|128),J[V++]=be&63|128)}return V}},32676:function(Sr,te,N){var ye=N(34155);(function(ee,y){Sr.exports=y()})(this,function(){"use strict";function ee(Tt,R){if(!(Tt instanceof R))throw new TypeError("Cannot call a class as a function")}function y(Tt,R){for(var ne=0;ne<R.length;ne++){var fe=R[ne];fe.enumerable=fe.enumerable||!1,fe.configurable=!0,"value"in fe&&(fe.writable=!0),Object.defineProperty(Tt,fe.key,fe)}}function le(Tt,R,ne){return R&&y(Tt.prototype,R),ne&&y(Tt,ne),Tt}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var U=function(){function Tt(R,ne){this.next=null,this.key=R,this.data=ne,this.left=null,this.right=null}return Tt}();function ce(Tt,R){return Tt>R?1:Tt<R?-1:0}function oe(Tt,R,ne){for(var fe=new U(null,null),Fe=fe,ct=fe;;){var zt=ne(Tt,R.key);if(zt<0){if(R.left===null)break;if(ne(Tt,R.left.key)<0){var Er=R.left;if(R.left=Er.right,Er.right=R,R=Er,R.left===null)break}ct.left=R,ct=R,R=R.left}else if(zt>0){if(R.right===null)break;if(ne(Tt,R.right.key)>0){var Er=R.right;if(R.right=Er.left,Er.left=R,R=Er,R.right===null)break}Fe.right=R,Fe=R,R=R.right}else break}return Fe.right=R.left,ct.left=R.right,R.left=fe.right,R.right=fe.left,R}function Ue(Tt,R,ne,fe){var Fe=new U(Tt,R);if(ne===null)return Fe.left=Fe.right=null,Fe;ne=oe(Tt,ne,fe);var ct=fe(Tt,ne.key);return ct<0?(Fe.left=ne.left,Fe.right=ne,ne.left=null):ct>=0&&(Fe.right=ne.right,Fe.left=ne,ne.right=null),Fe}function se(Tt,R,ne){var fe=null,Fe=null;if(R){R=oe(Tt,R,ne);var ct=ne(R.key,Tt);ct===0?(fe=R.left,Fe=R.right):ct<0?(Fe=R.right,R.right=null,fe=R):(fe=R.left,R.left=null,Fe=R)}return{left:fe,right:Fe}}function ze(Tt,R,ne){return R===null?Tt:(Tt===null||(R=oe(Tt.key,R,ne),R.left=Tt),R)}function et(Tt,R,ne,fe,Fe){if(Tt){fe(""+R+(ne?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Fe(Tt)+`
`);var ct=R+(ne?"    ":"\u2502   ");Tt.left&&et(Tt.left,ct,!1,fe,Fe),Tt.right&&et(Tt.right,ct,!0,fe,Fe)}}var ut=function(){function Tt(R){R===void 0&&(R=ce),this._root=null,this._size=0,this._comparator=R}return Tt.prototype.insert=function(R,ne){return this._size++,this._root=Ue(R,ne,this._root,this._comparator)},Tt.prototype.add=function(R,ne){var fe=new U(R,ne);this._root===null&&(fe.left=fe.right=null,this._size++,this._root=fe);var Fe=this._comparator,ct=oe(R,this._root,Fe),zt=Fe(R,ct.key);return zt===0?this._root=ct:(zt<0?(fe.left=ct.left,fe.right=ct,ct.left=null):zt>0&&(fe.right=ct.right,fe.left=ct,ct.right=null),this._size++,this._root=fe),this._root},Tt.prototype.remove=function(R){this._root=this._remove(R,this._root,this._comparator)},Tt.prototype._remove=function(R,ne,fe){var Fe;if(ne===null)return null;ne=oe(R,ne,fe);var ct=fe(R,ne.key);return ct===0?(ne.left===null?Fe=ne.right:(Fe=oe(R,ne.left,fe),Fe.right=ne.right),this._size--,Fe):ne},Tt.prototype.pop=function(){var R=this._root;if(R){for(;R.left;)R=R.left;return this._root=oe(R.key,this._root,this._comparator),this._root=this._remove(R.key,this._root,this._comparator),{key:R.key,data:R.data}}return null},Tt.prototype.findStatic=function(R){for(var ne=this._root,fe=this._comparator;ne;){var Fe=fe(R,ne.key);if(Fe===0)return ne;Fe<0?ne=ne.left:ne=ne.right}return null},Tt.prototype.find=function(R){return this._root&&(this._root=oe(R,this._root,this._comparator),this._comparator(R,this._root.key)!==0)?null:this._root},Tt.prototype.contains=function(R){for(var ne=this._root,fe=this._comparator;ne;){var Fe=fe(R,ne.key);if(Fe===0)return!0;Fe<0?ne=ne.left:ne=ne.right}return!1},Tt.prototype.forEach=function(R,ne){for(var fe=this._root,Fe=[],ct=!1;!ct;)fe!==null?(Fe.push(fe),fe=fe.left):Fe.length!==0?(fe=Fe.pop(),R.call(ne,fe),fe=fe.right):ct=!0;return this},Tt.prototype.range=function(R,ne,fe,Fe){for(var ct=[],zt=this._comparator,Er=this._root,Ne;ct.length!==0||Er;)if(Er)ct.push(Er),Er=Er.left;else{if(Er=ct.pop(),Ne=zt(Er.key,ne),Ne>0)break;if(zt(Er.key,R)>=0&&fe.call(Fe,Er))return this;Er=Er.right}return this},Tt.prototype.keys=function(){var R=[];return this.forEach(function(ne){var fe=ne.key;return R.push(fe)}),R},Tt.prototype.values=function(){var R=[];return this.forEach(function(ne){var fe=ne.data;return R.push(fe)}),R},Tt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Tt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Tt.prototype.minNode=function(R){if(R===void 0&&(R=this._root),R)for(;R.left;)R=R.left;return R},Tt.prototype.maxNode=function(R){if(R===void 0&&(R=this._root),R)for(;R.right;)R=R.right;return R},Tt.prototype.at=function(R){for(var ne=this._root,fe=!1,Fe=0,ct=[];!fe;)if(ne)ct.push(ne),ne=ne.left;else if(ct.length>0){if(ne=ct.pop(),Fe===R)return ne;Fe++,ne=ne.right}else fe=!0;return null},Tt.prototype.next=function(R){var ne=this._root,fe=null;if(R.right){for(fe=R.right;fe.left;)fe=fe.left;return fe}for(var Fe=this._comparator;ne;){var ct=Fe(R.key,ne.key);if(ct===0)break;ct<0?(fe=ne,ne=ne.left):ne=ne.right}return fe},Tt.prototype.prev=function(R){var ne=this._root,fe=null;if(R.left!==null){for(fe=R.left;fe.right;)fe=fe.right;return fe}for(var Fe=this._comparator;ne;){var ct=Fe(R.key,ne.key);if(ct===0)break;ct<0?ne=ne.left:(fe=ne,ne=ne.right)}return fe},Tt.prototype.clear=function(){return this._root=null,this._size=0,this},Tt.prototype.toList=function(){return Yt(this._root)},Tt.prototype.load=function(R,ne,fe){ne===void 0&&(ne=[]),fe===void 0&&(fe=!1);var Fe=R.length,ct=this._comparator;if(fe&&bt(R,ne,0,Fe-1,ct),this._root===null)this._root=Ct(R,ne,0,Fe),this._size=Fe;else{var zt=Jt(this.toList(),Kt(R,ne),ct);Fe=this._size+Fe,this._root=nr({head:zt},0,Fe)}return this},Tt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Tt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Tt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Tt.prototype.toString=function(R){R===void 0&&(R=function(Fe){return String(Fe.key)});var ne=[];return et(this._root,"",!0,function(fe){return ne.push(fe)},R),ne.join("")},Tt.prototype.update=function(R,ne,fe){var Fe=this._comparator,ct=se(R,this._root,Fe),zt=ct.left,Er=ct.right;Fe(R,ne)<0?Er=Ue(ne,fe,Er,Fe):zt=Ue(ne,fe,zt,Fe),this._root=ze(zt,Er,Fe)},Tt.prototype.split=function(R){return se(R,this._root,this._comparator)},Tt}();function Ct(Tt,R,ne,fe){var Fe=fe-ne;if(Fe>0){var ct=ne+Math.floor(Fe/2),zt=Tt[ct],Er=R[ct],Ne=new U(zt,Er);return Ne.left=Ct(Tt,R,ne,ct),Ne.right=Ct(Tt,R,ct+1,fe),Ne}return null}function Kt(Tt,R){for(var ne=new U(null,null),fe=ne,Fe=0;Fe<Tt.length;Fe++)fe=fe.next=new U(Tt[Fe],R[Fe]);return fe.next=null,ne.next}function Yt(Tt){for(var R=Tt,ne=[],fe=!1,Fe=new U(null,null),ct=Fe;!fe;)R?(ne.push(R),R=R.left):ne.length>0?(R=ct=ct.next=ne.pop(),R=R.right):fe=!0;return ct.next=null,Fe.next}function nr(Tt,R,ne){var fe=ne-R;if(fe>0){var Fe=R+Math.floor(fe/2),ct=nr(Tt,R,Fe),zt=Tt.head;return zt.left=ct,Tt.head=Tt.head.next,zt.right=nr(Tt,Fe+1,ne),zt}return null}function Jt(Tt,R,ne){for(var fe=new U(null,null),Fe=fe,ct=Tt,zt=R;ct!==null&&zt!==null;)ne(ct.key,zt.key)<0?(Fe.next=ct,ct=ct.next):(Fe.next=zt,zt=zt.next),Fe=Fe.next;return ct!==null?Fe.next=ct:zt!==null&&(Fe.next=zt),fe.next}function bt(Tt,R,ne,fe,Fe){if(!(ne>=fe)){for(var ct=Tt[ne+fe>>1],zt=ne-1,Er=fe+1;;){do zt++;while(Fe(Tt[zt],ct)<0);do Er--;while(Fe(Tt[Er],ct)>0);if(zt>=Er)break;var Ne=Tt[zt];Tt[zt]=Tt[Er],Tt[Er]=Ne,Ne=R[zt],R[zt]=R[Er],R[Er]=Ne}bt(Tt,R,ne,Er,Fe),bt(Tt,R,Er+1,fe,Fe)}}var vt=function(R,ne){return R.ll.x<=ne.x&&ne.x<=R.ur.x&&R.ll.y<=ne.y&&ne.y<=R.ur.y},Dr=function(R,ne){if(ne.ur.x<R.ll.x||R.ur.x<ne.ll.x||ne.ur.y<R.ll.y||R.ur.y<ne.ll.y)return null;var fe=R.ll.x<ne.ll.x?ne.ll.x:R.ll.x,Fe=R.ur.x<ne.ur.x?R.ur.x:ne.ur.x,ct=R.ll.y<ne.ll.y?ne.ll.y:R.ll.y,zt=R.ur.y<ne.ur.y?R.ur.y:ne.ur.y;return{ll:{x:fe,y:ct},ur:{x:Fe,y:zt}}},fr=Number.EPSILON;fr===void 0&&(fr=Math.pow(2,-52));var sr=fr*fr,mt=function(R,ne){if(-fr<R&&R<fr&&-fr<ne&&ne<fr)return 0;var fe=R-ne;return fe*fe<sr*R*ne?0:R<ne?-1:1},nt=function(){function Tt(){ee(this,Tt),this.reset()}return le(Tt,[{key:"reset",value:function(){this.xRounder=new Lt,this.yRounder=new Lt}},{key:"round",value:function(ne,fe){return{x:this.xRounder.round(ne),y:this.yRounder.round(fe)}}}]),Tt}(),Lt=function(){function Tt(){ee(this,Tt),this.tree=new ut,this.round(0)}return le(Tt,[{key:"round",value:function(ne){var fe=this.tree.add(ne),Fe=this.tree.prev(fe);if(Fe!==null&&mt(fe.key,Fe.key)===0)return this.tree.remove(ne),Fe.key;var ct=this.tree.next(fe);return ct!==null&&mt(fe.key,ct.key)===0?(this.tree.remove(ne),ct.key):ne}}]),Tt}(),lt=new nt,Xt=function(R,ne){return R.x*ne.y-R.y*ne.x},_r=function(R,ne){return R.x*ne.x+R.y*ne.y},J=function(R,ne,fe){var Fe={x:ne.x-R.x,y:ne.y-R.y},ct={x:fe.x-R.x,y:fe.y-R.y},zt=Xt(Fe,ct);return mt(zt,0)},Ie=function(R){return Math.sqrt(_r(R,R))},V=function(R,ne,fe){var Fe={x:ne.x-R.x,y:ne.y-R.y},ct={x:fe.x-R.x,y:fe.y-R.y};return Xt(ct,Fe)/Ie(ct)/Ie(Fe)},H=function(R,ne,fe){var Fe={x:ne.x-R.x,y:ne.y-R.y},ct={x:fe.x-R.x,y:fe.y-R.y};return _r(ct,Fe)/Ie(ct)/Ie(Fe)},be=function(R,ne,fe){return ne.y===0?null:{x:R.x+ne.x/ne.y*(fe-R.y),y:fe}},tt=function(R,ne,fe){return ne.x===0?null:{x:fe,y:R.y+ne.y/ne.x*(fe-R.x)}},ht=function(R,ne,fe,Fe){if(ne.x===0)return tt(fe,Fe,R.x);if(Fe.x===0)return tt(R,ne,fe.x);if(ne.y===0)return be(fe,Fe,R.y);if(Fe.y===0)return be(R,ne,fe.y);var ct=Xt(ne,Fe);if(ct==0)return null;var zt={x:fe.x-R.x,y:fe.y-R.y},Er=Xt(zt,ne)/ct,Ne=Xt(zt,Fe)/ct,Et=R.x+Ne*ne.x,ir=fe.x+Er*Fe.x,xr=R.y+Ne*ne.y,Wr=fe.y+Er*Fe.y,yn=(Et+ir)/2,Sn=(xr+Wr)/2;return{x:yn,y:Sn}},St=function(){le(Tt,null,[{key:"compare",value:function(ne,fe){var Fe=Tt.comparePoints(ne.point,fe.point);return Fe!==0?Fe:(ne.point!==fe.point&&ne.link(fe),ne.isLeft!==fe.isLeft?ne.isLeft?1:-1:tr.compare(ne.segment,fe.segment))}},{key:"comparePoints",value:function(ne,fe){return ne.x<fe.x?-1:ne.x>fe.x?1:ne.y<fe.y?-1:ne.y>fe.y?1:0}}]);function Tt(R,ne){ee(this,Tt),R.events===void 0?R.events=[this]:R.events.push(this),this.point=R,this.isLeft=ne}return le(Tt,[{key:"link",value:function(ne){if(ne.point===this.point)throw new Error("Tried to link already linked events");for(var fe=ne.point.events,Fe=0,ct=fe.length;Fe<ct;Fe++){var zt=fe[Fe];this.point.events.push(zt),zt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ne=this.point.events.length,fe=0;fe<ne;fe++){var Fe=this.point.events[fe];if(Fe.segment.consumedBy===void 0)for(var ct=fe+1;ct<ne;ct++){var zt=this.point.events[ct];zt.consumedBy===void 0&&Fe.otherSE.point.events===zt.otherSE.point.events&&Fe.segment.consume(zt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ne=[],fe=0,Fe=this.point.events.length;fe<Fe;fe++){var ct=this.point.events[fe];ct!==this&&!ct.segment.ringOut&&ct.segment.isInResult()&&ne.push(ct)}return ne}},{key:"getLeftmostComparator",value:function(ne){var fe=this,Fe=new Map,ct=function(Er){var Ne=Er.otherSE;Fe.set(Er,{sine:V(fe.point,ne.point,Ne.point),cosine:H(fe.point,ne.point,Ne.point)})};return function(zt,Er){Fe.has(zt)||ct(zt),Fe.has(Er)||ct(Er);var Ne=Fe.get(zt),Et=Ne.sine,ir=Ne.cosine,xr=Fe.get(Er),Wr=xr.sine,yn=xr.cosine;return Et>=0&&Wr>=0?ir<yn?1:ir>yn?-1:0:Et<0&&Wr<0?ir<yn?-1:ir>yn?1:0:Wr<Et?-1:Wr>Et?1:0}}}]),Tt}(),jt=0,tr=function(){le(Tt,null,[{key:"compare",value:function(ne,fe){var Fe=ne.leftSE.point.x,ct=fe.leftSE.point.x,zt=ne.rightSE.point.x,Er=fe.rightSE.point.x;if(Er<Fe)return 1;if(zt<ct)return-1;var Ne=ne.leftSE.point.y,Et=fe.leftSE.point.y,ir=ne.rightSE.point.y,xr=fe.rightSE.point.y;if(Fe<ct){if(Et<Ne&&Et<ir)return 1;if(Et>Ne&&Et>ir)return-1;var Wr=ne.comparePoint(fe.leftSE.point);if(Wr<0)return 1;if(Wr>0)return-1;var yn=fe.comparePoint(ne.rightSE.point);return yn!==0?yn:-1}if(Fe>ct){if(Ne<Et&&Ne<xr)return-1;if(Ne>Et&&Ne>xr)return 1;var Sn=fe.comparePoint(ne.leftSE.point);if(Sn!==0)return Sn;var En=ne.comparePoint(fe.rightSE.point);return En<0?1:En>0?-1:1}if(Ne<Et)return-1;if(Ne>Et)return 1;if(zt<Er){var pn=fe.comparePoint(ne.rightSE.point);if(pn!==0)return pn}if(zt>Er){var Kn=ne.comparePoint(fe.rightSE.point);if(Kn<0)return 1;if(Kn>0)return-1}if(zt!==Er){var Nn=ir-Ne,Ji=zt-Fe,$i=xr-Et,go=Er-ct;if(Nn>Ji&&$i<go)return 1;if(Nn<Ji&&$i>go)return-1}return zt>Er?1:zt<Er||ir<xr?-1:ir>xr?1:ne.id<fe.id?-1:ne.id>fe.id?1:0}}]);function Tt(R,ne,fe,Fe){ee(this,Tt),this.id=++jt,this.leftSE=R,R.segment=this,R.otherSE=ne,this.rightSE=ne,ne.segment=this,ne.otherSE=R,this.rings=fe,this.windings=Fe}return le(Tt,[{key:"replaceRightSE",value:function(ne){this.rightSE=ne,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ne=this.leftSE.point.y,fe=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ne<fe?ne:fe},ur:{x:this.rightSE.point.x,y:ne>fe?ne:fe}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ne){return ne.x===this.leftSE.point.x&&ne.y===this.leftSE.point.y||ne.x===this.rightSE.point.x&&ne.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ne){if(this.isAnEndpoint(ne))return 0;var fe=this.leftSE.point,Fe=this.rightSE.point,ct=this.vector();if(fe.x===Fe.x)return ne.x===fe.x?0:ne.x<fe.x?1:-1;var zt=(ne.y-fe.y)/ct.y,Er=fe.x+zt*ct.x;if(ne.x===Er)return 0;var Ne=(ne.x-fe.x)/ct.x,Et=fe.y+Ne*ct.y;return ne.y===Et?0:ne.y<Et?-1:1}},{key:"getIntersection",value:function(ne){var fe=this.bbox(),Fe=ne.bbox(),ct=Dr(fe,Fe);if(ct===null)return null;var zt=this.leftSE.point,Er=this.rightSE.point,Ne=ne.leftSE.point,Et=ne.rightSE.point,ir=vt(fe,Ne)&&this.comparePoint(Ne)===0,xr=vt(Fe,zt)&&ne.comparePoint(zt)===0,Wr=vt(fe,Et)&&this.comparePoint(Et)===0,yn=vt(Fe,Er)&&ne.comparePoint(Er)===0;if(xr&&ir)return yn&&!Wr?Er:!yn&&Wr?Et:null;if(xr)return Wr&&zt.x===Et.x&&zt.y===Et.y?null:zt;if(ir)return yn&&Er.x===Ne.x&&Er.y===Ne.y?null:Ne;if(yn&&Wr)return null;if(yn)return Er;if(Wr)return Et;var Sn=ht(zt,this.vector(),Ne,ne.vector());return Sn===null||!vt(ct,Sn)?null:lt.round(Sn.x,Sn.y)}},{key:"split",value:function(ne){var fe=[],Fe=ne.events!==void 0,ct=new St(ne,!0),zt=new St(ne,!1),Er=this.rightSE;this.replaceRightSE(zt),fe.push(zt),fe.push(ct);var Ne=new Tt(ct,Er,this.rings.slice(),this.windings.slice());return St.comparePoints(Ne.leftSE.point,Ne.rightSE.point)>0&&Ne.swapEvents(),St.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Fe&&(ct.checkForConsuming(),zt.checkForConsuming()),fe}},{key:"swapEvents",value:function(){var ne=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ne,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var fe=0,Fe=this.windings.length;fe<Fe;fe++)this.windings[fe]*=-1}},{key:"consume",value:function(ne){for(var fe=this,Fe=ne;fe.consumedBy;)fe=fe.consumedBy;for(;Fe.consumedBy;)Fe=Fe.consumedBy;var ct=Tt.compare(fe,Fe);if(ct!==0){if(ct>0){var zt=fe;fe=Fe,Fe=zt}if(fe.prev===Fe){var Er=fe;fe=Fe,Fe=Er}for(var Ne=0,Et=Fe.rings.length;Ne<Et;Ne++){var ir=Fe.rings[Ne],xr=Fe.windings[Ne],Wr=fe.rings.indexOf(ir);Wr===-1?(fe.rings.push(ir),fe.windings.push(xr)):fe.windings[Wr]+=xr}Fe.rings=null,Fe.windings=null,Fe.consumedBy=fe,Fe.leftSE.consumedBy=fe.leftSE,Fe.rightSE.consumedBy=fe.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ne=this.prev.consumedBy||this.prev;this._beforeState=ne.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ne=this.beforeState();this._afterState={rings:ne.rings.slice(0),windings:ne.windings.slice(0),multiPolys:[]};for(var fe=this._afterState.rings,Fe=this._afterState.windings,ct=this._afterState.multiPolys,zt=0,Er=this.rings.length;zt<Er;zt++){var Ne=this.rings[zt],Et=this.windings[zt],ir=fe.indexOf(Ne);ir===-1?(fe.push(Ne),Fe.push(Et)):Fe[ir]+=Et}for(var xr=[],Wr=[],yn=0,Sn=fe.length;yn<Sn;yn++)if(Fe[yn]!==0){var En=fe[yn],pn=En.poly;if(Wr.indexOf(pn)===-1)if(En.isExterior)xr.push(pn);else{Wr.indexOf(pn)===-1&&Wr.push(pn);var Kn=xr.indexOf(En.poly);Kn!==-1&&xr.splice(Kn,1)}}for(var Nn=0,Ji=xr.length;Nn<Ji;Nn++){var $i=xr[Nn].multiPoly;ct.indexOf($i)===-1&&ct.push($i)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ne=this.beforeState().multiPolys,fe=this.afterState().multiPolys;switch(Ei.type){case"union":{var Fe=ne.length===0,ct=fe.length===0;this._isInResult=Fe!==ct;break}case"intersection":{var zt,Er;ne.length<fe.length?(zt=ne.length,Er=fe.length):(zt=fe.length,Er=ne.length),this._isInResult=Er===Ei.numMultiPolys&&zt<Er;break}case"xor":{var Ne=Math.abs(ne.length-fe.length);this._isInResult=Ne%2==1;break}case"difference":{var Et=function(xr){return xr.length===1&&xr[0].isSubject};this._isInResult=Et(ne)!==Et(fe);break}default:throw new Error("Unrecognized operation type found ".concat(Ei.type))}return this._isInResult}}],[{key:"fromRing",value:function(ne,fe,Fe){var ct,zt,Er,Ne=St.comparePoints(ne,fe);if(Ne<0)ct=ne,zt=fe,Er=1;else if(Ne>0)ct=fe,zt=ne,Er=-1;else throw new Error("Tried to create degenerate segment at [".concat(ne.x,", ").concat(ne.y,"]"));var Et=new St(ct,!0),ir=new St(zt,!1);return new Tt(Et,ir,[Fe],[Er])}}]),Tt}(),Hr=function(){function Tt(R,ne,fe){if(ee(this,Tt),!Array.isArray(R)||R.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ne,this.isExterior=fe,this.segments=[],typeof R[0][0]!="number"||typeof R[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Fe=lt.round(R[0][0],R[0][1]);this.bbox={ll:{x:Fe.x,y:Fe.y},ur:{x:Fe.x,y:Fe.y}};for(var ct=Fe,zt=1,Er=R.length;zt<Er;zt++){if(typeof R[zt][0]!="number"||typeof R[zt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ne=lt.round(R[zt][0],R[zt][1]);Ne.x===ct.x&&Ne.y===ct.y||(this.segments.push(tr.fromRing(ct,Ne,this)),Ne.x<this.bbox.ll.x&&(this.bbox.ll.x=Ne.x),Ne.y<this.bbox.ll.y&&(this.bbox.ll.y=Ne.y),Ne.x>this.bbox.ur.x&&(this.bbox.ur.x=Ne.x),Ne.y>this.bbox.ur.y&&(this.bbox.ur.y=Ne.y),ct=Ne)}(Fe.x!==ct.x||Fe.y!==ct.y)&&this.segments.push(tr.fromRing(ct,Fe,this))}return le(Tt,[{key:"getSweepEvents",value:function(){for(var ne=[],fe=0,Fe=this.segments.length;fe<Fe;fe++){var ct=this.segments[fe];ne.push(ct.leftSE),ne.push(ct.rightSE)}return ne}}]),Tt}(),Br=function(){function Tt(R,ne){if(ee(this,Tt),!Array.isArray(R))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Hr(R[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var fe=1,Fe=R.length;fe<Fe;fe++){var ct=new Hr(R[fe],this,!1);ct.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ct.bbox.ll.x),ct.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ct.bbox.ll.y),ct.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ct.bbox.ur.x),ct.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ct.bbox.ur.y),this.interiorRings.push(ct)}this.multiPoly=ne}return le(Tt,[{key:"getSweepEvents",value:function(){for(var ne=this.exteriorRing.getSweepEvents(),fe=0,Fe=this.interiorRings.length;fe<Fe;fe++)for(var ct=this.interiorRings[fe].getSweepEvents(),zt=0,Er=ct.length;zt<Er;zt++)ne.push(ct[zt]);return ne}}]),Tt}(),Bn=function(){function Tt(R,ne){if(ee(this,Tt),!Array.isArray(R))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof R[0][0][0]=="number"&&(R=[R])}catch(zt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var fe=0,Fe=R.length;fe<Fe;fe++){var ct=new Br(R[fe],this);ct.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ct.bbox.ll.x),ct.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ct.bbox.ll.y),ct.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ct.bbox.ur.x),ct.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ct.bbox.ur.y),this.polys.push(ct)}this.isSubject=ne}return le(Tt,[{key:"getSweepEvents",value:function(){for(var ne=[],fe=0,Fe=this.polys.length;fe<Fe;fe++)for(var ct=this.polys[fe].getSweepEvents(),zt=0,Er=ct.length;zt<Er;zt++)ne.push(ct[zt]);return ne}}]),Tt}(),tn=function(){le(Tt,null,[{key:"factory",value:function(ne){for(var fe=[],Fe=0,ct=ne.length;Fe<ct;Fe++){var zt=ne[Fe];if(!(!zt.isInResult()||zt.ringOut)){for(var Er=null,Ne=zt.leftSE,Et=zt.rightSE,ir=[Ne],xr=Ne.point,Wr=[];Er=Ne,Ne=Et,ir.push(Ne),Ne.point!==xr;)for(;;){var yn=Ne.getAvailableLinkedEvents();if(yn.length===0){var Sn=ir[0].point,En=ir[ir.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Sn.x,",")+" ".concat(Sn.y,"]. Last matching segment found ends at")+" [".concat(En.x,", ").concat(En.y,"]."))}if(yn.length===1){Et=yn[0].otherSE;break}for(var pn=null,Kn=0,Nn=Wr.length;Kn<Nn;Kn++)if(Wr[Kn].point===Ne.point){pn=Kn;break}if(pn!==null){var Ji=Wr.splice(pn)[0],$i=ir.splice(Ji.index);$i.unshift($i[0].otherSE),fe.push(new Tt($i.reverse()));continue}Wr.push({index:ir.length,point:Ne.point});var go=Ne.getLeftmostComparator(Er);Et=yn.sort(go)[0].otherSE;break}fe.push(new Tt(ir))}}return fe}}]);function Tt(R){ee(this,Tt),this.events=R;for(var ne=0,fe=R.length;ne<fe;ne++)R[ne].segment.ringOut=this;this.poly=null}return le(Tt,[{key:"getGeom",value:function(){for(var ne=this.events[0].point,fe=[ne],Fe=1,ct=this.events.length-1;Fe<ct;Fe++){var zt=this.events[Fe].point,Er=this.events[Fe+1].point;J(zt,ne,Er)!==0&&(fe.push(zt),ne=zt)}if(fe.length===1)return null;var Ne=fe[0],Et=fe[1];J(Ne,ne,Et)===0&&fe.shift(),fe.push(fe[0]);for(var ir=this.isExteriorRing()?1:-1,xr=this.isExteriorRing()?0:fe.length-1,Wr=this.isExteriorRing()?fe.length:-1,yn=[],Sn=xr;Sn!=Wr;Sn+=ir)yn.push([fe[Sn].x,fe[Sn].y]);return yn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ne=this.enclosingRing();this._isExteriorRing=ne?!ne.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ne=this.events[0],fe=1,Fe=this.events.length;fe<Fe;fe++){var ct=this.events[fe];St.compare(ne,ct)>0&&(ne=ct)}for(var zt=ne.segment.prevInResult(),Er=zt?zt.prevInResult():null;;){if(!zt)return null;if(!Er)return zt.ringOut;if(Er.ringOut!==zt.ringOut)return Er.ringOut.enclosingRing()!==zt.ringOut?zt.ringOut:zt.ringOut.enclosingRing();zt=Er.prevInResult(),Er=zt?zt.prevInResult():null}}}]),Tt}(),gn=function(){function Tt(R){ee(this,Tt),this.exteriorRing=R,R.poly=this,this.interiorRings=[]}return le(Tt,[{key:"addInterior",value:function(ne){this.interiorRings.push(ne),ne.poly=this}},{key:"getGeom",value:function(){var ne=[this.exteriorRing.getGeom()];if(ne[0]===null)return null;for(var fe=0,Fe=this.interiorRings.length;fe<Fe;fe++){var ct=this.interiorRings[fe].getGeom();ct!==null&&ne.push(ct)}return ne}}]),Tt}(),fi=function(){function Tt(R){ee(this,Tt),this.rings=R,this.polys=this._composePolys(R)}return le(Tt,[{key:"getGeom",value:function(){for(var ne=[],fe=0,Fe=this.polys.length;fe<Fe;fe++){var ct=this.polys[fe].getGeom();ct!==null&&ne.push(ct)}return ne}},{key:"_composePolys",value:function(ne){for(var fe=[],Fe=0,ct=ne.length;Fe<ct;Fe++){var zt=ne[Fe];if(!zt.poly)if(zt.isExteriorRing())fe.push(new gn(zt));else{var Er=zt.enclosingRing();Er.poly||fe.push(new gn(Er)),Er.poly.addInterior(zt)}}return fe}}]),Tt}(),Vn=function(){function Tt(R){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:tr.compare;ee(this,Tt),this.queue=R,this.tree=new ut(ne),this.segments=[]}return le(Tt,[{key:"process",value:function(ne){var fe=ne.segment,Fe=[];if(ne.consumedBy)return ne.isLeft?this.queue.remove(ne.otherSE):this.tree.remove(fe),Fe;var ct=ne.isLeft?this.tree.insert(fe):this.tree.find(fe);if(!ct)throw new Error("Unable to find segment #".concat(fe.id," ")+"[".concat(fe.leftSE.point.x,", ").concat(fe.leftSE.point.y,"] -> ")+"[".concat(fe.rightSE.point.x,", ").concat(fe.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var zt=ct,Er=ct,Ne=void 0,Et=void 0;Ne===void 0;)zt=this.tree.prev(zt),zt===null?Ne=null:zt.key.consumedBy===void 0&&(Ne=zt.key);for(;Et===void 0;)Er=this.tree.next(Er),Er===null?Et=null:Er.key.consumedBy===void 0&&(Et=Er.key);if(ne.isLeft){var ir=null;if(Ne){var xr=Ne.getIntersection(fe);if(xr!==null&&(fe.isAnEndpoint(xr)||(ir=xr),!Ne.isAnEndpoint(xr)))for(var Wr=this._splitSafely(Ne,xr),yn=0,Sn=Wr.length;yn<Sn;yn++)Fe.push(Wr[yn])}var En=null;if(Et){var pn=Et.getIntersection(fe);if(pn!==null&&(fe.isAnEndpoint(pn)||(En=pn),!Et.isAnEndpoint(pn)))for(var Kn=this._splitSafely(Et,pn),Nn=0,Ji=Kn.length;Nn<Ji;Nn++)Fe.push(Kn[Nn])}if(ir!==null||En!==null){var $i=null;if(ir===null)$i=En;else if(En===null)$i=ir;else{var go=St.comparePoints(ir,En);$i=go<=0?ir:En}this.queue.remove(fe.rightSE),Fe.push(fe.rightSE);for(var rs=fe.split($i),qi=0,W=rs.length;qi<W;qi++)Fe.push(rs[qi])}Fe.length>0?(this.tree.remove(fe),Fe.push(ne)):(this.segments.push(fe),fe.prev=Ne)}else{if(Ne&&Et){var K=Ne.getIntersection(Et);if(K!==null){if(!Ne.isAnEndpoint(K))for(var ie=this._splitSafely(Ne,K),_e=0,Le=ie.length;_e<Le;_e++)Fe.push(ie[_e]);if(!Et.isAnEndpoint(K))for(var Ke=this._splitSafely(Et,K),it=0,he=Ke.length;it<he;it++)Fe.push(Ke[it])}}this.tree.remove(fe)}return Fe}},{key:"_splitSafely",value:function(ne,fe){this.tree.remove(ne);var Fe=ne.rightSE;this.queue.remove(Fe);var ct=ne.split(fe);return ct.push(Fe),ne.consumedBy===void 0&&this.tree.insert(ne),ct}}]),Tt}(),vn=typeof ye!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,bi=typeof ye!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Mi=function(){function Tt(){ee(this,Tt)}return le(Tt,[{key:"run",value:function(ne,fe,Fe){Ei.type=ne,lt.reset();for(var ct=[new Bn(fe,!0)],zt=0,Er=Fe.length;zt<Er;zt++)ct.push(new Bn(Fe[zt],!1));if(Ei.numMultiPolys=ct.length,Ei.type==="difference")for(var Ne=ct[0],Et=1;Et<ct.length;)Dr(ct[Et].bbox,Ne.bbox)!==null?Et++:ct.splice(Et,1);if(Ei.type==="intersection"){for(var ir=0,xr=ct.length;ir<xr;ir++)for(var Wr=ct[ir],yn=ir+1,Sn=ct.length;yn<Sn;yn++)if(Dr(Wr.bbox,ct[yn].bbox)===null)return[]}for(var En=new ut(St.compare),pn=0,Kn=ct.length;pn<Kn;pn++)for(var Nn=ct[pn].getSweepEvents(),Ji=0,$i=Nn.length;Ji<$i;Ji++)if(En.insert(Nn[Ji]),En.size>vn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var go=new Vn(En),rs=En.size,qi=En.pop();qi;){var W=qi.key;if(En.size===rs){var K=W.segment;throw new Error("Unable to pop() ".concat(W.isLeft?"left":"right"," SweepEvent ")+"[".concat(W.point.x,", ").concat(W.point.y,"] from segment #").concat(K.id," ")+"[".concat(K.leftSE.point.x,", ").concat(K.leftSE.point.y,"] -> ")+"[".concat(K.rightSE.point.x,", ").concat(K.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(En.size>vn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(go.segments.length>bi)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ie=go.process(W),_e=0,Le=ie.length;_e<Le;_e++){var Ke=ie[_e];Ke.consumedBy===void 0&&En.insert(Ke)}rs=En.size,qi=En.pop()}lt.reset();var it=tn.factory(go.segments),he=new fi(it);return he.getGeom()}}]),Tt}(),Ei=new Mi,Gn=function(R){for(var ne=arguments.length,fe=new Array(ne>1?ne-1:0),Fe=1;Fe<ne;Fe++)fe[Fe-1]=arguments[Fe];return Ei.run("union",R,fe)},kn=function(R){for(var ne=arguments.length,fe=new Array(ne>1?ne-1:0),Fe=1;Fe<ne;Fe++)fe[Fe-1]=arguments[Fe];return Ei.run("intersection",R,fe)},mo=function(R){for(var ne=arguments.length,fe=new Array(ne>1?ne-1:0),Fe=1;Fe<ne;Fe++)fe[Fe-1]=arguments[Fe];return Ei.run("xor",R,fe)},Hi=function(R){for(var ne=arguments.length,fe=new Array(ne>1?ne-1:0),Fe=1;Fe<ne;Fe++)fe[Fe-1]=arguments[Fe];return Ei.run("difference",R,fe)},ja={union:Gn,intersection:kn,xor:mo,difference:Hi};return ja})},28660:function(Sr,te,N){var ye=N(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ee;(function(y){(function(le){var U=typeof N.g=="object"?N.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=oe(y);typeof U.Reflect=="undefined"?U.Reflect=y:ce=oe(U.Reflect,ce),le(ce);function oe(Ue,se){return function(ze,et){typeof Ue[ze]!="function"&&Object.defineProperty(Ue,ze,{configurable:!0,writable:!0,value:et}),se&&se(ze,et)}}})(function(le){var U=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",oe=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ue=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",se=typeof Object.create=="function",ze={__proto__:[]}instanceof Array,et=!se&&!ze,ut={create:se?function(){return Er(Object.create(null))}:ze?function(){return Er({__proto__:null})}:function(){return Er({})},has:et?function(Ne,Et){return U.call(Ne,Et)}:function(Ne,Et){return Et in Ne},get:et?function(Ne,Et){return U.call(Ne,Et)?Ne[Et]:void 0}:function(Ne,Et){return Ne[Et]}},Ct=Object.getPrototypeOf(Function),Kt=typeof ye=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Yt=!Kt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Fe(),nr=!Kt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ct(),Jt=!Kt&&typeof WeakMap=="function"?WeakMap:zt(),bt=new Jt;function vt(Ne,Et,ir,xr){if(Br(ir)){if(!Ei(Ne))throw new TypeError;if(!kn(Et))throw new TypeError;return J(Ne,Et)}else{if(!Ei(Ne))throw new TypeError;if(!gn(Et))throw new TypeError;if(!gn(xr)&&!Br(xr)&&!Bn(xr))throw new TypeError;return Bn(xr)&&(xr=void 0),ir=Mi(ir),Ie(Ne,Et,ir,xr)}}le("decorate",vt);function Dr(Ne,Et){function ir(xr,Wr){if(!gn(xr))throw new TypeError;if(!Br(Wr)&&!mo(Wr))throw new TypeError;St(Ne,Et,xr,Wr)}return ir}le("metadata",Dr);function fr(Ne,Et,ir,xr){if(!gn(ir))throw new TypeError;return Br(xr)||(xr=Mi(xr)),St(Ne,Et,ir,xr)}le("defineMetadata",fr);function sr(Ne,Et,ir){if(!gn(Et))throw new TypeError;return Br(ir)||(ir=Mi(ir)),H(Ne,Et,ir)}le("hasMetadata",sr);function mt(Ne,Et,ir){if(!gn(Et))throw new TypeError;return Br(ir)||(ir=Mi(ir)),be(Ne,Et,ir)}le("hasOwnMetadata",mt);function nt(Ne,Et,ir){if(!gn(Et))throw new TypeError;return Br(ir)||(ir=Mi(ir)),tt(Ne,Et,ir)}le("getMetadata",nt);function Lt(Ne,Et,ir){if(!gn(Et))throw new TypeError;return Br(ir)||(ir=Mi(ir)),ht(Ne,Et,ir)}le("getOwnMetadata",Lt);function lt(Ne,Et){if(!gn(Ne))throw new TypeError;return Br(Et)||(Et=Mi(Et)),jt(Ne,Et)}le("getMetadataKeys",lt);function Xt(Ne,Et){if(!gn(Ne))throw new TypeError;return Br(Et)||(Et=Mi(Et)),tr(Ne,Et)}le("getOwnMetadataKeys",Xt);function _r(Ne,Et,ir){if(!gn(Et))throw new TypeError;Br(ir)||(ir=Mi(ir));var xr=V(Et,ir,!1);if(Br(xr)||!xr.delete(Ne))return!1;if(xr.size>0)return!0;var Wr=bt.get(Et);return Wr.delete(ir),Wr.size>0||bt.delete(Et),!0}le("deleteMetadata",_r);function J(Ne,Et){for(var ir=Ne.length-1;ir>=0;--ir){var xr=Ne[ir],Wr=xr(Et);if(!Br(Wr)&&!Bn(Wr)){if(!kn(Wr))throw new TypeError;Et=Wr}}return Et}function Ie(Ne,Et,ir,xr){for(var Wr=Ne.length-1;Wr>=0;--Wr){var yn=Ne[Wr],Sn=yn(Et,ir,xr);if(!Br(Sn)&&!Bn(Sn)){if(!gn(Sn))throw new TypeError;xr=Sn}}return xr}function V(Ne,Et,ir){var xr=bt.get(Ne);if(Br(xr)){if(!ir)return;xr=new Yt,bt.set(Ne,xr)}var Wr=xr.get(Et);if(Br(Wr)){if(!ir)return;Wr=new Yt,xr.set(Et,Wr)}return Wr}function H(Ne,Et,ir){var xr=be(Ne,Et,ir);if(xr)return!0;var Wr=fe(Et);return Bn(Wr)?!1:H(Ne,Wr,ir)}function be(Ne,Et,ir){var xr=V(Et,ir,!1);return Br(xr)?!1:vn(xr.has(Ne))}function tt(Ne,Et,ir){var xr=be(Ne,Et,ir);if(xr)return ht(Ne,Et,ir);var Wr=fe(Et);if(!Bn(Wr))return tt(Ne,Wr,ir)}function ht(Ne,Et,ir){var xr=V(Et,ir,!1);if(!Br(xr))return xr.get(Ne)}function St(Ne,Et,ir,xr){var Wr=V(ir,xr,!0);Wr.set(Ne,Et)}function jt(Ne,Et){var ir=tr(Ne,Et),xr=fe(Ne);if(xr===null)return ir;var Wr=jt(xr,Et);if(Wr.length<=0)return ir;if(ir.length<=0)return Wr;for(var yn=new nr,Sn=[],En=0,pn=ir;En<pn.length;En++){var Kn=pn[En],Nn=yn.has(Kn);Nn||(yn.add(Kn),Sn.push(Kn))}for(var Ji=0,$i=Wr;Ji<$i.length;Ji++){var Kn=$i[Ji],Nn=yn.has(Kn);Nn||(yn.add(Kn),Sn.push(Kn))}return Sn}function tr(Ne,Et){var ir=[],xr=V(Ne,Et,!1);if(Br(xr))return ir;for(var Wr=xr.keys(),yn=ja(Wr),Sn=0;;){var En=R(yn);if(!En)return ir.length=Sn,ir;var pn=Tt(En);try{ir[Sn]=pn}catch(Kn){try{ne(yn)}finally{throw Kn}}Sn++}}function Hr(Ne){if(Ne===null)return 1;switch(typeof Ne){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ne===null?1:6;default:return 6}}function Br(Ne){return Ne===void 0}function Bn(Ne){return Ne===null}function tn(Ne){return typeof Ne=="symbol"}function gn(Ne){return typeof Ne=="object"?Ne!==null:typeof Ne=="function"}function fi(Ne,Et){switch(Hr(Ne)){case 0:return Ne;case 1:return Ne;case 2:return Ne;case 3:return Ne;case 4:return Ne;case 5:return Ne}var ir=Et===3?"string":Et===5?"number":"default",xr=Hi(Ne,oe);if(xr!==void 0){var Wr=xr.call(Ne,ir);if(gn(Wr))throw new TypeError;return Wr}return Vn(Ne,ir==="default"?"number":ir)}function Vn(Ne,Et){if(Et==="string"){var ir=Ne.toString;if(Gn(ir)){var xr=ir.call(Ne);if(!gn(xr))return xr}var Wr=Ne.valueOf;if(Gn(Wr)){var xr=Wr.call(Ne);if(!gn(xr))return xr}}else{var Wr=Ne.valueOf;if(Gn(Wr)){var xr=Wr.call(Ne);if(!gn(xr))return xr}var yn=Ne.toString;if(Gn(yn)){var xr=yn.call(Ne);if(!gn(xr))return xr}}throw new TypeError}function vn(Ne){return!!Ne}function bi(Ne){return""+Ne}function Mi(Ne){var Et=fi(Ne,3);return tn(Et)?Et:bi(Et)}function Ei(Ne){return Array.isArray?Array.isArray(Ne):Ne instanceof Object?Ne instanceof Array:Object.prototype.toString.call(Ne)==="[object Array]"}function Gn(Ne){return typeof Ne=="function"}function kn(Ne){return typeof Ne=="function"}function mo(Ne){switch(Hr(Ne)){case 3:return!0;case 4:return!0;default:return!1}}function Hi(Ne,Et){var ir=Ne[Et];if(ir!=null){if(!Gn(ir))throw new TypeError;return ir}}function ja(Ne){var Et=Hi(Ne,Ue);if(!Gn(Et))throw new TypeError;var ir=Et.call(Ne);if(!gn(ir))throw new TypeError;return ir}function Tt(Ne){return Ne.value}function R(Ne){var Et=Ne.next();return Et.done?!1:Et}function ne(Ne){var Et=Ne.return;Et&&Et.call(Ne)}function fe(Ne){var Et=Object.getPrototypeOf(Ne);if(typeof Ne!="function"||Ne===Ct||Et!==Ct)return Et;var ir=Ne.prototype,xr=ir&&Object.getPrototypeOf(ir);if(xr==null||xr===Object.prototype)return Et;var Wr=xr.constructor;return typeof Wr!="function"||Wr===Ne?Et:Wr}function Fe(){var Ne={},Et=[],ir=function(){function Sn(En,pn,Kn){this._index=0,this._keys=En,this._values=pn,this._selector=Kn}return Sn.prototype["@@iterator"]=function(){return this},Sn.prototype[Ue]=function(){return this},Sn.prototype.next=function(){var En=this._index;if(En>=0&&En<this._keys.length){var pn=this._selector(this._keys[En],this._values[En]);return En+1>=this._keys.length?(this._index=-1,this._keys=Et,this._values=Et):this._index++,{value:pn,done:!1}}return{value:void 0,done:!0}},Sn.prototype.throw=function(En){throw this._index>=0&&(this._index=-1,this._keys=Et,this._values=Et),En},Sn.prototype.return=function(En){return this._index>=0&&(this._index=-1,this._keys=Et,this._values=Et),{value:En,done:!0}},Sn}();return function(){function Sn(){this._keys=[],this._values=[],this._cacheKey=Ne,this._cacheIndex=-2}return Object.defineProperty(Sn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Sn.prototype.has=function(En){return this._find(En,!1)>=0},Sn.prototype.get=function(En){var pn=this._find(En,!1);return pn>=0?this._values[pn]:void 0},Sn.prototype.set=function(En,pn){var Kn=this._find(En,!0);return this._values[Kn]=pn,this},Sn.prototype.delete=function(En){var pn=this._find(En,!1);if(pn>=0){for(var Kn=this._keys.length,Nn=pn+1;Nn<Kn;Nn++)this._keys[Nn-1]=this._keys[Nn],this._values[Nn-1]=this._values[Nn];return this._keys.length--,this._values.length--,En===this._cacheKey&&(this._cacheKey=Ne,this._cacheIndex=-2),!0}return!1},Sn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ne,this._cacheIndex=-2},Sn.prototype.keys=function(){return new ir(this._keys,this._values,xr)},Sn.prototype.values=function(){return new ir(this._keys,this._values,Wr)},Sn.prototype.entries=function(){return new ir(this._keys,this._values,yn)},Sn.prototype["@@iterator"]=function(){return this.entries()},Sn.prototype[Ue]=function(){return this.entries()},Sn.prototype._find=function(En,pn){return this._cacheKey!==En&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=En)),this._cacheIndex<0&&pn&&(this._cacheIndex=this._keys.length,this._keys.push(En),this._values.push(void 0)),this._cacheIndex},Sn}();function xr(Sn,En){return Sn}function Wr(Sn,En){return En}function yn(Sn,En){return[Sn,En]}}function ct(){return function(){function Ne(){this._map=new Yt}return Object.defineProperty(Ne.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ne.prototype.has=function(Et){return this._map.has(Et)},Ne.prototype.add=function(Et){return this._map.set(Et,Et),this},Ne.prototype.delete=function(Et){return this._map.delete(Et)},Ne.prototype.clear=function(){this._map.clear()},Ne.prototype.keys=function(){return this._map.keys()},Ne.prototype.values=function(){return this._map.values()},Ne.prototype.entries=function(){return this._map.entries()},Ne.prototype["@@iterator"]=function(){return this.keys()},Ne.prototype[Ue]=function(){return this.keys()},Ne}()}function zt(){var Ne=16,Et=ut.create(),ir=xr();return function(){function pn(){this._key=xr()}return pn.prototype.has=function(Kn){var Nn=Wr(Kn,!1);return Nn!==void 0?ut.has(Nn,this._key):!1},pn.prototype.get=function(Kn){var Nn=Wr(Kn,!1);return Nn!==void 0?ut.get(Nn,this._key):void 0},pn.prototype.set=function(Kn,Nn){var Ji=Wr(Kn,!0);return Ji[this._key]=Nn,this},pn.prototype.delete=function(Kn){var Nn=Wr(Kn,!1);return Nn!==void 0?delete Nn[this._key]:!1},pn.prototype.clear=function(){this._key=xr()},pn}();function xr(){var pn;do pn="@@WeakMap@@"+En();while(ut.has(Et,pn));return Et[pn]=!0,pn}function Wr(pn,Kn){if(!U.call(pn,ir)){if(!Kn)return;Object.defineProperty(pn,ir,{value:ut.create()})}return pn[ir]}function yn(pn,Kn){for(var Nn=0;Nn<Kn;++Nn)pn[Nn]=Math.random()*255|0;return pn}function Sn(pn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(pn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(pn)):yn(new Uint8Array(pn),pn):yn(new Array(pn),pn)}function En(){var pn=Sn(Ne);pn[6]=pn[6]&79|64,pn[8]=pn[8]&191|128;for(var Kn="",Nn=0;Nn<Ne;++Nn){var Ji=pn[Nn];(Nn===4||Nn===6||Nn===8)&&(Kn+="-"),Ji<16&&(Kn+="0"),Kn+=Ji.toString(16).toLowerCase()}return Kn}}function Er(Ne){return Ne.__=void 0,delete Ne.__,Ne}})})(ee||(ee={}))},81550:function(Sr){(function(te,N){Sr.exports=N()})(this,function(){"use strict";var te=function(z){return z instanceof Uint8Array||z instanceof Uint16Array||z instanceof Uint32Array||z instanceof Int8Array||z instanceof Int16Array||z instanceof Int32Array||z instanceof Float32Array||z instanceof Float64Array||z instanceof Uint8ClampedArray},N=function(z,xe){for(var Ce=Object.keys(xe),Ft=0;Ft<Ce.length;++Ft)z[Ce[Ft]]=xe[Ce[Ft]];return z},ye=`
`;function ee(z){return typeof atob!="undefined"?atob(z):"base64:"+z}function y(z){var xe=new Error("(regl) "+z);throw console.error(xe),xe}function le(z,xe){z||y(xe)}function U(z){return z?": "+z:""}function ce(z,xe,Ce){z in xe||y("unknown parameter ("+z+")"+U(Ce)+". possible values: "+Object.keys(xe).join())}function oe(z,xe){te(z)||y("invalid parameter type"+U(xe)+". must be a typed array")}function Ue(z,xe){switch(xe){case"number":return typeof z=="number";case"object":return typeof z=="object";case"string":return typeof z=="string";case"boolean":return typeof z=="boolean";case"function":return typeof z=="function";case"undefined":return typeof z=="undefined";case"symbol":return typeof z=="symbol"}}function se(z,xe,Ce){Ue(z,xe)||y("invalid parameter type"+U(Ce)+". expected "+xe+", got "+typeof z)}function ze(z,xe){z>=0&&(z|0)===z||y("invalid parameter type, ("+z+")"+U(xe)+". must be a nonnegative integer")}function et(z,xe,Ce){xe.indexOf(z)<0&&y("invalid value"+U(Ce)+". must be one of: "+xe)}var ut=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Ct(z){Object.keys(z).forEach(function(xe){ut.indexOf(xe)<0&&y('invalid regl constructor argument "'+xe+'". must be one of '+ut)})}function Kt(z,xe){for(z=z+"";z.length<xe;)z=" "+z;return z}function Yt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function nr(z,xe){this.number=z,this.line=xe,this.errors=[]}function Jt(z,xe,Ce){this.file=z,this.line=xe,this.message=Ce}function bt(){var z=new Error,xe=(z.stack||z).toString(),Ce=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(xe);if(Ce)return Ce[1];var Ft=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(xe);return Ft?Ft[1]:"unknown"}function vt(){var z=new Error,xe=(z.stack||z).toString(),Ce=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(xe);if(Ce)return Ce[1];var Ft=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(xe);return Ft?Ft[1]:"unknown"}function Dr(z,xe){var Ce=z.split(`
`),Ft=1,rr=0,kt={unknown:new Yt,0:new Yt};kt.unknown.name=kt[0].name=xe||bt(),kt.unknown.lines.push(new nr(0,""));for(var Wt=0;Wt<Ce.length;++Wt){var wr=Ce[Wt],Ir=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(wr);if(Ir)switch(Ir[1]){case"line":var Rr=/(\d+)(\s+\d+)?/.exec(Ir[2]);Rr&&(Ft=Rr[1]|0,Rr[2]&&(rr=Rr[2]|0,rr in kt||(kt[rr]=new Yt)));break;case"define":var Cr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Ir[2]);Cr&&(kt[rr].name=Cr[1]?ee(Cr[2]):Cr[2]);break}kt[rr].lines.push(new nr(Ft++,wr))}return Object.keys(kt).forEach(function(zr){var $r=kt[zr];$r.lines.forEach(function(Ar){$r.index[Ar.number]=Ar})}),kt}function fr(z){var xe=[];return z.split(`
`).forEach(function(Ce){if(!(Ce.length<5)){var Ft=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ce);Ft?xe.push(new Jt(Ft[1]|0,Ft[2]|0,Ft[3].trim())):Ce.length>0&&xe.push(new Jt("unknown",0,Ce))}}),xe}function sr(z,xe){xe.forEach(function(Ce){var Ft=z[Ce.file];if(Ft){var rr=Ft.index[Ce.line];if(rr){rr.errors.push(Ce),Ft.hasErrors=!0;return}}z.unknown.hasErrors=!0,z.unknown.lines[0].errors.push(Ce)})}function mt(z,xe,Ce,Ft,rr){if(!z.getShaderParameter(xe,z.COMPILE_STATUS)){var kt=z.getShaderInfoLog(xe),Wt=Ft===z.FRAGMENT_SHADER?"fragment":"vertex";Ie(Ce,"string",Wt+" shader source must be a string",rr);var wr=Dr(Ce,rr),Ir=fr(kt);sr(wr,Ir),Object.keys(wr).forEach(function(Rr){var Cr=wr[Rr];if(!Cr.hasErrors)return;var zr=[""],$r=[""];function Ar(Ur,gt){zr.push(Ur),$r.push(gt||"")}Ar("file number "+Rr+": "+Cr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Cr.lines.forEach(function(Ur){if(Ur.errors.length>0){Ar(Kt(Ur.number,4)+"|  ","background-color:yellow; font-weight:bold"),Ar(Ur.line+ye,"color:red; background-color:yellow; font-weight:bold");var gt=0;Ur.errors.forEach(function(Vt){var Tr=Vt.message,Qr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Tr);if(Qr){var vr=Qr[1];switch(Tr=Qr[2],vr){case"assign":vr="=";break}gt=Math.max(Ur.line.indexOf(vr,gt),0)}else gt=0;Ar(Kt("| ",6)),Ar(Kt("^^^",gt+3)+ye,"font-weight:bold"),Ar(Kt("| ",6)),Ar(Tr+ye,"font-weight:bold")}),Ar(Kt("| ",6)+ye)}else Ar(Kt(Ur.number,4)+"|  "),Ar(Ur.line+ye,"color:red")}),typeof document!="undefined"&&!window.chrome?($r[0]=zr.join("%c"),console.log.apply(console,$r)):console.log(zr.join(""))}),le.raise("Error compiling "+Wt+" shader, "+wr[0].name)}}function nt(z,xe,Ce,Ft,rr){if(!z.getProgramParameter(xe,z.LINK_STATUS)){var kt=z.getProgramInfoLog(xe),Wt=Dr(Ce,rr),wr=Dr(Ft,rr),Ir='Error linking program with vertex shader, "'+wr[0].name+'", and fragment shader "'+Wt[0].name+'"';typeof document!="undefined"?console.log("%c"+Ir+ye+"%c"+kt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Ir+ye+kt),le.raise(Ir)}}function Lt(z){z._commandRef=bt()}function lt(z,xe,Ce,Ft){Lt(z);function rr(Ir){return Ir?Ft.id(Ir):0}z._fragId=rr(z.static.frag),z._vertId=rr(z.static.vert);function kt(Ir,Rr){Object.keys(Rr).forEach(function(Cr){Ir[Ft.id(Cr)]=!0})}var Wt=z._uniformSet={};kt(Wt,xe.static),kt(Wt,xe.dynamic);var wr=z._attributeSet={};kt(wr,Ce.static),kt(wr,Ce.dynamic),z._hasCount="count"in z.static||"count"in z.dynamic||"elements"in z.static||"elements"in z.dynamic}function Xt(z,xe){var Ce=vt();y(z+" in command "+(xe||bt())+(Ce==="unknown"?"":" called from "+Ce))}function _r(z,xe,Ce){z||Xt(xe,Ce||bt())}function J(z,xe,Ce,Ft){z in xe||Xt("unknown parameter ("+z+")"+U(Ce)+". possible values: "+Object.keys(xe).join(),Ft||bt())}function Ie(z,xe,Ce,Ft){Ue(z,xe)||Xt("invalid parameter type"+U(Ce)+". expected "+xe+", got "+typeof z,Ft||bt())}function V(z){z()}function H(z,xe,Ce){z.texture?et(z.texture._texture.internalformat,xe,"unsupported texture format for attachment"):et(z.renderbuffer._renderbuffer.format,Ce,"unsupported renderbuffer format for attachment")}var be=33071,tt=9728,ht=9984,St=9985,jt=9986,tr=9987,Hr=5120,Br=5121,Bn=5122,tn=5123,gn=5124,fi=5125,Vn=5126,vn=32819,bi=32820,Mi=33635,Ei=34042,Gn=36193,kn={};kn[Hr]=kn[Br]=1,kn[Bn]=kn[tn]=kn[Gn]=kn[Mi]=kn[vn]=kn[bi]=2,kn[gn]=kn[fi]=kn[Vn]=kn[Ei]=4;function mo(z,xe){return z===bi||z===vn||z===Mi?2:z===Ei?4:kn[z]*xe}function Hi(z){return!(z&z-1)&&!!z}function ja(z,xe,Ce){var Ft,rr=xe.width,kt=xe.height,Wt=xe.channels;le(rr>0&&rr<=Ce.maxTextureSize&&kt>0&&kt<=Ce.maxTextureSize,"invalid texture shape"),(z.wrapS!==be||z.wrapT!==be)&&le(Hi(rr)&&Hi(kt),"incompatible wrap mode for texture, both width and height must be power of 2"),xe.mipmask===1?rr!==1&&kt!==1&&le(z.minFilter!==ht&&z.minFilter!==jt&&z.minFilter!==St&&z.minFilter!==tr,"min filter requires mipmap"):(le(Hi(rr)&&Hi(kt),"texture must be a square power of 2 to support mipmapping"),le(xe.mipmask===(rr<<1)-1,"missing or incomplete mipmap data")),xe.type===Vn&&(Ce.extensions.indexOf("oes_texture_float_linear")<0&&le(z.minFilter===tt&&z.magFilter===tt,"filter not supported, must enable oes_texture_float_linear"),le(!z.genMipmaps,"mipmap generation not supported with float textures"));var wr=xe.images;for(Ft=0;Ft<16;++Ft)if(wr[Ft]){var Ir=rr>>Ft,Rr=kt>>Ft;le(xe.mipmask&1<<Ft,"missing mipmap data");var Cr=wr[Ft];if(le(Cr.width===Ir&&Cr.height===Rr,"invalid shape for mip images"),le(Cr.format===xe.format&&Cr.internalformat===xe.internalformat&&Cr.type===xe.type,"incompatible type for mip image"),!Cr.compressed)if(Cr.data){var zr=Math.ceil(mo(Cr.type,Wt)*Ir/Cr.unpackAlignment)*Cr.unpackAlignment;le(Cr.data.byteLength===zr*Rr,"invalid data for image, buffer size is inconsistent with image format")}else Cr.element||Cr.copy}else z.genMipmaps||le((xe.mipmask&1<<Ft)==0,"extra mipmap data");xe.compressed&&le(!z.genMipmaps,"mipmap generation for compressed images not supported")}function Tt(z,xe,Ce,Ft){var rr=z.width,kt=z.height,Wt=z.channels;le(rr>0&&rr<=Ft.maxTextureSize&&kt>0&&kt<=Ft.maxTextureSize,"invalid texture shape"),le(rr===kt,"cube map must be square"),le(xe.wrapS===be&&xe.wrapT===be,"wrap mode not supported by cube map");for(var wr=0;wr<Ce.length;++wr){var Ir=Ce[wr];le(Ir.width===rr&&Ir.height===kt,"inconsistent cube map face shape"),xe.genMipmaps&&(le(!Ir.compressed,"can not generate mipmap for compressed textures"),le(Ir.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Rr=Ir.images,Cr=0;Cr<16;++Cr){var zr=Rr[Cr];if(zr){var $r=rr>>Cr,Ar=kt>>Cr;le(Ir.mipmask&1<<Cr,"missing mipmap data"),le(zr.width===$r&&zr.height===Ar,"invalid shape for mip images"),le(zr.format===z.format&&zr.internalformat===z.internalformat&&zr.type===z.type,"incompatible type for mip image"),zr.compressed||(zr.data?le(zr.data.byteLength===$r*Ar*Math.max(mo(zr.type,Wt),zr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):zr.element||zr.copy)}}}}var R=N(le,{optional:V,raise:y,commandRaise:Xt,command:_r,parameter:ce,commandParameter:J,constructor:Ct,type:se,commandType:Ie,isTypedArray:oe,nni:ze,oneOf:et,shaderError:mt,linkError:nt,callSite:vt,saveCommandRef:Lt,saveDrawInfo:lt,framebufferFormat:H,guessCommand:bt,texture2D:ja,textureCube:Tt}),ne=0,fe=0,Fe=5,ct=6;function zt(z,xe){this.id=ne++,this.type=z,this.data=xe}function Er(z){return z.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Ne(z){if(z.length===0)return[];var xe=z.charAt(0),Ce=z.charAt(z.length-1);if(z.length>1&&xe===Ce&&(xe==='"'||xe==="'"))return['"'+Er(z.substr(1,z.length-2))+'"'];var Ft=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(z);if(Ft)return Ne(z.substr(0,Ft.index)).concat(Ne(Ft[1])).concat(Ne(z.substr(Ft.index+Ft[0].length)));var rr=z.split(".");if(rr.length===1)return['"'+Er(z)+'"'];for(var kt=[],Wt=0;Wt<rr.length;++Wt)kt=kt.concat(Ne(rr[Wt]));return kt}function Et(z){return"["+Ne(z).join("][")+"]"}function ir(z,xe){return new zt(z,Et(xe+""))}function xr(z){return typeof z=="function"&&!z._reglType||z instanceof zt}function Wr(z,xe){if(typeof z=="function")return new zt(fe,z);if(typeof z=="number"||typeof z=="boolean")return new zt(Fe,z);if(Array.isArray(z))return new zt(ct,z.map((Ce,Ft)=>Wr(Ce,xe+"["+Ft+"]")));if(z instanceof zt)return z;R(!1,"invalid option type in uniform "+xe)}var yn={DynamicVariable:zt,define:ir,isDynamic:xr,unbox:Wr,accessor:Et},Sn={next:typeof requestAnimationFrame=="function"?function(z){return requestAnimationFrame(z)}:function(z){return setTimeout(z,16)},cancel:typeof cancelAnimationFrame=="function"?function(z){return cancelAnimationFrame(z)}:clearTimeout},En=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function pn(){var z={"":0},xe=[""];return{id:function(Ce){var Ft=z[Ce];return Ft||(Ft=z[Ce]=xe.length,xe.push(Ce),Ft)},str:function(Ce){return xe[Ce]}}}function Kn(z,xe,Ce){var Ft=document.createElement("canvas");N(Ft.style,{border:0,margin:0,padding:0,top:0,left:0}),z.appendChild(Ft),z===document.body&&(Ft.style.position="absolute",N(z.style,{margin:0,padding:0}));function rr(){var wr=window.innerWidth,Ir=window.innerHeight;if(z!==document.body){var Rr=z.getBoundingClientRect();wr=Rr.right-Rr.left,Ir=Rr.bottom-Rr.top}Ft.width=Ce*wr,Ft.height=Ce*Ir,N(Ft.style,{width:wr+"px",height:Ir+"px"})}var kt;z!==document.body&&typeof ResizeObserver=="function"?(kt=new ResizeObserver(function(){setTimeout(rr)}),kt.observe(z)):window.addEventListener("resize",rr,!1);function Wt(){kt?kt.disconnect():window.removeEventListener("resize",rr),z.removeChild(Ft)}return rr(),{canvas:Ft,onDestroy:Wt}}function Nn(z,xe){function Ce(Ft){try{return z.getContext(Ft,xe)}catch(rr){return null}}return Ce("webgl")||Ce("experimental-webgl")||Ce("webgl-experimental")}function Ji(z){return typeof z.nodeName=="string"&&typeof z.appendChild=="function"&&typeof z.getBoundingClientRect=="function"}function $i(z){return typeof z.drawArrays=="function"||typeof z.drawElements=="function"}function go(z){return typeof z=="string"?z.split():(R(Array.isArray(z),"invalid extension array"),z)}function rs(z){return typeof z=="string"?(R(typeof document!="undefined","not supported outside of DOM"),document.querySelector(z)):z}function qi(z){var xe=z||{},Ce,Ft,rr,kt,Wt={},wr=[],Ir=[],Rr=typeof window=="undefined"?1:window.devicePixelRatio,Cr=!1,zr=function(Ur){Ur&&R.raise(Ur)},$r=function(){};if(typeof xe=="string"?(R(typeof document!="undefined","selector queries only supported in DOM enviroments"),Ce=document.querySelector(xe),R(Ce,"invalid query string for element")):typeof xe=="object"?Ji(xe)?Ce=xe:$i(xe)?(kt=xe,rr=kt.canvas):(R.constructor(xe),"gl"in xe?kt=xe.gl:"canvas"in xe?rr=rs(xe.canvas):"container"in xe&&(Ft=rs(xe.container)),"attributes"in xe&&(Wt=xe.attributes,R.type(Wt,"object","invalid context attributes")),"extensions"in xe&&(wr=go(xe.extensions)),"optionalExtensions"in xe&&(Ir=go(xe.optionalExtensions)),"onDone"in xe&&(R.type(xe.onDone,"function","invalid or missing onDone callback"),zr=xe.onDone),"profile"in xe&&(Cr=!!xe.profile),"pixelRatio"in xe&&(Rr=+xe.pixelRatio,R(Rr>0,"invalid pixel ratio"))):R.raise("invalid arguments to regl"),Ce&&(Ce.nodeName.toLowerCase()==="canvas"?rr=Ce:Ft=Ce),!kt){if(!rr){R(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Ar=Kn(Ft||document.body,zr,Rr);if(!Ar)return null;rr=Ar.canvas,$r=Ar.onDestroy}Wt.premultipliedAlpha===void 0&&(Wt.premultipliedAlpha=!0),kt=Nn(rr,Wt)}return kt?{gl:kt,canvas:rr,container:Ft,extensions:wr,optionalExtensions:Ir,pixelRatio:Rr,profile:Cr,onDone:zr,onDestroy:$r}:($r(),zr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function W(z,xe){var Ce={};function Ft(Wt){R.type(Wt,"string","extension name must be string");var wr=Wt.toLowerCase(),Ir;try{Ir=Ce[wr]=z.getExtension(wr)}catch(Rr){}return!!Ir}for(var rr=0;rr<xe.extensions.length;++rr){var kt=xe.extensions[rr];if(!Ft(kt))return xe.onDestroy(),xe.onDone('"'+kt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return xe.optionalExtensions.forEach(Ft),{extensions:Ce,restore:function(){Object.keys(Ce).forEach(function(Wt){if(Ce[Wt]&&!Ft(Wt))throw new Error("(regl): error restoring extension "+Wt)})}}}function K(z,xe){for(var Ce=Array(z),Ft=0;Ft<z;++Ft)Ce[Ft]=xe(Ft);return Ce}var ie=5120,_e=5121,Le=5122,Ke=5123,it=5124,he=5125,Oe=5126;function wt(z){for(var xe=16;xe<=1<<28;xe*=16)if(z<=xe)return xe;return 0}function br(z){var xe,Ce;return xe=(z>65535)<<4,z>>>=xe,Ce=(z>255)<<3,z>>>=Ce,xe|=Ce,Ce=(z>15)<<2,z>>>=Ce,xe|=Ce,Ce=(z>3)<<1,z>>>=Ce,xe|=Ce,xe|z>>1}function Mr(){var z=K(8,function(){return[]});function xe(kt){var Wt=wt(kt),wr=z[br(Wt)>>2];return wr.length>0?wr.pop():new ArrayBuffer(Wt)}function Ce(kt){z[br(kt.byteLength)>>2].push(kt)}function Ft(kt,Wt){var wr=null;switch(kt){case ie:wr=new Int8Array(xe(Wt),0,Wt);break;case _e:wr=new Uint8Array(xe(Wt),0,Wt);break;case Le:wr=new Int16Array(xe(2*Wt),0,Wt);break;case Ke:wr=new Uint16Array(xe(2*Wt),0,Wt);break;case it:wr=new Int32Array(xe(4*Wt),0,Wt);break;case he:wr=new Uint32Array(xe(4*Wt),0,Wt);break;case Oe:wr=new Float32Array(xe(4*Wt),0,Wt);break;default:return null}return wr.length!==Wt?wr.subarray(0,Wt):wr}function rr(kt){Ce(kt.buffer)}return{alloc:xe,free:Ce,allocType:Ft,freeType:rr}}var Rt=Mr();Rt.zero=Mr();var mr=3408,mn=3410,sn=3411,Qt=3412,je=3413,qr=3414,Q=3415,ri=33901,en=33902,Jn=3379,Zi=3386,ni=34921,Ii=36347,hi=36348,yo=35661,Fi=35660,ea=34930,vi=36349,si=34076,Qn=34024,ba=7936,Is=7937,Qi=7938,fa=35724,Ou=34047,Du=36063,sa=34852,oo=3553,Oa=34067,Sa=34069,Ro=33984,Vi=6408,Oo=5126,_o=5121,ns=36160,is=36053,Gc=36064,Ho=16384,Da=function(z,xe){var Ce=1;xe.ext_texture_filter_anisotropic&&(Ce=z.getParameter(Ou));var Ft=1,rr=1;xe.webgl_draw_buffers&&(Ft=z.getParameter(sa),rr=z.getParameter(Du));var kt=!!xe.oes_texture_float;if(kt){var Wt=z.createTexture();z.bindTexture(oo,Wt),z.texImage2D(oo,0,Vi,1,1,0,Vi,Oo,null);var wr=z.createFramebuffer();if(z.bindFramebuffer(ns,wr),z.framebufferTexture2D(ns,Gc,oo,Wt,0),z.bindTexture(oo,null),z.checkFramebufferStatus(ns)!==is)kt=!1;else{z.viewport(0,0,1,1),z.clearColor(1,0,0,1),z.clear(Ho);var Ir=Rt.allocType(Oo,4);z.readPixels(0,0,1,1,Vi,Oo,Ir),z.getError()?kt=!1:(z.deleteFramebuffer(wr),z.deleteTexture(Wt),kt=Ir[0]===1),Rt.freeType(Ir)}}var Rr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Cr=!0;if(!Rr){var zr=z.createTexture(),$r=Rt.allocType(_o,36);z.activeTexture(Ro),z.bindTexture(Oa,zr),z.texImage2D(Sa,0,Vi,3,3,0,Vi,_o,$r),Rt.freeType($r),z.bindTexture(Oa,null),z.deleteTexture(zr),Cr=!z.getError()}return{colorBits:[z.getParameter(mn),z.getParameter(sn),z.getParameter(Qt),z.getParameter(je)],depthBits:z.getParameter(qr),stencilBits:z.getParameter(Q),subpixelBits:z.getParameter(mr),extensions:Object.keys(xe).filter(function(Ar){return!!xe[Ar]}),maxAnisotropic:Ce,maxDrawbuffers:Ft,maxColorAttachments:rr,pointSizeDims:z.getParameter(ri),lineWidthDims:z.getParameter(en),maxViewportDims:z.getParameter(Zi),maxCombinedTextureUnits:z.getParameter(yo),maxCubeMapSize:z.getParameter(si),maxRenderbufferSize:z.getParameter(Qn),maxTextureUnits:z.getParameter(ea),maxTextureSize:z.getParameter(Jn),maxAttributes:z.getParameter(ni),maxVertexUniforms:z.getParameter(Ii),maxVertexTextureUnits:z.getParameter(Fi),maxVaryingVectors:z.getParameter(hi),maxFragmentUniforms:z.getParameter(vi),glsl:z.getParameter(fa),renderer:z.getParameter(Is),vendor:z.getParameter(ba),version:z.getParameter(Qi),readFloat:kt,npotTextureCube:Cr}};function Ga(z){return!!z&&typeof z=="object"&&Array.isArray(z.shape)&&Array.isArray(z.stride)&&typeof z.offset=="number"&&z.shape.length===z.stride.length&&(Array.isArray(z.data)||te(z.data))}var Mt=function(z){return Object.keys(z).map(function(xe){return z[xe]})},j={shape:Ri,flatten:Tn};function P(z,xe,Ce){for(var Ft=0;Ft<xe;++Ft)Ce[Ft]=z[Ft]}function rt(z,xe,Ce,Ft){for(var rr=0,kt=0;kt<xe;++kt)for(var Wt=z[kt],wr=0;wr<Ce;++wr)Ft[rr++]=Wt[wr]}function qt(z,xe,Ce,Ft,rr,kt){for(var Wt=kt,wr=0;wr<xe;++wr)for(var Ir=z[wr],Rr=0;Rr<Ce;++Rr)for(var Cr=Ir[Rr],zr=0;zr<Ft;++zr)rr[Wt++]=Cr[zr]}function jr(z,xe,Ce,Ft,rr){for(var kt=1,Wt=Ce+1;Wt<xe.length;++Wt)kt*=xe[Wt];var wr=xe[Ce];if(xe.length-Ce==4){var Ir=xe[Ce+1],Rr=xe[Ce+2],Cr=xe[Ce+3];for(Wt=0;Wt<wr;++Wt)qt(z[Wt],Ir,Rr,Cr,Ft,rr),rr+=kt}else for(Wt=0;Wt<wr;++Wt)jr(z[Wt],xe,Ce+1,Ft,rr),rr+=kt}function Tn(z,xe,Ce,Ft){var rr=1;if(xe.length)for(var kt=0;kt<xe.length;++kt)rr*=xe[kt];else rr=0;var Wt=Ft||Rt.allocType(Ce,rr);switch(xe.length){case 0:break;case 1:P(z,xe[0],Wt);break;case 2:rt(z,xe[0],xe[1],Wt);break;case 3:qt(z,xe[0],xe[1],xe[2],Wt,0);break;default:jr(z,xe,0,Wt,0)}return Wt}function Ri(z){for(var xe=[],Ce=z;Ce.length;Ce=Ce[0])xe.push(Ce.length);return xe}var Fa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},so=5120,Ha=5122,as=5124,Xr=5121,Jr=5123,Qe=5125,gs=5126,Fu=5126,os={int8:so,int16:Ha,int32:as,uint8:Xr,uint16:Jr,uint32:Qe,float:gs,float32:Fu},iu=35048,au=35040,ss={dynamic:iu,stream:au,static:35044},Dl=j.flatten,Jo=j.shape,wa=35044,Fl=35040,hc=5121,Sf=5126,ou=[];ou[5120]=1,ou[5122]=2,ou[5124]=4,ou[5121]=1,ou[5123]=2,ou[5125]=4,ou[5126]=4;function Bl(z){return Fa[Object.prototype.toString.call(z)]|0}function zl(z,xe){for(var Ce=0;Ce<xe.length;++Ce)z[Ce]=xe[Ce]}function wf(z,xe,Ce,Ft,rr,kt,Wt){for(var wr=0,Ir=0;Ir<Ce;++Ir)for(var Rr=0;Rr<Ft;++Rr)z[wr++]=xe[rr*Ir+kt*Rr+Wt]}function sh(z,xe,Ce,Ft){var rr=0,kt={};function Wt(gt){this.id=rr++,this.buffer=z.createBuffer(),this.type=gt,this.usage=wa,this.byteLength=0,this.dimension=1,this.dtype=hc,this.persistentData=null,Ce.profile&&(this.stats={size:0})}Wt.prototype.bind=function(){z.bindBuffer(this.type,this.buffer)},Wt.prototype.destroy=function(){$r(this)};var wr=[];function Ir(gt,Vt){var Tr=wr.pop();return Tr||(Tr=new Wt(gt)),Tr.bind(),zr(Tr,Vt,Fl,0,1,!1),Tr}function Rr(gt){wr.push(gt)}function Cr(gt,Vt,Tr){gt.byteLength=Vt.byteLength,z.bufferData(gt.type,Vt,Tr)}function zr(gt,Vt,Tr,Qr,vr,an){var gr;if(gt.usage=Tr,Array.isArray(Vt)){if(gt.dtype=Qr||Sf,Vt.length>0){var Gr;if(Array.isArray(Vt[0])){gr=Jo(Vt);for(var at=1,Nr=1;Nr<gr.length;++Nr)at*=gr[Nr];gt.dimension=at,Gr=Dl(Vt,gr,gt.dtype),Cr(gt,Gr,Tr),an?gt.persistentData=Gr:Rt.freeType(Gr)}else if(typeof Vt[0]=="number"){gt.dimension=vr;var qe=Rt.allocType(gt.dtype,Vt.length);zl(qe,Vt),Cr(gt,qe,Tr),an?gt.persistentData=qe:Rt.freeType(qe)}else te(Vt[0])?(gt.dimension=Vt[0].length,gt.dtype=Qr||Bl(Vt[0])||Sf,Gr=Dl(Vt,[Vt.length,Vt[0].length],gt.dtype),Cr(gt,Gr,Tr),an?gt.persistentData=Gr:Rt.freeType(Gr)):R.raise("invalid buffer data")}}else if(te(Vt))gt.dtype=Qr||Bl(Vt),gt.dimension=vr,Cr(gt,Vt,Tr),an&&(gt.persistentData=new Uint8Array(new Uint8Array(Vt.buffer)));else if(Ga(Vt)){gr=Vt.shape;var Rn=Vt.stride,Vr=Vt.offset,pr=0,ur=0,jn=0,On=0;gr.length===1?(pr=gr[0],ur=1,jn=Rn[0],On=0):gr.length===2?(pr=gr[0],ur=gr[1],jn=Rn[0],On=Rn[1]):R.raise("invalid shape"),gt.dtype=Qr||Bl(Vt.data)||Sf,gt.dimension=ur;var _n=Rt.allocType(gt.dtype,pr*ur);wf(_n,Vt.data,pr,ur,jn,On,Vr),Cr(gt,_n,Tr),an?gt.persistentData=_n:Rt.freeType(_n)}else Vt instanceof ArrayBuffer?(gt.dtype=hc,gt.dimension=vr,Cr(gt,Vt,Tr),an&&(gt.persistentData=new Uint8Array(new Uint8Array(Vt)))):R.raise("invalid buffer data")}function $r(gt){xe.bufferCount--,Ft(gt);var Vt=gt.buffer;R(Vt,"buffer must not be deleted already"),z.deleteBuffer(Vt),gt.buffer=null,delete kt[gt.id]}function Ar(gt,Vt,Tr,Qr){xe.bufferCount++;var vr=new Wt(Vt);kt[vr.id]=vr;function an(at){var Nr=wa,qe=null,Rn=0,Vr=0,pr=1;return Array.isArray(at)||te(at)||Ga(at)||at instanceof ArrayBuffer?qe=at:typeof at=="number"?Rn=at|0:at&&(R.type(at,"object","buffer arguments must be an object, a number or an array"),"data"in at&&(R(qe===null||Array.isArray(qe)||te(qe)||Ga(qe),"invalid data for buffer"),qe=at.data),"usage"in at&&(R.parameter(at.usage,ss,"invalid buffer usage"),Nr=ss[at.usage]),"type"in at&&(R.parameter(at.type,os,"invalid buffer type"),Vr=os[at.type]),"dimension"in at&&(R.type(at.dimension,"number","invalid dimension"),pr=at.dimension|0),"length"in at&&(R.nni(Rn,"buffer length must be a nonnegative integer"),Rn=at.length|0)),vr.bind(),qe?zr(vr,qe,Nr,Vr,pr,Qr):(Rn&&z.bufferData(vr.type,Rn,Nr),vr.dtype=Vr||hc,vr.usage=Nr,vr.dimension=pr,vr.byteLength=Rn),Ce.profile&&(vr.stats.size=vr.byteLength*ou[vr.dtype]),an}function gr(at,Nr){R(Nr+at.byteLength<=vr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+at.byteLength+" starting from offset "+Nr+" to a buffer of size "+vr.byteLength),z.bufferSubData(vr.type,Nr,at)}function Gr(at,Nr){var qe=(Nr||0)|0,Rn;if(vr.bind(),te(at)||at instanceof ArrayBuffer)gr(at,qe);else if(Array.isArray(at)){if(at.length>0)if(typeof at[0]=="number"){var Vr=Rt.allocType(vr.dtype,at.length);zl(Vr,at),gr(Vr,qe),Rt.freeType(Vr)}else if(Array.isArray(at[0])||te(at[0])){Rn=Jo(at);var pr=Dl(at,Rn,vr.dtype);gr(pr,qe),Rt.freeType(pr)}else R.raise("invalid buffer data")}else if(Ga(at)){Rn=at.shape;var ur=at.stride,jn=0,On=0,_n=0,_i=0;Rn.length===1?(jn=Rn[0],On=1,_n=ur[0],_i=0):Rn.length===2?(jn=Rn[0],On=Rn[1],_n=ur[0],_i=ur[1]):R.raise("invalid shape");var ei=Array.isArray(at.data)?vr.dtype:Bl(at.data),li=Rt.allocType(ei,jn*On);wf(li,at.data,jn,On,_n,_i,at.offset),gr(li,qe),Rt.freeType(li)}else R.raise("invalid data for buffer subdata");return an}return Tr||an(gt),an._reglType="buffer",an._buffer=vr,an.subdata=Gr,Ce.profile&&(an.stats=vr.stats),an.destroy=function(){$r(vr)},an}function Ur(){Mt(kt).forEach(function(gt){gt.buffer=z.createBuffer(),z.bindBuffer(gt.type,gt.buffer),z.bufferData(gt.type,gt.persistentData||gt.byteLength,gt.usage)})}return Ce.profile&&(xe.getTotalBufferSize=function(){var gt=0;return Object.keys(kt).forEach(function(Vt){gt+=kt[Vt].stats.size}),gt}),{create:Ar,createStream:Ir,destroyStream:Rr,clear:function(){Mt(kt).forEach($r),wr.forEach($r)},getBuffer:function(gt){return gt&&gt._buffer instanceof Wt?gt._buffer:null},restore:Ur,_initBuffer:zr}}var Ef=0,Af=0,uh=1,ll=1,pc=4,Cf=4,ma={points:Ef,point:Af,lines:uh,line:ll,triangles:pc,triangle:Cf,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Hc=0,Bu=1,Zs=4,gi=5120,Mo=5121,Do=5122,us=5123,zu=5124,ls=5125,Wc=34963,lh=35040,Ki=35044;function Tf(z,xe,Ce,Ft){var rr={},kt=0,Wt={uint8:Mo,uint16:us};xe.oes_element_index_uint&&(Wt.uint32=ls);function wr(Ur){this.id=kt++,rr[this.id]=this,this.buffer=Ur,this.primType=Zs,this.vertCount=0,this.type=0}wr.prototype.bind=function(){this.buffer.bind()};var Ir=[];function Rr(Ur){var gt=Ir.pop();return gt||(gt=new wr(Ce.create(null,Wc,!0,!1)._buffer)),zr(gt,Ur,lh,-1,-1,0,0),gt}function Cr(Ur){Ir.push(Ur)}function zr(Ur,gt,Vt,Tr,Qr,vr,an){Ur.buffer.bind();var gr;if(gt){var Gr=an;!an&&(!te(gt)||Ga(gt)&&!te(gt.data))&&(Gr=xe.oes_element_index_uint?ls:us),Ce._initBuffer(Ur.buffer,gt,Vt,Gr,3)}else z.bufferData(Wc,vr,Vt),Ur.buffer.dtype=gr||Mo,Ur.buffer.usage=Vt,Ur.buffer.dimension=3,Ur.buffer.byteLength=vr;if(gr=an,!an){switch(Ur.buffer.dtype){case Mo:case gi:gr=Mo;break;case us:case Do:gr=us;break;case ls:case zu:gr=ls;break;default:R.raise("unsupported type for element array")}Ur.buffer.dtype=gr}Ur.type=gr,R(gr!==ls||!!xe.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var at=Qr;at<0&&(at=Ur.buffer.byteLength,gr===us?at>>=1:gr===ls&&(at>>=2)),Ur.vertCount=at;var Nr=Tr;if(Tr<0){Nr=Zs;var qe=Ur.buffer.dimension;qe===1&&(Nr=Hc),qe===2&&(Nr=Bu),qe===3&&(Nr=Zs)}Ur.primType=Nr}function $r(Ur){Ft.elementsCount--,R(Ur.buffer!==null,"must not double destroy elements"),delete rr[Ur.id],Ur.buffer.destroy(),Ur.buffer=null}function Ar(Ur,gt){var Vt=Ce.create(null,Wc,!0),Tr=new wr(Vt._buffer);Ft.elementsCount++;function Qr(vr){if(!vr)Vt(),Tr.primType=Zs,Tr.vertCount=0,Tr.type=Mo;else if(typeof vr=="number")Vt(vr),Tr.primType=Zs,Tr.vertCount=vr|0,Tr.type=Mo;else{var an=null,gr=Ki,Gr=-1,at=-1,Nr=0,qe=0;Array.isArray(vr)||te(vr)||Ga(vr)?an=vr:(R.type(vr,"object","invalid arguments for elements"),"data"in vr&&(an=vr.data,R(Array.isArray(an)||te(an)||Ga(an),"invalid data for element buffer")),"usage"in vr&&(R.parameter(vr.usage,ss,"invalid element buffer usage"),gr=ss[vr.usage]),"primitive"in vr&&(R.parameter(vr.primitive,ma,"invalid element buffer primitive"),Gr=ma[vr.primitive]),"count"in vr&&(R(typeof vr.count=="number"&&vr.count>=0,"invalid vertex count for elements"),at=vr.count|0),"type"in vr&&(R.parameter(vr.type,Wt,"invalid buffer type"),qe=Wt[vr.type]),"length"in vr?Nr=vr.length|0:(Nr=at,qe===us||qe===Do?Nr*=2:(qe===ls||qe===zu)&&(Nr*=4))),zr(Tr,an,gr,Gr,at,Nr,qe)}return Qr}return Qr(Ur),Qr._reglType="elements",Qr._elements=Tr,Qr.subdata=function(vr,an){return Vt.subdata(vr,an),Qr},Qr.destroy=function(){$r(Tr)},Qr}return{create:Ar,createStream:Rr,destroyStream:Cr,getElements:function(Ur){return typeof Ur=="function"&&Ur._elements instanceof wr?Ur._elements:null},clear:function(){Mt(rr).forEach($r)}}}var Us=new Float32Array(1),dc=new Uint32Array(Us.buffer),Dn=5123;function Mf(z){for(var xe=Rt.allocType(Dn,z.length),Ce=0;Ce<z.length;++Ce)if(isNaN(z[Ce]))xe[Ce]=65535;else if(z[Ce]===Infinity)xe[Ce]=31744;else if(z[Ce]===-Infinity)xe[Ce]=64512;else{Us[0]=z[Ce];var Ft=dc[0],rr=Ft>>>31<<15,kt=(Ft<<1>>>24)-127,Wt=Ft>>13&(1<<10)-1;if(kt<-24)xe[Ce]=rr;else if(kt<-14){var wr=-14-kt;xe[Ce]=rr+(Wt+(1<<10)>>wr)}else kt>15?xe[Ce]=rr+31744:xe[Ce]=rr+(kt+15<<10)+Wt}return xe}function Ta(z){return Array.isArray(z)||te(z)}var Nu=function(z){return!(z&z-1)&&!!z},Zu=34467,Wo=3553,$c=34067,vc=34069,bu=6408,Su=6406,mc=6407,Vs=6409,uo=6410,If=32854,cl=32855,ta=36194,Yc=32819,Uh=32820,Nl=33635,ch=34042,Pf=6402,gc=34041,Zl=35904,Uu=35906,su=36193,Ul=33776,fl=33777,Vu=33778,Xc=33779,hl=35986,Ps=35987,kf=34798,Lf=35840,Rf=35841,ju=35842,Vl=35843,yc=36196,Gu=5121,jl=5123,Of=5125,Hu=5126,Df=10242,fh=10243,yi=10497,Gl=33071,qc=33648,Kc=10240,Jc=10241,pl=9728,Ai=9729,qa=9984,Bi=9985,js=9986,wu=9987,Eu=33170,mi=4352,ua=4353,ys=4354,Hl=34046,Wl=3317,Qc=37440,Vh=37441,Ba=37443,dl=37444,uu=33984,Wu=[qa,js,Bi,wu],Ma=[0,Vs,uo,mc,bu],$o={};$o[Vs]=$o[Su]=$o[Pf]=1,$o[gc]=$o[uo]=2,$o[mc]=$o[Zl]=3,$o[bu]=$o[Uu]=4;function Au(z){return"[object "+z+"]"}var ha=Au("HTMLCanvasElement"),cn=Au("OffscreenCanvas"),Ka=Au("CanvasRenderingContext2D"),vl=Au("ImageBitmap"),ml=Au("HTMLImageElement"),ks=Au("HTMLVideoElement"),_s=Object.keys(Fa).concat([ha,cn,Ka,vl,ml,ks]),Gs=[];Gs[Gu]=1,Gs[Hu]=4,Gs[su]=2,Gs[jl]=2,Gs[Of]=4;var Pr=[];Pr[If]=2,Pr[cl]=2,Pr[ta]=2,Pr[gc]=4,Pr[Ul]=.5,Pr[fl]=.5,Pr[Vu]=1,Pr[Xc]=1,Pr[hl]=.5,Pr[Ps]=1,Pr[kf]=1,Pr[Lf]=.5,Pr[Rf]=.25,Pr[ju]=.5,Pr[Vl]=.25,Pr[yc]=.5;function Ff(z){return Array.isArray(z)&&(z.length===0||typeof z[0]=="number")}function _c(z){if(!Array.isArray(z))return!1;var xe=z.length;return!(xe===0||!Ta(z[0]))}function lu(z){return Object.prototype.toString.call(z)}function Ls(z){return lu(z)===ha}function Fo(z){return lu(z)===cn}function ef(z){return lu(z)===Ka}function $l(z){return lu(z)===vl}function Bo(z){return lu(z)===ml}function Cu(z){return lu(z)===ks}function tf(z){if(!z)return!1;var xe=lu(z);return _s.indexOf(xe)>=0?!0:Ff(z)||_c(z)||Ga(z)}function gl(z){return Fa[Object.prototype.toString.call(z)]|0}function hh(z,xe){var Ce=xe.length;switch(z.type){case Gu:case jl:case Of:case Hu:var Ft=Rt.allocType(z.type,Ce);Ft.set(xe),z.data=Ft;break;case su:z.data=Mf(xe);break;default:R.raise("unsupported texture type, must specify a typed array")}}function xc(z,xe){return Rt.allocType(z.type===su?Hu:z.type,xe)}function cs(z,xe){z.type===su?(z.data=Mf(xe),Rt.freeType(xe)):z.data=xe}function Rs(z,xe,Ce,Ft,rr,kt){for(var Wt=z.width,wr=z.height,Ir=z.channels,Rr=Wt*wr*Ir,Cr=xc(z,Rr),zr=0,$r=0;$r<wr;++$r)for(var Ar=0;Ar<Wt;++Ar)for(var Ur=0;Ur<Ir;++Ur)Cr[zr++]=xe[Ce*Ar+Ft*$r+rr*Ur+kt];cs(z,Cr)}function pi(z,xe,Ce,Ft,rr,kt){var Wt;if(typeof Pr[z]!="undefined"?Wt=Pr[z]:Wt=$o[z]*Gs[xe],kt&&(Wt*=6),rr){for(var wr=0,Ir=Ce;Ir>=1;)wr+=Wt*Ir*Ir,Ir/=2;return wr}else return Wt*Ce*Ft}function cu(z,xe,Ce,Ft,rr,kt,Wt){var wr={"don't care":mi,"dont care":mi,nice:ys,fast:ua},Ir={repeat:yi,clamp:Gl,mirror:qc},Rr={nearest:pl,linear:Ai},Cr=N({mipmap:wu,"nearest mipmap nearest":qa,"linear mipmap nearest":Bi,"nearest mipmap linear":js,"linear mipmap linear":wu},Rr),zr={none:0,browser:dl},$r={uint8:Gu,rgba4:Yc,rgb565:Nl,"rgb5 a1":Uh},Ar={alpha:Su,luminance:Vs,"luminance alpha":uo,rgb:mc,rgba:bu,rgba4:If,"rgb5 a1":cl,rgb565:ta},Ur={};xe.ext_srgb&&(Ar.srgb=Zl,Ar.srgba=Uu),xe.oes_texture_float&&($r.float32=$r.float=Hu),xe.oes_texture_half_float&&($r.float16=$r["half float"]=su),xe.webgl_depth_texture&&(N(Ar,{depth:Pf,"depth stencil":gc}),N($r,{uint16:jl,uint32:Of,"depth stencil":ch})),xe.webgl_compressed_texture_s3tc&&N(Ur,{"rgb s3tc dxt1":Ul,"rgba s3tc dxt1":fl,"rgba s3tc dxt3":Vu,"rgba s3tc dxt5":Xc}),xe.webgl_compressed_texture_atc&&N(Ur,{"rgb atc":hl,"rgba atc explicit alpha":Ps,"rgba atc interpolated alpha":kf}),xe.webgl_compressed_texture_pvrtc&&N(Ur,{"rgb pvrtc 4bppv1":Lf,"rgb pvrtc 2bppv1":Rf,"rgba pvrtc 4bppv1":ju,"rgba pvrtc 2bppv1":Vl}),xe.webgl_compressed_texture_etc1&&(Ur["rgb etc1"]=yc);var gt=Array.prototype.slice.call(z.getParameter(Zu));Object.keys(Ur).forEach(function(Pe){var Ot=Ur[Pe];gt.indexOf(Ot)>=0&&(Ar[Pe]=Ot)});var Vt=Object.keys(Ar);Ce.textureFormats=Vt;var Tr=[];Object.keys(Ar).forEach(function(Pe){var Ot=Ar[Pe];Tr[Ot]=Pe});var Qr=[];Object.keys($r).forEach(function(Pe){var Ot=$r[Pe];Qr[Ot]=Pe});var vr=[];Object.keys(Rr).forEach(function(Pe){var Ot=Rr[Pe];vr[Ot]=Pe});var an=[];Object.keys(Cr).forEach(function(Pe){var Ot=Cr[Pe];an[Ot]=Pe});var gr=[];Object.keys(Ir).forEach(function(Pe){var Ot=Ir[Pe];gr[Ot]=Pe});var Gr=Vt.reduce(function(Pe,Ot){var Pt=Ar[Ot];return Pt===Vs||Pt===Su||Pt===Vs||Pt===uo||Pt===Pf||Pt===gc||xe.ext_srgb&&(Pt===Zl||Pt===Uu)?Pe[Pt]=Pt:Pt===cl||Ot.indexOf("rgba")>=0?Pe[Pt]=bu:Pe[Pt]=mc,Pe},{});function at(){this.internalformat=bu,this.format=bu,this.type=Gu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=dl,this.width=0,this.height=0,this.channels=0}function Nr(Pe,Ot){Pe.internalformat=Ot.internalformat,Pe.format=Ot.format,Pe.type=Ot.type,Pe.compressed=Ot.compressed,Pe.premultiplyAlpha=Ot.premultiplyAlpha,Pe.flipY=Ot.flipY,Pe.unpackAlignment=Ot.unpackAlignment,Pe.colorSpace=Ot.colorSpace,Pe.width=Ot.width,Pe.height=Ot.height,Pe.channels=Ot.channels}function qe(Pe,Ot){if(!(typeof Ot!="object"||!Ot)){if("premultiplyAlpha"in Ot&&(R.type(Ot.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Pe.premultiplyAlpha=Ot.premultiplyAlpha),"flipY"in Ot&&(R.type(Ot.flipY,"boolean","invalid texture flip"),Pe.flipY=Ot.flipY),"alignment"in Ot&&(R.oneOf(Ot.alignment,[1,2,4,8],"invalid texture unpack alignment"),Pe.unpackAlignment=Ot.alignment),"colorSpace"in Ot&&(R.parameter(Ot.colorSpace,zr,"invalid colorSpace"),Pe.colorSpace=zr[Ot.colorSpace]),"type"in Ot){var Pt=Ot.type;R(xe.oes_texture_float||!(Pt==="float"||Pt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),R(xe.oes_texture_half_float||!(Pt==="half float"||Pt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),R(xe.webgl_depth_texture||!(Pt==="uint16"||Pt==="uint32"||Pt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),R.parameter(Pt,$r,"invalid texture type"),Pe.type=$r[Pt]}var fn=Pe.width,Si=Pe.height,we=Pe.channels,pe=!1;"shape"in Ot?(R(Array.isArray(Ot.shape)&&Ot.shape.length>=2,"shape must be an array"),fn=Ot.shape[0],Si=Ot.shape[1],Ot.shape.length===3&&(we=Ot.shape[2],R(we>0&&we<=4,"invalid number of channels"),pe=!0),R(fn>=0&&fn<=Ce.maxTextureSize,"invalid width"),R(Si>=0&&Si<=Ce.maxTextureSize,"invalid height")):("radius"in Ot&&(fn=Si=Ot.radius,R(fn>=0&&fn<=Ce.maxTextureSize,"invalid radius")),"width"in Ot&&(fn=Ot.width,R(fn>=0&&fn<=Ce.maxTextureSize,"invalid width")),"height"in Ot&&(Si=Ot.height,R(Si>=0&&Si<=Ce.maxTextureSize,"invalid height")),"channels"in Ot&&(we=Ot.channels,R(we>0&&we<=4,"invalid number of channels"),pe=!0)),Pe.width=fn|0,Pe.height=Si|0,Pe.channels=we|0;var Ye=!1;if("format"in Ot){var dt=Ot.format;R(xe.webgl_depth_texture||!(dt==="depth"||dt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),R.parameter(dt,Ar,"invalid texture format");var yt=Pe.internalformat=Ar[dt];Pe.format=Gr[yt],dt in $r&&("type"in Ot||(Pe.type=$r[dt])),dt in Ur&&(Pe.compressed=!0),Ye=!0}!pe&&Ye?Pe.channels=$o[Pe.format]:pe&&!Ye?Pe.channels!==Ma[Pe.format]&&(Pe.format=Pe.internalformat=Ma[Pe.channels]):Ye&&pe&&R(Pe.channels===$o[Pe.format],"number of channels inconsistent with specified format")}}function Rn(Pe){z.pixelStorei(Qc,Pe.flipY),z.pixelStorei(Vh,Pe.premultiplyAlpha),z.pixelStorei(Ba,Pe.colorSpace),z.pixelStorei(Wl,Pe.unpackAlignment)}function Vr(){at.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function pr(Pe,Ot){var Pt=null;if(tf(Ot)?Pt=Ot:Ot&&(R.type(Ot,"object","invalid pixel data type"),qe(Pe,Ot),"x"in Ot&&(Pe.xOffset=Ot.x|0),"y"in Ot&&(Pe.yOffset=Ot.y|0),tf(Ot.data)&&(Pt=Ot.data)),R(!Pe.compressed||Pt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Ot.copy){R(!Pt,"can not specify copy and data field for the same texture");var fn=rr.viewportWidth,Si=rr.viewportHeight;Pe.width=Pe.width||fn-Pe.xOffset,Pe.height=Pe.height||Si-Pe.yOffset,Pe.needsCopy=!0,R(Pe.xOffset>=0&&Pe.xOffset<fn&&Pe.yOffset>=0&&Pe.yOffset<Si&&Pe.width>0&&Pe.width<=fn&&Pe.height>0&&Pe.height<=Si,"copy texture read out of bounds")}else if(!Pt)Pe.width=Pe.width||1,Pe.height=Pe.height||1,Pe.channels=Pe.channels||4;else if(te(Pt))Pe.channels=Pe.channels||4,Pe.data=Pt,!("type"in Ot)&&Pe.type===Gu&&(Pe.type=gl(Pt));else if(Ff(Pt))Pe.channels=Pe.channels||4,hh(Pe,Pt),Pe.alignment=1,Pe.needsFree=!0;else if(Ga(Pt)){var we=Pt.data;!Array.isArray(we)&&Pe.type===Gu&&(Pe.type=gl(we));var pe=Pt.shape,Ye=Pt.stride,dt,yt,Ze,He,ft,Ee;pe.length===3?(Ze=pe[2],Ee=Ye[2]):(R(pe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ze=1,Ee=1),dt=pe[0],yt=pe[1],He=Ye[0],ft=Ye[1],Pe.alignment=1,Pe.width=dt,Pe.height=yt,Pe.channels=Ze,Pe.format=Pe.internalformat=Ma[Ze],Pe.needsFree=!0,Rs(Pe,we,He,ft,Ee,Pt.offset)}else if(Ls(Pt)||Fo(Pt)||ef(Pt))Ls(Pt)||Fo(Pt)?Pe.element=Pt:Pe.element=Pt.canvas,Pe.width=Pe.element.width,Pe.height=Pe.element.height,Pe.channels=4;else if($l(Pt))Pe.element=Pt,Pe.width=Pt.width,Pe.height=Pt.height,Pe.channels=4;else if(Bo(Pt))Pe.element=Pt,Pe.width=Pt.naturalWidth,Pe.height=Pt.naturalHeight,Pe.channels=4;else if(Cu(Pt))Pe.element=Pt,Pe.width=Pt.videoWidth,Pe.height=Pt.videoHeight,Pe.channels=4;else if(_c(Pt)){var Ge=Pe.width||Pt[0].length,Se=Pe.height||Pt.length,pt=Pe.channels;Ta(Pt[0][0])?pt=pt||Pt[0][0].length:pt=pt||1;for(var xt=j.shape(Pt),ar=1,Dt=0;Dt<xt.length;++Dt)ar*=xt[Dt];var er=xc(Pe,ar);j.flatten(Pt,xt,"",er),cs(Pe,er),Pe.alignment=1,Pe.width=Ge,Pe.height=Se,Pe.channels=pt,Pe.format=Pe.internalformat=Ma[pt],Pe.needsFree=!0}Pe.type===Hu?R(Ce.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Pe.type===su&&R(Ce.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function ur(Pe,Ot,Pt){var fn=Pe.element,Si=Pe.data,we=Pe.internalformat,pe=Pe.format,Ye=Pe.type,dt=Pe.width,yt=Pe.height;Rn(Pe),fn?z.texImage2D(Ot,Pt,pe,pe,Ye,fn):Pe.compressed?z.compressedTexImage2D(Ot,Pt,we,dt,yt,0,Si):Pe.needsCopy?(Ft(),z.copyTexImage2D(Ot,Pt,pe,Pe.xOffset,Pe.yOffset,dt,yt,0)):z.texImage2D(Ot,Pt,pe,dt,yt,0,pe,Ye,Si||null)}function jn(Pe,Ot,Pt,fn,Si){var we=Pe.element,pe=Pe.data,Ye=Pe.internalformat,dt=Pe.format,yt=Pe.type,Ze=Pe.width,He=Pe.height;Rn(Pe),we?z.texSubImage2D(Ot,Si,Pt,fn,dt,yt,we):Pe.compressed?z.compressedTexSubImage2D(Ot,Si,Pt,fn,Ye,Ze,He,pe):Pe.needsCopy?(Ft(),z.copyTexSubImage2D(Ot,Si,Pt,fn,Pe.xOffset,Pe.yOffset,Ze,He)):z.texSubImage2D(Ot,Si,Pt,fn,Ze,He,dt,yt,pe)}var On=[];function _n(){return On.pop()||new Vr}function _i(Pe){Pe.needsFree&&Rt.freeType(Pe.data),Vr.call(Pe),On.push(Pe)}function ei(){at.call(this),this.genMipmaps=!1,this.mipmapHint=mi,this.mipmask=0,this.images=Array(16)}function li(Pe,Ot,Pt){var fn=Pe.images[0]=_n();Pe.mipmask=1,fn.width=Pe.width=Ot,fn.height=Pe.height=Pt,fn.channels=Pe.channels=4}function Di(Pe,Ot){var Pt=null;if(tf(Ot))Pt=Pe.images[0]=_n(),Nr(Pt,Pe),pr(Pt,Ot),Pe.mipmask=1;else if(qe(Pe,Ot),Array.isArray(Ot.mipmap))for(var fn=Ot.mipmap,Si=0;Si<fn.length;++Si)Pt=Pe.images[Si]=_n(),Nr(Pt,Pe),Pt.width>>=Si,Pt.height>>=Si,pr(Pt,fn[Si]),Pe.mipmask|=1<<Si;else Pt=Pe.images[0]=_n(),Nr(Pt,Pe),pr(Pt,Ot),Pe.mipmask=1;Nr(Pe,Pe.images[0]),Pe.compressed&&(Pe.internalformat===Ul||Pe.internalformat===fl||Pe.internalformat===Vu||Pe.internalformat===Xc)&&R(Pe.width%4==0&&Pe.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Na(Pe,Ot){for(var Pt=Pe.images,fn=0;fn<Pt.length;++fn){if(!Pt[fn])return;ur(Pt[fn],Ot,fn)}}var Eo=[];function wi(){var Pe=Eo.pop()||new ei;at.call(Pe),Pe.mipmask=0;for(var Ot=0;Ot<16;++Ot)Pe.images[Ot]=null;return Pe}function Ea(Pe){for(var Ot=Pe.images,Pt=0;Pt<Ot.length;++Pt)Ot[Pt]&&_i(Ot[Pt]),Ot[Pt]=null;Eo.push(Pe)}function la(){this.minFilter=pl,this.magFilter=pl,this.wrapS=Gl,this.wrapT=Gl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=mi}function to(Pe,Ot){if("min"in Ot){var Pt=Ot.min;R.parameter(Pt,Cr),Pe.minFilter=Cr[Pt],Wu.indexOf(Pe.minFilter)>=0&&!("faces"in Ot)&&(Pe.genMipmaps=!0)}if("mag"in Ot){var fn=Ot.mag;R.parameter(fn,Rr),Pe.magFilter=Rr[fn]}var Si=Pe.wrapS,we=Pe.wrapT;if("wrap"in Ot){var pe=Ot.wrap;typeof pe=="string"?(R.parameter(pe,Ir),Si=we=Ir[pe]):Array.isArray(pe)&&(R.parameter(pe[0],Ir),R.parameter(pe[1],Ir),Si=Ir[pe[0]],we=Ir[pe[1]])}else{if("wrapS"in Ot){var Ye=Ot.wrapS;R.parameter(Ye,Ir),Si=Ir[Ye]}if("wrapT"in Ot){var dt=Ot.wrapT;R.parameter(dt,Ir),we=Ir[dt]}}if(Pe.wrapS=Si,Pe.wrapT=we,"anisotropic"in Ot){var yt=Ot.anisotropic;R(typeof yt=="number"&&yt>=1&&yt<=Ce.maxAnisotropic,"aniso samples must be between 1 and "),Pe.anisotropic=Ot.anisotropic}if("mipmap"in Ot){var Ze=!1;switch(typeof Ot.mipmap){case"string":R.parameter(Ot.mipmap,wr,"invalid mipmap hint"),Pe.mipmapHint=wr[Ot.mipmap],Pe.genMipmaps=!0,Ze=!0;break;case"boolean":Ze=Pe.genMipmaps=Ot.mipmap;break;case"object":R(Array.isArray(Ot.mipmap),"invalid mipmap type"),Pe.genMipmaps=!1,Ze=!0;break;default:R.raise("invalid mipmap type")}Ze&&!("min"in Ot)&&(Pe.minFilter=qa)}}function fo(Pe,Ot){z.texParameteri(Ot,Jc,Pe.minFilter),z.texParameteri(Ot,Kc,Pe.magFilter),z.texParameteri(Ot,Df,Pe.wrapS),z.texParameteri(Ot,fh,Pe.wrapT),xe.ext_texture_filter_anisotropic&&z.texParameteri(Ot,Hl,Pe.anisotropic),Pe.genMipmaps&&(z.hint(Eu,Pe.mipmapHint),z.generateMipmap(Ot))}var Ao=0,ko={},Vo=Ce.maxTextureUnits,$a=Array(Vo).map(function(){return null});function ui(Pe){at.call(this),this.mipmask=0,this.internalformat=bu,this.id=Ao++,this.refCount=1,this.target=Pe,this.texture=z.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new la,Wt.profile&&(this.stats={size:0})}function Yo(Pe){z.activeTexture(uu),z.bindTexture(Pe.target,Pe.texture)}function Wi(){var Pe=$a[0];Pe?z.bindTexture(Pe.target,Pe.texture):z.bindTexture(Wo,null)}function Un(Pe){var Ot=Pe.texture;R(Ot,"must not double destroy texture");var Pt=Pe.unit,fn=Pe.target;Pt>=0&&(z.activeTexture(uu+Pt),z.bindTexture(fn,null),$a[Pt]=null),z.deleteTexture(Ot),Pe.texture=null,Pe.params=null,Pe.pixels=null,Pe.refCount=0,delete ko[Pe.id],kt.textureCount--}N(ui.prototype,{bind:function(){var Pe=this;Pe.bindCount+=1;var Ot=Pe.unit;if(Ot<0){for(var Pt=0;Pt<Vo;++Pt){var fn=$a[Pt];if(fn){if(fn.bindCount>0)continue;fn.unit=-1}$a[Pt]=Pe,Ot=Pt;break}Ot>=Vo&&R.raise("insufficient number of texture units"),Wt.profile&&kt.maxTextureUnits<Ot+1&&(kt.maxTextureUnits=Ot+1),Pe.unit=Ot,z.activeTexture(uu+Ot),z.bindTexture(Pe.target,Pe.texture)}return Ot},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Un(this)}});function xi(Pe,Ot){var Pt=new ui(Wo);ko[Pt.id]=Pt,kt.textureCount++;function fn(pe,Ye){var dt=Pt.texInfo;la.call(dt);var yt=wi();return typeof pe=="number"?typeof Ye=="number"?li(yt,pe|0,Ye|0):li(yt,pe|0,pe|0):pe?(R.type(pe,"object","invalid arguments to regl.texture"),to(dt,pe),Di(yt,pe)):li(yt,1,1),dt.genMipmaps&&(yt.mipmask=(yt.width<<1)-1),Pt.mipmask=yt.mipmask,Nr(Pt,yt),R.texture2D(dt,yt,Ce),Pt.internalformat=yt.internalformat,fn.width=yt.width,fn.height=yt.height,Yo(Pt),Na(yt,Wo),fo(dt,Wo),Wi(),Ea(yt),Wt.profile&&(Pt.stats.size=pi(Pt.internalformat,Pt.type,yt.width,yt.height,dt.genMipmaps,!1)),fn.format=Tr[Pt.internalformat],fn.type=Qr[Pt.type],fn.mag=vr[dt.magFilter],fn.min=an[dt.minFilter],fn.wrapS=gr[dt.wrapS],fn.wrapT=gr[dt.wrapT],fn}function Si(pe,Ye,dt,yt){R(!!pe,"must specify image data");var Ze=Ye|0,He=dt|0,ft=yt|0,Ee=_n();return Nr(Ee,Pt),Ee.width=0,Ee.height=0,pr(Ee,pe),Ee.width=Ee.width||(Pt.width>>ft)-Ze,Ee.height=Ee.height||(Pt.height>>ft)-He,R(Pt.type===Ee.type&&Pt.format===Ee.format&&Pt.internalformat===Ee.internalformat,"incompatible format for texture.subimage"),R(Ze>=0&&He>=0&&Ze+Ee.width<=Pt.width&&He+Ee.height<=Pt.height,"texture.subimage write out of bounds"),R(Pt.mipmask&1<<ft,"missing mipmap data"),R(Ee.data||Ee.element||Ee.needsCopy,"missing image data"),Yo(Pt),jn(Ee,Wo,Ze,He,ft),Wi(),_i(Ee),fn}function we(pe,Ye){var dt=pe|0,yt=Ye|0||dt;if(dt===Pt.width&&yt===Pt.height)return fn;fn.width=Pt.width=dt,fn.height=Pt.height=yt,Yo(Pt);for(var Ze=0;Pt.mipmask>>Ze;++Ze){var He=dt>>Ze,ft=yt>>Ze;if(!He||!ft)break;z.texImage2D(Wo,Ze,Pt.format,He,ft,0,Pt.format,Pt.type,null)}return Wi(),Wt.profile&&(Pt.stats.size=pi(Pt.internalformat,Pt.type,dt,yt,!1,!1)),fn}return fn(Pe,Ot),fn.subimage=Si,fn.resize=we,fn._reglType="texture2d",fn._texture=Pt,Wt.profile&&(fn.stats=Pt.stats),fn.destroy=function(){Pt.decRef()},fn}function Pi(Pe,Ot,Pt,fn,Si,we){var pe=new ui($c);ko[pe.id]=pe,kt.cubeCount++;var Ye=new Array(6);function dt(He,ft,Ee,Ge,Se,pt){var xt,ar=pe.texInfo;for(la.call(ar),xt=0;xt<6;++xt)Ye[xt]=wi();if(typeof He=="number"||!He){var Dt=He|0||1;for(xt=0;xt<6;++xt)li(Ye[xt],Dt,Dt)}else if(typeof He=="object")if(ft)Di(Ye[0],He),Di(Ye[1],ft),Di(Ye[2],Ee),Di(Ye[3],Ge),Di(Ye[4],Se),Di(Ye[5],pt);else if(to(ar,He),qe(pe,He),"faces"in He){var er=He.faces;for(R(Array.isArray(er)&&er.length===6,"cube faces must be a length 6 array"),xt=0;xt<6;++xt)R(typeof er[xt]=="object"&&!!er[xt],"invalid input for cube map face"),Nr(Ye[xt],pe),Di(Ye[xt],er[xt])}else for(xt=0;xt<6;++xt)Di(Ye[xt],He);else R.raise("invalid arguments to cube map");for(Nr(pe,Ye[0]),Ce.npotTextureCube||R(Nu(pe.width)&&Nu(pe.height),"your browser does not support non power or two texture dimensions"),ar.genMipmaps?pe.mipmask=(Ye[0].width<<1)-1:pe.mipmask=Ye[0].mipmask,R.textureCube(pe,ar,Ye,Ce),pe.internalformat=Ye[0].internalformat,dt.width=Ye[0].width,dt.height=Ye[0].height,Yo(pe),xt=0;xt<6;++xt)Na(Ye[xt],vc+xt);for(fo(ar,$c),Wi(),Wt.profile&&(pe.stats.size=pi(pe.internalformat,pe.type,dt.width,dt.height,ar.genMipmaps,!0)),dt.format=Tr[pe.internalformat],dt.type=Qr[pe.type],dt.mag=vr[ar.magFilter],dt.min=an[ar.minFilter],dt.wrapS=gr[ar.wrapS],dt.wrapT=gr[ar.wrapT],xt=0;xt<6;++xt)Ea(Ye[xt]);return dt}function yt(He,ft,Ee,Ge,Se){R(!!ft,"must specify image data"),R(typeof He=="number"&&He===(He|0)&&He>=0&&He<6,"invalid face");var pt=Ee|0,xt=Ge|0,ar=Se|0,Dt=_n();return Nr(Dt,pe),Dt.width=0,Dt.height=0,pr(Dt,ft),Dt.width=Dt.width||(pe.width>>ar)-pt,Dt.height=Dt.height||(pe.height>>ar)-xt,R(pe.type===Dt.type&&pe.format===Dt.format&&pe.internalformat===Dt.internalformat,"incompatible format for texture.subimage"),R(pt>=0&&xt>=0&&pt+Dt.width<=pe.width&&xt+Dt.height<=pe.height,"texture.subimage write out of bounds"),R(pe.mipmask&1<<ar,"missing mipmap data"),R(Dt.data||Dt.element||Dt.needsCopy,"missing image data"),Yo(pe),jn(Dt,vc+He,pt,xt,ar),Wi(),_i(Dt),dt}function Ze(He){var ft=He|0;if(ft!==pe.width){dt.width=pe.width=ft,dt.height=pe.height=ft,Yo(pe);for(var Ee=0;Ee<6;++Ee)for(var Ge=0;pe.mipmask>>Ge;++Ge)z.texImage2D(vc+Ee,Ge,pe.format,ft>>Ge,ft>>Ge,0,pe.format,pe.type,null);return Wi(),Wt.profile&&(pe.stats.size=pi(pe.internalformat,pe.type,dt.width,dt.height,!1,!0)),dt}}return dt(Pe,Ot,Pt,fn,Si,we),dt.subimage=yt,dt.resize=Ze,dt._reglType="textureCube",dt._texture=pe,Wt.profile&&(dt.stats=pe.stats),dt.destroy=function(){pe.decRef()},dt}function ro(){for(var Pe=0;Pe<Vo;++Pe)z.activeTexture(uu+Pe),z.bindTexture(Wo,null),$a[Pe]=null;Mt(ko).forEach(Un),kt.cubeCount=0,kt.textureCount=0}Wt.profile&&(kt.getTotalTextureSize=function(){var Pe=0;return Object.keys(ko).forEach(function(Ot){Pe+=ko[Ot].stats.size}),Pe});function Ks(){for(var Pe=0;Pe<Vo;++Pe){var Ot=$a[Pe];Ot&&(Ot.bindCount=0,Ot.unit=-1,$a[Pe]=null)}Mt(ko).forEach(function(Pt){Pt.texture=z.createTexture(),z.bindTexture(Pt.target,Pt.texture);for(var fn=0;fn<32;++fn)if((Pt.mipmask&1<<fn)!=0)if(Pt.target===Wo)z.texImage2D(Wo,fn,Pt.internalformat,Pt.width>>fn,Pt.height>>fn,0,Pt.internalformat,Pt.type,null);else for(var Si=0;Si<6;++Si)z.texImage2D(vc+Si,fn,Pt.internalformat,Pt.width>>fn,Pt.height>>fn,0,Pt.internalformat,Pt.type,null);fo(Pt.texInfo,Pt.target)})}function Pu(){for(var Pe=0;Pe<Vo;++Pe){var Ot=$a[Pe];Ot&&(Ot.bindCount=0,Ot.unit=-1,$a[Pe]=null),z.activeTexture(uu+Pe),z.bindTexture(Wo,null),z.bindTexture($c,null)}}return{create2D:xi,createCube:Pi,clear:ro,getTexture:function(Pe){return null},restore:Ks,refresh:Pu}}var xo=36161,zi=32854,yl=32855,$u=36194,Hs=33189,zo=36168,bc=34041,An=35907,dn=34836,Yu=34842,Io=34843,Wa=[];Wa[zi]=2,Wa[yl]=2,Wa[$u]=2,Wa[Hs]=2,Wa[zo]=1,Wa[bc]=4,Wa[An]=4,Wa[dn]=16,Wa[Yu]=8,Wa[Io]=6;function bo(z,xe,Ce){return Wa[z]*xe*Ce}var Ws=function(z,xe,Ce,Ft,rr){var kt={rgba4:zi,rgb565:$u,"rgb5 a1":yl,depth:Hs,stencil:zo,"depth stencil":bc};xe.ext_srgb&&(kt.srgba=An),xe.ext_color_buffer_half_float&&(kt.rgba16f=Yu,kt.rgb16f=Io),xe.webgl_color_buffer_float&&(kt.rgba32f=dn);var Wt=[];Object.keys(kt).forEach(function(Ar){var Ur=kt[Ar];Wt[Ur]=Ar});var wr=0,Ir={};function Rr(Ar){this.id=wr++,this.refCount=1,this.renderbuffer=Ar,this.format=zi,this.width=0,this.height=0,rr.profile&&(this.stats={size:0})}Rr.prototype.decRef=function(){--this.refCount<=0&&Cr(this)};function Cr(Ar){var Ur=Ar.renderbuffer;R(Ur,"must not double destroy renderbuffer"),z.bindRenderbuffer(xo,null),z.deleteRenderbuffer(Ur),Ar.renderbuffer=null,Ar.refCount=0,delete Ir[Ar.id],Ft.renderbufferCount--}function zr(Ar,Ur){var gt=new Rr(z.createRenderbuffer());Ir[gt.id]=gt,Ft.renderbufferCount++;function Vt(Qr,vr){var an=0,gr=0,Gr=zi;if(typeof Qr=="object"&&Qr){var at=Qr;if("shape"in at){var Nr=at.shape;R(Array.isArray(Nr)&&Nr.length>=2,"invalid renderbuffer shape"),an=Nr[0]|0,gr=Nr[1]|0}else"radius"in at&&(an=gr=at.radius|0),"width"in at&&(an=at.width|0),"height"in at&&(gr=at.height|0);"format"in at&&(R.parameter(at.format,kt,"invalid renderbuffer format"),Gr=kt[at.format])}else typeof Qr=="number"?(an=Qr|0,typeof vr=="number"?gr=vr|0:gr=an):Qr?R.raise("invalid arguments to renderbuffer constructor"):an=gr=1;if(R(an>0&&gr>0&&an<=Ce.maxRenderbufferSize&&gr<=Ce.maxRenderbufferSize,"invalid renderbuffer size"),!(an===gt.width&&gr===gt.height&&Gr===gt.format))return Vt.width=gt.width=an,Vt.height=gt.height=gr,gt.format=Gr,z.bindRenderbuffer(xo,gt.renderbuffer),z.renderbufferStorage(xo,Gr,an,gr),R(z.getError()===0,"invalid render buffer format"),rr.profile&&(gt.stats.size=bo(gt.format,gt.width,gt.height)),Vt.format=Wt[gt.format],Vt}function Tr(Qr,vr){var an=Qr|0,gr=vr|0||an;return an===gt.width&&gr===gt.height||(R(an>0&&gr>0&&an<=Ce.maxRenderbufferSize&&gr<=Ce.maxRenderbufferSize,"invalid renderbuffer size"),Vt.width=gt.width=an,Vt.height=gt.height=gr,z.bindRenderbuffer(xo,gt.renderbuffer),z.renderbufferStorage(xo,gt.format,an,gr),R(z.getError()===0,"invalid render buffer format"),rr.profile&&(gt.stats.size=bo(gt.format,gt.width,gt.height))),Vt}return Vt(Ar,Ur),Vt.resize=Tr,Vt._reglType="renderbuffer",Vt._renderbuffer=gt,rr.profile&&(Vt.stats=gt.stats),Vt.destroy=function(){gt.decRef()},Vt}rr.profile&&(Ft.getTotalRenderbufferSize=function(){var Ar=0;return Object.keys(Ir).forEach(function(Ur){Ar+=Ir[Ur].stats.size}),Ar});function $r(){Mt(Ir).forEach(function(Ar){Ar.renderbuffer=z.createRenderbuffer(),z.bindRenderbuffer(xo,Ar.renderbuffer),z.renderbufferStorage(xo,Ar.format,Ar.width,Ar.height)}),z.bindRenderbuffer(xo,null)}return{create:zr,clear:function(){Mt(Ir).forEach(Cr)},restore:$r}},fu=36160,Yl=36161,Oi=3553,ra=34069,Bf=36064,Xu=36096,zf=36128,Tu=33306,Qo=36053,Sc=36054,Mu=36055,_l=36057,Xl=36061,ql=36193,rf=5121,wc=5126,qu=6407,Ec=6408,Ku=6402,Ju=[qu,Ec],Ac=[];Ac[Ec]=4,Ac[qu]=3;var $s=[];$s[rf]=1,$s[wc]=4,$s[ql]=2;var Os=32854,nf=32855,af=36194,Nf=33189,of=36168,f=34041,d=35907,h=34836,g=34842,w=34843,C=[Os,nf,af,d,g,w,h],T={};T[Qo]="complete",T[Sc]="incomplete attachment",T[_l]="incomplete dimensions",T[Mu]="incomplete, missing attachment",T[Xl]="unsupported";function L(z,xe,Ce,Ft,rr,kt){var Wt={cur:null,next:null,dirty:!1,setFBO:null},wr=["rgba"],Ir=["rgba4","rgb565","rgb5 a1"];xe.ext_srgb&&Ir.push("srgba"),xe.ext_color_buffer_half_float&&Ir.push("rgba16f","rgb16f"),xe.webgl_color_buffer_float&&Ir.push("rgba32f");var Rr=["uint8"];xe.oes_texture_half_float&&Rr.push("half float","float16"),xe.oes_texture_float&&Rr.push("float","float32");function Cr(Vr,pr,ur){this.target=Vr,this.texture=pr,this.renderbuffer=ur;var jn=0,On=0;pr?(jn=pr.width,On=pr.height):ur&&(jn=ur.width,On=ur.height),this.width=jn,this.height=On}function zr(Vr){Vr&&(Vr.texture&&Vr.texture._texture.decRef(),Vr.renderbuffer&&Vr.renderbuffer._renderbuffer.decRef())}function $r(Vr,pr,ur){if(!!Vr)if(Vr.texture){var jn=Vr.texture._texture,On=Math.max(1,jn.width),_n=Math.max(1,jn.height);R(On===pr&&_n===ur,"inconsistent width/height for supplied texture"),jn.refCount+=1}else{var _i=Vr.renderbuffer._renderbuffer;R(_i.width===pr&&_i.height===ur,"inconsistent width/height for renderbuffer"),_i.refCount+=1}}function Ar(Vr,pr){pr&&(pr.texture?z.framebufferTexture2D(fu,Vr,pr.target,pr.texture._texture.texture,0):z.framebufferRenderbuffer(fu,Vr,Yl,pr.renderbuffer._renderbuffer.renderbuffer))}function Ur(Vr){var pr=Oi,ur=null,jn=null,On=Vr;typeof Vr=="object"&&(On=Vr.data,"target"in Vr&&(pr=Vr.target|0)),R.type(On,"function","invalid attachment data");var _n=On._reglType;return _n==="texture2d"?(ur=On,R(pr===Oi)):_n==="textureCube"?(ur=On,R(pr>=ra&&pr<ra+6,"invalid cube map target")):_n==="renderbuffer"?(jn=On,pr=Yl):R.raise("invalid regl object for attachment"),new Cr(pr,ur,jn)}function gt(Vr,pr,ur,jn,On){if(ur){var _n=Ft.create2D({width:Vr,height:pr,format:jn,type:On});return _n._texture.refCount=0,new Cr(Oi,_n,null)}else{var _i=rr.create({width:Vr,height:pr,format:jn});return _i._renderbuffer.refCount=0,new Cr(Yl,null,_i)}}function Vt(Vr){return Vr&&(Vr.texture||Vr.renderbuffer)}function Tr(Vr,pr,ur){Vr&&(Vr.texture?Vr.texture.resize(pr,ur):Vr.renderbuffer&&Vr.renderbuffer.resize(pr,ur),Vr.width=pr,Vr.height=ur)}var Qr=0,vr={};function an(){this.id=Qr++,vr[this.id]=this,this.framebuffer=z.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function gr(Vr){Vr.colorAttachments.forEach(zr),zr(Vr.depthAttachment),zr(Vr.stencilAttachment),zr(Vr.depthStencilAttachment)}function Gr(Vr){var pr=Vr.framebuffer;R(pr,"must not double destroy framebuffer"),z.deleteFramebuffer(pr),Vr.framebuffer=null,kt.framebufferCount--,delete vr[Vr.id]}function at(Vr){var pr;z.bindFramebuffer(fu,Vr.framebuffer);var ur=Vr.colorAttachments;for(pr=0;pr<ur.length;++pr)Ar(Bf+pr,ur[pr]);for(pr=ur.length;pr<Ce.maxColorAttachments;++pr)z.framebufferTexture2D(fu,Bf+pr,Oi,null,0);z.framebufferTexture2D(fu,Tu,Oi,null,0),z.framebufferTexture2D(fu,Xu,Oi,null,0),z.framebufferTexture2D(fu,zf,Oi,null,0),Ar(Xu,Vr.depthAttachment),Ar(zf,Vr.stencilAttachment),Ar(Tu,Vr.depthStencilAttachment);var jn=z.checkFramebufferStatus(fu);!z.isContextLost()&&jn!==Qo&&R.raise("framebuffer configuration not supported, status = "+T[jn]),z.bindFramebuffer(fu,Wt.next?Wt.next.framebuffer:null),Wt.cur=Wt.next,z.getError()}function Nr(Vr,pr){var ur=new an;kt.framebufferCount++;function jn(_n,_i){var ei;R(Wt.next!==ur,"can not update framebuffer which is currently in use");var li=0,Di=0,Na=!0,Eo=!0,wi=null,Ea=!0,la="rgba",to="uint8",fo=1,Ao=null,ko=null,Vo=null,$a=!1;if(typeof _n=="number")li=_n|0,Di=_i|0||li;else if(!_n)li=Di=1;else{R.type(_n,"object","invalid arguments for framebuffer");var ui=_n;if("shape"in ui){var Yo=ui.shape;R(Array.isArray(Yo)&&Yo.length>=2,"invalid shape for framebuffer"),li=Yo[0],Di=Yo[1]}else"radius"in ui&&(li=Di=ui.radius),"width"in ui&&(li=ui.width),"height"in ui&&(Di=ui.height);("color"in ui||"colors"in ui)&&(wi=ui.color||ui.colors,Array.isArray(wi)&&R(wi.length===1||xe.webgl_draw_buffers,"multiple render targets not supported")),wi||("colorCount"in ui&&(fo=ui.colorCount|0,R(fo>0,"invalid color buffer count")),"colorTexture"in ui&&(Ea=!!ui.colorTexture,la="rgba4"),"colorType"in ui&&(to=ui.colorType,Ea?(R(xe.oes_texture_float||!(to==="float"||to==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),R(xe.oes_texture_half_float||!(to==="half float"||to==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):to==="half float"||to==="float16"?(R(xe.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),la="rgba16f"):(to==="float"||to==="float32")&&(R(xe.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),la="rgba32f"),R.oneOf(to,Rr,"invalid color type")),"colorFormat"in ui&&(la=ui.colorFormat,wr.indexOf(la)>=0?Ea=!0:Ir.indexOf(la)>=0?Ea=!1:Ea?R.oneOf(ui.colorFormat,wr,"invalid color format for texture"):R.oneOf(ui.colorFormat,Ir,"invalid color format for renderbuffer"))),("depthTexture"in ui||"depthStencilTexture"in ui)&&($a=!!(ui.depthTexture||ui.depthStencilTexture),R(!$a||xe.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in ui&&(typeof ui.depth=="boolean"?Na=ui.depth:(Ao=ui.depth,Eo=!1)),"stencil"in ui&&(typeof ui.stencil=="boolean"?Eo=ui.stencil:(ko=ui.stencil,Na=!1)),"depthStencil"in ui&&(typeof ui.depthStencil=="boolean"?Na=Eo=ui.depthStencil:(Vo=ui.depthStencil,Na=!1,Eo=!1))}var Wi=null,Un=null,xi=null,Pi=null;if(Array.isArray(wi))Wi=wi.map(Ur);else if(wi)Wi=[Ur(wi)];else for(Wi=new Array(fo),ei=0;ei<fo;++ei)Wi[ei]=gt(li,Di,Ea,la,to);R(xe.webgl_draw_buffers||Wi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),R(Wi.length<=Ce.maxColorAttachments,"too many color attachments, not supported"),li=li||Wi[0].width,Di=Di||Wi[0].height,Ao?Un=Ur(Ao):Na&&!Eo&&(Un=gt(li,Di,$a,"depth","uint32")),ko?xi=Ur(ko):Eo&&!Na&&(xi=gt(li,Di,!1,"stencil","uint8")),Vo?Pi=Ur(Vo):!Ao&&!ko&&Eo&&Na&&(Pi=gt(li,Di,$a,"depth stencil","depth stencil")),R(!!Ao+!!ko+!!Vo<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ro=null;for(ei=0;ei<Wi.length;++ei)if($r(Wi[ei],li,Di),R(!Wi[ei]||Wi[ei].texture&&Ju.indexOf(Wi[ei].texture._texture.format)>=0||Wi[ei].renderbuffer&&C.indexOf(Wi[ei].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ei+" is invalid"),Wi[ei]&&Wi[ei].texture){var Ks=Ac[Wi[ei].texture._texture.format]*$s[Wi[ei].texture._texture.type];ro===null?ro=Ks:R(ro===Ks,"all color attachments much have the same number of bits per pixel.")}return $r(Un,li,Di),R(!Un||Un.texture&&Un.texture._texture.format===Ku||Un.renderbuffer&&Un.renderbuffer._renderbuffer.format===Nf,"invalid depth attachment for framebuffer object"),$r(xi,li,Di),R(!xi||xi.renderbuffer&&xi.renderbuffer._renderbuffer.format===of,"invalid stencil attachment for framebuffer object"),$r(Pi,li,Di),R(!Pi||Pi.texture&&Pi.texture._texture.format===f||Pi.renderbuffer&&Pi.renderbuffer._renderbuffer.format===f,"invalid depth-stencil attachment for framebuffer object"),gr(ur),ur.width=li,ur.height=Di,ur.colorAttachments=Wi,ur.depthAttachment=Un,ur.stencilAttachment=xi,ur.depthStencilAttachment=Pi,jn.color=Wi.map(Vt),jn.depth=Vt(Un),jn.stencil=Vt(xi),jn.depthStencil=Vt(Pi),jn.width=ur.width,jn.height=ur.height,at(ur),jn}function On(_n,_i){R(Wt.next!==ur,"can not resize a framebuffer which is currently in use");var ei=Math.max(_n|0,1),li=Math.max(_i|0||ei,1);if(ei===ur.width&&li===ur.height)return jn;for(var Di=ur.colorAttachments,Na=0;Na<Di.length;++Na)Tr(Di[Na],ei,li);return Tr(ur.depthAttachment,ei,li),Tr(ur.stencilAttachment,ei,li),Tr(ur.depthStencilAttachment,ei,li),ur.width=jn.width=ei,ur.height=jn.height=li,at(ur),jn}return jn(Vr,pr),N(jn,{resize:On,_reglType:"framebuffer",_framebuffer:ur,destroy:function(){Gr(ur),gr(ur)},use:function(_n){Wt.setFBO({framebuffer:jn},_n)}})}function qe(Vr){var pr=Array(6);function ur(On){var _n;R(pr.indexOf(Wt.next)<0,"can not update framebuffer which is currently in use");var _i={color:null},ei=0,li=null,Di="rgba",Na="uint8",Eo=1;if(typeof On=="number")ei=On|0;else if(!On)ei=1;else{R.type(On,"object","invalid arguments for framebuffer");var wi=On;if("shape"in wi){var Ea=wi.shape;R(Array.isArray(Ea)&&Ea.length>=2,"invalid shape for framebuffer"),R(Ea[0]===Ea[1],"cube framebuffer must be square"),ei=Ea[0]}else"radius"in wi&&(ei=wi.radius|0),"width"in wi?(ei=wi.width|0,"height"in wi&&R(wi.height===ei,"must be square")):"height"in wi&&(ei=wi.height|0);("color"in wi||"colors"in wi)&&(li=wi.color||wi.colors,Array.isArray(li)&&R(li.length===1||xe.webgl_draw_buffers,"multiple render targets not supported")),li||("colorCount"in wi&&(Eo=wi.colorCount|0,R(Eo>0,"invalid color buffer count")),"colorType"in wi&&(R.oneOf(wi.colorType,Rr,"invalid color type"),Na=wi.colorType),"colorFormat"in wi&&(Di=wi.colorFormat,R.oneOf(wi.colorFormat,wr,"invalid color format for texture"))),"depth"in wi&&(_i.depth=wi.depth),"stencil"in wi&&(_i.stencil=wi.stencil),"depthStencil"in wi&&(_i.depthStencil=wi.depthStencil)}var la;if(li)if(Array.isArray(li))for(la=[],_n=0;_n<li.length;++_n)la[_n]=li[_n];else la=[li];else{la=Array(Eo);var to={radius:ei,format:Di,type:Na};for(_n=0;_n<Eo;++_n)la[_n]=Ft.createCube(to)}for(_i.color=Array(la.length),_n=0;_n<la.length;++_n){var fo=la[_n];R(typeof fo=="function"&&fo._reglType==="textureCube","invalid cube map"),ei=ei||fo.width,R(fo.width===ei&&fo.height===ei,"invalid cube map shape"),_i.color[_n]={target:ra,data:la[_n]}}for(_n=0;_n<6;++_n){for(var Ao=0;Ao<la.length;++Ao)_i.color[Ao].target=ra+_n;_n>0&&(_i.depth=pr[0].depth,_i.stencil=pr[0].stencil,_i.depthStencil=pr[0].depthStencil),pr[_n]?pr[_n](_i):pr[_n]=Nr(_i)}return N(ur,{width:ei,height:ei,color:la})}function jn(On){var _n,_i=On|0;if(R(_i>0&&_i<=Ce.maxCubeMapSize,"invalid radius for cube fbo"),_i===ur.width)return ur;var ei=ur.color;for(_n=0;_n<ei.length;++_n)ei[_n].resize(_i);for(_n=0;_n<6;++_n)pr[_n].resize(_i);return ur.width=ur.height=_i,ur}return ur(Vr),N(ur,{faces:pr,resize:jn,_reglType:"framebufferCube",destroy:function(){pr.forEach(function(On){On.destroy()})}})}function Rn(){Wt.cur=null,Wt.next=null,Wt.dirty=!0,Mt(vr).forEach(function(Vr){Vr.framebuffer=z.createFramebuffer(),at(Vr)})}return N(Wt,{getFramebuffer:function(Vr){if(typeof Vr=="function"&&Vr._reglType==="framebuffer"){var pr=Vr._framebuffer;if(pr instanceof an)return pr}return null},create:Nr,createCube:qe,clear:function(){Mt(vr).forEach(Gr)},restore:Rn})}var k=5126,X=34962;function ae(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=k,this.offset=0,this.stride=0,this.divisor=0}function de(z,xe,Ce,Ft,rr){for(var kt=Ce.maxAttributes,Wt=new Array(kt),wr=0;wr<kt;++wr)Wt[wr]=new ae;var Ir=0,Rr={},Cr={Record:ae,scope:{},state:Wt,currentVAO:null,targetVAO:null,restore:$r()?vr:function(){},createVAO:an,getVAO:Ur,destroyBuffer:zr,setVAO:$r()?gt:Vt,clear:$r()?Tr:function(){}};function zr(gr){for(var Gr=0;Gr<Wt.length;++Gr){var at=Wt[Gr];at.buffer===gr&&(z.disableVertexAttribArray(Gr),at.buffer=null)}}function $r(){return xe.oes_vertex_array_object}function Ar(){return xe.angle_instanced_arrays}function Ur(gr){return typeof gr=="function"&&gr._vao?gr._vao:null}function gt(gr){if(gr!==Cr.currentVAO){var Gr=$r();gr?Gr.bindVertexArrayOES(gr.vao):Gr.bindVertexArrayOES(null),Cr.currentVAO=gr}}function Vt(gr){if(gr!==Cr.currentVAO){if(gr)gr.bindAttrs();else for(var Gr=Ar(),at=0;at<Wt.length;++at){var Nr=Wt[at];Nr.buffer?(z.enableVertexAttribArray(at),z.vertexAttribPointer(at,Nr.size,Nr.type,Nr.normalized,Nr.stride,Nr.offfset),Gr&&Nr.divisor&&Gr.vertexAttribDivisorANGLE(at,Nr.divisor)):(z.disableVertexAttribArray(at),z.vertexAttrib4f(at,Nr.x,Nr.y,Nr.z,Nr.w))}Cr.currentVAO=gr}}function Tr(){Mt(Rr).forEach(function(gr){gr.destroy()})}function Qr(){this.id=++Ir,this.attributes=[];var gr=$r();gr?this.vao=gr.createVertexArrayOES():this.vao=null,Rr[this.id]=this,this.buffers=[]}Qr.prototype.bindAttrs=function(){for(var gr=Ar(),Gr=this.attributes,at=0;at<Gr.length;++at){var Nr=Gr[at];Nr.buffer?(z.enableVertexAttribArray(at),z.bindBuffer(X,Nr.buffer.buffer),z.vertexAttribPointer(at,Nr.size,Nr.type,Nr.normalized,Nr.stride,Nr.offset),gr&&Nr.divisor&&gr.vertexAttribDivisorANGLE(at,Nr.divisor)):(z.disableVertexAttribArray(at),z.vertexAttrib4f(at,Nr.x,Nr.y,Nr.z,Nr.w))}for(var qe=Gr.length;qe<kt;++qe)z.disableVertexAttribArray(qe)},Qr.prototype.refresh=function(){var gr=$r();gr&&(gr.bindVertexArrayOES(this.vao),this.bindAttrs(),Cr.currentVAO=this)},Qr.prototype.destroy=function(){if(this.vao){var gr=$r();this===Cr.currentVAO&&(Cr.currentVAO=null,gr.bindVertexArrayOES(null)),gr.deleteVertexArrayOES(this.vao),this.vao=null}Rr[this.id]&&(delete Rr[this.id],Ft.vaoCount-=1)};function vr(){var gr=$r();gr&&Mt(Rr).forEach(function(Gr){Gr.refresh()})}function an(gr){var Gr=new Qr;Ft.vaoCount+=1;function at(Nr){R(Array.isArray(Nr),"arguments to vertex array constructor must be an array"),R(Nr.length<kt,"too many attributes"),R(Nr.length>0,"must specify at least one attribute");var qe={},Rn=Gr.attributes;Rn.length=Nr.length;for(var Vr=0;Vr<Nr.length;++Vr){var pr=Nr[Vr],ur=Rn[Vr]=new ae,jn=pr.data||pr;if(Array.isArray(jn)||te(jn)||Ga(jn)){var On;Gr.buffers[Vr]&&(On=Gr.buffers[Vr],te(jn)&&On._buffer.byteLength>=jn.byteLength?On.subdata(jn):(On.destroy(),Gr.buffers[Vr]=null)),Gr.buffers[Vr]||(On=Gr.buffers[Vr]=rr.create(pr,X,!1,!0)),ur.buffer=rr.getBuffer(On),ur.size=ur.buffer.dimension|0,ur.normalized=!1,ur.type=ur.buffer.dtype,ur.offset=0,ur.stride=0,ur.divisor=0,ur.state=1,qe[Vr]=1}else rr.getBuffer(pr)?(ur.buffer=rr.getBuffer(pr),ur.size=ur.buffer.dimension|0,ur.normalized=!1,ur.type=ur.buffer.dtype,ur.offset=0,ur.stride=0,ur.divisor=0,ur.state=1):rr.getBuffer(pr.buffer)?(ur.buffer=rr.getBuffer(pr.buffer),ur.size=(+pr.size||ur.buffer.dimension)|0,ur.normalized=!!pr.normalized||!1,"type"in pr?(R.parameter(pr.type,os,"invalid buffer type"),ur.type=os[pr.type]):ur.type=ur.buffer.dtype,ur.offset=(pr.offset||0)|0,ur.stride=(pr.stride||0)|0,ur.divisor=(pr.divisor||0)|0,ur.state=1,R(ur.size>=1&&ur.size<=4,"size must be between 1 and 4"),R(ur.offset>=0,"invalid offset"),R(ur.stride>=0&&ur.stride<=255,"stride must be between 0 and 255"),R(ur.divisor>=0,"divisor must be positive"),R(!ur.divisor||!!xe.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in pr?(R(Vr>0,"first attribute must not be a constant"),ur.x=+pr.x||0,ur.y=+pr.y||0,ur.z=+pr.z||0,ur.w=+pr.w||0,ur.state=2):R(!1,"invalid attribute spec for location "+Vr)}for(var _n=0;_n<Gr.buffers.length;++_n)!qe[_n]&&Gr.buffers[_n]&&(Gr.buffers[_n].destroy(),Gr.buffers[_n]=null);return Gr.refresh(),at}return at.destroy=function(){for(var Nr=0;Nr<Gr.buffers.length;++Nr)Gr.buffers[Nr]&&Gr.buffers[Nr].destroy();Gr.buffers.length=0,Gr.destroy()},at._vao=Gr,at._reglType="vao",at(gr)}return Cr}var ge=35632,Te=35633,Re=35718,We=35721;function Ae(z,xe,Ce,Ft){var rr={},kt={};function Wt(gt,Vt,Tr,Qr){this.name=gt,this.id=Vt,this.location=Tr,this.info=Qr}function wr(gt,Vt){for(var Tr=0;Tr<gt.length;++Tr)if(gt[Tr].id===Vt.id){gt[Tr].location=Vt.location;return}gt.push(Vt)}function Ir(gt,Vt,Tr){var Qr=gt===ge?rr:kt,vr=Qr[Vt];if(!vr){var an=xe.str(Vt);vr=z.createShader(gt),z.shaderSource(vr,an),z.compileShader(vr),R.shaderError(z,vr,an,gt,Tr),Qr[Vt]=vr}return vr}var Rr={},Cr=[],zr=0;function $r(gt,Vt){this.id=zr++,this.fragId=gt,this.vertId=Vt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Ft.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Ar(gt,Vt,Tr){var Qr,vr,an=Ir(ge,gt.fragId),gr=Ir(Te,gt.vertId),Gr=gt.program=z.createProgram();if(z.attachShader(Gr,an),z.attachShader(Gr,gr),Tr)for(Qr=0;Qr<Tr.length;++Qr){var at=Tr[Qr];z.bindAttribLocation(Gr,at[0],at[1])}z.linkProgram(Gr),R.linkError(z,Gr,xe.str(gt.fragId),xe.str(gt.vertId),Vt);var Nr=z.getProgramParameter(Gr,Re);Ft.profile&&(gt.stats.uniformsCount=Nr);var qe=gt.uniforms;for(Qr=0;Qr<Nr;++Qr)if(vr=z.getActiveUniform(Gr,Qr),vr)if(vr.size>1)for(var Rn=0;Rn<vr.size;++Rn){var Vr=vr.name.replace("[0]","["+Rn+"]");wr(qe,new Wt(Vr,xe.id(Vr),z.getUniformLocation(Gr,Vr),vr))}else wr(qe,new Wt(vr.name,xe.id(vr.name),z.getUniformLocation(Gr,vr.name),vr));var pr=z.getProgramParameter(Gr,We);Ft.profile&&(gt.stats.attributesCount=pr);var ur=gt.attributes;for(Qr=0;Qr<pr;++Qr)vr=z.getActiveAttrib(Gr,Qr),vr&&wr(ur,new Wt(vr.name,xe.id(vr.name),z.getAttribLocation(Gr,vr.name),vr))}Ft.profile&&(Ce.getMaxUniformsCount=function(){var gt=0;return Cr.forEach(function(Vt){Vt.stats.uniformsCount>gt&&(gt=Vt.stats.uniformsCount)}),gt},Ce.getMaxAttributesCount=function(){var gt=0;return Cr.forEach(function(Vt){Vt.stats.attributesCount>gt&&(gt=Vt.stats.attributesCount)}),gt});function Ur(){rr={},kt={};for(var gt=0;gt<Cr.length;++gt)Ar(Cr[gt],null,Cr[gt].attributes.map(function(Vt){return[Vt.location,Vt.name]}))}return{clear:function(){var gt=z.deleteShader.bind(z);Mt(rr).forEach(gt),rr={},Mt(kt).forEach(gt),kt={},Cr.forEach(function(Vt){z.deleteProgram(Vt.program)}),Cr.length=0,Rr={},Ce.shaderCount=0},program:function(gt,Vt,Tr,Qr){R.command(gt>=0,"missing vertex shader",Tr),R.command(Vt>=0,"missing fragment shader",Tr);var vr=Rr[Vt];vr||(vr=Rr[Vt]={});var an=vr[gt];if(an&&(an.refCount++,!Qr))return an;var gr=new $r(Vt,gt);return Ce.shaderCount++,Ar(gr,Tr,Qr),an||(vr[gt]=gr),Cr.push(gr),N(gr,{destroy:function(){if(gr.refCount--,gr.refCount<=0){z.deleteProgram(gr.program);var Gr=Cr.indexOf(gr);Cr.splice(Gr,1),Ce.shaderCount--}vr[gr.vertId].refCount<=0&&(z.deleteShader(kt[gr.vertId]),delete kt[gr.vertId],delete Rr[gr.fragId][gr.vertId]),Object.keys(Rr[gr.fragId]).length||(z.deleteShader(rr[gr.fragId]),delete rr[gr.fragId],delete Rr[gr.fragId])}})},restore:Ur,shader:Ir,frag:-1,vert:-1}}var $e=6408,ot=5121,At=3333,Gt=5126;function Bt(z,xe,Ce,Ft,rr,kt,Wt){function wr(Cr){var zr;xe.next===null?(R(rr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),zr=ot):(R(xe.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),zr=xe.next.colorAttachments[0].texture._texture.type,kt.oes_texture_float?(R(zr===ot||zr===Gt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),zr===Gt&&R(Wt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):R(zr===ot,"Reading from a framebuffer is only allowed for the type 'uint8'"));var $r=0,Ar=0,Ur=Ft.framebufferWidth,gt=Ft.framebufferHeight,Vt=null;te(Cr)?Vt=Cr:Cr&&(R.type(Cr,"object","invalid arguments to regl.read()"),$r=Cr.x|0,Ar=Cr.y|0,R($r>=0&&$r<Ft.framebufferWidth,"invalid x offset for regl.read"),R(Ar>=0&&Ar<Ft.framebufferHeight,"invalid y offset for regl.read"),Ur=(Cr.width||Ft.framebufferWidth-$r)|0,gt=(Cr.height||Ft.framebufferHeight-Ar)|0,Vt=Cr.data||null),Vt&&(zr===ot?R(Vt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):zr===Gt&&R(Vt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),R(Ur>0&&Ur+$r<=Ft.framebufferWidth,"invalid width for read pixels"),R(gt>0&&gt+Ar<=Ft.framebufferHeight,"invalid height for read pixels"),Ce();var Tr=Ur*gt*4;return Vt||(zr===ot?Vt=new Uint8Array(Tr):zr===Gt&&(Vt=Vt||new Float32Array(Tr))),R.isTypedArray(Vt,"data buffer for regl.read() must be a typedarray"),R(Vt.byteLength>=Tr,"data buffer for regl.read() too small"),z.pixelStorei(At,4),z.readPixels($r,Ar,Ur,gt,$e,zr,Vt),Vt}function Ir(Cr){var zr;return xe.setFBO({framebuffer:Cr.framebuffer},function(){zr=wr(Cr)}),zr}function Rr(Cr){return!Cr||!("framebuffer"in Cr)?wr(Cr):Ir(Cr)}return Rr}function Ut(z){return Array.prototype.slice.call(z)}function hr(z){return Ut(z).join("")}function Zr(){var z=0,xe=[],Ce=[];function Ft(zr){for(var $r=0;$r<Ce.length;++$r)if(Ce[$r]===zr)return xe[$r];var Ar="g"+z++;return xe.push(Ar),Ce.push(zr),Ar}function rr(){var zr=[];function $r(){zr.push.apply(zr,Ut(arguments))}var Ar=[];function Ur(){var gt="v"+z++;return Ar.push(gt),arguments.length>0&&(zr.push(gt,"="),zr.push.apply(zr,Ut(arguments)),zr.push(";")),gt}return N($r,{def:Ur,toString:function(){return hr([Ar.length>0?"var "+Ar.join(",")+";":"",hr(zr)])}})}function kt(){var zr=rr(),$r=rr(),Ar=zr.toString,Ur=$r.toString;function gt(Vt,Tr){$r(Vt,Tr,"=",zr.def(Vt,Tr),";")}return N(function(){zr.apply(zr,Ut(arguments))},{def:zr.def,entry:zr,exit:$r,save:gt,set:function(Vt,Tr,Qr){gt(Vt,Tr),zr(Vt,Tr,"=",Qr,";")},toString:function(){return Ar()+Ur()}})}function Wt(){var zr=hr(arguments),$r=kt(),Ar=kt(),Ur=$r.toString,gt=Ar.toString;return N($r,{then:function(){return $r.apply($r,Ut(arguments)),this},else:function(){return Ar.apply(Ar,Ut(arguments)),this},toString:function(){var Vt=gt();return Vt&&(Vt="else{"+Vt+"}"),hr(["if(",zr,"){",Ur(),"}",Vt])}})}var wr=rr(),Ir={};function Rr(zr,$r){var Ar=[];function Ur(){var vr="a"+Ar.length;return Ar.push(vr),vr}$r=$r||0;for(var gt=0;gt<$r;++gt)Ur();var Vt=kt(),Tr=Vt.toString,Qr=Ir[zr]=N(Vt,{arg:Ur,toString:function(){return hr(["function(",Ar.join(),"){",Tr(),"}"])}});return Qr}function Cr(){var zr=['"use strict";',wr,"return {"];Object.keys(Ir).forEach(function(Ur){zr.push('"',Ur,'":',Ir[Ur].toString(),",")}),zr.push("}");var $r=hr(zr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Ar=Function.apply(null,xe.concat($r));return Ar.apply(null,Ce)}return{global:wr,link:Ft,block:rr,proc:Rr,scope:kt,cond:Wt,compile:Cr}}var kr="xyzw".split(""),rn=5121,Cn=1,Ln=2,Mn=0,Ci=1,nn=2,$n=3,ii=4,Yn=5,Wn=6,oi="dither",Hn="blend.enable",Zn="blend.color",aa="blend.equation",ga="blend.func",So="depth.enable",lo="depth.func",ya="depth.range",Ia="depth.mask",Ja="colorMask",No="cull.enable",Qu="cull.face",Zo="frontFace",Uo="lineWidth",xs="polygonOffset.enable",Ys="polygonOffset.offset",bs="sample.alpha",el="sample.enable",xl="sample.coverage",Cc="stencil.enable",hu="stencil.mask",Kl="stencil.func",Ds="stencil.opFront",Pa="stencil.opBack",pu="scissor.enable",Ss="scissor.box",es="viewport",ki="profile",co="framebuffer",wo="vert",ws="frag",tl="elements",Fs="primitive",bl="count",Iu="offset",rl="instances",Xs="vao",Sl="Width",Zf="Height",du=co+Sl,za=co+Zf,Mp=es+Sl,Ip=es+Zf,xd="drawingBuffer",bd=xd+Sl,ph=xd+Zf,Pv=[ga,aa,Kl,Ds,Pa,xl,es,Ss,Ys],Tc=34962,Pp=34963,jh=35632,kp=35633,Jl=3553,dh=34067,Lp=2884,Rp=3042,kv=3024,Lv=2960,Sd=2929,Rv=3089,Ov=32823,Gh=32926,wd=32928,Ql=5126,vh=35664,pa=35665,ec=35666,Hh=5124,Mc=35667,tc=35668,wl=35669,sf=35670,mh=35671,rc=35672,uf=35673,Ic=35674,gh=35675,nc=35676,Pc=35678,El=35680,yh=4,Al=1028,Cl=1029,Qa=2304,Lr=2305,_h=32775,Dv=32776,Po=519,fs=7680,vu=0,xh=1,Tl=32774,kc=513,Uf=36160,Fv=36064,nl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},il=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ic={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},qs={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Lc={frag:jh,vert:kp},mu={cw:Qa,ccw:Lr};function Wh(z){return Array.isArray(z)||te(z)||Ga(z)}function Op(z){return z.sort(function(xe,Ce){return xe===es?-1:Ce===es?1:xe<Ce?-1:1})}function Es(z,xe,Ce,Ft){this.thisDep=z,this.contextDep=xe,this.propDep=Ce,this.append=Ft}function gu(z){return z&&!(z.thisDep||z.contextDep||z.propDep)}function eo(z){return new Es(!1,!1,!1,z)}function As(z,xe){var Ce=z.type;if(Ce===Mn){var Ft=z.data.length;return new Es(!0,Ft>=1,Ft>=2,xe)}else if(Ce===ii){var rr=z.data;return new Es(rr.thisDep,rr.contextDep,rr.propDep,xe)}else{if(Ce===Yn)return new Es(!1,!1,!1,xe);if(Ce===Wn){for(var kt=!1,Wt=!1,wr=!1,Ir=0;Ir<z.data.length;++Ir){var Rr=z.data[Ir];if(Rr.type===Ci)wr=!0;else if(Rr.type===nn)Wt=!0;else if(Rr.type===$n)kt=!0;else if(Rr.type===Mn){kt=!0;var Cr=Rr.data;Cr>=1&&(Wt=!0),Cr>=2&&(wr=!0)}else Rr.type===ii&&(kt=kt||Rr.data.thisDep,Wt=Wt||Rr.data.contextDep,wr=wr||Rr.data.propDep)}return new Es(kt,Wt,wr,xe)}else return new Es(Ce===$n,Ce===nn,Ce===Ci,xe)}}var Ed=new Es(!1,!1,!1,function(){});function $h(z,xe,Ce,Ft,rr,kt,Wt,wr,Ir,Rr,Cr,zr,$r,Ar,Ur){var gt=Rr.Record,Vt={add:32774,subtract:32778,"reverse subtract":32779};Ce.ext_blend_minmax&&(Vt.min=_h,Vt.max=Dv);var Tr=Ce.angle_instanced_arrays,Qr=Ce.webgl_draw_buffers,vr={dirty:!0,profile:Ur.profile},an={},gr=[],Gr={},at={};function Nr(we){return we.replace(".","_")}function qe(we,pe,Ye){var dt=Nr(we);gr.push(we),an[dt]=vr[dt]=!!Ye,Gr[dt]=pe}function Rn(we,pe,Ye){var dt=Nr(we);gr.push(we),Array.isArray(Ye)?(vr[dt]=Ye.slice(),an[dt]=Ye.slice()):vr[dt]=an[dt]=Ye,at[dt]=pe}qe(oi,kv),qe(Hn,Rp),Rn(Zn,"blendColor",[0,0,0,0]),Rn(aa,"blendEquationSeparate",[Tl,Tl]),Rn(ga,"blendFuncSeparate",[xh,vu,xh,vu]),qe(So,Sd,!0),Rn(lo,"depthFunc",kc),Rn(ya,"depthRange",[0,1]),Rn(Ia,"depthMask",!0),Rn(Ja,Ja,[!0,!0,!0,!0]),qe(No,Lp),Rn(Qu,"cullFace",Cl),Rn(Zo,Zo,Lr),Rn(Uo,Uo,1),qe(xs,Ov),Rn(Ys,"polygonOffset",[0,0]),qe(bs,Gh),qe(el,wd),Rn(xl,"sampleCoverage",[1,!1]),qe(Cc,Lv),Rn(hu,"stencilMask",-1),Rn(Kl,"stencilFunc",[Po,0,-1]),Rn(Ds,"stencilOpSeparate",[Al,fs,fs,fs]),Rn(Pa,"stencilOpSeparate",[Cl,fs,fs,fs]),qe(pu,Rv),Rn(Ss,"scissor",[0,0,z.drawingBufferWidth,z.drawingBufferHeight]),Rn(es,es,[0,0,z.drawingBufferWidth,z.drawingBufferHeight]);var Vr={gl:z,context:$r,strings:xe,next:an,current:vr,draw:zr,elements:kt,buffer:rr,shader:Cr,attributes:Rr.state,vao:Rr,uniforms:Ir,framebuffer:wr,extensions:Ce,timer:Ar,isBufferArgs:Wh},pr={primTypes:ma,compareFuncs:ic,blendFuncs:nl,blendEquations:Vt,stencilOps:qs,glTypes:os,orientationType:mu};R.optional(function(){Vr.isArrayLike=Ta}),Qr&&(pr.backBuffer=[Cl],pr.drawBuffer=K(Ft.maxDrawbuffers,function(we){return we===0?[0]:K(we,function(pe){return Fv+pe})}));var ur=0;function jn(){var we=Zr(),pe=we.link,Ye=we.global;we.id=ur++,we.batchId="0";var dt=pe(Vr),yt=we.shared={props:"a0"};Object.keys(Vr).forEach(function(Ge){yt[Ge]=Ye.def(dt,".",Ge)}),R.optional(function(){we.CHECK=pe(R),we.commandStr=R.guessCommand(),we.command=pe(we.commandStr),we.assert=function(Ge,Se,pt){Ge("if(!(",Se,"))",this.CHECK,".commandRaise(",pe(pt),",",this.command,");")},pr.invalidBlendCombinations=il});var Ze=we.next={},He=we.current={};Object.keys(at).forEach(function(Ge){Array.isArray(vr[Ge])&&(Ze[Ge]=Ye.def(yt.next,".",Ge),He[Ge]=Ye.def(yt.current,".",Ge))});var ft=we.constants={};Object.keys(pr).forEach(function(Ge){ft[Ge]=Ye.def(JSON.stringify(pr[Ge]))}),we.invoke=function(Ge,Se){switch(Se.type){case Mn:var pt=["this",yt.context,yt.props,we.batchId];return Ge.def(pe(Se.data),".call(",pt.slice(0,Math.max(Se.data.length+1,4)),")");case Ci:return Ge.def(yt.props,Se.data);case nn:return Ge.def(yt.context,Se.data);case $n:return Ge.def("this",Se.data);case ii:return Se.data.append(we,Ge),Se.data.ref;case Yn:return Se.data.toString();case Wn:return Se.data.map(function(xt){return we.invoke(Ge,xt)})}},we.attribCache={};var Ee={};return we.scopeAttrib=function(Ge){var Se=xe.id(Ge);if(Se in Ee)return Ee[Se];var pt=Rr.scope[Se];pt||(pt=Rr.scope[Se]=new gt);var xt=Ee[Se]=pe(pt);return xt},we}function On(we){var pe=we.static,Ye=we.dynamic,dt;if(ki in pe){var yt=!!pe[ki];dt=eo(function(He,ft){return yt}),dt.enable=yt}else if(ki in Ye){var Ze=Ye[ki];dt=As(Ze,function(He,ft){return He.invoke(ft,Ze)})}return dt}function _n(we,pe){var Ye=we.static,dt=we.dynamic;if(co in Ye){var yt=Ye[co];return yt?(yt=wr.getFramebuffer(yt),R.command(yt,"invalid framebuffer object"),eo(function(He,ft){var Ee=He.link(yt),Ge=He.shared;ft.set(Ge.framebuffer,".next",Ee);var Se=Ge.context;return ft.set(Se,"."+du,Ee+".width"),ft.set(Se,"."+za,Ee+".height"),Ee})):eo(function(He,ft){var Ee=He.shared;ft.set(Ee.framebuffer,".next","null");var Ge=Ee.context;return ft.set(Ge,"."+du,Ge+"."+bd),ft.set(Ge,"."+za,Ge+"."+ph),"null"})}else if(co in dt){var Ze=dt[co];return As(Ze,function(He,ft){var Ee=He.invoke(ft,Ze),Ge=He.shared,Se=Ge.framebuffer,pt=ft.def(Se,".getFramebuffer(",Ee,")");R.optional(function(){He.assert(ft,"!"+Ee+"||"+pt,"invalid framebuffer object")}),ft.set(Se,".next",pt);var xt=Ge.context;return ft.set(xt,"."+du,pt+"?"+pt+".width:"+xt+"."+bd),ft.set(xt,"."+za,pt+"?"+pt+".height:"+xt+"."+ph),pt})}else return null}function _i(we,pe,Ye){var dt=we.static,yt=we.dynamic;function Ze(Ee){if(Ee in dt){var Ge=dt[Ee];R.commandType(Ge,"object","invalid "+Ee,Ye.commandStr);var Se=!0,pt=Ge.x|0,xt=Ge.y|0,ar,Dt;return"width"in Ge?(ar=Ge.width|0,R.command(ar>=0,"invalid "+Ee,Ye.commandStr)):Se=!1,"height"in Ge?(Dt=Ge.height|0,R.command(Dt>=0,"invalid "+Ee,Ye.commandStr)):Se=!1,new Es(!Se&&pe&&pe.thisDep,!Se&&pe&&pe.contextDep,!Se&&pe&&pe.propDep,function(xn,ai){var bn=xn.shared.context,zn=ar;"width"in Ge||(zn=ai.def(bn,".",du,"-",pt));var ti=Dt;return"height"in Ge||(ti=ai.def(bn,".",za,"-",xt)),[pt,xt,zn,ti]})}else if(Ee in yt){var er=yt[Ee],yr=As(er,function(xn,ai){var bn=xn.invoke(ai,er);R.optional(function(){xn.assert(ai,bn+"&&typeof "+bn+'==="object"',"invalid "+Ee)});var zn=xn.shared.context,ti=ai.def(bn,".x|0"),Ni=ai.def(bn,".y|0"),Za=ai.def('"width" in ',bn,"?",bn,".width|0:","(",zn,".",du,"-",ti,")"),Cs=ai.def('"height" in ',bn,"?",bn,".height|0:","(",zn,".",za,"-",Ni,")");return R.optional(function(){xn.assert(ai,Za+">=0&&"+Cs+">=0","invalid "+Ee)}),[ti,Ni,Za,Cs]});return pe&&(yr.thisDep=yr.thisDep||pe.thisDep,yr.contextDep=yr.contextDep||pe.contextDep,yr.propDep=yr.propDep||pe.propDep),yr}else return pe?new Es(pe.thisDep,pe.contextDep,pe.propDep,function(xn,ai){var bn=xn.shared.context;return[0,0,ai.def(bn,".",du),ai.def(bn,".",za)]}):null}var He=Ze(es);if(He){var ft=He;He=new Es(He.thisDep,He.contextDep,He.propDep,function(Ee,Ge){var Se=ft.append(Ee,Ge),pt=Ee.shared.context;return Ge.set(pt,"."+Mp,Se[2]),Ge.set(pt,"."+Ip,Se[3]),Se})}return{viewport:He,scissor_box:Ze(Ss)}}function ei(we,pe){var Ye=we.static,dt=typeof Ye[ws]=="string"&&typeof Ye[wo]=="string";if(dt){if(Object.keys(pe.dynamic).length>0)return null;var yt=pe.static,Ze=Object.keys(yt);if(Ze.length>0&&typeof yt[Ze[0]]=="number"){for(var He=[],ft=0;ft<Ze.length;++ft)R(typeof yt[Ze[ft]]=="number","must specify all vertex attribute locations when using vaos"),He.push([yt[Ze[ft]]|0,Ze[ft]]);return He}}return null}function li(we,pe,Ye){var dt=we.static,yt=we.dynamic;function Ze(Se){if(Se in dt){var pt=xe.id(dt[Se]);R.optional(function(){Cr.shader(Lc[Se],pt,R.guessCommand())});var xt=eo(function(){return pt});return xt.id=pt,xt}else if(Se in yt){var ar=yt[Se];return As(ar,function(Dt,er){var yr=Dt.invoke(er,ar),xn=er.def(Dt.shared.strings,".id(",yr,")");return R.optional(function(){er(Dt.shared.shader,".shader(",Lc[Se],",",xn,",",Dt.command,");")}),xn})}return null}var He=Ze(ws),ft=Ze(wo),Ee=null,Ge;return gu(He)&&gu(ft)?(Ee=Cr.program(ft.id,He.id,null,Ye),Ge=eo(function(Se,pt){return Se.link(Ee)})):Ge=new Es(He&&He.thisDep||ft&&ft.thisDep,He&&He.contextDep||ft&&ft.contextDep,He&&He.propDep||ft&&ft.propDep,function(Se,pt){var xt=Se.shared.shader,ar;He?ar=He.append(Se,pt):ar=pt.def(xt,".",ws);var Dt;ft?Dt=ft.append(Se,pt):Dt=pt.def(xt,".",wo);var er=xt+".program("+Dt+","+ar;return R.optional(function(){er+=","+Se.command}),pt.def(er+")")}),{frag:He,vert:ft,progVar:Ge,program:Ee}}function Di(we,pe){var Ye=we.static,dt=we.dynamic;function yt(){if(tl in Ye){var Se=Ye[tl];Wh(Se)?Se=kt.getElements(kt.create(Se,!0)):Se&&(Se=kt.getElements(Se),R.command(Se,"invalid elements",pe.commandStr));var pt=eo(function(ar,Dt){if(Se){var er=ar.link(Se);return ar.ELEMENTS=er,er}return ar.ELEMENTS=null,null});return pt.value=Se,pt}else if(tl in dt){var xt=dt[tl];return As(xt,function(ar,Dt){var er=ar.shared,yr=er.isBufferArgs,xn=er.elements,ai=ar.invoke(Dt,xt),bn=Dt.def("null"),zn=Dt.def(yr,"(",ai,")"),ti=ar.cond(zn).then(bn,"=",xn,".createStream(",ai,");").else(bn,"=",xn,".getElements(",ai,");");return R.optional(function(){ar.assert(ti.else,"!"+ai+"||"+bn,"invalid elements")}),Dt.entry(ti),Dt.exit(ar.cond(zn).then(xn,".destroyStream(",bn,");")),ar.ELEMENTS=bn,bn})}return null}var Ze=yt();function He(){if(Fs in Ye){var Se=Ye[Fs];return R.commandParameter(Se,ma,"invalid primitve",pe.commandStr),eo(function(xt,ar){return ma[Se]})}else if(Fs in dt){var pt=dt[Fs];return As(pt,function(xt,ar){var Dt=xt.constants.primTypes,er=xt.invoke(ar,pt);return R.optional(function(){xt.assert(ar,er+" in "+Dt,"invalid primitive, must be one of "+Object.keys(ma))}),ar.def(Dt,"[",er,"]")})}else if(Ze)return gu(Ze)?Ze.value?eo(function(xt,ar){return ar.def(xt.ELEMENTS,".primType")}):eo(function(){return yh}):new Es(Ze.thisDep,Ze.contextDep,Ze.propDep,function(xt,ar){var Dt=xt.ELEMENTS;return ar.def(Dt,"?",Dt,".primType:",yh)});return null}function ft(Se,pt){if(Se in Ye){var xt=Ye[Se]|0;return R.command(!pt||xt>=0,"invalid "+Se,pe.commandStr),eo(function(Dt,er){return pt&&(Dt.OFFSET=xt),xt})}else if(Se in dt){var ar=dt[Se];return As(ar,function(Dt,er){var yr=Dt.invoke(er,ar);return pt&&(Dt.OFFSET=yr,R.optional(function(){Dt.assert(er,yr+">=0","invalid "+Se)})),yr})}else if(pt&&Ze)return eo(function(Dt,er){return Dt.OFFSET="0",0});return null}var Ee=ft(Iu,!0);function Ge(){if(bl in Ye){var Se=Ye[bl]|0;return R.command(typeof Se=="number"&&Se>=0,"invalid vertex count",pe.commandStr),eo(function(){return Se})}else if(bl in dt){var pt=dt[bl];return As(pt,function(Dt,er){var yr=Dt.invoke(er,pt);return R.optional(function(){Dt.assert(er,"typeof "+yr+'==="number"&&'+yr+">=0&&"+yr+"===("+yr+"|0)","invalid vertex count")}),yr})}else if(Ze)if(gu(Ze)){if(Ze)return Ee?new Es(Ee.thisDep,Ee.contextDep,Ee.propDep,function(Dt,er){var yr=er.def(Dt.ELEMENTS,".vertCount-",Dt.OFFSET);return R.optional(function(){Dt.assert(er,yr+">=0","invalid vertex offset/element buffer too small")}),yr}):eo(function(Dt,er){return er.def(Dt.ELEMENTS,".vertCount")});var xt=eo(function(){return-1});return R.optional(function(){xt.MISSING=!0}),xt}else{var ar=new Es(Ze.thisDep||Ee.thisDep,Ze.contextDep||Ee.contextDep,Ze.propDep||Ee.propDep,function(Dt,er){var yr=Dt.ELEMENTS;return Dt.OFFSET?er.def(yr,"?",yr,".vertCount-",Dt.OFFSET,":-1"):er.def(yr,"?",yr,".vertCount:-1")});return R.optional(function(){ar.DYNAMIC=!0}),ar}return null}return{elements:Ze,primitive:He(),count:Ge(),instances:ft(rl,!1),offset:Ee}}function Na(we,pe){var Ye=we.static,dt=we.dynamic,yt={};return gr.forEach(function(Ze){var He=Nr(Ze);function ft(Ee,Ge){if(Ze in Ye){var Se=Ee(Ye[Ze]);yt[He]=eo(function(){return Se})}else if(Ze in dt){var pt=dt[Ze];yt[He]=As(pt,function(xt,ar){return Ge(xt,ar,xt.invoke(ar,pt))})}}switch(Ze){case No:case Hn:case oi:case Cc:case So:case pu:case xs:case bs:case el:case Ia:return ft(function(Ee){return R.commandType(Ee,"boolean",Ze,pe.commandStr),Ee},function(Ee,Ge,Se){return R.optional(function(){Ee.assert(Ge,"typeof "+Se+'==="boolean"',"invalid flag "+Ze,Ee.commandStr)}),Se});case lo:return ft(function(Ee){return R.commandParameter(Ee,ic,"invalid "+Ze,pe.commandStr),ic[Ee]},function(Ee,Ge,Se){var pt=Ee.constants.compareFuncs;return R.optional(function(){Ee.assert(Ge,Se+" in "+pt,"invalid "+Ze+", must be one of "+Object.keys(ic))}),Ge.def(pt,"[",Se,"]")});case ya:return ft(function(Ee){return R.command(Ta(Ee)&&Ee.length===2&&typeof Ee[0]=="number"&&typeof Ee[1]=="number"&&Ee[0]<=Ee[1],"depth range is 2d array",pe.commandStr),Ee},function(Ee,Ge,Se){R.optional(function(){Ee.assert(Ge,Ee.shared.isArrayLike+"("+Se+")&&"+Se+".length===2&&typeof "+Se+'[0]==="number"&&typeof '+Se+'[1]==="number"&&'+Se+"[0]<="+Se+"[1]","depth range must be a 2d array")});var pt=Ge.def("+",Se,"[0]"),xt=Ge.def("+",Se,"[1]");return[pt,xt]});case ga:return ft(function(Ee){R.commandType(Ee,"object","blend.func",pe.commandStr);var Ge="srcRGB"in Ee?Ee.srcRGB:Ee.src,Se="srcAlpha"in Ee?Ee.srcAlpha:Ee.src,pt="dstRGB"in Ee?Ee.dstRGB:Ee.dst,xt="dstAlpha"in Ee?Ee.dstAlpha:Ee.dst;return R.commandParameter(Ge,nl,He+".srcRGB",pe.commandStr),R.commandParameter(Se,nl,He+".srcAlpha",pe.commandStr),R.commandParameter(pt,nl,He+".dstRGB",pe.commandStr),R.commandParameter(xt,nl,He+".dstAlpha",pe.commandStr),R.command(il.indexOf(Ge+", "+pt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ge+", "+pt+")",pe.commandStr),[nl[Ge],nl[pt],nl[Se],nl[xt]]},function(Ee,Ge,Se){var pt=Ee.constants.blendFuncs;R.optional(function(){Ee.assert(Ge,Se+"&&typeof "+Se+'==="object"',"invalid blend func, must be an object")});function xt(bn,zn){var ti=Ge.def('"',bn,zn,'" in ',Se,"?",Se,".",bn,zn,":",Se,".",bn);return R.optional(function(){Ee.assert(Ge,ti+" in "+pt,"invalid "+Ze+"."+bn+zn+", must be one of "+Object.keys(nl))}),ti}var ar=xt("src","RGB"),Dt=xt("dst","RGB");R.optional(function(){var bn=Ee.constants.invalidBlendCombinations;Ee.assert(Ge,bn+".indexOf("+ar+'+", "+'+Dt+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var er=Ge.def(pt,"[",ar,"]"),yr=Ge.def(pt,"[",xt("src","Alpha"),"]"),xn=Ge.def(pt,"[",Dt,"]"),ai=Ge.def(pt,"[",xt("dst","Alpha"),"]");return[er,xn,yr,ai]});case aa:return ft(function(Ee){if(typeof Ee=="string")return R.commandParameter(Ee,Vt,"invalid "+Ze,pe.commandStr),[Vt[Ee],Vt[Ee]];if(typeof Ee=="object")return R.commandParameter(Ee.rgb,Vt,Ze+".rgb",pe.commandStr),R.commandParameter(Ee.alpha,Vt,Ze+".alpha",pe.commandStr),[Vt[Ee.rgb],Vt[Ee.alpha]];R.commandRaise("invalid blend.equation",pe.commandStr)},function(Ee,Ge,Se){var pt=Ee.constants.blendEquations,xt=Ge.def(),ar=Ge.def(),Dt=Ee.cond("typeof ",Se,'==="string"');return R.optional(function(){function er(yr,xn,ai){Ee.assert(yr,ai+" in "+pt,"invalid "+xn+", must be one of "+Object.keys(Vt))}er(Dt.then,Ze,Se),Ee.assert(Dt.else,Se+"&&typeof "+Se+'==="object"',"invalid "+Ze),er(Dt.else,Ze+".rgb",Se+".rgb"),er(Dt.else,Ze+".alpha",Se+".alpha")}),Dt.then(xt,"=",ar,"=",pt,"[",Se,"];"),Dt.else(xt,"=",pt,"[",Se,".rgb];",ar,"=",pt,"[",Se,".alpha];"),Ge(Dt),[xt,ar]});case Zn:return ft(function(Ee){return R.command(Ta(Ee)&&Ee.length===4,"blend.color must be a 4d array",pe.commandStr),K(4,function(Ge){return+Ee[Ge]})},function(Ee,Ge,Se){return R.optional(function(){Ee.assert(Ge,Ee.shared.isArrayLike+"("+Se+")&&"+Se+".length===4","blend.color must be a 4d array")}),K(4,function(pt){return Ge.def("+",Se,"[",pt,"]")})});case hu:return ft(function(Ee){return R.commandType(Ee,"number",He,pe.commandStr),Ee|0},function(Ee,Ge,Se){return R.optional(function(){Ee.assert(Ge,"typeof "+Se+'==="number"',"invalid stencil.mask")}),Ge.def(Se,"|0")});case Kl:return ft(function(Ee){R.commandType(Ee,"object",He,pe.commandStr);var Ge=Ee.cmp||"keep",Se=Ee.ref||0,pt="mask"in Ee?Ee.mask:-1;return R.commandParameter(Ge,ic,Ze+".cmp",pe.commandStr),R.commandType(Se,"number",Ze+".ref",pe.commandStr),R.commandType(pt,"number",Ze+".mask",pe.commandStr),[ic[Ge],Se,pt]},function(Ee,Ge,Se){var pt=Ee.constants.compareFuncs;R.optional(function(){function er(){Ee.assert(Ge,Array.prototype.join.call(arguments,""),"invalid stencil.func")}er(Se+"&&typeof ",Se,'==="object"'),er('!("cmp" in ',Se,")||(",Se,".cmp in ",pt,")")});var xt=Ge.def('"cmp" in ',Se,"?",pt,"[",Se,".cmp]",":",fs),ar=Ge.def(Se,".ref|0"),Dt=Ge.def('"mask" in ',Se,"?",Se,".mask|0:-1");return[xt,ar,Dt]});case Ds:case Pa:return ft(function(Ee){R.commandType(Ee,"object",He,pe.commandStr);var Ge=Ee.fail||"keep",Se=Ee.zfail||"keep",pt=Ee.zpass||"keep";return R.commandParameter(Ge,qs,Ze+".fail",pe.commandStr),R.commandParameter(Se,qs,Ze+".zfail",pe.commandStr),R.commandParameter(pt,qs,Ze+".zpass",pe.commandStr),[Ze===Pa?Cl:Al,qs[Ge],qs[Se],qs[pt]]},function(Ee,Ge,Se){var pt=Ee.constants.stencilOps;R.optional(function(){Ee.assert(Ge,Se+"&&typeof "+Se+'==="object"',"invalid "+Ze)});function xt(ar){return R.optional(function(){Ee.assert(Ge,'!("'+ar+'" in '+Se+")||("+Se+"."+ar+" in "+pt+")","invalid "+Ze+"."+ar+", must be one of "+Object.keys(qs))}),Ge.def('"',ar,'" in ',Se,"?",pt,"[",Se,".",ar,"]:",fs)}return[Ze===Pa?Cl:Al,xt("fail"),xt("zfail"),xt("zpass")]});case Ys:return ft(function(Ee){R.commandType(Ee,"object",He,pe.commandStr);var Ge=Ee.factor|0,Se=Ee.units|0;return R.commandType(Ge,"number",He+".factor",pe.commandStr),R.commandType(Se,"number",He+".units",pe.commandStr),[Ge,Se]},function(Ee,Ge,Se){R.optional(function(){Ee.assert(Ge,Se+"&&typeof "+Se+'==="object"',"invalid "+Ze)});var pt=Ge.def(Se,".factor|0"),xt=Ge.def(Se,".units|0");return[pt,xt]});case Qu:return ft(function(Ee){var Ge=0;return Ee==="front"?Ge=Al:Ee==="back"&&(Ge=Cl),R.command(!!Ge,He,pe.commandStr),Ge},function(Ee,Ge,Se){return R.optional(function(){Ee.assert(Ge,Se+'==="front"||'+Se+'==="back"',"invalid cull.face")}),Ge.def(Se,'==="front"?',Al,":",Cl)});case Uo:return ft(function(Ee){return R.command(typeof Ee=="number"&&Ee>=Ft.lineWidthDims[0]&&Ee<=Ft.lineWidthDims[1],"invalid line width, must be a positive number between "+Ft.lineWidthDims[0]+" and "+Ft.lineWidthDims[1],pe.commandStr),Ee},function(Ee,Ge,Se){return R.optional(function(){Ee.assert(Ge,"typeof "+Se+'==="number"&&'+Se+">="+Ft.lineWidthDims[0]+"&&"+Se+"<="+Ft.lineWidthDims[1],"invalid line width")}),Se});case Zo:return ft(function(Ee){return R.commandParameter(Ee,mu,He,pe.commandStr),mu[Ee]},function(Ee,Ge,Se){return R.optional(function(){Ee.assert(Ge,Se+'==="cw"||'+Se+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ge.def(Se+'==="cw"?'+Qa+":"+Lr)});case Ja:return ft(function(Ee){return R.command(Ta(Ee)&&Ee.length===4,"color.mask must be length 4 array",pe.commandStr),Ee.map(function(Ge){return!!Ge})},function(Ee,Ge,Se){return R.optional(function(){Ee.assert(Ge,Ee.shared.isArrayLike+"("+Se+")&&"+Se+".length===4","invalid color.mask")}),K(4,function(pt){return"!!"+Se+"["+pt+"]"})});case xl:return ft(function(Ee){R.command(typeof Ee=="object"&&Ee,He,pe.commandStr);var Ge="value"in Ee?Ee.value:1,Se=!!Ee.invert;return R.command(typeof Ge=="number"&&Ge>=0&&Ge<=1,"sample.coverage.value must be a number between 0 and 1",pe.commandStr),[Ge,Se]},function(Ee,Ge,Se){R.optional(function(){Ee.assert(Ge,Se+"&&typeof "+Se+'==="object"',"invalid sample.coverage")});var pt=Ge.def('"value" in ',Se,"?+",Se,".value:1"),xt=Ge.def("!!",Se,".invert");return[pt,xt]})}}),yt}function Eo(we,pe){var Ye=we.static,dt=we.dynamic,yt={};return Object.keys(Ye).forEach(function(Ze){var He=Ye[Ze],ft;if(typeof He=="number"||typeof He=="boolean")ft=eo(function(){return He});else if(typeof He=="function"){var Ee=He._reglType;Ee==="texture2d"||Ee==="textureCube"?ft=eo(function(Ge){return Ge.link(He)}):Ee==="framebuffer"||Ee==="framebufferCube"?(R.command(He.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ze+'"',pe.commandStr),ft=eo(function(Ge){return Ge.link(He.color[0])})):R.commandRaise('invalid data for uniform "'+Ze+'"',pe.commandStr)}else Ta(He)?ft=eo(function(Ge){var Se=Ge.global.def("[",K(He.length,function(pt){return R.command(typeof He[pt]=="number"||typeof He[pt]=="boolean","invalid uniform "+Ze,Ge.commandStr),He[pt]}),"]");return Se}):R.commandRaise('invalid or missing data for uniform "'+Ze+'"',pe.commandStr);ft.value=He,yt[Ze]=ft}),Object.keys(dt).forEach(function(Ze){var He=dt[Ze];yt[Ze]=As(He,function(ft,Ee){return ft.invoke(Ee,He)})}),yt}function wi(we,pe){var Ye=we.static,dt=we.dynamic,yt={};return Object.keys(Ye).forEach(function(Ze){var He=Ye[Ze],ft=xe.id(Ze),Ee=new gt;if(Wh(He))Ee.state=Cn,Ee.buffer=rr.getBuffer(rr.create(He,Tc,!1,!0)),Ee.type=0;else{var Ge=rr.getBuffer(He);if(Ge)Ee.state=Cn,Ee.buffer=Ge,Ee.type=0;else if(R.command(typeof He=="object"&&He,"invalid data for attribute "+Ze,pe.commandStr),"constant"in He){var Se=He.constant;Ee.buffer="null",Ee.state=Ln,typeof Se=="number"?Ee.x=Se:(R.command(Ta(Se)&&Se.length>0&&Se.length<=4,"invalid constant for attribute "+Ze,pe.commandStr),kr.forEach(function(xn,ai){ai<Se.length&&(Ee[xn]=Se[ai])}))}else{Wh(He.buffer)?Ge=rr.getBuffer(rr.create(He.buffer,Tc,!1,!0)):Ge=rr.getBuffer(He.buffer),R.command(!!Ge,'missing buffer for attribute "'+Ze+'"',pe.commandStr);var pt=He.offset|0;R.command(pt>=0,'invalid offset for attribute "'+Ze+'"',pe.commandStr);var xt=He.stride|0;R.command(xt>=0&&xt<256,'invalid stride for attribute "'+Ze+'", must be integer betweeen [0, 255]',pe.commandStr);var ar=He.size|0;R.command(!("size"in He)||ar>0&&ar<=4,'invalid size for attribute "'+Ze+'", must be 1,2,3,4',pe.commandStr);var Dt=!!He.normalized,er=0;"type"in He&&(R.commandParameter(He.type,os,"invalid type for attribute "+Ze,pe.commandStr),er=os[He.type]);var yr=He.divisor|0;"divisor"in He&&(R.command(yr===0||Tr,'cannot specify divisor for attribute "'+Ze+'", instancing not supported',pe.commandStr),R.command(yr>=0,'invalid divisor for attribute "'+Ze+'"',pe.commandStr)),R.optional(function(){var xn=pe.commandStr,ai=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(He).forEach(function(bn){R.command(ai.indexOf(bn)>=0,'unknown parameter "'+bn+'" for attribute pointer "'+Ze+'" (valid parameters are '+ai+")",xn)})}),Ee.buffer=Ge,Ee.state=Cn,Ee.size=ar,Ee.normalized=Dt,Ee.type=er||Ge.dtype,Ee.offset=pt,Ee.stride=xt,Ee.divisor=yr}}yt[Ze]=eo(function(xn,ai){var bn=xn.attribCache;if(ft in bn)return bn[ft];var zn={isStream:!1};return Object.keys(Ee).forEach(function(ti){zn[ti]=Ee[ti]}),Ee.buffer&&(zn.buffer=xn.link(Ee.buffer),zn.type=zn.type||zn.buffer+".dtype"),bn[ft]=zn,zn})}),Object.keys(dt).forEach(function(Ze){var He=dt[Ze];function ft(Ee,Ge){var Se=Ee.invoke(Ge,He),pt=Ee.shared,xt=Ee.constants,ar=pt.isBufferArgs,Dt=pt.buffer;R.optional(function(){Ee.assert(Ge,Se+"&&(typeof "+Se+'==="object"||typeof '+Se+'==="function")&&('+ar+"("+Se+")||"+Dt+".getBuffer("+Se+")||"+Dt+".getBuffer("+Se+".buffer)||"+ar+"("+Se+'.buffer)||("constant" in '+Se+"&&(typeof "+Se+'.constant==="number"||'+pt.isArrayLike+"("+Se+".constant))))",'invalid dynamic attribute "'+Ze+'"')});var er={isStream:Ge.def(!1)},yr=new gt;yr.state=Cn,Object.keys(yr).forEach(function(zn){er[zn]=Ge.def(""+yr[zn])});var xn=er.buffer,ai=er.type;Ge("if(",ar,"(",Se,")){",er.isStream,"=true;",xn,"=",Dt,".createStream(",Tc,",",Se,");",ai,"=",xn,".dtype;","}else{",xn,"=",Dt,".getBuffer(",Se,");","if(",xn,"){",ai,"=",xn,".dtype;",'}else if("constant" in ',Se,"){",er.state,"=",Ln,";","if(typeof "+Se+'.constant === "number"){',er[kr[0]],"=",Se,".constant;",kr.slice(1).map(function(zn){return er[zn]}).join("="),"=0;","}else{",kr.map(function(zn,ti){return er[zn]+"="+Se+".constant.length>"+ti+"?"+Se+".constant["+ti+"]:0;"}).join(""),"}}else{","if(",ar,"(",Se,".buffer)){",xn,"=",Dt,".createStream(",Tc,",",Se,".buffer);","}else{",xn,"=",Dt,".getBuffer(",Se,".buffer);","}",ai,'="type" in ',Se,"?",xt.glTypes,"[",Se,".type]:",xn,".dtype;",er.normalized,"=!!",Se,".normalized;");function bn(zn){Ge(er[zn],"=",Se,".",zn,"|0;")}return bn("size"),bn("offset"),bn("stride"),bn("divisor"),Ge("}}"),Ge.exit("if(",er.isStream,"){",Dt,".destroyStream(",xn,");","}"),er}yt[Ze]=As(He,ft)}),yt}function Ea(we,pe){var Ye=we.static,dt=we.dynamic;if(Xs in Ye){var yt=Ye[Xs];return yt!==null&&Rr.getVAO(yt)===null&&(yt=Rr.createVAO(yt)),eo(function(He){return He.link(Rr.getVAO(yt))})}else if(Xs in dt){var Ze=dt[Xs];return As(Ze,function(He,ft){var Ee=He.invoke(ft,Ze);return ft.def(He.shared.vao+".getVAO("+Ee+")")})}return null}function la(we){var pe=we.static,Ye=we.dynamic,dt={};return Object.keys(pe).forEach(function(yt){var Ze=pe[yt];dt[yt]=eo(function(He,ft){return typeof Ze=="number"||typeof Ze=="boolean"?""+Ze:He.link(Ze)})}),Object.keys(Ye).forEach(function(yt){var Ze=Ye[yt];dt[yt]=As(Ze,function(He,ft){return He.invoke(ft,Ze)})}),dt}function to(we,pe,Ye,dt,yt){var Ze=we.static,He=we.dynamic;R.optional(function(){var bn=[co,wo,ws,tl,Fs,Iu,bl,rl,ki,Xs].concat(gr);function zn(ti){Object.keys(ti).forEach(function(Ni){R.command(bn.indexOf(Ni)>=0,'unknown parameter "'+Ni+'"',yt.commandStr)})}zn(Ze),zn(He)});var ft=ei(we,pe),Ee=_n(we,yt),Ge=_i(we,Ee,yt),Se=Di(we,yt),pt=Na(we,yt),xt=li(we,yt,ft);function ar(bn){var zn=Ge[bn];zn&&(pt[bn]=zn)}ar(es),ar(Nr(Ss));var Dt=Object.keys(pt).length>0,er={framebuffer:Ee,draw:Se,shader:xt,state:pt,dirty:Dt,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(er.profile=On(we,yt),er.uniforms=Eo(Ye,yt),er.drawVAO=er.scopeVAO=Ea(we,yt),!er.drawVAO&&xt.program&&!ft&&Ce.angle_instanced_arrays){var yr=!0,xn=xt.program.attributes.map(function(bn){var zn=pe.static[bn];return yr=yr&&!!zn,zn});if(yr&&xn.length>0){var ai=Rr.getVAO(Rr.createVAO(xn));er.drawVAO=new Es(null,null,null,function(bn,zn){return bn.link(ai)}),er.useVAO=!0}}return ft?er.useVAO=!0:er.attributes=wi(pe,yt),er.context=la(dt,yt),er}function fo(we,pe,Ye){var dt=we.shared,yt=dt.context,Ze=we.scope();Object.keys(Ye).forEach(function(He){pe.save(yt,"."+He);var ft=Ye[He],Ee=ft.append(we,pe);Array.isArray(Ee)?Ze(yt,".",He,"=[",Ee.join(),"];"):Ze(yt,".",He,"=",Ee,";")}),pe(Ze)}function Ao(we,pe,Ye,dt){var yt=we.shared,Ze=yt.gl,He=yt.framebuffer,ft;Qr&&(ft=pe.def(yt.extensions,".webgl_draw_buffers"));var Ee=we.constants,Ge=Ee.drawBuffer,Se=Ee.backBuffer,pt;Ye?pt=Ye.append(we,pe):pt=pe.def(He,".next"),dt||pe("if(",pt,"!==",He,".cur){"),pe("if(",pt,"){",Ze,".bindFramebuffer(",Uf,",",pt,".framebuffer);"),Qr&&pe(ft,".drawBuffersWEBGL(",Ge,"[",pt,".colorAttachments.length]);"),pe("}else{",Ze,".bindFramebuffer(",Uf,",null);"),Qr&&pe(ft,".drawBuffersWEBGL(",Se,");"),pe("}",He,".cur=",pt,";"),dt||pe("}")}function ko(we,pe,Ye){var dt=we.shared,yt=dt.gl,Ze=we.current,He=we.next,ft=dt.current,Ee=dt.next,Ge=we.cond(ft,".dirty");gr.forEach(function(Se){var pt=Nr(Se);if(!(pt in Ye.state)){var xt,ar;if(pt in He){xt=He[pt],ar=Ze[pt];var Dt=K(vr[pt].length,function(yr){return Ge.def(xt,"[",yr,"]")});Ge(we.cond(Dt.map(function(yr,xn){return yr+"!=="+ar+"["+xn+"]"}).join("||")).then(yt,".",at[pt],"(",Dt,");",Dt.map(function(yr,xn){return ar+"["+xn+"]="+yr}).join(";"),";"))}else{xt=Ge.def(Ee,".",pt);var er=we.cond(xt,"!==",ft,".",pt);Ge(er),pt in Gr?er(we.cond(xt).then(yt,".enable(",Gr[pt],");").else(yt,".disable(",Gr[pt],");"),ft,".",pt,"=",xt,";"):er(yt,".",at[pt],"(",xt,");",ft,".",pt,"=",xt,";")}}}),Object.keys(Ye.state).length===0&&Ge(ft,".dirty=false;"),pe(Ge)}function Vo(we,pe,Ye,dt){var yt=we.shared,Ze=we.current,He=yt.current,ft=yt.gl;Op(Object.keys(Ye)).forEach(function(Ee){var Ge=Ye[Ee];if(!(dt&&!dt(Ge))){var Se=Ge.append(we,pe);if(Gr[Ee]){var pt=Gr[Ee];gu(Ge)?Se?pe(ft,".enable(",pt,");"):pe(ft,".disable(",pt,");"):pe(we.cond(Se).then(ft,".enable(",pt,");").else(ft,".disable(",pt,");")),pe(He,".",Ee,"=",Se,";")}else if(Ta(Se)){var xt=Ze[Ee];pe(ft,".",at[Ee],"(",Se,");",Se.map(function(ar,Dt){return xt+"["+Dt+"]="+ar}).join(";"),";")}else pe(ft,".",at[Ee],"(",Se,");",He,".",Ee,"=",Se,";")}})}function $a(we,pe){Tr&&(we.instancing=pe.def(we.shared.extensions,".angle_instanced_arrays"))}function ui(we,pe,Ye,dt,yt){var Ze=we.shared,He=we.stats,ft=Ze.current,Ee=Ze.timer,Ge=Ye.profile;function Se(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var pt,xt;function ar(bn){pt=pe.def(),bn(pt,"=",Se(),";"),typeof yt=="string"?bn(He,".count+=",yt,";"):bn(He,".count++;"),Ar&&(dt?(xt=pe.def(),bn(xt,"=",Ee,".getNumPendingQueries();")):bn(Ee,".beginQuery(",He,");"))}function Dt(bn){bn(He,".cpuTime+=",Se(),"-",pt,";"),Ar&&(dt?bn(Ee,".pushScopeStats(",xt,",",Ee,".getNumPendingQueries(),",He,");"):bn(Ee,".endQuery();"))}function er(bn){var zn=pe.def(ft,".profile");pe(ft,".profile=",bn,";"),pe.exit(ft,".profile=",zn,";")}var yr;if(Ge){if(gu(Ge)){Ge.enable?(ar(pe),Dt(pe.exit),er("true")):er("false");return}yr=Ge.append(we,pe),er(yr)}else yr=pe.def(ft,".profile");var xn=we.block();ar(xn),pe("if(",yr,"){",xn,"}");var ai=we.block();Dt(ai),pe.exit("if(",yr,"){",ai,"}")}function Yo(we,pe,Ye,dt,yt){var Ze=we.shared;function He(Ee){switch(Ee){case vh:case Mc:case mh:return 2;case pa:case tc:case rc:return 3;case ec:case wl:case uf:return 4;default:return 1}}function ft(Ee,Ge,Se){var pt=Ze.gl,xt=pe.def(Ee,".location"),ar=pe.def(Ze.attributes,"[",xt,"]"),Dt=Se.state,er=Se.buffer,yr=[Se.x,Se.y,Se.z,Se.w],xn=["buffer","normalized","offset","stride"];function ai(){pe("if(!",ar,".buffer){",pt,".enableVertexAttribArray(",xt,");}");var zn=Se.type,ti;if(Se.size?ti=pe.def(Se.size,"||",Ge):ti=Ge,pe("if(",ar,".type!==",zn,"||",ar,".size!==",ti,"||",xn.map(function(Za){return ar+"."+Za+"!=="+Se[Za]}).join("||"),"){",pt,".bindBuffer(",Tc,",",er,".buffer);",pt,".vertexAttribPointer(",[xt,ti,zn,Se.normalized,Se.stride,Se.offset],");",ar,".type=",zn,";",ar,".size=",ti,";",xn.map(function(Za){return ar+"."+Za+"="+Se[Za]+";"}).join(""),"}"),Tr){var Ni=Se.divisor;pe("if(",ar,".divisor!==",Ni,"){",we.instancing,".vertexAttribDivisorANGLE(",[xt,Ni],");",ar,".divisor=",Ni,";}")}}function bn(){pe("if(",ar,".buffer){",pt,".disableVertexAttribArray(",xt,");",ar,".buffer=null;","}if(",kr.map(function(zn,ti){return ar+"."+zn+"!=="+yr[ti]}).join("||"),"){",pt,".vertexAttrib4f(",xt,",",yr,");",kr.map(function(zn,ti){return ar+"."+zn+"="+yr[ti]+";"}).join(""),"}")}Dt===Cn?ai():Dt===Ln?bn():(pe("if(",Dt,"===",Cn,"){"),ai(),pe("}else{"),bn(),pe("}"))}dt.forEach(function(Ee){var Ge=Ee.name,Se=Ye.attributes[Ge],pt;if(Se){if(!yt(Se))return;pt=Se.append(we,pe)}else{if(!yt(Ed))return;var xt=we.scopeAttrib(Ge);R.optional(function(){we.assert(pe,xt+".state","missing attribute "+Ge)}),pt={},Object.keys(new gt).forEach(function(ar){pt[ar]=pe.def(xt,".",ar)})}ft(we.link(Ee),He(Ee.info.type),pt)})}function Wi(we,pe,Ye,dt,yt){for(var Ze=we.shared,He=Ze.gl,ft,Ee=0;Ee<dt.length;++Ee){var Ge=dt[Ee],Se=Ge.name,pt=Ge.info.type,xt=Ye.uniforms[Se],ar=we.link(Ge),Dt=ar+".location",er;if(xt){if(!yt(xt))continue;if(gu(xt)){var yr=xt.value;if(R.command(yr!==null&&typeof yr!="undefined",'missing uniform "'+Se+'"',we.commandStr),pt===Pc||pt===El){R.command(typeof yr=="function"&&(pt===Pc&&(yr._reglType==="texture2d"||yr._reglType==="framebuffer")||pt===El&&(yr._reglType==="textureCube"||yr._reglType==="framebufferCube")),"invalid texture for uniform "+Se,we.commandStr);var xn=we.link(yr._texture||yr.color[0]._texture);pe(He,".uniform1i(",Dt,",",xn+".bind());"),pe.exit(xn,".unbind();")}else if(pt===Ic||pt===gh||pt===nc){R.optional(function(){R.command(Ta(yr),"invalid matrix for uniform "+Se,we.commandStr),R.command(pt===Ic&&yr.length===4||pt===gh&&yr.length===9||pt===nc&&yr.length===16,"invalid length for matrix uniform "+Se,we.commandStr)});var ai=we.global.def("new Float32Array(["+Array.prototype.slice.call(yr)+"])"),bn=2;pt===gh?bn=3:pt===nc&&(bn=4),pe(He,".uniformMatrix",bn,"fv(",Dt,",false,",ai,");")}else{switch(pt){case Ql:R.commandType(yr,"number","uniform "+Se,we.commandStr),ft="1f";break;case vh:R.command(Ta(yr)&&yr.length===2,"uniform "+Se,we.commandStr),ft="2f";break;case pa:R.command(Ta(yr)&&yr.length===3,"uniform "+Se,we.commandStr),ft="3f";break;case ec:R.command(Ta(yr)&&yr.length===4,"uniform "+Se,we.commandStr),ft="4f";break;case sf:R.commandType(yr,"boolean","uniform "+Se,we.commandStr),ft="1i";break;case Hh:R.commandType(yr,"number","uniform "+Se,we.commandStr),ft="1i";break;case mh:R.command(Ta(yr)&&yr.length===2,"uniform "+Se,we.commandStr),ft="2i";break;case Mc:R.command(Ta(yr)&&yr.length===2,"uniform "+Se,we.commandStr),ft="2i";break;case rc:R.command(Ta(yr)&&yr.length===3,"uniform "+Se,we.commandStr),ft="3i";break;case tc:R.command(Ta(yr)&&yr.length===3,"uniform "+Se,we.commandStr),ft="3i";break;case uf:R.command(Ta(yr)&&yr.length===4,"uniform "+Se,we.commandStr),ft="4i";break;case wl:R.command(Ta(yr)&&yr.length===4,"uniform "+Se,we.commandStr),ft="4i";break}pe(He,".uniform",ft,"(",Dt,",",Ta(yr)?Array.prototype.slice.call(yr):yr,");")}continue}else er=xt.append(we,pe)}else{if(!yt(Ed))continue;er=pe.def(Ze.uniforms,"[",xe.id(Se),"]")}pt===Pc?(R(!Array.isArray(er),"must specify a scalar prop for textures"),pe("if(",er,"&&",er,'._reglType==="framebuffer"){',er,"=",er,".color[0];","}")):pt===El&&(R(!Array.isArray(er),"must specify a scalar prop for cube maps"),pe("if(",er,"&&",er,'._reglType==="framebufferCube"){',er,"=",er,".color[0];","}")),R.optional(function(){function Cs(yu,ff){we.assert(pe,yu,'bad data or missing for uniform "'+Se+'".  '+ff)}function Sh(yu){R(!Array.isArray(er),"must not specify an array type for uniform"),Cs("typeof "+er+'==="'+yu+'"',"invalid type, expected "+yu)}function Js(yu,ff){Array.isArray(er)?R(er.length===yu,"must have length "+yu):Cs(Ze.isArrayLike+"("+er+")&&"+er+".length==="+yu,"invalid vector, should have length "+yu,we.commandStr)}function Kh(yu){R(!Array.isArray(er),"must not specify a value type"),Cs("typeof "+er+'==="function"&&'+er+'._reglType==="texture'+(yu===Jl?"2d":"Cube")+'"',"invalid texture type",we.commandStr)}switch(pt){case Hh:Sh("number");break;case Mc:Js(2,"number");break;case tc:Js(3,"number");break;case wl:Js(4,"number");break;case Ql:Sh("number");break;case vh:Js(2,"number");break;case pa:Js(3,"number");break;case ec:Js(4,"number");break;case sf:Sh("boolean");break;case mh:Js(2,"boolean");break;case rc:Js(3,"boolean");break;case uf:Js(4,"boolean");break;case Ic:Js(4,"number");break;case gh:Js(9,"number");break;case nc:Js(16,"number");break;case Pc:Kh(Jl);break;case El:Kh(dh);break}});var zn=1;switch(pt){case Pc:case El:var ti=pe.def(er,"._texture");pe(He,".uniform1i(",Dt,",",ti,".bind());"),pe.exit(ti,".unbind();");continue;case Hh:case sf:ft="1i";break;case Mc:case mh:ft="2i",zn=2;break;case tc:case rc:ft="3i",zn=3;break;case wl:case uf:ft="4i",zn=4;break;case Ql:ft="1f";break;case vh:ft="2f",zn=2;break;case pa:ft="3f",zn=3;break;case ec:ft="4f",zn=4;break;case Ic:ft="Matrix2fv";break;case gh:ft="Matrix3fv";break;case nc:ft="Matrix4fv";break}if(pe(He,".uniform",ft,"(",Dt,","),ft.charAt(0)==="M"){var Ni=Math.pow(pt-Ic+2,2),Za=we.global.def("new Float32Array(",Ni,")");Array.isArray(er)?pe("false,(",K(Ni,function(Cs){return Za+"["+Cs+"]="+er[Cs]}),",",Za,")"):pe("false,(Array.isArray(",er,")||",er," instanceof Float32Array)?",er,":(",K(Ni,function(Cs){return Za+"["+Cs+"]="+er+"["+Cs+"]"}),",",Za,")")}else zn>1?pe(K(zn,function(Cs){return Array.isArray(er)?er[Cs]:er+"["+Cs+"]"})):(R(!Array.isArray(er),"uniform value must not be an array"),pe(er));pe(");")}}function Un(we,pe,Ye,dt){var yt=we.shared,Ze=yt.gl,He=yt.draw,ft=dt.draw;function Ee(){var ti=ft.elements,Ni,Za=pe;return ti?((ti.contextDep&&dt.contextDynamic||ti.propDep)&&(Za=Ye),Ni=ti.append(we,Za)):Ni=Za.def(He,".",tl),Ni&&Za("if("+Ni+")"+Ze+".bindBuffer("+Pp+","+Ni+".buffer.buffer);"),Ni}function Ge(){var ti=ft.count,Ni,Za=pe;return ti?((ti.contextDep&&dt.contextDynamic||ti.propDep)&&(Za=Ye),Ni=ti.append(we,Za),R.optional(function(){ti.MISSING&&we.assert(pe,"false","missing vertex count"),ti.DYNAMIC&&we.assert(Za,Ni+">=0","missing vertex count")})):(Ni=Za.def(He,".",bl),R.optional(function(){we.assert(Za,Ni+">=0","missing vertex count")})),Ni}var Se=Ee();function pt(ti){var Ni=ft[ti];return Ni?Ni.contextDep&&dt.contextDynamic||Ni.propDep?Ni.append(we,Ye):Ni.append(we,pe):pe.def(He,".",ti)}var xt=pt(Fs),ar=pt(Iu),Dt=Ge();if(typeof Dt=="number"){if(Dt===0)return}else Ye("if(",Dt,"){"),Ye.exit("}");var er,yr;Tr&&(er=pt(rl),yr=we.instancing);var xn=Se+".type",ai=ft.elements&&gu(ft.elements);function bn(){function ti(){Ye(yr,".drawElementsInstancedANGLE(",[xt,Dt,xn,ar+"<<(("+xn+"-"+rn+")>>1)",er],");")}function Ni(){Ye(yr,".drawArraysInstancedANGLE(",[xt,ar,Dt,er],");")}Se?ai?ti():(Ye("if(",Se,"){"),ti(),Ye("}else{"),Ni(),Ye("}")):Ni()}function zn(){function ti(){Ye(Ze+".drawElements("+[xt,Dt,xn,ar+"<<(("+xn+"-"+rn+")>>1)"]+");")}function Ni(){Ye(Ze+".drawArrays("+[xt,ar,Dt]+");")}Se?ai?ti():(Ye("if(",Se,"){"),ti(),Ye("}else{"),Ni(),Ye("}")):Ni()}Tr&&(typeof er!="number"||er>=0)?typeof er=="string"?(Ye("if(",er,">0){"),bn(),Ye("}else if(",er,"<0){"),zn(),Ye("}")):bn():zn()}function xi(we,pe,Ye,dt,yt){var Ze=jn(),He=Ze.proc("body",yt);return R.optional(function(){Ze.commandStr=pe.commandStr,Ze.command=Ze.link(pe.commandStr)}),Tr&&(Ze.instancing=He.def(Ze.shared.extensions,".angle_instanced_arrays")),we(Ze,He,Ye,dt),Ze.compile().body}function Pi(we,pe,Ye,dt){$a(we,pe),Ye.useVAO?Ye.drawVAO?pe(we.shared.vao,".setVAO(",Ye.drawVAO.append(we,pe),");"):pe(we.shared.vao,".setVAO(",we.shared.vao,".targetVAO);"):(pe(we.shared.vao,".setVAO(null);"),Yo(we,pe,Ye,dt.attributes,function(){return!0})),Wi(we,pe,Ye,dt.uniforms,function(){return!0}),Un(we,pe,pe,Ye)}function ro(we,pe){var Ye=we.proc("draw",1);$a(we,Ye),fo(we,Ye,pe.context),Ao(we,Ye,pe.framebuffer),ko(we,Ye,pe),Vo(we,Ye,pe.state),ui(we,Ye,pe,!1,!0);var dt=pe.shader.progVar.append(we,Ye);if(Ye(we.shared.gl,".useProgram(",dt,".program);"),pe.shader.program)Pi(we,Ye,pe,pe.shader.program);else{Ye(we.shared.vao,".setVAO(null);");var yt=we.global.def("{}"),Ze=Ye.def(dt,".id"),He=Ye.def(yt,"[",Ze,"]");Ye(we.cond(He).then(He,".call(this,a0);").else(He,"=",yt,"[",Ze,"]=",we.link(function(ft){return xi(Pi,we,pe,ft,1)}),"(",dt,");",He,".call(this,a0);"))}Object.keys(pe.state).length>0&&Ye(we.shared.current,".dirty=true;")}function Ks(we,pe,Ye,dt){we.batchId="a1",$a(we,pe);function yt(){return!0}Yo(we,pe,Ye,dt.attributes,yt),Wi(we,pe,Ye,dt.uniforms,yt),Un(we,pe,pe,Ye)}function Pu(we,pe,Ye,dt){$a(we,pe);var yt=Ye.contextDep,Ze=pe.def(),He="a0",ft="a1",Ee=pe.def();we.shared.props=Ee,we.batchId=Ze;var Ge=we.scope(),Se=we.scope();pe(Ge.entry,"for(",Ze,"=0;",Ze,"<",ft,";++",Ze,"){",Ee,"=",He,"[",Ze,"];",Se,"}",Ge.exit);function pt(xn){return xn.contextDep&&yt||xn.propDep}function xt(xn){return!pt(xn)}if(Ye.needsContext&&fo(we,Se,Ye.context),Ye.needsFramebuffer&&Ao(we,Se,Ye.framebuffer),Vo(we,Se,Ye.state,pt),Ye.profile&&pt(Ye.profile)&&ui(we,Se,Ye,!1,!0),dt)Ye.useVAO?Ye.drawVAO?pt(Ye.drawVAO)?Se(we.shared.vao,".setVAO(",Ye.drawVAO.append(we,Se),");"):Ge(we.shared.vao,".setVAO(",Ye.drawVAO.append(we,Ge),");"):Ge(we.shared.vao,".setVAO(",we.shared.vao,".targetVAO);"):(Ge(we.shared.vao,".setVAO(null);"),Yo(we,Ge,Ye,dt.attributes,xt),Yo(we,Se,Ye,dt.attributes,pt)),Wi(we,Ge,Ye,dt.uniforms,xt),Wi(we,Se,Ye,dt.uniforms,pt),Un(we,Ge,Se,Ye);else{var ar=we.global.def("{}"),Dt=Ye.shader.progVar.append(we,Se),er=Se.def(Dt,".id"),yr=Se.def(ar,"[",er,"]");Se(we.shared.gl,".useProgram(",Dt,".program);","if(!",yr,"){",yr,"=",ar,"[",er,"]=",we.link(function(xn){return xi(Ks,we,Ye,xn,2)}),"(",Dt,");}",yr,".call(this,a0[",Ze,"],",Ze,");")}}function Pe(we,pe){var Ye=we.proc("batch",2);we.batchId="0",$a(we,Ye);var dt=!1,yt=!0;Object.keys(pe.context).forEach(function(ar){dt=dt||pe.context[ar].propDep}),dt||(fo(we,Ye,pe.context),yt=!1);var Ze=pe.framebuffer,He=!1;Ze?(Ze.propDep?dt=He=!0:Ze.contextDep&&dt&&(He=!0),He||Ao(we,Ye,Ze)):Ao(we,Ye,null),pe.state.viewport&&pe.state.viewport.propDep&&(dt=!0);function ft(ar){return ar.contextDep&&dt||ar.propDep}ko(we,Ye,pe),Vo(we,Ye,pe.state,function(ar){return!ft(ar)}),(!pe.profile||!ft(pe.profile))&&ui(we,Ye,pe,!1,"a1"),pe.contextDep=dt,pe.needsContext=yt,pe.needsFramebuffer=He;var Ee=pe.shader.progVar;if(Ee.contextDep&&dt||Ee.propDep)Pu(we,Ye,pe,null);else{var Ge=Ee.append(we,Ye);if(Ye(we.shared.gl,".useProgram(",Ge,".program);"),pe.shader.program)Pu(we,Ye,pe,pe.shader.program);else{Ye(we.shared.vao,".setVAO(null);");var Se=we.global.def("{}"),pt=Ye.def(Ge,".id"),xt=Ye.def(Se,"[",pt,"]");Ye(we.cond(xt).then(xt,".call(this,a0,a1);").else(xt,"=",Se,"[",pt,"]=",we.link(function(ar){return xi(Pu,we,pe,ar,2)}),"(",Ge,");",xt,".call(this,a0,a1);"))}}Object.keys(pe.state).length>0&&Ye(we.shared.current,".dirty=true;")}function Ot(we,pe){var Ye=we.proc("scope",3);we.batchId="a2";var dt=we.shared,yt=dt.current;fo(we,Ye,pe.context),pe.framebuffer&&pe.framebuffer.append(we,Ye),Op(Object.keys(pe.state)).forEach(function(He){var ft=pe.state[He],Ee=ft.append(we,Ye);Ta(Ee)?Ee.forEach(function(Ge,Se){Ye.set(we.next[He],"["+Se+"]",Ge)}):Ye.set(dt.next,"."+He,Ee)}),ui(we,Ye,pe,!0,!0),[tl,Iu,bl,rl,Fs].forEach(function(He){var ft=pe.draw[He];!ft||Ye.set(dt.draw,"."+He,""+ft.append(we,Ye))}),Object.keys(pe.uniforms).forEach(function(He){var ft=pe.uniforms[He].append(we,Ye);Array.isArray(ft)&&(ft="["+ft.join()+"]"),Ye.set(dt.uniforms,"["+xe.id(He)+"]",ft)}),Object.keys(pe.attributes).forEach(function(He){var ft=pe.attributes[He].append(we,Ye),Ee=we.scopeAttrib(He);Object.keys(new gt).forEach(function(Ge){Ye.set(Ee,"."+Ge,ft[Ge])})}),pe.scopeVAO&&Ye.set(dt.vao,".targetVAO",pe.scopeVAO.append(we,Ye));function Ze(He){var ft=pe.shader[He];ft&&Ye.set(dt.shader,"."+He,ft.append(we,Ye))}Ze(wo),Ze(ws),Object.keys(pe.state).length>0&&(Ye(yt,".dirty=true;"),Ye.exit(yt,".dirty=true;")),Ye("a1(",we.shared.context,",a0,",we.batchId,");")}function Pt(we){if(!(typeof we!="object"||Ta(we))){for(var pe=Object.keys(we),Ye=0;Ye<pe.length;++Ye)if(yn.isDynamic(we[pe[Ye]]))return!0;return!1}}function fn(we,pe,Ye){var dt=pe.static[Ye];if(!dt||!Pt(dt))return;var yt=we.global,Ze=Object.keys(dt),He=!1,ft=!1,Ee=!1,Ge=we.global.def("{}");Ze.forEach(function(pt){var xt=dt[pt];if(yn.isDynamic(xt)){typeof xt=="function"&&(xt=dt[pt]=yn.unbox(xt));var ar=As(xt,null);He=He||ar.thisDep,Ee=Ee||ar.propDep,ft=ft||ar.contextDep}else{switch(yt(Ge,".",pt,"="),typeof xt){case"number":yt(xt);break;case"string":yt('"',xt,'"');break;case"object":Array.isArray(xt)&&yt("[",xt.join(),"]");break;default:yt(we.link(xt));break}yt(";")}});function Se(pt,xt){Ze.forEach(function(ar){var Dt=dt[ar];if(!!yn.isDynamic(Dt)){var er=pt.invoke(xt,Dt);xt(Ge,".",ar,"=",er,";")}})}pe.dynamic[Ye]=new yn.DynamicVariable(ii,{thisDep:He,contextDep:ft,propDep:Ee,ref:Ge,append:Se}),delete pe.static[Ye]}function Si(we,pe,Ye,dt,yt){var Ze=jn();Ze.stats=Ze.link(yt),Object.keys(pe.static).forEach(function(ft){fn(Ze,pe,ft)}),Pv.forEach(function(ft){fn(Ze,we,ft)});var He=to(we,pe,Ye,dt,Ze);return ro(Ze,He),Ot(Ze,He),Pe(Ze,He),N(Ze.compile(),{destroy:function(){He.shader.program.destroy()}})}return{next:an,current:vr,procs:function(){var we=jn(),pe=we.proc("poll"),Ye=we.proc("refresh"),dt=we.block();pe(dt),Ye(dt);var yt=we.shared,Ze=yt.gl,He=yt.next,ft=yt.current;dt(ft,".dirty=false;"),Ao(we,pe),Ao(we,Ye,null,!0);var Ee;Tr&&(Ee=we.link(Tr)),Ce.oes_vertex_array_object&&Ye(we.link(Ce.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ge=0;Ge<Ft.maxAttributes;++Ge){var Se=Ye.def(yt.attributes,"[",Ge,"]"),pt=we.cond(Se,".buffer");pt.then(Ze,".enableVertexAttribArray(",Ge,");",Ze,".bindBuffer(",Tc,",",Se,".buffer.buffer);",Ze,".vertexAttribPointer(",Ge,",",Se,".size,",Se,".type,",Se,".normalized,",Se,".stride,",Se,".offset);").else(Ze,".disableVertexAttribArray(",Ge,");",Ze,".vertexAttrib4f(",Ge,",",Se,".x,",Se,".y,",Se,".z,",Se,".w);",Se,".buffer=null;"),Ye(pt),Tr&&Ye(Ee,".vertexAttribDivisorANGLE(",Ge,",",Se,".divisor);")}return Ye(we.shared.vao,".currentVAO=null;",we.shared.vao,".setVAO(",we.shared.vao,".targetVAO);"),Object.keys(Gr).forEach(function(xt){var ar=Gr[xt],Dt=dt.def(He,".",xt),er=we.block();er("if(",Dt,"){",Ze,".enable(",ar,")}else{",Ze,".disable(",ar,")}",ft,".",xt,"=",Dt,";"),Ye(er),pe("if(",Dt,"!==",ft,".",xt,"){",er,"}")}),Object.keys(at).forEach(function(xt){var ar=at[xt],Dt=vr[xt],er,yr,xn=we.block();if(xn(Ze,".",ar,"("),Ta(Dt)){var ai=Dt.length;er=we.global.def(He,".",xt),yr=we.global.def(ft,".",xt),xn(K(ai,function(bn){return er+"["+bn+"]"}),");",K(ai,function(bn){return yr+"["+bn+"]="+er+"["+bn+"];"}).join("")),pe("if(",K(ai,function(bn){return er+"["+bn+"]!=="+yr+"["+bn+"]"}).join("||"),"){",xn,"}")}else er=dt.def(He,".",xt),yr=dt.def(ft,".",xt),xn(er,");",ft,".",xt,"=",er,";"),pe("if(",er,"!==",yr,"){",xn,"}");Ye(xn)}),we.compile()}(),compile:Si}}function Dp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Ad=34918,hs=34919,lf=35007,Fp=function(z,xe){if(!xe.ext_disjoint_timer_query)return null;var Ce=[];function Ft(){return Ce.pop()||xe.ext_disjoint_timer_query.createQueryEXT()}function rr(Tr){Ce.push(Tr)}var kt=[];function Wt(Tr){var Qr=Ft();xe.ext_disjoint_timer_query.beginQueryEXT(lf,Qr),kt.push(Qr),Ar(kt.length-1,kt.length,Tr)}function wr(){xe.ext_disjoint_timer_query.endQueryEXT(lf)}function Ir(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Rr=[];function Cr(){return Rr.pop()||new Ir}function zr(Tr){Rr.push(Tr)}var $r=[];function Ar(Tr,Qr,vr){var an=Cr();an.startQueryIndex=Tr,an.endQueryIndex=Qr,an.sum=0,an.stats=vr,$r.push(an)}var Ur=[],gt=[];function Vt(){var Tr,Qr,vr=kt.length;if(vr!==0){gt.length=Math.max(gt.length,vr+1),Ur.length=Math.max(Ur.length,vr+1),Ur[0]=0,gt[0]=0;var an=0;for(Tr=0,Qr=0;Qr<kt.length;++Qr){var gr=kt[Qr];xe.ext_disjoint_timer_query.getQueryObjectEXT(gr,hs)?(an+=xe.ext_disjoint_timer_query.getQueryObjectEXT(gr,Ad),rr(gr)):kt[Tr++]=gr,Ur[Qr+1]=an,gt[Qr+1]=Tr}for(kt.length=Tr,Tr=0,Qr=0;Qr<$r.length;++Qr){var Gr=$r[Qr],at=Gr.startQueryIndex,Nr=Gr.endQueryIndex;Gr.sum+=Ur[Nr]-Ur[at];var qe=gt[at],Rn=gt[Nr];Rn===qe?(Gr.stats.gpuTime+=Gr.sum/1e6,zr(Gr)):(Gr.startQueryIndex=qe,Gr.endQueryIndex=Rn,$r[Tr++]=Gr)}$r.length=Tr}}return{beginQuery:Wt,endQuery:wr,pushScopeStats:Ar,update:Vt,getNumPendingQueries:function(){return kt.length},clear:function(){Ce.push.apply(Ce,kt);for(var Tr=0;Tr<Ce.length;Tr++)xe.ext_disjoint_timer_query.deleteQueryEXT(Ce[Tr]);kt.length=0,Ce.length=0},restore:function(){kt.length=0,Ce.length=0}}},Bp=16384,Bv=256,zp=1024,zv=34962,bh="webglcontextlost",Yh="webglcontextrestored",Xh=1,Cd=2,Td=3;function cf(z,xe){for(var Ce=0;Ce<z.length;++Ce)if(z[Ce]===xe)return Ce;return-1}function qh(z){var xe=qi(z);if(!xe)return null;var Ce=xe.gl,Ft=Ce.getContextAttributes(),rr=Ce.isContextLost(),kt=W(Ce,xe);if(!kt)return null;var Wt=pn(),wr=Dp(),Ir=kt.extensions,Rr=Fp(Ce,Ir),Cr=En(),zr=Ce.drawingBufferWidth,$r=Ce.drawingBufferHeight,Ar={tick:0,time:0,viewportWidth:zr,viewportHeight:$r,framebufferWidth:zr,framebufferHeight:$r,drawingBufferWidth:zr,drawingBufferHeight:$r,pixelRatio:xe.pixelRatio},Ur={},gt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Vt=Da(Ce,Ir),Tr=sh(Ce,wr,xe,vr),Qr=de(Ce,Ir,Vt,wr,Tr);function vr(Un){return Qr.destroyBuffer(Un)}var an=Tf(Ce,Ir,Tr,wr),gr=Ae(Ce,Wt,wr,xe),Gr=cu(Ce,Ir,Vt,function(){qe.procs.poll()},Ar,wr,xe),at=Ws(Ce,Ir,Vt,wr,xe),Nr=L(Ce,Ir,Vt,Gr,at,wr),qe=$h(Ce,Wt,Ir,Vt,Tr,an,Gr,Nr,Ur,Qr,gr,gt,Ar,Rr,xe),Rn=Bt(Ce,Nr,qe.procs.poll,Ar,Ft,Ir,Vt),Vr=qe.next,pr=Ce.canvas,ur=[],jn=[],On=[],_n=[xe.onDestroy],_i=null;function ei(){if(ur.length===0){Rr&&Rr.update(),_i=null;return}_i=Sn.next(ei),Vo();for(var Un=ur.length-1;Un>=0;--Un){var xi=ur[Un];xi&&xi(Ar,null,0)}Ce.flush(),Rr&&Rr.update()}function li(){!_i&&ur.length>0&&(_i=Sn.next(ei))}function Di(){_i&&(Sn.cancel(ei),_i=null)}function Na(Un){Un.preventDefault(),rr=!0,Di(),jn.forEach(function(xi){xi()})}function Eo(Un){Ce.getError(),rr=!1,kt.restore(),gr.restore(),Tr.restore(),Gr.restore(),at.restore(),Nr.restore(),Qr.restore(),Rr&&Rr.restore(),qe.procs.refresh(),li(),On.forEach(function(xi){xi()})}pr&&(pr.addEventListener(bh,Na,!1),pr.addEventListener(Yh,Eo,!1));function wi(){ur.length=0,Di(),pr&&(pr.removeEventListener(bh,Na),pr.removeEventListener(Yh,Eo)),gr.clear(),Nr.clear(),at.clear(),Gr.clear(),an.clear(),Tr.clear(),Qr.clear(),Rr&&Rr.clear(),_n.forEach(function(Un){Un()})}function Ea(Un){R(!!Un,"invalid args to regl({...})"),R.type(Un,"object","invalid args to regl({...})");function xi(yt){var Ze=N({},yt);delete Ze.uniforms,delete Ze.attributes,delete Ze.context,delete Ze.vao,"stencil"in Ze&&Ze.stencil.op&&(Ze.stencil.opBack=Ze.stencil.opFront=Ze.stencil.op,delete Ze.stencil.op);function He(ft){if(ft in Ze){var Ee=Ze[ft];delete Ze[ft],Object.keys(Ee).forEach(function(Ge){Ze[ft+"."+Ge]=Ee[Ge]})}}return He("blend"),He("depth"),He("cull"),He("stencil"),He("polygonOffset"),He("scissor"),He("sample"),"vao"in yt&&(Ze.vao=yt.vao),Ze}function Pi(yt,Ze){var He={},ft={};return Object.keys(yt).forEach(function(Ee){var Ge=yt[Ee];if(yn.isDynamic(Ge)){ft[Ee]=yn.unbox(Ge,Ee);return}else if(Ze&&Array.isArray(Ge)){for(var Se=0;Se<Ge.length;++Se)if(yn.isDynamic(Ge[Se])){ft[Ee]=yn.unbox(Ge,Ee);return}}He[Ee]=Ge}),{dynamic:ft,static:He}}var ro=Pi(Un.context||{},!0),Ks=Pi(Un.uniforms||{},!0),Pu=Pi(Un.attributes||{},!1),Pe=Pi(xi(Un),!1),Ot={gpuTime:0,cpuTime:0,count:0},Pt=qe.compile(Pe,Pu,Ks,ro,Ot),fn=Pt.draw,Si=Pt.batch,we=Pt.scope,pe=[];function Ye(yt){for(;pe.length<yt;)pe.push(null);return pe}function dt(yt,Ze){var He;if(rr&&R.raise("context lost"),typeof yt=="function")return we.call(this,null,yt,0);if(typeof Ze=="function")if(typeof yt=="number")for(He=0;He<yt;++He)we.call(this,null,Ze,He);else if(Array.isArray(yt))for(He=0;He<yt.length;++He)we.call(this,yt[He],Ze,He);else return we.call(this,yt,Ze,0);else if(typeof yt=="number"){if(yt>0)return Si.call(this,Ye(yt|0),yt|0)}else if(Array.isArray(yt)){if(yt.length)return Si.call(this,yt,yt.length)}else return fn.call(this,yt)}return N(dt,{stats:Ot,destroy:function(){Pt.destroy()}})}var la=Nr.setFBO=Ea({framebuffer:yn.define.call(null,Xh,"framebuffer")});function to(Un,xi){var Pi=0;qe.procs.poll();var ro=xi.color;ro&&(Ce.clearColor(+ro[0]||0,+ro[1]||0,+ro[2]||0,+ro[3]||0),Pi|=Bp),"depth"in xi&&(Ce.clearDepth(+xi.depth),Pi|=Bv),"stencil"in xi&&(Ce.clearStencil(xi.stencil|0),Pi|=zp),R(!!Pi,"called regl.clear with no buffer specified"),Ce.clear(Pi)}function fo(Un){if(R(typeof Un=="object"&&Un,"regl.clear() takes an object as input"),"framebuffer"in Un)if(Un.framebuffer&&Un.framebuffer_reglType==="framebufferCube")for(var xi=0;xi<6;++xi)la(N({framebuffer:Un.framebuffer.faces[xi]},Un),to);else la(Un,to);else to(null,Un)}function Ao(Un){R.type(Un,"function","regl.frame() callback must be a function"),ur.push(Un);function xi(){var Pi=cf(ur,Un);R(Pi>=0,"cannot cancel a frame twice");function ro(){var Ks=cf(ur,ro);ur[Ks]=ur[ur.length-1],ur.length-=1,ur.length<=0&&Di()}ur[Pi]=ro}return li(),{cancel:xi}}function ko(){var Un=Vr.viewport,xi=Vr.scissor_box;Un[0]=Un[1]=xi[0]=xi[1]=0,Ar.viewportWidth=Ar.framebufferWidth=Ar.drawingBufferWidth=Un[2]=xi[2]=Ce.drawingBufferWidth,Ar.viewportHeight=Ar.framebufferHeight=Ar.drawingBufferHeight=Un[3]=xi[3]=Ce.drawingBufferHeight}function Vo(){Ar.tick+=1,Ar.time=ui(),ko(),qe.procs.poll()}function $a(){Gr.refresh(),ko(),qe.procs.refresh(),Rr&&Rr.update()}function ui(){return(En()-Cr)/1e3}$a();function Yo(Un,xi){R.type(xi,"function","listener callback must be a function");var Pi;switch(Un){case"frame":return Ao(xi);case"lost":Pi=jn;break;case"restore":Pi=On;break;case"destroy":Pi=_n;break;default:R.raise("invalid event, must be one of frame,lost,restore,destroy")}return Pi.push(xi),{cancel:function(){for(var ro=0;ro<Pi.length;++ro)if(Pi[ro]===xi){Pi[ro]=Pi[Pi.length-1],Pi.pop();return}}}}var Wi=N(Ea,{clear:fo,prop:yn.define.bind(null,Xh),context:yn.define.bind(null,Cd),this:yn.define.bind(null,Td),draw:Ea({}),buffer:function(Un){return Tr.create(Un,zv,!1,!1)},elements:function(Un){return an.create(Un,!1)},texture:Gr.create2D,cube:Gr.createCube,renderbuffer:at.create,framebuffer:Nr.create,framebufferCube:Nr.createCube,vao:Qr.createVAO,attributes:Ft,frame:Ao,on:Yo,limits:Vt,hasExtension:function(Un){return Vt.extensions.indexOf(Un.toLowerCase())>=0},read:Rn,destroy:wi,_gl:Ce,_refresh:$a,poll:function(){Vo(),Rr&&Rr.update()},now:ui,stats:wr});return xe.onDone(null,Wi),Wi}return qh})},69848:function(Sr){(function(te,N){Sr.exports=N()})(this,function(){"use strict";function te(mt,nt,Lt,lt,Xt,_r){if(!(Xt-lt<=Lt)){var J=lt+Xt>>1;N(mt,nt,J,lt,Xt,_r%2),te(mt,nt,Lt,lt,J-1,_r+1),te(mt,nt,Lt,J+1,Xt,_r+1)}}function N(mt,nt,Lt,lt,Xt,_r){for(;Xt>lt;){if(Xt-lt>600){var J=Xt-lt+1,Ie=Lt-lt+1,V=Math.log(J),H=.5*Math.exp(2*V/3),be=.5*Math.sqrt(V*H*(J-H)/J)*(Ie-J/2<0?-1:1),tt=Math.max(lt,Math.floor(Lt-Ie*H/J+be)),ht=Math.min(Xt,Math.floor(Lt+(J-Ie)*H/J+be));N(mt,nt,Lt,tt,ht,_r)}var St=nt[2*Lt+_r],jt=lt,tr=Xt;for(ye(mt,nt,lt,Lt),nt[2*Xt+_r]>St&&ye(mt,nt,lt,Xt);jt<tr;){for(ye(mt,nt,jt,tr),jt++,tr--;nt[2*jt+_r]<St;)jt++;for(;nt[2*tr+_r]>St;)tr--}nt[2*lt+_r]===St?ye(mt,nt,lt,tr):(tr++,ye(mt,nt,tr,Xt)),tr<=Lt&&(lt=tr+1),Lt<=tr&&(Xt=tr-1)}}function ye(mt,nt,Lt,lt){ee(mt,Lt,lt),ee(nt,2*Lt,2*lt),ee(nt,2*Lt+1,2*lt+1)}function ee(mt,nt,Lt){var lt=mt[nt];mt[nt]=mt[Lt],mt[Lt]=lt}function y(mt,nt,Lt,lt,Xt,_r,J){for(var Ie=[0,mt.length-1,0],V=[],H,be;Ie.length;){var tt=Ie.pop(),ht=Ie.pop(),St=Ie.pop();if(ht-St<=J){for(var jt=St;jt<=ht;jt++)H=nt[2*jt],be=nt[2*jt+1],H>=Lt&&H<=Xt&&be>=lt&&be<=_r&&V.push(mt[jt]);continue}var tr=Math.floor((St+ht)/2);H=nt[2*tr],be=nt[2*tr+1],H>=Lt&&H<=Xt&&be>=lt&&be<=_r&&V.push(mt[tr]);var Hr=(tt+1)%2;(tt===0?Lt<=H:lt<=be)&&(Ie.push(St),Ie.push(tr-1),Ie.push(Hr)),(tt===0?Xt>=H:_r>=be)&&(Ie.push(tr+1),Ie.push(ht),Ie.push(Hr))}return V}function le(mt,nt,Lt,lt,Xt,_r){for(var J=[0,mt.length-1,0],Ie=[],V=Xt*Xt;J.length;){var H=J.pop(),be=J.pop(),tt=J.pop();if(be-tt<=_r){for(var ht=tt;ht<=be;ht++)U(nt[2*ht],nt[2*ht+1],Lt,lt)<=V&&Ie.push(mt[ht]);continue}var St=Math.floor((tt+be)/2),jt=nt[2*St],tr=nt[2*St+1];U(jt,tr,Lt,lt)<=V&&Ie.push(mt[St]);var Hr=(H+1)%2;(H===0?Lt-Xt<=jt:lt-Xt<=tr)&&(J.push(tt),J.push(St-1),J.push(Hr)),(H===0?Lt+Xt>=jt:lt+Xt>=tr)&&(J.push(St+1),J.push(be),J.push(Hr))}return Ie}function U(mt,nt,Lt,lt){var Xt=mt-Lt,_r=nt-lt;return Xt*Xt+_r*_r}var ce=function(mt){return mt[0]},oe=function(mt){return mt[1]},Ue=function(nt,Lt,lt,Xt,_r){Lt===void 0&&(Lt=ce),lt===void 0&&(lt=oe),Xt===void 0&&(Xt=64),_r===void 0&&(_r=Float64Array),this.nodeSize=Xt,this.points=nt;for(var J=nt.length<65536?Uint16Array:Uint32Array,Ie=this.ids=new J(nt.length),V=this.coords=new _r(nt.length*2),H=0;H<nt.length;H++)Ie[H]=H,V[2*H]=Lt(nt[H]),V[2*H+1]=lt(nt[H]);te(Ie,V,Xt,0,Ie.length-1,0)};Ue.prototype.range=function(nt,Lt,lt,Xt){return y(this.ids,this.coords,nt,Lt,lt,Xt,this.nodeSize)},Ue.prototype.within=function(nt,Lt,lt){return le(this.ids,this.coords,nt,Lt,lt,this.nodeSize)};var se={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(mt){return mt}},ze=Math.fround||function(mt){return function(nt){return mt[0]=+nt,mt[0]}}(new Float32Array(1)),et=function(nt){this.options=Dr(Object.create(se),nt),this.trees=new Array(this.options.maxZoom+1)};et.prototype.load=function(nt){var Lt=this.options,lt=Lt.log,Xt=Lt.minZoom,_r=Lt.maxZoom,J=Lt.nodeSize;lt&&console.time("total time");var Ie="prepare "+nt.length+" points";lt&&console.time(Ie),this.points=nt;for(var V=[],H=0;H<nt.length;H++)!nt[H].geometry||V.push(Ct(nt[H],H));this.trees[_r+1]=new Ue(V,fr,sr,J,Float32Array),lt&&console.timeEnd(Ie);for(var be=_r;be>=Xt;be--){var tt=+Date.now();V=this._cluster(V,be),this.trees[be]=new Ue(V,fr,sr,J,Float32Array),lt&&console.log("z%d: %d clusters in %dms",be,V.length,+Date.now()-tt)}return lt&&console.timeEnd("total time"),this},et.prototype.getClusters=function(nt,Lt){var lt=((nt[0]+180)%360+360)%360-180,Xt=Math.max(-90,Math.min(90,nt[1])),_r=nt[2]===180?180:((nt[2]+180)%360+360)%360-180,J=Math.max(-90,Math.min(90,nt[3]));if(nt[2]-nt[0]>=360)lt=-180,_r=180;else if(lt>_r){var Ie=this.getClusters([lt,Xt,180,J],Lt),V=this.getClusters([-180,Xt,_r,J],Lt);return Ie.concat(V)}for(var H=this.trees[this._limitZoom(Lt)],be=H.range(nr(lt),Jt(J),nr(_r),Jt(Xt)),tt=[],ht=0,St=be;ht<St.length;ht+=1){var jt=St[ht],tr=H.points[jt];tt.push(tr.numPoints?Kt(tr):this.points[tr.index])}return tt},et.prototype.getChildren=function(nt){var Lt=this._getOriginId(nt),lt=this._getOriginZoom(nt),Xt="No cluster with the specified id.",_r=this.trees[lt];if(!_r)throw new Error(Xt);var J=_r.points[Lt];if(!J)throw new Error(Xt);for(var Ie=this.options.radius/(this.options.extent*Math.pow(2,lt-1)),V=_r.within(J.x,J.y,Ie),H=[],be=0,tt=V;be<tt.length;be+=1){var ht=tt[be],St=_r.points[ht];St.parentId===nt&&H.push(St.numPoints?Kt(St):this.points[St.index])}if(H.length===0)throw new Error(Xt);return H},et.prototype.getLeaves=function(nt,Lt,lt){Lt=Lt||10,lt=lt||0;var Xt=[];return this._appendLeaves(Xt,nt,Lt,lt,0),Xt},et.prototype.getTile=function(nt,Lt,lt){var Xt=this.trees[this._limitZoom(nt)],_r=Math.pow(2,nt),J=this.options,Ie=J.extent,V=J.radius,H=V/Ie,be=(lt-H)/_r,tt=(lt+1+H)/_r,ht={features:[]};return this._addTileFeatures(Xt.range((Lt-H)/_r,be,(Lt+1+H)/_r,tt),Xt.points,Lt,lt,_r,ht),Lt===0&&this._addTileFeatures(Xt.range(1-H/_r,be,1,tt),Xt.points,_r,lt,_r,ht),Lt===_r-1&&this._addTileFeatures(Xt.range(0,be,H/_r,tt),Xt.points,-1,lt,_r,ht),ht.features.length?ht:null},et.prototype.getClusterExpansionZoom=function(nt){for(var Lt=this._getOriginZoom(nt)-1;Lt<=this.options.maxZoom;){var lt=this.getChildren(nt);if(Lt++,lt.length!==1)break;nt=lt[0].properties.cluster_id}return Lt},et.prototype._appendLeaves=function(nt,Lt,lt,Xt,_r){for(var J=this.getChildren(Lt),Ie=0,V=J;Ie<V.length;Ie+=1){var H=V[Ie],be=H.properties;if(be&&be.cluster?_r+be.point_count<=Xt?_r+=be.point_count:_r=this._appendLeaves(nt,be.cluster_id,lt,Xt,_r):_r<Xt?_r++:nt.push(H),nt.length===lt)break}return _r},et.prototype._addTileFeatures=function(nt,Lt,lt,Xt,_r,J){for(var Ie=0,V=nt;Ie<V.length;Ie+=1){var H=V[Ie],be=Lt[H],tt=be.numPoints,ht=void 0,St=void 0,jt=void 0;if(tt)ht=Yt(be),St=be.x,jt=be.y;else{var tr=this.points[be.index];ht=tr.properties,St=nr(tr.geometry.coordinates[0]),jt=Jt(tr.geometry.coordinates[1])}var Hr={type:1,geometry:[[Math.round(this.options.extent*(St*_r-lt)),Math.round(this.options.extent*(jt*_r-Xt))]],tags:ht},Br=void 0;tt?Br=be.id:this.options.generateId?Br=be.index:this.points[be.index].id&&(Br=this.points[be.index].id),Br!==void 0&&(Hr.id=Br),J.features.push(Hr)}},et.prototype._limitZoom=function(nt){return Math.max(this.options.minZoom,Math.min(Math.floor(+nt),this.options.maxZoom+1))},et.prototype._cluster=function(nt,Lt){for(var lt=[],Xt=this.options,_r=Xt.radius,J=Xt.extent,Ie=Xt.reduce,V=Xt.minPoints,H=_r/(J*Math.pow(2,Lt)),be=0;be<nt.length;be++){var tt=nt[be];if(!(tt.zoom<=Lt)){tt.zoom=Lt;for(var ht=this.trees[Lt+1],St=ht.within(tt.x,tt.y,H),jt=tt.numPoints||1,tr=jt,Hr=0,Br=St;Hr<Br.length;Hr+=1){var Bn=Br[Hr],tn=ht.points[Bn];tn.zoom>Lt&&(tr+=tn.numPoints||1)}if(tr>jt&&tr>=V){for(var gn=tt.x*jt,fi=tt.y*jt,Vn=Ie&&jt>1?this._map(tt,!0):null,vn=(be<<5)+(Lt+1)+this.points.length,bi=0,Mi=St;bi<Mi.length;bi+=1){var Ei=Mi[bi],Gn=ht.points[Ei];if(!(Gn.zoom<=Lt)){Gn.zoom=Lt;var kn=Gn.numPoints||1;gn+=Gn.x*kn,fi+=Gn.y*kn,Gn.parentId=vn,Ie&&(Vn||(Vn=this._map(tt,!0)),Ie(Vn,this._map(Gn)))}}tt.parentId=vn,lt.push(ut(gn/tr,fi/tr,vn,tr,Vn))}else if(lt.push(tt),tr>1)for(var mo=0,Hi=St;mo<Hi.length;mo+=1){var ja=Hi[mo],Tt=ht.points[ja];Tt.zoom<=Lt||(Tt.zoom=Lt,lt.push(Tt))}}}return lt},et.prototype._getOriginId=function(nt){return nt-this.points.length>>5},et.prototype._getOriginZoom=function(nt){return(nt-this.points.length)%32},et.prototype._map=function(nt,Lt){if(nt.numPoints)return Lt?Dr({},nt.properties):nt.properties;var lt=this.points[nt.index].properties,Xt=this.options.map(lt);return Lt&&Xt===lt?Dr({},Xt):Xt};function ut(mt,nt,Lt,lt,Xt){return{x:ze(mt),y:ze(nt),zoom:Infinity,id:Lt,parentId:-1,numPoints:lt,properties:Xt}}function Ct(mt,nt){var Lt=mt.geometry.coordinates,lt=Lt[0],Xt=Lt[1];return{x:ze(nr(lt)),y:ze(Jt(Xt)),zoom:Infinity,index:nt,parentId:-1}}function Kt(mt){return{type:"Feature",id:mt.id,properties:Yt(mt),geometry:{type:"Point",coordinates:[bt(mt.x),vt(mt.y)]}}}function Yt(mt){var nt=mt.numPoints,Lt=nt>=1e4?Math.round(nt/1e3)+"k":nt>=1e3?Math.round(nt/100)/10+"k":nt;return Dr(Dr({},mt.properties),{cluster:!0,cluster_id:mt.id,point_count:nt,point_count_abbreviated:Lt})}function nr(mt){return mt/360+.5}function Jt(mt){var nt=Math.sin(mt*Math.PI/180),Lt=.5-.25*Math.log((1+nt)/(1-nt))/Math.PI;return Lt<0?0:Lt>1?1:Lt}function bt(mt){return(mt-.5)*360}function vt(mt){var nt=(180-mt*360)*Math.PI/180;return 360*Math.atan(Math.exp(nt))/Math.PI-90}function Dr(mt,nt){for(var Lt in nt)mt[Lt]=nt[Lt];return mt}function fr(mt){return mt.x}function sr(mt){return mt.y}return et})}}]);

//# sourceMappingURL=7100.05115758.async.js.map