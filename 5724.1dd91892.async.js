(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[5724],{64335:function(wr,ee,z){"use strict";var _e=z(67294),Q=(0,_e.createContext)({});ee.Z=Q},21349:function(wr,ee,z){"use strict";var _e=z(84305),Q=z(39559),y=z(85893),se=z(94184),U=z.n(se),ce=z(67294),ae=z(64335),Ge=z(53645),oe=z.n(Ge),je=function(ct){var Pt=(0,ce.useContext)(ae.Z),er=ct.children,qt=ct.contentWidth,ir=ct.className,tr=ct.style,Ct=(0,ce.useContext)(Q.ZP.ConfigContext),yt=Ct.getPrefixCls,Fr=ct.prefixCls||yt("pro"),mr=qt||Pt.contentWidth,lr="".concat(Fr,"-grid-content");return(0,y.jsx)("div",{className:U()(lr,ir,{wide:mr==="Fixed"}),style:tr,children:(0,y.jsx)("div",{className:"".concat(Fr,"-grid-content-children"),children:er})})};ee.Z=je},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(wr){try{let oe=function(){U||(U=!0,y())},je=function(){try{se.documentElement.doScroll("left")}catch(rt){return void setTimeout(je,50)}oe()};var Ge=oe,ae=je,ee=(ee=document.getElementsByTagName("script"))[ee.length-1],z=ee.getAttribute("data-injectcss"),ee=ee.getAttribute("data-disable-injectsvg");if(!ee){var _e,Q,y,se,U,ce=function(ct,Pt){Pt.parentNode.insertBefore(ct,Pt)};if(z&&!wr.__iconfont__svg__cssinject__){wr.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(rt){console&&console.log(rt)}}_e=function(){var ct,Pt=document.createElement("div");Pt.innerHTML=wr._iconfont_svg_string_3580659,(Pt=Pt.getElementsByTagName("svg")[0])&&(Pt.setAttribute("aria-hidden","true"),Pt.style.position="absolute",Pt.style.width=0,Pt.style.height=0,Pt.style.overflow="hidden",Pt=Pt,(ct=document.body).firstChild?ce(Pt,ct.firstChild):ct.appendChild(Pt))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(_e,0):(Q=function(){document.removeEventListener("DOMContentLoaded",Q,!1),_e()},document.addEventListener("DOMContentLoaded",Q,!1)):document.attachEvent&&(y=_e,se=wr.document,U=!1,je(),se.onreadystatechange=function(){se.readyState=="complete"&&(se.onreadystatechange=null,oe())})}}catch(oe){}}(window)},24070:function(wr,ee,z){"use strict";z.d(ee,{zP:function(){return UL},JE:function(){return NP},ns:function(){return ZL}});var _e={};z.r(_e),z.d(_e,{add:function(){return $v},adjoint:function(){return Sn},clone:function(){return At},copy:function(){return sr},create:function(){return vt},determinant:function(){return Wn},equals:function(){return a},exactEquals:function(){return Yv},frob:function(){return Wv},fromQuat:function(){return Dd},fromQuat2:function(){return Sa},fromRotation:function(){return Vf},fromRotationTranslation:function(){return uo},fromRotationTranslationScale:function(){return Gv},fromRotationTranslationScaleOrigin:function(){return Hv},fromScaling:function(){return Uf},fromTranslation:function(){return nu},fromValues:function(){return Ft},fromXRotation:function(){return Ld},fromYRotation:function(){return bh},fromZRotation:function(){return Uv},frustum:function(){return jf},getRotation:function(){return jv},getScaling:function(){return Rd},getTranslation:function(){return Vv},identity:function(){return kr},invert:function(){return ui},lookAt:function(){return Fd},mul:function(){return s},multiply:function(){return $n},multiplyScalar:function(){return Oo},multiplyScalarAndAdd:function(){return hf},ortho:function(){return Np},orthoNO:function(){return tc},orthoZO:function(){return Zp},perspective:function(){return Od},perspectiveFromFieldOfView:function(){return Qh},perspectiveNO:function(){return ff},perspectiveZO:function(){return wo},rotate:function(){return Is},rotateX:function(){return Rc},rotateY:function(){return Ps},rotateZ:function(){return Zf},scale:function(){return da},set:function(){return rr},str:function(){return Dc},sub:function(){return c},subtract:function(){return Xv},targetTo:function(){return Sh},translate:function(){return Pi},transpose:function(){return An}});var Q=z(67294),y=(0,Q.createContext)({});function se(){return(0,Q.useContext)(y)}var U={},ce={},ae=function(i){return ce[i]},Ge=function(i,r){ce[i]=r},oe=function(i){return U[i]},je=function(i,r){U[i]=r},rt={},ct={},Pt=34,er=10,qt=13;function ir(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function tr(e,i){var r=ir(e);return function(n,t){return i(r(n),t,e)}}function Ct(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var t in n)t in i||r.push(i[t]=t)}),r}function yt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function Fr(e){return e<0?"-"+yt(-e,6):e>9999?"+"+yt(e,6):yt(e,4)}function mr(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),t=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Fr(e.getUTCFullYear(),4)+"-"+yt(e.getUTCMonth()+1,2)+"-"+yt(e.getUTCDate(),2)+(t?"T"+yt(i,2)+":"+yt(r,2)+":"+yt(n,2)+"."+yt(t,3)+"Z":n?"T"+yt(i,2)+":"+yt(r,2)+":"+yt(n,2)+"Z":r||i?"T"+yt(i,2)+":"+yt(r,2)+"Z":"")}function lr(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(S,A){var k,D,R=t(S,function(N,W){if(k)return k(N,W-1);D=N,k=A?tr(N,A):ir(N)});return R.columns=D||[],R}function t(S,A){var k=[],D=S.length,R=0,N=0,W,me=D<=0,ye=!1;S.charCodeAt(D-1)===er&&--D,S.charCodeAt(D-1)===qt&&--D;function Ne(){if(me)return ct;if(ye)return ye=!1,rt;var tt,Et=R,Vt;if(S.charCodeAt(Et)===Pt){for(;R++<D&&S.charCodeAt(R)!==Pt||S.charCodeAt(++R)===Pt;);return(tt=R)>=D?me=!0:(Vt=S.charCodeAt(R++))===er?ye=!0:Vt===qt&&(ye=!0,S.charCodeAt(R)===er&&++R),S.slice(Et+1,tt-1).replace(/""/g,'"')}for(;R<D;){if((Vt=S.charCodeAt(tt=R++))===er)ye=!0;else if(Vt===qt)ye=!0,S.charCodeAt(R)===er&&++R;else if(Vt!==r)continue;return S.slice(Et,tt)}return me=!0,S.slice(Et,D)}for(;(W=Ne())!==ct;){for(var Ue=[];W!==rt&&W!==ct;)Ue.push(W),W=Ne();A&&(Ue=A(Ue,N++))==null||k.push(Ue)}return k}function o(S,A){return S.map(function(k){return A.map(function(D){return x(k[D])}).join(e)})}function u(S,A){return A==null&&(A=Ct(S)),[A.map(x).join(e)].concat(o(S,A)).join(`
`)}function l(S,A){return A==null&&(A=Ct(S)),o(S,A).join(`
`)}function p(S){return S.map(v).join(`
`)}function v(S){return S.map(x).join(e)}function x(S){return S==null?"":S instanceof Date?mr(S):i.test(S+="")?'"'+S.replace(/"/g,'""')+'"':S}return{parse:n,parseRows:t,format:u,formatBody:l,formatRows:p,formatRow:v,formatValue:x}}var xt=lr(","),at=xt.parse,Rt=xt.parseRows,ft=xt.format,Kt=xt.formatBody,xr=xt.formatRows,Y=xt.formatRow,Le=xt.formatValue,O=z(28991),ke=63710088e-1,Ae={centimeters:ke*100,centimetres:ke*100,degrees:ke/111325,feet:ke*3.28084,inches:ke*39.37,kilometers:ke/1e3,kilometres:ke/1e3,meters:ke,metres:ke,miles:ke/1609.344,millimeters:ke*1e3,millimetres:ke*1e3,nauticalmiles:ke/1852,radians:1,yards:ke*1.0936},st={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ke,yards:1.0936133},_t={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function bt(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function Ht(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return nr(i).geometry;case"LineString":return tn(i).geometry;case"Polygon":return Lr(i).geometry;case"MultiPoint":return vn(i).geometry;case"MultiLineString":return Xn(i).geometry;case"MultiPolygon":return Ai(i).geometry;default:throw new Error(e+" is invalid")}}function nr(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!fe(e[0])||!fe(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return bt(n,i,r)}function Qr(e,i,r){return r===void 0&&(r={}),si(e.map(function(n){return nr(n,i)}),r)}function Lr(e,i,r){r===void 0&&(r={});for(var n=0,t=e;n<t.length;n++){var o=t[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return bt(l,i,r)}function jn(e,i,r){return r===void 0&&(r={}),si(e.map(function(n){return Lr(n,i)}),r)}function tn(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return bt(n,i,r)}function Cn(e,i,r){return r===void 0&&(r={}),si(e.map(function(n){return tn(n,i)}),r)}function si(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function Xn(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return bt(n,i,r)}function vn(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return bt(n,i,r)}function Ai(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return bt(n,i,r)}function Ii(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return bt(n,i,r)}function Ti(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function Gn(e,i){i===void 0&&(i="kilometers");var r=Ae[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Dn(e,i){i===void 0&&(i="kilometers");var r=Ae[i];if(!r)throw new Error(i+" units is invalid");return e/r}function ho(e,i){return Ya(Dn(e,i))}function Hi(e){var i=e%360;return i<0&&(i+=360),i}function Ya(e){var i=e%(2*Math.PI);return i*180/Math.PI}function kt(e){var i=e%360;return i*Math.PI/180}function L(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Gn(Dn(e,i),r)}function ne(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=_t[i];if(!n)throw new Error("invalid original units");var t=_t[r];if(!t)throw new Error("invalid final units");return e/n*t}function fe(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Ze(e){return!!e&&e.constructor===Object}function pt(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!fe(i))throw new Error("bbox must only contain numbers")})}function Wt(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Ar(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ve(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Tt(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Tt(e[0]);throw new Error("coordinates must only contain numbers")}function ar(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Er(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Wr(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,t=e.features;n<t.length;n++){var o=t[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+o.geometry.type)}}function mn(e){return e.type==="Feature"?e.geometry:e}function wn(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function gn(e,i,r){if(e!==null)for(var n,t,o,u,l,p,v,x=0,S=0,A,k=e.type,D=k==="FeatureCollection",R=k==="Feature",N=D?e.features.length:1,W=0;W<N;W++){v=D?e.features[W].geometry:R?e.geometry:e,A=v?v.type==="GeometryCollection":!1,l=A?v.geometries.length:1;for(var me=0;me<l;me++){var ye=0,Ne=0;if(u=A?v.geometries[me]:v,u!==null){p=u.coordinates;var Ue=u.type;switch(x=r&&(Ue==="Polygon"||Ue==="MultiPolygon")?1:0,Ue){case null:break;case"Point":if(i(p,S,W,ye,Ne)===!1)return!1;S++,ye++;break;case"LineString":case"MultiPoint":for(n=0;n<p.length;n++){if(i(p[n],S,W,ye,Ne)===!1)return!1;S++,Ue==="MultiPoint"&&ye++}Ue==="LineString"&&ye++;break;case"Polygon":case"MultiLineString":for(n=0;n<p.length;n++){for(t=0;t<p[n].length-x;t++){if(i(p[n][t],S,W,ye,Ne)===!1)return!1;S++}Ue==="MultiLineString"&&ye++,Ue==="Polygon"&&Ne++}Ue==="Polygon"&&ye++;break;case"MultiPolygon":for(n=0;n<p.length;n++){for(Ne=0,t=0;t<p[n].length;t++){for(o=0;o<p[n][t].length-x;o++){if(i(p[n][t][o],S,W,ye,Ne)===!1)return!1;S++}Ne++}ye++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(gn(u.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function xn(e,i,r,n){var t=r;return gn(e,function(o,u,l,p,v){u===0&&r===void 0?t=o:t=i(t,o,u,l,p,v)},n),t}function ri(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function Jn(e,i,r){var n=r;return ri(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function Wi(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function $i(e,i,r){var n=r;return Wi(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function po(e){var i=[];return gn(e,function(r){i.push(r)}),i}function $o(e,i){var r,n,t,o,u,l,p,v,x,S,A=0,k=e.type==="FeatureCollection",D=e.type==="Feature",R=k?e.features.length:1;for(r=0;r<R;r++){for(l=k?e.features[r].geometry:D?e.geometry:e,v=k?e.features[r].properties:D?e.properties:{},x=k?e.features[r].bbox:D?e.bbox:void 0,S=k?e.features[r].id:D?e.id:void 0,p=l?l.type==="GeometryCollection":!1,u=p?l.geometries.length:1,t=0;t<u;t++){if(o=p?l.geometries[t]:l,o===null){if(i(null,A,v,x,S)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(o,A,v,x,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(i(o.geometries[n],A,v,x,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function Xi(e,i,r){var n=r;return $o(e,function(t,o,u,l,p){o===0&&r===void 0?n=t:n=i(n,t,o,u,l,p)}),n}function G(e,i){$o(e,function(r,n,t,o,u){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return i(bt(r,t,{bbox:o,id:u}),n,0)===!1?!1:void 0}var p;switch(l){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var v=0;v<r.coordinates.length;v++){var x=r.coordinates[v],S={type:p,coordinates:x};if(i(bt(S,t),n,v)===!1)return!1}})}function X(e,i,r){var n=r;return G(e,function(t,o,u){o===0&&u===0&&r===void 0?n=t:n=i(n,t,o,u)}),n}function ie(e,i){G(e,function(r,n,t){var o=0;if(!!r.geometry){var u=r.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var l,p=0,v=0,x=0;if(gn(r,function(S,A,k,D,R){if(l===void 0||n>p||D>v||R>x){l=S,p=n,v=D,x=R,o=0;return}var N=lineString([l,S],r.properties);if(i(N,n,t,R,o)===!1)return!1;o++,l=S})===!1)return!1}}})}function we(e,i,r){var n=r,t=!1;return ie(e,function(o,u,l,p,v){t===!1&&r===void 0?n=o:n=i(n,o,u,l,p,v),t=!0}),n}function Oe(e,i){if(!e)throw new Error("geojson is required");G(e,function(r,n,t){if(r.geometry!==null){var o=r.geometry.type,u=r.geometry.coordinates;switch(o){case"LineString":if(i(r,n,t,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<u.length;l++)if(i(lineString(u[l],r.properties),n,t,l)===!1)return!1;break}}})}function Ke(e,i,r){var n=r;return Oe(e,function(t,o,u,l){o===0&&r===void 0?n=t:n=i(n,t,o,u,l)}),n}function ot(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.segmentIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=p.length+o-1),lineString([p[o],p[o+1]],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o-1),lineString([p[t][o],p[t][o+1]],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o-1),lineString([p[n][o],p[n][o+1]],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o-1),lineString([p[n][t][o],p[n][t][o+1]],u,i)}throw new Error("geojson is invalid")}function pe(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.coordIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":return point(p,u,i);case"MultiPoint":return n<0&&(n=p.length+n),point(p[n],u,i);case"LineString":return o<0&&(o=p.length+o),point(p[o],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o),point(p[t][o],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o),point(p[n][o],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o),point(p[n][t][o],u,i)}throw new Error("geojson is invalid")}var J=z(5991),be=z(6610),lt=z(10379),dt=z(46070),re=z(77608),br=z(14665);function yn(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(i){return typeof e=="function"}}var ln=z(51814);function Qt(e,i,r){return(0,ln.Z)()?Qt=Reflect.construct.bind():Qt=function(t,o,u){var l=[null];l.push.apply(l,o);var p=Function.bind.apply(t,l),v=new p;return u&&(0,br.Z)(v,u.prototype),v},Qt.apply(null,arguments)}function en(e){var i=typeof Map=="function"?new Map:void 0;return en=function(n){if(n===null||!yn(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,t)}function t(){return Qt(n,arguments,(0,re.Z)(this).constructor)}return t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),(0,br.Z)(t,n)},en(e)}var Gr={REGISTERED_PROTOCOLS:{}};function Yr(e){var i=li();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function li(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qr=function(i){return Gr.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]},hi=function(e){(0,lt.Z)(r,e);var i=Yr(r);function r(n,t,o,u){var l;return(0,be.Z)(this,r),l=i.call(this,"AJAXError: ".concat(t," (").concat(n,"): ").concat(o)),l.status=n,l.statusText=t,l.url=o,l.body=u,l}return(0,J.Z)(r)}(en(Error));function Bi(e,i){var r=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(var t in e.headers)e.headers.hasOwnProperty(t)&&r.setRequestHeader(t,e.headers[t]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=function(){i(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){var o=r.response;if(e.type==="json")try{o=JSON.parse(r.response)}catch(l){return i(l)}i(null,o,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{var u=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});i(new hi(r.status,r.statusText,n.toString(),u))}},r.cancel=r.abort,r.send(e.body),r}function ci(e){return new Promise(function(i,r){Bi(e,function(n,t,o,u,l){n?r({err:n,data:null,xhr:l}):i({err:null,data:t,cacheControl:o,expires:u,xhr:l})})})}function _i(e,i){return Bi(e,i)}var xi=function(i,r){var n=qr(i.url)||_i;return n((0,O.Z)((0,O.Z)({},i),{},{type:"json"}),r)},ao=function(i,r){var n=qr(i.url)||_i;return n((0,O.Z)((0,O.Z)({},i),{},{type:"arrayBuffer"}),r)},Ui=function(i,r){return _i(_objectSpread(_objectSpread({},i),{},{method:"POST"}),r)},aa=function(i,r){return _i((0,O.Z)((0,O.Z)({},i),{},{method:"GET"}),r)};function bi(e){var i=window.document.createElement("a");return i.href=e,i.protocol===window.document.location.protocol&&i.host===window.document.location.host}var fi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function vi(e,i){var r=new window.Image,n=window.URL||window.webkitURL;r.crossOrigin="anonymous",r.onload=function(){i(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(function(){r.src=fi})},r.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var t=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(t):fi}function fa(e,i){var r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(function(n){i(null,n)}).catch(function(n){i(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var ms=function(i,r,n){var t=function(u,l){if(u)r(u);else if(l){var p=typeof createImageBitmap=="function",v=n?n(l):l;p?fa(v,r):vi(v,r)}};return i.type==="json"?xi(i,t):ao(i,t)},Ki=function(i,r){var n=typeof createImageBitmap=="function";n?fa(i,r):vi(i,r)},ha=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),Su={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function wu(e,i,r){var n=e.classList;for(var t in Su)Su.hasOwnProperty(t)&&n.remove("l7-".concat(r,"-anchor-").concat(t));n.add("l7-".concat(r,"-anchor-").concat(i))}var oa=z(2650);function vo(e){return typeof e=="string"?!!d3.color(e):!1}function Hn(e){var i=oa.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function ra(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],t=i+r*256+n*65536-1;return t}function Ea(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function zi(e){var i=window.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=null,t=r.createLinearGradient(0,0,256,1),o=e.positions[0],u=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var p=(e.positions[l]-o)/(u-o);t.addColorStop(p,e.colors[l])}return r.fillStyle=t,r.fillRect(0,0,256,1),n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),i=null,r=null,{data:n,width:256,height:1}}function To(e,i){var r=window.document.createElement("canvas"),n=r.getContext("2d");r.width=256,r.height=1;for(var t=n.createLinearGradient(0,0,256,1),o=i[1]-i[0],u=0;u<e.colors.length;++u){var l=Math.max((e.positions[u]-i[0])/o,0);t.addColorStop(l,e.colors[u])}n.fillStyle=t,n.fillRect(0,0,256,1);var p=n.getImageData(0,0,256,1).data,v=Fl(n,p);return r=null,n=null,v}function mo(e){var i=window.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;var n=r.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(t,o){var u=Hn(e.colors[o]);n.data[t*4+0]=u[0]*255,n.data[t*4+1]=u[1]*255,n.data[t*4+2]=u[2]*255,n.data[t*4+3]=u[3]*255}),i=null,r=null,n}function Ds(e){var i=window.document.createElement("canvas"),r=i.getContext("2d");r.globalAlpha=1,i.width=256,i.height=1;for(var n=256/e.colors.length,t=0;t<e.colors.length;t++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[t],r.moveTo(t*n,0),r.lineTo((t+1)*n,0),r.stroke();var o=r.getImageData(0,0,256,1).data,u=Fl(r,o);return i=null,r=null,u}function is(e,i){var r=window.document.createElement("canvas"),n=r.getContext("2d");n.globalAlpha=1,r.width=256,r.height=1;var t=i[1]-i[0];e.positions.length-e.colors.length!=1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var o=0;o<e.colors.length;o++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[o],n.moveTo((e.positions[o]-i[0])/t*255,0),n.lineTo((e.positions[o+1]-i[0])/t*255,0),n.stroke();var u=n.getImageData(0,0,256,1).data,l=Fl(n,u);return r=null,n=null,l}function Fl(e,i){for(var r=e.createImageData(256,1),n=0;n<r.data.length;n+=4)r.data[n+0]=i[n+0],r.data[n+1]=i[n+1],r.data[n+2]=i[n+2],r.data[n+3]=i[n+3];return r}function Xo(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var la={BACK:1029,FRONT:1028};function ga(e){switch(e){case"GAODE1.x":return la.BACK;case"GAODE2.x":return la.BACK;case"MAPBOX":return la.FRONT;case"SIMPLE":return la.FRONT;case"GLOBEL":return la.BACK;case"DEBAULT":return la.FRONT;default:return la.FRONT}}var cr=z(85061),K=z(28481),Me=z(74691),nt=z.n(Me),Jt=z(50361),Vr=z.n(Jt),Mn=z(23279),Ri=z.n(Mn),Pa=z(27361),oo=z.n(Pa),Ua=z(51584),as=z.n(Ua),sc=z(60442),Os=z.n(sc),Uc=z(14293),Fs=z.n(Uc),Bu=z(81763),os=z.n(Bu),ul=z(68630),zu=z.n(ul),Js=z(47037),Bl=z.n(Js),Yo=z(36719),La=z.n(Yo),zl=z(82492),Vc=z.n(zl),bf=z(30236),Nu=z.n(bf),Nl=z(97019),jc=z.n(Nl),Gc=z(23493),Sf=z.n(Gc),ih=z(44908),ah=z.n(ih),Zh=z(11700),uc=z.n(Zh),lc=z(23560),oh=z.n(lc),Ra=z(13218),wf=z.n(Ra),Zu=z(52353),Bs=z.n(Zu),ll=z(68929),zs=z.n(ll),ii={isNil:Fs(),merge:Vc(),throttle:Sf(),isString:Bl(),debounce:Ri(),pull:jc(),isTypedArray:La(),isPlainObject:zu(),isNumber:os(),isBoolean:as(),isEqual:Os(),cloneDeep:Vr(),uniq:ah(),clamp:nt(),upperFirst:uc(),get:oo(),mergeWith:Nu(),isFunction:oh(),isObject:wf(),isUndefined:Bs(),camelCase:zs()},Ns=ii.pull;function Eu(e){var i=e;return typeof e=="string"&&(i=window.document.getElementById(e)),i}function qo(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function cc(e){return qo(e).split(/\s+/)}function sh(e){var i,r,n,t=(i=window)===null||i===void 0||(r=i.document)===null||r===void 0||(n=r.documentElement)===null||n===void 0?void 0:n.style;if(!t)return e[0];for(var o in e)if(e[o]&&e[o]in t)return e[o];return e[0]}function kn(e,i,r){var n=window.document.createElement(e);return i&&(n.className=i||""),r&&r.appendChild(n),n}function gs(e){var i=e.parentNode;i&&i.removeChild(e)}function Ko(e,i){if(e.classList!==void 0)for(var r=cc(i),n=0,t=r.length;n<t;n++)e.classList.add(r[n]);else if(!uh(e,i)){var o=pa(e);Hc(e,(o?o+" ":"")+i)}}function Uu(e,i){if(e.classList!==void 0){var r=cc(i);r.forEach(function(n){e.classList.remove(n)})}else Hc(e,qo((" "+pa(e)+" ").replace(" "+i+" "," ")))}function uh(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=pa(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Hc(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function pa(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function cl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Vu=sh(["transform","WebkitTransform"]);function Mo(e,i){e.style[Vu]=i}function Wc(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function $c(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Au(){var e,i=window.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(t){var o=t.split("="),u=(0,K.Z)(o,1),l=u[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var qi=Au()<1?1:window.devicePixelRatio;function Zl(e,i){e.setAttribute("style","".concat(e.style.cssText).concat(i))}function Zs(e){return e.split(";").map(function(i){return i.trim()}).filter(function(i){return i})}function Cu(e,i){var r,n=Zs((r=e.getAttribute("style"))!==null&&r!==void 0?r:""),t=Zs(i),o=Ns.apply(void 0,[n].concat((0,cr.Z)(t)));e.setAttribute("style",o.join(";"))}function Ef(e){return Object.entries(e).map(function(i){var r=(0,K.Z)(i,2),n=r[0],t=r[1];return"".concat(n,": ").concat(t)}).join(";")}function fl(e,i){return{left:e.left-i.left,top:e.top-i.top,right:i.left+i.width-e.left-e.width,bottom:i.top+i.height-e.top-e.height}}function Yi(e,i){e.checked=i,i?e.setAttribute("checked","true"):e.removeAttribute("checked")}function ju(e){e.innerHTML=""}function lh(e){e.setAttribute("draggable","false")}function Us(e,i){if(typeof i=="string"){var r=document.createElement("div");for(r.innerHTML=i;r.firstChild;)e.append(r.firstChild)}else Array.isArray(i)?e.append.apply(e,(0,cr.Z)(i)):e.append(i)}function ch(e,i){for(var r=Array.isArray(i)?i:[i],n=e;n instanceof Element&&n!==window.document.body;){var t,o;if(r.find(function(u){var l;return(l=n)===null||l===void 0?void 0:l.matches(u)}))return n;n=(t=(o=n)===null||o===void 0?void 0:o.parentElement)!==null&&t!==void 0?t:null}}var fc;function hc(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function Ul(){return typeof importScripts=="function"}var hl=Ul()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},ys=(fc=navigator)===null||fc===void 0?void 0:fc.userAgent,pc=!!ys.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Vl=ys.indexOf("Android")>-1||ys.indexOf("Adr")>-1;function Gu(){for(var e=ys,i=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],r=!0,n=0,t=i;n<t.length;n++){var o=t[n];if(e.indexOf(o)>0){r=!1;break}}return r}function dc(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var jl=null;function ss(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return gn(e,function(r){i[0]>r[0]&&(i[0]=r[0]),i[1]>r[1]&&(i[1]=r[1]),i[2]<r[0]&&(i[2]=r[0]),i[3]<r[1]&&(i[3]=r[1])}),i}ss.default=ss;var Af=ss;function vc(e){return typeof e=="number"}var Gl=2*Math.PI*6378137/2;function Hu(e,i){var r=(0,K.Z)(i,4),n=r[0],t=r[1],o=r[2],u=r[3];return e.lng>n&&e.lng<=o&&e.lat>t&&e.lat<=u}function Hl(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;Wl(i,n)}),i}function Wl(e,i){return Array.isArray(i[0])?i.forEach(function(r){Wl(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function pl(e,i){return dl(e,i)}function dl(e,i){return Array.isArray(e[0])?e.map(function(r){return dl(r,i)}):i(e)}function mc(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=hh(e,i);var n=e[0],t=e[1],o=n*Gl/180,u=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return u=u*Gl/180,r.enable&&(o=Number(o.toFixed(r.decimal)),u=Number(u.toFixed(r.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function vl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],t=r/Gl*180,o=n/Gl*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),i!=null&&(t=Number(t.toFixed(i)),o=Number(o.toFixed(i))),e.length===3?[t,o,e[2]]:[t,o]}function Cf(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function fh(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function hh(e,i){if(i===!1)return e;var r=Cf(e[0]),n=fh(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Da(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,t=Math.PI/180,o=e[0]*t,u=r*t;u=Math.log(Math.tan(Math.PI/4+u/2));var l=.5/Math.PI,p=.5,v=-.5/Math.PI;return t=.5,o=n*(l*o+p),u=n*(v*u+t),[Math.floor(o),Math.floor(u)]}function ph(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,t=.5,o=256<<20,u=_slicedToArray(e,2),l=u[0],p=u[1];l=(l/o-r)/i,p=(p/o-t)/n,p=(Math.atan(Math.pow(Math.E,p))-Math.PI/4)*2,t=Math.PI/180;var v=p/t,x=l/t;return[x,v]}function dh(e,i){var r=85.0511287798,n=Math.PI/180,t=6378137;return i=Math.max(Math.min(r,i),-r),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*t,i*t]}function vh(e,i){var r=Math.PI/180,n=6378137,t=e/n/r,o=2*(Math.atan(Math.exp(i/n))-Math.PI/4)/r;return[t,o]}function ml(e,i,r){var n=kt(i[1]-e[1]),t=kt(i[0]-e[0]),o=kt(e[1]),u=kt(i[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(t/2),2)*Math.cos(o)*Math.cos(u);return Gn(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),r="meters")}function Uh(e){var i=Math.PI/180,r=85.0511287798,n=6378137,t=Math.max(Math.min(r,e[1]),-r),o=Math.sin(t*i),u=n*e[0]*i,l=n*Math.log((1+o)/(1-o))/2;return[u,l]}function _s(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Ji(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Wu(e){return[[e[0],e[1]],[e[2],e[3]]]}function su(e){var i=Tu(e,[0,0]);return[e[0]/i,e[1]/i]}function Tu(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Si(e,i){return e[0]*i[0]+e[1]*i[1]}function Qi(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Vs(e,i){return Math.acos(Si(e,i)/(Qi(e)*Qi(i)))*180/Math.PI}function gc(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function yc(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,t=[],o=0;o<e.length-1;o++){var u=e[o],l=e[o+1],p=Tu(u,l);n+=p;var v=[u[0]-l[0],u[1]-l[1]],x=gc(r,v);if(o>0){var S=t[o-1].rotation;S-x>360-S+x&&(x=x+360)}t.push({start:u,end:l,dis:p,rotation:x,duration:0})}return t.map(function(A){A.duration=i*(A.dis/n)}),t}}function xs(e){if(vc(e[0]))return e;if(vc(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(vc(e[0][0][0])){var i=e,r=0,n=0,t=0;return i.forEach(function(o){o.forEach(function(u){r+=u[0],n+=u[1],t++})}),[r/t,n/t,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Vh(e){for(var i=e[0],r=e[1],n=e[0],t=e[1],o=0,u=0,l=0,p=0;p<e.length;p+=2){var v=e[p],x=e[p+1];v&&x&&(i=Math.max(v,i),r=Math.max(x,r),n=Math.min(v,n),t=Math.min(x,t),o+=v,u+=x,l++)}return{center:[o/l,u/l],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-t,2))/2}}function jh(e){return Af(si([tn(e)]))}function _c(e){var i=131,r=137,n=0;e+="x";for(var t=Math.floor(9007199254740991/r),o=0;o<e.length;o++)n>t&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(o);return n}function $u(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}function Mu(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=Math.random()*16|0,r=e==="x"?i:i&3|8;return r.toString(16)})}var Oa=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function Jo(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=r;return u&&(l=Math.round(r*(o-1))/(o-1)),n?No(e,i,l,n,t):No(e,i,l,.314,t)}function uu(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function Fa(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function pn(e,i,r){var n=[i[0]-e[0],i[1]-e[1]],t=Fa(n,[0,0]),o=Math.atan2(n[1],n[0]),u=t/2/Math.cos(r),l=o+r,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function No(e,i,r,n,t){if(t===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(i[0],i[1]),l=pn(o,u,n),p=[o[0],l[0],u[0]],v=[o[1],l[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(uu(p,r),uu(v,r))),[0])}else{var x=pn(e,i,n),S=[e[0],x[0],i[0]],A=[e[1],x[1],i[1]];return[uu(S,r),uu(A,r),0]}}function Xc(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=r;return u&&(l=Math.round(r*29)/29),Xu(e,i,l,t)}function gl(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=calDistance(r,[0,0]),t=Math.atan2(r[1],r[0]),o=.314,u=n/2/Math.cos(o),l=t+o,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function bs(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function us(e,i){var r=[e[0]-i[0],e[1]-i[1]],n=[Math.sin(r[0]/2),Math.sin(r[1]/2)],t=n[1]*n[1]+Math.cos(e[1])*Math.cos(i[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t))}function Xu(e,i,r,n){var t=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(i[0]),degreesToRadians(i[1])];if(n==="GAODE2.x"){var u=gl(t,o),l=[t[0],u[0],o[0]],p=[t[1],u[1],o[1]];return[bs(l,r),bs(p,r),0]}else{var v=us(t,o);if(Math.abs(v-Math.PI)<.001)return[(1-r)*t[0]+r*o[0],(1-r)*t[1]+r*o[1]];var x=Math.sin((1-r)*v)/Math.sin(v),S=Math.sin(r*v)/Math.sin(v),A=[Math.sin(t[0]),Math.sin(t[1])],k=[Math.cos(t[0]),Math.cos(t[1])],D=[Math.sin(o[0]),Math.sin(o[1])],R=[Math.cos(o[0]),Math.cos(o[1])],N=x*k[1]*k[0]+S*R[1]*R[0],W=x*k[1]*A[0]+S*R[1]*D[0],me=x*A[1]+S*D[1];return[radiansToDegrees(Math.atan2(W,N)),radiansToDegrees(Math.atan2(me,Math.sqrt(N*N+W*W)))]}}function Dr(e,i){for(var r=0,n=[],t=0;t<e.length-1;t++){var o=e[t],u=e[t+1],l=xc(o,u),p=r;r+=l,n.push({p1:o,p2:u,totalDistance:r,distance:l,lastTotalDistance:p})}for(var v=r*i,x,S,A=0,k=n;A<k.length;A++){var D=k[A],R=D.totalDistance;if(R>v){var N=D.p1,W=D.p2,me=(v-D.lastTotalDistance)/D.distance,ye=Yc(W,N,me);x=ye[0],S=ye[1];break}}return{lng:x,lat:S,height:0}}function Yc(e,i,r){return[e[0]*r+i[0]*(1-r),e[1]*r+i[1]*(1-r)]}function xc(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function lu(e,i){var r=i.featureId,n=e.data.dataArray;return typeof r=="number"&&(n=n.filter(function(t){var o=t.id;return o===r})),n.map(function(t){var o=Qo(t,i);return _objectSpread(_objectSpread({},t),o)})}function js(e,i){return new Promise(function(r){e.inited?r(lu(e,i)):e.once("update",function(){r(lu(e,i))})})}function Qo(e,i){var r=i.offset,n=i.shape,t=i.thetaOffset,o=i.mapVersion,u=i.segmentNumber,l=u===void 0?30:u,p=i.autoFit,v=p===void 0?!0:p,x=e.coordinates;if(n==="line")return pathLineAtOffset(x,r);var S=x[0],A=x[1],k=typeof t=="string"?e[t]||0:t,D;switch(n){case"arc":D=arcLineAtOffset;break;case"greatcircle":D=greatCircleLineAtOffset;break;default:D=arcLineAtOffset}var R=D(S,A,r,k,o,l,v),N=_slicedToArray(R,3),W=N[0],me=N[1],ye=N[2];return{lng:W,lat:me,height:ye}}var qc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,be.Z)(this,e),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,J.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(t){return t===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function Kc(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function ls(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function cu(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function Jc(e){if(e.length===0)throw new Error("mean requires at least one data point");return cu(e)/e.length}function $l(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,t=1,o=1;o<e.length+1;o++)e[o]!==i?(t>n&&(n=t,r=i),t=1,i=e[o]):t++;return r*1}var bc={min:ls,max:Kc,mean:Jc,sum:cu,mode:$l};function Xl(e,i){return e.map(function(r){return r[i]})}function Gs(e,i){return bc[e](i)}var It=z(92137),Ee=z(63349),V=z(96156),go=z(87757),he=z.n(go);function Yu(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),t=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[r,n],l=[r,o],p=[t,o],v=[t,n];return Lr([[u,v,p,l,u]],i.properties,{bbox:e,id:i.id})}var ya=z(26729),cs=z.n(ya),so=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),Zo=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),Ln=0,_n=1,qu=2;function ko(e){e.forEach(function(i){i.isCurrent&&(i.isVisible=i.isLoaded)})}function qa(e){e.forEach(function(i){i.properties.state=Ln}),e.forEach(function(i){i.isCurrent&&!Qs(i)&&Ss(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&qu)})}function yo(e){e.forEach(function(r){r.properties.state=Ln}),e.forEach(function(r){r.isCurrent&&Qs(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&qu),r.children.length&&(r.isVisible||r.properties.state&_n)?r.children.forEach(function(n){n.properties.state=_n}):r.isCurrent&&Ss(r)})}function Qs(e){for(;e;){if(e.isLoaded)return e.properties.state|=qu,!0;e=e.parent}return!1}function Ss(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=qu:Ss(i)})}var fu,Di=256,Ba=[-Infinity,-Infinity,Infinity,Infinity],Tf=.2,Ku=5,Qc=(fu={},(0,V.Z)(fu,so.Realtime,ko),(0,V.Z)(fu,so.Overlap,qa),(0,V.Z)(fu,so.Replace,yo),fu),hu=function(){};function Io(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),t=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,t]}function yl(e,i,r){var n=e/Math.pow(2,r)*360-180,t=Math.PI-2*Math.PI*i/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)));return[n,o]}var eu=function(i,r,n){var t=yl(i,r,n),o=(0,K.Z)(t,2),u=o[0],l=o[1],p=yl(i+1,r+1,n),v=(0,K.Z)(p,2),x=v[0],S=v[1];return[u,S,x,l]};function ef(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,t=n===void 0?Infinity:n,o=e.minZoom,u=o===void 0?0:o,l=e.zoomOffset,p=l===void 0?0:l,v=e.extent,x=v===void 0?Ba:v,S=Math.ceil(i)+p;if(Number.isFinite(u)&&S<u)return[];Number.isFinite(t)&&S>t&&(S=t);for(var A=(0,K.Z)(r,4),k=A[0],D=A[1],R=A[2],N=A[3],W=[Math.max(k,x[0]),Math.max(D,x[1]),Math.min(R,x[2]),Math.min(N,x[3])],me=[],ye=Io(W[0],W[1],S),Ne=(0,K.Z)(ye,2),Ue=Ne[0],tt=Ne[1],Et=Io(W[2],W[3],S),Vt=(0,K.Z)(Et,2),Yt=Vt[0],gr=Vt[1],hr=Ue;hr<=Yt;hr++)for(var Hr=gr;Hr<=tt;Hr++)me.push({x:hr,y:Hr,z:S});var fn=(Yt+Ue)/2,Rn=(tt+gr)/2,Zi=function(Za,io){return Math.abs(Za-fn)+Math.abs(io-Rn)};return me.sort(function(Ia,Za){return Zi(Ia.x,Ia.y)-Zi(Za.x,Za.y)}),me}var Yl=function(i,r,n){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,o=Math.pow(2,n),u=o-1,l=o,p=i,v=r;return t&&(p<0?p=p+l:p>u&&(p=p%l)),{warpX:p,warpY:v}};function Sc(e){var i=Mf();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function Mf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ql=function(e){(0,lt.Z)(r,e);var i=Sc(r);function r(n){var t;(0,be.Z)(this,r),t=i.call(this),(0,V.Z)((0,Ee.Z)(t),"tileSize",256),(0,V.Z)((0,Ee.Z)(t),"isVisible",!1),(0,V.Z)((0,Ee.Z)(t),"isCurrent",!1),(0,V.Z)((0,Ee.Z)(t),"isVisibleChange",!1),(0,V.Z)((0,Ee.Z)(t),"loadedLayers",0),(0,V.Z)((0,Ee.Z)(t),"isLayerLoaded",!1),(0,V.Z)((0,Ee.Z)(t),"isLoad",!1),(0,V.Z)((0,Ee.Z)(t),"isChildLoad",!1),(0,V.Z)((0,Ee.Z)(t),"parent",null),(0,V.Z)((0,Ee.Z)(t),"children",[]),(0,V.Z)((0,Ee.Z)(t),"data",null),(0,V.Z)((0,Ee.Z)(t),"properties",{}),(0,V.Z)((0,Ee.Z)(t),"loadDataId",0);var o=n.x,u=n.y,l=n.z,p=n.tileSize,v=n.warp,x=v===void 0?!0:v;return t.x=o,t.y=u,t.z=l,t.warp=x||!0,t.tileSize=p,t}return(0,J.Z)(r,[{key:"isLoading",get:function(){return this.loadStatus===Zo.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Zo.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Zo.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Zo.Cancelled}},{key:"isDone",get:function(){return[Zo.Loaded,Zo.Cancelled,Zo.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return eu(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,K.Z)(this.bounds,4),o=t[0],u=t[1],l=t[2],p=t[3],v=[(l-o)/2,(p-u)/2],x=Yu(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return x}},{key:"key",get:function(){var t="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return t}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,It.Z)(he().mark(function o(u){var l,p,v,x,S,A,k,D,R,N,W,me,ye,Ne,Ue,tt,Et;return he().wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:return l=u.getData,p=u.onLoad,v=u.onError,this.loadDataId++,x=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Zo.Loading,S=null,Yt.prev=7,k=this.x,D=this.y,R=this.z,N=this.bounds,W=this.tileSize,me=this.warp,ye=Yl(k,D,R,me),Ne=ye.warpX,Ue=ye.warpY,tt=this.abortController.signal,Et={x:Ne,y:Ue,z:R,bounds:N,tileSize:W,signal:tt,warp:me},Yt.next=14,l(Et,this);case 14:S=Yt.sent,Yt.next=20;break;case 17:Yt.prev=17,Yt.t0=Yt.catch(7),A=Yt.t0;case 20:if(x===this.loadDataId){Yt.next=22;break}return Yt.abrupt("return");case 22:if(!(this.isCancelled&&!S)){Yt.next=24;break}return Yt.abrupt("return");case 24:if(!(A||!S)){Yt.next=28;break}return this.loadStatus=Zo.Failure,v(A,this),Yt.abrupt("return");case 28:this.loadStatus=Zo.Loaded,this.data=S,p(this);case 31:case"end":return Yt.stop()}},o,this,[[7,17]])}));function t(o){return n.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Zo.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(ya.EventEmitter),Ju=function(i,r){var n=Wu(i),t=_s(n,r),o=360*3-180,u=85.0511287798065,l=[Math.max(t[0][0],-o),Math.max(t[0][1],-u),Math.min(t[1][0],o),Math.min(t[1][1],u)];return l},tf=function(i,r){var n=Wu(i),t=Wu(r),o=Ji(n,t);return o};function es(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Qu(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Qu(e,i){if(!!e){if(typeof e=="string")return _l(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _l(e,i)}}function _l(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function tu(e){var i=Hs();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function Hs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kf=ii.throttle,pu=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),If=function(e){(0,lt.Z)(r,e);var i=tu(r);function r(n){var t;return(0,be.Z)(this,r),t=i.call(this),(0,V.Z)((0,Ee.Z)(t),"currentTiles",[]),(0,V.Z)((0,Ee.Z)(t),"cacheTiles",new Map),(0,V.Z)((0,Ee.Z)(t),"throttleUpdate",kf(function(o,u){t.update(o,u)},16)),(0,V.Z)((0,Ee.Z)(t),"onTileLoad",function(o){t.emit(pu.TileLoaded,o),t.updateTileVisible(),t.loadFinished()}),(0,V.Z)((0,Ee.Z)(t),"onTileError",function(o,u){t.emit(pu.TileError,{error:o,tile:u}),t.updateTileVisible(),t.loadFinished()}),(0,V.Z)((0,Ee.Z)(t),"onTileUnload",function(o){t.emit(pu.TileUnload,o),t.loadFinished()}),t.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:Ba,getTileData:hu,warp:!0,updateStrategy:so.Replace},t.updateOptions(n),t}return(0,J.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(t){return t.isDone})}},{key:"tiles",get:function(){var t=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return t}},{key:"updateOptions",value:function(t){var o=t.minZoom===void 0?this.options.minZoom:Math.ceil(t.minZoom),u=t.maxZoom===void 0?this.options.maxZoom:Math.floor(t.maxZoom);this.options=(0,O.Z)((0,O.Z)((0,O.Z)({},this.options),t),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(t,o){var u=this,l=Math.max(0,Math.ceil(t));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&tf(this.lastViewStates.latLonBoundsBuffer,o))){var p=Ju(o,Tf);this.lastViewStates={zoom:l,latLonBounds:o,latLonBoundsBuffer:p},this.currentZoom=l;var v=!1,x=this.getTileIndices(l,p).filter(function(S){return u.options.warp||S.x>=0&&S.x<Math.pow(2,l)});this.emit(pu.TilesLoadStart),this.currentTiles=x.map(function(S){var A=S.x,k=S.y,D=S.z,R=u.getTile(A,k,D);if(R){var N,W,me=((N=R)===null||N===void 0?void 0:N.isFailure)||((W=R)===null||W===void 0?void 0:W.isCancelled);return me&&R.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),R}return R=u.createTile(A,k,D),v=!0,R}),v&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t=es(this.cacheTiles),o;try{for(t.s();!(o=t.n()).done;){var u=(0,K.Z)(o.value,2),l=u[0],p=u[1];if(!this.currentTiles.includes(p)){this.cacheTiles.delete(l),this.onTileUnload(p);return}this.onTileUnload(p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(v){t.e(v)}finally{t.f()}}},{key:"reloadTileById",value:function(t,o,u){var l=this.cacheTiles.get("".concat(o,",").concat(u,",").concat(t));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(t,o,u){var l=this.getTileByLngLat(t,o,u);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(t,o){var u=this,l=this.getTileIndices(o,t);l.forEach(function(p){u.reloadTileById(p.z,p.x,p.y)})}},{key:"pruneRequests",value:function(){var t=[],o=es(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&t.push(l)}}catch(v){o.e(v)}finally{o.f()}for(;t.length>0;){var p=t.shift();p.abortLoad()}}},{key:"getTileByLngLat",value:function(t,o,u){var l=this.options.zoomOffset,p=Math.ceil(u)+l,v=Io(t,o,p),x=this.tiles.filter(function(S){return S.key==="".concat(v[0],"_").concat(v[1],"_").concat(p)});return x[0]}},{key:"getTileExtent",value:function(t,o){return this.getTileIndices(o,t)}},{key:"getTileByZXY",value:function(t,o,u){var l=this.tiles.filter(function(p){return p.key==="".concat(o,"_").concat(u,"_").concat(t)});return l[0]}},{key:"clear",value:function(){var t=es(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.isLoading?u.abortLoad():this.onTileUnload(u)}}catch(l){t.e(l)}finally{t.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t=this.options.updateStrategy,o=new Map,u=es(this.cacheTiles.values()),l;try{for(u.s();!(l=u.n()).done;){var p=l.value;o.set(p.key,p.isVisible),p.isCurrent=!1,p.isVisible=!1}}catch(D){u.e(D)}finally{u.f()}var v=es(this.currentTiles),x;try{for(v.s();!(x=v.n()).done;){var S=x.value;S.isCurrent=!0,S.isVisible=!0}}catch(D){v.e(D)}finally{v.f()}var A=Array.from(this.cacheTiles.values());typeof t=="function"?t(A):Qc[t](A);var k=!1;Array.from(this.cacheTiles.values()).forEach(function(D){D.isVisible!==o.get(D.key)?(D.isVisibleChange=!0,k=!0):D.isVisibleChange=!1}),k&&this.emit(pu.TileUpdate)}},{key:"getTileIndices",value:function(t,o){var u=this.options,l=u.tileSize,p=u.extent,v=u.zoomOffset,x=Math.floor(this.options.maxZoom),S=Math.ceil(this.options.minZoom),A=ef({maxZoom:x,minZoom:S,zoomOffset:v,tileSize:l,zoom:t,latLonBounds:o,extent:p});return A}},{key:"getTileId",value:function(t,o,u){var l="".concat(t,",").concat(o,",").concat(u);return l}},{key:"loadFinished",value:function(){var t=!this.currentTiles.some(function(o){return!o.isDone});return t&&this.emit(pu.TilesLoadFinished),t}},{key:"getTile",value:function(t,o,u){var l=this.getTileId(t,o,u),p=this.cacheTiles.get(l);return p}},{key:"createTile",value:function(t,o,u){var l=this.getTileId(t,o,u),p=new ql({x:t,y:o,z:u,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),p}},{key:"resizeCacheTiles",value:function(){var t=Ku*this.currentTiles.length,o=this.cacheTiles.size>t;if(o){var u=es(this.cacheTiles),l;try{for(u.s();!(l=u.n()).done;){var p=(0,K.Z)(l.value,2),v=p[0],x=p[1];if(!x.isVisible&&!this.currentTiles.includes(x)&&(this.cacheTiles.delete(v),this.onTileUnload(x)),this.cacheTiles.size<=t)break}}catch(S){u.e(S)}finally{u.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var t=es(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(S){t.e(S)}finally{t.f()}var l=es(this.cacheTiles.values()),p;try{for(l.s();!(p=l.n()).done;){var v=p.value,x=this.getNearestAncestor(v.x,v.y,v.z);v.parent=x,x!=null&&x.children&&x.children.push(v)}}catch(S){l.e(S)}finally{l.f()}}},{key:"getNearestAncestor",value:function(t,o,u){for(;u>this.options.minZoom;){t=Math.floor(t/2),o=Math.floor(o/2),u=u-1;var l=this.getTile(t,o,u);if(l)return l}return null}}]),r}(cs());function Pf(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function f(e){var i=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),t=r[2].charCodeAt(0),o;for(o=n;o<=t;++o)i.push(e.replace(r[0],String.fromCharCode(o)));return i}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){for(var u=parseInt(r[2],10),l=parseInt(r[1],10);l<=u;l++)i.push(e.replace(r[0],l.toString()));return i}return i.push(e),i}function d(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,t=i.z,o=f(e),u=Math.abs(r+n)%o.length,l=qr(o[u])?"".concat(o[u],"/{z}/{x}/{y}"):o[u];return l.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,t.toString()).replace(/\{bbox\}/g,eu(r,n,t).join(",")).replace(/\{-y\}/g,(Math.pow(2,t)-n-1).toString())}function h(e,i){var r=i.x,n=i.y,t=i.z,o=i.layer,u=i.version,l=u===void 0?"1.0.0":u,p=i.style,v=p===void 0?"default":p,x=i.format,S=i.service,A=S===void 0?"WMTS":S,k=i.tileMatrixset,D="".concat(e,"&SERVICE=").concat(A,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(o,"&STYLE=").concat(v,"&TILEMATRIXSET=").concat(k,"&FORMAT=").concat(x,"&TILECOL=").concat(r,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(t);return D}function g(e,i){if(!e)throw new Error(i||"web worker helper assertion failed.")}var w={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},C=w.self||w.window||{},T=w.window||w.self||{},I=w.self||w.window||{},Z=w.document||{},$=typeof importScripts=="function",le=typeof window!="undefined"&&typeof window.orientation!="undefined",ve=function(){function e(i,r){var n=this;this.name=i,this.workerThread=r,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(t,o){n.resolve=t,n.reject=o})}return e.prototype.postMessage=function(i,r){this.workerThread.postMessage({source:"Main thread",type:i,payload:r})},e.prototype.done=function(i){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(i)},e.prototype.error=function(i){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(i)},e}(),xe=ve,ze=new Map;function Fe(e){g(e.source&&!e.url||!e.source&&e.url);var i=ze.get(e.source||e.url);return i||(e.url&&(i=Ye(e.url),ze.set(e.url,i)),e.source&&(i=Pe(e.source),ze.set(e.source,i))),g(i),i}function Ye(e){if(!e.startsWith("http"))return e;var i=$e(e);return Pe(i)}function Pe(e){var i=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(i)}function $e(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function it(e,i,r){i===void 0&&(i=!0);var n=r||new Set;if(e){if(Mt(e))n.add(e);else if(Mt(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(i&&typeof e=="object")for(var t in e)it(e[t],i,n)}}return r===void 0?Array.from(n):[]}function Mt(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var jt=function(){},Ut=function(){function e(i){this.terminated=!1,this.loadableURL="";var r=i.name,n=i.source,t=i.url;g(n||t),this.name=r,this.source=n,this.url=t,this.onMessage=jt,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=jt,this.onError=jt,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(i,r){r=r||it(i),this.worker.postMessage(i,r)},e.prototype.getErrorFromErrorEvent=function(i){var r="Failed to load ";return r+="worker "+this.name+" from "+this.url+". ",i.message&&(r+=i.message+" in "),i.lineno&&(r+=":"+i.lineno+":"+i.colno),new Error(r)},e.prototype.createBrowserWorker=function(){var i=this;this.loadableURL=Fe({source:this.source,url:this.url});var r=new Worker(this.loadableURL,{name:this.name});return r.onmessage=function(n){n.data?i.onMessage(n.data):i.onError(new Error("No data received"))},r.onerror=function(n){i.onError(i.getErrorFromErrorEvent(n)),i.terminated=!0},r.onmessageerror=function(n){return console.error("worker "+i.name+", message error: "+n)},r},e}(),$t=Ut,pr=function(){return pr=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},pr.apply(this,arguments)},zr=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},Rr=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},an=function(){function e(i){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=i.source,this.url=i.url,this.setProps(i)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(i){return i.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(i){this.props=pr(pr({},this.props),i),i.name!==void 0&&(this.name=i.name),i.maxConcurrency!==void 0&&(this.maxConcurrency=i.maxConcurrency),i.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=i.maxMobileConcurrency),i.reuseWorkers!==void 0&&(this.reuseWorkers=i.reuseWorkers),i.onDebug!==void 0&&(this.onDebug=i.onDebug)},e.prototype.startJob=function(i,r,n){return r===void 0&&(r=function(t,o,u){return t.done(u)}),n===void 0&&(n=function(t,o){return t.error(o)}),zr(this,void 0,void 0,function(){var t,o=this;return Rr(this,function(u){switch(u.label){case 0:return t=new Promise(function(l){return o.jobQueue.push({name:i,onMessage:r,onError:n,onStart:l}),o}),this.startQueuedJob(),[4,t];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return zr(this,void 0,void 0,function(){var i,r,n;return Rr(this,function(t){switch(t.label){case 0:if(!this.jobQueue.length)return[2];if(i=this.getAvailableWorker(),!i)return[2];if(r=this.jobQueue.shift(),!r)return[3,4];this.onDebug({message:"Starting job",name:r.name,backlog:this.jobQueue.length,workerThread:i}),n=new xe(r.name,i),i.onMessage=function(o){return r.onMessage(n,o.type,o.payload)},i.onError=function(o){return r.onError(n,o)},r.onStart(n),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n.result];case 2:return t.sent(),[3,4];case 3:return this.returnWorkerToQueue(i),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(i){var r=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();r?(i.destroy(),this.count--):this.idleQueue.push(i),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var i=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new $t({name:i,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return le?this.maxMobileConcurrency:this.maxConcurrency},e}(),Tn=an,In=function(){return In=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},In.apply(this,arguments)},On=function(e){var i=typeof Symbol=="function"&&Symbol.iterator,r=i&&e[i],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},Mi={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},cn=function(){function e(i){this.workerPools=new Map,this.props=In({},Mi),this.setProps(i),this.workerPools=new Map}return e.isSupported=function(){return $t.isSupported()},e.getWorkerFarm=function(i){return i===void 0&&(i={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(i),e.workerFarm},e.prototype.destroy=function(){var i,r;try{for(var n=On(this.workerPools.values()),t=n.next();!t.done;t=n.next()){var o=t.value;o.destroy()}}catch(u){i={error:u}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},e.prototype.setProps=function(i){var r,n;this.props=In(In({},this.props),i);try{for(var t=On(this.workerPools.values()),o=t.next();!o.done;o=t.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=t.return)&&n.call(t)}finally{if(r)throw r.error}}},e.prototype.getWorkerPool=function(i){var r=i.name,n=i.source,t=i.url,o=this.workerPools.get(r);return o||(o=new Tn({name:r,source:n,url:t}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(r,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Qn=null,ni=new Map,ei=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(i){self.onmessage=function(r){if(!!ai(r)){var n=r.data,t=n.type,o=n.payload;i(t,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(i){var r=ni.get(i);r||(r=function(n){if(!!ai(n)){var t=n.data,o=t.type,u=t.payload;i(o,u)}}),self.addEventListener("message",r)},e.removeEventListener=function(i){var r=ni.get(i);ni.delete(i),self.removeEventListener("message",r)},e.postMessage=function(i,r){if(self){var n={source:"Worker thread",type:i,payload:r},t=it(r);self.postMessage(n,t)}},e}(),qn=null;function ai(e){var i=e.type,r=e.data;return i==="message"&&r&&typeof r.source=="string"&&r.source==="Main thread"}function Yn(e){return JSON.parse(Zn(e))}function Zn(e){var i=new Set;return JSON.stringify(e,function(r,n){if(typeof n=="object"&&n!==null){if(i.has(n))try{return JSON.parse(JSON.stringify(n))}catch(t){return}i.add(n)}return n})}function Ka(e){return""+e.name}function _a(e,i){i===void 0&&(i={});var r=i[e.id]||{},n=e.name+".worker.js",t=r.workerUrl;return i._workerType==="test"&&(t=e.module+"/dist/"+n),t||(t="https://unpkg.com/"+e.module+"/dist/"+n),assert(t),t}var _o=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},Ja=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}};function xa(e,i){return WorkerFarm.isSupported()?e.worker&&(i==null?void 0:i.worker):!1}function za(e,i,r,n){return r===void 0&&(r={}),n===void 0&&(n={}),_o(this,void 0,void 0,function(){var t,o,u,l,p,v,x,S;return Ja(this,function(A){switch(A.label){case 0:return t=getWorkerName(e),o=getWorkerURL(e,r),u=WorkerFarm.getWorkerFarm(r),l=u.getWorkerPool({name:t,url:o}),p=r.jobName||e.name,[4,l.startJob(p,Uo.bind(null,n))];case 1:return v=A.sent(),x=removeNontransferableOptions(r),v.postMessage("process",{input:i,options:x}),[4,v.result];case 2:return S=A.sent(),[2,S.result]}})})}function Uo(e,i,r,n){return _o(this,void 0,void 0,function(){var t,o,u,l,p,v,x;return Ja(this,function(S){switch(S.label){case 0:switch(t=r,t){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return i.done(n),[3,9];case 2:return i.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,l=n.options,S.label=4;case 4:return S.trys.push([4,6,,7]),e.process?[4,e.process(u,l)]:(i.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return p=S.sent(),i.postMessage("done",{id:o,result:p}),[3,7];case 6:return v=S.sent(),x=v instanceof Error?v.message:"unknown error",i.postMessage("error",{id:o,error:x}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+r),S.label=9;case 9:return[2]}})})}var Vo=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(i){return this.enqueue(i)},e.prototype.enqueue=function(i){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var r=this._settlers.shift();i instanceof Error?r.reject(i):r.resolve({value:i})}else this._values.push(i)},e.prototype.close=function(){for(;this._settlers.length>0;){var i=this._settlers.shift();i.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var i=this;if(this._values.length>0){var r=this._values.shift();return r instanceof Error?Promise.reject(r):Promise.resolve({done:!1,value:r})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,t){i._settlers.push({resolve:n,reject:t})})},e}(),el=null,Po=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},ws=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Es=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e[Symbol.asyncIterator],r;return i?i.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(u){return new Promise(function(l,p){u=e[o](u),t(l,p,u.done,u.value)})}}function t(o,u,l,p){Promise.resolve(p).then(function(v){o({value:v,done:l})},u)}},xl=0,du,vu;function bl(e,i){var r=this;if(typeof self!="undefined"){var n={process:Kl};WorkerBody.onmessage=function(t,o){return Po(r,void 0,void 0,function(){var u,l,p,v,x,S,A,k,D,R,N;return ws(this,function(W){switch(W.label){case 0:switch(W.trys.push([0,19,,20]),u=t,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return l=W.sent(),WorkerBody.postMessage("done",{result:l}),[3,18];case 3:if(!i)throw new Error("Worker does not support batched processing");du=new AsyncQueue,vu=o.options||{},p=i(du,vu,n),W.label=4;case 4:W.trys.push([4,9,10,15]),v=Es(p),W.label=5;case 5:return[4,v.next()];case 6:if(x=W.sent(),!!x.done)return[3,8];S=x.value,WorkerBody.postMessage("output-batch",{result:S}),W.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return A=W.sent(),R={error:A},[3,15];case 10:return W.trys.push([10,,13,14]),x&&!x.done&&(N=v.return)?[4,N.call(v)]:[3,12];case 11:W.sent(),W.label=12;case 12:return[3,14];case 13:if(R)throw R.error;return[7];case 14:return[7];case 15:return WorkerBody.postMessage("done",{}),[3,18];case 16:return du.push(o.input),[3,18];case 17:return du.close(),[3,18];case 18:return[3,20];case 19:return k=W.sent(),D=k instanceof Error?k.message:"",WorkerBody.postMessage("error",{error:D}),[3,20];case 20:return[2]}})})}}}function Kl(e,i){return i===void 0&&(i={}),new Promise(function(r,n){var t=xl++,o=function(l,p){if(p.id===t)switch(l){case"done":WorkerBody.removeEventListener(o),r(p.result);break;case"error":WorkerBody.removeEventListener(o),n(p.error);break;default:}};WorkerBody.addEventListener(o);var u={id:t,input:e,options:i};WorkerBody.postMessage("process",u)})}var Ws=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},tl=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},fs={};function Na(e,i,r){return i===void 0&&(i=null),r===void 0&&(r={}),Ws(this,void 0,void 0,function(){return tl(this,function(n){switch(n.label){case 0:return i&&(e=mu(e,i,r)),fs[e]=fs[e]||ru(e),[4,fs[e]];case 1:return[2,n.sent()]}})})}function mu(e,i,r){if(e.startsWith("http"))return e;var n=r.modules||{};return n[e]?n[e]:r.CDN?(assert(r.CDN.startsWith("http")),r.CDN+"/"+i+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+i+"/src/libs/"+e}function ru(e){return Ws(this,void 0,void 0,function(){var i,r,n;return tl(this,function(t){switch(t.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return i=t.sent(),[4,i.arrayBuffer()];case 2:return[2,t.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return r=t.sent(),[4,r.text()];case 5:return n=t.sent(),[2,ts(n,e)]}})})}function ts(e,i){if(isWorker)return eval.call(global,e),null;var r=document.createElement("script");r.id=i;try{r.appendChild(document.createTextNode(e))}catch(n){r.text=e}return document.body.appendChild(r),null}var Oi="0.0.3",Ao={id:"null",name:"null",module:"web-worker-helper",options:{}};function Qa(e){var i=e.color;return!i||!i.length?[1,1,1,1]:i}function As(e,i,r){return r.length===2?[r[0],r[1],0]:[r[0],r[1],r[2]]}function ku(e){var i=e.filter;return i?[1]:[0]}function $s(e,i){return[i]}var Sl=z(9187),xo=z.n(Sl),Ir=z(31437),Cs=Ir.create(),wc=Ir.create(),Va=Ir.create(),Lo=Ir.create(),Aa=Ir.create();function Gh(e,i,r,n,t){Ir.add(e,r,n),Ir.normalize(e,e),i=Ir.fromValues(-e[1],e[0]);var o=Ir.fromValues(-r[1],r[0]);return[t/Ir.dot(i,o),i]}function wl(e,i){return Ir.set(e,-i[1],i[0])}function Ec(e,i,r){return Ir.sub(e,i,r),Ir.normalize(e,e),e}function mh(e,i){return e[0]===i[0]&&e[1]===i[1]}function bd(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var Sd=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,be.Z)(this,e),(0,V.Z)(this,"lastFlip",-1),(0,V.Z)(this,"miter",Ir.fromValues(0,0)),(0,V.Z)(this,"started",!1),(0,V.Z)(this,"dash",!1),(0,V.Z)(this,"totalDistance",0),(0,V.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,J.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],k=r[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],R=l<r.length-1?[].concat((0,cr.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,N=l<n.length-1?n[l+1]:null,W=this.segment_gaode2(t,u,S,k,R,A,D,N);u+=W}if(this.dash)for(var me=0;me<t.positions.length/6;me++)t.positions[me*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],k=r[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],R=l<r.length-1?[].concat((0,cr.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,N=l<n.length-1?n[l+1]:null,W=this.simpleSegment(t,u,S,k,R,A,D,N);u+=W}if(this.dash)for(var me=0;me<t.positions.length/6;me++)t.positions[me*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,t,o,u,l,p,v){var x=0,S=r.indices,A=r.positions,k=r.normals,D=this.cap==="square",R=this.join==="bevel",N=Da([p[0],p[1]]),W=Da([l[0],l[1]]);Ec(Va,o,t);var me=0;if(this.dash&&(me=this.lineSegmentDistance(N,W),this.totalDistance+=me),this.normal||(this.normal=Ir.create(),wl(this.normal,Va)),!this.started)if(this.started=!0,D){var ye=Ir.create(),Ne=Ir.create();Ir.add(ye,this.normal,Va),Ir.add(Ne,this.normal,Va),k.push(Ne[0],Ne[1],0),k.push(ye[0],ye[1],0),A.push(t[0],t[1],t[2]|0,this.totalDistance-me,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),A.push(t[0],t[1],t[2]|0,this.totalDistance-me,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,k,t,this.normal,this.thickness,this.totalDistance-me);if(S.push(n+0,n+1,n+2),u){mh(o,u)&&Ir.add(u,o,Ir.normalize(u,Ir.subtract(u,o,t))),Ec(Lo,u,o);var Et=Gh(Aa,Ir.create(),Va,Lo,this.thickness),Vt=(0,K.Z)(Et,2),Yt=Vt[0],gr=Vt[1],hr=Ir.dot(Aa,this.normal)<0?-1:1,Hr=R;if(!Hr&&this.join==="miter"){var fn=Yt;fn>this.miterLimit&&(Hr=!0)}Hr?(k.push(this.normal[0],this.normal[1],0),k.push(gr[0],gr[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*hr,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*hr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,S.push.apply(S,(0,cr.Z)(this.lastFlip!==-hr?[n,n+2,n+3]:[n+2,n+1,n+3])),S.push(n+2,n+3,n+4),wl(Cs,Lo),Ir.copy(this.normal,Cs),k.push(this.normal[0],this.normal[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*hr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(A,k,o,gr,Yt,this.totalDistance),S.push.apply(S,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),hr=-1,Ir.copy(this.normal,gr),x+=2),this.lastFlip=hr}else{if(wl(this.normal,Va),D){var Ue=Ir.create(),tt=Ir.create();Ir.sub(tt,Va,this.normal),Ir.add(Ue,Va,this.normal),k.push(tt[0],tt[1],0),k.push(Ue[0],Ue[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,k,o,this.normal,this.thickness,this.totalDistance);S.push.apply(S,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"simpleSegment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=Da([o[0],o[1]]),A=Da([t[0],t[1]]);Ec(Va,S,A);var k=0;if(this.dash&&(k=this.lineSegmentDistance(S,A),this.totalDistance+=k),this.normal||(this.normal=Ir.create(),wl(this.normal,Va)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-k)),p.push(n+0,n+1,n+2),!u)wl(this.normal,Va),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var D=Da([u[0],u[1]]);mh(S,D)&&Ir.add(D,S,Ir.normalize(D,Ir.subtract(D,S,A))),Ec(Lo,D,S);var R=Gh(Aa,Ir.create(),Va,Lo,this.thickness),N=(0,K.Z)(R,2),W=N[0],me=N[1],ye=Ir.dot(Aa,this.normal)<0?-1:1;this.extrusions(v,x,o,me,W,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ye=-1,Ir.copy(this.normal,me),l+=2,this.lastFlip=ye}return l}},{key:"segment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=this.cap==="square",A=this.join==="bevel",k=Da([o[0],o[1]]),D=Da([t[0],t[1]]);Ec(Va,k,D);var R=0;if(this.dash&&(R=this.lineSegmentDistance(k,D),this.totalDistance+=R),this.normal||(this.normal=Ir.create(),wl(this.normal,Va)),!this.started)if(this.started=!0,S){var N=Ir.create(),W=Ir.create();Ir.add(N,this.normal,Va),Ir.add(W,this.normal,Va),x.push(W[0],W[1],0),x.push(N[0],N[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-R,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-R,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-R);if(p.push(n+0,n+1,n+2),u){var Ne=Da([u[0],u[1]]);mh(k,Ne)&&Ir.add(Ne,k,Ir.normalize(Ne,Ir.subtract(Ne,k,D))),Ec(Lo,Ne,k);var Ue=Gh(Aa,Ir.create(),Va,Lo,this.thickness),tt=(0,K.Z)(Ue,2),Et=tt[0],Vt=tt[1],Yt=Ir.dot(Aa,this.normal)<0?-1:1,gr=A;if(!gr&&this.join==="miter"){var hr=Et;hr>this.miterLimit&&(gr=!0)}gr?(x.push(this.normal[0],this.normal[1],0),x.push(Vt[0],Vt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,cr.Z)(this.lastFlip!==-Yt?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),wl(Cs,Lo),Ir.copy(this.normal,Cs),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Vt,Et,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Yt=-1,Ir.copy(this.normal,Vt),l+=2),this.lastFlip=Yt}else{if(wl(this.normal,Va),S){var me=Ir.create(),ye=Ir.create();Ir.sub(ye,Va,this.normal),Ir.add(me,Va,this.normal),x.push(ye[0],ye[1],0),x.push(me[0],me[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,t,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,l,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,l,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}(),Iu=85.0511287798;function Hh(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new Sd({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(A){t.extrude(A)})}var S=t.complex;return{vertices:S.positions,indices:S.indices,normals:S.normals,indexes:S.indexes,size:6}}function Ac(e){var i=xs(e.coordinates);return{vertices:[].concat((0,cr.Z)(i),(0,cr.Z)(i),(0,cr.Z)(i),(0,cr.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Wh(e){var i=e.coordinates,r=xo().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes,u=xo()(n,o,t);return{indices:u,vertices:n,size:t}}function Jl(e,i){var r=i;return i>Iu&&(r=Iu),i<-Iu&&(r=-Iu),[Math.PI*e/180+Math.PI,Math.PI-Math.log(Math.tan(Math.PI*.25+Math.PI*r/180*.5))]}function gh(e,i){return[(e-Math.PI)*180/Math.PI,(Math.atan(Math.exp(Math.PI-i))-Math.PI*.25)*2*180/Math.PI]}var wd=function(){var e=(0,It.Z)(he().mark(function i(r){var n,t,o,u,l,p,v,x,S;return he().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.iconMap,l={a_Color:Qa,a_Position:As,filter:ku,a_vertexId:$s,a_PickingColor:function(R){var N=R.id;return o?Ea(N):[0,0,0]},a_DistanceAndIndex:function(R,N,W,me,ye,Ne){return Ne===void 0?[W[3],10]:[W[3],Ne]},a_Total_Distance:function(R,N,W){return[W[5]]},a_Size:function(R){var N=R.size,W=N===void 0?1:N;return Array.isArray(W)?[W[0],W[1]]:[W,0]},a_Normal:function(R,N,W,me,ye){return ye},a_Miter:function(R,N,W){return[W[4]]},a_iconMapUV:function(R){var N=R.texture,W=u[N]||{x:0,y:0},me=W.x,ye=W.y;return[me,ye]}},p={sizePerElement:0,elements:[]},v=0,x=[],S=3,t.forEach(function(D,R){var N=Hh(D),W=N.indices,me=N.vertices,ye=N.normals,Ne=N.size,Ue=N.indexes;W.forEach(function(Yt){x.push(Yt+v)}),S=Ne;var tt=me.length/Ne;p.sizePerElement=S,p.elements.push({featureIdx:R,vertices:me,normals:ye,offset:v}),v+=tt;for(var Et=function(gr){var hr=(ye==null?void 0:ye.slice(gr*3,gr*3+3))||[],Hr=me.slice(gr*Ne,gr*Ne+Ne),fn=0;Ue&&Ue[gr]!==void 0&&(fn=Ue[gr]),n.forEach(function(Rn){if(Rn&&l[Rn.name]){var Zi;(Zi=Rn.buffer.data).push.apply(Zi,(0,cr.Z)(l[Rn.name](D,R,Hr,gr,hr,fn)))}})},Vt=0;Vt<tt;Vt++)Et(Vt)}),k.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return k.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),Ed=function(){var e=(0,It.Z)(he().mark(function i(r){var n,t,o,u,l,p,v,x,S;return he().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.shape2d,l={a_Color:Qa,a_Position:As,filter:ku,a_vertexId:$s,a_PickingColor:function(R){var N=R.id;return o?Ea(N):[0,0,0]},a_Shape:function(R){var N=R.shape,W=N===void 0?2:N,me=u.indexOf(W);return[me]},a_Extrude:function(R,N,W,me){var ye=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Ne=me%4*3;return[ye[Ne],ye[Ne+1],ye[Ne+2]]},a_Size:function(R){var N=R.size,W=N===void 0?5:N;return Array.isArray(W)?[W[0]]:[W]}},p={sizePerElement:0,elements:[]},v=0,x=[],S=3,t.forEach(function(D,R){var N=Ac(D),W=N.indices,me=N.vertices,ye=N.normals,Ne=N.size,Ue=N.indexes;W.forEach(function(Yt){x.push(Yt+v)}),S=Ne;var tt=me.length/Ne;p.sizePerElement=S,p.elements.push({featureIdx:R,vertices:me,normals:ye,offset:v}),v+=tt;for(var Et=function(gr){var hr=(ye==null?void 0:ye.slice(gr*3,gr*3+3))||[],Hr=me.slice(gr*Ne,gr*Ne+Ne),fn=0;Ue&&Ue[gr]!==void 0&&(fn=Ue[gr]),n.forEach(function(Rn){if(Rn&&l[Rn.name]){var Zi;(Zi=Rn.buffer.data).push.apply(Zi,(0,cr.Z)(l[Rn.name](D,R,Hr,gr,hr,fn)))}})},Vt=0;Vt<tt;Vt++)Et(Vt)}),k.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return k.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),Ad=function(){var e=(0,It.Z)(he().mark(function i(r){var n,t,o,u,l,p,v,x;return he().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u={a_Color:Qa,a_Position:As,filter:ku,a_vertexId:$s,a_PickingColor:function(D){var R=D.id;return o?Ea(R):[0,0,0]}},l={sizePerElement:0,elements:[]},p=0,v=[],x=3,t.forEach(function(k,D){var R=Wh(k),N=R.indices,W=R.vertices,me=R.normals,ye=R.size,Ne=R.indexes;N.forEach(function(Vt){v.push(Vt+p)}),x=ye;var Ue=W.length/ye;l.sizePerElement=x,l.elements.push({featureIdx:D,vertices:W,normals:me,offset:p}),p+=Ue;for(var tt=function(Yt){var gr=(me==null?void 0:me.slice(Yt*3,Yt*3+3))||[],hr=W.slice(Yt*ye,Yt*ye+ye),Hr=0;Ne&&Ne[Yt]!==void 0&&(Hr=Ne[Yt]),n.forEach(function(fn){if(fn&&u[fn.name]){var Rn;(Rn=fn.buffer.data).push.apply(Rn,(0,cr.Z)(u[fn.name](k,D,hr,Yt,gr,Hr)))}})},Et=0;Et<Ue;Et++)tt(Et)}),A.abrupt("return",{descriptors:n,featureLayout:l,indices:v});case 8:case"end":return A.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),Cd={pointFill:Ed,line:wd,polygonFill:Ad},Mp=(0,O.Z)({},Cd);function Nv(e){return $h.apply(this,arguments)}function $h(){return $h=_asyncToGenerator(_regeneratorRuntime.mark(function e(i){var r,n;return _regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=i.workerType,n=i.data,!Mp[r]){o.next=3;break}return o.abrupt("return",Mp[r](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(r,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),$h.apply(this,arguments)}var yh=new Map;function Zv(e,i){yh.set(e,i)}function Cc(e){var i=yh.get(e);return i}var Ql="l7-worker",Ca=3,Tc=!0;function Xh(e){registerWorkerSource(Ql,e)}function Mc(){var e=getWorkerSource(Ql);if(!e)throw new Error("get worker failed by workerName: ".concat(Ql,"."));return e}function rf(e,i){return rl.apply(this,arguments)}function rl(){return rl=_asyncToGenerator(_regeneratorRuntime.mark(function e(i,r){var n,t,o,u,l;return _regeneratorRuntime.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=Mc(),t=WorkerFarm.getWorkerFarm({maxConcurrency:Ca,reuseWorkers:Tc}),o=t.getWorkerPool({name:Ql,source:n}),v.next=5,o.startJob(Ql,function(x,S,A){return x.done(A)});case 5:return u=v.sent,u.postMessage("process",{input:{workerType:i,data:r}}),v.next=9,u.result;case 9:return l=v.sent,v.abrupt("return",l.result);case 11:case"end":return v.stop()}},e)})),rl.apply(this,arguments)}var _h=z(38163),Lf=z.n(_h);function ec(e,i){return e.map(function(r){return r[i]*1})}function nf(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function af(e){return Array.isArray(e)?e.length===0?!1:!!nf(e[0]):!1}function of(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function Pu(e){var i=Object.isFrozen(e)?ii.cloneDeep(e):e;return Lf()(i,!0),i}function sf(e,i){var r=i.x,n=i.y,t=i.x1,o=i.y1,u=i.coordinates,l=i.geometry,p=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(W){return W[l]&&W[l].type&&W[l].coordinates&&W[l].coordinates.length>0}).forEach(function(W,me){var ye=Pu(W[l]);G(ye,function(Ne){var Ue=Ve(Ne),tt=(0,O.Z)((0,O.Z)({},W),{},{_id:me,coordinates:Ue});p.push(tt)})}),{dataArray:p};for(var v=0;v<e.length;v++){var x=e[v],S=[];if(u){var A="Polygon";Array.isArray(u[0])||(A="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(A="LineString");var k=Pu({type:A,coordinates:x[u]});S=k.coordinates}else if(r&&n&&t&&o){var D=[parseFloat(x[r]),parseFloat(x[n])],R=[parseFloat(x[t]),parseFloat(x[o])];S=[D,R]}else r&&n&&(S=[parseFloat(x[r]),parseFloat(x[n])]);var N=(0,O.Z)((0,O.Z)({},x),{},{_id:v,coordinates:S});p.push(N)}return{dataArray:p}}function kc(e,i){var r=at(e);return sf(r,i)}var Rf=z(90484);function Ic(e){for(var i=e.toString(),r=5381,n=i.length;n;)r=r*33^i.charCodeAt(--n);return r>>>0}function El(e,i){return i===void 0?null:(0,Rf.Z)(e.properties[i])*1==="number"?e.properties[i]*1:e.properties&&e.properties[i]?Ic(e.properties[i]+"")%1000019:null}function gu(e,i){var r=[],n={};return e.features?(e.features=e.features.filter(function(t){var o=t.geometry;return t!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),e=Pu(e),e.features.length===0?{dataArray:[],featureKeys:n}:(G(e,function(t,o){var u=El(t,i==null?void 0:i.featureId);u===null&&(u=o);var l=u,p=Ve(t),v=(0,O.Z)((0,O.Z)({},t.properties),{},{coordinates:p,_id:l});r.push(v)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function Df(e,i,r,n){for(var t=n,o=r-i>>1,u=r-i,l,p=e[i],v=e[i+1],x=e[r],S=e[r+1],A=i+3;A<r;A+=3){var k=Td(e[A],e[A+1],p,v,x,S);if(k>t)l=A,t=k;else if(k===t){var D=Math.abs(A-o);D<u&&(l=A,u=D)}}t>n&&(l-i>3&&Df(e,i,l,n),e[l+2]=t,r-l>3&&Df(e,l,r,n))}function Td(e,i,r,n,t,o){var u=t-r,l=o-n;if(u!==0||l!==0){var p=((e-r)*u+(i-n)*l)/(u*u+l*l);p>1?(r=t,n=o):p>0&&(r+=u*p,n+=l*p)}return u=e-r,l=i-n,u*u+l*l}function Of(e,i,r,n){var t={id:typeof e=="undefined"?null:e,type:i,geometry:r,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return Md(t),t}function Md(e){var i=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")Lu(e,i);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<i.length;n++)Lu(e,i[n]);else if(r==="MultiPolygon")for(n=0;n<i.length;n++)for(var t=0;t<i[n].length;t++)Lu(e,i[n][t])}function Lu(e,i){for(var r=0;r<i.length;r+=3)e.minX=Math.min(e.minX,i[r]),e.minY=Math.min(e.minY,i[r+1]),e.maxX=Math.max(e.maxX,i[r]),e.maxY=Math.max(e.maxY,i[r+1])}function Pc(e,i){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Ff(r,e.features[n],i,n);else e.type==="Feature"?Ff(r,e,i):Ff(r,{geometry:e},i);return r}function Ff(e,i,r,n){if(!!i.geometry){var t=i.geometry.coordinates,o=i.geometry.type,u=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),l=[],p=i.id;if(r.promoteId?p=i.properties[r.promoteId]:r.generateId&&(p=n||0),o==="Point")Yh(t,l);else if(o==="MultiPoint")for(var v=0;v<t.length;v++)Yh(t[v],l);else if(o==="LineString")xh(t,l,u,!1);else if(o==="MultiLineString")if(r.lineMetrics){for(v=0;v<t.length;v++)l=[],xh(t[v],l,u,!1),e.push(Of(p,"LineString",l,i.properties));return}else Bf(t,l,u,!1);else if(o==="Polygon")Bf(t,l,u,!0);else if(o==="MultiPolygon")for(v=0;v<t.length;v++){var x=[];Bf(t[v],x,u,!0),l.push(x)}else if(o==="GeometryCollection"){for(v=0;v<i.geometry.geometries.length;v++)Ff(e,{id:p,geometry:i.geometry.geometries[v],properties:i.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Of(p,o,l,i.properties))}}function Yh(e,i){i.push(kp(e[0])),i.push(Ru(e[1])),i.push(0)}function xh(e,i,r,n){for(var t,o,u=0,l=0;l<e.length;l++){var p=kp(e[l][0]),v=Ru(e[l][1]);i.push(p),i.push(v),i.push(0),l>0&&(n?u+=(t*v-p*o)/2:u+=Math.sqrt(Math.pow(p-t,2)+Math.pow(v-o,2))),t=p,o=v}var x=i.length-3;i[2]=1,Df(i,0,x,r),i[x+2]=1,i.size=Math.abs(u),i.start=0,i.end=i.size}function Bf(e,i,r,n){for(var t=0;t<e.length;t++){var o=[];xh(e[t],o,r,n),i.push(o)}}function kp(e){return e/360+.5}function Ru(e){var i=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return r<0?0:r>1?1:r}function Ts(e,i,r,n,t,o,u,l){if(r/=i,n/=i,o>=r&&u<n)return e;if(u<r||o>=n)return null;for(var p=[],v=0;v<e.length;v++){var x=e[v],S=x.geometry,A=x.type,k=t===0?x.minX:x.minY,D=t===0?x.maxX:x.maxY;if(k>=r&&D<n){p.push(x);continue}else if(D<r||k>=n)continue;var R=[];if(A==="Point"||A==="MultiPoint")uf(S,R,r,n,t);else if(A==="LineString")Du(S,R,r,n,t,!1,l.lineMetrics);else if(A==="MultiLineString")Ms(S,R,r,n,t,!1);else if(A==="Polygon")Ms(S,R,r,n,t,!0);else if(A==="MultiPolygon")for(var N=0;N<S.length;N++){var W=[];Ms(S[N],W,r,n,t,!0),W.length&&R.push(W)}if(R.length){if(l.lineMetrics&&A==="LineString"){for(N=0;N<R.length;N++)p.push(Of(x.id,A,R[N],x.tags));continue}(A==="LineString"||A==="MultiLineString")&&(R.length===1?(A="LineString",R=R[0]):A="MultiLineString"),(A==="Point"||A==="MultiPoint")&&(A=R.length===3?"Point":"MultiPoint"),p.push(Of(x.id,A,R,x.tags))}}return p.length?p:null}function uf(e,i,r,n,t){for(var o=0;o<e.length;o+=3){var u=e[o+t];u>=r&&u<=n&&(i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]))}}function Du(e,i,r,n,t,o,u){for(var l=Lc(e),p=t===0?Ip:ks,v=e.start,x,S,A=0;A<e.length-3;A+=3){var k=e[A],D=e[A+1],R=e[A+2],N=e[A+3],W=e[A+4],me=t===0?k:D,ye=t===0?N:W,Ne=!1;u&&(x=Math.sqrt(Math.pow(k-N,2)+Math.pow(D-W,2))),me<r?ye>r&&(S=p(l,k,D,N,W,r),u&&(l.start=v+x*S)):me>n?ye<n&&(S=p(l,k,D,N,W,n),u&&(l.start=v+x*S)):lf(l,k,D,R),ye<r&&me>=r&&(S=p(l,k,D,N,W,r),Ne=!0),ye>n&&me<=n&&(S=p(l,k,D,N,W,n),Ne=!0),!o&&Ne&&(u&&(l.end=v+x*S),i.push(l),l=Lc(e)),u&&(v+=x)}var Ue=e.length-3;k=e[Ue],D=e[Ue+1],R=e[Ue+2],me=t===0?k:D,me>=r&&me<=n&&lf(l,k,D,R),Ue=l.length-3,o&&Ue>=3&&(l[Ue]!==l[0]||l[Ue+1]!==l[1])&&lf(l,l[0],l[1],l[2]),l.length&&i.push(l)}function Lc(e){var i=[];return i.size=e.size,i.start=e.start,i.end=e.end,i}function Ms(e,i,r,n,t,o){for(var u=0;u<e.length;u++)Du(e[u],i,r,n,t,o,!1)}function lf(e,i,r,n){e.push(i),e.push(r),e.push(n)}function Ip(e,i,r,n,t,o){var u=(o-i)/(n-i);return e.push(o),e.push(r+(t-r)*u),e.push(1),u}function ks(e,i,r,n,t,o){var u=(o-r)/(t-r);return e.push(i+(n-i)*u),e.push(o),e.push(1),u}function yu(e,i){var r=i.buffer/i.extent,n=e,t=Ts(e,1,-1-r,r,0,-1,2,i),o=Ts(e,1,1-r,2+r,0,-1,2,i);return(t||o)&&(n=Ts(e,1,-r,1+r,0,-1,2,i)||[],t&&(n=ja(t,1).concat(n)),o&&(n=n.concat(ja(o,-1)))),n}function ja(e,i){for(var r=[],n=0;n<e.length;n++){var t=e[n],o=t.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=hs(t.geometry,i);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var l=0;l<t.geometry.length;l++)u.push(hs(t.geometry[l],i))}else if(o==="MultiPolygon")for(u=[],l=0;l<t.geometry.length;l++){for(var p=[],v=0;v<t.geometry[l].length;v++)p.push(hs(t.geometry[l][v],i));u.push(p)}r.push(Of(t.id,o,u,t.tags))}return r}function hs(e,i){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+i,e[n+1],e[n+2]);return r}function qh(e,i){if(e.transformed)return e;var r=1<<e.z,n=e.x,t=e.y,o,u,l;for(o=0;o<e.features.length;o++){var p=e.features[o],v=p.geometry,x=p.type;if(p.geometry=[],x===1)for(u=0;u<v.length;u+=2)p.geometry.push(Pp(v[u],v[u+1],i,r,n,t));else for(u=0;u<v.length;u++){var S=[];for(l=0;l<v[u].length;l+=2)S.push(Pp(v[u][l],v[u][l+1],i,r,n,t));p.geometry.push(S)}}return e.transformed=!0,e}function Pp(e,i,r,n,t,o){return[Math.round(r*(e*n-t)),Math.round(r*(i*n-o))]}function kd(e,i,r,n,t){for(var o=i===t.maxZoom?0:t.tolerance/((1<<i)*t.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:i,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){u.numFeatures++,Lp(u,e[l],o,t);var p=e[l].minX,v=e[l].minY,x=e[l].maxX,S=e[l].maxY;p<u.minX&&(u.minX=p),v<u.minY&&(u.minY=v),x>u.maxX&&(u.maxX=x),S>u.maxY&&(u.maxY=S)}return u}function Lp(e,i,r,n){var t=i.geometry,o=i.type,u=[];if(o==="Point"||o==="MultiPoint")for(var l=0;l<t.length;l+=3)u.push(t[l]),u.push(t[l+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")Ro(u,t,e,r,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(l=0;l<t.length;l++)Ro(u,t[l],e,r,o==="Polygon",l===0);else if(o==="MultiPolygon")for(var p=0;p<t.length;p++){var v=t[p];for(l=0;l<v.length;l++)Ro(u,v[l],e,r,!0,l===0)}if(u.length){var x=i.tags||null;if(o==="LineString"&&n.lineMetrics){x={};for(var S in i.tags)x[S]=i.tags[S];x.mapbox_clip_start=t.start/t.size,x.mapbox_clip_end=t.end/t.size}var A={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:x};i.id!==null&&(A.id=i.id),e.features.push(A)}}function Ro(e,i,r,n,t,o){var u=n*n;if(n>0&&i.size<(t?u:n)){r.numPoints+=i.length/3;return}for(var l=[],p=0;p<i.length;p+=3)(n===0||i[p+2]>u)&&(r.numSimplified++,l.push(i[p]),l.push(i[p+1])),r.numPoints++;t&&Rp(l,o),e.push(l)}function Rp(e,i){for(var r=0,n=0,t=e.length,o=t-2;n<t;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===i)for(n=0,t=e.length;n<t/2;n+=2){var u=e[n],l=e[n+1];e[n]=e[t-2-n],e[n+1]=e[t-1-n],e[t-2-n]=u,e[t-1-n]=l}}function Dp(e,i){return new zf(e,i)}function zf(e,i){i=this.options=Op(Object.create(this.options),i);var r=i.debug;if(r&&console.time("preprocess data"),i.maxZoom<0||i.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(i.promoteId&&i.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Pc(e,i);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",i.indexMaxZoom,i.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=yu(n,i),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}zf.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},zf.prototype.splitTile=function(e,i,r,n,t,o,u){for(var l=[e,i,r,n],p=this.options,v=p.debug;l.length;){n=l.pop(),r=l.pop(),i=l.pop(),e=l.pop();var x=1<<i,S=Kh(i,r,n),A=this.tiles[S];if(!A&&(v>1&&console.time("creation"),A=this.tiles[S]=kd(e,i,r,n,p),this.tileCoords.push({z:i,x:r,y:n}),v)){v>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",i,r,n,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var k="z"+i;this.stats[k]=(this.stats[k]||0)+1,this.total++}if(A.source=e,t){if(i===p.maxZoom||i===t)continue;var D=1<<t-i;if(r!==Math.floor(o/D)||n!==Math.floor(u/D))continue}else if(i===p.indexMaxZoom||A.numPoints<=p.indexMaxPoints)continue;if(A.source=null,e.length!==0){v>1&&console.time("clipping");var R=.5*p.buffer/p.extent,N=.5-R,W=.5+R,me=1+R,ye,Ne,Ue,tt,Et,Vt;ye=Ne=Ue=tt=null,Et=Ts(e,x,r-R,r+W,0,A.minX,A.maxX,p),Vt=Ts(e,x,r+N,r+me,0,A.minX,A.maxX,p),e=null,Et&&(ye=Ts(Et,x,n-R,n+W,1,A.minY,A.maxY,p),Ne=Ts(Et,x,n+N,n+me,1,A.minY,A.maxY,p),Et=null),Vt&&(Ue=Ts(Vt,x,n-R,n+W,1,A.minY,A.maxY,p),tt=Ts(Vt,x,n+N,n+me,1,A.minY,A.maxY,p),Vt=null),v>1&&console.timeEnd("clipping"),l.push(ye||[],i+1,r*2,n*2),l.push(Ne||[],i+1,r*2,n*2+1),l.push(Ue||[],i+1,r*2+1,n*2),l.push(tt||[],i+1,r*2+1,n*2+1)}}},zf.prototype.getTile=function(e,i,r){var n=this.options,t=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;i=(i%u+u)%u;var l=Kh(e,i,r);if(this.tiles[l])return qh(this.tiles[l],t);o>1&&console.log("drilling down to z%d-%d-%d",e,i,r);for(var p=e,v=i,x=r,S;!S&&p>0;)p--,v=Math.floor(v/2),x=Math.floor(x/2),S=this.tiles[Kh(p,v,x)];return!S||!S.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",p,v,x),o>1&&console.time("drilling down"),this.splitTile(S.source,p,v,x,e,i,r),o>1&&console.timeEnd("drilling down"),this.tiles[l]?qh(this.tiles[l],t):null)};function Kh(e,i,r){return((1<<e)*r+i)*32+e}function Op(e,i){for(var r in i)e[r]=i[r];return e}var Nf=function(){function e(i,r,n,t){(0,be.Z)(this,e),(0,V.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=i}return(0,J.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Fp={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Bp(e){for(var i=0,r=0,n=e.length,t=n-1,o,u;r<n;t=r++)o=e[r],u=e[t],i+=(u.x-o.x)*(o.y+u.y);return i}function Jh(e){var i=e.length;if(i<=1)return[e];for(var r=[],n,t,o=0;o<i;o++){var u=Bp(e[o]);u!==0&&(t===void 0&&(t=u<0),t===u<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}var Id=["Unknown","Point","LineString","Polygon"];function Pd(e,i,r,n,t){var o=t.geometry,u=t.type,l=t.tags,p=t.id,v=e*Math.pow(2,n),x=e*i,S=e*r,A=Id[u],k,D;function R(me){for(var ye=0;ye<me.length;ye++){var Ne=me[ye];if(Ne[3])break;var Ue=180-(Ne[1]+S)*360/v,tt=(Ne[0]+x)*360/v-180,Et=360/Math.PI*Math.atan(Math.exp(Ue*Math.PI/180))-90;me[ye]=[tt,Et,0,1]}}switch(u){case 1:var N=[];for(k=0;k<o.length;k++)N[k]=o[k][0];o=N,R(o);break;case 2:for(k=0;k<o.length;k++)R(o[k]);break;case 3:for(o=Jh(o),k=0;k<o.length;k++)for(D=0;D<o[k].length;D++)R(o[k][D]);break}o.length===1?o=o[0]:A="Multi"+A;var W={type:"Feature",geometry:{type:A,coordinates:o},properties:l,id:p,tileOrigin:[0,0],coord:""};return W}var cf=function(){var e=(0,It.Z)(he().mark(function i(r,n,t,o){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p){var v=n.getTile(r.z,r.x,r.y),x=v?v.features.map(function(k){return Pd(o,t.x,t.y,t.z,k)}):[],S={layers:{defaultLayer:{features:x}}},A=new Nf(S,r.x,r.y,r.z);p(A)}));case 1:case"end":return l.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function zp(e){var i={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?i:(0,O.Z)((0,O.Z)({},i),e.geojsonvtOptions)}function B(e,i){var r=zp(i),n=r.extent||4096,t=Dp(e,r),o=function(p,v){return cf(v,t,p,n)},u=(0,O.Z)((0,O.Z)((0,O.Z)({},Fp),i),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}function Se(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,t=new Promise(function(u){e instanceof HTMLImageElement||hc(e)?u([e]):Ie(e,function(l){u(l)})}),o={originData:e,images:t,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function Ie(e,i){var r=e,n=[];if(typeof r=="string")ms({url:r},function(u,l){l&&(n.push(l),i(n))});else{var t=r.length,o=0;r.forEach(function(u){ms({url:u},function(l,p){o++,p&&n.push(p),o===t&&i(n)})})}return Se}var Nt=function(){var e=(0,It.Z)(he().mark(function i(r,n,t,o){var u,l;return he().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u={x:n.x,y:n.y,z:n.z},l=d(r,u),v.abrupt("return",new Promise(function(x){o?o(u,function(S,A){if(S||!A){var k={layers:{defaultLayer:{features:[]}}},D=new Nf(k,n.x,n.y,n.z);x(D)}else{var R={layers:{defaultLayer:{features:A.features}}},N=new Nf(R,n.x,n.y,n.z);x(N)}}):aa((0,O.Z)((0,O.Z)({},t),{},{url:l}),function(S,A){if(S||!A){var k={layers:{defaultLayer:{features:[]}}},D=new Nf(k,n.x,n.y,n.z);x(D)}else{var R=JSON.parse(A),N={layers:{defaultLayer:{features:R}}},W=new Nf(N,n.x,n.y,n.z);x(W)}})}));case 3:case"end":return v.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function or(e,i){var r=function(o,u){return Nt(e,u,i==null?void 0:i.requestParameters,i.getCustomData)},n=(0,O.Z)((0,O.Z)({},i),{},{getTileData:r});return{dataArray:[],tilesetOptions:n,isTile:!0}}var Dt=z(38929),Xt=z(3614),Cr=z.n(Xt),Mr=function(){function e(i,r,n,t){(0,be.Z)(this,e),(0,V.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=new Dt.VectorTile(new(Cr())(i))}return(0,J.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];if(Array.isArray(n.features))return this.vectorLayerCache[r]=n.features,n.features;for(var t=[],o=0;o<n.length;o++){var u=n.feature(o),l=u.toGeoJSON(this.x,this.y,this.z);t.push((0,O.Z)((0,O.Z)({},l),{},{properties:(0,O.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[r]=t,t}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Or={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},Pr=function(){var e=(0,It.Z)(he().mark(function i(r,n,t,o,u){var l;return he().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=d(r,n),v.abrupt("return",new Promise(function(x){if(u)u({x:t.x,y:t.y,z:t.z},function(A,k){if(A||!k)x(void 0);else{var D=new Mr(k,t.x,t.y,t.z);x(D)}});else{var S=ao((0,O.Z)((0,O.Z)({},o),{},{url:l}),function(A,k){if(A||!k)x(void 0);else{var D=new Mr(k,t.x,t.y,t.z);x(D)}});t.xhrCancel=function(){return S.cancel()}}}));case 2:case"end":return v.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function Nr(e,i){var r=Array.isArray(e)?e[0]:e,n=function(u,l){return Pr(r,u,l,i==null?void 0:i.requestParameters,i==null?void 0:i.getCustomData)},t=(0,O.Z)((0,O.Z)((0,O.Z)({},Or),i),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:t,isTile:!0}}function $r(e,i,r){switch(e){case"+":return i+r;case"-":return i-r;case"*":return i*r;case"/":return i/r;case"%":return i%r;case"^":return Math.pow(i,r);case"abs":return Math.abs(i);case"floor":return Math.floor(i);case"round":return Math.round(i);case"ceil":return Math.ceil(i);case"sin":return Math.sin(i);case"cos":return Math.cos(i);case"atan":return r===-1?Math.atan(i):Math.atan2(i,r);case"min":return Math.min(i,r);case"max":return Math.max(i,r);case"log10":return Math.log(i);case"log2":return Math.log2(i);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Sr(e,i){for(var r=i[0],n=r.width,t=r.height,o=i.map(function(k){return k.rasterData}),u=n*t,l=[],p=JSON.stringify(e),v=0;v<u;v++){var x=JSON.parse(p),S=Zr(x,o,v);if(typeof S=="number")l.push(S);else{var A=Gt(x);l.push(A)}}return l}function Zr(e,i,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return i[e[1]][r]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,t){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[t]=i[n[1]][r]}catch(o){console.warn("Raster Data err!"),e[t]=0}break;default:Zr(n,i,r)}})}function wt(e){var i=(0,K.Z)(e,3),r=i[0],n=i[1],t=n===void 0?-1:n,o=i[2],u=o===void 0?-1:o;if(r===void 0)return console.warn("Express err!"),["+",0,0];var l=r.replace(/\s+/g,"");return[l,t,u]}function Gt(e){var i=wt(e),r=i[0],n=i[1],t=i[2];return Array.isArray(n)&&(n=Gt(e[1])),Array.isArray(t)&&(t=Gt(e[2])),$r(r,n,t)}var Tr={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:Jr}};function Jr(e,i){for(var r=e[0].rasterData,n=e[1].rasterData,t=e[2].rasterData,o=[],u=(i==null?void 0:i.countCut)||[2,98],l=(0,K.Z)(u,2),p=l[0],v=l[1],x=(i==null?void 0:i.RMinMax)||dr(r,p,v),S=(i==null?void 0:i.GMinMax)||dr(n,p,v),A=(i==null?void 0:i.BMinMax)||dr(t,p,v),k=0;k<r.length;k++)o.push(Math.max(0,r[k]-x[0])),o.push(Math.max(0,n[k]-S[0])),o.push(Math.max(0,t[k]-A[0]));return{rasterData:o,rMinMax:x,gMinMax:S,bMinMax:A}}function dr(e,i,r){var n=e.slice().sort(function(l,p){return l-p}),t=n.length,o=n[Math.ceil(t*i/100)],u=n[Math.ceil(t*r/100)];return[o,u]}function rn(e,i,r){return _r.apply(this,arguments)}function _r(){return _r=(0,It.Z)(he().mark(function e(i,r,n){var t,o,u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(i.length!==0){S.next=2;break}return S.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return S.next=4,Promise.all(i.map(function(A){var k=A.data,D=A.bands,R=D===void 0?[0]:D;return r(k,R)}));case 4:t=S.sent,o=[],t.forEach(function(A){Array.isArray(A)?o.push.apply(o,(0,cr.Z)(A)):o.push(A)}),u=o[0],l=u.width,p=u.height,S.t0=(0,Rf.Z)(n),S.next=S.t0==="function"?11:S.t0==="object"?13:15;break;case 11:return v=n(o),S.abrupt("break",16);case 13:return Array.isArray(n)?v={rasterData:Sr(n,o)}:v=Ur(n,o),S.abrupt("break",16);case 15:v={rasterData:o[0].rasterData};case 16:return S.abrupt("return",(0,O.Z)((0,O.Z)({},v),{},{width:l,height:p}));case 17:case"end":return S.stop()}},e)})),_r.apply(this,arguments)}function Ur(e,i){var r=Tr[e.type];if(r.type==="function")return r.method(i,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?vr(r.expression,i):{rasterData:Sr(r.expression,i)}}function vr(e,i){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var r=Sr(e.r||["band",0],i),n=Sr(e.g||["band",0],i),t=Sr(e.b||["band",0],i);return[r,n,t]}function Br(e,i,r,n){return Pn.apply(this,arguments)}function Pn(){return Pn=(0,It.Z)(he().mark(function e(i,r,n,t){var o;return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,rn(i,r,n);case 2:o=l.sent,t(null,{data:o});case 4:case"end":return l.stop()}},e)})),Pn.apply(this,arguments)}function zn(e,i){var r=i.extent,n=i.width,t=i.height,o=i.min,u=i.max,l=i.format,p=i.operation,v,x,S;if(l===void 0||of(e))v=Array.from(e),x=n,S=t;else{var A=Array.isArray(e)?e:[e];v=rn(A,l,p)}var k={_id:1,dataArray:[{_id:1,data:v,width:x,height:S,min:o,max:u,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return k}var jr=z(28660),ut=z(86700),fr=z(84879),et={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Un=z(49296),bn=z.n(Un);function mi(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=oi(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function oi(e,i){if(!!e){if(typeof e=="string")return di(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return di(e,i)}}function di(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ci=30;function Ga(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,t=e.buffer,o=e.maxCanvasWidth,u=e.mapping,l=u===void 0?{}:u,p=e.xOffset,v=p===void 0?0:p,x=e.yOffset,S=x===void 0?0:x,A=0,k=v;Array.from(i).forEach(function(R,N){if(!l[R]){var W=r(R,N);k+Ci>o&&(k=0,A++),l[R]={x:k,y:S+A*Ci,width:Ci,height:Ci,advance:W},k+=Ci}});var D=n+t*2;return{mapping:l,xOffset:k,yOffset:S+A*D,canvasHeight:ba(S+(A+1)*D)}}function Co(e,i,r){var n=0,t=0,o=0,u=[],l={},p=mi(e),v;try{for(p.s();!(v=p.n()).done;){var x=v.value;if(!l[x.id]){var S=x.size;n+S+i>r&&(wi(l,u,t),n=0,t=o+t+i,o=0,u=[]),u.push({icon:x,xOffset:n}),n=n+S+i,o=Math.max(o,S)}}}catch(k){p.e(k)}finally{p.f()}u.length>0&&wi(l,u,t);var A=ba(o+t+i);return{mapping:l,canvasHeight:A}}function wi(e,i,r){var n=mi(i),t;try{for(n.s();!(t=n.n()).done;){var o=t.value,u=o.icon,l=o.xOffset;e[u.id]=(0,O.Z)((0,O.Z)({},u),{},{x:l,y:r,image:u.image,width:u.width,height:u.height})}}catch(p){n.e(p)}finally{n.f()}}function ba(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var na,Ha;function eo(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=bo(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function bo(e,i){if(!!e){if(typeof e=="string")return So(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return So(e,i)}}function So(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Do(e){var i=Wa();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function Wa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pi=dn(),jo="sans-serif",ji="normal",Vn=24,Ei=3,ki=.25,$a=8,Xs=1024,nl=1,Re=1,Bt=3,Ot=null;function dn(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function yi(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Ce(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var de=(na=(0,ut.b2)(),na(Ha=function(e){(0,lt.Z)(r,e);var i=Do(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"fontAtlas",void 0),(0,V.Z)((0,Ee.Z)(n),"iconFontMap",void 0),(0,V.Z)((0,Ee.Z)(n),"iconFontGlyphs",{}),(0,V.Z)((0,Ee.Z)(n),"fontOptions",void 0),(0,V.Z)((0,Ee.Z)(n),"key",void 0),(0,V.Z)((0,Ee.Z)(n),"cache",new qc(Bt)),n}return(0,J.Z)(r,[{key:"scale",get:function(){return Re}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping||{}}},{key:"getCanvasByKey",value:function(t){var o=this.cache.get(t);return o&&o.data}},{key:"getMappingByKey",value:function(t){var o=this.cache.get(t);return o&&o.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:jo,fontWeight:ji,characterSet:pi,fontSize:Vn,buffer:Ei,sdf:!0,cutoff:ki,radius:$a,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var o=this;t.forEach(function(u){o.iconFontGlyphs[u.name]=u.unicode})}},{key:"addIconFont",value:function(t,o){this.iconFontMap.set(t,o)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,O.Z)((0,O.Z)({},this.fontOptions),t),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),u=this.cache.get(this.key);if(!(u&&o.length===0)){var l=this.generateFontAtlas(this.key,o,u);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(t,o){var u=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(t,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then(function(){u.emit("fontloaded",{fontFamily:t})})}catch(p){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,o,u){var l=this.fontOptions,p=l.fontFamily,v=l.fontWeight,x=l.fontSize,S=l.buffer,A=l.sdf,k=l.radius,D=l.cutoff,R=l.iconfont,N=u&&u.data;N||(N=window.document.createElement("canvas"),N.width=Xs);var W=N.getContext("2d",{willReadFrequently:!0});yi(W,p,x,v);var me=Ga((0,O.Z)({getFontWidth:function(Wo){return W.measureText(Wo).width},fontHeight:x*Re,buffer:S,characterSet:o,maxCanvasWidth:Xs},u&&{mapping:u.mapping,xOffset:u.xOffset,yOffset:u.yOffset})),ye=me.mapping,Ne=me.canvasHeight,Ue=me.xOffset,tt=me.yOffset,Et=W.getImageData(0,0,N.width,N.height);if(N.height=Ne,W.putImageData(Et,0,0),yi(W,p,x,v),A){var Vt=new(bn())(x,S,k,D,p,v),Yt=W.getImageData(0,0,Vt.size,Vt.size),gr=eo(o),hr;try{for(gr.s();!(hr=gr.n()).done;){var Hr=hr.value;if(R){var fn=String.fromCharCode(parseInt(Hr.replace("&#x","").replace(";",""),16)),Rn=Vt.draw(fn);Ce(Rn,Yt)}else Ce(Vt.draw(Hr),Yt);W.putImageData(Yt,ye[Hr].x,ye[Hr].y)}}catch(io){gr.e(io)}finally{gr.f()}}else{var Zi=eo(o),Ia;try{for(Zi.s();!(Ia=Zi.n()).done;){var Za=Ia.value;W.fillText(Za,ye[Za].x,ye[Za].y+x*nl)}}catch(io){Zi.e(io)}finally{Zi.f()}}return{xOffset:Ue,yOffset:tt,mapping:ye,data:N,width:N.width,height:N.height}}},{key:"getKey",value:function(){var t=this.fontOptions,o=t.fontFamily,u=t.fontWeight;return"".concat(o,"_").concat(u)}},{key:"getNewChars",value:function(t,o){var u=this.cache.get(t);if(!u)return o;var l=[],p=u.mapping,v=new Set(Object.keys(p)),x=new Set(o);return x.forEach(function(S){v.has(S)||l.push(S)}),l}}]),r}(ya.EventEmitter))||Ha),Xe,gt;function St(e){var i=Qe();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function Qe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qe=3,ht=1024,Te=64,We=(Xe=(0,ut.b2)(),Xe(gt=function(e){(0,lt.Z)(r,e);var i=St(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"canvasHeight",128),(0,V.Z)((0,Ee.Z)(n),"texture",void 0),(0,V.Z)((0,Ee.Z)(n),"canvas",void 0),(0,V.Z)((0,Ee.Z)(n),"iconData",void 0),(0,V.Z)((0,Ee.Z)(n),"iconMap",void 0),(0,V.Z)((0,Ee.Z)(n),"ctx",void 0),(0,V.Z)((0,Ee.Z)(n),"loadingImageCount",0),n}return(0,J.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,It.Z)(he().mark(function o(u,l){var p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return p=new Image,this.loadingImageCount++,this.hasImage(u)?console.warn("Image Id already exists"):this.iconData.push({id:u,size:Te}),this.updateIconMap(),S.next=6,this.loadImage(l);case 6:p=S.sent,v=this.iconData.find(function(A){return A.id===u}),v&&(v.image=p,v.width=p.width,v.height=p.height),this.update();case 10:case"end":return S.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"addImageMini",value:function(t,o,u){var l=this,p=u.getSceneConfig().canvas,v=p.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:Te}),this.updateIconMap(),this.loadImageMini(o,p).then(function(x){v=x;var S=l.iconData.find(function(A){return A.id===t});S&&(S.image=v,S.width=v.width,S.height=v.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(function(o){return o.id!==t}),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise(function(o,u){if(t instanceof HTMLImageElement){o(t);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){o(l)},l.onerror=function(){u(new Error("Could not load image at "+t))},l.src=t instanceof File?URL.createObjectURL(t):t})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=ht,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=t.iconMap[o],l=u.x,p=u.y,v=u.image,x=u.width,S=x===void 0?64:x,A=u.height,k=A===void 0?64:A,D=Math.max(S,k),R=D/Te,N=k/R,W=S/R;v&&t.ctx.drawImage(v,l+(Te-W)/2,p+(Te-N)/2,W,N)})}},{key:"updateIconMap",value:function(){var t=Co(this.iconData,qe,ht),o=t.mapping,u=t.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(t,o){return new Promise(function(u,l){var p=o.createImage();p.crossOrigin="anonymous",p.onload=function(){u(p)},p.onerror=function(){l(new Error("Could not load image at "+t))},p.src=t})}}]),r}(ya.EventEmitter))||gt),ge=z(49685);function vt(){var e=new ge.WT(16);return ge.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function At(e){var i=new ge.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function sr(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Ft(e,i,r,n,t,o,u,l,p,v,x,S,A,k,D,R){var N=new ge.WT(16);return N[0]=e,N[1]=i,N[2]=r,N[3]=n,N[4]=t,N[5]=o,N[6]=u,N[7]=l,N[8]=p,N[9]=v,N[10]=x,N[11]=S,N[12]=A,N[13]=k,N[14]=D,N[15]=R,N}function rr(e,i,r,n,t,o,u,l,p,v,x,S,A,k,D,R,N){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e[4]=o,e[5]=u,e[6]=l,e[7]=p,e[8]=v,e[9]=x,e[10]=S,e[11]=A,e[12]=k,e[13]=D,e[14]=R,e[15]=N,e}function kr(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function An(e,i){if(e===i){var r=i[1],n=i[2],t=i[3],o=i[6],u=i[7],l=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=o,e[11]=i[14],e[12]=t,e[13]=u,e[14]=l}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function ui(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],S=i[9],A=i[10],k=i[11],D=i[12],R=i[13],N=i[14],W=i[15],me=r*l-n*u,ye=r*p-t*u,Ne=r*v-o*u,Ue=n*p-t*l,tt=n*v-o*l,Et=t*v-o*p,Vt=x*R-S*D,Yt=x*N-A*D,gr=x*W-k*D,hr=S*N-A*R,Hr=S*W-k*R,fn=A*W-k*N,Rn=me*fn-ye*Hr+Ne*hr+Ue*gr-tt*Yt+Et*Vt;return Rn?(Rn=1/Rn,e[0]=(l*fn-p*Hr+v*hr)*Rn,e[1]=(t*Hr-n*fn-o*hr)*Rn,e[2]=(R*Et-N*tt+W*Ue)*Rn,e[3]=(A*tt-S*Et-k*Ue)*Rn,e[4]=(p*gr-u*fn-v*Yt)*Rn,e[5]=(r*fn-t*gr+o*Yt)*Rn,e[6]=(N*Ne-D*Et-W*ye)*Rn,e[7]=(x*Et-A*Ne+k*ye)*Rn,e[8]=(u*Hr-l*gr+v*Vt)*Rn,e[9]=(n*gr-r*Hr-o*Vt)*Rn,e[10]=(D*tt-R*Ne+W*me)*Rn,e[11]=(S*Ne-x*tt-k*me)*Rn,e[12]=(l*Yt-u*hr-p*Vt)*Rn,e[13]=(r*hr-n*Yt+t*Vt)*Rn,e[14]=(R*ye-D*Ue-N*me)*Rn,e[15]=(x*Ue-S*ye+A*me)*Rn,e):null}function Sn(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],S=i[9],A=i[10],k=i[11],D=i[12],R=i[13],N=i[14],W=i[15];return e[0]=l*(A*W-k*N)-S*(p*W-v*N)+R*(p*k-v*A),e[1]=-(n*(A*W-k*N)-S*(t*W-o*N)+R*(t*k-o*A)),e[2]=n*(p*W-v*N)-l*(t*W-o*N)+R*(t*v-o*p),e[3]=-(n*(p*k-v*A)-l*(t*k-o*A)+S*(t*v-o*p)),e[4]=-(u*(A*W-k*N)-x*(p*W-v*N)+D*(p*k-v*A)),e[5]=r*(A*W-k*N)-x*(t*W-o*N)+D*(t*k-o*A),e[6]=-(r*(p*W-v*N)-u*(t*W-o*N)+D*(t*v-o*p)),e[7]=r*(p*k-v*A)-u*(t*k-o*A)+x*(t*v-o*p),e[8]=u*(S*W-k*R)-x*(l*W-v*R)+D*(l*k-v*S),e[9]=-(r*(S*W-k*R)-x*(n*W-o*R)+D*(n*k-o*S)),e[10]=r*(l*W-v*R)-u*(n*W-o*R)+D*(n*v-o*l),e[11]=-(r*(l*k-v*S)-u*(n*k-o*S)+x*(n*v-o*l)),e[12]=-(u*(S*N-A*R)-x*(l*N-p*R)+D*(l*A-p*S)),e[13]=r*(S*N-A*R)-x*(n*N-t*R)+D*(n*A-t*S),e[14]=-(r*(l*N-p*R)-u*(n*N-t*R)+D*(n*p-t*l)),e[15]=r*(l*A-p*S)-u*(n*A-t*S)+x*(n*p-t*l),e}function Wn(e){var i=e[0],r=e[1],n=e[2],t=e[3],o=e[4],u=e[5],l=e[6],p=e[7],v=e[8],x=e[9],S=e[10],A=e[11],k=e[12],D=e[13],R=e[14],N=e[15],W=i*u-r*o,me=i*l-n*o,ye=i*p-t*o,Ne=r*l-n*u,Ue=r*p-t*u,tt=n*p-t*l,Et=v*D-x*k,Vt=v*R-S*k,Yt=v*N-A*k,gr=x*R-S*D,hr=x*N-A*D,Hr=S*N-A*R;return W*Hr-me*hr+ye*gr+Ne*Yt-Ue*Vt+tt*Et}function $n(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],S=i[8],A=i[9],k=i[10],D=i[11],R=i[12],N=i[13],W=i[14],me=i[15],ye=r[0],Ne=r[1],Ue=r[2],tt=r[3];return e[0]=ye*n+Ne*l+Ue*S+tt*R,e[1]=ye*t+Ne*p+Ue*A+tt*N,e[2]=ye*o+Ne*v+Ue*k+tt*W,e[3]=ye*u+Ne*x+Ue*D+tt*me,ye=r[4],Ne=r[5],Ue=r[6],tt=r[7],e[4]=ye*n+Ne*l+Ue*S+tt*R,e[5]=ye*t+Ne*p+Ue*A+tt*N,e[6]=ye*o+Ne*v+Ue*k+tt*W,e[7]=ye*u+Ne*x+Ue*D+tt*me,ye=r[8],Ne=r[9],Ue=r[10],tt=r[11],e[8]=ye*n+Ne*l+Ue*S+tt*R,e[9]=ye*t+Ne*p+Ue*A+tt*N,e[10]=ye*o+Ne*v+Ue*k+tt*W,e[11]=ye*u+Ne*x+Ue*D+tt*me,ye=r[12],Ne=r[13],Ue=r[14],tt=r[15],e[12]=ye*n+Ne*l+Ue*S+tt*R,e[13]=ye*t+Ne*p+Ue*A+tt*N,e[14]=ye*o+Ne*v+Ue*k+tt*W,e[15]=ye*u+Ne*x+Ue*D+tt*me,e}function Pi(e,i,r){var n=r[0],t=r[1],o=r[2],u,l,p,v,x,S,A,k,D,R,N,W;return i===e?(e[12]=i[0]*n+i[4]*t+i[8]*o+i[12],e[13]=i[1]*n+i[5]*t+i[9]*o+i[13],e[14]=i[2]*n+i[6]*t+i[10]*o+i[14],e[15]=i[3]*n+i[7]*t+i[11]*o+i[15]):(u=i[0],l=i[1],p=i[2],v=i[3],x=i[4],S=i[5],A=i[6],k=i[7],D=i[8],R=i[9],N=i[10],W=i[11],e[0]=u,e[1]=l,e[2]=p,e[3]=v,e[4]=x,e[5]=S,e[6]=A,e[7]=k,e[8]=D,e[9]=R,e[10]=N,e[11]=W,e[12]=u*n+x*t+D*o+i[12],e[13]=l*n+S*t+R*o+i[13],e[14]=p*n+A*t+N*o+i[14],e[15]=v*n+k*t+W*o+i[15]),e}function da(e,i,r){var n=r[0],t=r[1],o=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*t,e[5]=i[5]*t,e[6]=i[6]*t,e[7]=i[7]*t,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=i[11]*o,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Is(e,i,r,n){var t=n[0],o=n[1],u=n[2],l=Math.hypot(t,o,u),p,v,x,S,A,k,D,R,N,W,me,ye,Ne,Ue,tt,Et,Vt,Yt,gr,hr,Hr,fn,Rn,Zi;return l<ge.Ib?null:(l=1/l,t*=l,o*=l,u*=l,p=Math.sin(r),v=Math.cos(r),x=1-v,S=i[0],A=i[1],k=i[2],D=i[3],R=i[4],N=i[5],W=i[6],me=i[7],ye=i[8],Ne=i[9],Ue=i[10],tt=i[11],Et=t*t*x+v,Vt=o*t*x+u*p,Yt=u*t*x-o*p,gr=t*o*x-u*p,hr=o*o*x+v,Hr=u*o*x+t*p,fn=t*u*x+o*p,Rn=o*u*x-t*p,Zi=u*u*x+v,e[0]=S*Et+R*Vt+ye*Yt,e[1]=A*Et+N*Vt+Ne*Yt,e[2]=k*Et+W*Vt+Ue*Yt,e[3]=D*Et+me*Vt+tt*Yt,e[4]=S*gr+R*hr+ye*Hr,e[5]=A*gr+N*hr+Ne*Hr,e[6]=k*gr+W*hr+Ue*Hr,e[7]=D*gr+me*hr+tt*Hr,e[8]=S*fn+R*Rn+ye*Zi,e[9]=A*fn+N*Rn+Ne*Zi,e[10]=k*fn+W*Rn+Ue*Zi,e[11]=D*fn+me*Rn+tt*Zi,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function Rc(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[4],u=i[5],l=i[6],p=i[7],v=i[8],x=i[9],S=i[10],A=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=o*t+v*n,e[5]=u*t+x*n,e[6]=l*t+S*n,e[7]=p*t+A*n,e[8]=v*t-o*n,e[9]=x*t-u*n,e[10]=S*t-l*n,e[11]=A*t-p*n,e}function Ps(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],l=i[2],p=i[3],v=i[8],x=i[9],S=i[10],A=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t-v*n,e[1]=u*t-x*n,e[2]=l*t-S*n,e[3]=p*t-A*n,e[8]=o*n+v*t,e[9]=u*n+x*t,e[10]=l*n+S*t,e[11]=p*n+A*t,e}function Zf(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],l=i[2],p=i[3],v=i[4],x=i[5],S=i[6],A=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t+v*n,e[1]=u*t+x*n,e[2]=l*t+S*n,e[3]=p*t+A*n,e[4]=v*t-o*n,e[5]=x*t-u*n,e[6]=S*t-l*n,e[7]=A*t-p*n,e}function nu(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Uf(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Vf(e,i,r){var n=r[0],t=r[1],o=r[2],u=Math.hypot(n,t,o),l,p,v;return u<ge.Ib?null:(u=1/u,n*=u,t*=u,o*=u,l=Math.sin(i),p=Math.cos(i),v=1-p,e[0]=n*n*v+p,e[1]=t*n*v+o*l,e[2]=o*n*v-t*l,e[3]=0,e[4]=n*t*v-o*l,e[5]=t*t*v+p,e[6]=o*t*v+n*l,e[7]=0,e[8]=n*o*v+t*l,e[9]=t*o*v-n*l,e[10]=o*o*v+p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Ld(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bh(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Uv(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function uo(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],l=n+n,p=t+t,v=o+o,x=n*l,S=n*p,A=n*v,k=t*p,D=t*v,R=o*v,N=u*l,W=u*p,me=u*v;return e[0]=1-(k+R),e[1]=S+me,e[2]=A-W,e[3]=0,e[4]=S-me,e[5]=1-(x+R),e[6]=D+N,e[7]=0,e[8]=A+W,e[9]=D-N,e[10]=1-(x+k),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Sa(e,i){var r=new ge.WT(3),n=-i[0],t=-i[1],o=-i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],S=n*n+t*t+o*o+u*u;return S>0?(r[0]=(l*u+x*n+p*o-v*t)*2/S,r[1]=(p*u+x*t+v*n-l*o)*2/S,r[2]=(v*u+x*o+l*t-p*n)*2/S):(r[0]=(l*u+x*n+p*o-v*t)*2,r[1]=(p*u+x*t+v*n-l*o)*2,r[2]=(v*u+x*o+l*t-p*n)*2),uo(e,i,r),e}function Vv(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Rd(e,i){var r=i[0],n=i[1],t=i[2],o=i[4],u=i[5],l=i[6],p=i[8],v=i[9],x=i[10];return e[0]=Math.hypot(r,n,t),e[1]=Math.hypot(o,u,l),e[2]=Math.hypot(p,v,x),e}function jv(e,i){var r=new ge.WT(3);Rd(r,i);var n=1/r[0],t=1/r[1],o=1/r[2],u=i[0]*n,l=i[1]*t,p=i[2]*o,v=i[4]*n,x=i[5]*t,S=i[6]*o,A=i[8]*n,k=i[9]*t,D=i[10]*o,R=u+x+D,N=0;return R>0?(N=Math.sqrt(R+1)*2,e[3]=.25*N,e[0]=(S-k)/N,e[1]=(A-p)/N,e[2]=(l-v)/N):u>x&&u>D?(N=Math.sqrt(1+u-x-D)*2,e[3]=(S-k)/N,e[0]=.25*N,e[1]=(l+v)/N,e[2]=(A+p)/N):x>D?(N=Math.sqrt(1+x-u-D)*2,e[3]=(A-p)/N,e[0]=(l+v)/N,e[1]=.25*N,e[2]=(S+k)/N):(N=Math.sqrt(1+D-u-x)*2,e[3]=(l-v)/N,e[0]=(A+p)/N,e[1]=(S+k)/N,e[2]=.25*N),e}function Gv(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=i[3],p=t+t,v=o+o,x=u+u,S=t*p,A=t*v,k=t*x,D=o*v,R=o*x,N=u*x,W=l*p,me=l*v,ye=l*x,Ne=n[0],Ue=n[1],tt=n[2];return e[0]=(1-(D+N))*Ne,e[1]=(A+ye)*Ne,e[2]=(k-me)*Ne,e[3]=0,e[4]=(A-ye)*Ue,e[5]=(1-(S+N))*Ue,e[6]=(R+W)*Ue,e[7]=0,e[8]=(k+me)*tt,e[9]=(R-W)*tt,e[10]=(1-(S+D))*tt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Hv(e,i,r,n,t){var o=i[0],u=i[1],l=i[2],p=i[3],v=o+o,x=u+u,S=l+l,A=o*v,k=o*x,D=o*S,R=u*x,N=u*S,W=l*S,me=p*v,ye=p*x,Ne=p*S,Ue=n[0],tt=n[1],Et=n[2],Vt=t[0],Yt=t[1],gr=t[2],hr=(1-(R+W))*Ue,Hr=(k+Ne)*Ue,fn=(D-ye)*Ue,Rn=(k-Ne)*tt,Zi=(1-(A+W))*tt,Ia=(N+me)*tt,Za=(D+ye)*Et,io=(N-me)*Et,Wo=(1-(A+R))*Et;return e[0]=hr,e[1]=Hr,e[2]=fn,e[3]=0,e[4]=Rn,e[5]=Zi,e[6]=Ia,e[7]=0,e[8]=Za,e[9]=io,e[10]=Wo,e[11]=0,e[12]=r[0]+Vt-(hr*Vt+Rn*Yt+Za*gr),e[13]=r[1]+Yt-(Hr*Vt+Zi*Yt+io*gr),e[14]=r[2]+gr-(fn*Vt+Ia*Yt+Wo*gr),e[15]=1,e}function Dd(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r+r,l=n+n,p=t+t,v=r*u,x=n*u,S=n*l,A=t*u,k=t*l,D=t*p,R=o*u,N=o*l,W=o*p;return e[0]=1-S-D,e[1]=x+W,e[2]=A-N,e[3]=0,e[4]=x-W,e[5]=1-v-D,e[6]=k+R,e[7]=0,e[8]=A+N,e[9]=k-R,e[10]=1-v-S,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function jf(e,i,r,n,t,o,u){var l=1/(r-i),p=1/(t-n),v=1/(o-u);return e[0]=o*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*p,e[6]=0,e[7]=0,e[8]=(r+i)*l,e[9]=(t+n)*p,e[10]=(u+o)*v,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*v,e[15]=0,e}function ff(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=(t+n)*u,e[14]=2*t*n*u):(e[10]=-1,e[14]=-2*n),e}var Od=ff;function wo(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=t*u,e[14]=t*n*u):(e[10]=-1,e[14]=-n),e}function Qh(e,i,r,n){var t=Math.tan(i.upDegrees*Math.PI/180),o=Math.tan(i.downDegrees*Math.PI/180),u=Math.tan(i.leftDegrees*Math.PI/180),l=Math.tan(i.rightDegrees*Math.PI/180),p=2/(u+l),v=2/(t+o);return e[0]=p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=-((u-l)*p*.5),e[9]=(t-o)*v*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function tc(e,i,r,n,t,o,u){var l=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*v,e[11]=0,e[12]=(i+r)*l,e[13]=(t+n)*p,e[14]=(u+o)*v,e[15]=1,e}var Np=tc;function Zp(e,i,r,n,t,o,u){var l=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=v,e[11]=0,e[12]=(i+r)*l,e[13]=(t+n)*p,e[14]=o*v,e[15]=1,e}function Fd(e,i,r,n){var t,o,u,l,p,v,x,S,A,k,D=i[0],R=i[1],N=i[2],W=n[0],me=n[1],ye=n[2],Ne=r[0],Ue=r[1],tt=r[2];return Math.abs(D-Ne)<ge.Ib&&Math.abs(R-Ue)<ge.Ib&&Math.abs(N-tt)<ge.Ib?kr(e):(x=D-Ne,S=R-Ue,A=N-tt,k=1/Math.hypot(x,S,A),x*=k,S*=k,A*=k,t=me*A-ye*S,o=ye*x-W*A,u=W*S-me*x,k=Math.hypot(t,o,u),k?(k=1/k,t*=k,o*=k,u*=k):(t=0,o=0,u=0),l=S*u-A*o,p=A*t-x*u,v=x*o-S*t,k=Math.hypot(l,p,v),k?(k=1/k,l*=k,p*=k,v*=k):(l=0,p=0,v=0),e[0]=t,e[1]=l,e[2]=x,e[3]=0,e[4]=o,e[5]=p,e[6]=S,e[7]=0,e[8]=u,e[9]=v,e[10]=A,e[11]=0,e[12]=-(t*D+o*R+u*N),e[13]=-(l*D+p*R+v*N),e[14]=-(x*D+S*R+A*N),e[15]=1,e)}function Sh(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=n[0],p=n[1],v=n[2],x=t-r[0],S=o-r[1],A=u-r[2],k=x*x+S*S+A*A;k>0&&(k=1/Math.sqrt(k),x*=k,S*=k,A*=k);var D=p*A-v*S,R=v*x-l*A,N=l*S-p*x;return k=D*D+R*R+N*N,k>0&&(k=1/Math.sqrt(k),D*=k,R*=k,N*=k),e[0]=D,e[1]=R,e[2]=N,e[3]=0,e[4]=S*N-A*R,e[5]=A*D-x*N,e[6]=x*R-S*D,e[7]=0,e[8]=x,e[9]=S,e[10]=A,e[11]=0,e[12]=t,e[13]=o,e[14]=u,e[15]=1,e}function Dc(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Wv(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function $v(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Xv(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Oo(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function hf(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function Yv(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function a(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8],S=e[9],A=e[10],k=e[11],D=e[12],R=e[13],N=e[14],W=e[15],me=i[0],ye=i[1],Ne=i[2],Ue=i[3],tt=i[4],Et=i[5],Vt=i[6],Yt=i[7],gr=i[8],hr=i[9],Hr=i[10],fn=i[11],Rn=i[12],Zi=i[13],Ia=i[14],Za=i[15];return Math.abs(r-me)<=ge.Ib*Math.max(1,Math.abs(r),Math.abs(me))&&Math.abs(n-ye)<=ge.Ib*Math.max(1,Math.abs(n),Math.abs(ye))&&Math.abs(t-Ne)<=ge.Ib*Math.max(1,Math.abs(t),Math.abs(Ne))&&Math.abs(o-Ue)<=ge.Ib*Math.max(1,Math.abs(o),Math.abs(Ue))&&Math.abs(u-tt)<=ge.Ib*Math.max(1,Math.abs(u),Math.abs(tt))&&Math.abs(l-Et)<=ge.Ib*Math.max(1,Math.abs(l),Math.abs(Et))&&Math.abs(p-Vt)<=ge.Ib*Math.max(1,Math.abs(p),Math.abs(Vt))&&Math.abs(v-Yt)<=ge.Ib*Math.max(1,Math.abs(v),Math.abs(Yt))&&Math.abs(x-gr)<=ge.Ib*Math.max(1,Math.abs(x),Math.abs(gr))&&Math.abs(S-hr)<=ge.Ib*Math.max(1,Math.abs(S),Math.abs(hr))&&Math.abs(A-Hr)<=ge.Ib*Math.max(1,Math.abs(A),Math.abs(Hr))&&Math.abs(k-fn)<=ge.Ib*Math.max(1,Math.abs(k),Math.abs(fn))&&Math.abs(D-Rn)<=ge.Ib*Math.max(1,Math.abs(D),Math.abs(Rn))&&Math.abs(R-Zi)<=ge.Ib*Math.max(1,Math.abs(R),Math.abs(Zi))&&Math.abs(N-Ia)<=ge.Ib*Math.max(1,Math.abs(N),Math.abs(Ia))&&Math.abs(W-Za)<=ge.Ib*Math.max(1,Math.abs(W),Math.abs(Za))}var s=$n,c=Xv,m,_,b=(m=(0,ut.b2)(),m(_=function(){function e(){(0,be.Z)(this,e),(0,V.Z)(this,"viewport",void 0),(0,V.Z)(this,"overridedViewProjectionMatrix",void 0),(0,V.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,V.Z)(this,"jitteredProjectionMatrix",void 0),(0,V.Z)(this,"viewMatrixInverse",void 0),(0,V.Z)(this,"cameraPosition",void 0)}return(0,J.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=vt(),ui(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,K.Z)(r,2),t=n[0],o=n[1];return[t,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var t=nu(vt(),[r,n,0]);this.jitteredProjectionMatrix=$n(vt(),t,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=$n(vt(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||_),E=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),M,P;function F(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=j(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function j(e,i){if(!!e){if(typeof e=="string")return H(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H(e,i)}}function H(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var te={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},ue=(M=(0,ut.b2)(),M(P=function(){function e(){(0,be.Z)(this,e),(0,V.Z)(this,"container",void 0),(0,V.Z)(this,"controlCorners",void 0),(0,V.Z)(this,"controlContainer",void 0),(0,V.Z)(this,"scene",void 0),(0,V.Z)(this,"mapsService",void 0),(0,V.Z)(this,"controls",[]),(0,V.Z)(this,"unAddControls",[])}return(0,J.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(et.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var t=n.get(et.IMapService);t.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=F(this.controls),n;try{for(r.s();!(n=r.n()).done;){var t=n.value;t.remove()}}catch(o){r.e(o)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",t=this.controlContainer=kn("div",n+"control-container",this.container);function o(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=l.map(function(v){return n+v}).join(" ");r[l.filter(function(v){return!["row","column"].includes(v)}).join("")]=kn("div",p,t)}function u(l){var p=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,cr.Z)(p),[te[l]])}Object.values(E).forEach(function(l){o(u(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&gs(this.controlCorners[r]);this.controlContainer&&gs(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var r=this,n=window.MutationObserver;if(!!n)for(var t=function(){var p=u[o],v=p.match(/^(top|bottom)(left|right)$/);if(v){var x=(0,K.Z)(v,3),S=x[1],A=x[2],k=r.controlCorners["".concat(S).concat(A)],D=new n(function(R){var N=(0,K.Z)(R,1),W=N[0].target;k&&(k.style[S]=W.clientHeight+"px")});D.observe(r.controlCorners["".concat(A).concat(S)],{childList:!0,attributes:!0})}},o=0,u=Object.keys(this.controlCorners);o<u.length;o++)t()}}]),e}())||P),De,Be,Je=(De=(0,ut.b2)(),De(Be=function(){function e(){(0,be.Z)(this,e),(0,V.Z)(this,"container",void 0),(0,V.Z)(this,"scene",void 0),(0,V.Z)(this,"mapsService",void 0),(0,V.Z)(this,"markers",[]),(0,V.Z)(this,"markerLayers",[]),(0,V.Z)(this,"unAddMarkers",[]),(0,V.Z)(this,"unAddMarkerLayers",[])}return(0,J.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(et.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Be),He,mt,Lt=(He=(0,ut.b2)(),He(mt=function(){function e(){(0,be.Z)(this,e),(0,V.Z)(this,"scene",void 0),(0,V.Z)(this,"mapsService",void 0),(0,V.Z)(this,"popups",[]),(0,V.Z)(this,"unAddPopups",[])}return(0,J.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(r){r!=null&&r.isOpen()&&r.remove();var n=this.popups.indexOf(r);n>-1&&this.popups.splice(n,1);var t=this.unAddPopups.indexOf(r);t>-1&&this.unAddPopups.splice(t,1)}},{key:"destroy",value:function(){this.popups.forEach(function(r){return r.remove()})}},{key:"addPopup",value:function(r){var n=this;r&&r.getOptions().autoClose&&[].concat((0,cr.Z)(this.popups),(0,cr.Z)(this.unAddPopups)).forEach(function(t){t.getOptions().autoClose&&n.removePopup(t)}),this.isMarkerReady?(r.addTo(this.scene),this.popups.push(r)):this.unAddPopups.push(r),r.on("close",function(){n.removePopup(r)})}},{key:"initPopup",value:function(){var r=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){r.addPopup(n),r.unAddPopups=[]})}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(et.IMapService)}}]),e}())||mt),zt=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),Zt=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),ur=function(e){return e.AND="and",e.OR="or",e}({}),yr=function(e){return e.INIT="init",e.UPDATE="update",e}({}),Xr={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Fn=Xr,nn,Bn,sn=ii.merge,gi={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Kn={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:ur.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},En=(nn=(0,ut.b2)(),nn(Bn=function(){function e(){(0,be.Z)(this,e),(0,V.Z)(this,"sceneConfigCache",{}),(0,V.Z)(this,"layerConfigCache",{}),(0,V.Z)(this,"layerAttributeConfigCache",{})}return(0,J.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Fn[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=(0,O.Z)((0,O.Z)({},gi),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,t){this.layerConfigCache[n]=(0,O.Z)({},sn({},this.sceneConfigCache[r],Kn,t))}},{key:"getAttributeConfig",value:function(r){return this.layerAttributeConfigCache[r]}},{key:"setAttributeConfig",value:function(r,n){this.layerAttributeConfigCache[r]=(0,O.Z)((0,O.Z)({},this.layerAttributeConfigCache[r]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Bn);function on(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function Kr(e,i,r,n,t){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(u,l){return l(e,i,u)||u},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,i,o),o=null),o}function Fi(){var e=new ge.WT(4);return ge.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Nn(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function Vi(e,i,r,n){var t=new ge.WT(4);return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function Ta(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function to(e,i,r,n,t){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e}function Xa(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function Ma(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function ro(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function Fo(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Bo(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Ls(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Go(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Rs(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function lo(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function zo(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function Li(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function sa(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return Math.hypot(r,n,t,o)}function ea(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return r*r+n*n+t*t+o*o}function Ni(e){var i=e[0],r=e[1],n=e[2],t=e[3];return Math.hypot(i,r,n,t)}function Ys(e){var i=e[0],r=e[1],n=e[2],t=e[3];return i*i+r*r+n*n+t*t}function ps(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function wa(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function Eo(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r*r+n*n+t*t+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=r*u,e[1]=n*u,e[2]=t*u,e[3]=o*u,e}function ds(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function Gi(e,i,r,n){var t=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],u=r[0]*n[3]-r[3]*n[0],l=r[1]*n[2]-r[2]*n[1],p=r[1]*n[3]-r[3]*n[1],v=r[2]*n[3]-r[3]*n[2],x=i[0],S=i[1],A=i[2],k=i[3];return e[0]=S*v-A*p+k*l,e[1]=-(x*v)+A*u-k*o,e[2]=x*p-S*u+k*t,e[3]=-(x*l)+S*o-A*t,e}function Oc(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=i[3];return e[0]=t+n*(r[0]-t),e[1]=o+n*(r[1]-o),e[2]=u+n*(r[2]-u),e[3]=l+n*(r[3]-l),e}function Ou(e,i){i=i||1;var r,n,t,o,u,l;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=r*r+n*n;while(u>=1);do t=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,l=t*t+o*o;while(l>=1);var p=Math.sqrt((1-u)/l);return e[0]=i*r,e[1]=i*n,e[2]=i*t*p,e[3]=i*o*p,e}function il(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3];return e[0]=r[0]*n+r[4]*t+r[8]*o+r[12]*u,e[1]=r[1]*n+r[5]*t+r[9]*o+r[13]*u,e[2]=r[2]*n+r[6]*t+r[10]*o+r[14]*u,e[3]=r[3]*n+r[7]*t+r[11]*o+r[15]*u,e}function co(e,i,r){var n=i[0],t=i[1],o=i[2],u=r[0],l=r[1],p=r[2],v=r[3],x=v*n+l*o-p*t,S=v*t+p*n-u*o,A=v*o+u*t-l*n,k=-u*n-l*t-p*o;return e[0]=x*v+k*-u+S*-p-A*-l,e[1]=S*v+k*-l+A*-u-x*-p,e[2]=A*v+k*-p+x*-l-S*-u,e[3]=i[3],e}function Fc(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Al(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function ep(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function wh(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=i[0],l=i[1],p=i[2],v=i[3];return Math.abs(r-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(t-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(p))&&Math.abs(o-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))}var tp=null,pf=null,rp=null,Bd=null,np=null,Up=null,zd=null,Nd=function(){var e=Fi();return function(i,r,n,t,o,u){var l,p;for(r||(r=4),n||(n=0),t?p=Math.min(t*r+n,i.length):p=i.length,l=n;l<p;l+=r)e[0]=i[l],e[1]=i[l+1],e[2]=i[l+2],e[3]=i[l+3],o(e,e,u),i[l]=e[0],i[l+1]=e[1],i[l+2]=e[2],i[l+3]=e[3];return i}}(),Cl=Math.PI/180,ip=512,Gf=4003e4;function Bc(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,t=n===void 0?0:n,o=e.scale,u=e.highPrecision,l=u===void 0?!1:u,p=e.flipY,v=p===void 0?!1:p;o=o!==void 0?o:Math.pow(2,t);var x={},S=ip*o,A=Math.cos(r*Cl),k=S/360,D=k/A,R=S/Gf/A;if(x.pixelsPerMeter=[R,-R,R],x.metersPerPixel=[1/R,-1/R,1/R],x.pixelsPerDegree=[k,-D,R],x.degreesPerPixel=[1/k,-1/D,1/R],l){var N=Cl*Math.tan(r*Cl)/A,W=k*N/2,me=S/Gf*N,ye=me/D*R;x.pixelsPerDegree2=[0,-W,me],x.pixelsPerMeter2=[ye,0,ye],v&&(x.pixelsPerDegree2[1]=-x.pixelsPerDegree2[1],x.pixelsPerMeter2[1]=-x.pixelsPerMeter2[1])}return v&&(x.pixelsPerMeter[1]=-x.pixelsPerMeter[1],x.metersPerPixel[1]=-x.metersPerPixel[1],x.pixelsPerDegree[1]=-x.pixelsPerDegree[1],x.degreesPerPixel[1]=-x.degreesPerPixel[1]),x}var Tl=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),rc={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},ap,Eh,Ah,Ch,Th,op=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],sp=(ap=(0,ut.b2)(),Eh=(0,ut.f3)(et.ICameraService),ap(Ah=(Ch=function(){function e(){(0,be.Z)(this,e),(0,V.Z)(this,"needRefresh",!0),on(this,"cameraService",Th,this),(0,V.Z)(this,"coordinateSystem",void 0),(0,V.Z)(this,"viewportCenter",void 0),(0,V.Z)(this,"viewportCenterProjection",void 0),(0,V.Z)(this,"pixelsPerDegree",void 0),(0,V.Z)(this,"pixelsPerDegree2",void 0),(0,V.Z)(this,"pixelsPerMeter",void 0)}return(0,J.Z)(e,[{key:"refresh",value:function(r){var n=this.cameraService.getZoom(),t=this.cameraService.getZoomScale(),o=r||this.cameraService.getCenter(),u=Bc({latitude:o[1],zoom:n}),l=u.pixelsPerMeter,p=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Tl.LNGLAT||this.coordinateSystem===Tl.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Tl.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===Tl.P20_OFFSET&&this.calculateLnglatOffset(o,n,t,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,t,o){var u=Bc({latitude:r[1],zoom:n,scale:t,flipY:o,highPrecision:!0}),l=u.pixelsPerMeter,p=u.pixelsPerDegree,v=u.pixelsPerDegree2,x=this.cameraService.getViewMatrix(),S=this.cameraService.getProjectionMatrix(),A=$n([],S,x),k=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=il([],[k[0],k[1],0,1],A),x=this.cameraService.getViewMatrixUncentered()||x,A=$n([],S,x),A=$n([],A,op),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=v}}]),e}(),Th=Kr(Ch.prototype,"cameraService",[Eh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch))||Ah),up,Hf;function Vp(e){var i=Mh();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function Mh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lp=(up=(0,ut.b2)(),up(Hf=function(e){(0,lt.Z)(r,e);var i=Vp(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"renderMap",new Map),(0,V.Z)((0,Ee.Z)(n),"enable",!1),(0,V.Z)((0,Ee.Z)(n),"renderEnable",!1),(0,V.Z)((0,Ee.Z)(n),"cacheLogs",{}),n}return(0,J.Z)(r,[{key:"setEnable",value:function(t){this.enable=!!t}},{key:"log",value:function(t,o){var u=this;if(!!this.enable){var l=t.split("."),p=null;l.forEach(function(v,x){p!==null?(p[v]||(p[v]={}),x!==l.length-1&&(p=p[v])):(u.cacheLogs[v]||(u.cacheLogs[v]={}),x!==l.length-1&&(p=u.cacheLogs[v])),x===l.length-1&&(p[v]=(0,O.Z)((0,O.Z)({time:Date.now()},p[v]),o))})}}},{key:"getLog",value:function(t){var o=this;switch((0,Rf.Z)(t)){case"string":return this.cacheLogs[t];case"object":return t.map(function(u){return o.cacheLogs[u]}).filter(function(u){return u!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(t){delete this.cacheLogs[t]}},{key:"generateRenderUid",value:function(){return this.renderEnable?Mu():""}},{key:"renderDebug",value:function(t){this.renderEnable=t}},{key:"renderStart",value:function(t){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(t)||{};this.renderMap.set(t,(0,O.Z)((0,O.Z)({},o),{},{renderUid:t,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(t){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(t);if(o){var u=o.renderStart,l=Date.now();this.emit("renderEnd",(0,O.Z)((0,O.Z)({},o),{},{renderEnd:l,renderDuration:l-u})),this.renderMap.delete(t)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),r}(ya.EventEmitter))||Hf),Wf=z(50840),zc=z.n(Wf),Ho=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),jp,Zd,Gp,Hp,Wp;function $m(e){var i=cp();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function cp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var no={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Ml=(jp=(0,ut.b2)(),Zd=(0,ut.f3)(et.IMapService),jp(Gp=(Hp=function(e){(0,lt.Z)(r,e);var i=$m(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"indragging",!1),on((0,Ee.Z)(n),"mapService",Wp,(0,Ee.Z)(n)),(0,V.Z)((0,Ee.Z)(n),"hammertime",void 0),(0,V.Z)((0,Ee.Z)(n),"lastClickTime",0),(0,V.Z)((0,Ee.Z)(n),"lastClickXY",[-1,-1]),(0,V.Z)((0,Ee.Z)(n),"clickTimer",void 0),(0,V.Z)((0,Ee.Z)(n),"$containter",void 0),(0,V.Z)((0,Ee.Z)(n),"onDrag",function(l){var p=n.interactionEvent(l);p.type=no[p.type],p.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Ho.Drag,p)}),(0,V.Z)((0,Ee.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var p=n.interactionEvent(l);n.emit(Ho.Hover,p)}),(0,V.Z)((0,Ee.Z)(n),"onTouch",function(l){var p=l.touches[0];n.onHover({x:p.pageX,y:p.pageY,type:"touch"})}),(0,V.Z)((0,Ee.Z)(n),"onHover",function(l){var p=l.clientX,v=l.clientY,x=p,S=v,A=l.type,k=n.mapService.getMapContainer();if(k){var D=k.getBoundingClientRect(),R=D.top,N=D.left;x=x-N-k.clientLeft,S=S-R-k.clientTop}var W=n.mapService.containerToLngLat([x,S]);if(A==="click"){n.isDoubleTap(x,S,W);return}if(A==="touch"){n.isDoubleTap(x,S,W);return}A!=="click"&&A!=="dblclick"&&n.emit(Ho.Hover,{x,y:S,lngLat:W,type:A,target:l})}),n}return(0,J.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Ho.Hover)}},{key:"triggerHover",value:function(t){var o=t.x,u=t.y;this.emit(Ho.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(t){this.emit(Ho.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(Ho.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t){var o=new(zc()).Manager(t);o.add(new(zc()).Tap({event:"dblclick",taps:2})),o.add(new(zc()).Tap({event:"click"})),o.add(new(zc()).Pan({threshold:0,pointers:0})),o.add(new(zc()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(t){var o=t.type,u=t.pointerType,l,p;u==="touch"?(p=Math.floor(t.pointers[0].clientY),l=Math.floor(t.pointers[0].clientX)):(p=Math.floor(t.srcEvent.y),l=Math.floor(t.srcEvent.x));var v=this.mapService.getMapContainer();if(v){var x=v.getBoundingClientRect(),S=x.top,A=x.left;l-=A,p-=S}var k=this.mapService.containerToLngLat([l,p]);return{x:l,y:p,lngLat:k,type:o,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,o,u){var l=this,p=new Date().getTime(),v="click";p-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),v="dblclick",this.emit(Ho.Hover,{x:t,y:o,lngLat:u,type:v})):(this.lastClickTime=p,this.lastClickXY=[t,o],this.clickTimer=setTimeout(function(){v="click",l.emit(Ho.Hover,{x:t,y:o,lngLat:u,type:v})},400))}}]),r}(cs()),Wp=Kr(Hp.prototype,"mapService",[Zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hp))||Gp),Xm=0;function df(e){var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Xm++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Ud(e){var i,r=!0;if((e==null||(i=e.target)===null||i===void 0?void 0:i.target)instanceof HTMLElement)for(var n,t=e==null||(n=e.target)===null||n===void 0?void 0:n.target;t;){var o,u=Array.from(t.classList);if(u.includes("l7-marker")||u.includes("l7-popup")){r=!1;break}t=(o=t)===null||o===void 0?void 0:o.parentElement}return r}var q=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),fp,kl,hp,kh,pp,dp,$p,vf,Ih,Vd,jd,Gd,Hd,qv=(fp=(0,ut.b2)(),kl=(0,ut.f3)(et.IMapService),hp=(0,ut.f3)(et.IRendererService),kh=(0,ut.f3)(et.IGlobalConfigService),pp=(0,ut.f3)(et.IInteractionService),dp=(0,ut.f3)(et.ILayerService),fp($p=(vf=function(){function e(){var i=this;(0,be.Z)(this,e),(0,V.Z)(this,"pickedColors",void 0),(0,V.Z)(this,"pickedTileLayers",[]),on(this,"mapService",Ih,this),on(this,"rendererService",Vd,this),on(this,"configService",jd,this),on(this,"interactionService",Gd,this),on(this,"layerService",Hd,this),(0,V.Z)(this,"pickingFBO",void 0),(0,V.Z)(this,"width",0),(0,V.Z)(this,"height",0),(0,V.Z)(this,"alreadyInPicking",!1),(0,V.Z)(this,"pickBufferScale",1),(0,V.Z)(this,"pickFromPickingFBO",function(r,n){var t=n.x,o=n.y,u=n.lngLat,l=n.type,p=n.target,v=!1,x=i.rendererService,S=x.readPixels,A=x.getContainer,k=i.getContainerSize(A()),D=k.width,R=k.height;D*=qi,R*=qi;var N=r.getLayerConfig(),W=N.enableHighlight,me=N.enableSelect,ye=t*qi,Ne=o*qi;if(ye>D-1*qi||ye<0||Ne>R-1*qi||Ne<0)return!1;var Ue=S({x:Math.floor(ye/i.pickBufferScale),y:Math.floor((R-(o+1)*qi)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO});if(i.pickedColors=Ue,Ue[0]!==0||Ue[1]!==0||Ue[2]!==0){var tt=ra(Ue),Et=r.layerPickService.getFeatureById(tt);tt!==r.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var Vt={x:t,y:o,type:l,lngLat:u,featureId:tt,feature:Et,target:p};Et&&(v=!0,r.setCurrentPickId(tt),i.triggerHoverOnLayer(r,Vt))}else{var Yt={x:t,y:o,lngLat:u,type:r.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:p,feature:null};i.triggerHoverOnLayer(r,(0,O.Z)((0,O.Z)({},Yt),{},{type:"unpick"})),i.triggerHoverOnLayer(r,Yt),r.setCurrentPickId(null)}if(W&&r.layerPickService.highlightPickedFeature(Ue),me&&l==="click"&&(Ue==null?void 0:Ue.toString())!==[0,0,0,0].toString()){var gr=ra(Ue);r.getCurrentSelectedId()===null||gr!==r.getCurrentSelectedId()?(r.layerPickService.selectFeature(Ue),r.setCurrentSelectedId(gr)):(r.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return v})}return(0,J.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,t=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,l=this.getContainerSize(u()),p=l.width,v=l.height;p*=qi,v*=qi,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=o({color:t({width:Math.round(p/this.pickBufferScale),height:Math.round(v/this.pickBufferScale),wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.interactionService.on(Ho.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,It.Z)(he().mark(function n(t,o,u){var l=this,p,v,x;return he().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:p=this.rendererService,v=p.useFramebuffer,x=p.clear,this.resizePickingFBO(),v(this.pickingFBO,function(){x({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels({ispick:!0}),t.hooks.afterPickingEncode.call();var k=l.pickBox(t,o);u(k)});case 3:case"end":return A.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var t=this,o=n.map(function(gr){var hr=gr<0?0:gr;return Math.floor(hr*qi/t.pickBufferScale)}),u=(0,K.Z)(o,4),l=u[0],p=u[1],v=u[2],x=u[3],S=this.rendererService,A=S.readPixels,k=S.getContainer,D=this.getContainerSize(k()),R=D.width,N=D.height;if(R*=qi,N*=qi,l>(R-1)*qi/this.pickBufferScale||v<0||p>(N-1)*qi/this.pickBufferScale||x<0)return[];for(var W=Math.min(R/this.pickBufferScale,v)-l,me=Math.min(N/this.pickBufferScale,x)-p,ye=A({x:l,y:Math.floor(N/this.pickBufferScale-(x+1)),width:W,height:me,data:new Uint8Array(W*me*4),framebuffer:this.pickingFBO}),Ne=[],Ue={},tt=0;tt<ye.length/4;tt=tt+1){var Et=ye.slice(tt*4,tt*4+4),Vt=ra(Et);if(Vt!==-1&&!Ue[Vt]){var Yt=r.layerPickService.getFeatureById(Vt);Ne.push((0,O.Z)((0,O.Z)({},Yt),{},{pickedFeatureIdx:Vt})),Ue[Vt]=!0}}return Ne}},{key:"handleCursor",value:function(r,n){var t=r.getLayerConfig(),o=t.cursor,u=o===void 0?"":o,l=t.cursorEnabled;if(l){var p=this.mapService.version,v=p==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),x=v==null?void 0:v.style.getPropertyValue("cursor");n==="unmousemove"&&x!==""?v==null||v.style.setProperty("cursor",""):n==="mousemove"&&(v==null||v.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/qi,height:r.height/qi}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,It.Z)(he().mark(function n(t){return he().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(!this.layerService.needPick(t.type)||!this.isPickingAllLayer())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),t=n.width,o=n.height;t*=qi,o*=qi,(this.width!==t||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=t,this.height=o)}},{key:"pickingLayers",value:function(){var i=(0,It.Z)(he().mark(function n(t){var o=this,u,l,p;return he().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=this.rendererService,l=u.useFramebuffer,p=u.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){var S=o.layerService.getRenderList();S.filter(function(A){return A.needPick(t.type)}).reverse().some(function(A){p({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),A.layerPickService.pickRender(t);var k=o.pickFromPickingFBO(A,t);return o.layerService.pickedLayerId=k?+A.id:-1,k&&!A.getLayerConfig().enablePropagation})});case 3:case"end":return x.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Ud(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}}]),e}(),Ih=Kr(vf.prototype,"mapService",[kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=Kr(vf.prototype,"rendererService",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=Kr(vf.prototype,"configService",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=Kr(vf.prototype,"interactionService",[pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd=Kr(vf.prototype,"layerService",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vf))||$p),_u=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,be.Z)(this,e),(0,V.Z)(this,"autoStart",void 0),(0,V.Z)(this,"startTime",0),(0,V.Z)(this,"oldTime",0),(0,V.Z)(this,"running",!1),(0,V.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,J.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),vp,Wd,Il,Kv,$d,Pl,$f,Xf,Yf;function mf(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Jv(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Jv(e,i){if(!!e){if(typeof e=="string")return Xd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xd(e,i)}}function Xd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Qv(e){var i=em();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function em(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xp=ii.throttle,Yd=(vp=(0,ut.b2)(),Wd=(0,ut.f3)(et.IRendererService),Il=(0,ut.f3)(et.IMapService),Kv=(0,ut.f3)(et.IDebugService),vp($d=(Pl=function(e){(0,lt.Z)(r,e);var i=Qv(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"pickedLayerId",-1),(0,V.Z)((0,Ee.Z)(n),"clock",new _u),(0,V.Z)((0,Ee.Z)(n),"alreadyInRendering",!1),(0,V.Z)((0,Ee.Z)(n),"layers",[]),(0,V.Z)((0,Ee.Z)(n),"layerList",[]),(0,V.Z)((0,Ee.Z)(n),"layerRenderID",void 0),(0,V.Z)((0,Ee.Z)(n),"sceneInited",!1),(0,V.Z)((0,Ee.Z)(n),"animateInstanceCount",0),(0,V.Z)((0,Ee.Z)(n),"shaderPicking",!0),(0,V.Z)((0,Ee.Z)(n),"enableRender",!0),on((0,Ee.Z)(n),"renderService",$f,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"mapService",Xf,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"debugService",Yf,(0,Ee.Z)(n)),(0,V.Z)((0,Ee.Z)(n),"reRender",Xp(function(){n.renderLayers()},32)),(0,V.Z)((0,Ee.Z)(n),"throttleRenderLayers",Xp(function(){n.renderLayers()},16)),n}return(0,J.Z)(r,[{key:"needPick",value:function(t){return this.layerList.some(function(o){return o.needPick(t)})}},{key:"add",value:function(t){var o=this;this.layers.push(t),this.sceneInited&&t.init().then(function(){o.renderLayers()})}},{key:"addMask",value:function(t){var o=this;this.sceneInited&&t.init().then(function(){o.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,It.Z)(he().mark(function o(){var u=this;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var v=(0,It.Z)(he().mark(function x(S){return he().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(S.startInit){k.next=4;break}return k.next=3,S.init();case 3:u.updateLayerRenderList();case 4:case"end":return k.stop()}},x)}));return function(x){return v.apply(this,arguments)}}());case 2:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(o){return o.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(o){return o.name===t})}},{key:"remove",value:function(){var n=(0,It.Z)(he().mark(function o(u,l){var p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:l?(p=l.layerChildren.indexOf(u),p>-1&&l.layerChildren.splice(p,1)):(v=this.layers.indexOf(u),v>-1&&this.layers.splice(v,1)),u.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return S.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"removeAllLayers",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S;return he().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){k.next=2;break}return k.abrupt("return");case 2:this.updateLayerRenderList(),u=this.debugService.generateRenderUid(),this.debugService.renderStart(u),this.alreadyInRendering=!0,this.clear(),l=mf(this.layerList),k.prev=8,l.s();case 10:if((p=l.n()).done){k.next=23;break}if(v=p.value,x=v.getLayerConfig(),S=x.enableMask,v.masks.filter(function(D){return D.inited}).length>0&&S&&this.renderMask(v.masks),!v.getLayerConfig().enableMultiPassRenderer){k.next=19;break}return k.next=17,v.renderMultiPass();case 17:k.next=21;break;case 19:return k.next=21,v.render();case 21:k.next=10;break;case 23:k.next=28;break;case 25:k.prev=25,k.t0=k.catch(8),l.e(k.t0);case 28:return k.prev=28,l.f(),k.finish(28);case 31:this.debugService.renderEnd(u),this.alreadyInRendering=!1;case 33:case"end":return k.stop()}},o,this,[[8,25,28,31]])}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMask",value:function(t){var o=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var u=t.length>1?Zt.MULTIPLE:Zt.SINGLE,l=mf(t),p;try{for(l.s();!(p=l.n()).done;){var v=p.value;v.render({isStencil:!0,stencilType:u,stencilIndex:o++})}}catch(x){l.e(x)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=(0,It.Z)(he().mark(function o(u){var l;return he().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,u.hooks.beforeRenderData.promise();case 2:l=v.sent,l&&this.renderLayers();case 4:case"end":return v.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderTileLayerMask",value:function(t){var o=0,u=t.getLayerConfig(),l=u.enableMask,p=l===void 0?!0:l,v=t.tileMask?1:0,x=t.masks.filter(function(R){return R.inited});v=v+(p?x.length:1);var S=v>1?Zt.MULTIPLE:Zt.SINGLE;if((t.tileMask||x.length&&p)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),x.length&&p){var A=mf(x),k;try{for(A.s();!(k=A.n()).done;){var D=k.value;D.render({isStencil:!0,stencilType:S,stencilIndex:o++})}}catch(R){A.e(R)}finally{A.f()}}t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:S,stencilIndex:o++,stencilOperation:ur.OR})}},{key:"renderTileLayer",value:function(){var n=(0,It.Z)(he().mark(function o(u){return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.renderTileLayerMask(u),!u.getLayerConfig().enableMultiPassRenderer){p.next=6;break}return p.next=4,u.renderMultiPass();case 4:p.next=8;break;case 6:return p.next=8,u.render();case 8:case"end":return p.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).sort(function(o,u){return o.zIndex-u.zIndex}).forEach(function(o){t.layerList.push(o)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=Hn(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),r}(ya.EventEmitter),$f=Kr(Pl.prototype,"renderService",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xf=Kr(Pl.prototype,"mapService",[Il],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yf=Kr(Pl.prototype,"debugService",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pl))||$d),rs=z(81253),tm=ii.isNil,qd=function(){function e(i){var r=this;(0,be.Z)(this,e),(0,V.Z)(this,"name",void 0),(0,V.Z)(this,"type",void 0),(0,V.Z)(this,"scale",void 0),(0,V.Z)(this,"descriptor",void 0),(0,V.Z)(this,"featureBufferLayout",[]),(0,V.Z)(this,"needRescale",!1),(0,V.Z)(this,"needRemapping",!1),(0,V.Z)(this,"needRegenerateVertices",!1),(0,V.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,V.Z)(this,"vertexAttribute",void 0),(0,V.Z)(this,"defaultCallback",function(n){if(n.length===0){var t;return((t=r.scale)===null||t===void 0?void 0:t.defaultValues)||[]}return n.map(function(o,u){var l,p=(l=r.scale)===null||l===void 0?void 0:l.scalers[u].func,v=p(o);return v})}),this.setProps(i)}return(0,J.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var t,o=(t=this.scale)===null||t===void 0?void 0:t.callback.apply(t,(0,cr.Z)(r));if(!tm(o))return[o]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Kd=["buffer","update","name"],rm=["buffer","update","name"],qf,Jd,Qd,Yp,qp,Ph,nm=(qf={},(0,V.Z)(qf,q.FLOAT,4),(0,V.Z)(qf,q.UNSIGNED_BYTE,1),(0,V.Z)(qf,q.UNSIGNED_SHORT,2),qf),Kp=(Jd=(0,ut.b2)(),Qd=(0,ut.f3)(et.IRendererService),Jd(Yp=(qp=function(){function e(){(0,be.Z)(this,e),(0,V.Z)(this,"attributesAndIndices",void 0),on(this,"rendererService",Ph,this),(0,V.Z)(this,"attributes",[]),(0,V.Z)(this,"triangulation",void 0),(0,V.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,J.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new qd(r),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(r){var n=this.attributes.findIndex(function(t){return t.name===r});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(r){this.attributes.forEach(function(n){var t,o=n.name,u=(t=n.scale)===null||t===void 0?void 0:t.field;(r[o]||u&&r[u])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(r,n,t){var o=this.getLayerStyleAttribute(r);o||(o=this.registerStyleAttribute((0,O.Z)((0,O.Z)({},n),{},{name:r})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,t&&t.featureRange&&(o.featureRange=t.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,t=this.getLayerStyleAttribute(r),o=t==null||(n=t.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(Ue){return Ue.name===r});if(l&&l.descriptor){var p=l.descriptor,v=p.update,x=p.buffer,S=p.size,A=S===void 0?0:S,k=nm[x.type||q.FLOAT];if(v){var D=this.featureLayout,R=D.elements,N=D.sizePerElement,W=R.slice(t,o);if(!W.length)return;var me=W[0].offset,ye=me*A*k,Ne=W.map(function(Ue,tt){for(var Et=Ue.featureIdx,Vt=Ue.vertices,Yt=Ue.normals,gr=Vt.length/N,hr=[],Hr=0;Hr<gr;Hr++){var fn=Yt?Yt.slice(Hr*3,Hr*3+3):[];hr.push.apply(hr,(0,cr.Z)(v(n[Et],Et,Vt.slice(Hr*N,Hr*N+N),tt,fn)))}return hr}).reduce(function(Ue,tt){return Ue.push.apply(Ue,(0,cr.Z)(tt)),Ue},[]);l.vertexAttribute.updateBuffer({data:Ne,offset:ye}),u==null||u.emit("legend:".concat(r),{type:r,attr:l})}}}},{key:"createAttributesAndIndices",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(W){return W.resetDescriptor(),W.descriptor}),l=0,p=0,v=[],x=3;r.forEach(function(W,me){var ye=o.triangulation(W,t),Ne=ye.indices,Ue=ye.vertices,tt=ye.normals,Et=ye.size,Vt=ye.indexes,Yt=ye.count;typeof Yt=="number"&&(p+=Yt),Ne.forEach(function(fn){v.push(fn+l)}),x=Et;var gr=Ue.length/Et;o.featureLayout.sizePerElement=x,o.featureLayout.elements.push({featureIdx:me,vertices:Ue,normals:tt,offset:l}),l+=gr;for(var hr=function(Rn){var Zi=(tt==null?void 0:tt.slice(Rn*3,Rn*3+3))||[],Ia=Ue.slice(Rn*Et,Rn*Et+Et),Za=0;Vt&&Vt[Rn]!==void 0&&(Za=Vt[Rn]),u.forEach(function(io,Wo){if(io&&io.update){var nh;(nh=io.buffer.data).push.apply(nh,(0,cr.Z)(io.update(W,me,Ia,Rn,Zi,Za)))}})},Hr=0;Hr<gr;Hr++)hr(Hr)});var S=this.rendererService,A=S.createAttribute,k=S.createBuffer,D=S.createElements,R={};u.forEach(function(W,me){if(W){var ye=W.buffer,Ne=W.update,Ue=W.name,tt=(0,rs.Z)(W,Kd),Et=A((0,O.Z)({buffer:k(ye)},tt));R[W.name||""]=Et,o.attributes[me].vertexAttribute=Et}});var N=D({data:v,type:q.UNSIGNED_INT,count:v.length});return this.attributesAndIndices={attributes:R,elements:N,count:p},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var t=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(k){return k.resetDescriptor(),k.descriptor}),u=0,l=[],p=3;r.forEach(function(k,D){var R=t.triangulation(k),N=R.indices,W=R.vertices,me=R.normals,ye=R.size,Ne=R.indexes;N.forEach(function(Vt){l.push(Vt+u)}),p=ye;var Ue=W.length/ye;t.featureLayout.sizePerElement=p,t.featureLayout.elements.push({featureIdx:D,vertices:W,normals:me,offset:u}),u+=Ue;for(var tt=function(Yt){var gr=(me==null?void 0:me.slice(Yt*3,Yt*3+3))||[],hr=W.slice(Yt*ye,Yt*ye+ye),Hr=0;Ne&&Ne[Yt]!==void 0&&(Hr=Ne[Yt]),o.forEach(function(fn,Rn){if(fn&&fn.update){var Zi;(Zi=fn.buffer.data).push.apply(Zi,(0,cr.Z)(fn.update(k,D,hr,Yt,gr,Hr)))}})},Et=0;Et<Ue;Et++)tt(Et)});var v=this.rendererService,x=v.createAttribute,S=v.createBuffer,A={};return o.forEach(function(k,D){if(k){var R=k.buffer,N=k.update,W=k.name,me=(0,rs.Z)(k,rm),ye=x((0,O.Z)({buffer:S(R)},me));A[k.name||""]=ye,t.attributes[D].vertexAttribute=ye}}),{attributes:A}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Ph=Kr(qp.prototype,"rendererService",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qp))||Yp),ev=z(34155);function Jp(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})}function tv(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function Qp(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),t,o=[],u;try{for(;(i===void 0||i-- >0)&&!(t=n.next()).done;)o.push(t.value)}catch(l){u={error:l}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(u)throw u.error}}return o}function ed(e,i,r){if(r||arguments.length===2)for(var n=0,t=i.length,o;n<t;n++)(o||!(n in i))&&(o||(o=Array.prototype.slice.call(i,0,n)),o[n]=i[n]);return e.concat(o||Array.prototype.slice.call(i))}function rv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var nv={exports:{}},td={exports:{}},mp={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default})(mp,mp.exports);var xu={},al={exports:{}},Lh={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];var o=n.pop();return r.call(this,n,o)}},e.exports=i.default})(Lh,Lh.exports);var Nc={};Object.defineProperty(Nc,"__esModule",{value:!0}),Nc.fallback=rg,Nc.wrap=ng;var gp=Nc.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,im=Nc.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,u2=Nc.hasNextTick=typeof ev=="object"&&typeof ev.nextTick=="function";function rg(e){setTimeout(e,0)}function ng(e){return function(i){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return i.apply(void 0,r)})}}var iv;gp?iv=queueMicrotask:im?iv=setImmediate:u2?iv=ev.nextTick:iv=rg,Nc.default=ng(iv),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=p;var r=Lh.exports,n=l(r),t=Nc,o=l(t),u=xu;function l(S){return S&&S.__esModule?S:{default:S}}function p(S){return(0,u.isAsync)(S)?function(){for(var A=[],k=arguments.length;k--;)A[k]=arguments[k];var D=A.pop(),R=S.apply(this,A);return v(R,D)}:(0,n.default)(function(A,k){var D;try{D=S.apply(this,A)}catch(R){return k(R)}if(D&&typeof D.then=="function")return v(D,k);k(null,D)})}function v(S,A){return S.then(function(k){x(A,null,k)},function(k){x(A,k&&k.message?k:new Error(k))})}function x(S,A,k){try{S(A,k)}catch(D){(0,o.default)(function(R){throw R},D)}}e.exports=i.default}(al,al.exports),Object.defineProperty(xu,"__esModule",{value:!0}),xu.isAsyncIterable=xu.isAsyncGenerator=xu.isAsync=void 0;var l2=al.exports,c2=f2(l2);function f2(e){return e&&e.__esModule?e:{default:e}}function ig(e){return e[Symbol.toStringTag]==="AsyncFunction"}function h2(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function p2(e){return typeof e[Symbol.asyncIterator]=="function"}function d2(e){if(typeof e!="function")throw new Error("expected a function");return ig(e)?(0,c2.default)(e):e}xu.default=d2,xu.isAsync=ig,xu.isAsyncGenerator=h2,xu.isAsyncIterable=p2;var yp={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,t){if(t===void 0&&(t=n.length),!t)throw new Error("arity is undefined");function o(){for(var u=this,l=[],p=arguments.length;p--;)l[p]=arguments[p];return typeof l[t-1]=="function"?n.apply(this,l):new Promise(function(v,x){l[t-1]=function(S){for(var A=[],k=arguments.length-1;k-- >0;)A[k]=arguments[k+1];if(S)return x(S);v(A.length>1?A:A[0])},n.apply(u,l)})}return o}e.exports=i.default})(yp,yp.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=mp.exports,n=p(r),t=xu,o=p(t),u=yp.exports,l=p(u);function p(v){return v&&v.__esModule?v:{default:v}}i.default=(0,l.default)(function(v,x,S){var A=(0,n.default)(x)?[]:{};v(x,function(k,D,R){(0,o.default)(k)(function(N){for(var W,me=[],ye=arguments.length-1;ye-- >0;)me[ye]=arguments[ye+1];me.length<2&&(W=me,me=W[0]),A[D]=me,R(N)})},function(k){return S(k,A)})},3),e.exports=i.default}(td,td.exports);var Ym={exports:{}},am={exports:{}},qm={exports:{}},av={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function t(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var l=n;n=null,l.apply(this,o)}}return Object.assign(t,n),t}e.exports=i.default})(av,av.exports);var Km={exports:{}},Jm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default})(Jm,Jm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=x;var r=mp.exports,n=u(r),t=Jm.exports,o=u(t);function u(S){return S&&S.__esModule?S:{default:S}}function l(S){var A=-1,k=S.length;return function(){return++A<k?{value:S[A],key:A}:null}}function p(S){var A=-1;return function(){var D=S.next();return D.done?null:(A++,{value:D.value,key:A})}}function v(S){var A=S?Object.keys(S):[],k=-1,D=A.length;return function R(){var N=A[++k];return N==="__proto__"?R():k<D?{value:S[N],key:N}:null}}function x(S){if((0,n.default)(S))return l(S);var A=(0,o.default)(S);return A?p(A):v(S)}e.exports=i.default}(Km,Km.exports);var ov={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,t)}}e.exports=i.default})(ov,ov.exports);var Qm={exports:{}},sv={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default})(sv,sv.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var r=sv.exports,n=t(r);function t(u){return u&&u.__esModule?u:{default:u}}function o(u,l,p,v){var x=!1,S=!1,A=!1,k=0,D=0;function R(){k>=l||A||x||(A=!0,u.next().then(function(me){var ye=me.value,Ne=me.done;if(!(S||x)){if(A=!1,Ne){x=!0,k<=0&&v(null);return}k++,p(ye,D,N),D++,R()}}).catch(W))}function N(me,ye){if(k-=1,!S){if(me)return W(me);if(me===!1){x=!0,S=!0;return}if(ye===n.default||x&&k<=0)return x=!0,v(null);R()}}function W(me){S||(A=!1,x=!0,v(me))}R()}e.exports=i.default}(Qm,Qm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=av.exports,n=k(r),t=Km.exports,o=k(t),u=ov.exports,l=k(u),p=xu,v=Qm.exports,x=k(v),S=sv.exports,A=k(S);function k(D){return D&&D.__esModule?D:{default:D}}i.default=function(D){return function(R,N,W){if(W=(0,n.default)(W),D<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!R)return W(null);if((0,p.isAsyncGenerator)(R))return(0,x.default)(R,D,N,W);if((0,p.isAsyncIterable)(R))return(0,x.default)(R[Symbol.asyncIterator](),D,N,W);var me=(0,o.default)(R),ye=!1,Ne=!1,Ue=0,tt=!1;function Et(Yt,gr){if(!Ne)if(Ue-=1,Yt)ye=!0,W(Yt);else if(Yt===!1)ye=!0,Ne=!0;else{if(gr===A.default||ye&&Ue<=0)return ye=!0,W(null);tt||Vt()}}function Vt(){for(tt=!0;Ue<D&&!ye;){var Yt=me();if(Yt===null){ye=!0,Ue<=0&&W(null);return}Ue+=1,N(Yt.value,Yt.key,(0,l.default)(Et))}tt=!1}Vt()}},e.exports=i.default}(qm,qm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=qm.exports,n=p(r),t=xu,o=p(t),u=yp.exports,l=p(u);function p(x){return x&&x.__esModule?x:{default:x}}function v(x,S,A,k){return(0,n.default)(S)(x,(0,o.default)(A),k)}i.default=(0,l.default)(v,4),e.exports=i.default}(am,am.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=am.exports,n=u(r),t=yp.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v,x){return(0,n.default)(p,1,v,x)}i.default=(0,o.default)(l,3),e.exports=i.default}(Ym,Ym.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var r=td.exports,n=u(r),t=Ym.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,n.default)(o.default,p,v)}e.exports=i.default}(nv,nv.exports);var om=rv(nv.exports),gf=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,om(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(t){r.apply(void 0,ed([],Qp(n.args),!1)),t(null,i)})},e}(),e0={exports:{}},t0={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=mp.exports,n=N(r),t=sv.exports,o=N(t),u=am.exports,l=N(u),p=av.exports,v=N(p),x=ov.exports,S=N(x),A=xu,k=N(A),D=yp.exports,R=N(D);function N(Ne){return Ne&&Ne.__esModule?Ne:{default:Ne}}function W(Ne,Ue,tt){tt=(0,v.default)(tt);var Et=0,Vt=0,Yt=Ne.length,gr=!1;Yt===0&&tt(null);function hr(Hr,fn){Hr===!1&&(gr=!0),gr!==!0&&(Hr?tt(Hr):(++Vt===Yt||fn===o.default)&&tt(null))}for(;Et<Yt;Et++)Ue(Ne[Et],Et,(0,S.default)(hr))}function me(Ne,Ue,tt){return(0,l.default)(Ne,Infinity,Ue,tt)}function ye(Ne,Ue,tt){var Et=(0,n.default)(Ne)?W:me;return Et(Ne,(0,k.default)(Ue),tt)}i.default=(0,R.default)(ye,3),e.exports=i.default})(t0,t0.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var r=t0.exports,n=u(r),t=td.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,o.default)(n.default,p,v)}e.exports=i.default}(e0,e0.exports);var v2=rv(e0.exports),dR=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return v2(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return Jp(n,void 0,void 0,function(){return tv(this,function(o){switch(o.label){case 0:return[4,r()];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),r0={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=av.exports,n=x(r),t=ov.exports,o=x(t),u=xu,l=x(u),p=yp.exports,v=x(p);function x(A){return A&&A.__esModule?A:{default:A}}function S(A,k){if(k=(0,n.default)(k),!Array.isArray(A))return k(new Error("First argument to waterfall must be an array of functions"));if(!A.length)return k();var D=0;function R(W){var me=(0,l.default)(A[D++]);me.apply(void 0,W.concat([(0,o.default)(N)]))}function N(W){for(var me=[],ye=arguments.length-1;ye-- >0;)me[ye]=arguments[ye+1];if(W!==!1){if(W||D===A.length)return k.apply(void 0,[W].concat(me));R(me)}}R([])}i.default=(0,v.default)(S),e.exports=i.default})(r0,r0.exports);var ag=rv(r0.exports),vR=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return ag(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var t=r();n(t?null:!1,t)}):this.tasks.push(function(n,t){var o=r.apply(void 0,ed([],Qp(n),!1));t(o?null:!1,i)})},e}(),og=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return om(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var t=r();n(t,i)})},e}(),m2=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,om(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return Jp(n,void 0,void 0,function(){return tv(this,function(o){switch(o.label){case 0:return[4,r.apply(void 0,ed([],Qp(this.args),!1))];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),g2=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,om(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return Jp(n,void 0,void 0,function(){var o;return tv(this,function(u){switch(u.label){case 0:return[4,r.apply(void 0,ed([],Qp(this.args),!1))];case 1:return o=u.sent(),t(o,i),[2]}})})})},e}(),y2=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return ag(this.tasks)},e.prototype.tapPromise=function(i,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(t){n(null,t)})}):this.tasks.push(function(n,t){r(n).then(function(o){t(null,o)})})},e}(),sg=z(67709),_2=z.n(sg),ug,lg,cg,fg,hg,pg,dg,vg,mg,gg,yg,_g,xg,bg,Sg,wg,Eg,Ag,qs,Cg,Tg,Mg,kg,Ig,Pg,Lg,Rg,Dg,Og,Fg,Bg,zg,Ng,Zg,Ug;function x2(e){var i=b2();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function b2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S2=(ug=(0,ut.b2)(),lg=(0,ut.f3)(et.SceneID),cg=(0,ut.f3)(et.IIconService),fg=(0,ut.f3)(et.IFontService),hg=(0,ut.f3)(et.IControlService),pg=(0,ut.f3)(et.IGlobalConfigService),dg=(0,ut.f3)(et.IMapService),vg=(0,ut.f3)(et.ICoordinateSystemService),mg=(0,ut.f3)(et.IRendererService),gg=(0,ut.f3)(et.ILayerService),yg=(0,ut.f3)(et.IDebugService),_g=(0,ut.f3)(et.ICameraService),xg=(0,ut.f3)(et.IInteractionService),bg=(0,ut.f3)(et.IPickingService),Sg=(0,ut.f3)(et.IShaderModuleService),wg=(0,ut.f3)(et.IMarkerService),Eg=(0,ut.f3)(et.IPopupService),ug(Ag=(qs=function(e){(0,lt.Z)(r,e);var i=x2(r);function r(){var n;return(0,be.Z)(this,r),n=i.call(this),(0,V.Z)((0,Ee.Z)(n),"destroyed",!1),(0,V.Z)((0,Ee.Z)(n),"loaded",!1),on((0,Ee.Z)(n),"id",Cg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"iconService",Tg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"fontService",Mg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"controlService",kg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"configService",Ig,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"map",Pg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"coordinateSystemService",Lg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"rendererService",Rg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"layerService",Dg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"debugService",Og,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"cameraService",Fg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"interactionService",Bg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"pickingService",zg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"shaderModuleService",Ng,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"markerService",Zg,(0,Ee.Z)(n)),on((0,Ee.Z)(n),"popupService",Ug,(0,Ee.Z)(n)),(0,V.Z)((0,Ee.Z)(n),"inited",!1),(0,V.Z)((0,Ee.Z)(n),"initPromise",void 0),(0,V.Z)((0,Ee.Z)(n),"rendering",!1),(0,V.Z)((0,Ee.Z)(n),"$container",void 0),(0,V.Z)((0,Ee.Z)(n),"canvas",void 0),(0,V.Z)((0,Ee.Z)(n),"markerContainer",void 0),(0,V.Z)((0,Ee.Z)(n),"hooks",void 0),(0,V.Z)((0,Ee.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),Wc(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,V.Z)((0,Ee.Z)(n),"handleMapCameraChanged",function(t){n.cameraService.update(t),n.render()}),n.hooks={init:new m2},n}return(0,J.Z)(r,[{key:"init",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,It.Z)(he().mark(function u(){return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o.debugService.log("map.mapInitStart",{type:o.map.version}),p.next=3,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),v()}),o.map.init()});case 3:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(Ho.Drag,o.addSceneEvent.bind(o));case 10:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,It.Z)(he().mark(function u(){var l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(p=((l=o.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,p?o.$container=p:o.$container=df(o.configService.getSceneConfig(o.id).id||""),!o.$container){S.next=13;break}return o.canvas=kn("canvas","",o.$container),o.setCanvas(),S.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),t.gl);case 7:o.registerContextLost(),o.initContainer(),_2()(o.$container,o.handleWindowResized),window.matchMedia&&((v=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||v===void 0||v.addListener(o.handleWindowResized)),S.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:o.pickingService.init(o.id);case 15:case"end":return S.stop()}},u)}))),this.render()}},{key:"registerContextLost",value:function(){var t=this,o=this.rendererService.getCanvas();o&&o.addEventListener("webglcontextlost",function(){return t.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,It.Z)(he().mark(function u(){return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),o.map.version!=="GAODE2.x"&&v()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(Ho.Drag,o.addSceneEvent.bind(o));case 5:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,It.Z)(he().mark(function u(){var l;return he().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(l=t.canvas,o.$container=l||null,!o.$container){v.next=7;break}return v.next=5,o.rendererService.init(t.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:v.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return v.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addFontFace",value:function(t,o){this.fontService.addFontFace(t,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,It.Z)(he().mark(function o(u){var l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return p=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],S.next=3,this.render();case 3:return v=u==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png"),S.abrupt("return",v);case 5:case"end":return S.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;t!==null&&(this.markerContainer=kn("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t=this,o,u;if(!this.inited){this.destroyed=!0;return}if((0,sg.unbind)(this.$container,this.handleWindowResized),window.matchMedia){var l;(l=window.matchMedia("screen and (min-resolution: 2dppx)"))===null||l===void 0||l.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var p;(p=t.$container)===null||p===void 0||p.removeChild(t.canvas),t.canvas=null,t.rendererService.destroy()}),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var t,o,u=qi,l=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v&&(v.width=l*u,v.height=p*u),this.rendererService.viewport({x:0,y:0,width:u*l,height:u*p})}},{key:"setCanvas",value:function(){var t,o,u=qi,l=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v.width=l*u,v.height=p*u,v.style.width="100%",v.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),r}(ya.EventEmitter),Cg=Kr(qs.prototype,"id",[lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tg=Kr(qs.prototype,"iconService",[cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mg=Kr(qs.prototype,"fontService",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kg=Kr(qs.prototype,"controlService",[hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ig=Kr(qs.prototype,"configService",[pg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pg=Kr(qs.prototype,"map",[dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lg=Kr(qs.prototype,"coordinateSystemService",[vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rg=Kr(qs.prototype,"rendererService",[mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dg=Kr(qs.prototype,"layerService",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Og=Kr(qs.prototype,"debugService",[yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fg=Kr(qs.prototype,"cameraService",[_g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bg=Kr(qs.prototype,"interactionService",[xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zg=Kr(qs.prototype,"pickingService",[bg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ng=Kr(qs.prototype,"shaderModuleService",[Sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zg=Kr(qs.prototype,"markerService",[wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ug=Kr(qs.prototype,"popupService",[Eg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qs))||Ag);function w2(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var E2=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function n0(e){var i={};return e=e.replace(E2,function(r,n,t){var o=t.split(":"),u=o[0].trim(),l="";switch(o.length>1&&(l=o[1].trim()),n){case"bool":l=l==="true";break;case"float":case"int":l=Number(l);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":l?l=l.replace("[","").replace("]","").split(",").reduce(function(p,v){return p.push(Number(v.trim())),p},[]):l=new Array(w2(n)).fill(0);break;default:}return i[u]=l,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:i}}var Vg,jg,A2=ii.uniq,Gg="#define PI 3.14159265359",C2=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,T2=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,M2=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,k2=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,I2=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,P2=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,L2=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;
uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}`,R2=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,D2=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,O2=/precision\s+(high|low|medium)p\s+float/,F2=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,B2=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,z2=/void\s+main\s*\([^)]*\)\s*\{\n?/,mR=/}\n?[^{}]*$/,N2=(Vg=(0,ut.b2)(),Vg(jg=function(){function e(){(0,be.Z)(this,e),(0,V.Z)(this,"moduleCache",{}),(0,V.Z)(this,"rawContentCache",{})}return(0,J.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Gg,fs:Gg}),this.registerModule("decode",{vs:C2,fs:""}),this.registerModule("projection",{vs:L2,fs:""}),this.registerModule("project",{vs:P2,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:D2}),this.registerModule("lighting",{vs:M2,fs:""}),this.registerModule("light",{vs:T2,fs:""}),this.registerModule("picking",{vs:I2,fs:k2}),this.registerModule("rotation_2d",{vs:R2,fs:""})}},{key:"registerModule",value:function(r,n){var t=n.vs,o=n.fs,u=n.uniforms,l=n.inject,p=n0(t),v=p.content,x=p.uniforms,S=n0(o),A=S.content,k=S.uniforms;this.rawContentCache[r]={fs:A,inject:l,uniforms:(0,O.Z)((0,O.Z)((0,O.Z)({},x),k),u),vs:v}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this,t=this.rawContentCache[r].vs,o=this.rawContentCache[r].fs,u=this.rawContentCache[r].inject,l={};u!=null&&u["vs:#decl"]&&(t=(u==null?void 0:u["vs:#decl"])+t,l=n0(u==null?void 0:u["vs:#decl"]).uniforms),u!=null&&u["vs:#main-start"]&&(t=t.replace(z2,function(N){return N+(u==null?void 0:u["vs:#main-start"])}));var p=this.processModule(t,[],"vs"),v=p.content,x=p.includeList,S=this.processModule(o,[],"fs"),A=S.content,k=S.includeList,D="",R=A2(x.concat(k).concat(r)).reduce(function(N,W){return(0,O.Z)((0,O.Z)({},N),n.rawContentCache[W].uniforms)},(0,O.Z)({},l));return O2.test(A)||(D=D+F2),D=D+A,this.moduleCache[r]={fs:D.trim(),uniforms:R,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,t){var o=this,u=r.replace(B2,function(l,p){var v=p.split(" "),x=v[0].replace(/"/g,"");if(n.indexOf(x)>-1)return"";var S=o.rawContentCache[x][t];n.push(x);var A=o.processModule(S,n,t),k=A.content;return k});return{content:u,includeList:n}}},{key:"injectDefines",value:function(r){var n=Object.keys(r).reduce(function(t,o){return t+"#define ".concat(o.toUpperCase()," ").concat(r[o],`;
`)},`
`);return n}}]),e}())||jg),ia=z(66213),rd=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),Hg,Wg,sm=(Hg=(0,ut.b2)(),Hg(Wg=function(){function e(){(0,be.Z)(this,e),(0,V.Z)(this,"shaderModuleService",void 0),(0,V.Z)(this,"rendererService",void 0),(0,V.Z)(this,"cameraService",void 0),(0,V.Z)(this,"mapService",void 0),(0,V.Z)(this,"interactionService",void 0),(0,V.Z)(this,"layerService",void 0),(0,V.Z)(this,"config",void 0)}return(0,J.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return rd.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(et.IRendererService),this.cameraService=r.getContainer().get(et.ICameraService),this.mapService=r.getContainer().get(et.IMapService),this.interactionService=r.getContainer().get(et.IInteractionService),this.layerService=r.getContainer().get(et.ILayerService),this.shaderModuleService=r.getContainer().get(et.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Wg),$g,Xg;function Z2(e){var i=U2();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function U2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V2=($g=(0,ut.b2)(),$g(Xg=function(e){(0,lt.Z)(r,e);var i=Z2(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,o){(0,ia.Z)((0,re.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(sm))||Xg),Yg,qg,Kg,i0,Jg;function j2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=G2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function G2(e,i){if(!!e){if(typeof e=="string")return Qg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qg(e,i)}}function Qg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var H2=(Yg=(0,ut.b2)(),qg=(0,ut.f3)(et.IPostProcessor),Yg(Kg=(i0=function(){function e(){(0,be.Z)(this,e),(0,V.Z)(this,"passes",[]),on(this,"postProcessor",Jg,this),(0,V.Z)(this,"layer",void 0),(0,V.Z)(this,"renderFlag",void 0),(0,V.Z)(this,"width",0),(0,V.Z)(this,"height",0)}return(0,J.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,It.Z)(he().mark(function n(){var t,o,u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=j2(this.passes),p.prev=1,t.s();case 3:if((o=t.n()).done){p.next=9;break}return u=o.value,p.next=7,u.render(this.layer);case 7:p.next=3;break;case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(1),t.e(p.t0);case 14:return p.prev=14,t.f(),p.finish(14);case 17:return p.next=19,this.postProcessor.render(this.layer);case 19:case"end":return p.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===rd.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,t){r.init(this.layer,n),this.passes.splice(t,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Jg=Kr(i0.prototype,"postProcessor",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i0))||Kg),ey,ty;function W2(e){var i=$2();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function $2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X2=(ey=(0,ut.b2)(),ey(ty=function(e){(0,lt.Z)(r,e);var i=W2(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"pickingFBO",void 0),(0,V.Z)((0,Ee.Z)(n),"layer",void 0),(0,V.Z)((0,Ee.Z)(n),"width",0),(0,V.Z)((0,Ee.Z)(n),"height",0),(0,V.Z)((0,Ee.Z)(n),"alreadyInRendering",!1),(0,V.Z)((0,Ee.Z)(n),"pickFromPickingFBO",function(l){var p=l.x,v=l.y,x=l.lngLat,S=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(S))){var A=n.rendererService,k=A.getViewportSize,D=A.readPixels,R=A.useFramebuffer,N=k(),W=N.width,me=N.height,ye=n.layer.getLayerConfig(),Ne=ye.enableHighlight,Ue=ye.enableSelect,tt=p*qi,Et=v*qi;if(!(tt>W||tt<0||Et>me||Et<0)){var Vt;R(n.pickingFBO,function(){var Yt;if(Vt=D({x:Math.round(tt),y:Math.round(me-(v+1)*qi),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Vt[0]!==0||Vt[1]!==0||Vt[2]!==0){var gr=ra(Vt),hr=n.layer.getSource().getFeatureById(gr),Hr={x:p,y:v,type:S,lngLat:x,featureId:gr,feature:hr};hr&&(n.layer.setCurrentPickId(gr),n.triggerHoverOnLayer(Hr))}else{var fn={x:p,y:v,lngLat:x,type:n.layer.getCurrentPickId()===null?"un"+S:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,O.Z)((0,O.Z)({},fn),{},{type:"unpick"})),n.triggerHoverOnLayer(fn),n.layer.setCurrentPickId(null)}Ne&&n.highlightPickedFeature(Vt),Ue&&S==="click"&&((Yt=Vt)===null||Yt===void 0?void 0:Yt.toString())!==[0,0,0,0].toString()&&n.selectFeature(Vt)})}}}),n}return(0,J.Z)(r,[{key:"getType",value:function(){return rd.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,o){(0,ia.Z)((0,re.Z)(r.prototype),"init",this).call(this,t,o),this.layer=t;var u=this.rendererService,l=u.createTexture2D,p=u.createFramebuffer,v=u.getViewportSize,x=v(),S=x.width,A=x.height;this.pickingFBO=p({color:l({width:S,height:A,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.interactionService.on(Ho.Hover,this.pickFromPickingFBO),this.interactionService.on(Ho.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Ho.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,l=u.getViewportSize,p=u.useFramebuffer,v=u.clear,x=l(),S=x.width,A=x.height;this.alreadyInRendering=!0,(this.width!==S||this.height!==A)&&(this.pickingFBO.resize({width:S,height:A}),this.width=S,this.height=A),p(this.pickingFBO,function(){v({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var k=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(k),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var o=(0,K.Z)(t,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeHighlight.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var o=(0,K.Z)(t,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeSelect.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var o=t.featureId,u=Ea(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(t){var o=t.featureId,u=Ea(o);this.highlightPickedFeature(new Uint8Array(u))}}]),r}(sm))||ty),ry,ny,iy,a0,ay,Y2=ii.camelCase,q2=ii.isNil,K2=ii.upperFirst,J2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Kf=(ry=(0,ut.b2)(),ny=(0,ut.f3)(et.IShaderModuleService),ry(iy=(a0=function(){function e(){(0,be.Z)(this,e),on(this,"shaderModuleService",ay,this),(0,V.Z)(this,"rendererService",void 0),(0,V.Z)(this,"config",void 0),(0,V.Z)(this,"quad",J2),(0,V.Z)(this,"enabled",!0),(0,V.Z)(this,"renderToScreen",!1),(0,V.Z)(this,"model",void 0),(0,V.Z)(this,"name",void 0),(0,V.Z)(this,"optionsToUpdate",{})}return(0,J.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return rd.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(et.IRendererService),this.shaderModuleService=r.getContainer().get(et.IShaderModuleService);var t=this.rendererService,o=t.createAttribute,u=t.createBuffer,l=t.createModel,p=this.setupShaders(),v=p.vs,x=p.fs,S=p.uniforms;this.model=l({vs:v,fs:x,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:q.FLOAT}),size:2})},uniforms:(0,O.Z)((0,O.Z)({u_Texture:null},S),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var t=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,l=u.useFramebuffer,p=u.getViewportSize,v=u.clear,x=p(),S=x.width,A=x.height;l(this.renderToScreen?null:o.getWriteFBO(),function(){v({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var k=(0,O.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[S,A]},t.convertOptionsToUniforms(t.optionsToUpdate));n&&(k.u_BloomFinal=1,k.u_Texture2=n),t.model.draw({uniforms:k})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=(0,O.Z)((0,O.Z)({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(t){q2(r[t])||(n["u_".concat(K2(Y2(t)))]=r[t])}),n}}]),e}(),ay=Kr(a0.prototype,"shaderModuleService",[ny],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a0))||iy),oy,sy;function Q2(e){var i=eS();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function eS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tS=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,rS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,o0=ii.isNil,nS=(oy=(0,ut.b2)(),oy(sy=function(e){(0,lt.Z)(r,e);var i=Q2(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:rS,fs:tS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return o0(t.bloomRadius)||(o.u_radius=t.bloomRadius),o0(t.bloomIntensity)||(o.u_intensity=t.bloomIntensity),o0(t.bloomBaseRadio)||(o.u_baseRadio=t.bloomBaseRadio),o}}]),r}(Kf))||sy),uy,ly;function iS(e){var i=aS();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function aS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,sS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,uS=ii.isNil,lS=(uy=(0,ut.b2)(),uy(ly=function(e){(0,lt.Z)(r,e);var i=iS(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:sS,fs:oS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return uS(t.blurRadius)||(o.u_BlurDir=[t.blurRadius,0]),o}}]),r}(Kf))||ly),cy,fy;function cS(e){var i=fS();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function fS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,pS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,dS=ii.isNil,vS=(cy=(0,ut.b2)(),cy(fy=function(e){(0,lt.Z)(r,e);var i=cS(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:pS,fs:hS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return dS(t.blurRadius)||(o.u_BlurDir=[0,t.blurRadius]),o}}]),r}(Kf))||fy),hy,py;function mS(e){var i=gS();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function gS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,_S=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xS=(hy=(0,ut.b2)(),hy(py=function(e){(0,lt.Z)(r,e);var i=mS(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:_S,fs:yS});var t=this.shaderModuleService.getModule("colorhalftone-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(Kf))||py),dy,vy;function bS(e){var i=SS();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function SS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,ES=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,AS=(dy=(0,ut.b2)(),dy(vy=function(e){(0,lt.Z)(r,e);var i=bS(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:ES,fs:wS}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Kf))||vy),gy,yy;function CS(e){var i=TS();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function TS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,kS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,IS=(gy=(0,ut.b2)(),gy(yy=function(e){(0,lt.Z)(r,e);var i=CS(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:kS,fs:MS});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(Kf))||yy),_y,xy;function PS(e){var i=LS();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function LS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,DS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,OS=(_y=(0,ut.b2)(),_y(xy=function(e){(0,lt.Z)(r,e);var i=PS(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:DS,fs:RS});var t=this.shaderModuleService.getModule("ink-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(Kf))||xy),by,Sy;function FS(e){var i=BS();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function BS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,NS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ZS=(by=(0,ut.b2)(),by(Sy=function(e){(0,lt.Z)(r,e);var i=FS(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:NS,fs:zS}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Kf))||Sy),wy,Ey;function US(e){var i=VS();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function VS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,GS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,HS=(wy=(0,ut.b2)(),wy(Ey=function(e){(0,lt.Z)(r,e);var i=US(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:jS,fs:GS}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Kf))||Ey),Ay,Cy,Ty,My,nd,ky,WS=(Ay=(0,ut.b2)(),Cy=(0,ut.f3)(et.IRendererService),Ty=(0,ut.zY)(),Ay(My=(nd=function(){function e(){(0,be.Z)(this,e),on(this,"rendererService",ky,this),(0,V.Z)(this,"passes",[]),(0,V.Z)(this,"readFBO",void 0),(0,V.Z)(this,"writeFBO",void 0)}return(0,J.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,t=r.createTexture2D,o=n(),u=o.width,l=o.height;return t({x:0,y:0,width:u,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(t){n(r.readFBO,(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:t(r.getCurrentFBOTex());case 1:case"end":return l.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var i=(0,It.Z)(he().mark(function n(t,o){var u,l;return he().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.getReadFBOTex();case 2:u=v.sent,l=0;case 4:if(!(l<4)){v.next=11;break}return v.next=7,o.render(t,u);case 7:this.swap(),l++,v.next=4;break;case 11:case"end":return v.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,It.Z)(he().mark(function n(t){var o,u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:o=0;case 1:if(!(o<this.passes.length)){p.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){p.next=9;break}return p.next=7,this.renderBloomPass(t,u);case 7:p.next=12;break;case 9:return p.next=11,u.render(t);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,p.next=1;break;case 15:case"end":return p.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,t){r.init(n,t),this.passes.push(r)}},{key:"insert",value:function(r,n,t,o){r.init(t,o),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,t=r.createTexture2D;this.readFBO=n({color:t({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.writeFBO=n({color:t({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),ky=Kr(nd.prototype,"rendererService",[Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kr(nd.prototype,"init",[Ty],Object.getOwnPropertyDescriptor(nd.prototype,"init"),nd.prototype),nd))||My),Iy,Py;function $S(e){var i=XS();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function XS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YS=(Iy=(0,ut.b2)(),Iy(Py=function(e){(0,lt.Z)(r,e);var i=$S(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getType",value:function(){return rd.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,o){(0,ia.Z)((0,re.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(t){var o=this.rendererService,u=o.useFramebuffer,l=o.clear,p=t.multiPassRenderer.getPostProcessor().getReadFBO();u(p,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:p}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(function(v){v.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}]),r}(sm))||Py),Ly,Ry,Dy,s0,Oy;function qS(e){var i=KS();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function KS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JS=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Fy=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,QS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function By(e,i){for(var r=0,n=1/i,t=e;t>0;)r=r+n*(t%i),t=Math.floor(t/i),n=n/i;return r}var ew=1,tw=(Ly=(0,ut.b2)(),Ry=(0,ut.f3)(et.IShaderModuleService),Ly(Dy=(s0=function(e){(0,lt.Z)(r,e);var i=qS(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),on((0,Ee.Z)(n),"shaderModuleService",Oy,(0,Ee.Z)(n)),(0,V.Z)((0,Ee.Z)(n),"haltonSequence",[]),(0,V.Z)((0,Ee.Z)(n),"accumulatingId",0),(0,V.Z)((0,Ee.Z)(n),"frame",0),(0,V.Z)((0,Ee.Z)(n),"timer",void 0),(0,V.Z)((0,Ee.Z)(n),"sampleRenderTarget",void 0),(0,V.Z)((0,Ee.Z)(n),"prevRenderTarget",void 0),(0,V.Z)((0,Ee.Z)(n),"outputRenderTarget",void 0),(0,V.Z)((0,Ee.Z)(n),"copyRenderTarget",void 0),(0,V.Z)((0,Ee.Z)(n),"blendModel",void 0),(0,V.Z)((0,Ee.Z)(n),"outputModel",void 0),(0,V.Z)((0,Ee.Z)(n),"copyModel",void 0),n}return(0,J.Z)(r,[{key:"getType",value:function(){return rd.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,o){(0,ia.Z)((0,re.Z)(r.prototype),"init",this).call(this,t,o);var u=this.rendererService,l=u.createFramebuffer,p=u.createTexture2D;this.sampleRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})});for(var v=0;v<30;v++)this.haltonSequence.push([By(v,2),By(v,3)]);this.blendModel=this.createTriangleModel("blend-pass",JS),this.outputModel=this.createTriangleModel("copy-pass",Fy,{blend:{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE_MINUS_SRC_ALPHA,srcAlpha:q.ONE,dstAlpha:q.ONE_MINUS_SRC_ALPHA},equation:{rgb:q.FUNC_ADD,alpha:q.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Fy)}},{key:"render",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),S=x.width,A=x.height;this.sampleRenderTarget.resize({width:S,height:A}),this.prevRenderTarget.resize({width:S,height:A}),this.outputRenderTarget.resize({width:S,height:A}),this.copyRenderTarget.resize({width:S,height:A}),this.resetFrame(),this.stopAccumulating();var k=t.multiPassRenderer.getPostProcessor().getReadFBO();v(k,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:k}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)});var D=function R(N){!o.accumulatingId||N!==o.accumulatingId||o.isFinished()||(o.doRender(t),window.requestAnimationFrame(function(){R(N)}))};this.accumulatingId=ew++,this.timer=window.setTimeout(function(){D(o.accumulatingId)},50)}},{key:"doRender",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),S=x.width,A=x.height,k=t.getLayerConfig(),D=k.jitterScale,R=D===void 0?1:D,N=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((N[0]*2-1)/S*R,(N[1]*2-1)/A*R),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),v(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),t.render()}),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var W=t.getLayerConfig();v(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:W.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?t.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(v(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),v(t.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),t.multiPassRenderer.getPostProcessor().render(t));var me=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=me,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,o,u){this.shaderModuleService.registerModule(t,{vs:QS,fs:o});var l=this.shaderModuleService.getModule(t),p=l.vs,v=l.fs,x=l.uniforms,S=this.rendererService,A=S.createAttribute,k=S.createBuffer,D=S.createModel;return D((0,O.Z)({vs:p,fs:v,attributes:{a_Position:A({buffer:k({data:[-4,-4,4,-4,0,4],type:q.FLOAT}),size:2})},uniforms:(0,O.Z)({},x),depth:{enable:!1},count:3},u))}}]),r}(sm),Oy=Kr(s0.prototype,"shaderModuleService",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s0))||Dy),uv=new ut.W2;uv.bind(et.IGlobalConfigService).to(En).inSingletonScope(),(0,ut.GW)((0,ut.b2)(),ya.EventEmitter),uv.bind(et.IEventEmitter).to(ya.EventEmitter);var zy=(0,fr.Z)(uv,!1),u0=function(i){var r=zy.lazyInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},gR=function(i){var r=zy.lazyMultiInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},ol=uv,rw=0;function nw(){var e=new ut.W2;return e.parent=uv,e.bind(et.SceneID).toConstantValue("".concat(rw++)),e.bind(et.IShaderModuleService).to(N2).inSingletonScope(),e.bind(et.ILayerService).to(Yd).inSingletonScope(),e.bind(et.IDebugService).to(lp).inSingletonScope(),e.bind(et.ISceneService).to(S2).inSingletonScope(),e.bind(et.ICameraService).to(b).inSingletonScope(),e.bind(et.ICoordinateSystemService).to(sp).inSingletonScope(),e.bind(et.IInteractionService).to(Ml).inSingletonScope(),e.bind(et.IPickingService).to(qv).inSingletonScope(),e.bind(et.IControlService).to(ue).inSingletonScope(),e.bind(et.IMarkerService).to(Je).inSingletonScope(),e.bind(et.IIconService).to(We).inSingletonScope(),e.bind(et.IFontService).to(de).inSingletonScope(),e.bind(et.IPopupService).to(Lt).inSingletonScope(),e.bind(et.INormalPass).to(V2).whenTargetNamed("clear"),e.bind(et.INormalPass).to(X2).whenTargetNamed("pixelPicking"),e.bind(et.INormalPass).to(YS).whenTargetNamed("render"),e.bind(et.INormalPass).to(tw).whenTargetNamed("taa"),e.bind(et.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(et.INormalPass,r)}}),e.bind(et.IPostProcessingPass).to(AS).whenTargetNamed("copy"),e.bind(et.IPostProcessingPass).to(nS).whenTargetNamed("bloom"),e.bind(et.IPostProcessingPass).to(lS).whenTargetNamed("blurH"),e.bind(et.IPostProcessingPass).to(vS).whenTargetNamed("blurV"),e.bind(et.IPostProcessingPass).to(ZS).whenTargetNamed("noise"),e.bind(et.IPostProcessingPass).to(HS).whenTargetNamed("sepia"),e.bind(et.IPostProcessingPass).to(xS).whenTargetNamed("colorHalftone"),e.bind(et.IPostProcessingPass).to(IS).whenTargetNamed("hexagonalPixelate"),e.bind(et.IPostProcessingPass).to(OS).whenTargetNamed("ink"),e.bind(et.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(et.IPostProcessingPass,r);return n.setName(r),n}}),e}function lv(e){var i=new ut.W2;return i.parent=e,i.bind(et.IStyleAttributeService).to(Kp).inSingletonScope(),i.bind(et.IMultiPassRenderer).to(H2).inSingletonScope(),i.bind(et.IPostProcessor).to(WS).inSingletonScope(),i}var iw=null;function yR(e){return iw.indexOf(e)}var Ny=ii.clamp,aw=2,_R=4,ow=64,xR=128,sw=256,uw=512,bR=8192,SR=16384,wR=32768,lw=null,Zy=131072,ER=262144,cw=524288,AR=1048576,fw=2097152,CR=4194304,hw=8388608,pw=16777216,dw=null;function um(e,i){return e=Ny(Math.floor(e),0,255),i=Ny(Math.floor(i),0,255),256*e+i}function TR(e){var i=e.color,r=e.radius,n=e.tileX,t=e.tileY,o=e.shape,u=e.opacity,l=e.stroke,p=e.strokeWidth,v=e.strokeOpacity,x=[],S=[],A=[],k=[um(i[0],i[1]),um(i[2],i[3])],D=[um(l[0],l[1]),um(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(R){var N=_slicedToArray(R,2),W=N[0],me=N[1];x.push([].concat(k,[(W+1)*hw+(me+1)*fw+getShapeIndex(o)*Zy+r,(n+512)*cw+(t+512)*ow])),S.push([].concat(D,[p,v])),A.push([u,0,0,0])}),{packedBuffer:x,packedBuffer2:S,packedBuffer3:A}}function MR(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*dw+r*pw+n*Zy+r*lw+n*uw+r*sw+n*aw+r}var _p={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},ns={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},ka=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),id=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),un=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),vw=["mapload","mapchange","mapAfterFrameChange"],lm=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],iu=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),mw=function(){var e=(0,It.Z)(he().mark(function i(r,n,t,o){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p,v){n({x:r.x,y:r.y,z:r.z},function(x,S){if(x||S.length===0){v(x);return}S&&Br([{data:S,bands:[0]}],t,o,function(A,k){A?v(A):k&&p(k)})})}));case 1:case"end":return l.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}(),gw=function(){var e=(0,It.Z)(he().mark(function i(r,n){return he().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(u,l){n({x:r.x,y:r.y,z:r.z},function(p,v){if(p||!v){l(p);return}v instanceof ArrayBuffer?Ki(v,function(x,S){x&&l(x),u(S)}):v instanceof HTMLImageElement?u(v):l(p)})}));case 1:case"end":return o.stop()}},i)}));return function(r,n){return e.apply(this,arguments)}}();function yw(e,i){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(r){return d(r,i)}):e.map(function(r){return{url:d(r.url,i),bands:r.bands||[0]}}):d(e,i)}function _w(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(i){return{url:i,bands:[0]}}):e}function Uy(e,i){e.xhrCancel=function(){i.map(function(r){r.abort()})}}var xw=function(){var e=(0,It.Z)(he().mark(function i(r,n,t,o,u){var l,p,v,x,S,A;return he().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(l=_w(n.url),!(l.length>1)){D.next=15;break}return D.next=4,bw(l,n);case 4:if(p=D.sent,v=p.rasterFiles,x=p.xhrList,S=p.errList,Uy(r,x),!(S.length>0)){D.next=12;break}return t(S,null),D.abrupt("return");case 12:Br(v,o,u,t),D.next=17;break;case 15:A=ao(n,function(R,N){if(R)t(R);else if(N){var W=[{data:N,bands:l[0].bands}];Br(W,o,u,t)}}),Uy(r,[A]);case 17:case"end":return D.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function bw(e,i){return l0.apply(this,arguments)}function l0(){return l0=(0,It.Z)(he().mark(function e(i,r){var n,t,o,u,l,p,v,x,S,A,k;return he().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:n=[],t=[],o=[],u=0;case 4:if(!(u<i.length)){R.next=20;break}return l=i[u],p=(0,O.Z)((0,O.Z)({},r),{},{url:l.url}),v=l.bands,R.next=10,ci((0,O.Z)((0,O.Z)({},p),{},{type:"arrayBuffer"}));case 10:x=R.sent,S=x.err,A=x.data,k=x.xhr,S&&o.push(S),t.push(k),n.push({data:A,bands:v});case 17:u++,R.next=4;break;case 20:return R.abrupt("return",{rasterFiles:n,xhrList:t,errList:o});case 21:case"end":return R.stop()}},e)})),l0.apply(this,arguments)}var Sw=function(){var e=(0,It.Z)(he().mark(function i(r,n,t,o,u){var l;return he().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l={url:yw(r,n)},v.abrupt("return",new Promise(function(x,S){xw(t,l,function(A,k){A?S(A):k&&x(k)},o,u)}));case 2:case"end":return v.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}(),Vy=function(){var e=(0,It.Z)(he().mark(function i(r,n,t,o){var u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return l=Array.isArray(r)?r[0]:r,o.wmtsOptions?(p=(o==null?void 0:o.getURLFromTemplate)||h,u=p(l,(0,O.Z)((0,O.Z)({},n),o.wmtsOptions))):(v=(o==null?void 0:o.getURLFromTemplate)||d,u=v(l,n)),S.abrupt("return",new Promise(function(A,k){var D,R=ms({url:u,type:(o==null||(D=o.requestParameters)===null||D===void 0?void 0:D.type)||"arrayBuffer"},function(N,W){N?k(N):W&&A(W)},o.transformResponse);t.xhrCancel=function(){return R.cancel()}}));case 3:case"end":return S.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}(),jy=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},ww={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},kR=[iu.ARRAYBUFFER,iu.RGB];function Ew(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function Aw(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ew(e))throw new Error("tile server url is error");var r=(i==null?void 0:i.dataType)||iu.IMAGE;r===iu.RGB&&(r=iu.ARRAYBUFFER);var n=function(u,l){switch(r){case iu.IMAGE:return Vy(e,u,l,i);case iu.CUSTOMIMAGE:case iu.CUSTOMTERRAINRGB:return gw(l,i==null?void 0:i.getCustomData);case iu.ARRAYBUFFER:return Sw(e,u,l,(i==null?void 0:i.format)||jy,i==null?void 0:i.operation);case iu.CUSTOMARRAYBUFFER:case iu.CUSTOMRGB:return mw(l,i==null?void 0:i.getCustomData,(i==null?void 0:i.format)||jy,i==null?void 0:i.operation);default:return Vy(e,u,l,i)}},t=(0,O.Z)((0,O.Z)((0,O.Z)({},ww),i),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:t,isTile:!0}}var Cw=["extent","min","max","width","height","format","operation"];function Tw(e,i){var r=i.extent,n=i.min,t=i.max,o=i.width,u=i.height,l=i.format,p=i.operation,v=(0,rs.Z)(i,Cw),x;if(l===void 0||of(e))x=Array.from(e);else{var S=Array.isArray(e)?e:[e];x=rn(S,l,p)}var A={_id:1,dataArray:[(0,O.Z)((0,O.Z)({_id:1,data:x,width:o,height:u},v),{},{min:n,max:t,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return A}var Mw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},kw=function(){var e=(0,It.Z)(he().mark(function i(r){return he().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(o){var u=(0,K.Z)(r.bounds,4),l=u[0],p=u[1],v=u[2],x=u[3],S={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,x:(l+v)/2,y:(p+x)/2},geometry:{type:"LineString",coordinates:[[v,x],[v,p],[l,p],[l,p]]}}]}}};o(S)}));case 1:case"end":return t.stop()}},i)}));return function(r){return e.apply(this,arguments)}}();function Iw(e,i){var r=function(o){return kw(o)},n=(0,O.Z)((0,O.Z)((0,O.Z)({},Mw),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var Pw=z(69848),Gy=z.n(Pw);function Hy(e,i){var r=i.radius,n=r===void 0?40:r,t=i.maxZoom,o=t===void 0?18:t,u=i.minZoom,l=u===void 0?0:u,p=i.zoom,v=p===void 0?2:p;if(e.pointIndex){var x=e.pointIndex.getClusters(e.extent,Math.floor(v));return e.dataArray=Lw(x),e}var S=new(Gy())({radius:n,minZoom:l,maxZoom:o}),A={type:"FeatureCollection",features:[]};return A.features=e.dataArray.map(function(k){return{type:"Feature",geometry:{type:"Point",coordinates:k.coordinates},properties:(0,O.Z)({},k)}}),S.load(A.features),S}function Lw(e){return e.map(function(i,r){return(0,O.Z)({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Rw(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Dw(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Wy(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,t=1;t<e.length;t++)n=i+e[t]*1,Math.abs(i)>=Math.abs(e[t])?r+=i-n+e[t]:r+=e[t]-n+i,i=n;return i+r*1}function Ow(e){if(e.length===0)throw new Error("mean requires at least one data point");return Wy(e)/e.length}var Fw={min:Dw,max:Rw,mean:Ow,sum:Wy};function Bw(e){var i=zw();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function zw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nw=ii.cloneDeep,$y=ii.isFunction,Zw=ii.isString,Uw=ii.mergeWith;function Vw(e,i){if(Array.isArray(i))return i}var jw=function(e){(0,lt.Z)(r,e);var i=Bw(r);function r(n,t){var o;return(0,be.Z)(this,r),o=i.call(this),(0,V.Z)((0,Ee.Z)(o),"type","source"),(0,V.Z)((0,Ee.Z)(o),"isTile",!1),(0,V.Z)((0,Ee.Z)(o),"inited",!1),(0,V.Z)((0,Ee.Z)(o),"hooks",{init:new gf}),(0,V.Z)((0,Ee.Z)(o),"parser",{type:"geojson"}),(0,V.Z)((0,Ee.Z)(o),"transforms",[]),(0,V.Z)((0,Ee.Z)(o),"cluster",!1),(0,V.Z)((0,Ee.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,V.Z)((0,Ee.Z)(o),"invalidExtent",!1),(0,V.Z)((0,Ee.Z)(o),"dataArrayChanged",!1),(0,V.Z)((0,Ee.Z)(o),"cfg",{autoRender:!0}),o.originData=n,o.initCfg(t),o.init().then(function(){o.inited=!0,o.emit("update",{type:"inited"})}),o}return(0,J.Z)(r,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var o=this,u=this.clusterOptions,l=u.method,p=l===void 0?"sum":l,v=u.field,x=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,x.forEach(function(S){S.id||(S.properties.point_count=1)}),(v||$y(p))&&(x=x.map(function(S){var A=S.id;if(A){var k=o.clusterIndex.getLeaves(A,Infinity),D=k.map(function(W){return W.properties}),R;if(Zw(p)&&v){var N=ec(D,v);R=Fw[p](N)}$y(p)&&(R=p(D)),S.properties.stat=R}else S.properties.point_count=1;return S})),this.data=ae("geojson")({type:"FeatureCollection",features:x}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var o=this.parser,u=o.type,l=u===void 0?"geojson":u,p=o.geometry;if(l==="geojson"&&!this.cluster){var v=t<this.originData.features.length?this.originData.features[t]:"null",x=Nw(v);if(x!=null&&x.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var S=this.data.dataArray.find(function(A){return A._id===t});x.properties=S}return x}else return l==="json"&&p?this.data.dataArray.find(function(A){return A._id===t}):t<this.data.dataArray.length?this.data.dataArray[t]:"null"}},{key:"updateFeaturePropertiesById",value:function(t,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===t?(0,O.Z)((0,O.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(t,o){var u=this.data.dataArray.find(function(l){return l[t]===o});return u==null?void 0:u._id}},{key:"setData",value:function(t,o){var u=this;this.originData=t,this.dataArrayChanged=!1,this.initCfg(o),this.init().then(function(){u.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var t;(t=this.tileset)===null||t===void 0||t.reloadAll()}},{key:"reloadTilebyId",value:function(t,o,u){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(t,o,u)}},{key:"reloadTileByLnglat",value:function(t,o,u){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(t,o,u)}},{key:"getTileExtent",value:function(t,o){var u;return(u=this.tileset)===null||u===void 0?void 0:u.getTileExtent(t,o)}},{key:"getTileByZXY",value:function(t,o,u){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(t,o,u)}},{key:"reloadTileByExtent",value:function(t,o){var u;(u=this.tileset)===null||u===void 0||u.reloadTileByExtent(t,o)}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(t=this.tileset)===null||t===void 0||t.destroy()}},{key:"processData",value:function(){var n=(0,It.Z)(he().mark(function o(){var u=this;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",new Promise(function(v,x){try{u.excuteParser(),u.initCluster(),u.executeTrans(),v({})}catch(S){x(S)}}));case 1:case"end":return p.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"initCfg",value:function(t){this.cfg=Uw(this.cfg,t,Vw);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,O.Z)((0,O.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"excuteParser",value:function(){var t=this.parser,o=t.type||"geojson",u=ae(o);this.data=u(this.originData,t),this.tileset=this.initTileset(),!t.cancelExtent&&(this.extent=Hl(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(!!t){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(t),this.tileset;var o=new If((0,O.Z)({},t));return o}}},{key:"executeTrans",value:function(){var t=this,o=this.transforms;o.forEach(function(u){var l=u.type,p=oe(l)(t.data,u);Object.assign(t.data,p)})}},{key:"initCluster",value:function(){if(!!this.cluster){var t=this.clusterOptions||{};this.clusterIndex=Hy(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=_s(Wu(this.extent),t)),o[0].concat(o[1])}}]),r}(ya.EventEmitter);function Gw(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Xy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Hw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Hw(e,i){if(!!e){if(typeof e=="string")return Yy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yy(e,i)}}function Yy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var c0=6378e3;function Ww(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=t/(2*Math.PI*c0)*(256<<20)/2,u=$w(r,t),l=u.gridHash,p=u.gridOffset,v=Kw(l,p,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:v}}function $w(e,i){var r=Infinity,n=-Infinity,t,o=Xy(e),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;t=l.coordinates[1],Number.isFinite(t)&&(r=t<r?t:r,n=t>n?t:n)}}catch(ye){o.e(ye)}finally{o.f()}var p=(r+n)/2,v=Xw(i,p);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var x={},S=Xy(e),A;try{for(S.s();!(A=S.n()).done;){var k=A.value,D=k.coordinates[1],R=k.coordinates[0];if(Number.isFinite(D)&&Number.isFinite(R)){var N=Math.floor((D+90)/v.yOffset),W=Math.floor((R+180)/v.xOffset),me="".concat(N,"-").concat(W);x[me]=x[me]||{count:0,points:[]},x[me].count+=1,x[me].points.push(k)}}}catch(ye){S.e(ye)}finally{S.f()}return{gridHash:x,gridOffset:v}}function Xw(e,i){var r=Yw(e),n=qw(i,e);return{yOffset:r,xOffset:n}}function Yw(e){return e/c0*(180/Math.PI)}function qw(e,i){return i/c0*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Kw(e,i,r){return Object.keys(e).reduce(function(n,t,o){var u=t.split("-"),l=parseInt(u[0],10),p=parseInt(u[1],10),v={};if(r.field&&r.method){var x=Xl(e[t].points,r.field);v[r.method]=bc[r.method](x)}return Object.assign(v,{_id:o,coordinates:Da([-180+i.xOffset*(p+.5),-90+i.yOffset*(l+.5)]),rawData:e[t].points,count:e[t].count}),n.push(v),n},[])}var ad=Math.PI/3,Jw=[0,ad,2*ad,3*ad,4*ad,5*ad];function Qw(e){return e[0]}function e3(e){return e[1]}function t3(){var e=0,i=0,r=1,n=1,t=Qw,o=e3,u,l,p;function v(S){var A={},k=[],D,R=S.length;for(D=0;D<R;++D)if(!(isNaN(W=+t.call(null,N=S[D],D,S))||isNaN(me=+o.call(null,N,D,S)))){var N,W,me,ye=Math.round(me=me/p),Ne=Math.round(W=W/l-(ye&1)/2),Ue=me-ye;if(Math.abs(Ue)*3>1){var tt=W-Ne,Et=Ne+(W<Ne?-1:1)/2,Vt=ye+(me<ye?-1:1),Yt=W-Et,gr=me-Vt;tt*tt+Ue*Ue>Yt*Yt+gr*gr&&(Ne=Et+(ye&1?1:-1)/2,ye=Vt)}var hr=Ne+"-"+ye,Hr=A[hr];Hr?Hr.push(N):(k.push(Hr=A[hr]=[N]),Hr.x=(Ne+(ye&1)/2)*l,Hr.y=ye*p)}return k}function x(S){var A=0,k=0;return Jw.map(function(D){var R=Math.sin(D)*S,N=-Math.cos(D)*S,W=R-A,me=N-k;return A=R,k=N,[W,me]})}return v.hexagon=function(S){return"m"+x(S==null?u:+S).join("l")+"z"},v.centers=function(){for(var S=[],A=Math.round(i/p),k=Math.round(e/l),D=A*p;D<n+u;D+=p,++A)for(var R=k*l+(A&1)*l/2;R<r+l/2;R+=l)S.push([R,D]);return S},v.mesh=function(){var S=x(u).slice(0,4).join("l");return v.centers().map(function(A){return"M"+A+"m"+S}).join("")},v.x=function(S){return arguments.length?(t=S,v):t},v.y=function(S){return arguments.length?(o=S,v):o},v.radius=function(S){return arguments.length?(u=+S,l=u*2*Math.sin(ad),p=u*1.5,v):u},v.size=function(S){return arguments.length?(e=i=0,r=+S[0],n=+S[1],v):[r-e,n-i]},v.extent=function(S){return arguments.length?(e=+S[0][0],i=+S[0][1],r=+S[1][0],n=+S[1][1],v):[[e,i],[r,n]]},v.radius(1)}var r3=6378e3;function n3(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=i.method,u=o===void 0?"sum":o,l=t/(2*Math.PI*r3)*(256<<20)/2,p=r.map(function(A){var k=Da(A.coordinates),D=(0,K.Z)(k,2),R=D[0],N=D[1];return(0,O.Z)((0,O.Z)({},A),{},{coordinates:[R,N]})}),v=t3().radius(l).x(function(A){return A.coordinates[0]}).y(function(A){return A.coordinates[1]}),x=v(p),S={dataArray:x.map(function(A,k){var D;if(i.field&&u){var R=Xl(A,i.field);A[u]=bc[u](R)}return D={},(0,V.Z)(D,i.method,A[u]),(0,V.Z)(D,"count",A.length),(0,V.Z)(D,"rawData",A),(0,V.Z)(D,"coordinates",[A.x,A.y]),(0,V.Z)(D,"_id",k),D}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return S}function i3(e,i){var r=i.sourceField,n=i.targetField,t=i.data,o={};return t.forEach(function(u){o[u[r]]=u}),e.dataArray=e.dataArray.map(function(u){var l=u[n];return(0,O.Z)((0,O.Z)({},u),o[l])}),e}function a3(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Ge("rasterTile",Aw),Ge("mvt",Nr),Ge("geojsonvt",B),Ge("testTile",Iw),Ge("geojson",gu),Ge("jsonTile",or),Ge("image",Se),Ge("csv",kc),Ge("json",sf),Ge("raster",zn),Ge("rasterRgb",Tw),je("cluster",Hy),je("filter",Gw),je("join",i3),je("map",a3),je("grid",Ww),je("hexagon",n3);var f0=jw;function o3(e){var i=s3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function s3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qy=function(e){(0,lt.Z)(r,e);var i=o3(r);function r(n){var t;return(0,be.Z)(this,r),t=i.call(this),(0,V.Z)((0,Ee.Z)(t),"added",!1),(0,V.Z)((0,Ee.Z)(t),"eventHandle",function(o){t.polyfillEvent(o),t.emit(o.type,{target:o,data:t.markerOption.extData,lngLat:t.lngLat})}),t.markerOption=(0,O.Z)((0,O.Z)({},t.getDefault()),n),dc(["update","onMove","onMapClick"],(0,Ee.Z)(t)),t.init(),t}return(0,J.Z)(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:ha.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(et.IMapService),this.sceneSerive=t.get(et.ISceneService);var o=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&gs(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var o=this;if(!this.added)return this.once("added",function(){o.setElement(t)}),this;var u=this.markerOption.element;return u&&gs(u),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",function(){t.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",function(){t.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.anchor;this.updatePosition(),Mo(o,"".concat(Su[u]))}}},{key:"onMapClick",value:function(t){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.offsets,l=this.lngLat,p=l.lng,v=l.lat,x=this.mapsService.lngLatToContainer([p,v]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var S=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=S.containerHeight,k=S.containerWidth,D=S.bounds;if(!D)return;if(Math.abs(D[0][0])>180||Math.abs(D[1][0])>180){if(x.x>k){var R=this.mapsService.lngLatToContainer([p-360,v]);x.x=R.x}if(x.x<0){var N=this.mapsService.lngLatToContainer([p+360,v]);x.x=N.x}}(x.x>k||x.x<0||x.y>A||x.y<0)&&(o.style.display="none"),o.style.left=x.x+u[0]+"px",o.style.top=x.y-u[1]+"px"}}}},{key:"init",value:function(){var t=this,o=this.markerOption.element,u=this.markerOption,l=u.color,p=u.anchor;if(!o){this.defaultMarker=!0,o=kn("div"),this.markerOption.element=o;var v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height","48px"),v.setAttributeNS(null,"width","48px"),v.setAttributeNS(null,"viewBox","0 0 1024 1024");var x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),x.setAttributeNS(null,"fill",l),v.appendChild(x),o.appendChild(v)}Ko(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(S){var A,k,D=((A=t.markerOption)===null||A===void 0?void 0:A.style)&&((k=t.markerOption)===null||k===void 0?void 0:k.style[S]);o&&(o.style[S]=D)}),wu(o,p,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(t){!this.mapsService||this.mapsService.version!=="GAODE2.x"||Gu()||(t.type==="touchstart"&&(this.touchStartTime=Date.now()),t.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(t){return null}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),r}(ya.EventEmitter);function u3(e){var i=l3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function l3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c3=ii.merge,IR=function(e){(0,lt.Z)(r,e);var i=u3(r);function r(n){var t,o;return(0,be.Z)(this,r),o=i.call(this),(0,V.Z)((0,Ee.Z)(o),"markers",[]),(0,V.Z)((0,Ee.Z)(o),"points",[]),(0,V.Z)((0,Ee.Z)(o),"clusterMarkers",[]),o.markerLayerOption=c3(o.getDefault(),n),dc(["update"],(0,Ee.Z)(o)),o.zoom=((t=o.markerLayerOption.clusterOption)===null||t===void 0?void 0:t.zoom)||-99,o}return(0,J.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(et.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var t=this.mapsService.getContainer();this.containerSize={containerWidth:(t==null?void 0:t.scrollWidth)||0,containerHeight:(t==null?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(t){var o=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(t,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=_s(l,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var o=this.markers.indexOf(t);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(t){t.getElement().style.opacity="0"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(t){t.getElement().style.opacity="1"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var t=this.markerLayerOption.cluster;return t?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach(function(o){o.addTo(t.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(t){t.remove()}),this.clusterMarkers.forEach(function(t){t.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(t,o){var u=t.getLnglat(),l=u.lng,p=u.lat,v={geometry:{type:"Point",coordinates:[l,p]},properties:(0,O.Z)((0,O.Z)({},t.getExtData()),{},{marker_id:o})};this.points.push(v),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,o=t.radius,u=t.minZoom,l=u===void 0?0:u,p=t.maxZoom;this.clusterIndex=new(Gy())({radius:o,minZoom:l,maxZoom:p}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,o){var u=this,l=t[0].concat(t[1]),p=this.clusterIndex.getClusters(l,o);this.clusterMarkers.forEach(function(v){v.remove()}),this.clusterMarkers=[],p.forEach(function(v){var x,S=u.markerLayerOption.clusterOption,A=S.field,k=S.method;if((x=v.properties)!==null&&x!==void 0&&x.cluster_id){var D,R=u.getLeaves((D=v.properties)===null||D===void 0?void 0:D.cluster_id);if(v.properties.clusterData=R,A&&k){var N=R==null?void 0:R.map(function(Ue){var tt=(0,V.Z)({},A,Ue.properties[A]);return tt}),W=Xl(N,A),me=Gs(k,W),ye="point_"+k;v.properties[ye]=me.toFixed(2)}}var Ne=u.clusterMarker(v);u.clusterMarkers.push(Ne),Ne.addTo(u.scene)})}},{key:"getLeaves",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,o,u):null}},{key:"clusterMarker",value:function(t){var o=this.markerLayerOption.clusterOption,u=o,l=u.element,p=l===void 0?this.generateElement.bind(this):l,v=new qy({element:p(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]});return v}},{key:"normalMarker",value:function(t){var o=t.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var t=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!Ji(this.bbox,o))&&(this.bbox=_s(o,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var o=kn("div","l7-marker-cluster"),u=kn("div","",o),l=kn("span","",u),p=this.markerLayerOption.clusterOption,v=p.field,x=p.method;t.properties.point_count=t.properties.point_count||1;var S=v&&x?t.properties["point_"+x]||t.properties[v]:t.properties.point_count;return l.textContent=S,o}}]),r}(ya.EventEmitter),PR=z(4157);function f3(e){var i=h3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function h3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var od=function(e){(0,lt.Z)(r,e);var i=f3(r);function r(n){var t;return(0,be.Z)(this,r),t=i.call(this),r.controlCount++,t.controlOption=(0,O.Z)((0,O.Z)({},t.getDefault(n)),n||{}),t}return(0,J.Z)(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(t){var o=this.getDefault(t);Object.entries(t).forEach(function(u){var l=(0,K.Z)(u,2),p=l[0],v=l[1];v===void 0&&(t[p]=o[p])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,O.Z)((0,O.Z)({},this.controlOption),t)}},{key:"addTo",value:function(t){this.mapsService=t.get(et.IMapService),this.renderService=t.get(et.IRendererService),this.layerService=t.get(et.ILayerService),this.controlService=t.get(et.IControlService),this.configService=t.get(et.IGlobalConfigService),this.scene=t.get(et.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),Ko(this.container,"l7-control");var o=this.controlOption,u=o.className,l=o.style;return u&&this.setClassName(u),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;gs(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return kn("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var t=this.container;Uu(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var t=this.container;Ko(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:E.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E.TOPLEFT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=t,o&&o.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(t){var o=this.container,u=this.controlOption.className;u&&Uu(o,u),t&&Ko(o,t)}},{key:"setStyle",value:function(t){var o=this.container;t?o.setAttribute("style",t):o.removeAttribute("style")}},{key:"insertContainer",value:function(){var t=this.controlOption.position,o=this.container;if(t instanceof Element)t.appendChild(o);else{var u=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?u.insertBefore(o,u.firstChild):u.appendChild(o)}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(cs());(0,V.Z)(od,"controlCount",0);function p3(e){var i=v3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function v3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cm=function(e){(0,lt.Z)(r,e);var i=p3(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"isDisable",!1),n}return(0,J.Z)(r,[{key:"setIsDisable",value:function(t){if(this.isDisable=t,t){var o;(o=this.button)===null||o===void 0||o.setAttribute("disabled","true")}else{var u;(u=this.button)===null||u===void 0||u.removeAttribute("disabled")}}},{key:"createButton",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return kn("button","l7-button-control ".concat(t))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var t=this.controlOption,o=t.title,u=t.btnText,l=t.btnIcon;return this.setBtnTitle(o),this.setBtnText(u),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(t){var o=t.title,u=t.btnText,l=t.btnIcon;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(o),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(u),(0,ia.Z)((0,re.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"setBtnTitle",value:function(t){var o;(o=this.button)===null||o===void 0||o.setAttribute("title",t!=null?t:"")}},{key:"setBtnIcon",value:function(t){if(this.buttonIcon&&gs(this.buttonIcon),t){var o,u=(o=this.button)===null||o===void 0?void 0:o.firstChild;if(u){var l;(l=this.button)===null||l===void 0||l.insertBefore(t,u)}else{var p;(p=this.button)===null||p===void 0||p.appendChild(t)}this.buttonIcon=t}}},{key:"setBtnText",value:function(t){if(!!this.button)if(Uu(this.button,"l7-button-control--row"),Uu(this.button,"l7-button-control--column"),t){var o=this.buttonText;if(!o){var u;o=kn("div","l7-button-control__text"),(u=this.button)===null||u===void 0||u.appendChild(o),this.buttonText=o}o.innerText=t,Ko(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(gs(this.buttonText),this.buttonText=void 0)}}]),r}(od);function m3(e){var i=g3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function g3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ky=function(e){(0,lt.Z)(r,e);var i=m3(r);function r(n,t){var o;return(0,be.Z)(this,r),o=i.call(this),(0,V.Z)((0,Ee.Z)(o),"isShow",!1),(0,V.Z)((0,Ee.Z)(o),"timeout",null),(0,V.Z)((0,Ee.Z)(o),"show",function(){return o.isShow||!o.contentDOM.innerHTML||(o.resetPopperPosition(),Uu(o.popperDOM,"l7-popper-hide"),o.isShow=!0,o.option.unique&&r.conflictPopperList.forEach(function(u){u!==(0,Ee.Z)(o)&&u.isShow&&u.hide()}),o.emit("show"),window.addEventListener("pointerdown",o.onPopperUnClick)),(0,Ee.Z)(o)}),(0,V.Z)((0,Ee.Z)(o),"hide",function(){return o.isShow&&(Ko(o.popperDOM,"l7-popper-hide"),o.isShow=!1,o.emit("hide"),window.removeEventListener("pointerdown",o.onPopperUnClick)),(0,Ee.Z)(o)}),(0,V.Z)((0,Ee.Z)(o),"setHideTimeout",function(){o.timeout||(o.timeout=window.setTimeout(function(){!o.isShow||(o.hide(),o.timeout=null)},300))}),(0,V.Z)((0,Ee.Z)(o),"clearHideTimeout",function(){o.timeout&&(window.clearTimeout(o.timeout),o.timeout=null)}),(0,V.Z)((0,Ee.Z)(o),"onBtnClick",function(){o.isShow?o.hide():o.show()}),(0,V.Z)((0,Ee.Z)(o),"onPopperUnClick",function(u){ch(u.target,[".l7-button-control",".l7-popper-content"])||o.hide()}),(0,V.Z)((0,Ee.Z)(o),"onBtnMouseLeave",function(){o.setHideTimeout()}),(0,V.Z)((0,Ee.Z)(o),"onBtnMouseMove",function(){o.clearHideTimeout(),!o.isShow&&o.show()}),o.button=n,o.option=t,o.init(),t.unique&&r.conflictPopperList.push((0,Ee.Z)(o)),o}return(0,J.Z)(r,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(ju(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}},{key:"init",value:function(){var t=this.option.trigger;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),gs(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var t={},o=this.option,u=o.container,l=o.offset,p=l===void 0?[0,0]:l,v=o.placement,x=(0,K.Z)(p,2),S=x[0],A=x[1],k=this.button.getBoundingClientRect(),D=u.getBoundingClientRect(),R=fl(k,D),N=R.left,W=R.right,me=R.top,ye=R.bottom,Ne=!1,Ue=!1;/^(left|right)/.test(v)?(v.includes("left")?t.right="".concat(k.width+W,"px"):v.includes("right")&&(t.left="".concat(k.width+N,"px")),v.includes("start")?t.top="".concat(me,"px"):v.includes("end")?t.bottom="".concat(ye,"px"):(t.top="".concat(me+k.height/2,"px"),Ue=!0,t.transform="translate(".concat(S,"px, calc(").concat(A,"px - 50%))"))):/^(top|bottom)/.test(v)&&(v.includes("top")?t.bottom="".concat(k.height+ye,"px"):v.includes("bottom")&&(t.top="".concat(k.height+me,"px")),v.includes("start")?t.left="".concat(N,"px"):v.includes("end")?t.right="".concat(W,"px"):(t.left="".concat(N+k.width/2,"px"),Ne=!0,t.transform="translate(calc(".concat(S,"px - 50%), ").concat(A,"px)"))),t.transform="translate(calc(".concat(S,"px - ").concat(Ne?"50%":"0%","), calc(").concat(A,"px - ").concat(Ue?"50%":"0%",")");var tt=v.split("-");tt.length&&Ko(this.popperDOM,tt.map(function(Et){return"l7-popper-".concat(Et)}).join(" ")),Zl(this.popperDOM,Ef(t))}},{key:"createPopper",value:function(){var t=this.option,o=t.container,u=t.className,l=u===void 0?"":u,p=t.content,v=kn("div","l7-popper l7-popper-hide ".concat(l)),x=kn("div","l7-popper-content"),S=kn("div","l7-popper-arrow");return v.appendChild(x),v.appendChild(S),o.appendChild(v),this.popperDOM=v,this.contentDOM=x,p&&this.setContent(p),v}}]),r}(ya.EventEmitter);(0,V.Z)(Ky,"conflictPopperList",[]);function y3(e){var i=_3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function _3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x3={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},b3=function(e){(0,lt.Z)(r,e);var i=y3(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,ia.Z)((0,re.Z)(r.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(t){var o,u=(0,ia.Z)((0,re.Z)(r.prototype),"getDefault",this).call(this,t),l=(o=t==null?void 0:t.position)!==null&&o!==void 0?o:u.position;return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,re.Z)(r.prototype),"getDefault",this).call(this,t)),{},{popperPlacement:l instanceof Element?"bottom":x3[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var t=(0,ia.Z)((0,re.Z)(r.prototype),"onAdd",this).call(this);return this.initPopper(),t}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var t=this,o=this.controlOption,u=o.popperClassName,l=o.popperPlacement,p=o.popperTrigger,v=this.mapsService.getMapContainer();return this.popper=new Ky(this.button,{className:u,placement:l,trigger:p,container:v,unique:!0}),this.popper.on("show",function(){t.emit("popperShow",t)}).on("hide",function(){t.emit("popperHide",t)}),this.popper}},{key:"setOptions",value:function(t){if((0,ia.Z)((0,re.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){var o=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(o)}}}]),r}(cm);function S3(e){var i=w3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function w3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rh=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(Rh||{}),Jy=function(e){(0,lt.Z)(r,e);var i=S3(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"selectValue",[]),(0,V.Z)((0,Ee.Z)(n),"createNormalOption",function(l){var p=n.selectValue.includes(l.value),v=kn("div","l7-select-control-item ".concat(p?Rh.ActiveOptionClassName:""));n.getIsMultiple()&&v.appendChild(n.createCheckbox(p)),l.icon&&v.appendChild(l.icon);var x=kn("span");return x.innerText=l.text,v.appendChild(x),v}),(0,V.Z)((0,Ee.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var p=n.selectValue.findIndex(function(v){return v===l.value});p>-1?n.selectValue.splice(p,1):n.selectValue=[].concat((0,cr.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,J.Z)(r,[{key:"setOptions",value:function(t){(0,ia.Z)((0,re.Z)(r.prototype),"setOptions",this).call(this,t);var o=t.options;o&&this.popper.setContent(this.getPopperContent(o))}},{key:"onAdd",value:function(){var t=(0,ia.Z)((0,re.Z)(r.prototype),"onAdd",this).call(this),o=this.controlOption.defaultValue;return o&&(this.selectValue=this.transSelectValue(o)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(t){var o=this,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(t);this.optionDOMList.forEach(function(p){var v=p.getAttribute(Rh.OptionValueAttrKey),x=o.getIsMultiple()?p.querySelector("input[type=checkbox]"):void 0;l.includes(v)?(Ko(p,Rh.ActiveOptionClassName),x&&Yi(x,!0)):(Uu(p,Rh.ActiveOptionClassName),x&&Yi(x,!1))}),this.selectValue=l,u&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(t){var o=this,u=this.isImageOptions(),l=kn("div",u?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Ko(l,"l7-select-control--multiple");var p=t.map(function(v,x){var S=u?o.createImageOption(v):o.createNormalOption(v);return S.setAttribute(Rh.OptionValueAttrKey,v.value),S.setAttribute(Rh.OptionIndexAttrKey,window.String(x)),S.addEventListener("click",o.onItemClick.bind(o,v)),S});return l.append.apply(l,(0,cr.Z)(p)),this.optionDOMList=p,l}},{key:"createImageOption",value:function(t){var o=this.selectValue.includes(t.value),u=kn("div","l7-select-control-item ".concat(o?Rh.ActiveOptionClassName:"")),l=kn("img");l.setAttribute("src",t.img),lh(l),u.appendChild(l);var p=kn("div","l7-select-control-item-row");this.getIsMultiple()&&u.appendChild(this.createCheckbox(o));var v=kn("span");return v.innerText=t.text,p.appendChild(v),u.appendChild(p),u}},{key:"createCheckbox",value:function(t){var o=kn("input");return o.setAttribute("type","checkbox"),t&&Yi(o,!0),o}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(t){return t.img})}},{key:"transSelectValue",value:function(t){return Array.isArray(t)?t:[t]}}]),r}(b3),Jf=function(i){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("l7-iconfont"),r.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(i)),r.appendChild(n),r};function E3(e){var i=A3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function A3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C3=function(e){(0,lt.Z)(r,e);var i=E3(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"onClick",(0,It.Z)(he().mark(function l(){var p;return he().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(p=n.controlOption.onExport,p!=null){x.next=5;break}x.next=10;break;case 5:return x.t0=p,x.next=8,n.getImage();case 8:x.t1=x.sent,(0,x.t0)(x.t1);case 10:case"end":return x.stop()}},l)}))),(0,V.Z)((0,Ee.Z)(n),"mergeImage",(0,It.Z)(he().mark(function l(){var p,v,x,S,A,k,D,R,N,W,me,ye,Ne,Ue,tt=arguments;return he().wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:for(x=n.controlOption.imageType,S=(p=(v=n.mapsService.getContainer())===null||v===void 0?void 0:v.getBoundingClientRect())!==null&&p!==void 0?p:{},A=S.width,k=A===void 0?0:A,D=S.height,R=D===void 0?0:D,N=document.createElement("canvas"),N.width=k,N.height=R,W=N.getContext("2d"),me=tt.length,ye=new Array(me),Ne=0;Ne<me;Ne++)ye[Ne]=tt[Ne];return Vt.next=9,Promise.all(ye.map(function(Yt){return new Promise(function(gr){var hr=new Image;hr.onload=function(){gr(hr)},hr.src=Yt})}));case 9:return Ue=Vt.sent,Ue.forEach(function(Yt){W==null||W.drawImage(Yt,0,0,k,R)}),Vt.abrupt("return",N.toDataURL("image/".concat(x)));case 12:case"end":return Vt.stop()}},l)}))),n}return(0,J.Z)(r,[{key:"onAdd",value:function(){var t=(0,ia.Z)((0,re.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}},{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,re.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Jf("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l;return he().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.mapsService.exportMap("png");case 2:return u=v.sent,v.next=5,this.scene.exportPng("png");case 5:return l=v.sent,v.abrupt("return",this.mergeImage.apply(this,(0,cr.Z)([u,l].filter(function(x){return x}))));case 7:case"end":return v.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(cm);function T3(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=M3(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function M3(e,i){if(!!e){if(typeof e=="string")return Qy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qy(e,i)}}function Qy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var e_=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Qf=function(){if(typeof document=="undefined")return!1;for(var e=e_[0],i={},r=0,n=e_;r<n.length;r++){var t=n[r],o=t==null?void 0:t[1];if(o in document){var u=T3(t.entries()),l;try{for(u.s();!(l=u.n()).done;){var p=(0,K.Z)(l.value,2),v=p[0],x=p[1];i[e[v]]=x}}catch(S){u.e(S)}finally{u.f()}return i}}return!1}(),t_={change:Qf.fullscreenchange,error:Qf.fullscreenerror},Ll={request:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,r=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,t){var o=function l(){Ll.off("change",l),n()};Ll.on("change",o);var u=i[Qf.requestFullscreen](r);u instanceof Promise&&u.then(o).catch(t)})},exit:function(){return new Promise(function(i,r){if(!Ll.isFullscreen){i();return}var n=function o(){Ll.off("change",o),i()};Ll.on("change",n);var t=document[Qf.exitFullscreen]();t instanceof Promise&&t.then(n).catch(r)})},toggle:function(i,r){return Ll.isFullscreen?Ll.exit():Ll.request(i,r)},onchange:function(i){Ll.on("change",i)},onerror:function(i){Ll.on("error",i)},on:function(i,r){var n=t_[i];n&&document.addEventListener(n,r,!1)},off:function(i,r){var n=t_[i];n&&document.removeEventListener(n,r,!1)},raw:Qf};Object.defineProperties(Ll,{isFullscreen:{get:function(){return Boolean(document[Qf.fullscreenElement])}},element:{enumerable:!0,get:function(){var i;return(i=document[Qf.fullscreenElement])!==null&&i!==void 0?i:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[Qf.fullscreenEnabled])}}}),Qf||(Ll={isEnabled:!1});var h0=Ll;function k3(e){var i=I3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function I3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P3=function(e){(0,lt.Z)(r,e);var i=k3(r);function r(n){var t;return(0,be.Z)(this,r),t=i.call(this,n),(0,V.Z)((0,Ee.Z)(t),"isFullscreen",!1),(0,V.Z)((0,Ee.Z)(t),"toggleFullscreen",(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!h0.isEnabled){l.next=3;break}return l.next=3,h0.toggle(t.mapContainer);case 3:case"end":return l.stop()}},o)}))),(0,V.Z)((0,Ee.Z)(t),"onClick",function(){t.toggleFullscreen()}),(0,V.Z)((0,Ee.Z)(t),"onFullscreenChange",function(){t.isFullscreen=!!document.fullscreenElement;var o=t.controlOption,u=o.btnText,l=o.btnIcon,p=o.title,v=o.exitBtnText,x=o.exitBtnIcon,S=o.exitTitle;t.isFullscreen?(t.setBtnTitle(S),t.setBtnText(v),t.setBtnIcon(x)):(t.setBtnTitle(p),t.setBtnText(u),t.setBtnIcon(l)),t.emit("fullscreenChange",t.isFullscreen)}),h0.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),t}return(0,J.Z)(r,[{key:"setOptions",value:function(t){var o=t.exitBtnText,u=t.exitBtnIcon,l=t.exitTitle;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(u),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(o),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(l)),(0,ia.Z)((0,re.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"onAdd",value:function(){var t=(0,ia.Z)((0,re.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),this.mapContainer=Eu(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}},{key:"onRemove",value:function(){(0,ia.Z)((0,re.Z)(r.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,re.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5168\u5C4F",btnIcon:Jf("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Jf("l7-icon-exit-fullscreen")})}}]),r}(cm);function L3(e){var i=R3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function R3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D3=function(e){(0,lt.Z)(r,e);var i=L3(r);function r(n){var t;return(0,be.Z)(this,r),t=i.call(this,n),(0,V.Z)((0,Ee.Z)(t),"getGeoLocation",function(){return new Promise(function(o,u){window.navigator.geolocation.getCurrentPosition(function(l){var p=l.coords,v=p!=null?p:{},x=v.longitude,S=v.latitude;!isNaN(x)&&!isNaN(S)?o([x,S]):u()},function(l){u(l)})})}),(0,V.Z)((0,Ee.Z)(t),"onClick",(0,It.Z)(he().mark(function o(){var u,l,p;return he().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(window.navigator.geolocation){x.next=2;break}return x.abrupt("return");case 2:return u=t.controlOption.transform,x.next=5,t.getGeoLocation();case 5:if(l=x.sent,p=t.mapsService.getZoom(),x.t0=t.mapsService,x.t1=p>15?p:15,!u){x.next=15;break}return x.next=12,u(l);case 12:x.t2=x.sent,x.next=16;break;case 15:x.t2=l;case 16:x.t3=x.t2,x.t0.setZoomAndCenter.call(x.t0,x.t1,x.t3);case 18:case"end":return x.stop()}},o)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),t}return(0,J.Z)(r,[{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,re.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5B9A\u4F4D",btnIcon:Jf("l7-icon-reposition")})}},{key:"onAdd",value:function(){var t=(0,ia.Z)((0,re.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}}]),r}(cm);function O3(e){var i=F3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function F3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r_=function(e){(0,lt.Z)(r,e);var i=O3(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,V.Z)((0,Ee.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,V.Z)((0,Ee.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var p=n.selectValue.includes(l.name),v=l.isVisible();p&&!v&&l.show(),!p&&v&&l.hide()})}),n}return(0,J.Z)(r,[{key:"layers",get:function(){var t=this.layerService,o=this.controlOption.layers;if(Array.isArray(o)&&o.length){var u=[];return o.forEach(function(l){if(l instanceof Object&&u.push(l),typeof l=="string"){var p=t.getLayer(l)||t.getLayerByName(l);p&&u.push(p)}}),u}return t.getLayers()||[]}},{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,re.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Jf("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(t){return t.isVisible()}).map(function(t){return t.name})}},{key:"getLayerOptions",value:function(){return this.layers.map(function(t){return{text:t.name,value:t.name}})}},{key:"setOptions",value:function(t){var o=this.checkUpdateOption(t,["layers"]);(0,ia.Z)((0,re.Z)(r.prototype),"setOptions",this).call(this,t),o&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var t;return(t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,ia.Z)((0,re.Z)(r.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),r}(Jy);function B3(e){var i=z3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function z3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n_=function(e){(0,lt.Z)(r,e);var i=B3(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getDefault",value:function(){return{position:E.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var t=kn("div","l7-control-logo");return this.setLogoContent(t),t}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(t){(0,ia.Z)((0,re.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["img","href"])&&(ju(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(t){var o=this.controlOption,u=o.href,l=o.img,p=kn("img");if(p.setAttribute("src",l),p.setAttribute("aria-label","AntV logo"),lh(p),u){var v=kn("a","l7-control-logo-link");v.target="_blank",v.href=u,v.rel="noopener nofollow",v.setAttribute("rel","noopener nofollow"),v.appendChild(p),t.appendChild(v)}else t.appendChild(p)}}]),r}(od),N3={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},Z3={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function U3(e){var i=V3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function V3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j3=function(e){(0,lt.Z)(r,e);var i=U3(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,J.Z)(r,[{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,re.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Jf("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var t=this.mapsService.getType()==="mapbox"?Z3:N3;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(o){var u=(0,K.Z)(o,2),l=u[0],p=u[1];return typeof p=="string"&&l!=="blank"}).map(function(o){var u,l=(0,K.Z)(o,2),p=l[0],v=l[1],x=(u=t[p])!==null&&u!==void 0?u:{},S=x.text,A=x.img;return{text:S!=null?S:p,value:v,img:A,key:p}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var t,o=this;if((t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var u,l,p=this.controlOption.defaultValue;this.controlOption.defaultValue=(u=(l=this.controlOption.options.find(function(x){return x.key===p}))===null||l===void 0?void 0:l.value)!==null&&u!==void 0?u:p}else{var v=this.getMapStyle();v?this.controlOption.defaultValue=v:this.mapsService.map.once("styledata",function(){var x=o.mapsService.getMapStyle();o.controlOption.defaultValue=x,o.setSelectValue(x,!1)})}return this.on("selectChange",this.onMapThemeChange),(0,ia.Z)((0,re.Z)(r.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),r}(Jy);function G3(e){var i=H3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function H3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W3=function(e){(0,lt.Z)(r,e);var i=G3(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"location",[0,0]),(0,V.Z)((0,Ee.Z)(n),"onMouseMove",function(l){var p=n.location,v=l.lngLat||l.lnglat,x=n.controlOption.transform;v&&(p=[v.lng,v.lat]),n.location=p,x&&(p=x(p)),n.insertLocation2HTML(p),n.emit("locationChange",p)}),n}return(0,J.Z)(r,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,re.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:E.BOTTOMLEFT,transform:function(u){var l=(0,K.Z)(u,2),p=l[0],v=l[1];return[+(+p).toFixed(6),+(+v).toFixed(6)]}})}},{key:"onAdd",value:function(){var t=kn("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(t){this.container.innerText=t.join(", ")}}]),r}(od);function $3(e){var i=X3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function X3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y3=function(e){(0,lt.Z)(r,e);var i=$3(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"update",function(){var l=n.mapsService,p=n.controlOption.maxWidth,v=l.getSize()[1]/2,x=l.containerToLngLat([0,v]),S=l.containerToLngLat([p,v]),A=ml([x.lng,x.lat],[S.lng,S.lat]);n.updateScales(A)}),n}return(0,J.Z)(r,[{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,re.Z)(r.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:E.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var t="l7-control-scale",o=kn("div",t);this.resetScaleLines(o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),o}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(t){(0,ia.Z)((0,re.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(t){var o=this.controlOption,u=o.metric,l=o.imperial;u&&t&&this.updateMetric(t),l&&t&&this.updateImperial(t)}},{key:"resetScaleLines",value:function(t){ju(t);var o=this.controlOption,u=o.metric,l=o.imperial,p=o.maxWidth,v=o.lockWidth;v&&Zl(t,"width: ".concat(p,"px")),u&&(this.mScale=kn("div","l7-control-scale-line",t)),l&&(this.iScale=kn("div","l7-control-scale-line",t)),this.update()}},{key:"updateScale",value:function(t,o,u){var l=this.controlOption.maxWidth;t.style.width=Math.round(l*u)+"px",t.innerHTML=o}},{key:"getRoundNum",value:function(t){var o=Math.pow(10,(Math.floor(t)+"").length-1),u=t/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"updateMetric",value:function(t){var o=this.getRoundNum(t),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/t)}},{key:"updateImperial",value:function(t){var o=t*3.2808399,u,l,p;o>5280?(u=o/5280,l=this.getRoundNum(u),this.updateScale(this.iScale,l+" mi",l/u)):(p=this.getRoundNum(o),this.updateScale(this.iScale,p+" ft",p/o))}}]),r}(od);function q3(e){var i=K3();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function K3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var J3=function(e){(0,lt.Z)(r,e);var i=q3(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,V.Z)((0,Ee.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,V.Z)((0,Ee.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,J.Z)(r,[{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,re.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:E.BOTTOMRIGHT,name:"zoom",zoomInText:Jf("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Jf("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(t){(0,ia.Z)((0,re.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var t=kn("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(t){ju(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",t)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(t,o,u,l,p){var v=kn("button",u,l);return typeof t=="string"?v.innerHTML=t:v.append(t),v.title=o,p&&v.addEventListener("click",p),v}}]),r}(od);function Q3(e){var i=eE();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function eE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p0=function(e){(0,lt.Z)(r,e);var i=Q3(r);function r(n){var t;(0,be.Z)(this,r),t=i.call(this),(0,V.Z)((0,Ee.Z)(t),"isShow",!0),(0,V.Z)((0,Ee.Z)(t),"onMouseMove",function(u){var l,p=t.mapsService.getMapContainer(),v=(l=p==null?void 0:p.getBoundingClientRect())!==null&&l!==void 0?l:{},x=v.left,S=x===void 0?0:x,A=v.top,k=A===void 0?0:A;t.setPopupPosition(u.clientX-S,u.clientY-k)}),(0,V.Z)((0,Ee.Z)(t),"updateLngLatPosition",function(){if(!(!t.mapsService||t.popupOption.followCursor)){var u=t.lngLat,l=u.lng,p=u.lat,v=t.mapsService.lngLatToContainer([l,p]),x=v.x,S=v.y;t.setPopupPosition(x,S)}}),(0,V.Z)((0,Ee.Z)(t),"onKeyDown",function(u){u.keyCode===27&&t.remove()}),(0,V.Z)((0,Ee.Z)(t),"onCloseButtonClick",function(u){u.stopPropagation&&u.stopPropagation(),t.hide()}),(0,V.Z)((0,Ee.Z)(t),"update",function(){var u=!!t.lngLat,l=t.popupOption,p=l.className,v=l.style,x=l.maxWidth,S=l.anchor,A=l.stopPropagation;if(!(!t.mapsService||!u||!t.content)){var k=t.mapsService.getMarkerContainer();if(!t.container&&k&&(t.container=kn("div","l7-popup ".concat(p!=null?p:""," ").concat(t.isShow?"":"l7-popup-hide"),k),v&&t.container.setAttribute("style",v),t.tip=kn("div","l7-popup-tip",t.container),t.container.appendChild(t.content),A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(N){t.container.addEventListener(N,function(W){W.stopPropagation()})}),t.container.style.whiteSpace="nowrap"),t.updateLngLatPosition(),Mo(t.container,"".concat(Su[S])),wu(t.container,S,"popup"),x){var D=t.container.getBoundingClientRect(),R=D.width;R>parseFloat(x)&&(t.container.style.width=x)}else t.container.style.removeProperty("width")}}),t.popupOption=(0,O.Z)((0,O.Z)({},t.getDefault(n!=null?n:{})),n);var o=t.popupOption.lngLat;return o&&(t.lngLat=o),t}return(0,J.Z)(r,[{key:"lngLat",get:function(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}},set:function(t){this.popupOption.lngLat=t}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(t){this.mapsService=t.get(et.IMapService),this.sceneService=t.get(et.ISceneService),this.layerService=t.get(et.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var o=this.popupOption,u=o.html,l=o.text,p=o.title;return u?this.setHTML(u):l&&this.setText(l),p&&this.setTitle(p),this.emit("open"),this}},{key:"remove",value:function(){if(!!(this!==null&&this!==void 0&&this.isOpen()))return this.content&&gs(this.content),this.container&&(gs(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(t){return this.show(),this.popupOption=(0,O.Z)((0,O.Z)({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(gs(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Uu(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&Ko(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(t){return this.popupOption.html=t,this.setDOMContent(t)}},{key:"setText",value:function(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}},{key:"setTitle",value:function(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=kn("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),ju(this.contentTitle),Us(this.contentTitle,t)):this.contentTitle&&(gs(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var t=this.lngLat,o=t.lng,u=t.lat;return this.popupOption.autoPan&&this.mapsService.panTo([o,u]),this}},{key:"setLngLat",value:function(t){return this.setLnglat(t)}},{key:"setLnglat",value:function(t){var o=this;return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){o.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:ha.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(t){return this.show(),this.createContent(),Us(this.contentPanel,t),this.update(),this}},{key:"updateCloseOnClick",value:function(t){var o=this,u=this.mapsService;u&&(u==null||u.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(function(){u==null||u.on("click",o.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(t){var o,u=(o=this.mapsService)===null||o===void 0?void 0:o.getContainer();u&&(u==null||u.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(u==null||u.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var t=this;if(this.content&&gs(this.content),this.contentTitle=void 0,this.content=kn("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var o=Jf("l7-icon-guanbi");Ko(o,"l7-popup-close-button"),this.content.appendChild(o),this.popupOption.closeButtonOffsets&&(o.style.right=this.popupOption.closeButtonOffsets[0]+"px",o.style.top=this.popupOption.closeButtonOffsets[1]+"px"),o.setAttribute("aria-label","Close popup"),o.addEventListener("click",function(u){t.hide()}),o.addEventListener("pointerup",function(u){u.stopPropagation()}),o.addEventListener("pointerdown",function(u){u.stopPropagation()}),this.closeButton=o}else this.closeButton=void 0;this.contentPanel=kn("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(t,o){if(this.container){var u=this.popupOption.offsets;this.container.style.left=t+u[0]+"px",this.container.style.top=o-u[1]+"px"}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(ya.EventEmitter);function tE(e){var i=rE();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function rE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nE=ii.get,LR=function(e){(0,lt.Z)(r,e);var i=tE(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"layerClickCountByFrame",0),(0,V.Z)((0,Ee.Z)(n),"layerConfigMap",new WeakMap),(0,V.Z)((0,Ee.Z)(n),"onLayerClick",function(l,p){requestAnimationFrame(function(){if(n.popupOption.closeOnClick&&n.layerClickCountByFrame++,n.isShow&&n.isSameFeature(l,p.featureId))n.hide();else{var v=n.getLayerInfoFrag(l,p),x=v.title,S=v.content;n.setDOMContent(S),n.setLnglat(p.lngLat),n.setTitle(x),n.displayFeatureInfo={layer:l,featureId:p.featureId},n.show()}})}),(0,V.Z)((0,Ee.Z)(n),"onSceneClick",function(){n.layerClickCountByFrame=0,requestAnimationFrame(function(){n.layerClickCountByFrame||n.hide()})}),(0,V.Z)((0,Ee.Z)(n),"updateCloseOnClick",function(){}),n}return(0,J.Z)(r,[{key:"layerConfigItems",get:function(){var t,o=this.popupOption,u=o.config,l=o.items;return(t=u!=null?u:l)!==null&&t!==void 0?t:[]}},{key:"addTo",value:function(t){return(0,ia.Z)((0,re.Z)(r.prototype),"addTo",this).call(this,t),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,ia.Z)((0,re.Z)(r.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(t){return this.unbindLayerEvent(),(0,ia.Z)((0,re.Z)(r.prototype),"setOptions",this).call(this,t),this.bindLayerEvent(),this}},{key:"getDefault",value:function(t){var o=t.trigger==="click";return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,re.Z)(r.prototype),"getDefault",this).call(this,t)),{},{trigger:"hover",followCursor:!o,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var t=this,o=this.popupOption,u=o.trigger,l=o.closeOnClick;this.layerConfigItems.forEach(function(p){var v,x=t.getLayerByConfig(p);if(!!x){var S=(0,O.Z)({},p);if(u==="hover"){var A=t.onLayerMouseMove.bind(t,x),k=t.onLayerMouseOut.bind(t,x);S.onMouseMove=A,S.onMouseOut=k,x==null||x.on("mousemove",A),x==null||x.on("mouseout",k)}else{var D,R=t.onLayerClick.bind(t,x);S.onClick=R,x==null||x.on("click",R);var N=(D=t.mapsService)===null||D===void 0?void 0:D.getMapContainer();N&&l&&N.addEventListener("click",t.onSceneClick)}var W=x==null||(v=x.getSource)===null||v===void 0?void 0:v.call(x),me=t.onSourceUpdate.bind(t,x);W==null||W.on("update",me),S.onSourceUpdate=me,t.layerConfigMap.set(x,S)}})}},{key:"unbindLayerEvent",value:function(){var t=this;this.layerConfigItems.forEach(function(o){var u,l=t.getLayerByConfig(o),p=l&&t.layerConfigMap.get(l);if(!!p){var v=p.onMouseMove,x=p.onMouseOut,S=p.onClick,A=p.onSourceUpdate;if(v&&l.off("mousemove",v),x&&l.off("mouseout",x),S&&l.off("click",S),A){var k;l==null||(k=l.getSource())===null||k===void 0||k.off("update",A)}var D=(u=t.mapsService)===null||u===void 0?void 0:u.getMapContainer();D&&D.removeEventListener("click",t.onSceneClick)}})}},{key:"onLayerMouseMove",value:function(t,o){if(!this.isSameFeature(t,o.featureId)){var u=this.getLayerInfoFrag(t,o),l=u.title,p=u.content;this.setDOMContent(p),this.setTitle(l),this.displayFeatureInfo={layer:t,featureId:o.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(t,o){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onSourceUpdate",value:function(t){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(t,o){var u=this.layerConfigMap.get(t),l,p=document.createDocumentFragment();if(u){var v=o.feature;v.type==="Feature"&&"properties"in v&&"geometry"in v&&(v=v.properties);var x=u.title,S=u.fields,A=u.customContent;if(x){l=document.createDocumentFragment();var k=x instanceof Function?x(v):x;Us(l,k)}if(A){var D=A instanceof Function?A(v):A;Us(p,D)}else S!=null&&S.length&&(S==null||S.forEach(function(R){var N,W,me=typeof R=="string"?{field:R}:R,ye=me.field,Ne=me.formatField,Ue=me.formatValue,tt=me.getValue,Et=kn("div","l7-layer-popup__row"),Vt=tt?tt(o.feature):nE(v,ye),Yt=(N=Ne instanceof Function?Ne(ye,v):Ne)!==null&&N!==void 0?N:ye,gr=(W=Ue instanceof Function?Ue(Vt,v):Ue)!==null&&W!==void 0?W:Vt,hr=kn("span","l7-layer-popup__key",Et);Us(hr,Yt),Us(hr,document.createTextNode("\uFF1A"));var Hr=kn("span","l7-layer-popup__value",Et);Array.isArray(gr)&&gr.every(function(fn){return!(fn instanceof Object)})&&(gr=gr.map(function(fn){return String(fn)}).join(",")),Us(Hr,gr),p.appendChild(Et)}))}return{title:l,content:p}}},{key:"getLayerByConfig",value:function(t){var o=t.layer;if(o instanceof Object)return o;if(typeof o=="string")return this.layerService.getLayer(o)||this.layerService.getLayerByName(o)}},{key:"isSameFeature",value:function(t,o){var u=this.displayFeatureInfo;return u&&t===u.layer&&o===u.featureId}}]),r}(p0);function iE(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}iE(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var Dh,i_=(Dh={},(0,V.Z)(Dh,zt.additive,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE,srcAlpha:1,dstAlpha:1}}),(0,V.Z)(Dh,zt.none,{enable:!1}),(0,V.Z)(Dh,zt.normal,{enable:!0,func:{srcRGB:q.SRC_ALPHA,dstRGB:q.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,V.Z)(Dh,zt.subtractive,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE,srcAlpha:q.ZERO,dstAlpha:q.ONE_MINUS_SRC_COLOR},equation:{rgb:q.FUNC_SUBTRACT,alpha:q.FUNC_SUBTRACT}}),(0,V.Z)(Dh,zt.max,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE},equation:{rgb:q.MAX_EXT}}),(0,V.Z)(Dh,zt.min,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE},equation:{rgb:q.MIN_EXT}}),Dh),nc=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({}),a_=ii.cloneDeep;function aE(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=su(r),t=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return t}function oE(e,i,r){if(e.length>0&&i.version===nc["GAODE2.x"]){var n=r.coordCenter;typeof e[0].coordinates[0]=="number"?e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=nc["GAODE2.x"],t.originCoordinates=a_(t.coordinates),t.coordinates=i.coordToAMap2RelativeCoordinates(t.coordinates,n)}):e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=nc["GAODE2.x"],t.originCoordinates=a_(t.coordinates),t.coordinates=i.coordToAMap2RelativeCoordinates(t.coordinates,n)})}}function sE(e,i){e.length>0&&i.version===nc.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=uE(r.coordinates,i),r.simpleCoordinate=!0)})}function uE(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(t){var o=[];t.map(function(u){o.push(i.simpleMapCoord.unproject(u))}),r.push(o)}),r}else{var n=[];return e.map(function(t){n.push(i.simpleMapCoord.unproject(t))}),n}}function lE(e,i){var r;if(!e.scale)return[];var n=(e==null||(r=e.scale)===null||r===void 0?void 0:r.scalers)||[],t=[];n.forEach(function(u){var l,p=u.field;(i.hasOwnProperty(p)||((l=e.scale)===null||l===void 0?void 0:l.type)==="variable")&&t.push(i[p])});var o=e.mapping?e.mapping(t):[];return o}function cE(e,i,r,n,t){var o=t==null?void 0:t.getLayerConfig(),u=o.arrow,l=u===void 0?{enable:!1}:u,p=i.map(function(v){var x={id:v._id,coordinates:v.coordinates};if(e.filter(function(k){return k.scale!==void 0}).forEach(function(k){var D=lE(k,v);k.needRemapping=!1,k.name==="color"&&(D=D.map(function(R){return Hn(R)})),x[k.name]=Array.isArray(D)&&D.length===1?D[0]:D,k.name==="shape"&&(x.shape=r.getIconFontKey(x[k.name]))}),x.shape==="line"&&l.enable){var S=x.coordinates,A=aE(S[0],S[1]);x.coordinates.splice(1,0,A,A)}return x});return oE(p,n,t),sE(p,n),p}function fE(e,i,r,n,t,o){var u=new f0(t,o),l=n.getLayerStyleAttributes()||[],p=u.data.dataArray,v=p,x=cE(l,v,i,r,e);return u.destroy(),x}function o_(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function s_(e,i,r,n){var t=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enableTAA;return u?t.add(n("taa")):t.add(n("render")),o_(i).forEach(function(l){var p=(0,K.Z)(l,2),v=p[0],x=p[1];t.add(r(v),x)}),t.add(r("copy")),t}var hE=function(){function e(i){(0,be.Z)(this,e),this.layer=i}return(0,J.Z)(e,[{key:"pickRender",value:function(r){var n=this.layer.getContainer(),t=n.get(et.ILayerService),o=this.layer;if(o.tileLayer)return o.tileLayer.pickRender(r);o.hooks.beforePickingEncode.call(),t.renderTileLayerMask(o),o.renderModels({ispick:!0}),o.hooks.afterPickingEncode.call()}},{key:"pick",value:function(r,n){var t=this.layer.getContainer(),o=t.get(et.IPickingService);return r.type==="RasterLayer"?this.pickRasterLayer(r,n):(this.pickRender(n),o.pickFromPickingFBO(r,n))}},{key:"pickRasterLayer",value:function(r,n,t){var o=this.layer.getContainer(),u=o.get(et.IPickingService),l=o.get(et.IMapService),p=this.layer.getSource().extent,v=Hu(n.lngLat,p),x={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},S=t||r;if(v){var A=this.readRasterValue(r,p,l,n.x,n.y);return x.rasterValue=A,u.triggerHoverOnLayer(S,x),!0}else return x.type=n.type==="mousemove"?"mouseout":"un"+n.type,u.triggerHoverOnLayer(S,(0,O.Z)((0,O.Z)({},x),{},{type:"unpick"})),u.triggerHoverOnLayer(S,x),!1}},{key:"readRasterValue",value:function(r,n,t,o,u){var l=r.getSource().data.dataArray[0],p=(0,K.Z)(n,4),v=p[0],x=v===void 0?0:v,S=p[1],A=S===void 0?0:S,k=p[2],D=k===void 0?10:k,R=p[3],N=R===void 0?-10:R,W=t.lngLatToContainer([x,A]),me=t.lngLatToContainer([D,N]),ye=me.x-W.x,Ne=W.y-me.y,Ue=[(o-W.x)/ye,(u-me.y)/Ne],tt=l.width||1,Et=l.height||1,Vt=Math.floor(Ue[0]*tt),Yt=Math.floor(Ue[1]*Et),gr=Math.max(0,Yt-1)*tt+Vt,hr=l.data[gr];return hr}},{key:"selectFeature",value:function(r){var n=this.layer,t=(0,K.Z)(r,3),o=t[0],u=t[1],l=t[2];n.hooks.beforeSelect.call([o,u,l])}},{key:"highlightPickedFeature",value:function(r){var n=(0,K.Z)(r,3),t=n[0],o=n[1],u=n[2];this.layer.hooks.beforeHighlight.call([t,o,u])}},{key:"getFeatureById",value:function(r){return this.layer.getSource().getFeatureById(r)}}]),e}(),pE=function(){function e(i){(0,be.Z)(this,e),this.layer=i;var r=this.layer.getContainer();this.rendererService=r.get(et.IRendererService)}return(0,J.Z)(e,[{key:"getColorTexture",value:function(r,n){var t=this.getTextureKey(r,n);return this.key===t?this.colorTexture:(this.createColorTexture(r,n),this.key=t,this.colorTexture)}},{key:"createColorTexture",value:function(r,n){var t=this.rendererService.createTexture2D,o=this.getColorRampBar(r,n),u=t({data:new Uint8Array(o.data),width:o.width,height:o.height,flipY:!1});return this.colorTexture=u,u}},{key:"setColorTexture",value:function(r,n,t){this.key=this.getTextureKey(n,t),this.colorTexture=r}},{key:"destroy",value:function(){var r;(r=this.colorTexture)===null||r===void 0||r.destroy()}},{key:"getColorRampBar",value:function(r,n){switch(r.type){case"cat":return mo(r);case"quantize":return Ds(r);case"custom":return is(r,n);case"linear":return To(r,n);default:return zi(r)}}},{key:"getTextureKey",value:function(r,n){var t;return"".concat(r.colors.join("_"),"_").concat(r==null||(t=r.positions)===null||t===void 0?void 0:t.join("_"),"_").concat(r.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),dE=["passes"],vE=["moduleName","vertexShader","fragmentShader","inject","triangulation","segmentNumber"],u_,d0,l_;function mE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=gE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function gE(e,i){if(!!e){if(typeof e=="string")return c_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c_(e,i)}}function c_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function yE(e){var i=_E();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function _E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v0=ii.isEqual,f_=ii.isFunction,h_=ii.isNumber,au=ii.isObject,xE=ii.isPlainObject,bE=ii.isUndefined,p_=0,Oh=(u_=u0(et.IGlobalConfigService),d0=function(e){(0,lt.Z)(r,e);var i=yE(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,be.Z)(this,r),n=i.call(this),(0,V.Z)((0,Ee.Z)(n),"id","".concat(p_++)),(0,V.Z)((0,Ee.Z)(n),"name","".concat(p_)),(0,V.Z)((0,Ee.Z)(n),"visible",!0),(0,V.Z)((0,Ee.Z)(n),"zIndex",0),(0,V.Z)((0,Ee.Z)(n),"inited",!1),(0,V.Z)((0,Ee.Z)(n),"layerModelNeedUpdate",!1),(0,V.Z)((0,Ee.Z)(n),"pickedFeatureID",null),(0,V.Z)((0,Ee.Z)(n),"selectedFeatureID",null),(0,V.Z)((0,Ee.Z)(n),"styleNeedUpdate",!1),(0,V.Z)((0,Ee.Z)(n),"forceRender",!1),(0,V.Z)((0,Ee.Z)(n),"clusterZoom",0),(0,V.Z)((0,Ee.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,V.Z)((0,Ee.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,V.Z)((0,Ee.Z)(n),"hooks",{init:new g2,afterInit:new og,beforeRender:new og,beforeRenderData:new y2,afterRender:new gf,beforePickingEncode:new gf,afterPickingEncode:new gf,beforeHighlight:new gf(["pickedColor"]),afterHighlight:new gf,beforeSelect:new gf(["pickedColor"]),afterSelect:new gf,beforeDestroy:new gf,afterDestroy:new gf}),(0,V.Z)((0,Ee.Z)(n),"models",[]),(0,V.Z)((0,Ee.Z)(n),"startInit",!1),(0,V.Z)((0,Ee.Z)(n),"layerChildren",[]),(0,V.Z)((0,Ee.Z)(n),"masks",[]),on((0,Ee.Z)(n),"configService",l_,(0,Ee.Z)(n)),(0,V.Z)((0,Ee.Z)(n),"animateOptions",{enable:!1}),(0,V.Z)((0,Ee.Z)(n),"currentPickId",null),(0,V.Z)((0,Ee.Z)(n),"encodeStyleAttribute",{}),(0,V.Z)((0,Ee.Z)(n),"enableShaderEncodeStyles",[]),(0,V.Z)((0,Ee.Z)(n),"enableDataEncodeStyles",[]),(0,V.Z)((0,Ee.Z)(n),"enablg",[]),(0,V.Z)((0,Ee.Z)(n),"pendingStyleAttributes",[]),(0,V.Z)((0,Ee.Z)(n),"scaleOptions",{}),(0,V.Z)((0,Ee.Z)(n),"animateStatus",!1),(0,V.Z)((0,Ee.Z)(n),"isDestroyed",!1),(0,V.Z)((0,Ee.Z)(n),"encodeDataLength",0),(0,V.Z)((0,Ee.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions);var u=n.layerSource.getSourceCfg().autoRender;u&&n.reRender()}),n.name=t.name||n.id,n.zIndex=t.zIndex||0,n.rawConfig=t,n}return(0,J.Z)(r,[{key:"addMask",value:function(t){this.masks.push(t),this.enableMask()}},{key:"removeMask",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var o=this;if(Object.keys(t).map(function(l){l in o.rawConfig&&(o.rawConfig[l]=t[l])}),!this.startInit)this.needUpdateConfig=(0,O.Z)((0,O.Z)({},this.needUpdateConfig),t);else{var u=this.container.get(et.SceneID);this.configService.setLayerConfig(u,this.id,(0,O.Z)((0,O.Z)((0,O.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(t,o){this.container=t,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var n=(0,It.Z)(he().mark(function o(){var u=this,l,p,v,x,S,A,k;return he().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:l=this.container.get(et.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(et.IIconService),this.fontService=this.container.get(et.IFontService),this.rendererService=this.container.get(et.IRendererService),this.layerService=this.container.get(et.ILayerService),this.debugService=this.container.get(et.IDebugService),this.interactionService=this.container.get(et.IInteractionService),this.pickingService=this.container.get(et.IPickingService),this.mapService=this.container.get(et.IMapService),p=this.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,v&&x!==null&&x!==void 0&&x.length&&x.length>0&&this.mapService.on("mapAfterFrameChange",function(){u.renderLayers()}),this.cameraService=this.container.get(et.ICameraService),this.coordinateService=this.container.get(et.ICoordinateSystemService),this.shaderModuleService=this.container.get(et.IShaderModuleService),this.postProcessingPassFactory=this.container.get(et.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(et.IFactoryNormalPass),this.styleAttributeService=this.container.get(et.IStyleAttributeService),v&&(this.multiPassRenderer=this.container.get(et.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(N){var W=N.attributeName,me=N.attributeField,ye=N.attributeValues,Ne=N.updateOptions;u.styleAttributeService.updateStyleAttribute(W,{scale:(0,O.Z)({field:me},u.splitValuesAndCallbackInAttribute(ye,me?void 0:u.getLayerConfig()[W]))},Ne)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(et.ILayerPlugin),S=mE(this.plugins);try{for(S.s();!(A=S.n()).done;)k=A.value,k.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(N){S.e(N)}finally{S.f()}return this.layerPickService=new hE(this),this.textureService=new pE(this),this.log(ns.LayerInitStart),R.next=31,this.hooks.init.promise();case 31:this.log(ns.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"log",value:function(t){var o,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(u,".").concat(t),p={id:this.id,type:this.type};(o=this.debugService)===null||o===void 0||o.log(l,p)}}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map(function(o){o.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}},{key:"createModelData",value:function(t,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var l=this.calculateEncodeData(t,o),p=this.triangulation;return l&&p?this.styleAttributeService.createAttributesAndIndices(l,p):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(t){this.layerPickService=t}},{key:"calculateEncodeData",value:function(t,o){return this.inited?fE(this,this.fontService,this.mapService,this.styleAttributeService,t,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var t=this.getLayerConfig(),o=t.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,o,u){return this.updateStyleAttribute("color",t,o,u),this}},{key:"texture",value:function(t,o,u){return this.updateStyleAttribute("texture",t,o,u),this}},{key:"rotate",value:function(t,o,u){return this.updateStyleAttribute("rotate",t,o,u),this}},{key:"size",value:function(t,o,u){return this.updateStyleAttribute("size",t,o,u),this}},{key:"filter",value:function(t,o,u){var l=this.updateStyleAttribute("filter",t,o,u);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(t,o,u){this.shapeOption={field:t,values:o};var l=this.updateStyleAttribute("shape",t,o,u);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(t,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(t){var o={};return au(t)?(o.enable=!0,o=(0,O.Z)((0,O.Z)({},o),t)):o.enable=t,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(t,o){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(t,o){var u=this;return this.inited?(this.log(ns.SourceInitStart,yr.UPDATE),this.layerSource.setData(t,o),this.log(ns.SourceInitEnd,yr.UPDATE)):this.on("inited",function(){u.log(ns.SourceInitStart,yr.UPDATE);var l=u.getSource();l?u.layerSource.setData(t,o):u.source(new f0(t,o)),u.layerSource.once("update",function(){u.log(ns.SourceInitEnd,yr.UPDATE)})}),this}},{key:"style",value:function(t){var o=this,u=t.passes,l=(0,rs.Z)(t,dE);u&&o_(u).forEach(function(v){var x=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(v[0]);x&&x.updateOptions(v[1])});var p=l;return Object.keys(l).forEach(function(v){var x=l[v];Array.isArray(x)&&x.length===2&&!h_(x[0])&&!h_(x[1])&&(p[v]={field:x[0],value:x[1]})}),this.encodeStyle(p),this.updateLayerConfig(p),this}},{key:"encodeStyle",value:function(t){var o=this;Object.keys(t).forEach(function(u){[].concat((0,cr.Z)(o.enableShaderEncodeStyles),(0,cr.Z)(o.enableDataEncodeStyles)).includes(u)&&xE(t[u])&&(t[u].field||t[u].value)&&!v0(o.encodeStyleAttribute[u],t[u])?(o.encodeStyleAttribute[u]=t[u],o.updateStyleAttribute(u,t[u].field,t[u].value),o.inited&&(o.dataState.dataMappingNeedUpdate=!0)):o.encodeStyleAttribute[u]&&(delete o.encodeStyleAttribute[u],o.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(t,o){var u=(0,O.Z)({},this.scaleOptions);if(au(t)?this.scaleOptions=(0,O.Z)((0,O.Z)({},this.scaleOptions),t):this.scaleOptions[t]=o,this.styleAttributeService&&!v0(u,this.scaleOptions)){var l=au(t)?t:(0,V.Z)({},t,o);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(t),this))}},{key:"renderMultiPass",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"active",value:function(t){var o={};return o.enableHighlight=au(t)?!0:t,au(t)?(o.enableHighlight=!0,t.color&&(o.highlightColor=t.color),t.mix&&(o.activeMix=t.mix)):o.enableHighlight=!!t,this.updateLayerConfig(o),this}},{key:"setActive",value:function(t,o){var u=this;if(au(t)){var l=t.x,p=l===void 0?0:l,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({highlightColor:au(o)?o.color:this.getLayerConfig().highlightColor,activeMix:au(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:au(o)?o.color:this.getLayerConfig().highlightColor,activeMix:au(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Ea(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(t){var o={};return o.enableSelect=au(t)?!0:t,au(t)?(o.enableSelect=!0,t.color&&(o.selectColor=t.color),t.mix&&(o.selectMix=t.mix)):o.enableSelect=!!t,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(t,o){var u=this;if(au(t)){var l=t.x,p=l===void 0?0:l,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({selectColor:au(o)?o.color:this.getLayerConfig().selectColor,selectMix:au(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:au(o)?o.color:this.getLayerConfig().selectColor,selectMix:au(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ea(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,l=o.minZoom,p=l===void 0?-Infinity:l,v=o.maxZoom,x=v===void 0?Infinity:v;return!!u&&t>=p&&t<x}},{key:"setMultiPass",value:function(t,o){if(this.updateLayerConfig({enableMultiPassRenderer:t}),o&&this.updateLayerConfig({passes:o}),t){var u=this.getLayerConfig(),l=u.passes,p=l===void 0?[]:l;this.multiPassRenderer=s_(this,p,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var v=this.rendererService.getViewportSize(),x=v.width,S=v.height;this.multiPassRenderer.resize(x,S)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){var t=this.getLayerConfig(),o=t.minZoom;return o}},{key:"getMaxZoom",value:function(){var t=this.getLayerConfig(),o=t.maxZoom;return o}},{key:"get",value:function(t){var o=this.getLayerConfig();return o[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,l=u.some(function(p){return Math.abs(p)===Infinity});return l?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],t),this)}},{key:"destroy",value:function(){var t,o,u,l,p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){this.layerChildren.map(function(S){return S.destroy(!1)}),this.layerChildren=[];var v=this.getLayerConfig(),x=v.maskfence;x&&(this.masks.map(function(S){return S.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(t=this.multiPassRenderer)===null||t===void 0||t.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(p),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],(l=this.debugService)===null||l===void 0||l.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach(function(o){return o.destroy()}),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices}).length}},{key:"setSource",value:function(t){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var p=l.type;if(o.coordCenter===void 0){var v,x=o.layerSource.center;o.coordCenter=x,(v=o.mapService)!==null&&v!==void 0&&v.setCoordCenter&&o.mapService.setCoordCenter(x)}if(p==="update"){if(o.tileLayer){o.tileLayer.reload();return}o.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var o,u,l,p=this.styleAttributeService.getLayerStyleAttribute(t),v=(p==null||(o=p.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(u=v[0].option)===null||u===void 0?void 0:u.type,field:p==null||(l=p.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var o=this.styleAttributeService.getLayerAttributeScale(t);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(v){return(0,V.Z)({value:o.invertExtent(v)},t,v)});return u}else if(o.ticks){var l=o.ticks().map(function(v){return(0,V.Z)({value:v},t,o(v))});return l}else if(o!=null&&o.domain){var p=o.domain().filter(function(v){return!bE(v)}).map(function(v){return(0,V.Z)({value:v},t,o(v))});return p}return[]}},{key:"pick",value:function(t){var o=t.x,u=t.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(t,o){this.pickingService.boxPickLayer(this,t,o)}},{key:"buildLayerModel",value:function(){var n=(0,It.Z)(he().mark(function o(u){var l=this,p,v,x,S,A,k,D,R,N,W,me,ye;return he().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return p=u.moduleName,v=u.vertexShader,x=u.fragmentShader,S=u.inject,A=u.triangulation,k=u.segmentNumber,D=(0,rs.Z)(u,vE),this.shaderModuleService.registerModule(p,{vs:v,fs:x,inject:S}),R=this.shaderModuleService.getModule(p),N=R.vs,W=R.fs,me=R.uniforms,ye=this.rendererService.createModel,Ue.abrupt("return",new Promise(function(tt){var Et=l.styleAttributeService.createAttributesAndIndices(l.encodedData,A,k),Vt=Et.attributes,Yt=Et.elements,gr=Et.count,hr=(0,O.Z)({attributes:Vt,uniforms:me,fs:W,vs:N,elements:Yt,blend:i_[zt.normal]},D);gr&&(hr.count=gr);var Hr=ye(hr);tt(Hr)}));case 5:case"end":return Ue.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"createAttributes",value:function(t){var o=t.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),l=u.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){var o=this.getLayerConfig(),u=o.enableHighlight,l=u===void 0?!0:u,p=o.enableSelect,v=p===void 0?!0:p,x=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&v&&(x=!0),t==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(x=!0),this.isVisible()&&x}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMulPass",value:function(){var n=(0,It.Z)(he().mark(function o(u){return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,u.render();case 2:case"end":return p.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var t=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(u){u.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(o)},(o==null?void 0:o.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(t,o,u,l){var p=this.configService.getAttributeConfig(this.id)||{};return v0(p[t],{field:o,values:u})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,(0,V.Z)({},t,{field:o,values:u})),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,O.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},l):this.pendingStyleAttributes.push({attributeName:t,attributeField:o,attributeValues:u,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"processData",value:function(t){return t}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.models.forEach(function(p){return p.destroy()}),this.models=[],l.next=4,this.layerModel.initModels();case 4:this.models=l.sent;case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t,o){return{values:f_(t)?void 0:t,callback:f_(t)?t:void 0}}}]),r}(ya.EventEmitter),l_=Kr(d0.prototype,"configService",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d0);function SE(e,i){return{enable:e,mask:255,func:{cmp:q.EQUAL,ref:i?1:0,mask:1}}}function d_(e){return e.maskOperation===ur.OR?{enable:!0,mask:255,func:{cmp:q.ALWAYS,ref:1,mask:255},opFront:{fail:q.KEEP,zfail:q.REPLACE,zpass:q.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===Zt.SINGLE||e.stencilIndex===0?q.ALWAYS:q.LESS,ref:e.stencilType===Zt.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:q.KEEP,zfail:q.REPLACE,zpass:q.REPLACE}}}function wE(e){switch(e){case"rotation":return{name:"Rotation",type:un.Attribute,descriptor:{name:"a_Rotation",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(r){var n=r.rotation,t=n===void 0?0:n;return Array.isArray(t)?[t[0]]:[t]}}};case"stroke":return{name:"stroke",type:un.Attribute,descriptor:{name:"a_Stroke",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(r){var n=r.stroke,t=n===void 0?[1,1,1,1]:n;return t}}};case"opacity":return{name:"opacity",type:un.Attribute,descriptor:{name:"a_Opacity",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(r){var n=r.opacity,t=n===void 0?1:n;return[t]}}};case"extrusionBase":return{name:"extrusionBase",type:un.Attribute,descriptor:{name:"a_ExtrusionBase",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(r){var n=r.extrusionBase,t=n===void 0?0:n;return[t]}}};case"offsets":return{name:"offsets",type:un.Attribute,descriptor:{name:"a_Offsets",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(r){var n=r.offsets;return n}}};default:return}}var v_,m0,m_,ua=(v_=u0(et.IGlobalConfigService),m0=function(){function e(i){(0,be.Z)(this,e),(0,V.Z)(this,"preStyleAttribute",{}),(0,V.Z)(this,"encodeStyleAttribute",{}),on(this,"configService",m_,this),this.layer=i,this.rendererService=i.getContainer().get(et.IRendererService),this.pickingService=i.getContainer().get(et.IPickingService),this.shaderModuleService=i.getContainer().get(et.IShaderModuleService),this.styleAttributeService=i.getContainer().get(et.IStyleAttributeService),this.mapService=i.getContainer().get(et.IMapService),this.iconService=i.getContainer().get(et.IIconService),this.fontService=i.getContainer().get(et.IFontService),this.cameraService=i.getContainer().get(et.ICameraService),this.layerService=i.getContainer().get(et.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r}return(0,J.Z)(e,[{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,t=n===void 0?"normal":n;return i_[zt[t]]}},{key:"getStencil",value:function(r){var n=this.layer.getLayerConfig(),t=n.mask,o=t===void 0?!1:t,u=n.maskInside,l=u===void 0?!0:u,p=n.enableMask,v=n.maskOperation,x=v===void 0?ur.AND:v;if(this.layer.type==="MaskLayer")return d_({isStencil:!0,stencilType:Zt.SINGLE});if(r.isStencil)return d_((0,O.Z)((0,O.Z)({},r),{},{maskOperation:x}));var S=o||p&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return SE(S,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var i=(0,It.Z)(he().mark(function n(){return he().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",!1);case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var i=(0,It.Z)(he().mark(function n(){return he().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var i=(0,It.Z)(he().mark(function n(){return he().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(r){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var r=this.layer.encodeStyleAttribute,n="",t={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float"};this.layer.enableShaderEncodeStyles.forEach(function(u){r[u]&&(n+="#define USE_ATTRIBUTE_".concat(u.toUpperCase(),` 0.0; 

`)),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(u.toUpperCase(),`
      attribute `).concat(t[u]," a_").concat(u.charAt(0).toUpperCase()+u.slice(1),`;
    #else
      uniform `).concat(t[u]," u_").concat(u,`;
    #endif

    `)});var o="";return this.layer.enableShaderEncodeStyles.forEach(function(u){o+=`

#ifdef USE_ATTRIBUTE_`.concat(u.toUpperCase(),`
  `).concat(t[u]," ").concat(u,"  = a_").concat(u.charAt(0).toUpperCase()+u.slice(1),`;
#else
  `).concat(t[u]," ").concat(u," = u_").concat(u,`;
#endif

`)}),{"vs:#decl":n,"vs:#main-start":o}}},{key:"getStyleAttribute",value:function(){var r=this,n={},t={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0};return this.layer.enableShaderEncodeStyles.forEach(function(o){if(!r.layer.encodeStyleAttribute[o]){var u=r.layer.getLayerConfig()[o],l=typeof u=="undefined"?t[o]:u;o==="stroke"&&(l=Hn(l)),n["u_"+o]=l}}),n}},{key:"registerStyleAttribute",value:function(){var r=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var t=wE(n);t&&r.styleAttributeService.registerStyleAttribute(t)})}},{key:"updateEncodeAttribute",value:function(r,n){this.encodeStyleAttribute[r]=n}}]),e}(),m_=Kr(m0.prototype,"configService",[v_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m0),g0=100,RR=36,DR=40;function g_(e){return e/180*Math.acos(-1)}function y_(e){var i=g_(e[0])+Math.PI/2,r=g_(e[1]),n=g0+Math.random()*.4,t=n*Math.cos(r)*Math.cos(i),o=n*Math.cos(r)*Math.sin(i),u=n*Math.sin(r);return[o,u,t]}function OR(e,i){var r=mat4.create(),n=mat4.create(),t=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var u=typeof i.segments!="undefined"?i.segments:32,l=2+u,p=2*l,v=[],x=[],S=[],A=[],k=[],D=[],R=0;R<=l;R++){for(var N=R/l,W=N*Math.PI,me=0;me<=p;me++){var ye=me/p,Ne=ye*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-W),mat4.identity(r),mat4.rotateY(r,r,Ne),vec3.transformMat4(o,t,n),vec3.transformMat4(o,o,r),vec3.scale(o,o,-e),S.push(o.slice()),A.push.apply(A,_toConsumableArray(o.slice())),vec3.normalize(o,o),k.push.apply(k,_toConsumableArray(o.slice())),D.push([ye,1-N]),A.push(ye,1-N)}if(R>0)for(var Ue=S.length,tt=Ue-2*(p+1);tt+p+2<Ue;tt++)v.push([tt,tt+1,tt+p+1]),x.push(tt,tt+1,tt+p+1),v.push([tt+p+1,tt+1,tt+p+2]),x.push(tt+p+1,tt+1,tt+p+2)}return{cells:v,positions:S,uvs:D,positionsArr:A,indicesArr:x,normalArr:k}}var fm=Ir.create(),FR=Ir.create(),vs=Ir.create(),Fh=Ir.create(),sd=Ir.create();function y0(e,i,r,n,t){Ir.add(e,r,n),Ir.normalize(e,e),i=Ir.fromValues(-e[1],e[0]);var o=Ir.fromValues(-r[1],r[0]);return[t/Ir.dot(i,o),i]}function Bh(e,i){return Ir.set(e,-i[1],i[0])}function ud(e,i,r){return Ir.sub(e,i,r),Ir.normalize(e,e),e}function _0(e,i){return e[0]===i[0]&&e[1]===i[1]}function BR(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var EE=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,be.Z)(this,e),(0,V.Z)(this,"lastFlip",-1),(0,V.Z)(this,"miter",Ir.fromValues(0,0)),(0,V.Z)(this,"started",!1),(0,V.Z)(this,"dash",!1),(0,V.Z)(this,"totalDistance",0),(0,V.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,J.Z)(e,[{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],k=r[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],R=l<r.length-1?[].concat((0,cr.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,N=l<n.length-1?n[l+1]:null,W=this.simpleSegment(t,u,S,k,R,A,D,N);u+=W}if(this.dash)for(var me=0;me<t.positions.length/6;me++)t.positions[me*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],k=r[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],R=l<r.length-1?[].concat((0,cr.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,N=l<n.length-1?n[l+1]:null,W=this.segment_gaode2(t,u,S,k,R,A,D,N);u+=W}if(this.dash)for(var me=0;me<t.positions.length/6;me++)t.positions[me*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=Da([o[0],o[1]]),A=Da([t[0],t[1]]);ud(vs,S,A);var k=0;if(this.dash&&(k=this.lineSegmentDistance(S,A),this.totalDistance+=k),this.normal||(this.normal=Ir.create(),Bh(this.normal,vs)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-k)),p.push(n+0,n+1,n+2),!u)Bh(this.normal,vs),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var D=Da([u[0],u[1]]);_0(S,D)&&Ir.add(D,S,Ir.normalize(D,Ir.subtract(D,S,A))),ud(Fh,D,S);var R=y0(sd,Ir.create(),vs,Fh,this.thickness),N=(0,K.Z)(R,2),W=N[0],me=N[1],ye=Ir.dot(sd,this.normal)<0?-1:1;this.extrusions(v,x,o,me,W,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ye=-1,Ir.copy(this.normal,me),l+=2,this.lastFlip=ye}return l}},{key:"segment_gaode2",value:function(r,n,t,o,u,l,p,v){var x=0,S=r.indices,A=r.positions,k=r.normals,D=this.cap==="square",R=this.join==="bevel",N=Da([p[0],p[1]]),W=Da([l[0],l[1]]);ud(vs,o,t);var me=0;if(this.dash&&(me=this.lineSegmentDistance(N,W),this.totalDistance+=me),this.normal||(this.normal=Ir.create(),Bh(this.normal,vs)),!this.started)if(this.started=!0,D){var ye=Ir.create(),Ne=Ir.create();Ir.add(ye,this.normal,vs),Ir.add(Ne,this.normal,vs),k.push(Ne[0],Ne[1],0),k.push(ye[0],ye[1],0),A.push(t[0],t[1],t[2]|0,this.totalDistance-me,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),A.push(t[0],t[1],t[2]|0,this.totalDistance-me,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,k,t,this.normal,this.thickness,this.totalDistance-me);if(S.push(n+0,n+1,n+2),u){_0(o,u)&&Ir.add(u,o,Ir.normalize(u,Ir.subtract(u,o,t))),ud(Fh,u,o);var Et=y0(sd,Ir.create(),vs,Fh,this.thickness),Vt=(0,K.Z)(Et,2),Yt=Vt[0],gr=Vt[1],hr=Ir.dot(sd,this.normal)<0?-1:1,Hr=R;if(!Hr&&this.join==="miter"){var fn=Yt;fn>this.miterLimit&&(Hr=!0)}Hr?(k.push(this.normal[0],this.normal[1],0),k.push(gr[0],gr[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*hr,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*hr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,S.push.apply(S,(0,cr.Z)(this.lastFlip!==-hr?[n,n+2,n+3]:[n+2,n+1,n+3])),S.push(n+2,n+3,n+4),Bh(fm,Fh),Ir.copy(this.normal,fm),k.push(this.normal[0],this.normal[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*hr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(A,k,o,gr,Yt,this.totalDistance),S.push.apply(S,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),hr=-1,Ir.copy(this.normal,gr),x+=2),this.lastFlip=hr}else{if(Bh(this.normal,vs),D){var Ue=Ir.create(),tt=Ir.create();Ir.sub(tt,vs,this.normal),Ir.add(Ue,vs,this.normal),k.push(tt[0],tt[1],0),k.push(Ue[0],Ue[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,k,o,this.normal,this.thickness,this.totalDistance);S.push.apply(S,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"segment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=this.cap==="square",A=this.join==="bevel",k=Da([o[0],o[1]]),D=Da([t[0],t[1]]);ud(vs,k,D);var R=0;if(this.dash&&(R=this.lineSegmentDistance(k,D),this.totalDistance+=R),this.normal||(this.normal=Ir.create(),Bh(this.normal,vs)),!this.started)if(this.started=!0,S){var N=Ir.create(),W=Ir.create();Ir.add(N,this.normal,vs),Ir.add(W,this.normal,vs),x.push(W[0],W[1],0),x.push(N[0],N[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-R,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-R,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-R);if(p.push(n+0,n+1,n+2),u){var Ne=Da([u[0],u[1]]);_0(k,Ne)&&Ir.add(Ne,k,Ir.normalize(Ne,Ir.subtract(Ne,k,D))),ud(Fh,Ne,k);var Ue=y0(sd,Ir.create(),vs,Fh,this.thickness),tt=(0,K.Z)(Ue,2),Et=tt[0],Vt=tt[1],Yt=Ir.dot(sd,this.normal)<0?-1:1,gr=A;if(!gr&&this.join==="miter"){var hr=Et;hr>this.miterLimit&&(gr=!0)}gr?(x.push(this.normal[0],this.normal[1],0),x.push(Vt[0],Vt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,cr.Z)(this.lastFlip!==-Yt?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),Bh(fm,Fh),Ir.copy(this.normal,fm),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Vt,Et,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Yt=-1,Ir.copy(this.normal,Vt),l+=2),this.lastFlip=Yt}else{if(Bh(this.normal,vs),S){var me=Ir.create(),ye=Ir.create();Ir.sub(ye,vs,this.normal),Ir.add(me,vs,this.normal),x.push(ye[0],ye[1],0),x.push(me[0],me[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,t,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,l,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,l,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}(),ca=z(77160);function AE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,t=xo().flatten(e),o=t.vertices,u=t.dimensions,l=[],p=[],v=0;v<o.length/u;v++)u===2?l.push(o[v*2],o[v*2+1],1):l.push(o[v*3],o[v*3+1],1);var x=xo()(t.vertices,t.holes,t.dimensions);p.push.apply(p,(0,cr.Z)(x));for(var S=function(){var D=t.vertices.slice(A*u,(A+1)*u),R=t.vertices.slice((A+1)*u,(A+2)*u);R.length===0&&(R=t.vertices.slice(0,u));var N=l.length/3;l.push(D[0],D[1],1,R[0],R[1],1,D[0],D[1],0,R[0],R[1],0),p.push.apply(p,(0,cr.Z)([0,2,1,2,3,1].map(function(W){return W+N})))},A=0;A<n;A++)S();return{positions:l,index:p}}function CE(e){var i=xo().flatten(e),r=xo()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function __(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var t=e[0].length,o=xo().flatten(e),u=o.vertices,l=o.dimensions,p=[],v=[],x=[],S=0;S<u.length/l;S++)p.push(u[S*l],u[S*l+1],1,-1,-1),x.push(0,0,1);var A=xo()(o.vertices,o.holes,o.dimensions);v.push.apply(v,(0,cr.Z)(A));for(var k=function(){var N=o.vertices.slice(D*l,(D+1)*l),W=o.vertices.slice((D+1)*l,(D+2)*l);W.length===0&&(W=o.vertices.slice(0,l));var me=p.length/5;p.push(N[0],N[1],1,0,0,W[0],W[1],1,.1,0,N[0],N[1],0,0,.8,W[0],W[1],0,.1,.8);var ye=TE([W[0],W[1],1],[N[0],N[1],0],[N[0],N[1],1],i);x.push.apply(x,(0,cr.Z)(ye).concat((0,cr.Z)(ye),(0,cr.Z)(ye),(0,cr.Z)(ye))),v.push.apply(v,(0,cr.Z)([1,2,0,3,2,1].map(function(Ne){return Ne+me})))},D=0;D<t;D++)k();return{positions:p,index:v,normals:x}}function TE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=ca.create(),o=ca.create(),u=ca.create();n&&(e=mc(e),i=mc(i),r=mc(r));var l=ca.fromValues.apply(ca,(0,cr.Z)(e)),p=ca.fromValues.apply(ca,(0,cr.Z)(i)),v=ca.fromValues.apply(ca,(0,cr.Z)(r));ca.sub(t,v,p),ca.sub(o,l,p),ca.cross(u,t,o);var x=ca.create();return ca.normalize(x,u),x}var ic,cv=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),fv=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function hv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],t=0;t<e;t++)n.push(r*t+i*Math.PI/12);var o=n.map(function(u){var l=Math.sin(u+Math.PI/4),p=Math.cos(u+Math.PI/4);return[l,p,0]});return o}function x_(){return hv(30)}function b_(){return hv(4)}function S_(){return hv(3)}function w_(){return hv(6,1)}function E_(){return hv(5)}var ld=(ic={},(0,V.Z)(ic,fv.CIRCLE,x_),(0,V.Z)(ic,fv.HEXAGON,w_),(0,V.Z)(ic,fv.TRIANGLE,S_),(0,V.Z)(ic,fv.SQUARE,b_),(0,V.Z)(ic,fv.PENTAGON,E_),(0,V.Z)(ic,cv.CYLINDER,x_),(0,V.Z)(ic,cv.HEXAGONCOLUMN,w_),(0,V.Z)(ic,cv.TRIANGLECOLUMN,S_),(0,V.Z)(ic,cv.SQUARECOLUMN,b_),(0,V.Z)(ic,cv.PENTAGONCOLUMN,E_),ic),hm={};function pm(e){var i=xs(e.coordinates);return{vertices:[].concat((0,cr.Z)(i),(0,cr.Z)(i),(0,cr.Z)(i),(0,cr.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function A_(e){var i=xs(e.coordinates),r=y_(i);return{vertices:[].concat((0,cr.Z)(r),(0,cr.Z)(r),(0,cr.Z)(r),(0,cr.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function x0(e){var i=e.shape,r=OE(i,!1),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function ME(e){var i=xs(e.coordinates);return{vertices:(0,cr.Z)(i),indices:[0],size:i.length}}function b0(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new EE({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(A){t.extrude(A)})}var S=t.complex;return{vertices:S.positions,indices:S.indices,normals:S.normals,indexes:S.indexes,size:6}}function kE(e){var i=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat((0,cr.Z)(i),[1,2,-3],(0,cr.Z)(i),[1,1,-3],(0,cr.Z)(i),[0,1,0],(0,cr.Z)(i),[0,0,0],(0,cr.Z)(i),[1,0,0],(0,cr.Z)(i),[1,2,-3],(0,cr.Z)(i),[1,1,-3],(0,cr.Z)(i),[0,1,0],(0,cr.Z)(i),[0,0,0],(0,cr.Z)(i)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function zR(e){var i=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat(_toConsumableArray(i),[1,2,-3],_toConsumableArray(i),[1,1,-3],_toConsumableArray(i),[0,1,0],_toConsumableArray(i),[0,0,0],_toConsumableArray(i)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1],indices:[0,1,1,2,2,3,3,4,4,0],size:7}}function IE(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=PE(i),t=n.results,o=n.totalDistance;return t.map(function(u){r.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:r,indices:[],normals:[],size:6,count:t.length}}function NR(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],size:4,count:0};var n=LE(i),t=n.results;return t.map(function(o){r.push(o[0],o[1],o[2],o[3])}),{vertices:r,indices:[],size:4,count:t.length}}function C_(e,i){var r=i[0]-e[0],n=i[1]-e[1];return Math.sqrt(r*r+n*n)}function cd(e,i){return e.length<3&&e.push(0),i!==void 0&&e.push(i),e}function PE(e){var i=e;Array.isArray(i)&&Array.isArray(i[0])&&Array.isArray(i[0][0])&&(i=e.flat());var r=0;if(i.length<2)return{results:i,totalDistance:0};var n=[],t=cd(i[0],r);n.push(t);for(var o=1;o<i.length-1;o++){var u=C_(i[o-1],i[o]);r+=u;var l=cd(i[o],r);n.push(l),n.push(l)}var p=C_(i[i.length-2],i[i.length-1]);return r+=p,n.push(cd(i[i.length-1],r)),{results:n,totalDistance:r}}function LE(e){if(e.length<2)return{results:e};var i=[],r=cd(e[0]);i.push(r);for(var n=1;n<e.length-1;n++){var t=cd(e[n]);i.push(t),i.push(t)}return i.push(cd(e[e.length-1])),{results:i}}function S0(e){var i=e.coordinates,r=xo().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:xo()(n,o,t),vertices:n,size:t}}function RE(e){var i=e.coordinates,r=xo().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:xo()(n,o,t),vertices:DE(n),size:t+4}}function DE(e){for(var i=[],r=Vh(e),n=r.center,t=r.radius,o=0;o<e.length;o+=2){var u=e[o],l=e[o+1];i.push.apply(i,[u,l,0].concat((0,cr.Z)(n),[t]))}return i}function w0(e){var i=e.coordinates,r=__(i,!0),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function T_(e){var i=e.shape,r=BE(i),n=r.positions,t=r.index;return{vertices:n,indices:t,size:3}}function dm(e){var i=e.coordinates,r=[].concat((0,cr.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,cr.Z)(i[1]),[0,1,0],(0,cr.Z)(i[0]),[0,0,1],(0,cr.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function vm(e,i){for(var r=i||30,n=e.coordinates,t=[],o=[],u=function(v){t.push(v,1,v,n[0][0],n[0][1],n[1][0],n[1][1],v,-1,v,n[0][0],n[0][1],n[1][0],n[1][1]),v!==r-1&&o.push.apply(o,(0,cr.Z)([0,1,2,1,3,2].map(function(x){return v*2+x})))},l=0;l<r;l++)u(l);return{vertices:t,indices:o,size:7}}function M_(e){var i=e.coordinates;i.length===2&&i.push(0);var r=mm(-1,1),n=mm(1,1),t=mm(-1,-1),o=mm(1,-1),u=[].concat((0,cr.Z)(i),(0,cr.Z)(r),(0,cr.Z)(i),(0,cr.Z)(t),(0,cr.Z)(i),(0,cr.Z)(o),(0,cr.Z)(i),(0,cr.Z)(n)),l=[0,1,2,3,0,2];return{vertices:u,indices:l,size:5}}function OE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(hm&&hm[e])return hm[e];var r=ld[e]?ld[e]():ld.cylinder(),n=__([r],i);return hm[e]=n,n}function ZR(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=new Float32Array(e.length/r*3),o,u,l,p=vec3.create(),v=vec3.create(),x=vec3.create(),S=0,A=i.length;S<A;S+=3){o=i[S+0]*3,u=i[S+1]*3,l=i[S+2]*3;var k=[e[o],e[o+1]],D=[e[u],e[u+1]],R=[e[l],e[l+1]];n&&(k=lngLatToMeters(k),D=lngLatToMeters(D),R=lngLatToMeters(R));var N=k,W=_slicedToArray(N,2),me=W[0],ye=W[1],Ne=vec3.fromValues(me,ye,e[o+2]),Ue=D,tt=_slicedToArray(Ue,2),Et=tt[0],Vt=tt[1],Yt=vec3.fromValues(Et,Vt,e[u+2]),gr=R,hr=_slicedToArray(gr,2),Hr=hr[0],fn=hr[1],Rn=vec3.fromValues(Hr,fn,e[l+2]);vec3.sub(p,Rn,Yt),vec3.sub(v,Ne,Yt),vec3.cross(x,p,v),t[o]+=p[0],t[o+1]+=p[1],t[o+2]+=p[2],t[u]+=p[0],t[u+1]+=p[1],t[u+2]+=p[2],t[l]+=p[0],t[l+1]+=p[1],t[l+2]+=p[2]}return FE(t),t}function FE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),t=vec3.create();vec3.normalize(t,n),e.set(t,i)}}function UR(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function BE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=ld[e]?ld[e]():ld.circle(),n=i.indexOf(e)===-1?CE([r]):AE([r]);return n}function mm(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function VR(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function jR(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function zE(e){var i=NE();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function NE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,UE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,VE=function(e){(0,lt.Z)(r,e);var i=zE(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.baseColor,p=l===void 0?"rgb(16,16,16)":l,v=t.brightColor,x=v===void 0?"rgb(255,176,38)":v,S=t.windowColor,A=S===void 0?"rgb(30,60,89)":S,k=t.time,D=k===void 0?0:k,R=t.sweep,N=R===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:R;return{u_cityCenter:N.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*N.sweepRadius,u_circleSweep:N.enable?1:0,u_circleSweepColor:Hn(N.sweepColor).slice(0,3),u_circleSweepSpeed:N.sweepSpeed,u_opacity:u,u_baseColor:Hn(p),u_brightColor:Hn(x),u_windowColor:Hn(A),u_time:this.layer.getLayerAnimateTime()||D}}},{key:"calCityGeo",value:function(){var t=(0,K.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],l=t[2],p=t[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+o)/2,(p+u)/2]);var v=this.mapService.lngLatToCoord([l,p]),x=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(v[0]-x[0],2)+Math.pow(v[1]-x[1],2))/4}else{var S=l-o,A=p-u;this.cityCenter=[(l+o)/2,(p+u)/2],this.cityMinSize=Math.sqrt(Math.pow(S,2)+Math.pow(A,2))/4}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:UE,fragmentShader:ZE,triangulation:w0,depth:{enable:!0},cull:{enable:!0,face:q.BACK}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:un.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?10:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(ua);function jE(e){var i=GE();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function GE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HE=function(e){(0,lt.Z)(r,e);var i=jE(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"type","CityBuildingLayer"),n}return(0,J.Z)(r,[{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new VE(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Oh);function WE(e){var i=$E();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function $E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
\r
varying vec4 v_color;\r
\r
uniform vec2 u_sceneCenterMercator;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,YE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,qE=function(e){(0,lt.Z)(r,e);var i=WE(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:XE,fragmentShader:YE,triangulation:T_,primitive:q.TRIANGLES,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:un.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(ua);function KE(e){var i=JE();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function JE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,eA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,tA=function(e){(0,lt.Z)(r,e);var i=KE(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:QE,fragmentShader:eA,triangulation:x0,primitive:q.TRIANGLES,depth:{enable:!0}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:un.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:un.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(ua);function rA(e,i){for(var r=[],n=[],t=[],o=e+1,u=i+1,l=e/2,p=i/2,v=0;v<u;v++)for(var x=v-p,S=0;S<o;S++){var A=S-l;n.push(A/l,-x/p,0),t.push(S/e),t.push(1-v/i)}for(var k=0;k<i;k++)for(var D=0;D<e;D++){var R=D+o*k,N=D+o*(k+1),W=D+1+o*(k+1),me=D+1+o*k;r.push(R,N,me),r.push(N,W,me)}return{vertices:n,indices:r,uvs:t}}var k_,I_;function nA(e){var i=iA();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function iA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aA=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,oA=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,sA=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,uA=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,lA=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,cA=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;


#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,fA=ii.isEqual,P_=(k_=(0,ut.b2)(),k_(I_=function(e){(0,lt.Z)(r,e);var i=nA(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"render",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.useFramebuffer,v=this.layer.getLayerConfig(),x=v.rampColors;p(this.heatmapFramerBuffer,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),fA(this.preRampColors,x)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode(t):this.draw3DHeatMap(t)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S,A,k,D,R;return he().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return l=this.rendererService,p=l.createFramebuffer,v=l.getViewportSize,x=l.createTexture2D,S=this.styleAttributeService.getLayerStyleAttribute("shape"),A=(S==null||(u=S.scale)===null||u===void 0?void 0:u.field)||"heatmap",this.shapeType=A,W.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=W.sent,this.colorModel=A==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),k=v(),D=k.width,R=k.height,this.heatmapFramerBuffer=p({color:x({width:Math.floor(D/4),height:Math.floor(R/4),wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.LINEAR,mag:q.LINEAR}),depth:!1}),this.updateColorTexture(),W.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return W.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:un.Attribute,descriptor:{name:"a_Dir",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=M_,p.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:cA,fragmentShader:lA,triangulation:M_,depth:{enable:!1},cull:{enable:!0,face:ga(this.mapService.version)}});case 3:return u=p.sent,p.abrupt("return",u);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:uA,fs:sA});var t=this.shaderModuleService.getModule("heatmapColor"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService,v=p.createAttribute,x=p.createElements,S=p.createBuffer,A=p.createModel;return A({vs:o,fs:u,attributes:{a_Position:v({buffer:S({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:q.FLOAT}),size:3}),a_Uv:v({buffer:S({data:[0,1,1,1,0,0,1,0],type:q.FLOAT}),size:2})},uniforms:(0,O.Z)({},l),depth:{enable:!1},elements:x({data:[0,2,1,2,3,1],type:q.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,l=o.intensity,p=l===void 0?10:l,v=o.radius,x=v===void 0?5:v;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_radius:x,u_intensity:p},blend:{enable:!0,func:{srcRGB:q.ONE,srcAlpha:1,dstRGB:q.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(t){var o,u=this.layer.getLayerConfig(),l=u.opacity;(o=this.colorModel)===null||o===void 0||o.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(t)})}},{key:"draw3DHeatMap",value:function(t){var o,u=this.layer.getLayerConfig(),l=u.opacity,p=vt();ui(p,this.cameraService.getViewProjectionMatrixUncentered()),(o=this.colorModel)===null||o===void 0||o.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,cr.Z)(p)},blend:{enable:!0,func:{srcRGB:q.SRC_ALPHA,srcAlpha:1,dstRGB:q.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}},{key:"build3dHeatMap",value:function(){var t=this.rendererService.getViewportSize,o=t(),u=o.width,l=o.height,p=rA(u/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:oA,fs:aA});var v=this.shaderModuleService.getModule("heatmap3dColor"),x=v.vs,S=v.fs,A=v.uniforms,k=this.rendererService,D=k.createAttribute,R=k.createElements,N=k.createBuffer,W=k.createModel;return W({vs:x,fs:S,attributes:{a_Position:D({buffer:N({data:p.vertices,type:q.FLOAT}),size:3}),a_Uv:D({buffer:N({data:p.uvs,type:q.FLOAT}),size:2})},primitive:q.TRIANGLES,uniforms:(0,O.Z)({},A),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:q.SRC_ALPHA,srcAlpha:1,dstRGB:q.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:R({data:p.indices,type:q.UNSIGNED_INT,count:p.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,l=zi(u);this.colorTexture=t({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.NEAREST,mag:q.NEAREST,flipY:!1}),this.preRampColors=u}}]),r}(ua))||I_);function hA(e){var i=pA();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function pA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,vA=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,mA=function(e){(0,lt.Z)(r,e);var i=hA(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:vA,fragmentShader:dA,triangulation:T_,depth:{enable:!1},primitive:q.TRIANGLES});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:un.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(ua),gA={heatmap:P_,heatmap3d:P_,grid:qE,grid3d:tA,hexagon:mA},yA=gA;function _A(e){var i=xA();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bA=function(e){(0,lt.Z)(r,e);var i=_A(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"type","HeatMapLayer"),n}return(0,J.Z)(r,[{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new yA[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var t=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=this.getModelType();return u==="heatmap"?(this.layerModel&&this.layerModel.render(o),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(o)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),l=u.shape3d,p=this.getSource(),v=p.data.type,x=(o==null||(t=o.scale)===null||t===void 0?void 0:t.field)||"heatmap";return x==="heatmap"||x==="heatmap3d"?"heatmap":v==="hexagon"?(l==null?void 0:l.indexOf(x))===-1?"hexagon":"grid3d":v==="grid"?(l==null?void 0:l.indexOf(x))===-1?"grid":"grid3d":"heatmap"}}]),r}(Oh);function SA(e){var i=wA();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function wA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EA=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
  if(gl_FragColor.a < 0.01)
    discard;
}
`,AA=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,CA=function(e){(0,lt.Z)(r,e);var i=SA(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,this.texture=l({height:0,width:0}),S.next=5,u.data.images;case 5:return p=S.sent,this.texture=l({data:p[0],width:p[0].width,height:p[0].height,mag:q.LINEAR,min:q.LINEAR}),S.next=9,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:AA,fragmentShader:EA,triangulation:dm,primitive:q.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 9:return v=S.sent,S.abrupt("return",[v]);case 11:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(ua),TA={image:CA},MA=TA;function kA(e){var i=IA();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function IA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L_=function(e){(0,lt.Z)(r,e);var i=kA(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"type","ImageLayer"),n}return(0,J.Z)(r,[{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new MA[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={image:{}};return o[t]}},{key:"getModelType",value:function(){return"image"}}]),r}(Oh);function PA(e){var i=LA();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function LA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RA=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_distance_ratio;

uniform float segmentNumber;


#pragma include "picking"

void main() {
  gl_FragColor = v_color;


  float flag = 0.;
  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,DA=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;
varying float v_distance_ratio;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));
 
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,OA=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_color;
  
  gl_FragColor.a *= u_opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,FA=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;
varying vec2 v_distance_ratio;

uniform float u_opacity: 1.0;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

 v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
 v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,BA=`varying vec4 v_color;

#pragma include "picking"

void main() {
// \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}`,zA=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;
varying float v_segmentIndex;

uniform float u_lineDir: 1.0;
uniform float u_opacity: 1.0;

uniform float u_thetaOffset: 0.314;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;




#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  v_color.a *= u_opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,NA={solid:0,dash:1},ZA=ii.isNumber,UA=function(e){(0,lt.Z)(r,e);var i=PA(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,A=S===void 0?"solid":S,k=t.dashArray,D=k===void 0?[10,5]:k,R=t.forward,N=R===void 0?!0:R,W=t.lineTexture,me=W===void 0?!1:W,ye=t.iconStep,Ne=ye===void 0?100:ye,Ue=t.segmentNumber,tt=Ue===void 0?30:Ue,Et=t.thetaOffset,Vt=Et===void 0?.314:Et;D.length===2&&D.push(0,0);var Yt=0,gr=[0,0,0,0],hr=[0,0,0,0];return l&&p&&(gr=Hn(l),hr=Hn(p),Yt=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:Vt,u_opacity:ZA(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:tt,u_line_type:NA[A||"solid"],u_dash_array:D,u_blur:.9,u_lineDir:N?1:-1,u_texture:this.texture,u_line_texture:me?1:0,u_icon_step:Ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Yt,u_sourceColor:gr,u_targetColor:hr}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.lineType;return l==="dash"?{frag:RA,vert:DA,type:"Dash"}:o&&u?{frag:BA,vert:zA,type:"Linear"}:{frag:OA,vert:FA,type:""}}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S,A,k;return he().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,R.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+A,vertexShader:S,fragmentShader:x,triangulation:vm,depth:{enable:!1},segmentNumber:p});case 4:return k=R.sent,R.abrupt("return",[k]);case 6:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:un.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ua);function VA(e){var i=jA();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function jA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
uniform float u_opacity;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,HA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,WA=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,$A=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,XA={solid:0,dash:1},YA=function(e){(0,lt.Z)(r,e);var i=VA(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.textureBlend,p=l===void 0?"normal":l,v=t.lineType,x=v===void 0?"solid":v,S=t.dashArray,A=S===void 0?[10,5]:S,k=t.lineTexture,D=k===void 0?!1:k,R=t.iconStep,N=R===void 0?100:R,W=t.segmentNumber,me=W===void 0?30:W,ye=t.globalArcHeight,Ne=ye===void 0?10:ye;A.length===2&&A.push(0,0);var Ue=0,tt=[0,0,0,0],Et=[0,0,0,0];return o&&u&&(tt=Hn(o),Et=Hn(u),Ue=1),this.rendererService.getDirty()&&this.texture.bind(),(0,O.Z)({u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:g0,u_global_height:Ne,u_textureBlend:p==="normal"?0:1,segmentNumber:me,u_line_type:XA[x]||0,u_dash_array:A,u_texture:this.texture,u_line_texture:D?1:0,u_icon_step:N,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ue,u_sourceColor:tt,u_targetColor:Et},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:WA,vert:$A,type:"Linear"}:{frag:GA,vert:HA,type:""}}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S,A,k;return he().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,R.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+A,vertexShader:S,fragmentShader:x,inject:this.getInject(),triangulation:vm,segmentNumber:p});case 4:return k=R.sent,R.abrupt("return",[k]);case 6:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:un.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ua);function qA(e){var i=KA();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function KA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
uniform float u_opacity;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,QA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,eC=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,tC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,rC={solid:0,dash:1},nC=function(e){(0,lt.Z)(r,e);var i=qA(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,A=S===void 0?"solid":S,k=t.dashArray,D=k===void 0?[10,5]:k,R=t.lineTexture,N=R===void 0?!1:R,W=t.iconStep,me=W===void 0?100:W,ye=t.segmentNumber,Ne=ye===void 0?30:ye,Ue=t.globalArcHeight,tt=Ue===void 0?10:Ue;D.length===2&&D.push(0,0);var Et=0,Vt=[0,0,0,0],Yt=[0,0,0,0];return l&&p&&(Vt=Hn(l),Yt=Hn(p),Et=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:g0,u_global_height:tt,u_opacity:u,u_textureBlend:x==="normal"?0:1,segmentNumber:Ne,u_line_type:rC[A]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:N?1:0,u_icon_step:me,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Et,u_sourceColor:Vt,u_targetColor:Yt}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:eC,vert:tC,type:"Linear"}:{frag:JA,vert:QA,type:""}}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S,A,k;return he().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,R.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+A,vertexShader:S,fragmentShader:x,triangulation:vm,depth:{enable:!0},segmentNumber:p});case 4:return k=R.sent,R.abrupt("return",[k]);case 6:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:un.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ua);function iC(e){var i=aC();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function aC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oC=`#extension GL_OES_standard_derivatives : enable

varying vec4 v_color;


// line texture

#pragma include "picking"

void main() {
gl_FragColor = v_color;
gl_FragColor = filterColor(gl_FragColor);
}
`,sC=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec4 a_Instance;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


#pragma include "projection"
#pragma include "picking"
varying vec4 v_color;
uniform float u_gap_width: 1.0;
uniform float u_stroke_width: 1.0;
uniform float u_stroke_opacity: 1.0;


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = normalize(target - source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);


  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel(a_Position.yz);
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.8), project_pixel(lengthCommon*.8)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel(a_Normal.xy);

  float gapCommon =  project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );


  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,uC=function(e){(0,lt.Z)(r,e);var i=iC(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.gapWidth,u=o===void 0?2:o,l=t.strokeWidth,p=l===void 0?1:l,v=t.stroke,x=v===void 0?"#000":v,S=t.strokeOpacity,A=S===void 0?1:S;return(0,O.Z)({u_gap_width:u,u_stroke_width:p,u_stroke:Hn(x),u_stroke_opacity:A},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:sC,fragmentShader:oC,inject:this.getInject(),triangulation:kE,primitive:q.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:un.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(o,u,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:un.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}})}}]),r}(ua);function lC(e){var i=cC();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function cC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying vec4 v_line_data;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,hC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }



  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,pC={solid:0,dash:1},dC=function(e){(0,lt.Z)(r,e);var i=lC(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,A=S===void 0?"solid":S,k=t.dashArray,D=k===void 0?[10,5]:k,R=t.lineTexture,N=R===void 0?!1:R,W=t.iconStep,me=W===void 0?100:W,ye=t.segmentNumber,Ne=ye===void 0?30:ye;D.length===2&&D.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Ue=0,tt=[0,0,0,0],Et=[0,0,0,0];return l&&p&&(tt=Hn(l),Et=Hn(p),Ue=1),{u_opacity:u,u_textureBlend:x==="normal"?0:1,segmentNumber:Ne,u_line_type:pC[A]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:N?1:0,u_icon_step:me,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ue,u_sourceColor:tt,u_targetColor:Et}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:hC,fragmentShader:fC,triangulation:vm,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:un.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ua),GR=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),gm=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),vC=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),E0=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),HR=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function mC(e){var i=gC();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function gC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yC=`#define LineTypeSolid 0.0
varying vec4 v_color;

// dash
varying vec4 v_dash_array;
varying float v_d_distance_ratio;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

// [animate, duration, interval, trailLength],
void main() {

  gl_FragColor = v_color;

 
  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,_C=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;
uniform float u_raisingHeight: 0.0;

uniform mat4 u_ModelMatrix;

uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying float v_d_distance_ratio;


void main() {

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;


  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,xC=`#extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying vec2 v_iconMapUV;
varying vec4 v_texture_data;


#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth / 2.0;


    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,R_=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

varying vec4 v_texture_data;

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,bC=`varying vec4 v_color;
varying vec4 v_texture_data;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity: 1.0;

#pragma include "picking"


void main() {
  float linearRadio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = v_texture_data.a;
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
    gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,SC={solid:0,dash:1},D_=function(e){(0,lt.Z)(r,e);var i=mC(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"textureEventFlag",!1),(0,V.Z)((0,Ee.Z)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,V.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.textureBlend,p=l===void 0?"normal":l,v=t.lineType,x=v===void 0?"solid":v,S=t.dashArray,A=S===void 0?[10,5,0,0]:S,k=t.lineTexture,D=k===void 0?!1:k,R=t.iconStep,N=R===void 0?100:R,W=t.vertexHeightScale,me=W===void 0?20:W,ye=t.borderWidth,Ne=ye===void 0?0:ye,Ue=t.borderColor,tt=Ue===void 0?"#ccc":Ue,Et=t.raisingHeight,Vt=Et===void 0?0:Et,Yt=t.heightfixed,gr=Yt===void 0?!1:Yt,hr=t.linearDir,Hr=hr===void 0?gm.VERTICAL:hr,fn=t.blur,Rn=fn===void 0?[1,1,1]:fn,Zi=t.arrow,Ia=Zi===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Zi;A.length===2&&A.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var Za=0,io=[0,0,0,0],Wo=[0,0,0,0];return o&&u&&(io=Hn(o),Wo=Hn(u),Za=1),(0,O.Z)({u_textureBlend:p===vC.NORMAL?0:1,u_line_type:SC[x],u_dash_array:A,u_blur:Rn,u_texture:this.texture,u_line_texture:D?1:0,u_icon_step:N,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Ne,u_borderColor:Hn(tt),u_linearDir:Hr===gm.VERTICAL?1:0,u_linearColor:Za,u_sourceColor:io,u_targetColor:Wo,u_heightfixed:Number(gr),u_vertexScale:me,u_raisingHeight:Number(Vt),u_arrow:Number(Ia.enable),u_arrowHeight:Ia.arrowHeight||3,u_arrowWidth:Ia.arrowWidth||2,u_tailWidth:Ia.tailWidth===void 0?1:Ia.tailWidth},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S,A,k;return he().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!1:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,this.layer.triangulation=Hh,R.next=5,this.layer.buildLayerModel({moduleName:"line"+A,vertexShader:S,fragmentShader:x,triangulation:Hh,inject:this.getInject(),depth:{enable:p}});case 5:return k=R.sent,R.abrupt("return",[k]);case 7:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.lineType;return l==="dash"?{frag:yC,vert:_C,type:"Dash"}:o&&u?{frag:bC,vert:R_,type:"Linear"}:{frag:xC,vert:R_,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:un.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,l,p,v,x,S){return S===void 0?[p[3],10]:[p[3],S]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:un.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:un.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:un.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ua);function wC(e){var i=EC();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function EC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AC=`
varying vec4 v_Color;
#pragma include "picking"
void main() {

  gl_FragColor = v_Color; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,CC=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;
uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"


void main() {


  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  float linearRadio =currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = texV;
  }

  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));

  v_Color.a *= u_opacity; // \u5168\u5C40\u900F\u660E\u5EA6



  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,TC=ii.isNumber,MC=function(e){(0,lt.Z)(r,e);var i=wC(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var p=n.layer.getLayerConfig(),v=p.rampColors,x=zi(v);n.colorTexture=l({data:new Uint8Array(x.data),width:x.width,height:x.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.NEAREST,mag:q.NEAREST,flipY:!1})}),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.vertexHeightScale,p=l===void 0?20:l,v=t.raisingHeight,x=v===void 0?0:v,S=t.heightfixed,A=S===void 0?!1:S,k=t.linearDir,D=k===void 0?gm.VERTICAL:k;return this.rendererService.getDirty()&&this.colorTexture.bind(),{u_linearDir:D===gm.VERTICAL?1:0,u_opacity:TC(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(A),u_vertexScale:p,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!1:l,this.layer.triangulation=b0,S.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:CC,fragmentShader:AC,triangulation:b0,depth:{enable:p}});case 4:return v=S.sent,S.abrupt("return",[v]);case 6:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:un.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l,p,v,x){return x===void 0?[l[3],10]:[l[3],x]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:un.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:un.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:un.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[4]]}}})}}]),r}(ua);function kC(e){var i=IC();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function IC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=`
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;

}
`,LC=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying float v_distanceScale;
uniform float u_opacity: 1.0;
void main() {
  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
  gl_FragColor.a *= u_opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,O_=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;


uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;



#pragma include "projection"

varying vec4 v_color;
varying float v_distanceScale;

void main() {

  v_color = a_Color; 
  v_distanceScale = a_Distance / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity); 
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,RC=ii.isNumber,DC=function(e){(0,lt.Z)(r,e);var i=kC(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.vertexHeightScale,x=v===void 0?20:v,S=0,A=[0,0,0,0],k=[0,0,0,0];return l&&p&&(A=Hn(l),k=Hn(p),S=1),{u_opacity:RC(u)?u:1,u_linearColor:S,u_sourceColor:A,u_targetColor:k,u_vertexScale:x}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:LC,vert:O_,type:"lineSimpleLinear"}:{frag:PC,vert:O_,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x;return he().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return u=this.getShaders(),l=u.frag,p=u.vert,v=u.type,A.next=3,this.layer.buildLayerModel({moduleName:v,vertexShader:p,fragmentShader:l,triangulation:IE,primitive:q.LINES,depth:{enable:!1},pick:!1});case 3:return x=A.sent,A.abrupt("return",[x]);case 5:case"end":return A.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:un.Attribute,descriptor:{name:"a_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:un.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}})}}]),r}(ua);function OC(e){var i=FC();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function FC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BC=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,zC=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,NC=ii.isNumber,ZC=function(e){(0,lt.Z)(r,e);var i=OC(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.heightfixed,A=S===void 0?!1:S,k=t.lineTexture,D=k===void 0?!1:k,R=t.iconStep,N=R===void 0?100:R,W=t.iconStepCount,me=W===void 0?1:W;this.rendererService.getDirty()&&this.texture.bind();var ye=0,Ne=[0,0,0,0],Ue=[0,0,0,0];return l&&p&&(Ne=Hn(l),Ue=Hn(p),ye=1),{u_heightfixed:Number(A),u_opacity:NC(u)?u:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:D?1:0,u_iconStepCount:me,u_icon_step:N,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ye,u_sourceColor:Ne,u_targetColor:Ue}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:zC,fragmentShader:BC,triangulation:b0,depth:{enable:!1},blend:this.getBlend()});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:un.Attribute,descriptor:{name:"a_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:un.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:un.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:un.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ua),UC={arc:UA,arc3d:YA,greatcircle:dC,wall:ZC,line:D_,simple:DC,linearline:MC,earthArc3d:nC,flowline:uC},VC=UC;function jC(e){var i=GC();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function GC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A0=function(e){(0,lt.Z)(r,e);var i=jC(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"type","LineLayer"),(0,V.Z)((0,Ee.Z)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke"]),(0,V.Z)((0,Ee.Z)(n),"arrowInsertCount",0),(0,V.Z)((0,Ee.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,J.Z)(r,[{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new VC[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{}};return o[t]}},{key:"getModelType",value:function(){var t;if(this.layerType)return this.layerType;var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u||"line"}},{key:"processData",value:function(t){if(this.getModelType()!=="simple")return t;var o=[];return t.map(function(u){if(Array.isArray(u.coordinates)&&Array.isArray(u.coordinates[0])&&Array.isArray(u.coordinates[0][0])){var l=(0,O.Z)({},u);u.coordinates.map(function(p){o.push((0,O.Z)((0,O.Z)({},l),{},{coordinates:p}))})}else o.push(u)}),o}}]),r}(Oh);function HC(e){var i=WC();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function WC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $C=`
uniform float u_additive;
uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,XC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;

attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying float v_blur;
varying float v_innerRadius;



#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function F_(e){var i=e.coordinates;return{vertices:(0,cr.Z)(i),indices:[0],size:i.length}}var YC=function(e){(0,lt.Z)(r,e);var i=HC(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.blend,x=t.strokeOpacity,S=x===void 0?1:x,A=t.strokeWidth,k=A===void 0?0:A,D=t.stroke,R=D===void 0?"#fff":D;return{u_additive:v==="additive"?1:0,u_opacity:u,u_offsets:p,u_stroke_opacity:S,u_stroke_width:k,u_stroke_color:Hn(R)}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=F_,p.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:XC,fragmentShader:$C,triangulation:F_,depth:{enable:!1},primitive:q.POINTS});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(ua);function qC(e){var i=KC();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function KC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JC=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;
varying float v_lightWeight;
varying float v_barLinearZ;
void main() {

   gl_FragColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,QC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
varying float v_lightWeight;
varying float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,eT=ii.isNumber,tT=function(e){(0,lt.Z)(r,e);var i=qC(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"raiseCount",0),(0,V.Z)((0,Ee.Z)(n),"raiseRepeat",0),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=t.opacity,p=l===void 0?1:l,v=t.sourceColor,x=t.targetColor,S=t.pickLight,A=S===void 0?!1:S,k=t.heightfixed,D=k===void 0?!1:k,R=t.opacityLinear,N=R===void 0?{enable:!1,dir:"up"}:R,W=t.lightEnable,me=W===void 0?!0:W,ye=0,Ne=[0,0,0,0],Ue=[0,0,0,0];if(v&&x&&(Ne=Hn(v),Ue=Hn(x),ye=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var tt=u.speed,Et=tt===void 0?.01:tt;this.raiseCount+=Et,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(D),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:eT(p)?p:1,u_linearColor:ye,u_sourceColor:Ne,u_targetColor:Ue,u_opacitylinear:Number(N.enable),u_opacitylinear_dir:N.dir==="up"?1:0,u_lightEnable:Number(me)}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getLayerConfig(),l=u.animateOption.repeat,p=l===void 0?1:l,this.raiseRepeat=p,S.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:QC,fragmentShader:JC,triangulation:x0,depth:{enable:!0},cull:{enable:!0,face:ga(this.mapService.version)},blend:this.getBlend()});case 4:return v=S.sent,S.abrupt("return",[v]);case 6:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:un.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:un.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=xs(o.coordinates);return y_([u[0],u[1]])}}})}}]),r}(ua);function rT(e){var i=nT();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function nT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iT=`uniform float u_additive;
uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,aT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);

  setPickingColor(a_PickingColor);
}
`,oT=function(e){(0,lt.Z)(r,e);var i=rT(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.strokeOpacity,p=l===void 0?1:l,v=t.strokeWidth,x=v===void 0?0:v,S=t.stroke,A=S===void 0?"rgba(0,0,0,0)":S,k=t.blend,D=t.blur,R=D===void 0?0:D;return{u_blur:R,u_additive:k==="additive"?1:0,u_opacity:u,u_stroke_opacity:p,u_stroke_width:x,u_stroke_color:Hn(A)}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=A_,p.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:aT,fragmentShader:iT,triangulation:A_,depth:{enable:!0},blend:this.getBlend()});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:un.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v){var x=(0,K.Z)(p,3),S=x[0],A=x[1],k=x[2],D=ca.fromValues(0,0,1),R=ca.fromValues(S,0,k),N=S>=0?ca.angle(D,R):Math.PI*2-ca.angle(D,R),W=Math.PI*2-Math.asin(A/100),me=vt();Ps(me,me,N),Rc(me,me,W);var ye=ca.fromValues(1,1,0);ca.transformMat4(ye,ye,me),ca.normalize(ye,ye);var Ne=ca.fromValues(-1,1,0);ca.transformMat4(Ne,Ne,me),ca.normalize(Ne,Ne);var Ue=ca.fromValues(-1,-1,0);ca.transformMat4(Ue,Ue,me),ca.normalize(Ue,Ue);var tt=ca.fromValues(1,-1,0);ca.transformMat4(tt,tt,me),ca.normalize(tt,tt);var Et=[].concat((0,cr.Z)(ye),(0,cr.Z)(Ne),(0,cr.Z)(Ue),(0,cr.Z)(tt)),Vt=v%4*3;return[Et[Vt],Et[Vt+1],Et[Vt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:un.Attribute,descriptor:{name:"a_Shape",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.layer.getLayerConfig().shape2d,x=v.indexOf(p);return[x]}}})}}]),r}(ua);function sT(e){var i=uT();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function uT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lT=`varying vec4 v_color;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"


void main() {

  gl_FragColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,cT=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;
varying float v_lightWeight;
varying float v_barLinearZ;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
uniform float u_opacitylinear: 0.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacitylinear_dir: 1.0;
uniform float  u_linearColor: 0.0;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * u_opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  // gl_Position = project_common_position_to_clipspace(pos);

  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,B_=function(e){(0,lt.Z)(r,e);var i=sT(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"raiseCount",0),(0,V.Z)((0,Ee.Z)(n),"raiseRepeat",0),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=t.opacity,p=l===void 0?1:l,v=t.sourceColor,x=t.targetColor,S=t.pickLight,A=S===void 0?!1:S,k=t.heightfixed,D=k===void 0?!1:k,R=t.opacityLinear,N=R===void 0?{enable:!1,dir:"up"}:R,W=t.lightEnable,me=W===void 0?!0:W,ye=0,Ne=[0,0,0,0],Ue=[0,0,0,0];if(v&&x&&(Ne=Hn(v),Ue=Hn(x),ye=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var tt=u.speed,Et=tt===void 0?.01:tt;this.raiseCount+=Et,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(D),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:p,u_linearColor:ye,u_sourceColor:Ne,u_targetColor:Ue,u_opacitylinear:Number(N.enable),u_opacitylinear_dir:N.dir==="up"?1:0,u_lightEnable:Number(me)}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S;return he().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!0:l,v=u.animateOption.repeat,x=v===void 0?1:v,this.raiseRepeat=x,k.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:cT,fragmentShader:lT,triangulation:x0,cull:{enable:!0,face:ga(this.mapService.version)},depth:{enable:p}});case 4:return S=k.sent,k.abrupt("return",[S]);case 6:case"end":return k.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:un.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:un.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=xs(o.coordinates);return[u[0],u[1],0]}}})}}]),r}(ua);function fT(e){var i=hT();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function hT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var z_=`
uniform float u_additive;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = v_color;

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,pT=`uniform float u_additive;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec4 v_stroke;


#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    gl_FragColor = v_color;
  } else {
    gl_FragColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(gl_FragColor.a < 0.01) {
    discard;
  } 
}
`,C0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;

uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec4 v_stroke;
uniform float u_stroke_width: 2;
uniform vec3 u_blur_height_fixed: [0, 0, 0];


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"


void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,N_=function(e){(0,lt.Z)(r,e);var i=fT(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.strokeOpacity,u=o===void 0?1:o,l=t.strokeWidth,p=l===void 0?0:l,v=t.blend,x=t.blur,S=x===void 0?0:x,A=t.raisingHeight,k=A===void 0?0:A,D=t.heightfixed,R=D===void 0?!1:D,N=t.unit,W=N===void 0?"pixel":N;return(0,O.Z)({u_blur_height_fixed:[S,Number(k),Number(R)],u_additive:v==="additive"?1:0,u_stroke_opacity:u,u_stroke_width:p,u_size_unit:E0[W]},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ac)}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S,A,k;return he().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getLayerConfig(),l=u.animateOption,p=l===void 0?{enable:!1}:l,v=this.getShaders(p),x=v.frag,S=v.vert,A=v.type,this.layer.triangulation=Ac,R.next=5,this.layer.buildLayerModel({moduleName:A,vertexShader:S,fragmentShader:x,inject:this.getInject(),triangulation:Ac,depth:{enable:!1}});case 5:return k=R.sent,R.abrupt("return",[k]);case 7:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(t){if(t.enable)switch(t.type){case"wave":return{frag:z_,vert:C0,type:"pointWave"};default:return{frag:z_,vert:C0,type:"pointWave"}}else return{frag:pT,vert:C0,type:"pointFill"}}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:un.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],S=v%4*3;return[x[S],x[S+1],x[S+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:un.Attribute,descriptor:{name:"a_Shape",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.indexOf(p);return[v]}}})}}]),r}(ua);function dT(e){var i=vT();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function vT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mT=`uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;
varying float v_opacity;

void main() {

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= v_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,gT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;

uniform mat4 u_ModelMatrix;

uniform mat2 u_RotateMatrix;
uniform int u_size_unit;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
varying float v_opacity;
// uniform vec2 u_offsets; // shader \u6CE8\u5165


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,yT=function(e){(0,lt.Z)(r,e);var i=dT(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"meter2coord",1),(0,V.Z)((0,Ee.Z)(n),"isMeter",!1),(0,V.Z)((0,Ee.Z)(n),"radian",0),(0,V.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.LINEAR,min:q.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,l=t.heightfixed,p=l===void 0?!1:l,v=t.unit,x=v===void 0?"pixel":v;return this.rendererService.getDirty()&&this.texture.bind(),(0,O.Z)({u_raisingHeight:Number(u),u_heightfixed:Number(p),u_size_unit:E0[x],u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),pm)}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:gT,fragmentShader:mT,triangulation:pm,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:ga(this.mapService.version)}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.shape,v=l[p]||{x:-64,y:-64},x=v.x,S=v.y;return[x,S]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:un.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],S=v%4*3;return[x[S],x[S+1],x[S+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}})}}]),r}(ua);function _T(e){var i=xT();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function xT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bT=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform vec2 u_textSize;

#pragma include "picking"

void main(){
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a *= v_opacity;
      if (gl_FragColor.a < 0.01) {
         discard;
      }
      gl_FragColor = filterColor(gl_FragColor);
}
`,ST=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,Z_=function(e){(0,lt.Z)(r,e);var i=_T(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:q.LINEAR,min:q.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.raisingHeight,x=v===void 0?0:v,S=t.heightfixed,A=S===void 0?!1:S;return this.rendererService.getDirty()&&this.texture.bind(),(0,O.Z)({u_raisingHeight:Number(x),u_heightfixed:Number(A),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:ST,fragmentShader:bT,triangulation:ME,inject:this.getInject(),depth:{enable:!1},primitive:q.POINTS});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.shape,v=l[p]||{x:-64,y:-64},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ua);function wT(e){var i=ET();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function ET(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AT=`varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
}
`,CT=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;

attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`,WR=ii.isNumber;function U_(e){var i=e.coordinates;return{vertices:(0,cr.Z)(i),indices:[0],size:i.length}}var V_=function(e){(0,lt.Z)(r,e);var i=wT(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o;return(0,O.Z)({},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=U_,p.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:CT,fragmentShader:AT,triangulation:U_,inject:this.getInject(),depth:{enable:!1},primitive:q.POINTS,pick:!1});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(ua);function TT(e){var i=MT();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function MT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kT=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,IT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;

uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,PT=function(e){(0,lt.Z)(r,e);var i=TT(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.blend,p=t.speed,v=p===void 0?1:p,x=t.unit,S=x===void 0?"pixel":x;return{u_size_unit:E0[S],u_speed:v,u_additive:l==="additive"?1:0,u_opacity:u}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),pm)}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:IT,fragmentShader:kT,triangulation:pm,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:un.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p){var v=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=p%4*3;return[v[x],v[x+1],v[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?5:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(ua);function LT(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=RT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function RT(e,i){if(!!e){if(typeof e=="string")return j_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j_(e,i)}}function j_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var DT=function(){function e(i,r,n){(0,be.Z)(this,e),(0,V.Z)(this,"boxCells",[]);var t=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)t.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,J.Z)(e,[{key:"insert",value:function(r,n,t,o,u){this.forEachCell(n,t,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!1,u)}},{key:"hitTest",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!0,u)}},{key:"insertBoxCell",value:function(r,n,t,o,u,l){this.boxCells[u].push(l)}},{key:"queryHitTest",value:function(r,n,t,o,u,l){if(t<0||r>this.width||o<0||n>this.height)return u?!1:[];var p=[];if(r<=0&&n<=0&&this.width<=t&&this.height<=o){if(u)return!0;for(var v=0;v<this.boxKeys.length;v++)p.push({key:this.boxKeys[v],x1:this.bboxes[v*4],y1:this.bboxes[v*4+1],x2:this.bboxes[v*4+2],y2:this.bboxes[v*4+3]});return l?p.filter(l):p}var x={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,t,o,this.queryCell,p,x,l),u?p.length>0:p}},{key:"queryCell",value:function(r,n,t,o,u,l,p,v){var x=p.seenUids,S=this.boxCells[u];if(S!==null){var A=this.bboxes,k=LT(S),D;try{for(k.s();!(D=k.n()).done;){var R=D.value;if(!x.box[R]){x.box[R]=!0;var N=R*4;if(r<=A[N+2]&&n<=A[N+3]&&t>=A[N+0]&&o>=A[N+1]&&(!v||v(this.boxKeys[R]))){if(p.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[R],x1:A[N],y1:A[N+1],x2:A[N+2],y2:A[N+3]})}}}}catch(W){k.e(W)}finally{k.f()}}return!1}},{key:"forEachCell",value:function(r,n,t,o,u,l,p,v){for(var x=this.convertToXCellCoord(r),S=this.convertToYCellCoord(n),A=this.convertToXCellCoord(t),k=this.convertToYCellCoord(o),D=x;D<=A;D++)for(var R=S;R<=k;R++){var N=this.xCellCount*R+D;if(u.call(this,r,n,t,o,N,l,p,v))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),OT=DT,FT=function(){function e(i,r){(0,be.Z)(this,e),(0,V.Z)(this,"viewportPadding",100),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new OT(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,J.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,t=r.y1+r.anchorPointY+this.viewportPadding,o=r.x2+r.anchorPointX+this.viewportPadding,u=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,t,o,u)||this.grid.hitTest(n,t,o,u)?{box:[]}:{box:[n,t,o,u]}}},{key:"insertCollisionBox",value:function(r,n){var t={featureIndex:n};this.grid.insert(t,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,t){var o=Vi(n,t,0,1),u=Fi(),l=Ft.apply(_e,(0,cr.Z)(r));return il(u,o,l),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,t,o){return t>=0&&r<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function G_(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=BT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function BT(e,i){if(!!e){if(typeof e=="string")return H_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H_(e,i)}}function H_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function W_(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function $_(e,i,r,n,t){if(!!t){var o=e[n],u=o.glyph;if(u)for(var l=i[u].advance*o.scale,p=(e[n].x+l)*t,v=r;v<=n;v++)e[v].x-=p}}function X_(e,i,r,n,t,o,u){var l=(i-r)*t,p=(-n*u+.5)*o,v=G_(e),x;try{for(v.s();!(x=v.n()).done;){var S=x.value;S.x+=l,S.y+=p}}catch(A){v.e(A)}finally{v.f()}}function zT(e,i,r,n,t,o,u){var l=-8,p=0,v=l,x=0,S=e.positionedGlyphs,A=o==="right"?1:o==="left"?0:.5,k=S.length;r.forEach(function(me){if(me.split("").forEach(function(Ne){var Ue=i[Ne],tt=0;Ue&&(S.push({glyph:Ne,x:p,y:v+tt,vertical:!1,scale:1,metrics:Ue}),p+=Ue.advance+u)}),S.length!==k){var ye=p-u;x=Math.max(ye,x),$_(S,i,k,S.length-1,A)}p=0,v-=n+5});var D=W_(t),R=D.horizontalAlign,N=D.verticalAlign;X_(S,A,R,N,x,n,r.length);var W=v-l;e.top+=-N*W,e.bottom=e.top-W,e.left+=-R*x,e.right=e.left+x}function NT(e,i,r,n,t,o,u){var l=-8,p=0,v=l,x=0,S=e.positionedGlyphs,A=o==="right"?1:o==="left"?0:.5,k=S.length;r.forEach(function(me){var ye=i[me],Ne=0;if(ye&&(S.push({glyph:me,x:ye.advance/2,y:v+Ne,vertical:!1,scale:1,metrics:ye}),p+=ye.advance+u),S.length!==k){var Ue=p-u;x=Math.max(Ue,x),$_(S,i,k,S.length-1,A)}p=0,v-=n+5});var D=W_(t),R=D.horizontalAlign,N=D.verticalAlign;X_(S,A,R,N,x,n,r.length);var W=v-l;e.top+=-N*W,e.bottom=e.top-W,e.left+=-R*x,e.right=e.left+x}function ZT(e,i,r,n,t,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,p=e.split(`
`),v=[],x={positionedGlyphs:v,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:p.length,text:e};return l?NT(x,i,p,r,n,t,o):zT(x,i,p,r,n,t,o),v.length?x:!1}function UT(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,t=n===void 0?[]:n,o=[],u=G_(t),l;try{for(u.s();!(l=u.n()).done;){var p=l.value,v=p.metrics,x=4,S=v.advance*p.scale/2,A=r?[p.x+S,p.y]:[0,0],k=r?[0,0]:[p.x+S+i[0],p.y+i[1]],D=(0-x)*p.scale-S+k[0],R=(0-x)*p.scale+k[1],N=D+v.width*p.scale,W=R+v.height*p.scale,me={x:D,y:R},ye={x:N,y:R},Ne={x:D,y:W},Ue={x:N,y:W};o.push({tl:me,tr:ye,bl:Ne,br:Ue,tex:v,glyphOffset:A})}}catch(tt){u.e(tt)}finally{u.f()}return o}function VT(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=jT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function jT(e,i){if(!!e){if(typeof e=="string")return Y_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Y_(e,i)}}function Y_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function GT(e){var i=HT();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function HT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec4 v_stroke_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;


#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  gl_FragColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (gl_FragColor.a < 0.01) {
    discard;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,K_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying vec4 v_stroke_color;
varying float v_fontScale;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];



#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,pv=ii.isEqual;function J_(e){var i=this,r=e.id,n=[],t=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[r].glyphQuads.forEach(function(l,p){n.push.apply(n,(0,cr.Z)(u).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,cr.Z)(u),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,cr.Z)(u),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,cr.Z)(u),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),t.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:t,size:7}}var Q_=function(e){(0,lt.Z)(r,e);var i=GT(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"glyphInfoMap",{}),(0,V.Z)((0,Ee.Z)(n),"currentZoom",-1),(0,V.Z)((0,Ee.Z)(n),"textureHeight",0),(0,V.Z)((0,Ee.Z)(n),"textCount",0),(0,V.Z)((0,Ee.Z)(n),"preTextStyle",{}),(0,V.Z)((0,Ee.Z)(n),"mapping",(0,It.Z)(he().mark(function l(){return he().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n.initGlyph(),n.updateTexture(),v.next=4,n.reBuildModel();case 4:case"end":return v.stop()}},l)}))),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.stroke,u=o===void 0?"#fff":o,l=t.strokeWidth,p=l===void 0?0:l,v=t.halo,x=v===void 0?.5:v,S=t.gamma,A=S===void 0?2:S,k=t.raisingHeight,D=k===void 0?0:k,R=this.getFontServiceMapping(),N=this.getFontServiceCanvas();return R&&Object.keys(R).length!==this.textCount&&N&&(this.updateTexture(),this.textCount=Object.keys(R).length),this.preTextStyle=this.getTextStyle(),(0,O.Z)({u_raisingHeight:Number(D),u_stroke_width:p,u_stroke_color:Hn(u),u_sdf_map:this.texture,u_halo_blur:x,u_gamma_scale:A,u_sdf_map_size:[(N==null?void 0:N.width)||1,(N==null?void 0:N.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),l.abrupt("return",this.buildModels());case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getLayerConfig(),l=u.textAllowOverlap,p=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),p||this.filterGlyphs(),S.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:K_,fragmentShader:q_,inject:this.getInject(),triangulation:J_.bind(this),depth:{enable:!1}});case 6:return v=S.sent,S.abrupt("return",[v]);case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"needUpdate",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S,A,k,D,R,N,W;return he().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(u=this.getTextStyle(),l=u.textAllowOverlap,p=l===void 0?!1:l,v=u.textAnchor,x=v===void 0?"center":v,S=u.textOffset,A=u.padding,k=u.fontFamily,D=u.fontWeight,!(!pv(A,this.preTextStyle.padding)||!pv(S,this.preTextStyle.textOffset)||!pv(x,this.preTextStyle.textAnchor)||!pv(k,this.preTextStyle.fontFamily)||!pv(D,this.preTextStyle.fontWeight))){ye.next=5;break}return ye.next=4,this.mapping();case 4:return ye.abrupt("return",!0);case 5:if(!p){ye.next=7;break}return ye.abrupt("return",!1);case 7:if(R=this.mapService.getZoom(),N=this.mapService.getBounds(),W=Ji(this.extent,N),!(Math.abs(this.currentZoom-R)>.5||!W||p!==this.preTextStyle.textAllowOverlap)){ye.next=14;break}return ye.next=13,this.reBuildModel();case 13:return ye.abrupt("return",!0);case 14:return ye.abrupt("return",!1);case 15:case"end":return ye.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:un.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?12:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:un.Attribute,descriptor:{name:"a_tex",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return _s(t,.5)}},{key:"initTextFont",value:function(){var t=this.getTextStyle(),o=t.fontWeight,u=t.fontFamily,l=this.rawEncodeData,p=[];l.forEach(function(v){var x=v.shape,S=x===void 0?"":x;S=S.toString();var A=VT(S),k;try{for(A.s();!(k=A.n()).done;){var D=k.value;p.indexOf(D)===-1&&p.push(D)}}catch(R){A.e(R)}finally{A.f()}}),this.fontService.setFontOptions({characterSet:p,fontWeight:o,fontFamily:u,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.getTextStyle(),o=t.fontWeight,u=t.fontFamily,l=this.rawEncodeData,p=[];l.forEach(function(v){var x=v.shape,S=x===void 0?"":x;S="".concat(S),p.indexOf(S)===-1&&p.push(S)}),this.fontService.setFontOptions({characterSet:p,fontWeight:o,fontFamily:u,iconfont:!0})}},{key:"getTextStyle",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l,v=t.textAllowOverlap,x=v===void 0?!1:v,S=t.padding,A=S===void 0?[0,0]:S,k=t.textAnchor,D=k===void 0?"center":k,R=t.textOffset,N=R===void 0?[0,0]:R,W=t.opacity,me=W===void 0?1:W,ye=t.strokeOpacity,Ne=ye===void 0?1:ye,Ue=t.strokeWidth,tt=Ue===void 0?0:Ue,Et=t.stroke,Vt=Et===void 0?"#000":Et;return{fontWeight:u,fontFamily:p,textAllowOverlap:x,padding:A,textAnchor:D,textOffset:N,opacity:me,strokeOpacity:Ne,strokeWidth:tt,stroke:Vt}}},{key:"generateGlyphLayout",value:function(t){var o=this,u=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),p=l.spacing,v=p===void 0?2:p,x=l.textAnchor,S=x===void 0?"center":x,A=l.textOffset,k=this.rawEncodeData;this.glyphInfo=k.map(function(D){var R=D.shape,N=R===void 0?"":R,W=D.id,me=D.size,ye=me===void 0?1:me,Ne=D.textOffset?D.textOffset:A||[0,0],Ue=D.textAnchor?D.textAnchor:S||"center",tt=ZT(N.toString(),u,ye,Ue,"left",v,Ne,t),Et=UT(tt,Ne,!1);return D.shaping=tt,D.glyphQuads=Et,D.centroid=xs(D.coordinates),D.originCentroid=D.version==="GAODE2.x"?xs(D.originCoordinates):D.originCentroid=D.centroid,o.glyphInfoMap[W]={shaping:tt,glyphQuads:Et,centroid:xs(D.coordinates)},D})}},{key:"getFontServiceMapping",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(p,"_").concat(u))}},{key:"getFontServiceCanvas",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(p,"_").concat(u))}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,l=u===void 0?[0,0]:u,p=o.textAllowOverlap,v=p===void 0?!1:p;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var x=this.rendererService.getViewportSize(),S=x.width,A=x.height,k=new FT(S,A),D=this.glyphInfo.filter(function(R){var N=R.shaping,W=R.id,me=W===void 0?0:W,ye=R.version==="GAODE2.x"?R.originCentroid:R.centroid,Ne=R.size,Ue=Ne/16,tt=t.mapService.lngLatToContainer(ye),Et=k.placeCollisionBox({x1:N.left*Ue-l[0],x2:N.right*Ue+l[0],y1:N.top*Ue-l[1],y2:N.bottom*Ue+l[1],anchorPointX:tt.x,anchorPointY:tt.y}),Vt=Et.box;return Vt&&Vt.length?(k.insertCollisionBox(Vt,me),!0):!1});D.forEach(function(R){t.glyphInfoMap[R.id]=R})}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig(),o=t.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.getFontServiceCanvas();this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:q.LINEAR,min:q.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.filterGlyphs(),p.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:K_,fragmentShader:q_,triangulation:J_.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:u=p.sent,this.layer.models=[u];case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(ua),WT={fillImage:yT,fill:N_,radar:PT,image:Z_,normal:V_,simplePoint:YC,extrude:B_,text:Q_,earthFill:oT,earthExtrude:tT},$T=WT;function XT(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=YT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function YT(e,i){if(!!e){if(typeof e=="string")return e1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e1(e,i)}}function e1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function qT(e){var i=KT();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function KT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ym=function(e){(0,lt.Z)(r,e);var i=qT(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"type","PointLayer"),(0,V.Z)((0,Ee.Z)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke","rotation"]),(0,V.Z)((0,Ee.Z)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,V.Z)((0,Ee.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,J.Z)(r,[{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new $T[u](this),p.next=5,this.initLayerModels();case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,o=t.field,u=t.values,l=this.getLayerConfig(),p=l.shape2d,v=this.iconService.getIconMap();if(o&&(p==null?void 0:p.indexOf(o))!==-1)return"fill";if(u==="text")return"text";if(u&&u instanceof Array){var x=XT(u),S;try{for(x.s();!(S=x.n()).done;){var A=S.value;if(typeof A=="string"&&v.hasOwnProperty(A))return"image"}}catch(k){x.e(k)}finally{x.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=o.billboard,v=p===void 0?!0:p,x=this.iconService.getIconMap(),S=t.find(function(k){return k.hasOwnProperty("shape")});if(S){var A=S.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"||v===!1?"fillImage":(u==null?void 0:u.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":x.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Oh);function JT(e){var i=QT();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function QT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eM=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;

#pragma include "picking"

void main() {


     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,tM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,rM=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
    // gl_FragColor = vec4(1.0, 0., 0., 1.0);
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,nM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform sampler2D u_texture;


uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;
varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_linearColor: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,iM=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,aM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,oM=function(e){(0,lt.Z)(r,e);var i=JT(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.heightfixed,u=o===void 0?!1:o,l=t.raisingHeight,p=l===void 0?0:l,v=t.topsurface,x=v===void 0?!0:v,S=t.sidesurface,A=S===void 0?!0:S,k=t.sourceColor,D=t.targetColor,R=0,N=[1,1,1,1],W=[1,1,1,1];return k&&D&&(N=Hn(k),W=Hn(D),R=1),(0,O.Z)({u_topsurface:Number(x),u_sidesurface:Number(A),u_heightfixed:Number(u),u_raisingHeight:Number(p),u_linearColor:R,u_sourceColor:N,u_targetColor:W,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x;return he().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return u=this.getShaders(),l=u.frag,p=u.vert,v=u.type,A.next=3,this.layer.buildLayerModel({moduleName:v,vertexShader:p,fragmentShader:l,inject:this.getInject(),triangulation:w0});case 3:return x=A.sent,A.abrupt("return",[x]);case 5:case"end":return A.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.pickLight,u=t.mapTexture;return u?{frag:rM,vert:nM,type:"polygonExtrudeTexture"}:o?{frag:iM,vert:aM,type:"polygonExtrudePickLight"}:{frag:eM,vert:tM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=t,u=this.layer.coordCenter||this.layer.getSource().center,l=o[2]-o[0],p=o[3]-o[1];if(this.mapService.version==="GAODE2.x"){var v=this.mapService.coordToAMap2RelativeCoordinates([t[0],t[1]],u),x=(0,K.Z)(v,2),S=x[0],A=x[1],k=this.mapService.coordToAMap2RelativeCoordinates([t[2],t[3]],u),D=(0,K.Z)(k,2),R=D[0],N=D[1];l=R-S,p=N-A,o=[S,A,R,N]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:un.Attribute,descriptor:{name:"a_uvs",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(me,ye,Ne){var Ue=Ne[0],tt=Ne[1];return[(Ue-o[0])/l,(tt-o[1])/p,Ne[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:un.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(me,ye,Ne,Ue,tt){return tt}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(me){var ye=me.size,Ne=ye===void 0?10:ye;return Array.isArray(Ne)?[Ne[0]]:[Ne]}}})}},{key:"loadTexture",value:function(){var n=(0,It.Z)(he().mark(function o(){var u=this,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(l=this.layer.getLayerConfig(),p=l.mapTexture,v=this.rendererService.createTexture2D,this.texture=v({height:0,width:0}),!p){S.next=5;break}return S.abrupt("return",new Promise(function(A,k){var D=new Image;D.crossOrigin="anonymous",D.src=p,D.onload=function(){return u.texture=v({data:D,width:D.width,height:D.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.LINEAR,mag:q.LINEAR}),A(null)},D.onerror=function(){k(new Error("image load error"))}}));case 5:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(ua);function sM(e){var i=uM();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function uM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lM=`
uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {

  gl_FragColor = v_Color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,cM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;




varying vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,fM=function(e){(0,lt.Z)(r,e);var i=sM(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){return(0,O.Z)({},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x;return he().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return u=this.getShaders(),l=u.frag,p=u.vert,v=u.type,A.next=3,this.layer.buildLayerModel({moduleName:v,vertexShader:p,fragmentShader:l,inject:this.getInject(),triangulation:w0});case 3:return x=A.sent,A.abrupt("return",[x]);case 5:case"end":return A.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){return{frag:lM,vert:cM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:un.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:un.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?10:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(ua);function hM(e){var i=pM();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function pM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dM=`varying vec4 v_color;
#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,vM=`#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;
varying vec4 v_Color;


void main() {
   gl_FragColor = v_Color;
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,mM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,gM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;

varying vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,yM=function(e){(0,lt.Z)(r,e);var i=hM(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,l=t.opacityLinear,p=l===void 0?{enable:!1,dir:"in"}:l;return(0,O.Z)({u_raisingHeight:Number(u),u_opacitylinear:Number(p.enable),u_dir:p.dir==="in"?1:0},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S;return he().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.getModelParams(),l=u.frag,p=u.vert,v=u.triangulation,x=u.type,this.layer.triangulation=v,k.next=4,this.layer.buildLayerModel({moduleName:x,vertexShader:p,fragmentShader:l,inject:this.getInject(),triangulation:v,primitive:q.TRIANGLES,depth:{enable:!1}});case 4:return S=k.sent,k.abrupt("return",[S]);case 6:case"end":return k.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:un.Attribute,descriptor:{name:"a_linear",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(p,v,x){return[x[3],x[4],x[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:vM,vert:mM,type:"polygonLinear",triangulation:RE}:{frag:dM,vert:gM,type:"polygonFill",triangulation:Wh}}}]),r}(ua);function _M(e){var i=xM();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function xM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bM=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,SM=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,wM=ii.isNumber,EM=function(e){(0,lt.Z)(r,e);var i=_M(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.watercolor,p=l===void 0?"#6D99A8":l,v=t.watercolor2,x=v===void 0?"#0F121C":v;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Hn(p),u_watercolor2:Hn(x),u_opacity:wM(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:SM,fragmentShader:bM,triangulation:S0,primitive:q.TRIANGLES,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o,u;(t=this.texture1)===null||t===void 0||t.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,K.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,S=v-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:un.Attribute,descriptor:{name:"a_uv",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(k,D,R,N){var W=k.version===nc["GAODE2.x"]?k.originCoordinates[0][N]:R,me=(0,K.Z)(W,2),ye=me[0],Ne=me[1];return[(ye-u)/x,(Ne-l)/S]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),l(function(v){t.texture1=p(v[0]),t.texture2=p(v[1]),t.texture3=p(v[2]),t.layerService.reRender()});function l(v){var x=0,S=[],A=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];A.map(function(k){var D=new Image;D.crossOrigin="",D.src=k,S.push(D),D.onload=function(){x++,x===3&&v(S)}})}function p(v){return o({data:v,width:v.width,height:v.height,wrapS:q.MIRRORED_REPEAT,wrapT:q.MIRRORED_REPEAT,min:q.LINEAR,mag:q.LINEAR})}}}]),r}(ua);function AM(e){var i=CM();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function CM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TM=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,MM=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,kM=ii.isNumber,IM=function(e){(0,lt.Z)(r,e);var i=AM(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.speed,p=l===void 0?.5:l;return{u_texture:this.texture,u_speed:p,u_opacity:kM(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:MM,fragmentShader:TM,triangulation:S0,primitive:q.TRIANGLES,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,K.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,S=v-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:un.Attribute,descriptor:{name:"a_uv",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(k,D,R,N){var W=k.version===nc["GAODE2.x"]?k.originCoordinates[0][N]:R,me=(0,K.Z)(W,2),ye=me[0],Ne=me[1];return[(ye-u)/x,(Ne-l)/S]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var p=new Image;p.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),p.src=u):p.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",p.onload=function(){t.texture=l({data:p,width:p.width,height:p.height,wrapS:q.MIRRORED_REPEAT,wrapT:q.MIRRORED_REPEAT,min:q.LINEAR,mag:q.LINEAR}),t.layerService.reRender()}}}]),r}(ua),PM={fill:yM,line:D_,extrude:oM,text:Q_,point_fill:N_,point_image:Z_,point_normal:V_,point_extrude:B_,water:IM,ocean:EM,extrusion:fM},LM=PM;function RM(e){var i=DM();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function DM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _m=function(e){(0,lt.Z)(r,e);var i=RM(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"type","PolygonLayer"),(0,V.Z)((0,Ee.Z)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return(0,J.Z)(r,[{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new LM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u==="fill"||!u?"fill":u==="extrude"?"extrude":u==="extrusion"?"extrusion":u==="water"?"water":u==="ocean"?"ocean":u==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=this.iconService.getIconMap(),v=t.find(function(S){return S.hasOwnProperty("shape")});if(v){var x=v.shape;return x==="dot"?"point_normal":(u==null?void 0:u.indexOf(x))!==-1?"point_fill":(l==null?void 0:l.indexOf(x))!==-1?"point_extrude":p.hasOwnProperty(x)?"point_image":"text"}else return"fill"}}]),r}(Oh);function OM(e){var i=FM();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function FM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BM=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
      discard;
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
     discard;
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
    if(gl_FragColor.a < 0.01)
      discard;
   
  }
}
`,zM=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,t1=function(e){(0,lt.Z)(r,e);var i=OM(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.clampLow,p=l===void 0?!0:l,v=t.clampHigh,x=v===void 0?!0:v,S=t.noDataValue,A=S===void 0?-9999999:S,k=t.domain,D=t.rampColors,R=k||Xo(D);return this.colorTexture=this.layer.textureService.getColorTexture(D,R),{u_opacity:u||1,u_texture:this.texture,u_domain:R,u_clampLow:p,u_clampHigh:typeof x!="undefined"?x:p,u_noDataValue:A,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,It.Z)(he().mark(function o(u){var l,p,v,x;return he().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!Array.isArray(u.data)){A.next=4;break}return A.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return A.next=6,u.data;case 6:return l=A.sent,p=l.rasterData,v=l.width,x=l.height,A.abrupt("return",{data:Array.from(p),width:v,height:x});case 11:case"end":return A.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S,A,k;return he().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,p=u.data.dataArray[0],R.next=5,this.getRasterData(p);case 5:return v=R.sent,x=v.data,S=v.width,A=v.height,this.texture=l({data:x,width:S,height:A,format:q.LUMINANCE,type:q.FLOAT}),R.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:zM,fragmentShader:BM,triangulation:dm,primitive:q.TRIANGLES,depth:{enable:!1}});case 12:return k=R.sent,R.abrupt("return",[k]);case 14:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(ua),NM=["data"],ZM=["rasterData"];function UM(e){var i=VM();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function VM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jM=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,GM=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(gl_FragColor.a < 0.01)
    discard;
 
}`,HM=function(e){(0,lt.Z)(r,e);var i=UM(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"dataOption",{}),n}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.noDataValue,p=l===void 0?0:l,v=this.dataOption,x=v.rMinMax,S=v.gMinMax,A=v.bMinMax;return{u_opacity:u||1,u_texture:this.texture,u_noDataValue:p,u_rminmax:x,u_gminmax:S,u_bminmax:A}}},{key:"getRasterData",value:function(){var n=(0,It.Z)(he().mark(function o(u){var l,p,v,x,S;return he().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!Array.isArray(u.data)){k.next=4;break}return l=u.data,p=(0,rs.Z)(u,NM),this.dataOption=p,k.abrupt("return",(0,O.Z)({data:l},p));case 4:return k.next=6,u.data;case 6:if(v=k.sent,x=v.rasterData,S=(0,rs.Z)(v,ZM),this.dataOption=S,!Array.isArray(x)){k.next=14;break}return k.abrupt("return",(0,O.Z)({data:x},S));case 14:return k.abrupt("return",(0,O.Z)({data:Array.from(x)},S));case 15:case"end":return k.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S,A,k;return he().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,p=u.data.dataArray[0],R.next=5,this.getRasterData(p);case 5:return v=R.sent,x=v.data,S=v.width,A=v.height,this.texture=l({data:x,width:S,height:A,format:q.RGB,type:q.FLOAT}),R.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:jM,fragmentShader:GM,triangulation:dm,primitive:q.TRIANGLES,depth:{enable:!1}});case 12:return k=R.sent,R.abrupt("return",[k]);case 14:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(ua);function WM(e){var i=$M();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function $M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XM=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,YM=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,qM=function(e){(0,lt.Z)(r,e);var i=WM(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.clampLow,l=u===void 0?!0:u,p=t.clampHigh,v=p===void 0?!0:p,x=t.noDataValue,S=x===void 0?-9999999:x,A=t.domain,k=t.rampColors,D=t.colorTexture,R=t.rScaler,N=R===void 0?6553.6:R,W=t.gScaler,me=W===void 0?25.6:W,ye=t.bScaler,Ne=ye===void 0?.1:ye,Ue=t.offset,tt=Ue===void 0?1e4:Ue,Et=A||Xo(k),Vt=D;return D?this.layer.textureService.setColorTexture(D,k,Et):Vt=this.layer.textureService.getColorTexture(k,Et),{u_opacity:o||1,u_texture:this.texture,u_domain:Et,u_clampLow:l,u_clampHigh:typeof v!="undefined"?v:l,u_noDataValue:S,u_unpack:[N,me,Ne,tt],u_colorTexture:Vt}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,S.next=4,u.data.images;case 4:return p=S.sent,this.texture=l({data:p[0],width:p[0].width,height:p[0].height,min:q.LINEAR,mag:q.LINEAR}),S.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:YM,fragmentShader:XM,triangulation:dm,primitive:q.TRIANGLES,depth:{enable:!1}});case 8:return v=S.sent,S.abrupt("return",[v]);case 10:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:un.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(ua),KM={raster:t1,rasterRgb:HM,raster3d:t1,rasterTerrainRgb:qM},JM=KM;function QM(e){var i=e5();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function e5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xm=function(e){(0,lt.Z)(r,e);var i=QM(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"type","RasterLayer"),n}return(0,J.Z)(r,[{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new JM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();switch(t){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),r}(Oh);function t5(e){var i=r5();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function r5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n5=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,i5=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,a5=ii.isNumber,o5=function(e){(0,lt.Z)(r,e);var i=t5(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.color,p=l===void 0?"#000":l;return{u_opacity:a5(u)?u:0,u_color:Hn(p)}}},{key:"initModels",value:function(){var n=(0,It.Z)(he().mark(function o(){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:i5,fragmentShader:n5,triangulation:S0,depth:{enable:!1},pick:!1});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;t&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(ua),s5={fill:o5},u5=s5;function l5(e){var i=c5();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function c5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r1=function(e){(0,lt.Z)(r,e);var i=l5(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"type","MaskLayer"),n}return(0,J.Z)(r,[{key:"buildModels",value:function(){var n=(0,It.Z)(he().mark(function o(){var u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new u5[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){return"fill"}}]),r}(Oh),n1,i1,a1,o1,bm,s1,u1,f5=ii.cloneDeep,h5=(n1=(0,ut.b2)(),i1=(0,ut.f3)(et.IMapService),a1=(0,ut.f3)(et.IFontService),n1(o1=(bm=function(){function e(){(0,be.Z)(this,e),on(this,"mapService",s1,this),on(this,"fontService",u1,this)}return(0,J.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("DataMappingPlugin",(0,It.Z)(he().mark(function u(){return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:r.log(ns.MappingStart,yr.INIT),t.generateMaping(r,{styleAttributeService:o}),r.log(ns.MappingEnd,yr.INIT);case 3:case"end":return p.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var u=(0,It.Z)(he().mark(function l(p){var v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(p){S.next=2;break}return S.abrupt("return",p);case 2:return r.dataState.dataMappingNeedUpdate=!1,r.log(ns.MappingStart,yr.UPDATE),v=t.generateMaping(r,{styleAttributeService:o}),r.log(ns.MappingEnd,yr.UPDATE),S.abrupt("return",v);case 7:case"end":return S.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=r.getSource();if(!(r.layerModelNeedUpdate||!u||!u.inited)){var l=o.getLayerStyleAttributes()||[],p=o.getLayerStyleAttribute("filter"),v=u.data.dataArray;if(!(Array.isArray(v)&&v.length===0)){var x=l.filter(function(k){return k.needRemapping}),S=v;if(p!=null&&p.needRemapping&&p!==null&&p!==void 0&&p.scale&&(S=v.filter(function(k){return t.applyAttributeMapping(p,k)[0]})),x.length){var A=t.mapping(r,x,S,r.getEncodedData());r.setEncodedData(A)}}}})}},{key:"generateMaping",value:function(r,n){var t=this,o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[],l=o.getLayerStyleAttribute("filter"),p=r.getSource().data.dataArray,v=p;l!=null&&l.scale&&(v=p.filter(function(S){return t.applyAttributeMapping(l,S)[0]})),v=r.processData(v);var x=this.mapping(r,u,v,void 0);return r.setEncodedData(x),p.length===0&&r.encodeDataLength===0?!1:(r.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(r,n,t,o){var u=this,l=r.getLayerConfig(),p=l.arrow,v=p===void 0?{enable:!1}:p,x=n.filter(function(A){return A.scale!==void 0}).filter(function(A){return A.name!=="filter"}),S=t.map(function(A,k){var D=o?o[k]:{},R=(0,O.Z)({id:A._id,coordinates:A.coordinates},D);if(x.forEach(function(me){var ye=u.applyAttributeMapping(me,A);(me.name==="color"||me.name==="stroke")&&(ye=ye.map(function(Ne){return Hn(Ne)})),R[me.name]=Array.isArray(ye)&&ye.length===1?ye[0]:ye,me.name==="shape"&&(R.shape=u.fontService.getIconFontKey(R[me.name]))}),v.enable&&R.shape==="line"){var N=R.coordinates;if(r.arrowInsertCount<r.encodeDataLength){var W=u.getArrowPoints(N[0],N[1]);R.coordinates.splice(1,0,W,W),r.arrowInsertCount++}}return R});return n.forEach(function(A){A.needRemapping=!1}),this.adjustData2Amap2Coordinates(S,r),this.adjustData2SimpleCoordinates(S),S}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var t=this;if(r.length>0&&this.mapService.version===nc["GAODE2.x"]){var o=n.coordCenter||n.getSource().center;r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=nc["GAODE2.x"],u.originCoordinates=f5(u.coordinates),u.coordinates=t.mapService.coordToAMap2RelativeCoordinates(u.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===nc.SIMPLE&&r.map(function(t){t.simpleCoordinate||(t.coordinates=n.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var t=[];return r.map(function(u){var l=[];u.map(function(p){l.push(n.mapService.simpleMapCoord.unproject(p))}),t.push(l)}),t}else{var o=[];return r.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(r,n){var t;if(!r.scale)return[];var o=(r==null||(t=r.scale)===null||t===void 0?void 0:t.scalers)||[],u=[];o.forEach(function(p){var v,x=p.field;(n.hasOwnProperty(x)||((v=r.scale)===null||v===void 0?void 0:v.type)==="variable")&&u.push(n[x])});var l=r.mapping?r.mapping(u):[];return l}},{key:"getArrowPoints",value:function(r,n){var t=[n[0]-r[0],n[1]-r[1]],o=su(t),u=[r[0]+o[0]*1e-4,r[1]+o[1]*1e-4];return u}}]),e}(),s1=Kr(bm.prototype,"mapService",[i1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u1=Kr(bm.prototype,"fontService",[a1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bm))||o1),l1,c1,p5=(l1=(0,ut.b2)(),l1(c1=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(et.IMapService),r.hooks.init.tapPromise("DataSourcePlugin",(0,It.Z)(he().mark(function t(){var o,u,l,p;return he().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(r.log(ns.SourceInitStart,yr.INIT),o=r.getSource(),o||(u=r.sourceOption||r.defaultSourceConfig,l=u.data,p=u.options,o=new f0(l,p),r.setSource(o)),!o.inited){x.next=8;break}n.updateClusterData(r),r.log(ns.SourceInitEnd,yr.INIT),x.next=10;break;case 8:return x.next=10,new Promise(function(S){o.on("update",function(A){A.type==="inited"&&(n.updateClusterData(r),r.log(ns.SourceInitEnd,yr.INIT)),S(null)})});case 10:case"end":return x.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,It.Z)(he().mark(function t(){var o,u,l;return he().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o=n.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate,r.dataState.dataSourceNeedUpdate=!1,l=o||u,v.abrupt("return",l);case 5:case"end":return v.stop()}},t)})))}},{key:"updateClusterData",value:function(r){if(r.isTileLayer||r.tileLayer||!r.getSource())return!1;var n=r.getSource(),t=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,l=this.mapService.getZoom()-1,p=r.dataState.dataSourceNeedUpdate;return t&&p&&n.updateClusterData(Math.floor(l)),t&&Math.abs(r.clusterZoom-l)>=1?(u!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),r.clusterZoom=l,!0):!1}}]),e}())||c1);function T0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function f1(e){return e.length===1&&(e=d5(e)),{left:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)<0?n=o+1:t=o}return n},right:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)>0?t=o:n=o+1}return n}}}function d5(e){return function(i,r){return T0(e(i),r)}}var h1=f1(T0),v5=h1.right,$R=h1.left,Sm=v5;function p1(e,i){var r=e.length,n=-1,t,o,u;if(i==null){for(;++n<r;)if((t=e[n])!=null&&t>=t)for(o=u=t;++n<r;)(t=e[n])!=null&&(o>t&&(o=t),u<t&&(u=t))}else for(;++n<r;)if((t=i(e[n],n,e))!=null&&t>=t)for(o=u=t;++n<r;)(t=i(e[n],n,e))!=null&&(o>t&&(o=t),u<t&&(u=t));return[o,u]}var d1=Array.prototype,XR=d1.slice,YR=d1.map,M0=Math.sqrt(50),k0=Math.sqrt(10),I0=Math.sqrt(2);function v1(e,i,r){var n,t=-1,o,u,l;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(o=e,e=i,i=o),(l=wm(e,i,r))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),i=Math.floor(i/l),u=new Array(o=Math.ceil(i-e+1));++t<o;)u[t]=(e+t)*l;else for(e=Math.floor(e*l),i=Math.ceil(i*l),u=new Array(o=Math.ceil(e-i+1));++t<o;)u[t]=(e-t)/l;return n&&u.reverse(),u}function wm(e,i,r){var n=(i-e)/Math.max(0,r),t=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,t);return t>=0?(o>=M0?10:o>=k0?5:o>=I0?2:1)*Math.pow(10,t):-Math.pow(10,-t)/(o>=M0?10:o>=k0?5:o>=I0?2:1)}function P0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),t=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/t;return o>=M0?t*=10:o>=k0?t*=5:o>=I0&&(t*=2),i<e?-t:t}function qR(){var e=identity,i=extent,r=sturges;function n(t){var o,u=t.length,l,p=new Array(u);for(o=0;o<u;++o)p[o]=e(t[o],o,t);var v=i(p),x=v[0],S=v[1],A=r(p,x,S);Array.isArray(A)||(A=tickStep(x,S,A),A=range(Math.ceil(x/A)*A,S,A));for(var k=A.length;A[0]<=x;)A.shift(),--k;for(;A[k-1]>S;)A.pop(),--k;var D=new Array(k+1),R;for(o=0;o<=k;++o)R=D[o]=[],R.x0=o>0?A[o-1]:x,R.x1=o<k?A[o]:S;for(o=0;o<u;++o)l=p[o],x<=l&&l<=S&&D[bisect(A,l,0,k)].push(t[o]);return D}return n.value=function(t){return arguments.length?(e=typeof t=="function"?t:constant(t),n):e},n.domain=function(t){return arguments.length?(i=typeof t=="function"?t:constant([t[0],t[1]]),n):i},n.thresholds=function(t){return arguments.length?(r=typeof t=="function"?t:Array.isArray(t)?constant(slice.call(t)):constant(t),n):r},n}function KR(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function m5(e){return e===null?NaN:+e}function g5(e,i,r){if(r==null&&(r=m5),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,t=(n-1)*i,o=Math.floor(t),u=+r(e[o],o,e),l=+r(e[o+1],o+1,e);return u+(l-u)*(t-o)}}var y5=z(87765),ac="$";function Em(){}Em.prototype=m1.prototype={constructor:Em,has:function(e){return ac+e in this},get:function(e){return this[ac+e]},set:function(e,i){return this[ac+e]=i,this},remove:function(e){var i=ac+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===ac&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===ac&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===ac&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===ac&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===ac&&++e;return e},empty:function(){for(var e in this)if(e[0]===ac)return!1;return!0},each:function(e){for(var i in this)i[0]===ac&&e(this[i],i.slice(1),this)}};function m1(e,i){var r=new Em;if(e instanceof Em)e.each(function(l,p){r.set(p,l)});else if(Array.isArray(e)){var n=-1,t=e.length,o;if(i==null)for(;++n<t;)r.set(n,e[n]);else for(;++n<t;)r.set(i(o=e[n],n,e),o)}else if(e)for(var u in e)r.set(u,e[u]);return r}var L0=m1;function JR(){var e=[],i=[],r,n,t;function o(l,p,v,x){if(p>=e.length)return r!=null&&l.sort(r),n!=null?n(l):l;for(var S=-1,A=l.length,k=e[p++],D,R,N=map(),W,me=v();++S<A;)(W=N.get(D=k(R=l[S])+""))?W.push(R):N.set(D,[R]);return N.each(function(ye,Ne){x(me,Ne,o(ye,p,v,x))}),me}function u(l,p){if(++p>e.length)return l;var v,x=i[p-1];return n!=null&&p>=e.length?v=l.entries():(v=[],l.each(function(S,A){v.push({key:A,values:u(S,p)})})),x!=null?v.sort(function(S,A){return x(S.key,A.key)}):v}return t={object:function(l){return o(l,0,_5,x5)},map:function(l){return o(l,0,g1,y1)},entries:function(l){return u(o(l,0,g1,y1),0)},key:function(l){return e.push(l),t},sortKeys:function(l){return i[e.length-1]=l,t},sortValues:function(l){return r=l,t},rollup:function(l){return n=l,t}}}function _5(){return{}}function x5(e,i,r){e[i]=r}function g1(){return map()}function y1(e,i,r){e.set(i,r)}function Am(){}var xp=L0.prototype;Am.prototype=b5.prototype={constructor:Am,has:xp.has,add:function(e){return e+="",this[ac+e]=e,this},remove:xp.remove,clear:xp.clear,values:xp.keys,size:xp.size,empty:xp.empty,each:xp.each};function b5(e,i){var r=new Am;if(e instanceof Am)e.each(function(o){r.add(o)});else if(e){var n=-1,t=e.length;if(i==null)for(;++n<t;)r.add(e[n]);else for(;++n<t;)r.add(i(e[n],n,e))}return r}var QR=null,_1=Array.prototype,x1=_1.map,bp=_1.slice;function zh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function b1(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var S1={name:"implicit"};function Cm(){var e=L0(),i=[],r=[],n=S1;function t(o){var u=o+"",l=e.get(u);if(!l){if(n!==S1)return n;e.set(u,l=i.push(o))}return r[(l-1)%r.length]}return t.domain=function(o){if(!arguments.length)return i.slice();i=[],e=L0();for(var u=-1,l=o.length,p,v;++u<l;)e.has(v=(p=o[u])+"")||e.set(v,i.push(p));return t},t.range=function(o){return arguments.length?(r=bp.call(o),t):r.slice()},t.unknown=function(o){return arguments.length?(n=o,t):n},t.copy=function(){return Cm(i,r).unknown(n)},zh.apply(t,arguments),t}function w1(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],t,o,u=!1,l=0,p=0,v=.5;delete e.unknown;function x(){var S=i().length,A=n[1]<n[0],k=n[A-0],D=n[1-A];t=(D-k)/Math.max(1,S-l+p*2),u&&(t=Math.floor(t)),k+=(D-k-t*(S-l))*v,o=t*(1-l),u&&(k=Math.round(k),o=Math.round(o));var R=sequence(S).map(function(N){return k+t*N});return r(A?R.reverse():R)}return e.domain=function(S){return arguments.length?(i(S),x()):i()},e.range=function(S){return arguments.length?(n=[+S[0],+S[1]],x()):n.slice()},e.rangeRound=function(S){return n=[+S[0],+S[1]],u=!0,x()},e.bandwidth=function(){return o},e.step=function(){return t},e.round=function(S){return arguments.length?(u=!!S,x()):u},e.padding=function(S){return arguments.length?(l=Math.min(1,p=+S),x()):l},e.paddingInner=function(S){return arguments.length?(l=Math.min(1,S),x()):l},e.paddingOuter=function(S){return arguments.length?(p=+S,x()):p},e.align=function(S){return arguments.length?(v=Math.max(0,Math.min(1,S)),x()):v},e.copy=function(){return w1(i(),n).round(u).paddingInner(l).paddingOuter(p).align(v)},initRange.apply(x(),arguments)}function E1(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return E1(i())},e}function e6(){return E1(w1.apply(null,arguments).paddingInner(1))}var S5=z(21775),w5=z(73626);function E5(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function A5(e){return function(){return e}}function C5(e){return+e}var A1=[0,1];function bu(e){return e}function R0(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:A5(isNaN(i)?NaN:.5)}function C1(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(t){return Math.max(i,Math.min(r,t))}}function T5(e,i,r){var n=e[0],t=e[1],o=i[0],u=i[1];return t<n?(n=R0(t,n),o=r(u,o)):(n=R0(n,t),o=r(o,u)),function(l){return o(n(l))}}function M5(e,i,r){var n=Math.min(e.length,i.length)-1,t=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++u<n;)t[u]=R0(e[u],e[u+1]),o[u]=r(i[u],i[u+1]);return function(l){var p=Sm(e,l,1,n)-1;return o[p](t[p](l))}}function Tm(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function D0(){var e=A1,i=A1,r=S5.Z,n,t,o,u=bu,l,p,v;function x(){return l=Math.min(e.length,i.length)>2?M5:T5,p=v=null,S}function S(A){return isNaN(A=+A)?o:(p||(p=l(e.map(n),i,r)))(n(u(A)))}return S.invert=function(A){return u(t((v||(v=l(i,e.map(n),w5.Z)))(A)))},S.domain=function(A){return arguments.length?(e=x1.call(A,C5),u===bu||(u=C1(e)),x()):e.slice()},S.range=function(A){return arguments.length?(i=bp.call(A),x()):i.slice()},S.rangeRound=function(A){return i=bp.call(A),r=E5,x()},S.clamp=function(A){return arguments.length?(u=A?C1(e):bu,S):u!==bu},S.interpolate=function(A){return arguments.length?(r=A,x()):r},S.unknown=function(A){return arguments.length?(o=A,S):o},function(A,k){return n=A,t=k,x()}}function T1(e,i){return D0()(e,i)}var k5=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Mm(e){if(!(i=k5.exec(e)))throw new Error("invalid format: "+e);var i;return new O0({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}Mm.prototype=O0.prototype;function O0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}O0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function I5(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function km(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function fd(e){return e=km(Math.abs(e)),e?e[1]:NaN}function P5(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(fd(i)/3)))*3-fd(Math.abs(e)))}function L5(e,i){return function(r,n){for(var t=r.length,o=[],u=0,l=e[0],p=0;t>0&&l>0&&(p+l+1>n&&(l=Math.max(1,n-p)),o.push(r.substring(t-=l,t+l)),!((p+=l+1)>n));)l=e[u=(u+1)%e.length];return o.reverse().join(i)}}function R5(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function D5(e){e:for(var i=e.length,r=1,n=-1,t;r<i;++r)switch(e[r]){case".":n=t=r;break;case"0":n===0&&(n=r),t=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(t+1):e}var M1;function O5(e,i){var r=km(e,i);if(!r)return e+"";var n=r[0],t=r[1],o=t-(M1=Math.max(-8,Math.min(8,Math.floor(t/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+km(e,Math.max(0,i+o-1))[0]}function k1(e,i){var r=km(e,i);if(!r)return e+"";var n=r[0],t=r[1];return t<0?"0."+new Array(-t).join("0")+n:n.length>t+1?n.slice(0,t+1)+"."+n.slice(t+1):n+new Array(t-n.length+2).join("0")}var I1={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:I5,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return k1(e*100,i)},r:k1,s:O5,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function P1(e){return e}var L1=Array.prototype.map,R1=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function F5(e){var i=e.grouping===void 0||e.thousands===void 0?P1:L5(L1.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",t=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?P1:R5(L1.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",p=e.nan===void 0?"NaN":e.nan+"";function v(S){S=Mm(S);var A=S.fill,k=S.align,D=S.sign,R=S.symbol,N=S.zero,W=S.width,me=S.comma,ye=S.precision,Ne=S.trim,Ue=S.type;Ue==="n"?(me=!0,Ue="g"):I1[Ue]||(ye===void 0&&(ye=12),Ne=!0,Ue="g"),(N||A==="0"&&k==="=")&&(N=!0,A="0",k="=");var tt=R==="$"?r:R==="#"&&/[boxX]/.test(Ue)?"0"+Ue.toLowerCase():"",Et=R==="$"?n:/[%p]/.test(Ue)?u:"",Vt=I1[Ue],Yt=/[defgprs%]/.test(Ue);ye=ye===void 0?6:/[gprs]/.test(Ue)?Math.max(1,Math.min(21,ye)):Math.max(0,Math.min(20,ye));function gr(hr){var Hr=tt,fn=Et,Rn,Zi,Ia;if(Ue==="c")fn=Vt(hr)+fn,hr="";else{hr=+hr;var Za=hr<0||1/hr<0;if(hr=isNaN(hr)?p:Vt(Math.abs(hr),ye),Ne&&(hr=D5(hr)),Za&&+hr==0&&D!=="+"&&(Za=!1),Hr=(Za?D==="("?D:l:D==="-"||D==="("?"":D)+Hr,fn=(Ue==="s"?R1[8+M1/3]:"")+fn+(Za&&D==="("?")":""),Yt){for(Rn=-1,Zi=hr.length;++Rn<Zi;)if(Ia=hr.charCodeAt(Rn),48>Ia||Ia>57){fn=(Ia===46?t+hr.slice(Rn+1):hr.slice(Rn))+fn,hr=hr.slice(0,Rn);break}}}me&&!N&&(hr=i(hr,Infinity));var io=Hr.length+hr.length+fn.length,Wo=io<W?new Array(W-io+1).join(A):"";switch(me&&N&&(hr=i(Wo+hr,Wo.length?W-fn.length:Infinity),Wo=""),k){case"<":hr=Hr+hr+fn+Wo;break;case"=":hr=Hr+Wo+hr+fn;break;case"^":hr=Wo.slice(0,io=Wo.length>>1)+Hr+hr+fn+Wo.slice(io);break;default:hr=Wo+Hr+hr+fn;break}return o(hr)}return gr.toString=function(){return S+""},gr}function x(S,A){var k=v((S=Mm(S),S.type="f",S)),D=Math.max(-8,Math.min(8,Math.floor(fd(A)/3)))*3,R=Math.pow(10,-D),N=R1[8+D/3];return function(W){return k(R*W)+N}}return{format:v,formatPrefix:x}}var Im,F0,D1;B5({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function B5(e){return Im=F5(e),F0=Im.format,D1=Im.formatPrefix,Im}function z5(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,fd(i)-fd(e))+1}function N5(e){return Math.max(0,-fd(Math.abs(e)))}function Z5(e,i,r,n){var t=P0(e,i,r),o;switch(n=Mm(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(o=P5(t,u))&&(n.precision=o),D1(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=z5(t,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=N5(t))&&(n.precision=o-(n.type==="%")*2);break}}return F0(n)}function dv(e){var i=e.domain;return e.ticks=function(r){var n=i();return v1(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var t=i();return Z5(t[0],t[t.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),t=0,o=n.length-1,u=n[t],l=n[o],p;return l<u&&(p=u,u=l,l=p,p=t,t=o,o=p),p=wm(u,l,r),p>0?(u=Math.floor(u/p)*p,l=Math.ceil(l/p)*p,p=wm(u,l,r)):p<0&&(u=Math.ceil(u*p)/p,l=Math.floor(l*p)/p,p=wm(u,l,r)),p>0?(n[t]=Math.floor(u/p)*p,n[o]=Math.ceil(l/p)*p,i(n)):p<0&&(n[t]=Math.ceil(u*p)/p,n[o]=Math.floor(l*p)/p,i(n)),e},e}function O1(){var e=T1(bu,bu);return e.copy=function(){return Tm(e,O1())},zh.apply(e,arguments),dv(e)}function U5(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=map.call(n,number),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return U5(e).unknown(i)},e=arguments.length?map.call(e,number):[0,1],linearish(r)}function F1(e,i){e=e.slice();var r=0,n=e.length-1,t=e[r],o=e[n],u;return o<t&&(u=r,r=n,n=u,u=t,t=o,o=u),e[r]=i.floor(t),e[n]=i.ceil(o),e}function B1(e){return Math.log(e)}function z1(e){return Math.exp(e)}function V5(e){return-Math.log(-e)}function j5(e){return-Math.exp(-e)}function G5(e){return isFinite(e)?+("1e"+e):e<0?0:e}function H5(e){return e===10?G5:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function W5(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function N1(e){return function(i){return-e(-i)}}function $5(e){var i=e(B1,z1),r=i.domain,n=10,t,o;function u(){return t=W5(n),o=H5(n),r()[0]<0?(t=N1(t),o=N1(o),e(V5,j5)):e(B1,z1),i}return i.base=function(l){return arguments.length?(n=+l,u()):n},i.domain=function(l){return arguments.length?(r(l),u()):r()},i.ticks=function(l){var p=r(),v=p[0],x=p[p.length-1],S;(S=x<v)&&(A=v,v=x,x=A);var A=t(v),k=t(x),D,R,N,W=l==null?10:+l,me=[];if(!(n%1)&&k-A<W){if(A=Math.round(A)-1,k=Math.round(k)+1,v>0){for(;A<k;++A)for(R=1,D=o(A);R<n;++R)if(N=D*R,!(N<v)){if(N>x)break;me.push(N)}}else for(;A<k;++A)for(R=n-1,D=o(A);R>=1;--R)if(N=D*R,!(N<v)){if(N>x)break;me.push(N)}}else me=v1(A,k,Math.min(k-A,W)).map(o);return S?me.reverse():me},i.tickFormat=function(l,p){if(p==null&&(p=n===10?".0e":","),typeof p!="function"&&(p=F0(p)),l===Infinity)return p;l==null&&(l=10);var v=Math.max(1,n*l/i.ticks().length);return function(x){var S=x/o(Math.round(t(x)));return S*n<n-.5&&(S*=n),S<=v?p(x):""}},i.nice=function(){return r(F1(r(),{floor:function(l){return o(Math.floor(t(l)))},ceil:function(l){return o(Math.ceil(t(l)))}}))},i}function Z1(){var e=$5(D0()).domain([1,10]);return e.copy=function(){return Tm(e,Z1()).base(e.base())},zh.apply(e,arguments),e}function U1(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function V1(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function X5(e){var i=1,r=e(U1(i),V1(i));return r.constant=function(n){return arguments.length?e(U1(i=+n),V1(i)):i},linearish(r)}function Y5(){var e=X5(transformer());return e.copy=function(){return copy(e,Y5()).constant(e.constant())},initRange.apply(e,arguments)}function j1(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function q5(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function K5(e){return e<0?-e*e:e*e}function J5(e){var i=e(bu,bu),r=1;function n(){return r===1?e(bu,bu):r===.5?e(q5,K5):e(j1(r),j1(1/r))}return i.exponent=function(t){return arguments.length?(r=+t,n()):r},dv(i)}function B0(){var e=J5(D0());return e.copy=function(){return Tm(e,B0()).exponent(e.exponent())},zh.apply(e,arguments),e}function t6(){return B0.apply(null,arguments).exponent(.5)}function G1(){var e=[],i=[],r=[],n;function t(){var u=0,l=Math.max(1,i.length);for(r=new Array(l-1);++u<l;)r[u-1]=g5(e,u/l);return o}function o(u){return isNaN(u=+u)?n:i[Sm(r,u)]}return o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var l=0,p=u.length,v;l<p;++l)v=u[l],v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(T0),t()},o.range=function(u){return arguments.length?(i=bp.call(u),t()):i.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return G1().domain(e).range(i).unknown(n)},zh.apply(o,arguments)}function H1(){var e=0,i=1,r=1,n=[.5],t=[0,1],o;function u(p){return p<=p?t[Sm(n,p,0,r)]:o}function l(){var p=-1;for(n=new Array(r);++p<r;)n[p]=((p+1)*i-(p-r)*e)/(r+1);return u}return u.domain=function(p){return arguments.length?(e=+p[0],i=+p[1],l()):[e,i]},u.range=function(p){return arguments.length?(r=(t=bp.call(p)).length-1,l()):t.slice()},u.invertExtent=function(p){var v=t.indexOf(p);return v<0?[NaN,NaN]:v<1?[e,n[0]]:v>=r?[n[r-1],i]:[n[v-1],n[v]]},u.unknown=function(p){return arguments.length&&(o=p),u},u.thresholds=function(){return n.slice()},u.copy=function(){return H1().domain([e,i]).range(t).unknown(o)},zh.apply(dv(u),arguments)}function W1(){var e=[.5],i=[0,1],r,n=1;function t(o){return o<=o?i[Sm(e,o,0,n)]:r}return t.domain=function(o){return arguments.length?(e=bp.call(o),n=Math.min(e.length,i.length-1),t):e.slice()},t.range=function(o){return arguments.length?(i=bp.call(o),n=Math.min(e.length,i.length-1),t):i.slice()},t.invertExtent=function(o){var u=i.indexOf(o);return[e[u-1],e[u]]},t.unknown=function(o){return arguments.length?(r=o,t):r},t.copy=function(){return W1().domain(e).range(i).unknown(r)},zh.apply(t,arguments)}var z0=new Date,N0=new Date;function Fu(e,i,r,n){function t(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return t.floor=function(o){return e(o=new Date(+o)),o},t.ceil=function(o){return e(o=new Date(o-1)),i(o,1),e(o),o},t.round=function(o){var u=t(o),l=t.ceil(o);return o-u<l-o?u:l},t.offset=function(o,u){return i(o=new Date(+o),u==null?1:Math.floor(u)),o},t.range=function(o,u,l){var p=[],v;if(o=t.ceil(o),l=l==null?1:Math.floor(l),!(o<u)||!(l>0))return p;do p.push(v=new Date(+o)),i(o,l),e(o);while(v<o&&o<u);return p},t.filter=function(o){return Fu(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,l){if(u>=u)if(l<0)for(;++l<=0;)for(;i(u,-1),!o(u););else for(;--l>=0;)for(;i(u,1),!o(u););})},r&&(t.count=function(o,u){return z0.setTime(+o),N0.setTime(+u),e(z0),e(N0),Math.floor(r(z0,N0))},t.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?t.filter(n?function(u){return n(u)%o==0}:function(u){return t.count(0,u)%o==0}):t}),t}var Z0=Fu(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Z0.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Fu(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var hd=Z0,r6=Z0.range,$1=Fu(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),Q5=$1,n6=$1.range,Pm=1e3,vv=6e4,X1=36e5,Y1=864e5,q1=6048e5;function Sp(e){return Fu(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*vv)/q1})}var U0=Sp(0),Lm=Sp(1),e4=Sp(2),t4=Sp(3),pd=Sp(4),r4=Sp(5),n4=Sp(6),i6=U0.range,a6=Lm.range,o6=e4.range,s6=t4.range,u6=pd.range,l6=r4.range,c6=n4.range,K1=Fu(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*vv)/Y1},function(e){return e.getDate()-1}),V0=K1,f6=K1.range,J1=Fu(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Pm-e.getMinutes()*vv)},function(e,i){e.setTime(+e+i*X1)},function(e,i){return(i-e)/X1},function(e){return e.getHours()}),i4=J1,h6=J1.range,Q1=Fu(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Pm)},function(e,i){e.setTime(+e+i*vv)},function(e,i){return(i-e)/vv},function(e){return e.getMinutes()}),a4=Q1,p6=Q1.range,ex=Fu(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*Pm)},function(e,i){return(i-e)/Pm},function(e){return e.getUTCSeconds()}),o4=ex,d6=ex.range,Rm=Fu(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});Rm.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Fu(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):Rm};var s4=Rm,v6=Rm.range;function wp(e){return Fu(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/q1})}var tx=wp(0),Dm=wp(1),u4=wp(2),l4=wp(3),dd=wp(4),c4=wp(5),f4=wp(6),m6=tx.range,g6=Dm.range,y6=u4.range,_6=l4.range,x6=dd.range,b6=c4.range,S6=f4.range,rx=Fu(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/Y1},function(e){return e.getUTCDate()-1}),nx=rx,w6=rx.range,j0=Fu(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});j0.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Fu(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var mv=j0,E6=j0.range;function G0(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function H0(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function gv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function h4(e){var i=e.dateTime,r=e.date,n=e.time,t=e.periods,o=e.days,u=e.shortDays,l=e.months,p=e.shortMonths,v=yv(t),x=_v(t),S=yv(o),A=_v(o),k=yv(u),D=_v(u),R=yv(l),N=_v(l),W=yv(p),me=_v(p),ye={a:Za,A:io,b:Wo,B:nh,c:null,d:lx,e:lx,f:O4,g:H4,G:$4,H:L4,I:R4,j:D4,L:cx,m:F4,M:B4,p:oR,q:sR,Q:mx,s:gx,S:z4,u:N4,U:Z4,V:U4,w:V4,W:j4,x:null,X:null,y:G4,Y:W4,Z:X4,"%":vx},Ne={a:uR,A:lR,b:cR,B:fR,c:null,d:hx,e:hx,f:J4,g:uk,G:ck,H:Y4,I:q4,j:K4,L:px,m:Q4,M:ek,p:hR,q:pR,Q:mx,s:gx,S:tk,u:rk,U:nk,V:ik,w:ak,W:ok,x:null,X:null,y:sk,Y:lk,Z:fk,"%":vx},Ue={a:gr,A:hr,b:Hr,B:fn,c:Rn,d:sx,e:sx,f:M4,g:ox,G:ax,H:ux,I:ux,j:E4,L:T4,m:w4,M:A4,p:Yt,q:S4,Q:I4,s:P4,S:C4,u:g4,U:y4,V:_4,w:m4,W:x4,x:Zi,X:Ia,y:ox,Y:ax,Z:b4,"%":k4};ye.x=tt(r,ye),ye.X=tt(n,ye),ye.c=tt(i,ye),Ne.x=tt(r,Ne),Ne.X=tt(n,Ne),Ne.c=tt(i,Ne);function tt(ti,ta){return function(ma){var hn=[],sl=-1,fo=0,Dl=ti.length,Ol,Tp,s2;for(ma instanceof Date||(ma=new Date(+ma));++sl<Dl;)ti.charCodeAt(sl)===37&&(hn.push(ti.slice(fo,sl)),(Tp=ix[Ol=ti.charAt(++sl)])!=null?Ol=ti.charAt(++sl):Tp=Ol==="e"?" ":"0",(s2=ta[Ol])&&(Ol=s2(ma,Tp)),hn.push(Ol),fo=sl+1);return hn.push(ti.slice(fo,sl)),hn.join("")}}function Et(ti,ta){return function(ma){var hn=gv(1900,void 0,1),sl=Vt(hn,ti,ma+="",0),fo,Dl;if(sl!=ma.length)return null;if("Q"in hn)return new Date(hn.Q);if("s"in hn)return new Date(hn.s*1e3+("L"in hn?hn.L:0));if(ta&&!("Z"in hn)&&(hn.Z=0),"p"in hn&&(hn.H=hn.H%12+hn.p*12),hn.m===void 0&&(hn.m="q"in hn?hn.q:0),"V"in hn){if(hn.V<1||hn.V>53)return null;"w"in hn||(hn.w=1),"Z"in hn?(fo=H0(gv(hn.y,0,1)),Dl=fo.getUTCDay(),fo=Dl>4||Dl===0?Dm.ceil(fo):Dm(fo),fo=nx.offset(fo,(hn.V-1)*7),hn.y=fo.getUTCFullYear(),hn.m=fo.getUTCMonth(),hn.d=fo.getUTCDate()+(hn.w+6)%7):(fo=G0(gv(hn.y,0,1)),Dl=fo.getDay(),fo=Dl>4||Dl===0?Lm.ceil(fo):Lm(fo),fo=V0.offset(fo,(hn.V-1)*7),hn.y=fo.getFullYear(),hn.m=fo.getMonth(),hn.d=fo.getDate()+(hn.w+6)%7)}else("W"in hn||"U"in hn)&&("w"in hn||(hn.w="u"in hn?hn.u%7:"W"in hn?1:0),Dl="Z"in hn?H0(gv(hn.y,0,1)).getUTCDay():G0(gv(hn.y,0,1)).getDay(),hn.m=0,hn.d="W"in hn?(hn.w+6)%7+hn.W*7-(Dl+5)%7:hn.w+hn.U*7-(Dl+6)%7);return"Z"in hn?(hn.H+=hn.Z/100|0,hn.M+=hn.Z%100,H0(hn)):G0(hn)}}function Vt(ti,ta,ma,hn){for(var sl=0,fo=ta.length,Dl=ma.length,Ol,Tp;sl<fo;){if(hn>=Dl)return-1;if(Ol=ta.charCodeAt(sl++),Ol===37){if(Ol=ta.charAt(sl++),Tp=Ue[Ol in ix?ta.charAt(sl++):Ol],!Tp||(hn=Tp(ti,ma,hn))<0)return-1}else if(Ol!=ma.charCodeAt(hn++))return-1}return hn}function Yt(ti,ta,ma){var hn=v.exec(ta.slice(ma));return hn?(ti.p=x[hn[0].toLowerCase()],ma+hn[0].length):-1}function gr(ti,ta,ma){var hn=k.exec(ta.slice(ma));return hn?(ti.w=D[hn[0].toLowerCase()],ma+hn[0].length):-1}function hr(ti,ta,ma){var hn=S.exec(ta.slice(ma));return hn?(ti.w=A[hn[0].toLowerCase()],ma+hn[0].length):-1}function Hr(ti,ta,ma){var hn=W.exec(ta.slice(ma));return hn?(ti.m=me[hn[0].toLowerCase()],ma+hn[0].length):-1}function fn(ti,ta,ma){var hn=R.exec(ta.slice(ma));return hn?(ti.m=N[hn[0].toLowerCase()],ma+hn[0].length):-1}function Rn(ti,ta,ma){return Vt(ti,i,ta,ma)}function Zi(ti,ta,ma){return Vt(ti,r,ta,ma)}function Ia(ti,ta,ma){return Vt(ti,n,ta,ma)}function Za(ti){return u[ti.getDay()]}function io(ti){return o[ti.getDay()]}function Wo(ti){return p[ti.getMonth()]}function nh(ti){return l[ti.getMonth()]}function oR(ti){return t[+(ti.getHours()>=12)]}function sR(ti){return 1+~~(ti.getMonth()/3)}function uR(ti){return u[ti.getUTCDay()]}function lR(ti){return o[ti.getUTCDay()]}function cR(ti){return p[ti.getUTCMonth()]}function fR(ti){return l[ti.getUTCMonth()]}function hR(ti){return t[+(ti.getUTCHours()>=12)]}function pR(ti){return 1+~~(ti.getUTCMonth()/3)}return{format:function(ti){var ta=tt(ti+="",ye);return ta.toString=function(){return ti},ta},parse:function(ti){var ta=Et(ti+="",!1);return ta.toString=function(){return ti},ta},utcFormat:function(ti){var ta=tt(ti+="",Ne);return ta.toString=function(){return ti},ta},utcParse:function(ti){var ta=Et(ti+="",!0);return ta.toString=function(){return ti},ta}}}var ix={"-":"",_:" ","0":"0"},Ks=/^\s*\d+/,p4=/^%/,d4=/[\\^$*+?|[\]().{}]/g;function va(e,i,r){var n=e<0?"-":"",t=(n?-e:e)+"",o=t.length;return n+(o<r?new Array(r-o+1).join(i)+t:t)}function v4(e){return e.replace(d4,"\\$&")}function yv(e){return new RegExp("^(?:"+e.map(v4).join("|")+")","i")}function _v(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function m4(e,i,r){var n=Ks.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function g4(e,i,r){var n=Ks.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function y4(e,i,r){var n=Ks.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function _4(e,i,r){var n=Ks.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function x4(e,i,r){var n=Ks.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function ax(e,i,r){var n=Ks.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function ox(e,i,r){var n=Ks.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function b4(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function S4(e,i,r){var n=Ks.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function w4(e,i,r){var n=Ks.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function sx(e,i,r){var n=Ks.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function E4(e,i,r){var n=Ks.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function ux(e,i,r){var n=Ks.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function A4(e,i,r){var n=Ks.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function C4(e,i,r){var n=Ks.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function T4(e,i,r){var n=Ks.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function M4(e,i,r){var n=Ks.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function k4(e,i,r){var n=p4.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function I4(e,i,r){var n=Ks.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function P4(e,i,r){var n=Ks.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function lx(e,i){return va(e.getDate(),i,2)}function L4(e,i){return va(e.getHours(),i,2)}function R4(e,i){return va(e.getHours()%12||12,i,2)}function D4(e,i){return va(1+V0.count(hd(e),e),i,3)}function cx(e,i){return va(e.getMilliseconds(),i,3)}function O4(e,i){return cx(e,i)+"000"}function F4(e,i){return va(e.getMonth()+1,i,2)}function B4(e,i){return va(e.getMinutes(),i,2)}function z4(e,i){return va(e.getSeconds(),i,2)}function N4(e){var i=e.getDay();return i===0?7:i}function Z4(e,i){return va(U0.count(hd(e)-1,e),i,2)}function fx(e){var i=e.getDay();return i>=4||i===0?pd(e):pd.ceil(e)}function U4(e,i){return e=fx(e),va(pd.count(hd(e),e)+(hd(e).getDay()===4),i,2)}function V4(e){return e.getDay()}function j4(e,i){return va(Lm.count(hd(e)-1,e),i,2)}function G4(e,i){return va(e.getFullYear()%100,i,2)}function H4(e,i){return e=fx(e),va(e.getFullYear()%100,i,2)}function W4(e,i){return va(e.getFullYear()%1e4,i,4)}function $4(e,i){var r=e.getDay();return e=r>=4||r===0?pd(e):pd.ceil(e),va(e.getFullYear()%1e4,i,4)}function X4(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+va(i/60|0,"0",2)+va(i%60,"0",2)}function hx(e,i){return va(e.getUTCDate(),i,2)}function Y4(e,i){return va(e.getUTCHours(),i,2)}function q4(e,i){return va(e.getUTCHours()%12||12,i,2)}function K4(e,i){return va(1+nx.count(mv(e),e),i,3)}function px(e,i){return va(e.getUTCMilliseconds(),i,3)}function J4(e,i){return px(e,i)+"000"}function Q4(e,i){return va(e.getUTCMonth()+1,i,2)}function ek(e,i){return va(e.getUTCMinutes(),i,2)}function tk(e,i){return va(e.getUTCSeconds(),i,2)}function rk(e){var i=e.getUTCDay();return i===0?7:i}function nk(e,i){return va(tx.count(mv(e)-1,e),i,2)}function dx(e){var i=e.getUTCDay();return i>=4||i===0?dd(e):dd.ceil(e)}function ik(e,i){return e=dx(e),va(dd.count(mv(e),e)+(mv(e).getUTCDay()===4),i,2)}function ak(e){return e.getUTCDay()}function ok(e,i){return va(Dm.count(mv(e)-1,e),i,2)}function sk(e,i){return va(e.getUTCFullYear()%100,i,2)}function uk(e,i){return e=dx(e),va(e.getUTCFullYear()%100,i,2)}function lk(e,i){return va(e.getUTCFullYear()%1e4,i,4)}function ck(e,i){var r=e.getUTCDay();return e=r>=4||r===0?dd(e):dd.ceil(e),va(e.getUTCFullYear()%1e4,i,4)}function fk(){return"+0000"}function vx(){return"%"}function mx(e){return+e}function gx(e){return Math.floor(+e/1e3)}var vd,yx,hk,pk,dk;vk({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function vk(e){return vd=h4(e),yx=vd.format,hk=vd.parse,pk=vd.utcFormat,dk=vd.utcParse,vd}var xv=1e3,bv=xv*60,Sv=bv*60,wv=Sv*24,mk=wv*7,_x=wv*30,W0=wv*365;function gk(e){return new Date(e)}function yk(e){return e instanceof Date?+e:+new Date(+e)}function xx(e,i,r,n,t,o,u,l,p){var v=T1(bu,bu),x=v.invert,S=v.domain,A=p(".%L"),k=p(":%S"),D=p("%I:%M"),R=p("%I %p"),N=p("%a %d"),W=p("%b %d"),me=p("%B"),ye=p("%Y"),Ne=[[u,1,xv],[u,5,5*xv],[u,15,15*xv],[u,30,30*xv],[o,1,bv],[o,5,5*bv],[o,15,15*bv],[o,30,30*bv],[t,1,Sv],[t,3,3*Sv],[t,6,6*Sv],[t,12,12*Sv],[n,1,wv],[n,2,2*wv],[r,1,mk],[i,1,_x],[i,3,3*_x],[e,1,W0]];function Ue(Et){return(u(Et)<Et?A:o(Et)<Et?k:t(Et)<Et?D:n(Et)<Et?R:i(Et)<Et?r(Et)<Et?N:W:e(Et)<Et?me:ye)(Et)}function tt(Et,Vt,Yt,gr){if(Et==null&&(Et=10),typeof Et=="number"){var hr=Math.abs(Yt-Vt)/Et,Hr=f1(function(fn){return fn[2]}).right(Ne,hr);Hr===Ne.length?(gr=P0(Vt/W0,Yt/W0,Et),Et=e):Hr?(Hr=Ne[hr/Ne[Hr-1][2]<Ne[Hr][2]/hr?Hr-1:Hr],gr=Hr[1],Et=Hr[0]):(gr=Math.max(P0(Vt,Yt,Et),1),Et=l)}return gr==null?Et:Et.every(gr)}return v.invert=function(Et){return new Date(x(Et))},v.domain=function(Et){return arguments.length?S(x1.call(Et,yk)):S().map(gk)},v.ticks=function(Et,Vt){var Yt=S(),gr=Yt[0],hr=Yt[Yt.length-1],Hr=hr<gr,fn;return Hr&&(fn=gr,gr=hr,hr=fn),fn=tt(Et,gr,hr,Vt),fn=fn?fn.range(gr,hr+1):[],Hr?fn.reverse():fn},v.tickFormat=function(Et,Vt){return Vt==null?Ue:p(Vt)},v.nice=function(Et,Vt){var Yt=S();return(Et=tt(Et,Yt[0],Yt[Yt.length-1],Vt))?S(F1(Yt,Et)):v},v.copy=function(){return Tm(v,xx(e,i,r,n,t,o,u,l,p))},v}function _k(){return zh.apply(xx(hd,Q5,U0,V0,i4,a4,o4,s4,yx).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function A6(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Om(){var e=0,i=1,r,n,t,o,u=bu,l=!1,p;function v(x){return isNaN(x=+x)?p:u(t===0?.5:(x=(o(x)-r)*t,l?Math.max(0,Math.min(1,x)):x))}return v.domain=function(x){return arguments.length?(r=o(e=+x[0]),n=o(i=+x[1]),t=r===n?0:1/(n-r),v):[e,i]},v.clamp=function(x){return arguments.length?(l=!!x,v):l},v.interpolator=function(x){return arguments.length?(u=x,v):u},v.unknown=function(x){return arguments.length?(p=x,v):p},function(x){return o=x,r=x(e),n=x(i),t=r===n?0:1/(n-r),v}}function Ev(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function bx(){var e=dv(Om()(bu));return e.copy=function(){return Ev(e,bx())},b1.apply(e,arguments)}function xk(){var e=loggish(Om()).domain([1,10]);return e.copy=function(){return Ev(e,xk()).base(e.base())},initInterpolator.apply(e,arguments)}function bk(){var e=symlogish(Om());return e.copy=function(){return Ev(e,bk()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Sx(){var e=powish(Om());return e.copy=function(){return Ev(e,Sx()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function C6(){return Sx.apply(null,arguments).exponent(.5)}function Sk(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var t=0,o=n.length,u;t<o;++t)u=n[t],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return Sk(i).domain(e)},initInterpolator.apply(r,arguments)}function Fm(){var e=0,i=.5,r=1,n,t,o,u,l,p=bu,v,x=!1,S;function A(k){return isNaN(k=+k)?S:(k=.5+((k=+v(k))-t)*(k<t?u:l),p(x?Math.max(0,Math.min(1,k)):k))}return A.domain=function(k){return arguments.length?(n=v(e=+k[0]),t=v(i=+k[1]),o=v(r=+k[2]),u=n===t?0:.5/(t-n),l=t===o?0:.5/(o-t),A):[e,i,r]},A.clamp=function(k){return arguments.length?(x=!!k,A):x},A.interpolator=function(k){return arguments.length?(p=k,A):p},A.unknown=function(k){return arguments.length?(S=k,A):S},function(k){return v=k,n=k(e),t=k(i),o=k(r),u=n===t?0:.5/(t-n),l=t===o?0:.5/(o-t),A}}function Ex(){var e=dv(Fm()(bu));return e.copy=function(){return Ev(e,Ex())},b1.apply(e,arguments)}function wk(){var e=loggish(Fm()).domain([.1,1,10]);return e.copy=function(){return copy(e,wk()).base(e.base())},initInterpolator.apply(e,arguments)}function Ek(){var e=symlogish(Fm());return e.copy=function(){return copy(e,Ek()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Ax(){var e=powish(Fm());return e.copy=function(){return copy(e,Ax()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function T6(){return Ax.apply(null,arguments).exponent(.5)}function Cx(e){var i,r=[];function n(t){return t==null?i:t}return n.invert=n,n.domain=n.range=function(t){return t?(r=t,t):r},n.unknown=function(t){return t?(i=t,t):i},n.copy=function(){return Cx(e).unknown(i)},n}var Rl,Tx,Mx,$0=ii.isNil,Ak=ii.isString,Ck=ii.uniq,Tk=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Mk=(Rl={},(0,V.Z)(Rl,ka.LINEAR,O1),(0,V.Z)(Rl,ka.POWER,B0),(0,V.Z)(Rl,ka.LOG,Z1),(0,V.Z)(Rl,ka.IDENTITY,Cx),(0,V.Z)(Rl,ka.SEQUENTIAL,bx),(0,V.Z)(Rl,ka.TIME,_k),(0,V.Z)(Rl,ka.QUANTILE,G1),(0,V.Z)(Rl,ka.QUANTIZE,H1),(0,V.Z)(Rl,ka.THRESHOLD,W1),(0,V.Z)(Rl,ka.CAT,Cm),(0,V.Z)(Rl,ka.DIVERGING,Ex),Rl),kk=(Tx=(0,ut.b2)(),Tx(Mx=function(){function e(){(0,be.Z)(this,e),(0,V.Z)(this,"scaleOptions",{})}return(0,J.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("FeatureScalePlugin",(0,It.Z)(he().mark(function u(){var l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(r.log(ns.ScaleInitStart,yr.INIT),t.scaleOptions=r.getScaleOptions(),p=o.getLayerStyleAttributes(),v=(l=r.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(v)&&v.length===0)){S.next=8;break}return S.abrupt("return");case 8:t.caculateScalesForAttributes(p||[],v);case 9:r.log(ns.ScaleInitEnd,yr.INIT);case 10:case"end":return S.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var u=(0,It.Z)(he().mark(function l(p){var v,x;return he().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(p){A.next=2;break}return A.abrupt("return",p);case 2:if(r.log(ns.ScaleInitStart,yr.UPDATE),t.scaleOptions=r.getScaleOptions(),v=o.getLayerStyleAttributes(),x=r.getSource().data.dataArray,!(Array.isArray(x)&&x.length===0)){A.next=8;break}return A.abrupt("return",!0);case 8:return t.caculateScalesForAttributes(v||[],x),r.log(ns.ScaleInitEnd,yr.UPDATE),r.layerModelNeedUpdate=!0,A.abrupt("return",!0);case 12:case"end":return A.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){t.scaleOptions=r.getScaleOptions();var u=o.getLayerStyleAttributes(),l=r.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&u){var p=u.filter(function(v){return v.needRescale});p.length&&t.caculateScalesForAttributes(p,l)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var t=this;r.forEach(function(o){if(o.scale){var u=o.scale,l=o.scale.field;u.names=t.parseFields($0(l)?[]:l);var p=[];u.names.forEach(function(v){var x;p.push(t.createScale(v,o.name,(x=o.scale)===null||x===void 0?void 0:x.values,n))}),p.some(function(v){return v.type===id.VARIABLE})?(u.type=id.VARIABLE,p.forEach(function(v){if(!u.callback&&u.values!=="text"){var x;switch((x=v.option)===null||x===void 0?void 0:x.type){case ka.LOG:case ka.LINEAR:case ka.POWER:if(u.values&&u.values.length>2){var S=v.scale.ticks(u.values.length);v.scale.domain(S)}u.values?v.scale.range(u.values):v.scale.range(v.option.domain);break;case ka.QUANTILE:case ka.QUANTIZE:case ka.THRESHOLD:v.scale.range(u.values);break;case ka.IDENTITY:break;case ka.CAT:u.values?v.scale.range(u.values):v.scale.range(v.option.domain);break;case ka.DIVERGING:case ka.SEQUENTIAL:v.scale.interpolator(y5.hD(u.values));break}}if(u.values==="text"){var A;v.scale.range((A=v.option)===null||A===void 0?void 0:A.domain)}})):(u.type=id.CONSTANT,u.defaultValues=p.map(function(v,x){return v.scale(u.names[x])})),u.scalers=p.map(function(v){return{field:v.field,func:v.scale,option:v.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Ak(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,t,o){var u,l,p=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===r?this.scaleOptions[n]:this.scaleOptions[r],v={field:r,scale:void 0,type:id.VARIABLE,option:p};if(!o||!o.length)return p&&p.type?v.scale=this.createDefaultScale(p):(v.scale=Cm([r]),v.type=id.CONSTANT),v;var x=(l=o.find(function(k){return!$0(k[r])}))===null||l===void 0?void 0:l[r];if(this.isNumber(r)||$0(x)&&!p)v.scale=Cm([r]),v.type=id.CONSTANT;else{var S=p&&p.type||this.getDefaultType(x);t==="text"&&(S=ka.CAT),t===void 0&&(S=ka.IDENTITY);var A=this.createScaleConfig(S,r,p,o);v.scale=this.createDefaultScale(A),v.option=A}return v}},{key:"getDefaultType",value:function(r){var n=ka.LINEAR;return typeof r=="string"&&(n=Tk.test(r)?ka.TIME:ka.CAT),n}},{key:"createScaleConfig",value:function(r,n,t,o){var u={type:r},l=(o==null?void 0:o.map(function(x){return x[n]}))||[];if(t!=null&&t.domain)u.domain=t==null?void 0:t.domain;else if(r===ka.CAT||r===ka.IDENTITY)u.domain=Ck(l);else if(r===ka.QUANTILE)u.domain=l;else if(r===ka.DIVERGING){var p=p1(l),v=(t==null?void 0:t.neutral)!==void 0?t==null?void 0:t.neutral:(p[0]+p[1])/2;u.domain=[p[0],v,p[1]]}else u.domain=p1(l);return(0,O.Z)((0,O.Z)({},u),t)}},{key:"createDefaultScale",value:function(r){var n=r.type,t=r.domain,o=r.unknown,u=r.clamp,l=r.nice,p=Mk[n]();return t&&p.domain&&p.domain(t),o&&p.unknown(o),u!==void 0&&p.clamp&&p.clamp(u),l!==void 0&&p.nice&&p.nice(l),p}}]),e}())||Mx),kx,Ix,Ik=(kx=(0,ut.b2)(),kx(Ix=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=r.animateStatus;n&&r.models.forEach(function(t){t.addUniforms((0,O.Z)({},r.layerModel.getAnimateUniforms()))})})}}]),e}())||Ix),Px,Lx,Pk=(Px=(0,ut.b2)(),Px(Lx=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=r.getLayerConfig(),t=n.maskLayers,o=n.enableMask;if(!r.tileLayer&&t&&t.length>0){var u;(u=r.masks).push.apply(u,(0,cr.Z)(t)),r.updateLayerConfig({mask:o})}})}}]),e}())||Lx),Lk=function(){function e(i){var r=i.rendererService,n=i.layerService,t=i.parent;(0,be.Z)(this,e),(0,V.Z)(this,"tileResource",new Map),(0,V.Z)(this,"layerTiles",[]),this.rendererService=r,this.layerService=n,this.parent=t}return(0,J.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(r){return this.layerTiles.some(function(n){return n.key===r})}},{key:"addTile",value:function(r){this.layerTiles.push(r)}},{key:"getTile",value:function(r){return this.layerTiles.find(function(n){return n.key===r})}},{key:"getVisibleTileBylngLat",value:function(r){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(r)})}},{key:"removeTile",value:function(r){var n=this.layerTiles.findIndex(function(o){return o.key===r}),t=this.layerTiles.splice(n,1);t[0]&&t[0].destroy()}},{key:"updateTileVisible",value:function(r){var n=this.getTile(r.key);if(r.isVisible)if(r.parent){var t=this.isChildrenLoaded(r.parent);n==null||n.updateVisible(t)}else n==null||n.updateVisible(!0);else if(r.parent){var o=this.isChildrenLoaded(r.parent);n==null||n.updateVisible(!o)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(r){var n=r.parent;if(!n)return!0;var t=this.getTile(n==null?void 0:n.key);return!!(t!=null&&t.isLoaded)}},{key:"isChildrenLoaded",value:function(r){var n=this,t=r==null?void 0:r.children;return t.length===0?!0:t.every(function(o){var u=n.getTile(o==null?void 0:o.key);return u?(u==null?void 0:u.isLoaded)===!0:!0})}},{key:"render",value:function(){var i=(0,It.Z)(he().mark(function n(){var t=this,o,u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=this.getRenderLayers(),u=o.map(function(){var v=(0,It.Z)(he().mark(function x(S){return he().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,t.layerService.renderTileLayer(S);case 2:case"end":return k.stop()}},x)}));return function(x){return v.apply(this,arguments)}}()),p.next=4,Promise.all(u);case 4:case"end":return p.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"getRenderLayers",value:function(){var r=this.layerTiles.filter(function(t){return t.visible&&t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,cr.Z)(t.getLayers()))}),n}},{key:"getLayers",value:function(){var r=this.layerTiles.filter(function(t){return t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,cr.Z)(t.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(r){return r.destroy()}),this.tileResource.clear()}}]),e}(),Rk=z(32676);function Dk(e,i,r){r===void 0&&(r={});var n=mn(e),t=mn(i),o=Rk.union(n.coordinates,t.coordinates);return o.length===0?null:o.length===1?Lr(o[0],r.properties):Ai(o,r.properties)}var Ok=Dk,Fk=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"getCombineFeature",value:function(r){var n=null,t=r[0];return r.map(function(o){var u=Lr(o.coordinates);n===null?n=u:n=Ok(n,u)}),t&&(n.properties=(0,O.Z)({},t)),n}}]),e}(),Av="select",Cv="active",Bk=function(){function e(i){var r=i.layerService,n=i.tileLayerService,t=i.parent;(0,be.Z)(this,e),(0,V.Z)(this,"tilePickID",new Map),this.layerService=r,this.tileLayerService=n,this.parent=t,this.tileSourceService=new Fk}return(0,J.Z)(e,[{key:"pickRender",value:function(r){var n=this.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(n){var t=n.getMainLayer();t==null||t.layerPickService.pickRender(r)}}},{key:"pick",value:function(r,n){var t=this.parent.getContainer(),o=t.get(et.IPickingService);if(r.type==="RasterLayer"){var u=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(u&&u.getMainLayer()!==void 0){var l=u.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),o.pickFromPickingFBO(r,n)}},{key:"selectFeature",value:function(r){var n=(0,K.Z)(r,3),t=n[0],o=n[1],u=n[2],l=this.color2PickId(t,o,u);this.tilePickID.set(Av,l),this.updateHighLight(t,o,u,Av)}},{key:"highlightPickedFeature",value:function(r){var n=(0,K.Z)(r,3),t=n[0],o=n[1],u=n[2],l=this.color2PickId(t,o,u);this.tilePickID.set(Cv,l),this.updateHighLight(t,o,u,Cv)}},{key:"updateHighLight",value:function(r,n,t,o){this.tileLayerService.tiles.map(function(u){var l=u.getMainLayer();switch(o){case Av:l==null||l.hooks.beforeSelect.call([r,n,t]);break;case Cv:l==null||l.hooks.beforeHighlight.call([r,n,t]);break}})}},{key:"setPickState",value:function(){var r=this.tilePickID.get(Av),n=this.tilePickID.get(Cv);if(r){var t=this.pickId2Color(r),o=(0,K.Z)(t,3),u=o[0],l=o[1],p=o[2];this.updateHighLight(u,l,p,Av);return}if(n){var v=this.pickId2Color(n),x=(0,K.Z)(v,3),S=x[0],A=x[1],k=x[2];this.updateHighLight(S,A,k,Cv);return}}},{key:"color2PickId",value:function(r,n,t){return ra(new Uint8Array([r,n,t]))}},{key:"pickId2Color",value:function(r){return Ea(r)}},{key:"getFeatureById",value:function(r){var n=this.tileLayerService.getTiles().filter(function(o){return o.visible}),t=[];return n.forEach(function(o){t.push.apply(t,(0,cr.Z)(o.getFeatureById(r)))}),t}},{key:"pickRasterLayer",value:function(r,n,t){return!1}}]),e}();function zk(e){return e==="PolygonLayer"?_m:e==="LineLayer"?A0:ym}function Nk(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function Zk(e){var i=Uk();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function Uk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ep=function(e){(0,lt.Z)(r,e);var i=Zk(r);function r(n,t){var o;return(0,be.Z)(this,r),o=i.call(this),(0,V.Z)((0,Ee.Z)(o),"visible",!0),(0,V.Z)((0,Ee.Z)(o),"layers",[]),(0,V.Z)((0,Ee.Z)(o),"isLoaded",!1),(0,V.Z)((0,Ee.Z)(o),"tileMaskLayers",[]),o.parent=t,o.sourceTile=n,o.x=n.x,o.y=n.y,o.z=n.z,o.key="".concat(o.x,"_").concat(o.y,"_").concat(o.z),o}return(0,J.Z)(r,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(t){var o=(0,K.Z)(this.sourceTile.bounds,4),u=o[0],l=o[1],p=o[2],v=o[3],x=t.lng,S=t.lat;return x>=u&&x<=p&&S>=l&&S<=v}},{key:"getLayerOptions",value:function(){var t,o=this.parent.getLayerConfig();return(0,O.Z)((0,O.Z)({},o),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:Nk(this.parent.type),mask:o.mask||((t=o.maskLayers)===null||t===void 0?void 0:t.length)!==0&&o.enableMask})}},{key:"getMaskLayer",value:function(){var t=this,o=this.parent.getLayerConfig(),u=o.maskLayers,l=[];return u==null||u.forEach(function(p){if(!p.tileLayer)return l.push(p),p;var v=p.tileLayer,x=v.getTile(t.sourceTile.key),S=x==null?void 0:x.getLayers()[0];S&&l.push(S)}),l}},{key:"addTileMask",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p;return he().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return u=new _m({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").style({opacity:.5}),l=lv(this.parent.sceneContainer),u.setContainer(l,this.parent.sceneContainer),x.next=5,u.init();case 5:return this.tileMask=u,p=this.getMainLayer(),p!==void 0&&(p.tileMask=u),x.abrupt("return",u);case 9:case"end":return x.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addMask",value:function(){var n=(0,It.Z)(he().mark(function o(u,l){var p;return he().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return p=lv(this.parent.sceneContainer),l.setContainer(p,this.parent.sceneContainer),x.next=4,l.init();case 4:u.addMask(l),this.tileMaskLayers.push(l);case 6:case"end":return x.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"addLayer",value:function(){var n=(0,It.Z)(he().mark(function o(u){var l;return he().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u.isTileLayer=!0,l=lv(this.parent.sceneContainer),u.setContainer(l,this.parent.sceneContainer),this.layers.push(u),v.next=6,u.init();case 6:case"end":return v.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"updateVisible",value:function(t){this.visible=t,this.updateOptions("visible",t)}},{key:"updateOptions",value:function(t,o){this.layers.forEach(function(u){u.updateLayerConfig((0,V.Z)({},t,o))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(t){return[]}},{key:"getFeatureById",value:function(t){return[]}},{key:"destroy",value:function(){var t;(t=this.tileMask)===null||t===void 0||t.destroy(),this.layers.forEach(function(o){return o.destroy()})}}]),r}(ya.EventEmitter);function Vk(e){var i=jk();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function jk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gk=function(e){(0,lt.Z)(r,e);var i=Vk(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.getSourceOption(),l=u.data.features[0].properties,p=new A0().source(u.data,u.options).size(1).shape("line").color("red"),v=new ym({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),S.next=6,this.addLayer(p);case 6:return S.next=8,this.addLayer(v);case 8:this.isLoaded=!0;case 9:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:o},options:{parser:{type:"geojson"},transforms:t.transforms}}}}]),r}(Ep);function Hk(e){var i=Wk();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function Wk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $k=function(e){(0,lt.Z)(r,e);var i=Hk(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new L_((0,O.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var k,D,R=A;v[R]((k=u[R])===null||k===void 0?void 0:k.field,(D=u[R])===null||D===void 0?void 0:D.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(Ep);function Xk(e){var i=Yk();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function Yk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qk=function(e){(0,lt.Z)(r,e);var i=Xk(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new r1((0,O.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var k,D,R=A;v[R]((k=u[R])===null||k===void 0?void 0:k.field,(D=u[R])===null||D===void 0?void 0:D.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getFeatures",value:function(t){if(!t)return[];var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=o.featureId,p=this.getFeatures(u);return{data:{type:"FeatureCollection",features:p},options:{parser:{type:"geojson",featureId:l},transforms:t.transforms}}}}]),r}(Ep),Kk=["rasterData"];function Jk(e){var i=Qk();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function Qk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eI=function(e){(0,lt.Z)(r,e);var i=Jk(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new xm((0,O.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var k,D,R=A;v[R]((k=u[R])===null||k===void 0?void 0:k.field,(D=u[R])===null||D===void 0?void 0:D.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,rs.Z)(o,Kk);return{data:u,options:{parser:(0,O.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:t.transforms}}}}]),r}(Ep);function tI(e){var i=rI();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function rI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nI=function(e){(0,lt.Z)(r,e);var i=tI(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v;return he().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new xm((0,O.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var k,D,R=A;v[R]((k=u[R])===null||k===void 0?void 0:k.field,(D=u[R])===null||D===void 0?void 0:D.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(Ep),iI=["rasterData"];function aI(e){var i=oI();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function oI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sI={positions:[0,1],colors:["#000","#fff"]},uI=function(e){(0,lt.Z)(r,e);var i=aI(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x,S,A;return he().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=this.getLayerOptions(),x=v.rampColors,S=v.domain,this.colorTexture=this.parent.textureService.getColorTexture(x,S),A=new xm((0,O.Z)((0,O.Z)({},l),{},{colorTexture:this.colorTexture})).source(p.data,p.options),u&&Object.keys(u).forEach(function(R){var N,W,me=R;A[me]((N=u[me])===null||N===void 0?void 0:N.field,(W=u[me])===null||W===void 0?void 0:W.values)}),D.next=9,this.addLayer(A);case 9:this.isLoaded=!0;case 10:case"end":return D.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,rs.Z)(o,iI);return{data:u,options:{parser:(0,O.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:t.transforms}}}},{key:"styleUpdate",value:function(){for(var t=this,o=arguments.length,u=new Array(o),l=0;l<o;l++)u[l]=arguments[l];var p=u,v=p.rampColors,x=v===void 0?sI:v,S=p.domain;this.colorTexture=this.parent.textureService.getColorTexture(x,S||Xo(x)),this.layers.forEach(function(A){return A.style({colorTexture:t.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(t){return t.destroy()})}}]),r}(Ep);function lI(e){var i=cI();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function cI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bm=function(e){(0,lt.Z)(r,e);var i=lI(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,It.Z)(he().mark(function o(){var u,l,p,v,x;return he().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=zk(this.parent.type),v=this.getSourceOption(),v){A.next=8;break}return this.isLoaded=!0,this.emit("loaded"),A.abrupt("return");case 8:return x=new p((0,O.Z)({},l)).source(v.data,v.options),Object.keys(u).forEach(function(k){var D,R,N=k;x[N]((D=u[N])===null||D===void 0?void 0:D.field,(R=u[N])===null||R===void 0?void 0:R.values)}),A.next=12,this.addLayer(x);case 12:if(!l.tileMask){A.next=15;break}return A.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(x),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return A.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=u===void 0?"defaultLayer":u,p=o.featureId,v=p===void 0?"id":p,x=this.getFeatures(l);return{data:{type:"FeatureCollection",features:x},options:{parser:{type:"geojson",featureId:v},transforms:t.transforms}}}},{key:"setLayerMinMaxZoom",value:function(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(t){var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getFeatureById",value:function(t){var o=this.getMainLayer();if(!o)return[];var u=o.getSource().data.dataArray.filter(function(l){return l._id===t});return u}}]),r}(Ep);function fI(e){var i=e.type;switch(i){case"PolygonLayer":return Bm;case"LineLayer":return Bm;case"PointLayer":return Bm;case"TileDebugLayer":return Gk;case"MaskLayer":return qk;case"RasterLayer":var r=e.getSource().parser.dataType;switch(r){case iu.RGB:case iu.CUSTOMRGB:return eI;case iu.ARRAYBUFFER:case iu.CUSTOMARRAYBUFFER:return uI;case iu.TERRAINRGB:case iu.CUSTOMTERRAINRGB:return nI;default:return $k}default:return Bm}}var hI=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"],pI=ii.debounce,Rx=function(){function e(i){var r=this;(0,be.Z)(this,e),(0,V.Z)(this,"initedTileset",!1),(0,V.Z)(this,"mapchange",function(){var t;if(r.parent.isVisible()!==!1){var o=r.getCurrentView(),u=o.latLonBounds,l=o.zoom;if(r.mapService.version==="GAODE1.x"){var p=r.parent.getLayerConfig(),v=p.visible;l<2&&v?(r.parent.updateLayerConfig({visible:!1}),r.layerService.reRender()):l>=2&&!v&&(r.parent.updateLayerConfig({visible:!0}),r.layerService.reRender())}r.lastViewStates&&r.lastViewStates.zoom===l&&r.lastViewStates.latLonBounds.toString()===u.toString()||(r.lastViewStates={zoom:l,latLonBounds:u},(t=r.tilesetManager)===null||t===void 0||t.throttleUpdate(l,u))}}),(0,V.Z)(this,"viewchange",pI(this.mapchange,24)),this.parent=i;var n=this.parent.getContainer();this.rendererService=n.get(et.IRendererService),this.layerService=n.get(et.ILayerService),this.mapService=n.get(et.IMapService),this.pickingService=n.get(et.IPickingService),this.tileLayerService=new Lk({rendererService:this.rendererService,layerService:this.layerService,parent:i}),this.tilePickService=new Bk({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:i}),this.parent.setLayerPickService(this.tilePickService),this.proxy(i),this.initTileSetManager()}return(0,J.Z)(e,[{key:"initTileSetManager",value:function(){var r,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var t=this.getCurrentView(),o=t.latLonBounds,u=t.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(u,o)}}},{key:"getCurrentView",value:function(){var r=this.mapService.getBounds(),n=[r[0][0],r[0][1],r[1][0],r[1][1]],t=this.mapService.getZoom();return{latLonBounds:n,zoom:t}}},{key:"bindTilesetEvent",value:function(){var r=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){r.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,t){r.tileError(n)}),this.tilesetManager.on("tile-update",function(){r.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(r){return this.tileLayerService.getTile(r)}},{key:"tileLoaded",value:function(r){}},{key:"tileError",value:function(r){console.warn("error:",r)}},{key:"destroy",value:function(){var r;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(r=this.tilesetManager)===null||r===void 0||r.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var r;this.tilesetManager.clear();var n=this.getCurrentView(),t=n.latLonBounds,o=n.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(o,t)}},{key:"tileUnLoad",value:function(r){this.tileLayerService.removeTile(r.key)}},{key:"tileUpdate",value:function(){var i=(0,It.Z)(he().mark(function n(){var t=this,o,u;return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.tilesetManager){p.next=2;break}return p.abrupt("return");case 2:return o=this.parent.getMinZoom(),u=this.parent.getMaxZoom(),p.next=6,Promise.all(this.tilesetManager.tiles.filter(function(v){return v.isLoaded}).filter(function(v){return v.isVisibleChange}).filter(function(v){return v.data}).filter(function(v){return v.z>=o&&v.z<u}).map(function(){var v=(0,It.Z)(he().mark(function x(S){var A,k;return he().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(t.tileLayerService.hasTile(S.key)){R.next=9;break}return A=fI(t.parent),k=new A(S,t.parent),R.next=5,k.initTileLayer();case 5:t.tilePickService.setPickState(),k.getLayers().length!==0&&(t.tileLayerService.addTile(k),t.tileLayerService.updateTileVisible(S),t.layerService.reRender()),R.next=12;break;case 9:t.tileLayerService.updateTileVisible(S),t.tilePickService.setPickState(),t.layerService.reRender();case 12:case"end":return R.stop()}},x)}));return function(x){return v.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return p.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"setPickState",value:function(r){}},{key:"pickRender",value:function(r){this.tilePickService.pickRender(r)}},{key:"selectFeature",value:function(r){this.tilePickService.selectFeature(r)}},{key:"highlightPickedFeature",value:function(r){this.tilePickService.highlightPickedFeature(r)}},{key:"proxy",value:function(r){var n=this;hI.forEach(function(t){var o=r[t].bind(r);r[t]=function(){for(var u=arguments.length,l=new Array(u),p=0;p<u;p++)l[p]=arguments[p];return o.apply(void 0,l),n.getLayers().map(function(v){v[t].apply(v,l)}),t==="style"&&n.getTiles().forEach(function(v){return v.styleUpdate.apply(v,l)}),r}})}}]),e}(),Dx,Ox,dI=(Dx=(0,ut.b2)(),Dx(Ox=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"build",value:function(){var i=(0,It.Z)(he().mark(function n(t){return he().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return t.prepareBuildModel(),u.next=3,t.buildModels();case 3:case"end":return u.stop()}},n)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"initLayerModel",value:function(){var i=(0,It.Z)(he().mark(function n(t){return he().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"prepareLayerModel",value:function(){var i=(0,It.Z)(he().mark(function n(t){return he().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"apply",value:function(r){var n=this;r.hooks.init.tapPromise("LayerModelPlugin",(0,It.Z)(he().mark(function t(){return he().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!r.getSource().isTile){u.next=4;break}return r.prepareBuildModel(),r.tileLayer=new Rx(r),u.abrupt("return");case 4:return r.log(ns.BuildModelStart,yr.INIT),u.next=7,n.initLayerModel(r);case 7:r.log(ns.BuildModelEnd,yr.INIT);case 8:case"end":return u.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var t=(0,It.Z)(he().mark(function o(u){return he().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(u){p.next=2;break}return p.abrupt("return",!1);case 2:if(!r.getSource().isTile){p.next=5;break}return r.tileLayer=new Rx(r),p.abrupt("return",!1);case 5:return r.log(ns.BuildModelStart,yr.UPDATE),p.next=8,n.prepareLayerModel(r);case 8:return r.log(ns.BuildModelEnd,yr.UPDATE),p.abrupt("return",!0);case 10:case"end":return p.stop()}},o)}));return function(o){return t.apply(this,arguments)}}())}}]),e}())||Ox),Fx,Bx,vI=(Fx=(0,ut.b2)(),Fx(Bx=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){var n=r.getLayerConfig(),t=n.autoFit,o=n.fitBoundsOptions;t&&r.fitBounds(o),r.styleNeedUpdate=!1})}}]),e}())||Bx),zx,Nx,mI=["type"],Zx={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},gI={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},yI={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},_I={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function xI(e){var i={u_DirectionalLights:new Array(3).fill((0,O.Z)({},yI)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,O.Z)({},_I)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[gI]),e.forEach(function(r){var n=r.type,t=n===void 0?"directional":n,o=(0,rs.Z)(r,mI),u=Zx[t].lights,l=Zx[t].num,p=i[l];i[u][p]=(0,O.Z)((0,O.Z)({},i[u][p]),o),i[l]++}),i}var bI=(zx=(0,ut.b2)(),zx(Nx=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),t=n.enableLighting;t&&r.models.forEach(function(o){return o.addUniforms((0,O.Z)({},xI()))})})}}]),e}())||Nx),Ux,Vx,SI=(Ux=(0,ut.b2)(),Ux(Vx=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.rendererService,u=n.postProcessingPassFactory,l=n.normalPassFactory;r.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var p=r.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,S=x===void 0?[]:x;t.enabled=!!v&&r.getLayerConfig().enableMultiPassRenderer!==!1,t.enabled&&(r.multiPassRenderer=s_(r,S,u,l),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(t.enabled){var p=o.getViewportSize(),v=p.width,x=p.height;r.multiPassRenderer.resize(v,x)}})}}]),e}())||Vx),jx,Gx,zm={NONE:0,ENCODE:1,HIGHLIGHT:2},wI=(jx=(0,ut.b2)(),jx(Gx=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"apply",value:function(r,n){var t=n.styleAttributeService;r.hooks.init.tapPromise("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;t.registerStyleAttribute({name:"pickingColor",type:un.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:q.FLOAT},size:3,update:function(p){var v=p.id;return u?Ea(v):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(l){return l.addUniforms({u_PickingStage:zm.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(l){return l.addUniforms({u_PickingStage:zm.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),l=u.highlightColor,p=u.activeMix,v=p===void 0?0:p,x=typeof l=="string"?Hn(l):l||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:ra(new Uint8Array(o))}),r.models.forEach(function(S){return S.addUniforms({u_PickingStage:zm.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(A){return A*255}),u_activeMix:v})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),l=u.selectColor,p=u.selectMix,v=p===void 0?0:p,x=typeof l=="string"?Hn(l):l||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:ra(new Uint8Array(o))}),r.models.forEach(function(S){return S.addUniforms({u_PickingStage:zm.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(A){return A*255}),u_activeMix:v,u_CurrentSelectedId:o,u_SelectColor:x.map(function(A){return A*255}),u_EnableSelect:1})})})}}]),e}())||Gx),EI=["mvt","geojsonvt","testTile"];function AI(e){var i=e.getSource();return EI.includes(i.parser.type)}function M6(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var Hx,Wx,CI=(Hx=(0,ut.b2)(),Hx(Wx=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){AI(r)||t.registerBuiltinAttributes(o,r)})}},{key:"registerBuiltinAttributes",value:function(r,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(r);return}this.registerPositionAttribute(r),this.registerColorAttribute(r),this.registerVertexIdAttribute(r)}},{key:"registerPositionAttribute",value:function(r){r.registerStyleAttribute({name:"position",type:un.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:q.FLOAT},size:3,update:function(t,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}})}},{key:"registerFilterAttribute",value:function(r){r.registerStyleAttribute({name:"filter",type:un.Attribute,descriptor:{name:"filter",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(t){var o=t.filter;return o?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(r){r.registerStyleAttribute({name:"color",type:un.Attribute,descriptor:{name:"a_Color",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(t){var o=t.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(r){r.registerStyleAttribute({name:"vertexId",type:un.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(t,o){return[o]}}})}}]),e}())||Wx),$x,Xx,Yx,qx,Kx,Jx,md,Qx,eb,tb,rb,TI=($x=(0,ut.b2)(),Xx=(0,ut.f3)(et.ICameraService),Yx=(0,ut.f3)(et.ICoordinateSystemService),qx=(0,ut.f3)(et.IRendererService),Kx=(0,ut.f3)(et.IMapService),$x(Jx=(md=function(){function e(){(0,be.Z)(this,e),on(this,"cameraService",Qx,this),on(this,"coordinateSystemService",eb,this),on(this,"rendererService",tb,this),on(this,"mapService",rb,this)}return(0,J.Z)(e,[{key:"apply",value:function(r){var n=this,t=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var l=r.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(l),t==="GAODE2.x"&&(n.setLayerCenter(r),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter());var p=n.rendererService.getViewportSize(),v=p.width,x=p.height;r.models.forEach(function(S){var A;S.addUniforms((A={},(0,V.Z)(A,_p.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,V.Z)(A,_p.ViewMatrix,n.cameraService.getViewMatrix()),(0,V.Z)(A,_p.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,V.Z)(A,_p.Zoom,n.cameraService.getZoom()),(0,V.Z)(A,_p.ZoomScale,n.cameraService.getZoomScale()),(0,V.Z)(A,_p.FocalDistance,n.cameraService.getFocalDistance()),(0,V.Z)(A,_p.CameraPosition,n.cameraService.getCameraPosition()),(0,V.Z)(A,rc.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,V.Z)(A,rc.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,V.Z)(A,rc.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,V.Z)(A,rc.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,V.Z)(A,rc.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,V.Z)(A,rc.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,V.Z)(A,rc.Mvp,o),(0,V.Z)(A,"u_sceneCenterMercator",u),(0,V.Z)(A,"u_ViewportSize",[v,x]),(0,V.Z)(A,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,V.Z)(A,"u_DevicePixelRatio",window.devicePixelRatio),(0,V.Z)(A,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,V.Z)(A,"u_shaderPick",Number(r.getShaderPickStat())),A))})})}},{key:"setLayerCenter",value:function(r){r.coordCenter===void 0&&(r.coordCenter=r.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(r.coordCenter)}}]),e}(),Qx=Kr(md.prototype,"cameraService",[Xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eb=Kr(md.prototype,"coordinateSystemService",[Yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tb=Kr(md.prototype,"rendererService",[qx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rb=Kr(md.prototype,"mapService",[Kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),md))||Jx),nb,ib,MI=(nb=(0,ut.b2)(),nb(ib=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate().then(function(n){n&&r.renderLayers()})}),r.hooks.afterRender.tap("UpdateModelPlugin",function(){r.layerModelNeedUpdate=!1})}}]),e}())||ib),ab,ob,kI=(ab=(0,ut.b2)(),ab(ob=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){t.initStyleAttribute(r,{styleAttributeService:o})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||r.inited&&t.updateStyleAttribute(r,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[],u=t.getLayerStyleAttribute("filter");if(u&&u.needRegenerateVertices){r.layerModelNeedUpdate=!0,o.forEach(function(l){return l.needRegenerateVertices=!1});return}o.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){t.updateAttributeByFeatureRange(l.name,r.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,r),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){t.updateAttributeByFeatureRange(u.name,r.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||ob);ol.bind(et.ILayerPlugin).to(p5).inRequestScope(),ol.bind(et.ILayerPlugin).to(CI).inRequestScope(),ol.bind(et.ILayerPlugin).to(kk).inRequestScope(),ol.bind(et.ILayerPlugin).to(h5).inRequestScope(),ol.bind(et.ILayerPlugin).to(vI).inRequestScope(),ol.bind(et.ILayerPlugin).to(Pk).inRequestScope(),ol.bind(et.ILayerPlugin).to(kI).inRequestScope(),ol.bind(et.ILayerPlugin).to(MI).inRequestScope(),ol.bind(et.ILayerPlugin).to(SI).inRequestScope(),ol.bind(et.ILayerPlugin).to(TI).inRequestScope(),ol.bind(et.ILayerPlugin).to(Ik).inRequestScope(),ol.bind(et.ILayerPlugin).to(bI).inRequestScope(),ol.bind(et.ILayerPlugin).to(wI).inRequestScope(),ol.bind(et.ILayerPlugin).to(dI).inRequestScope();var II=z(81550),PI=z.n(II),LI=function(){function e(i,r){(0,be.Z)(this,e);var n=r.buffer,t=r.offset,o=r.stride,u=r.normalized,l=r.size,p=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:t||0,stride:o||0,normalized:u||!1,divisor:p||0},l&&(this.attribute.size=l)}return(0,J.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),eh,Tv,th,oc,Mv,Nh,kv,Nm,yf,Ap,ou,_f,xf,Zm,RI=(eh={},(0,V.Z)(eh,q.POINTS,"points"),(0,V.Z)(eh,q.LINES,"lines"),(0,V.Z)(eh,q.LINE_LOOP,"line loop"),(0,V.Z)(eh,q.LINE_STRIP,"line strip"),(0,V.Z)(eh,q.TRIANGLES,"triangles"),(0,V.Z)(eh,q.TRIANGLE_FAN,"triangle fan"),(0,V.Z)(eh,q.TRIANGLE_STRIP,"triangle strip"),eh),sb=(Tv={},(0,V.Z)(Tv,q.STATIC_DRAW,"static"),(0,V.Z)(Tv,q.DYNAMIC_DRAW,"dynamic"),(0,V.Z)(Tv,q.STREAM_DRAW,"stream"),Tv),X0=(th={},(0,V.Z)(th,q.BYTE,"int8"),(0,V.Z)(th,q.UNSIGNED_INT,"int16"),(0,V.Z)(th,q.INT,"int32"),(0,V.Z)(th,q.UNSIGNED_BYTE,"uint8"),(0,V.Z)(th,q.UNSIGNED_SHORT,"uint16"),(0,V.Z)(th,q.UNSIGNED_INT,"uint32"),(0,V.Z)(th,q.FLOAT,"float"),th),DI=(oc={},(0,V.Z)(oc,q.ALPHA,"alpha"),(0,V.Z)(oc,q.LUMINANCE,"luminance"),(0,V.Z)(oc,q.LUMINANCE_ALPHA,"luminance alpha"),(0,V.Z)(oc,q.RGB,"rgb"),(0,V.Z)(oc,q.RGBA,"rgba"),(0,V.Z)(oc,q.RGBA4,"rgba4"),(0,V.Z)(oc,q.RGB5_A1,"rgb5 a1"),(0,V.Z)(oc,q.RGB565,"rgb565"),(0,V.Z)(oc,q.DEPTH_COMPONENT,"depth"),(0,V.Z)(oc,q.DEPTH_STENCIL,"depth stencil"),oc),OI=(Mv={},(0,V.Z)(Mv,q.DONT_CARE,"dont care"),(0,V.Z)(Mv,q.NICEST,"nice"),(0,V.Z)(Mv,q.FASTEST,"fast"),Mv),ub=(Nh={},(0,V.Z)(Nh,q.NEAREST,"nearest"),(0,V.Z)(Nh,q.LINEAR,"linear"),(0,V.Z)(Nh,q.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,V.Z)(Nh,q.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,V.Z)(Nh,q.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,V.Z)(Nh,q.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Nh),lb=(kv={},(0,V.Z)(kv,q.REPEAT,"repeat"),(0,V.Z)(kv,q.CLAMP_TO_EDGE,"clamp"),(0,V.Z)(kv,q.MIRRORED_REPEAT,"mirror"),kv),FI=(Nm={},(0,V.Z)(Nm,q.NONE,"none"),(0,V.Z)(Nm,q.BROWSER_DEFAULT_WEBGL,"browser"),Nm),BI=(yf={},(0,V.Z)(yf,q.NEVER,"never"),(0,V.Z)(yf,q.ALWAYS,"always"),(0,V.Z)(yf,q.LESS,"less"),(0,V.Z)(yf,q.LEQUAL,"lequal"),(0,V.Z)(yf,q.GREATER,"greater"),(0,V.Z)(yf,q.GEQUAL,"gequal"),(0,V.Z)(yf,q.EQUAL,"equal"),(0,V.Z)(yf,q.NOTEQUAL,"notequal"),yf),cb=(Ap={},(0,V.Z)(Ap,q.FUNC_ADD,"add"),(0,V.Z)(Ap,q.MIN_EXT,"min"),(0,V.Z)(Ap,q.MAX_EXT,"max"),(0,V.Z)(Ap,q.FUNC_SUBTRACT,"subtract"),(0,V.Z)(Ap,q.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ap),Um=(ou={},(0,V.Z)(ou,q.ZERO,"zero"),(0,V.Z)(ou,q.ONE,"one"),(0,V.Z)(ou,q.SRC_COLOR,"src color"),(0,V.Z)(ou,q.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,V.Z)(ou,q.SRC_ALPHA,"src alpha"),(0,V.Z)(ou,q.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,V.Z)(ou,q.DST_COLOR,"dst color"),(0,V.Z)(ou,q.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,V.Z)(ou,q.DST_ALPHA,"dst alpha"),(0,V.Z)(ou,q.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,V.Z)(ou,q.CONSTANT_COLOR,"constant color"),(0,V.Z)(ou,q.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,V.Z)(ou,q.CONSTANT_ALPHA,"constant alpha"),(0,V.Z)(ou,q.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,V.Z)(ou,q.SRC_ALPHA_SATURATE,"src alpha saturate"),ou),zI=(_f={},(0,V.Z)(_f,q.NEVER,"never"),(0,V.Z)(_f,q.ALWAYS,"always"),(0,V.Z)(_f,q.LESS,"less"),(0,V.Z)(_f,q.LEQUAL,"lequal"),(0,V.Z)(_f,q.GREATER,"greater"),(0,V.Z)(_f,q.GEQUAL,"gequal"),(0,V.Z)(_f,q.EQUAL,"equal"),(0,V.Z)(_f,q.NOTEQUAL,"notequal"),_f),gd=(xf={},(0,V.Z)(xf,q.ZERO,"zero"),(0,V.Z)(xf,q.KEEP,"keep"),(0,V.Z)(xf,q.REPLACE,"replace"),(0,V.Z)(xf,q.INVERT,"invert"),(0,V.Z)(xf,q.INCR,"increment"),(0,V.Z)(xf,q.DECR,"decrement"),(0,V.Z)(xf,q.INCR_WRAP,"increment wrap"),(0,V.Z)(xf,q.DECR_WRAP,"decrement wrap"),xf),NI=(Zm={},(0,V.Z)(Zm,q.FRONT,"front"),(0,V.Z)(Zm,q.BACK,"back"),Zm),ZI=function(){function e(i,r){(0,be.Z)(this,e),(0,V.Z)(this,"isDestroyed",!1);var n=r.data,t=r.usage,o=r.type;this.buffer=i.buffer({data:n,usage:sb[t||q.STATIC_DRAW],type:X0[o||q.UNSIGNED_BYTE]})}return(0,J.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(r){var n=r.data,t=r.offset;this.buffer.subdata(n,t)}}]),e}(),UI=function(){function e(i,r){(0,be.Z)(this,e);var n=r.data,t=r.usage,o=r.type,u=r.count;this.elements=i.elements({data:n,usage:sb[t||q.STATIC_DRAW],type:X0[o||q.UNSIGNED_BYTE],count:u})}return(0,J.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),VI=function(){function e(i,r){(0,be.Z)(this,e);var n=r.width,t=r.height,o=r.color,u=r.colors,l={width:n,height:t};Array.isArray(u)&&(l.colors=u.map(function(p){return p.get()})),o&&typeof o!="boolean"&&(l.color=o.get()),this.framebuffer=i.framebuffer(l)}return(0,J.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.framebuffer.resize(n,t)}}]),e}(),jI=ii.isPlainObject,GI=ii.isTypedArray,HI=function(){function e(i,r){(0,be.Z)(this,e),(0,V.Z)(this,"destroyed",!1),(0,V.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,t=r.fs,o=r.attributes,u=r.uniforms,l=r.primitive,p=r.count,v=r.elements,x=r.depth,S=r.cull,A=r.instances,k={};this.options=r,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(function(N){k[N]=i.prop(N)}));var D={};Object.keys(o).forEach(function(N){D[N]=o[N].get()});var R={attributes:D,frag:t,uniforms:k,vert:n,colorMask:i.prop("colorMask"),lineWidth:1,blend:{enable:i.prop("blend.enable"),func:i.prop("blend.func"),equation:i.prop("blend.equation"),color:i.prop("blend.color")},stencil:{enable:i.prop("stencil.enable"),mask:i.prop("stencil.mask"),func:i.prop("stencil.func"),opFront:i.prop("stencil.opFront"),opBack:i.prop("stencil.opBack")},primitive:RI[l===void 0?q.TRIANGLES:l]};A&&(R.instances=A),p?R.count=p:v&&(R.elements=v.get()),this.initDepthDrawParams({depth:x},R),this.initCullDrawParams({cull:S},R),this.drawCommand=i(R),this.drawParams=R}return(0,J.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var t={};Object.keys(r).forEach(function(o){t[o]=r[o].get()}),this.drawParams.attributes=t,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(t){n[t]=r[t].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(r){this.uniforms=(0,O.Z)((0,O.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var t=(0,O.Z)((0,O.Z)({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(t).forEach(function(u){var l=(0,Rf.Z)(t[u]);l==="boolean"||l==="number"||Array.isArray(t[u])||t[u].BYTES_PER_ELEMENT?o[u]=t[u]:o[u]=t[u].get()}),o.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(r),o.stencil=this.getStencilDrawParams(r),o.colorMask=this.getColorMaskDrawParams(r,n),this.drawCommand(o)}}},{key:"destroy",value:function(){var r,n;(r=this.drawParams)===null||r===void 0||(n=r.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t==null||t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var t=r.depth;t&&(n.depth={enable:t.enable===void 0?!0:!!t.enable,mask:t.mask===void 0?!0:!!t.mask,func:BI[t.func||q.LESS],range:t.range||[0,1]})}},{key:"getBlendDrawParams",value:function(r){var n=r.blend,t=n||{},o=t.enable,u=t.func,l=t.equation,p=t.color,v=p===void 0?[0,0,0,0]:p;return{enable:!!o,func:{srcRGB:Um[u&&u.srcRGB||q.SRC_ALPHA],srcAlpha:Um[u&&u.srcAlpha||q.SRC_ALPHA],dstRGB:Um[u&&u.dstRGB||q.ONE_MINUS_SRC_ALPHA],dstAlpha:Um[u&&u.dstAlpha||q.ONE_MINUS_SRC_ALPHA]},equation:{rgb:cb[l&&l.rgb||q.FUNC_ADD],alpha:cb[l&&l.alpha||q.FUNC_ADD]},color:v}}},{key:"getStencilDrawParams",value:function(r){var n=r.stencil,t=n||{},o=t.enable,u=t.mask,l=u===void 0?-1:u,p=t.func,v=p===void 0?{cmp:q.ALWAYS,ref:0,mask:-1}:p,x=t.opFront,S=x===void 0?{fail:q.KEEP,zfail:q.KEEP,zpass:q.KEEP}:x,A=t.opBack,k=A===void 0?{fail:q.KEEP,zfail:q.KEEP,zpass:q.KEEP}:A;return{enable:!!o,mask:l,func:(0,O.Z)((0,O.Z)({},v),{},{cmp:zI[v.cmp]}),opFront:{fail:gd[S.fail],zfail:gd[S.zfail],zpass:gd[S.zpass]},opBack:{fail:gd[k.fail],zfail:gd[k.zfail],zpass:gd[k.zpass]}}}},{key:"getColorMaskDrawParams",value:function(r,n){var t=r.stencil,o=t!=null&&t.enable&&t.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return o}},{key:"initCullDrawParams",value:function(r,n){var t=r.cull;if(t){var o=t.enable,u=t.face,l=u===void 0?q.BACK:u;n.cull={enable:!!o,face:NI[l]}}}},{key:"extractUniforms",value:function(r){var n=this,t={};return Object.keys(r).forEach(function(o){n.extractUniformsRecursively(o,r[o],t,"")}),t}},{key:"extractUniformsRecursively",value:function(r,n,t,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||GI(n)||n===""||"resize"in n){t["".concat(o&&o+".").concat(r)]=n;return}jI(n)&&Object.keys(n).forEach(function(l){u.extractUniformsRecursively(l,n[l],t,"".concat(o&&o+".").concat(r))}),Array.isArray(n)&&n.forEach(function(l,p){Object.keys(l).forEach(function(v){u.extractUniformsRecursively(v,l[v],t,"".concat(o&&o+".").concat(r,"[").concat(p,"]"))})})}}]),e}(),WI=function(){function e(i,r){(0,be.Z)(this,e),(0,V.Z)(this,"isDestroy",!1);var n=r.data,t=r.type,o=t===void 0?q.UNSIGNED_BYTE:t,u=r.width,l=r.height,p=r.flipY,v=p===void 0?!1:p,x=r.format,S=x===void 0?q.RGBA:x,A=r.mipmap,k=A===void 0?!1:A,D=r.wrapS,R=D===void 0?q.CLAMP_TO_EDGE:D,N=r.wrapT,W=N===void 0?q.CLAMP_TO_EDGE:N,me=r.aniso,ye=me===void 0?0:me,Ne=r.alignment,Ue=Ne===void 0?1:Ne,tt=r.premultiplyAlpha,Et=tt===void 0?!1:tt,Vt=r.mag,Yt=Vt===void 0?q.NEAREST:Vt,gr=r.min,hr=gr===void 0?q.NEAREST:gr,Hr=r.colorSpace,fn=Hr===void 0?q.BROWSER_DEFAULT_WEBGL:Hr,Rn=r.x,Zi=Rn===void 0?0:Rn,Ia=r.y,Za=Ia===void 0?0:Ia,io=r.copy,Wo=io===void 0?!1:io;this.width=u,this.height=l;var nh={width:u,height:l,type:X0[o],format:DI[S],wrapS:lb[R],wrapT:lb[W],mag:ub[Yt],min:ub[hr],alignment:Ue,flipY:v,colorSpace:FI[fn],premultiplyAlpha:Et,aniso:ye,x:Zi,y:Za,copy:Wo};n&&(nh.data=n),typeof k=="number"?nh.mipmap=OI[k]:typeof k=="boolean"&&(nh.mipmap=k),this.texture=i.texture(nh)}return(0,J.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.texture.resize(n,t),this.width=n,this.height=t}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDestroy=!0}}]),e}(),fb,hb,$I=(fb=(0,ut.b2)(),fb(hb=function(){function e(){var i=this;(0,be.Z)(this,e),(0,V.Z)(this,"createModel",function(r){return new HI(i.gl,r)}),(0,V.Z)(this,"createAttribute",function(r){return new LI(i.gl,r)}),(0,V.Z)(this,"createBuffer",function(r){return new ZI(i.gl,r)}),(0,V.Z)(this,"createElements",function(r){return new UI(i.gl,r)}),(0,V.Z)(this,"createTexture2D",function(r){return new WI(i.gl,r)}),(0,V.Z)(this,"createFramebuffer",function(r){return new VI(i.gl,r)}),(0,V.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,V.Z)(this,"clear",function(r){var n,t=r.color,o=r.depth,u=r.stencil,l=r.framebuffer,p=l===void 0?null:l,v={color:t,depth:o,stencil:u};v.framebuffer=p===null?p:p.get(),(n=i.gl)===null||n===void 0||n.clear(v)}),(0,V.Z)(this,"viewport",function(r){var n=r.x,t=r.y,o=r.width,u=r.height;i.gl._gl.viewport(n,t,o,u),i.width=o,i.height=u,i.gl._refresh()}),(0,V.Z)(this,"readPixels",function(r){var n=r.framebuffer,t=r.x,o=r.y,u=r.width,l=r.height,p={x:t,y:o,width:u,height:l};return n&&(p.framebuffer=n.get()),i.gl.read(p)}),(0,V.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,V.Z)(this,"getContainer",function(){var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,V.Z)(this,"getCanvas",function(){return i.canvas}),(0,V.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,V.Z)(this,"destroy",function(){var r,n,t;i.canvas=null,(r=i.gl)===null||r===void 0||(n=r._gl)===null||n===void 0||(t=n.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),i.gl.destroy(),i.gl=null})}return(0,J.Z)(e,[{key:"init",value:function(){var i=(0,It.Z)(he().mark(function n(t,o,u){var l=this;return he().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.canvas=t,!u){v.next=5;break}this.gl=u,v.next=8;break;case 5:return v.next=7,new Promise(function(x,S){PI()({canvas:l.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(k,D){(k||!D)&&S(k),x(D)}})});case 7:this.gl=v.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return v.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||hb);function XI(e){var i=YI();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function YI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y0=["selectstart","selecting","selectend"],qI=function(e){(0,lt.Z)(r,e);var i=XI(r);function r(n){var t,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,be.Z)(this,r),t=i.call(this),(0,V.Z)((0,Ee.Z)(t),"isEnable",!1),(0,V.Z)((0,Ee.Z)(t),"onDragStart",function(u){t.box.style.display="block",t.startEvent=t.endEvent=u,t.syncBoxBound(),t.emit("selectstart",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,V.Z)((0,Ee.Z)(t),"onDragging",function(u){t.endEvent=u,t.syncBoxBound(),t.emit("selecting",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,V.Z)((0,Ee.Z)(t),"onDragEnd",function(u){t.endEvent=u,t.box.style.display="none",t.emit("selectend",t.getLngLatBox(),t.startEvent,t.endEvent)}),t.scene=n,t.options=o,t}return(0,J.Z)(r,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var t=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var o=kn("div",void 0,this.container);o.classList.add("l7-select-box"),t&&o.classList.add(t),o.style.display="none",this.box=o}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var t=this.startEvent,o=t.x,u=t.y,l=this.endEvent,p=l.x,v=l.y,x=Math.min(o,p),S=Math.min(u,v),A=Math.abs(o-p),k=Math.abs(u-v);this.box.style.top="".concat(S,"px"),this.box.style.left="".concat(x,"px"),this.box.style.width="".concat(A,"px"),this.box.style.height="".concat(k,"px")}},{key:"getLngLatBox",value:function(){var t=this.startEvent.lngLat,o=t.lng,u=t.lat,l=this.endEvent.lngLat,p=l.lng,v=l.lat;return jh([[o,u],[p,v]])}}]),r}(ya.EventEmitter),KI=function(){function e(i){(0,be.Z)(this,e);var r=i.id,n=i.map,t=i.canvas,o=i.hasBaseMap,u=nw();this.container=u,n.setContainer(u,r,t,o),u.bind(et.IRendererService).to($I).inSingletonScope(),this.sceneService=u.get(et.ISceneService),this.mapService=u.get(et.IMapService),this.iconService=u.get(et.IIconService),this.fontService=u.get(et.IFontService),this.controlService=u.get(et.IControlService),this.layerService=u.get(et.ILayerService),this.debugService=u.get(et.IDebugService),this.debugService.setEnable(i.debug),this.markerService=u.get(et.IMarkerService),this.interactionService=u.get(et.IInteractionService),this.popupService=u.get(et.IPopupService),this.boxSelect=new qI(this,{}),this.initComponent(r),this.sceneService.init(i),this.initControl()}return(0,J.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var i=(0,It.Z)(he().mark(function n(t){return he().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"exportMap",value:function(){var i=(0,It.Z)(he().mark(function n(t){return he().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var t=new r(this);t.init()}else this.on("loaded",function(){var o=new r(n);o.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=this,t=lv(this.container);if(r.setContainer(t,this.container),this.sceneService.addLayer(r),r.inited){var o=this.initMask(r);this.addMask(o,r.id)}else r.on("inited",function(){var u=n.initMask(r);n.addMask(u,r.id)})}},{key:"initMask",value:function(r){var n=r.getLayerConfig(),t=n.mask,o=n.maskfence,u=n.maskColor,l=u===void 0?"#000":u,p=n.maskOpacity,v=p===void 0?0:p;if(!(!t||!o)){var x=new r1().source(o).shape("fill").style({color:l,opacity:v});return x}}},{key:"addMask",value:function(r,n){if(!!r){var t=this.getLayer(n);if(t){var o=lv(this.container);r.setContainer(o,this.container),t.addMaskLayer(r),this.sceneService.addMask(r)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(){var i=(0,It.Z)(he().mark(function n(t,o){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(t,o);case 2:case"end":return l.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"removeAllLayer",value:function(){var i=(0,It.Z)(he().mark(function n(){return he().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.layerService.removeAllLayers();case 2:case"end":return o.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(t){var o=(0,K.Z)(t,2),u=o[0],l=o[1];n.fontService.addIconFont(u,l)})}},{key:"addFontFace",value:function(r,n){var t=this;this.fontService.once("fontloaded",function(o){t.emit("fontloaded",o)}),this.fontService.addFontFace(r,n)}},{key:"addImage",value:function(){var i=(0,It.Z)(he().mark(function n(t,o){return he().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(t,o);case 2:case"end":return l.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"removePopup",value:function(r){this.popupService.removePopup(r)}},{key:"on",value:function(r,n){if(Y0.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.on(r,n)}else lm.includes(r)?this.sceneService.on(r,n):this.mapService.on(r,n)}},{key:"once",value:function(r,n){if(Y0.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.once(r,n)}else lm.includes(r)?this.sceneService.once(r,n):this.mapService.once(r,n)}},{key:"emit",value:function(r,n){lm.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.emit(r,n)}},{key:"off",value:function(r,n){if(Y0.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.off(r,n)}else lm.includes(r)?this.sceneService.off(r,n):this.mapService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var t=this.sceneService.getSceneConfig(),o=t.fitBoundsOptions,u=t.animate;this.mapService.fitBounds(r,n||(0,O.Z)((0,O.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(et.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){r.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(r){return Gr.REGISTERED_PROTOCOLS[r]}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Eu(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,t=r.logoPosition;n&&this.addControl(new n_({position:t}))}}],[{key:"addProtocol",value:function(r,n){Gr.REGISTERED_PROTOCOLS[r]=n}},{key:"removeProtocol",value:function(r){delete Gr.REGISTERED_PROTOCOLS[r]}}]),e}(),k6="2.17.11";function Iv(e){return Iv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Iv(e)}function pb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function I6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?pb(Object(r),!0).forEach(function(n){JI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JI(e,i,r){return i=QI(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function QI(e){var i=eP(e,"string");return Iv(i)==="symbol"?i:String(i)}function eP(e,i){if(Iv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Iv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function P6(e,i){return iP(e)||nP(e,i)||rP(e,i)||tP()}function tP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rP(e,i){if(!!e){if(typeof e=="string")return db(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return db(e,i)}}function db(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function nP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function iP(e){if(Array.isArray(e))return e}var L6=null,R6=null,vb,q0,mb,aP=(vb=u0(et.IGlobalConfigService),q0=function(){function e(i){(0,be.Z)(this,e),on(this,"configService",mb,this),this.config=i}return(0,J.Z)(e,[{key:"setContainer",value:function(r,n,t,o){r.bind(et.MapConfig).toConstantValue((0,O.Z)((0,O.Z)({},this.config),{},{id:n,canvas:t,hasBaseMap:o})),r.bind(et.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),mb=Kr(q0.prototype,"configService",[vb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q0),oP=z(6158),Pv=z.n(oP),sP=function(){function e(i){(0,be.Z)(this,e),(0,V.Z)(this,"size",1e4),this.size=i||1e4}return(0,J.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),t=this.mercatorYfromLat(r[1]);return[n,t]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),t=this.latFromMercatorY(r[1]);return[n,t]}}]),e}(),uP={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},gb,yb,_b,xb,bb,Sb,yd,wb,Eb,Ab,Cb,Tb={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},lP=12,cP=(gb=(0,ut.b2)(),yb=(0,ut.f3)(et.MapConfig),_b=(0,ut.f3)(et.IGlobalConfigService),xb=(0,ut.f3)(et.ICoordinateSystemService),bb=(0,ut.f3)(et.IEventEmitter),gb(Sb=(yd=function(){function e(){var i=this;(0,be.Z)(this,e),(0,V.Z)(this,"version",nc.DEFUALT),(0,V.Z)(this,"simpleMapCoord",new sP),(0,V.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),on(this,"config",wb,this),on(this,"configService",Eb,this),on(this,"coordinateSystemService",Ab,this),on(this,"eventEmitter",Cb,this),(0,V.Z)(this,"handleCameraChanged",function(r){var n=i.map.getCenter(),t=n.lat,o=n.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,t],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0}),i.updateCoordinateSystemService(),i.cameraChangedCallback(i.viewport)})}return(0,J.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=kn("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(r,n){vw.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(Tb[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(Tb[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===nc.SIMPLE)return this.simpleMapCoord.getSize();var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.dragEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyleValue(r))}},{key:"meterToCoord",value:function(r,n){return 1}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"getMapStyle",value:function(){try{var r,n=(r=this.map.getStyle().sprite)!==null&&r!==void 0?r:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(t){return""}}},{key:"getMapStyleConfig",value:function(){return uP}},{key:"getMapStyleValue",value:function(r){var n;return(n=this.getMapStyleConfig()[r])!==null&&n!==void 0?n:r}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[r].concat(o))}},{key:"once",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[r].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),t=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return t}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatMapContainer",value:function(r){var n=r;return typeof r=="string"&&(n=document.getElementById(r)),n}},{key:"updateView",value:function(r){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:r.bearing,center:r.center,viewportHeight:r.viewportHeight,pitch:r.pitch,viewportWidth:r.viewportWidth,zoom:r.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var r=this.config.offsetCoordinate,n=r===void 0?!0:r;this.viewport.getZoom()>lP&&n?this.coordinateSystemService.setCoordinateSystem(Tl.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Tl.LNGLAT)}}]),e}(),wb=Kr(yd.prototype,"config",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eb=Kr(yd.prototype,"configService",[_b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ab=Kr(yd.prototype,"coordinateSystemService",[xb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cb=Kr(yd.prototype,"eventEmitter",[bb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd))||Sb);function Lv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Vm(e,i){var r=il([],i,e);return zo(r,r,1/r[3]),r}function D6(e,i){var r=e%i;return r<0?i+r:r}function O6(e,i,r){return r*i+(1-r)*e}function Cp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var Zc=Math.PI,Mb=Zc/4,rh=Zc/180,kb=180/Zc,K0=512,J0=4003e4,fP=1.5;function Ib(e){return Math.pow(2,e)}function hP(e){return Math.log2(e)}function jm(e,i){var r=(0,K.Z)(e,2),n=r[0],t=r[1];Cp(Number.isFinite(n)&&Number.isFinite(i)),Cp(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude"),i*=K0;var o=n*rh,u=t*rh,l=i*(o+Zc)/(2*Zc),p=i*(Zc-Math.log(Math.tan(Mb+u*.5)))/(2*Zc);return[l,p]}function Q0(e,i){var r=(0,K.Z)(e,2),n=r[0],t=r[1];i*=K0;var o=n/i*(2*Zc)-Zc,u=2*(Math.atan(Math.exp(Zc-t/i*(2*Zc)))-Mb);return[o*kb,u*kb]}function F6(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*rh);return hP(J0*r)-9}function Pb(e){var i=e.latitude,r=e.longitude,n=e.zoom,t=e.scale,o=e.highPrecision,u=o===void 0?!1:o;t=t!==void 0?t:Ib(n),Cp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(t));var l={},p=K0*t,v=Math.cos(i*rh),x=p/360,S=x/v,A=p/J0/v;if(l.pixelsPerMeter=[A,-A,A],l.metersPerPixel=[1/A,-1/A,1/A],l.pixelsPerDegree=[x,-S,A],l.degreesPerPixel=[1/x,-1/S,1/A],u){var k=rh*Math.tan(i*rh)/v,D=x*k/2,R=p/J0*k,N=R/S*A;l.pixelsPerDegree2=[0,-D,R],l.pixelsPerMeter2=[N,0,N]}return l}function B6(e,i){var r=_slicedToArray(e,3),n=r[0],t=r[1],o=r[2],u=_slicedToArray(i,3),l=u[0],p=u[1],v=u[2],x=1,S=Pb({longitude:n,latitude:t,scale:x,highPrecision:!0}),A=S.pixelsPerMeter,k=S.pixelsPerMeter2,D=jm(e,x);D[0]+=l*(A[0]+k[0]*p),D[1]+=p*(A[1]+k[1]*p);var R=Q0(D,x),N=(o||0)+(v||0);return Number.isFinite(o)||Number.isFinite(v)?[R[0],R[1],N]:R}function pP(e){var i=e.height,r=e.pitch,n=e.bearing,t=e.altitude,o=e.center,u=o===void 0?null:o,l=e.flipY,p=l===void 0?!1:l,v=Lv();return Pi(v,v,[0,0,-t]),da(v,v,[1,1,1/i]),Rc(v,v,-r*rh),Zf(v,v,n*rh),p&&da(v,v,[1,-1,1]),u&&Pi(v,v,ca.negate([],u)),v}function dP(e){var i=e.width,r=e.height,n=e.altitude,t=n===void 0?fP:n,o=e.pitch,u=o===void 0?0:o,l=e.nearZMultiplier,p=l===void 0?1:l,v=e.farZMultiplier,x=v===void 0?1:v,S=u*rh,A=Math.atan(.5/t),k=Math.sin(A)*t/Math.sin(Math.PI/2-S-A),D=Math.cos(Math.PI/2-S)*k+t;return{fov:2*Math.atan(r/2/t),aspect:i/r,focalDistance:t,near:p,far:D*x}}function vP(e){var i=e.width,r=e.height,n=e.pitch,t=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,l=dP({width:i,height:r,altitude:t,pitch:n,nearZMultiplier:o,farZMultiplier:u}),p=l.fov,v=l.aspect,x=l.near,S=l.far,A=Od([],p,v,x,S);return A}function mP(e,i){var r=(0,K.Z)(e,3),n=r[0],t=r[1],o=r[2],u=o===void 0?0:o;return Cp(Number.isFinite(n)&&Number.isFinite(t)&&Number.isFinite(u)),Vm(i,[n,t,u,1])}function Lb(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,K.Z)(e,3),t=n[0],o=n[1],u=n[2];if(Cp(Number.isFinite(t)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var l=Vm(i,[t,o,u,1]);return l}var p=Vm(i,[t,o,0,1]),v=Vm(i,[t,o,1,1]),x=p[2],S=v[2],A=x===S?0:((r||0)-x)/(S-x);return Ir.lerp([],p,v,A)}var Rb=Lv(),gP=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,t=i.viewMatrix,o=t===void 0?Rb:t,u=i.projectionMatrix,l=u===void 0?Rb:u;(0,be.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=l;var p=Lv();$n(p,p,this.projectionMatrix),$n(p,p,this.viewMatrix),this.viewProjectionMatrix=p;var v=Lv();da(v,v,[this.width/2,-this.height/2,1]),Pi(v,v,[1,-1,0]),$n(v,v,this.viewProjectionMatrix);var x=ui(Lv(),v);if(!x)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=x,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,J.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&a(r.projectionMatrix,this.projectionMatrix)&&a(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=this.projectPosition(r),l=mP(u,this.pixelProjectionMatrix),p=(0,K.Z)(l,2),v=p[0],x=p[1],S=o?x:this.height-x;return r.length===2?[v,S]:[v,S,l[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=n.targetZ,l=(0,K.Z)(r,3),p=l[0],v=l[1],x=l[2],S=o?v:this.height-v,A=u&&u*this.pixelsPerMeter,k=Lb([p,S,x],this.pixelUnprojectionMatrix,A),D=this.unprojectPosition(k),R=(0,K.Z)(D,3),N=R[0],W=R[1],me=R[2];return Number.isFinite(x)?[N,W,me]:Number.isFinite(u)?[N,W,u]:[N,W]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),t=(0,K.Z)(n,2),o=t[0],u=t[1],l=(r[2]||0)*this.pixelsPerMeter;return[o,u,l]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),t=(0,K.Z)(n,2),o=t[0],u=t[1],l=(r[2]||0)/this.pixelsPerMeter;return[o,u,l]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function yP(e){var i=e.width,r=e.height,n=e.bounds,t=e.minExtent,o=t===void 0?0:t,u=e.maxZoom,l=u===void 0?24:u,p=e.padding,v=p===void 0?0:p,x=e.offset,S=x===void 0?[0,0]:x,A=(0,K.Z)(n,2),k=(0,K.Z)(A[0],2),D=k[0],R=k[1],N=(0,K.Z)(A[1],2),W=N[0],me=N[1];if(Number.isFinite(v)){var ye=v;v={top:ye,bottom:ye,left:ye,right:ye}}else Cp(Number.isFinite(v.top)&&Number.isFinite(v.bottom)&&Number.isFinite(v.left)&&Number.isFinite(v.right));var Ne=new Db({width:i,height:r,longitude:0,latitude:0,zoom:0}),Ue=Ne.project([D,me]),tt=Ne.project([W,R]),Et=[Math.max(Math.abs(tt[0]-Ue[0]),o),Math.max(Math.abs(tt[1]-Ue[1]),o)],Vt=[i-v.left-v.right-Math.abs(S[0])*2,r-v.top-v.bottom-Math.abs(S[1])*2];Cp(Vt[0]>0&&Vt[1]>0);var Yt=Vt[0]/Et[0],gr=Vt[1]/Et[1],hr=(v.right-v.left)/2/Yt,Hr=(v.bottom-v.top)/2/gr,fn=[(tt[0]+Ue[0])/2+hr,(tt[1]+Ue[1])/2+Hr],Rn=Ne.unproject(fn),Zi=Ne.zoom+Math.log2(Math.abs(Math.min(Yt,gr)));return{longitude:Rn[0],latitude:Rn[1],zoom:Math.min(Zi,l)}}var Db=function(e){(0,lt.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.width,o=n.height,u=n.latitude,l=u===void 0?0:u,p=n.longitude,v=p===void 0?0:p,x=n.zoom,S=x===void 0?0:x,A=n.pitch,k=A===void 0?0:A,D=n.bearing,R=D===void 0?0:D,N=n.altitude,W=N===void 0?1.5:N,me=n.nearZMultiplier,ye=n.farZMultiplier;(0,be.Z)(this,i),t=t||1,o=o||1;var Ne=Ib(S);W=Math.max(.75,W);var Ue=jm([v,l],Ne);Ue[2]=0;var tt=vP({width:t,height:o,pitch:k,bearing:R,altitude:W,nearZMultiplier:me||1/o,farZMultiplier:ye||1.01}),Et=pP({height:o,center:Ue,pitch:k,bearing:R,altitude:W,flipY:!0});return r=(0,dt.Z)(this,(0,re.Z)(i).call(this,{width:t,height:o,viewMatrix:Et,projectionMatrix:tt})),r.latitude=l,r.longitude=v,r.zoom=S,r.pitch=k,r.bearing=R,r.altitude=W,r.scale=Ne,r.center=Ue,r.pixelsPerMeter=Pb((0,Ee.Z)((0,Ee.Z)(r))).pixelsPerMeter[2],Object.freeze((0,Ee.Z)((0,Ee.Z)(r))),r}return(0,J.Z)(i,[{key:"projectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return jm(n,t)}},{key:"unprojectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Q0(n,t)}},{key:"getMapCenterByLngLatPosition",value:function(n){var t=n.lngLat,o=n.pos,u=Lb(o,this.pixelUnprojectionMatrix),l=jm(t,this.scale),p=Ir.add([],l,Ir.negate([],u)),v=Ir.add([],this.center,p);return Q0(v,this.scale)}},{key:"getLocationAtPoint",value:function(n){var t=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:o})}},{key:"fitBounds",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,l=yP(Object.assign({width:o,height:u,bounds:n},t)),p=l.longitude,v=l.latitude,x=l.zoom;return new i({width:o,height:u,longitude:p,latitude:v,zoom:x})}}]),i}(gP),_P=function(){function e(){(0,be.Z)(this,e)}return(0,J.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,t=r.zoom,o=r.pitch,u=r.bearing,l=r.viewportHeight,p=r.viewportWidth;this.viewport=new Db({width:p,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:t,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),xP=["id","attributionControl","style","token","rotation","mapInstance"],Ob,Fb;function bP(e){var i=SP();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function SP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function wP(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}wP(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Pv();var EP=0,Bb="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",AP=(Ob=(0,ut.b2)(),Ob(Fb=function(e){(0,lt.Z)(r,e);var i=bP(r);function r(){var n;(0,be.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,V.Z)((0,Ee.Z)(n),"version",nc.MAPBOX),n}return(0,J.Z)(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(t,0),l=u.x,p=u.y;return[l-o.x,p-o.y]}},{key:"lngLatToMercator",value:function(t,o){var u=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),l=u.x,p=l===void 0?0:l,v=u.y,x=v===void 0?0:v,S=u.z,A=S===void 0?0:S;return{x:p,y:x,z:A}}},{key:"getModelMatrix",value:function(t,o,u){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),x=v.meterInMercatorCoordinateUnits(),S=vt();return Pi(S,S,ca.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),da(S,S,ca.fromValues(x*l[0],-x*l[1],x*l[2])),Rc(S,S,u[0]),Ps(S,S,u[1]),Zf(S,S,u[2]),S}},{key:"init",value:function(){var n=(0,It.Z)(he().mark(function o(){var u=this,l,p,v,x,S,A,k,D,R,N,W,me,ye;return he().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:l=this.config,p=l.id,v=p===void 0?"map":p,x=l.attributionControl,S=x===void 0?!1:x,A=l.style,k=A===void 0?"light":A,D=l.token,R=D===void 0?Bb:D,N=l.rotation,W=N===void 0?0:N,me=l.mapInstance,ye=(0,rs.Z)(l,xP),this.viewport=new _P,!me&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),R===Bb&&k!=="blank"&&!window.mapboxgl.accessToken&&!me&&console.warn(this.configService.getSceneWarninfo("MapToken")),!me&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=R),me?(this.map=me,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(v),this.map=new window.mapboxgl.Map((0,O.Z)({container:this.$mapContainer,style:this.getMapStyleValue(k),attributionControl:S,bearing:W},ye))),this.map.on("load",function(){u.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ue.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,o;(t=this.$mapContainer)===null||t===void 0||(o=t.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).emit.apply(o,[t].concat(l))}},{key:"once",value:function(t){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).once.apply(o,[t].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,o){var u=new(Pv()).LngLat(t[0],t[1]),l=new(Pv()).LngLat(o[0],o[1]),p=u.distanceTo(l),v=Pv().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),x=Pv().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),S=v.x,A=v.y,k=x.x,D=x.y,R=Math.sqrt(Math.pow(S-k,2)+Math.pow(A-D,2))*4194304*2;return R/p}},{key:"exportMap",value:function(t){var o=this.map.getCanvas(),u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"creatMapContainer",value:function(t){var o=t;typeof t=="string"&&(o=document.getElementById(t));var u=document.createElement("div");return u.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,u.id="l7_mapbox_div"+EP++,o.appendChild(u),u}}]),r}(cP))||Fb);function CP(e){var i=TP();return function(){var n=(0,re.Z)(e),t;if(i){var o=(0,re.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,dt.Z)(this,t)}}function TP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function MP(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}MP(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var kP=function(e){(0,lt.Z)(r,e);var i=CP(r);function r(){return(0,be.Z)(this,r),i.apply(this,arguments)}return(0,J.Z)(r,[{key:"getServiceConstructor",value:function(){return AP}}]),r}(aP);function Rv(e){return Rv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Rv(e)}function zb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Nb(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zb(Object(r),!0).forEach(function(n){IP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function IP(e,i,r){return i=PP(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function PP(e){var i=LP(e,"string");return Rv(i)==="symbol"?i:String(i)}function LP(e,i){if(Rv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Rv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function RP(e,i){return BP(e)||FP(e,i)||OP(e,i)||DP()}function DP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OP(e,i){if(!!e){if(typeof e=="string")return Zb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zb(e,i)}}function Zb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function FP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function BP(e){if(Array.isArray(e))return e}var zP=Q.memo(function(e){var i=e.style,r=e.className,n=e.map,t=e.option,o=e.onSceneLoaded,u=(0,Q.createRef)(),l=(0,Q.useState)(),p=RP(l,2),v=p[0],x=p[1];return(0,Q.useEffect)(function(){var S=new KI(Nb(Nb({id:u.current},t),{},{map:new kP(n)}));return S.on("loaded",function(){x(S),o&&o(S)}),function(){S.destroy()}},[]),(0,Q.useEffect)(function(){v&&n.style&&v.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,Q.useEffect)(function(){v&&n.zoom&&v.setZoom(n.zoom)},[n.zoom]),(0,Q.useEffect)(function(){v&&n.center&&v.setCenter(n.center)},[JSON.stringify(n.center)]),(0,Q.useEffect)(function(){v&&n.pitch!==void 0&&v.setPitch(n.pitch||0)},[n.pitch]),(0,Q.useEffect)(function(){v&&n.rotation&&v.setRotation(n.rotation)},[n.rotation]),Q.createElement(y.Provider,{value:v},(0,Q.createElement)("div",{ref:u,style:i,className:r},v&&e.children))}),NP=zP;function Dv(e){return Dv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Dv(e)}function Ub(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function z6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ub(Object(r),!0).forEach(function(n){ZP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ub(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ZP(e,i,r){return i=UP(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function UP(e){var i=VP(e,"string");return Dv(i)==="symbol"?i:String(i)}function VP(e,i){if(Dv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Dv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function N6(e,i){return WP(e)||HP(e,i)||GP(e,i)||jP()}function jP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GP(e,i){if(!!e){if(typeof e=="string")return Vb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vb(e,i)}}function Vb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function HP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function WP(e){if(Array.isArray(e))return e}var Z6=null,U6=null;function Ov(e){return Ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Ov(e)}function jb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function V6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jb(Object(r),!0).forEach(function(n){$P(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $P(e,i,r){return i=XP(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function XP(e){var i=YP(e,"string");return Ov(i)==="symbol"?i:String(i)}function YP(e,i){if(Ov(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Ov(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function j6(e,i){return QP(e)||JP(e,i)||KP(e,i)||qP()}function qP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KP(e,i){if(!!e){if(typeof e=="string")return Gb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gb(e,i)}}function Gb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function JP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function QP(e){if(Array.isArray(e))return e}var G6=null,H6=null;function Fv(e){return Fv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Fv(e)}function Hb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function W6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hb(Object(r),!0).forEach(function(n){eL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eL(e,i,r){return i=tL(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function tL(e){var i=rL(e,"string");return Fv(i)==="symbol"?i:String(i)}function rL(e,i){if(Fv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Fv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function $6(e,i){return oL(e)||aL(e,i)||iL(e,i)||nL()}function nL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iL(e,i){if(!!e){if(typeof e=="string")return Wb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wb(e,i)}}function Wb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function aL(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function oL(e){if(Array.isArray(e))return e}var X6=null,Y6=null;function q6(e,i){return cL(e)||lL(e,i)||uL(e,i)||sL()}function sL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uL(e,i){if(!!e){if(typeof e=="string")return $b(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $b(e,i)}}function $b(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function lL(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function cL(e){if(Array.isArray(e))return e}var K6=null;function Bv(e){return Bv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Bv(e)}var J6=null;function Xb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Q6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Xb(Object(r),!0).forEach(function(n){fL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fL(e,i,r){return i=hL(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function hL(e){var i=pL(e,"string");return Bv(i)==="symbol"?i:String(i)}function pL(e,i){if(Bv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Bv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function eD(e,i){if(e==null)return{};var r=dL(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function dL(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var tD={exportImage:C3,fullscreen:P3,geoLocate:D3,layer:r_,layerSwitch:r_,logo:n_,mapTheme:j3,mouseLocation:W3,zoom:J3,scale:Y3},rD=null,Yb=z(73935);function qb(e,i){return yL(e)||gL(e,i)||mL(e,i)||vL()}function vL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mL(e,i){if(!!e){if(typeof e=="string")return Kb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kb(e,i)}}function Kb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function gL(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function yL(e){if(Array.isArray(e))return e}var Jb=Q.useEffect,Qb=Q.useState,_L=/\B([A-Z])/g,xL=function(i){return i.replace(_L,"-$1").toLowerCase()};function nD(e){var i=e.className,r=e.style,n=e.children,t=e.position,o=Qb(),u=qb(o,2),l=u[0],p=u[1],v=useSceneValue(),x=Qb(function(){return document.createElement("div")}),S=qb(x,1),A=S[0];return Jb(function(){var k=new Control({position:t});return k.onAdd=function(){if(i&&(A.className=i),r){var D=Object.keys(r).map(function(R){return"".concat(xL(R),":").concat(r[R])}).join(";");A.style.cssText=D}return A},k.onRemove=function(){},p(k),v.addControl(k),function(){v.removeControl(k)}},[]),Jb(function(){l&&l.setPosition(t||"bottomleft")},[t]),createPortal(n,A)}var e2=(0,Q.createContext)({});function iD(){return useContext(e2)}var bL=Q.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Os()),SL=Q.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Os()),wL=Q.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Os()),EL=Q.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Os()),AL=Q.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Os()),CL=Q.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Os()),TL=Q.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Os()),ML=Q.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Os()),kL=["data"];function IL(e,i){if(e==null)return{};var r=PL(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function PL(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var LL=Q.memo(function(i){var r=i.layer,n=i.source,t=n.data,o=IL(n,kL);return r.inited?r.setData(t,o):r.source(t,o),o.autoFit&&r.fitBounds(o&&o.fitBoundsOptions),null},Os()),aD=Q.useEffect,RL=Q.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Os());function DL(e,i){return zL(e)||BL(e,i)||FL(e,i)||OL()}function OL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FL(e,i){if(!!e){if(typeof e=="string")return t2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t2(e,i)}}function t2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function BL(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function zL(e){if(Array.isArray(e))return e}var zv=Q.useEffect,NL=Q.useState;function r2(e,i){var r=i.source,n=i.color,t=i.shape,o=i.style,u=i.size,l=i.scale,p=i.active,v=i.select,x=i.filter,S=i.animate,A=i.options,k=i.onLayerLoaded,D=se(),R=NL(function(){var me;switch(e){case"polygonLayer":me=new _m(A);break;case"lineLayer":me=new A0(A);break;case"pointLayer":me=new ym(A);break;case"heatmapLayer":me=new bA(A);break;case"rasterLayer":me=new xm(A);break;case"imageLayer":me=new L_(A);break;case"citybuildingLayer":me=new HE(A);break;default:me=new _m(A)}return me.on("inited",function(){k&&k(me,D)}),me}),N=DL(R,1),W=N[0];return zv(function(){return D.addLayer(W),function(){D.removeLayer(W)}},[]),zv(function(){W.inited&&A&&W.updateLayerConfig(A)},[A==null?void 0:A.minZoom,A==null?void 0:A.maxZoom,A==null?void 0:A.visible]),zv(function(){W.inited&&(A==null?void 0:A.zIndex)&&W.setIndex(A.zIndex)},[A==null?void 0:A.zIndex]),zv(function(){W.inited&&(A==null?void 0:A.blend)&&W.setBlend(A.blend)},[A==null?void 0:A.blend]),zv(function(){D.render()}),Q.createElement(e2.Provider,{value:W},Q.createElement(LL,{layer:W,source:r}),l&&Q.createElement(AL,{layer:W,scale:l}),n&&Q.createElement(wL,{layer:W,color:n}),u&&Q.createElement(ML,{layer:W,size:u}),t&&Q.createElement(TL,{layer:W,shape:t}),o&&Q.createElement(RL,{layer:W,style:o}),p&&Q.createElement(bL,{layer:W,active:p}),v&&Q.createElement(CL,{layer:W,select:v}),x&&Q.createElement(EL,{layer:W,filter:x}),S&&Q.createElement(SL,{layer:W,animate:S}),i.children)}var oD=null,sD=null,ZL=Q.memo(function(i){return r2("pointLayer",i)}),UL=Q.memo(function(i){return r2("heatmapLayer",i)}),uD=null,lD=null,cD=null,fD=Q.useEffect,hD=null,pD=null;function _d(e){return _d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_d(e)}function n2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Gm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?n2(Object(r),!0).forEach(function(n){VL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VL(e,i,r){return i=a2(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function jL(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function i2(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a2(n.key),n)}}function GL(e,i,r){return i&&i2(e.prototype,i),r&&i2(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a2(e){var i=HL(e,"string");return _d(i)==="symbol"?i:String(i)}function HL(e,i){if(_d(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(_d(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function WL(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&eg(e,i)}function eg(e,i){return eg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},eg(e,i)}function $L(e){var i=qL();return function(){var n=Hm(e),t;if(i){var o=Hm(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return XL(this,t)}}function XL(e,i){if(i&&(_d(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return YL(e)}function YL(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Hm(e){return Hm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Hm(e)}var dD=function(e){WL(r,e);var i=$L(r);function r(n){var t;return jL(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.popup=void 0,t.el=document.createElement("div"),t}return GL(r,[{key:"componentDidMount",value:function(){var t,o=this.props,u=o.lnglat,l=o.children,p=o.option,v=o.lngLat,x=new p0(Gm(Gm({},p),{},{stopPropagation:(t=this.props.option)===null||t===void 0?void 0:t.stopPropagation}));u&&x.setLnglat(u),v&&x.setLnglat(v),l&&x.setHTML(this.el),this.popup=x,this.scene.addPopup(x)}},{key:"componentDidUpdate",value:function(t){var o,u,l,p,v,x,S=Array.isArray(t.lnglat)?t.lnglat:[t==null||(o=t.lnglat)===null||o===void 0?void 0:o.lng,t==null||(u=t.lnglat)===null||u===void 0?void 0:u.lat],A=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(p=l.lnglat)===null||p===void 0?void 0:p.lng,(v=this.props)===null||v===void 0||(x=v.lnglat)===null||x===void 0?void 0:x.lat],k=S.toString()!==A.toString();if(k){var D;this.popup.remove(),this.popup=new p0(Gm(Gm({},this.props.option),{},{stopPropagation:(D=this.props.option)===null||D===void 0?void 0:D.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var t=this;return Q.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,Yb.createPortal)(t.props.children,t.el)})}}]),r}(Q.PureComponent);function xd(e){return xd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},xd(e)}function KL(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function o2(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,QL(n.key),n)}}function JL(e,i,r){return i&&o2(e.prototype,i),r&&o2(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function QL(e){var i=eR(e,"string");return xd(i)==="symbol"?i:String(i)}function eR(e,i){if(xd(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(xd(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function tR(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&tg(e,i)}function tg(e,i){return tg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},tg(e,i)}function rR(e){var i=aR();return function(){var n=Wm(e),t;if(i){var o=Wm(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return nR(this,t)}}function nR(e,i){if(i&&(xd(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return iR(e)}function iR(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function aR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Wm(e){return Wm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Wm(e)}var vD=function(e){tR(r,e);var i=rR(r);function r(n){var t;return KL(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.marker=void 0,t.el=document.createElement("div"),t}return JL(r,[{key:"componentDidMount",value:function(){var t=this.props,o=t.lnglat,u=t.children,l=t.option,p=t.onMarkerLoaded,v=new qy(l);o&&v.setLnglat(o),u&&v.setElement(this.el),this.marker=v,p&&p(v),this.scene.addMarker(v)}},{key:"componentDidUpdate",value:function(t){var o,u=JSON.stringify(t==null?void 0:t.lnglat)!==JSON.stringify((o=this.props)===null||o===void 0?void 0:o.lnglat);u&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var t=this;return Q.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,Yb.createPortal)(t.props.children,t.el)})}}]),r}(Q.PureComponent),mD=Q.useEffect,gD=null,yD=null,_D=Q.useEffect,xD=null},66213:function(wr,ee,z){"use strict";z.d(ee,{Z:function(){return y}});var _e=z(77608);function Q(se,U){for(;!Object.prototype.hasOwnProperty.call(se,U)&&(se=(0,_e.Z)(se),se!==null););return se}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(U,ce,ae){var Ge=Q(U,ce);if(!!Ge){var oe=Object.getOwnPropertyDescriptor(Ge,ce);return oe.get?oe.get.call(arguments.length<3?U:ae):oe.value}},y.apply(this,arguments)}},38163:function(wr){wr.exports=ee;function ee(Q,y){var se=Q&&Q.type,U;if(se==="FeatureCollection")for(U=0;U<Q.features.length;U++)ee(Q.features[U],y);else if(se==="GeometryCollection")for(U=0;U<Q.geometries.length;U++)ee(Q.geometries[U],y);else if(se==="Feature")ee(Q.geometry,y);else if(se==="Polygon")z(Q.coordinates,y);else if(se==="MultiPolygon")for(U=0;U<Q.coordinates.length;U++)z(Q.coordinates[U],y);return Q}function z(Q,y){if(Q.length!==0){_e(Q[0],y);for(var se=1;se<Q.length;se++)_e(Q[se],!y)}}function _e(Q,y){for(var se=0,U=0,ce=0,ae=Q.length,Ge=ae-1;ce<ae;Ge=ce++){var oe=(Q[ce][0]-Q[Ge][0])*(Q[Ge][1]+Q[ce][1]),je=se+oe;U+=Math.abs(se)>=Math.abs(oe)?se-je+oe:oe-je+se,se=je}se+U>=0!=!!y&&Q.reverse()}},75550:function(wr){"use strict";wr.exports=ee;function ee(z,_e){this.x=z,this.y=_e}ee.prototype={clone:function(){return new ee(this.x,this.y)},add:function(z){return this.clone()._add(z)},sub:function(z){return this.clone()._sub(z)},multByPoint:function(z){return this.clone()._multByPoint(z)},divByPoint:function(z){return this.clone()._divByPoint(z)},mult:function(z){return this.clone()._mult(z)},div:function(z){return this.clone()._div(z)},rotate:function(z){return this.clone()._rotate(z)},rotateAround:function(z,_e){return this.clone()._rotateAround(z,_e)},matMult:function(z){return this.clone()._matMult(z)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(z){return this.x===z.x&&this.y===z.y},dist:function(z){return Math.sqrt(this.distSqr(z))},distSqr:function(z){var _e=z.x-this.x,Q=z.y-this.y;return _e*_e+Q*Q},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(z){return Math.atan2(this.y-z.y,this.x-z.x)},angleWith:function(z){return this.angleWithSep(z.x,z.y)},angleWithSep:function(z,_e){return Math.atan2(this.x*_e-this.y*z,this.x*z+this.y*_e)},_matMult:function(z){var _e=z[0]*this.x+z[1]*this.y,Q=z[2]*this.x+z[3]*this.y;return this.x=_e,this.y=Q,this},_add:function(z){return this.x+=z.x,this.y+=z.y,this},_sub:function(z){return this.x-=z.x,this.y-=z.y,this},_mult:function(z){return this.x*=z,this.y*=z,this},_div:function(z){return this.x/=z,this.y/=z,this},_multByPoint:function(z){return this.x*=z.x,this.y*=z.y,this},_divByPoint:function(z){return this.x/=z.x,this.y/=z.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var z=this.y;return this.y=this.x,this.x=-z,this},_rotate:function(z){var _e=Math.cos(z),Q=Math.sin(z),y=_e*this.x-Q*this.y,se=Q*this.x+_e*this.y;return this.x=y,this.y=se,this},_rotateAround:function(z,_e){var Q=Math.cos(z),y=Math.sin(z),se=_e.x+Q*(this.x-_e.x)-y*(this.y-_e.y),U=_e.y+y*(this.x-_e.x)+Q*(this.y-_e.y);return this.x=se,this.y=U,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ee.convert=function(z){return z instanceof ee?z:Array.isArray(z)?new ee(z[0],z[1]):z}},49296:function(wr){"use strict";wr.exports=z,wr.exports.default=z;var ee=1e20;function z(U,ce,ae,Ge,oe,je){this.fontSize=U||24,this.buffer=ce===void 0?3:ce,this.cutoff=Ge||.25,this.fontFamily=oe||"sans-serif",this.fontWeight=je||"normal",this.radius=ae||8;var rt=this.size=this.fontSize+this.buffer*2,ct=rt+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=rt,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(ct*ct),this.gridInner=new Float64Array(ct*ct),this.f=new Float64Array(ct),this.z=new Float64Array(ct+1),this.v=new Uint16Array(ct),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(rt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function _e(U,ce,ae,Ge,oe,je,rt){je.fill(ee,0,ce*ae),rt.fill(0,0,ce*ae);for(var ct=(ce-Ge)/2,Pt=0;Pt<oe;Pt++)for(var er=0;er<Ge;er++){var qt=(Pt+ct)*ce+er+ct,ir=U.data[4*(Pt*Ge+er)+3]/255;if(ir===1)je[qt]=0,rt[qt]=ee;else if(ir===0)je[qt]=ee,rt[qt]=0;else{var tr=Math.max(0,.5-ir),Ct=Math.max(0,ir-.5);je[qt]=tr*tr,rt[qt]=Ct*Ct}}}function Q(U,ce,ae,Ge,oe,je,rt){for(var ct=0;ct<ce*ae;ct++){var Pt=Math.sqrt(Ge[ct])-Math.sqrt(oe[ct]);U[ct]=Math.round(255-255*(Pt/je+rt))}}z.prototype._draw=function(U,ce){var ae=this.ctx.measureText(U),Ge=ae.width,oe=2*this.buffer,je,rt,ct,Pt,er,qt,ir,tr;ce&&this.useMetrics?(er=Math.floor(ae.actualBoundingBoxAscent),tr=this.buffer+Math.ceil(ae.actualBoundingBoxAscent),qt=this.buffer,ir=this.buffer,rt=Math.min(this.size,Math.ceil(ae.actualBoundingBoxRight-ae.actualBoundingBoxLeft)),Pt=Math.min(this.size-qt,Math.ceil(ae.actualBoundingBoxAscent+ae.actualBoundingBoxDescent)),je=rt+oe,ct=Pt+oe,this.ctx.textBaseline="alphabetic"):(je=rt=this.size,ct=Pt=this.size,er=19*this.fontSize/24,qt=ir=0,tr=this.middle,this.ctx.textBaseline="middle");var Ct;rt&&Pt&&(this.ctx.clearRect(ir,qt,rt,Pt),this.ctx.fillText(U,this.buffer,tr),Ct=this.ctx.getImageData(ir,qt,rt,Pt));var yt=new Uint8ClampedArray(je*ct);return _e(Ct,je,ct,rt,Pt,this.gridOuter,this.gridInner),y(this.gridOuter,je,ct,this.f,this.v,this.z),y(this.gridInner,je,ct,this.f,this.v,this.z),Q(yt,je,ct,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:yt,metrics:{width:rt,height:Pt,sdfWidth:je,sdfHeight:ct,top:er,left:0,advance:Ge}}},z.prototype.draw=function(U){return this._draw(U,!1).data},z.prototype.drawWithMetrics=function(U){return this._draw(U,!0)};function y(U,ce,ae,Ge,oe,je){for(var rt=0;rt<ce;rt++)se(U,rt,ce,ae,Ge,oe,je);for(var ct=0;ct<ae;ct++)se(U,ct*ce,1,ce,Ge,oe,je)}function se(U,ce,ae,Ge,oe,je,rt){var ct,Pt,er,qt;for(je[0]=0,rt[0]=-ee,rt[1]=ee,ct=0;ct<Ge;ct++)oe[ct]=U[ce+ct*ae];for(ct=1,Pt=0,er=0;ct<Ge;ct++){do qt=je[Pt],er=(oe[ct]-oe[qt]+ct*ct-qt*qt)/(ct-qt)/2;while(er<=rt[Pt]&&--Pt>-1);Pt++,je[Pt]=ct,rt[Pt]=er,rt[Pt+1]=ee}for(ct=0,Pt=0;ct<Ge;ct++){for(;rt[Pt+1]<ct;)Pt++;qt=je[Pt],U[ce+ct*ae]=oe[qt]+(ct-qt)*(ct-qt)}}},38929:function(wr,ee,z){wr.exports.VectorTile=z(22779),z(66024),z(59701)},22779:function(wr,ee,z){"use strict";var _e=z(59701);wr.exports=Q;function Q(se,U){this.layers=se.readFields(y,{},U)}function y(se,U,ce){if(se===3){var ae=new _e(ce,ce.readVarint()+ce.pos);ae.length&&(U[ae.name]=ae)}}},66024:function(wr,ee,z){"use strict";var _e=z(75550);wr.exports=Q;function Q(ae,Ge,oe,je,rt){this.properties={},this.extent=oe,this.type=0,this._pbf=ae,this._geometry=-1,this._keys=je,this._values=rt,ae.readFields(y,this,Ge)}function y(ae,Ge,oe){ae==1?Ge.id=oe.readVarint():ae==2?se(oe,Ge):ae==3?Ge.type=oe.readVarint():ae==4&&(Ge._geometry=oe.pos)}function se(ae,Ge){for(var oe=ae.readVarint()+ae.pos;ae.pos<oe;){var je=Ge._keys[ae.readVarint()],rt=Ge._values[ae.readVarint()];Ge.properties[je]=rt}}Q.types=["Unknown","Point","LineString","Polygon"],Q.prototype.loadGeometry=function(){var ae=this._pbf;ae.pos=this._geometry;for(var Ge=ae.readVarint()+ae.pos,oe=1,je=0,rt=0,ct=0,Pt=[],er;ae.pos<Ge;){if(je<=0){var qt=ae.readVarint();oe=qt&7,je=qt>>3}if(je--,oe===1||oe===2)rt+=ae.readSVarint(),ct+=ae.readSVarint(),oe===1&&(er&&Pt.push(er),er=[]),er.push(new _e(rt,ct));else if(oe===7)er&&er.push(er[0].clone());else throw new Error("unknown command "+oe)}return er&&Pt.push(er),Pt},Q.prototype.bbox=function(){var ae=this._pbf;ae.pos=this._geometry;for(var Ge=ae.readVarint()+ae.pos,oe=1,je=0,rt=0,ct=0,Pt=Infinity,er=-Infinity,qt=Infinity,ir=-Infinity;ae.pos<Ge;){if(je<=0){var tr=ae.readVarint();oe=tr&7,je=tr>>3}if(je--,oe===1||oe===2)rt+=ae.readSVarint(),ct+=ae.readSVarint(),rt<Pt&&(Pt=rt),rt>er&&(er=rt),ct<qt&&(qt=ct),ct>ir&&(ir=ct);else if(oe!==7)throw new Error("unknown command "+oe)}return[Pt,qt,er,ir]},Q.prototype.toGeoJSON=function(ae,Ge,oe){var je=this.extent*Math.pow(2,oe),rt=this.extent*ae,ct=this.extent*Ge,Pt=this.loadGeometry(),er=Q.types[this.type],qt,ir;function tr(Fr){for(var mr=0;mr<Fr.length;mr++){var lr=Fr[mr],xt=180-(lr.y+ct)*360/je;Fr[mr]=[(lr.x+rt)*360/je-180,360/Math.PI*Math.atan(Math.exp(xt*Math.PI/180))-90]}}switch(this.type){case 1:var Ct=[];for(qt=0;qt<Pt.length;qt++)Ct[qt]=Pt[qt][0];Pt=Ct,tr(Pt);break;case 2:for(qt=0;qt<Pt.length;qt++)tr(Pt[qt]);break;case 3:for(Pt=U(Pt),qt=0;qt<Pt.length;qt++)for(ir=0;ir<Pt[qt].length;ir++)tr(Pt[qt][ir]);break}Pt.length===1?Pt=Pt[0]:er="Multi"+er;var yt={type:"Feature",geometry:{type:er,coordinates:Pt},properties:this.properties};return"id"in this&&(yt.id=this.id),yt};function U(ae){var Ge=ae.length;if(Ge<=1)return[ae];for(var oe=[],je,rt,ct=0;ct<Ge;ct++){var Pt=ce(ae[ct]);Pt!==0&&(rt===void 0&&(rt=Pt<0),rt===Pt<0?(je&&oe.push(je),je=[ae[ct]]):je.push(ae[ct]))}return je&&oe.push(je),oe}function ce(ae){for(var Ge=0,oe=0,je=ae.length,rt=je-1,ct,Pt;oe<je;rt=oe++)ct=ae[oe],Pt=ae[rt],Ge+=(Pt.x-ct.x)*(ct.y+Pt.y);return Ge}},59701:function(wr,ee,z){"use strict";var _e=z(66024);wr.exports=Q;function Q(U,ce){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=U,this._keys=[],this._values=[],this._features=[],U.readFields(y,this,ce),this.length=this._features.length}function y(U,ce,ae){U===15?ce.version=ae.readVarint():U===1?ce.name=ae.readString():U===5?ce.extent=ae.readVarint():U===2?ce._features.push(ae.pos):U===3?ce._keys.push(ae.readString()):U===4&&ce._values.push(se(ae))}function se(U){for(var ce=null,ae=U.readVarint()+U.pos;U.pos<ae;){var Ge=U.readVarint()>>3;ce=Ge===1?U.readString():Ge===2?U.readFloat():Ge===3?U.readDouble():Ge===4?U.readVarint64():Ge===5?U.readVarint():Ge===6?U.readSVarint():Ge===7?U.readBoolean():null}return ce}Q.prototype.feature=function(U){if(U<0||U>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[U];var ce=this._pbf.readVarint()+this._pbf.pos;return new _e(this._pbf,ce,this.extent,this._keys,this._values)}},53645:function(){},81903:function(){},7277:function(wr,ee,z){"use strict";z.d(ee,{Z:function(){return Kt}});var _e=z(22122),Q=z(67294),y=z(57838),se=z(96159),U=z(96156),ce=z(94184),ae=z.n(ce),Ge=z(53124),oe=z(90860),je=z(11726),rt=z.n(je),ct=function(Y){var Le=Y.value,O=Y.formatter,ke=Y.precision,Ae=Y.decimalSeparator,st=Y.groupSeparator,_t=st===void 0?"":st,bt=Y.prefixCls,Ht;if(typeof O=="function")Ht=O(Le);else{var nr=String(Le),Qr=nr.match(/^(-?)(\d*)(\.(\d+))?$/);if(!Qr||nr==="-")Ht=nr;else{var Lr=Qr[1],jn=Qr[2]||"0",tn=Qr[4]||"";jn=jn.replace(/\B(?=(\d{3})+(?!\d))/g,_t),typeof ke=="number"&&(tn=rt()(tn,ke,"0").slice(0,ke>0?ke:0)),tn&&(tn="".concat(Ae).concat(tn)),Ht=[Q.createElement("span",{key:"int",className:"".concat(bt,"-content-value-int")},Lr,jn),tn&&Q.createElement("span",{key:"decimal",className:"".concat(bt,"-content-value-decimal")},tn)]}}return Q.createElement("span",{className:"".concat(bt,"-content-value")},Ht)},Pt=ct,er=function(Y){var Le=Y.prefixCls,O=Y.className,ke=Y.style,Ae=Y.valueStyle,st=Y.value,_t=st===void 0?0:st,bt=Y.title,Ht=Y.valueRender,nr=Y.prefix,Qr=Y.suffix,Lr=Y.loading,jn=Lr===void 0?!1:Lr,tn=Y.direction,Cn=Y.onMouseEnter,si=Y.onMouseLeave,Xn=Y.decimalSeparator,vn=Xn===void 0?".":Xn,Ai=Y.groupSeparator,Ii=Ai===void 0?",":Ai,Ti=Q.createElement(Pt,(0,_e.Z)({decimalSeparator:vn,groupSeparator:Ii},Y,{value:_t})),Gn=ae()(Le,(0,U.Z)({},"".concat(Le,"-rtl"),tn==="rtl"),O);return Q.createElement("div",{className:Gn,style:ke,onMouseEnter:Cn,onMouseLeave:si},bt&&Q.createElement("div",{className:"".concat(Le,"-title")},bt),Q.createElement(oe.Z,{paragraph:!1,loading:jn,className:"".concat(Le,"-skeleton")},Q.createElement("div",{style:Ae,className:"".concat(Le,"-content")},nr&&Q.createElement("span",{className:"".concat(Le,"-content-prefix")},nr),Ht?Ht(Ti):Ti,Qr&&Q.createElement("span",{className:"".concat(Le,"-content-suffix")},Qr))))},qt=(0,Ge.PG)({prefixCls:"statistic"})(er),ir=qt,tr=z(28481),Ct=z(32475),yt=z.n(Ct),Fr=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function mr(xr,Y){var Le=xr,O=/\[[^\]]*]/g,ke=(Y.match(O)||[]).map(function(bt){return bt.slice(1,-1)}),Ae=Y.replace(O,"[]"),st=Fr.reduce(function(bt,Ht){var nr=(0,tr.Z)(Ht,2),Qr=nr[0],Lr=nr[1];if(bt.includes(Qr)){var jn=Math.floor(Le/Lr);return Le-=jn*Lr,bt.replace(new RegExp("".concat(Qr,"+"),"g"),function(tn){var Cn=tn.length;return yt()(jn.toString(),Cn,"0")})}return bt},Ae),_t=0;return st.replace(O,function(){var bt=ke[_t];return _t+=1,bt})}function lr(xr,Y){var Le=Y.format,O=Le===void 0?"":Le,ke=new Date(xr).getTime(),Ae=Date.now(),st=Math.max(ke-Ae,0);return mr(st,O)}var xt=1e3/30;function at(xr){return new Date(xr).getTime()}var Rt=function(Y){var Le=Y.value,O=Y.format,ke=O===void 0?"HH:mm:ss":O,Ae=Y.onChange,st=Y.onFinish,_t=(0,y.Z)(),bt=Q.useRef(null),Ht=function(){st==null||st(),bt.current&&(clearInterval(bt.current),bt.current=null)},nr=function(){var tn=at(Le);tn>=Date.now()&&(bt.current=setInterval(function(){_t(),Ae==null||Ae(tn-Date.now()),tn<Date.now()&&Ht()},xt))};Q.useEffect(function(){return nr(),function(){bt.current&&(clearInterval(bt.current),bt.current=null)}},[Le]);var Qr=function(tn,Cn){return lr(tn,(0,_e.Z)((0,_e.Z)({},Cn),{format:ke}))},Lr=function(tn){return(0,se.Tm)(tn,{title:void 0})};return Q.createElement(ir,(0,_e.Z)({},Y,{valueRender:Lr,formatter:Qr}))},ft=Q.memo(Rt);ir.Countdown=ft;var Kt=ir},95300:function(wr,ee,z){"use strict";var _e=z(38663),Q=z.n(_e),y=z(81903),se=z.n(y),U=z(18446)},9187:function(wr){"use strict";wr.exports=ee,wr.exports.default=ee;function ee(O,ke,Ae){Ae=Ae||2;var st=ke&&ke.length,_t=st?ke[0]*Ae:O.length,bt=z(O,0,_t,Ae,!0),Ht=[];if(!bt||bt.next===bt.prev)return Ht;var nr,Qr,Lr,jn,tn,Cn,si;if(st&&(bt=ae(O,ke,bt,Ae)),O.length>80*Ae){nr=Lr=O[0],Qr=jn=O[1];for(var Xn=Ae;Xn<_t;Xn+=Ae)tn=O[Xn],Cn=O[Xn+1],tn<nr&&(nr=tn),Cn<Qr&&(Qr=Cn),tn>Lr&&(Lr=tn),Cn>jn&&(jn=Cn);si=Math.max(Lr-nr,jn-Qr),si=si!==0?32767/si:0}return Q(bt,Ht,Ae,nr,Qr,si,0),Ht}function z(O,ke,Ae,st,_t){var bt,Ht;if(_t===Le(O,ke,Ae,st)>0)for(bt=ke;bt<Ae;bt+=st)Ht=Kt(bt,O[bt],O[bt+1],Ht);else for(bt=Ae-st;bt>=ke;bt-=st)Ht=Kt(bt,O[bt],O[bt+1],Ht);return Ht&&yt(Ht,Ht.next)&&(xr(Ht),Ht=Ht.next),Ht}function _e(O,ke){if(!O)return O;ke||(ke=O);var Ae=O,st;do if(st=!1,!Ae.steiner&&(yt(Ae,Ae.next)||Ct(Ae.prev,Ae,Ae.next)===0)){if(xr(Ae),Ae=ke=Ae.prev,Ae===Ae.next)break;st=!0}else Ae=Ae.next;while(st||Ae!==ke);return ke}function Q(O,ke,Ae,st,_t,bt,Ht){if(!!O){!Ht&&bt&&ct(O,st,_t,bt);for(var nr=O,Qr,Lr;O.prev!==O.next;){if(Qr=O.prev,Lr=O.next,bt?se(O,st,_t,bt):y(O)){ke.push(Qr.i/Ae|0),ke.push(O.i/Ae|0),ke.push(Lr.i/Ae|0),xr(O),O=Lr.next,nr=Lr.next;continue}if(O=Lr,O===nr){Ht?Ht===1?(O=U(_e(O),ke,Ae),Q(O,ke,Ae,st,_t,bt,2)):Ht===2&&ce(O,ke,Ae,st,_t,bt):Q(_e(O),ke,Ae,st,_t,bt,1);break}}}}function y(O){var ke=O.prev,Ae=O,st=O.next;if(Ct(ke,Ae,st)>=0)return!1;for(var _t=ke.x,bt=Ae.x,Ht=st.x,nr=ke.y,Qr=Ae.y,Lr=st.y,jn=_t<bt?_t<Ht?_t:Ht:bt<Ht?bt:Ht,tn=nr<Qr?nr<Lr?nr:Lr:Qr<Lr?Qr:Lr,Cn=_t>bt?_t>Ht?_t:Ht:bt>Ht?bt:Ht,si=nr>Qr?nr>Lr?nr:Lr:Qr>Lr?Qr:Lr,Xn=st.next;Xn!==ke;){if(Xn.x>=jn&&Xn.x<=Cn&&Xn.y>=tn&&Xn.y<=si&&ir(_t,nr,bt,Qr,Ht,Lr,Xn.x,Xn.y)&&Ct(Xn.prev,Xn,Xn.next)>=0)return!1;Xn=Xn.next}return!0}function se(O,ke,Ae,st){var _t=O.prev,bt=O,Ht=O.next;if(Ct(_t,bt,Ht)>=0)return!1;for(var nr=_t.x,Qr=bt.x,Lr=Ht.x,jn=_t.y,tn=bt.y,Cn=Ht.y,si=nr<Qr?nr<Lr?nr:Lr:Qr<Lr?Qr:Lr,Xn=jn<tn?jn<Cn?jn:Cn:tn<Cn?tn:Cn,vn=nr>Qr?nr>Lr?nr:Lr:Qr>Lr?Qr:Lr,Ai=jn>tn?jn>Cn?jn:Cn:tn>Cn?tn:Cn,Ii=er(si,Xn,ke,Ae,st),Ti=er(vn,Ai,ke,Ae,st),Gn=O.prevZ,Dn=O.nextZ;Gn&&Gn.z>=Ii&&Dn&&Dn.z<=Ti;){if(Gn.x>=si&&Gn.x<=vn&&Gn.y>=Xn&&Gn.y<=Ai&&Gn!==_t&&Gn!==Ht&&ir(nr,jn,Qr,tn,Lr,Cn,Gn.x,Gn.y)&&Ct(Gn.prev,Gn,Gn.next)>=0||(Gn=Gn.prevZ,Dn.x>=si&&Dn.x<=vn&&Dn.y>=Xn&&Dn.y<=Ai&&Dn!==_t&&Dn!==Ht&&ir(nr,jn,Qr,tn,Lr,Cn,Dn.x,Dn.y)&&Ct(Dn.prev,Dn,Dn.next)>=0))return!1;Dn=Dn.nextZ}for(;Gn&&Gn.z>=Ii;){if(Gn.x>=si&&Gn.x<=vn&&Gn.y>=Xn&&Gn.y<=Ai&&Gn!==_t&&Gn!==Ht&&ir(nr,jn,Qr,tn,Lr,Cn,Gn.x,Gn.y)&&Ct(Gn.prev,Gn,Gn.next)>=0)return!1;Gn=Gn.prevZ}for(;Dn&&Dn.z<=Ti;){if(Dn.x>=si&&Dn.x<=vn&&Dn.y>=Xn&&Dn.y<=Ai&&Dn!==_t&&Dn!==Ht&&ir(nr,jn,Qr,tn,Lr,Cn,Dn.x,Dn.y)&&Ct(Dn.prev,Dn,Dn.next)>=0)return!1;Dn=Dn.nextZ}return!0}function U(O,ke,Ae){var st=O;do{var _t=st.prev,bt=st.next.next;!yt(_t,bt)&&Fr(_t,st,st.next,bt)&&at(_t,bt)&&at(bt,_t)&&(ke.push(_t.i/Ae|0),ke.push(st.i/Ae|0),ke.push(bt.i/Ae|0),xr(st),xr(st.next),st=O=bt),st=st.next}while(st!==O);return _e(st)}function ce(O,ke,Ae,st,_t,bt){var Ht=O;do{for(var nr=Ht.next.next;nr!==Ht.prev;){if(Ht.i!==nr.i&&tr(Ht,nr)){var Qr=ft(Ht,nr);Ht=_e(Ht,Ht.next),Qr=_e(Qr,Qr.next),Q(Ht,ke,Ae,st,_t,bt,0),Q(Qr,ke,Ae,st,_t,bt,0);return}nr=nr.next}Ht=Ht.next}while(Ht!==O)}function ae(O,ke,Ae,st){var _t=[],bt,Ht,nr,Qr,Lr;for(bt=0,Ht=ke.length;bt<Ht;bt++)nr=ke[bt]*st,Qr=bt<Ht-1?ke[bt+1]*st:O.length,Lr=z(O,nr,Qr,st,!1),Lr===Lr.next&&(Lr.steiner=!0),_t.push(qt(Lr));for(_t.sort(Ge),bt=0;bt<_t.length;bt++)Ae=oe(_t[bt],Ae);return Ae}function Ge(O,ke){return O.x-ke.x}function oe(O,ke){var Ae=je(O,ke);if(!Ae)return ke;var st=ft(Ae,O);return _e(st,st.next),_e(Ae,Ae.next)}function je(O,ke){var Ae=ke,st=O.x,_t=O.y,bt=-Infinity,Ht;do{if(_t<=Ae.y&&_t>=Ae.next.y&&Ae.next.y!==Ae.y){var nr=Ae.x+(_t-Ae.y)*(Ae.next.x-Ae.x)/(Ae.next.y-Ae.y);if(nr<=st&&nr>bt&&(bt=nr,Ht=Ae.x<Ae.next.x?Ae:Ae.next,nr===st))return Ht}Ae=Ae.next}while(Ae!==ke);if(!Ht)return null;var Qr=Ht,Lr=Ht.x,jn=Ht.y,tn=Infinity,Cn;Ae=Ht;do st>=Ae.x&&Ae.x>=Lr&&st!==Ae.x&&ir(_t<jn?st:bt,_t,Lr,jn,_t<jn?bt:st,_t,Ae.x,Ae.y)&&(Cn=Math.abs(_t-Ae.y)/(st-Ae.x),at(Ae,O)&&(Cn<tn||Cn===tn&&(Ae.x>Ht.x||Ae.x===Ht.x&&rt(Ht,Ae)))&&(Ht=Ae,tn=Cn)),Ae=Ae.next;while(Ae!==Qr);return Ht}function rt(O,ke){return Ct(O.prev,O,ke.prev)<0&&Ct(ke.next,O,O.next)<0}function ct(O,ke,Ae,st){var _t=O;do _t.z===0&&(_t.z=er(_t.x,_t.y,ke,Ae,st)),_t.prevZ=_t.prev,_t.nextZ=_t.next,_t=_t.next;while(_t!==O);_t.prevZ.nextZ=null,_t.prevZ=null,Pt(_t)}function Pt(O){var ke,Ae,st,_t,bt,Ht,nr,Qr,Lr=1;do{for(Ae=O,O=null,bt=null,Ht=0;Ae;){for(Ht++,st=Ae,nr=0,ke=0;ke<Lr&&(nr++,st=st.nextZ,!!st);ke++);for(Qr=Lr;nr>0||Qr>0&&st;)nr!==0&&(Qr===0||!st||Ae.z<=st.z)?(_t=Ae,Ae=Ae.nextZ,nr--):(_t=st,st=st.nextZ,Qr--),bt?bt.nextZ=_t:O=_t,_t.prevZ=bt,bt=_t;Ae=st}bt.nextZ=null,Lr*=2}while(Ht>1);return O}function er(O,ke,Ae,st,_t){return O=(O-Ae)*_t|0,ke=(ke-st)*_t|0,O=(O|O<<8)&16711935,O=(O|O<<4)&252645135,O=(O|O<<2)&858993459,O=(O|O<<1)&1431655765,ke=(ke|ke<<8)&16711935,ke=(ke|ke<<4)&252645135,ke=(ke|ke<<2)&858993459,ke=(ke|ke<<1)&1431655765,O|ke<<1}function qt(O){var ke=O,Ae=O;do(ke.x<Ae.x||ke.x===Ae.x&&ke.y<Ae.y)&&(Ae=ke),ke=ke.next;while(ke!==O);return Ae}function ir(O,ke,Ae,st,_t,bt,Ht,nr){return(_t-Ht)*(ke-nr)>=(O-Ht)*(bt-nr)&&(O-Ht)*(st-nr)>=(Ae-Ht)*(ke-nr)&&(Ae-Ht)*(bt-nr)>=(_t-Ht)*(st-nr)}function tr(O,ke){return O.next.i!==ke.i&&O.prev.i!==ke.i&&!xt(O,ke)&&(at(O,ke)&&at(ke,O)&&Rt(O,ke)&&(Ct(O.prev,O,ke.prev)||Ct(O,ke.prev,ke))||yt(O,ke)&&Ct(O.prev,O,O.next)>0&&Ct(ke.prev,ke,ke.next)>0)}function Ct(O,ke,Ae){return(ke.y-O.y)*(Ae.x-ke.x)-(ke.x-O.x)*(Ae.y-ke.y)}function yt(O,ke){return O.x===ke.x&&O.y===ke.y}function Fr(O,ke,Ae,st){var _t=lr(Ct(O,ke,Ae)),bt=lr(Ct(O,ke,st)),Ht=lr(Ct(Ae,st,O)),nr=lr(Ct(Ae,st,ke));return!!(_t!==bt&&Ht!==nr||_t===0&&mr(O,Ae,ke)||bt===0&&mr(O,st,ke)||Ht===0&&mr(Ae,O,st)||nr===0&&mr(Ae,ke,st))}function mr(O,ke,Ae){return ke.x<=Math.max(O.x,Ae.x)&&ke.x>=Math.min(O.x,Ae.x)&&ke.y<=Math.max(O.y,Ae.y)&&ke.y>=Math.min(O.y,Ae.y)}function lr(O){return O>0?1:O<0?-1:0}function xt(O,ke){var Ae=O;do{if(Ae.i!==O.i&&Ae.next.i!==O.i&&Ae.i!==ke.i&&Ae.next.i!==ke.i&&Fr(Ae,Ae.next,O,ke))return!0;Ae=Ae.next}while(Ae!==O);return!1}function at(O,ke){return Ct(O.prev,O,O.next)<0?Ct(O,ke,O.next)>=0&&Ct(O,O.prev,ke)>=0:Ct(O,ke,O.prev)<0||Ct(O,O.next,ke)<0}function Rt(O,ke){var Ae=O,st=!1,_t=(O.x+ke.x)/2,bt=(O.y+ke.y)/2;do Ae.y>bt!=Ae.next.y>bt&&Ae.next.y!==Ae.y&&_t<(Ae.next.x-Ae.x)*(bt-Ae.y)/(Ae.next.y-Ae.y)+Ae.x&&(st=!st),Ae=Ae.next;while(Ae!==O);return st}function ft(O,ke){var Ae=new Y(O.i,O.x,O.y),st=new Y(ke.i,ke.x,ke.y),_t=O.next,bt=ke.prev;return O.next=ke,ke.prev=O,Ae.next=_t,_t.prev=Ae,st.next=Ae,Ae.prev=st,bt.next=st,st.prev=bt,st}function Kt(O,ke,Ae,st){var _t=new Y(O,ke,Ae);return st?(_t.next=st.next,_t.prev=st,st.next.prev=_t,st.next=_t):(_t.prev=_t,_t.next=_t),_t}function xr(O){O.next.prev=O.prev,O.prev.next=O.next,O.prevZ&&(O.prevZ.nextZ=O.nextZ),O.nextZ&&(O.nextZ.prevZ=O.prevZ)}function Y(O,ke,Ae){this.i=O,this.x=ke,this.y=Ae,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ee.deviation=function(O,ke,Ae,st){var _t=ke&&ke.length,bt=_t?ke[0]*Ae:O.length,Ht=Math.abs(Le(O,0,bt,Ae));if(_t)for(var nr=0,Qr=ke.length;nr<Qr;nr++){var Lr=ke[nr]*Ae,jn=nr<Qr-1?ke[nr+1]*Ae:O.length;Ht-=Math.abs(Le(O,Lr,jn,Ae))}var tn=0;for(nr=0;nr<st.length;nr+=3){var Cn=st[nr]*Ae,si=st[nr+1]*Ae,Xn=st[nr+2]*Ae;tn+=Math.abs((O[Cn]-O[Xn])*(O[si+1]-O[Cn+1])-(O[Cn]-O[si])*(O[Xn+1]-O[Cn+1]))}return Ht===0&&tn===0?0:Math.abs((tn-Ht)/Ht)};function Le(O,ke,Ae,st){for(var _t=0,bt=ke,Ht=Ae-st;bt<Ae;bt+=st)_t+=(O[Ht]-O[bt])*(O[bt+1]+O[Ht+1]),Ht=bt;return _t}ee.flatten=function(O){for(var ke=O[0][0].length,Ae={vertices:[],holes:[],dimensions:ke},st=0,_t=0;_t<O.length;_t++){for(var bt=0;bt<O[_t].length;bt++)for(var Ht=0;Ht<ke;Ht++)Ae.vertices.push(O[_t][bt][Ht]);_t>0&&(st+=O[_t-1].length,Ae.holes.push(st))}return Ae}},67709:function(wr){function ee(_e){var Q=_e.target||_e.srcElement;Q.__resizeRAF__&&cancelAnimationFrame(Q.__resizeRAF__),Q.__resizeRAF__=requestAnimationFrame(function(){var y=Q.__resizeTrigger__,se=y&&y.__resizeListeners__;se&&se.forEach(function(U){U.call(y,_e)})})}var z=function(Q,y){var se=this,U=se.document,ce,ae=U.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ge(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ee)}if(!Q.__resizeListeners__)if(Q.__resizeListeners__=[],ae)Q.__resizeTrigger__=Q,Q.attachEvent("onresize",ee);else{getComputedStyle(Q).position==="static"&&(Q.style.position="relative");var oe=Q.__resizeTrigger__=U.createElement("object");oe.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),oe.setAttribute("class","resize-sensor"),oe.setAttribute("tabindex","-1"),oe.setAttribute("title",""),oe.__resizeElement__=Q,oe.onload=Ge,oe.type="text/html",ce&&Q.appendChild(oe),oe.data="about:blank",ce||Q.appendChild(oe)}Q.__resizeListeners__.push(y)};wr.exports=typeof window=="undefined"?z:z.bind(window),wr.exports.unbind=function(_e,Q){var y=document.attachEvent,se=_e.__resizeListeners__||[];if(Q){var U=se.indexOf(Q);U!==-1&&se.splice(U,1)}else se=_e.__resizeListeners__=[];if(!se.length){if(y)_e.detachEvent("onresize",ee);else if(_e.__resizeTrigger__){var ce=_e.__resizeTrigger__.contentDocument,ae=ce&&ce.defaultView;ae&&(ae.removeEventListener("resize",ee),delete ae.__resizeTrigger__),_e.__resizeTrigger__=!_e.removeChild(_e.__resizeTrigger__)}delete _e.__resizeListeners__}}},26729:function(wr){"use strict";var ee=Object.prototype.hasOwnProperty,z="~";function _e(){}Object.create&&(_e.prototype=Object.create(null),new _e().__proto__||(z=!1));function Q(ce,ae,Ge){this.fn=ce,this.context=ae,this.once=Ge||!1}function y(ce,ae,Ge,oe,je){if(typeof Ge!="function")throw new TypeError("The listener must be a function");var rt=new Q(Ge,oe||ce,je),ct=z?z+ae:ae;return ce._events[ct]?ce._events[ct].fn?ce._events[ct]=[ce._events[ct],rt]:ce._events[ct].push(rt):(ce._events[ct]=rt,ce._eventsCount++),ce}function se(ce,ae){--ce._eventsCount==0?ce._events=new _e:delete ce._events[ae]}function U(){this._events=new _e,this._eventsCount=0}U.prototype.eventNames=function(){var ae=[],Ge,oe;if(this._eventsCount===0)return ae;for(oe in Ge=this._events)ee.call(Ge,oe)&&ae.push(z?oe.slice(1):oe);return Object.getOwnPropertySymbols?ae.concat(Object.getOwnPropertySymbols(Ge)):ae},U.prototype.listeners=function(ae){var Ge=z?z+ae:ae,oe=this._events[Ge];if(!oe)return[];if(oe.fn)return[oe.fn];for(var je=0,rt=oe.length,ct=new Array(rt);je<rt;je++)ct[je]=oe[je].fn;return ct},U.prototype.listenerCount=function(ae){var Ge=z?z+ae:ae,oe=this._events[Ge];return oe?oe.fn?1:oe.length:0},U.prototype.emit=function(ae,Ge,oe,je,rt,ct){var Pt=z?z+ae:ae;if(!this._events[Pt])return!1;var er=this._events[Pt],qt=arguments.length,ir,tr;if(er.fn){switch(er.once&&this.removeListener(ae,er.fn,void 0,!0),qt){case 1:return er.fn.call(er.context),!0;case 2:return er.fn.call(er.context,Ge),!0;case 3:return er.fn.call(er.context,Ge,oe),!0;case 4:return er.fn.call(er.context,Ge,oe,je),!0;case 5:return er.fn.call(er.context,Ge,oe,je,rt),!0;case 6:return er.fn.call(er.context,Ge,oe,je,rt,ct),!0}for(tr=1,ir=new Array(qt-1);tr<qt;tr++)ir[tr-1]=arguments[tr];er.fn.apply(er.context,ir)}else{var Ct=er.length,yt;for(tr=0;tr<Ct;tr++)switch(er[tr].once&&this.removeListener(ae,er[tr].fn,void 0,!0),qt){case 1:er[tr].fn.call(er[tr].context);break;case 2:er[tr].fn.call(er[tr].context,Ge);break;case 3:er[tr].fn.call(er[tr].context,Ge,oe);break;case 4:er[tr].fn.call(er[tr].context,Ge,oe,je);break;default:if(!ir)for(yt=1,ir=new Array(qt-1);yt<qt;yt++)ir[yt-1]=arguments[yt];er[tr].fn.apply(er[tr].context,ir)}}return!0},U.prototype.on=function(ae,Ge,oe){return y(this,ae,Ge,oe,!1)},U.prototype.once=function(ae,Ge,oe){return y(this,ae,Ge,oe,!0)},U.prototype.removeListener=function(ae,Ge,oe,je){var rt=z?z+ae:ae;if(!this._events[rt])return this;if(!Ge)return se(this,rt),this;var ct=this._events[rt];if(ct.fn)ct.fn===Ge&&(!je||ct.once)&&(!oe||ct.context===oe)&&se(this,rt);else{for(var Pt=0,er=[],qt=ct.length;Pt<qt;Pt++)(ct[Pt].fn!==Ge||je&&!ct[Pt].once||oe&&ct[Pt].context!==oe)&&er.push(ct[Pt]);er.length?this._events[rt]=er.length===1?er[0]:er:se(this,rt)}return this},U.prototype.removeAllListeners=function(ae){var Ge;return ae?(Ge=z?z+ae:ae,this._events[Ge]&&se(this,Ge)):(this._events=new _e,this._eventsCount=0),this},U.prototype.off=U.prototype.removeListener,U.prototype.addListener=U.prototype.on,U.prefixed=z,U.EventEmitter=U,wr.exports=U},50840:function(wr,ee,z){var _e;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(Q,y,se,U){"use strict";var ce=["","webkit","Moz","MS","ms","o"],ae=y.createElement("div"),Ge="function",oe=Math.round,je=Math.abs,rt=Date.now;function ct(K,Me,nt){return setTimeout(Fr(K,nt),Me)}function Pt(K,Me,nt){return Array.isArray(K)?(er(K,nt[Me],nt),!0):!1}function er(K,Me,nt){var Jt;if(!!K)if(K.forEach)K.forEach(Me,nt);else if(K.length!==U)for(Jt=0;Jt<K.length;)Me.call(nt,K[Jt],Jt,K),Jt++;else for(Jt in K)K.hasOwnProperty(Jt)&&Me.call(nt,K[Jt],Jt,K)}function qt(K,Me,nt){var Jt="DEPRECATED METHOD: "+Me+`
`+nt+` AT 
`;return function(){var Vr=new Error("get-stack-trace"),Mn=Vr&&Vr.stack?Vr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ri=Q.console&&(Q.console.warn||Q.console.log);return Ri&&Ri.call(Q.console,Jt,Mn),K.apply(this,arguments)}}var ir;typeof Object.assign!="function"?ir=function(Me){if(Me===U||Me===null)throw new TypeError("Cannot convert undefined or null to object");for(var nt=Object(Me),Jt=1;Jt<arguments.length;Jt++){var Vr=arguments[Jt];if(Vr!==U&&Vr!==null)for(var Mn in Vr)Vr.hasOwnProperty(Mn)&&(nt[Mn]=Vr[Mn])}return nt}:ir=Object.assign;var tr=qt(function(Me,nt,Jt){for(var Vr=Object.keys(nt),Mn=0;Mn<Vr.length;)(!Jt||Jt&&Me[Vr[Mn]]===U)&&(Me[Vr[Mn]]=nt[Vr[Mn]]),Mn++;return Me},"extend","Use `assign`."),Ct=qt(function(Me,nt){return tr(Me,nt,!0)},"merge","Use `assign`.");function yt(K,Me,nt){var Jt=Me.prototype,Vr;Vr=K.prototype=Object.create(Jt),Vr.constructor=K,Vr._super=Jt,nt&&ir(Vr,nt)}function Fr(K,Me){return function(){return K.apply(Me,arguments)}}function mr(K,Me){return typeof K==Ge?K.apply(Me&&Me[0]||U,Me):K}function lr(K,Me){return K===U?Me:K}function xt(K,Me,nt){er(Kt(Me),function(Jt){K.addEventListener(Jt,nt,!1)})}function at(K,Me,nt){er(Kt(Me),function(Jt){K.removeEventListener(Jt,nt,!1)})}function Rt(K,Me){for(;K;){if(K==Me)return!0;K=K.parentNode}return!1}function ft(K,Me){return K.indexOf(Me)>-1}function Kt(K){return K.trim().split(/\s+/g)}function xr(K,Me,nt){if(K.indexOf&&!nt)return K.indexOf(Me);for(var Jt=0;Jt<K.length;){if(nt&&K[Jt][nt]==Me||!nt&&K[Jt]===Me)return Jt;Jt++}return-1}function Y(K){return Array.prototype.slice.call(K,0)}function Le(K,Me,nt){for(var Jt=[],Vr=[],Mn=0;Mn<K.length;){var Ri=Me?K[Mn][Me]:K[Mn];xr(Vr,Ri)<0&&Jt.push(K[Mn]),Vr[Mn]=Ri,Mn++}return nt&&(Me?Jt=Jt.sort(function(oo,Ua){return oo[Me]>Ua[Me]}):Jt=Jt.sort()),Jt}function O(K,Me){for(var nt,Jt,Vr=Me[0].toUpperCase()+Me.slice(1),Mn=0;Mn<ce.length;){if(nt=ce[Mn],Jt=nt?nt+Vr:Me,Jt in K)return Jt;Mn++}return U}var ke=1;function Ae(){return ke++}function st(K){var Me=K.ownerDocument||K;return Me.defaultView||Me.parentWindow||Q}var _t=/mobile|tablet|ip(ad|hone|od)|android/i,bt="ontouchstart"in Q,Ht=O(Q,"PointerEvent")!==U,nr=bt&&_t.test(navigator.userAgent),Qr="touch",Lr="pen",jn="mouse",tn="kinect",Cn=25,si=1,Xn=2,vn=4,Ai=8,Ii=1,Ti=2,Gn=4,Dn=8,ho=16,Hi=Ti|Gn,Ya=Dn|ho,kt=Hi|Ya,L=["x","y"],ne=["clientX","clientY"];function fe(K,Me){var nt=this;this.manager=K,this.callback=Me,this.element=K.element,this.target=K.options.inputTarget,this.domHandler=function(Jt){mr(K.options.enable,[K])&&nt.handler(Jt)},this.init()}fe.prototype={handler:function(){},init:function(){this.evEl&&xt(this.element,this.evEl,this.domHandler),this.evTarget&&xt(this.target,this.evTarget,this.domHandler),this.evWin&&xt(st(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&at(this.element,this.evEl,this.domHandler),this.evTarget&&at(this.target,this.evTarget,this.domHandler),this.evWin&&at(st(this.element),this.evWin,this.domHandler)}};function Ze(K){var Me,nt=K.options.inputClass;return nt?Me=nt:Ht?Me=X:nr?Me=be:bt?Me=br:Me=$i,new Me(K,pt)}function pt(K,Me,nt){var Jt=nt.pointers.length,Vr=nt.changedPointers.length,Mn=Me&si&&Jt-Vr==0,Ri=Me&(vn|Ai)&&Jt-Vr==0;nt.isFirst=!!Mn,nt.isFinal=!!Ri,Mn&&(K.session={}),nt.eventType=Me,Wt(K,nt),K.emit("hammer.input",nt),K.recognize(nt),K.session.prevInput=nt}function Wt(K,Me){var nt=K.session,Jt=Me.pointers,Vr=Jt.length;nt.firstInput||(nt.firstInput=Tt(Me)),Vr>1&&!nt.firstMultiple?nt.firstMultiple=Tt(Me):Vr===1&&(nt.firstMultiple=!1);var Mn=nt.firstInput,Ri=nt.firstMultiple,Pa=Ri?Ri.center:Mn.center,oo=Me.center=ar(Jt);Me.timeStamp=rt(),Me.deltaTime=Me.timeStamp-Mn.timeStamp,Me.angle=wn(Pa,oo),Me.distance=mn(Pa,oo),Ar(nt,Me),Me.offsetDirection=Wr(Me.deltaX,Me.deltaY);var Ua=Er(Me.deltaTime,Me.deltaX,Me.deltaY);Me.overallVelocityX=Ua.x,Me.overallVelocityY=Ua.y,Me.overallVelocity=je(Ua.x)>je(Ua.y)?Ua.x:Ua.y,Me.scale=Ri?xn(Ri.pointers,Jt):1,Me.rotation=Ri?gn(Ri.pointers,Jt):0,Me.maxPointers=nt.prevInput?Me.pointers.length>nt.prevInput.maxPointers?Me.pointers.length:nt.prevInput.maxPointers:Me.pointers.length,Ve(nt,Me);var as=K.element;Rt(Me.srcEvent.target,as)&&(as=Me.srcEvent.target),Me.target=as}function Ar(K,Me){var nt=Me.center,Jt=K.offsetDelta||{},Vr=K.prevDelta||{},Mn=K.prevInput||{};(Me.eventType===si||Mn.eventType===vn)&&(Vr=K.prevDelta={x:Mn.deltaX||0,y:Mn.deltaY||0},Jt=K.offsetDelta={x:nt.x,y:nt.y}),Me.deltaX=Vr.x+(nt.x-Jt.x),Me.deltaY=Vr.y+(nt.y-Jt.y)}function Ve(K,Me){var nt=K.lastInterval||Me,Jt=Me.timeStamp-nt.timeStamp,Vr,Mn,Ri,Pa;if(Me.eventType!=Ai&&(Jt>Cn||nt.velocity===U)){var oo=Me.deltaX-nt.deltaX,Ua=Me.deltaY-nt.deltaY,as=Er(Jt,oo,Ua);Mn=as.x,Ri=as.y,Vr=je(as.x)>je(as.y)?as.x:as.y,Pa=Wr(oo,Ua),K.lastInterval=Me}else Vr=nt.velocity,Mn=nt.velocityX,Ri=nt.velocityY,Pa=nt.direction;Me.velocity=Vr,Me.velocityX=Mn,Me.velocityY=Ri,Me.direction=Pa}function Tt(K){for(var Me=[],nt=0;nt<K.pointers.length;)Me[nt]={clientX:oe(K.pointers[nt].clientX),clientY:oe(K.pointers[nt].clientY)},nt++;return{timeStamp:rt(),pointers:Me,center:ar(Me),deltaX:K.deltaX,deltaY:K.deltaY}}function ar(K){var Me=K.length;if(Me===1)return{x:oe(K[0].clientX),y:oe(K[0].clientY)};for(var nt=0,Jt=0,Vr=0;Vr<Me;)nt+=K[Vr].clientX,Jt+=K[Vr].clientY,Vr++;return{x:oe(nt/Me),y:oe(Jt/Me)}}function Er(K,Me,nt){return{x:Me/K||0,y:nt/K||0}}function Wr(K,Me){return K===Me?Ii:je(K)>=je(Me)?K<0?Ti:Gn:Me<0?Dn:ho}function mn(K,Me,nt){nt||(nt=L);var Jt=Me[nt[0]]-K[nt[0]],Vr=Me[nt[1]]-K[nt[1]];return Math.sqrt(Jt*Jt+Vr*Vr)}function wn(K,Me,nt){nt||(nt=L);var Jt=Me[nt[0]]-K[nt[0]],Vr=Me[nt[1]]-K[nt[1]];return Math.atan2(Vr,Jt)*180/Math.PI}function gn(K,Me){return wn(Me[1],Me[0],ne)+wn(K[1],K[0],ne)}function xn(K,Me){return mn(Me[0],Me[1],ne)/mn(K[0],K[1],ne)}var ri={mousedown:si,mousemove:Xn,mouseup:vn},Jn="mousedown",Wi="mousemove mouseup";function $i(){this.evEl=Jn,this.evWin=Wi,this.pressed=!1,fe.apply(this,arguments)}yt($i,fe,{handler:function(Me){var nt=ri[Me.type];nt&si&&Me.button===0&&(this.pressed=!0),nt&Xn&&Me.which!==1&&(nt=vn),!!this.pressed&&(nt&vn&&(this.pressed=!1),this.callback(this.manager,nt,{pointers:[Me],changedPointers:[Me],pointerType:jn,srcEvent:Me}))}});var po={pointerdown:si,pointermove:Xn,pointerup:vn,pointercancel:Ai,pointerout:Ai},$o={2:Qr,3:Lr,4:jn,5:tn},Xi="pointerdown",G="pointermove pointerup pointercancel";Q.MSPointerEvent&&!Q.PointerEvent&&(Xi="MSPointerDown",G="MSPointerMove MSPointerUp MSPointerCancel");function X(){this.evEl=Xi,this.evWin=G,fe.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}yt(X,fe,{handler:function(Me){var nt=this.store,Jt=!1,Vr=Me.type.toLowerCase().replace("ms",""),Mn=po[Vr],Ri=$o[Me.pointerType]||Me.pointerType,Pa=Ri==Qr,oo=xr(nt,Me.pointerId,"pointerId");Mn&si&&(Me.button===0||Pa)?oo<0&&(nt.push(Me),oo=nt.length-1):Mn&(vn|Ai)&&(Jt=!0),!(oo<0)&&(nt[oo]=Me,this.callback(this.manager,Mn,{pointers:nt,changedPointers:[Me],pointerType:Ri,srcEvent:Me}),Jt&&nt.splice(oo,1))}});var ie={touchstart:si,touchmove:Xn,touchend:vn,touchcancel:Ai},we="touchstart",Oe="touchstart touchmove touchend touchcancel";function Ke(){this.evTarget=we,this.evWin=Oe,this.started=!1,fe.apply(this,arguments)}yt(Ke,fe,{handler:function(Me){var nt=ie[Me.type];if(nt===si&&(this.started=!0),!!this.started){var Jt=ot.call(this,Me,nt);nt&(vn|Ai)&&Jt[0].length-Jt[1].length==0&&(this.started=!1),this.callback(this.manager,nt,{pointers:Jt[0],changedPointers:Jt[1],pointerType:Qr,srcEvent:Me})}}});function ot(K,Me){var nt=Y(K.touches),Jt=Y(K.changedTouches);return Me&(vn|Ai)&&(nt=Le(nt.concat(Jt),"identifier",!0)),[nt,Jt]}var pe={touchstart:si,touchmove:Xn,touchend:vn,touchcancel:Ai},J="touchstart touchmove touchend touchcancel";function be(){this.evTarget=J,this.targetIds={},fe.apply(this,arguments)}yt(be,fe,{handler:function(Me){var nt=pe[Me.type],Jt=lt.call(this,Me,nt);!Jt||this.callback(this.manager,nt,{pointers:Jt[0],changedPointers:Jt[1],pointerType:Qr,srcEvent:Me})}});function lt(K,Me){var nt=Y(K.touches),Jt=this.targetIds;if(Me&(si|Xn)&&nt.length===1)return Jt[nt[0].identifier]=!0,[nt,nt];var Vr,Mn,Ri=Y(K.changedTouches),Pa=[],oo=this.target;if(Mn=nt.filter(function(Ua){return Rt(Ua.target,oo)}),Me===si)for(Vr=0;Vr<Mn.length;)Jt[Mn[Vr].identifier]=!0,Vr++;for(Vr=0;Vr<Ri.length;)Jt[Ri[Vr].identifier]&&Pa.push(Ri[Vr]),Me&(vn|Ai)&&delete Jt[Ri[Vr].identifier],Vr++;if(!!Pa.length)return[Le(Mn.concat(Pa),"identifier",!0),Pa]}var dt=2500,re=25;function br(){fe.apply(this,arguments);var K=Fr(this.handler,this);this.touch=new be(this.manager,K),this.mouse=new $i(this.manager,K),this.primaryTouch=null,this.lastTouches=[]}yt(br,fe,{handler:function(Me,nt,Jt){var Vr=Jt.pointerType==Qr,Mn=Jt.pointerType==jn;if(!(Mn&&Jt.sourceCapabilities&&Jt.sourceCapabilities.firesTouchEvents)){if(Vr)yn.call(this,nt,Jt);else if(Mn&&Qt.call(this,Jt))return;this.callback(Me,nt,Jt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function yn(K,Me){K&si?(this.primaryTouch=Me.changedPointers[0].identifier,ln.call(this,Me)):K&(vn|Ai)&&ln.call(this,Me)}function ln(K){var Me=K.changedPointers[0];if(Me.identifier===this.primaryTouch){var nt={x:Me.clientX,y:Me.clientY};this.lastTouches.push(nt);var Jt=this.lastTouches,Vr=function(){var Mn=Jt.indexOf(nt);Mn>-1&&Jt.splice(Mn,1)};setTimeout(Vr,dt)}}function Qt(K){for(var Me=K.srcEvent.clientX,nt=K.srcEvent.clientY,Jt=0;Jt<this.lastTouches.length;Jt++){var Vr=this.lastTouches[Jt],Mn=Math.abs(Me-Vr.x),Ri=Math.abs(nt-Vr.y);if(Mn<=re&&Ri<=re)return!0}return!1}var en=O(ae.style,"touchAction"),Gr=en!==U,Yr="compute",li="auto",qr="manipulation",hi="none",Bi="pan-x",ci="pan-y",_i=Ui();function xi(K,Me){this.manager=K,this.set(Me)}xi.prototype={set:function(K){K==Yr&&(K=this.compute()),Gr&&this.manager.element.style&&_i[K]&&(this.manager.element.style[en]=K),this.actions=K.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var K=[];return er(this.manager.recognizers,function(Me){mr(Me.options.enable,[Me])&&(K=K.concat(Me.getTouchAction()))}),ao(K.join(" "))},preventDefaults:function(K){var Me=K.srcEvent,nt=K.offsetDirection;if(this.manager.session.prevented){Me.preventDefault();return}var Jt=this.actions,Vr=ft(Jt,hi)&&!_i[hi],Mn=ft(Jt,ci)&&!_i[ci],Ri=ft(Jt,Bi)&&!_i[Bi];if(Vr){var Pa=K.pointers.length===1,oo=K.distance<2,Ua=K.deltaTime<250;if(Pa&&oo&&Ua)return}if(!(Ri&&Mn)&&(Vr||Mn&&nt&Hi||Ri&&nt&Ya))return this.preventSrc(Me)},preventSrc:function(K){this.manager.session.prevented=!0,K.preventDefault()}};function ao(K){if(ft(K,hi))return hi;var Me=ft(K,Bi),nt=ft(K,ci);return Me&&nt?hi:Me||nt?Me?Bi:ci:ft(K,qr)?qr:li}function Ui(){if(!Gr)return!1;var K={},Me=Q.CSS&&Q.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(nt){K[nt]=Me?Q.CSS.supports("touch-action",nt):!0}),K}var aa=1,bi=2,fi=4,vi=8,fa=vi,ms=16,Ki=32;function ha(K){this.options=ir({},this.defaults,K||{}),this.id=Ae(),this.manager=null,this.options.enable=lr(this.options.enable,!0),this.state=aa,this.simultaneous={},this.requireFail=[]}ha.prototype={defaults:{},set:function(K){return ir(this.options,K),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(K){if(Pt(K,"recognizeWith",this))return this;var Me=this.simultaneous;return K=oa(K,this),Me[K.id]||(Me[K.id]=K,K.recognizeWith(this)),this},dropRecognizeWith:function(K){return Pt(K,"dropRecognizeWith",this)?this:(K=oa(K,this),delete this.simultaneous[K.id],this)},requireFailure:function(K){if(Pt(K,"requireFailure",this))return this;var Me=this.requireFail;return K=oa(K,this),xr(Me,K)===-1&&(Me.push(K),K.requireFailure(this)),this},dropRequireFailure:function(K){if(Pt(K,"dropRequireFailure",this))return this;K=oa(K,this);var Me=xr(this.requireFail,K);return Me>-1&&this.requireFail.splice(Me,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(K){return!!this.simultaneous[K.id]},emit:function(K){var Me=this,nt=this.state;function Jt(Vr){Me.manager.emit(Vr,K)}nt<vi&&Jt(Me.options.event+Su(nt)),Jt(Me.options.event),K.additionalEvent&&Jt(K.additionalEvent),nt>=vi&&Jt(Me.options.event+Su(nt))},tryEmit:function(K){if(this.canEmit())return this.emit(K);this.state=Ki},canEmit:function(){for(var K=0;K<this.requireFail.length;){if(!(this.requireFail[K].state&(Ki|aa)))return!1;K++}return!0},recognize:function(K){var Me=ir({},K);if(!mr(this.options.enable,[this,Me])){this.reset(),this.state=Ki;return}this.state&(fa|ms|Ki)&&(this.state=aa),this.state=this.process(Me),this.state&(bi|fi|vi|ms)&&this.tryEmit(Me)},process:function(K){},getTouchAction:function(){},reset:function(){}};function Su(K){return K&ms?"cancel":K&vi?"end":K&fi?"move":K&bi?"start":""}function wu(K){return K==ho?"down":K==Dn?"up":K==Ti?"left":K==Gn?"right":""}function oa(K,Me){var nt=Me.manager;return nt?nt.get(K):K}function vo(){ha.apply(this,arguments)}yt(vo,ha,{defaults:{pointers:1},attrTest:function(K){var Me=this.options.pointers;return Me===0||K.pointers.length===Me},process:function(K){var Me=this.state,nt=K.eventType,Jt=Me&(bi|fi),Vr=this.attrTest(K);return Jt&&(nt&Ai||!Vr)?Me|ms:Jt||Vr?nt&vn?Me|vi:Me&bi?Me|fi:bi:Ki}});function Hn(){vo.apply(this,arguments),this.pX=null,this.pY=null}yt(Hn,vo,{defaults:{event:"pan",threshold:10,pointers:1,direction:kt},getTouchAction:function(){var K=this.options.direction,Me=[];return K&Hi&&Me.push(ci),K&Ya&&Me.push(Bi),Me},directionTest:function(K){var Me=this.options,nt=!0,Jt=K.distance,Vr=K.direction,Mn=K.deltaX,Ri=K.deltaY;return Vr&Me.direction||(Me.direction&Hi?(Vr=Mn===0?Ii:Mn<0?Ti:Gn,nt=Mn!=this.pX,Jt=Math.abs(K.deltaX)):(Vr=Ri===0?Ii:Ri<0?Dn:ho,nt=Ri!=this.pY,Jt=Math.abs(K.deltaY))),K.direction=Vr,nt&&Jt>Me.threshold&&Vr&Me.direction},attrTest:function(K){return vo.prototype.attrTest.call(this,K)&&(this.state&bi||!(this.state&bi)&&this.directionTest(K))},emit:function(K){this.pX=K.deltaX,this.pY=K.deltaY;var Me=wu(K.direction);Me&&(K.additionalEvent=this.options.event+Me),this._super.emit.call(this,K)}});function ra(){vo.apply(this,arguments)}yt(ra,vo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[hi]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.scale-1)>this.options.threshold||this.state&bi)},emit:function(K){if(K.scale!==1){var Me=K.scale<1?"in":"out";K.additionalEvent=this.options.event+Me}this._super.emit.call(this,K)}});function Ea(){ha.apply(this,arguments),this._timer=null,this._input=null}yt(Ea,ha,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[li]},process:function(K){var Me=this.options,nt=K.pointers.length===Me.pointers,Jt=K.distance<Me.threshold,Vr=K.deltaTime>Me.time;if(this._input=K,!Jt||!nt||K.eventType&(vn|Ai)&&!Vr)this.reset();else if(K.eventType&si)this.reset(),this._timer=ct(function(){this.state=fa,this.tryEmit()},Me.time,this);else if(K.eventType&vn)return fa;return Ki},reset:function(){clearTimeout(this._timer)},emit:function(K){this.state===fa&&(K&&K.eventType&vn?this.manager.emit(this.options.event+"up",K):(this._input.timeStamp=rt(),this.manager.emit(this.options.event,this._input)))}});function zi(){vo.apply(this,arguments)}yt(zi,vo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[hi]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.rotation)>this.options.threshold||this.state&bi)}});function To(){vo.apply(this,arguments)}yt(To,vo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Hi|Ya,pointers:1},getTouchAction:function(){return Hn.prototype.getTouchAction.call(this)},attrTest:function(K){var Me=this.options.direction,nt;return Me&(Hi|Ya)?nt=K.overallVelocity:Me&Hi?nt=K.overallVelocityX:Me&Ya&&(nt=K.overallVelocityY),this._super.attrTest.call(this,K)&&Me&K.offsetDirection&&K.distance>this.options.threshold&&K.maxPointers==this.options.pointers&&je(nt)>this.options.velocity&&K.eventType&vn},emit:function(K){var Me=wu(K.offsetDirection);Me&&this.manager.emit(this.options.event+Me,K),this.manager.emit(this.options.event,K)}});function mo(){ha.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}yt(mo,ha,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[qr]},process:function(K){var Me=this.options,nt=K.pointers.length===Me.pointers,Jt=K.distance<Me.threshold,Vr=K.deltaTime<Me.time;if(this.reset(),K.eventType&si&&this.count===0)return this.failTimeout();if(Jt&&Vr&&nt){if(K.eventType!=vn)return this.failTimeout();var Mn=this.pTime?K.timeStamp-this.pTime<Me.interval:!0,Ri=!this.pCenter||mn(this.pCenter,K.center)<Me.posThreshold;this.pTime=K.timeStamp,this.pCenter=K.center,!Ri||!Mn?this.count=1:this.count+=1,this._input=K;var Pa=this.count%Me.taps;if(Pa===0)return this.hasRequireFailures()?(this._timer=ct(function(){this.state=fa,this.tryEmit()},Me.interval,this),bi):fa}return Ki},failTimeout:function(){return this._timer=ct(function(){this.state=Ki},this.options.interval,this),Ki},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==fa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ds(K,Me){return Me=Me||{},Me.recognizers=lr(Me.recognizers,Ds.defaults.preset),new Xo(K,Me)}Ds.VERSION="2.0.7",Ds.defaults={domEvents:!1,touchAction:Yr,enable:!0,inputTarget:null,inputClass:null,preset:[[zi,{enable:!1}],[ra,{enable:!1},["rotate"]],[To,{direction:Hi}],[Hn,{direction:Hi},["swipe"]],[mo],[mo,{event:"doubletap",taps:2},["tap"]],[Ea]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var is=1,Fl=2;function Xo(K,Me){this.options=ir({},Ds.defaults,Me||{}),this.options.inputTarget=this.options.inputTarget||K,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=K,this.input=Ze(this),this.touchAction=new xi(this,this.options.touchAction),la(this,!0),er(this.options.recognizers,function(nt){var Jt=this.add(new nt[0](nt[1]));nt[2]&&Jt.recognizeWith(nt[2]),nt[3]&&Jt.requireFailure(nt[3])},this)}Xo.prototype={set:function(K){return ir(this.options,K),K.touchAction&&this.touchAction.update(),K.inputTarget&&(this.input.destroy(),this.input.target=K.inputTarget,this.input.init()),this},stop:function(K){this.session.stopped=K?Fl:is},recognize:function(K){var Me=this.session;if(!Me.stopped){this.touchAction.preventDefaults(K);var nt,Jt=this.recognizers,Vr=Me.curRecognizer;(!Vr||Vr&&Vr.state&fa)&&(Vr=Me.curRecognizer=null);for(var Mn=0;Mn<Jt.length;)nt=Jt[Mn],Me.stopped!==Fl&&(!Vr||nt==Vr||nt.canRecognizeWith(Vr))?nt.recognize(K):nt.reset(),!Vr&&nt.state&(bi|fi|vi)&&(Vr=Me.curRecognizer=nt),Mn++}},get:function(K){if(K instanceof ha)return K;for(var Me=this.recognizers,nt=0;nt<Me.length;nt++)if(Me[nt].options.event==K)return Me[nt];return null},add:function(K){if(Pt(K,"add",this))return this;var Me=this.get(K.options.event);return Me&&this.remove(Me),this.recognizers.push(K),K.manager=this,this.touchAction.update(),K},remove:function(K){if(Pt(K,"remove",this))return this;if(K=this.get(K),K){var Me=this.recognizers,nt=xr(Me,K);nt!==-1&&(Me.splice(nt,1),this.touchAction.update())}return this},on:function(K,Me){if(K!==U&&Me!==U){var nt=this.handlers;return er(Kt(K),function(Jt){nt[Jt]=nt[Jt]||[],nt[Jt].push(Me)}),this}},off:function(K,Me){if(K!==U){var nt=this.handlers;return er(Kt(K),function(Jt){Me?nt[Jt]&&nt[Jt].splice(xr(nt[Jt],Me),1):delete nt[Jt]}),this}},emit:function(K,Me){this.options.domEvents&&ga(K,Me);var nt=this.handlers[K]&&this.handlers[K].slice();if(!(!nt||!nt.length)){Me.type=K,Me.preventDefault=function(){Me.srcEvent.preventDefault()};for(var Jt=0;Jt<nt.length;)nt[Jt](Me),Jt++}},destroy:function(){this.element&&la(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function la(K,Me){var nt=K.element;if(!!nt.style){var Jt;er(K.options.cssProps,function(Vr,Mn){Jt=O(nt.style,Mn),Me?(K.oldCssProps[Jt]=nt.style[Jt],nt.style[Jt]=Vr):nt.style[Jt]=K.oldCssProps[Jt]||""}),Me||(K.oldCssProps={})}}function ga(K,Me){var nt=y.createEvent("Event");nt.initEvent(K,!0,!0),nt.gesture=Me,Me.target.dispatchEvent(nt)}ir(Ds,{INPUT_START:si,INPUT_MOVE:Xn,INPUT_END:vn,INPUT_CANCEL:Ai,STATE_POSSIBLE:aa,STATE_BEGAN:bi,STATE_CHANGED:fi,STATE_ENDED:vi,STATE_RECOGNIZED:fa,STATE_CANCELLED:ms,STATE_FAILED:Ki,DIRECTION_NONE:Ii,DIRECTION_LEFT:Ti,DIRECTION_RIGHT:Gn,DIRECTION_UP:Dn,DIRECTION_DOWN:ho,DIRECTION_HORIZONTAL:Hi,DIRECTION_VERTICAL:Ya,DIRECTION_ALL:kt,Manager:Xo,Input:fe,TouchAction:xi,TouchInput:be,MouseInput:$i,PointerEventInput:X,TouchMouseInput:br,SingleTouchInput:Ke,Recognizer:ha,AttrRecognizer:vo,Tap:mo,Pan:Hn,Swipe:To,Pinch:ra,Rotate:zi,Press:Ea,on:xt,off:at,each:er,merge:Ct,extend:tr,assign:ir,inherit:yt,bindFn:Fr,prefixed:O});var cr=typeof Q!="undefined"?Q:typeof self!="undefined"?self:{};cr.Hammer=Ds,_e=function(){return Ds}.call(ee,z,ee,wr),_e!==U&&(wr.exports=_e)})(window,document,"Hammer")},80645:function(wr,ee){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ee.read=function(z,_e,Q,y,se){var U,ce,ae=se*8-y-1,Ge=(1<<ae)-1,oe=Ge>>1,je=-7,rt=Q?se-1:0,ct=Q?-1:1,Pt=z[_e+rt];for(rt+=ct,U=Pt&(1<<-je)-1,Pt>>=-je,je+=ae;je>0;U=U*256+z[_e+rt],rt+=ct,je-=8);for(ce=U&(1<<-je)-1,U>>=-je,je+=y;je>0;ce=ce*256+z[_e+rt],rt+=ct,je-=8);if(U===0)U=1-oe;else{if(U===Ge)return ce?NaN:(Pt?-1:1)*Infinity;ce=ce+Math.pow(2,y),U=U-oe}return(Pt?-1:1)*ce*Math.pow(2,U-y)},ee.write=function(z,_e,Q,y,se,U){var ce,ae,Ge,oe=U*8-se-1,je=(1<<oe)-1,rt=je>>1,ct=se===23?Math.pow(2,-24)-Math.pow(2,-77):0,Pt=y?0:U-1,er=y?1:-1,qt=_e<0||_e===0&&1/_e<0?1:0;for(_e=Math.abs(_e),isNaN(_e)||_e===Infinity?(ae=isNaN(_e)?1:0,ce=je):(ce=Math.floor(Math.log(_e)/Math.LN2),_e*(Ge=Math.pow(2,-ce))<1&&(ce--,Ge*=2),ce+rt>=1?_e+=ct/Ge:_e+=ct*Math.pow(2,1-rt),_e*Ge>=2&&(ce++,Ge/=2),ce+rt>=je?(ae=0,ce=je):ce+rt>=1?(ae=(_e*Ge-1)*Math.pow(2,se),ce=ce+rt):(ae=_e*Math.pow(2,rt-1)*Math.pow(2,se),ce=0));se>=8;z[Q+Pt]=ae&255,Pt+=er,ae/=256,se-=8);for(ce=ce<<se|ae,oe+=se;oe>0;z[Q+Pt]=ce&255,Pt+=er,ce/=256,oe-=8);z[Q+Pt-er]|=qt*128}},7375:function(wr,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0});var z=Symbol.for("INJECTION");function _e(ce,ae,Ge,oe){function je(){return oe&&!Reflect.hasMetadata(z,this,ae)&&Reflect.defineMetadata(z,Ge(),this,ae),Reflect.hasMetadata(z,this,ae)?Reflect.getMetadata(z,this,ae):Ge()}function rt(ct){Reflect.defineMetadata(z,ct,this,ae)}Object.defineProperty(ce,ae,{configurable:!0,enumerable:!0,get:je,set:rt})}function Q(ce,ae){return function(Ge){return function(oe,je){var rt=function(){return ce.get(Ge)};_e(oe,je,rt,ae)}}}ee.makePropertyInjectDecorator=Q;function y(ce,ae){return function(Ge,oe){return function(je,rt){var ct=function(){return ce.getNamed(Ge,oe)};_e(je,rt,ct,ae)}}}ee.makePropertyInjectNamedDecorator=y;function se(ce,ae){return function(Ge,oe,je){return function(rt,ct){var Pt=function(){return ce.getTagged(Ge,oe,je)};_e(rt,ct,Pt,ae)}}}ee.makePropertyInjectTaggedDecorator=se;function U(ce,ae){return function(Ge){return function(oe,je){var rt=function(){return ce.getAll(Ge)};_e(oe,je,rt,ae)}}}ee.makePropertyMultiInjectDecorator=U},84879:function(wr,ee,z){"use strict";var _e;_e={value:!0};var Q=z(7375);function y(se,U){U===void 0&&(U=!0);var ce=Q.makePropertyInjectDecorator(se,U),ae=Q.makePropertyInjectNamedDecorator(se,U),Ge=Q.makePropertyInjectTaggedDecorator(se,U),oe=Q.makePropertyMultiInjectDecorator(se,U);return{lazyInject:ce,lazyInjectNamed:ae,lazyInjectTagged:Ge,lazyMultiInject:oe}}ee.Z=y},99934:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.tagProperty=ee.tagParameter=ee.decorate=void 0;var _e=z(16674),Q=z(6867);function y(oe,je,rt,ct){var Pt=Q.TAGGED;U(Pt,oe,je,ct,rt)}ee.tagParameter=y;function se(oe,je,rt){var ct=Q.TAGGED_PROP;U(ct,oe.constructor,je,rt)}ee.tagProperty=se;function U(oe,je,rt,ct,Pt){var er={},qt=typeof Pt=="number",ir=Pt!==void 0&&qt?Pt.toString():rt;if(qt&&rt!==void 0)throw new Error(_e.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(oe,je)&&(er=Reflect.getMetadata(oe,je));var tr=er[ir];if(!Array.isArray(tr))tr=[];else for(var Ct=0,yt=tr;Ct<yt.length;Ct++){var Fr=yt[Ct];if(Fr.key===ct.key)throw new Error(_e.DUPLICATED_METADATA+" "+Fr.key.toString())}tr.push(ct),er[ir]=tr,Reflect.defineMetadata(oe,er,je)}function ce(oe,je){Reflect.decorate(oe,je)}function ae(oe,je){return function(rt,ct){je(rt,ct,oe)}}function Ge(oe,je,rt){typeof rt=="number"?ce([ae(rt,oe)],je):typeof rt=="string"?Reflect.decorate([oe],je,rt):ce([oe],je)}ee.decorate=Ge},5744:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.inject=ee.LazyServiceIdentifer=void 0;var _e=z(16674),Q=z(6867),y=z(47738),se=z(99934),U=function(){function ae(Ge){this._cb=Ge}return ae.prototype.unwrap=function(){return this._cb()},ae}();ee.LazyServiceIdentifer=U;function ce(ae){return function(Ge,oe,je){if(ae===void 0)throw new Error(_e.UNDEFINED_INJECT_ANNOTATION(Ge.name));var rt=new y.Metadata(Q.INJECT_TAG,ae);typeof je=="number"?se.tagParameter(Ge,oe,je,rt):se.tagProperty(Ge,oe,rt)}}ee.inject=ce},64315:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.injectable=void 0;var _e=z(16674),Q=z(6867);function y(){return function(se){if(Reflect.hasOwnMetadata(Q.PARAM_TYPES,se))throw new Error(_e.DUPLICATED_INJECTABLE_DECORATOR);var U=Reflect.getMetadata(Q.DESIGN_PARAM_TYPES,se)||[];return Reflect.defineMetadata(Q.PARAM_TYPES,U,se),se}}ee.injectable=y},71693:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.multiInject=void 0;var _e=z(6867),Q=z(47738),y=z(99934);function se(U){return function(ce,ae,Ge){var oe=new Q.Metadata(_e.MULTI_INJECT_TAG,U);typeof Ge=="number"?y.tagParameter(ce,ae,Ge,oe):y.tagProperty(ce,ae,oe)}}ee.multiInject=se},38085:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.named=void 0;var _e=z(6867),Q=z(47738),y=z(99934);function se(U){return function(ce,ae,Ge){var oe=new Q.Metadata(_e.NAMED_TAG,U);typeof Ge=="number"?y.tagParameter(ce,ae,Ge,oe):y.tagProperty(ce,ae,oe)}}ee.named=se},6515:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.optional=void 0;var _e=z(6867),Q=z(47738),y=z(99934);function se(){return function(U,ce,ae){var Ge=new Q.Metadata(_e.OPTIONAL_TAG,!0);typeof ae=="number"?y.tagParameter(U,ce,ae,Ge):y.tagProperty(U,ce,Ge)}}ee.optional=se},7014:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.postConstruct=void 0;var _e=z(16674),Q=z(6867),y=z(47738);function se(){return function(U,ce,ae){var Ge=new y.Metadata(Q.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(Q.POST_CONSTRUCT,U.constructor))throw new Error(_e.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(Q.POST_CONSTRUCT,Ge,U.constructor)}}ee.postConstruct=se},32052:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.tagged=void 0;var _e=z(47738),Q=z(99934);function y(se,U){return function(ce,ae,Ge){var oe=new _e.Metadata(se,U);typeof Ge=="number"?Q.tagParameter(ce,ae,Ge,oe):Q.tagProperty(ce,ae,oe)}}ee.tagged=y},55638:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.targetName=void 0;var _e=z(6867),Q=z(47738),y=z(99934);function se(U){return function(ce,ae,Ge){var oe=new Q.Metadata(_e.NAME_TAG,U);y.tagParameter(ce,ae,Ge,oe)}}ee.targetName=se},86757:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.unmanaged=void 0;var _e=z(6867),Q=z(47738),y=z(99934);function se(){return function(U,ce,ae){var Ge=new Q.Metadata(_e.UNMANAGED_TAG,!0);y.tagParameter(U,ce,ae,Ge)}}ee.unmanaged=se},44290:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Binding=void 0;var _e=z(28421),Q=z(37791),y=function(){function se(U,ce){this.id=Q.id(),this.activated=!1,this.serviceIdentifier=U,this.scope=ce,this.type=_e.BindingTypeEnum.Invalid,this.constraint=function(ae){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return se.prototype.clone=function(){var U=new se(this.serviceIdentifier,this.scope);return U.activated=U.scope===_e.BindingScopeEnum.Singleton?this.activated:!1,U.implementationType=this.implementationType,U.dynamicValue=this.dynamicValue,U.scope=this.scope,U.type=this.type,U.factory=this.factory,U.provider=this.provider,U.constraint=this.constraint,U.onActivation=this.onActivation,U.cache=this.cache,U},se}();ee.Binding=y},23184:function(wr,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingCount=void 0;var z={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ee.BindingCount=z},16674:function(wr,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.STACK_OVERFLOW=ee.CIRCULAR_DEPENDENCY_IN_FACTORY=ee.POST_CONSTRUCT_ERROR=ee.MULTIPLE_POST_CONSTRUCT_METHODS=ee.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ee.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ee.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ee.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ee.ARGUMENTS_LENGTH_MISMATCH=ee.INVALID_DECORATOR_OPERATION=ee.INVALID_TO_SELF_VALUE=ee.INVALID_FUNCTION_BINDING=ee.INVALID_MIDDLEWARE_RETURN=ee.NO_MORE_SNAPSHOTS_AVAILABLE=ee.INVALID_BINDING_TYPE=ee.NOT_IMPLEMENTED=ee.CIRCULAR_DEPENDENCY=ee.UNDEFINED_INJECT_ANNOTATION=ee.MISSING_INJECT_ANNOTATION=ee.MISSING_INJECTABLE_ANNOTATION=ee.NOT_REGISTERED=ee.CANNOT_UNBIND=ee.AMBIGUOUS_MATCH=ee.KEY_NOT_FOUND=ee.NULL_ARGUMENT=ee.DUPLICATED_METADATA=ee.DUPLICATED_INJECTABLE_DECORATOR=void 0,ee.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ee.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ee.NULL_ARGUMENT="NULL argument",ee.KEY_NOT_FOUND="Key Not Found",ee.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ee.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ee.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ee.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ee.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var z=function(se){return"@inject called with undefined this could mean that the class "+se+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ee.UNDEFINED_INJECT_ANNOTATION=z,ee.CIRCULAR_DEPENDENCY="Circular dependency found:",ee.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ee.INVALID_BINDING_TYPE="Invalid binding type:",ee.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ee.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ee.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ee.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ee.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var _e=function(){for(var se=[],U=0;U<arguments.length;U++)se[U]=arguments[U];return"The number of constructor arguments in the derived class "+(se[0]+" must be >= than the number of constructor arguments of its base class.")};ee.ARGUMENTS_LENGTH_MISMATCH=_e,ee.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ee.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ee.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ee.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ee.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var Q=function(){for(var se=[],U=0;U<arguments.length;U++)se[U]=arguments[U];return"@postConstruct error in class "+se[0]+": "+se[1]};ee.POST_CONSTRUCT_ERROR=Q;var y=function(){for(var se=[],U=0;U<arguments.length;U++)se[U]=arguments[U];return"It looks like there is a circular dependency "+("in one of the '"+se[0]+"' bindings. Please investigate bindings with")+("service identifier '"+se[1]+"'.")};ee.CIRCULAR_DEPENDENCY_IN_FACTORY=y,ee.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(wr,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.TargetTypeEnum=ee.BindingTypeEnum=ee.BindingScopeEnum=void 0;var z={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ee.BindingScopeEnum=z;var _e={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ee.BindingTypeEnum=_e;var Q={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ee.TargetTypeEnum=Q},6867:function(wr,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.NON_CUSTOM_TAG_KEYS=ee.POST_CONSTRUCT=ee.DESIGN_PARAM_TYPES=ee.PARAM_TYPES=ee.TAGGED_PROP=ee.TAGGED=ee.MULTI_INJECT_TAG=ee.INJECT_TAG=ee.OPTIONAL_TAG=ee.UNMANAGED_TAG=ee.NAME_TAG=ee.NAMED_TAG=void 0,ee.NAMED_TAG="named",ee.NAME_TAG="name",ee.UNMANAGED_TAG="unmanaged",ee.OPTIONAL_TAG="optional",ee.INJECT_TAG="inject",ee.MULTI_INJECT_TAG="multi_inject",ee.TAGGED="inversify:tagged",ee.TAGGED_PROP="inversify:tagged_props",ee.PARAM_TYPES="inversify:paramtypes",ee.DESIGN_PARAM_TYPES="design:paramtypes",ee.POST_CONSTRUCT="post_construct";function z(){return[ee.INJECT_TAG,ee.MULTI_INJECT_TAG,ee.NAME_TAG,ee.UNMANAGED_TAG,ee.NAMED_TAG,ee.OPTIONAL_TAG]}ee.NON_CUSTOM_TAG_KEYS=z()},51389:function(wr,ee,z){"use strict";var _e=this&&this.__awaiter||function(tr,Ct,yt,Fr){function mr(lr){return lr instanceof yt?lr:new yt(function(xt){xt(lr)})}return new(yt||(yt=Promise))(function(lr,xt){function at(Kt){try{ft(Fr.next(Kt))}catch(xr){xt(xr)}}function Rt(Kt){try{ft(Fr.throw(Kt))}catch(xr){xt(xr)}}function ft(Kt){Kt.done?lr(Kt.value):mr(Kt.value).then(at,Rt)}ft((Fr=Fr.apply(tr,Ct||[])).next())})},Q=this&&this.__generator||function(tr,Ct){var yt={label:0,sent:function(){if(lr[0]&1)throw lr[1];return lr[1]},trys:[],ops:[]},Fr,mr,lr,xt;return xt={next:at(0),throw:at(1),return:at(2)},typeof Symbol=="function"&&(xt[Symbol.iterator]=function(){return this}),xt;function at(ft){return function(Kt){return Rt([ft,Kt])}}function Rt(ft){if(Fr)throw new TypeError("Generator is already executing.");for(;yt;)try{if(Fr=1,mr&&(lr=ft[0]&2?mr.return:ft[0]?mr.throw||((lr=mr.return)&&lr.call(mr),0):mr.next)&&!(lr=lr.call(mr,ft[1])).done)return lr;switch(mr=0,lr&&(ft=[ft[0]&2,lr.value]),ft[0]){case 0:case 1:lr=ft;break;case 4:return yt.label++,{value:ft[1],done:!1};case 5:yt.label++,mr=ft[1],ft=[0];continue;case 7:ft=yt.ops.pop(),yt.trys.pop();continue;default:if(lr=yt.trys,!(lr=lr.length>0&&lr[lr.length-1])&&(ft[0]===6||ft[0]===2)){yt=0;continue}if(ft[0]===3&&(!lr||ft[1]>lr[0]&&ft[1]<lr[3])){yt.label=ft[1];break}if(ft[0]===6&&yt.label<lr[1]){yt.label=lr[1],lr=ft;break}if(lr&&yt.label<lr[2]){yt.label=lr[2],yt.ops.push(ft);break}lr[2]&&yt.ops.pop(),yt.trys.pop();continue}ft=Ct.call(tr,yt)}catch(Kt){ft=[6,Kt],mr=0}finally{Fr=lr=0}if(ft[0]&5)throw ft[1];return{value:ft[0]?ft[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(tr,Ct){for(var yt=0,Fr=Ct.length,mr=tr.length;yt<Fr;yt++,mr++)tr[mr]=Ct[yt];return tr};Object.defineProperty(ee,"__esModule",{value:!0}),ee.Container=void 0;var se=z(44290),U=z(16674),ce=z(28421),ae=z(6867),Ge=z(51377),oe=z(86311),je=z(31927),rt=z(15451),ct=z(37791),Pt=z(55800),er=z(85700),qt=z(80175),ir=function(){function tr(Ct){this._appliedMiddleware=[];var yt=Ct||{};if(typeof yt!="object")throw new Error(""+U.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(yt.defaultScope===void 0)yt.defaultScope=ce.BindingScopeEnum.Transient;else if(yt.defaultScope!==ce.BindingScopeEnum.Singleton&&yt.defaultScope!==ce.BindingScopeEnum.Transient&&yt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+U.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(yt.autoBindInjectable===void 0)yt.autoBindInjectable=!1;else if(typeof yt.autoBindInjectable!="boolean")throw new Error(""+U.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(yt.skipBaseClassChecks===void 0)yt.skipBaseClassChecks=!1;else if(typeof yt.skipBaseClassChecks!="boolean")throw new Error(""+U.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:yt.autoBindInjectable,defaultScope:yt.defaultScope,skipBaseClassChecks:yt.skipBaseClassChecks},this.id=ct.id(),this._bindingDictionary=new qt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ge.MetadataReader}return tr.merge=function(Ct,yt){for(var Fr=[],mr=2;mr<arguments.length;mr++)Fr[mr-2]=arguments[mr];var lr=new tr,xt=y([Ct,yt],Fr).map(function(ft){return oe.getBindingDictionary(ft)}),at=oe.getBindingDictionary(lr);function Rt(ft,Kt){ft.traverse(function(xr,Y){Y.forEach(function(Le){Kt.add(Le.serviceIdentifier,Le.clone())})})}return xt.forEach(function(ft){Rt(ft,at)}),lr},tr.prototype.load=function(){for(var Ct=[],yt=0;yt<arguments.length;yt++)Ct[yt]=arguments[yt];for(var Fr=this._getContainerModuleHelpersFactory(),mr=0,lr=Ct;mr<lr.length;mr++){var xt=lr[mr],at=Fr(xt.id);xt.registry(at.bindFunction,at.unbindFunction,at.isboundFunction,at.rebindFunction)}},tr.prototype.loadAsync=function(){for(var Ct=[],yt=0;yt<arguments.length;yt++)Ct[yt]=arguments[yt];return _e(this,void 0,void 0,function(){var Fr,mr,lr,xt,at;return Q(this,function(Rt){switch(Rt.label){case 0:Fr=this._getContainerModuleHelpersFactory(),mr=0,lr=Ct,Rt.label=1;case 1:return mr<lr.length?(xt=lr[mr],at=Fr(xt.id),[4,xt.registry(at.bindFunction,at.unbindFunction,at.isboundFunction,at.rebindFunction)]):[3,4];case 2:Rt.sent(),Rt.label=3;case 3:return mr++,[3,1];case 4:return[2]}})})},tr.prototype.unload=function(){for(var Ct=this,yt=[],Fr=0;Fr<arguments.length;Fr++)yt[Fr]=arguments[Fr];var mr=function(lr){return function(xt){return xt.moduleId===lr}};yt.forEach(function(lr){var xt=mr(lr.id);Ct._bindingDictionary.removeByCondition(xt)})},tr.prototype.bind=function(Ct){var yt=this.options.defaultScope||ce.BindingScopeEnum.Transient,Fr=new se.Binding(Ct,yt);return this._bindingDictionary.add(Ct,Fr),new rt.BindingToSyntax(Fr)},tr.prototype.rebind=function(Ct){return this.unbind(Ct),this.bind(Ct)},tr.prototype.unbind=function(Ct){try{this._bindingDictionary.remove(Ct)}catch(yt){throw new Error(U.CANNOT_UNBIND+" "+Pt.getServiceIdentifierAsString(Ct))}},tr.prototype.unbindAll=function(){this._bindingDictionary=new qt.Lookup},tr.prototype.isBound=function(Ct){var yt=this._bindingDictionary.hasKey(Ct);return!yt&&this.parent&&(yt=this.parent.isBound(Ct)),yt},tr.prototype.isBoundNamed=function(Ct,yt){return this.isBoundTagged(Ct,ae.NAMED_TAG,yt)},tr.prototype.isBoundTagged=function(Ct,yt,Fr){var mr=!1;if(this._bindingDictionary.hasKey(Ct)){var lr=this._bindingDictionary.get(Ct),xt=oe.createMockRequest(this,Ct,yt,Fr);mr=lr.some(function(at){return at.constraint(xt)})}return!mr&&this.parent&&(mr=this.parent.isBoundTagged(Ct,yt,Fr)),mr},tr.prototype.snapshot=function(){this._snapshots.push(er.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},tr.prototype.restore=function(){var Ct=this._snapshots.pop();if(Ct===void 0)throw new Error(U.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Ct.bindings,this._middleware=Ct.middleware},tr.prototype.createChild=function(Ct){var yt=new tr(Ct||this.options);return yt.parent=this,yt},tr.prototype.applyMiddleware=function(){for(var Ct=[],yt=0;yt<arguments.length;yt++)Ct[yt]=arguments[yt];this._appliedMiddleware=this._appliedMiddleware.concat(Ct);var Fr=this._middleware?this._middleware:this._planAndResolve();this._middleware=Ct.reduce(function(mr,lr){return lr(mr)},Fr)},tr.prototype.applyCustomMetadataReader=function(Ct){this._metadataReader=Ct},tr.prototype.get=function(Ct){return this._get(!1,!1,ce.TargetTypeEnum.Variable,Ct)},tr.prototype.getTagged=function(Ct,yt,Fr){return this._get(!1,!1,ce.TargetTypeEnum.Variable,Ct,yt,Fr)},tr.prototype.getNamed=function(Ct,yt){return this.getTagged(Ct,ae.NAMED_TAG,yt)},tr.prototype.getAll=function(Ct){return this._get(!0,!0,ce.TargetTypeEnum.Variable,Ct)},tr.prototype.getAllTagged=function(Ct,yt,Fr){return this._get(!1,!0,ce.TargetTypeEnum.Variable,Ct,yt,Fr)},tr.prototype.getAllNamed=function(Ct,yt){return this.getAllTagged(Ct,ae.NAMED_TAG,yt)},tr.prototype.resolve=function(Ct){var yt=this.createChild();return yt.bind(Ct).toSelf(),this._appliedMiddleware.forEach(function(Fr){yt.applyMiddleware(Fr)}),yt.get(Ct)},tr.prototype._getContainerModuleHelpersFactory=function(){var Ct=this,yt=function(at,Rt){at._binding.moduleId=Rt},Fr=function(at){return function(Rt){var ft=Ct.bind.bind(Ct),Kt=ft(Rt);return yt(Kt,at),Kt}},mr=function(at){return function(Rt){var ft=Ct.unbind.bind(Ct);ft(Rt)}},lr=function(at){return function(Rt){var ft=Ct.isBound.bind(Ct);return ft(Rt)}},xt=function(at){return function(Rt){var ft=Ct.rebind.bind(Ct),Kt=ft(Rt);return yt(Kt,at),Kt}};return function(at){return{bindFunction:Fr(at),isboundFunction:lr(at),rebindFunction:xt(at),unbindFunction:mr(at)}}},tr.prototype._get=function(Ct,yt,Fr,mr,lr,xt){var at=null,Rt={avoidConstraints:Ct,contextInterceptor:function(ft){return ft},isMultiInject:yt,key:lr,serviceIdentifier:mr,targetType:Fr,value:xt};if(this._middleware){if(at=this._middleware(Rt),at==null)throw new Error(U.INVALID_MIDDLEWARE_RETURN)}else at=this._planAndResolve()(Rt);return at},tr.prototype._planAndResolve=function(){var Ct=this;return function(yt){var Fr=oe.plan(Ct._metadataReader,Ct,yt.isMultiInject,yt.targetType,yt.serviceIdentifier,yt.key,yt.value,yt.avoidConstraints);Fr=yt.contextInterceptor(Fr);var mr=je.resolve(Fr);return mr}},tr}();ee.Container=ir},33244:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.AsyncContainerModule=ee.ContainerModule=void 0;var _e=z(37791),Q=function(){function se(U){this.id=_e.id(),this.registry=U}return se}();ee.ContainerModule=Q;var y=function(){function se(U){this.id=_e.id(),this.registry=U}return se}();ee.AsyncContainerModule=y},85700:function(wr,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.ContainerSnapshot=void 0;var z=function(){function _e(){}return _e.of=function(Q,y){var se=new _e;return se.bindings=Q,se.middleware=y,se},_e}();ee.ContainerSnapshot=z},80175:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Lookup=void 0;var _e=z(16674),Q=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(se,U){if(se==null)throw new Error(_e.NULL_ARGUMENT);if(U==null)throw new Error(_e.NULL_ARGUMENT);var ce=this._map.get(se);ce!==void 0?(ce.push(U),this._map.set(se,ce)):this._map.set(se,[U])},y.prototype.get=function(se){if(se==null)throw new Error(_e.NULL_ARGUMENT);var U=this._map.get(se);if(U!==void 0)return U;throw new Error(_e.KEY_NOT_FOUND)},y.prototype.remove=function(se){if(se==null)throw new Error(_e.NULL_ARGUMENT);if(!this._map.delete(se))throw new Error(_e.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(se){var U=this;this._map.forEach(function(ce,ae){var Ge=ce.filter(function(oe){return!se(oe)});Ge.length>0?U._map.set(ae,Ge):U._map.delete(ae)})},y.prototype.hasKey=function(se){if(se==null)throw new Error(_e.NULL_ARGUMENT);return this._map.has(se)},y.prototype.clone=function(){var se=new y;return this._map.forEach(function(U,ce){U.forEach(function(ae){return se.add(ce,ae.clone())})}),se},y.prototype.traverse=function(se){this._map.forEach(function(U,ce){se(ce,U)})},y}();ee.Lookup=Q},86700:function(wr,ee,z){"use strict";var _e;_e={value:!0},_e=_e=_e=_e=_e=_e=ee.GW=_e=_e=ee.zY=_e=_e=_e=_e=_e=ee.f3=_e=_e=ee.b2=_e=_e=_e=_e=_e=ee.W2=_e=void 0;var Q=z(6867);_e=Q;var y=z(51389);Object.defineProperty(ee,"W2",{enumerable:!0,get:function(){return y.Container}});var se=z(28421);_e={enumerable:!0,get:function(){return se.BindingScopeEnum}},_e={enumerable:!0,get:function(){return se.BindingTypeEnum}},_e={enumerable:!0,get:function(){return se.TargetTypeEnum}};var U=z(33244);_e={enumerable:!0,get:function(){return U.AsyncContainerModule}},_e={enumerable:!0,get:function(){return U.ContainerModule}};var ce=z(64315);Object.defineProperty(ee,"b2",{enumerable:!0,get:function(){return ce.injectable}});var ae=z(32052);_e={enumerable:!0,get:function(){return ae.tagged}};var Ge=z(38085);_e={enumerable:!0,get:function(){return Ge.named}};var oe=z(5744);Object.defineProperty(ee,"f3",{enumerable:!0,get:function(){return oe.inject}}),_e={enumerable:!0,get:function(){return oe.LazyServiceIdentifer}};var je=z(6515);_e={enumerable:!0,get:function(){return je.optional}};var rt=z(86757);_e={enumerable:!0,get:function(){return rt.unmanaged}};var ct=z(71693);_e={enumerable:!0,get:function(){return ct.multiInject}};var Pt=z(55638);_e={enumerable:!0,get:function(){return Pt.targetName}};var er=z(7014);Object.defineProperty(ee,"zY",{enumerable:!0,get:function(){return er.postConstruct}});var qt=z(51377);_e={enumerable:!0,get:function(){return qt.MetadataReader}};var ir=z(37791);_e={enumerable:!0,get:function(){return ir.id}};var tr=z(99934);Object.defineProperty(ee,"GW",{enumerable:!0,get:function(){return tr.decorate}});var Ct=z(80758);_e={enumerable:!0,get:function(){return Ct.traverseAncerstors}},_e={enumerable:!0,get:function(){return Ct.taggedConstraint}},_e={enumerable:!0,get:function(){return Ct.namedConstraint}},_e={enumerable:!0,get:function(){return Ct.typeConstraint}};var yt=z(55800);_e={enumerable:!0,get:function(){return yt.getServiceIdentifierAsString}};var Fr=z(70600);_e={enumerable:!0,get:function(){return Fr.multiBindToService}}},95228:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Context=void 0;var _e=z(37791),Q=function(){function y(se){this.id=_e.id(),this.container=se}return y.prototype.addPlan=function(se){this.plan=se},y.prototype.setCurrentRequest=function(se){this.currentRequest=se},y}();ee.Context=Q},47738:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Metadata=void 0;var _e=z(6867),Q=function(){function y(se,U){this.key=se,this.value=U}return y.prototype.toString=function(){return this.key===_e.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();ee.Metadata=Q},51377:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.MetadataReader=void 0;var _e=z(6867),Q=function(){function y(){}return y.prototype.getConstructorMetadata=function(se){var U=Reflect.getMetadata(_e.PARAM_TYPES,se),ce=Reflect.getMetadata(_e.TAGGED,se);return{compilerGeneratedMetadata:U,userGeneratedMetadata:ce||{}}},y.prototype.getPropertiesMetadata=function(se){var U=Reflect.getMetadata(_e.TAGGED_PROP,se)||[];return U},y}();ee.MetadataReader=Q},55314:function(wr,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Plan=void 0;var z=function(){function _e(Q,y){this.parentContext=Q,this.rootRequest=y}return _e}();ee.Plan=z},86311:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.getBindingDictionary=ee.createMockRequest=ee.plan=void 0;var _e=z(23184),Q=z(16674),y=z(28421),se=z(6867),U=z(85265),ce=z(55800),ae=z(95228),Ge=z(47738),oe=z(55314),je=z(6e3),rt=z(6748),ct=z(18924);function Pt(mr){return mr._bindingDictionary}ee.getBindingDictionary=Pt;function er(mr,lr,xt,at,Rt,ft){var Kt=mr?se.MULTI_INJECT_TAG:se.INJECT_TAG,xr=new Ge.Metadata(Kt,xt),Y=new ct.Target(lr,at,xt,xr);if(Rt!==void 0){var Le=new Ge.Metadata(Rt,ft);Y.metadata.push(Le)}return Y}function qt(mr,lr,xt,at,Rt){var ft=Ct(xt.container,Rt.serviceIdentifier),Kt=[];return ft.length===_e.BindingCount.NoBindingsAvailable&&xt.container.options.autoBindInjectable&&typeof Rt.serviceIdentifier=="function"&&mr.getConstructorMetadata(Rt.serviceIdentifier).compilerGeneratedMetadata&&(xt.container.bind(Rt.serviceIdentifier).toSelf(),ft=Ct(xt.container,Rt.serviceIdentifier)),lr?Kt=ft:Kt=ft.filter(function(xr){var Y=new rt.Request(xr.serviceIdentifier,xt,at,xr,Rt);return xr.constraint(Y)}),ir(Rt.serviceIdentifier,Kt,Rt,xt.container),Kt}function ir(mr,lr,xt,at){switch(lr.length){case _e.BindingCount.NoBindingsAvailable:if(xt.isOptional())return lr;var Rt=ce.getServiceIdentifierAsString(mr),ft=Q.NOT_REGISTERED;throw ft+=ce.listMetadataForTarget(Rt,xt),ft+=ce.listRegisteredBindingsForServiceIdentifier(at,Rt,Ct),new Error(ft);case _e.BindingCount.OnlyOneBindingAvailable:if(!xt.isArray())return lr;case _e.BindingCount.MultipleBindingsAvailable:default:if(xt.isArray())return lr;var Rt=ce.getServiceIdentifierAsString(mr),ft=Q.AMBIGUOUS_MATCH+" "+Rt;throw ft+=ce.listRegisteredBindingsForServiceIdentifier(at,Rt,Ct),new Error(ft)}}function tr(mr,lr,xt,at,Rt,ft){var Kt,xr;if(Rt===null){Kt=qt(mr,lr,at,null,ft),xr=new rt.Request(xt,at,null,Kt,ft);var Y=new oe.Plan(at,xr);at.addPlan(Y)}else Kt=qt(mr,lr,at,Rt,ft),xr=Rt.addChildRequest(ft.serviceIdentifier,Kt,ft);Kt.forEach(function(Le){var O=null;if(ft.isArray())O=xr.addChildRequest(Le.serviceIdentifier,Le,ft);else{if(Le.cache)return;O=xr}if(Le.type===y.BindingTypeEnum.Instance&&Le.implementationType!==null){var ke=je.getDependencies(mr,Le.implementationType);if(!at.container.options.skipBaseClassChecks){var Ae=je.getBaseClassDependencyCount(mr,Le.implementationType);if(ke.length<Ae){var st=Q.ARGUMENTS_LENGTH_MISMATCH(je.getFunctionName(Le.implementationType));throw new Error(st)}}ke.forEach(function(_t){tr(mr,!1,_t.serviceIdentifier,at,O,_t)})}})}function Ct(mr,lr){var xt=[],at=Pt(mr);return at.hasKey(lr)?xt=at.get(lr):mr.parent!==null&&(xt=Ct(mr.parent,lr)),xt}function yt(mr,lr,xt,at,Rt,ft,Kt,xr){xr===void 0&&(xr=!1);var Y=new ae.Context(lr),Le=er(xt,at,Rt,"",ft,Kt);try{return tr(mr,xr,Rt,Y,null,Le),Y}catch(O){throw U.isStackOverflowExeption(O)&&Y.plan&&ce.circularDependencyToException(Y.plan.rootRequest),O}}ee.plan=yt;function Fr(mr,lr,xt,at){var Rt=new ct.Target(y.TargetTypeEnum.Variable,"",lr,new Ge.Metadata(xt,at)),ft=new ae.Context(mr),Kt=new rt.Request(lr,ft,null,[],Rt);return Kt}ee.createMockRequest=Fr},88460:function(wr,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.QueryableString=void 0;var z=function(){function _e(Q){this.str=Q}return _e.prototype.startsWith=function(Q){return this.str.indexOf(Q)===0},_e.prototype.endsWith=function(Q){var y="",se=Q.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},se)},_e.prototype.contains=function(Q){return this.str.indexOf(Q)!==-1},_e.prototype.equals=function(Q){return this.str===Q},_e.prototype.value=function(){return this.str},_e}();ee.QueryableString=z},6e3:function(wr,ee,z){"use strict";var _e=this&&this.__spreadArray||function(qt,ir){for(var tr=0,Ct=ir.length,yt=qt.length;tr<Ct;tr++,yt++)qt[yt]=ir[tr];return qt};Object.defineProperty(ee,"__esModule",{value:!0}),ee.getFunctionName=ee.getBaseClassDependencyCount=ee.getDependencies=void 0;var Q=z(5744),y=z(16674),se=z(28421),U=z(6867),ce=z(55800);Object.defineProperty(ee,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var ae=z(18924);function Ge(qt,ir){var tr=ce.getFunctionName(ir),Ct=oe(qt,tr,ir,!1);return Ct}ee.getDependencies=Ge;function oe(qt,ir,tr,Ct){var yt=qt.getConstructorMetadata(tr),Fr=yt.compilerGeneratedMetadata;if(Fr===void 0){var mr=y.MISSING_INJECTABLE_ANNOTATION+" "+ir+".";throw new Error(mr)}var lr=yt.userGeneratedMetadata,xt=Object.keys(lr),at=tr.length===0&&xt.length>0,Rt=xt.length>tr.length,ft=at||Rt?xt.length:tr.length,Kt=rt(Ct,ir,Fr,lr,ft),xr=ct(qt,tr),Y=_e(_e([],Kt),xr);return Y}function je(qt,ir,tr,Ct,yt){var Fr=yt[qt.toString()]||[],mr=er(Fr),lr=mr.unmanaged!==!0,xt=Ct[qt],at=mr.inject||mr.multiInject;if(xt=at||xt,xt instanceof Q.LazyServiceIdentifer&&(xt=xt.unwrap()),lr){var Rt=xt===Object,ft=xt===Function,Kt=xt===void 0,xr=Rt||ft||Kt;if(!ir&&xr){var Y=y.MISSING_INJECT_ANNOTATION+" argument "+qt+" in class "+tr+".";throw new Error(Y)}var Le=new ae.Target(se.TargetTypeEnum.ConstructorArgument,mr.targetName,xt);return Le.metadata=Fr,Le}return null}function rt(qt,ir,tr,Ct,yt){for(var Fr=[],mr=0;mr<yt;mr++){var lr=mr,xt=je(lr,qt,ir,tr,Ct);xt!==null&&Fr.push(xt)}return Fr}function ct(qt,ir){for(var tr=qt.getPropertiesMetadata(ir),Ct=[],yt=Object.keys(tr),Fr=0,mr=yt;Fr<mr.length;Fr++){var lr=mr[Fr],xt=tr[lr],at=er(tr[lr]),Rt=at.targetName||lr,ft=at.inject||at.multiInject,Kt=new ae.Target(se.TargetTypeEnum.ClassProperty,Rt,ft);Kt.metadata=xt,Ct.push(Kt)}var xr=Object.getPrototypeOf(ir.prototype).constructor;if(xr!==Object){var Y=ct(qt,xr);Ct=_e(_e([],Ct),Y)}return Ct}function Pt(qt,ir){var tr=Object.getPrototypeOf(ir.prototype).constructor;if(tr!==Object){var Ct=ce.getFunctionName(tr),yt=oe(qt,Ct,tr,!0),Fr=yt.map(function(xt){return xt.metadata.filter(function(at){return at.key===U.UNMANAGED_TAG})}),mr=[].concat.apply([],Fr).length,lr=yt.length-mr;return lr>0?lr:Pt(qt,tr)}else return 0}ee.getBaseClassDependencyCount=Pt;function er(qt){var ir={};return qt.forEach(function(tr){ir[tr.key.toString()]=tr.value}),{inject:ir[U.INJECT_TAG],multiInject:ir[U.MULTI_INJECT_TAG],targetName:ir[U.NAME_TAG],unmanaged:ir[U.UNMANAGED_TAG]}}},6748:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Request=void 0;var _e=z(37791),Q=function(){function y(se,U,ce,ae,Ge){this.id=_e.id(),this.serviceIdentifier=se,this.parentContext=U,this.parentRequest=ce,this.target=Ge,this.childRequests=[],this.bindings=Array.isArray(ae)?ae:[ae],this.requestScope=ce===null?new Map:null}return y.prototype.addChildRequest=function(se,U,ce){var ae=new y(se,this.parentContext,this,U,ce);return this.childRequests.push(ae),ae},y}();ee.Request=Q},18924:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Target=void 0;var _e=z(6867),Q=z(37791),y=z(47738),se=z(88460),U=function(){function ce(ae,Ge,oe,je){this.id=Q.id(),this.type=ae,this.serviceIdentifier=oe,this.name=new se.QueryableString(Ge||""),this.metadata=new Array;var rt=null;typeof je=="string"?rt=new y.Metadata(_e.NAMED_TAG,je):je instanceof y.Metadata&&(rt=je),rt!==null&&this.metadata.push(rt)}return ce.prototype.hasTag=function(ae){for(var Ge=0,oe=this.metadata;Ge<oe.length;Ge++){var je=oe[Ge];if(je.key===ae)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(_e.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(ae){return this.matchesTag(_e.MULTI_INJECT_TAG)(ae)},ce.prototype.isNamed=function(){return this.hasTag(_e.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(ae){return _e.NON_CUSTOM_TAG_KEYS.every(function(Ge){return ae.key!==Ge})})},ce.prototype.isOptional=function(){return this.matchesTag(_e.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ae){return ae.key===_e.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ae){return _e.NON_CUSTOM_TAG_KEYS.every(function(Ge){return ae.key!==Ge})}):null},ce.prototype.matchesNamedTag=function(ae){return this.matchesTag(_e.NAMED_TAG)(ae)},ce.prototype.matchesTag=function(ae){var Ge=this;return function(oe){for(var je=0,rt=Ge.metadata;je<rt.length;je++){var ct=rt[je];if(ct.key===ae&&ct.value===oe)return!0}return!1}},ce}();ee.Target=U},52279:function(wr,ee,z){"use strict";var _e=this&&this.__spreadArray||function(oe,je){for(var rt=0,ct=je.length,Pt=oe.length;rt<ct;rt++,Pt++)oe[Pt]=je[rt];return oe};Object.defineProperty(ee,"__esModule",{value:!0}),ee.resolveInstance=void 0;var Q=z(16674),y=z(28421),se=z(6867);function U(oe,je,rt){var ct=je.filter(function(er){return er.target!==null&&er.target.type===y.TargetTypeEnum.ClassProperty}),Pt=ct.map(rt);return ct.forEach(function(er,qt){var ir="";ir=er.target.name.value();var tr=Pt[qt];oe[ir]=tr}),oe}function ce(oe,je){return new(oe.bind.apply(oe,_e([void 0],je)))}function ae(oe,je){if(Reflect.hasMetadata(se.POST_CONSTRUCT,oe)){var rt=Reflect.getMetadata(se.POST_CONSTRUCT,oe);try{je[rt.value]()}catch(ct){throw new Error(Q.POST_CONSTRUCT_ERROR(oe.name,ct.message))}}}function Ge(oe,je,rt){var ct=null;if(je.length>0){var Pt=je.filter(function(qt){return qt.target!==null&&qt.target.type===y.TargetTypeEnum.ConstructorArgument}),er=Pt.map(rt);ct=ce(oe,er),ct=U(ct,je,rt)}else ct=new oe;return ae(oe,ct),ct}ee.resolveInstance=Ge},31927:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.resolve=void 0;var _e=z(16674),Q=z(28421),y=z(85265),se=z(55800),U=z(52279),ce=function(oe,je,rt){try{return rt()}catch(ct){throw y.isStackOverflowExeption(ct)?new Error(_e.CIRCULAR_DEPENDENCY_IN_FACTORY(oe,je.toString())):ct}},ae=function(oe){return function(je){je.parentContext.setCurrentRequest(je);var rt=je.bindings,ct=je.childRequests,Pt=je.target&&je.target.isArray(),er=!je.parentRequest||!je.parentRequest.target||!je.target||!je.parentRequest.target.matchesArray(je.target.serviceIdentifier);if(Pt&&er)return ct.map(function(Fr){var mr=ae(oe);return mr(Fr)});var qt=null;if(je.target.isOptional()&&rt.length===0)return;var ir=rt[0],tr=ir.scope===Q.BindingScopeEnum.Singleton,Ct=ir.scope===Q.BindingScopeEnum.Request;if(tr&&ir.activated)return ir.cache;if(Ct&&oe!==null&&oe.has(ir.id))return oe.get(ir.id);if(ir.type===Q.BindingTypeEnum.ConstantValue)qt=ir.cache,ir.activated=!0;else if(ir.type===Q.BindingTypeEnum.Function)qt=ir.cache,ir.activated=!0;else if(ir.type===Q.BindingTypeEnum.Constructor)qt=ir.implementationType;else if(ir.type===Q.BindingTypeEnum.DynamicValue&&ir.dynamicValue!==null)qt=ce("toDynamicValue",ir.serviceIdentifier,function(){return ir.dynamicValue(je.parentContext)});else if(ir.type===Q.BindingTypeEnum.Factory&&ir.factory!==null)qt=ce("toFactory",ir.serviceIdentifier,function(){return ir.factory(je.parentContext)});else if(ir.type===Q.BindingTypeEnum.Provider&&ir.provider!==null)qt=ce("toProvider",ir.serviceIdentifier,function(){return ir.provider(je.parentContext)});else if(ir.type===Q.BindingTypeEnum.Instance&&ir.implementationType!==null)qt=U.resolveInstance(ir.implementationType,ct,ae(oe));else{var yt=se.getServiceIdentifierAsString(je.serviceIdentifier);throw new Error(_e.INVALID_BINDING_TYPE+" "+yt)}return typeof ir.onActivation=="function"&&(qt=ir.onActivation(je.parentContext,qt)),tr&&(ir.cache=qt,ir.activated=!0),Ct&&oe!==null&&!oe.has(ir.id)&&oe.set(ir.id,qt),qt}};function Ge(oe){var je=ae(oe.plan.rootRequest.requestScope);return je(oe.plan.rootRequest)}ee.resolve=Ge},83366:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingInSyntax=void 0;var _e=z(28421),Q=z(71325),y=function(){function se(U){this._binding=U}return se.prototype.inRequestScope=function(){return this._binding.scope=_e.BindingScopeEnum.Request,new Q.BindingWhenOnSyntax(this._binding)},se.prototype.inSingletonScope=function(){return this._binding.scope=_e.BindingScopeEnum.Singleton,new Q.BindingWhenOnSyntax(this._binding)},se.prototype.inTransientScope=function(){return this._binding.scope=_e.BindingScopeEnum.Transient,new Q.BindingWhenOnSyntax(this._binding)},se}();ee.BindingInSyntax=y},74889:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingInWhenOnSyntax=void 0;var _e=z(83366),Q=z(51811),y=z(98370),se=function(){function U(ce){this._binding=ce,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Q.BindingOnSyntax(this._binding),this._bindingInSyntax=new _e.BindingInSyntax(ce)}return U.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},U.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},U.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},U.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},U.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},U.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},U.prototype.whenTargetTagged=function(ce,ae){return this._bindingWhenSyntax.whenTargetTagged(ce,ae)},U.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},U.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},U.prototype.whenParentTagged=function(ce,ae){return this._bindingWhenSyntax.whenParentTagged(ce,ae)},U.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},U.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},U.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},U.prototype.whenAnyAncestorTagged=function(ce,ae){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,ae)},U.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},U.prototype.whenNoAncestorTagged=function(ce,ae){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,ae)},U.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},U.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},U.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},U}();ee.BindingInWhenOnSyntax=se},51811:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingOnSyntax=void 0;var _e=z(98370),Q=function(){function y(se){this._binding=se}return y.prototype.onActivation=function(se){return this._binding.onActivation=se,new _e.BindingWhenSyntax(this._binding)},y}();ee.BindingOnSyntax=Q},15451:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingToSyntax=void 0;var _e=z(16674),Q=z(28421),y=z(74889),se=z(71325),U=function(){function ce(ae){this._binding=ae}return ce.prototype.to=function(ae){return this._binding.type=Q.BindingTypeEnum.Instance,this._binding.implementationType=ae,new y.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+_e.INVALID_TO_SELF_VALUE);var ae=this._binding.serviceIdentifier;return this.to(ae)},ce.prototype.toConstantValue=function(ae){return this._binding.type=Q.BindingTypeEnum.ConstantValue,this._binding.cache=ae,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Q.BindingScopeEnum.Singleton,new se.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(ae){return this._binding.type=Q.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ae,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(ae){return this._binding.type=Q.BindingTypeEnum.Constructor,this._binding.implementationType=ae,this._binding.scope=Q.BindingScopeEnum.Singleton,new se.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(ae){return this._binding.type=Q.BindingTypeEnum.Factory,this._binding.factory=ae,this._binding.scope=Q.BindingScopeEnum.Singleton,new se.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(ae){if(typeof ae!="function")throw new Error(_e.INVALID_FUNCTION_BINDING);var Ge=this.toConstantValue(ae);return this._binding.type=Q.BindingTypeEnum.Function,this._binding.scope=Q.BindingScopeEnum.Singleton,Ge},ce.prototype.toAutoFactory=function(ae){return this._binding.type=Q.BindingTypeEnum.Factory,this._binding.factory=function(Ge){var oe=function(){return Ge.container.get(ae)};return oe},this._binding.scope=Q.BindingScopeEnum.Singleton,new se.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(ae){return this._binding.type=Q.BindingTypeEnum.Provider,this._binding.provider=ae,this._binding.scope=Q.BindingScopeEnum.Singleton,new se.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(ae){this.toDynamicValue(function(Ge){return Ge.container.get(ae)})},ce}();ee.BindingToSyntax=U},71325:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingWhenOnSyntax=void 0;var _e=z(51811),Q=z(98370),y=function(){function se(U){this._binding=U,this._bindingWhenSyntax=new Q.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new _e.BindingOnSyntax(this._binding)}return se.prototype.when=function(U){return this._bindingWhenSyntax.when(U)},se.prototype.whenTargetNamed=function(U){return this._bindingWhenSyntax.whenTargetNamed(U)},se.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},se.prototype.whenTargetTagged=function(U,ce){return this._bindingWhenSyntax.whenTargetTagged(U,ce)},se.prototype.whenInjectedInto=function(U){return this._bindingWhenSyntax.whenInjectedInto(U)},se.prototype.whenParentNamed=function(U){return this._bindingWhenSyntax.whenParentNamed(U)},se.prototype.whenParentTagged=function(U,ce){return this._bindingWhenSyntax.whenParentTagged(U,ce)},se.prototype.whenAnyAncestorIs=function(U){return this._bindingWhenSyntax.whenAnyAncestorIs(U)},se.prototype.whenNoAncestorIs=function(U){return this._bindingWhenSyntax.whenNoAncestorIs(U)},se.prototype.whenAnyAncestorNamed=function(U){return this._bindingWhenSyntax.whenAnyAncestorNamed(U)},se.prototype.whenAnyAncestorTagged=function(U,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(U,ce)},se.prototype.whenNoAncestorNamed=function(U){return this._bindingWhenSyntax.whenNoAncestorNamed(U)},se.prototype.whenNoAncestorTagged=function(U,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(U,ce)},se.prototype.whenAnyAncestorMatches=function(U){return this._bindingWhenSyntax.whenAnyAncestorMatches(U)},se.prototype.whenNoAncestorMatches=function(U){return this._bindingWhenSyntax.whenNoAncestorMatches(U)},se.prototype.onActivation=function(U){return this._bindingOnSyntax.onActivation(U)},se}();ee.BindingWhenOnSyntax=y},98370:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingWhenSyntax=void 0;var _e=z(51811),Q=z(80758),y=function(){function se(U){this._binding=U}return se.prototype.when=function(U){return this._binding.constraint=U,new _e.BindingOnSyntax(this._binding)},se.prototype.whenTargetNamed=function(U){return this._binding.constraint=Q.namedConstraint(U),new _e.BindingOnSyntax(this._binding)},se.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(U){var ce=U.target!==null&&!U.target.isNamed()&&!U.target.isTagged();return ce},new _e.BindingOnSyntax(this._binding)},se.prototype.whenTargetTagged=function(U,ce){return this._binding.constraint=Q.taggedConstraint(U)(ce),new _e.BindingOnSyntax(this._binding)},se.prototype.whenInjectedInto=function(U){return this._binding.constraint=function(ce){return Q.typeConstraint(U)(ce.parentRequest)},new _e.BindingOnSyntax(this._binding)},se.prototype.whenParentNamed=function(U){return this._binding.constraint=function(ce){return Q.namedConstraint(U)(ce.parentRequest)},new _e.BindingOnSyntax(this._binding)},se.prototype.whenParentTagged=function(U,ce){return this._binding.constraint=function(ae){return Q.taggedConstraint(U)(ce)(ae.parentRequest)},new _e.BindingOnSyntax(this._binding)},se.prototype.whenAnyAncestorIs=function(U){return this._binding.constraint=function(ce){return Q.traverseAncerstors(ce,Q.typeConstraint(U))},new _e.BindingOnSyntax(this._binding)},se.prototype.whenNoAncestorIs=function(U){return this._binding.constraint=function(ce){return!Q.traverseAncerstors(ce,Q.typeConstraint(U))},new _e.BindingOnSyntax(this._binding)},se.prototype.whenAnyAncestorNamed=function(U){return this._binding.constraint=function(ce){return Q.traverseAncerstors(ce,Q.namedConstraint(U))},new _e.BindingOnSyntax(this._binding)},se.prototype.whenNoAncestorNamed=function(U){return this._binding.constraint=function(ce){return!Q.traverseAncerstors(ce,Q.namedConstraint(U))},new _e.BindingOnSyntax(this._binding)},se.prototype.whenAnyAncestorTagged=function(U,ce){return this._binding.constraint=function(ae){return Q.traverseAncerstors(ae,Q.taggedConstraint(U)(ce))},new _e.BindingOnSyntax(this._binding)},se.prototype.whenNoAncestorTagged=function(U,ce){return this._binding.constraint=function(ae){return!Q.traverseAncerstors(ae,Q.taggedConstraint(U)(ce))},new _e.BindingOnSyntax(this._binding)},se.prototype.whenAnyAncestorMatches=function(U){return this._binding.constraint=function(ce){return Q.traverseAncerstors(ce,U)},new _e.BindingOnSyntax(this._binding)},se.prototype.whenNoAncestorMatches=function(U){return this._binding.constraint=function(ce){return!Q.traverseAncerstors(ce,U)},new _e.BindingOnSyntax(this._binding)},se}();ee.BindingWhenSyntax=y},80758:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.typeConstraint=ee.namedConstraint=ee.taggedConstraint=ee.traverseAncerstors=void 0;var _e=z(6867),Q=z(47738),y=function(ae,Ge){var oe=ae.parentRequest;return oe!==null?Ge(oe)?!0:y(oe,Ge):!1};ee.traverseAncerstors=y;var se=function(ae){return function(Ge){var oe=function(je){return je!==null&&je.target!==null&&je.target.matchesTag(ae)(Ge)};return oe.metaData=new Q.Metadata(ae,Ge),oe}};ee.taggedConstraint=se;var U=se(_e.NAMED_TAG);ee.namedConstraint=U;var ce=function(ae){return function(Ge){var oe=null;if(Ge!==null)if(oe=Ge.bindings[0],typeof ae=="string"){var je=oe.serviceIdentifier;return je===ae}else{var rt=Ge.bindings[0].implementationType;return ae===rt}return!1}};ee.typeConstraint=ce},70600:function(wr,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.multiBindToService=void 0;var z=function(_e){return function(Q){return function(){for(var y=[],se=0;se<arguments.length;se++)y[se]=arguments[se];return y.forEach(function(U){return _e.bind(U).toService(Q)})}}};ee.multiBindToService=z},85265:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.isStackOverflowExeption=void 0;var _e=z(16674);function Q(y){return y instanceof RangeError||y.message===_e.STACK_OVERFLOW}ee.isStackOverflowExeption=Q},37791:function(wr,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.id=void 0;var z=0;function _e(){return z++}ee.id=_e},55800:function(wr,ee,z){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.circularDependencyToException=ee.listMetadataForTarget=ee.listRegisteredBindingsForServiceIdentifier=ee.getServiceIdentifierAsString=ee.getFunctionName=void 0;var _e=z(16674);function Q(oe){if(typeof oe=="function"){var je=oe;return je.name}else{if(typeof oe=="symbol")return oe.toString();var je=oe;return je}}ee.getServiceIdentifierAsString=Q;function y(oe,je,rt){var ct="",Pt=rt(oe,je);return Pt.length!==0&&(ct=`
Registered bindings:`,Pt.forEach(function(er){var qt="Object";er.implementationType!==null&&(qt=Ge(er.implementationType)),ct=ct+`
 `+qt,er.constraint.metaData&&(ct=ct+" - "+er.constraint.metaData)})),ct}ee.listRegisteredBindingsForServiceIdentifier=y;function se(oe,je){return oe.parentRequest===null?!1:oe.parentRequest.serviceIdentifier===je?!0:se(oe.parentRequest,je)}function U(oe){function je(ct,Pt){Pt===void 0&&(Pt=[]);var er=Q(ct.serviceIdentifier);return Pt.push(er),ct.parentRequest!==null?je(ct.parentRequest,Pt):Pt}var rt=je(oe);return rt.reverse().join(" --> ")}function ce(oe){oe.childRequests.forEach(function(je){if(se(je,je.serviceIdentifier)){var rt=U(je);throw new Error(_e.CIRCULAR_DEPENDENCY+" "+rt)}else ce(je)})}ee.circularDependencyToException=ce;function ae(oe,je){if(je.isTagged()||je.isNamed()){var rt="",ct=je.getNamedTag(),Pt=je.getCustomTags();return ct!==null&&(rt+=ct.toString()+`
`),Pt!==null&&Pt.forEach(function(er){rt+=er.toString()+`
`})," "+oe+`
 `+oe+" - "+rt}else return" "+oe}ee.listMetadataForTarget=ae;function Ge(oe){if(oe.name)return oe.name;var je=oe.toString(),rt=je.match(/^function\s*([^\s(]+)/);return rt?rt[1]:"Anonymous function: "+je}ee.getFunctionName=Ge},29750:function(wr){function ee(z,_e,Q){return z===z&&(Q!==void 0&&(z=z<=Q?z:Q),_e!==void 0&&(z=z>=_e?z:_e)),z}wr.exports=ee},74221:function(wr){function ee(z,_e,Q,y){for(var se=Q-1,U=z.length;++se<U;)if(y(z[se],_e))return se;return-1}wr.exports=ee},65464:function(wr,ee,z){var _e=z(29932),Q=z(42118),y=z(74221),se=z(7518),U=z(278),ce=Array.prototype,ae=ce.splice;function Ge(oe,je,rt,ct){var Pt=ct?y:Q,er=-1,qt=je.length,ir=oe;for(oe===je&&(je=U(je)),rt&&(ir=_e(oe,se(rt)));++er<qt;)for(var tr=0,Ct=je[er],yt=rt?rt(Ct):Ct;(tr=Pt(ir,yt,tr,ct))>-1;)ir!==oe&&ae.call(ir,tr,1),ae.call(oe,tr,1);return oe}wr.exports=Ge},18190:function(wr){var ee=9007199254740991,z=Math.floor;function _e(Q,y){var se="";if(!Q||y<1||y>ee)return se;do y%2&&(se+=Q),y=z(y/2),y&&(Q+=Q);while(y);return se}wr.exports=_e},78302:function(wr,ee,z){var _e=z(18190),Q=z(80531),y=z(40180),se=z(62689),U=z(88016),ce=z(83140),ae=Math.ceil;function Ge(oe,je){je=je===void 0?" ":Q(je);var rt=je.length;if(rt<2)return rt?_e(je,oe):je;var ct=_e(je,ae(oe/U(je)));return se(je)?y(ce(ct),0,oe).join(""):ct.slice(0,oe)}wr.exports=Ge},74691:function(wr,ee,z){var _e=z(29750),Q=z(14841);function y(se,U,ce){return ce===void 0&&(ce=U,U=void 0),ce!==void 0&&(ce=Q(ce),ce=ce===ce?ce:0),U!==void 0&&(U=Q(U),U=U===U?U:0),_e(Q(se),U,ce)}wr.exports=y},51584:function(wr,ee,z){var _e=z(44239),Q=z(37005),y="[object Boolean]";function se(U){return U===!0||U===!1||Q(U)&&_e(U)==y}wr.exports=se},60442:function(wr,ee,z){var _e=z(90939);function Q(y,se){return _e(y,se)}wr.exports=Q},14293:function(wr){function ee(z){return z==null}wr.exports=ee},81763:function(wr,ee,z){var _e=z(44239),Q=z(37005),y="[object Number]";function se(U){return typeof U=="number"||Q(U)&&_e(U)==y}wr.exports=se},30236:function(wr,ee,z){var _e=z(42980),Q=z(21463),y=Q(function(se,U,ce,ae){_e(se,U,ce,ae)});wr.exports=y},11726:function(wr,ee,z){var _e=z(78302),Q=z(88016),y=z(40554),se=z(79833);function U(ce,ae,Ge){ce=se(ce),ae=y(ae);var oe=ae?Q(ce):0;return ae&&oe<ae?ce+_e(ae-oe,Ge):ce}wr.exports=U},32475:function(wr,ee,z){var _e=z(78302),Q=z(88016),y=z(40554),se=z(79833);function U(ce,ae,Ge){ce=se(ce),ae=y(ae);var oe=ae?Q(ce):0;return ae&&oe<ae?_e(ae-oe,Ge)+ce:ce}wr.exports=U},97019:function(wr,ee,z){var _e=z(5976),Q=z(45604),y=_e(Q);wr.exports=y},45604:function(wr,ee,z){var _e=z(65464);function Q(y,se){return y&&y.length&&se&&se.length?_e(y,se):y}wr.exports=Q},23493:function(wr,ee,z){var _e=z(23279),Q=z(13218),y="Expected a function";function se(U,ce,ae){var Ge=!0,oe=!0;if(typeof U!="function")throw new TypeError(y);return Q(ae)&&(Ge="leading"in ae?!!ae.leading:Ge,oe="trailing"in ae?!!ae.trailing:oe),_e(U,ce,{leading:Ge,maxWait:ce,trailing:oe})}wr.exports=se},44908:function(wr,ee,z){var _e=z(45652);function Q(y){return y&&y.length?_e(y):[]}wr.exports=Q},6158:function(wr){(function(ee,z){wr.exports=z()})(this,function(){"use strict";var ee,z,_e;function Q(y,se){if(!ee)ee=se;else if(!z)z=se;else{var U="var sharedChunk = {}; ("+ee+")(sharedChunk); ("+z+")(sharedChunk);",ce={};ee(ce),_e=se(ce),typeof window!="undefined"&&(_e.workerUrl=window.URL.createObjectURL(new Blob([U],{type:"text/javascript"})))}}return Q(["exports"],function(y){"use strict";function se(a,s){return a(s={exports:{}},s.exports),s.exports}var U=ce;function ce(a,s,c,m){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=m,this.p2x=c,this.p2y=m}ce.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},ce.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},ce.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},ce.prototype.solveCurveX=function(a,s){var c,m,_,b,E;for(s===void 0&&(s=1e-6),_=a,E=0;E<8;E++){if(b=this.sampleCurveX(_)-a,Math.abs(b)<s)return _;var M=this.sampleCurveDerivativeX(_);if(Math.abs(M)<1e-6)break;_-=b/M}if((_=a)<(c=0))return c;if(_>(m=1))return m;for(;c<m;){if(b=this.sampleCurveX(_),Math.abs(b-a)<s)return _;a>b?c=_:m=_,_=.5*(m-c)+c}return _},ce.prototype.solve=function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))};var ae=Ge;function Ge(a,s){this.x=a,this.y=s}Ge.prototype={clone:function(){return new Ge(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,s){return this.clone()._rotateAround(a,s)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var s=a.x-this.x,c=a.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,s){return Math.atan2(this.x*s-this.y*a,this.x*a+this.y*s)},_matMult:function(a){var s=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=s,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var s=Math.cos(a),c=Math.sin(a),m=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=m,this},_rotateAround:function(a,s){var c=Math.cos(a),m=Math.sin(a),_=s.y+m*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-m*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ge.convert=function(a){return a instanceof Ge?a:Array.isArray(a)?new Ge(a[0],a[1]):a};var oe=typeof self!="undefined"?self:{},je=Math.pow(2,53)-1;function rt(a,s,c,m){var _=new U(a,s,c,m);return function(b){return _.solve(b)}}var ct=rt(.25,.1,.25,1);function Pt(a,s,c){return Math.min(c,Math.max(s,a))}function er(a,s,c){var m=c-s,_=((a-s)%m+m)%m+s;return _===s?c:_}function qt(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var b=_[m];for(var E in b)a[E]=b[E]}return a}var ir=1;function tr(){return ir++}function Ct(){return function a(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function yt(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Fr(a,s){a.forEach(function(c){s[c]&&(s[c]=s[c].bind(s))})}function mr(a,s){return a.indexOf(s,a.length-s.length)!==-1}function lr(a,s,c){var m={};for(var _ in a)m[_]=s.call(c||this,a[_],_,a);return m}function xt(a,s,c){var m={};for(var _ in a)s.call(c||this,a[_],_,a)&&(m[_]=a[_]);return m}function at(a){return Array.isArray(a)?a.map(at):typeof a=="object"&&a?lr(a,at):a}var Rt={};function ft(a){Rt[a]||(typeof console!="undefined"&&console.warn(a),Rt[a]=!0)}function Kt(a,s,c){return(c.y-a.y)*(s.x-a.x)>(s.y-a.y)*(c.x-a.x)}function xr(a){for(var s=0,c=0,m=a.length,_=m-1,b=void 0,E=void 0;c<m;_=c++)s+=((E=a[_]).x-(b=a[c]).x)*(b.y+E.y);return s}function Y(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Le(a){var s={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,_,b,E){var M=b||E;return s[_]=!M||M.toLowerCase(),""}),s["max-age"]){var c=parseInt(s["max-age"],10);isNaN(c)?delete s["max-age"]:s["max-age"]=c}return s}var O=null;function ke(a){if(O==null){var s=a.navigator?a.navigator.userAgent:null;O=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return O}function Ae(a){try{var s=oe[a];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var st,_t,bt,Ht,nr=oe.performance&&oe.performance.now?oe.performance.now.bind(oe.performance):Date.now.bind(Date),Qr=oe.requestAnimationFrame||oe.mozRequestAnimationFrame||oe.webkitRequestAnimationFrame||oe.msRequestAnimationFrame,Lr=oe.cancelAnimationFrame||oe.mozCancelAnimationFrame||oe.webkitCancelAnimationFrame||oe.msCancelAnimationFrame,jn={now:nr,frame:function(a){var s=Qr(a);return{cancel:function(){return Lr(s)}}},getImageData:function(a,s){s===void 0&&(s=0);var c=oe.document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,m.drawImage(a,0,0,a.width,a.height),m.getImageData(-s,-s,a.width+2*s,a.height+2*s)},resolveURL:function(a){return st||(st=oe.document.createElement("a")),st.href=a,st.href},hardwareConcurrency:oe.navigator&&oe.navigator.hardwareConcurrency||4,get devicePixelRatio(){return oe.devicePixelRatio},get prefersReducedMotion(){return!!oe.matchMedia&&(_t==null&&(_t=oe.matchMedia("(prefers-reduced-motion: reduce)")),_t.matches)}},tn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Cn={supported:!1,testSupport:function(a){!si&&Ht&&(Xn?vn(a):bt=a)}},si=!1,Xn=!1;function vn(a){var s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Ht),a.isContextLost())return;Cn.supported=!0}catch(c){}a.deleteTexture(s),si=!0}oe.document&&((Ht=oe.document.createElement("img")).onload=function(){bt&&vn(bt),bt=null,Xn=!0},Ht.onerror=function(){si=!0,bt=null},Ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ai="01",Ii=function(a,s){this._transformRequestFn=a,this._customAccessToken=s,this._createSkuToken()};function Ti(a){return a.indexOf("mapbox:")===0}Ii.prototype._createSkuToken=function(){var a=function(){for(var s="",c=0;c<10;c++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ai,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},Ii.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ii.prototype.transformRequest=function(a,s){return this._transformRequestFn&&this._transformRequestFn(a,s)||{url:a}},Ii.prototype.normalizeStyleURL=function(a,s){if(!Ti(a))return a;var c=Hi(a);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},Ii.prototype.normalizeGlyphsURL=function(a,s){if(!Ti(a))return a;var c=Hi(a);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},Ii.prototype.normalizeSourceURL=function(a,s){if(!Ti(a))return a;var c=Hi(a);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||s)},Ii.prototype.normalizeSpriteURL=function(a,s,c,m){var _=Hi(a);return Ti(a)?(_.path="/styles/v1"+_.path+"/sprite"+s+c,this._makeAPIURL(_,this._customAccessToken||m)):(_.path+=""+s+c,Ya(_))},Ii.prototype.normalizeTileURL=function(a,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Ti(a))return a;var c=Hi(a);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(jn.devicePixelRatio>=2||s===512?"@2x":"")+(Cn.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var m=this._customAccessToken||function(_){for(var b=0,E=_;b<E.length;b+=1){var M=E[b].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(c.params)||tn.ACCESS_TOKEN;return tn.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,m)},Ii.prototype.canonicalizeTileURL=function(a,s){var c=Hi(a);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return a;var m="mapbox://tiles/";m+=c.path.replace("/v4/","");var _=c.params;return s&&(_=_.filter(function(b){return!b.match(/^access_token=/)})),_.length&&(m+="?"+_.join("&")),m},Ii.prototype.canonicalizeTileset=function(a,s){for(var c=!!s&&Ti(s),m=[],_=0,b=a.tiles||[];_<b.length;_+=1){var E=b[_];Dn(E)?m.push(this.canonicalizeTileURL(E,c)):m.push(E)}return m},Ii.prototype._makeAPIURL=function(a,s){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=Hi(tn.API_URL);if(a.protocol=m.protocol,a.authority=m.authority,a.protocol==="http"){var _=a.params.indexOf("secure");_>=0&&a.params.splice(_,1)}if(m.path!=="/"&&(a.path=""+m.path+a.path),!tn.REQUIRE_ACCESS_TOKEN)return Ya(a);if(!(s=s||tn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return a.params=a.params.filter(function(b){return b.indexOf("access_token")===-1}),a.params.push("access_token="+s),Ya(a)};var Gn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Dn(a){return Gn.test(a)}var ho=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Hi(a){var s=a.match(ho);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function Ya(a){var s=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+s}function kt(a){if(!a)return null;var s=a.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(oe.atob(s[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var L=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};L.prototype.getStorageKey=function(a){var s,c=kt(tn.ACCESS_TOKEN);return s=c&&c.u?oe.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(m,_){return String.fromCharCode(Number("0x"+_))})):tn.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+s:"mapbox.eventData:"+s},L.prototype.fetchEventData=function(){var a=Ae("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{var m=oe.localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));var _=oe.localStorage.getItem(c);_&&(this.anonId=_)}catch(b){ft("Unable to read from LocalStorage")}},L.prototype.saveEventData=function(){var a=Ae("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{oe.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&oe.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(m){ft("Unable to write to LocalStorage")}},L.prototype.processRequests=function(a){},L.prototype.postEvent=function(a,s,c,m){var _=this;if(tn.EVENTS_URL){var b=Hi(tn.EVENTS_URL);b.params.push("access_token="+(m||tn.ACCESS_TOKEN||""));var E={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Ai,userId:this.anonId},M=s?qt(E,s):E,P={url:Ya(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Xi(P,function(F){_.pendingRequest=null,c(F),_.saveEventData(),_.processRequests(m)})}},L.prototype.queueRequest=function(a,s){this.queue.push(a),this.processRequests(s)};var ne,fe,Ze=function(a){function s(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(c,m,_,b){this.skuToken=_;var E=!(!b&&!tn.ACCESS_TOKEN),M=Array.isArray(c)&&c.some(function(P){return Ti(P)||Dn(P)});tn.EVENTS_URL&&E&&M&&this.queueRequest({id:m,timestamp:Date.now()},b)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),b=_.id,E=_.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),yt(this.anonId)||(this.anonId=Ct()),this.postEvent(E,{skuToken:this.skuToken},function(M){M||b&&(m.success[b]=!0)},c))}},s}(L),pt=new(function(a){function s(c){a.call(this,"appUserTurnstile"),this._customAccessToken=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(c,m){tn.EVENTS_URL&&tn.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(_){return Ti(_)||Dn(_)})&&this.queueRequest(Date.now(),m)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=kt(tn.ACCESS_TOKEN),b=_?_.u:tn.ACCESS_TOKEN,E=b!==this.eventData.tokenU;yt(this.anonId)||(this.anonId=Ct(),E=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var P=new Date(this.eventData.lastSuccess),F=new Date(M),j=(M-this.eventData.lastSuccess)/864e5;E=E||j>=1||j<-1||P.getDate()!==F.getDate()}else E=!0;if(!E)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(H){H||(m.eventData.lastSuccess=M,m.eventData.tokenU=b)},c)}},s}(L)),Wt=pt.postTurnstileEvent.bind(pt),Ar=new Ze,Ve=Ar.postMapLoadEvent.bind(Ar),Tt=500,ar=50;function Er(){oe.caches&&!ne&&(ne=oe.caches.open("mapbox-tiles"))}function Wr(a){var s=a.indexOf("?");return s<0?a:a.slice(0,s)}var mn,wn=1/0;function gn(){return mn==null&&(mn=oe.OffscreenCanvas&&new oe.OffscreenCanvas(1,1).getContext("2d")&&typeof oe.createImageBitmap=="function"),mn}var xn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(xn);var ri=function(a){function s(c,m,_){m===401&&Dn(_)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,c),this.status=m,this.url=_,this.name=this.constructor.name,this.message=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),Jn=Y()?function(){return self.worker&&self.worker.referrer}:function(){return(oe.location.protocol==="blob:"?oe.parent:oe).location.href},Wi,$i,po=function(a,s){if(!(/^file:/.test(c=a.url)||/^file:/.test(Jn())&&!/^\w+:/.test(c))){if(oe.fetch&&oe.Request&&oe.AbortController&&oe.Request.prototype.hasOwnProperty("signal"))return function(m,_){var b,E=new oe.AbortController,M=new oe.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:Jn(),signal:E.signal}),P=!1,F=!1,j=(b=M.url).indexOf("sku=")>0&&Dn(b);m.type==="json"&&M.headers.set("Accept","application/json");var H=function(ue,De,Be){if(!F){if(ue&&ue.message!=="SecurityError"&&ft(ue),De&&Be)return te(De);var Je=Date.now();oe.fetch(M).then(function(He){if(He.ok){var mt=j?He.clone():null;return te(He,mt,Je)}return _(new ri(He.statusText,He.status,m.url))}).catch(function(He){He.code!==20&&_(new Error(He.message))})}},te=function(ue,De,Be){(m.type==="arrayBuffer"?ue.arrayBuffer():m.type==="json"?ue.json():ue.text()).then(function(Je){F||(De&&Be&&function(He,mt,Lt){if(Er(),ne){var zt={status:mt.status,statusText:mt.statusText,headers:new oe.Headers};mt.headers.forEach(function(ur,yr){return zt.headers.set(yr,ur)});var Zt=Le(mt.headers.get("Cache-Control")||"");Zt["no-store"]||(Zt["max-age"]&&zt.headers.set("Expires",new Date(Lt+1e3*Zt["max-age"]).toUTCString()),new Date(zt.headers.get("Expires")).getTime()-Lt<42e4||function(ur,yr){if(fe===void 0)try{new Response(new ReadableStream),fe=!0}catch(Xr){fe=!1}fe?yr(ur.body):ur.blob().then(yr)}(mt,function(ur){var yr=new oe.Response(ur,zt);Er(),ne&&ne.then(function(Xr){return Xr.put(Wr(He.url),yr)}).catch(function(Xr){return ft(Xr.message)})}))}}(M,De,Be),P=!0,_(null,Je,ue.headers.get("Cache-Control"),ue.headers.get("Expires")))}).catch(function(Je){F||_(new Error(Je.message))})};return j?function(ue,De){if(Er(),!ne)return De(null);var Be=Wr(ue.url);ne.then(function(Je){Je.match(Be).then(function(He){var mt=function(Lt){if(!Lt)return!1;var zt=new Date(Lt.headers.get("Expires")||0),Zt=Le(Lt.headers.get("Cache-Control")||"");return zt>Date.now()&&!Zt["no-cache"]}(He);Je.delete(Be),mt&&Je.put(Be,He.clone()),De(null,He,mt)}).catch(De)}).catch(De)}(M,H):H(null,null),{cancel:function(){F=!0,P||E.abort()}}}(a,s);if(Y()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,s,void 0,!0)}var c;return function(m,_){var b=new oe.XMLHttpRequest;for(var E in b.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(b.responseType="arraybuffer"),m.headers)b.setRequestHeader(E,m.headers[E]);return m.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=m.credentials==="include",b.onerror=function(){_(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var M=b.response;if(m.type==="json")try{M=JSON.parse(b.response)}catch(P){return _(P)}_(null,M,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else _(new ri(b.statusText,b.status,m.url))},b.send(m.body),{cancel:function(){return b.abort()}}}(a,s)},$o=function(a,s){return po(qt(a,{type:"arrayBuffer"}),s)},Xi=function(a,s){return po(qt(a,{method:"POST"}),s)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Wi=[],$i=0;var X=function(a,s){if(Cn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),$i>=tn.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:a,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return Wi.push(c),c}$i++;var m=!1,_=function(){if(!m)for(m=!0,$i--;Wi.length&&$i<tn.MAX_PARALLEL_IMAGE_REQUESTS;){var E=Wi.shift();E.cancelled||(E.cancel=X(E.requestParameters,E.callback).cancel)}},b=$o(a,function(E,M,P,F){_(),E?s(E):M&&(gn()?function(j,H){var te=new oe.Blob([new Uint8Array(j)],{type:"image/png"});oe.createImageBitmap(te).then(function(ue){H(null,ue)}).catch(function(ue){H(new Error("Could not load image because of "+ue.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,s):function(j,H,te,ue){var De=new oe.Image,Be=oe.URL;De.onload=function(){H(null,De),Be.revokeObjectURL(De.src),De.onload=null,oe.requestAnimationFrame(function(){De.src=G})},De.onerror=function(){return H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Je=new oe.Blob([new Uint8Array(j)],{type:"image/png"});De.cacheControl=te,De.expires=ue,De.src=j.byteLength?Be.createObjectURL(Je):G}(M,s,P,F))});return{cancel:function(){b.cancel(),_()}}};function ie(a,s,c){c[a]&&c[a].indexOf(s)!==-1||(c[a]=c[a]||[],c[a].push(s))}function we(a,s,c){if(c&&c[a]){var m=c[a].indexOf(s);m!==-1&&c[a].splice(m,1)}}var Oe=function(a,s){s===void 0&&(s={}),qt(this,s),this.type=a},Ke=function(a){function s(c,m){m===void 0&&(m={}),a.call(this,"error",qt({error:c},m))}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Oe),ot=function(){};ot.prototype.on=function(a,s){return this._listeners=this._listeners||{},ie(a,s,this._listeners),this},ot.prototype.off=function(a,s){return we(a,s,this._listeners),we(a,s,this._oneTimeListeners),this},ot.prototype.once=function(a,s){return this._oneTimeListeners=this._oneTimeListeners||{},ie(a,s,this._oneTimeListeners),this},ot.prototype.fire=function(a,s){typeof a=="string"&&(a=new Oe(a,s||{}));var c=a.type;if(this.listens(c)){a.target=this;for(var m=0,_=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];m<_.length;m+=1)_[m].call(this,a);for(var b=0,E=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];b<E.length;b+=1){var M=E[b];we(c,M,this._oneTimeListeners),M.call(this,a)}var P=this._eventedParent;P&&(qt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),P.fire(a))}else a instanceof Ke&&console.error(a.error);return this},ot.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},ot.prototype.setEventedParent=function(a,s){return this._eventedParent=a,this._eventedParentData=s,this};var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},J=function(a,s,c,m){this.message=(a?a+": ":"")+c,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)};function be(a){var s=a.value;return s?[new J(a.key,s,"constants have been deprecated as of v8")]:[]}function lt(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var b=_[m];for(var E in b)a[E]=b[E]}return a}function dt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function re(a){if(Array.isArray(a))return a.map(re);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var s={};for(var c in a)s[c]=re(a[c]);return s}return dt(a)}var br=function(a){function s(c,m){a.call(this,m),this.message=m,this.key=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Error),yn=function(a,s){s===void 0&&(s=[]),this.parent=a,this.bindings={};for(var c=0,m=s;c<m.length;c+=1){var _=m[c];this.bindings[_[0]]=_[1]}};yn.prototype.concat=function(a){return new yn(this,a)},yn.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},yn.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var ln={kind:"null"},Qt={kind:"number"},en={kind:"string"},Gr={kind:"boolean"},Yr={kind:"color"},li={kind:"object"},qr={kind:"value"},hi={kind:"collator"},Bi={kind:"formatted"},ci={kind:"resolvedImage"};function _i(a,s){return{kind:"array",itemType:a,N:s}}function xi(a){if(a.kind==="array"){var s=xi(a.itemType);return typeof a.N=="number"?"array<"+s+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+s+">"}return a.kind}var ao=[ln,Qt,en,Gr,Yr,Bi,li,_i(qr),ci];function Ui(a,s){if(s.kind==="error")return null;if(a.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Ui(a.itemType,s.itemType))&&(typeof a.N!="number"||a.N===s.N))return null}else{if(a.kind===s.kind)return null;if(a.kind==="value"){for(var c=0,m=ao;c<m.length;c+=1)if(!Ui(m[c],s))return null}}return"Expected "+xi(a)+" but found "+xi(s)+" instead."}function aa(a,s){return s.some(function(c){return c.kind===a.kind})}function bi(a,s){return s.some(function(c){return c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a})}var fi=se(function(a,s){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(M){return(M=Math.round(M))<0?0:M>255?255:M}function _(M){return m(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function b(M){return(P=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:P>1?1:P;var P}function E(M,P,F){return F<0?F+=1:F>1&&(F-=1),6*F<1?M+(P-M)*F*6:2*F<1?P:3*F<2?M+(P-M)*(2/3-F)*6:M}try{s.parseCSSColor=function(M){var P,F=M.replace(/ /g,"").toLowerCase();if(F in c)return c[F].slice();if(F[0]==="#")return F.length===4?(P=parseInt(F.substr(1),16))>=0&&P<=4095?[(3840&P)>>4|(3840&P)>>8,240&P|(240&P)>>4,15&P|(15&P)<<4,1]:null:F.length===7&&(P=parseInt(F.substr(1),16))>=0&&P<=16777215?[(16711680&P)>>16,(65280&P)>>8,255&P,1]:null;var j=F.indexOf("("),H=F.indexOf(")");if(j!==-1&&H+1===F.length){var te=F.substr(0,j),ue=F.substr(j+1,H-(j+1)).split(","),De=1;switch(te){case"rgba":if(ue.length!==4)return null;De=b(ue.pop());case"rgb":return ue.length!==3?null:[_(ue[0]),_(ue[1]),_(ue[2]),De];case"hsla":if(ue.length!==4)return null;De=b(ue.pop());case"hsl":if(ue.length!==3)return null;var Be=(parseFloat(ue[0])%360+360)%360/360,Je=b(ue[1]),He=b(ue[2]),mt=He<=.5?He*(Je+1):He+Je-He*Je,Lt=2*He-mt;return[m(255*E(Lt,mt,Be+1/3)),m(255*E(Lt,mt,Be)),m(255*E(Lt,mt,Be-1/3)),De];default:return null}}return null}}catch(M){}}).parseCSSColor,vi=function(a,s,c,m){m===void 0&&(m=1),this.r=a,this.g=s,this.b=c,this.a=m};vi.parse=function(a){if(a){if(a instanceof vi)return a;if(typeof a=="string"){var s=fi(a);if(s)return new vi(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},vi.prototype.toString=function(){var a=this.toArray(),s=a[1],c=a[2],m=a[3];return"rgba("+Math.round(a[0])+","+Math.round(s)+","+Math.round(c)+","+m+")"},vi.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},vi.black=new vi(0,0,0,1),vi.white=new vi(1,1,1,1),vi.transparent=new vi(0,0,0,0),vi.red=new vi(1,0,0,1);var fa=function(a,s,c){this.sensitivity=a?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};fa.prototype.compare=function(a,s){return this.collator.compare(a,s)},fa.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ms=function(a,s,c,m,_){this.text=a,this.image=s,this.scale=c,this.fontStack=m,this.textColor=_},Ki=function(a){this.sections=a};Ki.fromString=function(a){return new Ki([new ms(a,null,null,null,null)])},Ki.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},Ki.factory=function(a){return a instanceof Ki?a:Ki.fromString(a)},Ki.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},Ki.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];if(m.image)a.push(["image",m.image.name]);else{a.push(m.text);var _={};m.fontStack&&(_["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(_["font-scale"]=m.scale),m.textColor&&(_["text-color"]=["rgba"].concat(m.textColor.toArray())),a.push(_)}}return a};var ha=function(a){this.name=a.name,this.available=a.available};function Su(a,s,c,m){return typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof c=="number"&&c>=0&&c<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[a,s,c,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[a,s,c,m]:[a,s,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function wu(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof vi||a instanceof fa||a instanceof Ki||a instanceof ha)return!0;if(Array.isArray(a)){for(var s=0,c=a;s<c.length;s+=1)if(!wu(c[s]))return!1;return!0}if(typeof a=="object"){for(var m in a)if(!wu(a[m]))return!1;return!0}return!1}function oa(a){if(a===null)return ln;if(typeof a=="string")return en;if(typeof a=="boolean")return Gr;if(typeof a=="number")return Qt;if(a instanceof vi)return Yr;if(a instanceof fa)return hi;if(a instanceof Ki)return Bi;if(a instanceof ha)return ci;if(Array.isArray(a)){for(var s,c=a.length,m=0,_=a;m<_.length;m+=1){var b=oa(_[m]);if(s){if(s===b)continue;s=qr;break}s=b}return _i(s||qr,c)}return li}function vo(a){var s=typeof a;return a===null?"":s==="string"||s==="number"||s==="boolean"?String(a):a instanceof vi||a instanceof Ki||a instanceof ha?a.toString():JSON.stringify(a)}ha.prototype.toString=function(){return this.name},ha.fromString=function(a){return a?new ha({name:a,available:!1}):null},ha.prototype.serialize=function(){return["image",this.name]};var Hn=function(a,s){this.type=a,this.value=s};Hn.parse=function(a,s){if(a.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!wu(a[1]))return s.error("invalid value");var c=a[1],m=oa(c),_=s.expectedType;return m.kind!=="array"||m.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(m=_),new Hn(m,c)},Hn.prototype.evaluate=function(){return this.value},Hn.prototype.eachChild=function(){},Hn.prototype.outputDefined=function(){return!0},Hn.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof vi?["rgba"].concat(this.value.toArray()):this.value instanceof Ki?this.value.serialize():this.value};var ra=function(a){this.name="ExpressionEvaluationError",this.message=a};ra.prototype.toJSON=function(){return this.message};var Ea={string:en,number:Qt,boolean:Gr,object:li},zi=function(a,s){this.type=a,this.args=s};zi.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c,m=1,_=a[0];if(_==="array"){var b,E;if(a.length>2){var M=a[1];if(typeof M!="string"||!(M in Ea)||M==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ea[M],m++}else b=qr;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=a[2],m++}c=_i(b,E)}else c=Ea[_];for(var P=[];m<a.length;m++){var F=s.parse(a[m],m,qr);if(!F)return null;P.push(F)}return new zi(c,P)},zi.prototype.evaluate=function(a){for(var s=0;s<this.args.length;s++){var c=this.args[s].evaluate(a);if(!Ui(this.type,oa(c)))return c;if(s===this.args.length-1)throw new ra("Expected value to be of type "+xi(this.type)+", but found "+xi(oa(c))+" instead.")}return null},zi.prototype.eachChild=function(a){this.args.forEach(a)},zi.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},zi.prototype.serialize=function(){var a=this.type,s=[a.kind];if(a.kind==="array"){var c=a.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);var m=a.N;(typeof m=="number"||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(function(_){return _.serialize()}))};var To=function(a){this.type=Bi,this.sections=a};To.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");for(var m=[],_=!1,b=1;b<=a.length-1;++b){var E=a[b];if(_&&typeof E=="object"&&!Array.isArray(E)){_=!1;var M=null;if(E["font-scale"]&&!(M=s.parse(E["font-scale"],1,Qt)))return null;var P=null;if(E["text-font"]&&!(P=s.parse(E["text-font"],1,_i(en))))return null;var F=null;if(E["text-color"]&&!(F=s.parse(E["text-color"],1,Yr)))return null;var j=m[m.length-1];j.scale=M,j.font=P,j.textColor=F}else{var H=s.parse(a[b],1,qr);if(!H)return null;var te=H.type.kind;if(te!=="string"&&te!=="value"&&te!=="null"&&te!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,m.push({content:H,scale:null,font:null,textColor:null})}}return new To(m)},To.prototype.evaluate=function(a){return new Ki(this.sections.map(function(s){var c=s.content.evaluate(a);return oa(c)===ci?new ms("",c,null,null,null):new ms(vo(c),null,s.scale?s.scale.evaluate(a):null,s.font?s.font.evaluate(a).join(","):null,s.textColor?s.textColor.evaluate(a):null)}))},To.prototype.eachChild=function(a){for(var s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a(m.content),m.scale&&a(m.scale),m.font&&a(m.font),m.textColor&&a(m.textColor)}},To.prototype.outputDefined=function(){return!1},To.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a.push(m.content.serialize());var _={};m.scale&&(_["font-scale"]=m.scale.serialize()),m.font&&(_["text-font"]=m.font.serialize()),m.textColor&&(_["text-color"]=m.textColor.serialize()),a.push(_)}return a};var mo=function(a){this.type=ci,this.input=a};mo.parse=function(a,s){if(a.length!==2)return s.error("Expected two arguments.");var c=s.parse(a[1],1,en);return c?new mo(c):s.error("No image name provided.")},mo.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=ha.fromString(s);return c&&a.availableImages&&(c.available=a.availableImages.indexOf(s)>-1),c},mo.prototype.eachChild=function(a){a(this.input)},mo.prototype.outputDefined=function(){return!1},mo.prototype.serialize=function(){return["image",this.input.serialize()]};var Ds={"to-boolean":Gr,"to-color":Yr,"to-number":Qt,"to-string":en},is=function(a,s){this.type=a,this.args=s};is.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[0];if((c==="to-boolean"||c==="to-string")&&a.length!==2)return s.error("Expected one argument.");for(var m=Ds[c],_=[],b=1;b<a.length;b++){var E=s.parse(a[b],b,qr);if(!E)return null;_.push(E)}return new is(m,_)},is.prototype.evaluate=function(a){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(a));if(this.type.kind==="color"){for(var s,c,m=0,_=this.args;m<_.length;m+=1){if(c=null,(s=_[m].evaluate(a))instanceof vi)return s;if(typeof s=="string"){var b=a.parseColor(s);if(b)return b}else if(Array.isArray(s)&&!(c=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":Su(s[0],s[1],s[2],s[3])))return new vi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new ra(c||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var E=null,M=0,P=this.args;M<P.length;M+=1){if((E=P[M].evaluate(a))===null)return 0;var F=Number(E);if(!isNaN(F))return F}throw new ra("Could not convert "+JSON.stringify(E)+" to number.")}return this.type.kind==="formatted"?Ki.fromString(vo(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?ha.fromString(vo(this.args[0].evaluate(a))):vo(this.args[0].evaluate(a))},is.prototype.eachChild=function(a){this.args.forEach(a)},is.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},is.prototype.serialize=function(){if(this.type.kind==="formatted")return new To([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new mo(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(s){a.push(s.serialize())}),a};var Fl=["Unknown","Point","LineString","Polygon"],Xo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Xo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Xo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Fl[this.feature.type]:this.feature.type:null},Xo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Xo.prototype.canonicalID=function(){return this.canonical},Xo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Xo.prototype.parseColor=function(a){var s=this._parseColorCache[a];return s||(s=this._parseColorCache[a]=vi.parse(a)),s};var la=function(a,s,c,m){this.name=a,this.type=s,this._evaluate=c,this.args=m};la.prototype.evaluate=function(a){return this._evaluate(a,this.args)},la.prototype.eachChild=function(a){this.args.forEach(a)},la.prototype.outputDefined=function(){return!1},la.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},la.parse=function(a,s){var c,m=a[0],_=la.definitions[m];if(!_)return s.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(_)?_[0]:_.type,E=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,M=E.filter(function(Bn){var sn=Bn[0];return!Array.isArray(sn)||sn.length===a.length-1}),P=null,F=0,j=M;F<j.length;F+=1){var H=j[F],te=H[0],ue=H[1];P=new Js(s.registry,s.path,null,s.scope);for(var De=[],Be=!1,Je=1;Je<a.length;Je++){var He=a[Je],mt=Array.isArray(te)?te[Je-1]:te.type,Lt=P.parse(He,1+De.length,mt);if(!Lt){Be=!0;break}De.push(Lt)}if(!Be)if(Array.isArray(te)&&te.length!==De.length)P.error("Expected "+te.length+" arguments, but found "+De.length+" instead.");else{for(var zt=0;zt<De.length;zt++){var Zt=Array.isArray(te)?te[zt]:te.type,ur=De[zt];P.concat(zt+1).checkSubtype(Zt,ur.type)}if(P.errors.length===0)return new la(m,b,ue,De)}}if(M.length===1)(c=s.errors).push.apply(c,P.errors);else{for(var yr=(M.length?M:E).map(function(Bn){var sn;return sn=Bn[0],Array.isArray(sn)?"("+sn.map(xi).join(", ")+")":"("+xi(sn.type)+"...)"}).join(" | "),Xr=[],Fn=1;Fn<a.length;Fn++){var nn=s.parse(a[Fn],1+Xr.length);if(!nn)return null;Xr.push(xi(nn.type))}s.error("Expected arguments of type "+yr+", but found ("+Xr.join(", ")+") instead.")}return null},la.register=function(a,s){for(var c in la.definitions=s,s)a[c]=la};var ga=function(a,s,c){this.type=hi,this.locale=c,this.caseSensitive=a,this.diacriticSensitive=s};function cr(a,s){a[0]=Math.min(a[0],s[0]),a[1]=Math.min(a[1],s[1]),a[2]=Math.max(a[2],s[0]),a[3]=Math.max(a[3],s[1])}function K(a,s){return!(a[0]<=s[0]||a[2]>=s[2]||a[1]<=s[1]||a[3]>=s[3])}function Me(a,s){var c=(180+a[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(c*_*8192),Math.round(m*_*8192)]}function nt(a,s,c){return s[1]>a[1]!=c[1]>a[1]&&a[0]<(c[0]-s[0])*(a[1]-s[1])/(c[1]-s[1])+s[0]}function Jt(a,s){for(var c,m,_,b,E,M,P,F=!1,j=0,H=s.length;j<H;j++)for(var te=s[j],ue=0,De=te.length;ue<De-1;ue++){if((b=(c=a)[0]-(m=te[ue])[0])*(P=c[1]-(_=te[ue+1])[1])-(M=c[0]-_[0])*(E=c[1]-m[1])==0&&b*M<=0&&E*P<=0)return!1;nt(a,te[ue],te[ue+1])&&(F=!F)}return F}function Vr(a,s){for(var c=0;c<s.length;c++)if(Jt(a,s[c]))return!0;return!1}function Mn(a,s,c,m){var _=m[0]-c[0],b=m[1]-c[1],E=(a[0]-c[0])*b-_*(a[1]-c[1]),M=(s[0]-c[0])*b-_*(s[1]-c[1]);return E>0&&M<0||E<0&&M>0}function Ri(a,s,c){for(var m=0,_=c;m<_.length;m+=1)for(var b=_[m],E=0;E<b.length-1;++E)if((H=[(j=b[E+1])[0]-(F=b[E])[0],j[1]-F[1]])[0]*(te=[(P=s)[0]-(M=a)[0],P[1]-M[1]])[1]-H[1]*te[0]!=0&&Mn(M,P,F,j)&&Mn(F,j,M,P))return!0;var M,P,F,j,H,te;return!1}function Pa(a,s){for(var c=0;c<a.length;++c)if(!Jt(a[c],s))return!1;for(var m=0;m<a.length-1;++m)if(Ri(a[m],a[m+1],s))return!1;return!0}function oo(a,s){for(var c=0;c<s.length;c++)if(Pa(a,s[c]))return!0;return!1}function Ua(a,s,c){for(var m=[],_=0;_<a.length;_++){for(var b=[],E=0;E<a[_].length;E++){var M=Me(a[_][E],c);cr(s,M),b.push(M)}m.push(b)}return m}function as(a,s,c){for(var m=[],_=0;_<a.length;_++){var b=Ua(a[_],s,c);m.push(b)}return m}function sc(a,s,c,m){if(a[0]<c[0]||a[0]>c[2]){var _=.5*m,b=a[0]-c[0]>_?-m:c[0]-a[0]>_?m:0;b===0&&(b=a[0]-c[2]>_?-m:c[2]-a[0]>_?m:0),a[0]+=b}cr(s,a)}function Os(a,s,c,m){for(var _=8192*Math.pow(2,m.z),b=[8192*m.x,8192*m.y],E=[],M=0,P=a;M<P.length;M+=1)for(var F=0,j=P[M];F<j.length;F+=1){var H=j[F],te=[H.x+b[0],H.y+b[1]];sc(te,s,c,_),E.push(te)}return E}function Uc(a,s,c,m){for(var _,b=8192*Math.pow(2,m.z),E=[8192*m.x,8192*m.y],M=[],P=0,F=a;P<F.length;P+=1){for(var j=[],H=0,te=F[P];H<te.length;H+=1){var ue=te[H],De=[ue.x+E[0],ue.y+E[1]];cr(s,De),j.push(De)}M.push(j)}if(s[2]-s[0]<=b/2){(_=s)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var Be=0,Je=M;Be<Je.length;Be+=1)for(var He=0,mt=Je[Be];He<mt.length;He+=1)sc(mt[He],s,c,b)}return M}ga.parse=function(a,s){if(a.length!==2)return s.error("Expected one argument.");var c=a[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");var m=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Gr);if(!m)return null;var _=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Gr);if(!_)return null;var b=null;return c.locale&&!(b=s.parse(c.locale,1,en))?null:new ga(m,_,b)},ga.prototype.evaluate=function(a){return new fa(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},ga.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},ga.prototype.outputDefined=function(){return!1},ga.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Fs=function(a,s){this.type=Gr,this.geojson=a,this.geometries=s};function Bu(a){if(a instanceof la&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Fs)return!1;var s=!0;return a.eachChild(function(c){s&&!Bu(c)&&(s=!1)}),s}function os(a){if(a instanceof la&&a.name==="feature-state")return!1;var s=!0;return a.eachChild(function(c){s&&!os(c)&&(s=!1)}),s}function ul(a,s){if(a instanceof la&&s.indexOf(a.name)>=0)return!1;var c=!0;return a.eachChild(function(m){c&&!ul(m,s)&&(c=!1)}),c}Fs.parse=function(a,s){if(a.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(wu(a[1])){var c=a[1];if(c.type==="FeatureCollection")for(var m=0;m<c.features.length;++m){var _=c.features[m].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Fs(c,c.features[m].geometry)}else if(c.type==="Feature"){var b=c.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Fs(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Fs(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Fs.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=s.canonicalID();if(c.type==="Polygon"){var E=Ua(c.coordinates,_,b),M=Os(s.geometry(),m,_,b);if(!K(m,_))return!1;for(var P=0,F=M;P<F.length;P+=1)if(!Jt(F[P],E))return!1}if(c.type==="MultiPolygon"){var j=as(c.coordinates,_,b),H=Os(s.geometry(),m,_,b);if(!K(m,_))return!1;for(var te=0,ue=H;te<ue.length;te+=1)if(!Vr(ue[te],j))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=s.canonicalID();if(c.type==="Polygon"){var E=Ua(c.coordinates,_,b),M=Uc(s.geometry(),m,_,b);if(!K(m,_))return!1;for(var P=0,F=M;P<F.length;P+=1)if(!Pa(F[P],E))return!1}if(c.type==="MultiPolygon"){var j=as(c.coordinates,_,b),H=Uc(s.geometry(),m,_,b);if(!K(m,_))return!1;for(var te=0,ue=H;te<ue.length;te+=1)if(!oo(ue[te],j))return!1}return!0}(a,this.geometries)}return!1},Fs.prototype.eachChild=function(){},Fs.prototype.outputDefined=function(){return!0},Fs.prototype.serialize=function(){return["within",this.geojson]};var zu=function(a,s){this.type=s.type,this.name=a,this.boundExpression=s};zu.parse=function(a,s){if(a.length!==2||typeof a[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var c=a[1];return s.scope.has(c)?new zu(c,s.scope.get(c)):s.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},zu.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},zu.prototype.eachChild=function(){},zu.prototype.outputDefined=function(){return!1},zu.prototype.serialize=function(){return["var",this.name]};var Js=function(a,s,c,m,_){s===void 0&&(s=[]),m===void 0&&(m=new yn),_===void 0&&(_=[]),this.registry=a,this.path=s,this.key=s.map(function(b){return"["+b+"]"}).join(""),this.scope=m,this.errors=_,this.expectedType=c};function Bl(a,s){for(var c,m=a.length-1,_=0,b=m,E=0;_<=b;)if((c=a[E=Math.floor((_+b)/2)])<=s){if(E===m||s<a[E+1])return E;_=E+1}else{if(!(c>s))throw new ra("Input is not a number.");b=E-1}return 0}Js.prototype.parse=function(a,s,c,m,_){return _===void 0&&(_={}),s?this.concat(s,c,m)._parse(a,_):this._parse(a,_)},Js.prototype._parse=function(a,s){function c(F,j,H){return H==="assert"?new zi(j,[F]):H==="coerce"?new is(j,[F]):F}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=a[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[m];if(_){var b=_.parse(a,this);if(!b)return null;if(this.expectedType){var E=this.expectedType,M=b.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||M.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(E,M))return null}else b=c(b,E,s.typeAnnotation||"coerce");else b=c(b,E,s.typeAnnotation||"assert")}if(!(b instanceof Hn)&&b.type.kind!=="resolvedImage"&&function F(j){if(j instanceof zu)return F(j.boundExpression);if(j instanceof la&&j.name==="error"||j instanceof ga||j instanceof Fs)return!1;var H=j instanceof is||j instanceof zi,te=!0;return j.eachChild(function(ue){te=H?te&&F(ue):te&&ue instanceof Hn}),!!te&&Bu(j)&&ul(j,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var P=new Xo;try{b=new Hn(b.type,b.evaluate(P))}catch(F){return this.error(F.message),null}}return b}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},Js.prototype.concat=function(a,s,c){var m=typeof a=="number"?this.path.concat(a):this.path,_=c?this.scope.concat(c):this.scope;return new Js(this.registry,m,s||null,_,this.errors)},Js.prototype.error=function(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];var m=""+this.key+s.map(function(_){return"["+_+"]"}).join("");this.errors.push(new br(m,a))},Js.prototype.checkSubtype=function(a,s){var c=Ui(a,s);return c&&this.error(c),c};var Yo=function(a,s,c){this.type=a,this.input=s,this.labels=[],this.outputs=[];for(var m=0,_=c;m<_.length;m+=1){var b=_[m],E=b[1];this.labels.push(b[0]),this.outputs.push(E)}};function La(a,s,c){return a*(1-c)+s*c}Yo.parse=function(a,s){if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");var c=s.parse(a[1],1,Qt);if(!c)return null;var m=[],_=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(var b=1;b<a.length;b+=2){var E=b===1?-1/0:a[b],M=a[b+1],P=b,F=b+1;if(typeof E!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(m.length&&m[m.length-1][0]>=E)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);var j=s.parse(M,F,_);if(!j)return null;_=_||j.type,m.push([E,j])}return new Yo(_,c,m)},Yo.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;return m>=s[_-1]?c[_-1].evaluate(a):c[Bl(s,m)].evaluate(a)},Yo.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},Yo.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Yo.prototype.serialize=function(){for(var a=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&a.push(this.labels[s]),a.push(this.outputs[s].serialize());return a};var zl=Object.freeze({__proto__:null,number:La,color:function(a,s,c){return new vi(La(a.r,s.r,c),La(a.g,s.g,c),La(a.b,s.b,c),La(a.a,s.a,c))},array:function(a,s,c){return a.map(function(m,_){return La(m,s[_],c)})}}),Vc=6/29*3*(6/29),bf=Math.PI/180,Nu=180/Math.PI;function Nl(a){return a>.008856451679035631?Math.pow(a,1/3):a/Vc+4/29}function jc(a){return a>6/29?a*a*a:Vc*(a-4/29)}function Gc(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Sf(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ih(a){var s=Sf(a.r),c=Sf(a.g),m=Sf(a.b),_=Nl((.4124564*s+.3575761*c+.1804375*m)/.95047),b=Nl((.2126729*s+.7151522*c+.072175*m)/1);return{l:116*b-16,a:500*(_-b),b:200*(b-Nl((.0193339*s+.119192*c+.9503041*m)/1.08883)),alpha:a.a}}function ah(a){var s=(a.l+16)/116,c=isNaN(a.a)?s:s+a.a/500,m=isNaN(a.b)?s:s-a.b/200;return s=1*jc(s),c=.95047*jc(c),m=1.08883*jc(m),new vi(Gc(3.2404542*c-1.5371385*s-.4985314*m),Gc(-.969266*c+1.8760108*s+.041556*m),Gc(.0556434*c-.2040259*s+1.0572252*m),a.alpha)}function Zh(a,s,c){var m=s-a;return a+c*(m>180||m<-180?m-360*Math.round(m/360):m)}var uc={forward:ih,reverse:ah,interpolate:function(a,s,c){return{l:La(a.l,s.l,c),a:La(a.a,s.a,c),b:La(a.b,s.b,c),alpha:La(a.alpha,s.alpha,c)}}},lc={forward:function(a){var s=ih(a),c=s.l,m=s.a,_=s.b,b=Math.atan2(_,m)*Nu;return{h:b<0?b+360:b,c:Math.sqrt(m*m+_*_),l:c,alpha:a.a}},reverse:function(a){var s=a.h*bf,c=a.c;return ah({l:a.l,a:Math.cos(s)*c,b:Math.sin(s)*c,alpha:a.alpha})},interpolate:function(a,s,c){return{h:Zh(a.h,s.h,c),c:La(a.c,s.c,c),l:La(a.l,s.l,c),alpha:La(a.alpha,s.alpha,c)}}},oh=Object.freeze({__proto__:null,lab:uc,hcl:lc}),Ra=function(a,s,c,m,_){this.type=a,this.operator=s,this.interpolation=c,this.input=m,this.labels=[],this.outputs=[];for(var b=0,E=_;b<E.length;b+=1){var M=E[b],P=M[1];this.labels.push(M[0]),this.outputs.push(P)}};function wf(a,s,c,m){var _=m-c,b=a-c;return _===0?0:s===1?b/_:(Math.pow(s,b)-1)/(Math.pow(s,_)-1)}Ra.interpolationFactor=function(a,s,c,m){var _=0;if(a.name==="exponential")_=wf(s,a.base,c,m);else if(a.name==="linear")_=wf(s,1,c,m);else if(a.name==="cubic-bezier"){var b=a.controlPoints;_=new U(b[0],b[1],b[2],b[3]).solve(wf(s,1,c,m))}return _},Ra.parse=function(a,s){var c=a[0],m=a[1],_=a[2],b=a.slice(3);if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var E=m[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:E}}else{if(m[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(m[0]),1,0);var M=m.slice(1);if(M.length!==4||M.some(function(Je){return typeof Je!="number"||Je<0||Je>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(_=s.parse(_,2,Qt)))return null;var P=[],F=null;c==="interpolate-hcl"||c==="interpolate-lab"?F=Yr:s.expectedType&&s.expectedType.kind!=="value"&&(F=s.expectedType);for(var j=0;j<b.length;j+=2){var H=b[j],te=b[j+1],ue=j+3,De=j+4;if(typeof H!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ue);if(P.length&&P[P.length-1][0]>=H)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ue);var Be=s.parse(te,De,F);if(!Be)return null;F=F||Be.type,P.push([H,Be])}return F.kind==="number"||F.kind==="color"||F.kind==="array"&&F.itemType.kind==="number"&&typeof F.N=="number"?new Ra(F,c,m,_,P):s.error("Type "+xi(F)+" is not interpolatable.")},Ra.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;if(m>=s[_-1])return c[_-1].evaluate(a);var b=Bl(s,m),E=Ra.interpolationFactor(this.interpolation,m,s[b],s[b+1]),M=c[b].evaluate(a),P=c[b+1].evaluate(a);return this.operator==="interpolate"?zl[this.type.kind.toLowerCase()](M,P,E):this.operator==="interpolate-hcl"?lc.reverse(lc.interpolate(lc.forward(M),lc.forward(P),E)):uc.reverse(uc.interpolate(uc.forward(M),uc.forward(P),E))},Ra.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},Ra.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Ra.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,a,this.input.serialize()],c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s};var Zu=function(a,s){this.type=a,this.args=s};Zu.parse=function(a,s){if(a.length<2)return s.error("Expectected at least one argument.");var c=null,m=s.expectedType;m&&m.kind!=="value"&&(c=m);for(var _=[],b=0,E=a.slice(1);b<E.length;b+=1){var M=s.parse(E[b],1+_.length,c,void 0,{typeAnnotation:"omit"});if(!M)return null;c=c||M.type,_.push(M)}var P=m&&_.some(function(F){return Ui(m,F.type)});return new Zu(P?qr:c,_)},Zu.prototype.evaluate=function(a){for(var s,c=null,m=0,_=0,b=this.args;_<b.length&&(m++,(c=b[_].evaluate(a))&&c instanceof ha&&!c.available&&(s||(s=c.name),c=null,m===this.args.length&&(c=s)),c===null);_+=1);return c},Zu.prototype.eachChild=function(a){this.args.forEach(a)},Zu.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Zu.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Bs=function(a,s){this.type=s.type,this.bindings=[].concat(a),this.result=s};Bs.prototype.evaluate=function(a){return this.result.evaluate(a)},Bs.prototype.eachChild=function(a){for(var s=0,c=this.bindings;s<c.length;s+=1)a(c[s][1]);a(this.result)},Bs.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var c=[],m=1;m<a.length-1;m+=2){var _=a[m];if(typeof _!="string")return s.error("Expected string, but found "+typeof _+" instead.",m);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);var b=s.parse(a[m+1],m+1);if(!b)return null;c.push([_,b])}var E=s.parse(a[a.length-1],a.length-1,s.expectedType,c);return E?new Bs(c,E):null},Bs.prototype.outputDefined=function(){return this.result.outputDefined()},Bs.prototype.serialize=function(){for(var a=["let"],s=0,c=this.bindings;s<c.length;s+=1){var m=c[s];a.push(m[0],m[1].serialize())}return a.push(this.result.serialize()),a};var ll=function(a,s,c){this.type=a,this.index=s,this.input=c};ll.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,Qt),m=s.parse(a[2],2,_i(s.expectedType||qr));return c&&m?new ll(m.type.itemType,c,m):null},ll.prototype.evaluate=function(a){var s=this.index.evaluate(a),c=this.input.evaluate(a);if(s<0)throw new ra("Array index out of bounds: "+s+" < 0.");if(s>=c.length)throw new ra("Array index out of bounds: "+s+" > "+(c.length-1)+".");if(s!==Math.floor(s))throw new ra("Array index must be an integer, but found "+s+" instead.");return c[s]},ll.prototype.eachChild=function(a){a(this.index),a(this.input)},ll.prototype.outputDefined=function(){return!1},ll.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var zs=function(a,s){this.type=Gr,this.needle=a,this.haystack=s};zs.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,qr),m=s.parse(a[2],2,qr);return c&&m?aa(c.type,[Gr,en,Qt,ln,qr])?new zs(c,m):s.error("Expected first argument to be of type boolean, string, number or null, but found "+xi(c.type)+" instead"):null},zs.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!c)return!1;if(!bi(s,["boolean","string","number","null"]))throw new ra("Expected first argument to be of type boolean, string, number or null, but found "+xi(oa(s))+" instead.");if(!bi(c,["string","array"]))throw new ra("Expected second argument to be of type array or string, but found "+xi(oa(c))+" instead.");return c.indexOf(s)>=0},zs.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},zs.prototype.outputDefined=function(){return!0},zs.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ii=function(a,s,c){this.type=Qt,this.needle=a,this.haystack=s,this.fromIndex=c};ii.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,qr),m=s.parse(a[2],2,qr);if(!c||!m)return null;if(!aa(c.type,[Gr,en,Qt,ln,qr]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+xi(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,Qt);return _?new ii(c,m,_):null}return new ii(c,m)},ii.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!bi(s,["boolean","string","number","null"]))throw new ra("Expected first argument to be of type boolean, string, number or null, but found "+xi(oa(s))+" instead.");if(!bi(c,["string","array"]))throw new ra("Expected second argument to be of type array or string, but found "+xi(oa(c))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(a);return c.indexOf(s,m)}return c.indexOf(s)},ii.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},ii.prototype.outputDefined=function(){return!1},ii.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ns=function(a,s,c,m,_,b){this.inputType=a,this.type=s,this.input=c,this.cases=m,this.outputs=_,this.otherwise=b};Ns.parse=function(a,s){if(a.length<5)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return s.error("Expected an even number of arguments.");var c,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);for(var _={},b=[],E=2;E<a.length-1;E+=2){var M=a[E],P=a[E+1];Array.isArray(M)||(M=[M]);var F=s.concat(E);if(M.length===0)return F.error("Expected at least one branch label.");for(var j=0,H=M;j<H.length;j+=1){var te=H[j];if(typeof te!="number"&&typeof te!="string")return F.error("Branch labels must be numbers or strings.");if(typeof te=="number"&&Math.abs(te)>Number.MAX_SAFE_INTEGER)return F.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof te=="number"&&Math.floor(te)!==te)return F.error("Numeric branch labels must be integer values.");if(c){if(F.checkSubtype(c,oa(te)))return null}else c=oa(te);if(_[String(te)]!==void 0)return F.error("Branch labels must be unique.");_[String(te)]=b.length}var ue=s.parse(P,E,m);if(!ue)return null;m=m||ue.type,b.push(ue)}var De=s.parse(a[1],1,qr);if(!De)return null;var Be=s.parse(a[a.length-1],a.length-1,m);return Be?De.type.kind!=="value"&&s.concat(1).checkSubtype(c,De.type)?null:new Ns(c,m,De,_,b,Be):null},Ns.prototype.evaluate=function(a){var s=this.input.evaluate(a);return(oa(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(a)},Ns.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Ns.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Ns.prototype.serialize=function(){for(var a=this,s=["match",this.input.serialize()],c=[],m={},_=0,b=Object.keys(this.cases).sort();_<b.length;_+=1){var E=b[_];(H=m[this.cases[E]])===void 0?(m[this.cases[E]]=c.length,c.push([this.cases[E],[E]])):c[H][1].push(E)}for(var M=function(ue){return a.inputType.kind==="number"?Number(ue):ue},P=0,F=c;P<F.length;P+=1){var j=F[P],H=j[0],te=j[1];s.push(te.length===1?M(te[0]):te.map(M)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var Eu=function(a,s,c){this.type=a,this.branches=s,this.otherwise=c};Eu.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return s.error("Expected an odd number of arguments.");var c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);for(var m=[],_=1;_<a.length-1;_+=2){var b=s.parse(a[_],_,Gr);if(!b)return null;var E=s.parse(a[_+1],_+1,c);if(!E)return null;m.push([b,E]),c=c||E.type}var M=s.parse(a[a.length-1],a.length-1,c);return M?new Eu(c,m,M):null},Eu.prototype.evaluate=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];if(m[0].evaluate(a))return _.evaluate(a)}return this.otherwise.evaluate(a)},Eu.prototype.eachChild=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];a(m[0]),a(_)}a(this.otherwise)},Eu.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},Eu.prototype.serialize=function(){var a=["case"];return this.eachChild(function(s){a.push(s.serialize())}),a};var qo=function(a,s,c,m){this.type=a,this.input=s,this.beginIndex=c,this.endIndex=m};function cc(a,s){return a==="=="||a==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function sh(a,s,c,m){return m.compare(s,c)===0}function kn(a,s,c){var m=a!=="=="&&a!=="!=";return function(){function _(b,E,M){this.type=Gr,this.lhs=b,this.rhs=E,this.collator=M,this.hasUntypedArgument=b.type.kind==="value"||E.type.kind==="value"}return _.parse=function(b,E){if(b.length!==3&&b.length!==4)return E.error("Expected two or three arguments.");var M=b[0],P=E.parse(b[1],1,qr);if(!P)return null;if(!cc(M,P.type))return E.concat(1).error('"'+M+`" comparisons are not supported for type '`+xi(P.type)+"'.");var F=E.parse(b[2],2,qr);if(!F)return null;if(!cc(M,F.type))return E.concat(2).error('"'+M+`" comparisons are not supported for type '`+xi(F.type)+"'.");if(P.type.kind!==F.type.kind&&P.type.kind!=="value"&&F.type.kind!=="value")return E.error("Cannot compare types '"+xi(P.type)+"' and '"+xi(F.type)+"'.");m&&(P.type.kind==="value"&&F.type.kind!=="value"?P=new zi(F.type,[P]):P.type.kind!=="value"&&F.type.kind==="value"&&(F=new zi(P.type,[F])));var j=null;if(b.length===4){if(P.type.kind!=="string"&&F.type.kind!=="string"&&P.type.kind!=="value"&&F.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(!(j=E.parse(b[3],3,hi)))return null}return new _(P,F,j)},_.prototype.evaluate=function(b){var E=this.lhs.evaluate(b),M=this.rhs.evaluate(b);if(m&&this.hasUntypedArgument){var P=oa(E),F=oa(M);if(P.kind!==F.kind||P.kind!=="string"&&P.kind!=="number")throw new ra('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+P.kind+", "+F.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var j=oa(E),H=oa(M);if(j.kind!=="string"||H.kind!=="string")return s(b,E,M)}return this.collator?c(b,E,M,this.collator.evaluate(b)):s(b,E,M)},_.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var b=[a];return this.eachChild(function(E){b.push(E.serialize())}),b},_}()}qo.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,qr),m=s.parse(a[2],2,Qt);if(!c||!m)return null;if(!aa(c.type,[_i(qr),en,qr]))return s.error("Expected first argument to be of type array or string, but found "+xi(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,Qt);return _?new qo(c.type,c,m,_):null}return new qo(c.type,c,m)},qo.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=this.beginIndex.evaluate(a);if(!bi(s,["string","array"]))throw new ra("Expected first argument to be of type array or string, but found "+xi(oa(s))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(a);return s.slice(c,m)}return s.slice(c)},qo.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},qo.prototype.outputDefined=function(){return!1},qo.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var gs=kn("==",function(a,s,c){return s===c},sh),Ko=kn("!=",function(a,s,c){return s!==c},function(a,s,c,m){return!sh(0,s,c,m)}),Uu=kn("<",function(a,s,c){return s<c},function(a,s,c,m){return m.compare(s,c)<0}),uh=kn(">",function(a,s,c){return s>c},function(a,s,c,m){return m.compare(s,c)>0}),Hc=kn("<=",function(a,s,c){return s<=c},function(a,s,c,m){return m.compare(s,c)<=0}),pa=kn(">=",function(a,s,c){return s>=c},function(a,s,c,m){return m.compare(s,c)>=0}),cl=function(a,s,c,m,_){this.type=en,this.number=a,this.locale=s,this.currency=c,this.minFractionDigits=m,this.maxFractionDigits=_};cl.parse=function(a,s){if(a.length!==3)return s.error("Expected two arguments.");var c=s.parse(a[1],1,Qt);if(!c)return null;var m=a[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");var _=null;if(m.locale&&!(_=s.parse(m.locale,1,en)))return null;var b=null;if(m.currency&&!(b=s.parse(m.currency,1,en)))return null;var E=null;if(m["min-fraction-digits"]&&!(E=s.parse(m["min-fraction-digits"],1,Qt)))return null;var M=null;return m["max-fraction-digits"]&&!(M=s.parse(m["max-fraction-digits"],1,Qt))?null:new cl(c,_,b,E,M)},cl.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},cl.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},cl.prototype.outputDefined=function(){return!1},cl.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var Vu=function(a){this.type=Qt,this.input=a};Vu.parse=function(a,s){if(a.length!==2)return s.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+xi(c.type)+" instead."):new Vu(c):null},Vu.prototype.evaluate=function(a){var s=this.input.evaluate(a);if(typeof s=="string"||Array.isArray(s))return s.length;throw new ra("Expected value to be of type string or array, but found "+xi(oa(s))+" instead.")},Vu.prototype.eachChild=function(a){a(this.input)},Vu.prototype.outputDefined=function(){return!1},Vu.prototype.serialize=function(){var a=["length"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Mo={"==":gs,"!=":Ko,">":uh,"<":Uu,">=":pa,"<=":Hc,array:zi,at:ll,boolean:zi,case:Eu,coalesce:Zu,collator:ga,format:To,image:mo,in:zs,"index-of":ii,interpolate:Ra,"interpolate-hcl":Ra,"interpolate-lab":Ra,length:Vu,let:Bs,literal:Hn,match:Ns,number:zi,"number-format":cl,object:zi,slice:qo,step:Yo,string:zi,"to-boolean":is,"to-color":is,"to-number":is,"to-string":is,var:zu,within:Fs};function Wc(a,s){var c=s[0],m=s[1],_=s[2],b=s[3];c=c.evaluate(a),m=m.evaluate(a),_=_.evaluate(a);var E=b?b.evaluate(a):1,M=Su(c,m,_,E);if(M)throw new ra(M);return new vi(c/255*E,m/255*E,_/255*E,E)}function $c(a,s){return a in s}function Au(a,s){var c=s[a];return c===void 0?null:c}function qi(a){return{type:a}}function Zl(a){return{result:"success",value:a}}function Zs(a){return{result:"error",value:a}}function Cu(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Ef(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function fl(a){return!!a.expression&&a.expression.interpolated}function Yi(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function ju(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function lh(a){return a}function Us(a,s,c){return a!==void 0?a:s!==void 0?s:c!==void 0?c:void 0}function ch(a,s,c,m,_){return Us(typeof c===_?m[c]:void 0,a.default,s.default)}function fc(a,s,c){if(Yi(c)!=="number")return Us(a.default,s.default);var m=a.stops.length;if(m===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[m-1][0])return a.stops[m-1][1];var _=Bl(a.stops.map(function(b){return b[0]}),c);return a.stops[_][1]}function hc(a,s,c){var m=a.base!==void 0?a.base:1;if(Yi(c)!=="number")return Us(a.default,s.default);var _=a.stops.length;if(_===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[_-1][0])return a.stops[_-1][1];var b=Bl(a.stops.map(function(H){return H[0]}),c),E=function(H,te,ue,De){var Be=De-ue,Je=H-ue;return Be===0?0:te===1?Je/Be:(Math.pow(te,Je)-1)/(Math.pow(te,Be)-1)}(c,m,a.stops[b][0],a.stops[b+1][0]),M=a.stops[b][1],P=a.stops[b+1][1],F=zl[s.type]||lh;if(a.colorSpace&&a.colorSpace!=="rgb"){var j=oh[a.colorSpace];F=function(H,te){return j.reverse(j.interpolate(j.forward(H),j.forward(te),E))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var H=[],te=arguments.length;te--;)H[te]=arguments[te];var ue=M.evaluate.apply(void 0,H),De=P.evaluate.apply(void 0,H);if(ue!==void 0&&De!==void 0)return F(ue,De,E)}}:F(M,P,E)}function Ul(a,s,c){return s.type==="color"?c=vi.parse(c):s.type==="formatted"?c=Ki.fromString(c.toString()):s.type==="resolvedImage"?c=ha.fromString(c.toString()):Yi(c)===s.type||s.type==="enum"&&s.values[c]||(c=void 0),Us(c,a.default,s.default)}la.register(Mo,{error:[{kind:"error"},[en],function(a,s){throw new ra(s[0].evaluate(a))}],typeof:[en,[qr],function(a,s){return xi(oa(s[0].evaluate(a)))}],"to-rgba":[_i(Qt,4),[Yr],function(a,s){return s[0].evaluate(a).toArray()}],rgb:[Yr,[Qt,Qt,Qt],Wc],rgba:[Yr,[Qt,Qt,Qt,Qt],Wc],has:{type:Gr,overloads:[[[en],function(a,s){return $c(s[0].evaluate(a),a.properties())}],[[en,li],function(a,s){var c=s[1];return $c(s[0].evaluate(a),c.evaluate(a))}]]},get:{type:qr,overloads:[[[en],function(a,s){return Au(s[0].evaluate(a),a.properties())}],[[en,li],function(a,s){var c=s[1];return Au(s[0].evaluate(a),c.evaluate(a))}]]},"feature-state":[qr,[en],function(a,s){return Au(s[0].evaluate(a),a.featureState||{})}],properties:[li,[],function(a){return a.properties()}],"geometry-type":[en,[],function(a){return a.geometryType()}],id:[qr,[],function(a){return a.id()}],zoom:[Qt,[],function(a){return a.globals.zoom}],"heatmap-density":[Qt,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[Qt,[],function(a){return a.globals.lineProgress||0}],accumulated:[qr,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[Qt,qi(Qt),function(a,s){for(var c=0,m=0,_=s;m<_.length;m+=1)c+=_[m].evaluate(a);return c}],"*":[Qt,qi(Qt),function(a,s){for(var c=1,m=0,_=s;m<_.length;m+=1)c*=_[m].evaluate(a);return c}],"-":{type:Qt,overloads:[[[Qt,Qt],function(a,s){var c=s[1];return s[0].evaluate(a)-c.evaluate(a)}],[[Qt],function(a,s){return-s[0].evaluate(a)}]]},"/":[Qt,[Qt,Qt],function(a,s){var c=s[1];return s[0].evaluate(a)/c.evaluate(a)}],"%":[Qt,[Qt,Qt],function(a,s){var c=s[1];return s[0].evaluate(a)%c.evaluate(a)}],ln2:[Qt,[],function(){return Math.LN2}],pi:[Qt,[],function(){return Math.PI}],e:[Qt,[],function(){return Math.E}],"^":[Qt,[Qt,Qt],function(a,s){var c=s[1];return Math.pow(s[0].evaluate(a),c.evaluate(a))}],sqrt:[Qt,[Qt],function(a,s){return Math.sqrt(s[0].evaluate(a))}],log10:[Qt,[Qt],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN10}],ln:[Qt,[Qt],function(a,s){return Math.log(s[0].evaluate(a))}],log2:[Qt,[Qt],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN2}],sin:[Qt,[Qt],function(a,s){return Math.sin(s[0].evaluate(a))}],cos:[Qt,[Qt],function(a,s){return Math.cos(s[0].evaluate(a))}],tan:[Qt,[Qt],function(a,s){return Math.tan(s[0].evaluate(a))}],asin:[Qt,[Qt],function(a,s){return Math.asin(s[0].evaluate(a))}],acos:[Qt,[Qt],function(a,s){return Math.acos(s[0].evaluate(a))}],atan:[Qt,[Qt],function(a,s){return Math.atan(s[0].evaluate(a))}],min:[Qt,qi(Qt),function(a,s){return Math.min.apply(Math,s.map(function(c){return c.evaluate(a)}))}],max:[Qt,qi(Qt),function(a,s){return Math.max.apply(Math,s.map(function(c){return c.evaluate(a)}))}],abs:[Qt,[Qt],function(a,s){return Math.abs(s[0].evaluate(a))}],round:[Qt,[Qt],function(a,s){var c=s[0].evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[Qt,[Qt],function(a,s){return Math.floor(s[0].evaluate(a))}],ceil:[Qt,[Qt],function(a,s){return Math.ceil(s[0].evaluate(a))}],"filter-==":[Gr,[en,qr],function(a,s){var c=s[0],m=s[1];return a.properties()[c.value]===m.value}],"filter-id-==":[Gr,[qr],function(a,s){var c=s[0];return a.id()===c.value}],"filter-type-==":[Gr,[en],function(a,s){var c=s[0];return a.geometryType()===c.value}],"filter-<":[Gr,[en,qr],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_<b}],"filter-id-<":[Gr,[qr],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<_}],"filter->":[Gr,[en,qr],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_>b}],"filter-id->":[Gr,[qr],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>_}],"filter-<=":[Gr,[en,qr],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_<=b}],"filter-id-<=":[Gr,[qr],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<=_}],"filter->=":[Gr,[en,qr],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_>=b}],"filter-id->=":[Gr,[qr],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>=_}],"filter-has":[Gr,[qr],function(a,s){return s[0].value in a.properties()}],"filter-has-id":[Gr,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[Gr,[_i(en)],function(a,s){return s[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[Gr,[_i(qr)],function(a,s){return s[0].value.indexOf(a.id())>=0}],"filter-in-small":[Gr,[en,_i(qr)],function(a,s){var c=s[0];return s[1].value.indexOf(a.properties()[c.value])>=0}],"filter-in-large":[Gr,[en,_i(qr)],function(a,s){var c=s[0],m=s[1];return function(_,b,E,M){for(;E<=M;){var P=E+M>>1;if(b[P]===_)return!0;b[P]>_?M=P-1:E=P+1}return!1}(a.properties()[c.value],m.value,0,m.value.length-1)}],all:{type:Gr,overloads:[[[Gr,Gr],function(a,s){var c=s[1];return s[0].evaluate(a)&&c.evaluate(a)}],[qi(Gr),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(!m[c].evaluate(a))return!1;return!0}]]},any:{type:Gr,overloads:[[[Gr,Gr],function(a,s){var c=s[1];return s[0].evaluate(a)||c.evaluate(a)}],[qi(Gr),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(m[c].evaluate(a))return!0;return!1}]]},"!":[Gr,[Gr],function(a,s){return!s[0].evaluate(a)}],"is-supported-script":[Gr,[en],function(a,s){var c=a.globals&&a.globals.isSupportedScript;return!c||c(s[0].evaluate(a))}],upcase:[en,[en],function(a,s){return s[0].evaluate(a).toUpperCase()}],downcase:[en,[en],function(a,s){return s[0].evaluate(a).toLowerCase()}],concat:[en,qi(qr),function(a,s){return s.map(function(c){return vo(c.evaluate(a))}).join("")}],"resolved-locale":[en,[hi],function(a,s){return s[0].evaluate(a).resolvedLocale()}]});var hl=function(a,s){this.expression=a,this._warningHistory={},this._evaluator=new Xo,this._defaultValue=s?function(c){return c.type==="color"&&ju(c.default)?new vi(0,0,0,0):c.type==="color"?vi.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function ys(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Mo}function pc(a,s){var c=new Js(Mo,[],s?function(_){var b={color:Yr,string:en,number:Qt,enum:en,boolean:Gr,formatted:Bi,resolvedImage:ci};return _.type==="array"?_i(b[_.value]||qr,_.length):b[_.type]}(s):void 0),m=c.parse(a,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Zl(new hl(m,s)):Zs(c.errors)}hl.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,b){return this._evaluator.globals=a,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},hl.prototype.evaluate=function(a,s,c,m,_,b){this._evaluator.globals=a,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b||null;try{var E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new ra("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(E)+" instead.");return E}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var Vl=function(a,s){this.kind=a,this._styleExpression=s,this.isStateDependent=a!=="constant"&&!os(s.expression)};Vl.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,b){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,b)},Vl.prototype.evaluate=function(a,s,c,m,_,b){return this._styleExpression.evaluate(a,s,c,m,_,b)};var Gu=function(a,s,c,m){this.kind=a,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=a!=="camera"&&!os(s.expression),this.interpolationType=m};function dc(a,s){if((a=pc(a,s)).result==="error")return a;var c=a.value.expression,m=Bu(c);if(!m&&!Cu(s))return Zs([new br("","data expressions not supported")]);var _=ul(c,["zoom"]);if(!_&&!Ef(s))return Zs([new br("","zoom expressions not supported")]);var b=function E(M){var P=null;if(M instanceof Bs)P=E(M.result);else if(M instanceof Zu)for(var F=0,j=M.args;F<j.length&&!(P=E(j[F]));F+=1);else(M instanceof Yo||M instanceof Ra)&&M.input instanceof la&&M.input.name==="zoom"&&(P=M);return P instanceof br||M.eachChild(function(H){var te=E(H);te instanceof br?P=te:!P&&te?P=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):P&&te&&P!==te&&(P=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),P}(c);return b||_?b instanceof br?Zs([b]):b instanceof Ra&&!fl(s)?Zs([new br("",'"interpolate" expressions cannot be used with this property')]):Zl(b?new Gu(m?"camera":"composite",a.value,b.labels,b instanceof Ra?b.interpolation:void 0):new Vl(m?"constant":"source",a.value)):Zs([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Gu.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,b){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,b)},Gu.prototype.evaluate=function(a,s,c,m,_,b){return this._styleExpression.evaluate(a,s,c,m,_,b)},Gu.prototype.interpolationFactor=function(a,s,c){return this.interpolationType?Ra.interpolationFactor(this.interpolationType,a,s,c):0};var jl=function(a,s){this._parameters=a,this._specification=s,lt(this,function c(m,_){var b,E,M,P=_.type==="color",F=m.stops&&typeof m.stops[0][0]=="object",j=F||!(F||m.property!==void 0),H=m.type||(fl(_)?"exponential":"interval");if(P&&((m=lt({},m)).stops&&(m.stops=m.stops.map(function(nn){return[nn[0],vi.parse(nn[1])]})),m.default=vi.parse(m.default?m.default:_.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!oh[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(H==="exponential")b=hc;else if(H==="interval")b=fc;else if(H==="categorical"){b=ch,E=Object.create(null);for(var te=0,ue=m.stops;te<ue.length;te+=1){var De=ue[te];E[De[0]]=De[1]}M=typeof m.stops[0][0]}else{if(H!=="identity")throw new Error('Unknown function type "'+H+'"');b=Ul}if(F){for(var Be={},Je=[],He=0;He<m.stops.length;He++){var mt=m.stops[He],Lt=mt[0].zoom;Be[Lt]===void 0&&(Be[Lt]={zoom:Lt,type:m.type,property:m.property,default:m.default,stops:[]},Je.push(Lt)),Be[Lt].stops.push([mt[0].value,mt[1]])}for(var zt=[],Zt=0,ur=Je;Zt<ur.length;Zt+=1){var yr=ur[Zt];zt.push([Be[yr].zoom,c(Be[yr],_)])}var Xr={name:"linear"};return{kind:"composite",interpolationType:Xr,interpolationFactor:Ra.interpolationFactor.bind(void 0,Xr),zoomStops:zt.map(function(nn){return nn[0]}),evaluate:function(nn,Bn){var sn=nn.zoom;return hc({stops:zt,base:m.base},_,sn).evaluate(sn,Bn)}}}if(j){var Fn=H==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:Fn,interpolationFactor:Ra.interpolationFactor.bind(void 0,Fn),zoomStops:m.stops.map(function(nn){return nn[0]}),evaluate:function(nn){return b(m,_,nn.zoom,E,M)}}}return{kind:"source",evaluate:function(nn,Bn){var sn=Bn&&Bn.properties?Bn.properties[m.property]:void 0;return sn===void 0?Us(m.default,_.default):b(m,_,sn,E,M)}}}(this._parameters,this._specification))};function ss(a){var s=a.key,c=a.value,m=a.valueSpec||{},_=a.objectElementValidators||{},b=a.style,E=a.styleSpec,M=[],P=Yi(c);if(P!=="object")return[new J(s,c,"object expected, "+P+" found")];for(var F in c){var j=F.split(".")[0],H=m[j]||m["*"],te=void 0;if(_[j])te=_[j];else if(m[j])te=Si;else if(_["*"])te=_["*"];else{if(!m["*"]){M.push(new J(s,c[F],'unknown property "'+F+'"'));continue}te=Si}M=M.concat(te({key:(s&&s+".")+F,value:c[F],valueSpec:H,style:b,styleSpec:E,object:c,objectKey:F},c))}for(var ue in m)_[ue]||m[ue].required&&m[ue].default===void 0&&c[ue]===void 0&&M.push(new J(s,c,'missing required property "'+ue+'"'));return M}function Af(a){var s=a.value,c=a.valueSpec,m=a.style,_=a.styleSpec,b=a.key,E=a.arrayElementValidator||Si;if(Yi(s)!=="array")return[new J(b,s,"array expected, "+Yi(s)+" found")];if(c.length&&s.length!==c.length)return[new J(b,s,"array length "+c.length+" expected, length "+s.length+" found")];if(c["min-length"]&&s.length<c["min-length"])return[new J(b,s,"array length at least "+c["min-length"]+" expected, length "+s.length+" found")];var M={type:c.value,values:c.values};_.$version<7&&(M.function=c.function),Yi(c.value)==="object"&&(M=c.value);for(var P=[],F=0;F<s.length;F++)P=P.concat(E({array:s,arrayIndex:F,value:s[F],valueSpec:M,style:m,styleSpec:_,key:b+"["+F+"]"}));return P}function vc(a){var s=a.key,c=a.value,m=a.valueSpec,_=Yi(c);return _==="number"&&c!=c&&(_="NaN"),_!=="number"?[new J(s,c,"number expected, "+_+" found")]:"minimum"in m&&c<m.minimum?[new J(s,c,c+" is less than the minimum value "+m.minimum)]:"maximum"in m&&c>m.maximum?[new J(s,c,c+" is greater than the maximum value "+m.maximum)]:[]}function Gl(a){var s,c,m,_=a.valueSpec,b=dt(a.value.type),E={},M=b!=="categorical"&&a.value.property===void 0,P=!M,F=Yi(a.value.stops)==="array"&&Yi(a.value.stops[0])==="array"&&Yi(a.value.stops[0][0])==="object",j=ss({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(ue){if(b==="identity")return[new J(ue.key,ue.value,'identity function may not have a "stops" property')];var De=[],Be=ue.value;return De=De.concat(Af({key:ue.key,value:Be,valueSpec:ue.valueSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:H})),Yi(Be)==="array"&&Be.length===0&&De.push(new J(ue.key,Be,"array must have at least one stop")),De},default:function(ue){return Si({key:ue.key,value:ue.value,valueSpec:_,style:ue.style,styleSpec:ue.styleSpec})}}});return b==="identity"&&M&&j.push(new J(a.key,a.value,'missing required property "property"')),b==="identity"||a.value.stops||j.push(new J(a.key,a.value,'missing required property "stops"')),b==="exponential"&&a.valueSpec.expression&&!fl(a.valueSpec)&&j.push(new J(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(P&&!Cu(a.valueSpec)?j.push(new J(a.key,a.value,"property functions not supported")):M&&!Ef(a.valueSpec)&&j.push(new J(a.key,a.value,"zoom functions not supported"))),b!=="categorical"&&!F||a.value.property!==void 0||j.push(new J(a.key,a.value,'"property" property is required')),j;function H(ue){var De=[],Be=ue.value,Je=ue.key;if(Yi(Be)!=="array")return[new J(Je,Be,"array expected, "+Yi(Be)+" found")];if(Be.length!==2)return[new J(Je,Be,"array length 2 expected, length "+Be.length+" found")];if(F){if(Yi(Be[0])!=="object")return[new J(Je,Be,"object expected, "+Yi(Be[0])+" found")];if(Be[0].zoom===void 0)return[new J(Je,Be,"object stop key must have zoom")];if(Be[0].value===void 0)return[new J(Je,Be,"object stop key must have value")];if(m&&m>dt(Be[0].zoom))return[new J(Je,Be[0].zoom,"stop zoom values must appear in ascending order")];dt(Be[0].zoom)!==m&&(m=dt(Be[0].zoom),c=void 0,E={}),De=De.concat(ss({key:Je+"[0]",value:Be[0],valueSpec:{zoom:{}},style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:vc,value:te}}))}else De=De.concat(te({key:Je+"[0]",value:Be[0],valueSpec:{},style:ue.style,styleSpec:ue.styleSpec},Be));return ys(re(Be[1]))?De.concat([new J(Je+"[1]",Be[1],"expressions are not allowed in function stops.")]):De.concat(Si({key:Je+"[1]",value:Be[1],valueSpec:_,style:ue.style,styleSpec:ue.styleSpec}))}function te(ue,De){var Be=Yi(ue.value),Je=dt(ue.value),He=ue.value!==null?ue.value:De;if(s){if(Be!==s)return[new J(ue.key,He,Be+" stop domain type must match previous stop domain type "+s)]}else s=Be;if(Be!=="number"&&Be!=="string"&&Be!=="boolean")return[new J(ue.key,He,"stop domain value must be a number, string, or boolean")];if(Be!=="number"&&b!=="categorical"){var mt="number expected, "+Be+" found";return Cu(_)&&b===void 0&&(mt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new J(ue.key,He,mt)]}return b!=="categorical"||Be!=="number"||isFinite(Je)&&Math.floor(Je)===Je?b!=="categorical"&&Be==="number"&&c!==void 0&&Je<c?[new J(ue.key,He,"stop domain values must appear in ascending order")]:(c=Je,b==="categorical"&&Je in E?[new J(ue.key,He,"stop domain values must be unique")]:(E[Je]=!0,[])):[new J(ue.key,He,"integer expected, found "+Je)]}}function Hu(a){var s=(a.expressionContext==="property"?dc:pc)(re(a.value),a.valueSpec);if(s.result==="error")return s.value.map(function(m){return new J(""+a.key+m.key,a.value,m.message)});var c=s.value.expression||s.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new J(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!os(c))return[new J(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!os(c))return[new J(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!ul(c,["zoom","feature-state"]))return[new J(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Bu(c))return[new J(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hl(a){var s=a.key,c=a.value,m=a.valueSpec,_=[];return Array.isArray(m.values)?m.values.indexOf(dt(c))===-1&&_.push(new J(s,c,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(m.values).indexOf(dt(c))===-1&&_.push(new J(s,c,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(c)+" found")),_}function Wl(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var s=0,c=a.slice(1);s<c.length;s+=1){var m=c[s];if(!Wl(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}jl.deserialize=function(a){return new jl(a._parameters,a._specification)},jl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var pl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function dl(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};Wl(a)||(a=vl(a));var s=pc(a,pl);if(s.result==="error")throw new Error(s.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,m,_){return s.value.evaluate(c,m,{},_)},needGeometry:function c(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var _=1;_<m.length;_++)if(c(m[_]))return!0;return!1}(a)}}function mc(a,s){return a<s?-1:a>s?1:0}function vl(a){if(!a)return!0;var s,c=a[0];return a.length<=1?c!=="any":c==="=="?Cf(a[1],a[2],"=="):c==="!="?Da(Cf(a[1],a[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Cf(a[1],a[2],c):c==="any"?(s=a.slice(1),["any"].concat(s.map(vl))):c==="all"?["all"].concat(a.slice(1).map(vl)):c==="none"?["all"].concat(a.slice(1).map(vl).map(Da)):c==="in"?fh(a[1],a.slice(2)):c==="!in"?Da(fh(a[1],a.slice(2))):c==="has"?hh(a[1]):c==="!has"?Da(hh(a[1])):c!=="within"||a}function Cf(a,s,c){switch(a){case"$type":return["filter-type-"+c,s];case"$id":return["filter-id-"+c,s];default:return["filter-"+c,a,s]}}function fh(a,s){if(s.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(c){return typeof c!=typeof s[0]})?["filter-in-large",a,["literal",s.sort(mc)]]:["filter-in-small",a,["literal",s]]}}function hh(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Da(a){return["!",a]}function ph(a){return Wl(re(a.value))?Hu(lt({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(c){var m=c.value,_=c.key;if(Yi(m)!=="array")return[new J(_,m,"array expected, "+Yi(m)+" found")];var b,E=c.styleSpec,M=[];if(m.length<1)return[new J(_,m,"filter array must have at least 1 element")];switch(M=M.concat(Hl({key:_+"[0]",value:m[0],valueSpec:E.filter_operator,style:c.style,styleSpec:c.styleSpec})),dt(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&dt(m[1])==="$type"&&M.push(new J(_,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&M.push(new J(_,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(b=Yi(m[1]))!=="string"&&M.push(new J(_+"[1]",m[1],"string expected, "+b+" found"));for(var P=2;P<m.length;P++)b=Yi(m[P]),dt(m[1])==="$type"?M=M.concat(Hl({key:_+"["+P+"]",value:m[P],valueSpec:E.geometry_type,style:c.style,styleSpec:c.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&M.push(new J(_+"["+P+"]",m[P],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var F=1;F<m.length;F++)M=M.concat(s({key:_+"["+F+"]",value:m[F],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":b=Yi(m[1]),m.length!==2?M.push(new J(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):b!=="string"&&M.push(new J(_+"[1]",m[1],"string expected, "+b+" found"));break;case"within":b=Yi(m[1]),m.length!==2?M.push(new J(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):b!=="object"&&M.push(new J(_+"[1]",m[1],"object expected, "+b+" found"))}return M}(a)}function dh(a,s){var c=a.key,m=a.style,_=a.styleSpec,b=a.value,E=a.objectKey,M=_[s+"_"+a.layerType];if(!M)return[];var P=E.match(/^(.*)-transition$/);if(s==="paint"&&P&&M[P[1]]&&M[P[1]].transition)return Si({key:c,value:b,valueSpec:_.transition,style:m,styleSpec:_});var F,j=a.valueSpec||M[E];if(!j)return[new J(c,b,'unknown property "'+E+'"')];if(Yi(b)==="string"&&Cu(j)&&!j.tokens&&(F=/^{([^}]+)}$/.exec(b)))return[new J(c,b,'"'+E+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(F[1])+" }`.")];var H=[];return a.layerType==="symbol"&&(E==="text-field"&&m&&!m.glyphs&&H.push(new J(c,b,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&ju(re(b))&&dt(b.type)==="identity"&&H.push(new J(c,b,'"text-font" does not support identity functions'))),H.concat(Si({key:a.key,value:b,valueSpec:j,style:m,styleSpec:_,expressionContext:"property",propertyType:s,propertyKey:E}))}function vh(a){return dh(a,"paint")}function ml(a){return dh(a,"layout")}function Uh(a){var s=[],c=a.value,m=a.key,_=a.style,b=a.styleSpec;c.type||c.ref||s.push(new J(m,c,'either "type" or "ref" is required'));var E,M=dt(c.type),P=dt(c.ref);if(c.id)for(var F=dt(c.id),j=0;j<a.arrayIndex;j++){var H=_.layers[j];dt(H.id)===F&&s.push(new J(m,c.id,'duplicate layer id "'+c.id+'", previously used at line '+H.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function(De){De in c&&s.push(new J(m,c[De],'"'+De+'" is prohibited for ref layers'))}),_.layers.forEach(function(De){dt(De.id)===P&&(E=De)}),E?E.ref?s.push(new J(m,c.ref,"ref cannot reference another ref layer")):M=dt(E.type):s.push(new J(m,c.ref,'ref layer "'+P+'" not found'));else if(M!=="background")if(c.source){var te=_.sources&&_.sources[c.source],ue=te&&dt(te.type);te?ue==="vector"&&M==="raster"?s.push(new J(m,c.source,'layer "'+c.id+'" requires a raster source')):ue==="raster"&&M!=="raster"?s.push(new J(m,c.source,'layer "'+c.id+'" requires a vector source')):ue!=="vector"||c["source-layer"]?ue==="raster-dem"&&M!=="hillshade"?s.push(new J(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!c.paint||!c.paint["line-gradient"]||ue==="geojson"&&te.lineMetrics||s.push(new J(m,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new J(m,c,'layer "'+c.id+'" must specify a "source-layer"')):s.push(new J(m,c.source,'source "'+c.source+'" not found'))}else s.push(new J(m,c,'missing required property "source"'));return s=s.concat(ss({key:m,value:c,valueSpec:b.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Si({key:m+".type",value:c.type,valueSpec:b.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"})},filter:ph,layout:function(De){return ss({layer:c,key:De.key,value:De.value,style:De.style,styleSpec:De.styleSpec,objectElementValidators:{"*":function(Be){return ml(lt({layerType:M},Be))}}})},paint:function(De){return ss({layer:c,key:De.key,value:De.value,style:De.style,styleSpec:De.styleSpec,objectElementValidators:{"*":function(Be){return vh(lt({layerType:M},Be))}}})}}}))}function _s(a){var s=a.value,c=a.key,m=Yi(s);return m!=="string"?[new J(c,s,"string expected, "+m+" found")]:[]}var Ji={promoteId:function(a){var s=a.key,c=a.value;if(Yi(c)==="string")return _s({key:s,value:c});var m=[];for(var _ in c)m.push.apply(m,_s({key:s+"."+_,value:c[_]}));return m}};function Wu(a){var s=a.value,c=a.key,m=a.styleSpec,_=a.style;if(!s.type)return[new J(c,s,'"type" is required')];var b,E=dt(s.type);switch(E){case"vector":case"raster":case"raster-dem":return ss({key:c,value:s,valueSpec:m["source_"+E.replace("-","_")],style:a.style,styleSpec:m,objectElementValidators:Ji});case"geojson":if(b=ss({key:c,value:s,valueSpec:m.source_geojson,style:_,styleSpec:m,objectElementValidators:Ji}),s.cluster)for(var M in s.clusterProperties){var P=s.clusterProperties[M],F=P[0],j=typeof F=="string"?[F,["accumulated"],["get",M]]:F;b.push.apply(b,Hu({key:c+"."+M+".map",value:P[1],expressionContext:"cluster-map"})),b.push.apply(b,Hu({key:c+"."+M+".reduce",value:j,expressionContext:"cluster-reduce"}))}return b;case"video":return ss({key:c,value:s,valueSpec:m.source_video,style:_,styleSpec:m});case"image":return ss({key:c,value:s,valueSpec:m.source_image,style:_,styleSpec:m});case"canvas":return[new J(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hl({key:c+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:m})}}function su(a){var s=a.value,c=a.styleSpec,m=c.light,_=a.style,b=[],E=Yi(s);if(s===void 0)return b;if(E!=="object")return b.concat([new J("light",s,"object expected, "+E+" found")]);for(var M in s){var P=M.match(/^(.*)-transition$/);b=b.concat(P&&m[P[1]]&&m[P[1]].transition?Si({key:M,value:s[M],valueSpec:c.transition,style:_,styleSpec:c}):m[M]?Si({key:M,value:s[M],valueSpec:m[M],style:_,styleSpec:c}):[new J(M,s[M],'unknown property "'+M+'"')])}return b}var Tu={"*":function(){return[]},array:Af,boolean:function(a){var s=a.value,c=a.key,m=Yi(s);return m!=="boolean"?[new J(c,s,"boolean expected, "+m+" found")]:[]},number:vc,color:function(a){var s=a.key,c=a.value,m=Yi(c);return m!=="string"?[new J(s,c,"color expected, "+m+" found")]:fi(c)===null?[new J(s,c,'color expected, "'+c+'" found')]:[]},constants:be,enum:Hl,filter:ph,function:Gl,layer:Uh,object:ss,source:Wu,light:su,string:_s,formatted:function(a){return _s(a).length===0?[]:Hu(a)},resolvedImage:function(a){return _s(a).length===0?[]:Hu(a)}};function Si(a){var s=a.value,c=a.valueSpec,m=a.styleSpec;return c.expression&&ju(dt(s))?Gl(a):c.expression&&ys(re(s))?Hu(a):c.type&&Tu[c.type]?Tu[c.type](a):ss(lt({},a,{valueSpec:c.type?m[c.type]:c}))}function Qi(a){var s=a.value,c=a.key,m=_s(a);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new J(c,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new J(c,s,'"glyphs" url must include a "{range}" token'))),m}function Vs(a,s){s===void 0&&(s=pe);var c=[];return c=c.concat(Si({key:"",value:a,valueSpec:s.$root,styleSpec:s,style:a,objectElementValidators:{glyphs:Qi,"*":function(){return[]}}})),a.constants&&(c=c.concat(be({key:"constants",value:a.constants,style:a,styleSpec:s}))),gc(c)}function gc(a){return[].concat(a).sort(function(s,c){return s.line-c.line})}function yc(a){return function(){for(var s=[],c=arguments.length;c--;)s[c]=arguments[c];return gc(a.apply(this,s))}}Vs.source=yc(Wu),Vs.light=yc(su),Vs.layer=yc(Uh),Vs.filter=yc(ph),Vs.paintProperty=yc(vh),Vs.layoutProperty=yc(ml);var xs=Vs,Vh=xs.light,jh=xs.paintProperty,_c=xs.layoutProperty;function $u(a,s){var c=!1;if(s&&s.length)for(var m=0,_=s;m<_.length;m+=1)a.fire(new Ke(new Error(_[m].message))),c=!0;return c}var Mu=Oa;function Oa(a,s,c){var m=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(s=_[1])+2*(c=_[2]);for(var b=0;b<this.d*this.d;b++){var E=_[3+b],M=_[3+b+1];m.push(E===M?null:_.subarray(E,M))}var P=_[3+m.length+1];this.keys=_.subarray(_[3+m.length],P),this.bboxes=_.subarray(P),this.insert=this._insertReadonly}else{this.d=s+2*c;for(var F=0;F<this.d*this.d;F++)m.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=a,this.padding=c,this.scale=s/a,this.uid=0;var j=c/s*a;this.min=-j,this.max=a+j}Oa.prototype.insert=function(a,s,c,m,_){this._forEachCell(s,c,m,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(_)},Oa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Oa.prototype._insertCell=function(a,s,c,m,_,b){this.cells[_].push(b)},Oa.prototype.query=function(a,s,c,m,_){var b=this.min,E=this.max;if(a<=b&&s<=b&&E<=c&&E<=m&&!_)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(a,s,c,m,this._queryCell,M,{},_),M},Oa.prototype._queryCell=function(a,s,c,m,_,b,E,M){var P=this.cells[_];if(P!==null)for(var F=this.keys,j=this.bboxes,H=0;H<P.length;H++){var te=P[H];if(E[te]===void 0){var ue=4*te;(M?M(j[ue+0],j[ue+1],j[ue+2],j[ue+3]):a<=j[ue+2]&&s<=j[ue+3]&&c>=j[ue+0]&&m>=j[ue+1])?(E[te]=!0,b.push(F[te])):E[te]=!1}}},Oa.prototype._forEachCell=function(a,s,c,m,_,b,E,M){for(var P=this._convertToCellCoord(a),F=this._convertToCellCoord(s),j=this._convertToCellCoord(c),H=this._convertToCellCoord(m),te=P;te<=j;te++)for(var ue=F;ue<=H;ue++){var De=this.d*ue+te;if((!M||M(this._convertFromCellCoord(te),this._convertFromCellCoord(ue),this._convertFromCellCoord(te+1),this._convertFromCellCoord(ue+1)))&&_.call(this,a,s,c,m,De,b,E,M))return}},Oa.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Oa.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Oa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,s=3+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var _=new Int32Array(s+c+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var b=s,E=0;E<a.length;E++){var M=a[E];_[3+E]=b,_.set(M,b),b+=M.length}return _[3+a.length]=b,_.set(this.keys,b),_[3+a.length+1]=b+=this.keys.length,_.set(this.bboxes,b),b+=this.bboxes.length,_.buffer};var Jo=oe.ImageData,uu=oe.ImageBitmap,Fa={};function pn(a,s,c){c===void 0&&(c={}),Object.defineProperty(s,"_classRegistryKey",{value:a,writeable:!1}),Fa[a]={klass:s,omit:c.omit||[],shallow:c.shallow||[]}}for(var No in pn("Object",Object),Mu.serialize=function(a,s){var c=a.toArrayBuffer();return s&&s.push(c),{buffer:c}},Mu.deserialize=function(a){return new Mu(a.buffer)},pn("Grid",Mu),pn("Color",vi),pn("Error",Error),pn("ResolvedImage",ha),pn("StylePropertyFunction",jl),pn("StyleExpression",hl,{omit:["_evaluator"]}),pn("ZoomDependentExpression",Gu),pn("ZoomConstantExpression",Vl),pn("CompoundExpression",la,{omit:["_evaluate"]}),Mo)Mo[No]._classRegistryKey||pn("Expression_"+No,Mo[No]);function Xc(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function gl(a){return uu&&a instanceof uu}function bs(a,s){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Xc(a)||gl(a))return s&&s.push(a),a;if(ArrayBuffer.isView(a)){var c=a;return s&&s.push(c.buffer),c}if(a instanceof Jo)return s&&s.push(a.data.buffer),a;if(Array.isArray(a)){for(var m=[],_=0,b=a;_<b.length;_+=1)m.push(bs(b[_],s));return m}if(typeof a=="object"){var E=a.constructor,M=E._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var P=E.serialize?E.serialize(a,s):{};if(!E.serialize){for(var F in a)if(a.hasOwnProperty(F)&&!(Fa[M].omit.indexOf(F)>=0)){var j=a[F];P[F]=Fa[M].shallow.indexOf(F)>=0?j:bs(j,s)}a instanceof Error&&(P.message=a.message)}if(P.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(P.$name=M),P}throw new Error("can't serialize object of type "+typeof a)}function us(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Xc(a)||gl(a)||ArrayBuffer.isView(a)||a instanceof Jo)return a;if(Array.isArray(a))return a.map(us);if(typeof a=="object"){var s=a.$name||"Object",c=Fa[s].klass;if(!c)throw new Error("can't deserialize unregistered class "+s);if(c.deserialize)return c.deserialize(a);for(var m=Object.create(c.prototype),_=0,b=Object.keys(a);_<b.length;_+=1){var E=b[_];if(E!=="$name"){var M=a[E];m[E]=Fa[s].shallow.indexOf(E)>=0?M:us(M)}}return m}throw new Error("can't deserialize object of type "+typeof a)}var Xu=function(){this.first=!0};Xu.prototype.update=function(a,s){var c=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=c,!0))};var Dr={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function Yc(a){for(var s=0,c=a;s<c.length;s+=1)if(xc(c[s].charCodeAt(0)))return!0;return!1}function xc(a){return!(a!==746&&a!==747&&(a<4352||!(Dr["Bopomofo Extended"](a)||Dr.Bopomofo(a)||Dr["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Dr["CJK Compatibility Ideographs"](a)||Dr["CJK Compatibility"](a)||Dr["CJK Radicals Supplement"](a)||Dr["CJK Strokes"](a)||!(!Dr["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Dr["CJK Unified Ideographs Extension A"](a)||Dr["CJK Unified Ideographs"](a)||Dr["Enclosed CJK Letters and Months"](a)||Dr["Hangul Compatibility Jamo"](a)||Dr["Hangul Jamo Extended-A"](a)||Dr["Hangul Jamo Extended-B"](a)||Dr["Hangul Jamo"](a)||Dr["Hangul Syllables"](a)||Dr.Hiragana(a)||Dr["Ideographic Description Characters"](a)||Dr.Kanbun(a)||Dr["Kangxi Radicals"](a)||Dr["Katakana Phonetic Extensions"](a)||Dr.Katakana(a)&&a!==12540||!(!Dr["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Dr["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Dr["Unified Canadian Aboriginal Syllabics"](a)||Dr["Unified Canadian Aboriginal Syllabics Extended"](a)||Dr["Vertical Forms"](a)||Dr["Yijing Hexagram Symbols"](a)||Dr["Yi Syllables"](a)||Dr["Yi Radicals"](a))))}function lu(a){return!(xc(a)||function(s){return!!(Dr["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Dr["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Dr["Letterlike Symbols"](s)||Dr["Number Forms"](s)||Dr["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Dr["Control Pictures"](s)&&s!==9251||Dr["Optical Character Recognition"](s)||Dr["Enclosed Alphanumerics"](s)||Dr["Geometric Shapes"](s)||Dr["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Dr["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Dr["CJK Symbols and Punctuation"](s)||Dr.Katakana(s)||Dr["Private Use Area"](s)||Dr["CJK Compatibility Forms"](s)||Dr["Small Form Variants"](s)||Dr["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(a))}function js(a){return a>=1424&&a<=2303||Dr["Arabic Presentation Forms-A"](a)||Dr["Arabic Presentation Forms-B"](a)}function Qo(a,s){return!(!s&&js(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Dr.Khmer(a))}function qc(a){for(var s=0,c=a;s<c.length;s+=1)if(js(c[s].charCodeAt(0)))return!0;return!1}var Kc=null,ls="unavailable",cu=null,Jc=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(ls="error"),Kc&&Kc(a)};function $l(){bc.fire(new Oe("pluginStateChange",{pluginStatus:ls,pluginURL:cu}))}var bc=new ot,Xl=function(){return ls},Gs=function(){if(ls!=="deferred"||!cu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ls="loading",$l(),cu&&$o({url:cu},function(a){a?Jc(a):(ls="loaded",$l())})},It={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ls==="loaded"||It.applyArabicShaping!=null},isLoading:function(){return ls==="loading"},setState:function(a){ls=a.pluginStatus,cu=a.pluginURL},isParsed:function(){return It.applyArabicShaping!=null&&It.processBidirectionalText!=null&&It.processStyledBidirectionalText!=null},getPluginURL:function(){return cu}},Ee=function(a,s){this.zoom=a,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Xu,this.transition={})};Ee.prototype.isSupportedScript=function(a){return function(s,c){for(var m=0,_=s;m<_.length;m+=1)if(!Qo(_[m].charCodeAt(0),c))return!1;return!0}(a,It.isLoaded())},Ee.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ee.prototype.getCrossfadeParameters=function(){var a=this.zoom,s=a-Math.floor(a),c=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}};var V=function(a,s){this.property=a,this.value=s,this.expression=function(c,m){if(ju(c))return new jl(c,m);if(ys(c)){var _=dc(c,m);if(_.result==="error")throw new Error(_.value.map(function(E){return E.key+": "+E.message}).join(", "));return _.value}var b=c;return typeof c=="string"&&m.type==="color"&&(b=vi.parse(c)),{kind:"constant",evaluate:function(){return b}}}(s===void 0?a.specification.default:s,a.specification)};V.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},V.prototype.possiblyEvaluate=function(a,s,c){return this.property.possiblyEvaluate(this,a,s,c)};var go=function(a){this.property=a,this.value=new V(a,void 0)};go.prototype.transitioned=function(a,s){return new Yu(this.property,this.value,s,qt({},a.transition,this.transition),a.now)},go.prototype.untransitioned=function(){return new Yu(this.property,this.value,null,{},0)};var he=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};he.prototype.getValue=function(a){return at(this._values[a].value.value)},he.prototype.setValue=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new go(this._values[a].property)),this._values[a].value=new V(this._values[a].property,s===null?void 0:at(s))},he.prototype.getTransition=function(a){return at(this._values[a].transition)},he.prototype.setTransition=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new go(this._values[a].property)),this._values[a].transition=at(s)||void 0},he.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_);var b=this.getTransition(m);b!==void 0&&(a[m+"-transition"]=b)}return a},he.prototype.transitioned=function(a,s){for(var c=new ya(this._properties),m=0,_=Object.keys(this._values);m<_.length;m+=1){var b=_[m];c._values[b]=this._values[b].transitioned(a,s._values[b])}return c},he.prototype.untransitioned=function(){for(var a=new ya(this._properties),s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s];a._values[m]=this._values[m].untransitioned()}return a};var Yu=function(a,s,c,m,_){this.property=a,this.value=s,this.begin=_+m.delay||0,this.end=this.begin+m.duration||0,a.specification.transition&&(m.delay||m.duration)&&(this.prior=c)};Yu.prototype.possiblyEvaluate=function(a,s,c){var m=a.now||0,_=this.value.possiblyEvaluate(a,s,c),b=this.prior;if(b){if(m>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(m<this.begin)return b.possiblyEvaluate(a,s,c);var E=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(a,s,c),_,function(M){if(M<=0)return 0;if(M>=1)return 1;var P=M*M,F=P*M;return 4*(M<.5?F:3*(M-P)+F-.75)}(E))}return _};var ya=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};ya.prototype.possiblyEvaluate=function(a,s,c){for(var m=new Zo(this._properties),_=0,b=Object.keys(this._values);_<b.length;_+=1){var E=b[_];m._values[E]=this._values[E].possiblyEvaluate(a,s,c)}return m},ya.prototype.hasTransition=function(){for(var a=0,s=Object.keys(this._values);a<s.length;a+=1)if(this._values[s[a]].prior)return!0;return!1};var cs=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};cs.prototype.getValue=function(a){return at(this._values[a].value)},cs.prototype.setValue=function(a,s){this._values[a]=new V(this._values[a].property,s===null?void 0:at(s))},cs.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_)}return a},cs.prototype.possiblyEvaluate=function(a,s,c){for(var m=new Zo(this._properties),_=0,b=Object.keys(this._values);_<b.length;_+=1){var E=b[_];m._values[E]=this._values[E].possiblyEvaluate(a,s,c)}return m};var so=function(a,s,c){this.property=a,this.value=s,this.parameters=c};so.prototype.isConstant=function(){return this.value.kind==="constant"},so.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},so.prototype.evaluate=function(a,s,c,m){return this.property.evaluate(this.value,this.parameters,a,s,c,m)};var Zo=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};Zo.prototype.get=function(a){return this._values[a]};var Ln=function(a){this.specification=a};Ln.prototype.possiblyEvaluate=function(a,s){return a.expression.evaluate(s)},Ln.prototype.interpolate=function(a,s,c){var m=zl[this.specification.type];return m?m(a,s,c):a};var _n=function(a,s){this.specification=a,this.overrides=s};_n.prototype.possiblyEvaluate=function(a,s,c,m){return new so(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(s,null,{},c,m)}:a.expression,s)},_n.prototype.interpolate=function(a,s,c){if(a.value.kind!=="constant"||s.value.kind!=="constant")return a;if(a.value.value===void 0||s.value.value===void 0)return new so(this,{kind:"constant",value:void 0},a.parameters);var m=zl[this.specification.type];return m?new so(this,{kind:"constant",value:m(a.value.value,s.value.value,c)},a.parameters):a},_n.prototype.evaluate=function(a,s,c,m,_,b){return a.kind==="constant"?a.value:a.evaluate(s,c,m,_,b)};var qu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m,_,b){if(c.value===void 0)return new so(this,{kind:"constant",value:void 0},m);if(c.expression.kind==="constant"){var E=c.expression.evaluate(m,null,{},_,b),M=c.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,P=this._calculate(M,M,M,m);return new so(this,{kind:"constant",value:P},m)}if(c.expression.kind==="camera"){var F=this._calculate(c.expression.evaluate({zoom:m.zoom-1}),c.expression.evaluate({zoom:m.zoom}),c.expression.evaluate({zoom:m.zoom+1}),m);return new so(this,{kind:"constant",value:F},m)}return new so(this,c.expression,m)},s.prototype.evaluate=function(c,m,_,b,E,M){if(c.kind==="source"){var P=c.evaluate(m,_,b,E,M);return this._calculate(P,P,P,m)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(m.zoom)-1},_,b),c.evaluate({zoom:Math.floor(m.zoom)},_,b),c.evaluate({zoom:Math.floor(m.zoom)+1},_,b),m):c.value},s.prototype._calculate=function(c,m,_,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:m}:{from:_,to:m}},s.prototype.interpolate=function(c){return c},s}(_n),ko=function(a){this.specification=a};ko.prototype.possiblyEvaluate=function(a,s,c,m){if(a.value!==void 0){if(a.expression.kind==="constant"){var _=a.expression.evaluate(s,null,{},c,m);return this._calculate(_,_,_,s)}return this._calculate(a.expression.evaluate(new Ee(Math.floor(s.zoom-1),s)),a.expression.evaluate(new Ee(Math.floor(s.zoom),s)),a.expression.evaluate(new Ee(Math.floor(s.zoom+1),s)),s)}},ko.prototype._calculate=function(a,s,c,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:a,to:s}:{from:c,to:s}},ko.prototype.interpolate=function(a){return a};var qa=function(a){this.specification=a};qa.prototype.possiblyEvaluate=function(a,s,c,m){return!!a.expression.evaluate(s,null,{},c,m)},qa.prototype.interpolate=function(){return!1};var yo=function(a){for(var s in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var c=a[s];c.specification.overridable&&this.overridableProperties.push(s);var m=this.defaultPropertyValues[s]=new V(c,void 0),_=this.defaultTransitionablePropertyValues[s]=new go(c);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=m.possiblyEvaluate({})}};pn("DataDrivenProperty",_n),pn("DataConstantProperty",Ln),pn("CrossFadedDataDrivenProperty",qu),pn("CrossFadedProperty",ko),pn("ColorRampProperty",qa);var Qs=function(a){function s(c,m){if(a.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),m.layout&&(this._unevaluatedLayout=new cs(m.layout)),m.paint)){for(var _ in this._transitionablePaint=new he(m.paint),c.paint)this.setPaintProperty(_,c.paint[_],{validate:!1});for(var b in c.layout)this.setLayoutProperty(b,c.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zo(m.paint)}}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},s.prototype.setLayoutProperty=function(c,m,_){_===void 0&&(_={}),m!=null&&this._validate(_c,"layers."+this.id+".layout."+c,c,m,_)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,m):this.visibility=m)},s.prototype.getPaintProperty=function(c){return mr(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-"-transition".length)):this._transitionablePaint.getValue(c)},s.prototype.setPaintProperty=function(c,m,_){if(_===void 0&&(_={}),m!=null&&this._validate(jh,"layers."+this.id+".paint."+c,c,m,_))return!1;if(mr(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-"-transition".length),m||void 0),!1;var b=this._transitionablePaint._values[c],E=b.property.specification["property-type"]==="cross-faded-data-driven",M=b.value.isDataDriven(),P=b.value;this._transitionablePaint.setValue(c,m),this._handleSpecialPaintPropertyUpdate(c);var F=this._transitionablePaint._values[c].value;return F.isDataDriven()||M||E||this._handleOverridablePaintPropertyUpdate(c,P,F)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!1},s.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(c,m){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,m)},s.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),xt(c,function(m,_){return!(m===void 0||_==="layout"&&!Object.keys(m).length||_==="paint"&&!Object.keys(m).length)})},s.prototype._validate=function(c,m,_,b,E){return E===void 0&&(E={}),(!E||E.validate!==!1)&&$u(this,c.call(xs,{key:m,layerType:this.type,objectKey:_,value:b,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var c in this.paint._values){var m=this.paint.get(c);if(m instanceof so&&Cu(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},s}(ot),Ss={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},fu=function(a,s){this._structArray=a,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Di=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ba(a,s){s===void 0&&(s=1);var c=0,m=0;return{members:a.map(function(_){var b=Ss[_.type].BYTES_PER_ELEMENT,E=c=Tf(c,Math.max(s,b)),M=_.components||1;return m=Math.max(m,b),c+=b*M,{name:_.name,type:_.type,components:M,offset:E}}),size:Tf(c,Math.max(m,s)),alignment:s}}function Tf(a,s){return Math.ceil(a/s)*s}Di.serialize=function(a,s){return a._trim(),s&&(a.isTransferred=!0,s.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Di.deserialize=function(a){var s=Object.create(this.prototype);return s.arrayBuffer=a.arrayBuffer,s.length=a.length,s.capacity=a.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},Di.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Di.prototype.clear=function(){this.length=0},Di.prototype.resize=function(a){this.reserve(a),this.length=a},Di.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},Di.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ku=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var b=2*c;return this.int16[b+0]=m,this.int16[b+1]=_,c},s}(Di);Ku.prototype.bytesPerElement=4,pn("StructArrayLayout2i4",Ku);var Qc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,_,b)},s.prototype.emplace=function(c,m,_,b,E){var M=4*c;return this.int16[M+0]=m,this.int16[M+1]=_,this.int16[M+2]=b,this.int16[M+3]=E,c},s}(Di);Qc.prototype.bytesPerElement=8,pn("StructArrayLayout4i8",Qc);var hu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M){var P=this.length;return this.resize(P+1),this.emplace(P,c,m,_,b,E,M)},s.prototype.emplace=function(c,m,_,b,E,M,P){var F=6*c;return this.int16[F+0]=m,this.int16[F+1]=_,this.int16[F+2]=b,this.int16[F+3]=E,this.int16[F+4]=M,this.int16[F+5]=P,c},s}(Di);hu.prototype.bytesPerElement=12,pn("StructArrayLayout2i4i12",hu);var Io=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M){var P=this.length;return this.resize(P+1),this.emplace(P,c,m,_,b,E,M)},s.prototype.emplace=function(c,m,_,b,E,M,P){var F=4*c,j=8*c;return this.int16[F+0]=m,this.int16[F+1]=_,this.uint8[j+4]=b,this.uint8[j+5]=E,this.uint8[j+6]=M,this.uint8[j+7]=P,c},s}(Di);Io.prototype.bytesPerElement=8,pn("StructArrayLayout2i4ub8",Io);var yl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var b=2*c;return this.float32[b+0]=m,this.float32[b+1]=_,c},s}(Di);yl.prototype.bytesPerElement=8,pn("StructArrayLayout2f8",yl);var eu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,P,F,j,H){var te=this.length;return this.resize(te+1),this.emplace(te,c,m,_,b,E,M,P,F,j,H)},s.prototype.emplace=function(c,m,_,b,E,M,P,F,j,H,te){var ue=10*c;return this.uint16[ue+0]=m,this.uint16[ue+1]=_,this.uint16[ue+2]=b,this.uint16[ue+3]=E,this.uint16[ue+4]=M,this.uint16[ue+5]=P,this.uint16[ue+6]=F,this.uint16[ue+7]=j,this.uint16[ue+8]=H,this.uint16[ue+9]=te,c},s}(Di);eu.prototype.bytesPerElement=20,pn("StructArrayLayout10ui20",eu);var ef=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,P,F,j,H,te,ue){var De=this.length;return this.resize(De+1),this.emplace(De,c,m,_,b,E,M,P,F,j,H,te,ue)},s.prototype.emplace=function(c,m,_,b,E,M,P,F,j,H,te,ue,De){var Be=12*c;return this.int16[Be+0]=m,this.int16[Be+1]=_,this.int16[Be+2]=b,this.int16[Be+3]=E,this.uint16[Be+4]=M,this.uint16[Be+5]=P,this.uint16[Be+6]=F,this.uint16[Be+7]=j,this.int16[Be+8]=H,this.int16[Be+9]=te,this.int16[Be+10]=ue,this.int16[Be+11]=De,c},s}(Di);ef.prototype.bytesPerElement=24,pn("StructArrayLayout4i4ui4i24",ef);var Yl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=3*c;return this.float32[E+0]=m,this.float32[E+1]=_,this.float32[E+2]=b,c},s}(Di);Yl.prototype.bytesPerElement=12,pn("StructArrayLayout3f12",Yl);var Sc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint32[1*c+0]=m,c},s}(Di);Sc.prototype.bytesPerElement=4,pn("StructArrayLayout1ul4",Sc);var Mf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,P,F,j){var H=this.length;return this.resize(H+1),this.emplace(H,c,m,_,b,E,M,P,F,j)},s.prototype.emplace=function(c,m,_,b,E,M,P,F,j,H){var te=10*c,ue=5*c;return this.int16[te+0]=m,this.int16[te+1]=_,this.int16[te+2]=b,this.int16[te+3]=E,this.int16[te+4]=M,this.int16[te+5]=P,this.uint32[ue+3]=F,this.uint16[te+8]=j,this.uint16[te+9]=H,c},s}(Di);Mf.prototype.bytesPerElement=20,pn("StructArrayLayout6i1ul2ui20",Mf);var ql=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M){var P=this.length;return this.resize(P+1),this.emplace(P,c,m,_,b,E,M)},s.prototype.emplace=function(c,m,_,b,E,M,P){var F=6*c;return this.int16[F+0]=m,this.int16[F+1]=_,this.int16[F+2]=b,this.int16[F+3]=E,this.int16[F+4]=M,this.int16[F+5]=P,c},s}(Di);ql.prototype.bytesPerElement=12,pn("StructArrayLayout2i2i2i12",ql);var Ju=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E){var M=this.length;return this.resize(M+1),this.emplace(M,c,m,_,b,E)},s.prototype.emplace=function(c,m,_,b,E,M){var P=4*c,F=8*c;return this.float32[P+0]=m,this.float32[P+1]=_,this.float32[P+2]=b,this.int16[F+6]=E,this.int16[F+7]=M,c},s}(Di);Ju.prototype.bytesPerElement=16,pn("StructArrayLayout2f1f2i16",Ju);var tf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,_,b)},s.prototype.emplace=function(c,m,_,b,E){var M=12*c,P=3*c;return this.uint8[M+0]=m,this.uint8[M+1]=_,this.float32[P+1]=b,this.float32[P+2]=E,c},s}(Di);tf.prototype.bytesPerElement=12,pn("StructArrayLayout2ub2f12",tf);var es=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=3*c;return this.uint16[E+0]=m,this.uint16[E+1]=_,this.uint16[E+2]=b,c},s}(Di);es.prototype.bytesPerElement=6,pn("StructArrayLayout3ui6",es);var Qu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,P,F,j,H,te,ue,De,Be,Je,He,mt){var Lt=this.length;return this.resize(Lt+1),this.emplace(Lt,c,m,_,b,E,M,P,F,j,H,te,ue,De,Be,Je,He,mt)},s.prototype.emplace=function(c,m,_,b,E,M,P,F,j,H,te,ue,De,Be,Je,He,mt,Lt){var zt=24*c,Zt=12*c,ur=48*c;return this.int16[zt+0]=m,this.int16[zt+1]=_,this.uint16[zt+2]=b,this.uint16[zt+3]=E,this.uint32[Zt+2]=M,this.uint32[Zt+3]=P,this.uint32[Zt+4]=F,this.uint16[zt+10]=j,this.uint16[zt+11]=H,this.uint16[zt+12]=te,this.float32[Zt+7]=ue,this.float32[Zt+8]=De,this.uint8[ur+36]=Be,this.uint8[ur+37]=Je,this.uint8[ur+38]=He,this.uint32[Zt+10]=mt,this.int16[zt+22]=Lt,c},s}(Di);Qu.prototype.bytesPerElement=48,pn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Qu);var _l=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,P,F,j,H,te,ue,De,Be,Je,He,mt,Lt,zt,Zt,ur,yr,Xr,Fn,nn,Bn,sn,gi){var Kn=this.length;return this.resize(Kn+1),this.emplace(Kn,c,m,_,b,E,M,P,F,j,H,te,ue,De,Be,Je,He,mt,Lt,zt,Zt,ur,yr,Xr,Fn,nn,Bn,sn,gi)},s.prototype.emplace=function(c,m,_,b,E,M,P,F,j,H,te,ue,De,Be,Je,He,mt,Lt,zt,Zt,ur,yr,Xr,Fn,nn,Bn,sn,gi,Kn){var En=34*c,on=17*c;return this.int16[En+0]=m,this.int16[En+1]=_,this.int16[En+2]=b,this.int16[En+3]=E,this.int16[En+4]=M,this.int16[En+5]=P,this.int16[En+6]=F,this.int16[En+7]=j,this.uint16[En+8]=H,this.uint16[En+9]=te,this.uint16[En+10]=ue,this.uint16[En+11]=De,this.uint16[En+12]=Be,this.uint16[En+13]=Je,this.uint16[En+14]=He,this.uint16[En+15]=mt,this.uint16[En+16]=Lt,this.uint16[En+17]=zt,this.uint16[En+18]=Zt,this.uint16[En+19]=ur,this.uint16[En+20]=yr,this.uint16[En+21]=Xr,this.uint16[En+22]=Fn,this.uint32[on+12]=nn,this.float32[on+13]=Bn,this.float32[on+14]=sn,this.float32[on+15]=gi,this.float32[on+16]=Kn,c},s}(Di);_l.prototype.bytesPerElement=68,pn("StructArrayLayout8i15ui1ul4f68",_l);var tu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.float32[1*c+0]=m,c},s}(Di);tu.prototype.bytesPerElement=4,pn("StructArrayLayout1f4",tu);var Hs=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=3*c;return this.int16[E+0]=m,this.int16[E+1]=_,this.int16[E+2]=b,c},s}(Di);Hs.prototype.bytesPerElement=6,pn("StructArrayLayout3i6",Hs);var kf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=4*c;return this.uint32[2*c+0]=m,this.uint16[E+2]=_,this.uint16[E+3]=b,c},s}(Di);kf.prototype.bytesPerElement=8,pn("StructArrayLayout1ul2ui8",kf);var pu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var b=2*c;return this.uint16[b+0]=m,this.uint16[b+1]=_,c},s}(Di);pu.prototype.bytesPerElement=4,pn("StructArrayLayout2ui4",pu);var If=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint16[1*c+0]=m,c},s}(Di);If.prototype.bytesPerElement=2,pn("StructArrayLayout1ui2",If);var Pf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,_,b)},s.prototype.emplace=function(c,m,_,b,E){var M=4*c;return this.float32[M+0]=m,this.float32[M+1]=_,this.float32[M+2]=b,this.float32[M+3]=E,c},s}(Di);Pf.prototype.bytesPerElement=16,pn("StructArrayLayout4f16",Pf);var f=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new ae(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,c),s}(fu);f.prototype.size=20;var d=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new f(this,c)},s}(Mf);pn("CollisionBoxArray",d);var h=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,c),s}(fu);h.prototype.size=48;var g=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new h(this,c)},s}(Qu);pn("PlacedSymbolArray",g);var w=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,c),s}(fu);w.prototype.size=68;var C=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new w(this,c)},s}(_l);pn("SymbolInstanceArray",C);var T=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getoffsetX=function(c){return this.float32[1*c+0]},s}(tu);pn("GlyphOffsetArray",T);var I=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getx=function(c){return this.int16[3*c+0]},s.prototype.gety=function(c){return this.int16[3*c+1]},s.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},s}(Hs);pn("SymbolLineVertexArray",I);var Z=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,c),s}(fu);Z.prototype.size=8;var $=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new Z(this,c)},s}(kf);pn("FeatureIndexArray",$);var le=Ba([{name:"a_pos",components:2,type:"Int16"}],4).members,ve=function(a){a===void 0&&(a=[]),this.segments=a};function xe(a,s){return 256*(a=Pt(Math.floor(a),0,255))+Pt(Math.floor(s),0,255)}ve.prototype.prepareSegment=function(a,s,c,m){var _=this.segments[this.segments.length-1];return a>ve.MAX_VERTEX_ARRAY_LENGTH&&ft("Max vertices per segment is "+ve.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!_||_.vertexLength+a>ve.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==m)&&(_={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},m!==void 0&&(_.sortKey=m),this.segments.push(_)),_},ve.prototype.get=function(){return this.segments},ve.prototype.destroy=function(){for(var a=0,s=this.segments;a<s.length;a+=1){var c=s[a];for(var m in c.vaos)c.vaos[m].destroy()}},ve.simpleSegment=function(a,s,c,m){return new ve([{vertexOffset:a,primitiveOffset:s,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])},ve.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pn("SegmentVector",ve);var ze=Ba([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Fe=se(function(a){a.exports=function(s,c){var m,_,b,E,M,P,F,j;for(_=s.length-(m=3&s.length),b=c,M=3432918353,P=461845907,j=0;j<_;)F=255&s.charCodeAt(j)|(255&s.charCodeAt(++j))<<8|(255&s.charCodeAt(++j))<<16|(255&s.charCodeAt(++j))<<24,++j,b=27492+(65535&(E=5*(65535&(b=(b^=F=(65535&(F=(F=(65535&F)*M+(((F>>>16)*M&65535)<<16)&4294967295)<<15|F>>>17))*P+(((F>>>16)*P&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(F=0,m){case 3:F^=(255&s.charCodeAt(j+2))<<16;case 2:F^=(255&s.charCodeAt(j+1))<<8;case 1:b^=F=(65535&(F=(F=(65535&(F^=255&s.charCodeAt(j)))*M+(((F>>>16)*M&65535)<<16)&4294967295)<<15|F>>>17))*P+(((F>>>16)*P&65535)<<16)&4294967295}return b^=s.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Ye=se(function(a){a.exports=function(s,c){for(var m,_=s.length,b=c^_,E=0;_>=4;)m=1540483477*(65535&(m=255&s.charCodeAt(E)|(255&s.charCodeAt(++E))<<8|(255&s.charCodeAt(++E))<<16|(255&s.charCodeAt(++E))<<24))+((1540483477*(m>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),_-=4,++E;switch(_){case 3:b^=(255&s.charCodeAt(E+2))<<16;case 2:b^=(255&s.charCodeAt(E+1))<<8;case 1:b=1540483477*(65535&(b^=255&s.charCodeAt(E)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Pe=Fe,$e=Ye;Pe.murmur3=Fe,Pe.murmur2=$e;var it=function(){this.ids=[],this.positions=[],this.indexed=!1};it.prototype.add=function(a,s,c,m){this.ids.push(jt(a)),this.positions.push(s,c,m)},it.prototype.getPositions=function(a){for(var s=jt(a),c=0,m=this.ids.length-1;c<m;){var _=c+m>>1;this.ids[_]>=s?m=_:c=_+1}for(var b=[];this.ids[c]===s;)b.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return b},it.serialize=function(a,s){var c=new Float64Array(a.ids),m=new Uint32Array(a.positions);return function _(b,E,M,P){for(;M<P;){for(var F=b[M+P>>1],j=M-1,H=P+1;;){do j++;while(b[j]<F);do H--;while(b[H]>F);if(j>=H)break;Ut(b,j,H),Ut(E,3*j,3*H),Ut(E,3*j+1,3*H+1),Ut(E,3*j+2,3*H+2)}H-M<P-H?(_(b,E,M,H),M=H+1):(_(b,E,H+1,P),P=H)}}(c,m,0,c.length-1),s&&s.push(c.buffer,m.buffer),{ids:c,positions:m}},it.deserialize=function(a){var s=new it;return s.ids=a.ids,s.positions=a.positions,s.indexed=!0,s};var Mt=Math.pow(2,53)-1;function jt(a){var s=+a;return!isNaN(s)&&s<=Mt?s:Pe(String(a))}function Ut(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}pn("FeaturePositionMap",it);var $t=function(a,s){this.gl=a.gl,this.location=s},pr=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},s}($t),zr=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},s}($t),Rr=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},s}($t),an=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},s}($t),Tn=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},s}($t),In=function(a){function s(c,m){a.call(this,c,m),this.current=vi.transparent}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},s}($t),On=new Float32Array(16),Mi=function(a){function s(c,m){a.call(this,c,m),this.current=On}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},s}($t);function cn(a){return[xe(255*a.r,255*a.g),xe(255*a.b,255*a.a)]}var Qn=function(a,s,c){this.value=a,this.uniformNames=s.map(function(m){return"u_"+m}),this.type=c};Qn.prototype.setUniform=function(a,s,c){a.set(c.constantOr(this.value))},Qn.prototype.getBinding=function(a,s,c){return this.type==="color"?new In(a,s):new zr(a,s)};var ni=function(a,s){this.uniformNames=s.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ni.prototype.setConstantPatternPositions=function(a,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=a.tlbr},ni.prototype.setUniform=function(a,s,c,m){var _=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&a.set(_)},ni.prototype.getBinding=function(a,s,c){return c.substr(0,9)==="u_pattern"?new Tn(a,s):new zr(a,s)};var ei=function(a,s,c,m){this.expression=a,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(function(_){return{name:"a_"+_,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new m};ei.prototype.populatePaintArray=function(a,s,c,m,_){var b=this.paintVertexArray.length,E=this.expression.evaluate(new Ee(0),s,{},m,[],_);this.paintVertexArray.resize(a),this._setPaintValue(b,a,E)},ei.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:0},c,m);this._setPaintValue(a,s,_)},ei.prototype._setPaintValue=function(a,s,c){if(this.type==="color")for(var m=cn(c),_=a;_<s;_++)this.paintVertexArray.emplace(_,m[0],m[1]);else{for(var b=a;b<s;b++)this.paintVertexArray.emplace(b,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},ei.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ei.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var qn=function(a,s,c,m,_,b){this.expression=a,this.uniformNames=s.map(function(E){return"u_"+E+"_t"}),this.type=c,this.useIntegerZoom=m,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(function(E){return{name:"a_"+E,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new b};qn.prototype.populatePaintArray=function(a,s,c,m,_){var b=this.expression.evaluate(new Ee(this.zoom),s,{},m,[],_),E=this.expression.evaluate(new Ee(this.zoom+1),s,{},m,[],_),M=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(M,a,b,E)},qn.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:this.zoom},c,m),b=this.expression.evaluate({zoom:this.zoom+1},c,m);this._setPaintValue(a,s,_,b)},qn.prototype._setPaintValue=function(a,s,c,m){if(this.type==="color")for(var _=cn(c),b=cn(m),E=a;E<s;E++)this.paintVertexArray.emplace(E,_[0],_[1],b[0],b[1]);else{for(var M=a;M<s;M++)this.paintVertexArray.emplace(M,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}},qn.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},qn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},qn.prototype.setUniform=function(a,s){var c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,m=Pt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);a.set(m)},qn.prototype.getBinding=function(a,s,c){return new zr(a,s)};var ai=function(a,s,c,m,_,b){this.expression=a,this.type=s,this.useIntegerZoom=c,this.zoom=m,this.layerId=b,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};ai.prototype.populatePaintArray=function(a,s,c){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(m,a,s.patterns&&s.patterns[this.layerId],c)},ai.prototype.updatePaintArray=function(a,s,c,m,_){this._setPaintValues(a,s,c.patterns&&c.patterns[this.layerId],_)},ai.prototype._setPaintValues=function(a,s,c,m){if(m&&c){var _=m[c.min],b=m[c.mid],E=m[c.max];if(_&&b&&E)for(var M=a;M<s;M++)this.zoomInPaintVertexArray.emplace(M,b.tl[0],b.tl[1],b.br[0],b.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],b.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,b.tl[0],b.tl[1],b.br[0],b.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],b.pixelRatio,E.pixelRatio)}},ai.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,ze.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,ze.members,this.expression.isStateDependent))},ai.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Yn=function(a,s,c){this.binders={},this._buffers=[];var m=[];for(var _ in a.paint._values)if(c(_)){var b=a.paint.get(_);if(b instanceof so&&Cu(b.property.specification)){var E=Ka(_,a.type),M=b.value,P=b.property.specification.type,F=b.property.useIntegerZoom,j=b.property.specification["property-type"],H=j==="cross-faded"||j==="cross-faded-data-driven";if(M.kind==="constant")this.binders[_]=H?new ni(M.value,E):new Qn(M.value,E,P),m.push("/u_"+_);else if(M.kind==="source"||H){var te=_a(_,P,"source");this.binders[_]=H?new ai(M,P,F,s,te,a.id):new ei(M,E,P,te),m.push("/a_"+_)}else{var ue=_a(_,P,"composite");this.binders[_]=new qn(M,E,P,F,s,ue),m.push("/z_"+_)}}}this.cacheKey=m.sort().join("")};Yn.prototype.getMaxValue=function(a){var s=this.binders[a];return s instanceof ei||s instanceof qn?s.maxValue:0},Yn.prototype.populatePaintArrays=function(a,s,c,m,_){for(var b in this.binders){var E=this.binders[b];(E instanceof ei||E instanceof qn||E instanceof ai)&&E.populatePaintArray(a,s,c,m,_)}},Yn.prototype.setConstantPatternPositions=function(a,s){for(var c in this.binders){var m=this.binders[c];m instanceof ni&&m.setConstantPatternPositions(a,s)}},Yn.prototype.updatePaintArrays=function(a,s,c,m,_){var b=!1;for(var E in a)for(var M=0,P=s.getPositions(E);M<P.length;M+=1){var F=P[M],j=c.feature(F.index);for(var H in this.binders){var te=this.binders[H];if((te instanceof ei||te instanceof qn||te instanceof ai)&&te.expression.isStateDependent===!0){var ue=m.paint.get(H);te.expression=ue.value,te.updatePaintArray(F.start,F.end,j,a[E],_),b=!0}}}return b},Yn.prototype.defines=function(){var a=[];for(var s in this.binders){var c=this.binders[s];(c instanceof Qn||c instanceof ni)&&a.push.apply(a,c.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return a},Yn.prototype.getBinderAttributes=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof ei||c instanceof qn)for(var m=0;m<c.paintVertexAttributes.length;m++)a.push(c.paintVertexAttributes[m].name);else if(c instanceof ai)for(var _=0;_<ze.members.length;_++)a.push(ze.members[_].name)}return a},Yn.prototype.getBinderUniforms=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof Qn||c instanceof ni||c instanceof qn)for(var m=0,_=c.uniformNames;m<_.length;m+=1)a.push(_[m])}return a},Yn.prototype.getPaintVertexBuffers=function(){return this._buffers},Yn.prototype.getUniforms=function(a,s){var c=[];for(var m in this.binders){var _=this.binders[m];if(_ instanceof Qn||_ instanceof ni||_ instanceof qn)for(var b=0,E=_.uniformNames;b<E.length;b+=1){var M=E[b];if(s[M]){var P=_.getBinding(a,s[M],M);c.push({name:M,property:m,binding:P})}}}return c},Yn.prototype.setUniforms=function(a,s,c,m){for(var _=0,b=s;_<b.length;_+=1){var E=b[_],M=E.name,P=E.property;this.binders[P].setUniform(E.binding,m,c.get(P),M)}},Yn.prototype.updatePaintBuffers=function(a){for(var s in this._buffers=[],this.binders){var c=this.binders[s];if(a&&c instanceof ai){var m=a.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(c instanceof ei||c instanceof qn)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},Yn.prototype.upload=function(a){for(var s in this.binders){var c=this.binders[s];(c instanceof ei||c instanceof qn||c instanceof ai)&&c.upload(a)}this.updatePaintBuffers()},Yn.prototype.destroy=function(){for(var a in this.binders){var s=this.binders[a];(s instanceof ei||s instanceof qn||s instanceof ai)&&s.destroy()}};var Zn=function(a,s,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var m=0,_=a;m<_.length;m+=1){var b=_[m];this.programConfigurations[b.id]=new Yn(b,s,c)}this.needsUpload=!1,this._featureMap=new it,this._bufferOffset=0};function Ka(a,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(s+"-","").replace(/-/g,"_")]}function _a(a,s,c){var m={color:{source:yl,composite:Pf},number:{source:tu,composite:yl}},_=function(b){return{"line-pattern":{source:eu,composite:eu},"fill-pattern":{source:eu,composite:eu},"fill-extrusion-pattern":{source:eu,composite:eu}}[b]}(a);return _&&_[c]||m[s][c]}Zn.prototype.populatePaintArrays=function(a,s,c,m,_,b){for(var E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(a,s,m,_,b);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Zn.prototype.updatePaintArrays=function(a,s,c,m){for(var _=0,b=c;_<b.length;_+=1){var E=b[_];this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(a,this._featureMap,s,E,m)||this.needsUpload}},Zn.prototype.get=function(a){return this.programConfigurations[a]},Zn.prototype.upload=function(a){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(a);this.needsUpload=!1}},Zn.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},pn("ConstantBinder",Qn),pn("CrossFadedConstantBinder",ni),pn("SourceExpressionBinder",ei),pn("CrossFadedCompositeBinder",ai),pn("CompositeExpressionBinder",qn),pn("ProgramConfiguration",Yn,{omit:["_buffers"]}),pn("ProgramConfigurationSet",Zn);var _o=Math.pow(2,14)-1,Ja=-_o-1;function xa(a){for(var s=8192/a.extent,c=a.loadGeometry(),m=0;m<c.length;m++)for(var _=c[m],b=0;b<_.length;b++){var E=_[b],M=Math.round(E.x*s),P=Math.round(E.y*s);E.x=Pt(M,Ja,_o),E.y=Pt(P,Ja,_o),(M<E.x||M>E.x+1||P<E.y||P>E.y+1)&&ft("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function za(a,s){return{type:a.type,id:a.id,properties:a.properties,geometry:s?xa(a):[]}}function Uo(a,s,c,m,_){a.emplaceBack(2*s+(m+1)/2,2*c+(_+1)/2)}var Vo=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Ku,this.indexArray=new es,this.segments=new ve,this.programConfigurations=new Zn(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function el(a,s){for(var c=0;c<a.length;c++)if(Ws(s,a[c]))return!0;for(var m=0;m<s.length;m++)if(Ws(a,s[m]))return!0;return!!xl(a,s)}function Po(a,s,c){return!!Ws(a,s)||!!vu(s,a,c)}function ws(a,s){if(a.length===1)return Kl(s,a[0]);for(var c=0;c<s.length;c++)for(var m=s[c],_=0;_<m.length;_++)if(Ws(a,m[_]))return!0;for(var b=0;b<a.length;b++)if(Kl(s,a[b]))return!0;for(var E=0;E<s.length;E++)if(xl(a,s[E]))return!0;return!1}function Es(a,s,c){if(a.length>1){if(xl(a,s))return!0;for(var m=0;m<s.length;m++)if(vu(s[m],a,c))return!0}for(var _=0;_<a.length;_++)if(vu(a[_],s,c))return!0;return!1}function xl(a,s){if(a.length===0||s.length===0)return!1;for(var c=0;c<a.length-1;c++)for(var m=a[c],_=a[c+1],b=0;b<s.length-1;b++)if(du(m,_,s[b],s[b+1]))return!0;return!1}function du(a,s,c,m){return Kt(a,c,m)!==Kt(s,c,m)&&Kt(a,s,c)!==Kt(a,s,m)}function vu(a,s,c){var m=c*c;if(s.length===1)return a.distSqr(s[0])<m;for(var _=1;_<s.length;_++)if(bl(a,s[_-1],s[_])<m)return!0;return!1}function bl(a,s,c){var m=s.distSqr(c);if(m===0)return a.distSqr(s);var _=((a.x-s.x)*(c.x-s.x)+(a.y-s.y)*(c.y-s.y))/m;return a.distSqr(_<0?s:_>1?c:c.sub(s)._mult(_)._add(s))}function Kl(a,s){for(var c,m,_,b=!1,E=0;E<a.length;E++)for(var M=0,P=(c=a[E]).length-1;M<c.length;P=M++)(m=c[M]).y>s.y!=(_=c[P]).y>s.y&&s.x<(_.x-m.x)*(s.y-m.y)/(_.y-m.y)+m.x&&(b=!b);return b}function Ws(a,s){for(var c=!1,m=0,_=a.length-1;m<a.length;_=m++){var b=a[m],E=a[_];b.y>s.y!=E.y>s.y&&s.x<(E.x-b.x)*(s.y-b.y)/(E.y-b.y)+b.x&&(c=!c)}return c}function tl(a,s,c){var m=c[0],_=c[2];if(a.x<m.x&&s.x<m.x||a.x>_.x&&s.x>_.x||a.y<m.y&&s.y<m.y||a.y>_.y&&s.y>_.y)return!1;var b=Kt(a,s,c[0]);return b!==Kt(a,s,c[1])||b!==Kt(a,s,c[2])||b!==Kt(a,s,c[3])}function fs(a,s,c){var m=s.paint.get(a).value;return m.kind==="constant"?m.value:c.programConfigurations.get(s.id).getMaxValue(a)}function Na(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function mu(a,s,c,m,_){if(!s[0]&&!s[1])return a;var b=ae.convert(s)._mult(_);c==="viewport"&&b._rotate(-m);for(var E=[],M=0;M<a.length;M++)E.push(a[M].sub(b));return E}Vo.prototype.populate=function(a,s,c){var m=this.layers[0],_=[],b=null;m.type==="circle"&&(b=m.layout.get("circle-sort-key"));for(var E=0,M=a;E<M.length;E+=1){var P=M[E],F=P.feature,j=P.id,H=P.index,te=P.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,De=za(F,ue);if(this.layers[0]._featureFilter.filter(new Ee(this.zoom),De,c)){var Be=b?b.evaluate(De,{},c):void 0,Je={id:j,properties:F.properties,type:F.type,sourceLayerIndex:te,index:H,geometry:ue?De.geometry:xa(F),patterns:{},sortKey:Be};_.push(Je)}}b&&_.sort(function(Xr,Fn){return Xr.sortKey-Fn.sortKey});for(var He=0,mt=_;He<mt.length;He+=1){var Lt=mt[He],zt=Lt.geometry,Zt=Lt.index,ur=Lt.sourceLayerIndex,yr=a[Zt].feature;this.addFeature(Lt,zt,Zt,c),s.featureIndex.insert(yr,zt,Zt,ur,this.index)}},Vo.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},Vo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Vo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Vo.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,le),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Vo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Vo.prototype.addFeature=function(a,s,c,m){for(var _=0,b=s;_<b.length;_+=1)for(var E=0,M=b[_];E<M.length;E+=1){var P=M[E],F=P.x,j=P.y;if(!(F<0||F>=8192||j<0||j>=8192)){var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),te=H.vertexLength;Uo(this.layoutVertexArray,F,j,-1,-1),Uo(this.layoutVertexArray,F,j,1,-1),Uo(this.layoutVertexArray,F,j,1,1),Uo(this.layoutVertexArray,F,j,-1,1),this.indexArray.emplaceBack(te,te+1,te+2),this.indexArray.emplaceBack(te,te+3,te+2),H.vertexLength+=4,H.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,{},m)},pn("CircleBucket",Vo,{omit:["layers"]});var ru=new yo({"circle-sort-key":new _n(pe.layout_circle["circle-sort-key"])}),ts={paint:new yo({"circle-radius":new _n(pe.paint_circle["circle-radius"]),"circle-color":new _n(pe.paint_circle["circle-color"]),"circle-blur":new _n(pe.paint_circle["circle-blur"]),"circle-opacity":new _n(pe.paint_circle["circle-opacity"]),"circle-translate":new Ln(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ln(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ln(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ln(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _n(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _n(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _n(pe.paint_circle["circle-stroke-opacity"])}),layout:ru},Oi=typeof Float32Array!="undefined"?Float32Array:Array;function Ao(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Qa(a,s,c){var m=s[0],_=s[1],b=s[2],E=s[3],M=s[4],P=s[5],F=s[6],j=s[7],H=s[8],te=s[9],ue=s[10],De=s[11],Be=s[12],Je=s[13],He=s[14],mt=s[15],Lt=c[0],zt=c[1],Zt=c[2],ur=c[3];return a[0]=Lt*m+zt*M+Zt*H+ur*Be,a[1]=Lt*_+zt*P+Zt*te+ur*Je,a[2]=Lt*b+zt*F+Zt*ue+ur*He,a[3]=Lt*E+zt*j+Zt*De+ur*mt,a[4]=(Lt=c[4])*m+(zt=c[5])*M+(Zt=c[6])*H+(ur=c[7])*Be,a[5]=Lt*_+zt*P+Zt*te+ur*Je,a[6]=Lt*b+zt*F+Zt*ue+ur*He,a[7]=Lt*E+zt*j+Zt*De+ur*mt,a[8]=(Lt=c[8])*m+(zt=c[9])*M+(Zt=c[10])*H+(ur=c[11])*Be,a[9]=Lt*_+zt*P+Zt*te+ur*Je,a[10]=Lt*b+zt*F+Zt*ue+ur*He,a[11]=Lt*E+zt*j+Zt*De+ur*mt,a[12]=(Lt=c[12])*m+(zt=c[13])*M+(Zt=c[14])*H+(ur=c[15])*Be,a[13]=Lt*_+zt*P+Zt*te+ur*Je,a[14]=Lt*b+zt*F+Zt*ue+ur*He,a[15]=Lt*E+zt*j+Zt*De+ur*mt,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,s=0,c=arguments.length;c--;)s+=a[c]*a[c];return Math.sqrt(s)});var As,ku=Qa;function $s(a,s,c){var m=s[0],_=s[1],b=s[2],E=s[3];return a[0]=c[0]*m+c[4]*_+c[8]*b+c[12]*E,a[1]=c[1]*m+c[5]*_+c[9]*b+c[13]*E,a[2]=c[2]*m+c[6]*_+c[10]*b+c[14]*E,a[3]=c[3]*m+c[7]*_+c[11]*b+c[15]*E,a}As=new Oi(3),Oi!=Float32Array&&(As[0]=0,As[1]=0,As[2]=0),function(){var a=new Oi(4);Oi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var Sl=(function(){var a=new Oi(2);Oi!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function s(c){a.call(this,c,ts)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new Vo(c)},s.prototype.queryRadius=function(c){var m=c;return fs("circle-radius",this,m)+fs("circle-stroke-width",this,m)+Na(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,P,F){for(var j=mu(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,P),H=this.paint.get("circle-radius").evaluate(m,_)+this.paint.get("circle-stroke-width").evaluate(m,_),te=this.paint.get("circle-pitch-alignment")==="map",ue=te?j:function(yr,Xr){return yr.map(function(Fn){return xo(Fn,Xr)})}(j,F),De=te?H*P:H,Be=0,Je=b;Be<Je.length;Be+=1)for(var He=0,mt=Je[Be];He<mt.length;He+=1){var Lt=mt[He],zt=te?Lt:xo(Lt,F),Zt=De,ur=$s([],[Lt.x,Lt.y,0,1],F);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Zt*=ur[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Zt*=M.cameraToCenterDistance/ur[3]),Po(ue,zt,Zt))return!0}return!1},s}(Qs));function xo(a,s){var c=$s([],[a.x,a.y,0,1],s);return new ae(c[0]/c[3],c[1]/c[3])}var Ir=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Vo);function Cs(a,s,c,m){var _=s.width,b=s.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==_*b*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(_*b*c);return a.width=_,a.height=b,a.data=m,a}function wc(a,s,c){var m=s.width,_=s.height;if(m!==a.width||_!==a.height){var b=Cs({},{width:m,height:_},c);Va(a,b,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,m),height:Math.min(a.height,_)},c),a.width=m,a.height=_,a.data=b.data}}function Va(a,s,c,m,_,b){if(_.width===0||_.height===0)return s;if(_.width>a.width||_.height>a.height||c.x>a.width-_.width||c.y>a.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||m.x>s.width-_.width||m.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var E=a.data,M=s.data,P=0;P<_.height;P++)for(var F=((c.y+P)*a.width+c.x)*b,j=((m.y+P)*s.width+m.x)*b,H=0;H<_.width*b;H++)M[j+H]=E[F+H];return s}pn("HeatmapBucket",Ir,{omit:["layers"]});var Lo=function(a,s){Cs(this,a,1,s)};Lo.prototype.resize=function(a){wc(this,a,1)},Lo.prototype.clone=function(){return new Lo({width:this.width,height:this.height},new Uint8Array(this.data))},Lo.copy=function(a,s,c,m,_){Va(a,s,c,m,_,1)};var Aa=function(a,s){Cs(this,a,4,s)};Aa.prototype.resize=function(a){wc(this,a,4)},Aa.prototype.replace=function(a,s){s?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Aa.prototype.clone=function(){return new Aa({width:this.width,height:this.height},new Uint8Array(this.data))},Aa.copy=function(a,s,c,m,_){Va(a,s,c,m,_,4)},pn("AlphaImage",Lo),pn("RGBAImage",Aa);var Gh={paint:new yo({"heatmap-radius":new _n(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _n(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ln(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qa(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ln(pe.paint_heatmap["heatmap-opacity"])})};function wl(a){var s={},c=a.resolution||256,m=a.clips?a.clips.length:1,_=a.image||new Aa({width:c,height:m}),b=function(De,Be,Je){s[a.evaluationKey]=Je;var He=a.expression.evaluate(s);_.data[De+Be+0]=Math.floor(255*He.r/He.a),_.data[De+Be+1]=Math.floor(255*He.g/He.a),_.data[De+Be+2]=Math.floor(255*He.b/He.a),_.data[De+Be+3]=Math.floor(255*He.a)};if(a.clips)for(var E=0,M=0;E<m;++E,M+=4*c)for(var P=0,F=0;P<c;P++,F+=4){var j=P/(c-1),H=a.clips[E];b(M,F,H.start*(1-j)+H.end*j)}else for(var te=0,ue=0;te<c;te++,ue+=4)b(0,ue,te/(c-1));return _}var Ec=function(a){function s(c){a.call(this,c,Gh),this._updateColorRamp()}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new Ir(c)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=wl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(Qs),mh={paint:new yo({"hillshade-illumination-direction":new Ln(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ln(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ln(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ln(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ln(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ln(pe.paint_hillshade["hillshade-accent-color"])})},bd=function(a){function s(c){a.call(this,c,mh)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(Qs),Sd=Ba([{name:"a_pos",components:2,type:"Int16"}],4).members,Iu=Ac,Hh=Ac;function Ac(a,s,c){c=c||2;var m,_,b,E,M,P,F,j=s&&s.length,H=j?s[0]*c:a.length,te=Wh(a,0,H,c,!0),ue=[];if(!te||te.next===te.prev)return ue;if(j&&(te=function(Be,Je,He,mt){var Lt,zt,Zt,ur=[];for(Lt=0,zt=Je.length;Lt<zt;Lt++)(Zt=Wh(Be,Je[Lt]*mt,Lt<zt-1?Je[Lt+1]*mt:Be.length,mt,!1))===Zt.next&&(Zt.steiner=!0),ur.push(Zv(Zt));for(ur.sort(Mp),Lt=0;Lt<ur.length;Lt++)Nv(ur[Lt],He),He=Jl(He,He.next);return He}(a,s,te,c)),a.length>80*c){m=b=a[0],_=E=a[1];for(var De=c;De<H;De+=c)(M=a[De])<m&&(m=M),(P=a[De+1])<_&&(_=P),M>b&&(b=M),P>E&&(E=P);F=(F=Math.max(b-m,E-_))!==0?1/F:0}return gh(te,ue,c,m,_,F),ue}function Wh(a,s,c,m,_){var b,E;if(_===af(a,s,c,m)>0)for(b=s;b<c;b+=m)E=Lf(b,a[b],a[b+1],E);else for(b=c-m;b>=s;b-=m)E=Lf(b,a[b],a[b+1],E);return E&&Tc(E,E.next)&&(ec(E),E=E.next),E}function Jl(a,s){if(!a)return a;s||(s=a);var c,m=a;do if(c=!1,m.steiner||!Tc(m,m.next)&&Ca(m.prev,m,m.next)!==0)m=m.next;else{if(ec(m),(m=s=m.prev)===m.next)break;c=!0}while(c||m!==s);return s}function gh(a,s,c,m,_,b,E){if(a){!E&&b&&function(j,H,te,ue){var De=j;do De.z===null&&(De.z=yh(De.x,De.y,H,te,ue)),De.prevZ=De.prev,De.nextZ=De.next,De=De.next;while(De!==j);De.prevZ.nextZ=null,De.prevZ=null,function(Be){var Je,He,mt,Lt,zt,Zt,ur,yr,Xr=1;do{for(He=Be,Be=null,zt=null,Zt=0;He;){for(Zt++,mt=He,ur=0,Je=0;Je<Xr&&(ur++,mt=mt.nextZ);Je++);for(yr=Xr;ur>0||yr>0&&mt;)ur!==0&&(yr===0||!mt||He.z<=mt.z)?(Lt=He,He=He.nextZ,ur--):(Lt=mt,mt=mt.nextZ,yr--),zt?zt.nextZ=Lt:Be=Lt,Lt.prevZ=zt,zt=Lt;He=mt}zt.nextZ=null,Xr*=2}while(Zt>1)}(De)}(a,m,_,b);for(var M,P,F=a;a.prev!==a.next;)if(M=a.prev,P=a.next,b?Ed(a,m,_,b):wd(a))s.push(M.i/c),s.push(a.i/c),s.push(P.i/c),ec(a),a=P.next,F=P.next;else if((a=P)===F){E?E===1?gh(a=Ad(Jl(a),s,c),s,c,m,_,b,2):E===2&&Cd(a,s,c,m,_,b):gh(Jl(a),s,c,m,_,b,1);break}}}function wd(a){var s=a.prev,c=a,m=a.next;if(Ca(s,c,m)>=0)return!1;for(var _=a.next.next;_!==a.prev;){if(Cc(s.x,s.y,c.x,c.y,m.x,m.y,_.x,_.y)&&Ca(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function Ed(a,s,c,m){var _=a.prev,b=a,E=a.next;if(Ca(_,b,E)>=0)return!1;for(var M=_.x>b.x?_.x>E.x?_.x:E.x:b.x>E.x?b.x:E.x,P=_.y>b.y?_.y>E.y?_.y:E.y:b.y>E.y?b.y:E.y,F=yh(_.x<b.x?_.x<E.x?_.x:E.x:b.x<E.x?b.x:E.x,_.y<b.y?_.y<E.y?_.y:E.y:b.y<E.y?b.y:E.y,s,c,m),j=yh(M,P,s,c,m),H=a.prevZ,te=a.nextZ;H&&H.z>=F&&te&&te.z<=j;){if(H!==a.prev&&H!==a.next&&Cc(_.x,_.y,b.x,b.y,E.x,E.y,H.x,H.y)&&Ca(H.prev,H,H.next)>=0||(H=H.prevZ,te!==a.prev&&te!==a.next&&Cc(_.x,_.y,b.x,b.y,E.x,E.y,te.x,te.y)&&Ca(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;H&&H.z>=F;){if(H!==a.prev&&H!==a.next&&Cc(_.x,_.y,b.x,b.y,E.x,E.y,H.x,H.y)&&Ca(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;te&&te.z<=j;){if(te!==a.prev&&te!==a.next&&Cc(_.x,_.y,b.x,b.y,E.x,E.y,te.x,te.y)&&Ca(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function Ad(a,s,c){var m=a;do{var _=m.prev,b=m.next.next;!Tc(_,b)&&Xh(_,m,m.next,b)&&rl(_,b)&&rl(b,_)&&(s.push(_.i/c),s.push(m.i/c),s.push(b.i/c),ec(m),ec(m.next),m=a=b),m=m.next}while(m!==a);return Jl(m)}function Cd(a,s,c,m,_,b){var E=a;do{for(var M=E.next.next;M!==E.prev;){if(E.i!==M.i&&Ql(E,M)){var P=_h(E,M);return E=Jl(E,E.next),P=Jl(P,P.next),gh(E,s,c,m,_,b),void gh(P,s,c,m,_,b)}M=M.next}E=E.next}while(E!==a)}function Mp(a,s){return a.x-s.x}function Nv(a,s){if(s=function(m,_){var b,E=_,M=m.x,P=m.y,F=-1/0;do{if(P<=E.y&&P>=E.next.y&&E.next.y!==E.y){var j=E.x+(P-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(j<=M&&j>F){if(F=j,j===M){if(P===E.y)return E;if(P===E.next.y)return E.next}b=E.x<E.next.x?E:E.next}}E=E.next}while(E!==_);if(!b)return null;if(M===F)return b;var H,te=b,ue=b.x,De=b.y,Be=1/0;E=b;do M>=E.x&&E.x>=ue&&M!==E.x&&Cc(P<De?M:F,P,ue,De,P<De?F:M,P,E.x,E.y)&&(H=Math.abs(P-E.y)/(M-E.x),rl(E,m)&&(H<Be||H===Be&&(E.x>b.x||E.x===b.x&&$h(b,E)))&&(b=E,Be=H)),E=E.next;while(E!==te);return b}(a,s)){var c=_h(s,a);Jl(s,s.next),Jl(c,c.next)}}function $h(a,s){return Ca(a.prev,a,s.prev)<0&&Ca(s.next,a,a.next)<0}function yh(a,s,c,m,_){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-c)*_)|a<<8))|a<<4))|a<<2))|a<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-m)*_)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Zv(a){var s=a,c=a;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==a);return c}function Cc(a,s,c,m,_,b,E,M){return(_-E)*(s-M)-(a-E)*(b-M)>=0&&(a-E)*(m-M)-(c-E)*(s-M)>=0&&(c-E)*(b-M)-(_-E)*(m-M)>=0}function Ql(a,s){return a.next.i!==s.i&&a.prev.i!==s.i&&!function(c,m){var _=c;do{if(_.i!==c.i&&_.next.i!==c.i&&_.i!==m.i&&_.next.i!==m.i&&Xh(_,_.next,c,m))return!0;_=_.next}while(_!==c);return!1}(a,s)&&(rl(a,s)&&rl(s,a)&&function(c,m){var _=c,b=!1,E=(c.x+m.x)/2,M=(c.y+m.y)/2;do _.y>M!=_.next.y>M&&_.next.y!==_.y&&E<(_.next.x-_.x)*(M-_.y)/(_.next.y-_.y)+_.x&&(b=!b),_=_.next;while(_!==c);return b}(a,s)&&(Ca(a.prev,a,s.prev)||Ca(a,s.prev,s))||Tc(a,s)&&Ca(a.prev,a,a.next)>0&&Ca(s.prev,s,s.next)>0)}function Ca(a,s,c){return(s.y-a.y)*(c.x-s.x)-(s.x-a.x)*(c.y-s.y)}function Tc(a,s){return a.x===s.x&&a.y===s.y}function Xh(a,s,c,m){var _=rf(Ca(a,s,c)),b=rf(Ca(a,s,m)),E=rf(Ca(c,m,a)),M=rf(Ca(c,m,s));return _!==b&&E!==M||!(_!==0||!Mc(a,c,s))||!(b!==0||!Mc(a,m,s))||!(E!==0||!Mc(c,a,m))||!(M!==0||!Mc(c,s,m))}function Mc(a,s,c){return s.x<=Math.max(a.x,c.x)&&s.x>=Math.min(a.x,c.x)&&s.y<=Math.max(a.y,c.y)&&s.y>=Math.min(a.y,c.y)}function rf(a){return a>0?1:a<0?-1:0}function rl(a,s){return Ca(a.prev,a,a.next)<0?Ca(a,s,a.next)>=0&&Ca(a,a.prev,s)>=0:Ca(a,s,a.prev)<0||Ca(a,a.next,s)<0}function _h(a,s){var c=new nf(a.i,a.x,a.y),m=new nf(s.i,s.x,s.y),_=a.next,b=s.prev;return a.next=s,s.prev=a,c.next=_,_.prev=c,m.next=c,c.prev=m,b.next=m,m.prev=b,m}function Lf(a,s,c,m){var _=new nf(a,s,c);return m?(_.next=m.next,_.prev=m,m.next.prev=_,m.next=_):(_.prev=_,_.next=_),_}function ec(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function nf(a,s,c){this.i=a,this.x=s,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function af(a,s,c,m){for(var _=0,b=s,E=c-m;b<c;b+=m)_+=(a[E]-a[b])*(a[b+1]+a[E+1]),E=b;return _}function of(a,s,c,m,_){(function b(E,M,P,F,j){for(;F>P;){if(F-P>600){var H=F-P+1,te=M-P+1,ue=Math.log(H),De=.5*Math.exp(2*ue/3),Be=.5*Math.sqrt(ue*De*(H-De)/H)*(te-H/2<0?-1:1);b(E,M,Math.max(P,Math.floor(M-te*De/H+Be)),Math.min(F,Math.floor(M+(H-te)*De/H+Be)),j)}var Je=E[M],He=P,mt=F;for(Pu(E,P,M),j(E[F],Je)>0&&Pu(E,P,F);He<mt;){for(Pu(E,He,mt),He++,mt--;j(E[He],Je)<0;)He++;for(;j(E[mt],Je)>0;)mt--}j(E[P],Je)===0?Pu(E,P,mt):Pu(E,++mt,F),mt<=M&&(P=mt+1),M<=mt&&(F=mt-1)}})(a,s,c||0,m||a.length-1,_||sf)}function Pu(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}function sf(a,s){return a<s?-1:a>s?1:0}function kc(a,s){var c=a.length;if(c<=1)return[a];for(var m,_,b=[],E=0;E<c;E++){var M=xr(a[E]);M!==0&&(a[E].area=Math.abs(M),_===void 0&&(_=M<0),_===M<0?(m&&b.push(m),m=[a[E]]):m.push(a[E]))}if(m&&b.push(m),s>1)for(var P=0;P<b.length;P++)b[P].length<=s||(of(b[P],s,1,b[P].length-1,Rf),b[P]=b[P].slice(0,s));return b}function Rf(a,s){return s.area-a.area}function Ic(a,s,c){for(var m=c.patternDependencies,_=!1,b=0,E=s;b<E.length;b+=1){var M=E[b].paint.get(a+"-pattern");M.isConstant()||(_=!0);var P=M.constantOr(null);P&&(_=!0,m[P.to]=!0,m[P.from]=!0)}return _}function El(a,s,c,m,_){for(var b=_.patternDependencies,E=0,M=s;E<M.length;E+=1){var P=M[E],F=P.paint.get(a+"-pattern").value;if(F.kind!=="constant"){var j=F.evaluate({zoom:m-1},c,{},_.availableImages),H=F.evaluate({zoom:m},c,{},_.availableImages),te=F.evaluate({zoom:m+1},c,{},_.availableImages);H=H&&H.name?H.name:H,te=te&&te.name?te.name:te,b[j=j&&j.name?j.name:j]=!0,b[H]=!0,b[te]=!0,c.patterns[P.id]={min:j,mid:H,max:te}}}return c}Ac.deviation=function(a,s,c,m){var _=s&&s.length,b=Math.abs(af(a,0,_?s[0]*c:a.length,c));if(_)for(var E=0,M=s.length;E<M;E++)b-=Math.abs(af(a,s[E]*c,E<M-1?s[E+1]*c:a.length,c));var P=0;for(E=0;E<m.length;E+=3){var F=m[E]*c,j=m[E+1]*c,H=m[E+2]*c;P+=Math.abs((a[F]-a[H])*(a[j+1]-a[F+1])-(a[F]-a[j])*(a[H+1]-a[F+1]))}return b===0&&P===0?0:Math.abs((P-b)/b)},Ac.flatten=function(a){for(var s=a[0][0].length,c={vertices:[],holes:[],dimensions:s},m=0,_=0;_<a.length;_++){for(var b=0;b<a[_].length;b++)for(var E=0;E<s;E++)c.vertices.push(a[_][b][E]);_>0&&c.holes.push(m+=a[_-1].length)}return c},Iu.default=Hh;var gu=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ku,this.indexArray=new es,this.indexArray2=new pu,this.programConfigurations=new Zn(a.layers,a.zoom),this.segments=new ve,this.segments2=new ve,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};gu.prototype.populate=function(a,s,c){this.hasPattern=Ic("fill",this.layers,s);for(var m=this.layers[0].layout.get("fill-sort-key"),_=[],b=0,E=a;b<E.length;b+=1){var M=E[b],P=M.feature,F=M.id,j=M.index,H=M.sourceLayerIndex,te=this.layers[0]._featureFilter.needGeometry,ue=za(P,te);if(this.layers[0]._featureFilter.filter(new Ee(this.zoom),ue,c)){var De=m?m.evaluate(ue,{},c,s.availableImages):void 0,Be={id:F,properties:P.properties,type:P.type,sourceLayerIndex:H,index:j,geometry:te?ue.geometry:xa(P),patterns:{},sortKey:De};_.push(Be)}}m&&_.sort(function(yr,Xr){return yr.sortKey-Xr.sortKey});for(var Je=0,He=_;Je<He.length;Je+=1){var mt=He[Je],Lt=mt.geometry,zt=mt.index,Zt=mt.sourceLayerIndex;if(this.hasPattern){var ur=El("fill",this.layers,mt,this.zoom,s);this.patternFeatures.push(ur)}else this.addFeature(mt,Lt,zt,c,{});s.featureIndex.insert(a[zt].feature,Lt,zt,Zt,this.index)}},gu.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},gu.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var b=_[m];this.addFeature(b,b.geometry,b.index,s,c)}},gu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},gu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},gu.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Sd),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},gu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},gu.prototype.addFeature=function(a,s,c,m,_){for(var b=0,E=kc(s,500);b<E.length;b+=1){for(var M=E[b],P=0,F=0,j=M;F<j.length;F+=1)P+=j[F].length;for(var H=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),te=H.vertexLength,ue=[],De=[],Be=0,Je=M;Be<Je.length;Be+=1){var He=Je[Be];if(He.length!==0){He!==M[0]&&De.push(ue.length/2);var mt=this.segments2.prepareSegment(He.length,this.layoutVertexArray,this.indexArray2),Lt=mt.vertexLength;this.layoutVertexArray.emplaceBack(He[0].x,He[0].y),this.indexArray2.emplaceBack(Lt+He.length-1,Lt),ue.push(He[0].x),ue.push(He[0].y);for(var zt=1;zt<He.length;zt++)this.layoutVertexArray.emplaceBack(He[zt].x,He[zt].y),this.indexArray2.emplaceBack(Lt+zt-1,Lt+zt),ue.push(He[zt].x),ue.push(He[zt].y);mt.vertexLength+=He.length,mt.primitiveLength+=He.length}}for(var Zt=Iu(ue,De),ur=0;ur<Zt.length;ur+=3)this.indexArray.emplaceBack(te+Zt[ur],te+Zt[ur+1],te+Zt[ur+2]);H.vertexLength+=P,H.primitiveLength+=Zt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},pn("FillBucket",gu,{omit:["layers","patternFeatures"]});var Df=new yo({"fill-sort-key":new _n(pe.layout_fill["fill-sort-key"])}),Td={paint:new yo({"fill-antialias":new Ln(pe.paint_fill["fill-antialias"]),"fill-opacity":new _n(pe.paint_fill["fill-opacity"]),"fill-color":new _n(pe.paint_fill["fill-color"]),"fill-outline-color":new _n(pe.paint_fill["fill-outline-color"]),"fill-translate":new Ln(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ln(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new qu(pe.paint_fill["fill-pattern"])}),layout:Df},Of=function(a){function s(c){a.call(this,c,Td)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(c){return new gu(c)},s.prototype.queryRadius=function(){return Na(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,P){return ws(mu(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,P),b)},s.prototype.isTileClipped=function(){return!0},s}(Qs),Md=Ba([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Lu=Pc;function Pc(a,s,c,m,_){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=m,this._values=_,a.readFields(Ff,this,s)}function Ff(a,s,c){a==1?s.id=c.readVarint():a==2?function(m,_){for(var b=m.readVarint()+m.pos;m.pos<b;){var E=_._keys[m.readVarint()],M=_._values[m.readVarint()];_.properties[E]=M}}(c,s):a==3?s.type=c.readVarint():a==4&&(s._geometry=c.pos)}function Yh(a){for(var s,c,m=0,_=0,b=a.length,E=b-1;_<b;E=_++)m+=((c=a[E]).x-(s=a[_]).x)*(s.y+c.y);return m}Pc.types=["Unknown","Point","LineString","Polygon"],Pc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var s,c=a.readVarint()+a.pos,m=1,_=0,b=0,E=0,M=[];a.pos<c;){if(_<=0){var P=a.readVarint();m=7&P,_=P>>3}if(_--,m===1||m===2)b+=a.readSVarint(),E+=a.readSVarint(),m===1&&(s&&M.push(s),s=[]),s.push(new ae(b,E));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&M.push(s),M},Pc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var s=a.readVarint()+a.pos,c=1,m=0,_=0,b=0,E=1/0,M=-1/0,P=1/0,F=-1/0;a.pos<s;){if(m<=0){var j=a.readVarint();c=7&j,m=j>>3}if(m--,c===1||c===2)(_+=a.readSVarint())<E&&(E=_),_>M&&(M=_),(b+=a.readSVarint())<P&&(P=b),b>F&&(F=b);else if(c!==7)throw new Error("unknown command "+c)}return[E,P,M,F]},Pc.prototype.toGeoJSON=function(a,s,c){var m,_,b=this.extent*Math.pow(2,c),E=this.extent*a,M=this.extent*s,P=this.loadGeometry(),F=Pc.types[this.type];function j(ue){for(var De=0;De<ue.length;De++){var Be=ue[De];ue[De]=[360*(Be.x+E)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Be.y+M)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(m=0;m<P.length;m++)H[m]=P[m][0];j(P=H);break;case 2:for(m=0;m<P.length;m++)j(P[m]);break;case 3:for(P=function(ue){var De=ue.length;if(De<=1)return[ue];for(var Be,Je,He=[],mt=0;mt<De;mt++){var Lt=Yh(ue[mt]);Lt!==0&&(Je===void 0&&(Je=Lt<0),Je===Lt<0?(Be&&He.push(Be),Be=[ue[mt]]):Be.push(ue[mt]))}return Be&&He.push(Be),He}(P),m=0;m<P.length;m++)for(_=0;_<P[m].length;_++)j(P[m][_])}P.length===1?P=P[0]:F="Multi"+F;var te={type:"Feature",geometry:{type:F,coordinates:P},properties:this.properties};return"id"in this&&(te.id=this.id),te};var xh=Bf;function Bf(a,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(kp,this,s),this.length=this._features.length}function kp(a,s,c){a===15?s.version=c.readVarint():a===1?s.name=c.readString():a===5?s.extent=c.readVarint():a===2?s._features.push(c.pos):a===3?s._keys.push(c.readString()):a===4&&s._values.push(function(m){for(var _=null,b=m.readVarint()+m.pos;m.pos<b;){var E=m.readVarint()>>3;_=E===1?m.readString():E===2?m.readFloat():E===3?m.readDouble():E===4?m.readVarint64():E===5?m.readVarint():E===6?m.readSVarint():E===7?m.readBoolean():null}return _}(c))}function Ru(a,s,c){if(a===3){var m=new xh(c,c.readVarint()+c.pos);m.length&&(s[m.name]=m)}}Bf.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var s=this._pbf.readVarint()+this._pbf.pos;return new Lu(this._pbf,s,this.extent,this._keys,this._values)};var Ts={VectorTile:function(a,s){this.layers=a.readFields(Ru,{},s)},VectorTileFeature:Lu,VectorTileLayer:xh},uf=Ts.VectorTileFeature.types,Du=Math.pow(2,13);function Lc(a,s,c,m,_,b,E,M){a.emplaceBack(s,c,2*Math.floor(m*Du)+E,_*Du*2,b*Du*2,Math.round(M))}var Ms=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new hu,this.indexArray=new es,this.programConfigurations=new Zn(a.layers,a.zoom),this.segments=new ve,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function lf(a,s){return a.x===s.x&&(a.x<0||a.x>8192)||a.y===s.y&&(a.y<0||a.y>8192)}Ms.prototype.populate=function(a,s,c){this.features=[],this.hasPattern=Ic("fill-extrusion",this.layers,s);for(var m=0,_=a;m<_.length;m+=1){var b=_[m],E=b.feature,M=b.id,P=b.index,F=b.sourceLayerIndex,j=this.layers[0]._featureFilter.needGeometry,H=za(E,j);if(this.layers[0]._featureFilter.filter(new Ee(this.zoom),H,c)){var te={id:M,sourceLayerIndex:F,index:P,geometry:j?H.geometry:xa(E),properties:E.properties,type:E.type,patterns:{}};this.hasPattern?this.features.push(El("fill-extrusion",this.layers,te,this.zoom,s)):this.addFeature(te,te.geometry,P,c,{}),s.featureIndex.insert(E,te.geometry,P,F,this.index,!0)}}},Ms.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.features;m<_.length;m+=1){var b=_[m];this.addFeature(b,b.geometry,b.index,s,c)}},Ms.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},Ms.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ms.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ms.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Md),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ms.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ms.prototype.addFeature=function(a,s,c,m,_){for(var b=0,E=kc(s,500);b<E.length;b+=1){for(var M=E[b],P=0,F=0,j=M;F<j.length;F+=1)P+=j[F].length;for(var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),te=0,ue=M;te<ue.length;te+=1){var De=ue[te];if(De.length!==0&&!((on=De).every(function(Kr){return Kr.x<0})||on.every(function(Kr){return Kr.x>8192})||on.every(function(Kr){return Kr.y<0})||on.every(function(Kr){return Kr.y>8192})))for(var Be=0,Je=0;Je<De.length;Je++){var He=De[Je];if(Je>=1){var mt=De[Je-1];if(!lf(He,mt)){H.vertexLength+4>ve.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Lt=He.sub(mt)._perp()._unit(),zt=mt.dist(He);Be+zt>32768&&(Be=0),Lc(this.layoutVertexArray,He.x,He.y,Lt.x,Lt.y,0,0,Be),Lc(this.layoutVertexArray,He.x,He.y,Lt.x,Lt.y,0,1,Be),Lc(this.layoutVertexArray,mt.x,mt.y,Lt.x,Lt.y,0,0,Be+=zt),Lc(this.layoutVertexArray,mt.x,mt.y,Lt.x,Lt.y,0,1,Be);var Zt=H.vertexLength;this.indexArray.emplaceBack(Zt,Zt+2,Zt+1),this.indexArray.emplaceBack(Zt+1,Zt+2,Zt+3),H.vertexLength+=4,H.primitiveLength+=2}}}}if(H.vertexLength+P>ve.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),uf[a.type]==="Polygon"){for(var ur=[],yr=[],Xr=H.vertexLength,Fn=0,nn=M;Fn<nn.length;Fn+=1){var Bn=nn[Fn];if(Bn.length!==0){Bn!==M[0]&&yr.push(ur.length/2);for(var sn=0;sn<Bn.length;sn++){var gi=Bn[sn];Lc(this.layoutVertexArray,gi.x,gi.y,0,0,1,1,0),ur.push(gi.x),ur.push(gi.y)}}}for(var Kn=Iu(ur,yr),En=0;En<Kn.length;En+=3)this.indexArray.emplaceBack(Xr+Kn[En],Xr+Kn[En+2],Xr+Kn[En+1]);H.primitiveLength+=Kn.length/3,H.vertexLength+=P}}var on;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},pn("FillExtrusionBucket",Ms,{omit:["layers","features"]});var Ip={paint:new yo({"fill-extrusion-opacity":new Ln(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _n(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ln(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ln(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new qu(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _n(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _n(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ln(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},ks=function(a){function s(c){a.call(this,c,Ip)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new Ms(c)},s.prototype.queryRadius=function(){return Na(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,P,F){var j=mu(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,P),H=this.paint.get("fill-extrusion-height").evaluate(m,_),te=this.paint.get("fill-extrusion-base").evaluate(m,_),ue=function(Be,Je,He,mt){for(var Lt=[],zt=0,Zt=Be;zt<Zt.length;zt+=1){var ur=Zt[zt],yr=[ur.x,ur.y,0,1];$s(yr,yr,Je),Lt.push(new ae(yr[0]/yr[3],yr[1]/yr[3]))}return Lt}(j,F),De=function(Be,Je,He,mt){for(var Lt=[],zt=[],Zt=mt[8]*Je,ur=mt[9]*Je,yr=mt[10]*Je,Xr=mt[11]*Je,Fn=mt[8]*He,nn=mt[9]*He,Bn=mt[10]*He,sn=mt[11]*He,gi=0,Kn=Be;gi<Kn.length;gi+=1){for(var En=[],on=[],Kr=0,Fi=Kn[gi];Kr<Fi.length;Kr+=1){var Nn=Fi[Kr],Vi=Nn.x,Ta=Nn.y,to=mt[0]*Vi+mt[4]*Ta+mt[12],Xa=mt[1]*Vi+mt[5]*Ta+mt[13],Ma=mt[2]*Vi+mt[6]*Ta+mt[14],ro=mt[3]*Vi+mt[7]*Ta+mt[15],Fo=Ma+yr,Bo=ro+Xr,Ls=to+Fn,Go=Xa+nn,Rs=Ma+Bn,lo=ro+sn,zo=new ae((to+Zt)/Bo,(Xa+ur)/Bo);zo.z=Fo/Bo,En.push(zo);var Li=new ae(Ls/lo,Go/lo);Li.z=Rs/lo,on.push(Li)}Lt.push(En),zt.push(on)}return[Lt,zt]}(b,te,H,F);return function(Be,Je,He){var mt=1/0;ws(He,Je)&&(mt=ja(He,Je[0]));for(var Lt=0;Lt<Je.length;Lt++)for(var zt=Je[Lt],Zt=Be[Lt],ur=0;ur<zt.length-1;ur++){var yr=zt[ur],Xr=[yr,zt[ur+1],Zt[ur+1],Zt[ur],yr];el(He,Xr)&&(mt=Math.min(mt,ja(He,Xr)))}return mt!==1/0&&mt}(De[0],De[1],ue)},s}(Qs);function yu(a,s){return a.x*s.x+a.y*s.y}function ja(a,s){if(a.length===1){for(var c,m=0,_=s[m++];!c||_.equals(c);)if(!(c=s[m++]))return 1/0;for(;m<s.length;m++){var b=s[m],E=a[0],M=c.sub(_),P=b.sub(_),F=E.sub(_),j=yu(M,M),H=yu(M,P),te=yu(P,P),ue=yu(F,M),De=yu(F,P),Be=j*te-H*H,Je=(te*ue-H*De)/Be,He=(j*De-H*ue)/Be,mt=_.z*(1-Je-He)+c.z*Je+b.z*He;if(isFinite(mt))return mt}return 1/0}for(var Lt=1/0,zt=0,Zt=s;zt<Zt.length;zt+=1)Lt=Math.min(Lt,Zt[zt].z);return Lt}var hs=Ba([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,qh=Ba([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Pp=Ts.VectorTileFeature.types,kd=Math.cos(Math.PI/180*37.5),Lp=Math.pow(2,14)/.5,Ro=function(a){var s=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){s.gradients[c.id]={}}),this.layoutVertexArray=new Io,this.layoutVertexArray2=new yl,this.indexArray=new es,this.programConfigurations=new Zn(a.layers,a.zoom),this.segments=new ve,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};Ro.prototype.populate=function(a,s,c){this.hasPattern=Ic("line",this.layers,s);for(var m=this.layers[0].layout.get("line-sort-key"),_=[],b=0,E=a;b<E.length;b+=1){var M=E[b],P=M.feature,F=M.id,j=M.index,H=M.sourceLayerIndex,te=this.layers[0]._featureFilter.needGeometry,ue=za(P,te);if(this.layers[0]._featureFilter.filter(new Ee(this.zoom),ue,c)){var De=m?m.evaluate(ue,{},c):void 0,Be={id:F,properties:P.properties,type:P.type,sourceLayerIndex:H,index:j,geometry:te?ue.geometry:xa(P),patterns:{},sortKey:De};_.push(Be)}}m&&_.sort(function(yr,Xr){return yr.sortKey-Xr.sortKey});for(var Je=0,He=_;Je<He.length;Je+=1){var mt=He[Je],Lt=mt.geometry,zt=mt.index,Zt=mt.sourceLayerIndex;if(this.hasPattern){var ur=El("line",this.layers,mt,this.zoom,s);this.patternFeatures.push(ur)}else this.addFeature(mt,Lt,zt,c,{});s.featureIndex.insert(a[zt].feature,Lt,zt,Zt,this.index)}},Ro.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},Ro.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var b=_[m];this.addFeature(b,b.geometry,b.index,s,c)}},Ro.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ro.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ro.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,qh)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,hs),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ro.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ro.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Ro.prototype.addFeature=function(a,s,c,m,_){var b=this.layers[0].layout,E=b.get("line-join").evaluate(a,{}),M=b.get("line-cap"),P=b.get("line-miter-limit"),F=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var j=0,H=s;j<H.length;j+=1)this.addLine(H[j],a,E,M,P,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},Ro.prototype.addLine=function(a,s,c,m,_,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var E=0;E<a.length-1;E++)this.totalDistance+=a[E].dist(a[E+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Pp[s.type]==="Polygon",P=a.length;P>=2&&a[P-1].equals(a[P-2]);)P--;for(var F=0;F<P-1&&a[F].equals(a[F+1]);)F++;if(!(P<(M?3:2))){c==="bevel"&&(_=1.05);var j,H=this.overscaling<=16?122880/(512*this.overscaling):0,te=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray),ue=void 0,De=void 0,Be=void 0,Je=void 0;this.e1=this.e2=-1,M&&(Je=a[F].sub(j=a[P-2])._unit()._perp());for(var He=F;He<P;He++)if(!(De=He===P-1?M?a[F+1]:void 0:a[He+1])||!a[He].equals(De)){Je&&(Be=Je),j&&(ue=j),j=a[He],Je=De?De.sub(j)._unit()._perp():Be;var mt=(Be=Be||Je).add(Je);mt.x===0&&mt.y===0||mt._unit();var Lt=Be.x*Je.x+Be.y*Je.y,zt=mt.x*Je.x+mt.y*Je.y,Zt=zt!==0?1/zt:1/0,ur=2*Math.sqrt(2-2*zt),yr=zt<kd&&ue&&De,Xr=Be.x*Je.y-Be.y*Je.x>0;if(yr&&He>F){var Fn=j.dist(ue);if(Fn>2*H){var nn=j.sub(j.sub(ue)._mult(H/Fn)._round());this.updateDistance(ue,nn),this.addCurrentVertex(nn,Be,0,0,te),ue=nn}}var Bn=ue&&De,sn=Bn?c:M?"butt":m;if(Bn&&sn==="round"&&(Zt<b?sn="miter":Zt<=2&&(sn="fakeround")),sn==="miter"&&Zt>_&&(sn="bevel"),sn==="bevel"&&(Zt>2&&(sn="flipbevel"),Zt<_&&(sn="miter")),ue&&this.updateDistance(ue,j),sn==="miter")mt._mult(Zt),this.addCurrentVertex(j,mt,0,0,te);else if(sn==="flipbevel"){if(Zt>100)mt=Je.mult(-1);else{var gi=Zt*Be.add(Je).mag()/Be.sub(Je).mag();mt._perp()._mult(gi*(Xr?-1:1))}this.addCurrentVertex(j,mt,0,0,te),this.addCurrentVertex(j,mt.mult(-1),0,0,te)}else if(sn==="bevel"||sn==="fakeround"){var Kn=-Math.sqrt(Zt*Zt-1),En=Xr?Kn:0,on=Xr?0:Kn;if(ue&&this.addCurrentVertex(j,Be,En,on,te),sn==="fakeround")for(var Kr=Math.round(180*ur/Math.PI/20),Fi=1;Fi<Kr;Fi++){var Nn=Fi/Kr;if(Nn!==.5){var Vi=Nn-.5;Nn+=Nn*Vi*(Nn-1)*((1.0904+Lt*(Lt*(3.55645-1.43519*Lt)-3.2452))*Vi*Vi+(.848013+Lt*(.215638*Lt-1.06021)))}var Ta=Je.sub(Be)._mult(Nn)._add(Be)._unit()._mult(Xr?-1:1);this.addHalfVertex(j,Ta.x,Ta.y,!1,Xr,0,te)}De&&this.addCurrentVertex(j,Je,-En,-on,te)}else if(sn==="butt")this.addCurrentVertex(j,mt,0,0,te);else if(sn==="square"){var to=ue?1:-1;this.addCurrentVertex(j,mt,to,to,te)}else sn==="round"&&(ue&&(this.addCurrentVertex(j,Be,0,0,te),this.addCurrentVertex(j,Be,1,1,te,!0)),De&&(this.addCurrentVertex(j,Je,-1,-1,te,!0),this.addCurrentVertex(j,Je,0,0,te)));if(yr&&He<P-1){var Xa=j.dist(De);if(Xa>2*H){var Ma=j.add(De.sub(j)._mult(H/Xa)._round());this.updateDistance(j,Ma),this.addCurrentVertex(Ma,Je,0,0,te),j=Ma}}}}},Ro.prototype.addCurrentVertex=function(a,s,c,m,_,b){b===void 0&&(b=!1);var E=s.y*m-s.x,M=-s.y-s.x*m;this.addHalfVertex(a,s.x+s.y*c,s.y-s.x*c,b,!1,c,_),this.addHalfVertex(a,E,M,b,!0,-m,_),this.distance>Lp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,s,c,m,_,b))},Ro.prototype.addHalfVertex=function(a,s,c,m,_,b,E){var M=.5*(this.lineClips?this.scaledDistance*(Lp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(m?1:0),(a.y<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(b===0?0:b<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var P=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),E.primitiveLength++),_?this.e2=P:this.e1=P},Ro.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ro.prototype.updateDistance=function(a,s){this.distance+=a.dist(s),this.updateScaledDistance()},pn("LineBucket",Ro,{omit:["layers","patternFeatures"]});var Rp=new yo({"line-cap":new Ln(pe.layout_line["line-cap"]),"line-join":new _n(pe.layout_line["line-join"]),"line-miter-limit":new Ln(pe.layout_line["line-miter-limit"]),"line-round-limit":new Ln(pe.layout_line["line-round-limit"]),"line-sort-key":new _n(pe.layout_line["line-sort-key"])}),Dp={paint:new yo({"line-opacity":new _n(pe.paint_line["line-opacity"]),"line-color":new _n(pe.paint_line["line-color"]),"line-translate":new Ln(pe.paint_line["line-translate"]),"line-translate-anchor":new Ln(pe.paint_line["line-translate-anchor"]),"line-width":new _n(pe.paint_line["line-width"]),"line-gap-width":new _n(pe.paint_line["line-gap-width"]),"line-offset":new _n(pe.paint_line["line-offset"]),"line-blur":new _n(pe.paint_line["line-blur"]),"line-dasharray":new ko(pe.paint_line["line-dasharray"]),"line-pattern":new qu(pe.paint_line["line-pattern"]),"line-gradient":new qa(pe.paint_line["line-gradient"])}),layout:Rp},zf=new(function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m){return m=new Ee(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),a.prototype.possiblyEvaluate.call(this,c,m)},s.prototype.evaluate=function(c,m,_,b){return m=qt({},m,{zoom:Math.floor(m.zoom)}),a.prototype.evaluate.call(this,c,m,_,b)},s}(_n))(Dp.paint.properties["line-width"].specification);zf.useIntegerZoom=!0;var Kh=function(a){function s(c){a.call(this,c,Dp),this.gradientVersion=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Yo,this.gradientVersion=(this.gradientVersion+1)%je)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m),this.paint._values["line-floorwidth"]=zf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},s.prototype.createBucket=function(c){return new Ro(c)},s.prototype.queryRadius=function(c){var m=c,_=Op(fs("line-width",this,m),fs("line-gap-width",this,m)),b=fs("line-offset",this,m);return _/2+Math.abs(b)+Na(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,P){var F=mu(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,P),j=P/2*Op(this.paint.get("line-width").evaluate(m,_),this.paint.get("line-gap-width").evaluate(m,_)),H=this.paint.get("line-offset").evaluate(m,_);return H&&(b=function(te,ue){for(var De=[],Be=new ae(0,0),Je=0;Je<te.length;Je++){for(var He=te[Je],mt=[],Lt=0;Lt<He.length;Lt++){var zt=He[Lt],Zt=He[Lt+1],ur=Lt===0?Be:zt.sub(He[Lt-1])._unit()._perp(),yr=Lt===He.length-1?Be:Zt.sub(zt)._unit()._perp(),Xr=ur._add(yr)._unit();Xr._mult(1/(Xr.x*yr.x+Xr.y*yr.y)),mt.push(Xr._mult(ue)._add(zt))}De.push(mt)}return De}(b,H*P)),function(te,ue,De){for(var Be=0;Be<ue.length;Be++){var Je=ue[Be];if(te.length>=3){for(var He=0;He<Je.length;He++)if(Ws(te,Je[He]))return!0}if(Es(te,Je,De))return!0}return!1}(F,b,j)},s.prototype.isTileClipped=function(){return!0},s}(Qs);function Op(a,s){return s>0?s+2*a:a}var Nf=Ba([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Fp=Ba([{name:"a_projected_pos",components:3,type:"Float32"}],4),Bp=(Ba([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ba([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Jh=(Ba([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ba([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Id=Ba([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Pd(a,s,c){return a.sections.forEach(function(m){m.text=function(_,b,E){var M=b.layout.get("text-transform").evaluate(E,{});return M==="uppercase"?_=_.toLocaleUpperCase():M==="lowercase"&&(_=_.toLocaleLowerCase()),It.applyArabicShaping&&(_=It.applyArabicShaping(_)),_}(m.text,s,c)}),a}Ba([{name:"triangle",components:3,type:"Uint16"}]),Ba([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ba([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ba([{type:"Float32",name:"offsetX"}]),Ba([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var cf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},zp=function(a,s,c,m,_){var b,E,M=8*_-m-1,P=(1<<M)-1,F=P>>1,j=-7,H=c?_-1:0,te=c?-1:1,ue=a[s+H];for(H+=te,b=ue&(1<<-j)-1,ue>>=-j,j+=M;j>0;b=256*b+a[s+H],H+=te,j-=8);for(E=b&(1<<-j)-1,b>>=-j,j+=m;j>0;E=256*E+a[s+H],H+=te,j-=8);if(b===0)b=1-F;else{if(b===P)return E?NaN:1/0*(ue?-1:1);E+=Math.pow(2,m),b-=F}return(ue?-1:1)*E*Math.pow(2,b-m)},B=function(a,s,c,m,_,b){var E,M,P,F=8*b-_-1,j=(1<<F)-1,H=j>>1,te=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,ue=m?0:b-1,De=m?1:-1,Be=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(M=isNaN(s)?1:0,E=j):(E=Math.floor(Math.log(s)/Math.LN2),s*(P=Math.pow(2,-E))<1&&(E--,P*=2),(s+=E+H>=1?te/P:te*Math.pow(2,1-H))*P>=2&&(E++,P/=2),E+H>=j?(M=0,E=j):E+H>=1?(M=(s*P-1)*Math.pow(2,_),E+=H):(M=s*Math.pow(2,H-1)*Math.pow(2,_),E=0));_>=8;a[c+ue]=255&M,ue+=De,M/=256,_-=8);for(E=E<<_|M,F+=_;F>0;a[c+ue]=255&E,ue+=De,E/=256,F-=8);a[c+ue-De]|=128*Be},Se=Ie;function Ie(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Ie.Varint=0,Ie.Fixed64=1,Ie.Bytes=2,Ie.Fixed32=5;var Nt=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function or(a){return a.type===Ie.Bytes?a.readVarint()+a.pos:a.pos+1}function Dt(a,s,c){return c?4294967296*s+(a>>>0):4294967296*(s>>>0)+(a>>>0)}function Xt(a,s,c){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));c.realloc(m);for(var _=c.pos-1;_>=a;_--)c.buf[_+m]=c.buf[_]}function Cr(a,s){for(var c=0;c<a.length;c++)s.writeVarint(a[c])}function Mr(a,s){for(var c=0;c<a.length;c++)s.writeSVarint(a[c])}function Or(a,s){for(var c=0;c<a.length;c++)s.writeFloat(a[c])}function Pr(a,s){for(var c=0;c<a.length;c++)s.writeDouble(a[c])}function Nr(a,s){for(var c=0;c<a.length;c++)s.writeBoolean(a[c])}function $r(a,s){for(var c=0;c<a.length;c++)s.writeFixed32(a[c])}function Sr(a,s){for(var c=0;c<a.length;c++)s.writeSFixed32(a[c])}function Zr(a,s){for(var c=0;c<a.length;c++)s.writeFixed64(a[c])}function wt(a,s){for(var c=0;c<a.length;c++)s.writeSFixed64(a[c])}function Gt(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+16777216*a[s+3]}function Tr(a,s,c){a[c]=s,a[c+1]=s>>>8,a[c+2]=s>>>16,a[c+3]=s>>>24}function Jr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+(a[s+3]<<24)}function dr(a,s,c){a===1&&c.readMessage(rn,s)}function rn(a,s,c){if(a===3){var m=c.readMessage(_r,{}),_=m.width,b=m.height,E=m.left,M=m.top,P=m.advance;s.push({id:m.id,bitmap:new Lo({width:_+6,height:b+6},m.bitmap),metrics:{width:_,height:b,left:E,top:M,advance:P}})}}function _r(a,s,c){a===1?s.id=c.readVarint():a===2?s.bitmap=c.readBytes():a===3?s.width=c.readVarint():a===4?s.height=c.readVarint():a===5?s.left=c.readSVarint():a===6?s.top=c.readSVarint():a===7&&(s.advance=c.readVarint())}function Ur(a){for(var s=0,c=0,m=0,_=a;m<_.length;m+=1){var b=_[m];s+=b.w*b.h,c=Math.max(c,b.w)}a.sort(function(Be,Je){return Je.h-Be.h});for(var E=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),c),h:1/0}],M=0,P=0,F=0,j=a;F<j.length;F+=1)for(var H=j[F],te=E.length-1;te>=0;te--){var ue=E[te];if(!(H.w>ue.w||H.h>ue.h)){if(H.x=ue.x,H.y=ue.y,P=Math.max(P,H.y+H.h),M=Math.max(M,H.x+H.w),H.w===ue.w&&H.h===ue.h){var De=E.pop();te<E.length&&(E[te]=De)}else H.h===ue.h?(ue.x+=H.w,ue.w-=H.w):H.w===ue.w?(ue.y+=H.h,ue.h-=H.h):(E.push({x:ue.x+H.w,y:ue.y,w:ue.w-H.w,h:H.h}),ue.y+=H.h,ue.h-=H.h);break}}return{w:M,h:P,fill:s/(M*P)||0}}Ie.prototype={destroy:function(){this.buf=null},readFields:function(a,s,c){for(c=c||this.length;this.pos<c;){var m=this.readVarint(),_=m>>3,b=this.pos;this.type=7&m,a(_,s,this),this.pos===b&&this.skip(m)}return s},readMessage:function(a,s){return this.readFields(a,s,this.readVarint()+this.pos)},readFixed32:function(){var a=Gt(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Jr(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Gt(this.buf,this.pos)+4294967296*Gt(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=Gt(this.buf,this.pos)+4294967296*Jr(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=zp(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=zp(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var s,c,m=this.buf;return s=127&(c=m[this.pos++]),c<128?s:(s|=(127&(c=m[this.pos++]))<<7,c<128?s:(s|=(127&(c=m[this.pos++]))<<14,c<128?s:(s|=(127&(c=m[this.pos++]))<<21,c<128?s:function(_,b,E){var M,P,F=E.buf;if(M=(112&(P=F[E.pos++]))>>4,P<128||(M|=(127&(P=F[E.pos++]))<<3,P<128)||(M|=(127&(P=F[E.pos++]))<<10,P<128)||(M|=(127&(P=F[E.pos++]))<<17,P<128)||(M|=(127&(P=F[E.pos++]))<<24,P<128)||(M|=(1&(P=F[E.pos++]))<<31,P<128))return Dt(_,M,b);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(c=m[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,s=this.pos;return this.pos=a,a-s>=12&&Nt?function(c,m,_){return Nt.decode(c.subarray(m,_))}(this.buf,s,a):function(c,m,_){for(var b="",E=m;E<_;){var M,P,F,j=c[E],H=null,te=j>239?4:j>223?3:j>191?2:1;if(E+te>_)break;te===1?j<128&&(H=j):te===2?(192&(M=c[E+1]))==128&&(H=(31&j)<<6|63&M)<=127&&(H=null):te===3?(P=c[E+2],(192&(M=c[E+1]))==128&&(192&P)==128&&((H=(15&j)<<12|(63&M)<<6|63&P)<=2047||H>=55296&&H<=57343)&&(H=null)):te===4&&(P=c[E+2],F=c[E+3],(192&(M=c[E+1]))==128&&(192&P)==128&&(192&F)==128&&((H=(15&j)<<18|(63&M)<<12|(63&P)<<6|63&F)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,te=1):H>65535&&(H-=65536,b+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),b+=String.fromCharCode(H),E+=te}return b}(this.buf,s,a)},readBytes:function(){var a=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,a);return this.pos=a,s},readPackedVarint:function(a,s){if(this.type!==Ie.Bytes)return a.push(this.readVarint(s));var c=or(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(s));return a},readPackedSVarint:function(a){if(this.type!==Ie.Bytes)return a.push(this.readSVarint());var s=or(this);for(a=a||[];this.pos<s;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Ie.Bytes)return a.push(this.readBoolean());var s=or(this);for(a=a||[];this.pos<s;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Ie.Bytes)return a.push(this.readFloat());var s=or(this);for(a=a||[];this.pos<s;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Ie.Bytes)return a.push(this.readDouble());var s=or(this);for(a=a||[];this.pos<s;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Ie.Bytes)return a.push(this.readFixed32());var s=or(this);for(a=a||[];this.pos<s;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Ie.Bytes)return a.push(this.readSFixed32());var s=or(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Ie.Bytes)return a.push(this.readFixed64());var s=or(this);for(a=a||[];this.pos<s;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Ie.Bytes)return a.push(this.readSFixed64());var s=or(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed64());return a},skip:function(a){var s=7&a;if(s===Ie.Varint)for(;this.buf[this.pos++]>127;);else if(s===Ie.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Ie.Fixed32)this.pos+=4;else{if(s!==Ie.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(a,s){this.writeVarint(a<<3|s)},realloc:function(a){for(var s=this.length||16;s<this.pos+a;)s*=2;if(s!==this.length){var c=new Uint8Array(s);c.set(this.buf),this.buf=c,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Tr(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Tr(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Tr(this.buf,-1&a,this.pos),Tr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Tr(this.buf,-1&a,this.pos),Tr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(s,c){var m,_;if(s>=0?(m=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(b,E,M){M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,M.buf[M.pos]=127&(b>>>=7)}(m,0,c),function(b,E){var M=(7&b)<<4;E.buf[E.pos++]|=M|((b>>>=3)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b)))))}(_,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var s=this.pos;this.pos=function(m,_,b){for(var E,M,P=0;P<_.length;P++){if((E=_.charCodeAt(P))>55295&&E<57344){if(!M){E>56319||P+1===_.length?(m[b++]=239,m[b++]=191,m[b++]=189):M=E;continue}if(E<56320){m[b++]=239,m[b++]=191,m[b++]=189,M=E;continue}E=M-55296<<10|E-56320|65536,M=null}else M&&(m[b++]=239,m[b++]=191,m[b++]=189,M=null);E<128?m[b++]=E:(E<2048?m[b++]=E>>6|192:(E<65536?m[b++]=E>>12|224:(m[b++]=E>>18|240,m[b++]=E>>12&63|128),m[b++]=E>>6&63|128),m[b++]=63&E|128)}return b}(this.buf,a,this.pos);var c=this.pos-s;c>=128&&Xt(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),B(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),B(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var s=a.length;this.writeVarint(s),this.realloc(s);for(var c=0;c<s;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,s){this.pos++;var c=this.pos;a(s,this);var m=this.pos-c;m>=128&&Xt(c,m,this),this.pos=c-1,this.writeVarint(m),this.pos+=m},writeMessage:function(a,s,c){this.writeTag(a,Ie.Bytes),this.writeRawMessage(s,c)},writePackedVarint:function(a,s){s.length&&this.writeMessage(a,Cr,s)},writePackedSVarint:function(a,s){s.length&&this.writeMessage(a,Mr,s)},writePackedBoolean:function(a,s){s.length&&this.writeMessage(a,Nr,s)},writePackedFloat:function(a,s){s.length&&this.writeMessage(a,Or,s)},writePackedDouble:function(a,s){s.length&&this.writeMessage(a,Pr,s)},writePackedFixed32:function(a,s){s.length&&this.writeMessage(a,$r,s)},writePackedSFixed32:function(a,s){s.length&&this.writeMessage(a,Sr,s)},writePackedFixed64:function(a,s){s.length&&this.writeMessage(a,Zr,s)},writePackedSFixed64:function(a,s){s.length&&this.writeMessage(a,wt,s)},writeBytesField:function(a,s){this.writeTag(a,Ie.Bytes),this.writeBytes(s)},writeFixed32Field:function(a,s){this.writeTag(a,Ie.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(a,s){this.writeTag(a,Ie.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(a,s){this.writeTag(a,Ie.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(a,s){this.writeTag(a,Ie.Fixed64),this.writeSFixed64(s)},writeVarintField:function(a,s){this.writeTag(a,Ie.Varint),this.writeVarint(s)},writeSVarintField:function(a,s){this.writeTag(a,Ie.Varint),this.writeSVarint(s)},writeStringField:function(a,s){this.writeTag(a,Ie.Bytes),this.writeString(s)},writeFloatField:function(a,s){this.writeTag(a,Ie.Fixed32),this.writeFloat(s)},writeDoubleField:function(a,s){this.writeTag(a,Ie.Fixed64),this.writeDouble(s)},writeBooleanField:function(a,s){this.writeVarintField(a,Boolean(s))}};var vr=function(a,s){var c=s.pixelRatio,m=s.version,_=s.stretchX,b=s.stretchY,E=s.content;this.paddedRect=a,this.pixelRatio=c,this.stretchX=_,this.stretchY=b,this.content=E,this.version=m},Br={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Br.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Br.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Br.tlbr.get=function(){return this.tl.concat(this.br)},Br.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(vr.prototype,Br);var Pn=function(a,s){var c={},m={};this.haveRenderCallbacks=[];var _=[];this.addImages(a,c,_),this.addImages(s,m,_);var b=Ur(_),E=new Aa({width:b.w||1,height:b.h||1});for(var M in a){var P=a[M],F=c[M].paddedRect;Aa.copy(P.data,E,{x:0,y:0},{x:F.x+1,y:F.y+1},P.data)}for(var j in s){var H=s[j],te=m[j].paddedRect,ue=te.x+1,De=te.y+1,Be=H.data.width,Je=H.data.height;Aa.copy(H.data,E,{x:0,y:0},{x:ue,y:De},H.data),Aa.copy(H.data,E,{x:0,y:Je-1},{x:ue,y:De-1},{width:Be,height:1}),Aa.copy(H.data,E,{x:0,y:0},{x:ue,y:De+Je},{width:Be,height:1}),Aa.copy(H.data,E,{x:Be-1,y:0},{x:ue-1,y:De},{width:1,height:Je}),Aa.copy(H.data,E,{x:0,y:0},{x:ue+Be,y:De},{width:1,height:Je})}this.image=E,this.iconPositions=c,this.patternPositions=m};Pn.prototype.addImages=function(a,s,c){for(var m in a){var _=a[m],b={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(b),s[m]=new vr(b,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},Pn.prototype.patchUpdatedImages=function(a,s){for(var c in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[c],a.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],a.getImage(c),s)},Pn.prototype.patchUpdatedImage=function(a,s,c){if(a&&s&&a.version!==s.version){a.version=s.version;var m=a.tl;c.update(s.data,void 0,{x:m[0],y:m[1]})}},pn("ImagePosition",vr),pn("ImageAtlas",Pn);var zn={horizontal:1,vertical:2,horizontalOnly:3},jr=function(){this.scale=1,this.fontStack="",this.imageName=null};jr.forText=function(a,s){var c=new jr;return c.scale=a||1,c.fontStack=s,c},jr.forImage=function(a){var s=new jr;return s.imageName=a,s};var ut=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function fr(a,s,c,m,_,b,E,M,P,F,j,H,te,ue,De,Be){var Je,He=ut.fromFeature(a,_);H===zn.vertical&&He.verticalizePunctuation();var mt=It.processBidirectionalText,Lt=It.processStyledBidirectionalText;if(mt&&He.sections.length===1){Je=[];for(var zt=0,Zt=mt(He.toString(),Ci(He,F,b,s,m,ue,De));zt<Zt.length;zt+=1){var ur=Zt[zt],yr=new ut;yr.text=ur,yr.sections=He.sections;for(var Xr=0;Xr<ur.length;Xr++)yr.sectionIndex.push(0);Je.push(yr)}}else if(Lt){Je=[];for(var Fn=0,nn=Lt(He.text,He.sectionIndex,Ci(He,F,b,s,m,ue,De));Fn<nn.length;Fn+=1){var Bn=nn[Fn],sn=new ut;sn.text=Bn[0],sn.sectionIndex=Bn[1],sn.sections=He.sections,Je.push(sn)}}else Je=function(En,on){for(var Kr=[],Fi=En.text,Nn=0,Vi=0,Ta=on;Vi<Ta.length;Vi+=1){var to=Ta[Vi];Kr.push(En.substring(Nn,to)),Nn=to}return Nn<Fi.length&&Kr.push(En.substring(Nn,Fi.length)),Kr}(He,Ci(He,F,b,s,m,ue,De));var gi=[],Kn={positionedLines:gi,text:He.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(En,on,Kr,Fi,Nn,Vi,Ta,to,Xa,Ma,ro,Fo){for(var Bo=0,Ls=-17,Go=0,Rs=0,lo=to==="right"?1:to==="left"?0:.5,zo=0,Li=0,sa=Nn;Li<sa.length;Li+=1){var ea=sa[Li];ea.trim();var Ni=ea.getMaxScale(),Ys=24*(Ni-1),ps={positionedGlyphs:[],lineOffset:0};En.positionedLines[zo]=ps;var wa=ps.positionedGlyphs,Eo=0;if(ea.length()){for(var ds=0;ds<ea.length();ds++){var Gi=ea.getSection(ds),Oc=ea.getSectionIndex(ds),Ou=ea.getCharCode(ds),il=0,co=null,Fc=null,Al=null,ep=24,wh=!(Xa===zn.horizontal||!ro&&!xc(Ou)||ro&&(et[Ou]||(Cl=Ou,Dr.Arabic(Cl)||Dr["Arabic Supplement"](Cl)||Dr["Arabic Extended-A"](Cl)||Dr["Arabic Presentation Forms-A"](Cl)||Dr["Arabic Presentation Forms-B"](Cl))));if(Gi.imageName){var tp=Fi[Gi.imageName];if(!tp)continue;Al=Gi.imageName,En.iconsInText=En.iconsInText||!0,Fc=tp.paddedRect;var pf=tp.displaySize;Gi.scale=24*Gi.scale/Fo,il=Ys+(24-pf[1]*Gi.scale),ep=(co={width:pf[0],height:pf[1],left:1,top:-3,advance:wh?pf[1]:pf[0]}).advance;var rp=wh?pf[0]*Gi.scale-24*Ni:pf[1]*Gi.scale-24*Ni;rp>0&&rp>Eo&&(Eo=rp)}else{var Bd=Kr[Gi.fontStack],np=Bd&&Bd[Ou];if(np&&np.rect)Fc=np.rect,co=np.metrics;else{var Up=on[Gi.fontStack],zd=Up&&Up[Ou];if(!zd)continue;co=zd.metrics}il=24*(Ni-Gi.scale)}wh?(En.verticalizable=!0,wa.push({glyph:Ou,imageName:Al,x:Bo,y:Ls+il,vertical:wh,scale:Gi.scale,fontStack:Gi.fontStack,sectionIndex:Oc,metrics:co,rect:Fc}),Bo+=ep*Gi.scale+Ma):(wa.push({glyph:Ou,imageName:Al,x:Bo,y:Ls+il,vertical:wh,scale:Gi.scale,fontStack:Gi.fontStack,sectionIndex:Oc,metrics:co,rect:Fc}),Bo+=co.advance*Gi.scale+Ma)}wa.length!==0&&(Go=Math.max(Bo-Ma,Go),Co(wa,0,wa.length-1,lo,Eo)),Bo=0;var Nd=Vi*Ni+Eo;ps.lineOffset=Math.max(Eo,Ys),Ls+=Nd,Rs=Math.max(Nd,Rs),++zo}else Ls+=Vi,++zo}var Cl,ip=Ls- -17,Gf=Ga(Ta),Bc=Gf.horizontalAlign,Tl=Gf.verticalAlign;(function(rc,ap,Eh,Ah,Ch,Th,op,sp,up){var Hf,Vp=(ap-Eh)*Ch;Hf=Th!==op?-sp*Ah- -17:(-Ah*up+.5)*op;for(var Mh=0,lp=rc;Mh<lp.length;Mh+=1)for(var Wf=0,zc=lp[Mh].positionedGlyphs;Wf<zc.length;Wf+=1){var Ho=zc[Wf];Ho.x+=Vp,Ho.y+=Hf}})(En.positionedLines,lo,Bc,Tl,Go,Rs,Vi,ip,Nn.length),En.top+=-Tl*ip,En.bottom=En.top+ip,En.left+=-Bc*Go,En.right=En.left+Go}(Kn,s,c,m,Je,E,M,P,H,F,te,Be),!function(En){for(var on=0,Kr=En;on<Kr.length;on+=1)if(Kr[on].positionedGlyphs.length!==0)return!1;return!0}(gi)&&Kn}ut.fromFeature=function(a,s){for(var c=new ut,m=0;m<a.sections.length;m++){var _=a.sections[m];_.image?c.addImageSection(_):c.addTextSection(_,s)}return c},ut.prototype.length=function(){return this.text.length},ut.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},ut.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},ut.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},ut.prototype.verticalizePunctuation=function(){this.text=function(a){for(var s="",c=0;c<a.length;c++){var m=a.charCodeAt(c+1)||null,_=a.charCodeAt(c-1)||null;s+=m&&lu(m)&&!cf[a[c+1]]||_&&lu(_)&&!cf[a[c-1]]||!cf[a[c]]?a[c]:cf[a[c]]}return s}(this.text)},ut.prototype.trim=function(){for(var a=0,s=0;s<this.text.length&&et[this.text.charCodeAt(s)];s++)a++;for(var c=this.text.length,m=this.text.length-1;m>=0&&m>=a&&et[this.text.charCodeAt(m)];m--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)},ut.prototype.substring=function(a,s){var c=new ut;return c.text=this.text.substring(a,s),c.sectionIndex=this.sectionIndex.slice(a,s),c.sections=this.sections,c},ut.prototype.toString=function(){return this.text},ut.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(s,c){return Math.max(s,a.sections[c].scale)},0)},ut.prototype.addTextSection=function(a,s){this.text+=a.text,this.sections.push(jr.forText(a.scale,a.fontStack||s));for(var c=this.sections.length-1,m=0;m<a.text.length;++m)this.sectionIndex.push(c)},ut.prototype.addImageSection=function(a){var s=a.image?a.image.name:"";if(s.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(jr.forImage(s)),this.sectionIndex.push(this.sections.length-1)):ft("Reached maximum number of images 6401")}else ft("Can't add FormattedSection with an empty image.")},ut.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var et={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Un={};function bn(a,s,c,m,_,b){if(s.imageName){var E=m[s.imageName];return E?E.displaySize[0]*s.scale*24/b+_:0}var M=c[s.fontStack],P=M&&M[a];return P?P.metrics.advance*s.scale+_:0}function mi(a,s,c,m){var _=Math.pow(a-s,2);return m?a<s?_/2:2*_:_+Math.abs(c)*c}function oi(a,s,c){var m=0;return a===10&&(m-=1e4),c&&(m+=150),a!==40&&a!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function di(a,s,c,m,_,b){for(var E=null,M=mi(s,c,_,b),P=0,F=m;P<F.length;P+=1){var j=F[P],H=mi(s-j.x,c,_,b)+j.badness;H<=M&&(E=j,M=H)}return{index:a,x:s,priorBreak:E,badness:M}}function Ci(a,s,c,m,_,b,E){if(b!=="point")return[];if(!a)return[];for(var M,P=[],F=function(Je,He,mt,Lt,zt,Zt){for(var ur=0,yr=0;yr<Je.length();yr++){var Xr=Je.getSection(yr);ur+=bn(Je.getCharCode(yr),Xr,Lt,zt,He,Zt)}return ur/Math.max(1,Math.ceil(ur/mt))}(a,s,c,m,_,E),j=a.text.indexOf("\u200B")>=0,H=0,te=0;te<a.length();te++){var ue=a.getSection(te),De=a.getCharCode(te);if(et[De]||(H+=bn(De,ue,m,_,s,E)),te<a.length()-1){var Be=!((M=De)<11904||!(Dr["Bopomofo Extended"](M)||Dr.Bopomofo(M)||Dr["CJK Compatibility Forms"](M)||Dr["CJK Compatibility Ideographs"](M)||Dr["CJK Compatibility"](M)||Dr["CJK Radicals Supplement"](M)||Dr["CJK Strokes"](M)||Dr["CJK Symbols and Punctuation"](M)||Dr["CJK Unified Ideographs Extension A"](M)||Dr["CJK Unified Ideographs"](M)||Dr["Enclosed CJK Letters and Months"](M)||Dr["Halfwidth and Fullwidth Forms"](M)||Dr.Hiragana(M)||Dr["Ideographic Description Characters"](M)||Dr["Kangxi Radicals"](M)||Dr["Katakana Phonetic Extensions"](M)||Dr.Katakana(M)||Dr["Vertical Forms"](M)||Dr["Yi Radicals"](M)||Dr["Yi Syllables"](M)));(Un[De]||Be||ue.imageName)&&P.push(di(te+1,H,F,P,oi(De,a.getCharCode(te+1),Be&&j),!1))}}return function Je(He){return He?Je(He.priorBreak).concat(He.index):[]}(di(a.length(),H,F,P,0,!0))}function Ga(a){var s=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:s,verticalAlign:c}}function Co(a,s,c,m,_){if(m||_)for(var b=a[c],E=(a[c].x+b.metrics.advance*b.scale)*m,M=s;M<=c;M++)a[M].x-=E,a[M].y+=_}function wi(a,s,c,m,_,b){var E,M=a.image;if(M.content){var P=M.content,F=M.pixelRatio||1;E=[P[0]/F,P[1]/F,M.displaySize[0]-P[2]/F,M.displaySize[1]-P[3]/F]}var j,H,te,ue,De=s.left*b,Be=s.right*b;c==="width"||c==="both"?(ue=_[0]+De-m[3],H=_[0]+Be+m[1]):H=(ue=_[0]+(De+Be-M.displaySize[0])/2)+M.displaySize[0];var Je=s.top*b,He=s.bottom*b;return c==="height"||c==="both"?(j=_[1]+Je-m[0],te=_[1]+He+m[2]):te=(j=_[1]+(Je+He-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:j,right:H,bottom:te,left:ue,collisionPadding:E}}Un[10]=!0,Un[32]=!0,Un[38]=!0,Un[40]=!0,Un[41]=!0,Un[43]=!0,Un[45]=!0,Un[47]=!0,Un[173]=!0,Un[183]=!0,Un[8203]=!0,Un[8208]=!0,Un[8211]=!0,Un[8231]=!0;var ba=function(a){function s(c,m,_,b){a.call(this,c,m),this.angle=_,b!==void 0&&(this.segment=b)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(ae);function na(a,s){var c=s.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Ee(a+1))};if(c.kind==="source")return{kind:"source"};for(var m=c.zoomStops,_=c.interpolationType,b=0;b<m.length&&m[b]<=a;)b++;for(var E=b=Math.max(0,b-1);E<m.length&&m[E]<a+1;)E++;E=Math.min(m.length-1,E);var M=m[b],P=m[E];return c.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:P,interpolationType:_}:{kind:"camera",minZoom:M,maxZoom:P,minSize:c.evaluate(new Ee(M)),maxSize:c.evaluate(new Ee(P)),interpolationType:_}}function Ha(a,s,c){var m=s.uSize,_=c.lowerSize;return a.kind==="source"?_/128:a.kind==="composite"?La(_/128,c.upperSize/128,s.uSizeT):m}function eo(a,s){var c=0,m=0;if(a.kind==="constant")m=a.layoutSize;else if(a.kind!=="source"){var _=a.interpolationType,b=_?Pt(Ra.interpolationFactor(_,s,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?m=La(a.minSize,a.maxSize,b):c=b}return{uSizeT:c,uSize:m}}pn("Anchor",ba);var bo=Object.freeze({__proto__:null,getSizeData:na,evaluateSizeForFeature:Ha,evaluateSizeForZoom:eo,SIZE_PACK_FACTOR:128});function So(a,s,c,m,_){if(s.segment===void 0)return!0;for(var b=s,E=s.segment+1,M=0;M>-c/2;){if(--E<0)return!1;M-=a[E].dist(b),b=a[E]}M+=a[E].dist(a[E+1]),E++;for(var P=[],F=0;M<c/2;){var j=a[E],H=a[E+1];if(!H)return!1;var te=a[E-1].angleTo(j)-j.angleTo(H);for(te=Math.abs((te+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:M,angleDelta:te}),F+=te;M-P[0].distance>m;)F-=P.shift().angleDelta;if(F>_)return!1;E++,M+=j.dist(H)}return!0}function Do(a){for(var s=0,c=0;c<a.length-1;c++)s+=a[c].dist(a[c+1]);return s}function Wa(a,s,c){return a?.6*s*c:0}function pi(a,s){return Math.max(a?a.right-a.left:0,s?s.right-s.left:0)}function jo(a,s,c,m,_,b){for(var E=Wa(c,_,b),M=pi(c,m)*b,P=0,F=Do(a)/2,j=0;j<a.length-1;j++){var H=a[j],te=a[j+1],ue=H.dist(te);if(P+ue>F){var De=(F-P)/ue,Be=La(H.x,te.x,De),Je=La(H.y,te.y,De),He=new ba(Be,Je,te.angleTo(H),j);return He._round(),!E||So(a,He,M,E,s)?He:void 0}P+=ue}}function ji(a,s,c,m,_,b,E,M,P){var F=Wa(m,b,E),j=pi(m,_),H=j*E,te=a[0].x===0||a[0].x===P||a[0].y===0||a[0].y===P;return s-H<s/4&&(s=H+s/4),function ue(De,Be,Je,He,mt,Lt,zt,Zt,ur){for(var yr=Lt/2,Xr=Do(De),Fn=0,nn=Be-Je,Bn=[],sn=0;sn<De.length-1;sn++){for(var gi=De[sn],Kn=De[sn+1],En=gi.dist(Kn),on=Kn.angleTo(gi);nn+Je<Fn+En;){var Kr=((nn+=Je)-Fn)/En,Fi=La(gi.x,Kn.x,Kr),Nn=La(gi.y,Kn.y,Kr);if(Fi>=0&&Fi<ur&&Nn>=0&&Nn<ur&&nn-yr>=0&&nn+yr<=Xr){var Vi=new ba(Fi,Nn,on,sn);Vi._round(),He&&!So(De,Vi,Lt,He,mt)||Bn.push(Vi)}}Fn+=En}return Zt||Bn.length||zt||(Bn=ue(De,Fn/2,Je,He,mt,Lt,zt,!0,ur)),Bn}(a,te?s/2*M%s:(j/2+2*b)*E*M%s,s,F,c,H,te,!1,P)}function Vn(a,s,c,m,_){for(var b=[],E=0;E<a.length;E++)for(var M=a[E],P=void 0,F=0;F<M.length-1;F++){var j=M[F],H=M[F+1];j.x<s&&H.x<s||(j.x<s?j=new ae(s,j.y+(s-j.x)/(H.x-j.x)*(H.y-j.y))._round():H.x<s&&(H=new ae(s,j.y+(s-j.x)/(H.x-j.x)*(H.y-j.y))._round()),j.y<c&&H.y<c||(j.y<c?j=new ae(j.x+(c-j.y)/(H.y-j.y)*(H.x-j.x),c)._round():H.y<c&&(H=new ae(j.x+(c-j.y)/(H.y-j.y)*(H.x-j.x),c)._round()),j.x>=m&&H.x>=m||(j.x>=m?j=new ae(m,j.y+(m-j.x)/(H.x-j.x)*(H.y-j.y))._round():H.x>=m&&(H=new ae(m,j.y+(m-j.x)/(H.x-j.x)*(H.y-j.y))._round()),j.y>=_&&H.y>=_||(j.y>=_?j=new ae(j.x+(_-j.y)/(H.y-j.y)*(H.x-j.x),_)._round():H.y>=_&&(H=new ae(j.x+(_-j.y)/(H.y-j.y)*(H.x-j.x),_)._round()),P&&j.equals(P[P.length-1])||b.push(P=[j]),P.push(H)))))}return b}function Ei(a,s,c,m){var _=[],b=a.image,E=b.pixelRatio,M=b.paddedRect.w-2,P=b.paddedRect.h-2,F=a.right-a.left,j=a.bottom-a.top,H=b.stretchX||[[0,M]],te=b.stretchY||[[0,P]],ue=function(Fi,Nn){return Fi+Nn[1]-Nn[0]},De=H.reduce(ue,0),Be=te.reduce(ue,0),Je=M-De,He=P-Be,mt=0,Lt=De,zt=0,Zt=Be,ur=0,yr=Je,Xr=0,Fn=He;if(b.content&&m){var nn=b.content;mt=ki(H,0,nn[0]),zt=ki(te,0,nn[1]),Lt=ki(H,nn[0],nn[2]),Zt=ki(te,nn[1],nn[3]),ur=nn[0]-mt,Xr=nn[1]-zt,yr=nn[2]-nn[0]-Lt,Fn=nn[3]-nn[1]-Zt}var Bn=function(Fi,Nn,Vi,Ta){var to=Xs(Fi.stretch-mt,Lt,F,a.left),Xa=nl(Fi.fixed-ur,yr,Fi.stretch,De),Ma=Xs(Nn.stretch-zt,Zt,j,a.top),ro=nl(Nn.fixed-Xr,Fn,Nn.stretch,Be),Fo=Xs(Vi.stretch-mt,Lt,F,a.left),Bo=nl(Vi.fixed-ur,yr,Vi.stretch,De),Ls=Xs(Ta.stretch-zt,Zt,j,a.top),Go=nl(Ta.fixed-Xr,Fn,Ta.stretch,Be),Rs=new ae(to,Ma),lo=new ae(Fo,Ma),zo=new ae(Fo,Ls),Li=new ae(to,Ls),sa=new ae(Xa/E,ro/E),ea=new ae(Bo/E,Go/E),Ni=s*Math.PI/180;if(Ni){var Ys=Math.sin(Ni),ps=Math.cos(Ni),wa=[ps,-Ys,Ys,ps];Rs._matMult(wa),lo._matMult(wa),Li._matMult(wa),zo._matMult(wa)}var Eo=Fi.stretch+Fi.fixed,ds=Nn.stretch+Nn.fixed;return{tl:Rs,tr:lo,bl:Li,br:zo,tex:{x:b.paddedRect.x+1+Eo,y:b.paddedRect.y+1+ds,w:Vi.stretch+Vi.fixed-Eo,h:Ta.stretch+Ta.fixed-ds},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:sa,pixelOffsetBR:ea,minFontScaleX:yr/E/F,minFontScaleY:Fn/E/j,isSDF:c}};if(m&&(b.stretchX||b.stretchY))for(var sn=$a(H,Je,De),gi=$a(te,He,Be),Kn=0;Kn<sn.length-1;Kn++)for(var En=sn[Kn],on=sn[Kn+1],Kr=0;Kr<gi.length-1;Kr++)_.push(Bn(En,gi[Kr],on,gi[Kr+1]));else _.push(Bn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:P+1}));return _}function ki(a,s,c){for(var m=0,_=0,b=a;_<b.length;_+=1){var E=b[_];m+=Math.max(s,Math.min(c,E[1]))-Math.max(s,Math.min(c,E[0]))}return m}function $a(a,s,c){for(var m=[{fixed:-1,stretch:0}],_=0,b=a;_<b.length;_+=1){var E=b[_],M=E[0],P=E[1],F=m[m.length-1];m.push({fixed:M-F.stretch,stretch:F.stretch}),m.push({fixed:M-F.stretch,stretch:F.stretch+(P-M)})}return m.push({fixed:s+1,stretch:c}),m}function Xs(a,s,c,m){return a/s*c+m}function nl(a,s,c,m){return a-s*c/m}var Re=function(a,s,c,m,_,b,E,M,P,F){if(this.boxStartIndex=a.length,P){var j=b.top,H=b.bottom,te=b.collisionPadding;te&&(j-=te[1],H+=te[3]);var ue=H-j;ue>0&&(ue=Math.max(10,ue),this.circleDiameter=ue)}else{var De=b.top*E-M,Be=b.bottom*E+M,Je=b.left*E-M,He=b.right*E+M,mt=b.collisionPadding;if(mt&&(Je-=mt[0]*E,De-=mt[1]*E,He+=mt[2]*E,Be+=mt[3]*E),F){var Lt=new ae(Je,De),zt=new ae(He,De),Zt=new ae(Je,Be),ur=new ae(He,Be),yr=F*Math.PI/180;Lt._rotate(yr),zt._rotate(yr),Zt._rotate(yr),ur._rotate(yr),Je=Math.min(Lt.x,zt.x,Zt.x,ur.x),He=Math.max(Lt.x,zt.x,Zt.x,ur.x),De=Math.min(Lt.y,zt.y,Zt.y,ur.y),Be=Math.max(Lt.y,zt.y,Zt.y,ur.y)}a.emplaceBack(s.x,s.y,Je,De,He,Be,c,m,_)}this.boxEndIndex=a.length},Bt=function(a,s){if(a===void 0&&(a=[]),s===void 0&&(s=Ot),this.data=a,this.length=this.data.length,this.compare=s,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function Ot(a,s){return a<s?-1:a>s?1:0}function dn(a,s,c){s===void 0&&(s=1),c===void 0&&(c=!1);for(var m=1/0,_=1/0,b=-1/0,E=-1/0,M=a[0],P=0;P<M.length;P++){var F=M[P];(!P||F.x<m)&&(m=F.x),(!P||F.y<_)&&(_=F.y),(!P||F.x>b)&&(b=F.x),(!P||F.y>E)&&(E=F.y)}var j=Math.min(b-m,E-_),H=j/2,te=new Bt([],yi);if(j===0)return new ae(m,_);for(var ue=m;ue<b;ue+=j)for(var De=_;De<E;De+=j)te.push(new Ce(ue+H,De+H,H,a));for(var Be=function(mt){for(var Lt=0,zt=0,Zt=0,ur=mt[0],yr=0,Xr=ur.length,Fn=Xr-1;yr<Xr;Fn=yr++){var nn=ur[yr],Bn=ur[Fn],sn=nn.x*Bn.y-Bn.x*nn.y;zt+=(nn.x+Bn.x)*sn,Zt+=(nn.y+Bn.y)*sn,Lt+=3*sn}return new Ce(zt/Lt,Zt/Lt,0,mt)}(a),Je=te.length;te.length;){var He=te.pop();(He.d>Be.d||!Be.d)&&(Be=He,c&&console.log("found best %d after %d probes",Math.round(1e4*He.d)/1e4,Je)),He.max-Be.d<=s||(te.push(new Ce(He.p.x-(H=He.h/2),He.p.y-H,H,a)),te.push(new Ce(He.p.x+H,He.p.y-H,H,a)),te.push(new Ce(He.p.x-H,He.p.y+H,H,a)),te.push(new Ce(He.p.x+H,He.p.y+H,H,a)),Je+=4)}return c&&(console.log("num probes: "+Je),console.log("best distance: "+Be.d)),Be.p}function yi(a,s){return s.max-a.max}function Ce(a,s,c,m){this.p=new ae(a,s),this.h=c,this.d=function(_,b){for(var E=!1,M=1/0,P=0;P<b.length;P++)for(var F=b[P],j=0,H=F.length,te=H-1;j<H;te=j++){var ue=F[j],De=F[te];ue.y>_.y!=De.y>_.y&&_.x<(De.x-ue.x)*(_.y-ue.y)/(De.y-ue.y)+ue.x&&(E=!E),M=Math.min(M,bl(_,ue,De))}return(E?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}Bt.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},Bt.prototype.pop=function(){if(this.length!==0){var a=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),a}},Bt.prototype.peek=function(){return this.data[0]},Bt.prototype._up=function(a){for(var s=this.data,c=this.compare,m=s[a];a>0;){var _=a-1>>1,b=s[_];if(c(m,b)>=0)break;s[a]=b,a=_}s[a]=m},Bt.prototype._down=function(a){for(var s=this.data,c=this.compare,m=this.length>>1,_=s[a];a<m;){var b=1+(a<<1),E=s[b],M=b+1;if(M<this.length&&c(s[M],E)<0&&(b=M,E=s[M]),c(E,_)>=0)break;s[a]=E,a=b}s[a]=_};var de=Number.POSITIVE_INFINITY;function Xe(a,s){return s[1]!==de?function(c,m,_){var b=0,E=0;switch(m=Math.abs(m),_=Math.abs(_),c){case"top-right":case"top-left":case"top":E=_-7;break;case"bottom-right":case"bottom-left":case"bottom":E=7-_}switch(c){case"top-right":case"bottom-right":case"right":b=-m;break;case"top-left":case"bottom-left":case"left":b=m}return[b,E]}(a,s[0],s[1]):function(c,m){var _=0,b=0;m<0&&(m=0);var E=m/Math.sqrt(2);switch(c){case"top-right":case"top-left":b=E-7;break;case"bottom-right":case"bottom-left":b=7-E;break;case"bottom":b=7-m;break;case"top":b=m-7}switch(c){case"top-right":case"bottom-right":_=-E;break;case"top-left":case"bottom-left":_=E;break;case"left":_=m;break;case"right":_=-m}return[_,b]}(a,s[0])}function gt(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function St(a,s,c,m,_,b,E,M,P,F,j,H,te,ue,De){var Be=function(zt,Zt,ur,yr,Xr,Fn,nn,Bn){for(var sn=yr.layout.get("text-rotate").evaluate(Fn,{})*Math.PI/180,gi=[],Kn=0,En=Zt.positionedLines;Kn<En.length;Kn+=1)for(var on=En[Kn],Kr=0,Fi=on.positionedGlyphs;Kr<Fi.length;Kr+=1){var Nn=Fi[Kr];if(Nn.rect){var Vi=Nn.rect||{},Ta=4,to=!0,Xa=1,Ma=0,ro=(Xr||Bn)&&Nn.vertical,Fo=Nn.metrics.advance*Nn.scale/2;if(Bn&&Zt.verticalizable&&(Ma=on.lineOffset/2-(Nn.imageName?-(24-Nn.metrics.width*Nn.scale)/2:24*(Nn.scale-1))),Nn.imageName){var Bo=nn[Nn.imageName];to=Bo.sdf,Ta=1/(Xa=Bo.pixelRatio)}var Ls=Xr?[Nn.x+Fo,Nn.y]:[0,0],Go=Xr?[0,0]:[Nn.x+Fo+ur[0],Nn.y+ur[1]-Ma],Rs=[0,0];ro&&(Rs=Go,Go=[0,0]);var lo=(Nn.metrics.left-Ta)*Nn.scale-Fo+Go[0],zo=(-Nn.metrics.top-Ta)*Nn.scale+Go[1],Li=lo+Vi.w*Nn.scale/Xa,sa=zo+Vi.h*Nn.scale/Xa,ea=new ae(lo,zo),Ni=new ae(Li,zo),Ys=new ae(lo,sa),ps=new ae(Li,sa);if(ro){var wa=new ae(-Fo,Fo- -17),Eo=-Math.PI/2,ds=12-Fo,Gi=new ae(22-ds,-(Nn.imageName?ds:0)),Oc=new(Function.prototype.bind.apply(ae,[null].concat(Rs)));ea._rotateAround(Eo,wa)._add(Gi)._add(Oc),Ni._rotateAround(Eo,wa)._add(Gi)._add(Oc),Ys._rotateAround(Eo,wa)._add(Gi)._add(Oc),ps._rotateAround(Eo,wa)._add(Gi)._add(Oc)}if(sn){var Ou=Math.sin(sn),il=Math.cos(sn),co=[il,-Ou,Ou,il];ea._matMult(co),Ni._matMult(co),Ys._matMult(co),ps._matMult(co)}var Fc=new ae(0,0),Al=new ae(0,0);gi.push({tl:ea,tr:Ni,bl:Ys,br:ps,tex:Vi,writingMode:Zt.writingMode,glyphOffset:Ls,sectionIndex:Nn.sectionIndex,isSDF:to,pixelOffsetTL:Fc,pixelOffsetBR:Al,minFontScaleX:0,minFontScaleY:0})}}return gi}(0,c,M,_,b,E,m,a.allowVerticalPlacement),Je=a.textSizeData,He=null;Je.kind==="source"?(He=[128*_.layout.get("text-size").evaluate(E,{})])[0]>32640&&ft(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Je.kind==="composite"&&((He=[128*ue.compositeTextSizes[0].evaluate(E,{},De),128*ue.compositeTextSizes[1].evaluate(E,{},De)])[0]>32640||He[1]>32640)&&ft(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Be,He,M,b,E,F,s,P.lineStartIndex,P.lineLength,te,De);for(var mt=0,Lt=j;mt<Lt.length;mt+=1)H[Lt[mt]]=a.text.placedSymbolArray.length-1;return 4*Be.length}function Qe(a){for(var s in a)return a[s];return null}function qe(a,s,c,m){var _=a.compareText;if(s in _){for(var b=_[s],E=b.length-1;E>=0;E--)if(m.dist(b[E])<c)return!0}else _[s]=[];return _[s].push(m),!1}var ht=Ts.VectorTileFeature.types,Te=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function We(a,s,c,m,_,b,E,M,P,F,j,H,te){var ue=M?Math.min(32640,Math.round(M[0])):0,De=M?Math.min(32640,Math.round(M[1])):0;a.emplaceBack(s,c,Math.round(32*m),Math.round(32*_),b,E,(ue<<1)+(P?1:0),De,16*F,16*j,256*H,256*te)}function ge(a,s,c){a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c)}function vt(a){for(var s=0,c=a.sections;s<c.length;s+=1)if(qc(c[s].text))return!0;return!1}var At=function(a){this.layoutVertexArray=new ef,this.indexArray=new es,this.programConfigurations=a,this.segments=new ve,this.dynamicLayoutVertexArray=new Yl,this.opacityVertexArray=new Sc,this.placedSymbolArray=new g};At.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},At.prototype.upload=function(a,s,c,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Nf.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Fp.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Te,!0),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(a))},At.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},pn("SymbolBuffers",At);var sr=function(a,s,c){this.layoutVertexArray=new a,this.layoutAttributes=s,this.indexArray=new c,this.segments=new ve,this.collisionVertexArray=new tf};sr.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Bp.members,!0)},sr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},pn("CollisionBuffers",sr);var Ft=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ao([]),this.placementViewportMatrix=Ao([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=na(this.zoom,s["text-size"]),this.iconSizeData=na(this.zoom,s["icon-size"]);var c=this.layers[0].layout,m=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(b){return zn[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=a.sourceID};Ft.prototype.createArrays=function(){this.text=new At(new Zn(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new At(new Zn(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new T,this.lineVertexArray=new I,this.symbolInstances=new C},Ft.prototype.calculateGlyphDependencies=function(a,s,c,m,_){for(var b=0;b<a.length;b++)if(s[a.charCodeAt(b)]=!0,(c||m)&&_){var E=cf[a.charAt(b)];E&&(s[E.charCodeAt(0)]=!0)}},Ft.prototype.populate=function(a,s,c){var m=this.layers[0],_=m.layout,b=_.get("text-font"),E=_.get("text-field"),M=_.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof Ki&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),F=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,j=_.get("symbol-sort-key");if(this.features=[],P||F){for(var H=s.iconDependencies,te=s.glyphDependencies,ue=s.availableImages,De=new Ee(this.zoom),Be=0,Je=a;Be<Je.length;Be+=1){var He=Je[Be],mt=He.feature,Lt=He.id,zt=He.index,Zt=He.sourceLayerIndex,ur=m._featureFilter.needGeometry,yr=za(mt,ur);if(m._featureFilter.filter(De,yr,c)){ur||(yr.geometry=xa(mt));var Xr=void 0;if(P){var Fn=m.getValueAndResolveTokens("text-field",yr,c,ue),nn=Ki.factory(Fn);vt(nn)&&(this.hasRTLText=!0),(!this.hasRTLText||Xl()==="unavailable"||this.hasRTLText&&It.isParsed())&&(Xr=Pd(nn,m,yr))}var Bn=void 0;if(F){var sn=m.getValueAndResolveTokens("icon-image",yr,c,ue);Bn=sn instanceof ha?sn:ha.fromString(sn)}if(Xr||Bn){var gi=this.sortFeaturesByKey?j.evaluate(yr,{},c):void 0;if(this.features.push({id:Lt,text:Xr,icon:Bn,index:zt,sourceLayerIndex:Zt,geometry:yr.geometry,properties:mt.properties,type:ht[mt.type],sortKey:gi}),Bn&&(H[Bn.name]=!0),Xr){var Kn=b.evaluate(yr,{},c).join(","),En=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zn.vertical)>=0;for(var on=0,Kr=Xr.sections;on<Kr.length;on+=1){var Fi=Kr[on];if(Fi.image)H[Fi.image.name]=!0;else{var Nn=Yc(Xr.toString()),Vi=Fi.fontStack||Kn,Ta=te[Vi]=te[Vi]||{};this.calculateGlyphDependencies(Fi.text,Ta,En,this.allowVerticalPlacement,Nn)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(to){var Xa={},Ma={},ro=[],Fo=0;function Bo(wa){ro.push(to[wa]),Fo++}function Ls(wa,Eo,ds){var Gi=Ma[wa];return delete Ma[wa],Ma[Eo]=Gi,ro[Gi].geometry[0].pop(),ro[Gi].geometry[0]=ro[Gi].geometry[0].concat(ds[0]),Gi}function Go(wa,Eo,ds){var Gi=Xa[Eo];return delete Xa[Eo],Xa[wa]=Gi,ro[Gi].geometry[0].shift(),ro[Gi].geometry[0]=ds[0].concat(ro[Gi].geometry[0]),Gi}function Rs(wa,Eo,ds){var Gi=ds?Eo[0][Eo[0].length-1]:Eo[0][0];return wa+":"+Gi.x+":"+Gi.y}for(var lo=0;lo<to.length;lo++){var zo=to[lo],Li=zo.geometry,sa=zo.text?zo.text.toString():null;if(sa){var ea=Rs(sa,Li),Ni=Rs(sa,Li,!0);if(ea in Ma&&Ni in Xa&&Ma[ea]!==Xa[Ni]){var Ys=Go(ea,Ni,Li),ps=Ls(ea,Ni,ro[Ys].geometry);delete Xa[ea],delete Ma[Ni],Ma[Rs(sa,ro[ps].geometry,!0)]=ps,ro[Ys].geometry=null}else ea in Ma?Ls(ea,Ni,Li):Ni in Xa?Go(ea,Ni,Li):(Bo(lo),Xa[ea]=Fo-1,Ma[Ni]=Fo-1)}else Bo(lo)}return ro.filter(function(wa){return wa.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(to,Xa){return to.sortKey-Xa.sortKey})}},Ft.prototype.update=function(a,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(a,s,this.layers,c))},Ft.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Ft.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ft.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ft.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Ft.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Ft.prototype.addToLineVertexArray=function(a,s){var c=this.lineVertexArray.length;if(a.segment!==void 0){for(var m=a.dist(s[a.segment+1]),_=a.dist(s[a.segment]),b={},E=a.segment+1;E<s.length;E++)b[E]={x:s[E].x,y:s[E].y,tileUnitDistanceFromAnchor:m},E<s.length-1&&(m+=s[E+1].dist(s[E]));for(var M=a.segment||0;M>=0;M--)b[M]={x:s[M].x,y:s[M].y,tileUnitDistanceFromAnchor:_},M>0&&(_+=s[M-1].dist(s[M]));for(var P=0;P<s.length;P++){var F=b[P];this.lineVertexArray.emplaceBack(F.x,F.y,F.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},Ft.prototype.addSymbols=function(a,s,c,m,_,b,E,M,P,F,j,H){for(var te=a.indexArray,ue=a.layoutVertexArray,De=a.segments.prepareSegment(4*s.length,ue,te,this.canOverlap?b.sortKey:void 0),Be=this.glyphOffsetArray.length,Je=De.vertexLength,He=this.allowVerticalPlacement&&E===zn.vertical?Math.PI/2:0,mt=b.text&&b.text.sections,Lt=0;Lt<s.length;Lt++){var zt=s[Lt],Zt=zt.tl,ur=zt.tr,yr=zt.bl,Xr=zt.br,Fn=zt.tex,nn=zt.pixelOffsetTL,Bn=zt.pixelOffsetBR,sn=zt.minFontScaleX,gi=zt.minFontScaleY,Kn=zt.glyphOffset,En=zt.isSDF,on=zt.sectionIndex,Kr=De.vertexLength,Fi=Kn[1];We(ue,M.x,M.y,Zt.x,Fi+Zt.y,Fn.x,Fn.y,c,En,nn.x,nn.y,sn,gi),We(ue,M.x,M.y,ur.x,Fi+ur.y,Fn.x+Fn.w,Fn.y,c,En,Bn.x,nn.y,sn,gi),We(ue,M.x,M.y,yr.x,Fi+yr.y,Fn.x,Fn.y+Fn.h,c,En,nn.x,Bn.y,sn,gi),We(ue,M.x,M.y,Xr.x,Fi+Xr.y,Fn.x+Fn.w,Fn.y+Fn.h,c,En,Bn.x,Bn.y,sn,gi),ge(a.dynamicLayoutVertexArray,M,He),te.emplaceBack(Kr,Kr+1,Kr+2),te.emplaceBack(Kr+1,Kr+2,Kr+3),De.vertexLength+=4,De.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Kn[0]),Lt!==s.length-1&&on===s[Lt+1].sectionIndex||a.programConfigurations.populatePaintArrays(ue.length,b,b.index,{},H,mt&&mt[on])}a.placedSymbolArray.emplaceBack(M.x,M.y,Be,this.glyphOffsetArray.length-Be,Je,P,F,M.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],E,0,!1,0,j)},Ft.prototype._addCollisionDebugVertex=function(a,s,c,m,_,b){return s.emplaceBack(0,0),a.emplaceBack(c.x,c.y,m,_,Math.round(b.x),Math.round(b.y))},Ft.prototype.addCollisionDebugVertices=function(a,s,c,m,_,b,E){var M=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),P=M.vertexLength,F=_.layoutVertexArray,j=_.collisionVertexArray,H=E.anchorX,te=E.anchorY;this._addCollisionDebugVertex(F,j,b,H,te,new ae(a,s)),this._addCollisionDebugVertex(F,j,b,H,te,new ae(c,s)),this._addCollisionDebugVertex(F,j,b,H,te,new ae(c,m)),this._addCollisionDebugVertex(F,j,b,H,te,new ae(a,m)),M.vertexLength+=4;var ue=_.indexArray;ue.emplaceBack(P,P+1),ue.emplaceBack(P+1,P+2),ue.emplaceBack(P+2,P+3),ue.emplaceBack(P+3,P),M.primitiveLength+=4},Ft.prototype.addDebugCollisionBoxes=function(a,s,c,m){for(var _=a;_<s;_++){var b=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,m?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,c)}},Ft.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sr(ql,Jh.members,pu),this.iconCollisionBox=new sr(ql,Jh.members,pu);for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},Ft.prototype._deserializeCollisionBoxesForSymbol=function(a,s,c,m,_,b,E,M,P){for(var F={},j=s;j<c;j++){var H=a.get(j);F.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.textFeatureIndex=H.featureIndex;break}for(var te=m;te<_;te++){var ue=a.get(te);F.verticalTextBox={x1:ue.x1,y1:ue.y1,x2:ue.x2,y2:ue.y2,anchorPointX:ue.anchorPointX,anchorPointY:ue.anchorPointY},F.verticalTextFeatureIndex=ue.featureIndex;break}for(var De=b;De<E;De++){var Be=a.get(De);F.iconBox={x1:Be.x1,y1:Be.y1,x2:Be.x2,y2:Be.y2,anchorPointX:Be.anchorPointX,anchorPointY:Be.anchorPointY},F.iconFeatureIndex=Be.featureIndex;break}for(var Je=M;Je<P;Je++){var He=a.get(Je);F.verticalIconBox={x1:He.x1,y1:He.y1,x2:He.x2,y2:He.y2,anchorPointX:He.anchorPointX,anchorPointY:He.anchorPointY},F.verticalIconFeatureIndex=He.featureIndex;break}return F},Ft.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},Ft.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ft.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ft.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Ft.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Ft.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Ft.prototype.addIndicesForPlacedSymbol=function(a,s){for(var c=a.placedSymbolArray.get(s),m=c.vertexStartIndex+4*c.numGlyphs,_=c.vertexStartIndex;_<m;_+=4)a.indexArray.emplaceBack(_,_+1,_+2),a.indexArray.emplaceBack(_+1,_+2,_+3)},Ft.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(a),c=Math.cos(a),m=[],_=[],b=[],E=0;E<this.symbolInstances.length;++E){b.push(E);var M=this.symbolInstances.get(E);m.push(0|Math.round(s*M.anchorX+c*M.anchorY)),_.push(M.featureIndex)}return b.sort(function(P,F){return m[P]-m[F]||_[F]-_[P]}),b},Ft.prototype.addToSortKeyRanges=function(a,s){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:a,symbolInstanceEnd:a+1})},Ft.prototype.sortFeatures=function(a){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,m=this.symbolInstanceIndexes;c<m.length;c+=1){var _=this.symbolInstances.get(m[c]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(b,E,M){b>=0&&M.indexOf(b)===E&&s.addIndicesForPlacedSymbol(s.text,b)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},pn("SymbolBucket",Ft,{omit:["layers","collisionBoxArray","features","compareText"]}),Ft.MAX_GLYPHS=65535,Ft.addDynamicAttributes=ge;var rr=new yo({"symbol-placement":new Ln(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ln(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ln(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _n(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ln(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ln(pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ln(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ln(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ln(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new _n(pe.layout_symbol["icon-size"]),"icon-text-fit":new Ln(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ln(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new _n(pe.layout_symbol["icon-image"]),"icon-rotate":new _n(pe.layout_symbol["icon-rotate"]),"icon-padding":new Ln(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ln(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new _n(pe.layout_symbol["icon-offset"]),"icon-anchor":new _n(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ln(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ln(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ln(pe.layout_symbol["text-rotation-alignment"]),"text-field":new _n(pe.layout_symbol["text-field"]),"text-font":new _n(pe.layout_symbol["text-font"]),"text-size":new _n(pe.layout_symbol["text-size"]),"text-max-width":new _n(pe.layout_symbol["text-max-width"]),"text-line-height":new Ln(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new _n(pe.layout_symbol["text-letter-spacing"]),"text-justify":new _n(pe.layout_symbol["text-justify"]),"text-radial-offset":new _n(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ln(pe.layout_symbol["text-variable-anchor"]),"text-anchor":new _n(pe.layout_symbol["text-anchor"]),"text-max-angle":new Ln(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ln(pe.layout_symbol["text-writing-mode"]),"text-rotate":new _n(pe.layout_symbol["text-rotate"]),"text-padding":new Ln(pe.layout_symbol["text-padding"]),"text-keep-upright":new Ln(pe.layout_symbol["text-keep-upright"]),"text-transform":new _n(pe.layout_symbol["text-transform"]),"text-offset":new _n(pe.layout_symbol["text-offset"]),"text-allow-overlap":new Ln(pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ln(pe.layout_symbol["text-ignore-placement"]),"text-optional":new Ln(pe.layout_symbol["text-optional"])}),kr={paint:new yo({"icon-opacity":new _n(pe.paint_symbol["icon-opacity"]),"icon-color":new _n(pe.paint_symbol["icon-color"]),"icon-halo-color":new _n(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new _n(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _n(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ln(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ln(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new _n(pe.paint_symbol["text-opacity"]),"text-color":new _n(pe.paint_symbol["text-color"],{runtimeType:Yr,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new _n(pe.paint_symbol["text-halo-color"]),"text-halo-width":new _n(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new _n(pe.paint_symbol["text-halo-blur"]),"text-translate":new Ln(pe.paint_symbol["text-translate"]),"text-translate-anchor":new Ln(pe.paint_symbol["text-translate-anchor"])}),layout:rr},An=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:ln,this.defaultValue=a};An.prototype.evaluate=function(a){if(a.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(a.formattedSection))return s.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},An.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},An.prototype.outputDefined=function(){return!1},An.prototype.serialize=function(){return null},pn("FormatSectionOverride",An,{omit:["defaultValue"]});var ui=function(a){function s(c){a.call(this,c,kr)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){if(a.prototype.recalculate.call(this,c,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var b=[],E=0,M=_;E<M.length;E+=1){var P=M[E];b.indexOf(P)<0&&b.push(P)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(c,m,_,b){var E=this.layout.get(c).evaluate(m,{},_,b),M=this._unevaluatedLayout._values[c];return M.isDataDriven()||ys(M.value)||!E?E:function(P,F){return F.replace(/{([^{}]+)}/g,function(j,H){return H in P?String(P[H]):""})}(m.properties,E)},s.prototype.createBucket=function(c){return new Ft(c)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var c=0,m=kr.paint.overridableProperties;c<m.length;c+=1){var _=m[c];if(s.hasPaintOverride(this.layout,_)){var b,E=this.paint.get(_),M=new An(E),P=new hl(M,E.property.specification);b=E.value.kind==="constant"||E.value.kind==="source"?new Vl("source",P):new Gu("composite",P,E.value.zoomStops,E.value._interpolationType),this.paint._values[_]=new so(E.property,b,E.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!(!this.layout||m.isDataDriven()||_.isDataDriven())&&s.hasPaintOverride(this.layout,c)},s.hasPaintOverride=function(c,m){var _=c.get("text-field"),b=kr.paint.properties[m],E=!1,M=function(j){for(var H=0,te=j;H<te.length;H+=1)if(b.overrides&&b.overrides.hasOverride(te[H]))return void(E=!0)};if(_.value.kind==="constant"&&_.value.value instanceof Ki)M(_.value.value.sections);else if(_.value.kind==="source"){var P=function(j){E||(j instanceof Hn&&oa(j.value)===Bi?M(j.value.sections):j instanceof To?M(j.sections):j.eachChild(P))},F=_.value;F._styleExpression&&P(F._styleExpression.expression)}return E},s}(Qs),Sn={paint:new yo({"background-color":new Ln(pe.paint_background["background-color"]),"background-pattern":new ko(pe.paint_background["background-pattern"]),"background-opacity":new Ln(pe.paint_background["background-opacity"])})},Wn=function(a){function s(c){a.call(this,c,Sn)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Qs),$n={paint:new yo({"raster-opacity":new Ln(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ln(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ln(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ln(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ln(pe.paint_raster["raster-saturation"]),"raster-contrast":new Ln(pe.paint_raster["raster-contrast"]),"raster-resampling":new Ln(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ln(pe.paint_raster["raster-fade-duration"])})},Pi=function(a){function s(c){a.call(this,c,$n)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Qs),da=function(a){function s(c){a.call(this,c,{}),this.implementation=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},s.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},s}(Qs),Is={circle:Sl,heatmap:Ec,hillshade:bd,fill:Of,"fill-extrusion":ks,line:Kh,symbol:ui,background:Wn,raster:Pi},Rc=oe.HTMLImageElement,Ps=oe.HTMLCanvasElement,Zf=oe.HTMLVideoElement,nu=oe.ImageData,Uf=oe.ImageBitmap,Vf=function(a,s,c,m){this.context=a,this.format=c,this.texture=a.gl.createTexture(),this.update(s,m)};Vf.prototype.update=function(a,s,c){var m=a.width,_=a.height,b=!(this.size&&this.size[0]===m&&this.size[1]===_||c),E=this.context,M=E.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!s||s.premultiply!==!1)),b)this.size=[m,_],a instanceof Rc||a instanceof Ps||a instanceof Zf||a instanceof nu||Uf&&a instanceof Uf?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,a):M.texImage2D(M.TEXTURE_2D,0,this.format,m,_,0,this.format,M.UNSIGNED_BYTE,a.data);else{var P=c||{x:0,y:0},F=P.x,j=P.y;a instanceof Rc||a instanceof Ps||a instanceof Zf||a instanceof nu||Uf&&a instanceof Uf?M.texSubImage2D(M.TEXTURE_2D,0,F,j,M.RGBA,M.UNSIGNED_BYTE,a):M.texSubImage2D(M.TEXTURE_2D,0,F,j,m,_,M.RGBA,M.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},Vf.prototype.bind=function(a,s,c){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),a!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||a),this.filter=a),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)},Vf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Vf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ld=function(a){var s=this;this._callback=a,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};Ld.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Ld.prototype.remove=function(){delete this._channel,this._callback=function(){}};var bh=function(a,s,c){this.target=a,this.parent=s,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Fr(["receive","process"],this),this.invoker=new Ld(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Y()?a:oe};function Uv(a,s,c){var m=2*Math.PI*6378137/256/Math.pow(2,c);return[a*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}bh.prototype.send=function(a,s,c,m,_){var b=this;_===void 0&&(_=!1);var E=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[E]=c);var M=ke(this.globalScope)?void 0:[];return this.target.postMessage({id:E,type:a,hasCallback:!!c,targetMapId:m,mustQueue:_,sourceMapId:this.mapId,data:bs(s,M)},M),{cancel:function(){c&&delete b.callbacks[E],b.target.postMessage({id:E,type:"<cancel>",targetMapId:m,sourceMapId:b.mapId})}}},bh.prototype.receive=function(a){var s=a.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[c];var m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m()}else Y()||s.mustQueue?(this.tasks[c]=s,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,s)},bh.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),s=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(a,s)}},bh.prototype.processTask=function(a,s){var c=this;if(s.type==="<response>"){var m=this.callbacks[a];delete this.callbacks[a],m&&(s.error?m(us(s.error)):m(null,us(s.data)))}else{var _=!1,b=ke(this.globalScope)?void 0:[],E=s.hasCallback?function(j,H){_=!0,delete c.cancelCallbacks[a],c.target.postMessage({id:a,type:"<response>",sourceMapId:c.mapId,error:j?bs(j):null,data:bs(H,b)},b)}:function(j){_=!0},M=null,P=us(s.data);if(this.parent[s.type])M=this.parent[s.type](s.sourceMapId,P,E);else if(this.parent.getWorkerSource){var F=s.type.split(".");M=this.parent.getWorkerSource(s.sourceMapId,F[0],P.source)[F[1]](P,E)}else E(new Error("Could not find function "+s.type));!_&&M&&M.cancel&&(this.cancelCallbacks[a]=M.cancel)}},bh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var uo=function(a,s){a&&(s?this.setSouthWest(a).setNorthEast(s):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};uo.prototype.setNorthEast=function(a){return this._ne=a instanceof Sa?new Sa(a.lng,a.lat):Sa.convert(a),this},uo.prototype.setSouthWest=function(a){return this._sw=a instanceof Sa?new Sa(a.lng,a.lat):Sa.convert(a),this},uo.prototype.extend=function(a){var s,c,m=this._sw,_=this._ne;if(a instanceof Sa)s=a,c=a;else{if(!(a instanceof uo))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(uo.convert(a)):this.extend(Sa.convert(a)):this;if(c=a._ne,!(s=a._sw)||!c)return this}return m||_?(m.lng=Math.min(s.lng,m.lng),m.lat=Math.min(s.lat,m.lat),_.lng=Math.max(c.lng,_.lng),_.lat=Math.max(c.lat,_.lat)):(this._sw=new Sa(s.lng,s.lat),this._ne=new Sa(c.lng,c.lat)),this},uo.prototype.getCenter=function(){return new Sa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},uo.prototype.getSouthWest=function(){return this._sw},uo.prototype.getNorthEast=function(){return this._ne},uo.prototype.getNorthWest=function(){return new Sa(this.getWest(),this.getNorth())},uo.prototype.getSouthEast=function(){return new Sa(this.getEast(),this.getSouth())},uo.prototype.getWest=function(){return this._sw.lng},uo.prototype.getSouth=function(){return this._sw.lat},uo.prototype.getEast=function(){return this._ne.lng},uo.prototype.getNorth=function(){return this._ne.lat},uo.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},uo.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},uo.prototype.isEmpty=function(){return!(this._sw&&this._ne)},uo.prototype.contains=function(a){var s=Sa.convert(a),c=s.lng,m=s.lat,_=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&_},uo.convert=function(a){return!a||a instanceof uo?a:new uo(a)};var Sa=function(a,s){if(isNaN(a)||isNaN(s))throw new Error("Invalid LngLat object: ("+a+", "+s+")");if(this.lng=+a,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Sa.prototype.wrap=function(){return new Sa(er(this.lng,-180,180),this.lat)},Sa.prototype.toArray=function(){return[this.lng,this.lat]},Sa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Sa.prototype.distanceTo=function(a){var s=Math.PI/180,c=this.lat*s,m=a.lat*s,_=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((a.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(_,1))},Sa.prototype.toBounds=function(a){a===void 0&&(a=0);var s=360*a/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new uo(new Sa(this.lng-c,this.lat-s),new Sa(this.lng+c,this.lat+s))},Sa.convert=function(a){if(a instanceof Sa)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Sa(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Sa(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Vv=2*Math.PI*63710088e-1;function Rd(a){return Vv*Math.cos(a*Math.PI/180)}function jv(a){return(180+a)/360}function Gv(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Hv(a,s){return a/Rd(s)}function Dd(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var jf=function(a,s,c){c===void 0&&(c=0),this.x=+a,this.y=+s,this.z=+c};jf.fromLngLat=function(a,s){s===void 0&&(s=0);var c=Sa.convert(a);return new jf(jv(c.lng),Gv(c.lat),Hv(s,c.lat))},jf.prototype.toLngLat=function(){return new Sa(360*this.x-180,Dd(this.y))},jf.prototype.toAltitude=function(){return this.z*Rd(Dd(this.y))},jf.prototype.meterInMercatorCoordinateUnits=function(){return 1/Vv*(a=Dd(this.y),1/Math.cos(a*Math.PI/180));var a};var ff=function(a,s,c){this.z=a,this.x=s,this.y=c,this.key=Qh(0,a,a,s,c)};ff.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},ff.prototype.url=function(a,s){var c,m,_,b,E,M=(m=this.y,_=this.z,b=Uv(256*(c=this.x),256*(m=Math.pow(2,_)-m-1),_),E=Uv(256*(c+1),256*(m+1),_),b[0]+","+b[1]+","+E[0]+","+E[1]),P=function(F,j,H){for(var te,ue="",De=F;De>0;De--)ue+=(j&(te=1<<De-1)?1:0)+(H&te?2:0);return ue}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",P).replace("{bbox-epsg-3857}",M)},ff.prototype.getTilePoint=function(a){var s=Math.pow(2,this.z);return new ae(8192*(a.x*s-this.x),8192*(a.y*s-this.y))},ff.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Od=function(a,s){this.wrap=a,this.canonical=s,this.key=Qh(a,s.z,s.z,s.x,s.y)},wo=function(a,s,c,m,_){this.overscaledZ=a,this.wrap=s,this.canonical=new ff(c,+m,+_),this.key=Qh(s,a,c,m,_)};function Qh(a,s,c,m,_){(a*=2)<0&&(a=-1*a-1);var b=1<<c;return(b*b*a+b*_+m).toString(36)+c.toString(36)+s.toString(36)}wo.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},wo.prototype.scaledTo=function(a){var s=this.canonical.z-a;return a>this.canonical.z?new wo(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new wo(a,this.wrap,a,this.canonical.x>>s,this.canonical.y>>s)},wo.prototype.calculateScaledKey=function(a,s){var c=this.canonical.z-a;return a>this.canonical.z?Qh(this.wrap*+s,a,this.canonical.z,this.canonical.x,this.canonical.y):Qh(this.wrap*+s,a,a,this.canonical.x>>c,this.canonical.y>>c)},wo.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var s=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>s&&a.canonical.y===this.canonical.y>>s},wo.prototype.children=function(a){if(this.overscaledZ>=a)return[new wo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new wo(s,this.wrap,s,c,m),new wo(s,this.wrap,s,c+1,m),new wo(s,this.wrap,s,c,m+1),new wo(s,this.wrap,s,c+1,m+1)]},wo.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},wo.prototype.wrapped=function(){return new wo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},wo.prototype.unwrapTo=function(a){return new wo(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},wo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},wo.prototype.toUnwrapped=function(){return new Od(this.wrap,this.canonical)},wo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},wo.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new jf(a.x-this.wrap,a.y))},pn("CanonicalTileID",ff),pn("OverscaledTileID",wo,{omit:["posMatrix"]});var tc=function(a,s,c){if(this.uid=a,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return ft('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var m=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=c||"mapbox";for(var _=0;_<m;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(m,_)]=this.data[this._idx(m-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,m)]=this.data[this._idx(_,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};tc.prototype.get=function(a,s){var c=new Uint8Array(this.data.buffer),m=4*this._idx(a,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[m],c[m+1],c[m+2])},tc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},tc.prototype._idx=function(a,s){if(a<-1||a>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(a+1)},tc.prototype._unpackMapbox=function(a,s,c){return(256*a*256+256*s+c)/10-1e4},tc.prototype._unpackTerrarium=function(a,s,c){return 256*a+s+c/256-32768},tc.prototype.getPixels=function(){return new Aa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},tc.prototype.backfillBorder=function(a,s,c){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var m=s*this.dim,_=s*this.dim+this.dim,b=c*this.dim,E=c*this.dim+this.dim;switch(s){case-1:m=_-1;break;case 1:_=m+1}switch(c){case-1:b=E-1;break;case 1:E=b+1}for(var M=-s*this.dim,P=-c*this.dim,F=b;F<E;F++)for(var j=m;j<_;j++)this.data[this._idx(j,F)]=a.data[this._idx(j+M,F+P)]},pn("DEMData",tc);var Np=function(a){this._stringToNumber={},this._numberToString=[];for(var s=0;s<a.length;s++){var c=a[s];this._stringToNumber[c]=s,this._numberToString[s]=c}};Np.prototype.encode=function(a){return this._stringToNumber[a]},Np.prototype.decode=function(a){return this._numberToString[a]};var Zp=function(a,s,c,m,_){this.type="Feature",this._vectorTileFeature=a,a._z=s,a._x=c,a._y=m,this.properties=a.properties,this.id=_},Fd={geometry:{configurable:!0}};Fd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Fd.geometry.set=function(a){this._geometry=a},Zp.prototype.toJSON=function(){var a={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(a[s]=this[s]);return a},Object.defineProperties(Zp.prototype,Fd);var Sh=function(){this.state={},this.stateChanges={},this.deletedStates={}};Sh.prototype.updateState=function(a,s,c){var m=String(s);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][m]=this.stateChanges[a][m]||{},qt(this.stateChanges[a][m],c),this.deletedStates[a]===null)for(var _ in this.deletedStates[a]={},this.state[a])_!==m&&(this.deletedStates[a][_]=null);else if(this.deletedStates[a]&&this.deletedStates[a][m]===null)for(var b in this.deletedStates[a][m]={},this.state[a][m])c[b]||(this.deletedStates[a][m][b]=null);else for(var E in c)this.deletedStates[a]&&this.deletedStates[a][m]&&this.deletedStates[a][m][E]===null&&delete this.deletedStates[a][m][E]},Sh.prototype.removeFeatureState=function(a,s,c){if(this.deletedStates[a]!==null){var m=String(s);if(this.deletedStates[a]=this.deletedStates[a]||{},c&&s!==void 0)this.deletedStates[a][m]!==null&&(this.deletedStates[a][m]=this.deletedStates[a][m]||{},this.deletedStates[a][m][c]=null);else if(s!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][m])for(c in this.deletedStates[a][m]={},this.stateChanges[a][m])this.deletedStates[a][m][c]=null;else this.deletedStates[a][m]=null;else this.deletedStates[a]=null}},Sh.prototype.getState=function(a,s){var c=String(s),m=qt({},(this.state[a]||{})[c],(this.stateChanges[a]||{})[c]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var _=this.deletedStates[a][s];if(_===null)return{};for(var b in _)delete m[b]}return m},Sh.prototype.initializeTileState=function(a,s){a.setFeatureState(this.state,s)},Sh.prototype.coalesceChanges=function(a,s){var c={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var _={};for(var b in this.stateChanges[m])this.state[m][b]||(this.state[m][b]={}),qt(this.state[m][b],this.stateChanges[m][b]),_[b]=this.state[m][b];c[m]=_}for(var E in this.deletedStates){this.state[E]=this.state[E]||{};var M={};if(this.deletedStates[E]===null)for(var P in this.state[E])M[P]={},this.state[E][P]={};else for(var F in this.deletedStates[E]){if(this.deletedStates[E][F]===null)this.state[E][F]={};else for(var j=0,H=Object.keys(this.deletedStates[E][F]);j<H.length;j+=1)delete this.state[E][F][H[j]];M[F]=this.state[E][F]}c[E]=c[E]||{},qt(c[E],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var te in a)a[te].setFeatureState(c,s)};var Dc=function(a,s){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Mu(8192,16,0),this.grid3D=new Mu(8192,16,0),this.featureIndexArray=new $,this.promoteId=s};function Wv(a,s,c,m,_){return lr(a,function(b,E){var M=s instanceof Zo?s.get(E):null;return M&&M.evaluate?M.evaluate(c,m,_):M})}function $v(a){for(var s=1/0,c=1/0,m=-1/0,_=-1/0,b=0,E=a;b<E.length;b+=1){var M=E[b];s=Math.min(s,M.x),c=Math.min(c,M.y),m=Math.max(m,M.x),_=Math.max(_,M.y)}return{minX:s,minY:c,maxX:m,maxY:_}}function Xv(a,s){return s-a}Dc.prototype.insert=function(a,s,c,m,_,b){var E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,_);for(var M=b?this.grid3D:this.grid,P=0;P<s.length;P++){for(var F=s[P],j=[1/0,1/0,-1/0,-1/0],H=0;H<F.length;H++){var te=F[H];j[0]=Math.min(j[0],te.x),j[1]=Math.min(j[1],te.y),j[2]=Math.max(j[2],te.x),j[3]=Math.max(j[3],te.y)}j[0]<8192&&j[1]<8192&&j[2]>=0&&j[3]>=0&&M.insert(E,j[0],j[1],j[2],j[3])}},Dc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Ts.VectorTile(new Se(this.rawTileData)).layers,this.sourceLayerCoder=new Np(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Dc.prototype.query=function(a,s,c,m){var _=this;this.loadVTLayers();for(var b=a.params||{},E=8192/a.tileSize/a.scale,M=dl(b.filter),P=a.queryGeometry,F=a.queryPadding*E,j=$v(P),H=this.grid.query(j.minX-F,j.minY-F,j.maxX+F,j.maxY+F),te=$v(a.cameraQueryGeometry),ue=this.grid3D.query(te.minX-F,te.minY-F,te.maxX+F,te.maxY+F,function(zt,Zt,ur,yr){return function(Xr,Fn,nn,Bn,sn){for(var gi=0,Kn=Xr;gi<Kn.length;gi+=1){var En=Kn[gi];if(Fn<=En.x&&nn<=En.y&&Bn>=En.x&&sn>=En.y)return!0}var on=[new ae(Fn,nn),new ae(Fn,sn),new ae(Bn,sn),new ae(Bn,nn)];if(Xr.length>2){for(var Kr=0,Fi=on;Kr<Fi.length;Kr+=1)if(Ws(Xr,Fi[Kr]))return!0}for(var Nn=0;Nn<Xr.length-1;Nn++)if(tl(Xr[Nn],Xr[Nn+1],on))return!0;return!1}(a.cameraQueryGeometry,zt-F,Zt-F,ur+F,yr+F)}),De=0,Be=ue;De<Be.length;De+=1)H.push(Be[De]);H.sort(Xv);for(var Je,He={},mt=function(zt){var Zt=H[zt];if(Zt!==Je){Je=Zt;var ur=_.featureIndexArray.get(Zt),yr=null;_.loadMatchingFeature(He,ur.bucketIndex,ur.sourceLayerIndex,ur.featureIndex,M,b.layers,b.availableImages,s,c,m,function(Xr,Fn,nn){return yr||(yr=xa(Xr)),Fn.queryIntersectsFeature(P,Xr,nn,yr,_.z,a.transform,E,a.pixelPosMatrix)})}},Lt=0;Lt<H.length;Lt++)mt(Lt);return He},Dc.prototype.loadMatchingFeature=function(a,s,c,m,_,b,E,M,P,F,j){var H=this.bucketLayerIDs[s];if(!b||function(Xr,Fn){for(var nn=0;nn<Xr.length;nn++)if(Fn.indexOf(Xr[nn])>=0)return!0;return!1}(b,H)){var te=this.sourceLayerCoder.decode(c),ue=this.vtLayers[te].feature(m);if(_.needGeometry){var De=za(ue,!0);if(!_.filter(new Ee(this.tileID.overscaledZ),De,this.tileID.canonical))return}else if(!_.filter(new Ee(this.tileID.overscaledZ),ue))return;for(var Be=this.getId(ue,te),Je=0;Je<H.length;Je++){var He=H[Je];if(!(b&&b.indexOf(He)<0)){var mt=M[He];if(mt){var Lt={};Be!==void 0&&F&&(Lt=F.getState(mt.sourceLayer||"_geojsonTileLayer",Be));var zt=qt({},P[He]);zt.paint=Wv(zt.paint,mt.paint,ue,Lt,E),zt.layout=Wv(zt.layout,mt.layout,ue,Lt,E);var Zt=!j||j(ue,mt,Lt);if(Zt){var ur=new Zp(ue,this.z,this.x,this.y,Be);ur.layer=zt;var yr=a[He];yr===void 0&&(yr=a[He]=[]),yr.push({featureIndex:m,feature:ur,intersectionZ:Zt})}}}}}},Dc.prototype.lookupSymbolFeatures=function(a,s,c,m,_,b,E,M){var P={};this.loadVTLayers();for(var F=dl(_),j=0,H=a;j<H.length;j+=1)this.loadMatchingFeature(P,c,m,H[j],F,b,E,M,s);return P},Dc.prototype.hasLayer=function(a){for(var s=0,c=this.bucketLayerIDs;s<c.length;s+=1)for(var m=0,_=c[s];m<_.length;m+=1)if(a===_[m])return!0;return!1},Dc.prototype.getId=function(a,s){var c=a.id;return this.promoteId&&typeof(c=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(c=Number(c)),c},pn("FeatureIndex",Dc,{omit:["rawTileData","sourceLayerCoder"]});var Oo=function(a,s){this.tileID=a,this.uid=tr(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Oo.prototype.registerFadeDuration=function(a){var s=a+this.timeAdded;s<jn.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},Oo.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Oo.prototype.loadVectorData=function(a,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var m in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(F,j){var H={};if(!j)return H;for(var te=function(){var Be=De[ue],Je=Be.layerIds.map(function(Lt){return j.getLayer(Lt)}).filter(Boolean);if(Je.length!==0){Be.layers=Je,Be.stateDependentLayerIds&&(Be.stateDependentLayers=Be.stateDependentLayerIds.map(function(Lt){return Je.filter(function(zt){return zt.id===Lt})[0]}));for(var He=0,mt=Je;He<mt.length;He+=1)H[mt[He].id]=Be}},ue=0,De=F;ue<De.length;ue+=1)te();return H}(a.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[m];if(_ instanceof Ft){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var E=this.buckets[b];if(E instanceof Ft&&E.hasRTLText){this.hasRTLText=!0,It.isLoading()||It.isLoaded()||Xl()!=="deferred"||Gs();break}}for(var M in this.queryPadding=0,this.buckets){var P=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(M).queryRadius(P))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},Oo.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Oo.prototype.getBucket=function(a){return this.buckets[a.id]},Oo.prototype.upload=function(a){for(var s in this.buckets){var c=this.buckets[s];c.uploadPending()&&c.upload(a)}var m=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Vf(a,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Vf(a,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},Oo.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},Oo.prototype.queryRenderedFeatures=function(a,s,c,m,_,b,E,M,P,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:_,scale:b,tileSize:this.tileSize,pixelPosMatrix:F,transform:M,params:E,queryPadding:this.queryPadding*P},a,s,c):{}},Oo.prototype.querySourceFeatures=function(a,s){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var m=c.loadVTLayers(),_=s?s.sourceLayer:"",b=m._geojsonTileLayer||m[_];if(b)for(var E=dl(s&&s.filter),M=this.tileID.canonical,P=M.z,F=M.x,j=M.y,H={z:P,x:F,y:j},te=0;te<b.length;te++){var ue=b.feature(te);if(E.needGeometry){var De=za(ue,!0);if(!E.filter(new Ee(this.tileID.overscaledZ),De,this.tileID.canonical))continue}else if(!E.filter(new Ee(this.tileID.overscaledZ),ue))continue;var Be=c.getId(ue,_),Je=new Zp(ue,P,F,j,Be);Je.tile=H,a.push(Je)}}},Oo.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Oo.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Oo.prototype.setExpiryData=function(a){var s=this.expirationTime;if(a.cacheControl){var c=Le(a.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var m=Date.now(),_=!1;if(this.expirationTime>m)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{var b=this.expirationTime-s;b?this.expirationTime=m+Math.max(b,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Oo.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Oo.prototype.setFeatureState=function(a,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(s.style.hasLayer(m)){var _=this.buckets[m],b=_.layers[0].sourceLayer||"_geojsonTileLayer",E=c[b],M=a[b];if(E&&M&&Object.keys(M).length!==0){_.update(M,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});var P=s&&s.style&&s.style.getLayer(m);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(_)))}}}},Oo.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Oo.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<jn.now()},Oo.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Oo.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=jn.now()+a},Oo.prototype.setDependencies=function(a,s){for(var c={},m=0,_=s;m<_.length;m+=1)c[_[m]]=!0;this.dependencies[a]=c},Oo.prototype.hasDependency=function(a,s){for(var c=0,m=a;c<m.length;c+=1){var _=this.dependencies[m[c]];if(_){for(var b=0,E=s;b<E.length;b+=1)if(_[E[b]])return!0}}return!1};var hf=oe.performance,Yv=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},hf.mark(this._marks.start)};Yv.prototype.finish=function(){hf.mark(this._marks.end);var a=hf.getEntriesByName(this._marks.measure);return a.length===0&&(hf.measure(this._marks.measure,this._marks.start,this._marks.end),a=hf.getEntriesByName(this._marks.measure),hf.clearMarks(this._marks.start),hf.clearMarks(this._marks.end),hf.clearMeasures(this._marks.measure)),a},y.Actor=bh,y.AlphaImage=Lo,y.CanonicalTileID=ff,y.CollisionBoxArray=d,y.Color=vi,y.DEMData=tc,y.DataConstantProperty=Ln,y.DictionaryCoder=Np,y.EXTENT=8192,y.ErrorEvent=Ke,y.EvaluationParameters=Ee,y.Event=Oe,y.Evented=ot,y.FeatureIndex=Dc,y.FillBucket=gu,y.FillExtrusionBucket=Ms,y.ImageAtlas=Pn,y.ImagePosition=vr,y.LineBucket=Ro,y.LngLat=Sa,y.LngLatBounds=uo,y.MercatorCoordinate=jf,y.ONE_EM=24,y.OverscaledTileID=wo,y.Point=ae,y.Point$1=ae,y.Properties=yo,y.Protobuf=Se,y.RGBAImage=Aa,y.RequestManager=Ii,y.RequestPerformance=Yv,y.ResourceType=xn,y.SegmentVector=ve,y.SourceFeatureState=Sh,y.StructArrayLayout1ui2=If,y.StructArrayLayout2f1f2i16=Ju,y.StructArrayLayout2i4=Ku,y.StructArrayLayout3ui6=es,y.StructArrayLayout4i8=Qc,y.SymbolBucket=Ft,y.Texture=Vf,y.Tile=Oo,y.Transitionable=he,y.Uniform1f=zr,y.Uniform1i=pr,y.Uniform2f=Rr,y.Uniform3f=an,y.Uniform4f=Tn,y.UniformColor=In,y.UniformMatrix4f=Mi,y.UnwrappedTileID=Od,y.ValidationError=J,y.WritingMode=zn,y.ZoomHistory=Xu,y.add=function(a,s,c){return a[0]=s[0]+c[0],a[1]=s[1]+c[1],a[2]=s[2]+c[2],a},y.addDynamicAttributes=ge,y.asyncAll=function(a,s,c){if(!a.length)return c(null,[]);var m=a.length,_=new Array(a.length),b=null;a.forEach(function(E,M){s(E,function(P,F){P&&(b=P),_[M]=F,--m==0&&c(b,_)})})},y.bezier=rt,y.bindAll=Fr,y.browser=jn,y.cacheEntryPossiblyAdded=function(a){++wn>ar&&(a.getActor().send("enforceCacheSizeLimit",Tt),wn=0)},y.clamp=Pt,y.clearTileCache=function(a){var s=oe.caches.delete("mapbox-tiles");a&&s.catch(a).then(function(){return a()})},y.clipLine=Vn,y.clone=function(a){var s=new Oi(16);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s},y.clone$1=at,y.clone$2=function(a){var s=new Oi(3);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s},y.collisionCircleLayout=Id,y.config=tn,y.create=function(){var a=new Oi(16);return Oi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},y.create$1=function(){var a=new Oi(9);return Oi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},y.create$2=function(){var a=new Oi(4);return Oi!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},y.createCommonjsModule=se,y.createExpression=pc,y.createLayout=Ba,y.createStyleLayer=function(a){return a.type==="custom"?new da(a):new Is[a.type](a)},y.cross=function(a,s,c){var m=s[0],_=s[1],b=s[2],E=c[0],M=c[1],P=c[2];return a[0]=_*P-b*M,a[1]=b*E-m*P,a[2]=m*M-_*E,a},y.deepEqual=function a(s,c){if(Array.isArray(s)){if(!Array.isArray(c)||s.length!==c.length)return!1;for(var m=0;m<s.length;m++)if(!a(s[m],c[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&c!==null){if(typeof c!="object"||Object.keys(s).length!==Object.keys(c).length)return!1;for(var _ in s)if(!a(s[_],c[_]))return!1;return!0}return s===c},y.dot=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]},y.dot$1=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]+a[3]*s[3]},y.ease=ct,y.emitValidationErrors=$u,y.endsWith=mr,y.enforceCacheSizeLimit=function(a){Er(),ne&&ne.then(function(s){s.keys().then(function(c){for(var m=0;m<c.length-a;m++)s.delete(c[m])})})},y.evaluateSizeForFeature=Ha,y.evaluateSizeForZoom=eo,y.evaluateVariableOffset=Xe,y.evented=bc,y.extend=qt,y.featureFilter=dl,y.filterObject=xt,y.fromRotation=function(a,s){var c=Math.sin(s),m=Math.cos(s);return a[0]=m,a[1]=c,a[2]=0,a[3]=-c,a[4]=m,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},y.getAnchorAlignment=Ga,y.getAnchorJustification=gt,y.getArrayBuffer=$o,y.getImage=X,y.getJSON=function(a,s){return po(qt(a,{type:"json"}),s)},y.getRTLTextPluginStatus=Xl,y.getReferrer=Jn,y.getVideo=function(a,s){var c,m,_=oe.document.createElement("video");_.muted=!0,_.onloadstart=function(){s(null,_)};for(var b=0;b<a.length;b++){var E=oe.document.createElement("source");c=a[b],m=void 0,(m=oe.document.createElement("a")).href=c,(m.protocol!==oe.document.location.protocol||m.host!==oe.document.location.host)&&(_.crossOrigin="Anonymous"),E.src=a[b],_.appendChild(E)}return{cancel:function(){}}},y.identity=Ao,y.invert=function(a,s){var c=s[0],m=s[1],_=s[2],b=s[3],E=s[4],M=s[5],P=s[6],F=s[7],j=s[8],H=s[9],te=s[10],ue=s[11],De=s[12],Be=s[13],Je=s[14],He=s[15],mt=c*M-m*E,Lt=c*P-_*E,zt=c*F-b*E,Zt=m*P-_*M,ur=m*F-b*M,yr=_*F-b*P,Xr=j*Be-H*De,Fn=j*Je-te*De,nn=j*He-ue*De,Bn=H*Je-te*Be,sn=H*He-ue*Be,gi=te*He-ue*Je,Kn=mt*gi-Lt*sn+zt*Bn+Zt*nn-ur*Fn+yr*Xr;return Kn?(a[0]=(M*gi-P*sn+F*Bn)*(Kn=1/Kn),a[1]=(_*sn-m*gi-b*Bn)*Kn,a[2]=(Be*yr-Je*ur+He*Zt)*Kn,a[3]=(te*ur-H*yr-ue*Zt)*Kn,a[4]=(P*nn-E*gi-F*Fn)*Kn,a[5]=(c*gi-_*nn+b*Fn)*Kn,a[6]=(Je*zt-De*yr-He*Lt)*Kn,a[7]=(j*yr-te*zt+ue*Lt)*Kn,a[8]=(E*sn-M*nn+F*Xr)*Kn,a[9]=(m*nn-c*sn-b*Xr)*Kn,a[10]=(De*ur-Be*zt+He*mt)*Kn,a[11]=(H*zt-j*ur-ue*mt)*Kn,a[12]=(M*Fn-E*Bn-P*Xr)*Kn,a[13]=(c*Bn-m*Fn+_*Xr)*Kn,a[14]=(Be*Lt-De*Zt-Je*mt)*Kn,a[15]=(j*Zt-H*Lt+te*mt)*Kn,a):null},y.isChar=Dr,y.isMapboxURL=Ti,y.keysDifference=function(a,s){var c=[];for(var m in a)m in s||c.push(m);return c},y.makeRequest=po,y.mapObject=lr,y.mercatorXfromLng=jv,y.mercatorYfromLat=Gv,y.mercatorZfromAltitude=Hv,y.mul=ku,y.multiply=Qa,y.mvt=Ts,y.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},y.normalize=function(a,s){var c=s[0],m=s[1],_=s[2],b=c*c+m*m+_*_;return b>0&&(b=1/Math.sqrt(b)),a[0]=s[0]*b,a[1]=s[1]*b,a[2]=s[2]*b,a},y.number=La,y.offscreenCanvasSupported=gn,y.ortho=function(a,s,c,m,_,b,E){var M=1/(s-c),P=1/(m-_),F=1/(b-E);return a[0]=-2*M,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*P,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*F,a[11]=0,a[12]=(s+c)*M,a[13]=(_+m)*P,a[14]=(E+b)*F,a[15]=1,a},y.parseGlyphPBF=function(a){return new Se(a).readFields(dr,[])},y.pbf=Se,y.performSymbolLayout=function(a,s,c,m,_,b,E){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var M=a.layers[0].layout,P=a.layers[0]._unevaluatedLayout._values,F={};if(a.textSizeData.kind==="composite"){var j=a.textSizeData,H=j.maxZoom;F.compositeTextSizes=[P["text-size"].possiblyEvaluate(new Ee(j.minZoom),E),P["text-size"].possiblyEvaluate(new Ee(H),E)]}if(a.iconSizeData.kind==="composite"){var te=a.iconSizeData,ue=te.maxZoom;F.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new Ee(te.minZoom),E),P["icon-size"].possiblyEvaluate(new Ee(ue),E)]}F.layoutTextSize=P["text-size"].possiblyEvaluate(new Ee(a.zoom+1),E),F.layoutIconSize=P["icon-size"].possiblyEvaluate(new Ee(a.zoom+1),E),F.textMaxSize=P["text-size"].possiblyEvaluate(new Ee(18));for(var De=24*M.get("text-line-height"),Be=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Je=M.get("text-keep-upright"),He=M.get("text-size"),mt=function(){var Zt=zt[Lt],ur=M.get("text-font").evaluate(Zt,{},E).join(","),yr=He.evaluate(Zt,{},E),Xr=F.layoutTextSize.evaluate(Zt,{},E),Fn=F.layoutIconSize.evaluate(Zt,{},E),nn={horizontal:{},vertical:void 0},Bn=Zt.text,sn=[0,0];if(Bn){var gi=Bn.toString(),Kn=24*M.get("text-letter-spacing").evaluate(Zt,{},E),En=function(Li){for(var sa=0,ea=Li;sa<ea.length;sa+=1)if(Ni=ea[sa].charCodeAt(0),Dr.Arabic(Ni)||Dr["Arabic Supplement"](Ni)||Dr["Arabic Extended-A"](Ni)||Dr["Arabic Presentation Forms-A"](Ni)||Dr["Arabic Presentation Forms-B"](Ni))return!1;var Ni;return!0}(gi)?Kn:0,on=M.get("text-anchor").evaluate(Zt,{},E),Kr=M.get("text-variable-anchor");if(!Kr){var Fi=M.get("text-radial-offset").evaluate(Zt,{},E);sn=Fi?Xe(on,[24*Fi,de]):M.get("text-offset").evaluate(Zt,{},E).map(function(Li){return 24*Li})}var Nn=Be?"center":M.get("text-justify").evaluate(Zt,{},E),Vi=M.get("symbol-placement"),Ta=Vi==="point"?24*M.get("text-max-width").evaluate(Zt,{},E):0,to=function(){a.allowVerticalPlacement&&Yc(gi)&&(nn.vertical=fr(Bn,s,c,_,ur,Ta,De,on,"left",En,sn,zn.vertical,!0,Vi,Xr,yr))};if(!Be&&Kr){for(var Xa=Nn==="auto"?Kr.map(function(Li){return gt(Li)}):[Nn],Ma=!1,ro=0;ro<Xa.length;ro++){var Fo=Xa[ro];if(!nn.horizontal[Fo])if(Ma)nn.horizontal[Fo]=nn.horizontal[0];else{var Bo=fr(Bn,s,c,_,ur,Ta,De,"center",Fo,En,sn,zn.horizontal,!1,Vi,Xr,yr);Bo&&(nn.horizontal[Fo]=Bo,Ma=Bo.positionedLines.length===1)}}to()}else{Nn==="auto"&&(Nn=gt(on));var Ls=fr(Bn,s,c,_,ur,Ta,De,on,Nn,En,sn,zn.horizontal,!1,Vi,Xr,yr);Ls&&(nn.horizontal[Nn]=Ls),to(),Yc(gi)&&Be&&Je&&(nn.vertical=fr(Bn,s,c,_,ur,Ta,De,on,Nn,En,sn,zn.vertical,!1,Vi,Xr,yr))}}var Go=void 0,Rs=!1;if(Zt.icon&&Zt.icon.name){var lo=m[Zt.icon.name];lo&&(Go=function(Li,sa,ea){var Ni=Ga(ea),Ys=sa[0]-Li.displaySize[0]*Ni.horizontalAlign,ps=sa[1]-Li.displaySize[1]*Ni.verticalAlign;return{image:Li,top:ps,bottom:ps+Li.displaySize[1],left:Ys,right:Ys+Li.displaySize[0]}}(_[Zt.icon.name],M.get("icon-offset").evaluate(Zt,{},E),M.get("icon-anchor").evaluate(Zt,{},E)),Rs=lo.sdf,a.sdfIcons===void 0?a.sdfIcons=lo.sdf:a.sdfIcons!==lo.sdf&&ft("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(lo.pixelRatio!==a.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var zo=Qe(nn.horizontal)||nn.vertical;a.iconsInText=!!zo&&zo.iconsInText,(zo||Go)&&function(Li,sa,ea,Ni,Ys,ps,wa,Eo,ds,Gi,Oc){var Ou=ps.textMaxSize.evaluate(sa,{});Ou===void 0&&(Ou=wa);var il,co=Li.layers[0].layout,Fc=co.get("icon-offset").evaluate(sa,{},Oc),Al=Qe(ea.horizontal),ep=wa/24,wh=Li.tilePixelRatio*ep,tp=Li.tilePixelRatio*Ou/24,pf=Li.tilePixelRatio*Eo,rp=Li.tilePixelRatio*co.get("symbol-spacing"),Bd=co.get("text-padding")*Li.tilePixelRatio,np=co.get("icon-padding")*Li.tilePixelRatio,Up=co.get("text-max-angle")/180*Math.PI,zd=co.get("text-rotation-alignment")==="map"&&co.get("symbol-placement")!=="point",Nd=co.get("icon-rotation-alignment")==="map"&&co.get("symbol-placement")!=="point",Cl=co.get("symbol-placement"),ip=rp/2,Gf=co.get("icon-text-fit");Ni&&Gf!=="none"&&(Li.allowVerticalPlacement&&ea.vertical&&(il=wi(Ni,ea.vertical,Gf,co.get("icon-text-fit-padding"),Fc,ep)),Al&&(Ni=wi(Ni,Al,Gf,co.get("icon-text-fit-padding"),Fc,ep)));var Bc=function($m,cp){cp.x<0||cp.x>=8192||cp.y<0||cp.y>=8192||function(no,Ml,Xm,df,Ud,q,fp,kl,hp,kh,pp,dp,$p,vf,Ih,Vd,jd,Gd,Hd,qv,_u,vp,Wd,Il,Kv){var $d,Pl,$f,Xf,Yf,mf=no.addToLineVertexArray(Ml,Xm),Jv=0,Xd=0,Qv=0,em=0,Xp=-1,Yd=-1,rs={},tm=Pe(""),qd=0,Kd=0;if(kl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(qd=($d=kl.layout.get("text-offset").evaluate(_u,{},Il).map(function(gp){return 24*gp}))[0],Kd=$d[1]):(qd=24*kl.layout.get("text-radial-offset").evaluate(_u,{},Il),Kd=de),no.allowVerticalPlacement&&df.vertical){var rm=kl.layout.get("text-rotate").evaluate(_u,{},Il)+90;Xf=new Re(hp,Ml,kh,pp,dp,df.vertical,$p,vf,Ih,rm),fp&&(Yf=new Re(hp,Ml,kh,pp,dp,fp,jd,Gd,Ih,rm))}if(Ud){var qf=kl.layout.get("icon-rotate").evaluate(_u,{}),Jd=kl.layout.get("icon-text-fit")!=="none",Qd=Ei(Ud,qf,Wd,Jd),Yp=fp?Ei(fp,qf,Wd,Jd):void 0;$f=new Re(hp,Ml,kh,pp,dp,Ud,jd,Gd,!1,qf),Jv=4*Qd.length;var qp=no.iconSizeData,Ph=null;qp.kind==="source"?(Ph=[128*kl.layout.get("icon-size").evaluate(_u,{})])[0]>32640&&ft(no.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):qp.kind==="composite"&&((Ph=[128*vp.compositeIconSizes[0].evaluate(_u,{},Il),128*vp.compositeIconSizes[1].evaluate(_u,{},Il)])[0]>32640||Ph[1]>32640)&&ft(no.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),no.addSymbols(no.icon,Qd,Ph,qv,Hd,_u,!1,Ml,mf.lineStartIndex,mf.lineLength,-1,Il),Xp=no.icon.placedSymbolArray.length-1,Yp&&(Xd=4*Yp.length,no.addSymbols(no.icon,Yp,Ph,qv,Hd,_u,zn.vertical,Ml,mf.lineStartIndex,mf.lineLength,-1,Il),Yd=no.icon.placedSymbolArray.length-1)}for(var nm in df.horizontal){var Kp=df.horizontal[nm];if(!Pl){tm=Pe(Kp.text);var ev=kl.layout.get("text-rotate").evaluate(_u,{},Il);Pl=new Re(hp,Ml,kh,pp,dp,Kp,$p,vf,Ih,ev)}var Jp=Kp.positionedLines.length===1;if(Qv+=St(no,Ml,Kp,q,kl,Ih,_u,Vd,mf,df.vertical?zn.horizontal:zn.horizontalOnly,Jp?Object.keys(df.horizontal):[nm],rs,Xp,vp,Il),Jp)break}df.vertical&&(em+=St(no,Ml,df.vertical,q,kl,Ih,_u,Vd,mf,zn.vertical,["vertical"],rs,Yd,vp,Il));var tv=Pl?Pl.boxStartIndex:no.collisionBoxArray.length,Qp=Pl?Pl.boxEndIndex:no.collisionBoxArray.length,ed=Xf?Xf.boxStartIndex:no.collisionBoxArray.length,rv=Xf?Xf.boxEndIndex:no.collisionBoxArray.length,nv=$f?$f.boxStartIndex:no.collisionBoxArray.length,td=$f?$f.boxEndIndex:no.collisionBoxArray.length,mp=Yf?Yf.boxStartIndex:no.collisionBoxArray.length,xu=Yf?Yf.boxEndIndex:no.collisionBoxArray.length,al=-1,Lh=function(gp,im){return gp&&gp.circleDiameter?Math.max(gp.circleDiameter,im):im};al=Lh(Pl,al),al=Lh(Xf,al),al=Lh($f,al);var Nc=(al=Lh(Yf,al))>-1?1:0;Nc&&(al*=Kv/24),no.glyphOffsetArray.length>=Ft.MAX_GLYPHS&&ft("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),_u.sortKey!==void 0&&no.addToSortKeyRanges(no.symbolInstances.length,_u.sortKey),no.symbolInstances.emplaceBack(Ml.x,Ml.y,rs.right>=0?rs.right:-1,rs.center>=0?rs.center:-1,rs.left>=0?rs.left:-1,rs.vertical||-1,Xp,Yd,tm,tv,Qp,ed,rv,nv,td,mp,xu,kh,Qv,em,Jv,Xd,Nc,0,$p,qd,Kd,al)}(Li,cp,$m,ea,Ni,Ys,il,Li.layers[0],Li.collisionBoxArray,sa.index,sa.sourceLayerIndex,Li.index,wh,Bd,zd,ds,pf,np,Nd,Fc,sa,ps,Gi,Oc,wa)};if(Cl==="line")for(var Tl=0,rc=Vn(sa.geometry,0,0,8192,8192);Tl<rc.length;Tl+=1)for(var ap=rc[Tl],Eh=0,Ah=ji(ap,rp,Up,ea.vertical||Al,Ni,24,tp,Li.overscaling,8192);Eh<Ah.length;Eh+=1){var Ch=Ah[Eh];Al&&qe(Li,Al.text,ip,Ch)||Bc(ap,Ch)}else if(Cl==="line-center")for(var Th=0,op=sa.geometry;Th<op.length;Th+=1){var sp=op[Th];if(sp.length>1){var up=jo(sp,Up,ea.vertical||Al,Ni,24,tp);up&&Bc(sp,up)}}else if(sa.type==="Polygon")for(var Hf=0,Vp=kc(sa.geometry,0);Hf<Vp.length;Hf+=1){var Mh=Vp[Hf],lp=dn(Mh,16);Bc(Mh[0],new ba(lp.x,lp.y,0))}else if(sa.type==="LineString")for(var Wf=0,zc=sa.geometry;Wf<zc.length;Wf+=1){var Ho=zc[Wf];Bc(Ho,new ba(Ho[0].x,Ho[0].y,0))}else if(sa.type==="Point")for(var jp=0,Zd=sa.geometry;jp<Zd.length;jp+=1)for(var Gp=0,Hp=Zd[jp];Gp<Hp.length;Gp+=1){var Wp=Hp[Gp];Bc([Wp],new ba(Wp.x,Wp.y,0))}}(a,Zt,nn,Go,m,F,Xr,Fn,sn,Rs,E)},Lt=0,zt=a.features;Lt<zt.length;Lt+=1)mt();b&&a.generateCollisionDebugBuffers()},y.perspective=function(a,s,c,m,_){var b,E=1/Math.tan(s/2);return a[0]=E/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=E,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,_!=null&&_!==1/0?(a[10]=(_+m)*(b=1/(m-_)),a[14]=2*_*m*b):(a[10]=-1,a[14]=-2*m),a},y.pick=function(a,s){for(var c={},m=0;m<s.length;m++){var _=s[m];_ in a&&(c[_]=a[_])}return c},y.plugin=It,y.polygonIntersectsPolygon=el,y.postMapLoadEvent=Ve,y.postTurnstileEvent=Wt,y.potpack=Ur,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=pn,y.registerForPluginStateChange=function(a){return a({pluginStatus:ls,pluginURL:cu}),bc.on("pluginStateChange",a),a},y.renderColorRamp=wl,y.rotate=function(a,s,c){var m=s[0],_=s[1],b=s[2],E=s[3],M=Math.sin(c),P=Math.cos(c);return a[0]=m*P+b*M,a[1]=_*P+E*M,a[2]=m*-M+b*P,a[3]=_*-M+E*P,a},y.rotateX=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),b=s[4],E=s[5],M=s[6],P=s[7],F=s[8],j=s[9],H=s[10],te=s[11];return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[4]=b*_+F*m,a[5]=E*_+j*m,a[6]=M*_+H*m,a[7]=P*_+te*m,a[8]=F*_-b*m,a[9]=j*_-E*m,a[10]=H*_-M*m,a[11]=te*_-P*m,a},y.rotateZ=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),b=s[0],E=s[1],M=s[2],P=s[3],F=s[4],j=s[5],H=s[6],te=s[7];return s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[0]=b*_+F*m,a[1]=E*_+j*m,a[2]=M*_+H*m,a[3]=P*_+te*m,a[4]=F*_-b*m,a[5]=j*_-E*m,a[6]=H*_-M*m,a[7]=te*_-P*m,a},y.scale=function(a,s,c){var m=c[0],_=c[1],b=c[2];return a[0]=s[0]*m,a[1]=s[1]*m,a[2]=s[2]*m,a[3]=s[3]*m,a[4]=s[4]*_,a[5]=s[5]*_,a[6]=s[6]*_,a[7]=s[7]*_,a[8]=s[8]*b,a[9]=s[9]*b,a[10]=s[10]*b,a[11]=s[11]*b,a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},y.scale$1=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a[3]=s[3]*c,a},y.scale$2=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a},y.setCacheLimits=function(a,s){Tt=a,ar=s},y.setRTLTextPlugin=function(a,s,c){if(c===void 0&&(c=!1),ls==="deferred"||ls==="loading"||ls==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");cu=jn.resolveURL(a),ls="deferred",Kc=s,$l(),c||Gs()},y.sphericalToCartesian=function(a){var s=a[0],c=a[1],m=a[2];return c+=90,c*=Math.PI/180,m*=Math.PI/180,{x:s*Math.cos(c)*Math.sin(m),y:s*Math.sin(c)*Math.sin(m),z:s*Math.cos(m)}},y.sqrLen=function(a){var s=a[0],c=a[1];return s*s+c*c},y.styleSpec=pe,y.sub=function(a,s,c){return a[0]=s[0]-c[0],a[1]=s[1]-c[1],a[2]=s[2]-c[2],a},y.symbolSize=bo,y.transformMat3=function(a,s,c){var m=s[0],_=s[1],b=s[2];return a[0]=m*c[0]+_*c[3]+b*c[6],a[1]=m*c[1]+_*c[4]+b*c[7],a[2]=m*c[2]+_*c[5]+b*c[8],a},y.transformMat4=$s,y.translate=function(a,s,c){var m,_,b,E,M,P,F,j,H,te,ue,De,Be=c[0],Je=c[1],He=c[2];return s===a?(a[12]=s[0]*Be+s[4]*Je+s[8]*He+s[12],a[13]=s[1]*Be+s[5]*Je+s[9]*He+s[13],a[14]=s[2]*Be+s[6]*Je+s[10]*He+s[14],a[15]=s[3]*Be+s[7]*Je+s[11]*He+s[15]):(_=s[1],b=s[2],E=s[3],M=s[4],P=s[5],F=s[6],j=s[7],H=s[8],te=s[9],ue=s[10],De=s[11],a[0]=m=s[0],a[1]=_,a[2]=b,a[3]=E,a[4]=M,a[5]=P,a[6]=F,a[7]=j,a[8]=H,a[9]=te,a[10]=ue,a[11]=De,a[12]=m*Be+M*Je+H*He+s[12],a[13]=_*Be+P*Je+te*He+s[13],a[14]=b*Be+F*Je+ue*He+s[14],a[15]=E*Be+j*Je+De*He+s[15]),a},y.triggerPluginCompletionEvent=Jc,y.uniqueId=tr,y.validateCustomStyleLayer=function(a){var s=[],c=a.id;return c===void 0&&s.push({message:"layers."+c+': missing required property "id"'}),a.render===void 0&&s.push({message:"layers."+c+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&s.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=Vh,y.validateStyle=xs,y.values=function(a){var s=[];for(var c in a)s.push(a[c]);return s},y.vectorTile=Ts,y.version="1.13.3",y.warnOnce=ft,y.webpSupported=Cn,y.window=oe,y.wrap=er}),Q(["./shared"],function(y){"use strict";function se(G){var X=typeof G;if(X==="number"||X==="boolean"||X==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var ie="[",we=0,Oe=G;we<Oe.length;we+=1)ie+=se(Oe[we])+",";return ie+"]"}for(var Ke=Object.keys(G).sort(),ot="{",pe=0;pe<Ke.length;pe++)ot+=JSON.stringify(Ke[pe])+":"+se(G[Ke[pe]])+",";return ot+"}"}function U(G){for(var X="",ie=0,we=y.refProperties;ie<we.length;ie+=1)X+="/"+se(G[we[ie]]);return X}var ce=function(G){this.keyCache={},G&&this.replace(G)};ce.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},ce.prototype.update=function(G,X){for(var ie=this,we=0,Oe=G;we<Oe.length;we+=1){var Ke=Oe[we];this._layerConfigs[Ke.id]=Ke;var ot=this._layers[Ke.id]=y.createStyleLayer(Ke);ot._featureFilter=y.featureFilter(ot.filter),this.keyCache[Ke.id]&&delete this.keyCache[Ke.id]}for(var pe=0,J=X;pe<J.length;pe+=1){var be=J[pe];delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be]}this.familiesBySource={};for(var lt=0,dt=function(Gr,Yr){for(var li={},qr=0;qr<Gr.length;qr++){var hi=Yr&&Yr[Gr[qr].id]||U(Gr[qr]);Yr&&(Yr[Gr[qr].id]=hi);var Bi=li[hi];Bi||(Bi=li[hi]=[]),Bi.push(Gr[qr])}var ci=[];for(var _i in li)ci.push(li[_i]);return ci}(y.values(this._layerConfigs),this.keyCache);lt<dt.length;lt+=1){var re=dt[lt].map(function(Gr){return ie._layers[Gr.id]}),br=re[0];if(br.visibility!=="none"){var yn=br.source||"",ln=this.familiesBySource[yn];ln||(ln=this.familiesBySource[yn]={});var Qt=br.sourceLayer||"_geojsonTileLayer",en=ln[Qt];en||(en=ln[Qt]=[]),en.push(re)}}};var ae=function(G){var X={},ie=[];for(var we in G){var Oe=G[we],Ke=X[we]={};for(var ot in Oe){var pe=Oe[+ot];if(pe&&pe.bitmap.width!==0&&pe.bitmap.height!==0){var J={x:0,y:0,w:pe.bitmap.width+2,h:pe.bitmap.height+2};ie.push(J),Ke[ot]={rect:J,metrics:pe.metrics}}}}var be=y.potpack(ie),lt=new y.AlphaImage({width:be.w||1,height:be.h||1});for(var dt in G){var re=G[dt];for(var br in re){var yn=re[+br];if(yn&&yn.bitmap.width!==0&&yn.bitmap.height!==0){var ln=X[dt][br].rect;y.AlphaImage.copy(yn.bitmap,lt,{x:0,y:0},{x:ln.x+1,y:ln.y+1},yn.bitmap)}}}this.image=lt,this.positions=X};y.register("GlyphAtlas",ae);var Ge=function(G){this.tileID=new y.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function oe(G,X,ie){for(var we=new y.EvaluationParameters(X),Oe=0,Ke=G;Oe<Ke.length;Oe+=1)Ke[Oe].recalculate(we,ie)}function je(G,X){var ie=y.getArrayBuffer(G.request,function(we,Oe,Ke,ot){we?X(we):Oe&&X(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(Oe)),rawData:Oe,cacheControl:Ke,expires:ot})});return function(){ie.cancel(),X()}}Ge.prototype.parse=function(G,X,ie,we,Oe){var Ke=this;this.status="parsing",this.data=G,this.collisionBoxArray=new y.CollisionBoxArray;var ot=new y.DictionaryCoder(Object.keys(G.layers).sort()),pe=new y.FeatureIndex(this.tileID,this.promoteId);pe.bucketLayerIDs=[];var J,be,lt,dt,re={},br={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ie},yn=X.familiesBySource[this.source];for(var ln in yn){var Qt=G.layers[ln];if(Qt){Qt.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+ln+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var en=ot.encode(ln),Gr=[],Yr=0;Yr<Qt.length;Yr++){var li=Qt.feature(Yr),qr=pe.getId(li,ln);Gr.push({feature:li,id:qr,index:Yr,sourceLayerIndex:en})}for(var hi=0,Bi=yn[ln];hi<Bi.length;hi+=1){var ci=Bi[hi],_i=ci[0];_i.minzoom&&this.zoom<Math.floor(_i.minzoom)||_i.maxzoom&&this.zoom>=_i.maxzoom||_i.visibility!=="none"&&(oe(ci,this.zoom,ie),(re[_i.id]=_i.createBucket({index:pe.bucketLayerIDs.length,layers:ci,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:en,sourceID:this.source})).populate(Gr,br,this.tileID.canonical),pe.bucketLayerIDs.push(ci.map(function(bi){return bi.id})))}}}var xi=y.mapObject(br.glyphDependencies,function(bi){return Object.keys(bi).map(Number)});Object.keys(xi).length?we.send("getGlyphs",{uid:this.uid,stacks:xi},function(bi,fi){J||(J=bi,be=fi,aa.call(Ke))}):be={};var ao=Object.keys(br.iconDependencies);ao.length?we.send("getImages",{icons:ao,source:this.source,tileID:this.tileID,type:"icons"},function(bi,fi){J||(J=bi,lt=fi,aa.call(Ke))}):lt={};var Ui=Object.keys(br.patternDependencies);function aa(){if(J)return Oe(J);if(be&&lt&&dt){var bi=new ae(be),fi=new y.ImageAtlas(lt,dt);for(var vi in re){var fa=re[vi];fa instanceof y.SymbolBucket?(oe(fa.layers,this.zoom,ie),y.performSymbolLayout(fa,be,bi.positions,lt,fi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):fa.hasPattern&&(fa instanceof y.LineBucket||fa instanceof y.FillBucket||fa instanceof y.FillExtrusionBucket)&&(oe(fa.layers,this.zoom,ie),fa.addFeatures(br,this.tileID.canonical,fi.patternPositions))}this.status="done",Oe(null,{buckets:y.values(re).filter(function(ms){return!ms.isEmpty()}),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bi.image,imageAtlas:fi,glyphMap:this.returnDependencies?be:null,iconMap:this.returnDependencies?lt:null,glyphPositions:this.returnDependencies?bi.positions:null})}}Ui.length?we.send("getImages",{icons:Ui,source:this.source,tileID:this.tileID,type:"patterns"},function(bi,fi){J||(J=bi,dt=fi,aa.call(Ke))}):dt={},aa.call(this)};var rt=function(G,X,ie,we){this.actor=G,this.layerIndex=X,this.availableImages=ie,this.loadVectorData=we||je,this.loading={},this.loaded={}};rt.prototype.loadTile=function(G,X){var ie=this,we=G.uid;this.loading||(this.loading={});var Oe=!!(G&&G.request&&G.request.collectResourceTiming)&&new y.RequestPerformance(G.request),Ke=this.loading[we]=new Ge(G);Ke.abort=this.loadVectorData(G,function(ot,pe){if(delete ie.loading[we],ot||!pe)return Ke.status="done",ie.loaded[we]=Ke,X(ot);var J=pe.rawData,be={};pe.expires&&(be.expires=pe.expires),pe.cacheControl&&(be.cacheControl=pe.cacheControl);var lt={};if(Oe){var dt=Oe.finish();dt&&(lt.resourceTiming=JSON.parse(JSON.stringify(dt)))}Ke.vectorTile=pe.vectorTile,Ke.parse(pe.vectorTile,ie.layerIndex,ie.availableImages,ie.actor,function(re,br){if(re||!br)return X(re);X(null,y.extend({rawTileData:J.slice(0)},br,be,lt))}),ie.loaded=ie.loaded||{},ie.loaded[we]=Ke})},rt.prototype.reloadTile=function(G,X){var ie=this,we=this.loaded,Oe=G.uid,Ke=this;if(we&&we[Oe]){var ot=we[Oe];ot.showCollisionBoxes=G.showCollisionBoxes;var pe=function(J,be){var lt=ot.reloadCallback;lt&&(delete ot.reloadCallback,ot.parse(ot.vectorTile,Ke.layerIndex,ie.availableImages,Ke.actor,lt)),X(J,be)};ot.status==="parsing"?ot.reloadCallback=pe:ot.status==="done"&&(ot.vectorTile?ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor,pe):pe())}},rt.prototype.abortTile=function(G,X){var ie=this.loading,we=G.uid;ie&&ie[we]&&ie[we].abort&&(ie[we].abort(),delete ie[we]),X()},rt.prototype.removeTile=function(G,X){var ie=this.loaded,we=G.uid;ie&&ie[we]&&delete ie[we],X()};var ct=y.window.ImageBitmap,Pt=function(){this.loaded={}};function er(G,X){if(G.length!==0){qt(G[0],X);for(var ie=1;ie<G.length;ie++)qt(G[ie],!X)}}function qt(G,X){for(var ie=0,we=0,Oe=0,Ke=G.length,ot=Ke-1;Oe<Ke;ot=Oe++){var pe=(G[Oe][0]-G[ot][0])*(G[ot][1]+G[Oe][1]),J=ie+pe;we+=Math.abs(ie)>=Math.abs(pe)?ie-J+pe:pe-J+ie,ie=J}ie+we>=0!=!!X&&G.reverse()}Pt.prototype.loadTile=function(G,X){var ie=G.uid,we=G.encoding,Oe=G.rawImageData,Ke=ct&&Oe instanceof ct?this.getImageData(Oe):Oe,ot=new y.DEMData(ie,Ke,we);this.loaded=this.loaded||{},this.loaded[ie]=ot,X(null,ot)},Pt.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var X=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:X.width,height:X.height},X.data)},Pt.prototype.removeTile=function(G){var X=this.loaded,ie=G.uid;X&&X[ie]&&delete X[ie]};var ir=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,tr=function(G){this._feature=G,this.extent=y.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};tr.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],X=0,ie=this._feature.geometry;X<ie.length;X+=1){var we=ie[X];G.push([new y.Point$1(we[0],we[1])])}return G}for(var Oe=[],Ke=0,ot=this._feature.geometry;Ke<ot.length;Ke+=1){for(var pe=[],J=0,be=ot[Ke];J<be.length;J+=1){var lt=be[J];pe.push(new y.Point$1(lt[0],lt[1]))}Oe.push(pe)}return Oe},tr.prototype.toGeoJSON=function(G,X,ie){return ir.call(this,G,X,ie)};var Ct=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=G.length,this._features=G};Ct.prototype.feature=function(G){return new tr(this._features[G])};var yt=y.vectorTile.VectorTileFeature,Fr=mr;function mr(G,X){this.options=X||{},this.features=G,this.length=G.length}function lr(G,X){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=X||4096}mr.prototype.feature=function(G){return new lr(this.features[G],this.options.extent)},lr.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var X=0;X<G.length;X++){for(var ie=G[X],we=[],Oe=0;Oe<ie.length;Oe++)we.push(new y.Point$1(ie[Oe][0],ie[Oe][1]));this.geometry.push(we)}return this.geometry},lr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,X=1/0,ie=-1/0,we=1/0,Oe=-1/0,Ke=0;Ke<G.length;Ke++)for(var ot=G[Ke],pe=0;pe<ot.length;pe++){var J=ot[pe];X=Math.min(X,J.x),ie=Math.max(ie,J.x),we=Math.min(we,J.y),Oe=Math.max(Oe,J.y)}return[X,we,ie,Oe]},lr.prototype.toGeoJSON=yt.prototype.toGeoJSON;var xt=Rt,at=Fr;function Rt(G){var X=new y.pbf;return function(ie,we){for(var Oe in ie.layers)we.writeMessage(3,ft,ie.layers[Oe])}(G,X),X.finish()}function ft(G,X){var ie;X.writeVarintField(15,G.version||1),X.writeStringField(1,G.name||""),X.writeVarintField(5,G.extent||4096);var we={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<G.length;ie++)we.feature=G.feature(ie),X.writeMessage(2,Kt,we);var Oe=we.keys;for(ie=0;ie<Oe.length;ie++)X.writeStringField(3,Oe[ie]);var Ke=we.values;for(ie=0;ie<Ke.length;ie++)X.writeMessage(4,ke,Ke[ie])}function Kt(G,X){var ie=G.feature;ie.id!==void 0&&X.writeVarintField(1,ie.id),X.writeMessage(2,xr,G),X.writeVarintField(3,ie.type),X.writeMessage(4,O,ie)}function xr(G,X){var ie=G.feature,we=G.keys,Oe=G.values,Ke=G.keycache,ot=G.valuecache;for(var pe in ie.properties){var J=Ke[pe];J===void 0&&(we.push(pe),Ke[pe]=J=we.length-1),X.writeVarint(J);var be=ie.properties[pe],lt=typeof be;lt!=="string"&&lt!=="boolean"&&lt!=="number"&&(be=JSON.stringify(be));var dt=lt+":"+be,re=ot[dt];re===void 0&&(Oe.push(be),ot[dt]=re=Oe.length-1),X.writeVarint(re)}}function Y(G,X){return(X<<3)+(7&G)}function Le(G){return G<<1^G>>31}function O(G,X){for(var ie=G.loadGeometry(),we=G.type,Oe=0,Ke=0,ot=ie.length,pe=0;pe<ot;pe++){var J=ie[pe],be=1;we===1&&(be=J.length),X.writeVarint(Y(1,be));for(var lt=we===3?J.length-1:J.length,dt=0;dt<lt;dt++){dt===1&&we!==1&&X.writeVarint(Y(2,lt-1));var re=J[dt].x-Oe,br=J[dt].y-Ke;X.writeVarint(Le(re)),X.writeVarint(Le(br)),Oe+=re,Ke+=br}we===3&&X.writeVarint(Y(7,1))}}function ke(G,X){var ie=typeof G;ie==="string"?X.writeStringField(1,G):ie==="boolean"?X.writeBooleanField(7,G):ie==="number"&&(G%1!=0?X.writeDoubleField(3,G):G<0?X.writeSVarintField(6,G):X.writeVarintField(5,G))}function Ae(G,X,ie,we){st(G,ie,we),st(X,2*ie,2*we),st(X,2*ie+1,2*we+1)}function st(G,X,ie){var we=G[X];G[X]=G[ie],G[ie]=we}function _t(G,X,ie,we){var Oe=G-ie,Ke=X-we;return Oe*Oe+Ke*Ke}xt.fromVectorTileJs=Rt,xt.fromGeojsonVt=function(G,X){X=X||{};var ie={};for(var we in G)ie[we]=new Fr(G[we].features,X),ie[we].name=we,ie[we].version=X.version,ie[we].extent=X.extent;return Rt({layers:ie})},xt.GeoJSONWrapper=at;var bt=function(G){return G[0]},Ht=function(G){return G[1]},nr=function(G,X,ie,we,Oe){X===void 0&&(X=bt),ie===void 0&&(ie=Ht),we===void 0&&(we=64),Oe===void 0&&(Oe=Float64Array),this.nodeSize=we,this.points=G;for(var Ke=G.length<65536?Uint16Array:Uint32Array,ot=this.ids=new Ke(G.length),pe=this.coords=new Oe(2*G.length),J=0;J<G.length;J++)ot[J]=J,pe[2*J]=X(G[J]),pe[2*J+1]=ie(G[J]);(function be(lt,dt,re,br,yn,ln){if(!(yn-br<=re)){var Qt=br+yn>>1;(function en(Gr,Yr,li,qr,hi,Bi){for(;hi>qr;){if(hi-qr>600){var ci=hi-qr+1,_i=li-qr+1,xi=Math.log(ci),ao=.5*Math.exp(2*xi/3),Ui=.5*Math.sqrt(xi*ao*(ci-ao)/ci)*(_i-ci/2<0?-1:1);en(Gr,Yr,li,Math.max(qr,Math.floor(li-_i*ao/ci+Ui)),Math.min(hi,Math.floor(li+(ci-_i)*ao/ci+Ui)),Bi)}var aa=Yr[2*li+Bi],bi=qr,fi=hi;for(Ae(Gr,Yr,qr,li),Yr[2*hi+Bi]>aa&&Ae(Gr,Yr,qr,hi);bi<fi;){for(Ae(Gr,Yr,bi,fi),bi++,fi--;Yr[2*bi+Bi]<aa;)bi++;for(;Yr[2*fi+Bi]>aa;)fi--}Yr[2*qr+Bi]===aa?Ae(Gr,Yr,qr,fi):Ae(Gr,Yr,++fi,hi),fi<=li&&(qr=fi+1),li<=fi&&(hi=fi-1)}})(lt,dt,Qt,br,yn,ln%2),be(lt,dt,re,br,Qt-1,ln+1),be(lt,dt,re,Qt+1,yn,ln+1)}})(ot,pe,we,0,ot.length-1,0)};nr.prototype.range=function(G,X,ie,we){return function(Oe,Ke,ot,pe,J,be,lt){for(var dt,re,br=[0,Oe.length-1,0],yn=[];br.length;){var ln=br.pop(),Qt=br.pop(),en=br.pop();if(Qt-en<=lt)for(var Gr=en;Gr<=Qt;Gr++)re=Ke[2*Gr+1],(dt=Ke[2*Gr])>=ot&&dt<=J&&re>=pe&&re<=be&&yn.push(Oe[Gr]);else{var Yr=Math.floor((en+Qt)/2);re=Ke[2*Yr+1],(dt=Ke[2*Yr])>=ot&&dt<=J&&re>=pe&&re<=be&&yn.push(Oe[Yr]);var li=(ln+1)%2;(ln===0?ot<=dt:pe<=re)&&(br.push(en),br.push(Yr-1),br.push(li)),(ln===0?J>=dt:be>=re)&&(br.push(Yr+1),br.push(Qt),br.push(li))}}return yn}(this.ids,this.coords,G,X,ie,we,this.nodeSize)},nr.prototype.within=function(G,X,ie){return function(we,Oe,Ke,ot,pe,J){for(var be=[0,we.length-1,0],lt=[],dt=pe*pe;be.length;){var re=be.pop(),br=be.pop(),yn=be.pop();if(br-yn<=J)for(var ln=yn;ln<=br;ln++)_t(Oe[2*ln],Oe[2*ln+1],Ke,ot)<=dt&&lt.push(we[ln]);else{var Qt=Math.floor((yn+br)/2),en=Oe[2*Qt],Gr=Oe[2*Qt+1];_t(en,Gr,Ke,ot)<=dt&&lt.push(we[Qt]);var Yr=(re+1)%2;(re===0?Ke-pe<=en:ot-pe<=Gr)&&(be.push(yn),be.push(Qt-1),be.push(Yr)),(re===0?Ke+pe>=en:ot+pe>=Gr)&&(be.push(Qt+1),be.push(br),be.push(Yr))}}return lt}(this.ids,this.coords,G,X,ie,this.nodeSize)};var Qr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},Lr=function(G){this.options=Ai(Object.create(Qr),G),this.trees=new Array(this.options.maxZoom+1)};function jn(G,X,ie,we,Oe){return{x:G,y:X,zoom:1/0,id:ie,parentId:-1,numPoints:we,properties:Oe}}function tn(G,X){var ie=G.geometry.coordinates,we=ie[1];return{x:Xn(ie[0]),y:vn(we),zoom:1/0,index:X,parentId:-1}}function Cn(G){return{type:"Feature",id:G.id,properties:si(G),geometry:{type:"Point",coordinates:[(we=G.x,360*(we-.5)),(X=G.y,ie=(180-360*X)*Math.PI/180,360*Math.atan(Math.exp(ie))/Math.PI-90)]}};var X,ie,we}function si(G){var X=G.numPoints,ie=X>=1e4?Math.round(X/1e3)+"k":X>=1e3?Math.round(X/100)/10+"k":X;return Ai(Ai({},G.properties),{cluster:!0,cluster_id:G.id,point_count:X,point_count_abbreviated:ie})}function Xn(G){return G/360+.5}function vn(G){var X=Math.sin(G*Math.PI/180),ie=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ie<0?0:ie>1?1:ie}function Ai(G,X){for(var ie in X)G[ie]=X[ie];return G}function Ii(G){return G.x}function Ti(G){return G.y}function Gn(G,X,ie,we,Oe,Ke){var ot=Oe-ie,pe=Ke-we;if(ot!==0||pe!==0){var J=((G-ie)*ot+(X-we)*pe)/(ot*ot+pe*pe);J>1?(ie=Oe,we=Ke):J>0&&(ie+=ot*J,we+=pe*J)}return(ot=G-ie)*ot+(pe=X-we)*pe}function Dn(G,X,ie,we){var Oe={id:G===void 0?null:G,type:X,geometry:ie,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ke){var ot=Ke.geometry,pe=Ke.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")ho(Ke,ot);else if(pe==="Polygon"||pe==="MultiLineString")for(var J=0;J<ot.length;J++)ho(Ke,ot[J]);else if(pe==="MultiPolygon")for(J=0;J<ot.length;J++)for(var be=0;be<ot[J].length;be++)ho(Ke,ot[J][be])}(Oe),Oe}function ho(G,X){for(var ie=0;ie<X.length;ie+=3)G.minX=Math.min(G.minX,X[ie]),G.minY=Math.min(G.minY,X[ie+1]),G.maxX=Math.max(G.maxX,X[ie]),G.maxY=Math.max(G.maxY,X[ie+1])}function Hi(G,X,ie,we){if(X.geometry){var Oe=X.geometry.coordinates,Ke=X.geometry.type,ot=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2),pe=[],J=X.id;if(ie.promoteId?J=X.properties[ie.promoteId]:ie.generateId&&(J=we||0),Ke==="Point")Ya(Oe,pe);else if(Ke==="MultiPoint")for(var be=0;be<Oe.length;be++)Ya(Oe[be],pe);else if(Ke==="LineString")kt(Oe,pe,ot,!1);else if(Ke==="MultiLineString"){if(ie.lineMetrics){for(be=0;be<Oe.length;be++)kt(Oe[be],pe=[],ot,!1),G.push(Dn(J,"LineString",pe,X.properties));return}L(Oe,pe,ot,!1)}else if(Ke==="Polygon")L(Oe,pe,ot,!0);else{if(Ke!=="MultiPolygon"){if(Ke==="GeometryCollection"){for(be=0;be<X.geometry.geometries.length;be++)Hi(G,{id:J,geometry:X.geometry.geometries[be],properties:X.properties},ie,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(be=0;be<Oe.length;be++){var lt=[];L(Oe[be],lt,ot,!0),pe.push(lt)}}G.push(Dn(J,Ke,pe,X.properties))}}function Ya(G,X){X.push(ne(G[0])),X.push(fe(G[1])),X.push(0)}function kt(G,X,ie,we){for(var Oe,Ke,ot=0,pe=0;pe<G.length;pe++){var J=ne(G[pe][0]),be=fe(G[pe][1]);X.push(J),X.push(be),X.push(0),pe>0&&(ot+=we?(Oe*be-J*Ke)/2:Math.sqrt(Math.pow(J-Oe,2)+Math.pow(be-Ke,2))),Oe=J,Ke=be}var lt=X.length-3;X[2]=1,function dt(re,br,yn,ln){for(var Qt,en=ln,Gr=yn-br>>1,Yr=yn-br,li=re[br],qr=re[br+1],hi=re[yn],Bi=re[yn+1],ci=br+3;ci<yn;ci+=3){var _i=Gn(re[ci],re[ci+1],li,qr,hi,Bi);if(_i>en)Qt=ci,en=_i;else if(_i===en){var xi=Math.abs(ci-Gr);xi<Yr&&(Qt=ci,Yr=xi)}}en>ln&&(Qt-br>3&&dt(re,br,Qt,ln),re[Qt+2]=en,yn-Qt>3&&dt(re,Qt,yn,ln))}(X,0,lt,ie),X[lt+2]=1,X.size=Math.abs(ot),X.start=0,X.end=X.size}function L(G,X,ie,we){for(var Oe=0;Oe<G.length;Oe++){var Ke=[];kt(G[Oe],Ke,ie,we),X.push(Ke)}}function ne(G){return G/360+.5}function fe(G){var X=Math.sin(G*Math.PI/180),ie=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ie<0?0:ie>1?1:ie}function Ze(G,X,ie,we,Oe,Ke,ot,pe){if(we/=X,Ke>=(ie/=X)&&ot<we)return G;if(ot<ie||Ke>=we)return null;for(var J=[],be=0;be<G.length;be++){var lt=G[be],dt=lt.geometry,re=lt.type,br=Oe===0?lt.minX:lt.minY,yn=Oe===0?lt.maxX:lt.maxY;if(br>=ie&&yn<we)J.push(lt);else if(!(yn<ie||br>=we)){var ln=[];if(re==="Point"||re==="MultiPoint")pt(dt,ln,ie,we,Oe);else if(re==="LineString")Wt(dt,ln,ie,we,Oe,!1,pe.lineMetrics);else if(re==="MultiLineString")Ve(dt,ln,ie,we,Oe,!1);else if(re==="Polygon")Ve(dt,ln,ie,we,Oe,!0);else if(re==="MultiPolygon")for(var Qt=0;Qt<dt.length;Qt++){var en=[];Ve(dt[Qt],en,ie,we,Oe,!0),en.length&&ln.push(en)}if(ln.length){if(pe.lineMetrics&&re==="LineString"){for(Qt=0;Qt<ln.length;Qt++)J.push(Dn(lt.id,re,ln[Qt],lt.tags));continue}re!=="LineString"&&re!=="MultiLineString"||(ln.length===1?(re="LineString",ln=ln[0]):re="MultiLineString"),re!=="Point"&&re!=="MultiPoint"||(re=ln.length===3?"Point":"MultiPoint"),J.push(Dn(lt.id,re,ln,lt.tags))}}}return J.length?J:null}function pt(G,X,ie,we,Oe){for(var Ke=0;Ke<G.length;Ke+=3){var ot=G[Ke+Oe];ot>=ie&&ot<=we&&(X.push(G[Ke]),X.push(G[Ke+1]),X.push(G[Ke+2]))}}function Wt(G,X,ie,we,Oe,Ke,ot){for(var pe,J,be=Ar(G),lt=Oe===0?ar:Er,dt=G.start,re=0;re<G.length-3;re+=3){var br=G[re],yn=G[re+1],ln=G[re+2],Qt=G[re+3],en=G[re+4],Gr=Oe===0?br:yn,Yr=Oe===0?Qt:en,li=!1;ot&&(pe=Math.sqrt(Math.pow(br-Qt,2)+Math.pow(yn-en,2))),Gr<ie?Yr>ie&&(J=lt(be,br,yn,Qt,en,ie),ot&&(be.start=dt+pe*J)):Gr>we?Yr<we&&(J=lt(be,br,yn,Qt,en,we),ot&&(be.start=dt+pe*J)):Tt(be,br,yn,ln),Yr<ie&&Gr>=ie&&(J=lt(be,br,yn,Qt,en,ie),li=!0),Yr>we&&Gr<=we&&(J=lt(be,br,yn,Qt,en,we),li=!0),!Ke&&li&&(ot&&(be.end=dt+pe*J),X.push(be),be=Ar(G)),ot&&(dt+=pe)}var qr=G.length-3;br=G[qr],yn=G[qr+1],ln=G[qr+2],(Gr=Oe===0?br:yn)>=ie&&Gr<=we&&Tt(be,br,yn,ln),qr=be.length-3,Ke&&qr>=3&&(be[qr]!==be[0]||be[qr+1]!==be[1])&&Tt(be,be[0],be[1],be[2]),be.length&&X.push(be)}function Ar(G){var X=[];return X.size=G.size,X.start=G.start,X.end=G.end,X}function Ve(G,X,ie,we,Oe,Ke){for(var ot=0;ot<G.length;ot++)Wt(G[ot],X,ie,we,Oe,Ke,!1)}function Tt(G,X,ie,we){G.push(X),G.push(ie),G.push(we)}function ar(G,X,ie,we,Oe,Ke){var ot=(Ke-X)/(we-X);return G.push(Ke),G.push(ie+(Oe-ie)*ot),G.push(1),ot}function Er(G,X,ie,we,Oe,Ke){var ot=(Ke-ie)/(Oe-ie);return G.push(X+(we-X)*ot),G.push(Ke),G.push(1),ot}function Wr(G,X){for(var ie=[],we=0;we<G.length;we++){var Oe,Ke=G[we],ot=Ke.type;if(ot==="Point"||ot==="MultiPoint"||ot==="LineString")Oe=mn(Ke.geometry,X);else if(ot==="MultiLineString"||ot==="Polygon"){Oe=[];for(var pe=0;pe<Ke.geometry.length;pe++)Oe.push(mn(Ke.geometry[pe],X))}else if(ot==="MultiPolygon")for(Oe=[],pe=0;pe<Ke.geometry.length;pe++){for(var J=[],be=0;be<Ke.geometry[pe].length;be++)J.push(mn(Ke.geometry[pe][be],X));Oe.push(J)}ie.push(Dn(Ke.id,ot,Oe,Ke.tags))}return ie}function mn(G,X){var ie=[];ie.size=G.size,G.start!==void 0&&(ie.start=G.start,ie.end=G.end);for(var we=0;we<G.length;we+=3)ie.push(G[we]+X,G[we+1],G[we+2]);return ie}function wn(G,X){if(G.transformed)return G;var ie,we,Oe,Ke=1<<G.z,ot=G.x,pe=G.y;for(ie=0;ie<G.features.length;ie++){var J=G.features[ie],be=J.geometry,lt=J.type;if(J.geometry=[],lt===1)for(we=0;we<be.length;we+=2)J.geometry.push(gn(be[we],be[we+1],X,Ke,ot,pe));else for(we=0;we<be.length;we++){var dt=[];for(Oe=0;Oe<be[we].length;Oe+=2)dt.push(gn(be[we][Oe],be[we][Oe+1],X,Ke,ot,pe));J.geometry.push(dt)}}return G.transformed=!0,G}function gn(G,X,ie,we,Oe,Ke){return[Math.round(ie*(G*we-Oe)),Math.round(ie*(X*we-Ke))]}function xn(G,X,ie,we,Oe){for(var Ke=X===Oe.maxZoom?0:Oe.tolerance/((1<<X)*Oe.extent),ot={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ie,y:we,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<G.length;pe++){ot.numFeatures++,ri(ot,G[pe],Ke,Oe);var J=G[pe].minX,be=G[pe].minY,lt=G[pe].maxX,dt=G[pe].maxY;J<ot.minX&&(ot.minX=J),be<ot.minY&&(ot.minY=be),lt>ot.maxX&&(ot.maxX=lt),dt>ot.maxY&&(ot.maxY=dt)}return ot}function ri(G,X,ie,we){var Oe=X.geometry,Ke=X.type,ot=[];if(Ke==="Point"||Ke==="MultiPoint")for(var pe=0;pe<Oe.length;pe+=3)ot.push(Oe[pe]),ot.push(Oe[pe+1]),G.numPoints++,G.numSimplified++;else if(Ke==="LineString")Jn(ot,Oe,G,ie,!1,!1);else if(Ke==="MultiLineString"||Ke==="Polygon")for(pe=0;pe<Oe.length;pe++)Jn(ot,Oe[pe],G,ie,Ke==="Polygon",pe===0);else if(Ke==="MultiPolygon")for(var J=0;J<Oe.length;J++){var be=Oe[J];for(pe=0;pe<be.length;pe++)Jn(ot,be[pe],G,ie,!0,pe===0)}if(ot.length){var lt=X.tags||null;if(Ke==="LineString"&&we.lineMetrics){for(var dt in lt={},X.tags)lt[dt]=X.tags[dt];lt.mapbox_clip_start=Oe.start/Oe.size,lt.mapbox_clip_end=Oe.end/Oe.size}var re={geometry:ot,type:Ke==="Polygon"||Ke==="MultiPolygon"?3:Ke==="LineString"||Ke==="MultiLineString"?2:1,tags:lt};X.id!==null&&(re.id=X.id),G.features.push(re)}}function Jn(G,X,ie,we,Oe,Ke){var ot=we*we;if(we>0&&X.size<(Oe?ot:we))ie.numPoints+=X.length/3;else{for(var pe=[],J=0;J<X.length;J+=3)(we===0||X[J+2]>ot)&&(ie.numSimplified++,pe.push(X[J]),pe.push(X[J+1])),ie.numPoints++;Oe&&function(be,lt){for(var dt=0,re=0,br=be.length,yn=br-2;re<br;yn=re,re+=2)dt+=(be[re]-be[yn])*(be[re+1]+be[yn+1]);if(dt>0===lt)for(re=0,br=be.length;re<br/2;re+=2){var ln=be[re],Qt=be[re+1];be[re]=be[br-2-re],be[re+1]=be[br-1-re],be[br-2-re]=ln,be[br-1-re]=Qt}}(pe,Ke),G.push(pe)}}function Wi(G,X){var ie=(X=this.options=function(Oe,Ke){for(var ot in Ke)Oe[ot]=Ke[ot];return Oe}(Object.create(this.options),X)).debug;if(ie&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var we=function(Oe,Ke){var ot=[];if(Oe.type==="FeatureCollection")for(var pe=0;pe<Oe.features.length;pe++)Hi(ot,Oe.features[pe],Ke,pe);else Hi(ot,Oe.type==="Feature"?Oe:{geometry:Oe},Ke);return ot}(G,X);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(we=function(Oe,Ke){var ot=Ke.buffer/Ke.extent,pe=Oe,J=Ze(Oe,1,-1-ot,ot,0,-1,2,Ke),be=Ze(Oe,1,1-ot,2+ot,0,-1,2,Ke);return(J||be)&&(pe=Ze(Oe,1,-ot,1+ot,0,-1,2,Ke)||[],J&&(pe=Wr(J,1).concat(pe)),be&&(pe=pe.concat(Wr(be,-1)))),pe}(we,X)).length&&this.splitTile(we,0,0,0),ie&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $i(G,X,ie){return 32*((1<<G)*ie+X)+G}function po(G,X){var ie=G.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);var we=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!we)return X(null,null);var Oe=new Ct(we.features),Ke=xt(Oe);Ke.byteOffset===0&&Ke.byteLength===Ke.buffer.byteLength||(Ke=new Uint8Array(Ke)),X(null,{vectorTile:Oe,rawData:Ke.buffer})}Lr.prototype.load=function(G){var X=this.options,ie=X.log,we=X.minZoom,Oe=X.maxZoom,Ke=X.nodeSize;ie&&console.time("total time");var ot="prepare "+G.length+" points";ie&&console.time(ot),this.points=G;for(var pe=[],J=0;J<G.length;J++)G[J].geometry&&pe.push(tn(G[J],J));this.trees[Oe+1]=new nr(pe,Ii,Ti,Ke,Float32Array),ie&&console.timeEnd(ot);for(var be=Oe;be>=we;be--){var lt=+Date.now();pe=this._cluster(pe,be),this.trees[be]=new nr(pe,Ii,Ti,Ke,Float32Array),ie&&console.log("z%d: %d clusters in %dms",be,pe.length,+Date.now()-lt)}return ie&&console.timeEnd("total time"),this},Lr.prototype.getClusters=function(G,X){var ie=((G[0]+180)%360+360)%360-180,we=Math.max(-90,Math.min(90,G[1])),Oe=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ke=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ie=-180,Oe=180;else if(ie>Oe){var ot=this.getClusters([ie,we,180,Ke],X),pe=this.getClusters([-180,we,Oe,Ke],X);return ot.concat(pe)}for(var J=this.trees[this._limitZoom(X)],be=[],lt=0,dt=J.range(Xn(ie),vn(Ke),Xn(Oe),vn(we));lt<dt.length;lt+=1){var re=J.points[dt[lt]];be.push(re.numPoints?Cn(re):this.points[re.index])}return be},Lr.prototype.getChildren=function(G){var X=this._getOriginId(G),ie=this._getOriginZoom(G),we="No cluster with the specified id.",Oe=this.trees[ie];if(!Oe)throw new Error(we);var Ke=Oe.points[X];if(!Ke)throw new Error(we);for(var ot=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),pe=[],J=0,be=Oe.within(Ke.x,Ke.y,ot);J<be.length;J+=1){var lt=Oe.points[be[J]];lt.parentId===G&&pe.push(lt.numPoints?Cn(lt):this.points[lt.index])}if(pe.length===0)throw new Error(we);return pe},Lr.prototype.getLeaves=function(G,X,ie){var we=[];return this._appendLeaves(we,G,X=X||10,ie=ie||0,0),we},Lr.prototype.getTile=function(G,X,ie){var we=this.trees[this._limitZoom(G)],Oe=Math.pow(2,G),Ke=this.options,ot=Ke.radius/Ke.extent,pe=(ie-ot)/Oe,J=(ie+1+ot)/Oe,be={features:[]};return this._addTileFeatures(we.range((X-ot)/Oe,pe,(X+1+ot)/Oe,J),we.points,X,ie,Oe,be),X===0&&this._addTileFeatures(we.range(1-ot/Oe,pe,1,J),we.points,Oe,ie,Oe,be),X===Oe-1&&this._addTileFeatures(we.range(0,pe,ot/Oe,J),we.points,-1,ie,Oe,be),be.features.length?be:null},Lr.prototype.getClusterExpansionZoom=function(G){for(var X=this._getOriginZoom(G)-1;X<=this.options.maxZoom;){var ie=this.getChildren(G);if(X++,ie.length!==1)break;G=ie[0].properties.cluster_id}return X},Lr.prototype._appendLeaves=function(G,X,ie,we,Oe){for(var Ke=0,ot=this.getChildren(X);Ke<ot.length;Ke+=1){var pe=ot[Ke],J=pe.properties;if(J&&J.cluster?Oe+J.point_count<=we?Oe+=J.point_count:Oe=this._appendLeaves(G,J.cluster_id,ie,we,Oe):Oe<we?Oe++:G.push(pe),G.length===ie)break}return Oe},Lr.prototype._addTileFeatures=function(G,X,ie,we,Oe,Ke){for(var ot=0,pe=G;ot<pe.length;ot+=1){var J=X[pe[ot]],be=J.numPoints,lt={type:1,geometry:[[Math.round(this.options.extent*(J.x*Oe-ie)),Math.round(this.options.extent*(J.y*Oe-we))]],tags:be?si(J):this.points[J.index].properties},dt=void 0;be?dt=J.id:this.options.generateId?dt=J.index:this.points[J.index].id&&(dt=this.points[J.index].id),dt!==void 0&&(lt.id=dt),Ke.features.push(lt)}},Lr.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},Lr.prototype._cluster=function(G,X){for(var ie=[],we=this.options,Oe=we.reduce,Ke=we.minPoints,ot=we.radius/(we.extent*Math.pow(2,X)),pe=0;pe<G.length;pe++){var J=G[pe];if(!(J.zoom<=X)){J.zoom=X;for(var be=this.trees[X+1],lt=be.within(J.x,J.y,ot),dt=J.numPoints||1,re=dt,br=0,yn=lt;br<yn.length;br+=1){var ln=be.points[yn[br]];ln.zoom>X&&(re+=ln.numPoints||1)}if(re>=Ke){for(var Qt=J.x*dt,en=J.y*dt,Gr=Oe&&dt>1?this._map(J,!0):null,Yr=(pe<<5)+(X+1)+this.points.length,li=0,qr=lt;li<qr.length;li+=1){var hi=be.points[qr[li]];if(!(hi.zoom<=X)){hi.zoom=X;var Bi=hi.numPoints||1;Qt+=hi.x*Bi,en+=hi.y*Bi,hi.parentId=Yr,Oe&&(Gr||(Gr=this._map(J,!0)),Oe(Gr,this._map(hi)))}}J.parentId=Yr,ie.push(jn(Qt/re,en/re,Yr,re,Gr))}else if(ie.push(J),re>1)for(var ci=0,_i=lt;ci<_i.length;ci+=1){var xi=be.points[_i[ci]];xi.zoom<=X||(xi.zoom=X,ie.push(xi))}}}return ie},Lr.prototype._getOriginId=function(G){return G-this.points.length>>5},Lr.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},Lr.prototype._map=function(G,X){if(G.numPoints)return X?Ai({},G.properties):G.properties;var ie=this.points[G.index].properties,we=this.options.map(ie);return X&&we===ie?Ai({},we):we},Wi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wi.prototype.splitTile=function(G,X,ie,we,Oe,Ke,ot){for(var pe=[G,X,ie,we],J=this.options,be=J.debug;pe.length;){we=pe.pop(),ie=pe.pop(),X=pe.pop(),G=pe.pop();var lt=1<<X,dt=$i(X,ie,we),re=this.tiles[dt];if(!re&&(be>1&&console.time("creation"),re=this.tiles[dt]=xn(G,X,ie,we,J),this.tileCoords.push({z:X,x:ie,y:we}),be)){be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,ie,we,re.numFeatures,re.numPoints,re.numSimplified),console.timeEnd("creation"));var br="z"+X;this.stats[br]=(this.stats[br]||0)+1,this.total++}if(re.source=G,Oe){if(X===J.maxZoom||X===Oe)continue;var yn=1<<Oe-X;if(ie!==Math.floor(Ke/yn)||we!==Math.floor(ot/yn))continue}else if(X===J.indexMaxZoom||re.numPoints<=J.indexMaxPoints)continue;if(re.source=null,G.length!==0){be>1&&console.time("clipping");var ln,Qt,en,Gr,Yr,li,qr=.5*J.buffer/J.extent,hi=.5-qr,Bi=.5+qr,ci=1+qr;ln=Qt=en=Gr=null,Yr=Ze(G,lt,ie-qr,ie+Bi,0,re.minX,re.maxX,J),li=Ze(G,lt,ie+hi,ie+ci,0,re.minX,re.maxX,J),G=null,Yr&&(ln=Ze(Yr,lt,we-qr,we+Bi,1,re.minY,re.maxY,J),Qt=Ze(Yr,lt,we+hi,we+ci,1,re.minY,re.maxY,J),Yr=null),li&&(en=Ze(li,lt,we-qr,we+Bi,1,re.minY,re.maxY,J),Gr=Ze(li,lt,we+hi,we+ci,1,re.minY,re.maxY,J),li=null),be>1&&console.timeEnd("clipping"),pe.push(ln||[],X+1,2*ie,2*we),pe.push(Qt||[],X+1,2*ie,2*we+1),pe.push(en||[],X+1,2*ie+1,2*we),pe.push(Gr||[],X+1,2*ie+1,2*we+1)}}},Wi.prototype.getTile=function(G,X,ie){var we=this.options,Oe=we.extent,Ke=we.debug;if(G<0||G>24)return null;var ot=1<<G,pe=$i(G,X=(X%ot+ot)%ot,ie);if(this.tiles[pe])return wn(this.tiles[pe],Oe);Ke>1&&console.log("drilling down to z%d-%d-%d",G,X,ie);for(var J,be=G,lt=X,dt=ie;!J&&be>0;)be--,lt=Math.floor(lt/2),dt=Math.floor(dt/2),J=this.tiles[$i(be,lt,dt)];return J&&J.source?(Ke>1&&console.log("found parent tile z%d-%d-%d",be,lt,dt),Ke>1&&console.time("drilling down"),this.splitTile(J.source,be,lt,dt,G,X,ie),Ke>1&&console.timeEnd("drilling down"),this.tiles[pe]?wn(this.tiles[pe],Oe):null):null};var $o=function(G){function X(ie,we,Oe,Ke){G.call(this,ie,we,Oe,po),Ke&&(this.loadGeoJSON=Ke)}return G&&(X.__proto__=G),(X.prototype=Object.create(G&&G.prototype)).constructor=X,X.prototype.loadData=function(ie,we){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=we,this._pendingLoadDataParams=ie,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},X.prototype._loadData=function(){var ie=this;if(this._pendingCallback&&this._pendingLoadDataParams){var we=this._pendingCallback,Oe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ke=!!(Oe&&Oe.request&&Oe.request.collectResourceTiming)&&new y.RequestPerformance(Oe.request);this.loadGeoJSON(Oe,function(ot,pe){if(ot||!pe)return we(ot);if(typeof pe!="object")return we(new Error("Input data given to '"+Oe.source+"' is not a valid GeoJSON object."));(function re(br,yn){var ln,Qt=br&&br.type;if(Qt==="FeatureCollection")for(ln=0;ln<br.features.length;ln++)re(br.features[ln],yn);else if(Qt==="GeometryCollection")for(ln=0;ln<br.geometries.length;ln++)re(br.geometries[ln],yn);else if(Qt==="Feature")re(br.geometry,yn);else if(Qt==="Polygon")er(br.coordinates,yn);else if(Qt==="MultiPolygon")for(ln=0;ln<br.coordinates.length;ln++)er(br.coordinates[ln],yn);return br})(pe,!0);try{if(Oe.filter){var J=y.createExpression(Oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(J.result==="error")throw new Error(J.value.map(function(re){return re.key+": "+re.message}).join(", "));var be=pe.features.filter(function(re){return J.value.evaluate({zoom:0},re)});pe={type:"FeatureCollection",features:be}}ie._geoJSONIndex=Oe.cluster?new Lr(function(re){var br=re.superclusterOptions,yn=re.clusterProperties;if(!yn||!br)return br;for(var ln={},Qt={},en={accumulated:null,zoom:0},Gr={properties:null},Yr=Object.keys(yn),li=0,qr=Yr;li<qr.length;li+=1){var hi=qr[li],Bi=yn[hi],ci=Bi[0],_i=y.createExpression(Bi[1]),xi=y.createExpression(typeof ci=="string"?[ci,["accumulated"],["get",hi]]:ci);ln[hi]=_i.value,Qt[hi]=xi.value}return br.map=function(ao){Gr.properties=ao;for(var Ui={},aa=0,bi=Yr;aa<bi.length;aa+=1){var fi=bi[aa];Ui[fi]=ln[fi].evaluate(en,Gr)}return Ui},br.reduce=function(ao,Ui){Gr.properties=Ui;for(var aa=0,bi=Yr;aa<bi.length;aa+=1){var fi=bi[aa];en.accumulated=ao[fi],ao[fi]=Qt[fi].evaluate(en,Gr)}},br}(Oe)).load(pe.features):function(re,br){return new Wi(re,br)}(pe,Oe.geojsonVtOptions)}catch(re){return we(re)}ie.loaded={};var lt={};if(Ke){var dt=Ke.finish();dt&&(lt.resourceTiming={},lt.resourceTiming[Oe.source]=JSON.parse(JSON.stringify(dt)))}we(null,lt)})}},X.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},X.prototype.reloadTile=function(ie,we){var Oe=this.loaded;return Oe&&Oe[ie.uid]?G.prototype.reloadTile.call(this,ie,we):this.loadTile(ie,we)},X.prototype.loadGeoJSON=function(ie,we){if(ie.request)y.getJSON(ie.request,we);else{if(typeof ie.data!="string")return we(new Error("Input data given to '"+ie.source+"' is not a valid GeoJSON object."));try{return we(null,JSON.parse(ie.data))}catch(Oe){return we(new Error("Input data given to '"+ie.source+"' is not a valid GeoJSON object."))}}},X.prototype.removeSource=function(ie,we){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),we()},X.prototype.getClusterExpansionZoom=function(ie,we){try{we(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(Oe){we(Oe)}},X.prototype.getClusterChildren=function(ie,we){try{we(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(Oe){we(Oe)}},X.prototype.getClusterLeaves=function(ie,we){try{we(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(Oe){we(Oe)}},X}(rt),Xi=function(G){var X=this;this.self=G,this.actor=new y.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:rt,geojson:$o},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ie,we){if(X.workerSourceTypes[ie])throw new Error('Worker source with name "'+ie+'" already registered.');X.workerSourceTypes[ie]=we},this.self.registerRTLTextPlugin=function(ie){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=ie.applyArabicShaping,y.plugin.processBidirectionalText=ie.processBidirectionalText,y.plugin.processStyledBidirectionalText=ie.processStyledBidirectionalText}};return Xi.prototype.setReferrer=function(G,X){this.referrer=X},Xi.prototype.setImages=function(G,X,ie){for(var we in this.availableImages[G]=X,this.workerSources[G]){var Oe=this.workerSources[G][we];for(var Ke in Oe)Oe[Ke].availableImages=X}ie()},Xi.prototype.setLayers=function(G,X,ie){this.getLayerIndex(G).replace(X),ie()},Xi.prototype.updateLayers=function(G,X,ie){this.getLayerIndex(G).update(X.layers,X.removedIds),ie()},Xi.prototype.loadTile=function(G,X,ie){this.getWorkerSource(G,X.type,X.source).loadTile(X,ie)},Xi.prototype.loadDEMTile=function(G,X,ie){this.getDEMWorkerSource(G,X.source).loadTile(X,ie)},Xi.prototype.reloadTile=function(G,X,ie){this.getWorkerSource(G,X.type,X.source).reloadTile(X,ie)},Xi.prototype.abortTile=function(G,X,ie){this.getWorkerSource(G,X.type,X.source).abortTile(X,ie)},Xi.prototype.removeTile=function(G,X,ie){this.getWorkerSource(G,X.type,X.source).removeTile(X,ie)},Xi.prototype.removeDEMTile=function(G,X){this.getDEMWorkerSource(G,X.source).removeTile(X)},Xi.prototype.removeSource=function(G,X,ie){if(this.workerSources[G]&&this.workerSources[G][X.type]&&this.workerSources[G][X.type][X.source]){var we=this.workerSources[G][X.type][X.source];delete this.workerSources[G][X.type][X.source],we.removeSource!==void 0?we.removeSource(X,ie):ie()}},Xi.prototype.loadWorkerSource=function(G,X,ie){try{this.self.importScripts(X.url),ie()}catch(we){ie(we.toString())}},Xi.prototype.syncRTLPluginState=function(G,X,ie){try{y.plugin.setState(X);var we=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&we!=null){this.self.importScripts(we);var Oe=y.plugin.isParsed();ie(Oe?void 0:new Error("RTL Text Plugin failed to import scripts from "+we),Oe)}}catch(Ke){ie(Ke.toString())}},Xi.prototype.getAvailableImages=function(G){var X=this.availableImages[G];return X||(X=[]),X},Xi.prototype.getLayerIndex=function(G){var X=this.layerIndexes[G];return X||(X=this.layerIndexes[G]=new ce),X},Xi.prototype.getWorkerSource=function(G,X,ie){var we=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][X]||(this.workerSources[G][X]={}),this.workerSources[G][X][ie]||(this.workerSources[G][X][ie]=new this.workerSourceTypes[X]({send:function(Oe,Ke,ot){we.actor.send(Oe,Ke,ot,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][X][ie]},Xi.prototype.getDEMWorkerSource=function(G,X){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][X]||(this.demWorkerSources[G][X]=new Pt),this.demWorkerSources[G][X]},Xi.prototype.enforceCacheSizeLimit=function(G,X){y.enforceCacheSizeLimit(X)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Xi(self)),Xi}),Q(["./shared"],function(y){"use strict";var se=y.createCommonjsModule(function(f){function d(w){return!h(w)}function h(w){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,I,Z=new Blob([""],{type:"text/javascript"}),$=URL.createObjectURL(Z);try{I=new Worker($),T=!0}catch(le){T=!1}return I&&I.terminate(),URL.revokeObjectURL($),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var I=T.getContext("2d");if(!I)return!1;var Z=I.getImageData(0,0,1,1);return Z&&Z.width===T.width}()?(g[C=w&&w.failIfMajorPerformanceCaveat]===void 0&&(g[C]=function(T){var I=function($){var le=document.createElement("canvas"),ve=Object.create(d.webGLContextAttributes);return ve.failIfMajorPerformanceCaveat=$,le.probablySupportsContext?le.probablySupportsContext("webgl",ve)||le.probablySupportsContext("experimental-webgl",ve):le.supportsContext?le.supportsContext("webgl",ve)||le.supportsContext("experimental-webgl",ve):le.getContext("webgl",ve)||le.getContext("experimental-webgl",ve)}(T);if(!I)return!1;var Z=I.createShader(I.VERTEX_SHADER);return!(!Z||I.isContextLost())&&(I.shaderSource(Z,"void main() {}"),I.compileShader(Z),I.getShaderParameter(Z,I.COMPILE_STATUS)===!0)}(C)),g[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}f.exports?f.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var g={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),U={create:function(f,d,h){var g=y.window.document.createElement(f);return d!==void 0&&(g.className=d),h&&h.appendChild(g),g},createNS:function(f,d){return y.window.document.createElementNS(f,d)}},ce=y.window.document&&y.window.document.documentElement.style;function ae(f){if(!ce)return f[0];for(var d=0;d<f.length;d++)if(f[d]in ce)return f[d];return f[0]}var Ge,oe=ae(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);U.disableDrag=function(){ce&&oe&&(Ge=ce[oe],ce[oe]="none")},U.enableDrag=function(){ce&&oe&&(ce[oe]=Ge)};var je=ae(["transform","WebkitTransform"]);U.setTransform=function(f,d){f.style[je]=d};var rt=!1;try{var ct=Object.defineProperty({},"passive",{get:function(){rt=!0}});y.window.addEventListener("test",ct,ct),y.window.removeEventListener("test",ct,ct)}catch(f){rt=!1}U.addEventListener=function(f,d,h,g){g===void 0&&(g={}),f.addEventListener(d,h,"passive"in g&&rt?g:g.capture)},U.removeEventListener=function(f,d,h,g){g===void 0&&(g={}),f.removeEventListener(d,h,"passive"in g&&rt?g:g.capture)};var Pt=function(f){f.preventDefault(),f.stopPropagation(),y.window.removeEventListener("click",Pt,!0)};function er(f){var d=f.userImage;return!!(d&&d.render&&d.render())&&(f.data.replace(new Uint8Array(d.data.buffer)),!0)}U.suppressClick=function(){y.window.addEventListener("click",Pt,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",Pt,!0)},0)},U.mousePos=function(f,d){var h=f.getBoundingClientRect();return new y.Point(d.clientX-h.left-f.clientLeft,d.clientY-h.top-f.clientTop)},U.touchPos=function(f,d){for(var h=f.getBoundingClientRect(),g=[],w=0;w<d.length;w++)g.push(new y.Point(d[w].clientX-h.left-f.clientLeft,d[w].clientY-h.top-f.clientTop));return g},U.mouseButton=function(f){return y.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},U.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};var qt=function(f){function d(){f.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var g=0,w=this.requestors;g<w.length;g+=1){var C=w[g];this._notify(C.ids,C.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,g){this._validate(h,g)&&(this.images[h]=g)},d.prototype._validate=function(h,g){var w=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),w=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),w=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),w=!1),w},d.prototype._validateStretch=function(h,g){if(!h)return!0;for(var w=0,C=0,T=h;C<T.length;C+=1){var I=T[C];if(I[0]<w||I[1]<I[0]||g<I[1])return!1;w=I[1]}return!0},d.prototype._validateContent=function(h,g){return!(h&&(h.length!==4||h[0]<0||g.data.width<h[0]||h[1]<0||g.data.height<h[1]||h[2]<0||g.data.width<h[2]||h[3]<0||g.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,g){g.version=this.images[h].version+1,this.images[h]=g,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var g=this.images[h];delete this.images[h],delete this.patterns[h],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,g){var w=!0;if(!this.isLoaded())for(var C=0,T=h;C<T.length;C+=1)this.images[T[C]]||(w=!1);this.isLoaded()||w?this._notify(h,g):this.requestors.push({ids:h,callback:g})},d.prototype._notify=function(h,g){for(var w={},C=0,T=h;C<T.length;C+=1){var I=T[C];this.images[I]||this.fire(new y.Event("styleimagemissing",{id:I}));var Z=this.images[I];Z?w[I]={data:Z.data.clone(),pixelRatio:Z.pixelRatio,sdf:Z.sdf,version:Z.version,stretchX:Z.stretchX,stretchY:Z.stretchY,content:Z.content,hasRenderCallback:Boolean(Z.userImage&&Z.userImage.render)}:y.warnOnce('Image "'+I+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,w)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var g=this.patterns[h],w=this.getImage(h);if(!w)return null;if(g&&g.position.version===w.version)return g.position;if(g)g.position.version=w.version;else{var C={w:w.data.width+2,h:w.data.height+2,x:0,y:0},T=new y.ImagePosition(C,w);this.patterns[h]={bin:C,position:T}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var g=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(h,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var g in this.patterns)h.push(this.patterns[g].bin);var w=y.potpack(h),C=w.w,T=w.h,I=this.atlasImage;for(var Z in I.resize({width:C||1,height:T||1}),this.patterns){var $=this.patterns[Z].bin,le=$.x+1,ve=$.y+1,xe=this.images[Z].data,ze=xe.width,Fe=xe.height;y.RGBAImage.copy(xe,I,{x:0,y:0},{x:le,y:ve},{width:ze,height:Fe}),y.RGBAImage.copy(xe,I,{x:0,y:Fe-1},{x:le,y:ve-1},{width:ze,height:1}),y.RGBAImage.copy(xe,I,{x:0,y:0},{x:le,y:ve+Fe},{width:ze,height:1}),y.RGBAImage.copy(xe,I,{x:ze-1,y:0},{x:le-1,y:ve},{width:1,height:Fe}),y.RGBAImage.copy(xe,I,{x:0,y:0},{x:le+ze,y:ve},{width:1,height:Fe})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var g=0,w=h;g<w.length;g+=1){var C=w[g];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var T=this.images[C];er(T)&&this.updateImage(C,T)}}},d}(y.Evented),ir=yt,tr=yt,Ct=1e20;function yt(f,d,h,g,w,C){this.fontSize=f||24,this.buffer=d===void 0?3:d,this.cutoff=g||.25,this.fontFamily=w||"sans-serif",this.fontWeight=C||"normal",this.radius=h||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Fr(f,d,h,g,w,C,T){for(var I=0;I<d;I++){for(var Z=0;Z<h;Z++)g[Z]=f[Z*d+I];for(mr(g,w,C,T,h),Z=0;Z<h;Z++)f[Z*d+I]=w[Z]}for(Z=0;Z<h;Z++){for(I=0;I<d;I++)g[I]=f[Z*d+I];for(mr(g,w,C,T,d),I=0;I<d;I++)f[Z*d+I]=Math.sqrt(w[I])}}function mr(f,d,h,g,w){h[0]=0,g[0]=-Ct,g[1]=+Ct;for(var C=1,T=0;C<w;C++){for(var I=(f[C]+C*C-(f[h[T]]+h[T]*h[T]))/(2*C-2*h[T]);I<=g[T];)T--,I=(f[C]+C*C-(f[h[T]]+h[T]*h[T]))/(2*C-2*h[T]);h[++T]=C,g[T]=I,g[T+1]=+Ct}for(C=0,T=0;C<w;C++){for(;g[T+1]<C;)T++;d[C]=(C-h[T])*(C-h[T])+f[h[T]]}}yt.prototype.draw=function(f){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(f,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var w=d.data[4*g+3]/255;this.gridOuter[g]=w===1?0:w===0?Ct:Math.pow(Math.max(0,.5-w),2),this.gridInner[g]=w===1?Ct:w===0?0:Math.pow(Math.max(0,w-.5),2)}for(Fr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Fr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)h[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return h},ir.default=tr;var lr=function(f,d){this.requestManager=f,this.localIdeographFontFamily=d,this.entries={}};lr.prototype.setURL=function(f){this.url=f},lr.prototype.getGlyphs=function(f,d){var h=this,g=[];for(var w in f)for(var C=0,T=f[w];C<T.length;C+=1)g.push({stack:w,id:T[C]});y.asyncAll(g,function(I,Z){var $=I.stack,le=I.id,ve=h.entries[$];ve||(ve=h.entries[$]={glyphs:{},requests:{},ranges:{}});var xe=ve.glyphs[le];if(xe===void 0){if(xe=h._tinySDF(ve,$,le))return ve.glyphs[le]=xe,void Z(null,{stack:$,id:le,glyph:xe});var ze=Math.floor(le/256);if(256*ze>65535)Z(new Error("glyphs > 65535 not supported"));else if(ve.ranges[ze])Z(null,{stack:$,id:le,glyph:xe});else{var Fe=ve.requests[ze];Fe||(Fe=ve.requests[ze]=[],lr.loadGlyphRange($,ze,h.url,h.requestManager,function(Ye,Pe){if(Pe){for(var $e in Pe)h._doesCharSupportLocalGlyph(+$e)||(ve.glyphs[+$e]=Pe[+$e]);ve.ranges[ze]=!0}for(var it=0,Mt=Fe;it<Mt.length;it+=1)(0,Mt[it])(Ye,Pe);delete ve.requests[ze]})),Fe.push(function(Ye,Pe){Ye?Z(Ye):Pe&&Z(null,{stack:$,id:le,glyph:Pe[le]||null})})}}else Z(null,{stack:$,id:le,glyph:xe})},function(I,Z){if(I)d(I);else if(Z){for(var $={},le=0,ve=Z;le<ve.length;le+=1){var xe=ve[le],ze=xe.stack,Fe=xe.id,Ye=xe.glyph;($[ze]||($[ze]={}))[Fe]=Ye&&{id:Ye.id,bitmap:Ye.bitmap.clone(),metrics:Ye.metrics}}d(null,$)}})},lr.prototype._doesCharSupportLocalGlyph=function(f){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](f)||y.isChar["Hangul Syllables"](f)||y.isChar.Hiragana(f)||y.isChar.Katakana(f))},lr.prototype._tinySDF=function(f,d,h){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(h)){var w=f.tinySDF;if(!w){var C="400";/bold/i.test(d)?C="900":/medium/i.test(d)?C="500":/light/i.test(d)&&(C="200"),w=f.tinySDF=new lr.TinySDF(24,3,8,.25,g,C)}return{id:h,bitmap:new y.AlphaImage({width:30,height:30},w.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},lr.loadGlyphRange=function(f,d,h,g,w){var C=256*d,T=C+255,I=g.transformRequest(g.normalizeGlyphsURL(h).replace("{fontstack}",f).replace("{range}",C+"-"+T),y.ResourceType.Glyphs);y.getArrayBuffer(I,function(Z,$){if(Z)w(Z);else if($){for(var le={},ve=0,xe=y.parseGlyphPBF($);ve<xe.length;ve+=1){var ze=xe[ve];le[ze.id]=ze}w(null,le)}})},lr.TinySDF=ir;var xt=function(){this.specification=y.styleSpec.light.position};xt.prototype.possiblyEvaluate=function(f,d){return y.sphericalToCartesian(f.expression.evaluate(d))},xt.prototype.interpolate=function(f,d,h){return{x:y.number(f.x,d.x,h),y:y.number(f.y,d.y,h),z:y.number(f.z,d.z,h)}};var at=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new xt,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Rt=function(f){function d(h){f.call(this),this._transitionable=new y.Transitionable(at),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,h,g))for(var w in h){var C=h[w];y.endsWith(w,"-transition")?this._transitionable.setTransition(w.slice(0,-"-transition".length),C):this._transitionable.setValue(w,C)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,g,w){return(!w||w.validate!==!1)&&y.emitValidationErrors(this,h.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},d}(y.Evented),ft=function(f,d){this.width=f,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ft.prototype.getDash=function(f,d){var h=f.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(f,d)),this.dashEntry[h]},ft.prototype.getDashRanges=function(f,d,h){var g=[],w=f.length%2==1?-f[f.length-1]*h:0,C=f[0]*h,T=!0;g.push({left:w,right:C,isDash:T,zeroLength:f[0]===0});for(var I=f[0],Z=1;Z<f.length;Z++){var $=f[Z];g.push({left:w=I*h,right:C=(I+=$)*h,isDash:T=!T,zeroLength:$===0})}return g},ft.prototype.addRoundDash=function(f,d,h){for(var g=d/2,w=-h;w<=h;w++)for(var C=this.width*(this.nextRow+h+w),T=0,I=f[T],Z=0;Z<this.width;Z++){Z/I.right>1&&(I=f[++T]);var $=Math.abs(Z-I.left),le=Math.abs(Z-I.right),ve=Math.min($,le),xe=void 0,ze=w/h*(g+1);if(I.isDash){var Fe=g-Math.abs(ze);xe=Math.sqrt(ve*ve+Fe*Fe)}else xe=g-Math.sqrt(ve*ve+ze*ze);this.data[C+Z]=Math.max(0,Math.min(255,xe+128))}},ft.prototype.addRegularDash=function(f){for(var d=f.length-1;d>=0;--d){var h=f[d],g=f[d+1];h.zeroLength?f.splice(d,1):g&&g.isDash===h.isDash&&(g.left=h.left,f.splice(d,1))}var w=f[0],C=f[f.length-1];w.isDash===C.isDash&&(w.left=C.left-this.width,C.right=w.right+this.width);for(var T=this.width*this.nextRow,I=0,Z=f[I],$=0;$<this.width;$++){$/Z.right>1&&(Z=f[++I]);var le=Math.abs($-Z.left),ve=Math.abs($-Z.right),xe=Math.min(le,ve);this.data[T+$]=Math.max(0,Math.min(255,(Z.isDash?xe:-xe)+128))}},ft.prototype.addDash=function(f,d){var h=d?7:0,g=2*h+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var w=0,C=0;C<f.length;C++)w+=f[C];if(w!==0){var T=this.width/w,I=this.getDashRanges(f,this.width,T);d?this.addRoundDash(I,T,h):this.addRegularDash(I)}var Z={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:w};return this.nextRow+=g,this.dirty=!0,Z},ft.prototype.bind=function(f){var d=f.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var Kt=function f(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),w=0;w<g.length;w++){var C=new f.Actor(g[w],h,this.id);C.name="Worker "+w,this.actors.push(C)}};function xr(f,d,h){var g=function(w,C){if(w)return h(w);if(C){var T=y.pick(y.extend(C,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(T.vectorLayers=C.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(I){return I.id})),T.tiles=d.canonicalizeTileset(T,f.url),h(null,T)}};return f.url?y.getJSON(d.transformRequest(d.normalizeSourceURL(f.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,f)})}Kt.prototype.broadcast=function(f,d,h){y.asyncAll(this.actors,function(g,w){g.send(f,d,w)},h=h||function(){})},Kt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Kt.prototype.remove=function(){this.actors.forEach(function(f){f.remove()}),this.actors=[],this.workerPool.release(this.id)},Kt.Actor=y.Actor;var Y=function(f,d,h){this.bounds=y.LngLatBounds.convert(this.validateBounds(f)),this.minzoom=d||0,this.maxzoom=h||24};Y.prototype.validateBounds=function(f){return Array.isArray(f)&&f.length===4?[Math.max(-180,f[0]),Math.max(-90,f[1]),Math.min(180,f[2]),Math.min(90,f[3])]:[-180,-90,180,90]},Y.prototype.contains=function(f){var d=Math.pow(2,f.z),h=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*d),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*d),w=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*d),C=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*d);return f.x>=h&&f.x<w&&f.y>=g&&f.y<C};var Le=function(f){function d(h,g,w,C){if(f.call(this),this.id=h,this.dispatcher=w,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new Y(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles,h.map._requestManager._customAccessToken),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var g=this;return this.setSourceProperty(function(){g._options.tiles=h}),this},d.prototype.setUrl=function(h){var g=this;return this.setSourceProperty(function(){g.url=h,g._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(w,y.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(I,Z){return delete h.request,h.aborted?g(null):I&&I.status!==404?g(I):(Z&&Z.resourceTiming&&(h.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&h.setExpiryData(Z),h.loadVectorData(Z,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=g:h.request=h.actor.send("reloadTile",C,T.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",C,T.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(y.Evented),O=function(f){function d(h,g,w,C){f.call(this),this.id=h,this.dispatcher=w,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new Y(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,g){var w=this,C=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=y.getImage(this.map._requestManager.transformRequest(C,y.ResourceType.Tile),function(T,I){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(T)h.state="errored",g(T);else if(I){w.map._refreshExpiredTiles&&h.setExpiryData(I),delete I.cacheControl,delete I.expires;var Z=w.map.painter.context,$=Z.gl;h.texture=w.map.painter.getTileTexture(I.width),h.texture?h.texture.update(I,{useMipmap:!0}):(h.texture=new y.Texture(Z,I,$.RGBA,{useMipmap:!0}),h.texture.bind($.LINEAR,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),Z.extTextureFilterAnisotropic&&$.texParameterf($.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax)),h.state="loaded",y.cacheEntryPossiblyAdded(w.dispatcher),g(null)}})},d.prototype.abortTile=function(h,g){h.request&&(h.request.cancel(),delete h.request),g()},d.prototype.unloadTile=function(h,g){h.texture&&this.map.painter.saveTileTexture(h.texture),g()},d.prototype.hasTransition=function(){return!1},d}(y.Evented),ke=function(f){function d(h,g,w,C){f.call(this,h,g,w,C),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(T,I){T&&(h.state="errored",g(T)),I&&(h.dem=I,h.needsHillshadePrepare=!0,h.state="loaded",g(null))}h.request=y.getImage(this.map._requestManager.transformRequest(w,y.ResourceType.Tile),function(T,I){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(T)h.state="errored",g(T);else if(I){this.map._refreshExpiredTiles&&h.setExpiryData(I),delete I.cacheControl,delete I.expires;var Z=y.window.ImageBitmap&&I instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?I:y.browser.getImageData(I,1),$={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:Z,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",$,C.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var g=h.canonical,w=Math.pow(2,g.z),C=(g.x-1+w)%w,T=g.x===0?h.wrap-1:h.wrap,I=(g.x+1+w)%w,Z=g.x+1===w?h.wrap+1:h.wrap,$={};return $[new y.OverscaledTileID(h.overscaledZ,T,g.z,C,g.y).key]={backfilled:!1},$[new y.OverscaledTileID(h.overscaledZ,Z,g.z,I,g.y).key]={backfilled:!1},g.y>0&&($[new y.OverscaledTileID(h.overscaledZ,T,g.z,C,g.y-1).key]={backfilled:!1},$[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},$[new y.OverscaledTileID(h.overscaledZ,Z,g.z,I,g.y-1).key]={backfilled:!1}),g.y+1<w&&($[new y.OverscaledTileID(h.overscaledZ,T,g.z,C,g.y+1).key]={backfilled:!1},$[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},$[new y.OverscaledTileID(h.overscaledZ,Z,g.z,I,g.y+1).key]={backfilled:!1}),$},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(O),Ae=function(f){function d(h,g,w,C){f.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=w.getActor(),this.setEventedParent(C),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var T=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*T,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*T,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*T,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new y.ErrorEvent(g));else{var w={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(w.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new y.Event("data",w))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var g=this;return this._data=h,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(w){if(w)g.fire(new y.ErrorEvent(w));else{var C={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(C.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",C))}}),this},d.prototype.getClusterExpansionZoom=function(h,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},g),this},d.prototype.getClusterChildren=function(h,g){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},g),this},d.prototype.getClusterLeaves=function(h,g,w,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:g,offset:w},C),this},d.prototype._updateWorkerData=function(h){var g=this;this._loaded=!1;var w=y.extend({},this.workerOptions),C=this._data;typeof C=="string"?(w.request=this.map._requestManager.transformRequest(y.browser.resolveURL(C),y.ResourceType.Source),w.request.collectResourceTiming=this._collectResourceTiming):w.data=JSON.stringify(C),this.actor.send(this.type+".loadData",w,function(T,I){g._removed||I&&I.abandoned||(g._loaded=!0,I&&I.resourceTiming&&I.resourceTiming[g.id]&&(g._resourceTiming=I.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:w.source},null),h(T))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,g){var w=this,C=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(C,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,I){return delete h.request,h.unloadVectorData(),h.aborted?g(null):T?g(T):(h.loadVectorData(I,w.map.painter,C==="reloadTile"),g(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(y.Evented),st=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),_t=function(f){function d(h,g,w,C){f.call(this),this.id=h,this.dispatcher=w,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(h,g){var w=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(C,T){w._loaded=!0,C?w.fire(new y.ErrorEvent(C)):T&&(w.image=T,h&&(w.coordinates=h),g&&g(),w._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var g=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){g.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var g=this;this.coordinates=h;var w=h.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var I=1/0,Z=1/0,$=-1/0,le=-1/0,ve=0,xe=T;ve<xe.length;ve+=1){var ze=xe[ve];I=Math.min(I,ze.x),Z=Math.min(Z,ze.y),$=Math.max($,ze.x),le=Math.max(le,ze.y)}var Fe=Math.max($-I,le-Z),Ye=Math.max(0,Math.floor(-Math.log(Fe)/Math.LN2)),Pe=Math.pow(2,Ye);return new y.CanonicalTileID(Ye,Math.floor((I+$)/2*Pe),Math.floor((Z+le)/2*Pe))}(w),this.minzoom=this.maxzoom=this.tileID.z;var C=w.map(function(T){return g.tileID.getTilePoint(T)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,st.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(h,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},d.prototype.loadTile=function(h,g){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},g(null)):(h.state="errored",g(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(y.Evented),bt=function(f){function d(h,g,w,C){f.call(this,h,g,w,C),this.roundZoom=!0,this.type="video",this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var g=this.options;this.urls=[];for(var w=0,C=g.urls;w<C.length;w+=1)this.urls.push(this.map._requestManager.transformRequest(C[w],y.ResourceType.Source).url);y.getVideo(this.urls,function(T,I){h._loaded=!0,T?h.fire(new y.ErrorEvent(T)):I&&(h.video=I,h.video.loop=!0,h.video.setAttribute("playsinline",""),h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var g=this.video.seekable;h<g.start(0)||h>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,st.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(h,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(_t),Ht=function(f){function d(h,g,w,C){f.call(this,h,g,w,C),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(I){return typeof I!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,w=g.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,st.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,w.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[C];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,g=[this.canvas.width,this.canvas.height];h<g.length;h+=1){var w=g[h];if(isNaN(w)||w<=0)return!0}return!1},d}(_t),nr={vector:Le,raster:O,"raster-dem":ke,geojson:Ae,video:bt,image:_t,canvas:Ht};function Qr(f,d){var h=y.identity([]);return y.translate(h,h,[1,1,0]),y.scale(h,h,[.5*f.width,.5*f.height,1]),y.multiply(h,h,f.calculatePosMatrix(d.toUnwrapped()))}function Lr(f,d,h,g,w,C){var T=function(Ye,Pe,$e){if(Ye)for(var it=0,Mt=Ye;it<Mt.length;it+=1){var jt=Pe[Mt[it]];if(jt&&jt.source===$e&&jt.type==="fill-extrusion")return!0}else for(var Ut in Pe){var $t=Pe[Ut];if($t.source===$e&&$t.type==="fill-extrusion")return!0}return!1}(w&&w.layers,d,f.id),I=C.maxPitchScaleFactor(),Z=f.tilesIn(g,I,T);Z.sort(jn);for(var $=[],le=0,ve=Z;le<ve.length;le+=1){var xe=ve[le];$.push({wrappedTileID:xe.tileID.wrapped().key,queryResults:xe.tile.queryRenderedFeatures(d,h,f._state,xe.queryGeometry,xe.cameraQueryGeometry,xe.scale,w,C,I,Qr(f.transform,xe.tileID))})}var ze=function(Ye){for(var Pe={},$e={},it=0,Mt=Ye;it<Mt.length;it+=1){var jt=Mt[it],Ut=jt.queryResults,$t=jt.wrappedTileID,pr=$e[$t]=$e[$t]||{};for(var zr in Ut)for(var Rr=Ut[zr],an=pr[zr]=pr[zr]||{},Tn=Pe[zr]=Pe[zr]||[],In=0,On=Rr;In<On.length;In+=1){var Mi=On[In];an[Mi.featureIndex]||(an[Mi.featureIndex]=!0,Tn.push(Mi))}}return Pe}($);for(var Fe in ze)ze[Fe].forEach(function(Ye){var Pe=Ye.feature,$e=f.getFeatureState(Pe.layer["source-layer"],Pe.id);Pe.source=Pe.layer.source,Pe.layer["source-layer"]&&(Pe.sourceLayer=Pe.layer["source-layer"]),Pe.state=$e});return ze}function jn(f,d){var h=f.tileID,g=d.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}var tn=function(f,d){this.max=f,this.onRemove=d,this.reset()};tn.prototype.reset=function(){for(var f in this.data)for(var d=0,h=this.data[f];d<h.length;d+=1){var g=h[d];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},tn.prototype.add=function(f,d,h){var g=this,w=f.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);var C={value:d,timeout:void 0};if(h!==void 0&&(C.timeout=setTimeout(function(){g.remove(f,C)},h)),this.data[w].push(C),this.order.push(w),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},tn.prototype.has=function(f){return f.wrapped().key in this.data},tn.prototype.getAndRemove=function(f){return this.has(f)?this._getAndRemoveByKey(f.wrapped().key):null},tn.prototype._getAndRemoveByKey=function(f){var d=this.data[f].shift();return d.timeout&&clearTimeout(d.timeout),this.data[f].length===0&&delete this.data[f],this.order.splice(this.order.indexOf(f),1),d.value},tn.prototype.getByKey=function(f){var d=this.data[f];return d?d[0].value:null},tn.prototype.get=function(f){return this.has(f)?this.data[f.wrapped().key][0].value:null},tn.prototype.remove=function(f,d){if(!this.has(f))return this;var h=f.wrapped().key,g=d===void 0?0:this.data[h].indexOf(d),w=this.data[h][g];return this.data[h].splice(g,1),w.timeout&&clearTimeout(w.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(w.value),this.order.splice(this.order.indexOf(h),1),this},tn.prototype.setMaxSize=function(f){for(this.max=f;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},tn.prototype.filter=function(f){var d=[];for(var h in this.data)for(var g=0,w=this.data[h];g<w.length;g+=1){var C=w[g];f(C.value)||d.push(C)}for(var T=0,I=d;T<I.length;T+=1){var Z=I[T];this.remove(Z.value.tileID,Z)}};var Cn=function(f,d,h){this.context=f;var g=f.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),f.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Cn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Cn.prototype.updateData=function(f){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,f.arrayBuffer)},Cn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var si={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Xn=function(f,d,h,g){this.length=d.length,this.attributes=h,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=f;var w=f.gl;this.buffer=w.createBuffer(),f.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Xn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Xn.prototype.updateData=function(f){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,f.arrayBuffer)},Xn.prototype.enableAttributes=function(f,d){for(var h=0;h<this.attributes.length;h++){var g=d.attributes[this.attributes[h].name];g!==void 0&&f.enableVertexAttribArray(g)}},Xn.prototype.setVertexAttribPointers=function(f,d,h){for(var g=0;g<this.attributes.length;g++){var w=this.attributes[g],C=d.attributes[w.name];C!==void 0&&f.vertexAttribPointer(C,w.components,f[si[w.type]],!1,this.itemSize,w.offset+this.itemSize*(h||0))}},Xn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var vn=function(f){this.gl=f.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};vn.prototype.get=function(){return this.current},vn.prototype.set=function(f){},vn.prototype.getDefault=function(){return this.default},vn.prototype.setDefault=function(){this.set(this.default)};var Ai=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(vn),Ii=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(vn),Ti=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(vn),Gn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(vn),Dn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(vn),ho=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(vn),Hi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var g=this.current;(h.func!==g.func||h.ref!==g.ref||h.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(vn),Ya=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(vn),kt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(vn),L=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(vn),ne=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(vn),fe=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(vn),Ze=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.BLEND):g.disable(g.BLEND),this.current=h,this.dirty=!1}},d}(vn),pt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(vn),Wt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(vn),Ar=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(vn),Ve=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=h,this.dirty=!1}},d}(vn),Tt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(vn),ar=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(vn),Er=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(vn),Wr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(vn),mn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(vn),wn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(vn),gn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(vn),xn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(vn),ri=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(vn),Jn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(vn),Wi=function(f){function d(h){f.call(this,h),this.vao=h.extVertexArrayObject}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(vn),$i=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(vn),po=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(vn),$o=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(vn),Xi=function(f){function d(h,g){f.call(this,h),this.context=h,this.parent=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(vn),G=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(Xi),X=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(Xi),ie=function(f,d,h,g){this.context=f,this.width=d,this.height=h;var w=this.framebuffer=f.gl.createFramebuffer();this.colorAttachment=new G(f,w),g&&(this.depthAttachment=new X(f,w))};ie.prototype.destroy=function(){var f=this.context.gl,d=this.colorAttachment.get();if(d&&f.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&f.deleteRenderbuffer(h)}f.deleteFramebuffer(this.framebuffer)};var we=function(f,d,h){this.func=f,this.mask=d,this.range=h};we.ReadOnly=!1,we.ReadWrite=!0,we.disabled=new we(519,we.ReadOnly,[0,1]);var Oe=function(f,d,h,g,w,C){this.test=f,this.ref=d,this.mask=h,this.fail=g,this.depthFail=w,this.pass=C};Oe.disabled=new Oe({func:519,mask:0},0,0,7680,7680,7680);var Ke=function(f,d,h){this.blendFunction=f,this.blendColor=d,this.mask=h};Ke.disabled=new Ke(Ke.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),Ke.unblended=new Ke(Ke.Replace,y.Color.transparent,[!0,!0,!0,!0]),Ke.alphaBlended=new Ke([1,771],y.Color.transparent,[!0,!0,!0,!0]);var ot=function(f,d,h){this.enable=f,this.mode=d,this.frontFace=h};ot.disabled=new ot(!1,1029,2305),ot.backCCW=new ot(!0,1029,2305);var pe=function(f){this.gl=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ai(this),this.clearDepth=new Ii(this),this.clearStencil=new Ti(this),this.colorMask=new Gn(this),this.depthMask=new Dn(this),this.stencilMask=new ho(this),this.stencilFunc=new Hi(this),this.stencilOp=new Ya(this),this.stencilTest=new kt(this),this.depthRange=new L(this),this.depthTest=new ne(this),this.depthFunc=new fe(this),this.blend=new Ze(this),this.blendFunc=new pt(this),this.blendColor=new Wt(this),this.blendEquation=new Ar(this),this.cullFace=new Ve(this),this.cullFaceSide=new Tt(this),this.frontFace=new ar(this),this.program=new Er(this),this.activeTexture=new Wr(this),this.viewport=new mn(this),this.bindFramebuffer=new wn(this),this.bindRenderbuffer=new gn(this),this.bindTexture=new xn(this),this.bindVertexBuffer=new ri(this),this.bindElementBuffer=new Jn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Wi(this),this.pixelStoreUnpack=new $i(this),this.pixelStoreUnpackPremultiplyAlpha=new po(this),this.pixelStoreUnpackFlipY=new $o(this),this.extTextureFilterAnisotropic=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=f.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=f.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(f.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=f.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=f.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE)};pe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},pe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},pe.prototype.createIndexBuffer=function(f,d){return new Cn(this,f,d)},pe.prototype.createVertexBuffer=function(f,d,h){return new Xn(this,f,d,h)},pe.prototype.createRenderbuffer=function(f,d,h){var g=this.gl,w=g.createRenderbuffer();return this.bindRenderbuffer.set(w),g.renderbufferStorage(g.RENDERBUFFER,f,d,h),this.bindRenderbuffer.set(null),w},pe.prototype.createFramebuffer=function(f,d,h){return new ie(this,f,d,h)},pe.prototype.clear=function(f){var d=f.color,h=f.depth,g=this.gl,w=0;d&&(w|=g.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g.clear(w)},pe.prototype.setCullFace=function(f){f.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(f.mode),this.frontFace.set(f.frontFace))},pe.prototype.setDepthMode=function(f){f.func!==this.gl.ALWAYS||f.mask?(this.depthTest.set(!0),this.depthFunc.set(f.func),this.depthMask.set(f.mask),this.depthRange.set(f.range)):this.depthTest.set(!1)},pe.prototype.setStencilMode=function(f){f.test.func!==this.gl.ALWAYS||f.mask?(this.stencilTest.set(!0),this.stencilMask.set(f.mask),this.stencilOp.set([f.fail,f.depthFail,f.pass]),this.stencilFunc.set({func:f.test.func,ref:f.ref,mask:f.test.mask})):this.stencilTest.set(!1)},pe.prototype.setColorMode=function(f){y.deepEqual(f.blendFunction,Ke.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(f.blendFunction),this.blendColor.set(f.blendColor)),this.colorMask.set(f.mask)},pe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var J=function(f){function d(h,g,w){var C=this;f.call(this),this.id=h,this.dispatcher=w,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(T,I,Z,$){var le=new nr[I.type](T,I,Z,$);if(le.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+le.id);return y.bindAll(["load","abort","unload","serialize","prepare"],le),le}(h,g,w,this),this._tiles={},this._cache=new tn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var g=this._tiles[h];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,g){return this._source.loadTile(h,g)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var w=this._tiles[g];w.upload(h),w.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return y.values(this._tiles).map(function(h){return h.tileID}).sort(be).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var g=this,w=[];for(var C in this._tiles)this._isIdRenderable(C,h)&&w.push(this._tiles[C]);return h?w.sort(function(T,I){var Z=T.tileID,$=I.tileID,le=new y.Point(Z.canonical.x,Z.canonical.y)._rotate(g.transform.angle),ve=new y.Point($.canonical.x,$.canonical.y)._rotate(g.transform.angle);return Z.overscaledZ-$.overscaledZ||ve.y-le.y||ve.x-le.x}).map(function(T){return T.tileID.key}):w.map(function(T){return T.tileID}).sort(be).map(function(T){return T.key})},d.prototype.hasRenderableParent=function(h){var g=this.findLoadedParent(h,0);return!!g&&this._isIdRenderable(g.tileID.key)},d.prototype._isIdRenderable=function(h,g){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(g||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,g){var w=this._tiles[h];w&&(w.state!=="loading"&&(w.state=g),this._loadTile(w,this._tileLoaded.bind(this,w,h,g)))},d.prototype._tileLoaded=function(h,g,w,C){if(C)return h.state="errored",void(C.status!==404?this._source.fire(new y.ErrorEvent(C,{tile:h})):this.update(this.transform));h.timeAdded=y.browser.now(),w==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(g,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var g=this.getRenderableIds(),w=0;w<g.length;w++){var C=g[w];if(h.neighboringTiles&&h.neighboringTiles[C]){var T=this.getTileByID(C);I(h,T),I(T,h)}}function I(Z,$){Z.needsHillshadePrepare=!0;var le=$.tileID.canonical.x-Z.tileID.canonical.x,ve=$.tileID.canonical.y-Z.tileID.canonical.y,xe=Math.pow(2,Z.tileID.canonical.z),ze=$.tileID.key;le===0&&ve===0||Math.abs(ve)>1||(Math.abs(le)>1&&(Math.abs(le+xe)===1?le+=xe:Math.abs(le-xe)===1&&(le-=xe)),$.dem&&Z.dem&&(Z.dem.backfillBorder($.dem,le,ve),Z.neighboringTiles&&Z.neighboringTiles[ze]&&(Z.neighboringTiles[ze].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,g,w,C){for(var T in this._tiles){var I=this._tiles[T];if(!(C[T]||!I.hasData()||I.tileID.overscaledZ<=g||I.tileID.overscaledZ>w)){for(var Z=I.tileID;I&&I.tileID.overscaledZ>g+1;){var $=I.tileID.scaledTo(I.tileID.overscaledZ-1);(I=this._tiles[$.key])&&I.hasData()&&(Z=$)}for(var le=Z;le.overscaledZ>g;)if(h[(le=le.scaledTo(le.overscaledZ-1)).key]){C[Z.key]=Z;break}}}},d.prototype.findLoadedParent=function(h,g){if(h.key in this._loadedParentTiles){var w=this._loadedParentTiles[h.key];return w&&w.tileID.overscaledZ>=g?w:null}for(var C=h.overscaledZ-1;C>=g;C--){var T=h.scaledTo(C),I=this._getLoadedTile(T);if(I)return I}},d.prototype._getLoadedTile=function(h){var g=this._tiles[h.key];return g&&g.hasData()?g:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var g=Math.ceil(h.width/this._source.tileSize)+1,w=Math.ceil(h.height/this._source.tileSize)+1,C=Math.floor(g*w*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(T)},d.prototype.handleWrapJump=function(h){var g=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,g){var w={};for(var C in this._tiles){var T=this._tiles[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+g),w[T.tileID.key]=T}for(var I in this._tiles=w,this._timers)clearTimeout(this._timers[I]),delete this._timers[I];for(var Z in this._tiles)this._setTileReloadTimer(Z,this._tiles[Z])}},d.prototype.update=function(h){var g=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var w;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?w=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(pr){return new y.OverscaledTileID(pr.canonical.z,pr.wrap,pr.canonical.z,pr.canonical.x,pr.canonical.y)}):(w=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(w=w.filter(function(pr){return g._source.hasTile(pr)}))):w=[];var C=h.coveringZoomLevel(this._source),T=Math.max(C-d.maxOverzooming,this._source.minzoom),I=Math.max(C+d.maxUnderzooming,this._source.minzoom),Z=this._updateRetainedTiles(w,C);if(lt(this._source.type)){for(var $={},le={},ve=0,xe=Object.keys(Z);ve<xe.length;ve+=1){var ze=xe[ve],Fe=Z[ze],Ye=this._tiles[ze];if(Ye&&!(Ye.fadeEndTime&&Ye.fadeEndTime<=y.browser.now())){var Pe=this.findLoadedParent(Fe,T);Pe&&(this._addTile(Pe.tileID),$[Pe.tileID.key]=Pe.tileID),le[ze]=Fe}}for(var $e in this._retainLoadedChildren(le,C,I,Z),$)Z[$e]||(this._coveredTiles[$e]=!0,Z[$e]=$[$e])}for(var it in Z)this._tiles[it].clearFadeHold();for(var Mt=0,jt=y.keysDifference(this._tiles,Z);Mt<jt.length;Mt+=1){var Ut=jt[Mt],$t=this._tiles[Ut];$t.hasSymbolBuckets&&!$t.holdingForFade()?$t.setHoldDuration(this.map._fadeDuration):$t.hasSymbolBuckets&&!$t.symbolFadeFinished()||this._removeTile(Ut)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,g){for(var w={},C={},T=Math.max(g-d.maxOverzooming,this._source.minzoom),I=Math.max(g+d.maxUnderzooming,this._source.minzoom),Z={},$=0,le=h;$<le.length;$+=1){var ve=le[$],xe=this._addTile(ve);w[ve.key]=ve,xe.hasData()||g<this._source.maxzoom&&(Z[ve.key]=ve)}this._retainLoadedChildren(Z,g,I,w);for(var ze=0,Fe=h;ze<Fe.length;ze+=1){var Ye=Fe[ze],Pe=this._tiles[Ye.key];if(!Pe.hasData()){if(g+1>this._source.maxzoom){var $e=Ye.children(this._source.maxzoom)[0],it=this.getTile($e);if(it&&it.hasData()){w[$e.key]=$e;continue}}else{var Mt=Ye.children(this._source.maxzoom);if(w[Mt[0].key]&&w[Mt[1].key]&&w[Mt[2].key]&&w[Mt[3].key])continue}for(var jt=Pe.wasRequested(),Ut=Ye.overscaledZ-1;Ut>=T;--Ut){var $t=Ye.scaledTo(Ut);if(C[$t.key]||(C[$t.key]=!0,!(Pe=this.getTile($t))&&jt&&(Pe=this._addTile($t)),Pe&&(w[$t.key]=$t,jt=Pe.wasRequested(),Pe.hasData())))break}}}return w},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var g=[],w=void 0,C=this._tiles[h].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){w=this._loadedParentTiles[C.key];break}g.push(C.key);var T=C.scaledTo(C.overscaledZ-1);if(w=this._getLoadedTile(T))break;C=T}for(var I=0,Z=g;I<Z.length;I+=1)this._loadedParentTiles[Z[I]]=w}},d.prototype._addTile=function(h){var g=this._tiles[h.key];if(g)return g;(g=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,g),g.tileID=h,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,g)));var w=Boolean(g);return w||(g=new y.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,h.key,g.state))),g?(g.uses++,this._tiles[h.key]=g,w||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},d.prototype._setTileReloadTimer=function(h,g){var w=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var C=g.getExpiryTimeout();C&&(this._timers[h]=setTimeout(function(){w._reloadTile(h,"expired"),delete w._timers[h]},C))},d.prototype._removeTile=function(h){var g=this._tiles[h];g&&(g.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,g,w){var C=this,T=[],I=this.transform;if(!I)return T;for(var Z=w?I.getCameraQueryGeometry(h):h,$=h.map(function(Ut){return I.pointCoordinate(Ut)}),le=Z.map(function(Ut){return I.pointCoordinate(Ut)}),ve=this.getIds(),xe=1/0,ze=1/0,Fe=-1/0,Ye=-1/0,Pe=0,$e=le;Pe<$e.length;Pe+=1){var it=$e[Pe];xe=Math.min(xe,it.x),ze=Math.min(ze,it.y),Fe=Math.max(Fe,it.x),Ye=Math.max(Ye,it.y)}for(var Mt=function(Ut){var $t=C._tiles[ve[Ut]];if(!$t.holdingForFade()){var pr=$t.tileID,zr=Math.pow(2,I.zoom-$t.tileID.overscaledZ),Rr=g*$t.queryPadding*y.EXTENT/$t.tileSize/zr,an=[pr.getTilePoint(new y.MercatorCoordinate(xe,ze)),pr.getTilePoint(new y.MercatorCoordinate(Fe,Ye))];if(an[0].x-Rr<y.EXTENT&&an[0].y-Rr<y.EXTENT&&an[1].x+Rr>=0&&an[1].y+Rr>=0){var Tn=$.map(function(On){return pr.getTilePoint(On)}),In=le.map(function(On){return pr.getTilePoint(On)});T.push({tile:$t,tileID:pr,queryGeometry:Tn,cameraQueryGeometry:In,scale:zr})}}},jt=0;jt<ve.length;jt++)Mt(jt);return T},d.prototype.getVisibleCoordinates=function(h){for(var g=this,w=this.getRenderableIds(h).map(function(Z){return g._tiles[Z].tileID}),C=0,T=w;C<T.length;C+=1){var I=T[C];I.posMatrix=this.transform.calculatePosMatrix(I.toUnwrapped())}return w},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(lt(this._source.type))for(var h in this._tiles){var g=this._tiles[h];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,g,w){this._state.updateState(h=h||"_geojsonTileLayer",g,w)},d.prototype.removeFeatureState=function(h,g,w){this._state.removeFeatureState(h=h||"_geojsonTileLayer",g,w)},d.prototype.getFeatureState=function(h,g){return this._state.getState(h=h||"_geojsonTileLayer",g)},d.prototype.setDependencies=function(h,g,w){var C=this._tiles[h];C&&C.setDependencies(g,w)},d.prototype.reloadTilesForDependencies=function(h,g){for(var w in this._tiles)this._tiles[w].hasDependency(h,g)&&this._reloadTile(w,"reloading");this._cache.filter(function(C){return!C.hasDependency(h,g)})},d}(y.Evented);function be(f,d){var h=Math.abs(2*f.wrap)-+(f.wrap<0),g=Math.abs(2*d.wrap)-+(d.wrap<0);return f.overscaledZ-d.overscaledZ||g-h||d.canonical.y-f.canonical.y||d.canonical.x-f.canonical.x}function lt(f){return f==="raster"||f==="image"||f==="video"}function dt(){return new y.window.Worker(Pf.workerUrl)}J.maxOverzooming=10,J.maxUnderzooming=3;var re="mapboxgl_preloaded_worker_pool",br=function(){this.active={}};br.prototype.acquire=function(f){if(!this.workers)for(this.workers=[];this.workers.length<br.workerCount;)this.workers.push(new dt);return this.active[f]=!0,this.workers.slice()},br.prototype.release=function(f){delete this.active[f],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},br.prototype.isPreloaded=function(){return!!this.active[re]},br.prototype.numActive=function(){return Object.keys(this.active).length};var yn,ln=Math.floor(y.browser.hardwareConcurrency/2);function Qt(){return yn||(yn=new br),yn}function en(f,d){var h={};for(var g in f)g!=="ref"&&(h[g]=f[g]);return y.refProperties.forEach(function(w){w in d&&(h[w]=d[w])}),h}function Gr(f){f=f.slice();for(var d=Object.create(null),h=0;h<f.length;h++)d[f[h].id]=f[h];for(var g=0;g<f.length;g++)"ref"in f[g]&&(f[g]=en(f[g],d[f[g].ref]));return f}br.workerCount=Math.max(Math.min(ln,6),1);var Yr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function li(f,d,h){h.push({command:Yr.addSource,args:[f,d[f]]})}function qr(f,d,h){d.push({command:Yr.removeSource,args:[f]}),h[f]=!0}function hi(f,d,h,g){qr(f,h,g),li(f,d,h)}function Bi(f,d,h){var g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;for(g in d[h])if(d[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;return!0}function ci(f,d,h,g,w,C){var T;for(T in d=d||{},f=f||{})f.hasOwnProperty(T)&&(y.deepEqual(f[T],d[T])||h.push({command:C,args:[g,T,d[T],w]}));for(T in d)d.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(y.deepEqual(f[T],d[T])||h.push({command:C,args:[g,T,d[T],w]}))}function _i(f){return f.id}function xi(f,d){return f[d.id]=d,f}var ao=function(f,d){this.reset(f,d)};ao.prototype.reset=function(f,d){this.points=f||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ao.prototype.lerp=function(f){if(this.points.length===1)return this.points[0];f=y.clamp(f,0,1);for(var d=1,h=this._distances[d],g=f*this.paddedLength+this.padding;h<g&&d<this._distances.length;)h=this._distances[++d];var w=d-1,C=this._distances[w],T=h-C,I=T>0?(g-C)/T:0;return this.points[w].mult(1-I).add(this.points[d].mult(I))};var Ui=function(f,d,h){var g=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(f/h),this.yCellCount=Math.ceil(d/h);for(var C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=f,this.height=d,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function aa(f,d,h,g,w){var C=y.create();return d?(y.scale(C,C,[1/w,1/w,1]),h||y.rotateZ(C,C,g.angle)):y.multiply(C,g.labelPlaneMatrix,f),C}function bi(f,d,h,g,w){if(d){var C=y.clone(f);return y.scale(C,C,[w,w,1]),h||y.rotateZ(C,C,-g.angle),C}return g.glCoordMatrix}function fi(f,d){var h=[f.x,f.y,0,1];ra(h,h,d);var g=h[3];return{point:new y.Point(h[0]/g,h[1]/g),signedDistanceFromCamera:g}}function vi(f,d){return .5+f/d*.5}function fa(f,d){var h=f[0]/f[3],g=f[1]/f[3];return h>=-d[0]&&h<=d[0]&&g>=-d[1]&&g<=d[1]}function ms(f,d,h,g,w,C,T,I){var Z=g?f.textSizeData:f.iconSizeData,$=y.evaluateSizeForZoom(Z,h.transform.zoom),le=[256/h.width*2+1,256/h.height*2+1],ve=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ve.clear();for(var xe=f.lineVertexArray,ze=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,Fe=h.transform.width/h.transform.height,Ye=!1,Pe=0;Pe<ze.length;Pe++){var $e=ze.get(Pe);if($e.hidden||$e.writingMode===y.WritingMode.vertical&&!Ye)Hn($e.numGlyphs,ve);else{Ye=!1;var it=[$e.anchorX,$e.anchorY,0,1];if(y.transformMat4(it,it,d),fa(it,le)){var Mt=vi(h.transform.cameraToCenterDistance,it[3]),jt=y.evaluateSizeForFeature(Z,$,$e),Ut=T?jt/Mt:jt*Mt,$t=new y.Point($e.anchorX,$e.anchorY),pr=fi($t,w).point,zr={},Rr=Su($e,Ut,!1,I,d,w,C,f.glyphOffsetArray,xe,ve,pr,$t,zr,Fe);Ye=Rr.useVertical,(Rr.notEnoughRoom||Ye||Rr.needsFlipping&&Su($e,Ut,!0,I,d,w,C,f.glyphOffsetArray,xe,ve,pr,$t,zr,Fe).notEnoughRoom)&&Hn($e.numGlyphs,ve)}else Hn($e.numGlyphs,ve)}}g?f.text.dynamicLayoutVertexBuffer.updateData(ve):f.icon.dynamicLayoutVertexBuffer.updateData(ve)}function Ki(f,d,h,g,w,C,T,I,Z,$,le){var ve=I.glyphStartIndex+I.numGlyphs,xe=I.lineStartIndex,ze=I.lineStartIndex+I.lineLength,Fe=d.getoffsetX(I.glyphStartIndex),Ye=d.getoffsetX(ve-1),Pe=oa(f*Fe,h,g,w,C,T,I.segment,xe,ze,Z,$,le);if(!Pe)return null;var $e=oa(f*Ye,h,g,w,C,T,I.segment,xe,ze,Z,$,le);return $e?{first:Pe,last:$e}:null}function ha(f,d,h,g){return f===y.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*g?{useVertical:!0}:(f===y.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function Su(f,d,h,g,w,C,T,I,Z,$,le,ve,xe,ze){var Fe,Ye=d/24,Pe=f.lineOffsetX*Ye,$e=f.lineOffsetY*Ye;if(f.numGlyphs>1){var it=f.glyphStartIndex+f.numGlyphs,Mt=f.lineStartIndex,jt=f.lineStartIndex+f.lineLength,Ut=Ki(Ye,I,Pe,$e,h,le,ve,f,Z,C,xe);if(!Ut)return{notEnoughRoom:!0};var $t=fi(Ut.first.point,T).point,pr=fi(Ut.last.point,T).point;if(g&&!h){var zr=ha(f.writingMode,$t,pr,ze);if(zr)return zr}Fe=[Ut.first];for(var Rr=f.glyphStartIndex+1;Rr<it-1;Rr++)Fe.push(oa(Ye*I.getoffsetX(Rr),Pe,$e,h,le,ve,f.segment,Mt,jt,Z,C,xe));Fe.push(Ut.last)}else{if(g&&!h){var an=fi(ve,w).point,Tn=f.lineStartIndex+f.segment+1,In=new y.Point(Z.getx(Tn),Z.gety(Tn)),On=fi(In,w),Mi=On.signedDistanceFromCamera>0?On.point:wu(ve,In,an,1,w),cn=ha(f.writingMode,an,Mi,ze);if(cn)return cn}var Qn=oa(Ye*I.getoffsetX(f.glyphStartIndex),Pe,$e,h,le,ve,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,Z,C,xe);if(!Qn)return{notEnoughRoom:!0};Fe=[Qn]}for(var ni=0,ei=Fe;ni<ei.length;ni+=1){var qn=ei[ni];y.addDynamicAttributes($,qn.point,qn.angle)}return{}}function wu(f,d,h,g,w){var C=fi(f.add(f.sub(d)._unit()),w).point,T=h.sub(C);return h.add(T._mult(g/T.mag()))}function oa(f,d,h,g,w,C,T,I,Z,$,le,ve){var xe=g?f-d:f+d,ze=xe>0?1:-1,Fe=0;g&&(ze*=-1,Fe=Math.PI),ze<0&&(Fe+=Math.PI);for(var Ye=ze>0?I+T:I+T+1,Pe=w,$e=w,it=0,Mt=0,jt=Math.abs(xe),Ut=[];it+Mt<=jt;){if((Ye+=ze)<I||Ye>=Z)return null;if($e=Pe,Ut.push(Pe),(Pe=ve[Ye])===void 0){var $t=new y.Point($.getx(Ye),$.gety(Ye)),pr=fi($t,le);if(pr.signedDistanceFromCamera>0)Pe=ve[Ye]=pr.point;else{var zr=Ye-ze;Pe=wu(it===0?C:new y.Point($.getx(zr),$.gety(zr)),$t,$e,jt-it+1,le)}}it+=Mt,Mt=$e.dist(Pe)}var Rr=(jt-it)/Mt,an=Pe.sub($e),Tn=an.mult(Rr)._add($e);Tn._add(an._unit()._perp()._mult(h*ze));var In=Fe+Math.atan2(Pe.y-$e.y,Pe.x-$e.x);return Ut.push(Tn),{point:Tn,angle:In,path:Ut}}Ui.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ui.prototype.insert=function(f,d,h,g,w){this._forEachCell(d,h,g,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(f),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(w)},Ui.prototype.insertCircle=function(f,d,h,g){this._forEachCell(d-g,h-g,d+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(f),this.circles.push(d),this.circles.push(h),this.circles.push(g)},Ui.prototype._insertBoxCell=function(f,d,h,g,w,C){this.boxCells[w].push(C)},Ui.prototype._insertCircleCell=function(f,d,h,g,w,C){this.circleCells[w].push(C)},Ui.prototype._query=function(f,d,h,g,w,C){if(h<0||f>this.width||g<0||d>this.height)return!w&&[];var T=[];if(f<=0&&d<=0&&this.width<=h&&this.height<=g){if(w)return!0;for(var I=0;I<this.boxKeys.length;I++)T.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(var Z=0;Z<this.circleKeys.length;Z++){var $=this.circles[3*Z],le=this.circles[3*Z+1],ve=this.circles[3*Z+2];T.push({key:this.circleKeys[Z],x1:$-ve,y1:le-ve,x2:$+ve,y2:le+ve})}return C?T.filter(C):T}return this._forEachCell(f,d,h,g,this._queryCell,T,{hitTest:w,seenUids:{box:{},circle:{}}},C),w?T.length>0:T},Ui.prototype._queryCircle=function(f,d,h,g,w){var C=f-h,T=f+h,I=d-h,Z=d+h;if(T<0||C>this.width||Z<0||I>this.height)return!g&&[];var $=[];return this._forEachCell(C,I,T,Z,this._queryCellCircle,$,{hitTest:g,circle:{x:f,y:d,radius:h},seenUids:{box:{},circle:{}}},w),g?$.length>0:$},Ui.prototype.query=function(f,d,h,g,w){return this._query(f,d,h,g,!1,w)},Ui.prototype.hitTest=function(f,d,h,g,w){return this._query(f,d,h,g,!0,w)},Ui.prototype.hitTestCircle=function(f,d,h,g){return this._queryCircle(f,d,h,!0,g)},Ui.prototype._queryCell=function(f,d,h,g,w,C,T,I){var Z=T.seenUids,$=this.boxCells[w];if($!==null)for(var le=this.bboxes,ve=0,xe=$;ve<xe.length;ve+=1){var ze=xe[ve];if(!Z.box[ze]){Z.box[ze]=!0;var Fe=4*ze;if(f<=le[Fe+2]&&d<=le[Fe+3]&&h>=le[Fe+0]&&g>=le[Fe+1]&&(!I||I(this.boxKeys[ze]))){if(T.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[ze],x1:le[Fe],y1:le[Fe+1],x2:le[Fe+2],y2:le[Fe+3]})}}}var Ye=this.circleCells[w];if(Ye!==null)for(var Pe=this.circles,$e=0,it=Ye;$e<it.length;$e+=1){var Mt=it[$e];if(!Z.circle[Mt]){Z.circle[Mt]=!0;var jt=3*Mt;if(this._circleAndRectCollide(Pe[jt],Pe[jt+1],Pe[jt+2],f,d,h,g)&&(!I||I(this.circleKeys[Mt]))){if(T.hitTest)return C.push(!0),!0;var Ut=Pe[jt],$t=Pe[jt+1],pr=Pe[jt+2];C.push({key:this.circleKeys[Mt],x1:Ut-pr,y1:$t-pr,x2:Ut+pr,y2:$t+pr})}}}},Ui.prototype._queryCellCircle=function(f,d,h,g,w,C,T,I){var Z=T.circle,$=T.seenUids,le=this.boxCells[w];if(le!==null)for(var ve=this.bboxes,xe=0,ze=le;xe<ze.length;xe+=1){var Fe=ze[xe];if(!$.box[Fe]){$.box[Fe]=!0;var Ye=4*Fe;if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,ve[Ye+0],ve[Ye+1],ve[Ye+2],ve[Ye+3])&&(!I||I(this.boxKeys[Fe])))return C.push(!0),!0}}var Pe=this.circleCells[w];if(Pe!==null)for(var $e=this.circles,it=0,Mt=Pe;it<Mt.length;it+=1){var jt=Mt[it];if(!$.circle[jt]){$.circle[jt]=!0;var Ut=3*jt;if(this._circlesCollide($e[Ut],$e[Ut+1],$e[Ut+2],Z.x,Z.y,Z.radius)&&(!I||I(this.circleKeys[jt])))return C.push(!0),!0}}},Ui.prototype._forEachCell=function(f,d,h,g,w,C,T,I){for(var Z=this._convertToXCellCoord(f),$=this._convertToYCellCoord(d),le=this._convertToXCellCoord(h),ve=this._convertToYCellCoord(g),xe=Z;xe<=le;xe++)for(var ze=$;ze<=ve;ze++)if(w.call(this,f,d,h,g,this.xCellCount*ze+xe,C,T,I))return},Ui.prototype._convertToXCellCoord=function(f){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(f*this.xScale)))},Ui.prototype._convertToYCellCoord=function(f){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(f*this.yScale)))},Ui.prototype._circlesCollide=function(f,d,h,g,w,C){var T=g-f,I=w-d,Z=h+C;return Z*Z>T*T+I*I},Ui.prototype._circleAndRectCollide=function(f,d,h,g,w,C,T){var I=(C-g)/2,Z=Math.abs(f-(g+I));if(Z>I+h)return!1;var $=(T-w)/2,le=Math.abs(d-(w+$));if(le>$+h)return!1;if(Z<=I||le<=$)return!0;var ve=Z-I,xe=le-$;return ve*ve+xe*xe<=h*h};var vo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Hn(f,d){for(var h=0;h<f;h++){var g=d.length;d.resize(g+4),d.float32.set(vo,3*g)}}function ra(f,d,h){var g=d[0],w=d[1];return f[0]=h[0]*g+h[4]*w+h[12],f[1]=h[1]*g+h[5]*w+h[13],f[3]=h[3]*g+h[7]*w+h[15],f}var Ea=function(f,d,h){d===void 0&&(d=new Ui(f.width+200,f.height+200,25)),h===void 0&&(h=new Ui(f.width+200,f.height+200,25)),this.transform=f,this.grid=d,this.ignoredGrid=h,this.pitchfactor=Math.cos(f._pitch)*f.cameraToCenterDistance,this.screenRightBoundary=f.width+100,this.screenBottomBoundary=f.height+100,this.gridRightBoundary=f.width+200,this.gridBottomBoundary=f.height+200};function zi(f,d,h){return d*(y.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}Ea.prototype.placeCollisionBox=function(f,d,h,g,w){var C=this.projectAndGetPerspectiveRatio(g,f.anchorPointX,f.anchorPointY),T=h*C.perspectiveRatio,I=f.x1*T+C.point.x,Z=f.y1*T+C.point.y,$=f.x2*T+C.point.x,le=f.y2*T+C.point.y;return!this.isInsideGrid(I,Z,$,le)||!d&&this.grid.hitTest(I,Z,$,le,w)?{box:[],offscreen:!1}:{box:[I,Z,$,le],offscreen:this.isOffscreen(I,Z,$,le)}},Ea.prototype.placeCollisionCircles=function(f,d,h,g,w,C,T,I,Z,$,le,ve,xe){var ze=[],Fe=new y.Point(d.anchorX,d.anchorY),Ye=fi(Fe,C),Pe=vi(this.transform.cameraToCenterDistance,Ye.signedDistanceFromCamera),$e=($?w/Pe:w*Pe)/y.ONE_EM,it=fi(Fe,T).point,Mt=Ki($e,g,d.lineOffsetX*$e,d.lineOffsetY*$e,!1,it,Fe,d,h,T,{}),jt=!1,Ut=!1,$t=!0;if(Mt){for(var pr=.5*ve*Pe+xe,zr=new y.Point(-100,-100),Rr=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),an=new ao,Tn=Mt.first,In=Mt.last,On=[],Mi=Tn.path.length-1;Mi>=1;Mi--)On.push(Tn.path[Mi]);for(var cn=1;cn<In.path.length;cn++)On.push(In.path[cn]);var Qn=2.5*pr;if(I){var ni=On.map(function(Es){return fi(Es,I)});On=ni.some(function(Es){return Es.signedDistanceFromCamera<=0})?[]:ni.map(function(Es){return Es.point})}var ei=[];if(On.length>0){for(var qn=On[0].clone(),ai=On[0].clone(),Yn=1;Yn<On.length;Yn++)qn.x=Math.min(qn.x,On[Yn].x),qn.y=Math.min(qn.y,On[Yn].y),ai.x=Math.max(ai.x,On[Yn].x),ai.y=Math.max(ai.y,On[Yn].y);ei=qn.x>=zr.x&&ai.x<=Rr.x&&qn.y>=zr.y&&ai.y<=Rr.y?[On]:ai.x<zr.x||qn.x>Rr.x||ai.y<zr.y||qn.y>Rr.y?[]:y.clipLine([On],zr.x,zr.y,Rr.x,Rr.y)}for(var Zn=0,Ka=ei;Zn<Ka.length;Zn+=1){var _a;an.reset(Ka[Zn],.25*pr),_a=an.length<=.5*pr?1:Math.ceil(an.paddedLength/Qn)+1;for(var _o=0;_o<_a;_o++){var Ja=_o/Math.max(_a-1,1),xa=an.lerp(Ja),za=xa.x+100,Uo=xa.y+100;ze.push(za,Uo,pr,0);var Vo=za-pr,el=Uo-pr,Po=za+pr,ws=Uo+pr;if($t=$t&&this.isOffscreen(Vo,el,Po,ws),Ut=Ut||this.isInsideGrid(Vo,el,Po,ws),!f&&this.grid.hitTestCircle(za,Uo,pr,le)&&(jt=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:jt}}}}return{circles:!Z&&jt||!Ut?[]:ze,offscreen:$t,collisionDetected:jt}},Ea.prototype.queryRenderedSymbols=function(f){if(f.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,g=1/0,w=-1/0,C=-1/0,T=0,I=f;T<I.length;T+=1){var Z=I[T],$=new y.Point(Z.x+100,Z.y+100);h=Math.min(h,$.x),g=Math.min(g,$.y),w=Math.max(w,$.x),C=Math.max(C,$.y),d.push($)}for(var le={},ve={},xe=0,ze=this.grid.query(h,g,w,C).concat(this.ignoredGrid.query(h,g,w,C));xe<ze.length;xe+=1){var Fe=ze[xe],Ye=Fe.key;if(le[Ye.bucketInstanceId]===void 0&&(le[Ye.bucketInstanceId]={}),!le[Ye.bucketInstanceId][Ye.featureIndex]){var Pe=[new y.Point(Fe.x1,Fe.y1),new y.Point(Fe.x2,Fe.y1),new y.Point(Fe.x2,Fe.y2),new y.Point(Fe.x1,Fe.y2)];y.polygonIntersectsPolygon(d,Pe)&&(le[Ye.bucketInstanceId][Ye.featureIndex]=!0,ve[Ye.bucketInstanceId]===void 0&&(ve[Ye.bucketInstanceId]=[]),ve[Ye.bucketInstanceId].push(Ye.featureIndex))}}return ve},Ea.prototype.insertCollisionBox=function(f,d,h,g,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:w},f[0],f[1],f[2],f[3])},Ea.prototype.insertCollisionCircles=function(f,d,h,g,w){for(var C=d?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:g,collisionGroupID:w},I=0;I<f.length;I+=4)C.insertCircle(T,f[I],f[I+1],f[I+2])},Ea.prototype.projectAndGetPerspectiveRatio=function(f,d,h){var g=[d,h,0,1];return ra(g,g,f),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},Ea.prototype.isOffscreen=function(f,d,h,g){return h<100||f>=this.screenRightBoundary||g<100||d>this.screenBottomBoundary},Ea.prototype.isInsideGrid=function(f,d,h,g){return h>=0&&f<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary},Ea.prototype.getViewportMatrix=function(){var f=y.identity([]);return y.translate(f,f,[-100,-100,0]),f};var To=function(f,d,h,g){this.opacity=f?Math.max(0,Math.min(1,f.opacity+(f.placed?d:-d))):g&&h?1:0,this.placed=h};To.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var mo=function(f,d,h,g,w){this.text=new To(f?f.text:null,d,h,w),this.icon=new To(f?f.icon:null,d,g,w)};mo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ds=function(f,d,h){this.text=f,this.icon=d,this.skipFade=h},is=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},Fl=function(f,d,h,g,w){this.bucketInstanceId=f,this.featureIndex=d,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=w},Xo=function(f){this.crossSourceCollisions=f,this.maxGroupID=0,this.collisionGroups={}};function la(f,d,h,g,w){var C=y.getAnchorAlignment(f),T=-(C.horizontalAlign-.5)*d,I=-(C.verticalAlign-.5)*h,Z=y.evaluateVariableOffset(f,g);return new y.Point(T+Z[0]*w,I+Z[1]*w)}function ga(f,d,h,g,w,C){var T=f.x1,I=f.x2,Z=f.y1,$=f.y2,le=f.anchorPointX,ve=f.anchorPointY,xe=new y.Point(d,h);return g&&xe._rotate(w?C:-C),{x1:T+xe.x,y1:Z+xe.y,x2:I+xe.x,y2:$+xe.y,anchorPointX:le,anchorPointY:ve}}Xo.prototype.get=function(f){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[f]){var d=++this.maxGroupID;this.collisionGroups[f]={ID:d,predicate:function(h){return h.collisionGroupID===d}}}return this.collisionGroups[f]};var cr=function(f,d,h,g){this.transform=f.clone(),this.collisionIndex=new Ea(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Xo(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function K(f,d,h,g,w){f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0)}cr.prototype.getBucketParts=function(f,d,h,g){var w=h.getBucket(d),C=h.latestFeatureIndex;if(w&&C&&d.id===w.layerIds[0]){var T=h.collisionBoxArray,I=w.layers[0].layout,Z=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),$=h.tileSize/y.EXTENT,le=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),ve=I.get("text-pitch-alignment")==="map",xe=I.get("text-rotation-alignment")==="map",ze=zi(h,1,this.transform.zoom),Fe=aa(le,ve,xe,this.transform,ze),Ye=null;if(ve){var Pe=bi(le,ve,xe,this.transform,ze);Ye=y.multiply([],this.transform.labelPlaneMatrix,Pe)}this.retainedQueryData[w.bucketInstanceId]=new Fl(w.bucketInstanceId,C,w.sourceLayerIndex,w.index,h.tileID);var $e={bucket:w,layout:I,posMatrix:le,textLabelPlaneMatrix:Fe,labelToScreenMatrix:Ye,scale:Z,textPixelRatio:$,holdingForFade:h.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(g)for(var it=0,Mt=w.sortKeyRanges;it<Mt.length;it+=1){var jt=Mt[it];f.push({sortKey:jt.sortKey,symbolInstanceStart:jt.symbolInstanceStart,symbolInstanceEnd:jt.symbolInstanceEnd,parameters:$e})}else f.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:$e})}},cr.prototype.attemptAnchorPlacement=function(f,d,h,g,w,C,T,I,Z,$,le,ve,xe,ze,Fe){var Ye,Pe=[ve.textOffset0,ve.textOffset1],$e=la(f,h,g,Pe,w),it=this.collisionIndex.placeCollisionBox(ga(d,$e.x,$e.y,C,T,this.transform.angle),le,I,Z,$.predicate);if(!Fe||this.collisionIndex.placeCollisionBox(ga(Fe,$e.x,$e.y,C,T,this.transform.angle),le,I,Z,$.predicate).box.length!==0)return it.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ve.crossTileID]&&this.prevPlacement.placements[ve.crossTileID]&&this.prevPlacement.placements[ve.crossTileID].text&&(Ye=this.prevPlacement.variableOffsets[ve.crossTileID].anchor),this.variableOffsets[ve.crossTileID]={textOffset:Pe,width:h,height:g,anchor:f,textBoxScale:w,prevAnchor:Ye},this.markUsedJustification(xe,f,ve,ze),xe.allowVerticalPlacement&&(this.markUsedOrientation(xe,ze,ve),this.placedOrientations[ve.crossTileID]=ze),{shift:$e,placedGlyphBoxes:it}):void 0},cr.prototype.placeLayerBucketPart=function(f,d,h){var g=this,w=f.parameters,C=w.bucket,T=w.layout,I=w.posMatrix,Z=w.textLabelPlaneMatrix,$=w.labelToScreenMatrix,le=w.textPixelRatio,ve=w.holdingForFade,xe=w.collisionBoxArray,ze=w.partiallyEvaluatedTextSize,Fe=w.collisionGroup,Ye=T.get("text-optional"),Pe=T.get("icon-optional"),$e=T.get("text-allow-overlap"),it=T.get("icon-allow-overlap"),Mt=T.get("text-rotation-alignment")==="map",jt=T.get("text-pitch-alignment")==="map",Ut=T.get("icon-text-fit")!=="none",$t=T.get("symbol-z-order")==="viewport-y",pr=$e&&(it||!C.hasIconData()||Pe),zr=it&&($e||!C.hasTextData()||Ye);!C.collisionArrays&&xe&&C.deserializeCollisionBoxes(xe);var Rr=function(cn,Qn){if(!d[cn.crossTileID])if(ve)g.placements[cn.crossTileID]=new Ds(!1,!1,!1);else{var ni,ei=!1,qn=!1,ai=!0,Yn=null,Zn={box:null,offscreen:null},Ka={box:null,offscreen:null},_a=null,_o=null,Ja=0,xa=0,za=0;Qn.textFeatureIndex?Ja=Qn.textFeatureIndex:cn.useRuntimeCollisionCircles&&(Ja=cn.featureIndex),Qn.verticalTextFeatureIndex&&(xa=Qn.verticalTextFeatureIndex);var Uo=Qn.textBox;if(Uo){var Vo=function(Oi){var Ao=y.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Oi&&g.prevPlacement){var Qa=g.prevPlacement.placedOrientations[cn.crossTileID];Qa&&(g.placedOrientations[cn.crossTileID]=Qa,g.markUsedOrientation(C,Ao=Qa,cn))}return Ao},el=function(Oi,Ao){if(C.allowVerticalPlacement&&cn.numVerticalGlyphVertices>0&&Qn.verticalTextBox)for(var Qa=0,As=C.writingModes;Qa<As.length&&(As[Qa]===y.WritingMode.vertical?(Zn=Ao(),Ka=Zn):Zn=Oi(),!(Zn&&Zn.box&&Zn.box.length));Qa+=1);else Zn=Oi()};if(T.get("text-variable-anchor")){var Po=T.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[cn.crossTileID]){var ws=g.prevPlacement.variableOffsets[cn.crossTileID];Po.indexOf(ws.anchor)>0&&(Po=Po.filter(function(Oi){return Oi!==ws.anchor})).unshift(ws.anchor)}var Es=function(Oi,Ao,Qa){for(var As=Oi.x2-Oi.x1,ku=Oi.y2-Oi.y1,$s=cn.textBoxScale,Sl=Ut&&!it?Ao:null,xo={box:[],offscreen:!1},Ir=$e?2*Po.length:Po.length,Cs=0;Cs<Ir;++Cs){var wc=g.attemptAnchorPlacement(Po[Cs%Po.length],Oi,As,ku,$s,Mt,jt,le,I,Fe,Cs>=Po.length,cn,C,Qa,Sl);if(wc&&(xo=wc.placedGlyphBoxes)&&xo.box&&xo.box.length){ei=!0,Yn=wc.shift;break}}return xo};el(function(){return Es(Uo,Qn.iconBox,y.WritingMode.horizontal)},function(){var Oi=Qn.verticalTextBox;return C.allowVerticalPlacement&&!(Zn&&Zn.box&&Zn.box.length)&&cn.numVerticalGlyphVertices>0&&Oi?Es(Oi,Qn.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),Zn&&(ei=Zn.box,ai=Zn.offscreen);var xl=Vo(Zn&&Zn.box);if(!ei&&g.prevPlacement){var du=g.prevPlacement.variableOffsets[cn.crossTileID];du&&(g.variableOffsets[cn.crossTileID]=du,g.markUsedJustification(C,du.anchor,cn,xl))}}else{var vu=function(Oi,Ao){var Qa=g.collisionIndex.placeCollisionBox(Oi,$e,le,I,Fe.predicate);return Qa&&Qa.box&&Qa.box.length&&(g.markUsedOrientation(C,Ao,cn),g.placedOrientations[cn.crossTileID]=Ao),Qa};el(function(){return vu(Uo,y.WritingMode.horizontal)},function(){var Oi=Qn.verticalTextBox;return C.allowVerticalPlacement&&cn.numVerticalGlyphVertices>0&&Oi?vu(Oi,y.WritingMode.vertical):{box:null,offscreen:null}}),Vo(Zn&&Zn.box&&Zn.box.length)}}if(ei=(ni=Zn)&&ni.box&&ni.box.length>0,ai=ni&&ni.offscreen,cn.useRuntimeCollisionCircles){var bl=C.text.placedSymbolArray.get(cn.centerJustifiedTextSymbolIndex),Kl=y.evaluateSizeForFeature(C.textSizeData,ze,bl),Ws=T.get("text-padding");_a=g.collisionIndex.placeCollisionCircles($e,bl,C.lineVertexArray,C.glyphOffsetArray,Kl,I,Z,$,h,jt,Fe.predicate,cn.collisionCircleDiameter,Ws),ei=$e||_a.circles.length>0&&!_a.collisionDetected,ai=ai&&_a.offscreen}if(Qn.iconFeatureIndex&&(za=Qn.iconFeatureIndex),Qn.iconBox){var tl=function(Oi){var Ao=Ut&&Yn?ga(Oi,Yn.x,Yn.y,Mt,jt,g.transform.angle):Oi;return g.collisionIndex.placeCollisionBox(Ao,it,le,I,Fe.predicate)};qn=Ka&&Ka.box&&Ka.box.length&&Qn.verticalIconBox?(_o=tl(Qn.verticalIconBox)).box.length>0:(_o=tl(Qn.iconBox)).box.length>0,ai=ai&&_o.offscreen}var fs=Ye||cn.numHorizontalGlyphVertices===0&&cn.numVerticalGlyphVertices===0,Na=Pe||cn.numIconVertices===0;if(fs||Na?Na?fs||(qn=qn&&ei):ei=qn&&ei:qn=ei=qn&&ei,ei&&ni&&ni.box&&g.collisionIndex.insertCollisionBox(ni.box,T.get("text-ignore-placement"),C.bucketInstanceId,Ka&&Ka.box&&xa?xa:Ja,Fe.ID),qn&&_o&&g.collisionIndex.insertCollisionBox(_o.box,T.get("icon-ignore-placement"),C.bucketInstanceId,za,Fe.ID),_a&&(ei&&g.collisionIndex.insertCollisionCircles(_a.circles,T.get("text-ignore-placement"),C.bucketInstanceId,Ja,Fe.ID),h)){var mu=C.bucketInstanceId,ru=g.collisionCircleArrays[mu];ru===void 0&&(ru=g.collisionCircleArrays[mu]=new is);for(var ts=0;ts<_a.circles.length;ts+=4)ru.circles.push(_a.circles[ts+0]),ru.circles.push(_a.circles[ts+1]),ru.circles.push(_a.circles[ts+2]),ru.circles.push(_a.collisionDetected?1:0)}g.placements[cn.crossTileID]=new Ds(ei||pr,qn||zr,ai||C.justReloaded),d[cn.crossTileID]=!0}};if($t)for(var an=C.getSortedSymbolIndexes(this.transform.angle),Tn=an.length-1;Tn>=0;--Tn){var In=an[Tn];Rr(C.symbolInstances.get(In),C.collisionArrays[In])}else for(var On=f.symbolInstanceStart;On<f.symbolInstanceEnd;On++)Rr(C.symbolInstances.get(On),C.collisionArrays[On]);if(h&&C.bucketInstanceId in this.collisionCircleArrays){var Mi=this.collisionCircleArrays[C.bucketInstanceId];y.invert(Mi.invProjMatrix,I),Mi.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},cr.prototype.markUsedJustification=function(f,d,h,g){var w;w=g===y.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(d)];for(var C=0,T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];C<T.length;C+=1){var I=T[C];I>=0&&(f.text.placedSymbolArray.get(I).crossTileID=w>=0&&I!==w?0:h.crossTileID)}},cr.prototype.markUsedOrientation=function(f,d,h){for(var g=d===y.WritingMode.horizontal||d===y.WritingMode.horizontalOnly?d:0,w=d===y.WritingMode.vertical?d:0,C=0,T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];C<T.length;C+=1)f.text.placedSymbolArray.get(T[C]).placedOrientation=g;h.verticalPlacedTextSymbolIndex&&(f.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=w)},cr.prototype.commit=function(f){this.commitTime=f,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var g=d?d.symbolFadeChange(f):1,w=d?d.opacities:{},C=d?d.variableOffsets:{},T=d?d.placedOrientations:{};for(var I in this.placements){var Z=this.placements[I],$=w[I];$?(this.opacities[I]=new mo($,g,Z.text,Z.icon),h=h||Z.text!==$.text.placed||Z.icon!==$.icon.placed):(this.opacities[I]=new mo(null,g,Z.text,Z.icon,Z.skipFade),h=h||Z.text||Z.icon)}for(var le in w){var ve=w[le];if(!this.opacities[le]){var xe=new mo(ve,g,!1,!1);xe.isHidden()||(this.opacities[le]=xe,h=h||ve.text.placed||ve.icon.placed)}}for(var ze in C)this.variableOffsets[ze]||!this.opacities[ze]||this.opacities[ze].isHidden()||(this.variableOffsets[ze]=C[ze]);for(var Fe in T)this.placedOrientations[Fe]||!this.opacities[Fe]||this.opacities[Fe].isHidden()||(this.placedOrientations[Fe]=T[Fe]);h?this.lastPlacementChangeTime=f:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:f)},cr.prototype.updateLayerOpacities=function(f,d){for(var h={},g=0,w=d;g<w.length;g+=1){var C=w[g],T=C.getBucket(f);T&&C.latestFeatureIndex&&f.id===T.layerIds[0]&&this.updateBucketOpacities(T,h,C.collisionBoxArray)}},cr.prototype.updateBucketOpacities=function(f,d,h){var g=this;f.hasTextData()&&f.text.opacityVertexArray.clear(),f.hasIconData()&&f.icon.opacityVertexArray.clear(),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexArray.clear(),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexArray.clear();var w=f.layers[0].layout,C=new mo(null,0,!1,!1,!0),T=w.get("text-allow-overlap"),I=w.get("icon-allow-overlap"),Z=w.get("text-variable-anchor"),$=w.get("text-rotation-alignment")==="map",le=w.get("text-pitch-alignment")==="map",ve=w.get("icon-text-fit")!=="none",xe=new mo(null,0,T&&(I||!f.hasIconData()||w.get("icon-optional")),I&&(T||!f.hasTextData()||w.get("text-optional")),!0);!f.collisionArrays&&h&&(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData())&&f.deserializeCollisionBoxes(h);for(var ze=function($e,it,Mt){for(var jt=0;jt<it/4;jt++)$e.opacityVertexArray.emplaceBack(Mt)},Fe=function($e){var it=f.symbolInstances.get($e),Mt=it.numHorizontalGlyphVertices,jt=it.numVerticalGlyphVertices,Ut=it.crossTileID,$t=g.opacities[Ut];d[Ut]?$t=C:$t||(g.opacities[Ut]=$t=xe),d[Ut]=!0;var pr=it.numIconVertices>0,zr=g.placedOrientations[it.crossTileID],Rr=zr===y.WritingMode.vertical,an=zr===y.WritingMode.horizontal||zr===y.WritingMode.horizontalOnly;if(Mt>0||jt>0){var Tn=oo($t.text);ze(f.text,Mt,Rr?Ua:Tn),ze(f.text,jt,an?Ua:Tn);var In=$t.text.isHidden();[it.rightJustifiedTextSymbolIndex,it.centerJustifiedTextSymbolIndex,it.leftJustifiedTextSymbolIndex].forEach(function(Zn){Zn>=0&&(f.text.placedSymbolArray.get(Zn).hidden=In||Rr?1:0)}),it.verticalPlacedTextSymbolIndex>=0&&(f.text.placedSymbolArray.get(it.verticalPlacedTextSymbolIndex).hidden=In||an?1:0);var On=g.variableOffsets[it.crossTileID];On&&g.markUsedJustification(f,On.anchor,it,zr);var Mi=g.placedOrientations[it.crossTileID];Mi&&(g.markUsedJustification(f,"left",it,Mi),g.markUsedOrientation(f,Mi,it))}if(pr){var cn=oo($t.icon),Qn=!(ve&&it.verticalPlacedIconSymbolIndex&&Rr);it.placedIconSymbolIndex>=0&&(ze(f.icon,it.numIconVertices,Qn?cn:Ua),f.icon.placedSymbolArray.get(it.placedIconSymbolIndex).hidden=$t.icon.isHidden()),it.verticalPlacedIconSymbolIndex>=0&&(ze(f.icon,it.numVerticalIconVertices,Qn?Ua:cn),f.icon.placedSymbolArray.get(it.verticalPlacedIconSymbolIndex).hidden=$t.icon.isHidden())}if(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData()){var ni=f.collisionArrays[$e];if(ni){var ei=new y.Point(0,0);if(ni.textBox||ni.verticalTextBox){var qn=!0;if(Z){var ai=g.variableOffsets[Ut];ai?(ei=la(ai.anchor,ai.width,ai.height,ai.textOffset,ai.textBoxScale),$&&ei._rotate(le?g.transform.angle:-g.transform.angle)):qn=!1}ni.textBox&&K(f.textCollisionBox.collisionVertexArray,$t.text.placed,!qn||Rr,ei.x,ei.y),ni.verticalTextBox&&K(f.textCollisionBox.collisionVertexArray,$t.text.placed,!qn||an,ei.x,ei.y)}var Yn=Boolean(!an&&ni.verticalIconBox);ni.iconBox&&K(f.iconCollisionBox.collisionVertexArray,$t.icon.placed,Yn,ve?ei.x:0,ve?ei.y:0),ni.verticalIconBox&&K(f.iconCollisionBox.collisionVertexArray,$t.icon.placed,!Yn,ve?ei.x:0,ve?ei.y:0)}}},Ye=0;Ye<f.symbolInstances.length;Ye++)Fe(Ye);if(f.sortFeatures(this.transform.angle),this.retainedQueryData[f.bucketInstanceId]&&(this.retainedQueryData[f.bucketInstanceId].featureSortOrder=f.featureSortOrder),f.hasTextData()&&f.text.opacityVertexBuffer&&f.text.opacityVertexBuffer.updateData(f.text.opacityVertexArray),f.hasIconData()&&f.icon.opacityVertexBuffer&&f.icon.opacityVertexBuffer.updateData(f.icon.opacityVertexArray),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexBuffer&&f.iconCollisionBox.collisionVertexBuffer.updateData(f.iconCollisionBox.collisionVertexArray),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexBuffer&&f.textCollisionBox.collisionVertexBuffer.updateData(f.textCollisionBox.collisionVertexArray),f.bucketInstanceId in this.collisionCircleArrays){var Pe=this.collisionCircleArrays[f.bucketInstanceId];f.placementInvProjMatrix=Pe.invProjMatrix,f.placementViewportMatrix=Pe.viewportMatrix,f.collisionCircleArray=Pe.circles,delete this.collisionCircleArrays[f.bucketInstanceId]}},cr.prototype.symbolFadeChange=function(f){return this.fadeDuration===0?1:(f-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},cr.prototype.zoomAdjustment=function(f){return Math.max(0,(this.transform.zoom-f)/1.5)},cr.prototype.hasTransitions=function(f){return this.stale||f-this.lastPlacementChangeTime<this.fadeDuration},cr.prototype.stillRecent=function(f,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>f},cr.prototype.setStale=function(){this.stale=!0};var Me=Math.pow(2,25),nt=Math.pow(2,24),Jt=Math.pow(2,17),Vr=Math.pow(2,16),Mn=Math.pow(2,9),Ri=Math.pow(2,8),Pa=Math.pow(2,1);function oo(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;var d=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Me+d*nt+h*Jt+d*Vr+h*Mn+d*Ri+h*Pa+d}var Ua=0,as=function(f){this._sortAcrossTiles=f.layout.get("symbol-z-order")!=="viewport-y"&&f.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};as.prototype.continuePlacement=function(f,d,h,g,w){for(var C=this._bucketParts;this._currentTileIndex<f.length;)if(d.getBucketParts(C,g,f[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(T,I){return T.sortKey-I.sortKey}));this._currentPartIndex<C.length;)if(d.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,w())return!0;return!1};var sc=function(f,d,h,g,w,C,T){this.placement=new cr(f,w,C,T),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1};sc.prototype.isDone=function(){return this._done},sc.prototype.continuePlacement=function(f,d,h){for(var g=this,w=y.browser.now(),C=function(){var Z=y.browser.now()-w;return!g._forceFullPlacement&&Z>2};this._currentPlacementIndex>=0;){var T=d[f[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=I)&&(!T.maxzoom||T.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new as(T)),this._inProgressLayer.continuePlacement(h[T.source],this.placement,this._showCollisionBoxes,T,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},sc.prototype.commit=function(f){return this.placement.commit(f),this.placement};var Os=512/y.EXTENT/2,Uc=function(f,d,h){this.tileID=f,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var g=0;g<d.length;g++){var w=d.get(g),C=w.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,f)})}};Uc.prototype.getScaledCoordinates=function(f,d){var h=Os/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*y.EXTENT+f.anchorX)*h),y:Math.floor((d.canonical.y*y.EXTENT+f.anchorY)*h)}},Uc.prototype.findMatches=function(f,d,h){for(var g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),w=0;w<f.length;w++){var C=f.get(w);if(!C.crossTileID){var T=this.indexedSymbolInstances[C.key];if(T)for(var I=this.getScaledCoordinates(C,d),Z=0,$=T;Z<$.length;Z+=1){var le=$[Z];if(Math.abs(le.coord.x-I.x)<=g&&Math.abs(le.coord.y-I.y)<=g&&!h[le.crossTileID]){h[le.crossTileID]=!0,C.crossTileID=le.crossTileID;break}}}}};var Fs=function(){this.maxCrossTileID=0};Fs.prototype.generate=function(){return++this.maxCrossTileID};var Bu=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Bu.prototype.handleWrapJump=function(f){var d=Math.round((f-this.lng)/360);if(d!==0)for(var h in this.indexes){var g=this.indexes[h],w={};for(var C in g){var T=g[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+d),w[T.tileID.key]=T}this.indexes[h]=w}this.lng=f},Bu.prototype.addBucket=function(f,d,h){if(this.indexes[f.overscaledZ]&&this.indexes[f.overscaledZ][f.key]){if(this.indexes[f.overscaledZ][f.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(f.overscaledZ,this.indexes[f.overscaledZ][f.key])}for(var g=0;g<d.symbolInstances.length;g++)d.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[f.overscaledZ]||(this.usedCrossTileIDs[f.overscaledZ]={});var w=this.usedCrossTileIDs[f.overscaledZ];for(var C in this.indexes){var T=this.indexes[C];if(Number(C)>f.overscaledZ)for(var I in T){var Z=T[I];Z.tileID.isChildOf(f)&&Z.findMatches(d.symbolInstances,f,w)}else{var $=T[f.scaledTo(Number(C)).key];$&&$.findMatches(d.symbolInstances,f,w)}}for(var le=0;le<d.symbolInstances.length;le++){var ve=d.symbolInstances.get(le);ve.crossTileID||(ve.crossTileID=h.generate(),w[ve.crossTileID]=!0)}return this.indexes[f.overscaledZ]===void 0&&(this.indexes[f.overscaledZ]={}),this.indexes[f.overscaledZ][f.key]=new Uc(f,d.symbolInstances,d.bucketInstanceId),!0},Bu.prototype.removeBucketCrossTileIDs=function(f,d){for(var h in d.indexedSymbolInstances)for(var g=0,w=d.indexedSymbolInstances[h];g<w.length;g+=1)delete this.usedCrossTileIDs[f][w[g].crossTileID]},Bu.prototype.removeStaleBuckets=function(f){var d=!1;for(var h in this.indexes){var g=this.indexes[h];for(var w in g)f[g[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[w]),delete g[w],d=!0)}return d};var os=function(){this.layerIndexes={},this.crossTileIDs=new Fs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};os.prototype.addLayer=function(f,d,h){var g=this.layerIndexes[f.id];g===void 0&&(g=this.layerIndexes[f.id]=new Bu);var w=!1,C={};g.handleWrapJump(h);for(var T=0,I=d;T<I.length;T+=1){var Z=I[T],$=Z.getBucket(f);$&&f.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(Z.tileID,$,this.crossTileIDs)&&(w=!0),C[$.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(w=!0),w},os.prototype.pruneUnusedLayers=function(f){var d={};for(var h in f.forEach(function(g){d[g]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var ul=function(f,d){return y.emitValidationErrors(f,d&&d.filter(function(h){return h.identifier!=="source.canvas"}))},zu=y.pick(Yr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Js=y.pick(Yr,["setCenter","setZoom","setBearing","setPitch"]),Bl=function(){var f={},d=y.styleSpec.$version;for(var h in y.styleSpec.$root){var g,w=y.styleSpec.$root[h];w.required&&(g=h==="version"?d:w.type==="array"?[]:{})!=null&&(f[h]=g)}return f}(),Yo=function(f){function d(h,g){var w=this;g===void 0&&(g={}),f.call(this),this.map=h,this.dispatcher=new Kt(Qt(),this),this.imageManager=new qt,this.imageManager.setEventedParent(this),this.glyphManager=new lr(h._requestManager,g.localIdeographFontFamily),this.lineAtlas=new ft(256,512),this.crossTileSymbolIndex=new os,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var C=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(T){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(I,Z){if(y.triggerPluginCompletionEvent(I),Z&&Z.every(function(le){return le}))for(var $ in C.sourceCaches)C.sourceCaches[$].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var I=w.sourceCaches[T.sourceId];if(I){var Z=I.getSource();if(Z&&Z.vectorLayerIds)for(var $ in w._layers){var le=w._layers[$];le.source===Z.id&&w._validateLayer(le)}}}})}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.loadURL=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var C=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,g.accessToken);var T=this.map._requestManager.transformRequest(h,y.ResourceType.Style);this._request=y.getJSON(T,function(I,Z){w._request=null,I?w.fire(new y.ErrorEvent(I)):Z&&w._load(Z,C)})},d.prototype.loadJSON=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){w._request=null,w._load(h,g.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(Bl,!1)},d.prototype._load=function(h,g){if(!g||!ul(this,y.validateStyle(h))){for(var w in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(w,h.sources[w],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var C=Gr(this.stylesheet.layers);this._order=C.map(function($){return $.id}),this._layers={},this._serializedLayers={};for(var T=0,I=C;T<I.length;T+=1){var Z=I[T];(Z=y.createStyleLayer(Z)).setEventedParent(this,{layer:{id:Z.id}}),this._layers[Z.id]=Z,this._serializedLayers[Z.id]=Z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Rt(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},d.prototype._loadSprite=function(h){var g=this;this._spriteRequest=function(w,C,T){var I,Z,$,le=y.browser.devicePixelRatio>1?"@2x":"",ve=y.getJSON(C.transformRequest(C.normalizeSpriteURL(w,le,".json"),y.ResourceType.SpriteJSON),function(Fe,Ye){ve=null,$||($=Fe,I=Ye,ze())}),xe=y.getImage(C.transformRequest(C.normalizeSpriteURL(w,le,".png"),y.ResourceType.SpriteImage),function(Fe,Ye){xe=null,$||($=Fe,Z=Ye,ze())});function ze(){if($)T($);else if(I&&Z){var Fe=y.browser.getImageData(Z),Ye={};for(var Pe in I){var $e=I[Pe],it=$e.width,Mt=$e.height,jt=$e.x,Ut=$e.y,$t=$e.sdf,pr=$e.pixelRatio,zr=$e.stretchX,Rr=$e.stretchY,an=$e.content,Tn=new y.RGBAImage({width:it,height:Mt});y.RGBAImage.copy(Fe,Tn,{x:jt,y:Ut},{x:0,y:0},{width:it,height:Mt}),Ye[Pe]={data:Tn,pixelRatio:pr,sdf:$t,stretchX:zr,stretchY:Rr,content:an}}T(null,Ye)}}return{cancel:function(){ve&&(ve.cancel(),ve=null),xe&&(xe.cancel(),xe=null)}}}(h,this.map._requestManager,function(w,C){if(g._spriteRequest=null,w)g.fire(new y.ErrorEvent(w));else if(C)for(var T in C)g.imageManager.addImage(T,C[T]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var g=this.sourceCaches[h.source];if(g){var w=h.sourceLayer;if(w){var C=g.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(w)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+w+'" does not exist on source "'+C.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var g=[],w=0,C=h;w<C.length;w+=1){var T=this._layers[C[w]];T.type!=="custom"&&g.push(T.serialize())}return g},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var g=this._changed;if(this._changed){var w=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var T in(w.length||C.length)&&this._updateWorkerLayers(w,C),this._updatedSources){var I=this._updatedSources[T];I==="reload"?this._reloadSource(T):I==="clear"&&this._clearSource(T)}for(var Z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Z].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var $={};for(var le in this.sourceCaches){var ve=this.sourceCaches[le];$[le]=ve.used,ve.used=!1}for(var xe=0,ze=this._order;xe<ze.length;xe+=1){var Fe=this._layers[ze[xe]];Fe.recalculate(h,this._availableImages),!Fe.isHidden(h.zoom)&&Fe.source&&(this.sourceCaches[Fe.source].used=!0)}for(var Ye in $){var Pe=this.sourceCaches[Ye];$[Ye]!==Pe.used&&Pe.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ye}))}this.light.recalculate(h),this.z=h.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:g})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var g=this;if(this._checkLoaded(),ul(this,y.validateStyle(h)))return!1;(h=y.clone$1(h)).layers=Gr(h.layers);var w=function(T,I){if(!T)return[{command:Yr.setStyle,args:[I]}];var Z=[];try{if(!y.deepEqual(T.version,I.version))return[{command:Yr.setStyle,args:[I]}];y.deepEqual(T.center,I.center)||Z.push({command:Yr.setCenter,args:[I.center]}),y.deepEqual(T.zoom,I.zoom)||Z.push({command:Yr.setZoom,args:[I.zoom]}),y.deepEqual(T.bearing,I.bearing)||Z.push({command:Yr.setBearing,args:[I.bearing]}),y.deepEqual(T.pitch,I.pitch)||Z.push({command:Yr.setPitch,args:[I.pitch]}),y.deepEqual(T.sprite,I.sprite)||Z.push({command:Yr.setSprite,args:[I.sprite]}),y.deepEqual(T.glyphs,I.glyphs)||Z.push({command:Yr.setGlyphs,args:[I.glyphs]}),y.deepEqual(T.transition,I.transition)||Z.push({command:Yr.setTransition,args:[I.transition]}),y.deepEqual(T.light,I.light)||Z.push({command:Yr.setLight,args:[I.light]});var $={},le=[];(function(xe,ze,Fe,Ye){var Pe;for(Pe in ze=ze||{},xe=xe||{})xe.hasOwnProperty(Pe)&&(ze.hasOwnProperty(Pe)||qr(Pe,Fe,Ye));for(Pe in ze)ze.hasOwnProperty(Pe)&&(xe.hasOwnProperty(Pe)?y.deepEqual(xe[Pe],ze[Pe])||(xe[Pe].type==="geojson"&&ze[Pe].type==="geojson"&&Bi(xe,ze,Pe)?Fe.push({command:Yr.setGeoJSONSourceData,args:[Pe,ze[Pe].data]}):hi(Pe,ze,Fe,Ye)):li(Pe,ze,Fe))})(T.sources,I.sources,le,$);var ve=[];T.layers&&T.layers.forEach(function(xe){$[xe.source]?Z.push({command:Yr.removeLayer,args:[xe.id]}):ve.push(xe)}),Z=Z.concat(le),function(xe,ze,Fe){ze=ze||[];var Ye,Pe,$e,it,Mt,jt,Ut,$t=(xe=xe||[]).map(_i),pr=ze.map(_i),zr=xe.reduce(xi,{}),Rr=ze.reduce(xi,{}),an=$t.slice(),Tn=Object.create(null);for(Ye=0,Pe=0;Ye<$t.length;Ye++)Rr.hasOwnProperty($e=$t[Ye])?Pe++:(Fe.push({command:Yr.removeLayer,args:[$e]}),an.splice(an.indexOf($e,Pe),1));for(Ye=0,Pe=0;Ye<pr.length;Ye++)an[an.length-1-Ye]!==($e=pr[pr.length-1-Ye])&&(zr.hasOwnProperty($e)?(Fe.push({command:Yr.removeLayer,args:[$e]}),an.splice(an.lastIndexOf($e,an.length-Pe),1)):Pe++,Fe.push({command:Yr.addLayer,args:[Rr[$e],jt=an[an.length-Ye]]}),an.splice(an.length-Ye,0,$e),Tn[$e]=!0);for(Ye=0;Ye<pr.length;Ye++)if(it=zr[$e=pr[Ye]],Mt=Rr[$e],!Tn[$e]&&!y.deepEqual(it,Mt))if(y.deepEqual(it.source,Mt.source)&&y.deepEqual(it["source-layer"],Mt["source-layer"])&&y.deepEqual(it.type,Mt.type)){for(Ut in ci(it.layout,Mt.layout,Fe,$e,null,Yr.setLayoutProperty),ci(it.paint,Mt.paint,Fe,$e,null,Yr.setPaintProperty),y.deepEqual(it.filter,Mt.filter)||Fe.push({command:Yr.setFilter,args:[$e,Mt.filter]}),y.deepEqual(it.minzoom,Mt.minzoom)&&y.deepEqual(it.maxzoom,Mt.maxzoom)||Fe.push({command:Yr.setLayerZoomRange,args:[$e,Mt.minzoom,Mt.maxzoom]}),it)it.hasOwnProperty(Ut)&&Ut!=="layout"&&Ut!=="paint"&&Ut!=="filter"&&Ut!=="metadata"&&Ut!=="minzoom"&&Ut!=="maxzoom"&&(Ut.indexOf("paint.")===0?ci(it[Ut],Mt[Ut],Fe,$e,Ut.slice(6),Yr.setPaintProperty):y.deepEqual(it[Ut],Mt[Ut])||Fe.push({command:Yr.setLayerProperty,args:[$e,Ut,Mt[Ut]]}));for(Ut in Mt)Mt.hasOwnProperty(Ut)&&!it.hasOwnProperty(Ut)&&Ut!=="layout"&&Ut!=="paint"&&Ut!=="filter"&&Ut!=="metadata"&&Ut!=="minzoom"&&Ut!=="maxzoom"&&(Ut.indexOf("paint.")===0?ci(it[Ut],Mt[Ut],Fe,$e,Ut.slice(6),Yr.setPaintProperty):y.deepEqual(it[Ut],Mt[Ut])||Fe.push({command:Yr.setLayerProperty,args:[$e,Ut,Mt[Ut]]}))}else Fe.push({command:Yr.removeLayer,args:[$e]}),jt=an[an.lastIndexOf($e)+1],Fe.push({command:Yr.addLayer,args:[Mt,jt]})}(ve,I.layers,Z)}catch(xe){console.warn("Unable to compute style diff:",xe),Z=[{command:Yr.setStyle,args:[I]}]}return Z}(this.serialize(),h).filter(function(T){return!(T.command in Js)});if(w.length===0)return!1;var C=w.filter(function(T){return!(T.command in zu)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(T){return T.command}).join(", ")+".");return w.forEach(function(T){T.command!=="setTransition"&&g[T.command].apply(g,T.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,g){if(this.getImage(h))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,g),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,g){this.imageManager.updateImage(h,g)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,g,w){var C=this;if(w===void 0&&(w={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+h,g,null,w))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var T=this.sourceCaches[h]=new J(h,g,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:T.serialize(),sourceId:h}}),T.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===h)return this.fire(new y.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+g+'" is using it.')));var w=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],w.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),w.setEventedParent(null),w.clearTiles(),w.onRemove&&w.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,g){this._checkLoaded(),this.sourceCaches[h].getSource().setData(g),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var C=h.id;if(this.getLayer(C))this.fire(new y.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var T;if(h.type==="custom"){if(ul(this,y.validateCustomStyleLayer(h)))return;T=y.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(C,h.source),h=y.clone$1(h),h=y.extend(h,{source:C})),this._validate(y.validateStyle.layer,"layers."+C,h,{arrayIndex:-1},w))return;T=y.createStyleLayer(h),this._validateLayer(T),T.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[T.id]=T.serialize()}var I=g?this._order.indexOf(g):this._order.length;if(g&&I===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(I,0,C),this._layerOrderChanged=!0,this._layers[C]=T,this._removedLayers[C]&&T.source&&T.type!=="custom"){var Z=this._removedLayers[C];delete this._removedLayers[C],Z.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},d.prototype.moveLayer=function(h,g){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==g){var w=this._order.indexOf(h);this._order.splice(w,1);var C=g?this._order.indexOf(g):this._order.length;g&&C===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(C,0,h),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var g=this._layers[h];if(g){g.setEventedParent(null);var w=this._order.indexOf(h);this._order.splice(w,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=g,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,g,w){this._checkLoaded();var C=this.getLayer(h);C?C.minzoom===g&&C.maxzoom===w||(g!=null&&(C.minzoom=g),w!=null&&(C.maxzoom=w),this._updateLayer(C)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var C=this.getLayer(h);if(C){if(!y.deepEqual(C.filter,g))return g==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(y.validateStyle.filter,"layers."+C.id+".filter",g,null,w)||(C.filter=y.clone$1(g),this._updateLayer(C)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return y.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,g,w,C){C===void 0&&(C={}),this._checkLoaded();var T=this.getLayer(h);T?y.deepEqual(T.getLayoutProperty(g),w)||(T.setLayoutProperty(g,w,C),this._updateLayer(T)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,g){var w=this.getLayer(h);if(w)return w.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,g,w,C){C===void 0&&(C={}),this._checkLoaded();var T=this.getLayer(h);T?y.deepEqual(T.getPaintProperty(g),w)||(T.setPaintProperty(g,w,C)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,g){return this.getLayer(h).getPaintProperty(g)},d.prototype.setFeatureState=function(h,g){this._checkLoaded();var w=h.source,C=h.sourceLayer,T=this.sourceCaches[w];if(T!==void 0){var I=T.getSource().type;I==="geojson"&&C?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||C?(h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(C,h.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,g){this._checkLoaded();var w=h.source,C=this.sourceCaches[w];if(C!==void 0){var T=C.getSource().type,I=T==="vector"?h.sourceLayer:void 0;T!=="vector"||I?g&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(I,h.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var g=h.source,w=h.sourceLayer,C=this.sourceCaches[g];if(C!==void 0){if(C.getSource().type!=="vector"||w)return h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(w,h.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var g=this,w=function(zr){return g._layers[zr].type==="fill-extrusion"},C={},T=[],I=this._order.length-1;I>=0;I--){var Z=this._order[I];if(w(Z)){C[Z]=I;for(var $=0,le=h;$<le.length;$+=1){var ve=le[$][Z];if(ve)for(var xe=0,ze=ve;xe<ze.length;xe+=1)T.push(ze[xe])}}}T.sort(function(zr,Rr){return Rr.intersectionZ-zr.intersectionZ});for(var Fe=[],Ye=this._order.length-1;Ye>=0;Ye--){var Pe=this._order[Ye];if(w(Pe))for(var $e=T.length-1;$e>=0;$e--){var it=T[$e].feature;if(C[it.layer.id]<Ye)break;Fe.push(it),T.pop()}else for(var Mt=0,jt=h;Mt<jt.length;Mt+=1){var Ut=jt[Mt][Pe];if(Ut)for(var $t=0,pr=Ut;$t<pr.length;$t+=1)Fe.push(pr[$t].feature)}}return Fe},d.prototype.queryRenderedFeatures=function(h,g,w){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var C={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,I=g.layers;T<I.length;T+=1){var Z=I[T],$=this._layers[Z];if(!$)return this.fire(new y.ErrorEvent(new Error("The layer '"+Z+"' does not exist in the map's style and cannot be queried for features."))),[];C[$.source]=!0}}var le=[];for(var ve in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!C[ve]||le.push(Lr(this.sourceCaches[ve],this._layers,this._serializedLayers,h,g,w));return this.placement&&le.push(function(xe,ze,Fe,Ye,Pe,$e,it){for(var Mt={},jt=$e.queryRenderedSymbols(Ye),Ut=[],$t=0,pr=Object.keys(jt).map(Number);$t<pr.length;$t+=1)Ut.push(it[pr[$t]]);Ut.sort(jn);for(var zr=function(){var On=an[Rr],Mi=On.featureIndex.lookupSymbolFeatures(jt[On.bucketInstanceId],ze,On.bucketIndex,On.sourceLayerIndex,Pe.filter,Pe.layers,Pe.availableImages,xe);for(var cn in Mi){var Qn=Mt[cn]=Mt[cn]||[],ni=Mi[cn];ni.sort(function(ai,Yn){var Zn=On.featureSortOrder;if(Zn){var Ka=Zn.indexOf(ai.featureIndex);return Zn.indexOf(Yn.featureIndex)-Ka}return Yn.featureIndex-ai.featureIndex});for(var ei=0,qn=ni;ei<qn.length;ei+=1)Qn.push(qn[ei])}},Rr=0,an=Ut;Rr<an.length;Rr+=1)zr();var Tn=function(On){Mt[On].forEach(function(Mi){var cn=Mi.feature,Qn=Fe[xe[On].source].getFeatureState(cn.layer["source-layer"],cn.id);cn.source=cn.layer.source,cn.layer["source-layer"]&&(cn.sourceLayer=cn.layer["source-layer"]),cn.state=Qn})};for(var In in Mt)Tn(In);return Mt}(this._layers,this._serializedLayers,this.sourceCaches,h,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(le)},d.prototype.querySourceFeatures=function(h,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var w=this.sourceCaches[h];return w?function(C,T){for(var I=C.getRenderableIds().map(function(ze){return C.getTileByID(ze)}),Z=[],$={},le=0;le<I.length;le++){var ve=I[le],xe=ve.tileID.canonical.key;$[xe]||($[xe]=!0,ve.querySourceFeatures(Z,T))}return Z}(w,g):[]},d.prototype.addSourceType=function(h,g,w){return d.getSourceType(h)?w(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:g.workerSourceURL},w):w(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,g){g===void 0&&(g={}),this._checkLoaded();var w=this.light.getLight(),C=!1;for(var T in h)if(!y.deepEqual(h[T],w[T])){C=!0;break}if(C){var I={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,g),this.light.updateTransitions(I)}},d.prototype._validate=function(h,g,w,C,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&ul(this,h.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:w,styleSpec:y.styleSpec},C)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var g in this.sourceCaches)this.sourceCaches[g].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,g,w,C,T){T===void 0&&(T=!1);for(var I=!1,Z=!1,$={},le=0,ve=this._order;le<ve.length;le+=1){var xe=this._layers[ve[le]];if(xe.type==="symbol"){if(!$[xe.source]){var ze=this.sourceCaches[xe.source];$[xe.source]=ze.getRenderableIds(!0).map(function(it){return ze.getTileByID(it)}).sort(function(it,Mt){return Mt.tileID.overscaledZ-it.tileID.overscaledZ||(it.tileID.isLessThan(Mt.tileID)?-1:1)})}var Fe=this.crossTileSymbolIndex.addLayer(xe,$[xe.source],h.center.lng);I=I||Fe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||w===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),h.zoom))&&(this.pauseablePlacement=new sc(h,this._order,T,g,w,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),Z=!0),I&&this.pauseablePlacement.placement.setStale()),Z||I)for(var Ye=0,Pe=this._order;Ye<Pe.length;Ye+=1){var $e=this._layers[Pe[Ye]];$e.type==="symbol"&&this.placement.updateLayerOpacities($e,$[$e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,g,w){this.imageManager.getImages(g.icons,w),this._updateTilesForChangedImages();var C=this.sourceCaches[g.source];C&&C.setDependencies(g.tileID.key,g.type,g.icons)},d.prototype.getGlyphs=function(h,g,w){this.glyphManager.getGlyphs(g.stacks,w)},d.prototype.getResource=function(h,g,w){return y.makeRequest(g,w)},d}(y.Evented);Yo.getSourceType=function(f){return nr[f]},Yo.setSourceType=function(f,d){nr[f]=d},Yo.registerForPluginStateChange=y.registerForPluginStateChange;var La=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),zl=kn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Vc=kn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),bf=kn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Nu=kn(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Nl=kn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),jc=kn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Gc=kn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Sf=kn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ih=kn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),ah=kn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Zh=kn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),uc=kn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),lc=kn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),oh=kn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ra=kn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),wf=kn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Zu=kn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Bs=kn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ll=kn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),zs=kn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ii=kn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ns=kn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Eu=kn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),qo=kn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),cc=kn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),sh=kn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function kn(f,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=d.match(/attribute ([\w]+) ([\w]+)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=C?C.concat(w):w,I={};return{fragmentSource:f=f.replace(h,function(Z,$,le,ve,xe){return I[xe]=!0,$==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
varying `+le+" "+ve+" "+xe+`;
#else
uniform `+le+" "+ve+" u_"+xe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+xe+`
    `+le+" "+ve+" "+xe+" = u_"+xe+`;
#endif
`}),vertexSource:d=d.replace(h,function(Z,$,le,ve,xe){var ze=ve==="float"?"vec2":"vec4",Fe=xe.match(/color/)?"color":ze;return I[xe]?$==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+le+" "+ze+" a_"+xe+`;
varying `+le+" "+ve+" "+xe+`;
#else
uniform `+le+" "+ve+" u_"+xe+`;
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = a_"+xe+`;
#else
    `+le+" "+ve+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = unpack_mix_"+Fe+"(a_"+xe+", u_"+xe+`_t);
#else
    `+le+" "+ve+" "+xe+" = u_"+xe+`;
#endif
`:$==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+le+" "+ze+" a_"+xe+`;
#else
uniform `+le+" "+ve+" u_"+xe+`;
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+le+" "+ve+" "+xe+" = a_"+xe+`;
#else
    `+le+" "+ve+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+le+" "+ve+" "+xe+" = unpack_mix_"+Fe+"(a_"+xe+", u_"+xe+`_t);
#else
    `+le+" "+ve+" "+xe+" = u_"+xe+`;
#endif
`}),staticAttributes:g,staticUniforms:T}}var gs=Object.freeze({__proto__:null,prelude:zl,background:Vc,backgroundPattern:bf,circle:Nu,clippingMask:Nl,heatmap:jc,heatmapTexture:Gc,collisionBox:Sf,collisionCircle:ih,debug:ah,fill:Zh,fillOutline:uc,fillOutlinePattern:lc,fillPattern:oh,fillExtrusion:Ra,fillExtrusionPattern:wf,hillshadePrepare:Zu,hillshade:Bs,line:ll,lineGradient:zs,linePattern:ii,lineSDF:Ns,raster:Eu,symbolIcon:qo,symbolSDF:cc,symbolTextAndIcon:sh}),Ko=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Uu(f){for(var d=[],h=0;h<f.length;h++)if(f[h]!==null){var g=f[h].split(" ");d.push(g.pop())}return d}Ko.prototype.bind=function(f,d,h,g,w,C,T,I){this.context=f;for(var Z=this.boundPaintVertexBuffers.length!==g.length,$=0;!Z&&$<g.length;$++)this.boundPaintVertexBuffers[$]!==g[$]&&(Z=!0);f.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!Z&&this.boundIndexBuffer===w&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===I?(f.bindVertexArrayOES.set(this.vao),T&&T.bind(),w&&w.dynamicDraw&&w.bind(),I&&I.bind()):this.freshBind(d,h,g,w,C,T,I)},Ko.prototype.freshBind=function(f,d,h,g,w,C,T){var I,Z=f.numAttributes,$=this.context,le=$.gl;if($.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$.extVertexArrayObject.createVertexArrayOES(),$.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=f,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=T;else{I=$.currentNumAttributes||0;for(var ve=Z;ve<I;ve++)le.disableVertexAttribArray(ve)}d.enableAttributes(le,f);for(var xe=0,ze=h;xe<ze.length;xe+=1)ze[xe].enableAttributes(le,f);C&&C.enableAttributes(le,f),T&&T.enableAttributes(le,f),d.bind(),d.setVertexAttribPointers(le,f,w);for(var Fe=0,Ye=h;Fe<Ye.length;Fe+=1){var Pe=Ye[Fe];Pe.bind(),Pe.setVertexAttribPointers(le,f,w)}C&&(C.bind(),C.setVertexAttribPointers(le,f,w)),g&&g.bind(),T&&(T.bind(),T.setVertexAttribPointers(le,f,w)),$.currentNumAttributes=Z},Ko.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var uh=function(f,d,h,g,w,C){var T=f.gl;this.program=T.createProgram();for(var I=Uu(h.staticAttributes),Z=g?g.getBinderAttributes():[],$=I.concat(Z),le=h.staticUniforms?Uu(h.staticUniforms):[],ve=g?g.getBinderUniforms():[],xe=[],ze=0,Fe=le.concat(ve);ze<Fe.length;ze+=1){var Ye=Fe[ze];xe.indexOf(Ye)<0&&xe.push(Ye)}var Pe=g?g.defines():[];C&&Pe.push("#define OVERDRAW_INSPECTOR;");var $e=Pe.concat(zl.fragmentSource,h.fragmentSource).join(`
`),it=Pe.concat(zl.vertexSource,h.vertexSource).join(`
`),Mt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Mt,$e),T.compileShader(Mt),T.attachShader(this.program,Mt);var jt=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(jt,it),T.compileShader(jt),T.attachShader(this.program,jt),this.attributes={};var Ut={};this.numAttributes=$.length;for(var $t=0;$t<this.numAttributes;$t++)$[$t]&&(T.bindAttribLocation(this.program,$t,$[$t]),this.attributes[$[$t]]=$t);T.linkProgram(this.program),T.deleteShader(jt),T.deleteShader(Mt);for(var pr=0;pr<xe.length;pr++){var zr=xe[pr];if(zr&&!Ut[zr]){var Rr=T.getUniformLocation(this.program,zr);Rr&&(Ut[zr]=Rr)}}this.fixedUniforms=w(f,Ut),this.binderUniforms=g?g.getUniforms(f,Ut):[]}}};function Hc(f,d,h){var g=1/zi(h,1,d.transform.tileZoom),w=Math.pow(2,h.tileID.overscaledZ),C=h.tileSize*Math.pow(2,d.transform.tileZoom)/w,T=C*(h.tileID.canonical.x+h.tileID.wrap*w),I=C*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[T>>16,I>>16],u_pixel_coord_lower:[65535&T,65535&I]}}uh.prototype.draw=function(f,d,h,g,w,C,T,I,Z,$,le,ve,xe,ze,Fe,Ye){var Pe,$e=f.gl;if(!this.failedToCreate){for(var it in f.program.set(this.program),f.setDepthMode(h),f.setStencilMode(g),f.setColorMode(w),f.setCullFace(C),this.fixedUniforms)this.fixedUniforms[it].set(T[it]);ze&&ze.setUniforms(f,this.binderUniforms,ve,{zoom:xe});for(var Mt=(Pe={},Pe[$e.LINES]=2,Pe[$e.TRIANGLES]=3,Pe[$e.LINE_STRIP]=1,Pe)[d],jt=0,Ut=le.get();jt<Ut.length;jt+=1){var $t=Ut[jt],pr=$t.vaos||($t.vaos={});(pr[I]||(pr[I]=new Ko)).bind(f,this,Z,ze?ze.getPaintVertexBuffers():[],$,$t.vertexOffset,Fe,Ye),$e.drawElements(d,$t.primitiveLength*Mt,$e.UNSIGNED_SHORT,$t.primitiveOffset*Mt*2)}}};var pa=function(f,d,h,g){var w=d.style.light,C=w.properties.get("position"),T=[C.x,C.y,C.z],I=y.create$1();w.properties.get("anchor")==="viewport"&&y.fromRotation(I,-d.transform.angle),y.transformMat3(T,T,I);var Z=w.properties.get("color");return{u_matrix:f,u_lightpos:T,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+h,u_opacity:g}},cl=function(f,d,h,g,w,C,T){return y.extend(pa(f,d,h,g),Hc(C,d,T),{u_height_factor:-Math.pow(2,w.overscaledZ)/T.tileSize/8})},Vu=function(f){return{u_matrix:f}},Mo=function(f,d,h,g){return y.extend(Vu(f),Hc(h,d,g))},Wc=function(f,d){return{u_matrix:f,u_world:d}},$c=function(f,d,h,g,w){return y.extend(Mo(f,d,h,g),{u_world:w})},Au=function(f,d,h,g){var w,C,T=f.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var I=zi(h,1,T.zoom);w=!0,C=[I,I]}else w=!1,C=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(d.posMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:C}},qi=function(f,d,h){var g=zi(h,1,d.zoom),w=Math.pow(2,d.zoom-h.tileID.overscaledZ),C=h.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[d.pixelsToGLUnits[0]/(g*w),d.pixelsToGLUnits[1]/(g*w)],u_overscale_factor:C}},Zl=function(f,d,h){return{u_matrix:f,u_inv_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},Zs=function(f,d,h){return h===void 0&&(h=1),{u_matrix:f,u_color:d,u_overlay:0,u_overlay_scale:h}},Cu=function(f){return{u_matrix:f}},Ef=function(f,d,h,g){return{u_matrix:f,u_extrude_scale:zi(d,1,h),u_intensity:g}},fl=function(f,d,h){var g=f.transform;return{u_matrix:ch(f,d,h),u_ratio:1/zi(d,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Yi=function(f,d,h,g){return y.extend(fl(f,d,h),{u_image:0,u_image_height:g})},ju=function(f,d,h,g){var w=f.transform,C=Us(d,w);return{u_matrix:ch(f,d,h),u_texsize:d.imageAtlasTexture.size,u_ratio:1/zi(d,1,w.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[C,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},lh=function(f,d,h,g,w){var C=f.lineAtlas,T=Us(d,f.transform),I=h.layout.get("line-cap")==="round",Z=C.getDash(g.from,I),$=C.getDash(g.to,I),le=Z.width*w.fromScale,ve=$.width*w.toScale;return y.extend(fl(f,d,h),{u_patternscale_a:[T/le,-Z.height/2],u_patternscale_b:[T/ve,-$.height/2],u_sdfgamma:C.width/(256*Math.min(le,ve)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:$.y,u_mix:w.t})};function Us(f,d){return 1/zi(f,1,d.tileZoom)}function ch(f,d,h){return f.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var fc=function(f,d,h,g,w){return{u_matrix:f,u_tl_parent:d,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(T=w.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(C=w.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:hc(w.paint.get("raster-hue-rotate"))};var C,T};function hc(f){f*=Math.PI/180;var d=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var Ul,hl=function(f,d,h,g,w,C,T,I,Z,$){var le=w.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_pitch:le.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:le.width/le.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:T,u_coord_matrix:I,u_is_text:+Z,u_pitch_with_map:+g,u_texsize:$,u_texture:0}},ys=function(f,d,h,g,w,C,T,I,Z,$,le){var ve=w.transform;return y.extend(hl(f,d,h,g,w,C,T,I,Z,$),{u_gamma_scale:g?Math.cos(ve._pitch)*ve.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+le})},pc=function(f,d,h,g,w,C,T,I,Z,$){return y.extend(ys(f,d,h,g,w,C,T,I,!0,Z,!0),{u_texsize_icon:$,u_texture_icon:1})},Vl=function(f,d,h){return{u_matrix:f,u_opacity:d,u_color:h}},Gu=function(f,d,h,g,w,C){return y.extend(function(T,I,Z,$){var le=Z.imageManager.getPattern(T.from.toString()),ve=Z.imageManager.getPattern(T.to.toString()),xe=Z.imageManager.getPixelSize(),ze=xe.width,Fe=xe.height,Ye=Math.pow(2,$.tileID.overscaledZ),Pe=$.tileSize*Math.pow(2,Z.transform.tileZoom)/Ye,$e=Pe*($.tileID.canonical.x+$.tileID.wrap*Ye),it=Pe*$.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:le.tl,u_pattern_br_a:le.br,u_pattern_tl_b:ve.tl,u_pattern_br_b:ve.br,u_texsize:[ze,Fe],u_mix:I.t,u_pattern_size_a:le.displaySize,u_pattern_size_b:ve.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/zi($,1,Z.transform.tileZoom),u_pixel_coord_upper:[$e>>16,it>>16],u_pixel_coord_lower:[65535&$e,65535&it]}}(g,C,h,w),{u_matrix:f,u_opacity:d})},dc={fillExtrusion:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fillExtrusionPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_height_factor:new y.Uniform1f(f,d.u_height_factor),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fill:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},fillPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},fillOutline:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world)}},fillOutlinePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},circle:function(f,d){return{u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(f,d.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},collisionBox:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(f,d.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_overscale_factor:new y.Uniform1f(f,d.u_overscale_factor)}},collisionCircle:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_inv_matrix:new y.UniformMatrix4f(f,d.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(f,d.u_viewport_size)}},debug:function(f,d){return{u_color:new y.UniformColor(f,d.u_color),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_overlay:new y.Uniform1i(f,d.u_overlay),u_overlay_scale:new y.Uniform1f(f,d.u_overlay_scale)}},clippingMask:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmap:function(f,d){return{u_extrude_scale:new y.Uniform1f(f,d.u_extrude_scale),u_intensity:new y.Uniform1f(f,d.u_intensity),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmapTexture:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_color_ramp:new y.Uniform1i(f,d.u_color_ramp),u_opacity:new y.Uniform1f(f,d.u_opacity)}},hillshade:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_latrange:new y.Uniform2f(f,d.u_latrange),u_light:new y.Uniform2f(f,d.u_light),u_shadow:new y.UniformColor(f,d.u_shadow),u_highlight:new y.UniformColor(f,d.u_highlight),u_accent:new y.UniformColor(f,d.u_accent)}},hillshadePrepare:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_dimension:new y.Uniform2f(f,d.u_dimension),u_zoom:new y.Uniform1f(f,d.u_zoom),u_unpack:new y.Uniform4f(f,d.u_unpack)}},line:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels)}},lineGradient:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_image:new y.Uniform1i(f,d.u_image),u_image_height:new y.Uniform1f(f,d.u_image_height)}},linePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_texsize:new y.Uniform2f(f,d.u_texsize),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_image:new y.Uniform1i(f,d.u_image),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},lineSDF:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(f,d.u_patternscale_a),u_patternscale_b:new y.Uniform2f(f,d.u_patternscale_b),u_sdfgamma:new y.Uniform1f(f,d.u_sdfgamma),u_image:new y.Uniform1i(f,d.u_image),u_tex_y_a:new y.Uniform1f(f,d.u_tex_y_a),u_tex_y_b:new y.Uniform1f(f,d.u_tex_y_b),u_mix:new y.Uniform1f(f,d.u_mix)}},raster:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_tl_parent:new y.Uniform2f(f,d.u_tl_parent),u_scale_parent:new y.Uniform1f(f,d.u_scale_parent),u_buffer_scale:new y.Uniform1f(f,d.u_buffer_scale),u_fade_t:new y.Uniform1f(f,d.u_fade_t),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image0:new y.Uniform1i(f,d.u_image0),u_image1:new y.Uniform1i(f,d.u_image1),u_brightness_low:new y.Uniform1f(f,d.u_brightness_low),u_brightness_high:new y.Uniform1f(f,d.u_brightness_high),u_saturation_factor:new y.Uniform1f(f,d.u_saturation_factor),u_contrast_factor:new y.Uniform1f(f,d.u_contrast_factor),u_spin_weights:new y.Uniform3f(f,d.u_spin_weights)}},symbolIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture)}},symbolSDF:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},symbolTextAndIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texsize_icon:new y.Uniform2f(f,d.u_texsize_icon),u_texture:new y.Uniform1i(f,d.u_texture),u_texture_icon:new y.Uniform1i(f,d.u_texture_icon),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},background:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_color:new y.UniformColor(f,d.u_color)}},backgroundPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image:new y.Uniform1i(f,d.u_image),u_pattern_tl_a:new y.Uniform2f(f,d.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(f,d.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(f,d.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(f,d.u_pattern_br_b),u_texsize:new y.Uniform2f(f,d.u_texsize),u_mix:new y.Uniform1f(f,d.u_mix),u_pattern_size_a:new y.Uniform2f(f,d.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(f,d.u_pattern_size_b),u_scale_a:new y.Uniform1f(f,d.u_scale_a),u_scale_b:new y.Uniform1f(f,d.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(f,d.u_tile_units_to_pixels)}}};function jl(f,d,h,g,w,C,T){for(var I=f.context,Z=I.gl,$=f.useProgram("collisionBox"),le=[],ve=0,xe=0,ze=0;ze<g.length;ze++){var Fe=g[ze],Ye=d.getTile(Fe),Pe=Ye.getBucket(h);if(Pe){var $e=Fe.posMatrix;w[0]===0&&w[1]===0||($e=f.translatePosMatrix(Fe.posMatrix,Ye,w,C));var it=T?Pe.textCollisionBox:Pe.iconCollisionBox,Mt=Pe.collisionCircleArray;if(Mt.length>0){var jt=y.create(),Ut=$e;y.mul(jt,Pe.placementInvProjMatrix,f.transform.glCoordMatrix),y.mul(jt,jt,Pe.placementViewportMatrix),le.push({circleArray:Mt,circleOffset:xe,transform:Ut,invTransform:jt}),xe=ve+=Mt.length/4}it&&$.draw(I,Z.LINES,we.disabled,Oe.disabled,f.colorModeForRenderPass(),ot.disabled,qi($e,f.transform,Ye),h.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,f.transform.zoom,null,null,it.collisionVertexBuffer)}}if(T&&le.length){var $t=f.useProgram("collisionCircle"),pr=new y.StructArrayLayout2f1f2i16;pr.resize(4*ve),pr._trim();for(var zr=0,Rr=0,an=le;Rr<an.length;Rr+=1)for(var Tn=an[Rr],In=0;In<Tn.circleArray.length/4;In++){var On=4*In,Mi=Tn.circleArray[On+0],cn=Tn.circleArray[On+1],Qn=Tn.circleArray[On+2],ni=Tn.circleArray[On+3];pr.emplace(zr++,Mi,cn,Qn,ni,0),pr.emplace(zr++,Mi,cn,Qn,ni,1),pr.emplace(zr++,Mi,cn,Qn,ni,2),pr.emplace(zr++,Mi,cn,Qn,ni,3)}(!Ul||Ul.length<2*ve)&&(Ul=function(_a){var _o=2*_a,Ja=new y.StructArrayLayout3ui6;Ja.resize(_o),Ja._trim();for(var xa=0;xa<_o;xa++){var za=6*xa;Ja.uint16[za+0]=4*xa+0,Ja.uint16[za+1]=4*xa+1,Ja.uint16[za+2]=4*xa+2,Ja.uint16[za+3]=4*xa+2,Ja.uint16[za+4]=4*xa+3,Ja.uint16[za+5]=4*xa+0}return Ja}(ve));for(var ei=I.createIndexBuffer(Ul,!0),qn=I.createVertexBuffer(pr,y.collisionCircleLayout.members,!0),ai=0,Yn=le;ai<Yn.length;ai+=1){var Zn=Yn[ai],Ka=Zl(Zn.transform,Zn.invTransform,f.transform);$t.draw(I,Z.TRIANGLES,we.disabled,Oe.disabled,f.colorModeForRenderPass(),ot.disabled,Ka,h.id,qn,ei,y.SegmentVector.simpleSegment(0,2*Zn.circleOffset,Zn.circleArray.length,Zn.circleArray.length/2),null,f.transform.zoom,null,null,null)}qn.destroy(),ei.destroy()}}var ss=y.identity(new Float32Array(16));function Af(f,d,h,g,w,C){var T=y.getAnchorAlignment(f),I=-(T.horizontalAlign-.5)*d,Z=-(T.verticalAlign-.5)*h,$=y.evaluateVariableOffset(f,g);return new y.Point((I/w+$[0])*C,(Z/w+$[1])*C)}function vc(f,d,h,g,w,C,T,I,Z,$,le){var ve=f.text.placedSymbolArray,xe=f.text.dynamicLayoutVertexArray,ze=f.icon.dynamicLayoutVertexArray,Fe={};xe.clear();for(var Ye=0;Ye<ve.length;Ye++){var Pe=ve.get(Ye),$e=Pe.hidden||!Pe.crossTileID||f.allowVerticalPlacement&&!Pe.placedOrientation?null:g[Pe.crossTileID];if($e){var it=new y.Point(Pe.anchorX,Pe.anchorY),Mt=fi(it,h?I:T),jt=vi(C.cameraToCenterDistance,Mt.signedDistanceFromCamera),Ut=w.evaluateSizeForFeature(f.textSizeData,$,Pe)*jt/y.ONE_EM;h&&(Ut*=f.tilePixelRatio/Z);for(var $t=Af($e.anchor,$e.width,$e.height,$e.textOffset,$e.textBoxScale,Ut),pr=h?fi(it.add($t),T).point:Mt.point.add(d?$t.rotate(-C.angle):$t),zr=f.allowVerticalPlacement&&Pe.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,Rr=0;Rr<Pe.numGlyphs;Rr++)y.addDynamicAttributes(xe,pr,zr);le&&Pe.associatedIconIndex>=0&&(Fe[Pe.associatedIconIndex]={shiftedAnchor:pr,angle:zr})}else Hn(Pe.numGlyphs,xe)}if(le){ze.clear();for(var an=f.icon.placedSymbolArray,Tn=0;Tn<an.length;Tn++){var In=an.get(Tn);if(In.hidden)Hn(In.numGlyphs,ze);else{var On=Fe[Tn];if(On)for(var Mi=0;Mi<In.numGlyphs;Mi++)y.addDynamicAttributes(ze,On.shiftedAnchor,On.angle);else Hn(In.numGlyphs,ze)}}f.icon.dynamicLayoutVertexBuffer.updateData(ze)}f.text.dynamicLayoutVertexBuffer.updateData(xe)}function Gl(f,d,h){return h.iconsInText&&d?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Hu(f,d,h,g,w,C,T,I,Z,$,le,ve){for(var xe=f.context,ze=xe.gl,Fe=f.transform,Ye=I==="map",Pe=Z==="map",$e=Ye&&h.layout.get("symbol-placement")!=="point",it=Ye&&!Pe&&!$e,Mt=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,jt=!1,Ut=f.depthModeForSublayer(0,we.ReadOnly),$t=h.layout.get("text-variable-anchor"),pr=[],zr=0,Rr=g;zr<Rr.length;zr+=1){var an=Rr[zr],Tn=d.getTile(an),In=Tn.getBucket(h);if(In){var On=w?In.text:In.icon;if(On&&On.segments.get().length){var Mi=On.programConfigurations.get(h.id),cn=w||In.sdfIcons,Qn=w?In.textSizeData:In.iconSizeData,ni=Pe||Fe.pitch!==0,ei=f.useProgram(Gl(cn,w,In),Mi),qn=y.evaluateSizeForZoom(Qn,Fe.zoom),ai=void 0,Yn=[0,0],Zn=void 0,Ka=void 0,_a=null,_o=void 0;if(w)Zn=Tn.glyphAtlasTexture,Ka=ze.LINEAR,ai=Tn.glyphAtlasTexture.size,In.iconsInText&&(Yn=Tn.imageAtlasTexture.size,_a=Tn.imageAtlasTexture,_o=ni||f.options.rotating||f.options.zooming||Qn.kind==="composite"||Qn.kind==="camera"?ze.LINEAR:ze.NEAREST);else{var Ja=h.layout.get("icon-size").constantOr(0)!==1||In.iconsNeedLinear;Zn=Tn.imageAtlasTexture,Ka=cn||f.options.rotating||f.options.zooming||Ja||ni?ze.LINEAR:ze.NEAREST,ai=Tn.imageAtlasTexture.size}var xa=zi(Tn,1,f.transform.zoom),za=aa(an.posMatrix,Pe,Ye,f.transform,xa),Uo=bi(an.posMatrix,Pe,Ye,f.transform,xa),Vo=$t&&In.hasTextData(),el=h.layout.get("icon-text-fit")!=="none"&&Vo&&In.hasIconData();$e&&ms(In,an.posMatrix,f,w,za,Uo,Pe,$);var Po=f.translatePosMatrix(an.posMatrix,Tn,C,T),ws=$e||w&&$t||el?ss:za,Es=f.translatePosMatrix(Uo,Tn,C,T,!0),xl=cn&&h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0,du={program:ei,buffers:On,uniformValues:cn?In.iconsInText?pc(Qn.kind,qn,it,Pe,f,Po,ws,Es,ai,Yn):ys(Qn.kind,qn,it,Pe,f,Po,ws,Es,w,ai,!0):hl(Qn.kind,qn,it,Pe,f,Po,ws,Es,w,ai),atlasTexture:Zn,atlasTextureIcon:_a,atlasInterpolation:Ka,atlasInterpolationIcon:_o,isSDF:cn,hasHalo:xl};if(Mt&&In.canOverlap){jt=!0;for(var vu=0,bl=On.segments.get();vu<bl.length;vu+=1){var Kl=bl[vu];pr.push({segments:new y.SegmentVector([Kl]),sortKey:Kl.sortKey,state:du})}}else pr.push({segments:On.segments,sortKey:0,state:du})}}}jt&&pr.sort(function(ru,ts){return ru.sortKey-ts.sortKey});for(var Ws=0,tl=pr;Ws<tl.length;Ws+=1){var fs=tl[Ws],Na=fs.state;if(xe.activeTexture.set(ze.TEXTURE0),Na.atlasTexture.bind(Na.atlasInterpolation,ze.CLAMP_TO_EDGE),Na.atlasTextureIcon&&(xe.activeTexture.set(ze.TEXTURE1),Na.atlasTextureIcon&&Na.atlasTextureIcon.bind(Na.atlasInterpolationIcon,ze.CLAMP_TO_EDGE)),Na.isSDF){var mu=Na.uniformValues;Na.hasHalo&&(mu.u_is_halo=1,Hl(Na.buffers,fs.segments,h,f,Na.program,Ut,le,ve,mu)),mu.u_is_halo=0}Hl(Na.buffers,fs.segments,h,f,Na.program,Ut,le,ve,Na.uniformValues)}}function Hl(f,d,h,g,w,C,T,I,Z){var $=g.context;w.draw($,$.gl.TRIANGLES,C,T,I,ot.disabled,Z,h.id,f.layoutVertexBuffer,f.indexBuffer,d,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Wl(f,d,h,g,w,C,T){var I,Z,$,le,ve,xe=f.context.gl,ze=h.paint.get("fill-pattern"),Fe=ze&&ze.constantOr(1),Ye=h.getCrossfadeParameters();T?(Z=Fe&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=xe.LINES):(Z=Fe?"fillPattern":"fill",I=xe.TRIANGLES);for(var Pe=0,$e=g;Pe<$e.length;Pe+=1){var it=$e[Pe],Mt=d.getTile(it);if(!Fe||Mt.patternsLoaded()){var jt=Mt.getBucket(h);if(jt){var Ut=jt.programConfigurations.get(h.id),$t=f.useProgram(Z,Ut);Fe&&(f.context.activeTexture.set(xe.TEXTURE0),Mt.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Ut.updatePaintBuffers(Ye));var pr=ze.constantOr(null);if(pr&&Mt.imageAtlas){var zr=Mt.imageAtlas,Rr=zr.patternPositions[pr.to.toString()],an=zr.patternPositions[pr.from.toString()];Rr&&an&&Ut.setConstantPatternPositions(Rr,an)}var Tn=f.translatePosMatrix(it.posMatrix,Mt,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(T){le=jt.indexBuffer2,ve=jt.segments2;var In=[xe.drawingBufferWidth,xe.drawingBufferHeight];$=Z==="fillOutlinePattern"&&Fe?$c(Tn,f,Ye,Mt,In):Wc(Tn,In)}else le=jt.indexBuffer,ve=jt.segments,$=Fe?Mo(Tn,f,Ye,Mt):Vu(Tn);$t.draw(f.context,I,w,f.stencilModeForClipping(it),C,ot.disabled,$,h.id,jt.layoutVertexBuffer,le,ve,h.paint,f.transform.zoom,Ut)}}}}function pl(f,d,h,g,w,C,T){for(var I=f.context,Z=I.gl,$=h.paint.get("fill-extrusion-pattern"),le=$.constantOr(1),ve=h.getCrossfadeParameters(),xe=h.paint.get("fill-extrusion-opacity"),ze=0,Fe=g;ze<Fe.length;ze+=1){var Ye=Fe[ze],Pe=d.getTile(Ye),$e=Pe.getBucket(h);if($e){var it=$e.programConfigurations.get(h.id),Mt=f.useProgram(le?"fillExtrusionPattern":"fillExtrusion",it);le&&(f.context.activeTexture.set(Z.TEXTURE0),Pe.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),it.updatePaintBuffers(ve));var jt=$.constantOr(null);if(jt&&Pe.imageAtlas){var Ut=Pe.imageAtlas,$t=Ut.patternPositions[jt.to.toString()],pr=Ut.patternPositions[jt.from.toString()];$t&&pr&&it.setConstantPatternPositions($t,pr)}var zr=f.translatePosMatrix(Ye.posMatrix,Pe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Rr=h.paint.get("fill-extrusion-vertical-gradient"),an=le?cl(zr,f,Rr,xe,Ye,ve,Pe):pa(zr,f,Rr,xe);Mt.draw(I,I.gl.TRIANGLES,w,C,T,ot.backCCW,an,h.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,h.paint,f.transform.zoom,it)}}}function dl(f,d,h,g,w,C){var T=f.context,I=T.gl,Z=d.fbo;if(Z){var $=f.useProgram("hillshade");T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,Z.colorAttachment.get());var le=function(ve,xe,ze){var Fe=ze.paint.get("hillshade-shadow-color"),Ye=ze.paint.get("hillshade-highlight-color"),Pe=ze.paint.get("hillshade-accent-color"),$e=ze.paint.get("hillshade-illumination-direction")*(Math.PI/180);ze.paint.get("hillshade-illumination-anchor")==="viewport"&&($e-=ve.transform.angle);var it,Mt,jt,Ut=!ve.options.moving;return{u_matrix:ve.transform.calculatePosMatrix(xe.tileID.toUnwrapped(),Ut),u_image:0,u_latrange:(it=xe.tileID,Mt=Math.pow(2,it.canonical.z),jt=it.canonical.y,[new y.MercatorCoordinate(0,jt/Mt).toLngLat().lat,new y.MercatorCoordinate(0,(jt+1)/Mt).toLngLat().lat]),u_light:[ze.paint.get("hillshade-exaggeration"),$e],u_shadow:Fe,u_highlight:Ye,u_accent:Pe}}(f,d,h);$.draw(T,I.TRIANGLES,g,w,C,ot.disabled,le,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}}function mc(f,d,h,g,w,C){var T=f.context,I=T.gl,Z=d.dem;if(Z&&Z.data){var $=Z.dim,le=Z.stride,ve=Z.getPixels();if(T.activeTexture.set(I.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||f.getTileTexture(le),d.demTexture){var xe=d.demTexture;xe.update(ve,{premultiply:!1}),xe.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else d.demTexture=new y.Texture(T,ve,I.RGBA,{premultiply:!1}),d.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);T.activeTexture.set(I.TEXTURE0);var ze=d.fbo;if(!ze){var Fe=new y.Texture(T,{width:$,height:$,data:null},I.RGBA);Fe.bind(I.LINEAR,I.CLAMP_TO_EDGE),(ze=d.fbo=T.createFramebuffer($,$,!0)).colorAttachment.set(Fe.texture)}T.bindFramebuffer.set(ze.framebuffer),T.viewport.set([0,0,$,$]),f.useProgram("hillshadePrepare").draw(T,I.TRIANGLES,g,w,C,ot.disabled,function(Ye,Pe){var $e=Pe.stride,it=y.create();return y.ortho(it,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(it,it,[0,-y.EXTENT,0]),{u_matrix:it,u_image:1,u_dimension:[$e,$e],u_zoom:Ye.overscaledZ,u_unpack:Pe.getUnpackVector()}}(d.tileID,Z),h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function vl(f,d,h,g,w){var C=g.paint.get("raster-fade-duration");if(C>0){var T=y.browser.now(),I=(T-f.timeAdded)/C,Z=d?(T-d.timeAdded)/C:-1,$=h.getSource(),le=w.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),ve=!d||Math.abs(d.tileID.overscaledZ-le)>Math.abs(f.tileID.overscaledZ-le),xe=ve&&f.refreshedUponExpiration?1:y.clamp(ve?I:1-Z,0,1);return f.refreshedUponExpiration&&I>=1&&(f.refreshedUponExpiration=!1),d?{opacity:1,mix:1-xe}:{opacity:xe,mix:0}}return{opacity:1,mix:0}}var Cf=new y.Color(1,0,0,1),fh=new y.Color(0,1,0,1),hh=new y.Color(0,0,1,1),Da=new y.Color(1,0,1,1),ph=new y.Color(0,1,1,1);function dh(f,d,h,g){ml(f,0,d+h/2,f.transform.width,h,g)}function vh(f,d,h,g){ml(f,d-h/2,0,h,f.transform.height,g)}function ml(f,d,h,g,w,C){var T=f.context,I=T.gl;I.enable(I.SCISSOR_TEST),I.scissor(d*y.browser.devicePixelRatio,h*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,w*y.browser.devicePixelRatio),T.clear({color:C}),I.disable(I.SCISSOR_TEST)}function Uh(f,d,h){var g=f.context,w=g.gl,C=h.posMatrix,T=f.useProgram("debug"),I=we.disabled,Z=Oe.disabled,$=f.colorModeForRenderPass();g.activeTexture.set(w.TEXTURE0),f.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),T.draw(g,w.LINE_STRIP,I,Z,$,ot.disabled,Zs(C,y.Color.red),"$debug",f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments);var le=d.getTileByID(h.key).latestRawTileData,ve=Math.floor((le&&le.byteLength||0)/1024),xe=d.getTile(h).tileSize,ze=512/Math.min(xe,512)*(h.overscaledZ/f.transform.zoom)*.5,Fe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Fe+=" => "+h.overscaledZ),function(Ye,Pe){Ye.initDebugOverlayCanvas();var $e=Ye.debugOverlayCanvas,it=Ye.context.gl,Mt=Ye.debugOverlayCanvas.getContext("2d");Mt.clearRect(0,0,$e.width,$e.height),Mt.shadowColor="white",Mt.shadowBlur=2,Mt.lineWidth=1.5,Mt.strokeStyle="white",Mt.textBaseline="top",Mt.font="bold 36px Open Sans, sans-serif",Mt.fillText(Pe,5,5),Mt.strokeText(Pe,5,5),Ye.debugOverlayTexture.update($e),Ye.debugOverlayTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE)}(f,Fe+" "+ve+"kb"),T.draw(g,w.TRIANGLES,I,Z,Ke.alphaBlended,ot.disabled,Zs(C,y.Color.transparent,ze),"$debug",f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}var _s={symbol:function(f,d,h,g,w){if(f.renderPass==="translucent"){var C=Oe.disabled,T=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(I,Z,$,le,ve,xe,ze){for(var Fe=Z.transform,Ye=ve==="map",Pe=xe==="map",$e=0,it=I;$e<it.length;$e+=1){var Mt=it[$e],jt=le.getTile(Mt),Ut=jt.getBucket($);if(Ut&&Ut.text&&Ut.text.segments.get().length){var $t=y.evaluateSizeForZoom(Ut.textSizeData,Fe.zoom),pr=zi(jt,1,Z.transform.zoom),zr=aa(Mt.posMatrix,Pe,Ye,Z.transform,pr),Rr=$.layout.get("icon-text-fit")!=="none"&&Ut.hasIconData();if($t){var an=Math.pow(2,Fe.zoom-jt.tileID.overscaledZ);vc(Ut,Ye,Pe,ze,y.symbolSize,Fe,zr,Mt.posMatrix,an,$t,Rr)}}}}(g,f,h,d,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),h.paint.get("icon-opacity").constantOr(1)!==0&&Hu(f,d,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),C,T),h.paint.get("text-opacity").constantOr(1)!==0&&Hu(f,d,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),C,T),d.map.showCollisionBoxes&&(jl(f,d,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),jl(f,d,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),I=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(w.constantOr(1)!==0||C.constantOr(1)!==0&&T.constantOr(1)!==0){for(var Z=f.context,$=Z.gl,le=f.depthModeForSublayer(0,we.ReadOnly),ve=Oe.disabled,xe=f.colorModeForRenderPass(),ze=[],Fe=0;Fe<g.length;Fe++){var Ye=g[Fe],Pe=d.getTile(Ye),$e=Pe.getBucket(h);if($e){var it=$e.programConfigurations.get(h.id),Mt={programConfiguration:it,program:f.useProgram("circle",it),layoutVertexBuffer:$e.layoutVertexBuffer,indexBuffer:$e.indexBuffer,uniformValues:Au(f,Ye,Pe,h)};if(I)for(var jt=0,Ut=$e.segments.get();jt<Ut.length;jt+=1){var $t=Ut[jt];ze.push({segments:new y.SegmentVector([$t]),sortKey:$t.sortKey,state:Mt})}else ze.push({segments:$e.segments,sortKey:0,state:Mt})}}I&&ze.sort(function(Tn,In){return Tn.sortKey-In.sortKey});for(var pr=0,zr=ze;pr<zr.length;pr+=1){var Rr=zr[pr],an=Rr.state;an.program.draw(Z,$.TRIANGLES,le,ve,xe,ot.disabled,an.uniformValues,h.id,an.layoutVertexBuffer,an.indexBuffer,Rr.segments,h.paint,f.transform.zoom,an.programConfiguration)}}}},heatmap:function(f,d,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){var w=f.context,C=w.gl,T=Oe.disabled,I=new Ke([C.ONE,C.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(ze,Fe,Ye){var Pe=ze.gl;ze.activeTexture.set(Pe.TEXTURE1),ze.viewport.set([0,0,Fe.width/4,Fe.height/4]);var $e=Ye.heatmapFbo;if($e)Pe.bindTexture(Pe.TEXTURE_2D,$e.colorAttachment.get()),ze.bindFramebuffer.set($e.framebuffer);else{var it=Pe.createTexture();Pe.bindTexture(Pe.TEXTURE_2D,it),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_WRAP_S,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_WRAP_T,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_MIN_FILTER,Pe.LINEAR),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_MAG_FILTER,Pe.LINEAR),$e=Ye.heatmapFbo=ze.createFramebuffer(Fe.width/4,Fe.height/4,!1),function(Mt,jt,Ut,$t){var pr=Mt.gl;pr.texImage2D(pr.TEXTURE_2D,0,pr.RGBA,jt.width/4,jt.height/4,0,pr.RGBA,Mt.extRenderToTextureHalfFloat?Mt.extTextureHalfFloat.HALF_FLOAT_OES:pr.UNSIGNED_BYTE,null),$t.colorAttachment.set(Ut)}(ze,Fe,it,$e)}})(w,f,h),w.clear({color:y.Color.transparent});for(var Z=0;Z<g.length;Z++){var $=g[Z];if(!d.hasRenderableParent($)){var le=d.getTile($),ve=le.getBucket(h);if(ve){var xe=ve.programConfigurations.get(h.id);f.useProgram("heatmap",xe).draw(w,C.TRIANGLES,we.disabled,T,I,ot.disabled,Ef($.posMatrix,le,f.transform.zoom,h.paint.get("heatmap-intensity")),h.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,h.paint,f.transform.zoom,xe)}}}w.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(ze,Fe){var Ye=ze.context,Pe=Ye.gl,$e=Fe.heatmapFbo;if($e){Ye.activeTexture.set(Pe.TEXTURE0),Pe.bindTexture(Pe.TEXTURE_2D,$e.colorAttachment.get()),Ye.activeTexture.set(Pe.TEXTURE1);var it=Fe.colorRampTexture;it||(it=Fe.colorRampTexture=new y.Texture(Ye,Fe.colorRamp,Pe.RGBA)),it.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),ze.useProgram("heatmapTexture").draw(Ye,Pe.TRIANGLES,we.disabled,Oe.disabled,ze.colorModeForRenderPass(),ot.disabled,function(Mt,jt,Ut,$t){var pr=y.create();y.ortho(pr,0,Mt.width,Mt.height,0,0,1);var zr=Mt.context.gl;return{u_matrix:pr,u_world:[zr.drawingBufferWidth,zr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:jt.paint.get("heatmap-opacity")}}(ze,Fe),Fe.id,ze.viewportBuffer,ze.quadTriangleIndexBuffer,ze.viewportSegments,Fe.paint,ze.transform.zoom)}}(f,h))},line:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(w.constantOr(1)!==0&&C.constantOr(1)!==0)for(var T=f.depthModeForSublayer(0,we.ReadOnly),I=f.colorModeForRenderPass(),Z=h.paint.get("line-dasharray"),$=h.paint.get("line-pattern"),le=$.constantOr(1),ve=h.paint.get("line-gradient"),xe=h.getCrossfadeParameters(),ze=le?"linePattern":Z?"lineSDF":ve?"lineGradient":"line",Fe=f.context,Ye=Fe.gl,Pe=!0,$e=0,it=g;$e<it.length;$e+=1){var Mt=it[$e],jt=d.getTile(Mt);if(!le||jt.patternsLoaded()){var Ut=jt.getBucket(h);if(Ut){var $t=Ut.programConfigurations.get(h.id),pr=f.context.program.get(),zr=f.useProgram(ze,$t),Rr=Pe||zr.program!==pr,an=$.constantOr(null);if(an&&jt.imageAtlas){var Tn=jt.imageAtlas,In=Tn.patternPositions[an.to.toString()],On=Tn.patternPositions[an.from.toString()];In&&On&&$t.setConstantPatternPositions(In,On)}var Mi=le?ju(f,jt,h,xe):Z?lh(f,jt,h,Z,xe):ve?Yi(f,jt,h,Ut.lineClipsArray.length):fl(f,jt,h);if(le)Fe.activeTexture.set(Ye.TEXTURE0),jt.imageAtlasTexture.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE),$t.updatePaintBuffers(xe);else if(Z&&(Rr||f.lineAtlas.dirty))Fe.activeTexture.set(Ye.TEXTURE0),f.lineAtlas.bind(Fe);else if(ve){var cn=Ut.gradients[h.id],Qn=cn.texture;if(h.gradientVersion!==cn.version){var ni=256;if(h.stepInterpolant){var ei=d.getSource().maxzoom,qn=Mt.canonical.z===ei?Math.ceil(1<<f.transform.maxZoom-Mt.canonical.z):1;ni=y.clamp(y.nextPowerOfTwo(Ut.maxLineLength/y.EXTENT*1024*qn),256,Fe.maxTextureSize)}cn.gradient=y.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:ni,image:cn.gradient||void 0,clips:Ut.lineClipsArray}),cn.texture?cn.texture.update(cn.gradient):cn.texture=new y.Texture(Fe,cn.gradient,Ye.RGBA),cn.version=h.gradientVersion,Qn=cn.texture}Fe.activeTexture.set(Ye.TEXTURE0),Qn.bind(h.stepInterpolant?Ye.NEAREST:Ye.LINEAR,Ye.CLAMP_TO_EDGE)}zr.draw(Fe,Ye.TRIANGLES,T,f.stencilModeForClipping(Mt),I,ot.disabled,Mi,h.id,Ut.layoutVertexBuffer,Ut.indexBuffer,Ut.segments,h.paint,f.transform.zoom,$t,Ut.layoutVertexBuffer2),Pe=!1}}}}},fill:function(f,d,h,g){var w=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(C.constantOr(1)!==0){var T=f.colorModeForRenderPass(),I=h.paint.get("fill-pattern"),Z=f.opaquePassEnabledForLayer()&&!I.constantOr(1)&&w.constantOr(y.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===Z){var $=f.depthModeForSublayer(1,f.renderPass==="opaque"?we.ReadWrite:we.ReadOnly);Wl(f,d,h,g,$,T,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){var le=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,we.ReadOnly);Wl(f,d,h,g,le,T,!0)}}},"fill-extrusion":function(f,d,h,g){var w=h.paint.get("fill-extrusion-opacity");if(w!==0&&f.renderPass==="translucent"){var C=new we(f.context.gl.LEQUAL,we.ReadWrite,f.depthRangeFor3D);if(w!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))pl(f,d,h,g,C,Oe.disabled,Ke.disabled),pl(f,d,h,g,C,f.stencilModeFor3D(),f.colorModeForRenderPass());else{var T=f.colorModeForRenderPass();pl(f,d,h,g,C,Oe.disabled,T)}}},hillshade:function(f,d,h,g){if(f.renderPass==="offscreen"||f.renderPass==="translucent"){for(var w=f.context,C=f.depthModeForSublayer(0,we.ReadOnly),T=f.colorModeForRenderPass(),I=f.renderPass==="translucent"?f.stencilConfigForOverlap(g):[{},g],Z=I[0],$=0,le=I[1];$<le.length;$+=1){var ve=le[$],xe=d.getTile(ve);xe.needsHillshadePrepare&&f.renderPass==="offscreen"?mc(f,xe,h,C,Oe.disabled,T):f.renderPass==="translucent"&&dl(f,xe,h,C,Z[ve.overscaledZ],T)}w.viewport.set([0,0,f.width,f.height])}},raster:function(f,d,h,g){if(f.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&g.length)for(var w=f.context,C=w.gl,T=d.getSource(),I=f.useProgram("raster"),Z=f.colorModeForRenderPass(),$=T instanceof _t?[{},g]:f.stencilConfigForOverlap(g),le=$[0],ve=$[1],xe=ve[ve.length-1].overscaledZ,ze=!f.options.moving,Fe=0,Ye=ve;Fe<Ye.length;Fe+=1){var Pe=Ye[Fe],$e=f.depthModeForSublayer(Pe.overscaledZ-xe,h.paint.get("raster-opacity")===1?we.ReadWrite:we.ReadOnly,C.LESS),it=d.getTile(Pe),Mt=f.transform.calculatePosMatrix(Pe.toUnwrapped(),ze);it.registerFadeDuration(h.paint.get("raster-fade-duration"));var jt=d.findLoadedParent(Pe,0),Ut=vl(it,jt,d,h,f.transform),$t=void 0,pr=void 0,zr=h.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;w.activeTexture.set(C.TEXTURE0),it.texture.bind(zr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(C.TEXTURE1),jt?(jt.texture.bind(zr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),$t=Math.pow(2,jt.tileID.overscaledZ-it.tileID.overscaledZ),pr=[it.tileID.canonical.x*$t%1,it.tileID.canonical.y*$t%1]):it.texture.bind(zr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var Rr=fc(Mt,pr||[0,0],$t||1,Ut,h);T instanceof _t?I.draw(w,C.TRIANGLES,$e,Oe.disabled,Z,ot.disabled,Rr,h.id,T.boundsBuffer,f.quadTriangleIndexBuffer,T.boundsSegments):I.draw(w,C.TRIANGLES,$e,le[Pe.overscaledZ],Z,ot.disabled,Rr,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,d,h){var g=h.paint.get("background-color"),w=h.paint.get("background-opacity");if(w!==0){var C=f.context,T=C.gl,I=f.transform,Z=I.tileSize,$=h.paint.get("background-pattern");if(!f.isPatternMissing($)){var le=!$&&g.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass===le){var ve=Oe.disabled,xe=f.depthModeForSublayer(0,le==="opaque"?we.ReadWrite:we.ReadOnly),ze=f.colorModeForRenderPass(),Fe=f.useProgram($?"backgroundPattern":"background"),Ye=I.coveringTiles({tileSize:Z});$&&(C.activeTexture.set(T.TEXTURE0),f.imageManager.bind(f.context));for(var Pe=h.getCrossfadeParameters(),$e=0,it=Ye;$e<it.length;$e+=1){var Mt=it[$e],jt=f.transform.calculatePosMatrix(Mt.toUnwrapped()),Ut=$?Gu(jt,w,f,$,{tileID:Mt,tileSize:Z},Pe):Vl(jt,w,g);Fe.draw(C,T.TRIANGLES,xe,ve,ze,ot.disabled,Ut,h.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}}}},debug:function(f,d,h){for(var g=0;g<h.length;g++)Uh(f,d,h[g])},custom:function(f,d,h){var g=f.context,w=h.implementation;if(f.renderPass==="offscreen"){var C=w.prerender;C&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),C.call(w,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(Oe.disabled);var T=w.renderingMode==="3d"?new we(f.context.gl.LEQUAL,we.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,we.ReadOnly);g.setDepthMode(T),w.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}},Ji=function(f,d){this.context=new pe(f),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=J.maxUnderzooming+J.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new os,this.gpuTimers={}};Ji.prototype.resize=function(f,d){if(this.width=f*y.browser.devicePixelRatio,this.height=d*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,g=this.style._order;h<g.length;h+=1)this.style._layers[g[h]].resize()},Ji.prototype.setup=function(){var f=this.context,d=new y.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(y.EXTENT,0),d.emplaceBack(0,y.EXTENT),d.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(d,La.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var h=new y.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(y.EXTENT,0),h.emplaceBack(0,y.EXTENT),h.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=f.createVertexBuffer(h,La.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=f.createVertexBuffer(g,st.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var w=new y.StructArrayLayout2i4;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(w,La.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var C=new y.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=f.createIndexBuffer(C);var T=new y.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(T),this.emptyTexture=new y.Texture(f,{width:1,height:1,data:new Uint8Array([0,0,0,0])},f.gl.RGBA);var I=this.context.gl;this.stencilClearMode=new Oe({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)},Ji.prototype.clearStencil=function(){var f=this.context,d=f.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=y.create();y.ortho(h,0,this.width,this.height,0,0,1),y.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(f,d.TRIANGLES,we.disabled,this.stencilClearMode,Ke.disabled,ot.disabled,Cu(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ji.prototype._renderTileClippingMasks=function(f,d){if(this.currentStencilSource!==f.source&&f.isTileClipped()&&d&&d.length){this.currentStencilSource=f.source;var h=this.context,g=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(Ke.disabled),h.setDepthMode(we.disabled);var w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,T=d;C<T.length;C+=1){var I=T[C],Z=this._tileClippingMaskIDs[I.key]=this.nextStencilID++;w.draw(h,g.TRIANGLES,we.disabled,new Oe({func:g.ALWAYS,mask:0},Z,255,g.KEEP,g.KEEP,g.REPLACE),Ke.disabled,ot.disabled,Cu(I.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ji.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var f=this.nextStencilID++,d=this.context.gl;return new Oe({func:d.NOTEQUAL,mask:255},f,255,d.KEEP,d.KEEP,d.REPLACE)},Ji.prototype.stencilModeForClipping=function(f){var d=this.context.gl;return new Oe({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[f.key],0,d.KEEP,d.KEEP,d.REPLACE)},Ji.prototype.stencilConfigForOverlap=function(f){var d,h=this.context.gl,g=f.sort(function(Z,$){return $.overscaledZ-Z.overscaledZ}),w=g[g.length-1].overscaledZ,C=g[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var T={},I=0;I<C;I++)T[I+w]=new Oe({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[T,g]}return[(d={},d[w]=Oe.disabled,d),g]},Ji.prototype.colorModeForRenderPass=function(){var f=this.context.gl;return this._showOverdrawInspector?new Ke([f.CONSTANT_COLOR,f.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ke.unblended:Ke.alphaBlended},Ji.prototype.depthModeForSublayer=function(f,d,h){if(!this.opaquePassEnabledForLayer())return we.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+f)*this.depthEpsilon;return new we(h||this.context.gl.LEQUAL,d,[g,g])},Ji.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ji.prototype.render=function(f,d){var h=this;this.style=f,this.options=d,this.lineAtlas=f.lineAtlas,this.imageManager=f.imageManager,this.glyphManager=f.glyphManager,this.symbolFadeChange=f.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,w=this.style.sourceCaches;for(var C in w){var T=w[C];T.used&&T.prepare(this.context)}var I,Z,$={},le={},ve={};for(var xe in w){var ze=w[xe];$[xe]=ze.getVisibleCoordinates(),le[xe]=$[xe].slice().reverse(),ve[xe]=ze.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Fe=0;Fe<g.length;Fe++)if(this.style._layers[g[Fe]].is3D()){this.opaquePassCutoff=Fe;break}this.renderPass="offscreen";for(var Ye=0,Pe=g;Ye<Pe.length;Ye+=1){var $e=this.style._layers[Pe[Ye]];if($e.hasOffscreenPass()&&!$e.isHidden(this.transform.zoom)){var it=le[$e.source];($e.type==="custom"||it.length)&&this.renderLayer(this,w[$e.source],$e,it)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(f._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var Mt=this.style._layers[g[this.currentLayer]],jt=w[Mt.source],Ut=$[Mt.source];this._renderTileClippingMasks(Mt,Ut),this.renderLayer(this,jt,Mt,Ut)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var $t=this.style._layers[g[this.currentLayer]],pr=w[$t.source],zr=($t.type==="symbol"?ve:le)[$t.source];this._renderTileClippingMasks($t,$[$t.source]),this.renderLayer(this,pr,$t,zr)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(Rr){Rr.source&&!Rr.isHidden(h.transform.zoom)&&(Rr.source!==(Z&&Z.id)&&(Z=h.style.sourceCaches[Rr.source]),(!I||I.getSource().maxzoom<Z.getSource().maxzoom)&&(I=Z))}),I&&_s.debug(this,I,I.getVisibleCoordinates())),this.options.showPadding&&function(Rr){var an=Rr.transform.padding;dh(Rr,Rr.transform.height-(an.top||0),3,Cf),dh(Rr,an.bottom||0,3,fh),vh(Rr,an.left||0,3,hh),vh(Rr,Rr.transform.width-(an.right||0),3,Da);var Tn=Rr.transform.centerPoint;(function(In,On,Mi,cn){ml(In,On-1,Mi-10,2,20,cn),ml(In,On-10,Mi-1,20,2,cn)})(Rr,Tn.x,Rr.transform.height-Tn.y,ph)}(this),this.context.setDefault()},Ji.prototype.renderLayer=function(f,d,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||g.length)&&(this.id=h.id,this.gpuTimingStart(h),_s[h.type](f,d,h,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ji.prototype.gpuTimingStart=function(f){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[f.id];h||(h=this.gpuTimers[f.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},Ji.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var f=this.context.extTimerQuery;f.endQueryEXT(f.TIME_ELAPSED_EXT)}},Ji.prototype.collectGpuTimers=function(){var f=this.gpuTimers;return this.gpuTimers={},f},Ji.prototype.queryGpuTimers=function(f){var d={};for(var h in f){var g=f[h],w=this.context.extTimerQuery,C=w.getQueryObjectEXT(g.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(g.query),d[h]=C}return d},Ji.prototype.translatePosMatrix=function(f,d,h,g,w){if(!h[0]&&!h[1])return f;var C=w?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(C){var T=Math.sin(C),I=Math.cos(C);h=[h[0]*I-h[1]*T,h[0]*T+h[1]*I]}var Z=[w?h[0]:zi(d,h[0],this.transform.zoom),w?h[1]:zi(d,h[1],this.transform.zoom),0],$=new Float32Array(16);return y.translate($,f,Z),$},Ji.prototype.saveTileTexture=function(f){var d=this._tileTextures[f.size[0]];d?d.push(f):this._tileTextures[f.size[0]]=[f]},Ji.prototype.getTileTexture=function(f){var d=this._tileTextures[f];return d&&d.length>0?d.pop():null},Ji.prototype.isPatternMissing=function(f){if(!f)return!1;if(!f.from||!f.to)return!0;var d=this.imageManager.getPattern(f.from.toString()),h=this.imageManager.getPattern(f.to.toString());return!d||!h},Ji.prototype.useProgram=function(f,d){this.cache=this.cache||{};var h=""+f+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new uh(this.context,f,gs[f],d,dc[f],this._showOverdrawInspector)),this.cache[h]},Ji.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ji.prototype.setBaseState=function(){var f=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(f.FUNC_ADD)},Ji.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ji.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Wu=function(f,d){this.points=f,this.planes=d};Wu.fromInvProjectionMatrix=function(f,d,h){var g=Math.pow(2,h),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return y.transformMat4([],T,f)}).map(function(T){return y.scale$1([],T,1/T[3]/d*g)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var I=y.sub([],w[T[0]],w[T[1]]),Z=y.sub([],w[T[2]],w[T[1]]),$=y.normalize([],y.cross([],I,Z)),le=-y.dot($,w[T[1]]);return $.concat(le)});return new Wu(w,C)};var su=function(f,d){this.min=f,this.max=d,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};su.prototype.quadrant=function(f){for(var d=[f%2==0,f<2],h=y.clone$2(this.min),g=y.clone$2(this.max),w=0;w<d.length;w++)h[w]=d[w]?this.min[w]:this.center[w],g[w]=d[w]?this.center[w]:this.max[w];return g[2]=this.max[2],new su(h,g)},su.prototype.distanceX=function(f){return Math.max(Math.min(this.max[0],f[0]),this.min[0])-f[0]},su.prototype.distanceY=function(f){return Math.max(Math.min(this.max[1],f[1]),this.min[1])-f[1]},su.prototype.intersects=function(f){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,g=0;g<f.planes.length;g++){for(var w=f.planes[g],C=0,T=0;T<d.length;T++)C+=y.dot$1(w,d[T])>=0;if(C===0)return 0;C!==d.length&&(h=!1)}if(h)return 2;for(var I=0;I<3;I++){for(var Z=Number.MAX_VALUE,$=-Number.MAX_VALUE,le=0;le<f.points.length;le++){var ve=f.points[le][I]-this.min[I];Z=Math.min(Z,ve),$=Math.max($,ve)}if($<0||Z>this.max[I]-this.min[I])return 0}return 1};var Tu=function(f,d,h,g){if(f===void 0&&(f=0),d===void 0&&(d=0),h===void 0&&(h=0),g===void 0&&(g=0),isNaN(f)||f<0||isNaN(d)||d<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=f,this.bottom=d,this.left=h,this.right=g};Tu.prototype.interpolate=function(f,d,h){return d.top!=null&&f.top!=null&&(this.top=y.number(f.top,d.top,h)),d.bottom!=null&&f.bottom!=null&&(this.bottom=y.number(f.bottom,d.bottom,h)),d.left!=null&&f.left!=null&&(this.left=y.number(f.left,d.left,h)),d.right!=null&&f.right!=null&&(this.right=y.number(f.right,d.right,h)),this},Tu.prototype.getCenter=function(f,d){var h=y.clamp((this.left+f-this.right)/2,0,f),g=y.clamp((this.top+d-this.bottom)/2,0,d);return new y.Point(h,g)},Tu.prototype.equals=function(f){return this.top===f.top&&this.bottom===f.bottom&&this.left===f.left&&this.right===f.right},Tu.prototype.clone=function(){return new Tu(this.top,this.bottom,this.left,this.right)},Tu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Si=function(f,d,h,g,w){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=w===void 0||w,this._minZoom=f||0,this._maxZoom=d||22,this._minPitch=h==null?0:h,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Tu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Qi={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Si.prototype.clone=function(){var f=new Si(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return f.tileSize=this.tileSize,f.latRange=this.latRange,f.width=this.width,f.height=this.height,f._center=this._center,f.zoom=this.zoom,f.angle=this.angle,f._fov=this._fov,f._pitch=this._pitch,f._unmodified=this._unmodified,f._edgeInsets=this._edgeInsets.clone(),f._calcMatrices(),f},Qi.minZoom.get=function(){return this._minZoom},Qi.minZoom.set=function(f){this._minZoom!==f&&(this._minZoom=f,this.zoom=Math.max(this.zoom,f))},Qi.maxZoom.get=function(){return this._maxZoom},Qi.maxZoom.set=function(f){this._maxZoom!==f&&(this._maxZoom=f,this.zoom=Math.min(this.zoom,f))},Qi.minPitch.get=function(){return this._minPitch},Qi.minPitch.set=function(f){this._minPitch!==f&&(this._minPitch=f,this.pitch=Math.max(this.pitch,f))},Qi.maxPitch.get=function(){return this._maxPitch},Qi.maxPitch.set=function(f){this._maxPitch!==f&&(this._maxPitch=f,this.pitch=Math.min(this.pitch,f))},Qi.renderWorldCopies.get=function(){return this._renderWorldCopies},Qi.renderWorldCopies.set=function(f){f===void 0?f=!0:f===null&&(f=!1),this._renderWorldCopies=f},Qi.worldSize.get=function(){return this.tileSize*this.scale},Qi.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Qi.size.get=function(){return new y.Point(this.width,this.height)},Qi.bearing.get=function(){return-this.angle/Math.PI*180},Qi.bearing.set=function(f){var d=-y.wrap(f,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Qi.pitch.get=function(){return this._pitch/Math.PI*180},Qi.pitch.set=function(f){var d=y.clamp(f,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},Qi.fov.get=function(){return this._fov/Math.PI*180},Qi.fov.set=function(f){f=Math.max(.01,Math.min(60,f)),this._fov!==f&&(this._unmodified=!1,this._fov=f/180*Math.PI,this._calcMatrices())},Qi.zoom.get=function(){return this._zoom},Qi.zoom.set=function(f){var d=Math.min(Math.max(f,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},Qi.center.get=function(){return this._center},Qi.center.set=function(f){f.lat===this._center.lat&&f.lng===this._center.lng||(this._unmodified=!1,this._center=f,this._constrain(),this._calcMatrices())},Qi.padding.get=function(){return this._edgeInsets.toJSON()},Qi.padding.set=function(f){this._edgeInsets.equals(f)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,f,1),this._calcMatrices())},Qi.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Si.prototype.isPaddingEqual=function(f){return this._edgeInsets.equals(f)},Si.prototype.interpolatePadding=function(f,d,h){this._unmodified=!1,this._edgeInsets.interpolate(f,d,h),this._constrain(),this._calcMatrices()},Si.prototype.coveringZoomLevel=function(f){var d=(f.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/f.tileSize));return Math.max(0,d)},Si.prototype.getVisibleUnwrappedCoordinates=function(f){var d=[new y.UnwrappedTileID(0,f)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),w=this.pointCoordinate(new y.Point(this.width,this.height)),C=this.pointCoordinate(new y.Point(0,this.height)),T=Math.floor(Math.min(h.x,g.x,w.x,C.x)),I=Math.floor(Math.max(h.x,g.x,w.x,C.x)),Z=T-1;Z<=I+1;Z++)Z!==0&&d.push(new y.UnwrappedTileID(Z,f));return d},Si.prototype.coveringTiles=function(f){var d=this.coveringZoomLevel(f),h=d;if(f.minzoom!==void 0&&d<f.minzoom)return[];f.maxzoom!==void 0&&d>f.maxzoom&&(d=f.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),w=Math.pow(2,d),C=[w*g.x,w*g.y,0],T=Wu.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),I=f.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(I=d);var Z=function(Rr){return{aabb:new su([Rr*w,0,0],[(Rr+1)*w,w,0]),zoom:0,x:0,y:0,wrap:Rr,fullyVisible:!1}},$=[],le=[],ve=d,xe=f.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var ze=1;ze<=3;ze++)$.push(Z(-ze)),$.push(Z(ze));for($.push(Z(0));$.length>0;){var Fe=$.pop(),Ye=Fe.x,Pe=Fe.y,$e=Fe.fullyVisible;if(!$e){var it=Fe.aabb.intersects(T);if(it===0)continue;$e=it===2}var Mt=Fe.aabb.distanceX(C),jt=Fe.aabb.distanceY(C),Ut=Math.max(Math.abs(Mt),Math.abs(jt));if(Fe.zoom===ve||Ut>3+(1<<ve-Fe.zoom)-2&&Fe.zoom>=I)le.push({tileID:new y.OverscaledTileID(Fe.zoom===ve?xe:Fe.zoom,Fe.wrap,Fe.zoom,Ye,Pe),distanceSq:y.sqrLen([C[0]-.5-Ye,C[1]-.5-Pe])});else for(var $t=0;$t<4;$t++){var pr=(Ye<<1)+$t%2,zr=(Pe<<1)+($t>>1);$.push({aabb:Fe.aabb.quadrant($t),zoom:Fe.zoom+1,x:pr,y:zr,wrap:Fe.wrap,fullyVisible:$e})}}return le.sort(function(Rr,an){return Rr.distanceSq-an.distanceSq}).map(function(Rr){return Rr.tileID})},Si.prototype.resize=function(f,d){this.width=f,this.height=d,this.pixelsToGLUnits=[2/f,-2/d],this._constrain(),this._calcMatrices()},Qi.unmodified.get=function(){return this._unmodified},Si.prototype.zoomScale=function(f){return Math.pow(2,f)},Si.prototype.scaleZoom=function(f){return Math.log(f)/Math.LN2},Si.prototype.project=function(f){var d=y.clamp(f.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(f.lng)*this.worldSize,y.mercatorYfromLat(d)*this.worldSize)},Si.prototype.unproject=function(f){return new y.MercatorCoordinate(f.x/this.worldSize,f.y/this.worldSize).toLngLat()},Qi.point.get=function(){return this.project(this.center)},Si.prototype.setLocationAtPoint=function(f,d){var h=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(f),C=new y.MercatorCoordinate(w.x-(h.x-g.x),w.y-(h.y-g.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},Si.prototype.locationPoint=function(f){return this.coordinatePoint(this.locationCoordinate(f))},Si.prototype.pointLocation=function(f){return this.coordinateLocation(this.pointCoordinate(f))},Si.prototype.locationCoordinate=function(f){return y.MercatorCoordinate.fromLngLat(f)},Si.prototype.coordinateLocation=function(f){return f.toLngLat()},Si.prototype.pointCoordinate=function(f){var d=[f.x,f.y,0,1],h=[f.x,f.y,1,1];y.transformMat4(d,d,this.pixelMatrixInverse),y.transformMat4(h,h,this.pixelMatrixInverse);var g=d[3],w=h[3],C=d[1]/g,T=h[1]/w,I=d[2]/g,Z=h[2]/w,$=I===Z?0:(0-I)/(Z-I);return new y.MercatorCoordinate(y.number(d[0]/g,h[0]/w,$)/this.worldSize,y.number(C,T,$)/this.worldSize)},Si.prototype.coordinatePoint=function(f){var d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix),new y.Point(d[0]/d[3],d[1]/d[3])},Si.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Si.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Si.prototype.setMaxBounds=function(f){f?(this.lngRange=[f.getWest(),f.getEast()],this.latRange=[f.getSouth(),f.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Si.prototype.calculatePosMatrix=function(f,d){d===void 0&&(d=!1);var h=f.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[h])return g[h];var w=f.canonical,C=this.worldSize/this.zoomScale(w.z),T=w.x+Math.pow(2,w.z)*f.wrap,I=y.identity(new Float64Array(16));return y.translate(I,I,[T*C,w.y*C,0]),y.scale(I,I,[C/y.EXTENT,C/y.EXTENT,1]),y.multiply(I,d?this.alignedProjMatrix:this.projMatrix,I),g[h]=new Float32Array(I),g[h]},Si.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Si.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var f,d,h,g,w=-90,C=90,T=-180,I=180,Z=this.size,$=this._unmodified;if(this.latRange){var le=this.latRange;w=y.mercatorYfromLat(le[1])*this.worldSize,f=(C=y.mercatorYfromLat(le[0])*this.worldSize)-w<Z.y?Z.y/(C-w):0}if(this.lngRange){var ve=this.lngRange;T=y.mercatorXfromLng(ve[0])*this.worldSize,d=(I=y.mercatorXfromLng(ve[1])*this.worldSize)-T<Z.x?Z.x/(I-T):0}var xe=this.point,ze=Math.max(d||0,f||0);if(ze)return this.center=this.unproject(new y.Point(d?(I+T)/2:xe.x,f?(C+w)/2:xe.y)),this.zoom+=this.scaleZoom(ze),this._unmodified=$,void(this._constraining=!1);if(this.latRange){var Fe=xe.y,Ye=Z.y/2;Fe-Ye<w&&(g=w+Ye),Fe+Ye>C&&(g=C-Ye)}if(this.lngRange){var Pe=xe.x,$e=Z.x/2;Pe-$e<T&&(h=T+$e),Pe+$e>I&&(h=I-$e)}h===void 0&&g===void 0||(this.center=this.unproject(new y.Point(h!==void 0?h:xe.x,g!==void 0?g:xe.y))),this._unmodified=$,this._constraining=!1}},Si.prototype._calcMatrices=function(){if(this.height){var f=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+f.y/this.height),g=Math.sin(h)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-d-h,.01,Math.PI-.01)),w=this.point,C=w.x,T=w.y,I=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),Z=this.height/50,$=new Float64Array(16);y.perspective($,this._fov,this.width/this.height,Z,I),$[8]=2*-f.x/this.width,$[9]=2*f.y/this.height,y.scale($,$,[1,-1,1]),y.translate($,$,[0,0,-this.cameraToCenterDistance]),y.rotateX($,$,this._pitch),y.rotateZ($,$,this.angle),y.translate($,$,[-C,-T,0]),this.mercatorMatrix=y.scale([],$,[this.worldSize,this.worldSize,this.worldSize]),y.scale($,$,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=$,this.invProjMatrix=y.invert([],this.projMatrix);var le=this.width%2/2,ve=this.height%2/2,xe=Math.cos(this.angle),ze=Math.sin(this.angle),Fe=C-Math.round(C)+xe*le+ze*ve,Ye=T-Math.round(T)+xe*ve+ze*le,Pe=new Float64Array($);if(y.translate(Pe,Pe,[Fe>.5?Fe-1:Fe,Ye>.5?Ye-1:Ye,0]),this.alignedProjMatrix=Pe,$=y.create(),y.scale($,$,[this.width/2,-this.height/2,1]),y.translate($,$,[1,-1,0]),this.labelPlaneMatrix=$,$=y.create(),y.scale($,$,[1,-1,1]),y.translate($,$,[-1,-1,0]),y.scale($,$,[2/this.width,2/this.height,1]),this.glCoordMatrix=$,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!($=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=$,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Si.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var f=this.pointCoordinate(new y.Point(0,0)),d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},Si.prototype.getCameraPoint=function(){var f=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,f))},Si.prototype.getCameraQueryGeometry=function(f){var d=this.getCameraPoint();if(f.length===1)return[f[0],d];for(var h=d.x,g=d.y,w=d.x,C=d.y,T=0,I=f;T<I.length;T+=1){var Z=I[T];h=Math.min(h,Z.x),g=Math.min(g,Z.y),w=Math.max(w,Z.x),C=Math.max(C,Z.y)}return[new y.Point(h,g),new y.Point(w,g),new y.Point(w,C),new y.Point(h,C),new y.Point(h,g)]},Object.defineProperties(Si.prototype,Qi);var Vs=function(f){var d,h,g,w;this._hashName=f&&encodeURIComponent(f),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),h=!1,g=null,w=function(){g=null,h&&(d(),g=setTimeout(w,300),h=!1)},function(){return h=!0,g||w(),g})};Vs.prototype.addTo=function(f){return this._map=f,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Vs.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Vs.prototype.getHashString=function(f){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,g),C=Math.round(d.lng*w)/w,T=Math.round(d.lat*w)/w,I=this._map.getBearing(),Z=this._map.getPitch(),$="";if($+=f?"/"+C+"/"+T+"/"+h:h+"/"+T+"/"+C,(I||Z)&&($+="/"+Math.round(10*I)/10),Z&&($+="/"+Math.round(Z)),this._hashName){var le=this._hashName,ve=!1,xe=y.window.location.hash.slice(1).split("&").map(function(ze){var Fe=ze.split("=")[0];return Fe===le?(ve=!0,Fe+"="+$):ze}).filter(function(ze){return ze});return ve||xe.push(le+"="+$),"#"+xe.join("&")}return"#"+$},Vs.prototype._getCurrentHash=function(){var f,d=this,h=y.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===d._hashName&&(f=g)}),(f&&f[1]||"").split("/")):h.split("/")},Vs.prototype._onHashChange=function(){var f=this._getCurrentHash();if(f.length>=3&&!f.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:d,pitch:+(f[4]||0)}),!0}return!1},Vs.prototype._updateHashUnthrottled=function(){var f=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,f)}catch(d){}};var gc={linearity:.3,easing:y.bezier(0,0,.3,1)},yc=y.extend({deceleration:2500,maxSpeed:1400},gc),xs=y.extend({deceleration:20,maxSpeed:1400},gc),Vh=y.extend({deceleration:1e3,maxSpeed:360},gc),jh=y.extend({deceleration:1e3,maxSpeed:90},gc),_c=function(f){this._map=f,this.clear()};function $u(f,d){(!f.duration||f.duration<d.duration)&&(f.duration=d.duration,f.easing=d.easing)}function Mu(f,d,h){var g=h.maxSpeed,w=h.linearity,C=h.deceleration,T=y.clamp(f*w/(d/1e3),-g,g),I=Math.abs(T)/(C*w);return{easing:h.easing,duration:1e3*I,amount:T*(I/2)}}_c.prototype.clear=function(){this._inertiaBuffer=[]},_c.prototype.record=function(f){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:f})},_c.prototype._drainInertiaBuffer=function(){for(var f=this._inertiaBuffer,d=y.browser.now();f.length>0&&d-f[0].time>160;)f.shift()},_c.prototype._onMoveEnd=function(f){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},h=0,g=this._inertiaBuffer;h<g.length;h+=1){var w=g[h].settings;d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(d.pan.mag()){var I=Mu(d.pan.mag(),C,y.extend({},yc,f||{}));T.offset=d.pan.mult(I.amount/d.pan.mag()),T.center=this._map.transform.center,$u(T,I)}if(d.zoom){var Z=Mu(d.zoom,C,xs);T.zoom=this._map.transform.zoom+Z.amount,$u(T,Z)}if(d.bearing){var $=Mu(d.bearing,C,Vh);T.bearing=this._map.transform.bearing+y.clamp($.amount,-179,179),$u(T,$)}if(d.pitch){var le=Mu(d.pitch,C,jh);T.pitch=this._map.transform.pitch+le.amount,$u(T,le)}if(T.zoom||T.bearing){var ve=d.pinchAround===void 0?d.around:d.pinchAround;T.around=ve?this._map.unproject(ve):this._map.getCenter()}return this.clear(),y.extend(T,{noMoveStart:!0})}};var Oa=function(f){function d(g,w,C,T){T===void 0&&(T={});var I=U.mousePos(w.getCanvasContainer(),C),Z=w.unproject(I);f.call(this,g,y.extend({point:I,lngLat:Z,originalEvent:C},T)),this._defaultPrevented=!1,this.target=w}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Jo=function(f){function d(g,w,C){var T=g==="touchend"?C.changedTouches:C.touches,I=U.touchPos(w.getCanvasContainer(),T),Z=I.map(function(ve){return w.unproject(ve)}),$=I.reduce(function(ve,xe,ze,Fe){return ve.add(xe.div(Fe.length))},new y.Point(0,0)),le=w.unproject($);f.call(this,g,{points:I,point:$,lngLats:Z,lngLat:le,originalEvent:C}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),uu=function(f){function d(g,w,C){f.call(this,g,{originalEvent:C}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Fa=function(f,d){this._map=f,this._clickTolerance=d.clickTolerance};Fa.prototype.reset=function(){delete this._mousedownPos},Fa.prototype.wheel=function(f){return this._firePreventable(new uu(f.type,this._map,f))},Fa.prototype.mousedown=function(f,d){return this._mousedownPos=d,this._firePreventable(new Oa(f.type,this._map,f))},Fa.prototype.mouseup=function(f){this._map.fire(new Oa(f.type,this._map,f))},Fa.prototype.click=function(f,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Oa(f.type,this._map,f))},Fa.prototype.dblclick=function(f){return this._firePreventable(new Oa(f.type,this._map,f))},Fa.prototype.mouseover=function(f){this._map.fire(new Oa(f.type,this._map,f))},Fa.prototype.mouseout=function(f){this._map.fire(new Oa(f.type,this._map,f))},Fa.prototype.touchstart=function(f){return this._firePreventable(new Jo(f.type,this._map,f))},Fa.prototype.touchmove=function(f){this._map.fire(new Jo(f.type,this._map,f))},Fa.prototype.touchend=function(f){this._map.fire(new Jo(f.type,this._map,f))},Fa.prototype.touchcancel=function(f){this._map.fire(new Jo(f.type,this._map,f))},Fa.prototype._firePreventable=function(f){if(this._map.fire(f),f.defaultPrevented)return{}},Fa.prototype.isEnabled=function(){return!0},Fa.prototype.isActive=function(){return!1},Fa.prototype.enable=function(){},Fa.prototype.disable=function(){};var pn=function(f){this._map=f};pn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},pn.prototype.mousemove=function(f){this._map.fire(new Oa(f.type,this._map,f))},pn.prototype.mousedown=function(){this._delayContextMenu=!0},pn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Oa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},pn.prototype.contextmenu=function(f){this._delayContextMenu?this._contextMenuEvent=f:this._map.fire(new Oa(f.type,this._map,f)),this._map.listens("contextmenu")&&f.preventDefault()},pn.prototype.isEnabled=function(){return!0},pn.prototype.isActive=function(){return!1},pn.prototype.enable=function(){},pn.prototype.disable=function(){};var No=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._container=f.getContainer(),this._clickTolerance=d.clickTolerance||1};function Xc(f,d){for(var h={},g=0;g<f.length;g++)h[f[g].identifier]=d[g];return h}No.prototype.isEnabled=function(){return!!this._enabled},No.prototype.isActive=function(){return!!this._active},No.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},No.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},No.prototype.mousedown=function(f,d){this.isEnabled()&&f.shiftKey&&f.button===0&&(U.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},No.prototype.mousemoveWindow=function(f,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=h,this._box||(this._box=U.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",f));var w=Math.min(g.x,h.x),C=Math.max(g.x,h.x),T=Math.min(g.y,h.y),I=Math.max(g.y,h.y);U.setTransform(this._box,"translate("+w+"px,"+T+"px)"),this._box.style.width=C-w+"px",this._box.style.height=I-T+"px"}}},No.prototype.mouseupWindow=function(f,d){var h=this;if(this._active&&f.button===0){var g=this._startPos,w=d;if(this.reset(),U.suppressClick(),g.x!==w.x||g.y!==w.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:f})),{cameraAnimation:function(C){return C.fitScreenCoordinates(g,w,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",f)}},No.prototype.keydown=function(f){this._active&&f.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",f))},No.prototype.blur=function(){this.reset()},No.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos},No.prototype._fireEvent=function(f,d){return this._map.fire(new y.Event(f,{originalEvent:d}))};var gl=function(f){this.reset(),this.numTouches=f.numTouches};gl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},gl.prototype.touchstart=function(f,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=f.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){for(var w=new y.Point(0,0),C=0,T=g;C<T.length;C+=1)w._add(T[C]);return w.div(g.length)}(d),this.touches=Xc(h,d)))},gl.prototype.touchmove=function(f,d,h){if(!this.aborted&&this.centroid){var g=Xc(h,d);for(var w in this.touches){var C=g[w];(!C||C.dist(this.touches[w])>30)&&(this.aborted=!0)}}},gl.prototype.touchend=function(f,d,h){if((!this.centroid||f.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var bs=function(f){this.singleTap=new gl(f),this.numTaps=f.numTaps,this.reset()};bs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},bs.prototype.touchstart=function(f,d,h){this.singleTap.touchstart(f,d,h)},bs.prototype.touchmove=function(f,d,h){this.singleTap.touchmove(f,d,h)},bs.prototype.touchend=function(f,d,h){var g=this.singleTap.touchend(f,d,h);if(g){var w=f.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(g)<30;if(w&&C||this.reset(),this.count++,this.lastTime=f.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var us=function(){this._zoomIn=new bs({numTouches:1,numTaps:2}),this._zoomOut=new bs({numTouches:2,numTaps:1}),this.reset()};us.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},us.prototype.touchstart=function(f,d,h){this._zoomIn.touchstart(f,d,h),this._zoomOut.touchstart(f,d,h)},us.prototype.touchmove=function(f,d,h){this._zoomIn.touchmove(f,d,h),this._zoomOut.touchmove(f,d,h)},us.prototype.touchend=function(f,d,h){var g=this,w=this._zoomIn.touchend(f,d,h),C=this._zoomOut.touchend(f,d,h);return w?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(w)},{originalEvent:f})}}):C?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(C)},{originalEvent:f})}}):void 0},us.prototype.touchcancel=function(){this.reset()},us.prototype.enable=function(){this._enabled=!0},us.prototype.disable=function(){this._enabled=!1,this.reset()},us.prototype.isEnabled=function(){return this._enabled},us.prototype.isActive=function(){return this._active};var Xu={0:1,2:2},Dr=function(f){this.reset(),this._clickTolerance=f.clickTolerance||1};Dr.prototype.blur=function(){this.reset()},Dr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Dr.prototype._correctButton=function(f,d){return!1},Dr.prototype._move=function(f,d){return{}},Dr.prototype.mousedown=function(f,d){if(!this._lastPoint){var h=U.mouseButton(f);this._correctButton(f,h)&&(this._lastPoint=d,this._eventButton=h)}},Dr.prototype.mousemoveWindow=function(f,d){var h=this._lastPoint;if(h){if(f.preventDefault(),function(g,w){var C=Xu[w];return g.buttons===void 0||(g.buttons&C)!==C}(f,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},Dr.prototype.mouseupWindow=function(f){this._lastPoint&&U.mouseButton(f)===this._eventButton&&(this._moved&&U.suppressClick(),this.reset())},Dr.prototype.enable=function(){this._enabled=!0},Dr.prototype.disable=function(){this._enabled=!1,this.reset()},Dr.prototype.isEnabled=function(){return this._enabled},Dr.prototype.isActive=function(){return this._active};var Yc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.mousedown=function(h,g){f.prototype.mousedown.call(this,h,g),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,g){return g===0&&!h.ctrlKey},d.prototype._move=function(h,g){return{around:g,panDelta:g.sub(h)}},d}(Dr),xc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=.8*(g.x-h.x);if(w)return this._active=!0,{bearingDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Dr),lu=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=-.5*(g.y-h.y);if(w)return this._active=!0,{pitchDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Dr),js=function(f){this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset()};js.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},js.prototype.touchstart=function(f,d,h){return this._calculateTransform(f,d,h)},js.prototype.touchmove=function(f,d,h){if(this._active&&!(h.length<this._minTouches))return f.preventDefault(),this._calculateTransform(f,d,h)},js.prototype.touchend=function(f,d,h){this._calculateTransform(f,d,h),this._active&&h.length<this._minTouches&&this.reset()},js.prototype.touchcancel=function(){this.reset()},js.prototype._calculateTransform=function(f,d,h){h.length>0&&(this._active=!0);var g=Xc(h,d),w=new y.Point(0,0),C=new y.Point(0,0),T=0;for(var I in g){var Z=g[I],$=this._touches[I];$&&(w._add(Z),C._add(Z.sub($)),T++,g[I]=Z)}if(this._touches=g,!(T<this._minTouches)&&C.mag()){var le=C.div(T);if(this._sum._add(le),!(this._sum.mag()<this._clickTolerance))return{around:w.div(T),panDelta:le}}},js.prototype.enable=function(){this._enabled=!0},js.prototype.disable=function(){this._enabled=!1,this.reset()},js.prototype.isEnabled=function(){return this._enabled},js.prototype.isActive=function(){return this._active};var Qo=function(){this.reset()};function qc(f,d,h){for(var g=0;g<f.length;g++)if(f[g].identifier===h)return d[g]}function Kc(f,d){return Math.log(f/d)/Math.LN2}Qo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Qo.prototype._start=function(f){},Qo.prototype._move=function(f,d,h){return{}},Qo.prototype.touchstart=function(f,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},Qo.prototype.touchmove=function(f,d,h){if(this._firstTwoTouches){f.preventDefault();var g=this._firstTwoTouches,w=g[1],C=qc(h,d,g[0]),T=qc(h,d,w);if(C&&T){var I=this._aroundCenter?null:C.add(T).div(2);return this._move([C,T],I,f)}}},Qo.prototype.touchend=function(f,d,h){if(this._firstTwoTouches){var g=this._firstTwoTouches,w=g[1],C=qc(h,d,g[0]),T=qc(h,d,w);C&&T||(this._active&&U.suppressClick(),this.reset())}},Qo.prototype.touchcancel=function(){this.reset()},Qo.prototype.enable=function(f){this._enabled=!0,this._aroundCenter=!!f&&f.around==="center"},Qo.prototype.disable=function(){this._enabled=!1,this.reset()},Qo.prototype.isEnabled=function(){return this._enabled},Qo.prototype.isActive=function(){return this._active};var ls=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,w),pinchAround:g}},d}(Qo);function cu(f,d){return 180*f.angleWith(d)/Math.PI}var Jc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:cu(this._vector,w),pinchAround:g}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var g=25/(Math.PI*this._minDiameter)*360,w=cu(h,this._startVector);return Math.abs(w)<g},d}(Qo);function $l(f){return Math.abs(f.y)>Math.abs(f.x)}var bc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,$l(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,g,w){var C=h[0].sub(this._lastPoints[0]),T=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,T,w.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(C.y+T.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,g,w){if(this._valid!==void 0)return this._valid;var C=h.mag()>=2,T=g.mag()>=2;if(C||T){if(!C||!T)return this._firstMove===void 0&&(this._firstMove=w),w-this._firstMove<100&&void 0;var I=h.y>0==g.y>0;return $l(h)&&$l(g)&&I}},d}(Qo),Xl={panStep:100,bearingStep:15,pitchStep:10},Gs=function(){var f=Xl;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1};function It(f){return f*(2-f)}Gs.prototype.blur=function(){this.reset()},Gs.prototype.reset=function(){this._active=!1},Gs.prototype.keydown=function(f){var d=this;if(!(f.altKey||f.ctrlKey||f.metaKey)){var h=0,g=0,w=0,C=0,T=0;switch(f.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:f.shiftKey?g=-1:(f.preventDefault(),C=-1);break;case 39:f.shiftKey?g=1:(f.preventDefault(),C=1);break;case 38:f.shiftKey?w=1:(f.preventDefault(),T=-1);break;case 40:f.shiftKey?w=-1:(f.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(g=0,w=0),{cameraAnimation:function(I){var Z=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:It,zoom:h?Math.round(Z)+h*(f.shiftKey?2:1):Z,bearing:I.getBearing()+g*d._bearingStep,pitch:I.getPitch()+w*d._pitchStep,offset:[-C*d._panStep,-T*d._panStep],center:I.getCenter()},{originalEvent:f})}}}},Gs.prototype.enable=function(){this._enabled=!0},Gs.prototype.disable=function(){this._enabled=!1,this.reset()},Gs.prototype.isEnabled=function(){return this._enabled},Gs.prototype.isActive=function(){return this._active},Gs.prototype.disableRotation=function(){this._rotationDisabled=!0},Gs.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ee=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};Ee.prototype.setZoomRate=function(f){this._defaultZoomRate=f},Ee.prototype.setWheelZoomRate=function(f){this._wheelZoomRate=f},Ee.prototype.isEnabled=function(){return!!this._enabled},Ee.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ee.prototype.isZooming=function(){return!!this._zooming},Ee.prototype.enable=function(f){this.isEnabled()||(this._enabled=!0,this._aroundCenter=f&&f.around==="center")},Ee.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ee.prototype.wheel=function(f){if(this.isEnabled()){var d=f.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*f.deltaY:f.deltaY,h=y.browser.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,f)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),f.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=f,this._delta-=d,this._active||this._start(f)),f.preventDefault()}},Ee.prototype._onTimeout=function(f){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},Ee.prototype._start=function(f){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=U.mousePos(this._el,f);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ee.prototype.renderFrame=function(){var f=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&g!==0&&(g=1/g);var w=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(w*g))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,T=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,I=this._startZoom,Z=this._easing,$=!1;if(this._type==="wheel"&&I&&Z){var le=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),ve=Z(le);C=y.number(I,T,ve),le<1?this._frameId||(this._frameId=!0):$=!0}else C=T,$=!0;return this._active=!0,$&&(this._active=!1,this._finishTimeout=setTimeout(function(){f._zooming=!1,f._handler._triggerRenderFrame(),delete f._targetZoom,delete f._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!$,zoomDelta:C-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ee.prototype._smoothOutEasing=function(f){var d=y.ease;if(this._prevEase){var h=this._prevEase,g=(y.browser.now()-h.start)/h.duration,w=h.easing(g+.01)-h.easing(g),C=.27/Math.sqrt(w*w+1e-4)*.01,T=Math.sqrt(.0729-C*C);d=y.bezier(C,T,.25,1)}return this._prevEase={start:y.browser.now(),duration:f,easing:d},d},Ee.prototype.blur=function(){this.reset()},Ee.prototype.reset=function(){this._active=!1};var V=function(f,d){this._clickZoom=f,this._tapZoom=d};V.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},V.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},V.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},V.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var go=function(){this.reset()};go.prototype.reset=function(){this._active=!1},go.prototype.blur=function(){this.reset()},go.prototype.dblclick=function(f,d){return f.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(f.shiftKey?-1:1),around:h.unproject(d)},{originalEvent:f})}}},go.prototype.enable=function(){this._enabled=!0},go.prototype.disable=function(){this._enabled=!1,this.reset()},go.prototype.isEnabled=function(){return this._enabled},go.prototype.isActive=function(){return this._active};var he=function(){this._tap=new bs({numTouches:1,numTaps:1}),this.reset()};he.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},he.prototype.touchstart=function(f,d,h){this._swipePoint||(this._tapTime&&f.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(f,d,h))},he.prototype.touchmove=function(f,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var g=d[0],w=g.y-this._swipePoint.y;return this._swipePoint=g,f.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(f,d,h)},he.prototype.touchend=function(f,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(f,d,h)&&(this._tapTime=f.timeStamp)},he.prototype.touchcancel=function(){this.reset()},he.prototype.enable=function(){this._enabled=!0},he.prototype.disable=function(){this._enabled=!1,this.reset()},he.prototype.isEnabled=function(){return this._enabled},he.prototype.isActive=function(){return this._active};var Yu=function(f,d,h){this._el=f,this._mousePan=d,this._touchPan=h};Yu.prototype.enable=function(f){this._inertiaOptions=f||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Yu.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Yu.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Yu.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ya=function(f,d,h){this._pitchWithRotate=f.pitchWithRotate,this._mouseRotate=d,this._mousePitch=h};ya.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ya.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ya.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ya.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var cs=function(f,d,h,g){this._el=f,this._touchZoom=d,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};cs.prototype.enable=function(f){this._touchZoom.enable(f),this._rotationDisabled||this._touchRotate.enable(f),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},cs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},cs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},cs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},cs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},cs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var so=function(f){return f.zoom||f.drag||f.pitch||f.rotate},Zo=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(y.Event);function Ln(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}var _n=function(f,d){this._map=f,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new _c(f),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),y.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,w=this._listeners;g<w.length;g+=1){var C=w[g],T=C[0];U.addEventListener(T,C[1],T===y.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};_n.prototype.destroy=function(){for(var f=0,d=this._listeners;f<d.length;f+=1){var h=d[f],g=h[0];U.removeEventListener(g,h[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},_n.prototype._addDefaultHandlers=function(f){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new Fa(d,f));var g=d.boxZoom=new No(d,f);this._add("boxZoom",g);var w=new us,C=new go;d.doubleClickZoom=new V(C,w),this._add("tapZoom",w),this._add("clickZoom",C);var T=new he;this._add("tapDragZoom",T);var I=d.touchPitch=new bc;this._add("touchPitch",I);var Z=new xc(f),$=new lu(f);d.dragRotate=new ya(f,Z,$),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);var le=new Yc(f),ve=new js(f);d.dragPan=new Yu(h,le,ve),this._add("mousePan",le),this._add("touchPan",ve,["touchZoom","touchRotate"]);var xe=new Jc,ze=new ls;d.touchZoomRotate=new cs(h,ze,xe,T),this._add("touchRotate",xe,["touchPan","touchZoom"]),this._add("touchZoom",ze,["touchPan","touchRotate"]);var Fe=d.scrollZoom=new Ee(d,this);this._add("scrollZoom",Fe,["mousePan"]);var Ye=d.keyboard=new Gs;this._add("keyboard",Ye),this._add("blockableMapEvent",new pn(d));for(var Pe=0,$e=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Pe<$e.length;Pe+=1){var it=$e[Pe];f.interactive&&f[it]&&d[it].enable(f[it])}},_n.prototype._add=function(f,d,h){this._handlers.push({handlerName:f,handler:d,allowed:h}),this._handlersById[f]=d},_n.prototype.stop=function(f){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},f),this._changes=[]}},_n.prototype.isActive=function(){for(var f=0,d=this._handlers;f<d.length;f+=1)if(d[f].handler.isActive())return!0;return!1},_n.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},_n.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},_n.prototype.isMoving=function(){return Boolean(so(this._eventsInProgress))||this.isZooming()},_n.prototype._blockedByActive=function(f,d,h){for(var g in f)if(g!==h&&(!d||d.indexOf(g)<0))return!0;return!1},_n.prototype.handleWindowEvent=function(f){this.handleEvent(f,f.type+"Window")},_n.prototype._getMapTouches=function(f){for(var d=[],h=0,g=f;h<g.length;h+=1){var w=g[h];this._el.contains(w.target)&&d.push(w)}return d},_n.prototype.handleEvent=function(f,d){this._updatingCamera=!0;for(var h=f.type==="renderFrame"?void 0:f,g={needsRenderFrame:!1},w={},C={},T=f.touches?this._getMapTouches(f.touches):void 0,I=T?U.touchPos(this._el,T):U.mousePos(this._el,f),Z=0,$=this._handlers;Z<$.length;Z+=1){var le=$[Z],ve=le.handlerName,xe=le.handler,ze=le.allowed;if(xe.isEnabled()){var Fe=void 0;this._blockedByActive(C,ze,ve)?xe.reset():xe[d||f.type]&&(Fe=xe[d||f.type](f,I,T),this.mergeHandlerResult(g,w,Fe,ve,h),Fe&&Fe.needsRenderFrame&&this._triggerRenderFrame()),(Fe||xe.isActive())&&(C[ve]=xe)}}var Ye={};for(var Pe in this._previousActiveHandlers)C[Pe]||(Ye[Pe]=h);this._previousActiveHandlers=C,(Object.keys(Ye).length||Ln(g))&&(this._changes.push([g,w,Ye]),this._triggerRenderFrame()),(Object.keys(C).length||Ln(g))&&this._map._stop(!0),this._updatingCamera=!1;var $e=g.cameraAnimation;$e&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$e(this._map))},_n.prototype.mergeHandlerResult=function(f,d,h,g,w){if(h){y.extend(f,h);var C={handlerName:g,originalEvent:h.originalEvent||w};h.zoomDelta!==void 0&&(d.zoom=C),h.panDelta!==void 0&&(d.drag=C),h.pitchDelta!==void 0&&(d.pitch=C),h.bearingDelta!==void 0&&(d.rotate=C)}},_n.prototype._applyChanges=function(){for(var f={},d={},h={},g=0,w=this._changes;g<w.length;g+=1){var C=w[g],T=C[0],I=C[1],Z=C[2];T.panDelta&&(f.panDelta=(f.panDelta||new y.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(f.zoomDelta=(f.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(f.bearingDelta=(f.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(f.pitchDelta=(f.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(f.around=T.around),T.pinchAround!==void 0&&(f.pinchAround=T.pinchAround),T.noInertia&&(f.noInertia=T.noInertia),y.extend(d,I),y.extend(h,Z)}this._updateMapTransform(f,d,h),this._changes=[]},_n.prototype._updateMapTransform=function(f,d,h){var g=this._map,w=g.transform;if(!Ln(f))return this._fireEvents(d,h,!0);var C=f.panDelta,T=f.zoomDelta,I=f.bearingDelta,Z=f.pitchDelta,$=f.around,le=f.pinchAround;le!==void 0&&($=le),g._stop(!0),$=$||g.transform.centerPoint;var ve=w.pointLocation(C?$.sub(C):$);I&&(w.bearing+=I),Z&&(w.pitch+=Z),T&&(w.zoom+=T),w.setLocationAtPoint(ve,$),this._map._update(),f.noInertia||this._inertia.record(f),this._fireEvents(d,h,!0)},_n.prototype._fireEvents=function(f,d,h){var g=this,w=so(this._eventsInProgress),C=so(f),T={};for(var I in f)this._eventsInProgress[I]||(T[I+"start"]=f[I].originalEvent),this._eventsInProgress[I]=f[I];for(var Z in!w&&C&&this._fireEvent("movestart",C.originalEvent),T)this._fireEvent(Z,T[Z]);for(var $ in C&&this._fireEvent("move",C.originalEvent),f)this._fireEvent($,f[$].originalEvent);var le,ve={};for(var xe in this._eventsInProgress){var ze=this._eventsInProgress[xe],Fe=ze.handlerName,Ye=ze.originalEvent;this._handlersById[Fe].isActive()||(delete this._eventsInProgress[xe],ve[xe+"end"]=le=d[Fe]||Ye)}for(var Pe in ve)this._fireEvent(Pe,ve[Pe]);var $e=so(this._eventsInProgress);if(h&&(w||C)&&!$e){this._updatingCamera=!0;var it=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Mt=function(jt){return jt!==0&&-g._bearingSnap<jt&&jt<g._bearingSnap};it?(Mt(it.bearing||this._map.getBearing())&&(it.bearing=0),this._map.easeTo(it,{originalEvent:le})):(this._map.fire(new y.Event("moveend",{originalEvent:le})),Mt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},_n.prototype._fireEvent=function(f,d){this._map.fire(new y.Event(f,d?{originalEvent:d}:{}))},_n.prototype._requestFrame=function(){var f=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete f._frameId,f.handleEvent(new Zo("renderFrame",{timeStamp:d})),f._applyChanges()})},_n.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var qu=function(f){function d(h,g){f.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,g){return this.jumpTo({center:h},g)},d.prototype.panBy=function(h,g,w){return h=y.Point.convert(h).mult(-1),this.panTo(this.transform.center,y.extend({offset:h},g),w)},d.prototype.panTo=function(h,g,w){return this.easeTo(y.extend({center:h},g),w)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,g){return this.jumpTo({zoom:h},g),this},d.prototype.zoomTo=function(h,g,w){return this.easeTo(y.extend({zoom:h},g),w)},d.prototype.zoomIn=function(h,g){return this.zoomTo(this.getZoom()+1,h,g),this},d.prototype.zoomOut=function(h,g){return this.zoomTo(this.getZoom()-1,h,g),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,g){return this.jumpTo({bearing:h},g),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,g){return this.jumpTo({padding:h},g),this},d.prototype.rotateTo=function(h,g,w){return this.easeTo(y.extend({bearing:h},g),w)},d.prototype.resetNorth=function(h,g){return this.rotateTo(0,y.extend({duration:1e3},h),g),this},d.prototype.resetNorthPitch=function(h,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},h),g),this},d.prototype.snapToNorth=function(h,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,g):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,g){return this.jumpTo({pitch:h},g),this},d.prototype.cameraForBounds=function(h,g){h=y.LngLatBounds.convert(h);var w=g&&g.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),w,g)},d.prototype._cameraForBoxAndBearing=function(h,g,w,C){var T={top:0,bottom:0,right:0,left:0};if(typeof(C=y.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var I=C.padding;C.padding={top:I,bottom:I,right:I,left:I}}C.padding=y.extend(T,C.padding);var Z=this.transform,$=Z.padding,le=Z.project(y.LngLat.convert(h)),ve=Z.project(y.LngLat.convert(g)),xe=le.rotate(-w*Math.PI/180),ze=ve.rotate(-w*Math.PI/180),Fe=new y.Point(Math.max(xe.x,ze.x),Math.max(xe.y,ze.y)),Ye=new y.Point(Math.min(xe.x,ze.x),Math.min(xe.y,ze.y)),Pe=Fe.sub(Ye),$e=(Z.width-($.left+$.right+C.padding.left+C.padding.right))/Pe.x,it=(Z.height-($.top+$.bottom+C.padding.top+C.padding.bottom))/Pe.y;if(!(it<0||$e<0)){var Mt=Math.min(Z.scaleZoom(Z.scale*Math.min($e,it)),C.maxZoom),jt=typeof C.offset.x=="number"?new y.Point(C.offset.x,C.offset.y):y.Point.convert(C.offset),Ut=new y.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(w*Math.PI/180),$t=jt.add(Ut).mult(Z.scale/Z.zoomScale(Mt));return{center:Z.unproject(le.add(ve).div(2).sub($t)),zoom:Mt,bearing:w}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,g,w){return this._fitInternal(this.cameraForBounds(h,g),g,w)},d.prototype.fitScreenCoordinates=function(h,g,w,C,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(h)),this.transform.pointLocation(y.Point.convert(g)),w,C),C,T)},d.prototype._fitInternal=function(h,g,w){return h?(delete(g=y.extend(h,g)).padding,g.linear?this.easeTo(g,w):this.flyTo(g,w)):this},d.prototype.jumpTo=function(h,g){this.stop();var w=this.transform,C=!1,T=!1,I=!1;return"zoom"in h&&w.zoom!==+h.zoom&&(C=!0,w.zoom=+h.zoom),h.center!==void 0&&(w.center=y.LngLat.convert(h.center)),"bearing"in h&&w.bearing!==+h.bearing&&(T=!0,w.bearing=+h.bearing),"pitch"in h&&w.pitch!==+h.pitch&&(I=!0,w.pitch=+h.pitch),h.padding==null||w.isPaddingEqual(h.padding)||(w.padding=h.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),C&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),T&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),I&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},d.prototype.easeTo=function(h,g){var w=this;this._stop(!1,h.easeId),((h=y.extend({offset:[0,0],duration:500,easing:y.ease},h)).animate===!1||!h.essential&&y.browser.prefersReducedMotion)&&(h.duration=0);var C=this.transform,T=this.getZoom(),I=this.getBearing(),Z=this.getPitch(),$=this.getPadding(),le="zoom"in h?+h.zoom:T,ve="bearing"in h?this._normalizeBearing(h.bearing,I):I,xe="pitch"in h?+h.pitch:Z,ze="padding"in h?h.padding:C.padding,Fe=y.Point.convert(h.offset),Ye=C.centerPoint.add(Fe),Pe=C.pointLocation(Ye),$e=y.LngLat.convert(h.center||Pe);this._normalizeCenter($e);var it,Mt,jt=C.project(Pe),Ut=C.project($e).sub(jt),$t=C.zoomScale(le-T);h.around&&(it=y.LngLat.convert(h.around),Mt=C.locationPoint(it));var pr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||le!==T,this._rotating=this._rotating||I!==ve,this._pitching=this._pitching||xe!==Z,this._padding=!C.isPaddingEqual(ze),this._easeId=h.easeId,this._prepareEase(g,h.noMoveStart,pr),this._ease(function(zr){if(w._zooming&&(C.zoom=y.number(T,le,zr)),w._rotating&&(C.bearing=y.number(I,ve,zr)),w._pitching&&(C.pitch=y.number(Z,xe,zr)),w._padding&&(C.interpolatePadding($,ze,zr),Ye=C.centerPoint.add(Fe)),it)C.setLocationAtPoint(it,Mt);else{var Rr=C.zoomScale(C.zoom-T),an=le>T?Math.min(2,$t):Math.max(.5,$t),Tn=Math.pow(an,1-zr),In=C.unproject(jt.add(Ut.mult(zr*Tn)).mult(Rr));C.setLocationAtPoint(C.renderWorldCopies?In.wrap():In,Ye)}w._fireMoveEvents(g)},function(zr){w._afterEase(g,zr)},h),this},d.prototype._prepareEase=function(h,g,w){w===void 0&&(w={}),this._moving=!0,g||w.moving||this.fire(new y.Event("movestart",h)),this._zooming&&!w.zooming&&this.fire(new y.Event("zoomstart",h)),this._rotating&&!w.rotating&&this.fire(new y.Event("rotatestart",h)),this._pitching&&!w.pitching&&this.fire(new y.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new y.Event("move",h)),this._zooming&&this.fire(new y.Event("zoom",h)),this._rotating&&this.fire(new y.Event("rotate",h)),this._pitching&&this.fire(new y.Event("pitch",h))},d.prototype._afterEase=function(h,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var w=this._zooming,C=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,w&&this.fire(new y.Event("zoomend",h)),C&&this.fire(new y.Event("rotateend",h)),T&&this.fire(new y.Event("pitchend",h)),this.fire(new y.Event("moveend",h))}},d.prototype.flyTo=function(h,g){var w=this;if(!h.essential&&y.browser.prefersReducedMotion){var C=y.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,g)}this.stop(),h=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},h);var T=this.transform,I=this.getZoom(),Z=this.getBearing(),$=this.getPitch(),le=this.getPadding(),ve="zoom"in h?y.clamp(+h.zoom,T.minZoom,T.maxZoom):I,xe="bearing"in h?this._normalizeBearing(h.bearing,Z):Z,ze="pitch"in h?+h.pitch:$,Fe="padding"in h?h.padding:T.padding,Ye=T.zoomScale(ve-I),Pe=y.Point.convert(h.offset),$e=T.centerPoint.add(Pe),it=T.pointLocation($e),Mt=y.LngLat.convert(h.center||it);this._normalizeCenter(Mt);var jt=T.project(it),Ut=T.project(Mt).sub(jt),$t=h.curve,pr=Math.max(T.width,T.height),zr=pr/Ye,Rr=Ut.mag();if("minZoom"in h){var an=y.clamp(Math.min(h.minZoom,I,ve),T.minZoom,T.maxZoom),Tn=pr/T.zoomScale(an-I);$t=Math.sqrt(Tn/Rr*2)}var In=$t*$t;function On(Yn){var Zn=(zr*zr-pr*pr+(Yn?-1:1)*In*In*Rr*Rr)/(2*(Yn?zr:pr)*In*Rr);return Math.log(Math.sqrt(Zn*Zn+1)-Zn)}function Mi(Yn){return(Math.exp(Yn)-Math.exp(-Yn))/2}function cn(Yn){return(Math.exp(Yn)+Math.exp(-Yn))/2}var Qn=On(0),ni=function(Yn){return cn(Qn)/cn(Qn+$t*Yn)},ei=function(Yn){return pr*((cn(Qn)*(Mi(Zn=Qn+$t*Yn)/cn(Zn))-Mi(Qn))/In)/Rr;var Zn},qn=(On(1)-Qn)/$t;if(Math.abs(Rr)<1e-6||!isFinite(qn)){if(Math.abs(pr-zr)<1e-6)return this.easeTo(h,g);var ai=zr<pr?-1:1;qn=Math.abs(Math.log(zr/pr))/$t,ei=function(){return 0},ni=function(Yn){return Math.exp(ai*$t*Yn)}}return h.duration="duration"in h?+h.duration:1e3*qn/("screenSpeed"in h?+h.screenSpeed/$t:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=Z!==xe,this._pitching=ze!==$,this._padding=!T.isPaddingEqual(Fe),this._prepareEase(g,!1),this._ease(function(Yn){var Zn=Yn*qn,Ka=1/ni(Zn);T.zoom=Yn===1?ve:I+T.scaleZoom(Ka),w._rotating&&(T.bearing=y.number(Z,xe,Yn)),w._pitching&&(T.pitch=y.number($,ze,Yn)),w._padding&&(T.interpolatePadding(le,Fe,Yn),$e=T.centerPoint.add(Pe));var _a=Yn===1?Mt:T.unproject(jt.add(Ut.mult(ei(Zn))).mult(Ka));T.setLocationAtPoint(T.renderWorldCopies?_a.wrap():_a,$e),w._fireMoveEvents(g)},function(){return w._afterEase(g)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var w=this._onEaseEnd;delete this._onEaseEnd,w.call(this,g)}if(!h){var C=this.handlers;C&&C.stop(!1)}return this},d.prototype._ease=function(h,g,w){w.animate===!1||w.duration===0?(h(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=w,this._onEaseFrame=h,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,g){h=y.wrap(h,-180,180);var w=Math.abs(h-g);return Math.abs(h-360-g)<w&&(h-=360),Math.abs(h+360-g)<w&&(h+=360),h},d.prototype._normalizeCenter=function(h){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var w=h.lng-g.center.lng;h.lng+=w>180?-360:w<-180?360:0}},d}(y.Evented),ko=function(f){f===void 0&&(f={}),this.options=f,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ko.prototype.getDefaultPosition=function(){return"bottom-right"},ko.prototype.onAdd=function(f){var d=this.options&&this.options.compact;return this._map=f,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ko.prototype.onRemove=function(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ko.prototype._setElementTitle=function(f,d){var h=this._map._getUIString("AttributionControl."+d);f.title=h,f.setAttribute("aria-label",h)},ko.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ko.prototype._updateEditLink=function(){var f=this._editLink;f||(f=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(f){var h=d.reduce(function(g,w,C){return w.value&&(g+=w.key+"="+w.value+(C<d.length-1?"&":"")),g},"?");f.href=y.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),f.rel="noopener nofollow",this._setElementTitle(f,"MapFeedback")}},ko.prototype._updateData=function(f){!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ko.prototype._updateAttributions=function(){if(this._map.style){var f=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?f=f.concat(this.options.customAttribution.map(function(I){return typeof I!="string"?"":I})):typeof this.options.customAttribution=="string"&&f.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var g in h){var w=h[g];if(w.used){var C=w.getSource();C.attribution&&f.indexOf(C.attribution)<0&&f.push(C.attribution)}}f.sort(function(I,Z){return I.length-Z.length});var T=(f=f.filter(function(I,Z){for(var $=Z+1;$<f.length;$++)if(f[$].indexOf(I)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,f.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ko.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var qa=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};qa.prototype.onAdd=function(f){this._map=f,this._container=U.create("div","mapboxgl-ctrl");var d=U.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},qa.prototype.onRemove=function(){U.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},qa.prototype.getDefaultPosition=function(){return"bottom-left"},qa.prototype._updateLogo=function(f){f&&f.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},qa.prototype._logoRequired=function(){if(this._map.style){var f=this._map.style.sourceCaches;for(var d in f)if(f[d].getSource().mapbox_logo)return!0;return!1}},qa.prototype._updateCompact=function(){var f=this._container.children;if(f.length){var d=f[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var yo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};yo.prototype.add=function(f){var d=++this._id;return this._queue.push({callback:f,id:d,cancelled:!1}),d},yo.prototype.remove=function(f){for(var d=this._currentlyRunning,h=0,g=d?this._queue.concat(d):this._queue;h<g.length;h+=1){var w=g[h];if(w.id===f)return void(w.cancelled=!0)}},yo.prototype.run=function(f){f===void 0&&(f=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,g=d;h<g.length;h+=1){var w=g[h];if(!w.cancelled&&(w.callback(f),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},yo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Qs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ss=y.window.HTMLImageElement,fu=y.window.HTMLElement,Di=y.window.ImageBitmap,Ba={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Tf=function(f){function d(g){var w=this;if((g=y.extend({},Ba,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new Si(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(f.call(this,C,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new yo,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},Qs,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof fu))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return w._update(!1)}),this.on("moveend",function(){return w._update(!1)}),this.on("zoom",function(){return w._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new _n(this,g),this._hash=g.hash&&new Vs(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new ko({customAttribution:g.customAttribution})),this.addControl(new qa,g.logoPosition),this.on("style.load",function(){w.transform.unmodified&&w.jumpTo(w.style.stylesheet)}),this.on("data",function(T){w._update(T.dataType==="style"),w.fire(new y.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){w.fire(new y.Event(T.dataType+"dataloading",T))})}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(g,w){if(w===void 0&&(w=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=g.onAdd(this);this._controls.push(g);var T=this._controlPositions[w];return w.indexOf("bottom")!==-1?T.insertBefore(C,T.firstChild):T.appendChild(C),this},d.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var w=this._controls.indexOf(g);return w>-1&&this._controls.splice(w,1),g.onRemove(this),this},d.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},d.prototype.resize=function(g){var w=this._containerDimensions(),C=w[0],T=w[1];if(C===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(C,T),this.transform.resize(C,T),this.painter.resize(C,T);var I=!this._moving;return I&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),I&&this.fire(new y.Event("moveend",g)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},d.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},d.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},d.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(g,w,C){var T,I=this;if(g==="mouseenter"||g==="mouseover"){var Z=!1;return{layer:w,listener:C,delegates:{mousemove:function(le){var ve=I.getLayer(w)?I.queryRenderedFeatures(le.point,{layers:[w]}):[];ve.length?Z||(Z=!0,C.call(I,new Oa(g,I,le.originalEvent,{features:ve}))):Z=!1},mouseout:function(){Z=!1}}}}if(g==="mouseleave"||g==="mouseout"){var $=!1;return{layer:w,listener:C,delegates:{mousemove:function(le){(I.getLayer(w)?I.queryRenderedFeatures(le.point,{layers:[w]}):[]).length?$=!0:$&&($=!1,C.call(I,new Oa(g,I,le.originalEvent)))},mouseout:function(le){$&&($=!1,C.call(I,new Oa(g,I,le.originalEvent)))}}}}return{layer:w,listener:C,delegates:(T={},T[g]=function(le){var ve=I.getLayer(w)?I.queryRenderedFeatures(le.point,{layers:[w]}):[];ve.length&&(le.features=ve,C.call(I,le),delete le.features)},T)}},d.prototype.on=function(g,w,C){if(C===void 0)return f.prototype.on.call(this,g,w);var T=this._createDelegatedListener(g,w,C);for(var I in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(T),T.delegates)this.on(I,T.delegates[I]);return this},d.prototype.once=function(g,w,C){if(C===void 0)return f.prototype.once.call(this,g,w);var T=this._createDelegatedListener(g,w,C);for(var I in T.delegates)this.once(I,T.delegates[I]);return this},d.prototype.off=function(g,w,C){var T=this;return C===void 0?f.prototype.off.call(this,g,w):(this._delegatedListeners&&this._delegatedListeners[g]&&function(I){for(var Z=I[g],$=0;$<Z.length;$++){var le=Z[$];if(le.layer===w&&le.listener===C){for(var ve in le.delegates)T.off(ve,le.delegates[ve]);return Z.splice($,1),T}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(g,w){if(!this.style)return[];var C;if(w!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(w=g,g=void 0),w=w||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")C=[y.Point.convert(g)];else{var T=y.Point.convert(g[0]),I=y.Point.convert(g[1]);C=[T,new y.Point(I.x,T.y),I,new y.Point(T.x,I.y),T]}return this.style.queryRenderedFeatures(C,w,this.transform)},d.prototype.querySourceFeatures=function(g,w){return this.style.querySourceFeatures(g,w)},d.prototype.setStyle=function(g,w){return(w=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},w)).diff!==!1&&w.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,w),this):(this._localIdeographFontFamily=w.localIdeographFontFamily,this._updateStyle(g,w))},d.prototype._getUIString=function(g){var w=this._locale[g];if(w==null)throw new Error("Missing UI string '"+g+"'");return w},d.prototype._updateStyle=function(g,w){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Yo(this,w||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Yo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(g,w){var C=this;if(typeof g=="string"){var T=this._requestManager.normalizeStyleURL(g),I=this._requestManager.transformRequest(T,y.ResourceType.Style);y.getJSON(I,function(Z,$){Z?C.fire(new y.ErrorEvent(Z)):$&&C._updateDiff($,w)})}else typeof g=="object"&&this._updateDiff(g,w)},d.prototype._updateDiff=function(g,w){try{this.style.setState(g)&&this._update(!0)}catch(C){y.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(g,w)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(g,w){return this._lazyInitEmptyStyle(),this.style.addSource(g,w),this._update(!0)},d.prototype.isSourceLoaded=function(g){var w=this.style&&this.style.sourceCaches[g];if(w!==void 0)return w.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},d.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var w in g){var C=g[w]._tiles;for(var T in C){var I=C[T];if(I.state!=="loaded"&&I.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(g,w,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,w,C)},d.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},d.prototype.getSource=function(g){return this.style.getSource(g)},d.prototype.addImage=function(g,w,C){C===void 0&&(C={});var T=C.pixelRatio;T===void 0&&(T=1);var I=C.sdf;I===void 0&&(I=!1);var Z=C.stretchX,$=C.stretchY,le=C.content;if(this._lazyInitEmptyStyle(),w instanceof Ss||Di&&w instanceof Di){var ve=y.browser.getImageData(w);this.style.addImage(g,{data:new y.RGBAImage({width:ve.width,height:ve.height},ve.data),pixelRatio:T,stretchX:Z,stretchY:$,content:le,sdf:I,version:0})}else{if(w.width===void 0||w.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var xe=w;this.style.addImage(g,{data:new y.RGBAImage({width:w.width,height:w.height},new Uint8Array(w.data)),pixelRatio:T,stretchX:Z,stretchY:$,content:le,sdf:I,version:0,userImage:xe}),xe.onAdd&&xe.onAdd(this,g)}},d.prototype.updateImage=function(g,w){var C=this.style.getImage(g);if(!C)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=w instanceof Ss||Di&&w instanceof Di?y.browser.getImageData(w):w,I=T.width,Z=T.height,$=T.data;return I===void 0||Z===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):I!==C.data.width||Z!==C.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace($,!(w instanceof Ss||Di&&w instanceof Di)),void this.style.updateImage(g,C))},d.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(g){this.style.removeImage(g)},d.prototype.loadImage=function(g,w){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),w)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(g,w){return this._lazyInitEmptyStyle(),this.style.addLayer(g,w),this._update(!0)},d.prototype.moveLayer=function(g,w){return this.style.moveLayer(g,w),this._update(!0)},d.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},d.prototype.getLayer=function(g){return this.style.getLayer(g)},d.prototype.setLayerZoomRange=function(g,w,C){return this.style.setLayerZoomRange(g,w,C),this._update(!0)},d.prototype.setFilter=function(g,w,C){return C===void 0&&(C={}),this.style.setFilter(g,w,C),this._update(!0)},d.prototype.getFilter=function(g){return this.style.getFilter(g)},d.prototype.setPaintProperty=function(g,w,C,T){return T===void 0&&(T={}),this.style.setPaintProperty(g,w,C,T),this._update(!0)},d.prototype.getPaintProperty=function(g,w){return this.style.getPaintProperty(g,w)},d.prototype.setLayoutProperty=function(g,w,C,T){return T===void 0&&(T={}),this.style.setLayoutProperty(g,w,C,T),this._update(!0)},d.prototype.getLayoutProperty=function(g,w){return this.style.getLayoutProperty(g,w)},d.prototype.setLight=function(g,w){return w===void 0&&(w={}),this._lazyInitEmptyStyle(),this.style.setLight(g,w),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(g,w){return this.style.setFeatureState(g,w),this._update()},d.prototype.removeFeatureState=function(g,w){return this.style.removeFeatureState(g,w),this._update()},d.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var g=0,w=0;return this._container&&(g=this._container.clientWidth||400,w=this._container.clientHeight||300),[g,w]},d.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=U.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var w=this._canvasContainer=U.create("div","mapboxgl-canvas-container",g);this._interactive&&w.classList.add("mapboxgl-interactive"),this._canvas=U.create("canvas","mapboxgl-canvas",w),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var T=this._controlContainer=U.create("div","mapboxgl-control-container",g),I=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Z){I[Z]=U.create("div","mapboxgl-ctrl-"+Z,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(g,w){var C=y.browser.devicePixelRatio||1;this._canvas.width=C*g,this._canvas.height=C*w,this._canvas.style.width=g+"px",this._canvas.style.height=w+"px"},d.prototype._setupPainter=function(){var g=y.extend({},se.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),w=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);w?(this.painter=new Ji(w,this.transform),y.webpSupported.testSupport(w)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},d.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},d.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},d.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},d.prototype._render=function(g){var w,C=this,T=0,I=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(w=I.createQueryEXT(),I.beginQueryEXT(I.TIME_ELAPSED_EXT,w),T=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var Z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var $=this.transform.zoom,le=y.browser.now();this.style.zoomHistory.update($,le);var ve=new y.EvaluationParameters($,{now:le,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),xe=ve.crossFadingFactor();xe===1&&xe===this._crossFadingFactor||(Z=!0,this._crossFadingFactor=xe),this.style.update(ve)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||Z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var ze=y.browser.now()-T;I.endQueryEXT(I.TIME_ELAPSED_EXT,w),setTimeout(function(){var Pe=I.getQueryObjectEXT(w,I.QUERY_RESULT_EXT)/1e6;I.deleteQueryEXT(w),C.fire(new y.Event("gpu-timing-frame",{cpuTime:ze,gpuTime:Pe}))},50)}if(this.listens("gpu-timing-layer")){var Fe=this.painter.collectGpuTimers();setTimeout(function(){var Pe=C.painter.queryGpuTimers(Fe);C.fire(new y.Event("gpu-timing-layer",{layerTimes:Pe}))},50)}var Ye=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ye||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||Ye||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,w=this._controls;g<w.length;g+=1)w[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),Ku(this._canvasContainer),Ku(this._controlContainer),Ku(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},d.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(w){g._frame=null,g._render(w)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(g){this._vertices=g,this._update()},d.prototype._setCacheLimits=function(g,w){y.setCacheLimits(g,w)},h.version.get=function(){return y.version},Object.defineProperties(d.prototype,h),d}(qu);function Ku(f){f.parentNode&&f.parentNode.removeChild(f)}var Qc={showCompass:!0,showZoom:!0,visualizePitch:!1},hu=function(f){var d=this;this.options=y.extend({},Qc,f),this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return d._map.zoomIn({},{originalEvent:h})}),U.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return d._map.zoomOut({},{originalEvent:h})}),U.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:h}):d._map.resetNorth({},{originalEvent:h})}),this._compassIcon=U.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};hu.prototype._updateZoomButtons=function(){var f=this._map.getZoom(),d=f===this._map.getMaxZoom(),h=f===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},hu.prototype._rotateCompassArrow=function(){var f=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=f},hu.prototype.onAdd=function(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Io(this._map,this._compass,this.options.visualizePitch)),this._container},hu.prototype.onRemove=function(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},hu.prototype._createButton=function(f,d){var h=U.create("button",f,this._container);return h.type="button",h.addEventListener("click",d),h},hu.prototype._setButtonTitle=function(f,d){var h=this._map._getUIString("NavigationControl."+d);f.title=h,f.setAttribute("aria-label",h)};var Io=function(f,d,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new xc({clickTolerance:f.dragRotate._mouseRotate._clickTolerance}),this.map=f,h&&(this.mousePitch=new lu({clickTolerance:f.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),U.addEventListener(d,"mousedown",this.mousedown),U.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(d,"touchmove",this.touchmove),U.addEventListener(d,"touchend",this.touchend),U.addEventListener(d,"touchcancel",this.reset)};function yl(f,d,h){if(f=new y.LngLat(f.lng,f.lat),d){var g=new y.LngLat(f.lng-360,f.lat),w=new y.LngLat(f.lng+360,f.lat),C=h.locationPoint(f).distSqr(d);h.locationPoint(g).distSqr(d)<C?f=g:h.locationPoint(w).distSqr(d)<C&&(f=w)}for(;Math.abs(f.lng-h.center.lng)>180;){var T=h.locationPoint(f);if(T.x>=0&&T.y>=0&&T.x<=h.width&&T.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}Io.prototype.down=function(f,d){this.mouseRotate.mousedown(f,d),this.mousePitch&&this.mousePitch.mousedown(f,d),U.disableDrag()},Io.prototype.move=function(f,d){var h=this.map,g=this.mouseRotate.mousemoveWindow(f,d);if(g&&g.bearingDelta&&h.setBearing(h.getBearing()+g.bearingDelta),this.mousePitch){var w=this.mousePitch.mousemoveWindow(f,d);w&&w.pitchDelta&&h.setPitch(h.getPitch()+w.pitchDelta)}},Io.prototype.off=function(){var f=this.element;U.removeEventListener(f,"mousedown",this.mousedown),U.removeEventListener(f,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(f,"touchmove",this.touchmove),U.removeEventListener(f,"touchend",this.touchend),U.removeEventListener(f,"touchcancel",this.reset),this.offTemp()},Io.prototype.offTemp=function(){U.enableDrag(),U.removeEventListener(y.window,"mousemove",this.mousemove),U.removeEventListener(y.window,"mouseup",this.mouseup)},Io.prototype.mousedown=function(f){this.down(y.extend({},f,{ctrlKey:!0,preventDefault:function(){return f.preventDefault()}}),U.mousePos(this.element,f)),U.addEventListener(y.window,"mousemove",this.mousemove),U.addEventListener(y.window,"mouseup",this.mouseup)},Io.prototype.mousemove=function(f){this.move(f,U.mousePos(this.element,f))},Io.prototype.mouseup=function(f){this.mouseRotate.mouseupWindow(f),this.mousePitch&&this.mousePitch.mouseupWindow(f),this.offTemp()},Io.prototype.touchstart=function(f){f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,f.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return f.preventDefault()}},this._startPos))},Io.prototype.touchmove=function(f){f.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,f.targetTouches)[0],this.move({preventDefault:function(){return f.preventDefault()}},this._lastPos))},Io.prototype.touchend=function(f){f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Io.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var eu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ef(f,d,h){var g=f.classList;for(var w in eu)g.remove("mapboxgl-"+h+"-anchor-"+w);g.add("mapboxgl-"+h+"-anchor-"+d)}var Yl,Sc=function(f){function d(h,g){if(f.call(this),(h instanceof y.window.HTMLElement||g)&&(h=y.extend({element:h},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=y.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div"),this._element.setAttribute("aria-label","Map marker");var w=U.createNS("http://www.w3.org/2000/svg","svg");w.setAttributeNS(null,"display","block"),w.setAttributeNS(null,"height","41px"),w.setAttributeNS(null,"width","27px"),w.setAttributeNS(null,"viewBox","0 0 27 41");var C=U.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var T=U.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var I=U.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");for(var Z=0,$=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Z<$.length;Z+=1){var le=$[Z],ve=U.createNS("http://www.w3.org/2000/svg","ellipse");ve.setAttributeNS(null,"opacity","0.04"),ve.setAttributeNS(null,"cx","10.5"),ve.setAttributeNS(null,"cy","5.80029008"),ve.setAttributeNS(null,"rx",le.rx),ve.setAttributeNS(null,"ry",le.ry),I.appendChild(ve)}var xe=U.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"fill",this._color);var ze=U.createNS("http://www.w3.org/2000/svg","path");ze.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),xe.appendChild(ze);var Fe=U.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"opacity","0.25"),Fe.setAttributeNS(null,"fill","#000000");var Ye=U.createNS("http://www.w3.org/2000/svg","path");Ye.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Fe.appendChild(Ye);var Pe=U.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Pe.setAttributeNS(null,"fill","#FFFFFF");var $e=U.createNS("http://www.w3.org/2000/svg","g");$e.setAttributeNS(null,"transform","translate(8.0, 8.0)");var it=U.createNS("http://www.w3.org/2000/svg","circle");it.setAttributeNS(null,"fill","#000000"),it.setAttributeNS(null,"opacity","0.25"),it.setAttributeNS(null,"cx","5.5"),it.setAttributeNS(null,"cy","5.5"),it.setAttributeNS(null,"r","5.4999962");var Mt=U.createNS("http://www.w3.org/2000/svg","circle");Mt.setAttributeNS(null,"fill","#FFFFFF"),Mt.setAttributeNS(null,"cx","5.5"),Mt.setAttributeNS(null,"cy","5.5"),Mt.setAttributeNS(null,"r","5.4999962"),$e.appendChild(it),$e.appendChild(Mt),T.appendChild(I),T.appendChild(xe),T.appendChild(Fe),T.appendChild(Pe),T.appendChild($e),w.appendChild(T),w.setAttributeNS(null,"height",41*this._scale+"px"),w.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(w),this._offset=y.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(jt){jt.preventDefault()}),this._element.addEventListener("mousedown",function(jt){jt.preventDefault()}),ef(this._element,this._anchor,"marker"),this._popup=null}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var g=h.code,w=h.charCode||h.keyCode;g!=="Space"&&g!=="Enter"&&w!==32&&w!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var g=h.originalEvent.target,w=this._element;this._popup&&(g===w||w.contains(g))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=yl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,eu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+w+" "+g)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=y.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(y.Evented),Mf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ql=0,Ju=!1,tf=function(f){function d(h){f.call(this),this.options=y.extend({},Mf,h),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){var g;return this._map=h,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Yl!==void 0?g(Yl):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(w){g(Yl=w.state!=="denied")}):g(Yl=!!y.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ql=0,Ju=!1},d.prototype._isOutOfMapMaxBounds=function(h){var g=this._map.getMaxBounds(),w=h.coords;return g&&(w.longitude<g.getWest()||w.longitude>g.getEast()||w.latitude<g.getSouth()||w.latitude>g.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude),w=h.coords.accuracy,C=this._map.getBearing(),T=y.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(w),T,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,g=this._map.unproject([0,h]),w=this._map.unproject([1,h]),C=g.distanceTo(w),T=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&Ju)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var g=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=U.create("button","mapboxgl-ctrl-geolocate",this._container),U.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var w=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Sc(this._dotElement),this._circleElement=U.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Sc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||g._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ql--,Ju=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ql>1?(h={maximumAge:6e5,timeout:0},Ju=!0):(h=this.options.positionOptions,Ju=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(y.Evented),es={maxWidth:100,unit:"metric"},Qu=function(f){this.options=y.extend({},es,f),y.bindAll(["_onMove","setUnit"],this)};function _l(f,d,h){var g=h&&h.maxWidth||100,w=f._container.clientHeight/2,C=f.unproject([0,w]),T=f.unproject([g,w]),I=C.distanceTo(T);if(h&&h.unit==="imperial"){var Z=3.2808*I;Z>5280?tu(d,g,Z/5280,f._getUIString("ScaleControl.Miles")):tu(d,g,Z,f._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?tu(d,g,I/1852,f._getUIString("ScaleControl.NauticalMiles")):I>=1e3?tu(d,g,I/1e3,f._getUIString("ScaleControl.Kilometers")):tu(d,g,I,f._getUIString("ScaleControl.Meters"))}function tu(f,d,h,g){var w,C,T,I=(w=h,(C=Math.pow(10,(""+Math.floor(w)).length-1))*(T=(T=w/C)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(Z){var $=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*$)/$}(T)));f.style.width=d*(I/h)+"px",f.innerHTML=I+"&nbsp;"+g}Qu.prototype.getDefaultPosition=function(){return"bottom-left"},Qu.prototype._onMove=function(){_l(this._map,this._container,this.options)},Qu.prototype.onAdd=function(f){return this._map=f,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Qu.prototype.onRemove=function(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Qu.prototype.setUnit=function(f){this.options.unit=f,_l(this._map,this._container,this.options)};var Hs=function(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof y.window.HTMLElement?this._container=f.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};Hs.prototype.onAdd=function(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Hs.prototype.onRemove=function(){U.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Hs.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},Hs.prototype._setupUI=function(){var f=this._fullscreenButton=U.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Hs.prototype._updateTitle=function(){var f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f},Hs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Hs.prototype._isFullscreen=function(){return this._fullscreen},Hs.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Hs.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var kf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},pu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),If=function(f){function d(h){f.call(this),this.options=y.extend(Object.create(kf),h),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(y.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var g,w=y.window.document.createDocumentFragment(),C=y.window.document.createElement("body");for(C.innerHTML=h;g=C.firstChild;)w.appendChild(g);return this.setDOMContent(w)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=U.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=U.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=U.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ve){return g._container.classList.add(ve)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=yl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var w=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),C=this.options.anchor,T=function ve(xe){if(xe){if(typeof xe=="number"){var ze=Math.round(Math.sqrt(.5*Math.pow(xe,2)));return{center:new y.Point(0,0),top:new y.Point(0,xe),"top-left":new y.Point(ze,ze),"top-right":new y.Point(-ze,ze),bottom:new y.Point(0,-xe),"bottom-left":new y.Point(ze,-ze),"bottom-right":new y.Point(-ze,-ze),left:new y.Point(xe,0),right:new y.Point(-xe,0)}}if(xe instanceof y.Point||Array.isArray(xe)){var Fe=y.Point.convert(xe);return{center:Fe,top:Fe,"top-left":Fe,"top-right":Fe,bottom:Fe,"bottom-left":Fe,"bottom-right":Fe,left:Fe,right:Fe}}return{center:y.Point.convert(xe.center||[0,0]),top:y.Point.convert(xe.top||[0,0]),"top-left":y.Point.convert(xe["top-left"]||[0,0]),"top-right":y.Point.convert(xe["top-right"]||[0,0]),bottom:y.Point.convert(xe.bottom||[0,0]),"bottom-left":y.Point.convert(xe["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(xe["bottom-right"]||[0,0]),left:y.Point.convert(xe.left||[0,0]),right:y.Point.convert(xe.right||[0,0])}}return ve(new y.Point(0,0))}(this.options.offset);if(!C){var I,Z=this._container.offsetWidth,$=this._container.offsetHeight;I=w.y+T.bottom.y<$?["top"]:w.y>this._map.transform.height-$?["bottom"]:[],w.x<Z/2?I.push("left"):w.x>this._map.transform.width-Z/2&&I.push("right"),C=I.length===0?"bottom":I.join("-")}var le=w.add(T[C]).round();U.setTransform(this._container,eu[C]+" translate("+le.x+"px,"+le.y+"px)"),ef(this._container,C,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(pu);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(y.Evented),Pf={version:y.version,supported:se,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:Tf,NavigationControl:hu,GeolocateControl:tf,AttributionControl:ko,ScaleControl:Qu,FullscreenControl:Hs,Popup:If,Marker:Sc,Style:Yo,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){Qt().acquire(re)},clearPrewarmedResources:function(){var f=yn;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(re),yn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(f){y.config.ACCESS_TOKEN=f},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(f){y.config.API_URL=f},get workerCount(){return br.workerCount},set workerCount(f){br.workerCount=f},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){y.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage:function(f){y.clearTileCache(f)},workerUrl:""};return Pf}),_e})},3614:function(wr,ee,z){"use strict";wr.exports=Q;var _e=z(80645);function Q(Y){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Y)?Y:new Uint8Array(Y||0),this.pos=0,this.type=0,this.length=this.buf.length}Q.Varint=0,Q.Fixed64=1,Q.Bytes=2,Q.Fixed32=5;var y=(1<<16)*(1<<16),se=1/y,U=12,ce=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");Q.prototype={destroy:function(){this.buf=null},readFields:function(Y,Le,O){for(O=O||this.length;this.pos<O;){var ke=this.readVarint(),Ae=ke>>3,st=this.pos;this.type=ke&7,Y(Ae,Le,this),this.pos===st&&this.skip(ke)}return Le},readMessage:function(Y,Le){return this.readFields(Y,Le,this.readVarint()+this.pos)},readFixed32:function(){var Y=xt(this.buf,this.pos);return this.pos+=4,Y},readSFixed32:function(){var Y=Rt(this.buf,this.pos);return this.pos+=4,Y},readFixed64:function(){var Y=xt(this.buf,this.pos)+xt(this.buf,this.pos+4)*y;return this.pos+=8,Y},readSFixed64:function(){var Y=xt(this.buf,this.pos)+Rt(this.buf,this.pos+4)*y;return this.pos+=8,Y},readFloat:function(){var Y=_e.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Y},readDouble:function(){var Y=_e.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Y},readVarint:function(Y){var Le=this.buf,O,ke;return ke=Le[this.pos++],O=ke&127,ke<128||(ke=Le[this.pos++],O|=(ke&127)<<7,ke<128)||(ke=Le[this.pos++],O|=(ke&127)<<14,ke<128)||(ke=Le[this.pos++],O|=(ke&127)<<21,ke<128)?O:(ke=Le[this.pos],O|=(ke&15)<<28,ae(O,Y,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Y=this.readVarint();return Y%2==1?(Y+1)/-2:Y/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var Y=this.readVarint()+this.pos,Le=this.pos;return this.pos=Y,Y-Le>=U&&ce?Kt(this.buf,Le,Y):ft(this.buf,Le,Y)},readBytes:function(){var Y=this.readVarint()+this.pos,Le=this.buf.subarray(this.pos,Y);return this.pos=Y,Le},readPackedVarint:function(Y,Le){if(this.type!==Q.Bytes)return Y.push(this.readVarint(Le));var O=Ge(this);for(Y=Y||[];this.pos<O;)Y.push(this.readVarint(Le));return Y},readPackedSVarint:function(Y){if(this.type!==Q.Bytes)return Y.push(this.readSVarint());var Le=Ge(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readSVarint());return Y},readPackedBoolean:function(Y){if(this.type!==Q.Bytes)return Y.push(this.readBoolean());var Le=Ge(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readBoolean());return Y},readPackedFloat:function(Y){if(this.type!==Q.Bytes)return Y.push(this.readFloat());var Le=Ge(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readFloat());return Y},readPackedDouble:function(Y){if(this.type!==Q.Bytes)return Y.push(this.readDouble());var Le=Ge(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readDouble());return Y},readPackedFixed32:function(Y){if(this.type!==Q.Bytes)return Y.push(this.readFixed32());var Le=Ge(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readFixed32());return Y},readPackedSFixed32:function(Y){if(this.type!==Q.Bytes)return Y.push(this.readSFixed32());var Le=Ge(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readSFixed32());return Y},readPackedFixed64:function(Y){if(this.type!==Q.Bytes)return Y.push(this.readFixed64());var Le=Ge(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readFixed64());return Y},readPackedSFixed64:function(Y){if(this.type!==Q.Bytes)return Y.push(this.readSFixed64());var Le=Ge(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readSFixed64());return Y},skip:function(Y){var Le=Y&7;if(Le===Q.Varint)for(;this.buf[this.pos++]>127;);else if(Le===Q.Bytes)this.pos=this.readVarint()+this.pos;else if(Le===Q.Fixed32)this.pos+=4;else if(Le===Q.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Le)},writeTag:function(Y,Le){this.writeVarint(Y<<3|Le)},realloc:function(Y){for(var Le=this.length||16;Le<this.pos+Y;)Le*=2;if(Le!==this.length){var O=new Uint8Array(Le);O.set(this.buf),this.buf=O,this.length=Le}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Y){this.realloc(4),at(this.buf,Y,this.pos),this.pos+=4},writeSFixed32:function(Y){this.realloc(4),at(this.buf,Y,this.pos),this.pos+=4},writeFixed64:function(Y){this.realloc(8),at(this.buf,Y&-1,this.pos),at(this.buf,Math.floor(Y*se),this.pos+4),this.pos+=8},writeSFixed64:function(Y){this.realloc(8),at(this.buf,Y&-1,this.pos),at(this.buf,Math.floor(Y*se),this.pos+4),this.pos+=8},writeVarint:function(Y){if(Y=+Y||0,Y>268435455||Y<0){je(Y,this);return}this.realloc(4),this.buf[this.pos++]=Y&127|(Y>127?128:0),!(Y<=127)&&(this.buf[this.pos++]=(Y>>>=7)&127|(Y>127?128:0),!(Y<=127)&&(this.buf[this.pos++]=(Y>>>=7)&127|(Y>127?128:0),!(Y<=127)&&(this.buf[this.pos++]=Y>>>7&127)))},writeSVarint:function(Y){this.writeVarint(Y<0?-Y*2-1:Y*2)},writeBoolean:function(Y){this.writeVarint(Boolean(Y))},writeString:function(Y){Y=String(Y),this.realloc(Y.length*4),this.pos++;var Le=this.pos;this.pos=xr(this.buf,Y,this.pos);var O=this.pos-Le;O>=128&&Pt(Le,O,this),this.pos=Le-1,this.writeVarint(O),this.pos+=O},writeFloat:function(Y){this.realloc(4),_e.write(this.buf,Y,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Y){this.realloc(8),_e.write(this.buf,Y,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Y){var Le=Y.length;this.writeVarint(Le),this.realloc(Le);for(var O=0;O<Le;O++)this.buf[this.pos++]=Y[O]},writeRawMessage:function(Y,Le){this.pos++;var O=this.pos;Y(Le,this);var ke=this.pos-O;ke>=128&&Pt(O,ke,this),this.pos=O-1,this.writeVarint(ke),this.pos+=ke},writeMessage:function(Y,Le,O){this.writeTag(Y,Q.Bytes),this.writeRawMessage(Le,O)},writePackedVarint:function(Y,Le){Le.length&&this.writeMessage(Y,er,Le)},writePackedSVarint:function(Y,Le){Le.length&&this.writeMessage(Y,qt,Le)},writePackedBoolean:function(Y,Le){Le.length&&this.writeMessage(Y,Ct,Le)},writePackedFloat:function(Y,Le){Le.length&&this.writeMessage(Y,ir,Le)},writePackedDouble:function(Y,Le){Le.length&&this.writeMessage(Y,tr,Le)},writePackedFixed32:function(Y,Le){Le.length&&this.writeMessage(Y,yt,Le)},writePackedSFixed32:function(Y,Le){Le.length&&this.writeMessage(Y,Fr,Le)},writePackedFixed64:function(Y,Le){Le.length&&this.writeMessage(Y,mr,Le)},writePackedSFixed64:function(Y,Le){Le.length&&this.writeMessage(Y,lr,Le)},writeBytesField:function(Y,Le){this.writeTag(Y,Q.Bytes),this.writeBytes(Le)},writeFixed32Field:function(Y,Le){this.writeTag(Y,Q.Fixed32),this.writeFixed32(Le)},writeSFixed32Field:function(Y,Le){this.writeTag(Y,Q.Fixed32),this.writeSFixed32(Le)},writeFixed64Field:function(Y,Le){this.writeTag(Y,Q.Fixed64),this.writeFixed64(Le)},writeSFixed64Field:function(Y,Le){this.writeTag(Y,Q.Fixed64),this.writeSFixed64(Le)},writeVarintField:function(Y,Le){this.writeTag(Y,Q.Varint),this.writeVarint(Le)},writeSVarintField:function(Y,Le){this.writeTag(Y,Q.Varint),this.writeSVarint(Le)},writeStringField:function(Y,Le){this.writeTag(Y,Q.Bytes),this.writeString(Le)},writeFloatField:function(Y,Le){this.writeTag(Y,Q.Fixed32),this.writeFloat(Le)},writeDoubleField:function(Y,Le){this.writeTag(Y,Q.Fixed64),this.writeDouble(Le)},writeBooleanField:function(Y,Le){this.writeVarintField(Y,Boolean(Le))}};function ae(Y,Le,O){var ke=O.buf,Ae,st;if(st=ke[O.pos++],Ae=(st&112)>>4,st<128||(st=ke[O.pos++],Ae|=(st&127)<<3,st<128)||(st=ke[O.pos++],Ae|=(st&127)<<10,st<128)||(st=ke[O.pos++],Ae|=(st&127)<<17,st<128)||(st=ke[O.pos++],Ae|=(st&127)<<24,st<128)||(st=ke[O.pos++],Ae|=(st&1)<<31,st<128))return oe(Y,Ae,Le);throw new Error("Expected varint not more than 10 bytes")}function Ge(Y){return Y.type===Q.Bytes?Y.readVarint()+Y.pos:Y.pos+1}function oe(Y,Le,O){return O?Le*4294967296+(Y>>>0):(Le>>>0)*4294967296+(Y>>>0)}function je(Y,Le){var O,ke;if(Y>=0?(O=Y%4294967296|0,ke=Y/4294967296|0):(O=~(-Y%4294967296),ke=~(-Y/4294967296),O^4294967295?O=O+1|0:(O=0,ke=ke+1|0)),Y>=18446744073709552e3||Y<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Le.realloc(10),rt(O,ke,Le),ct(ke,Le)}function rt(Y,Le,O){O.buf[O.pos++]=Y&127|128,Y>>>=7,O.buf[O.pos++]=Y&127|128,Y>>>=7,O.buf[O.pos++]=Y&127|128,Y>>>=7,O.buf[O.pos++]=Y&127|128,Y>>>=7,O.buf[O.pos]=Y&127}function ct(Y,Le){var O=(Y&7)<<4;Le.buf[Le.pos++]|=O|((Y>>>=3)?128:0),!!Y&&(Le.buf[Le.pos++]=Y&127|((Y>>>=7)?128:0),!!Y&&(Le.buf[Le.pos++]=Y&127|((Y>>>=7)?128:0),!!Y&&(Le.buf[Le.pos++]=Y&127|((Y>>>=7)?128:0),!!Y&&(Le.buf[Le.pos++]=Y&127|((Y>>>=7)?128:0),!!Y&&(Le.buf[Le.pos++]=Y&127)))))}function Pt(Y,Le,O){var ke=Le<=16383?1:Le<=2097151?2:Le<=268435455?3:Math.floor(Math.log(Le)/(Math.LN2*7));O.realloc(ke);for(var Ae=O.pos-1;Ae>=Y;Ae--)O.buf[Ae+ke]=O.buf[Ae]}function er(Y,Le){for(var O=0;O<Y.length;O++)Le.writeVarint(Y[O])}function qt(Y,Le){for(var O=0;O<Y.length;O++)Le.writeSVarint(Y[O])}function ir(Y,Le){for(var O=0;O<Y.length;O++)Le.writeFloat(Y[O])}function tr(Y,Le){for(var O=0;O<Y.length;O++)Le.writeDouble(Y[O])}function Ct(Y,Le){for(var O=0;O<Y.length;O++)Le.writeBoolean(Y[O])}function yt(Y,Le){for(var O=0;O<Y.length;O++)Le.writeFixed32(Y[O])}function Fr(Y,Le){for(var O=0;O<Y.length;O++)Le.writeSFixed32(Y[O])}function mr(Y,Le){for(var O=0;O<Y.length;O++)Le.writeFixed64(Y[O])}function lr(Y,Le){for(var O=0;O<Y.length;O++)Le.writeSFixed64(Y[O])}function xt(Y,Le){return(Y[Le]|Y[Le+1]<<8|Y[Le+2]<<16)+Y[Le+3]*16777216}function at(Y,Le,O){Y[O]=Le,Y[O+1]=Le>>>8,Y[O+2]=Le>>>16,Y[O+3]=Le>>>24}function Rt(Y,Le){return(Y[Le]|Y[Le+1]<<8|Y[Le+2]<<16)+(Y[Le+3]<<24)}function ft(Y,Le,O){for(var ke="",Ae=Le;Ae<O;){var st=Y[Ae],_t=null,bt=st>239?4:st>223?3:st>191?2:1;if(Ae+bt>O)break;var Ht,nr,Qr;bt===1?st<128&&(_t=st):bt===2?(Ht=Y[Ae+1],(Ht&192)==128&&(_t=(st&31)<<6|Ht&63,_t<=127&&(_t=null))):bt===3?(Ht=Y[Ae+1],nr=Y[Ae+2],(Ht&192)==128&&(nr&192)==128&&(_t=(st&15)<<12|(Ht&63)<<6|nr&63,(_t<=2047||_t>=55296&&_t<=57343)&&(_t=null))):bt===4&&(Ht=Y[Ae+1],nr=Y[Ae+2],Qr=Y[Ae+3],(Ht&192)==128&&(nr&192)==128&&(Qr&192)==128&&(_t=(st&15)<<18|(Ht&63)<<12|(nr&63)<<6|Qr&63,(_t<=65535||_t>=1114112)&&(_t=null))),_t===null?(_t=65533,bt=1):_t>65535&&(_t-=65536,ke+=String.fromCharCode(_t>>>10&1023|55296),_t=56320|_t&1023),ke+=String.fromCharCode(_t),Ae+=bt}return ke}function Kt(Y,Le,O){return ce.decode(Y.subarray(Le,O))}function xr(Y,Le,O){for(var ke=0,Ae,st;ke<Le.length;ke++){if(Ae=Le.charCodeAt(ke),Ae>55295&&Ae<57344)if(st)if(Ae<56320){Y[O++]=239,Y[O++]=191,Y[O++]=189,st=Ae;continue}else Ae=st-55296<<10|Ae-56320|65536,st=null;else{Ae>56319||ke+1===Le.length?(Y[O++]=239,Y[O++]=191,Y[O++]=189):st=Ae;continue}else st&&(Y[O++]=239,Y[O++]=191,Y[O++]=189,st=null);Ae<128?Y[O++]=Ae:(Ae<2048?Y[O++]=Ae>>6|192:(Ae<65536?Y[O++]=Ae>>12|224:(Y[O++]=Ae>>18|240,Y[O++]=Ae>>12&63|128),Y[O++]=Ae>>6&63|128),Y[O++]=Ae&63|128)}return O}},32676:function(wr,ee,z){var _e=z(34155);(function(Q,y){wr.exports=y()})(this,function(){"use strict";function Q(kt,L){if(!(kt instanceof L))throw new TypeError("Cannot call a class as a function")}function y(kt,L){for(var ne=0;ne<L.length;ne++){var fe=L[ne];fe.enumerable=fe.enumerable||!1,fe.configurable=!0,"value"in fe&&(fe.writable=!0),Object.defineProperty(kt,fe.key,fe)}}function se(kt,L,ne){return L&&y(kt.prototype,L),ne&&y(kt,ne),kt}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var U=function(){function kt(L,ne){this.next=null,this.key=L,this.data=ne,this.left=null,this.right=null}return kt}();function ce(kt,L){return kt>L?1:kt<L?-1:0}function ae(kt,L,ne){for(var fe=new U(null,null),Ze=fe,pt=fe;;){var Wt=ne(kt,L.key);if(Wt<0){if(L.left===null)break;if(ne(kt,L.left.key)<0){var Ar=L.left;if(L.left=Ar.right,Ar.right=L,L=Ar,L.left===null)break}pt.left=L,pt=L,L=L.left}else if(Wt>0){if(L.right===null)break;if(ne(kt,L.right.key)>0){var Ar=L.right;if(L.right=Ar.left,Ar.left=L,L=Ar,L.right===null)break}Ze.right=L,Ze=L,L=L.right}else break}return Ze.right=L.left,pt.left=L.right,L.left=fe.right,L.right=fe.left,L}function Ge(kt,L,ne,fe){var Ze=new U(kt,L);if(ne===null)return Ze.left=Ze.right=null,Ze;ne=ae(kt,ne,fe);var pt=fe(kt,ne.key);return pt<0?(Ze.left=ne.left,Ze.right=ne,ne.left=null):pt>=0&&(Ze.right=ne.right,Ze.left=ne,ne.right=null),Ze}function oe(kt,L,ne){var fe=null,Ze=null;if(L){L=ae(kt,L,ne);var pt=ne(L.key,kt);pt===0?(fe=L.left,Ze=L.right):pt<0?(Ze=L.right,L.right=null,fe=L):(fe=L.left,L.left=null,Ze=L)}return{left:fe,right:Ze}}function je(kt,L,ne){return L===null?kt:(kt===null||(L=ae(kt.key,L,ne),L.left=kt),L)}function rt(kt,L,ne,fe,Ze){if(kt){fe(""+L+(ne?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Ze(kt)+`
`);var pt=L+(ne?"    ":"\u2502   ");kt.left&&rt(kt.left,pt,!1,fe,Ze),kt.right&&rt(kt.right,pt,!0,fe,Ze)}}var ct=function(){function kt(L){L===void 0&&(L=ce),this._root=null,this._size=0,this._comparator=L}return kt.prototype.insert=function(L,ne){return this._size++,this._root=Ge(L,ne,this._root,this._comparator)},kt.prototype.add=function(L,ne){var fe=new U(L,ne);this._root===null&&(fe.left=fe.right=null,this._size++,this._root=fe);var Ze=this._comparator,pt=ae(L,this._root,Ze),Wt=Ze(L,pt.key);return Wt===0?this._root=pt:(Wt<0?(fe.left=pt.left,fe.right=pt,pt.left=null):Wt>0&&(fe.right=pt.right,fe.left=pt,pt.right=null),this._size++,this._root=fe),this._root},kt.prototype.remove=function(L){this._root=this._remove(L,this._root,this._comparator)},kt.prototype._remove=function(L,ne,fe){var Ze;if(ne===null)return null;ne=ae(L,ne,fe);var pt=fe(L,ne.key);return pt===0?(ne.left===null?Ze=ne.right:(Ze=ae(L,ne.left,fe),Ze.right=ne.right),this._size--,Ze):ne},kt.prototype.pop=function(){var L=this._root;if(L){for(;L.left;)L=L.left;return this._root=ae(L.key,this._root,this._comparator),this._root=this._remove(L.key,this._root,this._comparator),{key:L.key,data:L.data}}return null},kt.prototype.findStatic=function(L){for(var ne=this._root,fe=this._comparator;ne;){var Ze=fe(L,ne.key);if(Ze===0)return ne;Ze<0?ne=ne.left:ne=ne.right}return null},kt.prototype.find=function(L){return this._root&&(this._root=ae(L,this._root,this._comparator),this._comparator(L,this._root.key)!==0)?null:this._root},kt.prototype.contains=function(L){for(var ne=this._root,fe=this._comparator;ne;){var Ze=fe(L,ne.key);if(Ze===0)return!0;Ze<0?ne=ne.left:ne=ne.right}return!1},kt.prototype.forEach=function(L,ne){for(var fe=this._root,Ze=[],pt=!1;!pt;)fe!==null?(Ze.push(fe),fe=fe.left):Ze.length!==0?(fe=Ze.pop(),L.call(ne,fe),fe=fe.right):pt=!0;return this},kt.prototype.range=function(L,ne,fe,Ze){for(var pt=[],Wt=this._comparator,Ar=this._root,Ve;pt.length!==0||Ar;)if(Ar)pt.push(Ar),Ar=Ar.left;else{if(Ar=pt.pop(),Ve=Wt(Ar.key,ne),Ve>0)break;if(Wt(Ar.key,L)>=0&&fe.call(Ze,Ar))return this;Ar=Ar.right}return this},kt.prototype.keys=function(){var L=[];return this.forEach(function(ne){var fe=ne.key;return L.push(fe)}),L},kt.prototype.values=function(){var L=[];return this.forEach(function(ne){var fe=ne.data;return L.push(fe)}),L},kt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},kt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},kt.prototype.minNode=function(L){if(L===void 0&&(L=this._root),L)for(;L.left;)L=L.left;return L},kt.prototype.maxNode=function(L){if(L===void 0&&(L=this._root),L)for(;L.right;)L=L.right;return L},kt.prototype.at=function(L){for(var ne=this._root,fe=!1,Ze=0,pt=[];!fe;)if(ne)pt.push(ne),ne=ne.left;else if(pt.length>0){if(ne=pt.pop(),Ze===L)return ne;Ze++,ne=ne.right}else fe=!0;return null},kt.prototype.next=function(L){var ne=this._root,fe=null;if(L.right){for(fe=L.right;fe.left;)fe=fe.left;return fe}for(var Ze=this._comparator;ne;){var pt=Ze(L.key,ne.key);if(pt===0)break;pt<0?(fe=ne,ne=ne.left):ne=ne.right}return fe},kt.prototype.prev=function(L){var ne=this._root,fe=null;if(L.left!==null){for(fe=L.left;fe.right;)fe=fe.right;return fe}for(var Ze=this._comparator;ne;){var pt=Ze(L.key,ne.key);if(pt===0)break;pt<0?ne=ne.left:(fe=ne,ne=ne.right)}return fe},kt.prototype.clear=function(){return this._root=null,this._size=0,this},kt.prototype.toList=function(){return qt(this._root)},kt.prototype.load=function(L,ne,fe){ne===void 0&&(ne=[]),fe===void 0&&(fe=!1);var Ze=L.length,pt=this._comparator;if(fe&&Ct(L,ne,0,Ze-1,pt),this._root===null)this._root=Pt(L,ne,0,Ze),this._size=Ze;else{var Wt=tr(this.toList(),er(L,ne),pt);Ze=this._size+Ze,this._root=ir({head:Wt},0,Ze)}return this},kt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(kt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(kt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),kt.prototype.toString=function(L){L===void 0&&(L=function(Ze){return String(Ze.key)});var ne=[];return rt(this._root,"",!0,function(fe){return ne.push(fe)},L),ne.join("")},kt.prototype.update=function(L,ne,fe){var Ze=this._comparator,pt=oe(L,this._root,Ze),Wt=pt.left,Ar=pt.right;Ze(L,ne)<0?Ar=Ge(ne,fe,Ar,Ze):Wt=Ge(ne,fe,Wt,Ze),this._root=je(Wt,Ar,Ze)},kt.prototype.split=function(L){return oe(L,this._root,this._comparator)},kt}();function Pt(kt,L,ne,fe){var Ze=fe-ne;if(Ze>0){var pt=ne+Math.floor(Ze/2),Wt=kt[pt],Ar=L[pt],Ve=new U(Wt,Ar);return Ve.left=Pt(kt,L,ne,pt),Ve.right=Pt(kt,L,pt+1,fe),Ve}return null}function er(kt,L){for(var ne=new U(null,null),fe=ne,Ze=0;Ze<kt.length;Ze++)fe=fe.next=new U(kt[Ze],L[Ze]);return fe.next=null,ne.next}function qt(kt){for(var L=kt,ne=[],fe=!1,Ze=new U(null,null),pt=Ze;!fe;)L?(ne.push(L),L=L.left):ne.length>0?(L=pt=pt.next=ne.pop(),L=L.right):fe=!0;return pt.next=null,Ze.next}function ir(kt,L,ne){var fe=ne-L;if(fe>0){var Ze=L+Math.floor(fe/2),pt=ir(kt,L,Ze),Wt=kt.head;return Wt.left=pt,kt.head=kt.head.next,Wt.right=ir(kt,Ze+1,ne),Wt}return null}function tr(kt,L,ne){for(var fe=new U(null,null),Ze=fe,pt=kt,Wt=L;pt!==null&&Wt!==null;)ne(pt.key,Wt.key)<0?(Ze.next=pt,pt=pt.next):(Ze.next=Wt,Wt=Wt.next),Ze=Ze.next;return pt!==null?Ze.next=pt:Wt!==null&&(Ze.next=Wt),fe.next}function Ct(kt,L,ne,fe,Ze){if(!(ne>=fe)){for(var pt=kt[ne+fe>>1],Wt=ne-1,Ar=fe+1;;){do Wt++;while(Ze(kt[Wt],pt)<0);do Ar--;while(Ze(kt[Ar],pt)>0);if(Wt>=Ar)break;var Ve=kt[Wt];kt[Wt]=kt[Ar],kt[Ar]=Ve,Ve=L[Wt],L[Wt]=L[Ar],L[Ar]=Ve}Ct(kt,L,ne,Ar,Ze),Ct(kt,L,Ar+1,fe,Ze)}}var yt=function(L,ne){return L.ll.x<=ne.x&&ne.x<=L.ur.x&&L.ll.y<=ne.y&&ne.y<=L.ur.y},Fr=function(L,ne){if(ne.ur.x<L.ll.x||L.ur.x<ne.ll.x||ne.ur.y<L.ll.y||L.ur.y<ne.ll.y)return null;var fe=L.ll.x<ne.ll.x?ne.ll.x:L.ll.x,Ze=L.ur.x<ne.ur.x?L.ur.x:ne.ur.x,pt=L.ll.y<ne.ll.y?ne.ll.y:L.ll.y,Wt=L.ur.y<ne.ur.y?L.ur.y:ne.ur.y;return{ll:{x:fe,y:pt},ur:{x:Ze,y:Wt}}},mr=Number.EPSILON;mr===void 0&&(mr=Math.pow(2,-52));var lr=mr*mr,xt=function(L,ne){if(-mr<L&&L<mr&&-mr<ne&&ne<mr)return 0;var fe=L-ne;return fe*fe<lr*L*ne?0:L<ne?-1:1},at=function(){function kt(){Q(this,kt),this.reset()}return se(kt,[{key:"reset",value:function(){this.xRounder=new Rt,this.yRounder=new Rt}},{key:"round",value:function(ne,fe){return{x:this.xRounder.round(ne),y:this.yRounder.round(fe)}}}]),kt}(),Rt=function(){function kt(){Q(this,kt),this.tree=new ct,this.round(0)}return se(kt,[{key:"round",value:function(ne){var fe=this.tree.add(ne),Ze=this.tree.prev(fe);if(Ze!==null&&xt(fe.key,Ze.key)===0)return this.tree.remove(ne),Ze.key;var pt=this.tree.next(fe);return pt!==null&&xt(fe.key,pt.key)===0?(this.tree.remove(ne),pt.key):ne}}]),kt}(),ft=new at,Kt=function(L,ne){return L.x*ne.y-L.y*ne.x},xr=function(L,ne){return L.x*ne.x+L.y*ne.y},Y=function(L,ne,fe){var Ze={x:ne.x-L.x,y:ne.y-L.y},pt={x:fe.x-L.x,y:fe.y-L.y},Wt=Kt(Ze,pt);return xt(Wt,0)},Le=function(L){return Math.sqrt(xr(L,L))},O=function(L,ne,fe){var Ze={x:ne.x-L.x,y:ne.y-L.y},pt={x:fe.x-L.x,y:fe.y-L.y};return Kt(pt,Ze)/Le(pt)/Le(Ze)},ke=function(L,ne,fe){var Ze={x:ne.x-L.x,y:ne.y-L.y},pt={x:fe.x-L.x,y:fe.y-L.y};return xr(pt,Ze)/Le(pt)/Le(Ze)},Ae=function(L,ne,fe){return ne.y===0?null:{x:L.x+ne.x/ne.y*(fe-L.y),y:fe}},st=function(L,ne,fe){return ne.x===0?null:{x:fe,y:L.y+ne.y/ne.x*(fe-L.x)}},_t=function(L,ne,fe,Ze){if(ne.x===0)return st(fe,Ze,L.x);if(Ze.x===0)return st(L,ne,fe.x);if(ne.y===0)return Ae(fe,Ze,L.y);if(Ze.y===0)return Ae(L,ne,fe.y);var pt=Kt(ne,Ze);if(pt==0)return null;var Wt={x:fe.x-L.x,y:fe.y-L.y},Ar=Kt(Wt,ne)/pt,Ve=Kt(Wt,Ze)/pt,Tt=L.x+Ve*ne.x,ar=fe.x+Ar*Ze.x,Er=L.y+Ve*ne.y,Wr=fe.y+Ar*Ze.y,mn=(Tt+ar)/2,wn=(Er+Wr)/2;return{x:mn,y:wn}},bt=function(){se(kt,null,[{key:"compare",value:function(ne,fe){var Ze=kt.comparePoints(ne.point,fe.point);return Ze!==0?Ze:(ne.point!==fe.point&&ne.link(fe),ne.isLeft!==fe.isLeft?ne.isLeft?1:-1:nr.compare(ne.segment,fe.segment))}},{key:"comparePoints",value:function(ne,fe){return ne.x<fe.x?-1:ne.x>fe.x?1:ne.y<fe.y?-1:ne.y>fe.y?1:0}}]);function kt(L,ne){Q(this,kt),L.events===void 0?L.events=[this]:L.events.push(this),this.point=L,this.isLeft=ne}return se(kt,[{key:"link",value:function(ne){if(ne.point===this.point)throw new Error("Tried to link already linked events");for(var fe=ne.point.events,Ze=0,pt=fe.length;Ze<pt;Ze++){var Wt=fe[Ze];this.point.events.push(Wt),Wt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ne=this.point.events.length,fe=0;fe<ne;fe++){var Ze=this.point.events[fe];if(Ze.segment.consumedBy===void 0)for(var pt=fe+1;pt<ne;pt++){var Wt=this.point.events[pt];Wt.consumedBy===void 0&&Ze.otherSE.point.events===Wt.otherSE.point.events&&Ze.segment.consume(Wt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ne=[],fe=0,Ze=this.point.events.length;fe<Ze;fe++){var pt=this.point.events[fe];pt!==this&&!pt.segment.ringOut&&pt.segment.isInResult()&&ne.push(pt)}return ne}},{key:"getLeftmostComparator",value:function(ne){var fe=this,Ze=new Map,pt=function(Ar){var Ve=Ar.otherSE;Ze.set(Ar,{sine:O(fe.point,ne.point,Ve.point),cosine:ke(fe.point,ne.point,Ve.point)})};return function(Wt,Ar){Ze.has(Wt)||pt(Wt),Ze.has(Ar)||pt(Ar);var Ve=Ze.get(Wt),Tt=Ve.sine,ar=Ve.cosine,Er=Ze.get(Ar),Wr=Er.sine,mn=Er.cosine;return Tt>=0&&Wr>=0?ar<mn?1:ar>mn?-1:0:Tt<0&&Wr<0?ar<mn?-1:ar>mn?1:0:Wr<Tt?-1:Wr>Tt?1:0}}}]),kt}(),Ht=0,nr=function(){se(kt,null,[{key:"compare",value:function(ne,fe){var Ze=ne.leftSE.point.x,pt=fe.leftSE.point.x,Wt=ne.rightSE.point.x,Ar=fe.rightSE.point.x;if(Ar<Ze)return 1;if(Wt<pt)return-1;var Ve=ne.leftSE.point.y,Tt=fe.leftSE.point.y,ar=ne.rightSE.point.y,Er=fe.rightSE.point.y;if(Ze<pt){if(Tt<Ve&&Tt<ar)return 1;if(Tt>Ve&&Tt>ar)return-1;var Wr=ne.comparePoint(fe.leftSE.point);if(Wr<0)return 1;if(Wr>0)return-1;var mn=fe.comparePoint(ne.rightSE.point);return mn!==0?mn:-1}if(Ze>pt){if(Ve<Tt&&Ve<Er)return-1;if(Ve>Tt&&Ve>Er)return 1;var wn=fe.comparePoint(ne.leftSE.point);if(wn!==0)return wn;var gn=ne.comparePoint(fe.rightSE.point);return gn<0?1:gn>0?-1:1}if(Ve<Tt)return-1;if(Ve>Tt)return 1;if(Wt<Ar){var xn=fe.comparePoint(ne.rightSE.point);if(xn!==0)return xn}if(Wt>Ar){var ri=ne.comparePoint(fe.rightSE.point);if(ri<0)return 1;if(ri>0)return-1}if(Wt!==Ar){var Jn=ar-Ve,Wi=Wt-Ze,$i=Er-Tt,po=Ar-pt;if(Jn>Wi&&$i<po)return 1;if(Jn<Wi&&$i>po)return-1}return Wt>Ar?1:Wt<Ar||ar<Er?-1:ar>Er?1:ne.id<fe.id?-1:ne.id>fe.id?1:0}}]);function kt(L,ne,fe,Ze){Q(this,kt),this.id=++Ht,this.leftSE=L,L.segment=this,L.otherSE=ne,this.rightSE=ne,ne.segment=this,ne.otherSE=L,this.rings=fe,this.windings=Ze}return se(kt,[{key:"replaceRightSE",value:function(ne){this.rightSE=ne,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ne=this.leftSE.point.y,fe=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ne<fe?ne:fe},ur:{x:this.rightSE.point.x,y:ne>fe?ne:fe}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ne){return ne.x===this.leftSE.point.x&&ne.y===this.leftSE.point.y||ne.x===this.rightSE.point.x&&ne.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ne){if(this.isAnEndpoint(ne))return 0;var fe=this.leftSE.point,Ze=this.rightSE.point,pt=this.vector();if(fe.x===Ze.x)return ne.x===fe.x?0:ne.x<fe.x?1:-1;var Wt=(ne.y-fe.y)/pt.y,Ar=fe.x+Wt*pt.x;if(ne.x===Ar)return 0;var Ve=(ne.x-fe.x)/pt.x,Tt=fe.y+Ve*pt.y;return ne.y===Tt?0:ne.y<Tt?-1:1}},{key:"getIntersection",value:function(ne){var fe=this.bbox(),Ze=ne.bbox(),pt=Fr(fe,Ze);if(pt===null)return null;var Wt=this.leftSE.point,Ar=this.rightSE.point,Ve=ne.leftSE.point,Tt=ne.rightSE.point,ar=yt(fe,Ve)&&this.comparePoint(Ve)===0,Er=yt(Ze,Wt)&&ne.comparePoint(Wt)===0,Wr=yt(fe,Tt)&&this.comparePoint(Tt)===0,mn=yt(Ze,Ar)&&ne.comparePoint(Ar)===0;if(Er&&ar)return mn&&!Wr?Ar:!mn&&Wr?Tt:null;if(Er)return Wr&&Wt.x===Tt.x&&Wt.y===Tt.y?null:Wt;if(ar)return mn&&Ar.x===Ve.x&&Ar.y===Ve.y?null:Ve;if(mn&&Wr)return null;if(mn)return Ar;if(Wr)return Tt;var wn=_t(Wt,this.vector(),Ve,ne.vector());return wn===null||!yt(pt,wn)?null:ft.round(wn.x,wn.y)}},{key:"split",value:function(ne){var fe=[],Ze=ne.events!==void 0,pt=new bt(ne,!0),Wt=new bt(ne,!1),Ar=this.rightSE;this.replaceRightSE(Wt),fe.push(Wt),fe.push(pt);var Ve=new kt(pt,Ar,this.rings.slice(),this.windings.slice());return bt.comparePoints(Ve.leftSE.point,Ve.rightSE.point)>0&&Ve.swapEvents(),bt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Ze&&(pt.checkForConsuming(),Wt.checkForConsuming()),fe}},{key:"swapEvents",value:function(){var ne=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ne,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var fe=0,Ze=this.windings.length;fe<Ze;fe++)this.windings[fe]*=-1}},{key:"consume",value:function(ne){for(var fe=this,Ze=ne;fe.consumedBy;)fe=fe.consumedBy;for(;Ze.consumedBy;)Ze=Ze.consumedBy;var pt=kt.compare(fe,Ze);if(pt!==0){if(pt>0){var Wt=fe;fe=Ze,Ze=Wt}if(fe.prev===Ze){var Ar=fe;fe=Ze,Ze=Ar}for(var Ve=0,Tt=Ze.rings.length;Ve<Tt;Ve++){var ar=Ze.rings[Ve],Er=Ze.windings[Ve],Wr=fe.rings.indexOf(ar);Wr===-1?(fe.rings.push(ar),fe.windings.push(Er)):fe.windings[Wr]+=Er}Ze.rings=null,Ze.windings=null,Ze.consumedBy=fe,Ze.leftSE.consumedBy=fe.leftSE,Ze.rightSE.consumedBy=fe.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ne=this.prev.consumedBy||this.prev;this._beforeState=ne.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ne=this.beforeState();this._afterState={rings:ne.rings.slice(0),windings:ne.windings.slice(0),multiPolys:[]};for(var fe=this._afterState.rings,Ze=this._afterState.windings,pt=this._afterState.multiPolys,Wt=0,Ar=this.rings.length;Wt<Ar;Wt++){var Ve=this.rings[Wt],Tt=this.windings[Wt],ar=fe.indexOf(Ve);ar===-1?(fe.push(Ve),Ze.push(Tt)):Ze[ar]+=Tt}for(var Er=[],Wr=[],mn=0,wn=fe.length;mn<wn;mn++)if(Ze[mn]!==0){var gn=fe[mn],xn=gn.poly;if(Wr.indexOf(xn)===-1)if(gn.isExterior)Er.push(xn);else{Wr.indexOf(xn)===-1&&Wr.push(xn);var ri=Er.indexOf(gn.poly);ri!==-1&&Er.splice(ri,1)}}for(var Jn=0,Wi=Er.length;Jn<Wi;Jn++){var $i=Er[Jn].multiPoly;pt.indexOf($i)===-1&&pt.push($i)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ne=this.beforeState().multiPolys,fe=this.afterState().multiPolys;switch(Ti.type){case"union":{var Ze=ne.length===0,pt=fe.length===0;this._isInResult=Ze!==pt;break}case"intersection":{var Wt,Ar;ne.length<fe.length?(Wt=ne.length,Ar=fe.length):(Wt=fe.length,Ar=ne.length),this._isInResult=Ar===Ti.numMultiPolys&&Wt<Ar;break}case"xor":{var Ve=Math.abs(ne.length-fe.length);this._isInResult=Ve%2==1;break}case"difference":{var Tt=function(Er){return Er.length===1&&Er[0].isSubject};this._isInResult=Tt(ne)!==Tt(fe);break}default:throw new Error("Unrecognized operation type found ".concat(Ti.type))}return this._isInResult}}],[{key:"fromRing",value:function(ne,fe,Ze){var pt,Wt,Ar,Ve=bt.comparePoints(ne,fe);if(Ve<0)pt=ne,Wt=fe,Ar=1;else if(Ve>0)pt=fe,Wt=ne,Ar=-1;else throw new Error("Tried to create degenerate segment at [".concat(ne.x,", ").concat(ne.y,"]"));var Tt=new bt(pt,!0),ar=new bt(Wt,!1);return new kt(Tt,ar,[Ze],[Ar])}}]),kt}(),Qr=function(){function kt(L,ne,fe){if(Q(this,kt),!Array.isArray(L)||L.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ne,this.isExterior=fe,this.segments=[],typeof L[0][0]!="number"||typeof L[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ze=ft.round(L[0][0],L[0][1]);this.bbox={ll:{x:Ze.x,y:Ze.y},ur:{x:Ze.x,y:Ze.y}};for(var pt=Ze,Wt=1,Ar=L.length;Wt<Ar;Wt++){if(typeof L[Wt][0]!="number"||typeof L[Wt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ve=ft.round(L[Wt][0],L[Wt][1]);Ve.x===pt.x&&Ve.y===pt.y||(this.segments.push(nr.fromRing(pt,Ve,this)),Ve.x<this.bbox.ll.x&&(this.bbox.ll.x=Ve.x),Ve.y<this.bbox.ll.y&&(this.bbox.ll.y=Ve.y),Ve.x>this.bbox.ur.x&&(this.bbox.ur.x=Ve.x),Ve.y>this.bbox.ur.y&&(this.bbox.ur.y=Ve.y),pt=Ve)}(Ze.x!==pt.x||Ze.y!==pt.y)&&this.segments.push(nr.fromRing(pt,Ze,this))}return se(kt,[{key:"getSweepEvents",value:function(){for(var ne=[],fe=0,Ze=this.segments.length;fe<Ze;fe++){var pt=this.segments[fe];ne.push(pt.leftSE),ne.push(pt.rightSE)}return ne}}]),kt}(),Lr=function(){function kt(L,ne){if(Q(this,kt),!Array.isArray(L))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Qr(L[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var fe=1,Ze=L.length;fe<Ze;fe++){var pt=new Qr(L[fe],this,!1);pt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=pt.bbox.ll.x),pt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=pt.bbox.ll.y),pt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=pt.bbox.ur.x),pt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=pt.bbox.ur.y),this.interiorRings.push(pt)}this.multiPoly=ne}return se(kt,[{key:"getSweepEvents",value:function(){for(var ne=this.exteriorRing.getSweepEvents(),fe=0,Ze=this.interiorRings.length;fe<Ze;fe++)for(var pt=this.interiorRings[fe].getSweepEvents(),Wt=0,Ar=pt.length;Wt<Ar;Wt++)ne.push(pt[Wt]);return ne}}]),kt}(),jn=function(){function kt(L,ne){if(Q(this,kt),!Array.isArray(L))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof L[0][0][0]=="number"&&(L=[L])}catch(Wt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var fe=0,Ze=L.length;fe<Ze;fe++){var pt=new Lr(L[fe],this);pt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=pt.bbox.ll.x),pt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=pt.bbox.ll.y),pt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=pt.bbox.ur.x),pt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=pt.bbox.ur.y),this.polys.push(pt)}this.isSubject=ne}return se(kt,[{key:"getSweepEvents",value:function(){for(var ne=[],fe=0,Ze=this.polys.length;fe<Ze;fe++)for(var pt=this.polys[fe].getSweepEvents(),Wt=0,Ar=pt.length;Wt<Ar;Wt++)ne.push(pt[Wt]);return ne}}]),kt}(),tn=function(){se(kt,null,[{key:"factory",value:function(ne){for(var fe=[],Ze=0,pt=ne.length;Ze<pt;Ze++){var Wt=ne[Ze];if(!(!Wt.isInResult()||Wt.ringOut)){for(var Ar=null,Ve=Wt.leftSE,Tt=Wt.rightSE,ar=[Ve],Er=Ve.point,Wr=[];Ar=Ve,Ve=Tt,ar.push(Ve),Ve.point!==Er;)for(;;){var mn=Ve.getAvailableLinkedEvents();if(mn.length===0){var wn=ar[0].point,gn=ar[ar.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(wn.x,",")+" ".concat(wn.y,"]. Last matching segment found ends at")+" [".concat(gn.x,", ").concat(gn.y,"]."))}if(mn.length===1){Tt=mn[0].otherSE;break}for(var xn=null,ri=0,Jn=Wr.length;ri<Jn;ri++)if(Wr[ri].point===Ve.point){xn=ri;break}if(xn!==null){var Wi=Wr.splice(xn)[0],$i=ar.splice(Wi.index);$i.unshift($i[0].otherSE),fe.push(new kt($i.reverse()));continue}Wr.push({index:ar.length,point:Ve.point});var po=Ve.getLeftmostComparator(Ar);Tt=mn.sort(po)[0].otherSE;break}fe.push(new kt(ar))}}return fe}}]);function kt(L){Q(this,kt),this.events=L;for(var ne=0,fe=L.length;ne<fe;ne++)L[ne].segment.ringOut=this;this.poly=null}return se(kt,[{key:"getGeom",value:function(){for(var ne=this.events[0].point,fe=[ne],Ze=1,pt=this.events.length-1;Ze<pt;Ze++){var Wt=this.events[Ze].point,Ar=this.events[Ze+1].point;Y(Wt,ne,Ar)!==0&&(fe.push(Wt),ne=Wt)}if(fe.length===1)return null;var Ve=fe[0],Tt=fe[1];Y(Ve,ne,Tt)===0&&fe.shift(),fe.push(fe[0]);for(var ar=this.isExteriorRing()?1:-1,Er=this.isExteriorRing()?0:fe.length-1,Wr=this.isExteriorRing()?fe.length:-1,mn=[],wn=Er;wn!=Wr;wn+=ar)mn.push([fe[wn].x,fe[wn].y]);return mn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ne=this.enclosingRing();this._isExteriorRing=ne?!ne.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ne=this.events[0],fe=1,Ze=this.events.length;fe<Ze;fe++){var pt=this.events[fe];bt.compare(ne,pt)>0&&(ne=pt)}for(var Wt=ne.segment.prevInResult(),Ar=Wt?Wt.prevInResult():null;;){if(!Wt)return null;if(!Ar)return Wt.ringOut;if(Ar.ringOut!==Wt.ringOut)return Ar.ringOut.enclosingRing()!==Wt.ringOut?Wt.ringOut:Wt.ringOut.enclosingRing();Wt=Ar.prevInResult(),Ar=Wt?Wt.prevInResult():null}}}]),kt}(),Cn=function(){function kt(L){Q(this,kt),this.exteriorRing=L,L.poly=this,this.interiorRings=[]}return se(kt,[{key:"addInterior",value:function(ne){this.interiorRings.push(ne),ne.poly=this}},{key:"getGeom",value:function(){var ne=[this.exteriorRing.getGeom()];if(ne[0]===null)return null;for(var fe=0,Ze=this.interiorRings.length;fe<Ze;fe++){var pt=this.interiorRings[fe].getGeom();pt!==null&&ne.push(pt)}return ne}}]),kt}(),si=function(){function kt(L){Q(this,kt),this.rings=L,this.polys=this._composePolys(L)}return se(kt,[{key:"getGeom",value:function(){for(var ne=[],fe=0,Ze=this.polys.length;fe<Ze;fe++){var pt=this.polys[fe].getGeom();pt!==null&&ne.push(pt)}return ne}},{key:"_composePolys",value:function(ne){for(var fe=[],Ze=0,pt=ne.length;Ze<pt;Ze++){var Wt=ne[Ze];if(!Wt.poly)if(Wt.isExteriorRing())fe.push(new Cn(Wt));else{var Ar=Wt.enclosingRing();Ar.poly||fe.push(new Cn(Ar)),Ar.poly.addInterior(Wt)}}return fe}}]),kt}(),Xn=function(){function kt(L){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nr.compare;Q(this,kt),this.queue=L,this.tree=new ct(ne),this.segments=[]}return se(kt,[{key:"process",value:function(ne){var fe=ne.segment,Ze=[];if(ne.consumedBy)return ne.isLeft?this.queue.remove(ne.otherSE):this.tree.remove(fe),Ze;var pt=ne.isLeft?this.tree.insert(fe):this.tree.find(fe);if(!pt)throw new Error("Unable to find segment #".concat(fe.id," ")+"[".concat(fe.leftSE.point.x,", ").concat(fe.leftSE.point.y,"] -> ")+"[".concat(fe.rightSE.point.x,", ").concat(fe.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Wt=pt,Ar=pt,Ve=void 0,Tt=void 0;Ve===void 0;)Wt=this.tree.prev(Wt),Wt===null?Ve=null:Wt.key.consumedBy===void 0&&(Ve=Wt.key);for(;Tt===void 0;)Ar=this.tree.next(Ar),Ar===null?Tt=null:Ar.key.consumedBy===void 0&&(Tt=Ar.key);if(ne.isLeft){var ar=null;if(Ve){var Er=Ve.getIntersection(fe);if(Er!==null&&(fe.isAnEndpoint(Er)||(ar=Er),!Ve.isAnEndpoint(Er)))for(var Wr=this._splitSafely(Ve,Er),mn=0,wn=Wr.length;mn<wn;mn++)Ze.push(Wr[mn])}var gn=null;if(Tt){var xn=Tt.getIntersection(fe);if(xn!==null&&(fe.isAnEndpoint(xn)||(gn=xn),!Tt.isAnEndpoint(xn)))for(var ri=this._splitSafely(Tt,xn),Jn=0,Wi=ri.length;Jn<Wi;Jn++)Ze.push(ri[Jn])}if(ar!==null||gn!==null){var $i=null;if(ar===null)$i=gn;else if(gn===null)$i=ar;else{var po=bt.comparePoints(ar,gn);$i=po<=0?ar:gn}this.queue.remove(fe.rightSE),Ze.push(fe.rightSE);for(var $o=fe.split($i),Xi=0,G=$o.length;Xi<G;Xi++)Ze.push($o[Xi])}Ze.length>0?(this.tree.remove(fe),Ze.push(ne)):(this.segments.push(fe),fe.prev=Ve)}else{if(Ve&&Tt){var X=Ve.getIntersection(Tt);if(X!==null){if(!Ve.isAnEndpoint(X))for(var ie=this._splitSafely(Ve,X),we=0,Oe=ie.length;we<Oe;we++)Ze.push(ie[we]);if(!Tt.isAnEndpoint(X))for(var Ke=this._splitSafely(Tt,X),ot=0,pe=Ke.length;ot<pe;ot++)Ze.push(Ke[ot])}}this.tree.remove(fe)}return Ze}},{key:"_splitSafely",value:function(ne,fe){this.tree.remove(ne);var Ze=ne.rightSE;this.queue.remove(Ze);var pt=ne.split(fe);return pt.push(Ze),ne.consumedBy===void 0&&this.tree.insert(ne),pt}}]),kt}(),vn=typeof _e!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ai=typeof _e!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Ii=function(){function kt(){Q(this,kt)}return se(kt,[{key:"run",value:function(ne,fe,Ze){Ti.type=ne,ft.reset();for(var pt=[new jn(fe,!0)],Wt=0,Ar=Ze.length;Wt<Ar;Wt++)pt.push(new jn(Ze[Wt],!1));if(Ti.numMultiPolys=pt.length,Ti.type==="difference")for(var Ve=pt[0],Tt=1;Tt<pt.length;)Fr(pt[Tt].bbox,Ve.bbox)!==null?Tt++:pt.splice(Tt,1);if(Ti.type==="intersection"){for(var ar=0,Er=pt.length;ar<Er;ar++)for(var Wr=pt[ar],mn=ar+1,wn=pt.length;mn<wn;mn++)if(Fr(Wr.bbox,pt[mn].bbox)===null)return[]}for(var gn=new ct(bt.compare),xn=0,ri=pt.length;xn<ri;xn++)for(var Jn=pt[xn].getSweepEvents(),Wi=0,$i=Jn.length;Wi<$i;Wi++)if(gn.insert(Jn[Wi]),gn.size>vn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var po=new Xn(gn),$o=gn.size,Xi=gn.pop();Xi;){var G=Xi.key;if(gn.size===$o){var X=G.segment;throw new Error("Unable to pop() ".concat(G.isLeft?"left":"right"," SweepEvent ")+"[".concat(G.point.x,", ").concat(G.point.y,"] from segment #").concat(X.id," ")+"[".concat(X.leftSE.point.x,", ").concat(X.leftSE.point.y,"] -> ")+"[".concat(X.rightSE.point.x,", ").concat(X.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(gn.size>vn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(po.segments.length>Ai)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ie=po.process(G),we=0,Oe=ie.length;we<Oe;we++){var Ke=ie[we];Ke.consumedBy===void 0&&gn.insert(Ke)}$o=gn.size,Xi=gn.pop()}ft.reset();var ot=tn.factory(po.segments),pe=new si(ot);return pe.getGeom()}}]),kt}(),Ti=new Ii,Gn=function(L){for(var ne=arguments.length,fe=new Array(ne>1?ne-1:0),Ze=1;Ze<ne;Ze++)fe[Ze-1]=arguments[Ze];return Ti.run("union",L,fe)},Dn=function(L){for(var ne=arguments.length,fe=new Array(ne>1?ne-1:0),Ze=1;Ze<ne;Ze++)fe[Ze-1]=arguments[Ze];return Ti.run("intersection",L,fe)},ho=function(L){for(var ne=arguments.length,fe=new Array(ne>1?ne-1:0),Ze=1;Ze<ne;Ze++)fe[Ze-1]=arguments[Ze];return Ti.run("xor",L,fe)},Hi=function(L){for(var ne=arguments.length,fe=new Array(ne>1?ne-1:0),Ze=1;Ze<ne;Ze++)fe[Ze-1]=arguments[Ze];return Ti.run("difference",L,fe)},Ya={union:Gn,intersection:Dn,xor:ho,difference:Hi};return Ya})},28660:function(wr,ee,z){var _e=z(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Q;(function(y){(function(se){var U=typeof z.g=="object"?z.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=ae(y);typeof U.Reflect=="undefined"?U.Reflect=y:ce=ae(U.Reflect,ce),se(ce);function ae(Ge,oe){return function(je,rt){typeof Ge[je]!="function"&&Object.defineProperty(Ge,je,{configurable:!0,writable:!0,value:rt}),oe&&oe(je,rt)}}})(function(se){var U=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",ae=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ge=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",oe=typeof Object.create=="function",je={__proto__:[]}instanceof Array,rt=!oe&&!je,ct={create:oe?function(){return Ar(Object.create(null))}:je?function(){return Ar({__proto__:null})}:function(){return Ar({})},has:rt?function(Ve,Tt){return U.call(Ve,Tt)}:function(Ve,Tt){return Tt in Ve},get:rt?function(Ve,Tt){return U.call(Ve,Tt)?Ve[Tt]:void 0}:function(Ve,Tt){return Ve[Tt]}},Pt=Object.getPrototypeOf(Function),er=typeof _e=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",qt=!er&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ze(),ir=!er&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:pt(),tr=!er&&typeof WeakMap=="function"?WeakMap:Wt(),Ct=new tr;function yt(Ve,Tt,ar,Er){if(Lr(ar)){if(!Ti(Ve))throw new TypeError;if(!Dn(Tt))throw new TypeError;return Y(Ve,Tt)}else{if(!Ti(Ve))throw new TypeError;if(!Cn(Tt))throw new TypeError;if(!Cn(Er)&&!Lr(Er)&&!jn(Er))throw new TypeError;return jn(Er)&&(Er=void 0),ar=Ii(ar),Le(Ve,Tt,ar,Er)}}se("decorate",yt);function Fr(Ve,Tt){function ar(Er,Wr){if(!Cn(Er))throw new TypeError;if(!Lr(Wr)&&!ho(Wr))throw new TypeError;bt(Ve,Tt,Er,Wr)}return ar}se("metadata",Fr);function mr(Ve,Tt,ar,Er){if(!Cn(ar))throw new TypeError;return Lr(Er)||(Er=Ii(Er)),bt(Ve,Tt,ar,Er)}se("defineMetadata",mr);function lr(Ve,Tt,ar){if(!Cn(Tt))throw new TypeError;return Lr(ar)||(ar=Ii(ar)),ke(Ve,Tt,ar)}se("hasMetadata",lr);function xt(Ve,Tt,ar){if(!Cn(Tt))throw new TypeError;return Lr(ar)||(ar=Ii(ar)),Ae(Ve,Tt,ar)}se("hasOwnMetadata",xt);function at(Ve,Tt,ar){if(!Cn(Tt))throw new TypeError;return Lr(ar)||(ar=Ii(ar)),st(Ve,Tt,ar)}se("getMetadata",at);function Rt(Ve,Tt,ar){if(!Cn(Tt))throw new TypeError;return Lr(ar)||(ar=Ii(ar)),_t(Ve,Tt,ar)}se("getOwnMetadata",Rt);function ft(Ve,Tt){if(!Cn(Ve))throw new TypeError;return Lr(Tt)||(Tt=Ii(Tt)),Ht(Ve,Tt)}se("getMetadataKeys",ft);function Kt(Ve,Tt){if(!Cn(Ve))throw new TypeError;return Lr(Tt)||(Tt=Ii(Tt)),nr(Ve,Tt)}se("getOwnMetadataKeys",Kt);function xr(Ve,Tt,ar){if(!Cn(Tt))throw new TypeError;Lr(ar)||(ar=Ii(ar));var Er=O(Tt,ar,!1);if(Lr(Er)||!Er.delete(Ve))return!1;if(Er.size>0)return!0;var Wr=Ct.get(Tt);return Wr.delete(ar),Wr.size>0||Ct.delete(Tt),!0}se("deleteMetadata",xr);function Y(Ve,Tt){for(var ar=Ve.length-1;ar>=0;--ar){var Er=Ve[ar],Wr=Er(Tt);if(!Lr(Wr)&&!jn(Wr)){if(!Dn(Wr))throw new TypeError;Tt=Wr}}return Tt}function Le(Ve,Tt,ar,Er){for(var Wr=Ve.length-1;Wr>=0;--Wr){var mn=Ve[Wr],wn=mn(Tt,ar,Er);if(!Lr(wn)&&!jn(wn)){if(!Cn(wn))throw new TypeError;Er=wn}}return Er}function O(Ve,Tt,ar){var Er=Ct.get(Ve);if(Lr(Er)){if(!ar)return;Er=new qt,Ct.set(Ve,Er)}var Wr=Er.get(Tt);if(Lr(Wr)){if(!ar)return;Wr=new qt,Er.set(Tt,Wr)}return Wr}function ke(Ve,Tt,ar){var Er=Ae(Ve,Tt,ar);if(Er)return!0;var Wr=fe(Tt);return jn(Wr)?!1:ke(Ve,Wr,ar)}function Ae(Ve,Tt,ar){var Er=O(Tt,ar,!1);return Lr(Er)?!1:vn(Er.has(Ve))}function st(Ve,Tt,ar){var Er=Ae(Ve,Tt,ar);if(Er)return _t(Ve,Tt,ar);var Wr=fe(Tt);if(!jn(Wr))return st(Ve,Wr,ar)}function _t(Ve,Tt,ar){var Er=O(Tt,ar,!1);if(!Lr(Er))return Er.get(Ve)}function bt(Ve,Tt,ar,Er){var Wr=O(ar,Er,!0);Wr.set(Ve,Tt)}function Ht(Ve,Tt){var ar=nr(Ve,Tt),Er=fe(Ve);if(Er===null)return ar;var Wr=Ht(Er,Tt);if(Wr.length<=0)return ar;if(ar.length<=0)return Wr;for(var mn=new ir,wn=[],gn=0,xn=ar;gn<xn.length;gn++){var ri=xn[gn],Jn=mn.has(ri);Jn||(mn.add(ri),wn.push(ri))}for(var Wi=0,$i=Wr;Wi<$i.length;Wi++){var ri=$i[Wi],Jn=mn.has(ri);Jn||(mn.add(ri),wn.push(ri))}return wn}function nr(Ve,Tt){var ar=[],Er=O(Ve,Tt,!1);if(Lr(Er))return ar;for(var Wr=Er.keys(),mn=Ya(Wr),wn=0;;){var gn=L(mn);if(!gn)return ar.length=wn,ar;var xn=kt(gn);try{ar[wn]=xn}catch(ri){try{ne(mn)}finally{throw ri}}wn++}}function Qr(Ve){if(Ve===null)return 1;switch(typeof Ve){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ve===null?1:6;default:return 6}}function Lr(Ve){return Ve===void 0}function jn(Ve){return Ve===null}function tn(Ve){return typeof Ve=="symbol"}function Cn(Ve){return typeof Ve=="object"?Ve!==null:typeof Ve=="function"}function si(Ve,Tt){switch(Qr(Ve)){case 0:return Ve;case 1:return Ve;case 2:return Ve;case 3:return Ve;case 4:return Ve;case 5:return Ve}var ar=Tt===3?"string":Tt===5?"number":"default",Er=Hi(Ve,ae);if(Er!==void 0){var Wr=Er.call(Ve,ar);if(Cn(Wr))throw new TypeError;return Wr}return Xn(Ve,ar==="default"?"number":ar)}function Xn(Ve,Tt){if(Tt==="string"){var ar=Ve.toString;if(Gn(ar)){var Er=ar.call(Ve);if(!Cn(Er))return Er}var Wr=Ve.valueOf;if(Gn(Wr)){var Er=Wr.call(Ve);if(!Cn(Er))return Er}}else{var Wr=Ve.valueOf;if(Gn(Wr)){var Er=Wr.call(Ve);if(!Cn(Er))return Er}var mn=Ve.toString;if(Gn(mn)){var Er=mn.call(Ve);if(!Cn(Er))return Er}}throw new TypeError}function vn(Ve){return!!Ve}function Ai(Ve){return""+Ve}function Ii(Ve){var Tt=si(Ve,3);return tn(Tt)?Tt:Ai(Tt)}function Ti(Ve){return Array.isArray?Array.isArray(Ve):Ve instanceof Object?Ve instanceof Array:Object.prototype.toString.call(Ve)==="[object Array]"}function Gn(Ve){return typeof Ve=="function"}function Dn(Ve){return typeof Ve=="function"}function ho(Ve){switch(Qr(Ve)){case 3:return!0;case 4:return!0;default:return!1}}function Hi(Ve,Tt){var ar=Ve[Tt];if(ar!=null){if(!Gn(ar))throw new TypeError;return ar}}function Ya(Ve){var Tt=Hi(Ve,Ge);if(!Gn(Tt))throw new TypeError;var ar=Tt.call(Ve);if(!Cn(ar))throw new TypeError;return ar}function kt(Ve){return Ve.value}function L(Ve){var Tt=Ve.next();return Tt.done?!1:Tt}function ne(Ve){var Tt=Ve.return;Tt&&Tt.call(Ve)}function fe(Ve){var Tt=Object.getPrototypeOf(Ve);if(typeof Ve!="function"||Ve===Pt||Tt!==Pt)return Tt;var ar=Ve.prototype,Er=ar&&Object.getPrototypeOf(ar);if(Er==null||Er===Object.prototype)return Tt;var Wr=Er.constructor;return typeof Wr!="function"||Wr===Ve?Tt:Wr}function Ze(){var Ve={},Tt=[],ar=function(){function wn(gn,xn,ri){this._index=0,this._keys=gn,this._values=xn,this._selector=ri}return wn.prototype["@@iterator"]=function(){return this},wn.prototype[Ge]=function(){return this},wn.prototype.next=function(){var gn=this._index;if(gn>=0&&gn<this._keys.length){var xn=this._selector(this._keys[gn],this._values[gn]);return gn+1>=this._keys.length?(this._index=-1,this._keys=Tt,this._values=Tt):this._index++,{value:xn,done:!1}}return{value:void 0,done:!0}},wn.prototype.throw=function(gn){throw this._index>=0&&(this._index=-1,this._keys=Tt,this._values=Tt),gn},wn.prototype.return=function(gn){return this._index>=0&&(this._index=-1,this._keys=Tt,this._values=Tt),{value:gn,done:!0}},wn}();return function(){function wn(){this._keys=[],this._values=[],this._cacheKey=Ve,this._cacheIndex=-2}return Object.defineProperty(wn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),wn.prototype.has=function(gn){return this._find(gn,!1)>=0},wn.prototype.get=function(gn){var xn=this._find(gn,!1);return xn>=0?this._values[xn]:void 0},wn.prototype.set=function(gn,xn){var ri=this._find(gn,!0);return this._values[ri]=xn,this},wn.prototype.delete=function(gn){var xn=this._find(gn,!1);if(xn>=0){for(var ri=this._keys.length,Jn=xn+1;Jn<ri;Jn++)this._keys[Jn-1]=this._keys[Jn],this._values[Jn-1]=this._values[Jn];return this._keys.length--,this._values.length--,gn===this._cacheKey&&(this._cacheKey=Ve,this._cacheIndex=-2),!0}return!1},wn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ve,this._cacheIndex=-2},wn.prototype.keys=function(){return new ar(this._keys,this._values,Er)},wn.prototype.values=function(){return new ar(this._keys,this._values,Wr)},wn.prototype.entries=function(){return new ar(this._keys,this._values,mn)},wn.prototype["@@iterator"]=function(){return this.entries()},wn.prototype[Ge]=function(){return this.entries()},wn.prototype._find=function(gn,xn){return this._cacheKey!==gn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=gn)),this._cacheIndex<0&&xn&&(this._cacheIndex=this._keys.length,this._keys.push(gn),this._values.push(void 0)),this._cacheIndex},wn}();function Er(wn,gn){return wn}function Wr(wn,gn){return gn}function mn(wn,gn){return[wn,gn]}}function pt(){return function(){function Ve(){this._map=new qt}return Object.defineProperty(Ve.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ve.prototype.has=function(Tt){return this._map.has(Tt)},Ve.prototype.add=function(Tt){return this._map.set(Tt,Tt),this},Ve.prototype.delete=function(Tt){return this._map.delete(Tt)},Ve.prototype.clear=function(){this._map.clear()},Ve.prototype.keys=function(){return this._map.keys()},Ve.prototype.values=function(){return this._map.values()},Ve.prototype.entries=function(){return this._map.entries()},Ve.prototype["@@iterator"]=function(){return this.keys()},Ve.prototype[Ge]=function(){return this.keys()},Ve}()}function Wt(){var Ve=16,Tt=ct.create(),ar=Er();return function(){function xn(){this._key=Er()}return xn.prototype.has=function(ri){var Jn=Wr(ri,!1);return Jn!==void 0?ct.has(Jn,this._key):!1},xn.prototype.get=function(ri){var Jn=Wr(ri,!1);return Jn!==void 0?ct.get(Jn,this._key):void 0},xn.prototype.set=function(ri,Jn){var Wi=Wr(ri,!0);return Wi[this._key]=Jn,this},xn.prototype.delete=function(ri){var Jn=Wr(ri,!1);return Jn!==void 0?delete Jn[this._key]:!1},xn.prototype.clear=function(){this._key=Er()},xn}();function Er(){var xn;do xn="@@WeakMap@@"+gn();while(ct.has(Tt,xn));return Tt[xn]=!0,xn}function Wr(xn,ri){if(!U.call(xn,ar)){if(!ri)return;Object.defineProperty(xn,ar,{value:ct.create()})}return xn[ar]}function mn(xn,ri){for(var Jn=0;Jn<ri;++Jn)xn[Jn]=Math.random()*255|0;return xn}function wn(xn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(xn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(xn)):mn(new Uint8Array(xn),xn):mn(new Array(xn),xn)}function gn(){var xn=wn(Ve);xn[6]=xn[6]&79|64,xn[8]=xn[8]&191|128;for(var ri="",Jn=0;Jn<Ve;++Jn){var Wi=xn[Jn];(Jn===4||Jn===6||Jn===8)&&(ri+="-"),Wi<16&&(ri+="0"),ri+=Wi.toString(16).toLowerCase()}return ri}}function Ar(Ve){return Ve.__=void 0,delete Ve.__,Ve}})})(Q||(Q={}))},81550:function(wr){(function(ee,z){wr.exports=z()})(this,function(){"use strict";var ee=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},z=function(B,Se){for(var Ie=Object.keys(Se),Nt=0;Nt<Ie.length;++Nt)B[Ie[Nt]]=Se[Ie[Nt]];return B},_e=`
`;function Q(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function y(B){var Se=new Error("(regl) "+B);throw console.error(Se),Se}function se(B,Se){B||y(Se)}function U(B){return B?": "+B:""}function ce(B,Se,Ie){B in Se||y("unknown parameter ("+B+")"+U(Ie)+". possible values: "+Object.keys(Se).join())}function ae(B,Se){ee(B)||y("invalid parameter type"+U(Se)+". must be a typed array")}function Ge(B,Se){switch(Se){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function oe(B,Se,Ie){Ge(B,Se)||y("invalid parameter type"+U(Ie)+". expected "+Se+", got "+typeof B)}function je(B,Se){B>=0&&(B|0)===B||y("invalid parameter type, ("+B+")"+U(Se)+". must be a nonnegative integer")}function rt(B,Se,Ie){Se.indexOf(B)<0&&y("invalid value"+U(Ie)+". must be one of: "+Se)}var ct=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Pt(B){Object.keys(B).forEach(function(Se){ct.indexOf(Se)<0&&y('invalid regl constructor argument "'+Se+'". must be one of '+ct)})}function er(B,Se){for(B=B+"";B.length<Se;)B=" "+B;return B}function qt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ir(B,Se){this.number=B,this.line=Se,this.errors=[]}function tr(B,Se,Ie){this.file=B,this.line=Se,this.message=Ie}function Ct(){var B=new Error,Se=(B.stack||B).toString(),Ie=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Se);if(Ie)return Ie[1];var Nt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Se);return Nt?Nt[1]:"unknown"}function yt(){var B=new Error,Se=(B.stack||B).toString(),Ie=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Se);if(Ie)return Ie[1];var Nt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Se);return Nt?Nt[1]:"unknown"}function Fr(B,Se){var Ie=B.split(`
`),Nt=1,or=0,Dt={unknown:new qt,0:new qt};Dt.unknown.name=Dt[0].name=Se||Ct(),Dt.unknown.lines.push(new ir(0,""));for(var Xt=0;Xt<Ie.length;++Xt){var Cr=Ie[Xt],Mr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Cr);if(Mr)switch(Mr[1]){case"line":var Or=/(\d+)(\s+\d+)?/.exec(Mr[2]);Or&&(Nt=Or[1]|0,Or[2]&&(or=Or[2]|0,or in Dt||(Dt[or]=new qt)));break;case"define":var Pr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Mr[2]);Pr&&(Dt[or].name=Pr[1]?Q(Pr[2]):Pr[2]);break}Dt[or].lines.push(new ir(Nt++,Cr))}return Object.keys(Dt).forEach(function(Nr){var $r=Dt[Nr];$r.lines.forEach(function(Sr){$r.index[Sr.number]=Sr})}),Dt}function mr(B){var Se=[];return B.split(`
`).forEach(function(Ie){if(!(Ie.length<5)){var Nt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ie);Nt?Se.push(new tr(Nt[1]|0,Nt[2]|0,Nt[3].trim())):Ie.length>0&&Se.push(new tr("unknown",0,Ie))}}),Se}function lr(B,Se){Se.forEach(function(Ie){var Nt=B[Ie.file];if(Nt){var or=Nt.index[Ie.line];if(or){or.errors.push(Ie),Nt.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(Ie)})}function xt(B,Se,Ie,Nt,or){if(!B.getShaderParameter(Se,B.COMPILE_STATUS)){var Dt=B.getShaderInfoLog(Se),Xt=Nt===B.FRAGMENT_SHADER?"fragment":"vertex";Le(Ie,"string",Xt+" shader source must be a string",or);var Cr=Fr(Ie,or),Mr=mr(Dt);lr(Cr,Mr),Object.keys(Cr).forEach(function(Or){var Pr=Cr[Or];if(!Pr.hasErrors)return;var Nr=[""],$r=[""];function Sr(Zr,wt){Nr.push(Zr),$r.push(wt||"")}Sr("file number "+Or+": "+Pr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Pr.lines.forEach(function(Zr){if(Zr.errors.length>0){Sr(er(Zr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Sr(Zr.line+_e,"color:red; background-color:yellow; font-weight:bold");var wt=0;Zr.errors.forEach(function(Gt){var Tr=Gt.message,Jr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Tr);if(Jr){var dr=Jr[1];switch(Tr=Jr[2],dr){case"assign":dr="=";break}wt=Math.max(Zr.line.indexOf(dr,wt),0)}else wt=0;Sr(er("| ",6)),Sr(er("^^^",wt+3)+_e,"font-weight:bold"),Sr(er("| ",6)),Sr(Tr+_e,"font-weight:bold")}),Sr(er("| ",6)+_e)}else Sr(er(Zr.number,4)+"|  "),Sr(Zr.line+_e,"color:red")}),typeof document!="undefined"&&!window.chrome?($r[0]=Nr.join("%c"),console.log.apply(console,$r)):console.log(Nr.join(""))}),se.raise("Error compiling "+Xt+" shader, "+Cr[0].name)}}function at(B,Se,Ie,Nt,or){if(!B.getProgramParameter(Se,B.LINK_STATUS)){var Dt=B.getProgramInfoLog(Se),Xt=Fr(Ie,or),Cr=Fr(Nt,or),Mr='Error linking program with vertex shader, "'+Cr[0].name+'", and fragment shader "'+Xt[0].name+'"';typeof document!="undefined"?console.log("%c"+Mr+_e+"%c"+Dt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Mr+_e+Dt),se.raise(Mr)}}function Rt(B){B._commandRef=Ct()}function ft(B,Se,Ie,Nt){Rt(B);function or(Mr){return Mr?Nt.id(Mr):0}B._fragId=or(B.static.frag),B._vertId=or(B.static.vert);function Dt(Mr,Or){Object.keys(Or).forEach(function(Pr){Mr[Nt.id(Pr)]=!0})}var Xt=B._uniformSet={};Dt(Xt,Se.static),Dt(Xt,Se.dynamic);var Cr=B._attributeSet={};Dt(Cr,Ie.static),Dt(Cr,Ie.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function Kt(B,Se){var Ie=yt();y(B+" in command "+(Se||Ct())+(Ie==="unknown"?"":" called from "+Ie))}function xr(B,Se,Ie){B||Kt(Se,Ie||Ct())}function Y(B,Se,Ie,Nt){B in Se||Kt("unknown parameter ("+B+")"+U(Ie)+". possible values: "+Object.keys(Se).join(),Nt||Ct())}function Le(B,Se,Ie,Nt){Ge(B,Se)||Kt("invalid parameter type"+U(Ie)+". expected "+Se+", got "+typeof B,Nt||Ct())}function O(B){B()}function ke(B,Se,Ie){B.texture?rt(B.texture._texture.internalformat,Se,"unsupported texture format for attachment"):rt(B.renderbuffer._renderbuffer.format,Ie,"unsupported renderbuffer format for attachment")}var Ae=33071,st=9728,_t=9984,bt=9985,Ht=9986,nr=9987,Qr=5120,Lr=5121,jn=5122,tn=5123,Cn=5124,si=5125,Xn=5126,vn=32819,Ai=32820,Ii=33635,Ti=34042,Gn=36193,Dn={};Dn[Qr]=Dn[Lr]=1,Dn[jn]=Dn[tn]=Dn[Gn]=Dn[Ii]=Dn[vn]=Dn[Ai]=2,Dn[Cn]=Dn[si]=Dn[Xn]=Dn[Ti]=4;function ho(B,Se){return B===Ai||B===vn||B===Ii?2:B===Ti?4:Dn[B]*Se}function Hi(B){return!(B&B-1)&&!!B}function Ya(B,Se,Ie){var Nt,or=Se.width,Dt=Se.height,Xt=Se.channels;se(or>0&&or<=Ie.maxTextureSize&&Dt>0&&Dt<=Ie.maxTextureSize,"invalid texture shape"),(B.wrapS!==Ae||B.wrapT!==Ae)&&se(Hi(or)&&Hi(Dt),"incompatible wrap mode for texture, both width and height must be power of 2"),Se.mipmask===1?or!==1&&Dt!==1&&se(B.minFilter!==_t&&B.minFilter!==Ht&&B.minFilter!==bt&&B.minFilter!==nr,"min filter requires mipmap"):(se(Hi(or)&&Hi(Dt),"texture must be a square power of 2 to support mipmapping"),se(Se.mipmask===(or<<1)-1,"missing or incomplete mipmap data")),Se.type===Xn&&(Ie.extensions.indexOf("oes_texture_float_linear")<0&&se(B.minFilter===st&&B.magFilter===st,"filter not supported, must enable oes_texture_float_linear"),se(!B.genMipmaps,"mipmap generation not supported with float textures"));var Cr=Se.images;for(Nt=0;Nt<16;++Nt)if(Cr[Nt]){var Mr=or>>Nt,Or=Dt>>Nt;se(Se.mipmask&1<<Nt,"missing mipmap data");var Pr=Cr[Nt];if(se(Pr.width===Mr&&Pr.height===Or,"invalid shape for mip images"),se(Pr.format===Se.format&&Pr.internalformat===Se.internalformat&&Pr.type===Se.type,"incompatible type for mip image"),!Pr.compressed)if(Pr.data){var Nr=Math.ceil(ho(Pr.type,Xt)*Mr/Pr.unpackAlignment)*Pr.unpackAlignment;se(Pr.data.byteLength===Nr*Or,"invalid data for image, buffer size is inconsistent with image format")}else Pr.element||Pr.copy}else B.genMipmaps||se((Se.mipmask&1<<Nt)==0,"extra mipmap data");Se.compressed&&se(!B.genMipmaps,"mipmap generation for compressed images not supported")}function kt(B,Se,Ie,Nt){var or=B.width,Dt=B.height,Xt=B.channels;se(or>0&&or<=Nt.maxTextureSize&&Dt>0&&Dt<=Nt.maxTextureSize,"invalid texture shape"),se(or===Dt,"cube map must be square"),se(Se.wrapS===Ae&&Se.wrapT===Ae,"wrap mode not supported by cube map");for(var Cr=0;Cr<Ie.length;++Cr){var Mr=Ie[Cr];se(Mr.width===or&&Mr.height===Dt,"inconsistent cube map face shape"),Se.genMipmaps&&(se(!Mr.compressed,"can not generate mipmap for compressed textures"),se(Mr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Or=Mr.images,Pr=0;Pr<16;++Pr){var Nr=Or[Pr];if(Nr){var $r=or>>Pr,Sr=Dt>>Pr;se(Mr.mipmask&1<<Pr,"missing mipmap data"),se(Nr.width===$r&&Nr.height===Sr,"invalid shape for mip images"),se(Nr.format===B.format&&Nr.internalformat===B.internalformat&&Nr.type===B.type,"incompatible type for mip image"),Nr.compressed||(Nr.data?se(Nr.data.byteLength===$r*Sr*Math.max(ho(Nr.type,Xt),Nr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Nr.element||Nr.copy)}}}}var L=z(se,{optional:O,raise:y,commandRaise:Kt,command:xr,parameter:ce,commandParameter:Y,constructor:Pt,type:oe,commandType:Le,isTypedArray:ae,nni:je,oneOf:rt,shaderError:xt,linkError:at,callSite:yt,saveCommandRef:Rt,saveDrawInfo:ft,framebufferFormat:ke,guessCommand:Ct,texture2D:Ya,textureCube:kt}),ne=0,fe=0,Ze=5,pt=6;function Wt(B,Se){this.id=ne++,this.type=B,this.data=Se}function Ar(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Ve(B){if(B.length===0)return[];var Se=B.charAt(0),Ie=B.charAt(B.length-1);if(B.length>1&&Se===Ie&&(Se==='"'||Se==="'"))return['"'+Ar(B.substr(1,B.length-2))+'"'];var Nt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(Nt)return Ve(B.substr(0,Nt.index)).concat(Ve(Nt[1])).concat(Ve(B.substr(Nt.index+Nt[0].length)));var or=B.split(".");if(or.length===1)return['"'+Ar(B)+'"'];for(var Dt=[],Xt=0;Xt<or.length;++Xt)Dt=Dt.concat(Ve(or[Xt]));return Dt}function Tt(B){return"["+Ve(B).join("][")+"]"}function ar(B,Se){return new Wt(B,Tt(Se+""))}function Er(B){return typeof B=="function"&&!B._reglType||B instanceof Wt}function Wr(B,Se){if(typeof B=="function")return new Wt(fe,B);if(typeof B=="number"||typeof B=="boolean")return new Wt(Ze,B);if(Array.isArray(B))return new Wt(pt,B.map((Ie,Nt)=>Wr(Ie,Se+"["+Nt+"]")));if(B instanceof Wt)return B;L(!1,"invalid option type in uniform "+Se)}var mn={DynamicVariable:Wt,define:ar,isDynamic:Er,unbox:Wr,accessor:Tt},wn={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},gn=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function xn(){var B={"":0},Se=[""];return{id:function(Ie){var Nt=B[Ie];return Nt||(Nt=B[Ie]=Se.length,Se.push(Ie),Nt)},str:function(Ie){return Se[Ie]}}}function ri(B,Se,Ie){var Nt=document.createElement("canvas");z(Nt.style,{border:0,margin:0,padding:0,top:0,left:0}),B.appendChild(Nt),B===document.body&&(Nt.style.position="absolute",z(B.style,{margin:0,padding:0}));function or(){var Cr=window.innerWidth,Mr=window.innerHeight;if(B!==document.body){var Or=B.getBoundingClientRect();Cr=Or.right-Or.left,Mr=Or.bottom-Or.top}Nt.width=Ie*Cr,Nt.height=Ie*Mr,z(Nt.style,{width:Cr+"px",height:Mr+"px"})}var Dt;B!==document.body&&typeof ResizeObserver=="function"?(Dt=new ResizeObserver(function(){setTimeout(or)}),Dt.observe(B)):window.addEventListener("resize",or,!1);function Xt(){Dt?Dt.disconnect():window.removeEventListener("resize",or),B.removeChild(Nt)}return or(),{canvas:Nt,onDestroy:Xt}}function Jn(B,Se){function Ie(Nt){try{return B.getContext(Nt,Se)}catch(or){return null}}return Ie("webgl")||Ie("experimental-webgl")||Ie("webgl-experimental")}function Wi(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function $i(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function po(B){return typeof B=="string"?B.split():(L(Array.isArray(B),"invalid extension array"),B)}function $o(B){return typeof B=="string"?(L(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function Xi(B){var Se=B||{},Ie,Nt,or,Dt,Xt={},Cr=[],Mr=[],Or=typeof window=="undefined"?1:window.devicePixelRatio,Pr=!1,Nr=function(Zr){Zr&&L.raise(Zr)},$r=function(){};if(typeof Se=="string"?(L(typeof document!="undefined","selector queries only supported in DOM enviroments"),Ie=document.querySelector(Se),L(Ie,"invalid query string for element")):typeof Se=="object"?Wi(Se)?Ie=Se:$i(Se)?(Dt=Se,or=Dt.canvas):(L.constructor(Se),"gl"in Se?Dt=Se.gl:"canvas"in Se?or=$o(Se.canvas):"container"in Se&&(Nt=$o(Se.container)),"attributes"in Se&&(Xt=Se.attributes,L.type(Xt,"object","invalid context attributes")),"extensions"in Se&&(Cr=po(Se.extensions)),"optionalExtensions"in Se&&(Mr=po(Se.optionalExtensions)),"onDone"in Se&&(L.type(Se.onDone,"function","invalid or missing onDone callback"),Nr=Se.onDone),"profile"in Se&&(Pr=!!Se.profile),"pixelRatio"in Se&&(Or=+Se.pixelRatio,L(Or>0,"invalid pixel ratio"))):L.raise("invalid arguments to regl"),Ie&&(Ie.nodeName.toLowerCase()==="canvas"?or=Ie:Nt=Ie),!Dt){if(!or){L(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Sr=ri(Nt||document.body,Nr,Or);if(!Sr)return null;or=Sr.canvas,$r=Sr.onDestroy}Xt.premultipliedAlpha===void 0&&(Xt.premultipliedAlpha=!0),Dt=Jn(or,Xt)}return Dt?{gl:Dt,canvas:or,container:Nt,extensions:Cr,optionalExtensions:Mr,pixelRatio:Or,profile:Pr,onDone:Nr,onDestroy:$r}:($r(),Nr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function G(B,Se){var Ie={};function Nt(Xt){L.type(Xt,"string","extension name must be string");var Cr=Xt.toLowerCase(),Mr;try{Mr=Ie[Cr]=B.getExtension(Cr)}catch(Or){}return!!Mr}for(var or=0;or<Se.extensions.length;++or){var Dt=Se.extensions[or];if(!Nt(Dt))return Se.onDestroy(),Se.onDone('"'+Dt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Se.optionalExtensions.forEach(Nt),{extensions:Ie,restore:function(){Object.keys(Ie).forEach(function(Xt){if(Ie[Xt]&&!Nt(Xt))throw new Error("(regl): error restoring extension "+Xt)})}}}function X(B,Se){for(var Ie=Array(B),Nt=0;Nt<B;++Nt)Ie[Nt]=Se(Nt);return Ie}var ie=5120,we=5121,Oe=5122,Ke=5123,ot=5124,pe=5125,J=5126;function be(B){for(var Se=16;Se<=1<<28;Se*=16)if(B<=Se)return Se;return 0}function lt(B){var Se,Ie;return Se=(B>65535)<<4,B>>>=Se,Ie=(B>255)<<3,B>>>=Ie,Se|=Ie,Ie=(B>15)<<2,B>>>=Ie,Se|=Ie,Ie=(B>3)<<1,B>>>=Ie,Se|=Ie,Se|B>>1}function dt(){var B=X(8,function(){return[]});function Se(Dt){var Xt=be(Dt),Cr=B[lt(Xt)>>2];return Cr.length>0?Cr.pop():new ArrayBuffer(Xt)}function Ie(Dt){B[lt(Dt.byteLength)>>2].push(Dt)}function Nt(Dt,Xt){var Cr=null;switch(Dt){case ie:Cr=new Int8Array(Se(Xt),0,Xt);break;case we:Cr=new Uint8Array(Se(Xt),0,Xt);break;case Oe:Cr=new Int16Array(Se(2*Xt),0,Xt);break;case Ke:Cr=new Uint16Array(Se(2*Xt),0,Xt);break;case ot:Cr=new Int32Array(Se(4*Xt),0,Xt);break;case pe:Cr=new Uint32Array(Se(4*Xt),0,Xt);break;case J:Cr=new Float32Array(Se(4*Xt),0,Xt);break;default:return null}return Cr.length!==Xt?Cr.subarray(0,Xt):Cr}function or(Dt){Ie(Dt.buffer)}return{alloc:Se,free:Ie,allocType:Nt,freeType:or}}var re=dt();re.zero=dt();var br=3408,yn=3410,ln=3411,Qt=3412,en=3413,Gr=3414,Yr=3415,li=33901,qr=33902,hi=3379,Bi=3386,ci=34921,_i=36347,xi=36348,ao=35661,Ui=35660,aa=34930,bi=36349,fi=34076,vi=34024,fa=7936,ms=7937,Ki=7938,ha=35724,Su=34047,wu=36063,oa=34852,vo=3553,Hn=34067,ra=34069,Ea=33984,zi=6408,To=5126,mo=5121,Ds=36160,is=36053,Fl=36064,Xo=16384,la=function(B,Se){var Ie=1;Se.ext_texture_filter_anisotropic&&(Ie=B.getParameter(Su));var Nt=1,or=1;Se.webgl_draw_buffers&&(Nt=B.getParameter(oa),or=B.getParameter(wu));var Dt=!!Se.oes_texture_float;if(Dt){var Xt=B.createTexture();B.bindTexture(vo,Xt),B.texImage2D(vo,0,zi,1,1,0,zi,To,null);var Cr=B.createFramebuffer();if(B.bindFramebuffer(Ds,Cr),B.framebufferTexture2D(Ds,Fl,vo,Xt,0),B.bindTexture(vo,null),B.checkFramebufferStatus(Ds)!==is)Dt=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(Xo);var Mr=re.allocType(To,4);B.readPixels(0,0,1,1,zi,To,Mr),B.getError()?Dt=!1:(B.deleteFramebuffer(Cr),B.deleteTexture(Xt),Dt=Mr[0]===1),re.freeType(Mr)}}var Or=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Pr=!0;if(!Or){var Nr=B.createTexture(),$r=re.allocType(mo,36);B.activeTexture(Ea),B.bindTexture(Hn,Nr),B.texImage2D(ra,0,zi,3,3,0,zi,mo,$r),re.freeType($r),B.bindTexture(Hn,null),B.deleteTexture(Nr),Pr=!B.getError()}return{colorBits:[B.getParameter(yn),B.getParameter(ln),B.getParameter(Qt),B.getParameter(en)],depthBits:B.getParameter(Gr),stencilBits:B.getParameter(Yr),subpixelBits:B.getParameter(br),extensions:Object.keys(Se).filter(function(Sr){return!!Se[Sr]}),maxAnisotropic:Ie,maxDrawbuffers:Nt,maxColorAttachments:or,pointSizeDims:B.getParameter(li),lineWidthDims:B.getParameter(qr),maxViewportDims:B.getParameter(Bi),maxCombinedTextureUnits:B.getParameter(ao),maxCubeMapSize:B.getParameter(fi),maxRenderbufferSize:B.getParameter(vi),maxTextureUnits:B.getParameter(aa),maxTextureSize:B.getParameter(hi),maxAttributes:B.getParameter(ci),maxVertexUniforms:B.getParameter(_i),maxVertexTextureUnits:B.getParameter(Ui),maxVaryingVectors:B.getParameter(xi),maxFragmentUniforms:B.getParameter(bi),glsl:B.getParameter(ha),renderer:B.getParameter(ms),vendor:B.getParameter(fa),version:B.getParameter(Ki),readFloat:Dt,npotTextureCube:Pr}};function ga(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||ee(B.data))}var cr=function(B){return Object.keys(B).map(function(Se){return B[Se]})},K={shape:Ri,flatten:Mn};function Me(B,Se,Ie){for(var Nt=0;Nt<Se;++Nt)Ie[Nt]=B[Nt]}function nt(B,Se,Ie,Nt){for(var or=0,Dt=0;Dt<Se;++Dt)for(var Xt=B[Dt],Cr=0;Cr<Ie;++Cr)Nt[or++]=Xt[Cr]}function Jt(B,Se,Ie,Nt,or,Dt){for(var Xt=Dt,Cr=0;Cr<Se;++Cr)for(var Mr=B[Cr],Or=0;Or<Ie;++Or)for(var Pr=Mr[Or],Nr=0;Nr<Nt;++Nr)or[Xt++]=Pr[Nr]}function Vr(B,Se,Ie,Nt,or){for(var Dt=1,Xt=Ie+1;Xt<Se.length;++Xt)Dt*=Se[Xt];var Cr=Se[Ie];if(Se.length-Ie==4){var Mr=Se[Ie+1],Or=Se[Ie+2],Pr=Se[Ie+3];for(Xt=0;Xt<Cr;++Xt)Jt(B[Xt],Mr,Or,Pr,Nt,or),or+=Dt}else for(Xt=0;Xt<Cr;++Xt)Vr(B[Xt],Se,Ie+1,Nt,or),or+=Dt}function Mn(B,Se,Ie,Nt){var or=1;if(Se.length)for(var Dt=0;Dt<Se.length;++Dt)or*=Se[Dt];else or=0;var Xt=Nt||re.allocType(Ie,or);switch(Se.length){case 0:break;case 1:Me(B,Se[0],Xt);break;case 2:nt(B,Se[0],Se[1],Xt);break;case 3:Jt(B,Se[0],Se[1],Se[2],Xt,0);break;default:Vr(B,Se,0,Xt,0)}return Xt}function Ri(B){for(var Se=[],Ie=B;Ie.length;Ie=Ie[0])Se.push(Ie.length);return Se}var Pa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},oo=5120,Ua=5122,as=5124,sc=5121,Os=5123,Uc=5125,Fs=5126,Bu=5126,os={int8:oo,int16:Ua,int32:as,uint8:sc,uint16:Os,uint32:Uc,float:Fs,float32:Bu},ul=35048,zu=35040,Js={dynamic:ul,stream:zu,static:35044},Bl=K.flatten,Yo=K.shape,La=35044,zl=35040,Vc=5121,bf=5126,Nu=[];Nu[5120]=1,Nu[5122]=2,Nu[5124]=4,Nu[5121]=1,Nu[5123]=2,Nu[5125]=4,Nu[5126]=4;function Nl(B){return Pa[Object.prototype.toString.call(B)]|0}function jc(B,Se){for(var Ie=0;Ie<Se.length;++Ie)B[Ie]=Se[Ie]}function Gc(B,Se,Ie,Nt,or,Dt,Xt){for(var Cr=0,Mr=0;Mr<Ie;++Mr)for(var Or=0;Or<Nt;++Or)B[Cr++]=Se[or*Mr+Dt*Or+Xt]}function Sf(B,Se,Ie,Nt){var or=0,Dt={};function Xt(wt){this.id=or++,this.buffer=B.createBuffer(),this.type=wt,this.usage=La,this.byteLength=0,this.dimension=1,this.dtype=Vc,this.persistentData=null,Ie.profile&&(this.stats={size:0})}Xt.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},Xt.prototype.destroy=function(){$r(this)};var Cr=[];function Mr(wt,Gt){var Tr=Cr.pop();return Tr||(Tr=new Xt(wt)),Tr.bind(),Nr(Tr,Gt,zl,0,1,!1),Tr}function Or(wt){Cr.push(wt)}function Pr(wt,Gt,Tr){wt.byteLength=Gt.byteLength,B.bufferData(wt.type,Gt,Tr)}function Nr(wt,Gt,Tr,Jr,dr,rn){var _r;if(wt.usage=Tr,Array.isArray(Gt)){if(wt.dtype=Jr||bf,Gt.length>0){var Ur;if(Array.isArray(Gt[0])){_r=Yo(Gt);for(var vr=1,Br=1;Br<_r.length;++Br)vr*=_r[Br];wt.dimension=vr,Ur=Bl(Gt,_r,wt.dtype),Pr(wt,Ur,Tr),rn?wt.persistentData=Ur:re.freeType(Ur)}else if(typeof Gt[0]=="number"){wt.dimension=dr;var Pn=re.allocType(wt.dtype,Gt.length);jc(Pn,Gt),Pr(wt,Pn,Tr),rn?wt.persistentData=Pn:re.freeType(Pn)}else ee(Gt[0])?(wt.dimension=Gt[0].length,wt.dtype=Jr||Nl(Gt[0])||bf,Ur=Bl(Gt,[Gt.length,Gt[0].length],wt.dtype),Pr(wt,Ur,Tr),rn?wt.persistentData=Ur:re.freeType(Ur)):L.raise("invalid buffer data")}}else if(ee(Gt))wt.dtype=Jr||Nl(Gt),wt.dimension=dr,Pr(wt,Gt,Tr),rn&&(wt.persistentData=new Uint8Array(new Uint8Array(Gt.buffer)));else if(ga(Gt)){_r=Gt.shape;var zn=Gt.stride,jr=Gt.offset,ut=0,fr=0,et=0,Un=0;_r.length===1?(ut=_r[0],fr=1,et=zn[0],Un=0):_r.length===2?(ut=_r[0],fr=_r[1],et=zn[0],Un=zn[1]):L.raise("invalid shape"),wt.dtype=Jr||Nl(Gt.data)||bf,wt.dimension=fr;var bn=re.allocType(wt.dtype,ut*fr);Gc(bn,Gt.data,ut,fr,et,Un,jr),Pr(wt,bn,Tr),rn?wt.persistentData=bn:re.freeType(bn)}else Gt instanceof ArrayBuffer?(wt.dtype=Vc,wt.dimension=dr,Pr(wt,Gt,Tr),rn&&(wt.persistentData=new Uint8Array(new Uint8Array(Gt)))):L.raise("invalid buffer data")}function $r(wt){Se.bufferCount--,Nt(wt);var Gt=wt.buffer;L(Gt,"buffer must not be deleted already"),B.deleteBuffer(Gt),wt.buffer=null,delete Dt[wt.id]}function Sr(wt,Gt,Tr,Jr){Se.bufferCount++;var dr=new Xt(Gt);Dt[dr.id]=dr;function rn(vr){var Br=La,Pn=null,zn=0,jr=0,ut=1;return Array.isArray(vr)||ee(vr)||ga(vr)||vr instanceof ArrayBuffer?Pn=vr:typeof vr=="number"?zn=vr|0:vr&&(L.type(vr,"object","buffer arguments must be an object, a number or an array"),"data"in vr&&(L(Pn===null||Array.isArray(Pn)||ee(Pn)||ga(Pn),"invalid data for buffer"),Pn=vr.data),"usage"in vr&&(L.parameter(vr.usage,Js,"invalid buffer usage"),Br=Js[vr.usage]),"type"in vr&&(L.parameter(vr.type,os,"invalid buffer type"),jr=os[vr.type]),"dimension"in vr&&(L.type(vr.dimension,"number","invalid dimension"),ut=vr.dimension|0),"length"in vr&&(L.nni(zn,"buffer length must be a nonnegative integer"),zn=vr.length|0)),dr.bind(),Pn?Nr(dr,Pn,Br,jr,ut,Jr):(zn&&B.bufferData(dr.type,zn,Br),dr.dtype=jr||Vc,dr.usage=Br,dr.dimension=ut,dr.byteLength=zn),Ie.profile&&(dr.stats.size=dr.byteLength*Nu[dr.dtype]),rn}function _r(vr,Br){L(Br+vr.byteLength<=dr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+vr.byteLength+" starting from offset "+Br+" to a buffer of size "+dr.byteLength),B.bufferSubData(dr.type,Br,vr)}function Ur(vr,Br){var Pn=(Br||0)|0,zn;if(dr.bind(),ee(vr)||vr instanceof ArrayBuffer)_r(vr,Pn);else if(Array.isArray(vr)){if(vr.length>0)if(typeof vr[0]=="number"){var jr=re.allocType(dr.dtype,vr.length);jc(jr,vr),_r(jr,Pn),re.freeType(jr)}else if(Array.isArray(vr[0])||ee(vr[0])){zn=Yo(vr);var ut=Bl(vr,zn,dr.dtype);_r(ut,Pn),re.freeType(ut)}else L.raise("invalid buffer data")}else if(ga(vr)){zn=vr.shape;var fr=vr.stride,et=0,Un=0,bn=0,mi=0;zn.length===1?(et=zn[0],Un=1,bn=fr[0],mi=0):zn.length===2?(et=zn[0],Un=zn[1],bn=fr[0],mi=fr[1]):L.raise("invalid shape");var oi=Array.isArray(vr.data)?dr.dtype:Nl(vr.data),di=re.allocType(oi,et*Un);Gc(di,vr.data,et,Un,bn,mi,vr.offset),_r(di,Pn),re.freeType(di)}else L.raise("invalid data for buffer subdata");return rn}return Tr||rn(wt),rn._reglType="buffer",rn._buffer=dr,rn.subdata=Ur,Ie.profile&&(rn.stats=dr.stats),rn.destroy=function(){$r(dr)},rn}function Zr(){cr(Dt).forEach(function(wt){wt.buffer=B.createBuffer(),B.bindBuffer(wt.type,wt.buffer),B.bufferData(wt.type,wt.persistentData||wt.byteLength,wt.usage)})}return Ie.profile&&(Se.getTotalBufferSize=function(){var wt=0;return Object.keys(Dt).forEach(function(Gt){wt+=Dt[Gt].stats.size}),wt}),{create:Sr,createStream:Mr,destroyStream:Or,clear:function(){cr(Dt).forEach($r),Cr.forEach($r)},getBuffer:function(wt){return wt&&wt._buffer instanceof Xt?wt._buffer:null},restore:Zr,_initBuffer:Nr}}var ih=0,ah=0,Zh=1,uc=1,lc=4,oh=4,Ra={points:ih,point:ah,lines:Zh,line:uc,triangles:lc,triangle:oh,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},wf=0,Zu=1,Bs=4,ll=5120,zs=5121,ii=5122,Ns=5123,Eu=5124,qo=5125,cc=34963,sh=35040,kn=35044;function gs(B,Se,Ie,Nt){var or={},Dt=0,Xt={uint8:zs,uint16:Ns};Se.oes_element_index_uint&&(Xt.uint32=qo);function Cr(Zr){this.id=Dt++,or[this.id]=this,this.buffer=Zr,this.primType=Bs,this.vertCount=0,this.type=0}Cr.prototype.bind=function(){this.buffer.bind()};var Mr=[];function Or(Zr){var wt=Mr.pop();return wt||(wt=new Cr(Ie.create(null,cc,!0,!1)._buffer)),Nr(wt,Zr,sh,-1,-1,0,0),wt}function Pr(Zr){Mr.push(Zr)}function Nr(Zr,wt,Gt,Tr,Jr,dr,rn){Zr.buffer.bind();var _r;if(wt){var Ur=rn;!rn&&(!ee(wt)||ga(wt)&&!ee(wt.data))&&(Ur=Se.oes_element_index_uint?qo:Ns),Ie._initBuffer(Zr.buffer,wt,Gt,Ur,3)}else B.bufferData(cc,dr,Gt),Zr.buffer.dtype=_r||zs,Zr.buffer.usage=Gt,Zr.buffer.dimension=3,Zr.buffer.byteLength=dr;if(_r=rn,!rn){switch(Zr.buffer.dtype){case zs:case ll:_r=zs;break;case Ns:case ii:_r=Ns;break;case qo:case Eu:_r=qo;break;default:L.raise("unsupported type for element array")}Zr.buffer.dtype=_r}Zr.type=_r,L(_r!==qo||!!Se.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var vr=Jr;vr<0&&(vr=Zr.buffer.byteLength,_r===Ns?vr>>=1:_r===qo&&(vr>>=2)),Zr.vertCount=vr;var Br=Tr;if(Tr<0){Br=Bs;var Pn=Zr.buffer.dimension;Pn===1&&(Br=wf),Pn===2&&(Br=Zu),Pn===3&&(Br=Bs)}Zr.primType=Br}function $r(Zr){Nt.elementsCount--,L(Zr.buffer!==null,"must not double destroy elements"),delete or[Zr.id],Zr.buffer.destroy(),Zr.buffer=null}function Sr(Zr,wt){var Gt=Ie.create(null,cc,!0),Tr=new Cr(Gt._buffer);Nt.elementsCount++;function Jr(dr){if(!dr)Gt(),Tr.primType=Bs,Tr.vertCount=0,Tr.type=zs;else if(typeof dr=="number")Gt(dr),Tr.primType=Bs,Tr.vertCount=dr|0,Tr.type=zs;else{var rn=null,_r=kn,Ur=-1,vr=-1,Br=0,Pn=0;Array.isArray(dr)||ee(dr)||ga(dr)?rn=dr:(L.type(dr,"object","invalid arguments for elements"),"data"in dr&&(rn=dr.data,L(Array.isArray(rn)||ee(rn)||ga(rn),"invalid data for element buffer")),"usage"in dr&&(L.parameter(dr.usage,Js,"invalid element buffer usage"),_r=Js[dr.usage]),"primitive"in dr&&(L.parameter(dr.primitive,Ra,"invalid element buffer primitive"),Ur=Ra[dr.primitive]),"count"in dr&&(L(typeof dr.count=="number"&&dr.count>=0,"invalid vertex count for elements"),vr=dr.count|0),"type"in dr&&(L.parameter(dr.type,Xt,"invalid buffer type"),Pn=Xt[dr.type]),"length"in dr?Br=dr.length|0:(Br=vr,Pn===Ns||Pn===ii?Br*=2:(Pn===qo||Pn===Eu)&&(Br*=4))),Nr(Tr,rn,_r,Ur,vr,Br,Pn)}return Jr}return Jr(Zr),Jr._reglType="elements",Jr._elements=Tr,Jr.subdata=function(dr,rn){return Gt.subdata(dr,rn),Jr},Jr.destroy=function(){$r(Tr)},Jr}return{create:Sr,createStream:Or,destroyStream:Pr,getElements:function(Zr){return typeof Zr=="function"&&Zr._elements instanceof Cr?Zr._elements:null},clear:function(){cr(or).forEach($r)}}}var Ko=new Float32Array(1),Uu=new Uint32Array(Ko.buffer),uh=5123;function Hc(B){for(var Se=re.allocType(uh,B.length),Ie=0;Ie<B.length;++Ie)if(isNaN(B[Ie]))Se[Ie]=65535;else if(B[Ie]===Infinity)Se[Ie]=31744;else if(B[Ie]===-Infinity)Se[Ie]=64512;else{Ko[0]=B[Ie];var Nt=Uu[0],or=Nt>>>31<<15,Dt=(Nt<<1>>>24)-127,Xt=Nt>>13&(1<<10)-1;if(Dt<-24)Se[Ie]=or;else if(Dt<-14){var Cr=-14-Dt;Se[Ie]=or+(Xt+(1<<10)>>Cr)}else Dt>15?Se[Ie]=or+31744:Se[Ie]=or+(Dt+15<<10)+Xt}return Se}function pa(B){return Array.isArray(B)||ee(B)}var cl=function(B){return!(B&B-1)&&!!B},Vu=34467,Mo=3553,Wc=34067,$c=34069,Au=6408,qi=6406,Zl=6407,Zs=6409,Cu=6410,Ef=32854,fl=32855,Yi=36194,ju=32819,lh=32820,Us=33635,ch=34042,fc=6402,hc=34041,Ul=35904,hl=35906,ys=36193,pc=33776,Vl=33777,Gu=33778,dc=33779,jl=35986,ss=35987,Af=34798,vc=35840,Gl=35841,Hu=35842,Hl=35843,Wl=36196,pl=5121,dl=5123,mc=5125,vl=5126,Cf=10242,fh=10243,hh=10497,Da=33071,ph=33648,dh=10240,vh=10241,ml=9728,Uh=9729,_s=9984,Ji=9985,Wu=9986,su=9987,Tu=33170,Si=4352,Qi=4353,Vs=4354,gc=34046,yc=3317,xs=37440,Vh=37441,jh=37443,_c=37444,$u=33984,Mu=[_s,Wu,Ji,su],Oa=[0,Zs,Cu,Zl,Au],Jo={};Jo[Zs]=Jo[qi]=Jo[fc]=1,Jo[hc]=Jo[Cu]=2,Jo[Zl]=Jo[Ul]=3,Jo[Au]=Jo[hl]=4;function uu(B){return"[object "+B+"]"}var Fa=uu("HTMLCanvasElement"),pn=uu("OffscreenCanvas"),No=uu("CanvasRenderingContext2D"),Xc=uu("ImageBitmap"),gl=uu("HTMLImageElement"),bs=uu("HTMLVideoElement"),us=Object.keys(Pa).concat([Fa,pn,No,Xc,gl,bs]),Xu=[];Xu[pl]=1,Xu[vl]=4,Xu[ys]=2,Xu[dl]=2,Xu[mc]=4;var Dr=[];Dr[Ef]=2,Dr[fl]=2,Dr[Yi]=2,Dr[hc]=4,Dr[pc]=.5,Dr[Vl]=.5,Dr[Gu]=1,Dr[dc]=1,Dr[jl]=.5,Dr[ss]=1,Dr[Af]=1,Dr[vc]=.5,Dr[Gl]=.25,Dr[Hu]=.5,Dr[Hl]=.25,Dr[Wl]=.5;function Yc(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function xc(B){if(!Array.isArray(B))return!1;var Se=B.length;return!(Se===0||!pa(B[0]))}function lu(B){return Object.prototype.toString.call(B)}function js(B){return lu(B)===Fa}function Qo(B){return lu(B)===pn}function qc(B){return lu(B)===No}function Kc(B){return lu(B)===Xc}function ls(B){return lu(B)===gl}function cu(B){return lu(B)===bs}function Jc(B){if(!B)return!1;var Se=lu(B);return us.indexOf(Se)>=0?!0:Yc(B)||xc(B)||ga(B)}function $l(B){return Pa[Object.prototype.toString.call(B)]|0}function bc(B,Se){var Ie=Se.length;switch(B.type){case pl:case dl:case mc:case vl:var Nt=re.allocType(B.type,Ie);Nt.set(Se),B.data=Nt;break;case ys:B.data=Hc(Se);break;default:L.raise("unsupported texture type, must specify a typed array")}}function Xl(B,Se){return re.allocType(B.type===ys?vl:B.type,Se)}function Gs(B,Se){B.type===ys?(B.data=Hc(Se),re.freeType(Se)):B.data=Se}function It(B,Se,Ie,Nt,or,Dt){for(var Xt=B.width,Cr=B.height,Mr=B.channels,Or=Xt*Cr*Mr,Pr=Xl(B,Or),Nr=0,$r=0;$r<Cr;++$r)for(var Sr=0;Sr<Xt;++Sr)for(var Zr=0;Zr<Mr;++Zr)Pr[Nr++]=Se[Ie*Sr+Nt*$r+or*Zr+Dt];Gs(B,Pr)}function Ee(B,Se,Ie,Nt,or,Dt){var Xt;if(typeof Dr[B]!="undefined"?Xt=Dr[B]:Xt=Jo[B]*Xu[Se],Dt&&(Xt*=6),or){for(var Cr=0,Mr=Ie;Mr>=1;)Cr+=Xt*Mr*Mr,Mr/=2;return Cr}else return Xt*Ie*Nt}function V(B,Se,Ie,Nt,or,Dt,Xt){var Cr={"don't care":Si,"dont care":Si,nice:Vs,fast:Qi},Mr={repeat:hh,clamp:Da,mirror:ph},Or={nearest:ml,linear:Uh},Pr=z({mipmap:su,"nearest mipmap nearest":_s,"linear mipmap nearest":Ji,"nearest mipmap linear":Wu,"linear mipmap linear":su},Or),Nr={none:0,browser:_c},$r={uint8:pl,rgba4:ju,rgb565:Us,"rgb5 a1":lh},Sr={alpha:qi,luminance:Zs,"luminance alpha":Cu,rgb:Zl,rgba:Au,rgba4:Ef,"rgb5 a1":fl,rgb565:Yi},Zr={};Se.ext_srgb&&(Sr.srgb=Ul,Sr.srgba=hl),Se.oes_texture_float&&($r.float32=$r.float=vl),Se.oes_texture_half_float&&($r.float16=$r["half float"]=ys),Se.webgl_depth_texture&&(z(Sr,{depth:fc,"depth stencil":hc}),z($r,{uint16:dl,uint32:mc,"depth stencil":ch})),Se.webgl_compressed_texture_s3tc&&z(Zr,{"rgb s3tc dxt1":pc,"rgba s3tc dxt1":Vl,"rgba s3tc dxt3":Gu,"rgba s3tc dxt5":dc}),Se.webgl_compressed_texture_atc&&z(Zr,{"rgb atc":jl,"rgba atc explicit alpha":ss,"rgba atc interpolated alpha":Af}),Se.webgl_compressed_texture_pvrtc&&z(Zr,{"rgb pvrtc 4bppv1":vc,"rgb pvrtc 2bppv1":Gl,"rgba pvrtc 4bppv1":Hu,"rgba pvrtc 2bppv1":Hl}),Se.webgl_compressed_texture_etc1&&(Zr["rgb etc1"]=Wl);var wt=Array.prototype.slice.call(B.getParameter(Vu));Object.keys(Zr).forEach(function(Re){var Bt=Zr[Re];wt.indexOf(Bt)>=0&&(Sr[Re]=Bt)});var Gt=Object.keys(Sr);Ie.textureFormats=Gt;var Tr=[];Object.keys(Sr).forEach(function(Re){var Bt=Sr[Re];Tr[Bt]=Re});var Jr=[];Object.keys($r).forEach(function(Re){var Bt=$r[Re];Jr[Bt]=Re});var dr=[];Object.keys(Or).forEach(function(Re){var Bt=Or[Re];dr[Bt]=Re});var rn=[];Object.keys(Pr).forEach(function(Re){var Bt=Pr[Re];rn[Bt]=Re});var _r=[];Object.keys(Mr).forEach(function(Re){var Bt=Mr[Re];_r[Bt]=Re});var Ur=Gt.reduce(function(Re,Bt){var Ot=Sr[Bt];return Ot===Zs||Ot===qi||Ot===Zs||Ot===Cu||Ot===fc||Ot===hc||Se.ext_srgb&&(Ot===Ul||Ot===hl)?Re[Ot]=Ot:Ot===fl||Bt.indexOf("rgba")>=0?Re[Ot]=Au:Re[Ot]=Zl,Re},{});function vr(){this.internalformat=Au,this.format=Au,this.type=pl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=_c,this.width=0,this.height=0,this.channels=0}function Br(Re,Bt){Re.internalformat=Bt.internalformat,Re.format=Bt.format,Re.type=Bt.type,Re.compressed=Bt.compressed,Re.premultiplyAlpha=Bt.premultiplyAlpha,Re.flipY=Bt.flipY,Re.unpackAlignment=Bt.unpackAlignment,Re.colorSpace=Bt.colorSpace,Re.width=Bt.width,Re.height=Bt.height,Re.channels=Bt.channels}function Pn(Re,Bt){if(!(typeof Bt!="object"||!Bt)){if("premultiplyAlpha"in Bt&&(L.type(Bt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Re.premultiplyAlpha=Bt.premultiplyAlpha),"flipY"in Bt&&(L.type(Bt.flipY,"boolean","invalid texture flip"),Re.flipY=Bt.flipY),"alignment"in Bt&&(L.oneOf(Bt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Re.unpackAlignment=Bt.alignment),"colorSpace"in Bt&&(L.parameter(Bt.colorSpace,Nr,"invalid colorSpace"),Re.colorSpace=Nr[Bt.colorSpace]),"type"in Bt){var Ot=Bt.type;L(Se.oes_texture_float||!(Ot==="float"||Ot==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),L(Se.oes_texture_half_float||!(Ot==="half float"||Ot==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),L(Se.webgl_depth_texture||!(Ot==="uint16"||Ot==="uint32"||Ot==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),L.parameter(Ot,$r,"invalid texture type"),Re.type=$r[Ot]}var dn=Re.width,yi=Re.height,Ce=Re.channels,de=!1;"shape"in Bt?(L(Array.isArray(Bt.shape)&&Bt.shape.length>=2,"shape must be an array"),dn=Bt.shape[0],yi=Bt.shape[1],Bt.shape.length===3&&(Ce=Bt.shape[2],L(Ce>0&&Ce<=4,"invalid number of channels"),de=!0),L(dn>=0&&dn<=Ie.maxTextureSize,"invalid width"),L(yi>=0&&yi<=Ie.maxTextureSize,"invalid height")):("radius"in Bt&&(dn=yi=Bt.radius,L(dn>=0&&dn<=Ie.maxTextureSize,"invalid radius")),"width"in Bt&&(dn=Bt.width,L(dn>=0&&dn<=Ie.maxTextureSize,"invalid width")),"height"in Bt&&(yi=Bt.height,L(yi>=0&&yi<=Ie.maxTextureSize,"invalid height")),"channels"in Bt&&(Ce=Bt.channels,L(Ce>0&&Ce<=4,"invalid number of channels"),de=!0)),Re.width=dn|0,Re.height=yi|0,Re.channels=Ce|0;var Xe=!1;if("format"in Bt){var gt=Bt.format;L(Se.webgl_depth_texture||!(gt==="depth"||gt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),L.parameter(gt,Sr,"invalid texture format");var St=Re.internalformat=Sr[gt];Re.format=Ur[St],gt in $r&&("type"in Bt||(Re.type=$r[gt])),gt in Zr&&(Re.compressed=!0),Xe=!0}!de&&Xe?Re.channels=Jo[Re.format]:de&&!Xe?Re.channels!==Oa[Re.format]&&(Re.format=Re.internalformat=Oa[Re.channels]):Xe&&de&&L(Re.channels===Jo[Re.format],"number of channels inconsistent with specified format")}}function zn(Re){B.pixelStorei(xs,Re.flipY),B.pixelStorei(Vh,Re.premultiplyAlpha),B.pixelStorei(jh,Re.colorSpace),B.pixelStorei(yc,Re.unpackAlignment)}function jr(){vr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function ut(Re,Bt){var Ot=null;if(Jc(Bt)?Ot=Bt:Bt&&(L.type(Bt,"object","invalid pixel data type"),Pn(Re,Bt),"x"in Bt&&(Re.xOffset=Bt.x|0),"y"in Bt&&(Re.yOffset=Bt.y|0),Jc(Bt.data)&&(Ot=Bt.data)),L(!Re.compressed||Ot instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Bt.copy){L(!Ot,"can not specify copy and data field for the same texture");var dn=or.viewportWidth,yi=or.viewportHeight;Re.width=Re.width||dn-Re.xOffset,Re.height=Re.height||yi-Re.yOffset,Re.needsCopy=!0,L(Re.xOffset>=0&&Re.xOffset<dn&&Re.yOffset>=0&&Re.yOffset<yi&&Re.width>0&&Re.width<=dn&&Re.height>0&&Re.height<=yi,"copy texture read out of bounds")}else if(!Ot)Re.width=Re.width||1,Re.height=Re.height||1,Re.channels=Re.channels||4;else if(ee(Ot))Re.channels=Re.channels||4,Re.data=Ot,!("type"in Bt)&&Re.type===pl&&(Re.type=$l(Ot));else if(Yc(Ot))Re.channels=Re.channels||4,bc(Re,Ot),Re.alignment=1,Re.needsFree=!0;else if(ga(Ot)){var Ce=Ot.data;!Array.isArray(Ce)&&Re.type===pl&&(Re.type=$l(Ce));var de=Ot.shape,Xe=Ot.stride,gt,St,Qe,qe,ht,Te;de.length===3?(Qe=de[2],Te=Xe[2]):(L(de.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Qe=1,Te=1),gt=de[0],St=de[1],qe=Xe[0],ht=Xe[1],Re.alignment=1,Re.width=gt,Re.height=St,Re.channels=Qe,Re.format=Re.internalformat=Oa[Qe],Re.needsFree=!0,It(Re,Ce,qe,ht,Te,Ot.offset)}else if(js(Ot)||Qo(Ot)||qc(Ot))js(Ot)||Qo(Ot)?Re.element=Ot:Re.element=Ot.canvas,Re.width=Re.element.width,Re.height=Re.element.height,Re.channels=4;else if(Kc(Ot))Re.element=Ot,Re.width=Ot.width,Re.height=Ot.height,Re.channels=4;else if(ls(Ot))Re.element=Ot,Re.width=Ot.naturalWidth,Re.height=Ot.naturalHeight,Re.channels=4;else if(cu(Ot))Re.element=Ot,Re.width=Ot.videoWidth,Re.height=Ot.videoHeight,Re.channels=4;else if(xc(Ot)){var We=Re.width||Ot[0].length,ge=Re.height||Ot.length,vt=Re.channels;pa(Ot[0][0])?vt=vt||Ot[0][0].length:vt=vt||1;for(var At=K.shape(Ot),sr=1,Ft=0;Ft<At.length;++Ft)sr*=At[Ft];var rr=Xl(Re,sr);K.flatten(Ot,At,"",rr),Gs(Re,rr),Re.alignment=1,Re.width=We,Re.height=ge,Re.channels=vt,Re.format=Re.internalformat=Oa[vt],Re.needsFree=!0}Re.type===vl?L(Ie.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Re.type===ys&&L(Ie.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function fr(Re,Bt,Ot){var dn=Re.element,yi=Re.data,Ce=Re.internalformat,de=Re.format,Xe=Re.type,gt=Re.width,St=Re.height;zn(Re),dn?B.texImage2D(Bt,Ot,de,de,Xe,dn):Re.compressed?B.compressedTexImage2D(Bt,Ot,Ce,gt,St,0,yi):Re.needsCopy?(Nt(),B.copyTexImage2D(Bt,Ot,de,Re.xOffset,Re.yOffset,gt,St,0)):B.texImage2D(Bt,Ot,de,gt,St,0,de,Xe,yi||null)}function et(Re,Bt,Ot,dn,yi){var Ce=Re.element,de=Re.data,Xe=Re.internalformat,gt=Re.format,St=Re.type,Qe=Re.width,qe=Re.height;zn(Re),Ce?B.texSubImage2D(Bt,yi,Ot,dn,gt,St,Ce):Re.compressed?B.compressedTexSubImage2D(Bt,yi,Ot,dn,Xe,Qe,qe,de):Re.needsCopy?(Nt(),B.copyTexSubImage2D(Bt,yi,Ot,dn,Re.xOffset,Re.yOffset,Qe,qe)):B.texSubImage2D(Bt,yi,Ot,dn,Qe,qe,gt,St,de)}var Un=[];function bn(){return Un.pop()||new jr}function mi(Re){Re.needsFree&&re.freeType(Re.data),jr.call(Re),Un.push(Re)}function oi(){vr.call(this),this.genMipmaps=!1,this.mipmapHint=Si,this.mipmask=0,this.images=Array(16)}function di(Re,Bt,Ot){var dn=Re.images[0]=bn();Re.mipmask=1,dn.width=Re.width=Bt,dn.height=Re.height=Ot,dn.channels=Re.channels=4}function Ci(Re,Bt){var Ot=null;if(Jc(Bt))Ot=Re.images[0]=bn(),Br(Ot,Re),ut(Ot,Bt),Re.mipmask=1;else if(Pn(Re,Bt),Array.isArray(Bt.mipmap))for(var dn=Bt.mipmap,yi=0;yi<dn.length;++yi)Ot=Re.images[yi]=bn(),Br(Ot,Re),Ot.width>>=yi,Ot.height>>=yi,ut(Ot,dn[yi]),Re.mipmask|=1<<yi;else Ot=Re.images[0]=bn(),Br(Ot,Re),ut(Ot,Bt),Re.mipmask=1;Br(Re,Re.images[0]),Re.compressed&&(Re.internalformat===pc||Re.internalformat===Vl||Re.internalformat===Gu||Re.internalformat===dc)&&L(Re.width%4==0&&Re.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ga(Re,Bt){for(var Ot=Re.images,dn=0;dn<Ot.length;++dn){if(!Ot[dn])return;fr(Ot[dn],Bt,dn)}}var Co=[];function wi(){var Re=Co.pop()||new oi;vr.call(Re),Re.mipmask=0;for(var Bt=0;Bt<16;++Bt)Re.images[Bt]=null;return Re}function ba(Re){for(var Bt=Re.images,Ot=0;Ot<Bt.length;++Ot)Bt[Ot]&&mi(Bt[Ot]),Bt[Ot]=null;Co.push(Re)}function na(){this.minFilter=ml,this.magFilter=ml,this.wrapS=Da,this.wrapT=Da,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Si}function Ha(Re,Bt){if("min"in Bt){var Ot=Bt.min;L.parameter(Ot,Pr),Re.minFilter=Pr[Ot],Mu.indexOf(Re.minFilter)>=0&&!("faces"in Bt)&&(Re.genMipmaps=!0)}if("mag"in Bt){var dn=Bt.mag;L.parameter(dn,Or),Re.magFilter=Or[dn]}var yi=Re.wrapS,Ce=Re.wrapT;if("wrap"in Bt){var de=Bt.wrap;typeof de=="string"?(L.parameter(de,Mr),yi=Ce=Mr[de]):Array.isArray(de)&&(L.parameter(de[0],Mr),L.parameter(de[1],Mr),yi=Mr[de[0]],Ce=Mr[de[1]])}else{if("wrapS"in Bt){var Xe=Bt.wrapS;L.parameter(Xe,Mr),yi=Mr[Xe]}if("wrapT"in Bt){var gt=Bt.wrapT;L.parameter(gt,Mr),Ce=Mr[gt]}}if(Re.wrapS=yi,Re.wrapT=Ce,"anisotropic"in Bt){var St=Bt.anisotropic;L(typeof St=="number"&&St>=1&&St<=Ie.maxAnisotropic,"aniso samples must be between 1 and "),Re.anisotropic=Bt.anisotropic}if("mipmap"in Bt){var Qe=!1;switch(typeof Bt.mipmap){case"string":L.parameter(Bt.mipmap,Cr,"invalid mipmap hint"),Re.mipmapHint=Cr[Bt.mipmap],Re.genMipmaps=!0,Qe=!0;break;case"boolean":Qe=Re.genMipmaps=Bt.mipmap;break;case"object":L(Array.isArray(Bt.mipmap),"invalid mipmap type"),Re.genMipmaps=!1,Qe=!0;break;default:L.raise("invalid mipmap type")}Qe&&!("min"in Bt)&&(Re.minFilter=_s)}}function eo(Re,Bt){B.texParameteri(Bt,vh,Re.minFilter),B.texParameteri(Bt,dh,Re.magFilter),B.texParameteri(Bt,Cf,Re.wrapS),B.texParameteri(Bt,fh,Re.wrapT),Se.ext_texture_filter_anisotropic&&B.texParameteri(Bt,gc,Re.anisotropic),Re.genMipmaps&&(B.hint(Tu,Re.mipmapHint),B.generateMipmap(Bt))}var bo=0,So={},Do=Ie.maxTextureUnits,Wa=Array(Do).map(function(){return null});function pi(Re){vr.call(this),this.mipmask=0,this.internalformat=Au,this.id=bo++,this.refCount=1,this.target=Re,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new na,Xt.profile&&(this.stats={size:0})}function jo(Re){B.activeTexture($u),B.bindTexture(Re.target,Re.texture)}function ji(){var Re=Wa[0];Re?B.bindTexture(Re.target,Re.texture):B.bindTexture(Mo,null)}function Vn(Re){var Bt=Re.texture;L(Bt,"must not double destroy texture");var Ot=Re.unit,dn=Re.target;Ot>=0&&(B.activeTexture($u+Ot),B.bindTexture(dn,null),Wa[Ot]=null),B.deleteTexture(Bt),Re.texture=null,Re.params=null,Re.pixels=null,Re.refCount=0,delete So[Re.id],Dt.textureCount--}z(pi.prototype,{bind:function(){var Re=this;Re.bindCount+=1;var Bt=Re.unit;if(Bt<0){for(var Ot=0;Ot<Do;++Ot){var dn=Wa[Ot];if(dn){if(dn.bindCount>0)continue;dn.unit=-1}Wa[Ot]=Re,Bt=Ot;break}Bt>=Do&&L.raise("insufficient number of texture units"),Xt.profile&&Dt.maxTextureUnits<Bt+1&&(Dt.maxTextureUnits=Bt+1),Re.unit=Bt,B.activeTexture($u+Bt),B.bindTexture(Re.target,Re.texture)}return Bt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Vn(this)}});function Ei(Re,Bt){var Ot=new pi(Mo);So[Ot.id]=Ot,Dt.textureCount++;function dn(de,Xe){var gt=Ot.texInfo;na.call(gt);var St=wi();return typeof de=="number"?typeof Xe=="number"?di(St,de|0,Xe|0):di(St,de|0,de|0):de?(L.type(de,"object","invalid arguments to regl.texture"),Ha(gt,de),Ci(St,de)):di(St,1,1),gt.genMipmaps&&(St.mipmask=(St.width<<1)-1),Ot.mipmask=St.mipmask,Br(Ot,St),L.texture2D(gt,St,Ie),Ot.internalformat=St.internalformat,dn.width=St.width,dn.height=St.height,jo(Ot),Ga(St,Mo),eo(gt,Mo),ji(),ba(St),Xt.profile&&(Ot.stats.size=Ee(Ot.internalformat,Ot.type,St.width,St.height,gt.genMipmaps,!1)),dn.format=Tr[Ot.internalformat],dn.type=Jr[Ot.type],dn.mag=dr[gt.magFilter],dn.min=rn[gt.minFilter],dn.wrapS=_r[gt.wrapS],dn.wrapT=_r[gt.wrapT],dn}function yi(de,Xe,gt,St){L(!!de,"must specify image data");var Qe=Xe|0,qe=gt|0,ht=St|0,Te=bn();return Br(Te,Ot),Te.width=0,Te.height=0,ut(Te,de),Te.width=Te.width||(Ot.width>>ht)-Qe,Te.height=Te.height||(Ot.height>>ht)-qe,L(Ot.type===Te.type&&Ot.format===Te.format&&Ot.internalformat===Te.internalformat,"incompatible format for texture.subimage"),L(Qe>=0&&qe>=0&&Qe+Te.width<=Ot.width&&qe+Te.height<=Ot.height,"texture.subimage write out of bounds"),L(Ot.mipmask&1<<ht,"missing mipmap data"),L(Te.data||Te.element||Te.needsCopy,"missing image data"),jo(Ot),et(Te,Mo,Qe,qe,ht),ji(),mi(Te),dn}function Ce(de,Xe){var gt=de|0,St=Xe|0||gt;if(gt===Ot.width&&St===Ot.height)return dn;dn.width=Ot.width=gt,dn.height=Ot.height=St,jo(Ot);for(var Qe=0;Ot.mipmask>>Qe;++Qe){var qe=gt>>Qe,ht=St>>Qe;if(!qe||!ht)break;B.texImage2D(Mo,Qe,Ot.format,qe,ht,0,Ot.format,Ot.type,null)}return ji(),Xt.profile&&(Ot.stats.size=Ee(Ot.internalformat,Ot.type,gt,St,!1,!1)),dn}return dn(Re,Bt),dn.subimage=yi,dn.resize=Ce,dn._reglType="texture2d",dn._texture=Ot,Xt.profile&&(dn.stats=Ot.stats),dn.destroy=function(){Ot.decRef()},dn}function ki(Re,Bt,Ot,dn,yi,Ce){var de=new pi(Wc);So[de.id]=de,Dt.cubeCount++;var Xe=new Array(6);function gt(qe,ht,Te,We,ge,vt){var At,sr=de.texInfo;for(na.call(sr),At=0;At<6;++At)Xe[At]=wi();if(typeof qe=="number"||!qe){var Ft=qe|0||1;for(At=0;At<6;++At)di(Xe[At],Ft,Ft)}else if(typeof qe=="object")if(ht)Ci(Xe[0],qe),Ci(Xe[1],ht),Ci(Xe[2],Te),Ci(Xe[3],We),Ci(Xe[4],ge),Ci(Xe[5],vt);else if(Ha(sr,qe),Pn(de,qe),"faces"in qe){var rr=qe.faces;for(L(Array.isArray(rr)&&rr.length===6,"cube faces must be a length 6 array"),At=0;At<6;++At)L(typeof rr[At]=="object"&&!!rr[At],"invalid input for cube map face"),Br(Xe[At],de),Ci(Xe[At],rr[At])}else for(At=0;At<6;++At)Ci(Xe[At],qe);else L.raise("invalid arguments to cube map");for(Br(de,Xe[0]),Ie.npotTextureCube||L(cl(de.width)&&cl(de.height),"your browser does not support non power or two texture dimensions"),sr.genMipmaps?de.mipmask=(Xe[0].width<<1)-1:de.mipmask=Xe[0].mipmask,L.textureCube(de,sr,Xe,Ie),de.internalformat=Xe[0].internalformat,gt.width=Xe[0].width,gt.height=Xe[0].height,jo(de),At=0;At<6;++At)Ga(Xe[At],$c+At);for(eo(sr,Wc),ji(),Xt.profile&&(de.stats.size=Ee(de.internalformat,de.type,gt.width,gt.height,sr.genMipmaps,!0)),gt.format=Tr[de.internalformat],gt.type=Jr[de.type],gt.mag=dr[sr.magFilter],gt.min=rn[sr.minFilter],gt.wrapS=_r[sr.wrapS],gt.wrapT=_r[sr.wrapT],At=0;At<6;++At)ba(Xe[At]);return gt}function St(qe,ht,Te,We,ge){L(!!ht,"must specify image data"),L(typeof qe=="number"&&qe===(qe|0)&&qe>=0&&qe<6,"invalid face");var vt=Te|0,At=We|0,sr=ge|0,Ft=bn();return Br(Ft,de),Ft.width=0,Ft.height=0,ut(Ft,ht),Ft.width=Ft.width||(de.width>>sr)-vt,Ft.height=Ft.height||(de.height>>sr)-At,L(de.type===Ft.type&&de.format===Ft.format&&de.internalformat===Ft.internalformat,"incompatible format for texture.subimage"),L(vt>=0&&At>=0&&vt+Ft.width<=de.width&&At+Ft.height<=de.height,"texture.subimage write out of bounds"),L(de.mipmask&1<<sr,"missing mipmap data"),L(Ft.data||Ft.element||Ft.needsCopy,"missing image data"),jo(de),et(Ft,$c+qe,vt,At,sr),ji(),mi(Ft),gt}function Qe(qe){var ht=qe|0;if(ht!==de.width){gt.width=de.width=ht,gt.height=de.height=ht,jo(de);for(var Te=0;Te<6;++Te)for(var We=0;de.mipmask>>We;++We)B.texImage2D($c+Te,We,de.format,ht>>We,ht>>We,0,de.format,de.type,null);return ji(),Xt.profile&&(de.stats.size=Ee(de.internalformat,de.type,gt.width,gt.height,!1,!0)),gt}}return gt(Re,Bt,Ot,dn,yi,Ce),gt.subimage=St,gt.resize=Qe,gt._reglType="textureCube",gt._texture=de,Xt.profile&&(gt.stats=de.stats),gt.destroy=function(){de.decRef()},gt}function $a(){for(var Re=0;Re<Do;++Re)B.activeTexture($u+Re),B.bindTexture(Mo,null),Wa[Re]=null;cr(So).forEach(Vn),Dt.cubeCount=0,Dt.textureCount=0}Xt.profile&&(Dt.getTotalTextureSize=function(){var Re=0;return Object.keys(So).forEach(function(Bt){Re+=So[Bt].stats.size}),Re});function Xs(){for(var Re=0;Re<Do;++Re){var Bt=Wa[Re];Bt&&(Bt.bindCount=0,Bt.unit=-1,Wa[Re]=null)}cr(So).forEach(function(Ot){Ot.texture=B.createTexture(),B.bindTexture(Ot.target,Ot.texture);for(var dn=0;dn<32;++dn)if((Ot.mipmask&1<<dn)!=0)if(Ot.target===Mo)B.texImage2D(Mo,dn,Ot.internalformat,Ot.width>>dn,Ot.height>>dn,0,Ot.internalformat,Ot.type,null);else for(var yi=0;yi<6;++yi)B.texImage2D($c+yi,dn,Ot.internalformat,Ot.width>>dn,Ot.height>>dn,0,Ot.internalformat,Ot.type,null);eo(Ot.texInfo,Ot.target)})}function nl(){for(var Re=0;Re<Do;++Re){var Bt=Wa[Re];Bt&&(Bt.bindCount=0,Bt.unit=-1,Wa[Re]=null),B.activeTexture($u+Re),B.bindTexture(Mo,null),B.bindTexture(Wc,null)}}return{create2D:Ei,createCube:ki,clear:$a,getTexture:function(Re){return null},restore:Xs,refresh:nl}}var go=36161,he=32854,Yu=32855,ya=36194,cs=33189,so=36168,Zo=34041,Ln=35907,_n=34836,qu=34842,ko=34843,qa=[];qa[he]=2,qa[Yu]=2,qa[ya]=2,qa[cs]=2,qa[so]=1,qa[Zo]=4,qa[Ln]=4,qa[_n]=16,qa[qu]=8,qa[ko]=6;function yo(B,Se,Ie){return qa[B]*Se*Ie}var Qs=function(B,Se,Ie,Nt,or){var Dt={rgba4:he,rgb565:ya,"rgb5 a1":Yu,depth:cs,stencil:so,"depth stencil":Zo};Se.ext_srgb&&(Dt.srgba=Ln),Se.ext_color_buffer_half_float&&(Dt.rgba16f=qu,Dt.rgb16f=ko),Se.webgl_color_buffer_float&&(Dt.rgba32f=_n);var Xt=[];Object.keys(Dt).forEach(function(Sr){var Zr=Dt[Sr];Xt[Zr]=Sr});var Cr=0,Mr={};function Or(Sr){this.id=Cr++,this.refCount=1,this.renderbuffer=Sr,this.format=he,this.width=0,this.height=0,or.profile&&(this.stats={size:0})}Or.prototype.decRef=function(){--this.refCount<=0&&Pr(this)};function Pr(Sr){var Zr=Sr.renderbuffer;L(Zr,"must not double destroy renderbuffer"),B.bindRenderbuffer(go,null),B.deleteRenderbuffer(Zr),Sr.renderbuffer=null,Sr.refCount=0,delete Mr[Sr.id],Nt.renderbufferCount--}function Nr(Sr,Zr){var wt=new Or(B.createRenderbuffer());Mr[wt.id]=wt,Nt.renderbufferCount++;function Gt(Jr,dr){var rn=0,_r=0,Ur=he;if(typeof Jr=="object"&&Jr){var vr=Jr;if("shape"in vr){var Br=vr.shape;L(Array.isArray(Br)&&Br.length>=2,"invalid renderbuffer shape"),rn=Br[0]|0,_r=Br[1]|0}else"radius"in vr&&(rn=_r=vr.radius|0),"width"in vr&&(rn=vr.width|0),"height"in vr&&(_r=vr.height|0);"format"in vr&&(L.parameter(vr.format,Dt,"invalid renderbuffer format"),Ur=Dt[vr.format])}else typeof Jr=="number"?(rn=Jr|0,typeof dr=="number"?_r=dr|0:_r=rn):Jr?L.raise("invalid arguments to renderbuffer constructor"):rn=_r=1;if(L(rn>0&&_r>0&&rn<=Ie.maxRenderbufferSize&&_r<=Ie.maxRenderbufferSize,"invalid renderbuffer size"),!(rn===wt.width&&_r===wt.height&&Ur===wt.format))return Gt.width=wt.width=rn,Gt.height=wt.height=_r,wt.format=Ur,B.bindRenderbuffer(go,wt.renderbuffer),B.renderbufferStorage(go,Ur,rn,_r),L(B.getError()===0,"invalid render buffer format"),or.profile&&(wt.stats.size=yo(wt.format,wt.width,wt.height)),Gt.format=Xt[wt.format],Gt}function Tr(Jr,dr){var rn=Jr|0,_r=dr|0||rn;return rn===wt.width&&_r===wt.height||(L(rn>0&&_r>0&&rn<=Ie.maxRenderbufferSize&&_r<=Ie.maxRenderbufferSize,"invalid renderbuffer size"),Gt.width=wt.width=rn,Gt.height=wt.height=_r,B.bindRenderbuffer(go,wt.renderbuffer),B.renderbufferStorage(go,wt.format,rn,_r),L(B.getError()===0,"invalid render buffer format"),or.profile&&(wt.stats.size=yo(wt.format,wt.width,wt.height))),Gt}return Gt(Sr,Zr),Gt.resize=Tr,Gt._reglType="renderbuffer",Gt._renderbuffer=wt,or.profile&&(Gt.stats=wt.stats),Gt.destroy=function(){wt.decRef()},Gt}or.profile&&(Nt.getTotalRenderbufferSize=function(){var Sr=0;return Object.keys(Mr).forEach(function(Zr){Sr+=Mr[Zr].stats.size}),Sr});function $r(){cr(Mr).forEach(function(Sr){Sr.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(go,Sr.renderbuffer),B.renderbufferStorage(go,Sr.format,Sr.width,Sr.height)}),B.bindRenderbuffer(go,null)}return{create:Nr,clear:function(){cr(Mr).forEach(Pr)},restore:$r}},Ss=36160,fu=36161,Di=3553,Ba=34069,Tf=36064,Ku=36096,Qc=36128,hu=33306,Io=36053,yl=36054,eu=36055,ef=36057,Yl=36061,Sc=36193,Mf=5121,ql=5126,Ju=6407,tf=6408,es=6402,Qu=[Ju,tf],_l=[];_l[tf]=4,_l[Ju]=3;var tu=[];tu[Mf]=1,tu[ql]=4,tu[Sc]=2;var Hs=32854,kf=32855,pu=36194,If=33189,Pf=36168,f=34041,d=35907,h=34836,g=34842,w=34843,C=[Hs,kf,pu,d,g,w,h],T={};T[Io]="complete",T[yl]="incomplete attachment",T[ef]="incomplete dimensions",T[eu]="incomplete, missing attachment",T[Yl]="unsupported";function I(B,Se,Ie,Nt,or,Dt){var Xt={cur:null,next:null,dirty:!1,setFBO:null},Cr=["rgba"],Mr=["rgba4","rgb565","rgb5 a1"];Se.ext_srgb&&Mr.push("srgba"),Se.ext_color_buffer_half_float&&Mr.push("rgba16f","rgb16f"),Se.webgl_color_buffer_float&&Mr.push("rgba32f");var Or=["uint8"];Se.oes_texture_half_float&&Or.push("half float","float16"),Se.oes_texture_float&&Or.push("float","float32");function Pr(jr,ut,fr){this.target=jr,this.texture=ut,this.renderbuffer=fr;var et=0,Un=0;ut?(et=ut.width,Un=ut.height):fr&&(et=fr.width,Un=fr.height),this.width=et,this.height=Un}function Nr(jr){jr&&(jr.texture&&jr.texture._texture.decRef(),jr.renderbuffer&&jr.renderbuffer._renderbuffer.decRef())}function $r(jr,ut,fr){if(!!jr)if(jr.texture){var et=jr.texture._texture,Un=Math.max(1,et.width),bn=Math.max(1,et.height);L(Un===ut&&bn===fr,"inconsistent width/height for supplied texture"),et.refCount+=1}else{var mi=jr.renderbuffer._renderbuffer;L(mi.width===ut&&mi.height===fr,"inconsistent width/height for renderbuffer"),mi.refCount+=1}}function Sr(jr,ut){ut&&(ut.texture?B.framebufferTexture2D(Ss,jr,ut.target,ut.texture._texture.texture,0):B.framebufferRenderbuffer(Ss,jr,fu,ut.renderbuffer._renderbuffer.renderbuffer))}function Zr(jr){var ut=Di,fr=null,et=null,Un=jr;typeof jr=="object"&&(Un=jr.data,"target"in jr&&(ut=jr.target|0)),L.type(Un,"function","invalid attachment data");var bn=Un._reglType;return bn==="texture2d"?(fr=Un,L(ut===Di)):bn==="textureCube"?(fr=Un,L(ut>=Ba&&ut<Ba+6,"invalid cube map target")):bn==="renderbuffer"?(et=Un,ut=fu):L.raise("invalid regl object for attachment"),new Pr(ut,fr,et)}function wt(jr,ut,fr,et,Un){if(fr){var bn=Nt.create2D({width:jr,height:ut,format:et,type:Un});return bn._texture.refCount=0,new Pr(Di,bn,null)}else{var mi=or.create({width:jr,height:ut,format:et});return mi._renderbuffer.refCount=0,new Pr(fu,null,mi)}}function Gt(jr){return jr&&(jr.texture||jr.renderbuffer)}function Tr(jr,ut,fr){jr&&(jr.texture?jr.texture.resize(ut,fr):jr.renderbuffer&&jr.renderbuffer.resize(ut,fr),jr.width=ut,jr.height=fr)}var Jr=0,dr={};function rn(){this.id=Jr++,dr[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function _r(jr){jr.colorAttachments.forEach(Nr),Nr(jr.depthAttachment),Nr(jr.stencilAttachment),Nr(jr.depthStencilAttachment)}function Ur(jr){var ut=jr.framebuffer;L(ut,"must not double destroy framebuffer"),B.deleteFramebuffer(ut),jr.framebuffer=null,Dt.framebufferCount--,delete dr[jr.id]}function vr(jr){var ut;B.bindFramebuffer(Ss,jr.framebuffer);var fr=jr.colorAttachments;for(ut=0;ut<fr.length;++ut)Sr(Tf+ut,fr[ut]);for(ut=fr.length;ut<Ie.maxColorAttachments;++ut)B.framebufferTexture2D(Ss,Tf+ut,Di,null,0);B.framebufferTexture2D(Ss,hu,Di,null,0),B.framebufferTexture2D(Ss,Ku,Di,null,0),B.framebufferTexture2D(Ss,Qc,Di,null,0),Sr(Ku,jr.depthAttachment),Sr(Qc,jr.stencilAttachment),Sr(hu,jr.depthStencilAttachment);var et=B.checkFramebufferStatus(Ss);!B.isContextLost()&&et!==Io&&L.raise("framebuffer configuration not supported, status = "+T[et]),B.bindFramebuffer(Ss,Xt.next?Xt.next.framebuffer:null),Xt.cur=Xt.next,B.getError()}function Br(jr,ut){var fr=new rn;Dt.framebufferCount++;function et(bn,mi){var oi;L(Xt.next!==fr,"can not update framebuffer which is currently in use");var di=0,Ci=0,Ga=!0,Co=!0,wi=null,ba=!0,na="rgba",Ha="uint8",eo=1,bo=null,So=null,Do=null,Wa=!1;if(typeof bn=="number")di=bn|0,Ci=mi|0||di;else if(!bn)di=Ci=1;else{L.type(bn,"object","invalid arguments for framebuffer");var pi=bn;if("shape"in pi){var jo=pi.shape;L(Array.isArray(jo)&&jo.length>=2,"invalid shape for framebuffer"),di=jo[0],Ci=jo[1]}else"radius"in pi&&(di=Ci=pi.radius),"width"in pi&&(di=pi.width),"height"in pi&&(Ci=pi.height);("color"in pi||"colors"in pi)&&(wi=pi.color||pi.colors,Array.isArray(wi)&&L(wi.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),wi||("colorCount"in pi&&(eo=pi.colorCount|0,L(eo>0,"invalid color buffer count")),"colorTexture"in pi&&(ba=!!pi.colorTexture,na="rgba4"),"colorType"in pi&&(Ha=pi.colorType,ba?(L(Se.oes_texture_float||!(Ha==="float"||Ha==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),L(Se.oes_texture_half_float||!(Ha==="half float"||Ha==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ha==="half float"||Ha==="float16"?(L(Se.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),na="rgba16f"):(Ha==="float"||Ha==="float32")&&(L(Se.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),na="rgba32f"),L.oneOf(Ha,Or,"invalid color type")),"colorFormat"in pi&&(na=pi.colorFormat,Cr.indexOf(na)>=0?ba=!0:Mr.indexOf(na)>=0?ba=!1:ba?L.oneOf(pi.colorFormat,Cr,"invalid color format for texture"):L.oneOf(pi.colorFormat,Mr,"invalid color format for renderbuffer"))),("depthTexture"in pi||"depthStencilTexture"in pi)&&(Wa=!!(pi.depthTexture||pi.depthStencilTexture),L(!Wa||Se.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in pi&&(typeof pi.depth=="boolean"?Ga=pi.depth:(bo=pi.depth,Co=!1)),"stencil"in pi&&(typeof pi.stencil=="boolean"?Co=pi.stencil:(So=pi.stencil,Ga=!1)),"depthStencil"in pi&&(typeof pi.depthStencil=="boolean"?Ga=Co=pi.depthStencil:(Do=pi.depthStencil,Ga=!1,Co=!1))}var ji=null,Vn=null,Ei=null,ki=null;if(Array.isArray(wi))ji=wi.map(Zr);else if(wi)ji=[Zr(wi)];else for(ji=new Array(eo),oi=0;oi<eo;++oi)ji[oi]=wt(di,Ci,ba,na,Ha);L(Se.webgl_draw_buffers||ji.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),L(ji.length<=Ie.maxColorAttachments,"too many color attachments, not supported"),di=di||ji[0].width,Ci=Ci||ji[0].height,bo?Vn=Zr(bo):Ga&&!Co&&(Vn=wt(di,Ci,Wa,"depth","uint32")),So?Ei=Zr(So):Co&&!Ga&&(Ei=wt(di,Ci,!1,"stencil","uint8")),Do?ki=Zr(Do):!bo&&!So&&Co&&Ga&&(ki=wt(di,Ci,Wa,"depth stencil","depth stencil")),L(!!bo+!!So+!!Do<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var $a=null;for(oi=0;oi<ji.length;++oi)if($r(ji[oi],di,Ci),L(!ji[oi]||ji[oi].texture&&Qu.indexOf(ji[oi].texture._texture.format)>=0||ji[oi].renderbuffer&&C.indexOf(ji[oi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+oi+" is invalid"),ji[oi]&&ji[oi].texture){var Xs=_l[ji[oi].texture._texture.format]*tu[ji[oi].texture._texture.type];$a===null?$a=Xs:L($a===Xs,"all color attachments much have the same number of bits per pixel.")}return $r(Vn,di,Ci),L(!Vn||Vn.texture&&Vn.texture._texture.format===es||Vn.renderbuffer&&Vn.renderbuffer._renderbuffer.format===If,"invalid depth attachment for framebuffer object"),$r(Ei,di,Ci),L(!Ei||Ei.renderbuffer&&Ei.renderbuffer._renderbuffer.format===Pf,"invalid stencil attachment for framebuffer object"),$r(ki,di,Ci),L(!ki||ki.texture&&ki.texture._texture.format===f||ki.renderbuffer&&ki.renderbuffer._renderbuffer.format===f,"invalid depth-stencil attachment for framebuffer object"),_r(fr),fr.width=di,fr.height=Ci,fr.colorAttachments=ji,fr.depthAttachment=Vn,fr.stencilAttachment=Ei,fr.depthStencilAttachment=ki,et.color=ji.map(Gt),et.depth=Gt(Vn),et.stencil=Gt(Ei),et.depthStencil=Gt(ki),et.width=fr.width,et.height=fr.height,vr(fr),et}function Un(bn,mi){L(Xt.next!==fr,"can not resize a framebuffer which is currently in use");var oi=Math.max(bn|0,1),di=Math.max(mi|0||oi,1);if(oi===fr.width&&di===fr.height)return et;for(var Ci=fr.colorAttachments,Ga=0;Ga<Ci.length;++Ga)Tr(Ci[Ga],oi,di);return Tr(fr.depthAttachment,oi,di),Tr(fr.stencilAttachment,oi,di),Tr(fr.depthStencilAttachment,oi,di),fr.width=et.width=oi,fr.height=et.height=di,vr(fr),et}return et(jr,ut),z(et,{resize:Un,_reglType:"framebuffer",_framebuffer:fr,destroy:function(){Ur(fr),_r(fr)},use:function(bn){Xt.setFBO({framebuffer:et},bn)}})}function Pn(jr){var ut=Array(6);function fr(Un){var bn;L(ut.indexOf(Xt.next)<0,"can not update framebuffer which is currently in use");var mi={color:null},oi=0,di=null,Ci="rgba",Ga="uint8",Co=1;if(typeof Un=="number")oi=Un|0;else if(!Un)oi=1;else{L.type(Un,"object","invalid arguments for framebuffer");var wi=Un;if("shape"in wi){var ba=wi.shape;L(Array.isArray(ba)&&ba.length>=2,"invalid shape for framebuffer"),L(ba[0]===ba[1],"cube framebuffer must be square"),oi=ba[0]}else"radius"in wi&&(oi=wi.radius|0),"width"in wi?(oi=wi.width|0,"height"in wi&&L(wi.height===oi,"must be square")):"height"in wi&&(oi=wi.height|0);("color"in wi||"colors"in wi)&&(di=wi.color||wi.colors,Array.isArray(di)&&L(di.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),di||("colorCount"in wi&&(Co=wi.colorCount|0,L(Co>0,"invalid color buffer count")),"colorType"in wi&&(L.oneOf(wi.colorType,Or,"invalid color type"),Ga=wi.colorType),"colorFormat"in wi&&(Ci=wi.colorFormat,L.oneOf(wi.colorFormat,Cr,"invalid color format for texture"))),"depth"in wi&&(mi.depth=wi.depth),"stencil"in wi&&(mi.stencil=wi.stencil),"depthStencil"in wi&&(mi.depthStencil=wi.depthStencil)}var na;if(di)if(Array.isArray(di))for(na=[],bn=0;bn<di.length;++bn)na[bn]=di[bn];else na=[di];else{na=Array(Co);var Ha={radius:oi,format:Ci,type:Ga};for(bn=0;bn<Co;++bn)na[bn]=Nt.createCube(Ha)}for(mi.color=Array(na.length),bn=0;bn<na.length;++bn){var eo=na[bn];L(typeof eo=="function"&&eo._reglType==="textureCube","invalid cube map"),oi=oi||eo.width,L(eo.width===oi&&eo.height===oi,"invalid cube map shape"),mi.color[bn]={target:Ba,data:na[bn]}}for(bn=0;bn<6;++bn){for(var bo=0;bo<na.length;++bo)mi.color[bo].target=Ba+bn;bn>0&&(mi.depth=ut[0].depth,mi.stencil=ut[0].stencil,mi.depthStencil=ut[0].depthStencil),ut[bn]?ut[bn](mi):ut[bn]=Br(mi)}return z(fr,{width:oi,height:oi,color:na})}function et(Un){var bn,mi=Un|0;if(L(mi>0&&mi<=Ie.maxCubeMapSize,"invalid radius for cube fbo"),mi===fr.width)return fr;var oi=fr.color;for(bn=0;bn<oi.length;++bn)oi[bn].resize(mi);for(bn=0;bn<6;++bn)ut[bn].resize(mi);return fr.width=fr.height=mi,fr}return fr(jr),z(fr,{faces:ut,resize:et,_reglType:"framebufferCube",destroy:function(){ut.forEach(function(Un){Un.destroy()})}})}function zn(){Xt.cur=null,Xt.next=null,Xt.dirty=!0,cr(dr).forEach(function(jr){jr.framebuffer=B.createFramebuffer(),vr(jr)})}return z(Xt,{getFramebuffer:function(jr){if(typeof jr=="function"&&jr._reglType==="framebuffer"){var ut=jr._framebuffer;if(ut instanceof rn)return ut}return null},create:Br,createCube:Pn,clear:function(){cr(dr).forEach(Ur)},restore:zn})}var Z=5126,$=34962;function le(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Z,this.offset=0,this.stride=0,this.divisor=0}function ve(B,Se,Ie,Nt,or){for(var Dt=Ie.maxAttributes,Xt=new Array(Dt),Cr=0;Cr<Dt;++Cr)Xt[Cr]=new le;var Mr=0,Or={},Pr={Record:le,scope:{},state:Xt,currentVAO:null,targetVAO:null,restore:$r()?dr:function(){},createVAO:rn,getVAO:Zr,destroyBuffer:Nr,setVAO:$r()?wt:Gt,clear:$r()?Tr:function(){}};function Nr(_r){for(var Ur=0;Ur<Xt.length;++Ur){var vr=Xt[Ur];vr.buffer===_r&&(B.disableVertexAttribArray(Ur),vr.buffer=null)}}function $r(){return Se.oes_vertex_array_object}function Sr(){return Se.angle_instanced_arrays}function Zr(_r){return typeof _r=="function"&&_r._vao?_r._vao:null}function wt(_r){if(_r!==Pr.currentVAO){var Ur=$r();_r?Ur.bindVertexArrayOES(_r.vao):Ur.bindVertexArrayOES(null),Pr.currentVAO=_r}}function Gt(_r){if(_r!==Pr.currentVAO){if(_r)_r.bindAttrs();else for(var Ur=Sr(),vr=0;vr<Xt.length;++vr){var Br=Xt[vr];Br.buffer?(B.enableVertexAttribArray(vr),B.vertexAttribPointer(vr,Br.size,Br.type,Br.normalized,Br.stride,Br.offfset),Ur&&Br.divisor&&Ur.vertexAttribDivisorANGLE(vr,Br.divisor)):(B.disableVertexAttribArray(vr),B.vertexAttrib4f(vr,Br.x,Br.y,Br.z,Br.w))}Pr.currentVAO=_r}}function Tr(){cr(Or).forEach(function(_r){_r.destroy()})}function Jr(){this.id=++Mr,this.attributes=[];var _r=$r();_r?this.vao=_r.createVertexArrayOES():this.vao=null,Or[this.id]=this,this.buffers=[]}Jr.prototype.bindAttrs=function(){for(var _r=Sr(),Ur=this.attributes,vr=0;vr<Ur.length;++vr){var Br=Ur[vr];Br.buffer?(B.enableVertexAttribArray(vr),B.bindBuffer($,Br.buffer.buffer),B.vertexAttribPointer(vr,Br.size,Br.type,Br.normalized,Br.stride,Br.offset),_r&&Br.divisor&&_r.vertexAttribDivisorANGLE(vr,Br.divisor)):(B.disableVertexAttribArray(vr),B.vertexAttrib4f(vr,Br.x,Br.y,Br.z,Br.w))}for(var Pn=Ur.length;Pn<Dt;++Pn)B.disableVertexAttribArray(Pn)},Jr.prototype.refresh=function(){var _r=$r();_r&&(_r.bindVertexArrayOES(this.vao),this.bindAttrs(),Pr.currentVAO=this)},Jr.prototype.destroy=function(){if(this.vao){var _r=$r();this===Pr.currentVAO&&(Pr.currentVAO=null,_r.bindVertexArrayOES(null)),_r.deleteVertexArrayOES(this.vao),this.vao=null}Or[this.id]&&(delete Or[this.id],Nt.vaoCount-=1)};function dr(){var _r=$r();_r&&cr(Or).forEach(function(Ur){Ur.refresh()})}function rn(_r){var Ur=new Jr;Nt.vaoCount+=1;function vr(Br){L(Array.isArray(Br),"arguments to vertex array constructor must be an array"),L(Br.length<Dt,"too many attributes"),L(Br.length>0,"must specify at least one attribute");var Pn={},zn=Ur.attributes;zn.length=Br.length;for(var jr=0;jr<Br.length;++jr){var ut=Br[jr],fr=zn[jr]=new le,et=ut.data||ut;if(Array.isArray(et)||ee(et)||ga(et)){var Un;Ur.buffers[jr]&&(Un=Ur.buffers[jr],ee(et)&&Un._buffer.byteLength>=et.byteLength?Un.subdata(et):(Un.destroy(),Ur.buffers[jr]=null)),Ur.buffers[jr]||(Un=Ur.buffers[jr]=or.create(ut,$,!1,!0)),fr.buffer=or.getBuffer(Un),fr.size=fr.buffer.dimension|0,fr.normalized=!1,fr.type=fr.buffer.dtype,fr.offset=0,fr.stride=0,fr.divisor=0,fr.state=1,Pn[jr]=1}else or.getBuffer(ut)?(fr.buffer=or.getBuffer(ut),fr.size=fr.buffer.dimension|0,fr.normalized=!1,fr.type=fr.buffer.dtype,fr.offset=0,fr.stride=0,fr.divisor=0,fr.state=1):or.getBuffer(ut.buffer)?(fr.buffer=or.getBuffer(ut.buffer),fr.size=(+ut.size||fr.buffer.dimension)|0,fr.normalized=!!ut.normalized||!1,"type"in ut?(L.parameter(ut.type,os,"invalid buffer type"),fr.type=os[ut.type]):fr.type=fr.buffer.dtype,fr.offset=(ut.offset||0)|0,fr.stride=(ut.stride||0)|0,fr.divisor=(ut.divisor||0)|0,fr.state=1,L(fr.size>=1&&fr.size<=4,"size must be between 1 and 4"),L(fr.offset>=0,"invalid offset"),L(fr.stride>=0&&fr.stride<=255,"stride must be between 0 and 255"),L(fr.divisor>=0,"divisor must be positive"),L(!fr.divisor||!!Se.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in ut?(L(jr>0,"first attribute must not be a constant"),fr.x=+ut.x||0,fr.y=+ut.y||0,fr.z=+ut.z||0,fr.w=+ut.w||0,fr.state=2):L(!1,"invalid attribute spec for location "+jr)}for(var bn=0;bn<Ur.buffers.length;++bn)!Pn[bn]&&Ur.buffers[bn]&&(Ur.buffers[bn].destroy(),Ur.buffers[bn]=null);return Ur.refresh(),vr}return vr.destroy=function(){for(var Br=0;Br<Ur.buffers.length;++Br)Ur.buffers[Br]&&Ur.buffers[Br].destroy();Ur.buffers.length=0,Ur.destroy()},vr._vao=Ur,vr._reglType="vao",vr(_r)}return Pr}var xe=35632,ze=35633,Fe=35718,Ye=35721;function Pe(B,Se,Ie,Nt){var or={},Dt={};function Xt(wt,Gt,Tr,Jr){this.name=wt,this.id=Gt,this.location=Tr,this.info=Jr}function Cr(wt,Gt){for(var Tr=0;Tr<wt.length;++Tr)if(wt[Tr].id===Gt.id){wt[Tr].location=Gt.location;return}wt.push(Gt)}function Mr(wt,Gt,Tr){var Jr=wt===xe?or:Dt,dr=Jr[Gt];if(!dr){var rn=Se.str(Gt);dr=B.createShader(wt),B.shaderSource(dr,rn),B.compileShader(dr),L.shaderError(B,dr,rn,wt,Tr),Jr[Gt]=dr}return dr}var Or={},Pr=[],Nr=0;function $r(wt,Gt){this.id=Nr++,this.fragId=wt,this.vertId=Gt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Nt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Sr(wt,Gt,Tr){var Jr,dr,rn=Mr(xe,wt.fragId),_r=Mr(ze,wt.vertId),Ur=wt.program=B.createProgram();if(B.attachShader(Ur,rn),B.attachShader(Ur,_r),Tr)for(Jr=0;Jr<Tr.length;++Jr){var vr=Tr[Jr];B.bindAttribLocation(Ur,vr[0],vr[1])}B.linkProgram(Ur),L.linkError(B,Ur,Se.str(wt.fragId),Se.str(wt.vertId),Gt);var Br=B.getProgramParameter(Ur,Fe);Nt.profile&&(wt.stats.uniformsCount=Br);var Pn=wt.uniforms;for(Jr=0;Jr<Br;++Jr)if(dr=B.getActiveUniform(Ur,Jr),dr)if(dr.size>1)for(var zn=0;zn<dr.size;++zn){var jr=dr.name.replace("[0]","["+zn+"]");Cr(Pn,new Xt(jr,Se.id(jr),B.getUniformLocation(Ur,jr),dr))}else Cr(Pn,new Xt(dr.name,Se.id(dr.name),B.getUniformLocation(Ur,dr.name),dr));var ut=B.getProgramParameter(Ur,Ye);Nt.profile&&(wt.stats.attributesCount=ut);var fr=wt.attributes;for(Jr=0;Jr<ut;++Jr)dr=B.getActiveAttrib(Ur,Jr),dr&&Cr(fr,new Xt(dr.name,Se.id(dr.name),B.getAttribLocation(Ur,dr.name),dr))}Nt.profile&&(Ie.getMaxUniformsCount=function(){var wt=0;return Pr.forEach(function(Gt){Gt.stats.uniformsCount>wt&&(wt=Gt.stats.uniformsCount)}),wt},Ie.getMaxAttributesCount=function(){var wt=0;return Pr.forEach(function(Gt){Gt.stats.attributesCount>wt&&(wt=Gt.stats.attributesCount)}),wt});function Zr(){or={},Dt={};for(var wt=0;wt<Pr.length;++wt)Sr(Pr[wt],null,Pr[wt].attributes.map(function(Gt){return[Gt.location,Gt.name]}))}return{clear:function(){var wt=B.deleteShader.bind(B);cr(or).forEach(wt),or={},cr(Dt).forEach(wt),Dt={},Pr.forEach(function(Gt){B.deleteProgram(Gt.program)}),Pr.length=0,Or={},Ie.shaderCount=0},program:function(wt,Gt,Tr,Jr){L.command(wt>=0,"missing vertex shader",Tr),L.command(Gt>=0,"missing fragment shader",Tr);var dr=Or[Gt];dr||(dr=Or[Gt]={});var rn=dr[wt];if(rn&&(rn.refCount++,!Jr))return rn;var _r=new $r(Gt,wt);return Ie.shaderCount++,Sr(_r,Tr,Jr),rn||(dr[wt]=_r),Pr.push(_r),z(_r,{destroy:function(){if(_r.refCount--,_r.refCount<=0){B.deleteProgram(_r.program);var Ur=Pr.indexOf(_r);Pr.splice(Ur,1),Ie.shaderCount--}dr[_r.vertId].refCount<=0&&(B.deleteShader(Dt[_r.vertId]),delete Dt[_r.vertId],delete Or[_r.fragId][_r.vertId]),Object.keys(Or[_r.fragId]).length||(B.deleteShader(or[_r.fragId]),delete or[_r.fragId],delete Or[_r.fragId])}})},restore:Zr,shader:Mr,frag:-1,vert:-1}}var $e=6408,it=5121,Mt=3333,jt=5126;function Ut(B,Se,Ie,Nt,or,Dt,Xt){function Cr(Pr){var Nr;Se.next===null?(L(or.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Nr=it):(L(Se.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Nr=Se.next.colorAttachments[0].texture._texture.type,Dt.oes_texture_float?(L(Nr===it||Nr===jt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Nr===jt&&L(Xt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):L(Nr===it,"Reading from a framebuffer is only allowed for the type 'uint8'"));var $r=0,Sr=0,Zr=Nt.framebufferWidth,wt=Nt.framebufferHeight,Gt=null;ee(Pr)?Gt=Pr:Pr&&(L.type(Pr,"object","invalid arguments to regl.read()"),$r=Pr.x|0,Sr=Pr.y|0,L($r>=0&&$r<Nt.framebufferWidth,"invalid x offset for regl.read"),L(Sr>=0&&Sr<Nt.framebufferHeight,"invalid y offset for regl.read"),Zr=(Pr.width||Nt.framebufferWidth-$r)|0,wt=(Pr.height||Nt.framebufferHeight-Sr)|0,Gt=Pr.data||null),Gt&&(Nr===it?L(Gt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Nr===jt&&L(Gt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),L(Zr>0&&Zr+$r<=Nt.framebufferWidth,"invalid width for read pixels"),L(wt>0&&wt+Sr<=Nt.framebufferHeight,"invalid height for read pixels"),Ie();var Tr=Zr*wt*4;return Gt||(Nr===it?Gt=new Uint8Array(Tr):Nr===jt&&(Gt=Gt||new Float32Array(Tr))),L.isTypedArray(Gt,"data buffer for regl.read() must be a typedarray"),L(Gt.byteLength>=Tr,"data buffer for regl.read() too small"),B.pixelStorei(Mt,4),B.readPixels($r,Sr,Zr,wt,$e,Nr,Gt),Gt}function Mr(Pr){var Nr;return Se.setFBO({framebuffer:Pr.framebuffer},function(){Nr=Cr(Pr)}),Nr}function Or(Pr){return!Pr||!("framebuffer"in Pr)?Cr(Pr):Mr(Pr)}return Or}function $t(B){return Array.prototype.slice.call(B)}function pr(B){return $t(B).join("")}function zr(){var B=0,Se=[],Ie=[];function Nt(Nr){for(var $r=0;$r<Ie.length;++$r)if(Ie[$r]===Nr)return Se[$r];var Sr="g"+B++;return Se.push(Sr),Ie.push(Nr),Sr}function or(){var Nr=[];function $r(){Nr.push.apply(Nr,$t(arguments))}var Sr=[];function Zr(){var wt="v"+B++;return Sr.push(wt),arguments.length>0&&(Nr.push(wt,"="),Nr.push.apply(Nr,$t(arguments)),Nr.push(";")),wt}return z($r,{def:Zr,toString:function(){return pr([Sr.length>0?"var "+Sr.join(",")+";":"",pr(Nr)])}})}function Dt(){var Nr=or(),$r=or(),Sr=Nr.toString,Zr=$r.toString;function wt(Gt,Tr){$r(Gt,Tr,"=",Nr.def(Gt,Tr),";")}return z(function(){Nr.apply(Nr,$t(arguments))},{def:Nr.def,entry:Nr,exit:$r,save:wt,set:function(Gt,Tr,Jr){wt(Gt,Tr),Nr(Gt,Tr,"=",Jr,";")},toString:function(){return Sr()+Zr()}})}function Xt(){var Nr=pr(arguments),$r=Dt(),Sr=Dt(),Zr=$r.toString,wt=Sr.toString;return z($r,{then:function(){return $r.apply($r,$t(arguments)),this},else:function(){return Sr.apply(Sr,$t(arguments)),this},toString:function(){var Gt=wt();return Gt&&(Gt="else{"+Gt+"}"),pr(["if(",Nr,"){",Zr(),"}",Gt])}})}var Cr=or(),Mr={};function Or(Nr,$r){var Sr=[];function Zr(){var dr="a"+Sr.length;return Sr.push(dr),dr}$r=$r||0;for(var wt=0;wt<$r;++wt)Zr();var Gt=Dt(),Tr=Gt.toString,Jr=Mr[Nr]=z(Gt,{arg:Zr,toString:function(){return pr(["function(",Sr.join(),"){",Tr(),"}"])}});return Jr}function Pr(){var Nr=['"use strict";',Cr,"return {"];Object.keys(Mr).forEach(function(Zr){Nr.push('"',Zr,'":',Mr[Zr].toString(),",")}),Nr.push("}");var $r=pr(Nr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Sr=Function.apply(null,Se.concat($r));return Sr.apply(null,Ie)}return{global:Cr,link:Nt,block:or,proc:Or,scope:Dt,cond:Xt,compile:Pr}}var Rr="xyzw".split(""),an=5121,Tn=1,In=2,On=0,Mi=1,cn=2,Qn=3,ni=4,ei=5,qn=6,ai="dither",Yn="blend.enable",Zn="blend.color",Ka="blend.equation",_a="blend.func",_o="depth.enable",Ja="depth.func",xa="depth.range",za="depth.mask",Uo="colorMask",Vo="cull.enable",el="cull.face",Po="frontFace",ws="lineWidth",Es="polygonOffset.enable",xl="polygonOffset.offset",du="sample.alpha",vu="sample.enable",bl="sample.coverage",Kl="stencil.enable",Ws="stencil.mask",tl="stencil.func",fs="stencil.opFront",Na="stencil.opBack",mu="scissor.enable",ru="scissor.box",ts="viewport",Oi="profile",Ao="framebuffer",Qa="vert",As="frag",ku="elements",$s="primitive",Sl="count",xo="offset",Ir="instances",Cs="vao",wc="Width",Va="Height",Lo=Ao+wc,Aa=Ao+Va,Gh=ts+wc,wl=ts+Va,Ec="drawingBuffer",mh=Ec+wc,bd=Ec+Va,Sd=[_a,Ka,tl,fs,Na,bl,ts,ru,xl],Iu=34962,Hh=34963,Ac=35632,Wh=35633,Jl=3553,gh=34067,wd=2884,Ed=3042,Ad=3024,Cd=2960,Mp=2929,Nv=3089,$h=32823,yh=32926,Zv=32928,Cc=5126,Ql=35664,Ca=35665,Tc=35666,Xh=5124,Mc=35667,rf=35668,rl=35669,_h=35670,Lf=35671,ec=35672,nf=35673,af=35674,of=35675,Pu=35676,sf=35678,kc=35680,Rf=4,Ic=1028,El=1029,gu=2304,Df=2305,Td=32775,Of=32776,Md=519,Lu=7680,Pc=0,Ff=1,Yh=32774,xh=513,Bf=36160,kp=36064,Ru={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ts=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],uf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Du={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Lc={frag:Ac,vert:Wh},Ms={cw:gu,ccw:Df};function lf(B){return Array.isArray(B)||ee(B)||ga(B)}function Ip(B){return B.sort(function(Se,Ie){return Se===ts?-1:Ie===ts?1:Se<Ie?-1:1})}function ks(B,Se,Ie,Nt){this.thisDep=B,this.contextDep=Se,this.propDep=Ie,this.append=Nt}function yu(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function ja(B){return new ks(!1,!1,!1,B)}function hs(B,Se){var Ie=B.type;if(Ie===On){var Nt=B.data.length;return new ks(!0,Nt>=1,Nt>=2,Se)}else if(Ie===ni){var or=B.data;return new ks(or.thisDep,or.contextDep,or.propDep,Se)}else{if(Ie===ei)return new ks(!1,!1,!1,Se);if(Ie===qn){for(var Dt=!1,Xt=!1,Cr=!1,Mr=0;Mr<B.data.length;++Mr){var Or=B.data[Mr];if(Or.type===Mi)Cr=!0;else if(Or.type===cn)Xt=!0;else if(Or.type===Qn)Dt=!0;else if(Or.type===On){Dt=!0;var Pr=Or.data;Pr>=1&&(Xt=!0),Pr>=2&&(Cr=!0)}else Or.type===ni&&(Dt=Dt||Or.data.thisDep,Xt=Xt||Or.data.contextDep,Cr=Cr||Or.data.propDep)}return new ks(Dt,Xt,Cr,Se)}else return new ks(Ie===Qn,Ie===cn,Ie===Mi,Se)}}var qh=new ks(!1,!1,!1,function(){});function Pp(B,Se,Ie,Nt,or,Dt,Xt,Cr,Mr,Or,Pr,Nr,$r,Sr,Zr){var wt=Or.Record,Gt={add:32774,subtract:32778,"reverse subtract":32779};Ie.ext_blend_minmax&&(Gt.min=Td,Gt.max=Of);var Tr=Ie.angle_instanced_arrays,Jr=Ie.webgl_draw_buffers,dr={dirty:!0,profile:Zr.profile},rn={},_r=[],Ur={},vr={};function Br(Ce){return Ce.replace(".","_")}function Pn(Ce,de,Xe){var gt=Br(Ce);_r.push(Ce),rn[gt]=dr[gt]=!!Xe,Ur[gt]=de}function zn(Ce,de,Xe){var gt=Br(Ce);_r.push(Ce),Array.isArray(Xe)?(dr[gt]=Xe.slice(),rn[gt]=Xe.slice()):dr[gt]=rn[gt]=Xe,vr[gt]=de}Pn(ai,Ad),Pn(Yn,Ed),zn(Zn,"blendColor",[0,0,0,0]),zn(Ka,"blendEquationSeparate",[Yh,Yh]),zn(_a,"blendFuncSeparate",[Ff,Pc,Ff,Pc]),Pn(_o,Mp,!0),zn(Ja,"depthFunc",xh),zn(xa,"depthRange",[0,1]),zn(za,"depthMask",!0),zn(Uo,Uo,[!0,!0,!0,!0]),Pn(Vo,wd),zn(el,"cullFace",El),zn(Po,Po,Df),zn(ws,ws,1),Pn(Es,$h),zn(xl,"polygonOffset",[0,0]),Pn(du,yh),Pn(vu,Zv),zn(bl,"sampleCoverage",[1,!1]),Pn(Kl,Cd),zn(Ws,"stencilMask",-1),zn(tl,"stencilFunc",[Md,0,-1]),zn(fs,"stencilOpSeparate",[Ic,Lu,Lu,Lu]),zn(Na,"stencilOpSeparate",[El,Lu,Lu,Lu]),Pn(mu,Nv),zn(ru,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),zn(ts,ts,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var jr={gl:B,context:$r,strings:Se,next:rn,current:dr,draw:Nr,elements:Dt,buffer:or,shader:Pr,attributes:Or.state,vao:Or,uniforms:Mr,framebuffer:Cr,extensions:Ie,timer:Sr,isBufferArgs:lf},ut={primTypes:Ra,compareFuncs:uf,blendFuncs:Ru,blendEquations:Gt,stencilOps:Du,glTypes:os,orientationType:Ms};L.optional(function(){jr.isArrayLike=pa}),Jr&&(ut.backBuffer=[El],ut.drawBuffer=X(Nt.maxDrawbuffers,function(Ce){return Ce===0?[0]:X(Ce,function(de){return kp+de})}));var fr=0;function et(){var Ce=zr(),de=Ce.link,Xe=Ce.global;Ce.id=fr++,Ce.batchId="0";var gt=de(jr),St=Ce.shared={props:"a0"};Object.keys(jr).forEach(function(We){St[We]=Xe.def(gt,".",We)}),L.optional(function(){Ce.CHECK=de(L),Ce.commandStr=L.guessCommand(),Ce.command=de(Ce.commandStr),Ce.assert=function(We,ge,vt){We("if(!(",ge,"))",this.CHECK,".commandRaise(",de(vt),",",this.command,");")},ut.invalidBlendCombinations=Ts});var Qe=Ce.next={},qe=Ce.current={};Object.keys(vr).forEach(function(We){Array.isArray(dr[We])&&(Qe[We]=Xe.def(St.next,".",We),qe[We]=Xe.def(St.current,".",We))});var ht=Ce.constants={};Object.keys(ut).forEach(function(We){ht[We]=Xe.def(JSON.stringify(ut[We]))}),Ce.invoke=function(We,ge){switch(ge.type){case On:var vt=["this",St.context,St.props,Ce.batchId];return We.def(de(ge.data),".call(",vt.slice(0,Math.max(ge.data.length+1,4)),")");case Mi:return We.def(St.props,ge.data);case cn:return We.def(St.context,ge.data);case Qn:return We.def("this",ge.data);case ni:return ge.data.append(Ce,We),ge.data.ref;case ei:return ge.data.toString();case qn:return ge.data.map(function(At){return Ce.invoke(We,At)})}},Ce.attribCache={};var Te={};return Ce.scopeAttrib=function(We){var ge=Se.id(We);if(ge in Te)return Te[ge];var vt=Or.scope[ge];vt||(vt=Or.scope[ge]=new wt);var At=Te[ge]=de(vt);return At},Ce}function Un(Ce){var de=Ce.static,Xe=Ce.dynamic,gt;if(Oi in de){var St=!!de[Oi];gt=ja(function(qe,ht){return St}),gt.enable=St}else if(Oi in Xe){var Qe=Xe[Oi];gt=hs(Qe,function(qe,ht){return qe.invoke(ht,Qe)})}return gt}function bn(Ce,de){var Xe=Ce.static,gt=Ce.dynamic;if(Ao in Xe){var St=Xe[Ao];return St?(St=Cr.getFramebuffer(St),L.command(St,"invalid framebuffer object"),ja(function(qe,ht){var Te=qe.link(St),We=qe.shared;ht.set(We.framebuffer,".next",Te);var ge=We.context;return ht.set(ge,"."+Lo,Te+".width"),ht.set(ge,"."+Aa,Te+".height"),Te})):ja(function(qe,ht){var Te=qe.shared;ht.set(Te.framebuffer,".next","null");var We=Te.context;return ht.set(We,"."+Lo,We+"."+mh),ht.set(We,"."+Aa,We+"."+bd),"null"})}else if(Ao in gt){var Qe=gt[Ao];return hs(Qe,function(qe,ht){var Te=qe.invoke(ht,Qe),We=qe.shared,ge=We.framebuffer,vt=ht.def(ge,".getFramebuffer(",Te,")");L.optional(function(){qe.assert(ht,"!"+Te+"||"+vt,"invalid framebuffer object")}),ht.set(ge,".next",vt);var At=We.context;return ht.set(At,"."+Lo,vt+"?"+vt+".width:"+At+"."+mh),ht.set(At,"."+Aa,vt+"?"+vt+".height:"+At+"."+bd),vt})}else return null}function mi(Ce,de,Xe){var gt=Ce.static,St=Ce.dynamic;function Qe(Te){if(Te in gt){var We=gt[Te];L.commandType(We,"object","invalid "+Te,Xe.commandStr);var ge=!0,vt=We.x|0,At=We.y|0,sr,Ft;return"width"in We?(sr=We.width|0,L.command(sr>=0,"invalid "+Te,Xe.commandStr)):ge=!1,"height"in We?(Ft=We.height|0,L.command(Ft>=0,"invalid "+Te,Xe.commandStr)):ge=!1,new ks(!ge&&de&&de.thisDep,!ge&&de&&de.contextDep,!ge&&de&&de.propDep,function(An,ui){var Sn=An.shared.context,Wn=sr;"width"in We||(Wn=ui.def(Sn,".",Lo,"-",vt));var $n=Ft;return"height"in We||($n=ui.def(Sn,".",Aa,"-",At)),[vt,At,Wn,$n]})}else if(Te in St){var rr=St[Te],kr=hs(rr,function(An,ui){var Sn=An.invoke(ui,rr);L.optional(function(){An.assert(ui,Sn+"&&typeof "+Sn+'==="object"',"invalid "+Te)});var Wn=An.shared.context,$n=ui.def(Sn,".x|0"),Pi=ui.def(Sn,".y|0"),da=ui.def('"width" in ',Sn,"?",Sn,".width|0:","(",Wn,".",Lo,"-",$n,")"),Is=ui.def('"height" in ',Sn,"?",Sn,".height|0:","(",Wn,".",Aa,"-",Pi,")");return L.optional(function(){An.assert(ui,da+">=0&&"+Is+">=0","invalid "+Te)}),[$n,Pi,da,Is]});return de&&(kr.thisDep=kr.thisDep||de.thisDep,kr.contextDep=kr.contextDep||de.contextDep,kr.propDep=kr.propDep||de.propDep),kr}else return de?new ks(de.thisDep,de.contextDep,de.propDep,function(An,ui){var Sn=An.shared.context;return[0,0,ui.def(Sn,".",Lo),ui.def(Sn,".",Aa)]}):null}var qe=Qe(ts);if(qe){var ht=qe;qe=new ks(qe.thisDep,qe.contextDep,qe.propDep,function(Te,We){var ge=ht.append(Te,We),vt=Te.shared.context;return We.set(vt,"."+Gh,ge[2]),We.set(vt,"."+wl,ge[3]),ge})}return{viewport:qe,scissor_box:Qe(ru)}}function oi(Ce,de){var Xe=Ce.static,gt=typeof Xe[As]=="string"&&typeof Xe[Qa]=="string";if(gt){if(Object.keys(de.dynamic).length>0)return null;var St=de.static,Qe=Object.keys(St);if(Qe.length>0&&typeof St[Qe[0]]=="number"){for(var qe=[],ht=0;ht<Qe.length;++ht)L(typeof St[Qe[ht]]=="number","must specify all vertex attribute locations when using vaos"),qe.push([St[Qe[ht]]|0,Qe[ht]]);return qe}}return null}function di(Ce,de,Xe){var gt=Ce.static,St=Ce.dynamic;function Qe(ge){if(ge in gt){var vt=Se.id(gt[ge]);L.optional(function(){Pr.shader(Lc[ge],vt,L.guessCommand())});var At=ja(function(){return vt});return At.id=vt,At}else if(ge in St){var sr=St[ge];return hs(sr,function(Ft,rr){var kr=Ft.invoke(rr,sr),An=rr.def(Ft.shared.strings,".id(",kr,")");return L.optional(function(){rr(Ft.shared.shader,".shader(",Lc[ge],",",An,",",Ft.command,");")}),An})}return null}var qe=Qe(As),ht=Qe(Qa),Te=null,We;return yu(qe)&&yu(ht)?(Te=Pr.program(ht.id,qe.id,null,Xe),We=ja(function(ge,vt){return ge.link(Te)})):We=new ks(qe&&qe.thisDep||ht&&ht.thisDep,qe&&qe.contextDep||ht&&ht.contextDep,qe&&qe.propDep||ht&&ht.propDep,function(ge,vt){var At=ge.shared.shader,sr;qe?sr=qe.append(ge,vt):sr=vt.def(At,".",As);var Ft;ht?Ft=ht.append(ge,vt):Ft=vt.def(At,".",Qa);var rr=At+".program("+Ft+","+sr;return L.optional(function(){rr+=","+ge.command}),vt.def(rr+")")}),{frag:qe,vert:ht,progVar:We,program:Te}}function Ci(Ce,de){var Xe=Ce.static,gt=Ce.dynamic;function St(){if(ku in Xe){var ge=Xe[ku];lf(ge)?ge=Dt.getElements(Dt.create(ge,!0)):ge&&(ge=Dt.getElements(ge),L.command(ge,"invalid elements",de.commandStr));var vt=ja(function(sr,Ft){if(ge){var rr=sr.link(ge);return sr.ELEMENTS=rr,rr}return sr.ELEMENTS=null,null});return vt.value=ge,vt}else if(ku in gt){var At=gt[ku];return hs(At,function(sr,Ft){var rr=sr.shared,kr=rr.isBufferArgs,An=rr.elements,ui=sr.invoke(Ft,At),Sn=Ft.def("null"),Wn=Ft.def(kr,"(",ui,")"),$n=sr.cond(Wn).then(Sn,"=",An,".createStream(",ui,");").else(Sn,"=",An,".getElements(",ui,");");return L.optional(function(){sr.assert($n.else,"!"+ui+"||"+Sn,"invalid elements")}),Ft.entry($n),Ft.exit(sr.cond(Wn).then(An,".destroyStream(",Sn,");")),sr.ELEMENTS=Sn,Sn})}return null}var Qe=St();function qe(){if($s in Xe){var ge=Xe[$s];return L.commandParameter(ge,Ra,"invalid primitve",de.commandStr),ja(function(At,sr){return Ra[ge]})}else if($s in gt){var vt=gt[$s];return hs(vt,function(At,sr){var Ft=At.constants.primTypes,rr=At.invoke(sr,vt);return L.optional(function(){At.assert(sr,rr+" in "+Ft,"invalid primitive, must be one of "+Object.keys(Ra))}),sr.def(Ft,"[",rr,"]")})}else if(Qe)return yu(Qe)?Qe.value?ja(function(At,sr){return sr.def(At.ELEMENTS,".primType")}):ja(function(){return Rf}):new ks(Qe.thisDep,Qe.contextDep,Qe.propDep,function(At,sr){var Ft=At.ELEMENTS;return sr.def(Ft,"?",Ft,".primType:",Rf)});return null}function ht(ge,vt){if(ge in Xe){var At=Xe[ge]|0;return L.command(!vt||At>=0,"invalid "+ge,de.commandStr),ja(function(Ft,rr){return vt&&(Ft.OFFSET=At),At})}else if(ge in gt){var sr=gt[ge];return hs(sr,function(Ft,rr){var kr=Ft.invoke(rr,sr);return vt&&(Ft.OFFSET=kr,L.optional(function(){Ft.assert(rr,kr+">=0","invalid "+ge)})),kr})}else if(vt&&Qe)return ja(function(Ft,rr){return Ft.OFFSET="0",0});return null}var Te=ht(xo,!0);function We(){if(Sl in Xe){var ge=Xe[Sl]|0;return L.command(typeof ge=="number"&&ge>=0,"invalid vertex count",de.commandStr),ja(function(){return ge})}else if(Sl in gt){var vt=gt[Sl];return hs(vt,function(Ft,rr){var kr=Ft.invoke(rr,vt);return L.optional(function(){Ft.assert(rr,"typeof "+kr+'==="number"&&'+kr+">=0&&"+kr+"===("+kr+"|0)","invalid vertex count")}),kr})}else if(Qe)if(yu(Qe)){if(Qe)return Te?new ks(Te.thisDep,Te.contextDep,Te.propDep,function(Ft,rr){var kr=rr.def(Ft.ELEMENTS,".vertCount-",Ft.OFFSET);return L.optional(function(){Ft.assert(rr,kr+">=0","invalid vertex offset/element buffer too small")}),kr}):ja(function(Ft,rr){return rr.def(Ft.ELEMENTS,".vertCount")});var At=ja(function(){return-1});return L.optional(function(){At.MISSING=!0}),At}else{var sr=new ks(Qe.thisDep||Te.thisDep,Qe.contextDep||Te.contextDep,Qe.propDep||Te.propDep,function(Ft,rr){var kr=Ft.ELEMENTS;return Ft.OFFSET?rr.def(kr,"?",kr,".vertCount-",Ft.OFFSET,":-1"):rr.def(kr,"?",kr,".vertCount:-1")});return L.optional(function(){sr.DYNAMIC=!0}),sr}return null}return{elements:Qe,primitive:qe(),count:We(),instances:ht(Ir,!1),offset:Te}}function Ga(Ce,de){var Xe=Ce.static,gt=Ce.dynamic,St={};return _r.forEach(function(Qe){var qe=Br(Qe);function ht(Te,We){if(Qe in Xe){var ge=Te(Xe[Qe]);St[qe]=ja(function(){return ge})}else if(Qe in gt){var vt=gt[Qe];St[qe]=hs(vt,function(At,sr){return We(At,sr,At.invoke(sr,vt))})}}switch(Qe){case Vo:case Yn:case ai:case Kl:case _o:case mu:case Es:case du:case vu:case za:return ht(function(Te){return L.commandType(Te,"boolean",Qe,de.commandStr),Te},function(Te,We,ge){return L.optional(function(){Te.assert(We,"typeof "+ge+'==="boolean"',"invalid flag "+Qe,Te.commandStr)}),ge});case Ja:return ht(function(Te){return L.commandParameter(Te,uf,"invalid "+Qe,de.commandStr),uf[Te]},function(Te,We,ge){var vt=Te.constants.compareFuncs;return L.optional(function(){Te.assert(We,ge+" in "+vt,"invalid "+Qe+", must be one of "+Object.keys(uf))}),We.def(vt,"[",ge,"]")});case xa:return ht(function(Te){return L.command(pa(Te)&&Te.length===2&&typeof Te[0]=="number"&&typeof Te[1]=="number"&&Te[0]<=Te[1],"depth range is 2d array",de.commandStr),Te},function(Te,We,ge){L.optional(function(){Te.assert(We,Te.shared.isArrayLike+"("+ge+")&&"+ge+".length===2&&typeof "+ge+'[0]==="number"&&typeof '+ge+'[1]==="number"&&'+ge+"[0]<="+ge+"[1]","depth range must be a 2d array")});var vt=We.def("+",ge,"[0]"),At=We.def("+",ge,"[1]");return[vt,At]});case _a:return ht(function(Te){L.commandType(Te,"object","blend.func",de.commandStr);var We="srcRGB"in Te?Te.srcRGB:Te.src,ge="srcAlpha"in Te?Te.srcAlpha:Te.src,vt="dstRGB"in Te?Te.dstRGB:Te.dst,At="dstAlpha"in Te?Te.dstAlpha:Te.dst;return L.commandParameter(We,Ru,qe+".srcRGB",de.commandStr),L.commandParameter(ge,Ru,qe+".srcAlpha",de.commandStr),L.commandParameter(vt,Ru,qe+".dstRGB",de.commandStr),L.commandParameter(At,Ru,qe+".dstAlpha",de.commandStr),L.command(Ts.indexOf(We+", "+vt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+We+", "+vt+")",de.commandStr),[Ru[We],Ru[vt],Ru[ge],Ru[At]]},function(Te,We,ge){var vt=Te.constants.blendFuncs;L.optional(function(){Te.assert(We,ge+"&&typeof "+ge+'==="object"',"invalid blend func, must be an object")});function At(Sn,Wn){var $n=We.def('"',Sn,Wn,'" in ',ge,"?",ge,".",Sn,Wn,":",ge,".",Sn);return L.optional(function(){Te.assert(We,$n+" in "+vt,"invalid "+Qe+"."+Sn+Wn+", must be one of "+Object.keys(Ru))}),$n}var sr=At("src","RGB"),Ft=At("dst","RGB");L.optional(function(){var Sn=Te.constants.invalidBlendCombinations;Te.assert(We,Sn+".indexOf("+sr+'+", "+'+Ft+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var rr=We.def(vt,"[",sr,"]"),kr=We.def(vt,"[",At("src","Alpha"),"]"),An=We.def(vt,"[",Ft,"]"),ui=We.def(vt,"[",At("dst","Alpha"),"]");return[rr,An,kr,ui]});case Ka:return ht(function(Te){if(typeof Te=="string")return L.commandParameter(Te,Gt,"invalid "+Qe,de.commandStr),[Gt[Te],Gt[Te]];if(typeof Te=="object")return L.commandParameter(Te.rgb,Gt,Qe+".rgb",de.commandStr),L.commandParameter(Te.alpha,Gt,Qe+".alpha",de.commandStr),[Gt[Te.rgb],Gt[Te.alpha]];L.commandRaise("invalid blend.equation",de.commandStr)},function(Te,We,ge){var vt=Te.constants.blendEquations,At=We.def(),sr=We.def(),Ft=Te.cond("typeof ",ge,'==="string"');return L.optional(function(){function rr(kr,An,ui){Te.assert(kr,ui+" in "+vt,"invalid "+An+", must be one of "+Object.keys(Gt))}rr(Ft.then,Qe,ge),Te.assert(Ft.else,ge+"&&typeof "+ge+'==="object"',"invalid "+Qe),rr(Ft.else,Qe+".rgb",ge+".rgb"),rr(Ft.else,Qe+".alpha",ge+".alpha")}),Ft.then(At,"=",sr,"=",vt,"[",ge,"];"),Ft.else(At,"=",vt,"[",ge,".rgb];",sr,"=",vt,"[",ge,".alpha];"),We(Ft),[At,sr]});case Zn:return ht(function(Te){return L.command(pa(Te)&&Te.length===4,"blend.color must be a 4d array",de.commandStr),X(4,function(We){return+Te[We]})},function(Te,We,ge){return L.optional(function(){Te.assert(We,Te.shared.isArrayLike+"("+ge+")&&"+ge+".length===4","blend.color must be a 4d array")}),X(4,function(vt){return We.def("+",ge,"[",vt,"]")})});case Ws:return ht(function(Te){return L.commandType(Te,"number",qe,de.commandStr),Te|0},function(Te,We,ge){return L.optional(function(){Te.assert(We,"typeof "+ge+'==="number"',"invalid stencil.mask")}),We.def(ge,"|0")});case tl:return ht(function(Te){L.commandType(Te,"object",qe,de.commandStr);var We=Te.cmp||"keep",ge=Te.ref||0,vt="mask"in Te?Te.mask:-1;return L.commandParameter(We,uf,Qe+".cmp",de.commandStr),L.commandType(ge,"number",Qe+".ref",de.commandStr),L.commandType(vt,"number",Qe+".mask",de.commandStr),[uf[We],ge,vt]},function(Te,We,ge){var vt=Te.constants.compareFuncs;L.optional(function(){function rr(){Te.assert(We,Array.prototype.join.call(arguments,""),"invalid stencil.func")}rr(ge+"&&typeof ",ge,'==="object"'),rr('!("cmp" in ',ge,")||(",ge,".cmp in ",vt,")")});var At=We.def('"cmp" in ',ge,"?",vt,"[",ge,".cmp]",":",Lu),sr=We.def(ge,".ref|0"),Ft=We.def('"mask" in ',ge,"?",ge,".mask|0:-1");return[At,sr,Ft]});case fs:case Na:return ht(function(Te){L.commandType(Te,"object",qe,de.commandStr);var We=Te.fail||"keep",ge=Te.zfail||"keep",vt=Te.zpass||"keep";return L.commandParameter(We,Du,Qe+".fail",de.commandStr),L.commandParameter(ge,Du,Qe+".zfail",de.commandStr),L.commandParameter(vt,Du,Qe+".zpass",de.commandStr),[Qe===Na?El:Ic,Du[We],Du[ge],Du[vt]]},function(Te,We,ge){var vt=Te.constants.stencilOps;L.optional(function(){Te.assert(We,ge+"&&typeof "+ge+'==="object"',"invalid "+Qe)});function At(sr){return L.optional(function(){Te.assert(We,'!("'+sr+'" in '+ge+")||("+ge+"."+sr+" in "+vt+")","invalid "+Qe+"."+sr+", must be one of "+Object.keys(Du))}),We.def('"',sr,'" in ',ge,"?",vt,"[",ge,".",sr,"]:",Lu)}return[Qe===Na?El:Ic,At("fail"),At("zfail"),At("zpass")]});case xl:return ht(function(Te){L.commandType(Te,"object",qe,de.commandStr);var We=Te.factor|0,ge=Te.units|0;return L.commandType(We,"number",qe+".factor",de.commandStr),L.commandType(ge,"number",qe+".units",de.commandStr),[We,ge]},function(Te,We,ge){L.optional(function(){Te.assert(We,ge+"&&typeof "+ge+'==="object"',"invalid "+Qe)});var vt=We.def(ge,".factor|0"),At=We.def(ge,".units|0");return[vt,At]});case el:return ht(function(Te){var We=0;return Te==="front"?We=Ic:Te==="back"&&(We=El),L.command(!!We,qe,de.commandStr),We},function(Te,We,ge){return L.optional(function(){Te.assert(We,ge+'==="front"||'+ge+'==="back"',"invalid cull.face")}),We.def(ge,'==="front"?',Ic,":",El)});case ws:return ht(function(Te){return L.command(typeof Te=="number"&&Te>=Nt.lineWidthDims[0]&&Te<=Nt.lineWidthDims[1],"invalid line width, must be a positive number between "+Nt.lineWidthDims[0]+" and "+Nt.lineWidthDims[1],de.commandStr),Te},function(Te,We,ge){return L.optional(function(){Te.assert(We,"typeof "+ge+'==="number"&&'+ge+">="+Nt.lineWidthDims[0]+"&&"+ge+"<="+Nt.lineWidthDims[1],"invalid line width")}),ge});case Po:return ht(function(Te){return L.commandParameter(Te,Ms,qe,de.commandStr),Ms[Te]},function(Te,We,ge){return L.optional(function(){Te.assert(We,ge+'==="cw"||'+ge+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),We.def(ge+'==="cw"?'+gu+":"+Df)});case Uo:return ht(function(Te){return L.command(pa(Te)&&Te.length===4,"color.mask must be length 4 array",de.commandStr),Te.map(function(We){return!!We})},function(Te,We,ge){return L.optional(function(){Te.assert(We,Te.shared.isArrayLike+"("+ge+")&&"+ge+".length===4","invalid color.mask")}),X(4,function(vt){return"!!"+ge+"["+vt+"]"})});case bl:return ht(function(Te){L.command(typeof Te=="object"&&Te,qe,de.commandStr);var We="value"in Te?Te.value:1,ge=!!Te.invert;return L.command(typeof We=="number"&&We>=0&&We<=1,"sample.coverage.value must be a number between 0 and 1",de.commandStr),[We,ge]},function(Te,We,ge){L.optional(function(){Te.assert(We,ge+"&&typeof "+ge+'==="object"',"invalid sample.coverage")});var vt=We.def('"value" in ',ge,"?+",ge,".value:1"),At=We.def("!!",ge,".invert");return[vt,At]})}}),St}function Co(Ce,de){var Xe=Ce.static,gt=Ce.dynamic,St={};return Object.keys(Xe).forEach(function(Qe){var qe=Xe[Qe],ht;if(typeof qe=="number"||typeof qe=="boolean")ht=ja(function(){return qe});else if(typeof qe=="function"){var Te=qe._reglType;Te==="texture2d"||Te==="textureCube"?ht=ja(function(We){return We.link(qe)}):Te==="framebuffer"||Te==="framebufferCube"?(L.command(qe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Qe+'"',de.commandStr),ht=ja(function(We){return We.link(qe.color[0])})):L.commandRaise('invalid data for uniform "'+Qe+'"',de.commandStr)}else pa(qe)?ht=ja(function(We){var ge=We.global.def("[",X(qe.length,function(vt){return L.command(typeof qe[vt]=="number"||typeof qe[vt]=="boolean","invalid uniform "+Qe,We.commandStr),qe[vt]}),"]");return ge}):L.commandRaise('invalid or missing data for uniform "'+Qe+'"',de.commandStr);ht.value=qe,St[Qe]=ht}),Object.keys(gt).forEach(function(Qe){var qe=gt[Qe];St[Qe]=hs(qe,function(ht,Te){return ht.invoke(Te,qe)})}),St}function wi(Ce,de){var Xe=Ce.static,gt=Ce.dynamic,St={};return Object.keys(Xe).forEach(function(Qe){var qe=Xe[Qe],ht=Se.id(Qe),Te=new wt;if(lf(qe))Te.state=Tn,Te.buffer=or.getBuffer(or.create(qe,Iu,!1,!0)),Te.type=0;else{var We=or.getBuffer(qe);if(We)Te.state=Tn,Te.buffer=We,Te.type=0;else if(L.command(typeof qe=="object"&&qe,"invalid data for attribute "+Qe,de.commandStr),"constant"in qe){var ge=qe.constant;Te.buffer="null",Te.state=In,typeof ge=="number"?Te.x=ge:(L.command(pa(ge)&&ge.length>0&&ge.length<=4,"invalid constant for attribute "+Qe,de.commandStr),Rr.forEach(function(An,ui){ui<ge.length&&(Te[An]=ge[ui])}))}else{lf(qe.buffer)?We=or.getBuffer(or.create(qe.buffer,Iu,!1,!0)):We=or.getBuffer(qe.buffer),L.command(!!We,'missing buffer for attribute "'+Qe+'"',de.commandStr);var vt=qe.offset|0;L.command(vt>=0,'invalid offset for attribute "'+Qe+'"',de.commandStr);var At=qe.stride|0;L.command(At>=0&&At<256,'invalid stride for attribute "'+Qe+'", must be integer betweeen [0, 255]',de.commandStr);var sr=qe.size|0;L.command(!("size"in qe)||sr>0&&sr<=4,'invalid size for attribute "'+Qe+'", must be 1,2,3,4',de.commandStr);var Ft=!!qe.normalized,rr=0;"type"in qe&&(L.commandParameter(qe.type,os,"invalid type for attribute "+Qe,de.commandStr),rr=os[qe.type]);var kr=qe.divisor|0;"divisor"in qe&&(L.command(kr===0||Tr,'cannot specify divisor for attribute "'+Qe+'", instancing not supported',de.commandStr),L.command(kr>=0,'invalid divisor for attribute "'+Qe+'"',de.commandStr)),L.optional(function(){var An=de.commandStr,ui=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(qe).forEach(function(Sn){L.command(ui.indexOf(Sn)>=0,'unknown parameter "'+Sn+'" for attribute pointer "'+Qe+'" (valid parameters are '+ui+")",An)})}),Te.buffer=We,Te.state=Tn,Te.size=sr,Te.normalized=Ft,Te.type=rr||We.dtype,Te.offset=vt,Te.stride=At,Te.divisor=kr}}St[Qe]=ja(function(An,ui){var Sn=An.attribCache;if(ht in Sn)return Sn[ht];var Wn={isStream:!1};return Object.keys(Te).forEach(function($n){Wn[$n]=Te[$n]}),Te.buffer&&(Wn.buffer=An.link(Te.buffer),Wn.type=Wn.type||Wn.buffer+".dtype"),Sn[ht]=Wn,Wn})}),Object.keys(gt).forEach(function(Qe){var qe=gt[Qe];function ht(Te,We){var ge=Te.invoke(We,qe),vt=Te.shared,At=Te.constants,sr=vt.isBufferArgs,Ft=vt.buffer;L.optional(function(){Te.assert(We,ge+"&&(typeof "+ge+'==="object"||typeof '+ge+'==="function")&&('+sr+"("+ge+")||"+Ft+".getBuffer("+ge+")||"+Ft+".getBuffer("+ge+".buffer)||"+sr+"("+ge+'.buffer)||("constant" in '+ge+"&&(typeof "+ge+'.constant==="number"||'+vt.isArrayLike+"("+ge+".constant))))",'invalid dynamic attribute "'+Qe+'"')});var rr={isStream:We.def(!1)},kr=new wt;kr.state=Tn,Object.keys(kr).forEach(function(Wn){rr[Wn]=We.def(""+kr[Wn])});var An=rr.buffer,ui=rr.type;We("if(",sr,"(",ge,")){",rr.isStream,"=true;",An,"=",Ft,".createStream(",Iu,",",ge,");",ui,"=",An,".dtype;","}else{",An,"=",Ft,".getBuffer(",ge,");","if(",An,"){",ui,"=",An,".dtype;",'}else if("constant" in ',ge,"){",rr.state,"=",In,";","if(typeof "+ge+'.constant === "number"){',rr[Rr[0]],"=",ge,".constant;",Rr.slice(1).map(function(Wn){return rr[Wn]}).join("="),"=0;","}else{",Rr.map(function(Wn,$n){return rr[Wn]+"="+ge+".constant.length>"+$n+"?"+ge+".constant["+$n+"]:0;"}).join(""),"}}else{","if(",sr,"(",ge,".buffer)){",An,"=",Ft,".createStream(",Iu,",",ge,".buffer);","}else{",An,"=",Ft,".getBuffer(",ge,".buffer);","}",ui,'="type" in ',ge,"?",At.glTypes,"[",ge,".type]:",An,".dtype;",rr.normalized,"=!!",ge,".normalized;");function Sn(Wn){We(rr[Wn],"=",ge,".",Wn,"|0;")}return Sn("size"),Sn("offset"),Sn("stride"),Sn("divisor"),We("}}"),We.exit("if(",rr.isStream,"){",Ft,".destroyStream(",An,");","}"),rr}St[Qe]=hs(qe,ht)}),St}function ba(Ce,de){var Xe=Ce.static,gt=Ce.dynamic;if(Cs in Xe){var St=Xe[Cs];return St!==null&&Or.getVAO(St)===null&&(St=Or.createVAO(St)),ja(function(qe){return qe.link(Or.getVAO(St))})}else if(Cs in gt){var Qe=gt[Cs];return hs(Qe,function(qe,ht){var Te=qe.invoke(ht,Qe);return ht.def(qe.shared.vao+".getVAO("+Te+")")})}return null}function na(Ce){var de=Ce.static,Xe=Ce.dynamic,gt={};return Object.keys(de).forEach(function(St){var Qe=de[St];gt[St]=ja(function(qe,ht){return typeof Qe=="number"||typeof Qe=="boolean"?""+Qe:qe.link(Qe)})}),Object.keys(Xe).forEach(function(St){var Qe=Xe[St];gt[St]=hs(Qe,function(qe,ht){return qe.invoke(ht,Qe)})}),gt}function Ha(Ce,de,Xe,gt,St){var Qe=Ce.static,qe=Ce.dynamic;L.optional(function(){var Sn=[Ao,Qa,As,ku,$s,xo,Sl,Ir,Oi,Cs].concat(_r);function Wn($n){Object.keys($n).forEach(function(Pi){L.command(Sn.indexOf(Pi)>=0,'unknown parameter "'+Pi+'"',St.commandStr)})}Wn(Qe),Wn(qe)});var ht=oi(Ce,de),Te=bn(Ce,St),We=mi(Ce,Te,St),ge=Ci(Ce,St),vt=Ga(Ce,St),At=di(Ce,St,ht);function sr(Sn){var Wn=We[Sn];Wn&&(vt[Sn]=Wn)}sr(ts),sr(Br(ru));var Ft=Object.keys(vt).length>0,rr={framebuffer:Te,draw:ge,shader:At,state:vt,dirty:Ft,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(rr.profile=Un(Ce,St),rr.uniforms=Co(Xe,St),rr.drawVAO=rr.scopeVAO=ba(Ce,St),!rr.drawVAO&&At.program&&!ht&&Ie.angle_instanced_arrays){var kr=!0,An=At.program.attributes.map(function(Sn){var Wn=de.static[Sn];return kr=kr&&!!Wn,Wn});if(kr&&An.length>0){var ui=Or.getVAO(Or.createVAO(An));rr.drawVAO=new ks(null,null,null,function(Sn,Wn){return Sn.link(ui)}),rr.useVAO=!0}}return ht?rr.useVAO=!0:rr.attributes=wi(de,St),rr.context=na(gt,St),rr}function eo(Ce,de,Xe){var gt=Ce.shared,St=gt.context,Qe=Ce.scope();Object.keys(Xe).forEach(function(qe){de.save(St,"."+qe);var ht=Xe[qe],Te=ht.append(Ce,de);Array.isArray(Te)?Qe(St,".",qe,"=[",Te.join(),"];"):Qe(St,".",qe,"=",Te,";")}),de(Qe)}function bo(Ce,de,Xe,gt){var St=Ce.shared,Qe=St.gl,qe=St.framebuffer,ht;Jr&&(ht=de.def(St.extensions,".webgl_draw_buffers"));var Te=Ce.constants,We=Te.drawBuffer,ge=Te.backBuffer,vt;Xe?vt=Xe.append(Ce,de):vt=de.def(qe,".next"),gt||de("if(",vt,"!==",qe,".cur){"),de("if(",vt,"){",Qe,".bindFramebuffer(",Bf,",",vt,".framebuffer);"),Jr&&de(ht,".drawBuffersWEBGL(",We,"[",vt,".colorAttachments.length]);"),de("}else{",Qe,".bindFramebuffer(",Bf,",null);"),Jr&&de(ht,".drawBuffersWEBGL(",ge,");"),de("}",qe,".cur=",vt,";"),gt||de("}")}function So(Ce,de,Xe){var gt=Ce.shared,St=gt.gl,Qe=Ce.current,qe=Ce.next,ht=gt.current,Te=gt.next,We=Ce.cond(ht,".dirty");_r.forEach(function(ge){var vt=Br(ge);if(!(vt in Xe.state)){var At,sr;if(vt in qe){At=qe[vt],sr=Qe[vt];var Ft=X(dr[vt].length,function(kr){return We.def(At,"[",kr,"]")});We(Ce.cond(Ft.map(function(kr,An){return kr+"!=="+sr+"["+An+"]"}).join("||")).then(St,".",vr[vt],"(",Ft,");",Ft.map(function(kr,An){return sr+"["+An+"]="+kr}).join(";"),";"))}else{At=We.def(Te,".",vt);var rr=Ce.cond(At,"!==",ht,".",vt);We(rr),vt in Ur?rr(Ce.cond(At).then(St,".enable(",Ur[vt],");").else(St,".disable(",Ur[vt],");"),ht,".",vt,"=",At,";"):rr(St,".",vr[vt],"(",At,");",ht,".",vt,"=",At,";")}}}),Object.keys(Xe.state).length===0&&We(ht,".dirty=false;"),de(We)}function Do(Ce,de,Xe,gt){var St=Ce.shared,Qe=Ce.current,qe=St.current,ht=St.gl;Ip(Object.keys(Xe)).forEach(function(Te){var We=Xe[Te];if(!(gt&&!gt(We))){var ge=We.append(Ce,de);if(Ur[Te]){var vt=Ur[Te];yu(We)?ge?de(ht,".enable(",vt,");"):de(ht,".disable(",vt,");"):de(Ce.cond(ge).then(ht,".enable(",vt,");").else(ht,".disable(",vt,");")),de(qe,".",Te,"=",ge,";")}else if(pa(ge)){var At=Qe[Te];de(ht,".",vr[Te],"(",ge,");",ge.map(function(sr,Ft){return At+"["+Ft+"]="+sr}).join(";"),";")}else de(ht,".",vr[Te],"(",ge,");",qe,".",Te,"=",ge,";")}})}function Wa(Ce,de){Tr&&(Ce.instancing=de.def(Ce.shared.extensions,".angle_instanced_arrays"))}function pi(Ce,de,Xe,gt,St){var Qe=Ce.shared,qe=Ce.stats,ht=Qe.current,Te=Qe.timer,We=Xe.profile;function ge(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var vt,At;function sr(Sn){vt=de.def(),Sn(vt,"=",ge(),";"),typeof St=="string"?Sn(qe,".count+=",St,";"):Sn(qe,".count++;"),Sr&&(gt?(At=de.def(),Sn(At,"=",Te,".getNumPendingQueries();")):Sn(Te,".beginQuery(",qe,");"))}function Ft(Sn){Sn(qe,".cpuTime+=",ge(),"-",vt,";"),Sr&&(gt?Sn(Te,".pushScopeStats(",At,",",Te,".getNumPendingQueries(),",qe,");"):Sn(Te,".endQuery();"))}function rr(Sn){var Wn=de.def(ht,".profile");de(ht,".profile=",Sn,";"),de.exit(ht,".profile=",Wn,";")}var kr;if(We){if(yu(We)){We.enable?(sr(de),Ft(de.exit),rr("true")):rr("false");return}kr=We.append(Ce,de),rr(kr)}else kr=de.def(ht,".profile");var An=Ce.block();sr(An),de("if(",kr,"){",An,"}");var ui=Ce.block();Ft(ui),de.exit("if(",kr,"){",ui,"}")}function jo(Ce,de,Xe,gt,St){var Qe=Ce.shared;function qe(Te){switch(Te){case Ql:case Mc:case Lf:return 2;case Ca:case rf:case ec:return 3;case Tc:case rl:case nf:return 4;default:return 1}}function ht(Te,We,ge){var vt=Qe.gl,At=de.def(Te,".location"),sr=de.def(Qe.attributes,"[",At,"]"),Ft=ge.state,rr=ge.buffer,kr=[ge.x,ge.y,ge.z,ge.w],An=["buffer","normalized","offset","stride"];function ui(){de("if(!",sr,".buffer){",vt,".enableVertexAttribArray(",At,");}");var Wn=ge.type,$n;if(ge.size?$n=de.def(ge.size,"||",We):$n=We,de("if(",sr,".type!==",Wn,"||",sr,".size!==",$n,"||",An.map(function(da){return sr+"."+da+"!=="+ge[da]}).join("||"),"){",vt,".bindBuffer(",Iu,",",rr,".buffer);",vt,".vertexAttribPointer(",[At,$n,Wn,ge.normalized,ge.stride,ge.offset],");",sr,".type=",Wn,";",sr,".size=",$n,";",An.map(function(da){return sr+"."+da+"="+ge[da]+";"}).join(""),"}"),Tr){var Pi=ge.divisor;de("if(",sr,".divisor!==",Pi,"){",Ce.instancing,".vertexAttribDivisorANGLE(",[At,Pi],");",sr,".divisor=",Pi,";}")}}function Sn(){de("if(",sr,".buffer){",vt,".disableVertexAttribArray(",At,");",sr,".buffer=null;","}if(",Rr.map(function(Wn,$n){return sr+"."+Wn+"!=="+kr[$n]}).join("||"),"){",vt,".vertexAttrib4f(",At,",",kr,");",Rr.map(function(Wn,$n){return sr+"."+Wn+"="+kr[$n]+";"}).join(""),"}")}Ft===Tn?ui():Ft===In?Sn():(de("if(",Ft,"===",Tn,"){"),ui(),de("}else{"),Sn(),de("}"))}gt.forEach(function(Te){var We=Te.name,ge=Xe.attributes[We],vt;if(ge){if(!St(ge))return;vt=ge.append(Ce,de)}else{if(!St(qh))return;var At=Ce.scopeAttrib(We);L.optional(function(){Ce.assert(de,At+".state","missing attribute "+We)}),vt={},Object.keys(new wt).forEach(function(sr){vt[sr]=de.def(At,".",sr)})}ht(Ce.link(Te),qe(Te.info.type),vt)})}function ji(Ce,de,Xe,gt,St){for(var Qe=Ce.shared,qe=Qe.gl,ht,Te=0;Te<gt.length;++Te){var We=gt[Te],ge=We.name,vt=We.info.type,At=Xe.uniforms[ge],sr=Ce.link(We),Ft=sr+".location",rr;if(At){if(!St(At))continue;if(yu(At)){var kr=At.value;if(L.command(kr!==null&&typeof kr!="undefined",'missing uniform "'+ge+'"',Ce.commandStr),vt===sf||vt===kc){L.command(typeof kr=="function"&&(vt===sf&&(kr._reglType==="texture2d"||kr._reglType==="framebuffer")||vt===kc&&(kr._reglType==="textureCube"||kr._reglType==="framebufferCube")),"invalid texture for uniform "+ge,Ce.commandStr);var An=Ce.link(kr._texture||kr.color[0]._texture);de(qe,".uniform1i(",Ft,",",An+".bind());"),de.exit(An,".unbind();")}else if(vt===af||vt===of||vt===Pu){L.optional(function(){L.command(pa(kr),"invalid matrix for uniform "+ge,Ce.commandStr),L.command(vt===af&&kr.length===4||vt===of&&kr.length===9||vt===Pu&&kr.length===16,"invalid length for matrix uniform "+ge,Ce.commandStr)});var ui=Ce.global.def("new Float32Array(["+Array.prototype.slice.call(kr)+"])"),Sn=2;vt===of?Sn=3:vt===Pu&&(Sn=4),de(qe,".uniformMatrix",Sn,"fv(",Ft,",false,",ui,");")}else{switch(vt){case Cc:L.commandType(kr,"number","uniform "+ge,Ce.commandStr),ht="1f";break;case Ql:L.command(pa(kr)&&kr.length===2,"uniform "+ge,Ce.commandStr),ht="2f";break;case Ca:L.command(pa(kr)&&kr.length===3,"uniform "+ge,Ce.commandStr),ht="3f";break;case Tc:L.command(pa(kr)&&kr.length===4,"uniform "+ge,Ce.commandStr),ht="4f";break;case _h:L.commandType(kr,"boolean","uniform "+ge,Ce.commandStr),ht="1i";break;case Xh:L.commandType(kr,"number","uniform "+ge,Ce.commandStr),ht="1i";break;case Lf:L.command(pa(kr)&&kr.length===2,"uniform "+ge,Ce.commandStr),ht="2i";break;case Mc:L.command(pa(kr)&&kr.length===2,"uniform "+ge,Ce.commandStr),ht="2i";break;case ec:L.command(pa(kr)&&kr.length===3,"uniform "+ge,Ce.commandStr),ht="3i";break;case rf:L.command(pa(kr)&&kr.length===3,"uniform "+ge,Ce.commandStr),ht="3i";break;case nf:L.command(pa(kr)&&kr.length===4,"uniform "+ge,Ce.commandStr),ht="4i";break;case rl:L.command(pa(kr)&&kr.length===4,"uniform "+ge,Ce.commandStr),ht="4i";break}de(qe,".uniform",ht,"(",Ft,",",pa(kr)?Array.prototype.slice.call(kr):kr,");")}continue}else rr=At.append(Ce,de)}else{if(!St(qh))continue;rr=de.def(Qe.uniforms,"[",Se.id(ge),"]")}vt===sf?(L(!Array.isArray(rr),"must specify a scalar prop for textures"),de("if(",rr,"&&",rr,'._reglType==="framebuffer"){',rr,"=",rr,".color[0];","}")):vt===kc&&(L(!Array.isArray(rr),"must specify a scalar prop for cube maps"),de("if(",rr,"&&",rr,'._reglType==="framebufferCube"){',rr,"=",rr,".color[0];","}")),L.optional(function(){function Is(nu,Uf){Ce.assert(de,nu,'bad data or missing for uniform "'+ge+'".  '+Uf)}function Rc(nu){L(!Array.isArray(rr),"must not specify an array type for uniform"),Is("typeof "+rr+'==="'+nu+'"',"invalid type, expected "+nu)}function Ps(nu,Uf){Array.isArray(rr)?L(rr.length===nu,"must have length "+nu):Is(Qe.isArrayLike+"("+rr+")&&"+rr+".length==="+nu,"invalid vector, should have length "+nu,Ce.commandStr)}function Zf(nu){L(!Array.isArray(rr),"must not specify a value type"),Is("typeof "+rr+'==="function"&&'+rr+'._reglType==="texture'+(nu===Jl?"2d":"Cube")+'"',"invalid texture type",Ce.commandStr)}switch(vt){case Xh:Rc("number");break;case Mc:Ps(2,"number");break;case rf:Ps(3,"number");break;case rl:Ps(4,"number");break;case Cc:Rc("number");break;case Ql:Ps(2,"number");break;case Ca:Ps(3,"number");break;case Tc:Ps(4,"number");break;case _h:Rc("boolean");break;case Lf:Ps(2,"boolean");break;case ec:Ps(3,"boolean");break;case nf:Ps(4,"boolean");break;case af:Ps(4,"number");break;case of:Ps(9,"number");break;case Pu:Ps(16,"number");break;case sf:Zf(Jl);break;case kc:Zf(gh);break}});var Wn=1;switch(vt){case sf:case kc:var $n=de.def(rr,"._texture");de(qe,".uniform1i(",Ft,",",$n,".bind());"),de.exit($n,".unbind();");continue;case Xh:case _h:ht="1i";break;case Mc:case Lf:ht="2i",Wn=2;break;case rf:case ec:ht="3i",Wn=3;break;case rl:case nf:ht="4i",Wn=4;break;case Cc:ht="1f";break;case Ql:ht="2f",Wn=2;break;case Ca:ht="3f",Wn=3;break;case Tc:ht="4f",Wn=4;break;case af:ht="Matrix2fv";break;case of:ht="Matrix3fv";break;case Pu:ht="Matrix4fv";break}if(de(qe,".uniform",ht,"(",Ft,","),ht.charAt(0)==="M"){var Pi=Math.pow(vt-af+2,2),da=Ce.global.def("new Float32Array(",Pi,")");Array.isArray(rr)?de("false,(",X(Pi,function(Is){return da+"["+Is+"]="+rr[Is]}),",",da,")"):de("false,(Array.isArray(",rr,")||",rr," instanceof Float32Array)?",rr,":(",X(Pi,function(Is){return da+"["+Is+"]="+rr+"["+Is+"]"}),",",da,")")}else Wn>1?de(X(Wn,function(Is){return Array.isArray(rr)?rr[Is]:rr+"["+Is+"]"})):(L(!Array.isArray(rr),"uniform value must not be an array"),de(rr));de(");")}}function Vn(Ce,de,Xe,gt){var St=Ce.shared,Qe=St.gl,qe=St.draw,ht=gt.draw;function Te(){var $n=ht.elements,Pi,da=de;return $n?(($n.contextDep&&gt.contextDynamic||$n.propDep)&&(da=Xe),Pi=$n.append(Ce,da)):Pi=da.def(qe,".",ku),Pi&&da("if("+Pi+")"+Qe+".bindBuffer("+Hh+","+Pi+".buffer.buffer);"),Pi}function We(){var $n=ht.count,Pi,da=de;return $n?(($n.contextDep&&gt.contextDynamic||$n.propDep)&&(da=Xe),Pi=$n.append(Ce,da),L.optional(function(){$n.MISSING&&Ce.assert(de,"false","missing vertex count"),$n.DYNAMIC&&Ce.assert(da,Pi+">=0","missing vertex count")})):(Pi=da.def(qe,".",Sl),L.optional(function(){Ce.assert(da,Pi+">=0","missing vertex count")})),Pi}var ge=Te();function vt($n){var Pi=ht[$n];return Pi?Pi.contextDep&&gt.contextDynamic||Pi.propDep?Pi.append(Ce,Xe):Pi.append(Ce,de):de.def(qe,".",$n)}var At=vt($s),sr=vt(xo),Ft=We();if(typeof Ft=="number"){if(Ft===0)return}else Xe("if(",Ft,"){"),Xe.exit("}");var rr,kr;Tr&&(rr=vt(Ir),kr=Ce.instancing);var An=ge+".type",ui=ht.elements&&yu(ht.elements);function Sn(){function $n(){Xe(kr,".drawElementsInstancedANGLE(",[At,Ft,An,sr+"<<(("+An+"-"+an+")>>1)",rr],");")}function Pi(){Xe(kr,".drawArraysInstancedANGLE(",[At,sr,Ft,rr],");")}ge?ui?$n():(Xe("if(",ge,"){"),$n(),Xe("}else{"),Pi(),Xe("}")):Pi()}function Wn(){function $n(){Xe(Qe+".drawElements("+[At,Ft,An,sr+"<<(("+An+"-"+an+")>>1)"]+");")}function Pi(){Xe(Qe+".drawArrays("+[At,sr,Ft]+");")}ge?ui?$n():(Xe("if(",ge,"){"),$n(),Xe("}else{"),Pi(),Xe("}")):Pi()}Tr&&(typeof rr!="number"||rr>=0)?typeof rr=="string"?(Xe("if(",rr,">0){"),Sn(),Xe("}else if(",rr,"<0){"),Wn(),Xe("}")):Sn():Wn()}function Ei(Ce,de,Xe,gt,St){var Qe=et(),qe=Qe.proc("body",St);return L.optional(function(){Qe.commandStr=de.commandStr,Qe.command=Qe.link(de.commandStr)}),Tr&&(Qe.instancing=qe.def(Qe.shared.extensions,".angle_instanced_arrays")),Ce(Qe,qe,Xe,gt),Qe.compile().body}function ki(Ce,de,Xe,gt){Wa(Ce,de),Xe.useVAO?Xe.drawVAO?de(Ce.shared.vao,".setVAO(",Xe.drawVAO.append(Ce,de),");"):de(Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"):(de(Ce.shared.vao,".setVAO(null);"),jo(Ce,de,Xe,gt.attributes,function(){return!0})),ji(Ce,de,Xe,gt.uniforms,function(){return!0}),Vn(Ce,de,de,Xe)}function $a(Ce,de){var Xe=Ce.proc("draw",1);Wa(Ce,Xe),eo(Ce,Xe,de.context),bo(Ce,Xe,de.framebuffer),So(Ce,Xe,de),Do(Ce,Xe,de.state),pi(Ce,Xe,de,!1,!0);var gt=de.shader.progVar.append(Ce,Xe);if(Xe(Ce.shared.gl,".useProgram(",gt,".program);"),de.shader.program)ki(Ce,Xe,de,de.shader.program);else{Xe(Ce.shared.vao,".setVAO(null);");var St=Ce.global.def("{}"),Qe=Xe.def(gt,".id"),qe=Xe.def(St,"[",Qe,"]");Xe(Ce.cond(qe).then(qe,".call(this,a0);").else(qe,"=",St,"[",Qe,"]=",Ce.link(function(ht){return Ei(ki,Ce,de,ht,1)}),"(",gt,");",qe,".call(this,a0);"))}Object.keys(de.state).length>0&&Xe(Ce.shared.current,".dirty=true;")}function Xs(Ce,de,Xe,gt){Ce.batchId="a1",Wa(Ce,de);function St(){return!0}jo(Ce,de,Xe,gt.attributes,St),ji(Ce,de,Xe,gt.uniforms,St),Vn(Ce,de,de,Xe)}function nl(Ce,de,Xe,gt){Wa(Ce,de);var St=Xe.contextDep,Qe=de.def(),qe="a0",ht="a1",Te=de.def();Ce.shared.props=Te,Ce.batchId=Qe;var We=Ce.scope(),ge=Ce.scope();de(We.entry,"for(",Qe,"=0;",Qe,"<",ht,";++",Qe,"){",Te,"=",qe,"[",Qe,"];",ge,"}",We.exit);function vt(An){return An.contextDep&&St||An.propDep}function At(An){return!vt(An)}if(Xe.needsContext&&eo(Ce,ge,Xe.context),Xe.needsFramebuffer&&bo(Ce,ge,Xe.framebuffer),Do(Ce,ge,Xe.state,vt),Xe.profile&&vt(Xe.profile)&&pi(Ce,ge,Xe,!1,!0),gt)Xe.useVAO?Xe.drawVAO?vt(Xe.drawVAO)?ge(Ce.shared.vao,".setVAO(",Xe.drawVAO.append(Ce,ge),");"):We(Ce.shared.vao,".setVAO(",Xe.drawVAO.append(Ce,We),");"):We(Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"):(We(Ce.shared.vao,".setVAO(null);"),jo(Ce,We,Xe,gt.attributes,At),jo(Ce,ge,Xe,gt.attributes,vt)),ji(Ce,We,Xe,gt.uniforms,At),ji(Ce,ge,Xe,gt.uniforms,vt),Vn(Ce,We,ge,Xe);else{var sr=Ce.global.def("{}"),Ft=Xe.shader.progVar.append(Ce,ge),rr=ge.def(Ft,".id"),kr=ge.def(sr,"[",rr,"]");ge(Ce.shared.gl,".useProgram(",Ft,".program);","if(!",kr,"){",kr,"=",sr,"[",rr,"]=",Ce.link(function(An){return Ei(Xs,Ce,Xe,An,2)}),"(",Ft,");}",kr,".call(this,a0[",Qe,"],",Qe,");")}}function Re(Ce,de){var Xe=Ce.proc("batch",2);Ce.batchId="0",Wa(Ce,Xe);var gt=!1,St=!0;Object.keys(de.context).forEach(function(sr){gt=gt||de.context[sr].propDep}),gt||(eo(Ce,Xe,de.context),St=!1);var Qe=de.framebuffer,qe=!1;Qe?(Qe.propDep?gt=qe=!0:Qe.contextDep&&gt&&(qe=!0),qe||bo(Ce,Xe,Qe)):bo(Ce,Xe,null),de.state.viewport&&de.state.viewport.propDep&&(gt=!0);function ht(sr){return sr.contextDep&&gt||sr.propDep}So(Ce,Xe,de),Do(Ce,Xe,de.state,function(sr){return!ht(sr)}),(!de.profile||!ht(de.profile))&&pi(Ce,Xe,de,!1,"a1"),de.contextDep=gt,de.needsContext=St,de.needsFramebuffer=qe;var Te=de.shader.progVar;if(Te.contextDep&&gt||Te.propDep)nl(Ce,Xe,de,null);else{var We=Te.append(Ce,Xe);if(Xe(Ce.shared.gl,".useProgram(",We,".program);"),de.shader.program)nl(Ce,Xe,de,de.shader.program);else{Xe(Ce.shared.vao,".setVAO(null);");var ge=Ce.global.def("{}"),vt=Xe.def(We,".id"),At=Xe.def(ge,"[",vt,"]");Xe(Ce.cond(At).then(At,".call(this,a0,a1);").else(At,"=",ge,"[",vt,"]=",Ce.link(function(sr){return Ei(nl,Ce,de,sr,2)}),"(",We,");",At,".call(this,a0,a1);"))}}Object.keys(de.state).length>0&&Xe(Ce.shared.current,".dirty=true;")}function Bt(Ce,de){var Xe=Ce.proc("scope",3);Ce.batchId="a2";var gt=Ce.shared,St=gt.current;eo(Ce,Xe,de.context),de.framebuffer&&de.framebuffer.append(Ce,Xe),Ip(Object.keys(de.state)).forEach(function(qe){var ht=de.state[qe],Te=ht.append(Ce,Xe);pa(Te)?Te.forEach(function(We,ge){Xe.set(Ce.next[qe],"["+ge+"]",We)}):Xe.set(gt.next,"."+qe,Te)}),pi(Ce,Xe,de,!0,!0),[ku,xo,Sl,Ir,$s].forEach(function(qe){var ht=de.draw[qe];!ht||Xe.set(gt.draw,"."+qe,""+ht.append(Ce,Xe))}),Object.keys(de.uniforms).forEach(function(qe){var ht=de.uniforms[qe].append(Ce,Xe);Array.isArray(ht)&&(ht="["+ht.join()+"]"),Xe.set(gt.uniforms,"["+Se.id(qe)+"]",ht)}),Object.keys(de.attributes).forEach(function(qe){var ht=de.attributes[qe].append(Ce,Xe),Te=Ce.scopeAttrib(qe);Object.keys(new wt).forEach(function(We){Xe.set(Te,"."+We,ht[We])})}),de.scopeVAO&&Xe.set(gt.vao,".targetVAO",de.scopeVAO.append(Ce,Xe));function Qe(qe){var ht=de.shader[qe];ht&&Xe.set(gt.shader,"."+qe,ht.append(Ce,Xe))}Qe(Qa),Qe(As),Object.keys(de.state).length>0&&(Xe(St,".dirty=true;"),Xe.exit(St,".dirty=true;")),Xe("a1(",Ce.shared.context,",a0,",Ce.batchId,");")}function Ot(Ce){if(!(typeof Ce!="object"||pa(Ce))){for(var de=Object.keys(Ce),Xe=0;Xe<de.length;++Xe)if(mn.isDynamic(Ce[de[Xe]]))return!0;return!1}}function dn(Ce,de,Xe){var gt=de.static[Xe];if(!gt||!Ot(gt))return;var St=Ce.global,Qe=Object.keys(gt),qe=!1,ht=!1,Te=!1,We=Ce.global.def("{}");Qe.forEach(function(vt){var At=gt[vt];if(mn.isDynamic(At)){typeof At=="function"&&(At=gt[vt]=mn.unbox(At));var sr=hs(At,null);qe=qe||sr.thisDep,Te=Te||sr.propDep,ht=ht||sr.contextDep}else{switch(St(We,".",vt,"="),typeof At){case"number":St(At);break;case"string":St('"',At,'"');break;case"object":Array.isArray(At)&&St("[",At.join(),"]");break;default:St(Ce.link(At));break}St(";")}});function ge(vt,At){Qe.forEach(function(sr){var Ft=gt[sr];if(!!mn.isDynamic(Ft)){var rr=vt.invoke(At,Ft);At(We,".",sr,"=",rr,";")}})}de.dynamic[Xe]=new mn.DynamicVariable(ni,{thisDep:qe,contextDep:ht,propDep:Te,ref:We,append:ge}),delete de.static[Xe]}function yi(Ce,de,Xe,gt,St){var Qe=et();Qe.stats=Qe.link(St),Object.keys(de.static).forEach(function(ht){dn(Qe,de,ht)}),Sd.forEach(function(ht){dn(Qe,Ce,ht)});var qe=Ha(Ce,de,Xe,gt,Qe);return $a(Qe,qe),Bt(Qe,qe),Re(Qe,qe),z(Qe.compile(),{destroy:function(){qe.shader.program.destroy()}})}return{next:rn,current:dr,procs:function(){var Ce=et(),de=Ce.proc("poll"),Xe=Ce.proc("refresh"),gt=Ce.block();de(gt),Xe(gt);var St=Ce.shared,Qe=St.gl,qe=St.next,ht=St.current;gt(ht,".dirty=false;"),bo(Ce,de),bo(Ce,Xe,null,!0);var Te;Tr&&(Te=Ce.link(Tr)),Ie.oes_vertex_array_object&&Xe(Ce.link(Ie.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var We=0;We<Nt.maxAttributes;++We){var ge=Xe.def(St.attributes,"[",We,"]"),vt=Ce.cond(ge,".buffer");vt.then(Qe,".enableVertexAttribArray(",We,");",Qe,".bindBuffer(",Iu,",",ge,".buffer.buffer);",Qe,".vertexAttribPointer(",We,",",ge,".size,",ge,".type,",ge,".normalized,",ge,".stride,",ge,".offset);").else(Qe,".disableVertexAttribArray(",We,");",Qe,".vertexAttrib4f(",We,",",ge,".x,",ge,".y,",ge,".z,",ge,".w);",ge,".buffer=null;"),Xe(vt),Tr&&Xe(Te,".vertexAttribDivisorANGLE(",We,",",ge,".divisor);")}return Xe(Ce.shared.vao,".currentVAO=null;",Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"),Object.keys(Ur).forEach(function(At){var sr=Ur[At],Ft=gt.def(qe,".",At),rr=Ce.block();rr("if(",Ft,"){",Qe,".enable(",sr,")}else{",Qe,".disable(",sr,")}",ht,".",At,"=",Ft,";"),Xe(rr),de("if(",Ft,"!==",ht,".",At,"){",rr,"}")}),Object.keys(vr).forEach(function(At){var sr=vr[At],Ft=dr[At],rr,kr,An=Ce.block();if(An(Qe,".",sr,"("),pa(Ft)){var ui=Ft.length;rr=Ce.global.def(qe,".",At),kr=Ce.global.def(ht,".",At),An(X(ui,function(Sn){return rr+"["+Sn+"]"}),");",X(ui,function(Sn){return kr+"["+Sn+"]="+rr+"["+Sn+"];"}).join("")),de("if(",X(ui,function(Sn){return rr+"["+Sn+"]!=="+kr+"["+Sn+"]"}).join("||"),"){",An,"}")}else rr=gt.def(qe,".",At),kr=gt.def(ht,".",At),An(rr,");",ht,".",At,"=",rr,";"),de("if(",rr,"!==",kr,"){",An,"}");Xe(An)}),Ce.compile()}(),compile:yi}}function kd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Lp=34918,Ro=34919,Rp=35007,Dp=function(B,Se){if(!Se.ext_disjoint_timer_query)return null;var Ie=[];function Nt(){return Ie.pop()||Se.ext_disjoint_timer_query.createQueryEXT()}function or(Tr){Ie.push(Tr)}var Dt=[];function Xt(Tr){var Jr=Nt();Se.ext_disjoint_timer_query.beginQueryEXT(Rp,Jr),Dt.push(Jr),Sr(Dt.length-1,Dt.length,Tr)}function Cr(){Se.ext_disjoint_timer_query.endQueryEXT(Rp)}function Mr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Or=[];function Pr(){return Or.pop()||new Mr}function Nr(Tr){Or.push(Tr)}var $r=[];function Sr(Tr,Jr,dr){var rn=Pr();rn.startQueryIndex=Tr,rn.endQueryIndex=Jr,rn.sum=0,rn.stats=dr,$r.push(rn)}var Zr=[],wt=[];function Gt(){var Tr,Jr,dr=Dt.length;if(dr!==0){wt.length=Math.max(wt.length,dr+1),Zr.length=Math.max(Zr.length,dr+1),Zr[0]=0,wt[0]=0;var rn=0;for(Tr=0,Jr=0;Jr<Dt.length;++Jr){var _r=Dt[Jr];Se.ext_disjoint_timer_query.getQueryObjectEXT(_r,Ro)?(rn+=Se.ext_disjoint_timer_query.getQueryObjectEXT(_r,Lp),or(_r)):Dt[Tr++]=_r,Zr[Jr+1]=rn,wt[Jr+1]=Tr}for(Dt.length=Tr,Tr=0,Jr=0;Jr<$r.length;++Jr){var Ur=$r[Jr],vr=Ur.startQueryIndex,Br=Ur.endQueryIndex;Ur.sum+=Zr[Br]-Zr[vr];var Pn=wt[vr],zn=wt[Br];zn===Pn?(Ur.stats.gpuTime+=Ur.sum/1e6,Nr(Ur)):(Ur.startQueryIndex=Pn,Ur.endQueryIndex=zn,$r[Tr++]=Ur)}$r.length=Tr}}return{beginQuery:Xt,endQuery:Cr,pushScopeStats:Sr,update:Gt,getNumPendingQueries:function(){return Dt.length},clear:function(){Ie.push.apply(Ie,Dt);for(var Tr=0;Tr<Ie.length;Tr++)Se.ext_disjoint_timer_query.deleteQueryEXT(Ie[Tr]);Dt.length=0,Ie.length=0},restore:function(){Dt.length=0,Ie.length=0}}},zf=16384,Kh=256,Op=1024,Nf=34962,Fp="webglcontextlost",Bp="webglcontextrestored",Jh=1,Id=2,Pd=3;function cf(B,Se){for(var Ie=0;Ie<B.length;++Ie)if(B[Ie]===Se)return Ie;return-1}function zp(B){var Se=Xi(B);if(!Se)return null;var Ie=Se.gl,Nt=Ie.getContextAttributes(),or=Ie.isContextLost(),Dt=G(Ie,Se);if(!Dt)return null;var Xt=xn(),Cr=kd(),Mr=Dt.extensions,Or=Dp(Ie,Mr),Pr=gn(),Nr=Ie.drawingBufferWidth,$r=Ie.drawingBufferHeight,Sr={tick:0,time:0,viewportWidth:Nr,viewportHeight:$r,framebufferWidth:Nr,framebufferHeight:$r,drawingBufferWidth:Nr,drawingBufferHeight:$r,pixelRatio:Se.pixelRatio},Zr={},wt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Gt=la(Ie,Mr),Tr=Sf(Ie,Cr,Se,dr),Jr=ve(Ie,Mr,Gt,Cr,Tr);function dr(Vn){return Jr.destroyBuffer(Vn)}var rn=gs(Ie,Mr,Tr,Cr),_r=Pe(Ie,Xt,Cr,Se),Ur=V(Ie,Mr,Gt,function(){Pn.procs.poll()},Sr,Cr,Se),vr=Qs(Ie,Mr,Gt,Cr,Se),Br=I(Ie,Mr,Gt,Ur,vr,Cr),Pn=Pp(Ie,Xt,Mr,Gt,Tr,rn,Ur,Br,Zr,Jr,_r,wt,Sr,Or,Se),zn=Ut(Ie,Br,Pn.procs.poll,Sr,Nt,Mr,Gt),jr=Pn.next,ut=Ie.canvas,fr=[],et=[],Un=[],bn=[Se.onDestroy],mi=null;function oi(){if(fr.length===0){Or&&Or.update(),mi=null;return}mi=wn.next(oi),Do();for(var Vn=fr.length-1;Vn>=0;--Vn){var Ei=fr[Vn];Ei&&Ei(Sr,null,0)}Ie.flush(),Or&&Or.update()}function di(){!mi&&fr.length>0&&(mi=wn.next(oi))}function Ci(){mi&&(wn.cancel(oi),mi=null)}function Ga(Vn){Vn.preventDefault(),or=!0,Ci(),et.forEach(function(Ei){Ei()})}function Co(Vn){Ie.getError(),or=!1,Dt.restore(),_r.restore(),Tr.restore(),Ur.restore(),vr.restore(),Br.restore(),Jr.restore(),Or&&Or.restore(),Pn.procs.refresh(),di(),Un.forEach(function(Ei){Ei()})}ut&&(ut.addEventListener(Fp,Ga,!1),ut.addEventListener(Bp,Co,!1));function wi(){fr.length=0,Ci(),ut&&(ut.removeEventListener(Fp,Ga),ut.removeEventListener(Bp,Co)),_r.clear(),Br.clear(),vr.clear(),Ur.clear(),rn.clear(),Tr.clear(),Jr.clear(),Or&&Or.clear(),bn.forEach(function(Vn){Vn()})}function ba(Vn){L(!!Vn,"invalid args to regl({...})"),L.type(Vn,"object","invalid args to regl({...})");function Ei(St){var Qe=z({},St);delete Qe.uniforms,delete Qe.attributes,delete Qe.context,delete Qe.vao,"stencil"in Qe&&Qe.stencil.op&&(Qe.stencil.opBack=Qe.stencil.opFront=Qe.stencil.op,delete Qe.stencil.op);function qe(ht){if(ht in Qe){var Te=Qe[ht];delete Qe[ht],Object.keys(Te).forEach(function(We){Qe[ht+"."+We]=Te[We]})}}return qe("blend"),qe("depth"),qe("cull"),qe("stencil"),qe("polygonOffset"),qe("scissor"),qe("sample"),"vao"in St&&(Qe.vao=St.vao),Qe}function ki(St,Qe){var qe={},ht={};return Object.keys(St).forEach(function(Te){var We=St[Te];if(mn.isDynamic(We)){ht[Te]=mn.unbox(We,Te);return}else if(Qe&&Array.isArray(We)){for(var ge=0;ge<We.length;++ge)if(mn.isDynamic(We[ge])){ht[Te]=mn.unbox(We,Te);return}}qe[Te]=We}),{dynamic:ht,static:qe}}var $a=ki(Vn.context||{},!0),Xs=ki(Vn.uniforms||{},!0),nl=ki(Vn.attributes||{},!1),Re=ki(Ei(Vn),!1),Bt={gpuTime:0,cpuTime:0,count:0},Ot=Pn.compile(Re,nl,Xs,$a,Bt),dn=Ot.draw,yi=Ot.batch,Ce=Ot.scope,de=[];function Xe(St){for(;de.length<St;)de.push(null);return de}function gt(St,Qe){var qe;if(or&&L.raise("context lost"),typeof St=="function")return Ce.call(this,null,St,0);if(typeof Qe=="function")if(typeof St=="number")for(qe=0;qe<St;++qe)Ce.call(this,null,Qe,qe);else if(Array.isArray(St))for(qe=0;qe<St.length;++qe)Ce.call(this,St[qe],Qe,qe);else return Ce.call(this,St,Qe,0);else if(typeof St=="number"){if(St>0)return yi.call(this,Xe(St|0),St|0)}else if(Array.isArray(St)){if(St.length)return yi.call(this,St,St.length)}else return dn.call(this,St)}return z(gt,{stats:Bt,destroy:function(){Ot.destroy()}})}var na=Br.setFBO=ba({framebuffer:mn.define.call(null,Jh,"framebuffer")});function Ha(Vn,Ei){var ki=0;Pn.procs.poll();var $a=Ei.color;$a&&(Ie.clearColor(+$a[0]||0,+$a[1]||0,+$a[2]||0,+$a[3]||0),ki|=zf),"depth"in Ei&&(Ie.clearDepth(+Ei.depth),ki|=Kh),"stencil"in Ei&&(Ie.clearStencil(Ei.stencil|0),ki|=Op),L(!!ki,"called regl.clear with no buffer specified"),Ie.clear(ki)}function eo(Vn){if(L(typeof Vn=="object"&&Vn,"regl.clear() takes an object as input"),"framebuffer"in Vn)if(Vn.framebuffer&&Vn.framebuffer_reglType==="framebufferCube")for(var Ei=0;Ei<6;++Ei)na(z({framebuffer:Vn.framebuffer.faces[Ei]},Vn),Ha);else na(Vn,Ha);else Ha(null,Vn)}function bo(Vn){L.type(Vn,"function","regl.frame() callback must be a function"),fr.push(Vn);function Ei(){var ki=cf(fr,Vn);L(ki>=0,"cannot cancel a frame twice");function $a(){var Xs=cf(fr,$a);fr[Xs]=fr[fr.length-1],fr.length-=1,fr.length<=0&&Ci()}fr[ki]=$a}return di(),{cancel:Ei}}function So(){var Vn=jr.viewport,Ei=jr.scissor_box;Vn[0]=Vn[1]=Ei[0]=Ei[1]=0,Sr.viewportWidth=Sr.framebufferWidth=Sr.drawingBufferWidth=Vn[2]=Ei[2]=Ie.drawingBufferWidth,Sr.viewportHeight=Sr.framebufferHeight=Sr.drawingBufferHeight=Vn[3]=Ei[3]=Ie.drawingBufferHeight}function Do(){Sr.tick+=1,Sr.time=pi(),So(),Pn.procs.poll()}function Wa(){Ur.refresh(),So(),Pn.procs.refresh(),Or&&Or.update()}function pi(){return(gn()-Pr)/1e3}Wa();function jo(Vn,Ei){L.type(Ei,"function","listener callback must be a function");var ki;switch(Vn){case"frame":return bo(Ei);case"lost":ki=et;break;case"restore":ki=Un;break;case"destroy":ki=bn;break;default:L.raise("invalid event, must be one of frame,lost,restore,destroy")}return ki.push(Ei),{cancel:function(){for(var $a=0;$a<ki.length;++$a)if(ki[$a]===Ei){ki[$a]=ki[ki.length-1],ki.pop();return}}}}var ji=z(ba,{clear:eo,prop:mn.define.bind(null,Jh),context:mn.define.bind(null,Id),this:mn.define.bind(null,Pd),draw:ba({}),buffer:function(Vn){return Tr.create(Vn,Nf,!1,!1)},elements:function(Vn){return rn.create(Vn,!1)},texture:Ur.create2D,cube:Ur.createCube,renderbuffer:vr.create,framebuffer:Br.create,framebufferCube:Br.createCube,vao:Jr.createVAO,attributes:Nt,frame:bo,on:jo,limits:Gt,hasExtension:function(Vn){return Gt.extensions.indexOf(Vn.toLowerCase())>=0},read:zn,destroy:wi,_gl:Ie,_refresh:Wa,poll:function(){Do(),Or&&Or.update()},now:pi,stats:Cr});return Se.onDone(null,ji),ji}return zp})},69848:function(wr){(function(ee,z){wr.exports=z()})(this,function(){"use strict";function ee(xt,at,Rt,ft,Kt,xr){if(!(Kt-ft<=Rt)){var Y=ft+Kt>>1;z(xt,at,Y,ft,Kt,xr%2),ee(xt,at,Rt,ft,Y-1,xr+1),ee(xt,at,Rt,Y+1,Kt,xr+1)}}function z(xt,at,Rt,ft,Kt,xr){for(;Kt>ft;){if(Kt-ft>600){var Y=Kt-ft+1,Le=Rt-ft+1,O=Math.log(Y),ke=.5*Math.exp(2*O/3),Ae=.5*Math.sqrt(O*ke*(Y-ke)/Y)*(Le-Y/2<0?-1:1),st=Math.max(ft,Math.floor(Rt-Le*ke/Y+Ae)),_t=Math.min(Kt,Math.floor(Rt+(Y-Le)*ke/Y+Ae));z(xt,at,Rt,st,_t,xr)}var bt=at[2*Rt+xr],Ht=ft,nr=Kt;for(_e(xt,at,ft,Rt),at[2*Kt+xr]>bt&&_e(xt,at,ft,Kt);Ht<nr;){for(_e(xt,at,Ht,nr),Ht++,nr--;at[2*Ht+xr]<bt;)Ht++;for(;at[2*nr+xr]>bt;)nr--}at[2*ft+xr]===bt?_e(xt,at,ft,nr):(nr++,_e(xt,at,nr,Kt)),nr<=Rt&&(ft=nr+1),Rt<=nr&&(Kt=nr-1)}}function _e(xt,at,Rt,ft){Q(xt,Rt,ft),Q(at,2*Rt,2*ft),Q(at,2*Rt+1,2*ft+1)}function Q(xt,at,Rt){var ft=xt[at];xt[at]=xt[Rt],xt[Rt]=ft}function y(xt,at,Rt,ft,Kt,xr,Y){for(var Le=[0,xt.length-1,0],O=[],ke,Ae;Le.length;){var st=Le.pop(),_t=Le.pop(),bt=Le.pop();if(_t-bt<=Y){for(var Ht=bt;Ht<=_t;Ht++)ke=at[2*Ht],Ae=at[2*Ht+1],ke>=Rt&&ke<=Kt&&Ae>=ft&&Ae<=xr&&O.push(xt[Ht]);continue}var nr=Math.floor((bt+_t)/2);ke=at[2*nr],Ae=at[2*nr+1],ke>=Rt&&ke<=Kt&&Ae>=ft&&Ae<=xr&&O.push(xt[nr]);var Qr=(st+1)%2;(st===0?Rt<=ke:ft<=Ae)&&(Le.push(bt),Le.push(nr-1),Le.push(Qr)),(st===0?Kt>=ke:xr>=Ae)&&(Le.push(nr+1),Le.push(_t),Le.push(Qr))}return O}function se(xt,at,Rt,ft,Kt,xr){for(var Y=[0,xt.length-1,0],Le=[],O=Kt*Kt;Y.length;){var ke=Y.pop(),Ae=Y.pop(),st=Y.pop();if(Ae-st<=xr){for(var _t=st;_t<=Ae;_t++)U(at[2*_t],at[2*_t+1],Rt,ft)<=O&&Le.push(xt[_t]);continue}var bt=Math.floor((st+Ae)/2),Ht=at[2*bt],nr=at[2*bt+1];U(Ht,nr,Rt,ft)<=O&&Le.push(xt[bt]);var Qr=(ke+1)%2;(ke===0?Rt-Kt<=Ht:ft-Kt<=nr)&&(Y.push(st),Y.push(bt-1),Y.push(Qr)),(ke===0?Rt+Kt>=Ht:ft+Kt>=nr)&&(Y.push(bt+1),Y.push(Ae),Y.push(Qr))}return Le}function U(xt,at,Rt,ft){var Kt=xt-Rt,xr=at-ft;return Kt*Kt+xr*xr}var ce=function(xt){return xt[0]},ae=function(xt){return xt[1]},Ge=function(at,Rt,ft,Kt,xr){Rt===void 0&&(Rt=ce),ft===void 0&&(ft=ae),Kt===void 0&&(Kt=64),xr===void 0&&(xr=Float64Array),this.nodeSize=Kt,this.points=at;for(var Y=at.length<65536?Uint16Array:Uint32Array,Le=this.ids=new Y(at.length),O=this.coords=new xr(at.length*2),ke=0;ke<at.length;ke++)Le[ke]=ke,O[2*ke]=Rt(at[ke]),O[2*ke+1]=ft(at[ke]);ee(Le,O,Kt,0,Le.length-1,0)};Ge.prototype.range=function(at,Rt,ft,Kt){return y(this.ids,this.coords,at,Rt,ft,Kt,this.nodeSize)},Ge.prototype.within=function(at,Rt,ft){return se(this.ids,this.coords,at,Rt,ft,this.nodeSize)};var oe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(xt){return xt}},je=Math.fround||function(xt){return function(at){return xt[0]=+at,xt[0]}}(new Float32Array(1)),rt=function(at){this.options=Fr(Object.create(oe),at),this.trees=new Array(this.options.maxZoom+1)};rt.prototype.load=function(at){var Rt=this.options,ft=Rt.log,Kt=Rt.minZoom,xr=Rt.maxZoom,Y=Rt.nodeSize;ft&&console.time("total time");var Le="prepare "+at.length+" points";ft&&console.time(Le),this.points=at;for(var O=[],ke=0;ke<at.length;ke++)!at[ke].geometry||O.push(Pt(at[ke],ke));this.trees[xr+1]=new Ge(O,mr,lr,Y,Float32Array),ft&&console.timeEnd(Le);for(var Ae=xr;Ae>=Kt;Ae--){var st=+Date.now();O=this._cluster(O,Ae),this.trees[Ae]=new Ge(O,mr,lr,Y,Float32Array),ft&&console.log("z%d: %d clusters in %dms",Ae,O.length,+Date.now()-st)}return ft&&console.timeEnd("total time"),this},rt.prototype.getClusters=function(at,Rt){var ft=((at[0]+180)%360+360)%360-180,Kt=Math.max(-90,Math.min(90,at[1])),xr=at[2]===180?180:((at[2]+180)%360+360)%360-180,Y=Math.max(-90,Math.min(90,at[3]));if(at[2]-at[0]>=360)ft=-180,xr=180;else if(ft>xr){var Le=this.getClusters([ft,Kt,180,Y],Rt),O=this.getClusters([-180,Kt,xr,Y],Rt);return Le.concat(O)}for(var ke=this.trees[this._limitZoom(Rt)],Ae=ke.range(ir(ft),tr(Y),ir(xr),tr(Kt)),st=[],_t=0,bt=Ae;_t<bt.length;_t+=1){var Ht=bt[_t],nr=ke.points[Ht];st.push(nr.numPoints?er(nr):this.points[nr.index])}return st},rt.prototype.getChildren=function(at){var Rt=this._getOriginId(at),ft=this._getOriginZoom(at),Kt="No cluster with the specified id.",xr=this.trees[ft];if(!xr)throw new Error(Kt);var Y=xr.points[Rt];if(!Y)throw new Error(Kt);for(var Le=this.options.radius/(this.options.extent*Math.pow(2,ft-1)),O=xr.within(Y.x,Y.y,Le),ke=[],Ae=0,st=O;Ae<st.length;Ae+=1){var _t=st[Ae],bt=xr.points[_t];bt.parentId===at&&ke.push(bt.numPoints?er(bt):this.points[bt.index])}if(ke.length===0)throw new Error(Kt);return ke},rt.prototype.getLeaves=function(at,Rt,ft){Rt=Rt||10,ft=ft||0;var Kt=[];return this._appendLeaves(Kt,at,Rt,ft,0),Kt},rt.prototype.getTile=function(at,Rt,ft){var Kt=this.trees[this._limitZoom(at)],xr=Math.pow(2,at),Y=this.options,Le=Y.extent,O=Y.radius,ke=O/Le,Ae=(ft-ke)/xr,st=(ft+1+ke)/xr,_t={features:[]};return this._addTileFeatures(Kt.range((Rt-ke)/xr,Ae,(Rt+1+ke)/xr,st),Kt.points,Rt,ft,xr,_t),Rt===0&&this._addTileFeatures(Kt.range(1-ke/xr,Ae,1,st),Kt.points,xr,ft,xr,_t),Rt===xr-1&&this._addTileFeatures(Kt.range(0,Ae,ke/xr,st),Kt.points,-1,ft,xr,_t),_t.features.length?_t:null},rt.prototype.getClusterExpansionZoom=function(at){for(var Rt=this._getOriginZoom(at)-1;Rt<=this.options.maxZoom;){var ft=this.getChildren(at);if(Rt++,ft.length!==1)break;at=ft[0].properties.cluster_id}return Rt},rt.prototype._appendLeaves=function(at,Rt,ft,Kt,xr){for(var Y=this.getChildren(Rt),Le=0,O=Y;Le<O.length;Le+=1){var ke=O[Le],Ae=ke.properties;if(Ae&&Ae.cluster?xr+Ae.point_count<=Kt?xr+=Ae.point_count:xr=this._appendLeaves(at,Ae.cluster_id,ft,Kt,xr):xr<Kt?xr++:at.push(ke),at.length===ft)break}return xr},rt.prototype._addTileFeatures=function(at,Rt,ft,Kt,xr,Y){for(var Le=0,O=at;Le<O.length;Le+=1){var ke=O[Le],Ae=Rt[ke],st=Ae.numPoints,_t=void 0,bt=void 0,Ht=void 0;if(st)_t=qt(Ae),bt=Ae.x,Ht=Ae.y;else{var nr=this.points[Ae.index];_t=nr.properties,bt=ir(nr.geometry.coordinates[0]),Ht=tr(nr.geometry.coordinates[1])}var Qr={type:1,geometry:[[Math.round(this.options.extent*(bt*xr-ft)),Math.round(this.options.extent*(Ht*xr-Kt))]],tags:_t},Lr=void 0;st?Lr=Ae.id:this.options.generateId?Lr=Ae.index:this.points[Ae.index].id&&(Lr=this.points[Ae.index].id),Lr!==void 0&&(Qr.id=Lr),Y.features.push(Qr)}},rt.prototype._limitZoom=function(at){return Math.max(this.options.minZoom,Math.min(Math.floor(+at),this.options.maxZoom+1))},rt.prototype._cluster=function(at,Rt){for(var ft=[],Kt=this.options,xr=Kt.radius,Y=Kt.extent,Le=Kt.reduce,O=Kt.minPoints,ke=xr/(Y*Math.pow(2,Rt)),Ae=0;Ae<at.length;Ae++){var st=at[Ae];if(!(st.zoom<=Rt)){st.zoom=Rt;for(var _t=this.trees[Rt+1],bt=_t.within(st.x,st.y,ke),Ht=st.numPoints||1,nr=Ht,Qr=0,Lr=bt;Qr<Lr.length;Qr+=1){var jn=Lr[Qr],tn=_t.points[jn];tn.zoom>Rt&&(nr+=tn.numPoints||1)}if(nr>Ht&&nr>=O){for(var Cn=st.x*Ht,si=st.y*Ht,Xn=Le&&Ht>1?this._map(st,!0):null,vn=(Ae<<5)+(Rt+1)+this.points.length,Ai=0,Ii=bt;Ai<Ii.length;Ai+=1){var Ti=Ii[Ai],Gn=_t.points[Ti];if(!(Gn.zoom<=Rt)){Gn.zoom=Rt;var Dn=Gn.numPoints||1;Cn+=Gn.x*Dn,si+=Gn.y*Dn,Gn.parentId=vn,Le&&(Xn||(Xn=this._map(st,!0)),Le(Xn,this._map(Gn)))}}st.parentId=vn,ft.push(ct(Cn/nr,si/nr,vn,nr,Xn))}else if(ft.push(st),nr>1)for(var ho=0,Hi=bt;ho<Hi.length;ho+=1){var Ya=Hi[ho],kt=_t.points[Ya];kt.zoom<=Rt||(kt.zoom=Rt,ft.push(kt))}}}return ft},rt.prototype._getOriginId=function(at){return at-this.points.length>>5},rt.prototype._getOriginZoom=function(at){return(at-this.points.length)%32},rt.prototype._map=function(at,Rt){if(at.numPoints)return Rt?Fr({},at.properties):at.properties;var ft=this.points[at.index].properties,Kt=this.options.map(ft);return Rt&&Kt===ft?Fr({},Kt):Kt};function ct(xt,at,Rt,ft,Kt){return{x:je(xt),y:je(at),zoom:Infinity,id:Rt,parentId:-1,numPoints:ft,properties:Kt}}function Pt(xt,at){var Rt=xt.geometry.coordinates,ft=Rt[0],Kt=Rt[1];return{x:je(ir(ft)),y:je(tr(Kt)),zoom:Infinity,index:at,parentId:-1}}function er(xt){return{type:"Feature",id:xt.id,properties:qt(xt),geometry:{type:"Point",coordinates:[Ct(xt.x),yt(xt.y)]}}}function qt(xt){var at=xt.numPoints,Rt=at>=1e4?Math.round(at/1e3)+"k":at>=1e3?Math.round(at/100)/10+"k":at;return Fr(Fr({},xt.properties),{cluster:!0,cluster_id:xt.id,point_count:at,point_count_abbreviated:Rt})}function ir(xt){return xt/360+.5}function tr(xt){var at=Math.sin(xt*Math.PI/180),Rt=.5-.25*Math.log((1+at)/(1-at))/Math.PI;return Rt<0?0:Rt>1?1:Rt}function Ct(xt){return(xt-.5)*360}function yt(xt){var at=(180-xt*360)*Math.PI/180;return 360*Math.atan(Math.exp(at))/Math.PI-90}function Fr(xt,at){for(var Rt in at)xt[Rt]=at[Rt];return xt}function mr(xt){return xt.x}function lr(xt){return xt.y}return rt})}}]);

//# sourceMappingURL=5724.1dd91892.async.js.map