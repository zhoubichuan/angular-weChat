(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[2535],{97993:function(Lr,U,S){"use strict";var ue=S(59301),C=(0,ue.createContext)({});U.Z=C},53644:function(Lr,U,S){"use strict";var ue=S(15629),C=S(55778),p=S(83114),w=S.n(p),q=S(59301),K=S(92691),W=S.n(K),L=S(97993),N=function(Ye){var Je=(0,q.useContext)(L.Z),rt=Ye.children,Xt=Ye.contentWidth,Gt=Ye.className,nr=Ye.style,Ut=(0,q.useContext)(C.ZP.ConfigContext),At=Ut.getPrefixCls,Et=Ye.prefixCls||At("pro"),dr=Xt||Je.contentWidth,re="".concat(Et,"-grid-content");return q.createElement("div",{className:W()(re,Gt,{wide:dr==="Fixed"}),style:nr},q.createElement("div",{className:"".concat(Et,"-grid-content-children")},rt))};U.Z=N},65859:function(Lr,U,S){"use strict";S.d(U,{zj:function(){return Ft},oI:function(){return Xi},ni:function(){return ge},gg:function(){return mn}});var ue=S(97671);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function C(ir,pe,Pe,Ze){function Le(It){return It instanceof Pe?It:new Pe(function(tr){tr(It)})}return new(Pe||(Pe=Promise))(function(It,tr){function E(Ge){try{be(Ze.next(Ge))}catch(qe){tr(qe)}}function Z(Ge){try{be(Ze.throw(Ge))}catch(qe){tr(qe)}}function be(Ge){Ge.done?It(Ge.value):Le(Ge.value).then(E,Z)}be((Ze=Ze.apply(ir,pe||[])).next())})}function p(ir,pe){var Pe={label:0,sent:function(){if(It[0]&1)throw It[1];return It[1]},trys:[],ops:[]},Ze,Le,It,tr;return tr={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(tr[Symbol.iterator]=function(){return this}),tr;function E(be){return function(Ge){return Z([be,Ge])}}function Z(be){if(Ze)throw new TypeError("Generator is already executing.");for(;Pe;)try{if(Ze=1,Le&&(It=be[0]&2?Le.return:be[0]?Le.throw||((It=Le.return)&&It.call(Le),0):Le.next)&&!(It=It.call(Le,be[1])).done)return It;switch(Le=0,It&&(be=[be[0]&2,It.value]),be[0]){case 0:case 1:It=be;break;case 4:return Pe.label++,{value:be[1],done:!1};case 5:Pe.label++,Le=be[1],be=[0];continue;case 7:be=Pe.ops.pop(),Pe.trys.pop();continue;default:if(It=Pe.trys,!(It=It.length>0&&It[It.length-1])&&(be[0]===6||be[0]===2)){Pe=0;continue}if(be[0]===3&&(!It||be[1]>It[0]&&be[1]<It[3])){Pe.label=be[1];break}if(be[0]===6&&Pe.label<It[1]){Pe.label=It[1],It=be;break}if(It&&Pe.label<It[2]){Pe.label=It[2],Pe.ops.push(be);break}It[2]&&Pe.ops.pop(),Pe.trys.pop();continue}be=pe.call(ir,Pe)}catch(Ge){be=[6,Ge],Le=0}finally{Ze=It=0}if(be[0]&5)throw be[1];return{value:be[0]?be[1]:void 0,done:!0}}}function w(ir,pe){var Pe=typeof Symbol=="function"&&ir[Symbol.iterator];if(!Pe)return ir;var Ze=Pe.call(ir),Le,It=[],tr;try{for(;(pe===void 0||pe-- >0)&&!(Le=Ze.next()).done;)It.push(Le.value)}catch(E){tr={error:E}}finally{try{Le&&!Le.done&&(Pe=Ze.return)&&Pe.call(Ze)}finally{if(tr)throw tr.error}}return It}function q(){for(var ir=[],pe=0;pe<arguments.length;pe++)ir=ir.concat(w(arguments[pe]));return ir}function K(ir){return ir&&ir.__esModule&&Object.prototype.hasOwnProperty.call(ir,"default")?ir.default:ir}function W(ir,pe){return pe={exports:{}},ir(pe,pe.exports),pe.exports}var L=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Pe;function Pe(Ze){return Ze&&typeof Ze.length=="number"&&Ze.length>=0&&Ze.length%1==0}ir.exports=pe.default});K(L);var N=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=function(Pe){return function(){for(var Ze=[],Le=arguments.length;Le--;)Ze[Le]=arguments[Le];var It=Ze.pop();return Pe.call(this,Ze,It)}},ir.exports=pe.default});K(N);var Ne=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.fallback=Le,pe.wrap=It;var Pe=pe.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Ze=pe.hasNextTick=typeof ue=="object"&&typeof ue.nextTick=="function";function Le(E){setTimeout(E,0)}function It(E){return function(Z){for(var be=[],Ge=arguments.length-1;Ge-- >0;)be[Ge]=arguments[Ge+1];return E(function(){return Z.apply(void 0,be)})}}var tr;Pe?tr=setImmediate:Ze?tr=ue.nextTick:tr=Le,pe.default=It(tr)});K(Ne);var Ye=Ne.fallback,Je=Ne.wrap,rt=Ne.hasSetImmediate,Xt=Ne.hasNextTick,Gt=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=It;var Pe=Le(N),Ze=Le(Ne);function Le(Z){return Z&&Z.__esModule?Z:{default:Z}}function It(Z){return(0,nr.isAsync)(Z)?function(){for(var be=[],Ge=arguments.length;Ge--;)be[Ge]=arguments[Ge];var qe=be.pop(),gt=Z.apply(this,be);return tr(gt,qe)}:(0,Pe.default)(function(be,Ge){var qe;try{qe=Z.apply(this,be)}catch(gt){return Ge(gt)}if(qe&&typeof qe.then=="function")return tr(qe,Ge);Ge(null,qe)})}function tr(Z,be){return Z.then(function(Ge){E(be,null,Ge)},function(Ge){E(be,Ge&&Ge.message?Ge:new Error(Ge))})}function E(Z,be,Ge){try{Z(be,Ge)}catch(qe){(0,Ze.default)(function(gt){throw gt},qe)}}ir.exports=pe.default});K(Gt);var nr=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.isAsyncIterable=pe.isAsyncGenerator=pe.isAsync=void 0;var Pe=Ze(Gt);function Ze(Z){return Z&&Z.__esModule?Z:{default:Z}}function Le(Z){return Z[Symbol.toStringTag]==="AsyncFunction"}function It(Z){return Z[Symbol.toStringTag]==="AsyncGenerator"}function tr(Z){return typeof Z[Symbol.asyncIterator]=="function"}function E(Z){if(typeof Z!="function")throw new Error("expected a function");return Le(Z)?(0,Pe.default)(Z):Z}pe.default=E,pe.isAsync=Le,pe.isAsyncGenerator=It,pe.isAsyncIterable=tr});K(nr);var Ut=nr.isAsyncIterable,At=nr.isAsyncGenerator,Et=nr.isAsync,dr=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Pe;function Pe(Ze,Le){if(Le===void 0&&(Le=Ze.length),!Le)throw new Error("arity is undefined");function It(){for(var tr=this,E=[],Z=arguments.length;Z--;)E[Z]=arguments[Z];return typeof E[Le-1]=="function"?Ze.apply(this,E):new Promise(function(be,Ge){E[Le-1]=function(qe){for(var gt=[],St=arguments.length-1;St-- >0;)gt[St]=arguments[St+1];if(qe)return Ge(qe);be(gt.length>1?gt:gt[0])},Ze.apply(tr,E)})}return Object.defineProperty(It,"name",{configurable:!0,value:"awaitable("+Ze.name+")"}),It}ir.exports=pe.default});K(dr);var re=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=It(L),Ze=It(nr),Le=It(dr);function It(tr){return tr&&tr.__esModule?tr:{default:tr}}pe.default=(0,Le.default)(function(tr,E,Z){var be=(0,Pe.default)(E)?[]:{};tr(E,function(Ge,qe,gt){(0,Ze.default)(Ge)(function(St){for(var Ct,Vt=[],qt=arguments.length-1;qt-- >0;)Vt[qt]=arguments[qt+1];Vt.length<2&&(Ct=Vt,Vt=Ct[0]),be[qe]=Vt,gt(St)})},function(Ge){return Z(Ge,be)})},3),ir.exports=pe.default});K(re);var mr=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Pe;function Pe(Ze){function Le(){for(var It=[],tr=arguments.length;tr--;)It[tr]=arguments[tr];if(Ze!==null){var E=Ze;Ze=null,E.apply(this,It)}}return Object.assign(Le,Ze),Le}ir.exports=pe.default});K(mr);var wt=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=function(Pe){return Pe[Symbol.iterator]&&Pe[Symbol.iterator]()},ir.exports=pe.default});K(wt);var Ke=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Z;var Pe=Le(L),Ze=Le(wt);function Le(be){return be&&be.__esModule?be:{default:be}}function It(be){var Ge=-1,qe=be.length;return function(){return++Ge<qe?{value:be[Ge],key:Ge}:null}}function tr(be){var Ge=-1;return function(){var gt=be.next();return gt.done?null:(Ge++,{value:gt.value,key:Ge})}}function E(be){var Ge=be?Object.keys(be):[],qe=-1,gt=Ge.length;return function(){var Ct=Ge[++qe];return qe<gt?{value:be[Ct],key:Ct}:null}}function Z(be){if((0,Pe.default)(be))return It(be);var Ge=(0,Ze.default)(be);return Ge?tr(Ge):E(be)}ir.exports=pe.default});K(Ke);var Dt=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Pe;function Pe(Ze){return function(){for(var Le=[],It=arguments.length;It--;)Le[It]=arguments[It];if(Ze===null)throw new Error("Callback was already called.");var tr=Ze;Ze=null,tr.apply(this,Le)}}ir.exports=pe.default});K(Dt);var Xe=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe={};pe.default=Pe,ir.exports=pe.default});K(Xe);var Zt=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Le;var Pe=Ze(Xe);function Ze(It){return It&&It.__esModule?It:{default:It}}function Le(It,tr,E,Z){var be=!1,Ge=!1,qe=!1,gt=0,St=0;function Ct(){gt>=tr||qe||be||(qe=!0,It.next().then(function(ie){var sr=ie.value,Mr=ie.done;if(!(Ge||be)){if(qe=!1,Mr){be=!0,gt<=0&&Z(null);return}gt++,E(sr,St,Vt),St++,Ct()}}).catch(qt))}function Vt(ie,sr){if(gt-=1,!Ge){if(ie)return qt(ie);if(ie===!1){be=!0,Ge=!0;return}if(sr===Pe.default||be&&gt<=0)return be=!0,Z(null);Ct()}}function qt(ie){Ge||(qe=!1,be=!0,Z(ie))}Ct()}ir.exports=pe.default});K(Zt);var yr=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=E(mr),Ze=E(Ke),Le=E(Dt),It=E(Zt),tr=E(Xe);function E(Z){return Z&&Z.__esModule?Z:{default:Z}}pe.default=function(Z){return function(be,Ge,qe){if(qe=(0,Pe.default)(qe),Z<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!be)return qe(null);if((0,nr.isAsyncGenerator)(be))return(0,It.default)(be,Z,Ge,qe);if((0,nr.isAsyncIterable)(be))return(0,It.default)(be[Symbol.asyncIterator](),Z,Ge,qe);var gt=(0,Ze.default)(be),St=!1,Ct=!1,Vt=0,qt=!1;function ie(Mr,Nr){if(!Ct)if(Vt-=1,Mr)St=!0,qe(Mr);else if(Mr===!1)St=!0,Ct=!0;else{if(Nr===tr.default||St&&Vt<=0)return St=!0,qe(null);qt||sr()}}function sr(){for(qt=!0;Vt<Z&&!St;){var Mr=gt();if(Mr===null){St=!0,Vt<=0&&qe(null);return}Vt+=1,Ge(Mr.value,Mr.key,(0,Le.default)(ie))}qt=!1}sr()}},ir.exports=pe.default});K(yr);var ur=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=It(yr),Ze=It(nr),Le=It(dr);function It(E){return E&&E.__esModule?E:{default:E}}function tr(E,Z,be,Ge){return(0,Pe.default)(Z)(E,(0,Ze.default)(be),Ge)}pe.default=(0,Le.default)(tr,4),ir.exports=pe.default});K(ur);var Ur=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=Le(ur),Ze=Le(dr);function Le(tr){return tr&&tr.__esModule?tr:{default:tr}}function It(tr,E,Z){return(0,Pe.default)(tr,1,E,Z)}pe.default=(0,Ze.default)(It,3),ir.exports=pe.default});K(Ur);var he=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=It;var Pe=Le(re),Ze=Le(Ur);function Le(tr){return tr&&tr.__esModule?tr:{default:tr}}function It(tr,E){return(0,Pe.default)(Ze.default,tr,E)}ir.exports=pe.default}),Re=K(he),ge=function(){function ir(){for(var pe=arguments,Pe=[],Ze=0;Ze<arguments.length;Ze++)Pe[Ze]=pe[Ze];this.args=[],this.tasks=[]}return ir.prototype.call=function(){for(var pe=arguments,Pe=[],Ze=0;Ze<arguments.length;Ze++)Pe[Ze]=pe[Ze];return this.args=Pe,Re(this.tasks)},ir.prototype.tap=function(pe,Pe){var Ze=this;this.tasks.push(function(Le){Pe.apply(void 0,q(Ze.args)),Le(null,pe)})},ir}(),_t=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=be(L),Ze=be(Xe),Le=be(ur),It=be(mr),tr=be(Dt),E=be(nr),Z=be(dr);function be(St){return St&&St.__esModule?St:{default:St}}function Ge(St,Ct,Vt){Vt=(0,It.default)(Vt);var qt=0,ie=0,sr=St.length,Mr=!1;sr===0&&Vt(null);function Nr(tt,mt){tt===!1&&(Mr=!0),Mr!==!0&&(tt?Vt(tt):(++ie===sr||mt===Ze.default)&&Vt(null))}for(;qt<sr;qt++)Ct(St[qt],qt,(0,tr.default)(Nr))}function qe(St,Ct,Vt){return(0,Le.default)(St,Infinity,Ct,Vt)}function gt(St,Ct,Vt){var qt=(0,Pe.default)(St)?Ge:qe;return qt(St,(0,E.default)(Ct),Vt)}pe.default=(0,Z.default)(gt,3),ir.exports=pe.default});K(_t);var pt=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=It;var Pe=Le(_t),Ze=Le(re);function Le(tr){return tr&&tr.__esModule?tr:{default:tr}}function It(tr,E){return(0,Ze.default)(Pe.default,tr,E)}ir.exports=pe.default}),zt=K(pt),Ft=function(){function ir(){for(var pe=arguments,Pe=[],Ze=0;Ze<arguments.length;Ze++)Pe[Ze]=pe[Ze];this.tasks=[]}return ir.prototype.promise=function(){for(var pe=arguments,Pe=[],Ze=0;Ze<arguments.length;Ze++)Pe[Ze]=pe[Ze];return zt(this.tasks)},ir.prototype.tapPromise=function(pe,Pe){var Ze=this;this.tasks.push(function(Le){return C(Ze,void 0,void 0,function(){return p(this,function(It){switch(It.label){case 0:return[4,Pe()];case 1:return It.sent(),Le(null,pe),[2]}})})})},ir}(),Dr=W(function(ir,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=tr(mr),Ze=tr(Dt),Le=tr(nr),It=tr(dr);function tr(Z){return Z&&Z.__esModule?Z:{default:Z}}function E(Z,be){if(be=(0,Pe.default)(be),!Array.isArray(Z))return be(new Error("First argument to waterfall must be an array of functions"));if(!Z.length)return be();var Ge=0;function qe(St){var Ct=(0,Le.default)(Z[Ge++]);Ct.apply(void 0,St.concat([(0,Ze.default)(gt)]))}function gt(St){for(var Ct=[],Vt=arguments.length-1;Vt-- >0;)Ct[Vt]=arguments[Vt+1];if(St!==!1){if(St||Ge===Z.length)return be.apply(void 0,[St].concat(Ct));qe(Ct)}}qe([])}pe.default=(0,It.default)(E),ir.exports=pe.default}),pn=K(Dr),mn=function(){function ir(){for(var pe=arguments,Pe=[],Ze=0;Ze<arguments.length;Ze++)Pe[Ze]=pe[Ze];this.tasks=[]}return ir.prototype.call=function(){for(var pe=arguments,Pe=[],Ze=0;Ze<arguments.length;Ze++)Pe[Ze]=pe[Ze];return pn(this.tasks)},ir.prototype.tap=function(pe,Pe){this.tasks.length===0?this.tasks.push(function(Ze){var Le=Pe();Ze(Le?null:!1,Le)}):this.tasks.push(function(Ze,Le){var It=Pe();Le(It?null:!1,pe)})},ir}(),Xi=function(){function ir(){for(var pe=arguments,Pe=[],Ze=0;Ze<arguments.length;Ze++)Pe[Ze]=pe[Ze];this.tasks=[]}return ir.prototype.call=function(){for(var pe=arguments,Pe=[],Ze=0;Ze<arguments.length;Ze++)Pe[Ze]=pe[Ze];return Re(this.tasks)},ir.prototype.tap=function(pe,Pe){this.tasks.push(function(Ze){var Le=Pe();Ze(Le,pe)})},ir}()},96391:function(Lr,U,S){"use strict";S.d(U,{nC:function(){return ue.ZP},Hp:function(){return ue.Hp},e7:function(){return ue.e7},yT:function(){return ue.yT},vK:function(){return p.v},h0:function(){return q.h},GC:function(){return K.GC},vY:function(){return K.vY},ee:function(){return K.ee},MapServiceEvent:function(){return N.I},CoordinateSystem:function(){return Ne.l},CoordinateUniform:function(){return Ne.k},CameraUniform:function(){return rt.l},SceneEventList:function(){return nr.P},PositionType:function(){return wt.d},gl:function(){return tr.gl}});var ue=S(35458),C=S(78908),p=S(13078),w=S(68152),q=S(554),K=S(73132),W=S(52977),L=S.n(W);S.o(W,"CameraUniform")&&S.d(U,{CameraUniform:function(){return W.CameraUniform}}),S.o(W,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return W.CityBuildingLayer}}),S.o(W,"CoordinateSystem")&&S.d(U,{CoordinateSystem:function(){return W.CoordinateSystem}}),S.o(W,"CoordinateUniform")&&S.d(U,{CoordinateUniform:function(){return W.CoordinateUniform}}),S.o(W,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return W.HeatmapLayer}}),S.o(W,"ImageLayer")&&S.d(U,{ImageLayer:function(){return W.ImageLayer}}),S.o(W,"LineLayer")&&S.d(U,{LineLayer:function(){return W.LineLayer}}),S.o(W,"MapServiceEvent")&&S.d(U,{MapServiceEvent:function(){return W.MapServiceEvent}}),S.o(W,"Marker")&&S.d(U,{Marker:function(){return W.Marker}}),S.o(W,"PointLayer")&&S.d(U,{PointLayer:function(){return W.PointLayer}}),S.o(W,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return W.PolygonLayer}}),S.o(W,"Popup")&&S.d(U,{Popup:function(){return W.Popup}}),S.o(W,"PositionType")&&S.d(U,{PositionType:function(){return W.PositionType}}),S.o(W,"RasterLayer")&&S.d(U,{RasterLayer:function(){return W.RasterLayer}}),S.o(W,"Scene")&&S.d(U,{Scene:function(){return W.Scene}}),S.o(W,"SceneEventList")&&S.d(U,{SceneEventList:function(){return W.SceneEventList}}),S.o(W,"gl")&&S.d(U,{gl:function(){return W.gl}});var N=S(85808),Ne=S(48216),Ye=S(23157),Je=S.n(Ye);S.o(Ye,"CameraUniform")&&S.d(U,{CameraUniform:function(){return Ye.CameraUniform}}),S.o(Ye,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return Ye.CityBuildingLayer}}),S.o(Ye,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return Ye.HeatmapLayer}}),S.o(Ye,"ImageLayer")&&S.d(U,{ImageLayer:function(){return Ye.ImageLayer}}),S.o(Ye,"LineLayer")&&S.d(U,{LineLayer:function(){return Ye.LineLayer}}),S.o(Ye,"Marker")&&S.d(U,{Marker:function(){return Ye.Marker}}),S.o(Ye,"PointLayer")&&S.d(U,{PointLayer:function(){return Ye.PointLayer}}),S.o(Ye,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return Ye.PolygonLayer}}),S.o(Ye,"Popup")&&S.d(U,{Popup:function(){return Ye.Popup}}),S.o(Ye,"PositionType")&&S.d(U,{PositionType:function(){return Ye.PositionType}}),S.o(Ye,"RasterLayer")&&S.d(U,{RasterLayer:function(){return Ye.RasterLayer}}),S.o(Ye,"Scene")&&S.d(U,{Scene:function(){return Ye.Scene}}),S.o(Ye,"SceneEventList")&&S.d(U,{SceneEventList:function(){return Ye.SceneEventList}}),S.o(Ye,"gl")&&S.d(U,{gl:function(){return Ye.gl}});var rt=S(22206),Xt=S(991),Gt=S.n(Xt);S.o(Xt,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return Xt.CityBuildingLayer}}),S.o(Xt,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return Xt.HeatmapLayer}}),S.o(Xt,"ImageLayer")&&S.d(U,{ImageLayer:function(){return Xt.ImageLayer}}),S.o(Xt,"LineLayer")&&S.d(U,{LineLayer:function(){return Xt.LineLayer}}),S.o(Xt,"Marker")&&S.d(U,{Marker:function(){return Xt.Marker}}),S.o(Xt,"PointLayer")&&S.d(U,{PointLayer:function(){return Xt.PointLayer}}),S.o(Xt,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return Xt.PolygonLayer}}),S.o(Xt,"Popup")&&S.d(U,{Popup:function(){return Xt.Popup}}),S.o(Xt,"PositionType")&&S.d(U,{PositionType:function(){return Xt.PositionType}}),S.o(Xt,"RasterLayer")&&S.d(U,{RasterLayer:function(){return Xt.RasterLayer}}),S.o(Xt,"Scene")&&S.d(U,{Scene:function(){return Xt.Scene}}),S.o(Xt,"SceneEventList")&&S.d(U,{SceneEventList:function(){return Xt.SceneEventList}}),S.o(Xt,"gl")&&S.d(U,{gl:function(){return Xt.gl}});var nr=S(49305),Ut=S(96829),At=S.n(Ut);S.o(Ut,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return Ut.CityBuildingLayer}}),S.o(Ut,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return Ut.HeatmapLayer}}),S.o(Ut,"ImageLayer")&&S.d(U,{ImageLayer:function(){return Ut.ImageLayer}}),S.o(Ut,"LineLayer")&&S.d(U,{LineLayer:function(){return Ut.LineLayer}}),S.o(Ut,"Marker")&&S.d(U,{Marker:function(){return Ut.Marker}}),S.o(Ut,"PointLayer")&&S.d(U,{PointLayer:function(){return Ut.PointLayer}}),S.o(Ut,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return Ut.PolygonLayer}}),S.o(Ut,"Popup")&&S.d(U,{Popup:function(){return Ut.Popup}}),S.o(Ut,"PositionType")&&S.d(U,{PositionType:function(){return Ut.PositionType}}),S.o(Ut,"RasterLayer")&&S.d(U,{RasterLayer:function(){return Ut.RasterLayer}}),S.o(Ut,"Scene")&&S.d(U,{Scene:function(){return Ut.Scene}}),S.o(Ut,"gl")&&S.d(U,{gl:function(){return Ut.gl}});var Et=S(97522),dr=S.n(Et);S.o(Et,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return Et.CityBuildingLayer}}),S.o(Et,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return Et.HeatmapLayer}}),S.o(Et,"ImageLayer")&&S.d(U,{ImageLayer:function(){return Et.ImageLayer}}),S.o(Et,"LineLayer")&&S.d(U,{LineLayer:function(){return Et.LineLayer}}),S.o(Et,"Marker")&&S.d(U,{Marker:function(){return Et.Marker}}),S.o(Et,"PointLayer")&&S.d(U,{PointLayer:function(){return Et.PointLayer}}),S.o(Et,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return Et.PolygonLayer}}),S.o(Et,"Popup")&&S.d(U,{Popup:function(){return Et.Popup}}),S.o(Et,"PositionType")&&S.d(U,{PositionType:function(){return Et.PositionType}}),S.o(Et,"RasterLayer")&&S.d(U,{RasterLayer:function(){return Et.RasterLayer}}),S.o(Et,"Scene")&&S.d(U,{Scene:function(){return Et.Scene}}),S.o(Et,"gl")&&S.d(U,{gl:function(){return Et.gl}});var re=S(44705),mr=S.n(re);S.o(re,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return re.CityBuildingLayer}}),S.o(re,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return re.HeatmapLayer}}),S.o(re,"ImageLayer")&&S.d(U,{ImageLayer:function(){return re.ImageLayer}}),S.o(re,"LineLayer")&&S.d(U,{LineLayer:function(){return re.LineLayer}}),S.o(re,"Marker")&&S.d(U,{Marker:function(){return re.Marker}}),S.o(re,"PointLayer")&&S.d(U,{PointLayer:function(){return re.PointLayer}}),S.o(re,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return re.PolygonLayer}}),S.o(re,"Popup")&&S.d(U,{Popup:function(){return re.Popup}}),S.o(re,"PositionType")&&S.d(U,{PositionType:function(){return re.PositionType}}),S.o(re,"RasterLayer")&&S.d(U,{RasterLayer:function(){return re.RasterLayer}}),S.o(re,"Scene")&&S.d(U,{Scene:function(){return re.Scene}}),S.o(re,"gl")&&S.d(U,{gl:function(){return re.gl}});var wt=S(60205),Ke=S(62049),Dt=S.n(Ke);S.o(Ke,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return Ke.CityBuildingLayer}}),S.o(Ke,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return Ke.HeatmapLayer}}),S.o(Ke,"ImageLayer")&&S.d(U,{ImageLayer:function(){return Ke.ImageLayer}}),S.o(Ke,"LineLayer")&&S.d(U,{LineLayer:function(){return Ke.LineLayer}}),S.o(Ke,"Marker")&&S.d(U,{Marker:function(){return Ke.Marker}}),S.o(Ke,"PointLayer")&&S.d(U,{PointLayer:function(){return Ke.PointLayer}}),S.o(Ke,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return Ke.PolygonLayer}}),S.o(Ke,"Popup")&&S.d(U,{Popup:function(){return Ke.Popup}}),S.o(Ke,"RasterLayer")&&S.d(U,{RasterLayer:function(){return Ke.RasterLayer}}),S.o(Ke,"Scene")&&S.d(U,{Scene:function(){return Ke.Scene}}),S.o(Ke,"gl")&&S.d(U,{gl:function(){return Ke.gl}});var Xe=S(52616),Zt=S.n(Xe);S.o(Xe,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return Xe.CityBuildingLayer}}),S.o(Xe,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return Xe.HeatmapLayer}}),S.o(Xe,"ImageLayer")&&S.d(U,{ImageLayer:function(){return Xe.ImageLayer}}),S.o(Xe,"LineLayer")&&S.d(U,{LineLayer:function(){return Xe.LineLayer}}),S.o(Xe,"Marker")&&S.d(U,{Marker:function(){return Xe.Marker}}),S.o(Xe,"PointLayer")&&S.d(U,{PointLayer:function(){return Xe.PointLayer}}),S.o(Xe,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return Xe.PolygonLayer}}),S.o(Xe,"Popup")&&S.d(U,{Popup:function(){return Xe.Popup}}),S.o(Xe,"RasterLayer")&&S.d(U,{RasterLayer:function(){return Xe.RasterLayer}}),S.o(Xe,"Scene")&&S.d(U,{Scene:function(){return Xe.Scene}}),S.o(Xe,"gl")&&S.d(U,{gl:function(){return Xe.gl}});var yr=S(90511),ur=S(64188),Ur=S.n(ur);S.o(ur,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return ur.CityBuildingLayer}}),S.o(ur,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return ur.HeatmapLayer}}),S.o(ur,"ImageLayer")&&S.d(U,{ImageLayer:function(){return ur.ImageLayer}}),S.o(ur,"LineLayer")&&S.d(U,{LineLayer:function(){return ur.LineLayer}}),S.o(ur,"Marker")&&S.d(U,{Marker:function(){return ur.Marker}}),S.o(ur,"PointLayer")&&S.d(U,{PointLayer:function(){return ur.PointLayer}}),S.o(ur,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return ur.PolygonLayer}}),S.o(ur,"Popup")&&S.d(U,{Popup:function(){return ur.Popup}}),S.o(ur,"RasterLayer")&&S.d(U,{RasterLayer:function(){return ur.RasterLayer}}),S.o(ur,"Scene")&&S.d(U,{Scene:function(){return ur.Scene}}),S.o(ur,"gl")&&S.d(U,{gl:function(){return ur.gl}});var he=S(39340),Re=S.n(he);S.o(he,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return he.CityBuildingLayer}}),S.o(he,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return he.HeatmapLayer}}),S.o(he,"ImageLayer")&&S.d(U,{ImageLayer:function(){return he.ImageLayer}}),S.o(he,"LineLayer")&&S.d(U,{LineLayer:function(){return he.LineLayer}}),S.o(he,"Marker")&&S.d(U,{Marker:function(){return he.Marker}}),S.o(he,"PointLayer")&&S.d(U,{PointLayer:function(){return he.PointLayer}}),S.o(he,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return he.PolygonLayer}}),S.o(he,"Popup")&&S.d(U,{Popup:function(){return he.Popup}}),S.o(he,"RasterLayer")&&S.d(U,{RasterLayer:function(){return he.RasterLayer}}),S.o(he,"Scene")&&S.d(U,{Scene:function(){return he.Scene}}),S.o(he,"gl")&&S.d(U,{gl:function(){return he.gl}});var ge=S(44052),_t=S.n(ge);S.o(ge,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return ge.CityBuildingLayer}}),S.o(ge,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return ge.HeatmapLayer}}),S.o(ge,"ImageLayer")&&S.d(U,{ImageLayer:function(){return ge.ImageLayer}}),S.o(ge,"LineLayer")&&S.d(U,{LineLayer:function(){return ge.LineLayer}}),S.o(ge,"Marker")&&S.d(U,{Marker:function(){return ge.Marker}}),S.o(ge,"PointLayer")&&S.d(U,{PointLayer:function(){return ge.PointLayer}}),S.o(ge,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return ge.PolygonLayer}}),S.o(ge,"Popup")&&S.d(U,{Popup:function(){return ge.Popup}}),S.o(ge,"RasterLayer")&&S.d(U,{RasterLayer:function(){return ge.RasterLayer}}),S.o(ge,"Scene")&&S.d(U,{Scene:function(){return ge.Scene}}),S.o(ge,"gl")&&S.d(U,{gl:function(){return ge.gl}});var pt=S(80454),zt=S.n(pt);S.o(pt,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return pt.CityBuildingLayer}}),S.o(pt,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return pt.HeatmapLayer}}),S.o(pt,"ImageLayer")&&S.d(U,{ImageLayer:function(){return pt.ImageLayer}}),S.o(pt,"LineLayer")&&S.d(U,{LineLayer:function(){return pt.LineLayer}}),S.o(pt,"Marker")&&S.d(U,{Marker:function(){return pt.Marker}}),S.o(pt,"PointLayer")&&S.d(U,{PointLayer:function(){return pt.PointLayer}}),S.o(pt,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return pt.PolygonLayer}}),S.o(pt,"Popup")&&S.d(U,{Popup:function(){return pt.Popup}}),S.o(pt,"RasterLayer")&&S.d(U,{RasterLayer:function(){return pt.RasterLayer}}),S.o(pt,"Scene")&&S.d(U,{Scene:function(){return pt.Scene}}),S.o(pt,"gl")&&S.d(U,{gl:function(){return pt.gl}});var Ft=S(90437),Dr=S.n(Ft);S.o(Ft,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return Ft.CityBuildingLayer}}),S.o(Ft,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return Ft.HeatmapLayer}}),S.o(Ft,"ImageLayer")&&S.d(U,{ImageLayer:function(){return Ft.ImageLayer}}),S.o(Ft,"LineLayer")&&S.d(U,{LineLayer:function(){return Ft.LineLayer}}),S.o(Ft,"Marker")&&S.d(U,{Marker:function(){return Ft.Marker}}),S.o(Ft,"PointLayer")&&S.d(U,{PointLayer:function(){return Ft.PointLayer}}),S.o(Ft,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return Ft.PolygonLayer}}),S.o(Ft,"Popup")&&S.d(U,{Popup:function(){return Ft.Popup}}),S.o(Ft,"RasterLayer")&&S.d(U,{RasterLayer:function(){return Ft.RasterLayer}}),S.o(Ft,"Scene")&&S.d(U,{Scene:function(){return Ft.Scene}}),S.o(Ft,"gl")&&S.d(U,{gl:function(){return Ft.gl}});var pn=S(10008),mn=S.n(pn);S.o(pn,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return pn.CityBuildingLayer}}),S.o(pn,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return pn.HeatmapLayer}}),S.o(pn,"ImageLayer")&&S.d(U,{ImageLayer:function(){return pn.ImageLayer}}),S.o(pn,"LineLayer")&&S.d(U,{LineLayer:function(){return pn.LineLayer}}),S.o(pn,"Marker")&&S.d(U,{Marker:function(){return pn.Marker}}),S.o(pn,"PointLayer")&&S.d(U,{PointLayer:function(){return pn.PointLayer}}),S.o(pn,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return pn.PolygonLayer}}),S.o(pn,"Popup")&&S.d(U,{Popup:function(){return pn.Popup}}),S.o(pn,"RasterLayer")&&S.d(U,{RasterLayer:function(){return pn.RasterLayer}}),S.o(pn,"Scene")&&S.d(U,{Scene:function(){return pn.Scene}}),S.o(pn,"gl")&&S.d(U,{gl:function(){return pn.gl}});var Xi=S(15194),ir=S(18023),pe=S.n(ir);S.o(ir,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return ir.CityBuildingLayer}}),S.o(ir,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return ir.HeatmapLayer}}),S.o(ir,"ImageLayer")&&S.d(U,{ImageLayer:function(){return ir.ImageLayer}}),S.o(ir,"LineLayer")&&S.d(U,{LineLayer:function(){return ir.LineLayer}}),S.o(ir,"Marker")&&S.d(U,{Marker:function(){return ir.Marker}}),S.o(ir,"PointLayer")&&S.d(U,{PointLayer:function(){return ir.PointLayer}}),S.o(ir,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return ir.PolygonLayer}}),S.o(ir,"Popup")&&S.d(U,{Popup:function(){return ir.Popup}}),S.o(ir,"RasterLayer")&&S.d(U,{RasterLayer:function(){return ir.RasterLayer}}),S.o(ir,"Scene")&&S.d(U,{Scene:function(){return ir.Scene}}),S.o(ir,"gl")&&S.d(U,{gl:function(){return ir.gl}});var Pe=S(80854),Ze=S.n(Pe);S.o(Pe,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return Pe.CityBuildingLayer}}),S.o(Pe,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return Pe.HeatmapLayer}}),S.o(Pe,"ImageLayer")&&S.d(U,{ImageLayer:function(){return Pe.ImageLayer}}),S.o(Pe,"LineLayer")&&S.d(U,{LineLayer:function(){return Pe.LineLayer}}),S.o(Pe,"Marker")&&S.d(U,{Marker:function(){return Pe.Marker}}),S.o(Pe,"PointLayer")&&S.d(U,{PointLayer:function(){return Pe.PointLayer}}),S.o(Pe,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return Pe.PolygonLayer}}),S.o(Pe,"Popup")&&S.d(U,{Popup:function(){return Pe.Popup}}),S.o(Pe,"RasterLayer")&&S.d(U,{RasterLayer:function(){return Pe.RasterLayer}}),S.o(Pe,"Scene")&&S.d(U,{Scene:function(){return Pe.Scene}}),S.o(Pe,"gl")&&S.d(U,{gl:function(){return Pe.gl}});var Le=S(19198),It=S.n(Le);S.o(Le,"CityBuildingLayer")&&S.d(U,{CityBuildingLayer:function(){return Le.CityBuildingLayer}}),S.o(Le,"HeatmapLayer")&&S.d(U,{HeatmapLayer:function(){return Le.HeatmapLayer}}),S.o(Le,"ImageLayer")&&S.d(U,{ImageLayer:function(){return Le.ImageLayer}}),S.o(Le,"LineLayer")&&S.d(U,{LineLayer:function(){return Le.LineLayer}}),S.o(Le,"Marker")&&S.d(U,{Marker:function(){return Le.Marker}}),S.o(Le,"PointLayer")&&S.d(U,{PointLayer:function(){return Le.PointLayer}}),S.o(Le,"PolygonLayer")&&S.d(U,{PolygonLayer:function(){return Le.PolygonLayer}}),S.o(Le,"Popup")&&S.d(U,{Popup:function(){return Le.Popup}}),S.o(Le,"RasterLayer")&&S.d(U,{RasterLayer:function(){return Le.RasterLayer}}),S.o(Le,"Scene")&&S.d(U,{Scene:function(){return Le.Scene}}),S.o(Le,"gl")&&S.d(U,{gl:function(){return Le.gl}});var tr=S(13027)},35458:function(Lr,U,S){"use strict";S.d(U,{e7:function(){return zi},Hp:function(){return xi},ZP:function(){return aa},yT:function(){return ci}});var ue=S(78892),C=S(40666),p=S.n(C),w=S(99311),q=S(11922),K=S(13078),W=S(51548),L=S(46893),N=S(19297),Ne=S(41889),Ye=S(52155),Je=S.n(Ye);function rt(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function Xt(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?rt(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):rt(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}function Gt(J,Q){var D=typeof Symbol!="undefined"&&J[Symbol.iterator]||J["@@iterator"];if(!D){if(Array.isArray(J)||(D=nr(J))||Q&&J&&typeof J.length=="number"){D&&(J=D);var k=0,te=function(){};return{s:te,n:function(){return k>=J.length?{done:!0}:{done:!1,value:J[k++]}},e:function(Kt){throw Kt},f:te}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ce=!0,st=!1,Bt;return{s:function(){D=D.call(J)},n:function(){var Kt=D.next();return Ce=Kt.done,Kt},e:function(Kt){st=!0,Bt=Kt},f:function(){try{!Ce&&D.return!=null&&D.return()}finally{if(st)throw Bt}}}}function nr(J,Q){if(!!J){if(typeof J=="string")return Ut(J,Q);var D=Object.prototype.toString.call(J).slice(8,-1);if(D==="Object"&&J.constructor&&(D=J.constructor.name),D==="Map"||D==="Set")return Array.from(J);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return Ut(J,Q)}}function Ut(J,Q){(Q==null||Q>J.length)&&(Q=J.length);for(var D=0,k=new Array(Q);D<Q;D++)k[D]=J[D];return k}var At=30;function Et(J){var Q=J.characterSet,D=J.getFontWidth,k=J.fontHeight,te=J.buffer,Ce=J.maxCanvasWidth,st=J.mapping,Bt=st===void 0?{}:st,bt=J.xOffset,Kt=bt===void 0?0:bt,Ir=J.yOffset,Fn=Ir===void 0?0:Ir,Nn=0,fi=Kt;Array.from(Q).forEach(function(yi,Hi){if(!Bt[yi]){var ya=D(yi,Hi);fi+At>Ce&&(fi=0,Nn++),Bt[yi]={x:fi,y:Fn+Nn*At,width:At,height:At,advance:ya},fi+=At}});var si=k+te*2;return{mapping:Bt,xOffset:fi,yOffset:Fn+Nn*si,canvasHeight:mr(Fn+(Nn+1)*si)}}function dr(J,Q,D){var k=0,te=0,Ce=0,st=[],Bt={},bt=Gt(J),Kt;try{for(bt.s();!(Kt=bt.n()).done;){var Ir=Kt.value;if(!Bt[Ir.id]){var Fn=Ir.size;k+Fn+Q>D&&(re(Bt,st,te),k=0,te=Ce+te+Q,Ce=0,st=[]),st.push({icon:Ir,xOffset:k}),k=k+Fn+Q,Ce=Math.max(Ce,Fn)}}}catch(fi){bt.e(fi)}finally{bt.f()}st.length>0&&re(Bt,st,te);var Nn=mr(Ce+te+Q);return{mapping:Bt,canvasHeight:Nn}}function re(J,Q,D){var k=Gt(Q),te;try{for(k.s();!(te=k.n()).done;){var Ce=te.value,st=Ce.icon,Bt=Ce.xOffset;J[st.id]=Xt(Xt({},st),{},{x:Bt,y:D,image:st.image,width:st.width,height:st.height})}}catch(bt){k.e(bt)}finally{k.f()}}function mr(J){return Math.pow(2,Math.ceil(Math.log2(J)))}var wt,Ke;function Dt(J,Q){var D=typeof Symbol!="undefined"&&J[Symbol.iterator]||J["@@iterator"];if(!D){if(Array.isArray(J)||(D=Xe(J))||Q&&J&&typeof J.length=="number"){D&&(J=D);var k=0,te=function(){};return{s:te,n:function(){return k>=J.length?{done:!0}:{done:!1,value:J[k++]}},e:function(Kt){throw Kt},f:te}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ce=!0,st=!1,Bt;return{s:function(){D=D.call(J)},n:function(){var Kt=D.next();return Ce=Kt.done,Kt},e:function(Kt){st=!0,Bt=Kt},f:function(){try{!Ce&&D.return!=null&&D.return()}finally{if(st)throw Bt}}}}function Xe(J,Q){if(!!J){if(typeof J=="string")return Zt(J,Q);var D=Object.prototype.toString.call(J).slice(8,-1);if(D==="Object"&&J.constructor&&(D=J.constructor.name),D==="Map"||D==="Set")return Array.from(J);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return Zt(J,Q)}}function Zt(J,Q){(Q==null||Q>J.length)&&(Q=J.length);for(var D=0,k=new Array(Q);D<Q;D++)k[D]=J[D];return k}function yr(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function ur(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?yr(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):yr(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}var Ur=ir(),he="sans-serif",Re="normal",ge=24,_t=3,pt=.25,zt=8,Ft=1024,Dr=1,pn=1,mn=3,Xi=null;function ir(){for(var J=[],Q=32;Q<128;Q++)J.push(String.fromCharCode(Q));return J}function pe(J,Q,D,k){J.font="".concat(k," ").concat(D,"px ").concat(Q),J.fillStyle="black",J.textBaseline="middle"}function Pe(J,Q){for(var D=0;D<J.length;D++)Q.data[4*D+3]=J[D]}var Ze=(wt=(0,w.b2)(),wt(Ke=function(){function J(){(0,W.Z)(this,J),(0,N.Z)(this,"fontAtlas",void 0),(0,N.Z)(this,"iconFontMap",void 0),(0,N.Z)(this,"iconFontGlyphs",{}),(0,N.Z)(this,"fontOptions",void 0),(0,N.Z)(this,"key",void 0),(0,N.Z)(this,"cache",new Ne.z6(mn))}return(0,L.Z)(J,[{key:"scale",get:function(){return pn}},{key:"canvas",get:function(){var D=this.cache.get(this.key);return D&&D.data}},{key:"mapping",get:function(){var D=this.cache.get(this.key);return D&&D.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:he,fontWeight:Re,characterSet:Ur,fontSize:ge,buffer:_t,sdf:!0,cutoff:pt,radius:zt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(D){var k=this;D.forEach(function(te){k.iconFontGlyphs[te.name]=te.unicode})}},{key:"addIconFont",value:function(D,k){this.iconFontMap.set(D,k)}},{key:"getIconFontKey",value:function(D){return this.iconFontMap.get(D)||D}},{key:"getGlyph",value:function(D){return this.iconFontGlyphs[D]?String.fromCharCode(parseInt(this.iconFontGlyphs[D],16)):""}},{key:"setFontOptions",value:function(D){this.fontOptions=ur(ur({},this.fontOptions),D),this.key=this.getKey();var k=this.getNewChars(this.key,this.fontOptions.characterSet),te=this.cache.get(this.key);if(!(te&&k.length===0)){var Ce=this.generateFontAtlas(this.key,k,te);this.fontAtlas=Ce,this.cache.set(this.key,Ce)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(D,k,te){var Ce=this.fontOptions,st=Ce.fontFamily,Bt=Ce.fontWeight,bt=Ce.fontSize,Kt=Ce.buffer,Ir=Ce.sdf,Fn=Ce.radius,Nn=Ce.cutoff,fi=Ce.iconfont,si=te&&te.data;si||(si=document.createElement("canvas"),si.width=Ft);var yi=si.getContext("2d");pe(yi,st,bt,Bt);var Hi=Et(ur({getFontWidth:function(Tc){return yi.measureText(Tc).width},fontHeight:bt*pn,buffer:Kt,characterSet:k,maxCanvasWidth:Ft},te&&{mapping:te.mapping,xOffset:te.xOffset,yOffset:te.yOffset})),ya=Hi.mapping,_a=Hi.canvasHeight,Ka=Hi.xOffset,Ba=Hi.yOffset,wo=yi.getImageData(0,0,si.width,si.height);if(si.height=_a,yi.putImageData(wo,0,0),pe(yi,st,bt,Bt),Ir){var La=new(Je())(bt,Kt,Fn,Nn,st,Bt),Sa=yi.getImageData(0,0,La.size,La.size),la=Dt(k),va;try{for(la.s();!(va=la.n()).done;){var Ga=va.value;if(fi){var Na=String.fromCharCode(parseInt(Ga.replace("&#x","").replace(";",""),16)),ko=La.draw(Na);Pe(ko,Sa)}else Pe(La.draw(Ga),Sa);yi.putImageData(Sa,ya[Ga].x,ya[Ga].y)}}catch(Ao){la.e(Ao)}finally{la.f()}}else{var Ui=Dt(k),$o;try{for(Ui.s();!($o=Ui.n()).done;){var Po=$o.value;yi.fillText(Po,ya[Po].x,ya[Po].y+bt*Dr)}}catch(Ao){Ui.e(Ao)}finally{Ui.f()}}return{xOffset:Ka,yOffset:Ba,mapping:ya,data:si,width:si.width,height:si.height}}},{key:"getKey",value:function(){return"key";var D,k,te,Ce,st,Bt,bt,Kt}},{key:"getNewChars",value:function(D,k){var te=this.cache.get(D);if(!te)return k;var Ce=[],st=te.mapping,Bt=new Set(Object.keys(st)),bt=new Set(k);return bt.forEach(function(Kt){Bt.has(Kt)||Ce.push(Kt)}),Ce}}]),J}())||Ke),Le=S(67708),It=S(37150),tr=S(87896),E=S(74415),Z,be;function Ge(J){var Q=qe();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function qe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var gt=3,St=1024,Ct=64,Vt=(Z=(0,w.b2)(),Z(be=function(J){(0,It.Z)(D,J);var Q=Ge(D);function D(){var k;(0,W.Z)(this,D);for(var te=arguments.length,Ce=new Array(te),st=0;st<te;st++)Ce[st]=arguments[st];return k=Q.call.apply(Q,[this].concat(Ce)),(0,N.Z)((0,Le.Z)(k),"canvasHeight",128),(0,N.Z)((0,Le.Z)(k),"texture",void 0),(0,N.Z)((0,Le.Z)(k),"canvas",void 0),(0,N.Z)((0,Le.Z)(k),"iconData",void 0),(0,N.Z)((0,Le.Z)(k),"iconMap",void 0),(0,N.Z)((0,Le.Z)(k),"ctx",void 0),(0,N.Z)((0,Le.Z)(k),"loadingImageCount",0),k}return(0,L.Z)(D,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(te,Ce){var st=this,Bt=new Image;if(this.loadingImageCount++,this.hasImage(te))throw new Error("Image Id already exists");this.iconData.push({id:te,size:Ct}),this.updateIconMap(),this.loadImage(Ce).then(function(bt){Bt=bt;var Kt=st.iconData.find(function(Ir){return Ir.id===te});Kt&&(Kt.image=Bt,Kt.width=Bt.width,Kt.height=Bt.height),st.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(te){return this.iconMap.hasOwnProperty(te)}},{key:"removeImage",value:function(te){this.hasImage(te)&&(this.iconData=this.iconData.filter(function(Ce){return Ce.id!==te}),delete this.iconMap[te],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var te=this;this.canvas.width=St,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(Ce){var st=te.iconMap[Ce],Bt=st.x,bt=st.y,Kt=st.image,Ir=st.width,Fn=Ir===void 0?64:Ir,Nn=st.height,fi=Nn===void 0?64:Nn,si=Math.max(Fn,fi),yi=si/Ct,Hi=fi/yi,ya=Fn/yi;Kt&&te.ctx.drawImage(Kt,Bt+(Ct-ya)/2,bt+(Ct-Hi)/2,ya,Hi)})}},{key:"updateIconMap",value:function(){var te=dr(this.iconData,gt,St),Ce=te.mapping,st=te.canvasHeight;this.iconMap=Ce,this.canvasHeight=st}},{key:"loadImage",value:function(te){return new Promise(function(Ce,st){if(te instanceof HTMLImageElement){Ce(te);return}var Bt=new Image;Bt.crossOrigin="anonymous",Bt.onload=function(){Ce(Bt)},Bt.onerror=function(){st(new Error("Could not load image at "+te))},Bt.src=te instanceof File?URL.createObjectURL(te):te})}}]),D}(C.EventEmitter))||be),qt=S(83405),ie=S(76180),sr,Mr,Nr=(sr=(0,w.b2)(),sr(Mr=function(){function J(){(0,W.Z)(this,J),(0,N.Z)(this,"viewport",void 0),(0,N.Z)(this,"overridedViewProjectionMatrix",void 0),(0,N.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,N.Z)(this,"jitteredProjectionMatrix",void 0),(0,N.Z)(this,"viewMatrixInverse",void 0),(0,N.Z)(this,"cameraPosition",void 0)}return(0,L.Z)(J,[{key:"init",value:function(){}},{key:"update",value:function(D){this.viewport=D,this.viewMatrixInverse=ie.create(),ie.invert(this.viewMatrixInverse,D.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var D=this.viewport.getCenter(),k=(0,qt.Z)(D,2),te=k[0],Ce=k[1];return[te,Ce]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(D,k){return this.viewport.projectFlat(D,k)}},{key:"setViewProjectionMatrix",value:function(D){this.overridedViewProjectionMatrix=D}},{key:"jitterProjectionMatrix",value:function(D,k){var te=ie.fromTranslation(ie.create(),[D,k,0]);this.jitteredProjectionMatrix=ie.multiply(ie.create(),te,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=ie.multiply(ie.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),J}())||Mr),tt,mt;function yt(J,Q){var D=typeof Symbol!="undefined"&&J[Symbol.iterator]||J["@@iterator"];if(!D){if(Array.isArray(J)||(D=hr(J))||Q&&J&&typeof J.length=="number"){D&&(J=D);var k=0,te=function(){};return{s:te,n:function(){return k>=J.length?{done:!0}:{done:!1,value:J[k++]}},e:function(Kt){throw Kt},f:te}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ce=!0,st=!1,Bt;return{s:function(){D=D.call(J)},n:function(){var Kt=D.next();return Ce=Kt.done,Kt},e:function(Kt){st=!0,Bt=Kt},f:function(){try{!Ce&&D.return!=null&&D.return()}finally{if(st)throw Bt}}}}function hr(J,Q){if(!!J){if(typeof J=="string")return Gr(J,Q);var D=Object.prototype.toString.call(J).slice(8,-1);if(D==="Object"&&J.constructor&&(D=J.constructor.name),D==="Map"||D==="Set")return Array.from(J);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return Gr(J,Q)}}function Gr(J,Q){(Q==null||Q>J.length)&&(Q=J.length);for(var D=0,k=new Array(Q);D<Q;D++)k[D]=J[D];return k}var Zr=(tt=(0,w.b2)(),tt(mt=function(){function J(){(0,W.Z)(this,J),(0,N.Z)(this,"container",void 0),(0,N.Z)(this,"controlCorners",void 0),(0,N.Z)(this,"controlContainer",void 0),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"controls",[]),(0,N.Z)(this,"unAddControls",[])}return(0,L.Z)(J,[{key:"init",value:function(D,k){this.container=D.container,this.scene=k,this.mapsService=k.get(K.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(D,k){var te=k.get(K.v.IMapService);te.map?(D.addTo(this.scene),this.controls.push(D)):this.unAddControls.push(D)}},{key:"getControlByName",value:function(D){return this.controls.find(function(k){return k.controlOption.name===D})}},{key:"removeControl",value:function(D){var k=this.controls.indexOf(D);return k>-1&&this.controls.splice(k,1),D.remove(),this}},{key:"addControls",value:function(){var D=this;this.unAddControls.forEach(function(k){k.addTo(D.scene),D.controls.push(k)}),this.unAddControls=[]}},{key:"destroy",value:function(){var D=yt(this.controls),k;try{for(D.s();!(k=D.n()).done;){var te=k.value;te.remove()}}catch(Ce){D.e(Ce)}finally{D.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var D=this.controlCorners={},k="l7-",te=this.controlContainer=Ne.SO.create("div",k+"control-container",this.container);function Ce(){var st=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],Bt=st.map(function(bt){return k+bt}).join(" ");D[st.join("")]=Ne.SO.create("div",Bt,te)}Ce(["top","left"]),Ce(["top","right"]),Ce(["bottom","left"]),Ce(["bottom","right"]),Ce(["top","center"]),Ce(["right","center"]),Ce(["left","center"]),Ce(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var D in this.controlCorners)this.controlCorners[D]&&Ne.SO.remove(this.controlCorners[D]);this.controlContainer&&Ne.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),J}())||mt),Jr,qr,Er=(Jr=(0,w.b2)(),Jr(qr=function(){function J(){(0,W.Z)(this,J),(0,N.Z)(this,"container",void 0),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"markers",[]),(0,N.Z)(this,"markerLayers",[]),(0,N.Z)(this,"unAddMarkers",[]),(0,N.Z)(this,"unAddMarkerLayers",[])}return(0,L.Z)(J,[{key:"addMarkerLayer",value:function(D){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(D),D.addTo(this.scene)):this.unAddMarkerLayers.push(D)}},{key:"removeMarkerLayer",value:function(D){D.destroy(),this.markerLayers.indexOf(D);var k=this.markerLayers.indexOf(D);k>-1&&this.markerLayers.splice(k,1)}},{key:"addMarker",value:function(D){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(D),D.addTo(this.scene)):this.unAddMarkers.push(D)}},{key:"addMarkers",value:function(){var D=this;this.unAddMarkers.forEach(function(k){k.addTo(D.scene),D.markers.push(k)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var D=this;this.unAddMarkerLayers.forEach(function(k){D.markerLayers.push(k),k.addTo(D.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(D){D.remove(),this.markers.indexOf(D);var k=this.markers.indexOf(D);k>-1&&this.markers.splice(k,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(D){this.scene=D,this.mapsService=D.get(K.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(D){D.remove()}),this.markers=[],this.markerLayers.forEach(function(D){D.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(D){D.destroy()}}]),J}())||qr),Jn,Wn,Ti=(Jn=(0,w.b2)(),Jn(Wn=function(){function J(){(0,W.Z)(this,J),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"popup",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"unAddPopup",void 0)}return(0,L.Z)(J,[{key:"removePopup",value:function(D){D.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(D){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(D.addTo(this.scene),this.popup=D):this.unAddPopup=D}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(D){this.scene=D,this.mapsService=D.get(K.v.IMapService)}}]),J}())||Wn),$i=S(28440),Ji=S.n($i),Pi={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Ri=Pi,Y,ce;function me(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function z(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?me(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):me(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}var oe={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},de={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Ae=(Y=(0,w.b2)(),Y(ce=function(){function J(){(0,W.Z)(this,J),(0,N.Z)(this,"sceneConfigCache",{}),(0,N.Z)(this,"layerConfigCache",{})}return(0,L.Z)(J,[{key:"getSceneConfig",value:function(D){return this.sceneConfigCache[D]}},{key:"getSceneWarninfo",value:function(D){return Ri[D]}},{key:"setSceneConfig",value:function(D,k){this.sceneConfigCache[D]=z(z({},oe),k)}},{key:"getLayerConfig",value:function(D){return this.layerConfigCache[D]}},{key:"setLayerConfig",value:function(D,k,te){this.layerConfigCache[k]=z({},Ji()({},this.sceneConfigCache[D],de,te))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),J}())||ce),se=S(84904),Ee=S(7273),dt=S(86804),br=Math.PI/180,Ht=512,Qt=4003e4;function Rr(J){var Q=J.latitude,D=Q===void 0?0:Q,k=J.zoom,te=k===void 0?0:k,Ce=J.scale,st=J.highPrecision,Bt=st===void 0?!1:st,bt=J.flipY,Kt=bt===void 0?!1:bt;Ce=Ce!==void 0?Ce:Math.pow(2,te);var Ir={},Fn=Ht*Ce,Nn=Math.cos(D*br),fi=Fn/360,si=fi/Nn,yi=Fn/Qt/Nn;if(Ir.pixelsPerMeter=[yi,-yi,yi],Ir.metersPerPixel=[1/yi,-1/yi,1/yi],Ir.pixelsPerDegree=[fi,-si,yi],Ir.degreesPerPixel=[1/fi,-1/si,1/yi],Bt){var Hi=br*Math.tan(D*br)/Nn,ya=fi*Hi/2,_a=Fn/Qt*Hi,Ka=_a/si*yi;Ir.pixelsPerDegree2=[0,-ya,_a],Ir.pixelsPerMeter2=[Ka,0,Ka],Kt&&(Ir.pixelsPerDegree2[1]=-Ir.pixelsPerDegree2[1],Ir.pixelsPerMeter2[1]=-Ir.pixelsPerMeter2[1])}return Kt&&(Ir.pixelsPerMeter[1]=-Ir.pixelsPerMeter[1],Ir.metersPerPixel[1]=-Ir.metersPerPixel[1],Ir.pixelsPerDegree[1]=-Ir.pixelsPerDegree[1],Ir.degreesPerPixel[1]=-Ir.degreesPerPixel[1]),Ir}var kn=S(48216),Ln,$t,Cn,sn,an,Ii=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],xn=(Ln=(0,w.b2)(),$t=(0,w.f3)(K.v.ICameraService),Ln(Cn=(sn=function(){function J(){(0,W.Z)(this,J),(0,N.Z)(this,"needRefresh",!0),(0,se.Z)(this,"cameraService",an,this),(0,N.Z)(this,"coordinateSystem",void 0),(0,N.Z)(this,"viewportCenter",void 0),(0,N.Z)(this,"viewportCenterProjection",void 0),(0,N.Z)(this,"pixelsPerDegree",void 0),(0,N.Z)(this,"pixelsPerDegree2",void 0),(0,N.Z)(this,"pixelsPerMeter",void 0)}return(0,L.Z)(J,[{key:"refresh",value:function(){var D=this.cameraService.getZoom(),k=this.cameraService.getZoomScale(),te=this.cameraService.getCenter(),Ce=Rr({latitude:te[1],zoom:D}),st=Ce.pixelsPerMeter,Bt=Ce.pixelsPerDegree;this.viewportCenter=te,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=st,this.pixelsPerDegree=Bt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===kn.l.LNGLAT||this.coordinateSystem===kn.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===kn.l.LNGLAT_OFFSET?this.calculateLnglatOffset(te,D):this.coordinateSystem===kn.l.P20_OFFSET&&this.calculateLnglatOffset(te,D,k,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(D){this.coordinateSystem=D}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(D,k,te,Ce){var st=Rr({latitude:D[1],zoom:k,scale:te,flipY:Ce,highPrecision:!0}),Bt=st.pixelsPerMeter,bt=st.pixelsPerDegree,Kt=st.pixelsPerDegree2,Ir=this.cameraService.getViewMatrix(),Fn=this.cameraService.getProjectionMatrix(),Nn=ie.multiply([],Fn,Ir),fi=this.cameraService.projectFlat([Math.fround(D[0]),Math.fround(D[1])],Math.pow(2,k));this.viewportCenterProjection=dt.fF([],[fi[0],fi[1],0,1],Nn),Ir=this.cameraService.getViewMatrixUncentered()||Ir,Nn=ie.multiply([],Fn,Ir),Nn=ie.multiply([],Nn,Ii),this.cameraService.setViewProjectionMatrix(Nn),this.pixelsPerMeter=Bt,this.pixelsPerDegree=bt,this.pixelsPerDegree2=Kt}}]),J}(),an=(0,Ee.Z)(sn.prototype,"cameraService",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sn))||Cn),Ai=S(83959),Qi=S.n(Ai),li=S(90511),Yi,Bi,wi,sa,Fi;function ni(J){var Q=Di();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function Di(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var Ei={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},no=(Yi=(0,w.b2)(),Bi=(0,w.f3)(K.v.IMapService),Yi(wi=(sa=function(J){(0,It.Z)(D,J);var Q=ni(D);function D(){var k;(0,W.Z)(this,D);for(var te=arguments.length,Ce=new Array(te),st=0;st<te;st++)Ce[st]=arguments[st];return k=Q.call.apply(Q,[this].concat(Ce)),(0,se.Z)((0,Le.Z)(k),"mapService",Fi,(0,Le.Z)(k)),(0,N.Z)((0,Le.Z)(k),"hammertime",void 0),(0,N.Z)((0,Le.Z)(k),"lastClickTime",0),(0,N.Z)((0,Le.Z)(k),"lastClickXY",[-1,-1]),(0,N.Z)((0,Le.Z)(k),"clickTimer",void 0),(0,N.Z)((0,Le.Z)(k),"$containter",void 0),(0,N.Z)((0,Le.Z)(k),"onDrag",function(Bt){var bt=k.interactionEvent(Bt);bt.type=Ei[bt.type],k.emit(li.s.Drag,bt)}),(0,N.Z)((0,Le.Z)(k),"onHammer",function(Bt){Bt.srcEvent.stopPropagation();var bt=k.interactionEvent(Bt);k.emit(li.s.Hover,bt)}),(0,N.Z)((0,Le.Z)(k),"onTouch",function(Bt){var bt=Bt.touches[0];k.onHover({x:bt.pageX,y:bt.pageY,type:"touch"})}),(0,N.Z)((0,Le.Z)(k),"onHover",function(Bt){var bt=Bt.clientX,Kt=Bt.clientY,Ir=bt,Fn=Kt,Nn=Bt.type,fi=k.mapService.getMapContainer();if(fi){var si=fi.getBoundingClientRect(),yi=si.top,Hi=si.left;Ir=Ir-Hi-fi.clientLeft,Fn=Fn-yi-fi.clientTop}var ya=k.mapService.containerToLngLat([Ir,Fn]);if(Nn==="click"){if("ontouchstart"in document.documentElement)return;k.isDoubleTap(Ir,Fn,ya);return}if(Nn==="touch"){k.isDoubleTap(Ir,Fn,ya);return}Nn!=="click"&&Nn!=="dblclick"&&k.emit(li.s.Hover,{x:Ir,y:Fn,lngLat:ya,type:Nn,target:Bt})}),k}return(0,L.Z)(D,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(li.s.Hover)}},{key:"triggerHover",value:function(te){var Ce=te.x,st=te.y;this.emit(li.s.Hover,{x:Ce,y:st})}},{key:"triggerSelect",value:function(te){this.emit(li.s.Select,{featureId:te})}},{key:"triggerActive",value:function(te){this.emit(li.s.Active,{featureId:te})}},{key:"addEventListenerOnMap",value:function(){var te=this.mapService.getMapContainer();if(te){var Ce=new(Qi()).Manager(te);Ce.add(new(Qi()).Tap({event:"dblclick",taps:2})),Ce.add(new(Qi()).Tap({event:"click"})),Ce.add(new(Qi()).Pan({threshold:0,pointers:0})),Ce.add(new(Qi()).Press({})),Ce.on("dblclick click",this.onHammer),Ce.on("panstart panmove panend pancancel",this.onDrag),te.addEventListener("mousemove",this.onHover),te.addEventListener("mousedown",this.onHover,!0),te.addEventListener("mouseup",this.onHover),te.addEventListener("contextmenu",this.onHover),this.hammertime=Ce}}},{key:"removeEventListenerOnMap",value:function(){var te=this.mapService.getMapContainer();te&&(te.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),te.removeEventListener("mousedown",this.onHover),te.removeEventListener("mouseup",this.onHover),te.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(te){var Ce=te.type,st=te.pointerType,Bt,bt;st==="touch"?(bt=Math.floor(te.pointers[0].clientY),Bt=Math.floor(te.pointers[0].clientX)):(bt=Math.floor(te.srcEvent.y),Bt=Math.floor(te.srcEvent.x));var Kt=this.mapService.getMapContainer();if(Kt){var Ir=Kt.getBoundingClientRect(),Fn=Ir.top,Nn=Ir.left;Bt-=Nn,bt-=Fn}var fi=this.mapService.containerToLngLat([Bt,bt]);return{x:Bt,y:bt,lngLat:fi,type:Ce,target:te.srcEvent}}},{key:"isDoubleTap",value:function(te,Ce,st){var Bt=this,bt=new Date().getTime(),Kt="click";bt-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-te)<10&&Math.abs(this.lastClickXY[1]-Ce)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),Kt="dblclick",this.emit(li.s.Hover,{x:te,y:Ce,lngLat:st,type:Kt})):(this.lastClickTime=bt,this.lastClickXY=[te,Ce],this.clickTimer=setTimeout(function(){Kt="click",Bt.emit(li.s.Hover,{x:te,y:Ce,lngLat:st,type:Kt})},400))}}]),D}(p()),Fi=(0,Ee.Z)(sa.prototype,"mapService",[Bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sa))||wi),ho=S(30513),ta=S(90122),Vi=S.n(ta),Ns=window.document.documentElement.style,tu=0;function Aa(J){var Q=J;if(typeof J=="string"&&(Q=document.getElementById(J)),Q){var D=document.createElement("div");return D.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,D.id="l7-scene-".concat(tu++),D.classList.add("l7-scene"),Q.appendChild(D),D}return null}function No(J){var Q,D,k=!0;return J==null||(Q=J.target)===null||Q===void 0||(D=Q.path)===null||D===void 0||D.map(function(te){if(te!=null&&te.classList){var Ce;te==null||(Ce=te.classList)===null||Ce===void 0||Ce.forEach(function(st){(st==="l7-marker"||st==="l7-popup")&&(k=!1)})}}),k}var Gi=S(13027),Wa,oo,ma,Lo,ka,bs,ki,Ko,ga,po,Da;function So(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function ye(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?So(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):So(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}var De=(Wa=(0,w.b2)(),oo=(0,w.f3)(K.v.IRendererService),ma=(0,w.f3)(K.v.IGlobalConfigService),Lo=(0,w.f3)(K.v.IInteractionService),ka=(0,w.f3)(K.v.ILayerService),Wa(bs=(ki=function(){function J(){var Q=this;(0,W.Z)(this,J),(0,se.Z)(this,"rendererService",Ko,this),(0,se.Z)(this,"configService",ga,this),(0,se.Z)(this,"interactionService",po,this),(0,se.Z)(this,"layerService",Da,this),(0,N.Z)(this,"pickingFBO",void 0),(0,N.Z)(this,"width",0),(0,N.Z)(this,"height",0),(0,N.Z)(this,"alreadyInPicking",!1),(0,N.Z)(this,"pickBufferScale",1),(0,N.Z)(this,"pickFromPickingFBO",function(D,k){var te,Ce=k.x,st=k.y,Bt=k.lngLat,bt=k.type,Kt=k.target,Ir=!1,Fn=Q.rendererService,Nn=Fn.getViewportSize,fi=Fn.readPixels,si=Fn.getContainer,yi=si().getBoundingClientRect(),Hi=yi.width,ya=yi.height;Hi*=Ne.SO.DPR,ya*=Ne.SO.DPR;var _a=D.getLayerConfig(),Ka=_a.enableHighlight,Ba=_a.enableSelect,wo=Ce*Ne.SO.DPR,La=st*Ne.SO.DPR;if(wo>Hi-1*Ne.SO.DPR||wo<0||La>ya-1*Ne.SO.DPR||La<0)return!1;var Sa;if(Sa=fi({x:Math.floor(wo/Q.pickBufferScale),y:Math.floor((ya-(st+1)*Ne.SO.DPR)/Q.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:Q.pickingFBO}),Sa[0]!==0||Sa[1]!==0||Sa[2]!==0){var la=(0,Ne.W0)(Sa),va=D.getSource().getFeatureById(la);la!==D.getCurrentPickId()&&bt==="mousemove"&&(bt="mouseenter");var Ga={x:Ce,y:st,type:bt,lngLat:Bt,featureId:la,feature:va,target:Kt};va&&(Ir=!0,D.setCurrentPickId(la),Q.triggerHoverOnLayer(D,Ga))}else{var Na={x:Ce,y:st,lngLat:Bt,type:D.getCurrentPickId()!==null&&bt==="mousemove"?"mouseout":"un"+bt,featureId:null,target:Kt,feature:null};Q.triggerHoverOnLayer(D,ye(ye({},Na),{},{type:"unpick"})),Q.triggerHoverOnLayer(D,Na),D.setCurrentPickId(null)}if(Ka&&Q.highlightPickedFeature(D,Sa),Ba&&bt==="click"&&((te=Sa)===null||te===void 0?void 0:te.toString())!==[0,0,0,0].toString()){var ko=(0,Ne.W0)(Sa);D.getCurrentSelectedId()===null||ko!==D.getCurrentSelectedId()?(Q.selectFeature(D,Sa),D.setCurrentSelectedId(ko)):(Q.selectFeature(D,new Uint8Array([0,0,0,0])),D.setCurrentSelectedId(null))}return Ir})}return(0,L.Z)(J,[{key:"init",value:function(D){var k=this.rendererService,te=k.createTexture2D,Ce=k.createFramebuffer,st=k.getViewportSize,Bt=k.getContainer,bt=Bt().getBoundingClientRect(),Kt=bt.width,Ir=bt.height;Kt*=Ne.SO.DPR,Ir*=Ne.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(D).pickBufferScale||1,this.pickingFBO=Ce({color:te({width:Math.round(Kt/this.pickBufferScale),height:Math.round(Ir/this.pickBufferScale),wrapS:Gi.gl.CLAMP_TO_EDGE,wrapT:Gi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(li.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var Q=(0,ho.Z)(Vi().mark(function k(te,Ce,st){var Bt=this,bt,Kt,Ir,Fn;return Vi().wrap(function(fi){for(;;)switch(fi.prev=fi.next){case 0:bt=this.rendererService,Kt=bt.useFramebuffer,Ir=bt.clear,Fn=bt.getContainer,this.resizePickingFBO(),Kt(this.pickingFBO,function(){Ir({framebuffer:Bt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),te.hooks.beforePickingEncode.call(),te.renderModels(),te.hooks.afterPickingEncode.call();var si=Bt.pickBox(te,Ce);st(si)});case 3:case"end":return fi.stop()}},k,this)}));function D(k,te,Ce){return Q.apply(this,arguments)}return D}()},{key:"pickBox",value:function(D,k){var te=this,Ce=k.map(function(Na){var ko=Na<0?0:Na;return Math.floor(ko*Ne.SO.DPR/te.pickBufferScale)}),st=(0,qt.Z)(Ce,4),Bt=st[0],bt=st[1],Kt=st[2],Ir=st[3],Fn=this.rendererService,Nn=Fn.getViewportSize,fi=Fn.readPixels,si=Fn.getContainer,yi=si().getBoundingClientRect(),Hi=yi.width,ya=yi.height;if(Hi*=Ne.SO.DPR,ya*=Ne.SO.DPR,Bt>(Hi-1)*Ne.SO.DPR/this.pickBufferScale||Kt<0||bt>(ya-1)*Ne.SO.DPR/this.pickBufferScale||Ir<0)return[];var _a,Ka=Math.min(Hi/this.pickBufferScale,Kt)-Bt,Ba=Math.min(ya/this.pickBufferScale,Ir)-bt;_a=fi({x:Bt,y:Math.floor(ya/this.pickBufferScale-(Ir+1)),width:Ka,height:Ba,data:new Uint8Array(Ka*Ba*4),framebuffer:this.pickingFBO});for(var wo=[],La={},Sa=0;Sa<_a.length/4;Sa=Sa+1){var la=_a.slice(Sa*4,Sa*4+4),va=(0,Ne.W0)(la);if(va!==-1&&!La[va]){var Ga=D.getSource().getFeatureById(va);wo.push(Ga),La[va]=!0}}return wo}},{key:"pickingAllLayer",value:function(){var Q=(0,ho.Z)(Vi().mark(function k(te){return Vi().wrap(function(st){for(;;)switch(st.prev=st.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){st.next=2;break}return st.abrupt("return");case 2:return this.alreadyInPicking=!0,st.next=5,this.pickingLayers(te);case 5:this.layerService.renderLayers("picking"),this.alreadyInPicking=!1;case 7:case"end":return st.stop()}},k,this)}));function D(k){return Q.apply(this,arguments)}return D}()},{key:"resizePickingFBO",value:function(){var D=this.rendererService.getContainer,k=D().getBoundingClientRect(),te=k.width,Ce=k.height;te*=Ne.SO.DPR,Ce*=Ne.SO.DPR,(this.width!==te||this.height!==Ce)&&(this.pickingFBO.resize({width:Math.round(te/this.pickBufferScale),height:Math.round(Ce/this.pickBufferScale)}),this.width=te,this.height=Ce)}},{key:"pickingLayers",value:function(){var Q=(0,ho.Z)(Vi().mark(function k(te){var Ce=this,st,Bt,bt,Kt,Ir;return Vi().wrap(function(Nn){for(;;)switch(Nn.prev=Nn.next){case 0:st=this.rendererService,Bt=st.getViewportSize,bt=st.useFramebuffer,Kt=st.clear,Ir=st.getContainer,this.resizePickingFBO(),bt(this.pickingFBO,function(){var fi=Ce.layerService.getLayers();fi.filter(function(si){return si.needPick(te.type)}).reverse().some(function(si){Kt({framebuffer:Ce.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),si.hooks.beforePickingEncode.call(),si.renderModels(),si.hooks.afterPickingEncode.call();var yi=Ce.pickFromPickingFBO(si,te);return yi&&!si.getLayerConfig().enablePropagation})});case 3:case"end":return Nn.stop()}},k,this)}));function D(k){return Q.apply(this,arguments)}return D}()},{key:"triggerHoverOnLayer",value:function(D,k){No(k)&&D.emit(k.type,k)}},{key:"highlightPickedFeature",value:function(D,k){var te=(0,qt.Z)(k,3),Ce=te[0],st=te[1],Bt=te[2];D.hooks.beforeHighlight.call([Ce,st,Bt])}},{key:"selectFeature",value:function(D,k){var te=(0,qt.Z)(k,3),Ce=te[0],st=te[1],Bt=te[2];D.hooks.beforeSelect.call([Ce,st,Bt])}}]),J}(),Ko=(0,Ee.Z)(ki.prototype,"rendererService",[oo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ga=(0,Ee.Z)(ki.prototype,"configService",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),po=(0,Ee.Z)(ki.prototype,"interactionService",[Lo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Da=(0,Ee.Z)(ki.prototype,"layerService",[ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ki))||bs),ct=function(){function J(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,W.Z)(this,J),(0,N.Z)(this,"autoStart",void 0),(0,N.Z)(this,"startTime",0),(0,N.Z)(this,"oldTime",0),(0,N.Z)(this,"running",!1),(0,N.Z)(this,"elapsedTime",0),this.autoStart=Q}return(0,L.Z)(J,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var D=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var k=(typeof performance=="undefined"?Date:performance).now();D=(k-this.oldTime)/1e3,this.oldTime=k,this.elapsedTime+=D}return D}}]),J}(),Yt,Wr,Qn,Si,Za,vo,so,es=(Yt=(0,w.b2)(),Wr=(0,w.f3)(K.v.IRendererService),Qn=(0,w.f3)(K.v.IGlobalConfigService),Yt(Si=(Za=function(){function J(){(0,W.Z)(this,J),(0,N.Z)(this,"clock",new ct),(0,N.Z)(this,"alreadyInRendering",!1),(0,N.Z)(this,"layers",[]),(0,N.Z)(this,"layerRenderID",void 0),(0,N.Z)(this,"sceneInited",!1),(0,N.Z)(this,"animateInstanceCount",0),(0,N.Z)(this,"lastRenderType",void 0),(0,N.Z)(this,"lastPickRenderTime",void 0),(0,se.Z)(this,"renderService",vo,this),(0,se.Z)(this,"configService",so,this)}return(0,L.Z)(J,[{key:"add",value:function(D){this.sceneInited&&D.init(),this.layers.push(D)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(D){D.inited||D.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(D){return this.layers.find(function(k){return k.id===D})}},{key:"getLayerByName",value:function(D){return this.layers.find(function(k){return k.name===D})}},{key:"remove",value:function(D){var k=this.layers.indexOf(D);k>-1&&this.layers.splice(k,1),D.emit("remove",null),D.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(D){!this.renderTest(D)||this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(k){return k.inited}).filter(function(k){return k.isVisible()}).forEach(function(k){k.hooks.beforeRenderData.call(),k.hooks.beforeRender.call(),k.render(),k.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(D,k){return D.zIndex-k.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(D){return D.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"renderTest",value:function(D){var k=new Date().getTime(),te=k-this.lastPickRenderTime;if(D==="picking"&&(this.lastPickRenderTime=new Date().getTime()),D)switch(D){case"picking":return this.lastRenderType==="mapRender"||this.lastRenderType==="animate"?(this.lastRenderType="picking",te>48):(this.lastRenderType="picking",!0);case"animate":return this.lastRenderType==="mapRender"?(this.lastRenderType="animate",!1):(this.lastRenderType="animate",!0);case"mapRender":return this.lastRenderType="mapRender",!0;default:return!0}return!0}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers("animate"),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),J}(),vo=(0,Ee.Z)(Za.prototype,"renderService",[Wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so=(0,Ee.Z)(Za.prototype,"configService",[Qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Za))||Si),Hs=S(96320),ja=S(10971),Bu=S(93544),ts=S.n(Bu),zo=function(){function J(Q){var D=this;(0,W.Z)(this,J),(0,N.Z)(this,"name",void 0),(0,N.Z)(this,"type",void 0),(0,N.Z)(this,"scale",void 0),(0,N.Z)(this,"descriptor",void 0),(0,N.Z)(this,"featureBufferLayout",[]),(0,N.Z)(this,"needRescale",!1),(0,N.Z)(this,"needRemapping",!1),(0,N.Z)(this,"needRegenerateVertices",!1),(0,N.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,N.Z)(this,"vertexAttribute",void 0),(0,N.Z)(this,"defaultCallback",function(k){if(k.length===0){var te;return((te=D.scale)===null||te===void 0?void 0:te.defaultValues)||[]}return k.map(function(Ce,st){var Bt,bt=(Bt=D.scale)===null||Bt===void 0?void 0:Bt.scalers[st].func,Kt=bt(Ce);return Kt})}),this.setProps(Q)}return(0,L.Z)(J,[{key:"setProps",value:function(D){Object.assign(this,D)}},{key:"mapping",value:function(D){var k;if((k=this.scale)!==null&&k!==void 0&&k.callback){var te,Ce=(te=this.scale)===null||te===void 0?void 0:te.callback.apply(te,(0,ja.Z)(D));if(!ts()(Ce))return[Ce]}return this.defaultCallback(D)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),J}(),uo,ii,ms,rs,Rs,ns;function Ta(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function lo(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?Ta(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):Ta(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}function _l(J){return new Promise(function(Q){return setTimeout(Q,J)})}var xl=(uo={},(0,N.Z)(uo,Gi.gl.FLOAT,4),(0,N.Z)(uo,Gi.gl.UNSIGNED_BYTE,1),(0,N.Z)(uo,Gi.gl.UNSIGNED_SHORT,2),uo),Nu=(ii=(0,w.b2)(),ms=(0,w.f3)(K.v.IRendererService),ii(rs=(Rs=function(){function J(){(0,W.Z)(this,J),(0,N.Z)(this,"attributesAndIndices",void 0),(0,se.Z)(this,"rendererService",ns,this),(0,N.Z)(this,"attributes",[]),(0,N.Z)(this,"triangulation",void 0),(0,N.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,L.Z)(J,[{key:"registerStyleAttribute",value:function(D){var k=this.getLayerStyleAttribute(D.name||"");return k?k.setProps(D):(k=new zo(D),this.attributes.push(k)),k}},{key:"updateStyleAttribute",value:function(D,k,te){var Ce=this.getLayerStyleAttribute(D);Ce||(Ce=this.registerStyleAttribute(lo(lo({},k),{},{name:D})));var st=k.scale;st&&Ce&&(Ce.scale=st,Ce.needRescale=!0,Ce.needRemapping=!0,Ce.needRegenerateVertices=!0,te&&te.featureRange&&(Ce.featureRange=te.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(D){return this.attributes.find(function(k){return k.name===D})}},{key:"getLayerAttributeScale",value:function(D){var k,te=this.getLayerStyleAttribute(D),Ce=te==null||(k=te.scale)===null||k===void 0?void 0:k.scalers;return Ce&&Ce[0]?Ce[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(D,k){var te=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,Ce=arguments.length>3?arguments[3]:void 0,st=this.attributes.find(function(Ba){return Ba.name===D});if(st&&st.descriptor){var Bt=st.descriptor,bt=Bt.update,Kt=Bt.buffer,Ir=Bt.size,Fn=Ir===void 0?0:Ir,Nn=xl[Kt.type||Gi.gl.FLOAT];if(bt){var fi=this.featureLayout,si=fi.elements,yi=fi.sizePerElement,Hi=si.slice(te,Ce);if(!Hi.length)return;var ya=Hi[0].offset,_a=ya*Fn*Nn,Ka=Hi.map(function(Ba,wo){for(var La=Ba.featureIdx,Sa=Ba.vertices,la=Ba.normals,va=Sa.length/yi,Ga=[],Na=0;Na<va;Na++){var ko=la?la.slice(Na*3,Na*3+3):[];Ga.push.apply(Ga,(0,ja.Z)(bt(k[La],La,Sa.slice(Na*yi,Na*yi+yi),wo,ko)))}return Ga}).reduce(function(Ba,wo){return Ba.push.apply(Ba,(0,ja.Z)(wo)),Ba},[]);st.vertexAttribute.updateBuffer({data:Ka,offset:_a})}}}},{key:"createAttributesAndIndices",value:function(D,k,te){var Ce=this;this.featureLayout={sizePerElement:0,elements:[]},k&&(this.triangulation=k);var st=this.attributes.map(function(_a){return _a.resetDescriptor(),_a.descriptor}),Bt=0,bt=[],Kt=[],Ir=[],Fn=3;D.forEach(function(_a,Ka){var Ba=Ce.triangulation(_a,te),wo=Ba.indices,La=Ba.vertices,Sa=Ba.normals,la=Ba.size;wo.forEach(function(ko){Kt.push(ko+Bt)}),Fn=la;var va=La.length/la;Ce.featureLayout.sizePerElement=Fn,Ce.featureLayout.elements.push({featureIdx:Ka,vertices:La,normals:Sa,offset:Bt}),Bt+=va;for(var Ga=function(Ui){var $o=(Sa==null?void 0:Sa.slice(Ui*3,Ui*3+3))||[],Po=La.slice(Ui*la,Ui*la+la);st.forEach(function(Ao,Tc){if(Ao&&Ao.update){var ku;(ku=Ao.buffer.data).push.apply(ku,(0,ja.Z)(Ao.update(_a,Ka,Po,Ui,$o)))}})},Na=0;Na<va;Na++)Ga(Na)});var Nn=this.rendererService,fi=Nn.createAttribute,si=Nn.createBuffer,yi=Nn.createElements,Hi={};st.forEach(function(_a,Ka){if(_a){var Ba=_a.buffer,wo=_a.update,La=_a.name,Sa=(0,Hs.Z)(_a,["buffer","update","name"]),la=fi(lo({buffer:si(Ba)},Sa));Hi[_a.name||""]=la,Ce.attributes[Ka].vertexAttribute=la}});var ya=yi({data:Kt,type:Gi.gl.UNSIGNED_INT,count:Kt.length});return this.attributesAndIndices={attributes:Hi,elements:ya},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var D;this.attributes.forEach(function(k){k.vertexAttribute&&k.vertexAttribute.destroy()}),(D=this.attributesAndIndices)===null||D===void 0||D.elements.destroy(),this.attributes=[]}}]),J}(),ns=(0,Ee.Z)(Rs.prototype,"rendererService",[ms],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rs))||rs),Gl=S(65859),wu=S(67499),co=S.n(wu),zs,Ss,m,A,j,O,le,Ie,ut,Pt,Ot,Ar,jr,qn,gi,wn,fa,Ni,Oa,ua,Xa,is,Es,Au,cu,nl,Ws,Xs,Ys,za,il,al,ds;function Hl(J){var Q=fu();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function fu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var Ds=(zs=(0,w.b2)(),Ss=(0,w.f3)(K.v.SceneID),m=(0,w.f3)(K.v.IIconService),A=(0,w.f3)(K.v.IFontService),j=(0,w.f3)(K.v.IControlService),O=(0,w.f3)(K.v.IGlobalConfigService),le=(0,w.f3)(K.v.IMapService),Ie=(0,w.f3)(K.v.ICoordinateSystemService),ut=(0,w.f3)(K.v.IRendererService),Pt=(0,w.f3)(K.v.ILayerService),Ot=(0,w.f3)(K.v.ICameraService),Ar=(0,w.f3)(K.v.IInteractionService),jr=(0,w.f3)(K.v.IPickingService),qn=(0,w.f3)(K.v.IShaderModuleService),gi=(0,w.f3)(K.v.IMarkerService),wn=(0,w.f3)(K.v.IPopupService),zs(fa=(Ni=function(J){(0,It.Z)(D,J);var Q=Hl(D);function D(){var k;return(0,W.Z)(this,D),k=Q.call(this),(0,N.Z)((0,Le.Z)(k),"destroyed",!1),(0,N.Z)((0,Le.Z)(k),"loaded",!1),(0,N.Z)((0,Le.Z)(k),"loadFont",!1),(0,N.Z)((0,Le.Z)(k),"fontFamily",""),(0,se.Z)((0,Le.Z)(k),"id",Oa,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"iconService",ua,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"fontService",Xa,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"controlService",is,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"configService",Es,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"map",Au,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"coordinateSystemService",cu,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"rendererService",nl,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"layerService",Ws,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"cameraService",Xs,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"interactionService",Ys,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"pickingService",za,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"shaderModuleService",il,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"markerService",al,(0,Le.Z)(k)),(0,se.Z)((0,Le.Z)(k),"popupService",ds,(0,Le.Z)(k)),(0,N.Z)((0,Le.Z)(k),"inited",!1),(0,N.Z)((0,Le.Z)(k),"initPromise",void 0),(0,N.Z)((0,Le.Z)(k),"rendering",!1),(0,N.Z)((0,Le.Z)(k),"$container",void 0),(0,N.Z)((0,Le.Z)(k),"canvas",void 0),(0,N.Z)((0,Le.Z)(k),"markerContainer",void 0),(0,N.Z)((0,Le.Z)(k),"hooks",void 0),(0,N.Z)((0,Le.Z)(k),"handleWindowResized",function(){k.emit("resize"),k.$container&&(k.initContainer(),Ne.SO.triggerResize(),k.coordinateSystemService.needRefresh=!0,k.render())}),(0,N.Z)((0,Le.Z)(k),"handleMapCameraChanged",function(te){k.cameraService.update(te),k.render("mapRender")}),k.hooks={init:new Gl.zj},k}return(0,L.Z)(D,[{key:"init",value:function(te){var Ce=this;this.configService.setSceneConfig(this.id,te),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,ho.Z)(Vi().mark(function st(){return Vi().wrap(function(bt){for(;;)switch(bt.prev=bt.next){case 0:return bt.next=2,new Promise(function(Kt){Ce.map.onCameraChanged(function(Ir){Ce.cameraService.init(),Ce.cameraService.update(Ir),Ce.map.version!=="GAODE2.x"&&Kt()}),Ce.map.version!=="GAODE2.x"?Ce.map.init():Kt()});case 2:if(!(Ce.map.version==="GAODE2.x"&&Ce.map.initViewPort)){bt.next=6;break}return bt.next=5,Ce.map.init();case 5:Ce.map.initViewPort();case 6:Ce.map.onCameraChanged(Ce.handleMapCameraChanged),Ce.map.addMarkerContainer(),Ce.markerService.addMarkers(),Ce.markerService.addMarkerLayers(),Ce.popupService.initPopup(),Ce.interactionService.init(),Ce.interactionService.on(li.s.Drag,Ce.addSceneEvent.bind(Ce));case 13:case"end":return bt.stop()}},st)}))),this.hooks.init.tapPromise("initRenderer",(0,ho.Z)(Vi().mark(function st(){var Bt;return Vi().wrap(function(Kt){for(;;)switch(Kt.prev=Kt.next){case 0:if(Bt=Aa(Ce.configService.getSceneConfig(Ce.id).id||""),Ce.$container=Bt,!Bt){Kt.next=11;break}return Ce.canvas=Ne.SO.create("canvas","",Bt),Ce.setCanvas(),Kt.next=7,Ce.rendererService.init(Ce.canvas,Ce.configService.getSceneConfig(Ce.id));case 7:co()(Ce.$container,Ce.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(Ce.handleWindowResized),Kt.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:Ce.pickingService.init(Ce.id);case 13:case"end":return Kt.stop()}},st)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(te){this.layerService.add(te),this.render()}},{key:"render",value:function(){var k=(0,ho.Z)(Vi().mark(function Ce(st){return Vi().wrap(function(bt){for(;;)switch(bt.prev=bt.next){case 0:if(!(this.rendering||this.destroyed)){bt.next=2;break}return bt.abrupt("return");case 2:if(this.rendering=!0,this.inited){bt.next=15;break}return bt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){bt.next=10;break}return bt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(st),this.rendering=!1;case 17:case"end":return bt.stop()}},Ce,this)}));function te(Ce){return k.apply(this,arguments)}return te}()},{key:"addFontFace",value:function(te,Ce){this.fontFamily=te;var st=document.createElement("style");st.type="text/css",st.innerText=`
        @font-face{
            font-family: '`.concat(te,`';
            src: url('`).concat(Ce,`') format('woff2'),
            url('`).concat(Ce,`') format('woff'),
            url('`).concat(Ce,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(st),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(te){var Ce,st=(Ce=this.$container)===null||Ce===void 0?void 0:Ce.getElementsByTagName("canvas")[0];this.render();var Bt=te==="jpg"?st==null?void 0:st.toDataURL("image/jpeg"):st==null?void 0:st.toDataURL("image/png");return Bt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var te=this.$container.parentElement;te!==null&&(this.markerContainer=Ne.SO.create("div","l7-marker-container",te))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var te,Ce;if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(te=this.$container)===null||te===void 0||(Ce=te.parentNode)===null||Ce===void 0||Ce.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,wu.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var te,Ce,st=Ne.SO.DPR,Bt=((te=this.$container)===null||te===void 0?void 0:te.clientWidth)||400,bt=((Ce=this.$container)===null||Ce===void 0?void 0:Ce.clientHeight)||300,Kt=this.canvas;Kt&&(Kt.width=Bt*st,Kt.height=bt*st,Kt.style.width="".concat(Bt,"px"),Kt.style.height="".concat(bt,"px")),this.rendererService.viewport({x:0,y:0,width:st*Bt,height:st*bt})}},{key:"setCanvas",value:function(){var te,Ce,st=Ne.SO.DPR,Bt=((te=this.$container)===null||te===void 0?void 0:te.clientWidth)||400,bt=((Ce=this.$container)===null||Ce===void 0?void 0:Ce.clientHeight)||300,Kt=this.canvas;Kt.width=Bt*st,Kt.height=bt*st,Kt.style.width="".concat(Bt,"px"),Kt.style.height="".concat(bt,"px")}},{key:"addSceneEvent",value:function(te){this.emit(te.type,te)}}]),D}(C.EventEmitter),Oa=(0,Ee.Z)(Ni.prototype,"id",[Ss],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ua=(0,Ee.Z)(Ni.prototype,"iconService",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xa=(0,Ee.Z)(Ni.prototype,"fontService",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),is=(0,Ee.Z)(Ni.prototype,"controlService",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Es=(0,Ee.Z)(Ni.prototype,"configService",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Au=(0,Ee.Z)(Ni.prototype,"map",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cu=(0,Ee.Z)(Ni.prototype,"coordinateSystemService",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nl=(0,Ee.Z)(Ni.prototype,"rendererService",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ws=(0,Ee.Z)(Ni.prototype,"layerService",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xs=(0,Ee.Z)(Ni.prototype,"cameraService",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ys=(0,Ee.Z)(Ni.prototype,"interactionService",[Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),za=(0,Ee.Z)(Ni.prototype,"pickingService",[jr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),il=(0,Ee.Z)(Ni.prototype,"shaderModuleService",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),al=(0,Ee.Z)(Ni.prototype,"markerService",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ds=(0,Ee.Z)(Ni.prototype,"popupService",[wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ni))||fa),mc=S(21691),Tu=S.n(mc);function Ma(J){var Q=0;switch(J){case"vec2":case"ivec2":Q=2;break;case"vec3":case"ivec3":Q=3;break;case"vec4":case"ivec4":case"mat2":Q=4;break;case"mat3":Q=9;break;case"mat4":Q=16;break;default:}return Q}var ol=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Fc(J){var Q={};return J=J.replace(ol,function(D,k,te){var Ce=te.split(":"),st=Ce[0].trim(),Bt="";switch(Ce.length>1&&(Bt=Ce[1].trim()),k){case"bool":Bt=Bt==="true";break;case"float":case"int":Bt=Number(Bt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Bt?Bt=Bt.replace("[","").replace("]","").split(",").reduce(function(bt,Kt){return bt.push(Number(Kt.trim())),bt},[]):Bt=new Array(Ma(k)).fill(0);break;default:}return Q[st]=Bt,"uniform ".concat(k," ").concat(st,`;
`)}),{content:J,uniforms:Q}}var hu,Wl;function Bc(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function zu(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?Bc(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):Bc(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}var Xl="#define PI 3.14159265359",bl=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Sl=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,sl=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,El=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,Uu=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,pu=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,ul=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Us=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,gc=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,yc=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Nc=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Zu=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Cl=/precision\s+(high|low|medium)p\s+float/,Yl=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,_c=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Kl=(hu=(0,w.b2)(),hu(Wl=function(){function J(){(0,W.Z)(this,J),(0,N.Z)(this,"moduleCache",{}),(0,N.Z)(this,"rawContentCache",{})}return(0,L.Z)(J,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Xl,fs:Xl}),this.registerModule("decode",{vs:bl,fs:""}),this.registerModule("projection",{vs:ul,fs:""}),this.registerModule("project",{vs:pu,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Us}),this.registerModule("lighting",{vs:sl,fs:""}),this.registerModule("light",{vs:Sl,fs:""}),this.registerModule("picking",{vs:Uu,fs:El}),this.registerModule("styleMapping",{vs:gc,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:yc,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Nc,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Zu,fs:""})}},{key:"registerModule",value:function(D,k){if(!this.rawContentCache[D]){var te=k.vs,Ce=k.fs,st=k.uniforms,Bt=Fc(te),bt=Bt.content,Kt=Bt.uniforms,Ir=Fc(Ce),Fn=Ir.content,Nn=Ir.uniforms;this.rawContentCache[D]={fs:Fn,uniforms:zu(zu(zu({},Kt),Nn),st),vs:bt}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(D){var k=this;if(this.moduleCache[D])return this.moduleCache[D];var te=this.rawContentCache[D].vs,Ce=this.rawContentCache[D].fs,st=this.processModule(te,[],"vs"),Bt=st.content,bt=st.includeList,Kt=this.processModule(Ce,[],"fs"),Ir=Kt.content,Fn=Kt.includeList,Nn=Ir,fi=Tu()(bt.concat(Fn).concat(D)).reduce(function(si,yi){return zu(zu({},si),k.rawContentCache[yi].uniforms)},{});return Cl.test(Ir)||(Nn=Yl+Ir),this.moduleCache[D]={fs:Nn.trim(),uniforms:fi,vs:Bt.trim()},this.moduleCache[D]}},{key:"processModule",value:function(D,k,te){var Ce=this,st=D.replace(_c,function(Bt,bt){var Kt=bt.split(" "),Ir=Kt[0].replace(/"/g,"");if(k.indexOf(Ir)>-1)return"";var Fn=Ce.rawContentCache[Ir][te];k.push(Ir);var Nn=Ce.processModule(Fn,k,te),fi=Nn.content;return fi});return{content:st,includeList:k}}}]),J}())||Wl),$l=S(66366),Pu=S(15194),Mu,Jl,Ql,du,xc,wl=(Mu=(0,w.b2)(),Jl=(0,w.f3)(K.v.IShaderModuleService),Mu(Ql=(du=function(){function J(){(0,W.Z)(this,J),(0,se.Z)(this,"shaderModuleService",xc,this),(0,N.Z)(this,"rendererService",void 0),(0,N.Z)(this,"cameraService",void 0),(0,N.Z)(this,"mapService",void 0),(0,N.Z)(this,"interactionService",void 0),(0,N.Z)(this,"layerService",void 0),(0,N.Z)(this,"config",void 0)}return(0,L.Z)(J,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Pu.G.Normal}},{key:"init",value:function(D,k){this.config=k,this.rendererService=D.getContainer().get(K.v.IRendererService),this.cameraService=D.getContainer().get(K.v.ICameraService),this.mapService=D.getContainer().get(K.v.IMapService),this.interactionService=D.getContainer().get(K.v.IInteractionService),this.layerService=D.getContainer().get(K.v.ILayerService)}},{key:"render",value:function(D){}}]),J}(),xc=(0,Ee.Z)(du.prototype,"shaderModuleService",[Jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),du))||Ql),bc,ju;function Va(J){var Q=ll();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function ll(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var Ya=(bc=(0,w.b2)(),bc(ju=function(J){(0,It.Z)(D,J);var Q=Va(D);function D(){return(0,W.Z)(this,D),Q.apply(this,arguments)}return(0,L.Z)(D,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(te,Ce){(0,$l.Z)((0,E.Z)(D.prototype),"init",this).call(this,te,Ce)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),D}(wl))||ju),Vu,Iu,Ks,ra,Fa;function Cs(J,Q){var D=typeof Symbol!="undefined"&&J[Symbol.iterator]||J["@@iterator"];if(!D){if(Array.isArray(J)||(D=ql(J))||Q&&J&&typeof J.length=="number"){D&&(J=D);var k=0,te=function(){};return{s:te,n:function(){return k>=J.length?{done:!0}:{done:!1,value:J[k++]}},e:function(Kt){throw Kt},f:te}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ce=!0,st=!1,Bt;return{s:function(){D=D.call(J)},n:function(){var Kt=D.next();return Ce=Kt.done,Kt},e:function(Kt){st=!0,Bt=Kt},f:function(){try{!Ce&&D.return!=null&&D.return()}finally{if(st)throw Bt}}}}function ql(J,Q){if(!!J){if(typeof J=="string")return vu(J,Q);var D=Object.prototype.toString.call(J).slice(8,-1);if(D==="Object"&&J.constructor&&(D=J.constructor.name),D==="Map"||D==="Set")return Array.from(J);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return vu(J,Q)}}function vu(J,Q){(Q==null||Q>J.length)&&(Q=J.length);for(var D=0,k=new Array(Q);D<Q;D++)k[D]=J[D];return k}var ec=(Vu=(0,w.b2)(),Iu=(0,w.f3)(K.v.IPostProcessor),Vu(Ks=(ra=function(){function J(){(0,W.Z)(this,J),(0,N.Z)(this,"passes",[]),(0,se.Z)(this,"postProcessor",Fa,this),(0,N.Z)(this,"layer",void 0),(0,N.Z)(this,"renderFlag",void 0),(0,N.Z)(this,"width",0),(0,N.Z)(this,"height",0)}return(0,L.Z)(J,[{key:"setLayer",value:function(D){this.layer=D}},{key:"setRenderFlag",value:function(D){this.renderFlag=D}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var Q=(0,ho.Z)(Vi().mark(function k(){var te,Ce,st;return Vi().wrap(function(bt){for(;;)switch(bt.prev=bt.next){case 0:te=Cs(this.passes),bt.prev=1,te.s();case 3:if((Ce=te.n()).done){bt.next=9;break}return st=Ce.value,bt.next=7,st.render(this.layer);case 7:bt.next=3;break;case 9:bt.next=14;break;case 11:bt.prev=11,bt.t0=bt.catch(1),te.e(bt.t0);case 14:return bt.prev=14,te.f(),bt.finish(14);case 17:this.layer.renderModels();case 18:case"end":return bt.stop()}},k,this,[[1,11,14,17]])}));function D(){return Q.apply(this,arguments)}return D}()},{key:"resize",value:function(D,k){(this.width!==D||this.height!==k)&&(this.width=D,this.height=k)}},{key:"add",value:function(D,k){D.getType()===Pu.G.PostProcessing?this.postProcessor.add(D,this.layer,k):(D.init(this.layer,k),this.passes.push(D))}},{key:"insert",value:function(D,k,te){D.init(this.layer,k),this.passes.splice(te,0,D)}},{key:"destroy",value:function(){this.passes.length=0}}]),J}(),Fa=(0,Ee.Z)(ra.prototype,"postProcessor",[Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ra))||Ks),nf,af;function cl(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function Al(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?cl(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):cl(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}function Ou(J){var Q=Ro();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function Ro(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var Tl=(nf=(0,w.b2)(),nf(af=function(J){(0,It.Z)(D,J);var Q=Ou(D);function D(){var k;(0,W.Z)(this,D);for(var te=arguments.length,Ce=new Array(te),st=0;st<te;st++)Ce[st]=arguments[st];return k=Q.call.apply(Q,[this].concat(Ce)),(0,N.Z)((0,Le.Z)(k),"pickingFBO",void 0),(0,N.Z)((0,Le.Z)(k),"layer",void 0),(0,N.Z)((0,Le.Z)(k),"width",0),(0,N.Z)((0,Le.Z)(k),"height",0),(0,N.Z)((0,Le.Z)(k),"alreadyInRendering",!1),(0,N.Z)((0,Le.Z)(k),"pickFromPickingFBO",function(Bt){var bt=Bt.x,Kt=Bt.y,Ir=Bt.lngLat,Fn=Bt.type;if(!(!k.layer.isVisible()||!k.layer.needPick(Fn))){var Nn=k.rendererService,fi=Nn.getViewportSize,si=Nn.readPixels,yi=Nn.useFramebuffer,Hi=fi(),ya=Hi.width,_a=Hi.height,Ka=k.layer.getLayerConfig(),Ba=Ka.enableHighlight,wo=Ka.enableSelect,La=bt*Ne.SO.DPR,Sa=Kt*Ne.SO.DPR;if(!(La>ya||La<0||Sa>_a||Sa<0)){var la;yi(k.pickingFBO,function(){var va;if(la=si({x:Math.round(La),y:Math.round(_a-(Kt+1)*Ne.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:k.pickingFBO}),la[0]!==0||la[1]!==0||la[2]!==0){var Ga=(0,Ne.W0)(la),Na=k.layer.getSource().getFeatureById(Ga),ko={x:bt,y:Kt,type:Fn,lngLat:Ir,featureId:Ga,feature:Na};Na&&(k.layer.setCurrentPickId(Ga),k.triggerHoverOnLayer(ko))}else{var Ui={x:bt,y:Kt,lngLat:Ir,type:k.layer.getCurrentPickId()===null?"un"+Fn:"mouseout",featureId:null,feature:null};k.triggerHoverOnLayer(Al(Al({},Ui),{},{type:"unpick"})),k.triggerHoverOnLayer(Ui),k.layer.setCurrentPickId(null)}Ba&&k.highlightPickedFeature(la),wo&&Fn==="click"&&((va=la)===null||va===void 0?void 0:va.toString())!==[0,0,0,0].toString()&&k.selectFeature(la)})}}}),k}return(0,L.Z)(D,[{key:"getType",value:function(){return Pu.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(te,Ce){(0,$l.Z)((0,E.Z)(D.prototype),"init",this).call(this,te,Ce),this.layer=te;var st=this.rendererService,Bt=st.createTexture2D,bt=st.createFramebuffer,Kt=st.getViewportSize,Ir=Kt(),Fn=Ir.width,Nn=Ir.height;this.pickingFBO=bt({color:Bt({width:Fn,height:Nn,wrapS:Gi.gl.CLAMP_TO_EDGE,wrapT:Gi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(li.s.Hover,this.pickFromPickingFBO),this.interactionService.on(li.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(li.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(te){var Ce=this;if(!this.alreadyInRendering){var st=this.rendererService,Bt=st.getViewportSize,bt=st.useFramebuffer,Kt=st.clear,Ir=Bt(),Fn=Ir.width,Nn=Ir.height;this.alreadyInRendering=!0,(this.width!==Fn||this.height!==Nn)&&(this.pickingFBO.resize({width:Fn,height:Nn}),this.width=Fn,this.height=Nn),bt(this.pickingFBO,function(){Kt({framebuffer:Ce.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var fi=Ce.layer.multiPassRenderer.getRenderFlag();Ce.layer.multiPassRenderer.setRenderFlag(!1),te.hooks.beforePickingEncode.call(),te.render(),te.hooks.afterPickingEncode.call(),Ce.layer.multiPassRenderer.setRenderFlag(fi),Ce.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(te){this.layer.emit(te.type,te)}},{key:"highlightPickedFeature",value:function(te){var Ce=(0,qt.Z)(te,3),st=Ce[0],Bt=Ce[1],bt=Ce[2];this.layer.hooks.beforeHighlight.call([st,Bt,bt]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(te){var Ce=(0,qt.Z)(te,3),st=Ce[0],Bt=Ce[1],bt=Ce[2];this.layer.hooks.beforeSelect.call([st,Bt,bt]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(te){var Ce=te.featureId,st=(0,Ne.Z6)(Ce);this.selectFeature(new Uint8Array(st))}},{key:"highlightFeatureHandle",value:function(te){var Ce=te.featureId,st=(0,Ne.Z6)(Ce);this.highlightPickedFeature(new Uint8Array(st))}}]),D}(wl))||af),Zs=S(78908),Eo,Bn;function mo(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function mu(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?mo(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):mo(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}function fl(J){var Q=$s();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function $s(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var ws=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Sc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gn=(Eo=(0,w.b2)(),Eo(Bn=function(J){(0,It.Z)(D,J);var Q=fl(D);function D(){return(0,W.Z)(this,D),Q.apply(this,arguments)}return(0,L.Z)(D,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Sc,fs:ws});var te=this.shaderModuleService.getModule("blur-pass"),Ce=te.vs,st=te.fs,Bt=te.uniforms,bt=this.rendererService.getViewportSize(),Kt=bt.width,Ir=bt.height;return{vs:Ce,fs:st,uniforms:mu(mu({},Bt),{},{u_ViewportSize:[Kt,Ir]})}}},{key:"convertOptionsToUniforms",value:function(te){var Ce={};return ts()(te.blurRadius)||(Ce.u_BlurDir=[te.blurRadius,0]),Ce}}]),D}(Zs.Z))||Bn),tc,rc;function Lu(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function Ua(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?Lu(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):Lu(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}function As(J){var Q=nc();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function nc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var gu=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Ts=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yu=(tc=(0,w.b2)(),tc(rc=function(J){(0,It.Z)(D,J);var Q=As(D);function D(){return(0,W.Z)(this,D),Q.apply(this,arguments)}return(0,L.Z)(D,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Ts,fs:gu});var te=this.shaderModuleService.getModule("blur-pass"),Ce=te.vs,st=te.fs,Bt=te.uniforms,bt=this.rendererService.getViewportSize(),Kt=bt.width,Ir=bt.height;return{vs:Ce,fs:st,uniforms:Ua(Ua({},Bt),{},{u_ViewportSize:[Kt,Ir]})}}},{key:"convertOptionsToUniforms",value:function(te){var Ce={};return ts()(te.blurRadius)||(Ce.u_BlurDir=[0,te.blurRadius]),Ce}}]),D}(Zs.Z))||rc),zc,Pl;function Ec(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function Cc(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?Ec(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):Ec(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}function Js(J){var Q=Ps();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function Ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var na=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,_u=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qs=(zc=(0,w.b2)(),zc(Pl=function(J){(0,It.Z)(D,J);var Q=Js(D);function D(){return(0,W.Z)(this,D),Q.apply(this,arguments)}return(0,L.Z)(D,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:_u,fs:na});var te=this.shaderModuleService.getModule("colorhalftone-pass"),Ce=te.vs,st=te.fs,Bt=te.uniforms,bt=this.rendererService.getViewportSize(),Kt=bt.width,Ir=bt.height;return{vs:Ce,fs:st,uniforms:Cc(Cc({},Bt),{},{u_ViewportSize:[Kt,Ir]})}}}]),D}(Zs.Z))||Pl),Uo,Gu;function ru(J){var Q=nu();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function nu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var Co=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Hu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ri=(Uo=(0,w.b2)(),Uo(Gu=function(J){(0,It.Z)(D,J);var Q=ru(D);function D(){return(0,W.Z)(this,D),Q.apply(this,arguments)}return(0,L.Z)(D,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Hu,fs:Co}),this.shaderModuleService.getModule("copy-pass")}}]),D}(Zs.Z))||Gu),Kn,Ml;function as(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function js(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?as(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):as(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}function Zo(J){var Q=iu();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function iu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var wc=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,ic=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ia=(Kn=(0,w.b2)(),Kn(Ml=function(J){(0,It.Z)(D,J);var Q=Zo(D);function D(){return(0,W.Z)(this,D),Q.apply(this,arguments)}return(0,L.Z)(D,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:ic,fs:wc});var te=this.shaderModuleService.getModule("hexagonalpixelate-pass"),Ce=te.vs,st=te.fs,Bt=te.uniforms,bt=this.rendererService.getViewportSize(),Kt=bt.width,Ir=bt.height;return{vs:Ce,fs:st,uniforms:js(js({},Bt),{},{u_ViewportSize:[Kt,Ir]})}}}]),D}(Zs.Z))||Ml),Do,Uc;function gs(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function Il(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?gs(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):gs(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}function Ms(J){var Q=os();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function os(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var hl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,au=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ac=(Do=(0,w.b2)(),Do(Uc=function(J){(0,It.Z)(D,J);var Q=Ms(D);function D(){return(0,W.Z)(this,D),Q.apply(this,arguments)}return(0,L.Z)(D,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:au,fs:hl});var te=this.shaderModuleService.getModule("ink-pass"),Ce=te.vs,st=te.fs,Bt=te.uniforms,bt=this.rendererService.getViewportSize(),Kt=bt.width,Ir=bt.height;return{vs:Ce,fs:st,uniforms:Il(Il({},Bt),{},{u_ViewportSize:[Kt,Ir]})}}}]),D}(Zs.Z))||Uc),Wu,Xu;function Zc(J){var Q=Ol();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function Ol(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var pl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,jc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Yu=(Wu=(0,w.b2)(),Wu(Xu=function(J){(0,It.Z)(D,J);var Q=Zc(D);function D(){return(0,W.Z)(this,D),Q.apply(this,arguments)}return(0,L.Z)(D,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:jc,fs:pl}),this.shaderModuleService.getModule("noise-pass")}}]),D}(Zs.Z))||Xu),Ru,oc;function Du(J){var Q=Vs();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function Vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var Ac=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,sc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,uc=(Ru=(0,w.b2)(),Ru(oc=function(J){(0,It.Z)(D,J);var Q=Du(D);function D(){return(0,W.Z)(this,D),Q.apply(this,arguments)}return(0,L.Z)(D,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Ac,fs:sc}),this.shaderModuleService.getModule("sepia-pass")}}]),D}(Zs.Z))||oc),Ku,n,u,o,h,y,b=(Ku=(0,w.b2)(),n=(0,w.f3)(K.v.IRendererService),u=(0,w.zY)(),Ku(o=(h=function(){function J(){(0,W.Z)(this,J),(0,se.Z)(this,"rendererService",y,this),(0,N.Z)(this,"passes",[]),(0,N.Z)(this,"readFBO",void 0),(0,N.Z)(this,"writeFBO",void 0)}return(0,L.Z)(J,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var Q=(0,ho.Z)(Vi().mark(function k(te){var Ce,st;return Vi().wrap(function(bt){for(;;)switch(bt.prev=bt.next){case 0:Ce=0;case 1:if(!(Ce<this.passes.length)){bt.next=10;break}return st=this.passes[Ce],st.setRenderToScreen(this.isLastEnabledPass(Ce)),bt.next=6,st.render(te);case 6:Ce!==this.passes.length-1&&this.swap();case 7:Ce++,bt.next=1;break;case 10:case"end":return bt.stop()}},k,this)}));function D(k){return Q.apply(this,arguments)}return D}()},{key:"resize",value:function(D,k){this.readFBO.resize({width:D,height:k}),this.writeFBO.resize({width:D,height:k})}},{key:"add",value:function(D,k,te){D.init(k,te),this.passes.push(D)}},{key:"insert",value:function(D,k,te,Ce){D.init(te,Ce),this.passes.splice(k,0,D)}},{key:"getPostProcessingPassByName",value:function(D){return this.passes.find(function(k){return k.getName()===D})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(D){for(var k=D+1;k<this.passes.length;k++)if(this.passes[k].isEnabled())return!1;return!0}},{key:"swap",value:function(){var D=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=D}}]),J}(),y=(0,Ee.Z)(h.prototype,"rendererService",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,Ee.Z)(h.prototype,"init",[u],Object.getOwnPropertyDescriptor(h.prototype,"init"),h.prototype),h))||o),P,F;function H(J){var Q=ae();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function ae(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var xe=(P=(0,w.b2)(),P(F=function(J){(0,It.Z)(D,J);var Q=H(D);function D(){return(0,W.Z)(this,D),Q.apply(this,arguments)}return(0,L.Z)(D,[{key:"getType",value:function(){return Pu.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(te,Ce){(0,$l.Z)((0,E.Z)(D.prototype),"init",this).call(this,te,Ce)}},{key:"render",value:function(te){var Ce=this.rendererService,st=Ce.useFramebuffer,Bt=Ce.clear;st(null,function(){Bt({color:[0,0,0,0],depth:1,stencil:0}),te.multiPassRenderer.setRenderFlag(!1),te.render(),te.multiPassRenderer.setRenderFlag(!0)})}}]),D}(wl))||F),we,Te,He,je,it;function ze(J,Q){var D=Object.keys(J);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(J);Q&&(k=k.filter(function(te){return Object.getOwnPropertyDescriptor(J,te).enumerable})),D.push.apply(D,k)}return D}function at(J){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?ze(Object(D),!0).forEach(function(k){(0,N.Z)(J,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(D)):ze(Object(D)).forEach(function(k){Object.defineProperty(J,k,Object.getOwnPropertyDescriptor(D,k))})}return J}function xt(J){var Q=jt();return function(){var k=(0,E.Z)(J),te;if(Q){var Ce=(0,E.Z)(this).constructor;te=Reflect.construct(k,arguments,Ce)}else te=k.apply(this,arguments);return(0,tr.Z)(this,te)}}function jt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(J){return!1}}var gr=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,lr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,_r=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function zr(J,Q){for(var D=0,k=1/Q,te=J;te>0;)D=D+k*(te%Q),te=Math.floor(te/Q),k=k/Q;return D}var on=1,Qr=(we=(0,w.b2)(),Te=(0,w.f3)(K.v.IShaderModuleService),we(He=(je=function(J){(0,It.Z)(D,J);var Q=xt(D);function D(){var k;(0,W.Z)(this,D);for(var te=arguments.length,Ce=new Array(te),st=0;st<te;st++)Ce[st]=arguments[st];return k=Q.call.apply(Q,[this].concat(Ce)),(0,se.Z)((0,Le.Z)(k),"shaderModuleService",it,(0,Le.Z)(k)),(0,N.Z)((0,Le.Z)(k),"haltonSequence",[]),(0,N.Z)((0,Le.Z)(k),"accumulatingId",0),(0,N.Z)((0,Le.Z)(k),"frame",0),(0,N.Z)((0,Le.Z)(k),"timer",void 0),(0,N.Z)((0,Le.Z)(k),"sampleRenderTarget",void 0),(0,N.Z)((0,Le.Z)(k),"prevRenderTarget",void 0),(0,N.Z)((0,Le.Z)(k),"outputRenderTarget",void 0),(0,N.Z)((0,Le.Z)(k),"copyRenderTarget",void 0),(0,N.Z)((0,Le.Z)(k),"blendModel",void 0),(0,N.Z)((0,Le.Z)(k),"outputModel",void 0),(0,N.Z)((0,Le.Z)(k),"copyModel",void 0),k}return(0,L.Z)(D,[{key:"getType",value:function(){return Pu.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(te,Ce){(0,$l.Z)((0,E.Z)(D.prototype),"init",this).call(this,te,Ce);var st=this.rendererService,Bt=st.createFramebuffer,bt=st.createTexture2D;this.sampleRenderTarget=Bt({color:bt({width:1,height:1,wrapS:Gi.gl.CLAMP_TO_EDGE,wrapT:Gi.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Bt({color:bt({width:1,height:1,wrapS:Gi.gl.CLAMP_TO_EDGE,wrapT:Gi.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Bt({color:bt({width:1,height:1,wrapS:Gi.gl.CLAMP_TO_EDGE,wrapT:Gi.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Bt({color:bt({width:1,height:1,wrapS:Gi.gl.CLAMP_TO_EDGE,wrapT:Gi.gl.CLAMP_TO_EDGE})});for(var Kt=0;Kt<30;Kt++)this.haltonSequence.push([zr(Kt,2),zr(Kt,3)]);this.blendModel=this.createTriangleModel("blend-pass",gr),this.outputModel=this.createTriangleModel("copy-pass",lr,{blend:{enable:!0,func:{srcRGB:Gi.gl.ONE,dstRGB:Gi.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:Gi.gl.ONE,dstAlpha:Gi.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:Gi.gl.FUNC_ADD,alpha:Gi.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",lr)}},{key:"render",value:function(te){var Ce=this,st=this.rendererService,Bt=st.clear,bt=st.getViewportSize,Kt=st.useFramebuffer,Ir=bt(),Fn=Ir.width,Nn=Ir.height;this.sampleRenderTarget.resize({width:Fn,height:Nn}),this.prevRenderTarget.resize({width:Fn,height:Nn}),this.outputRenderTarget.resize({width:Fn,height:Nn}),this.copyRenderTarget.resize({width:Fn,height:Nn}),this.resetFrame(),this.stopAccumulating();var fi=te.multiPassRenderer.getPostProcessor().getReadFBO();Kt(fi,function(){Bt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:fi}),te.multiPassRenderer.setRenderFlag(!1),te.render(),te.multiPassRenderer.setRenderFlag(!0)});var si=function yi(Hi){!Ce.accumulatingId||Hi!==Ce.accumulatingId||Ce.isFinished()||(Ce.doRender(te),requestAnimationFrame(function(){yi(Hi)}))};this.accumulatingId=on++,this.timer=window.setTimeout(function(){si(Ce.accumulatingId)},50)}},{key:"doRender",value:function(te){var Ce=this,st=this.rendererService,Bt=st.clear,bt=st.getViewportSize,Kt=st.useFramebuffer,Ir=bt(),Fn=Ir.width,Nn=Ir.height,fi=te.getLayerConfig(),si=fi.jitterScale,yi=si===void 0?1:si,Hi=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Hi[0]*2-1)/Fn*yi,(Hi[1]*2-1)/Nn*yi),te.multiPassRenderer.setRenderFlag(!1),te.hooks.beforeRender.call(),Kt(this.sampleRenderTarget,function(){Bt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Ce.sampleRenderTarget}),te.render()}),te.hooks.afterRender.call(),te.multiPassRenderer.setRenderFlag(!0);var ya=te.getLayerConfig();Kt(this.outputRenderTarget,function(){Ce.blendModel.draw({uniforms:{u_opacity:ya.opacity||1,u_MixRatio:Ce.frame===0?1:.9,u_Diffuse1:Ce.sampleRenderTarget,u_Diffuse2:Ce.frame===0?te.multiPassRenderer.getPostProcessor().getReadFBO():Ce.prevRenderTarget}})}),this.frame===0&&Bt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(Kt(this.copyRenderTarget,function(){Ce.outputModel.draw({uniforms:{u_Texture:Ce.outputRenderTarget}})}),Kt(te.multiPassRenderer.getPostProcessor().getReadFBO(),function(){Ce.copyModel.draw({uniforms:{u_Texture:Ce.copyRenderTarget}})}),te.multiPassRenderer.getPostProcessor().render(te));var _a=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=_a,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(te,Ce,st){this.shaderModuleService.registerModule(te,{vs:_r,fs:Ce});var Bt=this.shaderModuleService.getModule(te),bt=Bt.vs,Kt=Bt.fs,Ir=Bt.uniforms,Fn=this.rendererService,Nn=Fn.createAttribute,fi=Fn.createBuffer,si=Fn.createModel;return si(at({vs:bt,fs:Kt,attributes:{a_Position:Nn({buffer:fi({data:[-4,-4,4,-4,0,4],type:Gi.gl.FLOAT}),size:2})},uniforms:at({},Ir),depth:{enable:!1},count:3},st))}}]),D}(wl),it=(0,Ee.Z)(je.prototype,"shaderModuleService",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),je))||He),Pn=new w.W2;Pn.bind(K.v.IGlobalConfigService).to(Ae).inSingletonScope(),Pn.bind(K.v.IShaderModuleService).to(Kl).inSingletonScope(),(0,w.GW)((0,w.b2)(),C.EventEmitter),Pn.bind(K.v.IEventEmitter).to(C.EventEmitter);var ei=(0,q.Z)(Pn,!1),ci=function(Q){var D=ei.lazyInject(Q);return function(k,te,Ce){D.call(this,k,te),Ce&&(Ce.initializer=function(){return k[te]})}},ti=function(Q){var D=ei.lazyMultiInject(Q);return function(k,te,Ce){D.call(this,k,te),Ce&&(Ce.initializer=function(){return k[te]})}},aa=Pn,jn=0;function xi(){var J=new w.W2;return J.parent=Pn,J.bind(K.v.SceneID).toConstantValue("".concat(jn++)),J.bind(K.v.ILayerService).to(es).inSingletonScope(),J.bind(K.v.ISceneService).to(Ds).inSingletonScope(),J.bind(K.v.ICameraService).to(Nr).inSingletonScope(),J.bind(K.v.ICoordinateSystemService).to(xn).inSingletonScope(),J.bind(K.v.IInteractionService).to(no).inSingletonScope(),J.bind(K.v.IPickingService).to(De).inSingletonScope(),J.bind(K.v.IControlService).to(Zr).inSingletonScope(),J.bind(K.v.IMarkerService).to(Er).inSingletonScope(),J.bind(K.v.IIconService).to(Vt).inSingletonScope(),J.bind(K.v.IFontService).to(Ze).inSingletonScope(),J.bind(K.v.IPopupService).to(Ti).inSingletonScope(),J.bind(K.v.INormalPass).to(Ya).whenTargetNamed("clear"),J.bind(K.v.INormalPass).to(Tl).whenTargetNamed("pixelPicking"),J.bind(K.v.INormalPass).to(xe).whenTargetNamed("render"),J.bind(K.v.INormalPass).to(Qr).whenTargetNamed("taa"),J.bind(K.v.IFactoryNormalPass).toFactory(function(Q){return function(D){return Q.container.getNamed(K.v.INormalPass,D)}}),J.bind(K.v.IPostProcessingPass).to(ri).whenTargetNamed("copy"),J.bind(K.v.IPostProcessingPass).to(gn).whenTargetNamed("blurH"),J.bind(K.v.IPostProcessingPass).to(yu).whenTargetNamed("blurV"),J.bind(K.v.IPostProcessingPass).to(Yu).whenTargetNamed("noise"),J.bind(K.v.IPostProcessingPass).to(uc).whenTargetNamed("sepia"),J.bind(K.v.IPostProcessingPass).to(Qs).whenTargetNamed("colorHalftone"),J.bind(K.v.IPostProcessingPass).to(ia).whenTargetNamed("hexagonalPixelate"),J.bind(K.v.IPostProcessingPass).to(ac).whenTargetNamed("ink"),J.bind(K.v.IFactoryPostProcessingPass).toFactory(function(Q){return function(D){var k=Q.container.getNamed(K.v.IPostProcessingPass,D);return k.setName(D),k}}),J}function zi(J){var Q=new w.W2;return Q.parent=J,Q.bind(K.v.IStyleAttributeService).to(Nu).inSingletonScope(),Q.bind(K.v.IMultiPassRenderer).to(ec).inSingletonScope(),Q.bind(K.v.IPostProcessor).to(b).inSingletonScope(),Q}},44705:function(){},97522:function(){},22206:function(Lr,U,S){"use strict";S.d(U,{l:function(){return ue}});var ue={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},60205:function(Lr,U,S){"use strict";S.d(U,{d:function(){return ue}});var ue;(function(C){C.TOPRIGHT="topright",C.TOPLEFT="topleft",C.BOTTOMRIGHT="bottomright",C.BOTTOMLEFT="bottomleft",C.TOPCENTER="topcenter",C.BOTTOMCENTER="bottomcenter",C.LEFTCENTER="leftcenter",C.RIGHTCENTER="rightcenter"})(ue||(ue={}))},62049:function(){},52616:function(){},991:function(){},48216:function(Lr,U,S){"use strict";S.d(U,{l:function(){return ue},k:function(){return C}});var ue;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(ue||(ue={}));var C={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},90511:function(Lr,U,S){"use strict";S.d(U,{s:function(){return ue}});var ue;(function(C){C.Hover="hover",C.Click="click",C.Select="select",C.Active="active",C.Drag="drag"})(ue||(ue={}))},64188:function(){},554:function(Lr,U,S){"use strict";S.d(U,{h:function(){return ue}});var ue;(function(C){C.normal="normal",C.additive="additive",C.subtractive="subtractive",C.min="min",C.max="max",C.none="none"})(ue||(ue={}))},73132:function(Lr,U,S){"use strict";S.d(U,{vY:function(){return ue},ee:function(){return C},GC:function(){return p}});var ue;(function(w){w.LINEAR="linear",w.POWER="power",w.LOG="log",w.IDENTITY="identity",w.TIME="time",w.QUANTILE="quantile",w.QUANTIZE="quantize",w.THRESHOLD="threshold",w.CAT="cat"})(ue||(ue={}));var C;(function(w){w.CONSTANT="constant",w.VARIABLE="variable"})(C||(C={}));var p;(function(w){w[w.Attribute=0]="Attribute",w[w.InstancedAttribute=1]="InstancedAttribute",w[w.Uniform=2]="Uniform"})(p||(p={}))},85808:function(Lr,U,S){"use strict";S.d(U,{I:function(){return ue}});var ue=["mapload"]},39340:function(){},44052:function(){},80454:function(){},90437:function(){},10008:function(){},15194:function(Lr,U,S){"use strict";S.d(U,{G:function(){return ue}});var ue;(function(C){C.Normal="normal",C.PostProcessing="post-processing"})(ue||(ue={}))},18023:function(){},23157:function(){},80854:function(){},19198:function(){},13027:function(Lr,U,S){"use strict";S.d(U,{gl:function(){return ue}});var ue;(function(C){C[C.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",C[C.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",C[C.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",C[C.POINTS=0]="POINTS",C[C.LINES=1]="LINES",C[C.LINE_LOOP=2]="LINE_LOOP",C[C.LINE_STRIP=3]="LINE_STRIP",C[C.TRIANGLES=4]="TRIANGLES",C[C.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",C[C.TRIANGLE_FAN=6]="TRIANGLE_FAN",C[C.ZERO=0]="ZERO",C[C.ONE=1]="ONE",C[C.SRC_COLOR=768]="SRC_COLOR",C[C.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",C[C.SRC_ALPHA=770]="SRC_ALPHA",C[C.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",C[C.DST_ALPHA=772]="DST_ALPHA",C[C.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",C[C.DST_COLOR=774]="DST_COLOR",C[C.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",C[C.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",C[C.FUNC_ADD=32774]="FUNC_ADD",C[C.BLEND_EQUATION=32777]="BLEND_EQUATION",C[C.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",C[C.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",C[C.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",C[C.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",C[C.MAX_EXT=32776]="MAX_EXT",C[C.MIN_EXT=32775]="MIN_EXT",C[C.BLEND_DST_RGB=32968]="BLEND_DST_RGB",C[C.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",C[C.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",C[C.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",C[C.CONSTANT_COLOR=32769]="CONSTANT_COLOR",C[C.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",C[C.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",C[C.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",C[C.BLEND_COLOR=32773]="BLEND_COLOR",C[C.ARRAY_BUFFER=34962]="ARRAY_BUFFER",C[C.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",C[C.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",C[C.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",C[C.STREAM_DRAW=35040]="STREAM_DRAW",C[C.STATIC_DRAW=35044]="STATIC_DRAW",C[C.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",C[C.BUFFER_SIZE=34660]="BUFFER_SIZE",C[C.BUFFER_USAGE=34661]="BUFFER_USAGE",C[C.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",C[C.FRONT=1028]="FRONT",C[C.BACK=1029]="BACK",C[C.FRONT_AND_BACK=1032]="FRONT_AND_BACK",C[C.CULL_FACE=2884]="CULL_FACE",C[C.BLEND=3042]="BLEND",C[C.DITHER=3024]="DITHER",C[C.STENCIL_TEST=2960]="STENCIL_TEST",C[C.DEPTH_TEST=2929]="DEPTH_TEST",C[C.SCISSOR_TEST=3089]="SCISSOR_TEST",C[C.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",C[C.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",C[C.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",C[C.NO_ERROR=0]="NO_ERROR",C[C.INVALID_ENUM=1280]="INVALID_ENUM",C[C.INVALID_VALUE=1281]="INVALID_VALUE",C[C.INVALID_OPERATION=1282]="INVALID_OPERATION",C[C.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",C[C.CW=2304]="CW",C[C.CCW=2305]="CCW",C[C.LINE_WIDTH=2849]="LINE_WIDTH",C[C.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",C[C.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",C[C.CULL_FACE_MODE=2885]="CULL_FACE_MODE",C[C.FRONT_FACE=2886]="FRONT_FACE",C[C.DEPTH_RANGE=2928]="DEPTH_RANGE",C[C.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",C[C.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",C[C.DEPTH_FUNC=2932]="DEPTH_FUNC",C[C.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",C[C.STENCIL_FUNC=2962]="STENCIL_FUNC",C[C.STENCIL_FAIL=2964]="STENCIL_FAIL",C[C.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",C[C.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",C[C.STENCIL_REF=2967]="STENCIL_REF",C[C.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",C[C.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",C[C.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",C[C.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",C[C.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",C[C.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",C[C.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",C[C.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",C[C.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",C[C.VIEWPORT=2978]="VIEWPORT",C[C.SCISSOR_BOX=3088]="SCISSOR_BOX",C[C.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",C[C.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",C[C.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",C[C.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",C[C.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",C[C.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",C[C.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",C[C.RED_BITS=3410]="RED_BITS",C[C.GREEN_BITS=3411]="GREEN_BITS",C[C.BLUE_BITS=3412]="BLUE_BITS",C[C.ALPHA_BITS=3413]="ALPHA_BITS",C[C.DEPTH_BITS=3414]="DEPTH_BITS",C[C.STENCIL_BITS=3415]="STENCIL_BITS",C[C.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",C[C.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",C[C.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",C[C.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",C[C.SAMPLES=32937]="SAMPLES",C[C.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",C[C.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",C[C.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",C[C.DONT_CARE=4352]="DONT_CARE",C[C.FASTEST=4353]="FASTEST",C[C.NICEST=4354]="NICEST",C[C.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",C[C.BYTE=5120]="BYTE",C[C.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",C[C.SHORT=5122]="SHORT",C[C.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",C[C.INT=5124]="INT",C[C.UNSIGNED_INT=5125]="UNSIGNED_INT",C[C.FLOAT=5126]="FLOAT",C[C.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",C[C.ALPHA=6406]="ALPHA",C[C.RGB=6407]="RGB",C[C.RGBA=6408]="RGBA",C[C.LUMINANCE=6409]="LUMINANCE",C[C.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",C[C.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",C[C.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",C[C.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",C[C.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",C[C.VERTEX_SHADER=35633]="VERTEX_SHADER",C[C.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",C[C.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",C[C.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",C[C.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",C[C.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",C[C.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",C[C.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",C[C.SHADER_TYPE=35663]="SHADER_TYPE",C[C.DELETE_STATUS=35712]="DELETE_STATUS",C[C.LINK_STATUS=35714]="LINK_STATUS",C[C.VALIDATE_STATUS=35715]="VALIDATE_STATUS",C[C.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",C[C.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",C[C.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",C[C.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",C[C.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",C[C.NEVER=512]="NEVER",C[C.LESS=513]="LESS",C[C.EQUAL=514]="EQUAL",C[C.LEQUAL=515]="LEQUAL",C[C.GREATER=516]="GREATER",C[C.NOTEQUAL=517]="NOTEQUAL",C[C.GEQUAL=518]="GEQUAL",C[C.ALWAYS=519]="ALWAYS",C[C.KEEP=7680]="KEEP",C[C.REPLACE=7681]="REPLACE",C[C.INCR=7682]="INCR",C[C.DECR=7683]="DECR",C[C.INVERT=5386]="INVERT",C[C.INCR_WRAP=34055]="INCR_WRAP",C[C.DECR_WRAP=34056]="DECR_WRAP",C[C.VENDOR=7936]="VENDOR",C[C.RENDERER=7937]="RENDERER",C[C.VERSION=7938]="VERSION",C[C.NEAREST=9728]="NEAREST",C[C.LINEAR=9729]="LINEAR",C[C.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",C[C.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",C[C.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",C[C.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",C[C.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",C[C.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",C[C.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",C[C.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",C[C.TEXTURE_2D=3553]="TEXTURE_2D",C[C.TEXTURE=5890]="TEXTURE",C[C.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",C[C.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",C[C.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",C[C.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",C[C.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",C[C.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",C[C.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",C[C.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",C[C.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",C[C.TEXTURE0=33984]="TEXTURE0",C[C.TEXTURE1=33985]="TEXTURE1",C[C.TEXTURE2=33986]="TEXTURE2",C[C.TEXTURE3=33987]="TEXTURE3",C[C.TEXTURE4=33988]="TEXTURE4",C[C.TEXTURE5=33989]="TEXTURE5",C[C.TEXTURE6=33990]="TEXTURE6",C[C.TEXTURE7=33991]="TEXTURE7",C[C.TEXTURE8=33992]="TEXTURE8",C[C.TEXTURE9=33993]="TEXTURE9",C[C.TEXTURE10=33994]="TEXTURE10",C[C.TEXTURE11=33995]="TEXTURE11",C[C.TEXTURE12=33996]="TEXTURE12",C[C.TEXTURE13=33997]="TEXTURE13",C[C.TEXTURE14=33998]="TEXTURE14",C[C.TEXTURE15=33999]="TEXTURE15",C[C.TEXTURE16=34e3]="TEXTURE16",C[C.TEXTURE17=34001]="TEXTURE17",C[C.TEXTURE18=34002]="TEXTURE18",C[C.TEXTURE19=34003]="TEXTURE19",C[C.TEXTURE20=34004]="TEXTURE20",C[C.TEXTURE21=34005]="TEXTURE21",C[C.TEXTURE22=34006]="TEXTURE22",C[C.TEXTURE23=34007]="TEXTURE23",C[C.TEXTURE24=34008]="TEXTURE24",C[C.TEXTURE25=34009]="TEXTURE25",C[C.TEXTURE26=34010]="TEXTURE26",C[C.TEXTURE27=34011]="TEXTURE27",C[C.TEXTURE28=34012]="TEXTURE28",C[C.TEXTURE29=34013]="TEXTURE29",C[C.TEXTURE30=34014]="TEXTURE30",C[C.TEXTURE31=34015]="TEXTURE31",C[C.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",C[C.REPEAT=10497]="REPEAT",C[C.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",C[C.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",C[C.FLOAT_VEC2=35664]="FLOAT_VEC2",C[C.FLOAT_VEC3=35665]="FLOAT_VEC3",C[C.FLOAT_VEC4=35666]="FLOAT_VEC4",C[C.INT_VEC2=35667]="INT_VEC2",C[C.INT_VEC3=35668]="INT_VEC3",C[C.INT_VEC4=35669]="INT_VEC4",C[C.BOOL=35670]="BOOL",C[C.BOOL_VEC2=35671]="BOOL_VEC2",C[C.BOOL_VEC3=35672]="BOOL_VEC3",C[C.BOOL_VEC4=35673]="BOOL_VEC4",C[C.FLOAT_MAT2=35674]="FLOAT_MAT2",C[C.FLOAT_MAT3=35675]="FLOAT_MAT3",C[C.FLOAT_MAT4=35676]="FLOAT_MAT4",C[C.SAMPLER_2D=35678]="SAMPLER_2D",C[C.SAMPLER_CUBE=35680]="SAMPLER_CUBE",C[C.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",C[C.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",C[C.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",C[C.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",C[C.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",C[C.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",C[C.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",C[C.COMPILE_STATUS=35713]="COMPILE_STATUS",C[C.LOW_FLOAT=36336]="LOW_FLOAT",C[C.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",C[C.HIGH_FLOAT=36338]="HIGH_FLOAT",C[C.LOW_INT=36339]="LOW_INT",C[C.MEDIUM_INT=36340]="MEDIUM_INT",C[C.HIGH_INT=36341]="HIGH_INT",C[C.FRAMEBUFFER=36160]="FRAMEBUFFER",C[C.RENDERBUFFER=36161]="RENDERBUFFER",C[C.RGBA4=32854]="RGBA4",C[C.RGB5_A1=32855]="RGB5_A1",C[C.RGB565=36194]="RGB565",C[C.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",C[C.STENCIL_INDEX=6401]="STENCIL_INDEX",C[C.STENCIL_INDEX8=36168]="STENCIL_INDEX8",C[C.DEPTH_STENCIL=34041]="DEPTH_STENCIL",C[C.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",C[C.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",C[C.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",C[C.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",C[C.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",C[C.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",C[C.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",C[C.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",C[C.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",C[C.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",C[C.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",C[C.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",C[C.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",C[C.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",C[C.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",C[C.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",C[C.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",C[C.NONE=0]="NONE",C[C.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",C[C.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",C[C.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",C[C.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",C[C.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",C[C.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",C[C.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",C[C.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",C[C.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",C[C.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",C[C.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",C[C.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",C[C.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",C[C.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(ue||(ue={}))},78908:function(Lr,U,S){"use strict";S.d(U,{Z:function(){return Xe}});var ue=S(84904),C=S(51548),p=S(46893),w=S(19297),q=S(7273),K=S(53592),W=S.n(K),L=S(93544),N=S.n(L),Ne=S(34301),Ye=S.n(Ne),Je=S(99311),rt=S(78892),Xt=S.n(rt),Gt=S(13027),nr=S(13078),Ut=S(15194),At,Et,dr,re,mr;function wt(Zt,yr){var ur=Object.keys(Zt);if(Object.getOwnPropertySymbols){var Ur=Object.getOwnPropertySymbols(Zt);yr&&(Ur=Ur.filter(function(he){return Object.getOwnPropertyDescriptor(Zt,he).enumerable})),ur.push.apply(ur,Ur)}return ur}function Ke(Zt){for(var yr=1;yr<arguments.length;yr++){var ur=arguments[yr]!=null?arguments[yr]:{};yr%2?wt(Object(ur),!0).forEach(function(Ur){(0,w.Z)(Zt,Ur,ur[Ur])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Zt,Object.getOwnPropertyDescriptors(ur)):wt(Object(ur)).forEach(function(Ur){Object.defineProperty(Zt,Ur,Object.getOwnPropertyDescriptor(ur,Ur))})}return Zt}var Dt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Xe=(At=(0,Je.b2)(),Et=(0,Je.f3)(nr.v.IShaderModuleService),At(dr=(re=function(){function Zt(){(0,C.Z)(this,Zt),(0,ue.Z)(this,"shaderModuleService",mr,this),(0,w.Z)(this,"rendererService",void 0),(0,w.Z)(this,"config",void 0),(0,w.Z)(this,"quad",Dt),(0,w.Z)(this,"enabled",!0),(0,w.Z)(this,"renderToScreen",!1),(0,w.Z)(this,"model",void 0),(0,w.Z)(this,"name",void 0),(0,w.Z)(this,"optionsToUpdate",{})}return(0,p.Z)(Zt,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(ur){this.name=ur}},{key:"getType",value:function(){return Ut.G.PostProcessing}},{key:"init",value:function(ur,Ur){this.config=Ur,this.rendererService=ur.getContainer().get(nr.v.IRendererService);var he=this.rendererService,Re=he.createAttribute,ge=he.createBuffer,_t=he.createModel,pt=this.setupShaders(),zt=pt.vs,Ft=pt.fs,Dr=pt.uniforms;this.model=_t({vs:zt,fs:Ft,attributes:{a_Position:Re({buffer:ge({data:[-4,-4,4,-4,0,4],type:Gt.gl.FLOAT}),size:2})},uniforms:Ke(Ke({u_Texture:null},Dr),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(ur){var Ur=this,he=ur.multiPassRenderer.getPostProcessor(),Re=this.rendererService,ge=Re.useFramebuffer,_t=Re.getViewportSize,pt=Re.clear,zt=_t(),Ft=zt.width,Dr=zt.height;ge(this.renderToScreen?null:he.getWriteFBO(),function(){pt({framebuffer:he.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),Ur.model.draw({uniforms:Ke({u_Texture:he.getReadFBO(),u_ViewportSize:[Ft,Dr]},Ur.convertOptionsToUniforms(Ur.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(ur){this.enabled=ur}},{key:"setRenderToScreen",value:function(ur){this.renderToScreen=ur}},{key:"updateOptions",value:function(ur){this.optionsToUpdate=Ke(Ke({},this.optionsToUpdate),ur)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(ur){var Ur={};return Object.keys(ur).forEach(function(he){N()(ur[he])||(Ur["u_".concat(W()(Ye()(he)))]=ur[he])}),Ur}}]),Zt}(),mr=(0,q.Z)(re.prototype,"shaderModuleService",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),re))||dr)},49305:function(Lr,U,S){"use strict";S.d(U,{P:function(){return ue}});var ue=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},96829:function(){},52977:function(){},13078:function(Lr,U,S){"use strict";S.d(U,{v:function(){return ue}});var ue={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},68152:function(Lr,U,S){"use strict";var ue=S(61400),C=null;function p(Xe){return C.indexOf(Xe)}var w=2,q=4,K=64,W=128,L=256,N=512,Ne=8192,Ye=16384,Je=32768,rt=null,Xt=131072,Gt=262144,nr=524288,Ut=1048576,At=2097152,Et=4194304,dr=8388608,re=16777216,mr=null;function wt(Xe,Zt){return Xe=_clamp(Math.floor(Xe),0,255),Zt=_clamp(Math.floor(Zt),0,255),256*Xe+Zt}function Ke(Xe){var Zt=Xe.color,yr=Xe.radius,ur=Xe.tileX,Ur=Xe.tileY,he=Xe.shape,Re=Xe.opacity,ge=Xe.stroke,_t=Xe.strokeWidth,pt=Xe.strokeOpacity,zt=[],Ft=[],Dr=[],pn=[wt(Zt[0],Zt[1]),wt(Zt[2],Zt[3])],mn=[wt(ge[0],ge[1]),wt(ge[2],ge[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Xi){var ir=_slicedToArray(Xi,2),pe=ir[0],Pe=ir[1];zt.push([].concat(pn,[(pe+1)*dr+(Pe+1)*At+getShapeIndex(he)*Xt+yr,(ur+512)*nr+(Ur+512)*K])),Ft.push([].concat(mn,[_t,pt])),Dr.push([Re,0,0,0])}),{packedBuffer:zt,packedBuffer2:Ft,packedBuffer3:Dr}}function Dt(Xe,Zt){if(Xe===0&&!Zt)return 0;if(Xe===1&&Zt)return 4294967295;var yr=Zt?1:0,ur=Math.floor(Xe*127);return ur*mr+yr*re+ur*Xt+yr*rt+ur*N+yr*L+ur*w+yr}},84158:function(Lr,U,S){"use strict";S.d(U,{zP:function(){return wg},JE:function(){return w0},ns:function(){return Cg}});var ue=S(59301),C=(0,ue.createContext)({});function p(){return(0,ue.useContext)(C)}var w=S(96391),q=S(83405),K=S(51548),W=S(46893),L=S(19297),N=S(67708),Ne=S(37150),Ye=S(87896),Je=S(74415),rt=S(41889),Xt=S(40666);function Gt(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function nr(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Gt(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Gt(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function Ut(i){var c=At();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function At(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Et=0,dr=function(i){(0,Ne.Z)(a,i);var c=Ut(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this),(0,L.Z)((0,N.Z)(l),"controlOption",void 0),(0,L.Z)((0,N.Z)(l),"container",void 0),(0,L.Z)((0,N.Z)(l),"sceneContainer",void 0),(0,L.Z)((0,N.Z)(l),"mapsService",void 0),(0,L.Z)((0,N.Z)(l),"renderService",void 0),(0,L.Z)((0,N.Z)(l),"layerService",void 0),(0,L.Z)((0,N.Z)(l),"controlService",void 0),(0,L.Z)((0,N.Z)(l),"isShow",void 0),l.controlOption=nr(nr({},l.getDefault()),s||{}),l}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{position:w.PositionType.TOPRIGHT,name:"".concat(Et++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:w.PositionType.BOTTOMRIGHT,d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=l,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(w.vK.IMapService),this.renderService=l.get(w.vK.IRendererService),this.layerService=l.get(w.vK.ILayerService),this.controlService=l.get(w.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var d=this.container,_=this.controlOption.position,T=this.controlService.controlCorners[_];return rt.SO.addClass(d,"l7-control"),_.indexOf("bottom")!==-1?T.insertBefore(d,T.firstChild):T.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;rt.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;rt.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;rt.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),a}(Xt.EventEmitter);function re(i){var c=mr();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function mr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var wt=function(i){(0,Ne.Z)(a,i);var c=re(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this,s),(0,L.Z)((0,N.Z)(l),"layerControlInputs",void 0),(0,L.Z)((0,N.Z)(l),"layers",void 0),(0,L.Z)((0,N.Z)(l),"lastZIndex",void 0),(0,L.Z)((0,N.Z)(l),"handlingClick",void 0),(0,L.Z)((0,N.Z)(l),"layersLink",void 0),(0,L.Z)((0,N.Z)(l),"baseLayersList",void 0),(0,L.Z)((0,N.Z)(l),"separator",void 0),(0,L.Z)((0,N.Z)(l),"overlaysList",void 0),(0,L.Z)((0,N.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,rt.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,N.Z)(l)),l}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{collapsed:!0,position:w.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",l.onLayerChange),d.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,d){return this.addLayer(l,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),d=l.height;rt.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var _=d-(this.container.offsetTop+50);return _<this.form.clientHeight?(rt.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=_+"px"):rt.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return rt.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",l.onLayerChange),d.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",d=this.container=rt.SO.create("div",l),_=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var T=this.form=rt.SO.create("form",l+"-list");_&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=rt.SO.create("a",l+"-toggle",d);var I=this.layersLink;I.title="Layers",_||this.expand(),this.baseLayersList=rt.SO.create("div",l+"-base",T),this.separator=rt.SO.create("div",l+"-separator",T),this.overlaysList=rt.SO.create("div",l+"-overlays",T),d.appendChild(T)}},{key:"initLayers",value:function(){var l=this,d=this.controlOption,_=d.baseLayers,T=_===void 0?{}:_,I=d.overlayers,R=I===void 0?{}:I;Object.keys(T).forEach(function(ee,X){l.addLayer(T[ee],ee,!1)}),Object.keys(R).forEach(function(ee,X){l.addLayer(R[ee],ee,!0)})}},{key:"update",value:function(){if(!this.container)return this;rt.SO.empty(this.baseLayersList),rt.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,d,_,T,I=0;for(_=0;_<this.layers.length;_++)T=this.layers[_],this.addItem(T),d=d||T.overlay,l=l||!T.overlay,I+=T.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&I>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=d&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,d,_,T=this.mapsService.getZoom(),I=l.length-1;I>=0;I--)if(d=l[I],_=this.layerService.getLayer(d.layerId),_&&_.inited){var R=_.getMinZoom(),ee=_.getMaxZoom();d.disabled=T<R||T>ee}}},{key:"addLayer",value:function(l,d,_){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:d,overlay:_});var T=this.controlOption,I=T.sortLayers,R=T.sortFunction,ee=T.autoZIndex;I&&this.layers.sort(function(X,ve){return R(X.layer,ve.layer,X.name,ve.name)}),ee&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var d=this.layerService.getLayer(l.target.layerId),_=d!=null&&d.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;_&&this.emit(_,d)}},{key:"createRadioElement",value:function(l,d){var _='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(d?' checked="checked"':"")+"/>",T=document.createElement("div");return T.innerHTML=_,T.firstChild}},{key:"addItem",value:function(l){var d=document.createElement("label"),_=this.layerService.getLayer(l.layer.id),T=_&&_.inited&&l.layer.isVisible(),I;l.overlay?(I=document.createElement("input"),I.type="checkbox",I.className="l7-control-layers-selector",I.defaultChecked=T):I=this.createRadioElement("l7-base-layers",T),this.layerControlInputs.push(I),I.layerId=l.layer.id,I.addEventListener("click",this.onInputClick);var R=document.createElement("span");R.innerHTML=" "+l.name;var ee=document.createElement("div");d.appendChild(ee),ee.appendChild(I),ee.appendChild(R);var X=l.overlay?this.overlaysList:this.baseLayersList;return X.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,d,_,T=[],I=[];this.handlingClick=!0;for(var R=l.length-1;R>=0;R--)d=l[R],_=this.layerService.getLayer(d.layerId),d.checked?T.push(_):d.checked||I.push(_);I.forEach(function(ee){ee.hide()}),T.forEach(function(ee){ee.show()}),this.handlingClick=!1}}]),a}(dr);function Ke(i){var c=Dt();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Dt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Xe=function(i){(0,Ne.Z)(a,i);var c=Ke(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{position:w.PositionType.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",d=rt.SO.create("div",l),_=rt.SO.create("a","l7-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://antv.alipay.com/l7",_.setAttribute("aria-label","AntV logo"),_.setAttribute("rel","noopener nofollow"),d.appendChild(_),d}},{key:"onRemove",value:function(){return null}}]),a}(dr);function Zt(i){var c=yr();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function yr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ur=function(i){(0,Ne.Z)(a,i);var c=Zt(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this,s),(0,L.Z)((0,N.Z)(l),"mScale",void 0),(0,L.Z)((0,N.Z)(l),"iScale",void 0),(0,rt.Ev)(["update"],(0,N.Z)(l)),l}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{position:w.PositionType.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",d=rt.SO.create("div",l);this.addScales(l+"-line",d);var _=this.controlOption.updateWhenIdle;return this.mapsService.on(_?"moveend":"mapmove",this.update),this.mapsService.on(_?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,d=this.controlOption.maxWidth,_=l.getSize()[1]/2,T=l.containerToLngLat([0,_]),I=l.containerToLngLat([d,_]),R=(0,rt.yM)([T.lng,T.lat],[I.lng,I.lat]);this.updateScales(R)}},{key:"updateScales",value:function(l){var d=this.controlOption,_=d.metric,T=d.imperial;_&&l&&this.updateMetric(l),T&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var d=this.getRoundNum(l),_=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,_,d/l)}},{key:"updateImperial",value:function(l){var d=l*3.2808399,_,T,I;d>5280?(_=d/5280,T=this.getRoundNum(_),this.updateScale(this.iScale,T+" mi",T/_)):(I=this.getRoundNum(d),this.updateScale(this.iScale,I+" ft",I/d))}},{key:"updateScale",value:function(l,d,_){var T=this.controlOption.maxWidth;l.style.width=Math.round(T*_)+"px",l.innerHTML=d}},{key:"getRoundNum",value:function(l){var d=Math.pow(10,(Math.floor(l)+"").length-1),_=l/d;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,d*_}},{key:"addScales",value:function(l,d){var _=this.controlOption,T=_.metric,I=_.imperial;T&&(this.mScale=rt.SO.create("div",l,d)),I&&(this.iScale=rt.SO.create("div",l,d))}}]),a}(dr);function Ur(i){var c=he();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function he(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Re=function(i){(0,Ne.Z)(a,i);var c=Ur(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this,s),(0,L.Z)((0,N.Z)(l),"disabled",void 0),(0,L.Z)((0,N.Z)(l),"zoomInButton",void 0),(0,L.Z)((0,N.Z)(l),"zoomOutButton",void 0),(0,rt.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,N.Z)(l)),l}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{position:w.PositionType.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",d=rt.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,d,_,T,I){var R=rt.SO.create("a",_,T);return R.innerHTML=l,R.title=d,R.href="javascript:void(0)",R.addEventListener("click",I),R}},{key:"updateDisabled",value:function(){var l=this.mapsService,d="l7-disabled";rt.SO.removeClass(this.zoomInButton,d),rt.SO.removeClass(this.zoomOutButton,d),(this.disabled||l.getZoom()<=l.getMinZoom())&&rt.SO.addClass(this.zoomOutButton,d),(this.disabled||l.getZoom()>=l.getMaxZoom())&&rt.SO.addClass(this.zoomInButton,d)}}]),a}(dr);function ge(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function _t(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ge(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):ge(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function pt(i){var c=zt();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function zt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ft=function(i){(0,Ne.Z)(a,i);var c=pt(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this),(0,L.Z)((0,N.Z)(l),"markerOption",void 0),(0,L.Z)((0,N.Z)(l),"defaultMarker",void 0),(0,L.Z)((0,N.Z)(l),"popup",void 0),(0,L.Z)((0,N.Z)(l),"mapsService",void 0),(0,L.Z)((0,N.Z)(l),"sceneSerive",void 0),(0,L.Z)((0,N.Z)(l),"lngLat",void 0),(0,L.Z)((0,N.Z)(l),"scene",void 0),(0,L.Z)((0,N.Z)(l),"added",!1),(0,L.Z)((0,N.Z)(l),"eventHandle",function(d){l.emit(d.type,{target:d,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=_t(_t({},l.getDefault()),s),(0,rt.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,N.Z)(l)),l.init(),l}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{element:void 0,anchor:rt.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(w.vK.IMapService),this.sceneSerive=l.get(w.vK.ISceneService);var d=this.markerOption,_=d.element,T=d.draggable;return this.mapsService.getMarkerContainer().appendChild(_),this.registerMarkerEvent(_),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&rt.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var d=this;if(!this.added)return this.once("added",function(){d.setElement(l)}),this;var _=this.markerOption.element;return _&&rt.SO.remove(_),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,_=l.anchor;this.updatePosition(),rt.SO.setTransform(d,"".concat(rt.rQ[_]))}}},{key:"onMapClick",value:function(l){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,_=l.offsets,T=this.lngLat,I=T.lng,R=T.lat,ee=this.mapsService.getBounds(),X=this.mapsService.lngLatToContainer([I,R]);if(d){d.style.display="block";var ve=this.mapsService.getContainer(),Be=0,lt=0;if(ve&&(Be=ve.scrollWidth,lt=ve.scrollHeight),Math.abs(ee[0][0])>180||Math.abs(ee[1][0])>180){if(X.x>Be){var Mt=this.mapsService.lngLatToContainer([I-360,R]);X.x=Mt.x}if(X.x<0){var pr=this.mapsService.lngLatToContainer([I+360,R]);X.x=pr.x}}(X.x>Be||X.x<0||X.y>lt||X.y<0)&&(d.style.display="none"),d.style.left=X.x+_[0]+"px",d.style.top=X.y-_[1]+"px"}}}},{key:"init",value:function(){var l=this,d=this.markerOption.element,_=this.markerOption,T=_.color,I=_.anchor;if(!d){this.defaultMarker=!0,d=rt.SO.create("div"),this.markerOption.element=d;var R=document.createElementNS("http://www.w3.org/2000/svg","svg");R.setAttributeNS(null,"display","block"),R.setAttributeNS(null,"height","48px"),R.setAttributeNS(null,"width","48px"),R.setAttributeNS(null,"viewBox","0 0 1024 1024");var ee=document.createElementNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),ee.setAttributeNS(null,"fill",T),R.appendChild(ee),d.appendChild(R)}rt.SO.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(X){var ve,Be,lt=((ve=l.markerOption)===null||ve===void 0?void 0:ve.style)&&((Be=l.markerOption)===null||Be===void 0?void 0:Be.style[X]);d&&(d.style[X]=lt)}),d.addEventListener("click",function(X){l.onMapClick(X)}),d.addEventListener("click",this.eventHandle),(0,rt.zi)(d,I,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),a}(Xt.EventEmitter),Dr=S(28440),pn=S.n(Dr),mn=S(983),Xi=S.n(mn);function ir(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function pe(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ir(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):ir(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function Pe(i){var c=Ze();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ze(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Le=function(i){(0,Ne.Z)(a,i);var c=Pe(a);function a(s){var l,d;return(0,K.Z)(this,a),d=c.call(this),(0,L.Z)((0,N.Z)(d),"markers",[]),(0,L.Z)((0,N.Z)(d),"markerLayerOption",void 0),(0,L.Z)((0,N.Z)(d),"clusterIndex",void 0),(0,L.Z)((0,N.Z)(d),"points",[]),(0,L.Z)((0,N.Z)(d),"clusterMarkers",[]),(0,L.Z)((0,N.Z)(d),"mapsService",void 0),(0,L.Z)((0,N.Z)(d),"scene",void 0),(0,L.Z)((0,N.Z)(d),"zoom",void 0),(0,L.Z)((0,N.Z)(d),"bbox",void 0),d.markerLayerOption=pn()(d.getDefault(),s),(0,rt.Ev)(["update"],(0,N.Z)(d)),d.zoom=((l=d.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,d}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(w.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var d=this.markerLayerOption.cluster;d&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var d=this.markers.indexOf(l);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(d){d.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,d){var _=l.getLnglat(),T=_.lng,I=_.lat,R={geometry:{type:"Point",coordinates:[T,I]},properties:pe(pe({},l.getExtData()),{},{marker_id:d})};this.points.push(R)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,d=l.radius,_=l.minZoom,T=_===void 0?0:_,I=l.maxZoom;this.clusterIndex=new(Xi())({radius:d,minZoom:T,maxZoom:I}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,d){var _=this,T=l[0].concat(l[1]),I=this.clusterIndex.getClusters(T,d);this.clusterMarkers.forEach(function(R){R.remove()}),this.clusterMarkers=[],I.forEach(function(R){var ee,X=_.markerLayerOption.clusterOption,ve=X.field,Be=X.method;if(R.properties&&(ee=R.properties)!==null&&ee!==void 0&&ee.cluster_id){var lt,Mt=_.getLeaves((lt=R.properties)===null||lt===void 0?void 0:lt.cluster_id);if(R.properties.clusterData=Mt,ve&&Be){var pr=Mt==null?void 0:Mt.map(function(In){var oi=(0,L.Z)({},ve,In.properties[ve]);return oi}),xr=rt.a5.getColumn(pr,ve),kr=rt.a5.getSatByColumn(Be,xr),hn="point_"+Be;R.properties[hn]=kr.toFixed(2)}}var cn=_.clusterMarker(R);_.clusterMarkers.push(cn),cn.addTo(_.scene)})}},{key:"getLeaves",value:function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,d,_):null}},{key:"clusterMarker",value:function(l){var d=this.markerLayerOption.clusterOption,_=d,T=_.element,I=T===void 0?this.generateElement.bind(this):T,R=new Ft({element:I(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return R}},{key:"normalMarker",value:function(l){var d=l.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,rt.oO)(this.bbox,d))&&(this.bbox=(0,rt.yA)(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var d=rt.SO.create("div","l7-marker-cluster"),_=rt.SO.create("div","",d),T=rt.SO.create("span","",_),I=this.markerLayerOption.clusterOption,R=I.field,ee=I.method;l.properties.point_count=l.properties.point_count||1;var X=R&&ee?l.properties["point_"+ee]||l.properties[R]:l.properties.point_count;return T.textContent=X,d}}]),a}(Xt.EventEmitter);function It(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function tr(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?It(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):It(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function E(i){var c=Z();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Z(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var be=function(i){(0,Ne.Z)(a,i);var c=E(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this),(0,L.Z)((0,N.Z)(l),"popupOption",void 0),(0,L.Z)((0,N.Z)(l),"mapsService",void 0),(0,L.Z)((0,N.Z)(l),"sceneSerive",void 0),(0,L.Z)((0,N.Z)(l),"lngLat",void 0),(0,L.Z)((0,N.Z)(l),"content",void 0),(0,L.Z)((0,N.Z)(l),"closeButton",void 0),(0,L.Z)((0,N.Z)(l),"timeoutInstance",void 0),(0,L.Z)((0,N.Z)(l),"container",void 0),(0,L.Z)((0,N.Z)(l),"tip",void 0),(0,L.Z)((0,N.Z)(l),"scene",void 0),l.popupOption=tr(tr({},l.getdefault()),s),(0,rt.Ev)(["update","onClickClose","remove"],(0,N.Z)(l)),l}return(0,W.Z)(a,[{key:"addTo",value:function(l){var d=this;return this.mapsService=l.get(w.vK.IMapService),this.sceneSerive=l.get(w.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var d=window.document.createDocumentFragment(),_=window.document.createElement("body"),T;for(_.innerHTML=l;T=_.firstChild,!!T;)d.appendChild(T);return this.setDOMContent(d)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&rt.SO.remove(this.content),this.content=rt.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=rt.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,d,_){var T=window.document.createElement(l);return d!==void 0&&(T.className=d),_&&_.appendChild(T),T}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:rt.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,d=this.lngLat,_=this.popupOption,T=_.className,I=_.maxWidth,R=_.anchor;if(!(!this.mapsService||!d||!this.content)){var ee=this.mapsService.getMarkerContainer();if(!this.container&&ee){this.container=this.creatDom("div","l7-popup",ee),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),T&&T.split(" ").forEach(function(ve){return l.container.classList.add(ve)});var X=this.popupOption.stopPropagation;X&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(ve){l.container.addEventListener(ve,function(Be){Be.stopPropagation()})})}I&&this.container.style.maxWidth!==I&&(this.container.style.maxWidth=I),this.updatePosition(),rt.SO.setTransform(this.container,"".concat(rt.rQ[R])),(0,rt.zi)(this.container,R,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,d=l.lng,_=l.lat,T=this.popupOption.offsets,I=this.mapsService.lngLatToContainer([d,_]);this.container.style.left=I.x+T[0]+"px",this.container.style.top=I.y-T[1]+"px"}}}]),a}(Xt.EventEmitter);function Ge(i,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=i:l.appendChild(c.createTextNode(i)),a.appendChild(l),l}}Ge(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var qe=S(30513),gt=S(90122),St=S.n(gt),Ct=S(99311),Vt=S(30954),qt=S.n(Vt),ie=S(78892),sr=function(){function i(c,a){(0,K.Z)(this,i),(0,L.Z)(this,"attribute",void 0),(0,L.Z)(this,"buffer",void 0);var s=a.buffer,l=a.offset,d=a.stride,_=a.normalized,T=a.size,I=a.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:d||0,normalized:_||!1,divisor:I||0},T&&(this.attribute.size=T)}return(0,W.Z)(i,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(a){this.buffer.subData(a)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),i}(),Mr,Nr,tt,mt,yt,hr,Gr,Zr,Jr,qr,Er,Jn,Wn,Ti,$i=(Mr={},(0,L.Z)(Mr,w.gl.POINTS,"points"),(0,L.Z)(Mr,w.gl.LINES,"lines"),(0,L.Z)(Mr,w.gl.LINE_LOOP,"line loop"),(0,L.Z)(Mr,w.gl.LINE_STRIP,"line strip"),(0,L.Z)(Mr,w.gl.TRIANGLES,"triangles"),(0,L.Z)(Mr,w.gl.TRIANGLE_FAN,"triangle fan"),(0,L.Z)(Mr,w.gl.TRIANGLE_STRIP,"triangle strip"),Mr),Ji=(Nr={},(0,L.Z)(Nr,w.gl.STATIC_DRAW,"static"),(0,L.Z)(Nr,w.gl.DYNAMIC_DRAW,"dynamic"),(0,L.Z)(Nr,w.gl.STREAM_DRAW,"stream"),Nr),Pi=(tt={},(0,L.Z)(tt,w.gl.BYTE,"int8"),(0,L.Z)(tt,w.gl.UNSIGNED_INT,"int16"),(0,L.Z)(tt,w.gl.INT,"int32"),(0,L.Z)(tt,w.gl.UNSIGNED_BYTE,"uint8"),(0,L.Z)(tt,w.gl.UNSIGNED_SHORT,"uint16"),(0,L.Z)(tt,w.gl.UNSIGNED_INT,"uint32"),(0,L.Z)(tt,w.gl.FLOAT,"float"),tt),Ri=(mt={},(0,L.Z)(mt,w.gl.ALPHA,"alpha"),(0,L.Z)(mt,w.gl.LUMINANCE,"luminance"),(0,L.Z)(mt,w.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,L.Z)(mt,w.gl.RGB,"rgb"),(0,L.Z)(mt,w.gl.RGBA,"rgba"),(0,L.Z)(mt,w.gl.RGBA4,"rgba4"),(0,L.Z)(mt,w.gl.RGB5_A1,"rgb5 a1"),(0,L.Z)(mt,w.gl.RGB565,"rgb565"),(0,L.Z)(mt,w.gl.DEPTH_COMPONENT,"depth"),(0,L.Z)(mt,w.gl.DEPTH_STENCIL,"depth stencil"),mt),Y=(yt={},(0,L.Z)(yt,w.gl.DONT_CARE,"dont care"),(0,L.Z)(yt,w.gl.NICEST,"nice"),(0,L.Z)(yt,w.gl.FASTEST,"fast"),yt),ce=(hr={},(0,L.Z)(hr,w.gl.NEAREST,"nearest"),(0,L.Z)(hr,w.gl.LINEAR,"linear"),(0,L.Z)(hr,w.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,L.Z)(hr,w.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,L.Z)(hr,w.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,L.Z)(hr,w.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),hr),me=(Gr={},(0,L.Z)(Gr,w.gl.REPEAT,"repeat"),(0,L.Z)(Gr,w.gl.CLAMP_TO_EDGE,"clamp"),(0,L.Z)(Gr,w.gl.MIRRORED_REPEAT,"mirror"),Gr),z=(Zr={},(0,L.Z)(Zr,w.gl.NONE,"none"),(0,L.Z)(Zr,w.gl.BROWSER_DEFAULT_WEBGL,"browser"),Zr),oe=(Jr={},(0,L.Z)(Jr,w.gl.NEVER,"never"),(0,L.Z)(Jr,w.gl.ALWAYS,"always"),(0,L.Z)(Jr,w.gl.LESS,"less"),(0,L.Z)(Jr,w.gl.LEQUAL,"lequal"),(0,L.Z)(Jr,w.gl.GREATER,"greater"),(0,L.Z)(Jr,w.gl.GEQUAL,"gequal"),(0,L.Z)(Jr,w.gl.EQUAL,"equal"),(0,L.Z)(Jr,w.gl.NOTEQUAL,"notequal"),Jr),de=(qr={},(0,L.Z)(qr,w.gl.FUNC_ADD,"add"),(0,L.Z)(qr,w.gl.MIN_EXT,"min"),(0,L.Z)(qr,w.gl.MAX_EXT,"max"),(0,L.Z)(qr,w.gl.FUNC_SUBTRACT,"subtract"),(0,L.Z)(qr,w.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),qr),Ae=(Er={},(0,L.Z)(Er,w.gl.ZERO,"zero"),(0,L.Z)(Er,w.gl.ONE,"one"),(0,L.Z)(Er,w.gl.SRC_COLOR,"src color"),(0,L.Z)(Er,w.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,L.Z)(Er,w.gl.SRC_ALPHA,"src alpha"),(0,L.Z)(Er,w.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,L.Z)(Er,w.gl.DST_COLOR,"dst color"),(0,L.Z)(Er,w.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,L.Z)(Er,w.gl.DST_ALPHA,"dst alpha"),(0,L.Z)(Er,w.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,L.Z)(Er,w.gl.CONSTANT_COLOR,"constant color"),(0,L.Z)(Er,w.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,L.Z)(Er,w.gl.CONSTANT_ALPHA,"constant alpha"),(0,L.Z)(Er,w.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,L.Z)(Er,w.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),Er),se=(Jn={},(0,L.Z)(Jn,w.gl.NEVER,"never"),(0,L.Z)(Jn,w.gl.ALWAYS,"always"),(0,L.Z)(Jn,w.gl.LESS,"less"),(0,L.Z)(Jn,w.gl.LEQUAL,"lequal"),(0,L.Z)(Jn,w.gl.GREATER,"greater"),(0,L.Z)(Jn,w.gl.GEQUAL,"gequal"),(0,L.Z)(Jn,w.gl.EQUAL,"equal"),(0,L.Z)(Jn,w.gl.NOTEQUAL,"notequal"),Jn),Ee=(Wn={},(0,L.Z)(Wn,w.gl.ZERO,"zero"),(0,L.Z)(Wn,w.gl.KEEP,"keep"),(0,L.Z)(Wn,w.gl.REPLACE,"replace"),(0,L.Z)(Wn,w.gl.INVERT,"invert"),(0,L.Z)(Wn,w.gl.INCR,"increment"),(0,L.Z)(Wn,w.gl.DECR,"decrement"),(0,L.Z)(Wn,w.gl.INCR_WRAP,"increment wrap"),(0,L.Z)(Wn,w.gl.DECR_WRAP,"decrement wrap"),Wn),dt=(Ti={},(0,L.Z)(Ti,w.gl.FRONT,"front"),(0,L.Z)(Ti,w.gl.BACK,"back"),Ti),br=function(){function i(c,a){(0,K.Z)(this,i),(0,L.Z)(this,"buffer",void 0);var s=a.data,l=a.usage,d=a.type;this.buffer=c.buffer({data:s,usage:Ji[l||w.gl.STATIC_DRAW],type:Pi[d||w.gl.UNSIGNED_BYTE]})}return(0,W.Z)(i,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(a){var s=a.data,l=a.offset;this.buffer.subdata(s,l)}}]),i}(),Ht=function(){function i(c,a){(0,K.Z)(this,i),(0,L.Z)(this,"elements",void 0);var s=a.data,l=a.usage,d=a.type,_=a.count;this.elements=c.elements({data:s,usage:Ji[l||w.gl.STATIC_DRAW],type:Pi[d||w.gl.UNSIGNED_BYTE],count:_})}return(0,W.Z)(i,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(a){var s=a.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),i}(),Qt=function(){function i(c,a){(0,K.Z)(this,i),(0,L.Z)(this,"framebuffer",void 0);var s=a.width,l=a.height,d=a.color,_=a.colors,T=a.depth,I=a.stencil,R={width:s,height:l};Array.isArray(_)&&(R.colors=_.map(function(ee){return ee.get()})),d&&typeof d!="boolean"&&(R.color=d.get()),this.framebuffer=c.framebuffer(R)}return(0,W.Z)(i,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.framebuffer.resize(s,l)}}]),i}(),Rr=S(53383),kn=S(18397),Ln=S.n(kn),$t=S(19308),Cn=S.n($t);function sn(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function an(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?sn(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):sn(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}var Ii=function(){function i(c,a){(0,K.Z)(this,i),(0,L.Z)(this,"reGl",void 0),(0,L.Z)(this,"destroyed",!1),(0,L.Z)(this,"drawCommand",void 0),(0,L.Z)(this,"drawParams",void 0),(0,L.Z)(this,"options",void 0),(0,L.Z)(this,"uniforms",{}),this.reGl=c;var s=a.vs,l=a.fs,d=a.attributes,_=a.uniforms,T=a.primitive,I=a.count,R=a.elements,ee=a.depth,X=a.blend,ve=a.stencil,Be=a.cull,lt=a.instances,Mt={};this.options=a,_&&(this.uniforms=this.extractUniforms(_),Object.keys(_).forEach(function(kr){Mt[kr]=c.prop(kr)}));var pr={};Object.keys(d).forEach(function(kr){pr[kr]=d[kr].get()});var xr={attributes:pr,frag:l,uniforms:Mt,vert:s,primitive:$i[T===void 0?w.gl.TRIANGLES:T]};lt&&(xr.instances=lt),I&&(xr.count=I),R&&(xr.elements=R.get()),this.initDepthDrawParams({depth:ee},xr),this.initBlendDrawParams({blend:X},xr),this.initStencilDrawParams({stencil:ve},xr),this.initCullDrawParams({cull:Be},xr),this.drawCommand=c(xr),this.drawParams=xr}return(0,W.Z)(i,[{key:"addUniforms",value:function(a){this.uniforms=an(an({},this.uniforms),this.extractUniforms(a))}},{key:"draw",value:function(a){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=an(an({},this.uniforms),this.extractUniforms(a.uniforms||{})),l={};Object.keys(s).forEach(function(d){var _=(0,Rr.Z)(s[d]);_==="boolean"||_==="number"||Array.isArray(s[d])||s[d].BYTES_PER_ELEMENT?l[d]=s[d]:l[d]=s[d].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(a){a.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(a,s){var l=a.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:oe[l.func||w.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(a,s){var l=a.blend;if(l){var d=l.enable,_=l.func,T=l.equation,I=l.color,R=I===void 0?[0,0,0,0]:I;s.blend={enable:!!d,func:{srcRGB:Ae[_&&_.srcRGB||w.gl.SRC_ALPHA],srcAlpha:Ae[_&&_.srcAlpha||w.gl.SRC_ALPHA],dstRGB:Ae[_&&_.dstRGB||w.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:Ae[_&&_.dstAlpha||w.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:de[T&&T.rgb||w.gl.FUNC_ADD],alpha:de[T&&T.alpha||w.gl.FUNC_ADD]},color:R}}}},{key:"initStencilDrawParams",value:function(a,s){var l=a.stencil;if(l){var d=l.enable,_=l.mask,T=_===void 0?-1:_,I=l.func,R=I===void 0?{cmp:w.gl.ALWAYS,ref:0,mask:-1}:I,ee=l.opFront,X=ee===void 0?{fail:w.gl.KEEP,zfail:w.gl.KEEP,zpass:w.gl.KEEP}:ee,ve=l.opBack,Be=ve===void 0?{fail:w.gl.KEEP,zfail:w.gl.KEEP,zpass:w.gl.KEEP}:ve;s.stencil={enable:!!d,mask:T,func:an(an({},R),{},{cmp:se[R.cmp]}),opFront:{fail:Ee[X.fail],zfail:Ee[X.zfail],zpass:Ee[X.zpass]},opBack:{fail:Ee[Be.fail],zfail:Ee[Be.zfail],zpass:Ee[Be.zpass]}}}}},{key:"initCullDrawParams",value:function(a,s){var l=a.cull;if(l){var d=l.enable,_=l.face,T=_===void 0?w.gl.BACK:_;s.cull={enable:!!d,face:dt[T]}}}},{key:"extractUniforms",value:function(a){var s=this,l={};return Object.keys(a).forEach(function(d){s.extractUniformsRecursively(d,a[d],l,"")}),l}},{key:"extractUniformsRecursively",value:function(a,s,l,d){var _=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||Ln()(s)||s===""||"resize"in s){l["".concat(d&&d+".").concat(a)]=s;return}Cn()(s)&&Object.keys(s).forEach(function(T){_.extractUniformsRecursively(T,s[T],l,"".concat(d&&d+".").concat(a))}),Array.isArray(s)&&s.forEach(function(T,I){Object.keys(T).forEach(function(R){_.extractUniformsRecursively(R,T[R],l,"".concat(d&&d+".").concat(a,"[").concat(I,"]"))})})}}]),i}(),xn=function(){function i(c,a){(0,K.Z)(this,i),(0,L.Z)(this,"texture",void 0),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0);var s=a.data,l=a.type,d=l===void 0?w.gl.UNSIGNED_BYTE:l,_=a.width,T=a.height,I=a.flipY,R=I===void 0?!1:I,ee=a.format,X=ee===void 0?w.gl.RGBA:ee,ve=a.mipmap,Be=ve===void 0?!1:ve,lt=a.wrapS,Mt=lt===void 0?w.gl.CLAMP_TO_EDGE:lt,pr=a.wrapT,xr=pr===void 0?w.gl.CLAMP_TO_EDGE:pr,kr=a.aniso,hn=kr===void 0?0:kr,cn=a.alignment,In=cn===void 0?1:cn,oi=a.premultiplyAlpha,vn=oi===void 0?!1:oi,mi=a.mag,Ki=mi===void 0?w.gl.NEAREST:mi,ba=a.min,pi=ba===void 0?w.gl.NEAREST:ba,Ia=a.colorSpace,to=Ia===void 0?w.gl.BROWSER_DEFAULT_WEBGL:Ia;this.width=_,this.height=T;var Cu={width:_,height:T,type:Pi[d],format:Ri[X],wrapS:me[Mt],wrapT:me[xr],mag:ce[Ki],min:ce[pi],alignment:In,flipY:R,colorSpace:z[to],premultiplyAlpha:vn,aniso:hn};s&&(Cu.data=s),typeof Be=="number"?Cu.mipmap=Y[Be]:typeof Be=="boolean"&&(Cu.mipmap=Be),this.texture=c.texture(Cu)}return(0,W.Z)(i,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(a)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),i}(),Ai,Qi,li=(Ai=(0,Ct.b2)(),Ai(Qi=function(){function i(){var c=this;(0,K.Z)(this,i),(0,L.Z)(this,"extensionObject",void 0),(0,L.Z)(this,"gl",void 0),(0,L.Z)(this,"$container",void 0),(0,L.Z)(this,"canvas",void 0),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0),(0,L.Z)(this,"isDirty",void 0),(0,L.Z)(this,"createModel",function(a){return new Ii(c.gl,a)}),(0,L.Z)(this,"createAttribute",function(a){return new sr(c.gl,a)}),(0,L.Z)(this,"createBuffer",function(a){return new br(c.gl,a)}),(0,L.Z)(this,"createElements",function(a){return new Ht(c.gl,a)}),(0,L.Z)(this,"createTexture2D",function(a){return new xn(c.gl,a)}),(0,L.Z)(this,"createFramebuffer",function(a){return new Qt(c.gl,a)}),(0,L.Z)(this,"useFramebuffer",function(a,s){c.gl({framebuffer:a?a.get():null})(s)}),(0,L.Z)(this,"clear",function(a){var s=a.color,l=a.depth,d=a.stencil,_=a.framebuffer,T=_===void 0?null:_,I={color:s,depth:l,stencil:d};I.framebuffer=T===null?T:T.get(),c.gl.clear(I)}),(0,L.Z)(this,"viewport",function(a){var s=a.x,l=a.y,d=a.width,_=a.height;c.gl._gl.viewport(s,l,d,_),c.width=d,c.height=_,c.gl._refresh()}),(0,L.Z)(this,"readPixels",function(a){var s=a.framebuffer,l=a.x,d=a.y,_=a.width,T=a.height,I={x:l,y:d,width:_,height:T};return s&&(I.framebuffer=s.get()),c.gl.read(I)}),(0,L.Z)(this,"getViewportSize",function(){return{width:c.gl._gl.drawingBufferWidth,height:c.gl._gl.drawingBufferHeight}}),(0,L.Z)(this,"getContainer",function(){var a;return(a=c.canvas)===null||a===void 0?void 0:a.parentElement}),(0,L.Z)(this,"getCanvas",function(){return c.canvas}),(0,L.Z)(this,"getGLContext",function(){return c.gl._gl}),(0,L.Z)(this,"destroy",function(){c.gl.destroy()})}return(0,W.Z)(i,[{key:"init",value:function(){var c=(0,qe.Z)(St().mark(function s(l,d){var _=this;return St().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return this.canvas=l,I.next=3,new Promise(function(R,ee){qt()({canvas:_.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(ve,Be){(ve||!Be)&&ee(ve),R(Be)}})});case 3:this.gl=I.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return I.stop()}},s,this)}));function a(s,l){return c.apply(this,arguments)}return a}()},{key:"testExtension",value:function(a){return!!this.getGLContext().getExtension(a)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var a=this.getGLContext();a.disable(a.CULL_FACE)}},{key:"setDirty",value:function(a){this.isDirty=a}},{key:"getDirty",value:function(){return this.isDirty}}]),i}())||Qi);function Yi(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function Bi(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Yi(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Yi(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}var wi=function(){function i(c){(0,K.Z)(this,i),(0,L.Z)(this,"sceneService",void 0),(0,L.Z)(this,"mapService",void 0),(0,L.Z)(this,"controlService",void 0),(0,L.Z)(this,"layerService",void 0),(0,L.Z)(this,"iconService",void 0),(0,L.Z)(this,"markerService",void 0),(0,L.Z)(this,"popupService",void 0),(0,L.Z)(this,"fontService",void 0),(0,L.Z)(this,"interactionService",void 0),(0,L.Z)(this,"container",void 0);var a=c.id,s=c.map,l=(0,w.Hp)();this.container=l,s.setContainer(l,a),l.bind(w.vK.IRendererService).to(li).inSingletonScope(),this.sceneService=l.get(w.vK.ISceneService),this.mapService=l.get(w.vK.IMapService),this.iconService=l.get(w.vK.IIconService),this.fontService=l.get(w.vK.IFontService),this.controlService=l.get(w.vK.IControlService),this.layerService=l.get(w.vK.ILayerService),this.markerService=l.get(w.vK.IMarkerService),this.interactionService=l.get(w.vK.IInteractionService),this.popupService=l.get(w.vK.IPopupService),this.initComponent(a),this.sceneService.init(c),this.initControl()}return(0,W.Z)(i,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(a){return this.sceneService.exportPng(a)}},{key:"exportMap",value:function(a){return this.sceneService.exportPng(a)}},{key:"registerRenderService",value:function(a){var s=this;if(this.sceneService.loaded){var l=new a(this);l.init()}else this.on("loaded",function(){var d=new a(s);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(a){var s=(0,w.e7)(this.container);a.setContainer(s),this.sceneService.addLayer(a)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(a){return this.layerService.getLayer(a)}},{key:"getLayerByName",value:function(a){return this.layerService.getLayerByName(a)}},{key:"removeLayer",value:function(a){this.layerService.remove(a)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(a,s){this.fontService.addIconFont(a,s)}},{key:"addIconFonts",value:function(a){var s=this;a.forEach(function(l){var d=(0,q.Z)(l,2),_=d[0],T=d[1];s.fontService.addIconFont(_,T)})}},{key:"addFontFace",value:function(a,s){this.sceneService.addFontFace(a,s)}},{key:"addImage",value:function(a,s){this.iconService.addImage(a,s)}},{key:"hasImage",value:function(a){return this.iconService.hasImage(a)}},{key:"removeImage",value:function(a){this.iconService.removeImage(a)}},{key:"addIconFontGlyphs",value:function(a,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(a){this.controlService.addControl(a,this.container)}},{key:"removeControl",value:function(a){this.controlService.removeControl(a)}},{key:"getControlByName",value:function(a){return this.controlService.getControlByName(a)}},{key:"addMarker",value:function(a){this.markerService.addMarker(a)}},{key:"addMarkerLayer",value:function(a){this.markerService.addMarkerLayer(a)}},{key:"removeMarkerLayer",value:function(a){this.markerService.removeMarkerLayer(a)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(a){this.popupService.addPopup(a)}},{key:"on",value:function(a,s){w.SceneEventList.indexOf(a)===-1?this.mapService.on(a,s):this.sceneService.on(a,s)}},{key:"once",value:function(a,s){w.SceneEventList.indexOf(a)===-1?this.mapService.once(a,s):this.sceneService.once(a,s)}},{key:"off",value:function(a,s){w.SceneEventList.indexOf(a)===-1?this.mapService.off(a,s):this.sceneService.off(a,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(a){return this.mapService.getCenter(a)}},{key:"setCenter",value:function(a,s){return this.mapService.setCenter(a,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(a){return this.mapService.setPitch(a)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(a){this.mapService.setRotation(a)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(a){this.mapService.panTo(a)}},{key:"panBy",value:function(a){this.mapService.panBy(a)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(a){this.mapService.setZoom(a)}},{key:"fitBounds",value:function(a,s){var l=this.sceneService.getSceneConfig(),d=l.fitBoundsOptions,_=l.animate;this.mapService.fitBounds(a,s||Bi(Bi({},d),{},{animate:_}))}},{key:"setZoomAndCenter",value:function(a,s){this.mapService.setZoomAndCenter(a,s)}},{key:"setMapStyle",value:function(a){this.mapService.setMapStyle(a)}},{key:"setMapStatus",value:function(a){this.mapService.setMapStatus(a)}},{key:"pixelToLngLat",value:function(a){return this.mapService.pixelToLngLat(a)}},{key:"lngLatToPixel",value:function(a){return this.mapService.lngLatToPixel(a)}},{key:"containerToLngLat",value:function(a){return this.mapService.containerToLngLat(a)}},{key:"lngLatToContainer",value:function(a){return this.mapService.lngLatToContainer(a)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(a,s){this.container.bind(w.vK.IPostProcessingPass).to(a).whenTargetNamed(s)}},{key:"initComponent",value:function(a){this.controlService.init({container:rt.SO.getContainer(a)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var a=this.sceneService.getSceneConfig(),s=a.logoVisible,l=a.logoPosition;s&&this.addControl(new Xe({position:l}))}}]),i}(),sa=S(96320),Fi=S(84904),ni=S(7273),Di=S(20816),Ei=S.n(Di),no=S(9363),ho=S.n(no),ta=S(65859),Vi,Ns,tu,Aa,No;function Gi(i){return i.map(function(c){return typeof c=="string"&&(c=[c,{}]),c})}var Wa=(Vi=(0,Ct.b2)(),Ns=(0,Ct.f3)(w.vK.IGlobalConfigService),Vi(tu=(Aa=function(){function i(){(0,K.Z)(this,i),(0,Fi.Z)(this,"configService",No,this),(0,L.Z)(this,"enabled",void 0)}return(0,W.Z)(i,[{key:"apply",value:function(a,s){var l=this,d=s.rendererService,_=s.postProcessingPassFactory,T=s.normalPassFactory;a.hooks.init.tap("MultiPassRendererPlugin",function(){var I=a.getLayerConfig(),R=I.enableMultiPassRenderer,ee=I.passes,X=ee===void 0?[]:ee;l.enabled=!!R&&a.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(a.multiPassRenderer=l.createMultiPassRenderer(a,X,_,T),a.multiPassRenderer.setRenderFlag(!0))}),a.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(a,s,l,d){var _=a.multiPassRenderer,T=a.getLayerConfig(),I=T.enablePicking,R=T.enableTAA;return I&&_.add(d("pixelPicking")),_}}]),i}(),No=(0,ni.Z)(Aa.prototype,"configService",[Ns],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa))||tu),oo,ma=(oo={},(0,L.Z)(oo,w.h0.additive,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,L.Z)(oo,w.h0.none,{enable:!1}),(0,L.Z)(oo,w.h0.normal,{enable:!0,func:{srcRGB:w.gl.SRC_ALPHA,dstRGB:w.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,L.Z)(oo,w.h0.subtractive,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE,srcAlpha:w.gl.ZERO,dstAlpha:w.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:w.gl.FUNC_SUBTRACT,alpha:w.gl.FUNC_SUBTRACT}}),(0,L.Z)(oo,w.h0.max,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE},equation:{rgb:w.gl.MAX_EXT}}),(0,L.Z)(oo,w.h0.min,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE},equation:{rgb:w.gl.MIN_EXT}}),oo),Lo=S(7941),ka=S.n(Lo),bs=S(68868),ki=S.n(bs),Ko=S(80744),ga=S.n(Ko),po=1024;function Da(i,c,a,s,l){c.updateStyleAttribute(i,a,s,l)}function So(i,c){i.opacity&&ye("opacity",c,i.opacity),i.strokeWidth&&ye("strokeWidth",c,i.strokeWidth),i.strokeOpacity&&ye("strokeOpacity",c,i.strokeOpacity),i.stroke&&ct("stroke",c,i.stroke),i.offsets&&De("offsets",c,i.offsets),i.textOffset&&De("textOffset",c,i.textOffset)}function ye(i,c,a){ka()(a)?Da(i,c,a,function(s){return s}):ki()(a)?Da(i,c,[a],void 0):ga()(a)&&a.length===2?ka()(a[0])&&ho()(a[1])||ka()(a[0])&&ga()(a[1])&&ki()(a[1][0])&&ki()(a[1][1])?Da(i,c,a[0],a[1]):Da(i,c,[1],void 0):Da(i,c,[1],void 0)}function De(i,c,a){ka()(a)?Da(i,c,a,function(s){return s}):ga()(a)&&a.length===2&&ka()(a[0])&&ho()(a[1])?Da(i,c,a[0],a[1]):ga()(a)&&a.length===2&&ki()(a[0])&&ki()(a[1])?Da(i,c,a,void 0):Da(i,c,[0,0],void 0)}function ct(i,c,a){ka()(a)?Da(i,c,a,void 0):ga()(a)&&a.length===2&&(ka()(a[0])&&ho()(a[1])||ka()(a[0])&&ga()(a[1])&&a[1].length>0)?Da(i,c,a[0],a[1]):Da(i,c,"#fff",void 0)}var Yt,Wr,Qn,Si,Za;function vo(i,c){var a=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!a){if(Array.isArray(i)||(a=so(i))||c&&i&&typeof i.length=="number"){a&&(i=a);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){a=a.call(i)},n:function(){var R=a.next();return d=R.done,R},e:function(R){_=!0,T=R},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function so(i,c){if(!!i){if(typeof i=="string")return es(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return es(i,c)}}function es(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}function Hs(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function ja(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Hs(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Hs(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function Bu(i){var c=ts();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var zo=0,uo=(Yt=(0,w.yT)(w.vK.IGlobalConfigService),Wr=(0,w.yT)(w.vK.IShaderModuleService),Qn=function(i){(0,Ne.Z)(a,i);var c=Bu(a);function a(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,K.Z)(this,a),s=c.call(this),(0,L.Z)((0,N.Z)(s),"id","".concat(zo++)),(0,L.Z)((0,N.Z)(s),"name","".concat(zo)),(0,L.Z)((0,N.Z)(s),"type",void 0),(0,L.Z)((0,N.Z)(s),"visible",!0),(0,L.Z)((0,N.Z)(s),"zIndex",0),(0,L.Z)((0,N.Z)(s),"minZoom",void 0),(0,L.Z)((0,N.Z)(s),"maxZoom",void 0),(0,L.Z)((0,N.Z)(s),"inited",!1),(0,L.Z)((0,N.Z)(s),"layerModelNeedUpdate",!1),(0,L.Z)((0,N.Z)(s),"pickedFeatureID",null),(0,L.Z)((0,N.Z)(s),"selectedFeatureID",null),(0,L.Z)((0,N.Z)(s),"styleNeedUpdate",!1),(0,L.Z)((0,N.Z)(s),"rendering",void 0),(0,L.Z)((0,N.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,L.Z)((0,N.Z)(s),"hooks",{init:new ta.oI,afterInit:new ta.oI,beforeRender:new ta.oI,beforeRenderData:new ta.gg,afterRender:new ta.ni,beforePickingEncode:new ta.ni,afterPickingEncode:new ta.ni,beforeHighlight:new ta.ni(["pickedColor"]),afterHighlight:new ta.ni,beforeSelect:new ta.ni(["pickedColor"]),afterSelect:new ta.ni,beforeDestroy:new ta.ni,afterDestroy:new ta.ni}),(0,L.Z)((0,N.Z)(s),"models",[]),(0,L.Z)((0,N.Z)(s),"multiPassRenderer",void 0),(0,L.Z)((0,N.Z)(s),"plugins",void 0),(0,L.Z)((0,N.Z)(s),"sourceOption",void 0),(0,L.Z)((0,N.Z)(s),"layerModel",void 0),(0,Fi.Z)((0,N.Z)(s),"configService",Si,(0,N.Z)(s)),(0,Fi.Z)((0,N.Z)(s),"shaderModuleService",Za,(0,N.Z)(s)),(0,L.Z)((0,N.Z)(s),"cameraService",void 0),(0,L.Z)((0,N.Z)(s),"coordinateService",void 0),(0,L.Z)((0,N.Z)(s),"iconService",void 0),(0,L.Z)((0,N.Z)(s),"fontService",void 0),(0,L.Z)((0,N.Z)(s),"pickingService",void 0),(0,L.Z)((0,N.Z)(s),"rendererService",void 0),(0,L.Z)((0,N.Z)(s),"layerService",void 0),(0,L.Z)((0,N.Z)(s),"interactionService",void 0),(0,L.Z)((0,N.Z)(s),"mapService",void 0),(0,L.Z)((0,N.Z)(s),"styleAttributeService",void 0),(0,L.Z)((0,N.Z)(s),"layerSource",void 0),(0,L.Z)((0,N.Z)(s),"postProcessingPassFactory",void 0),(0,L.Z)((0,N.Z)(s),"normalPassFactory",void 0),(0,L.Z)((0,N.Z)(s),"animateOptions",{enable:!1}),(0,L.Z)((0,N.Z)(s),"container",void 0),(0,L.Z)((0,N.Z)(s),"encodedData",void 0),(0,L.Z)((0,N.Z)(s),"configSchema",void 0),(0,L.Z)((0,N.Z)(s),"currentPickId",null),(0,L.Z)((0,N.Z)(s),"rawConfig",void 0),(0,L.Z)((0,N.Z)(s),"needUpdateConfig",void 0),(0,L.Z)((0,N.Z)(s),"pendingStyleAttributes",[]),(0,L.Z)((0,N.Z)(s),"scaleOptions",{}),(0,L.Z)((0,N.Z)(s),"animateStartTime",void 0),(0,L.Z)((0,N.Z)(s),"aniamateStatus",!1),(0,L.Z)((0,N.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var d=s.getLayerConfig(),_=d.autoFit,T=d.fitBoundsOptions;_&&s.fitBounds(T),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,W.Z)(a,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=ja(ja({},this.needUpdateConfig),l);else{var d=this.container.get(w.vK.SceneID);So(l,this),this.configService.setLayerConfig(d,this.id,ja(ja(ja({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,d=this.container.get(w.vK.SceneID),_=this.rawConfig.enableMultiPassRenderer,T=_===void 0?!1:_;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:T}),this.iconService=this.container.get(w.vK.IIconService),this.fontService=this.container.get(w.vK.IFontService),this.rendererService=this.container.get(w.vK.IRendererService),this.layerService=this.container.get(w.vK.ILayerService),this.interactionService=this.container.get(w.vK.IInteractionService),this.pickingService=this.container.get(w.vK.IPickingService),this.mapService=this.container.get(w.vK.IMapService),this.cameraService=this.container.get(w.vK.ICameraService),this.coordinateService=this.container.get(w.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(w.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(w.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(w.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(w.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(X){var ve=X.attributeName,Be=X.attributeField,lt=X.attributeValues,Mt=X.updateOptions;l.styleAttributeService.updateStyleAttribute(ve,{scale:ja({field:Be},l.splitValuesAndCallbackInAttribute(lt,l.getLayerConfig()[ve]))},Mt)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(w.vK.ILayerPlugin);var I=vo(this.plugins),R;try{for(I.s();!(R=I.n()).done;){var ee=R.value;ee.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(X){I.e(X)}finally{I.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(ja(ja({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),d=l.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,d,_){return this.updateStyleAttribute("color",l,d,_),this}},{key:"texture",value:function(l,d,_){return this.updateStyleAttribute("texture",l,d,_),this}},{key:"rotate",value:function(l,d,_){return this.updateStyleAttribute("rotate",l,d,_),this}},{key:"size",value:function(l,d,_){return this.updateStyleAttribute("size",l,d,_),this}},{key:"filter",value:function(l,d,_){return this.updateStyleAttribute("filter",l,d,_),this}},{key:"shape",value:function(l,d,_){return this.updateStyleAttribute("shape",l,d,_),this}},{key:"label",value:function(l,d,_){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:d,updateOptions:_}),this}},{key:"animate",value:function(l){var d={};return Ei()(l)?(d.enable=!0,d=ja(ja({},d),l)):d.enable=l,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(l,d){return this.sourceOption={data:l,options:d},this}},{key:"setData",value:function(l,d){var _=this;return this.inited?this.layerSource.setData(l,d):this.on("inited",function(){_.layerSource.setData(l,d)}),this}},{key:"style",value:function(l){var d=this,_=l.passes,T=(0,sa.Z)(l,["passes"]);return _&&Gi(_).forEach(function(I){var R=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(I[0]);R&&R.updateOptions(I[1])}),this.rawConfig=ja(ja({},this.rawConfig),T),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,d){return Ei()(l)?this.scaleOptions=ja(ja({},this.scaleOptions),l):this.scaleOptions[l]=d,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var d={};return d.enableHighlight=Ei()(l)?!0:l,Ei()(l)?(d.enableHighlight=!0,l.color&&(d.highlightColor=l.color)):d.enableHighlight=!!l,this.updateLayerConfig(d),this}},{key:"setActive",value:function(l,d){var _=this;if(Ei()(l)){var T=l.x,I=T===void 0?0:T,R=l.y,ee=R===void 0?0:R;this.updateLayerConfig({highlightColor:Ei()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:I,y:ee})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:Ei()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,rt.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"select",value:function(l){var d={};return d.enableSelect=Ei()(l)?!0:l,Ei()(l)?(d.enableSelect=!0,l.color&&(d.selectColor=l.color)):d.enableSelect=!!l,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(l,d){var _=this;if(Ei()(l)){var T=l.x,I=T===void 0?0:T,R=l.y,ee=R===void 0?0:R;this.updateLayerConfig({selectColor:Ei()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:I,y:ee})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:Ei()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,rt.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),d=this.getLayerConfig(),_=d.visible,T=d.minZoom,I=T===void 0?-Infinity:T,R=d.maxZoom,ee=R===void 0?Infinity:R;return!!_&&l>=I&&l<=ee}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),d=l.minZoom;return d}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),d=l.maxZoom;return d}},{key:"get",value:function(l){var d=this.getLayerConfig();return d[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),_=d.extent,T=_.some(function(I){return Math.abs(I)===Infinity});return T?this:(this.mapService.fitBounds([[_[0],_[1]],[_[2],_[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(l){var d=this.styleAttributeService.getLayerAttributeScale(l);if(d){if(d.ticks){var _=d.ticks().map(function(I){return(0,L.Z)({value:I},l,d(I))});return _}else if(d.invertExtent){var T=d.range().map(function(I){return(0,L.Z)({value:d.invertExtent(I)},l,I)});return T}}else return[]}},{key:"pick",value:function(l){var d=l.x,_=l.y;this.interactionService.triggerHover({x:d,y:_})}},{key:"boxSelect",value:function(l,d){this.pickingService.boxPickLayer(this,l,d)}},{key:"buildLayerModel",value:function(l){var d=l.moduleName,_=l.vertexShader,T=l.fragmentShader,I=l.triangulation,R=l.segmentNumber,ee=(0,sa.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"]);this.shaderModuleService.registerModule(d,{vs:_,fs:T});var X=this.shaderModuleService.getModule(d),ve=X.vs,Be=X.fs,lt=X.uniforms,Mt=this.rendererService.createModel,pr=this.styleAttributeService.createAttributesAndIndices(this.encodedData,I,R),xr=pr.attributes,kr=pr.elements;return Mt(ja({attributes:xr,uniforms:lt,fs:Be,vs:ve,elements:kr,blend:ma[w.h0.normal]},ee))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var d=this.getLayerConfig(),_=d.enableHighlight,T=_===void 0?!0:_,I=d.enableSelect,R=I===void 0?!0:I,ee=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&R&&(ee=!0),l==="mousemove"&&(T||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(ee=!0),this.isVisible()&&ee}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,d,_,T){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:ja({field:d},this.splitValuesAndCallbackInAttribute(_,this.getLayerConfig()[d]))},T):this.pendingStyleAttributes.push({attributeName:l,attributeField:d,attributeValues:_,updateOptions:T})}},{key:"setEarthTime",value:function(l){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,d){return{values:ho()(l)?void 0:l||d,callback:ho()(l)?l:void 0}}}]),a}(Xt.EventEmitter),Si=(0,ni.Z)(Qn.prototype,"configService",[Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Za=(0,ni.Z)(Qn.prototype,"shaderModuleService",[Wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qn),ii=S(10971),ms=S(98621),rs=S.n(ms),Rs=S(34663),ns,Ta,lo,_l,xl;function Nu(i,c){var a=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!a){if(Array.isArray(i)||(a=Gl(i))||c&&i&&typeof i.length=="number"){a&&(i=a);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){a=a.call(i)},n:function(){var R=a.next();return d=R.done,R},e:function(R){_=!0,T=R},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function Gl(i,c){if(!!i){if(typeof i=="string")return wu(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return wu(i,c)}}function wu(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}var co=(ns=(0,w.yT)(w.vK.IGlobalConfigService),Ta=(0,w.yT)(w.vK.IShaderModuleService),lo=function(){function i(c){(0,K.Z)(this,i),(0,L.Z)(this,"triangulation",void 0),(0,L.Z)(this,"createTexture2D",void 0),(0,L.Z)(this,"layer",void 0),(0,L.Z)(this,"dataTexture",void 0),(0,L.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,L.Z)(this,"rowCount",void 0),(0,L.Z)(this,"cacheStyleProperties",void 0),(0,L.Z)(this,"cellLength",void 0),(0,L.Z)(this,"cellProperties",void 0),(0,L.Z)(this,"cellTypeLayout",void 0),(0,L.Z)(this,"stylePropertyesExist",void 0),(0,L.Z)(this,"dataTextureTest",void 0),(0,Fi.Z)(this,"configService",_l,this),(0,Fi.Z)(this,"shaderModuleService",xl,this),(0,L.Z)(this,"rendererService",void 0),(0,L.Z)(this,"iconService",void 0),(0,L.Z)(this,"fontService",void 0),(0,L.Z)(this,"styleAttributeService",void 0),(0,L.Z)(this,"mapService",void 0),(0,L.Z)(this,"cameraService",void 0),(0,L.Z)(this,"layerService",void 0),this.layer=c,this.rendererService=c.getContainer().get(w.vK.IRendererService),this.styleAttributeService=c.getContainer().get(w.vK.IStyleAttributeService),this.mapService=c.getContainer().get(w.vK.IMapService),this.iconService=c.getContainer().get(w.vK.IIconService),this.fontService=c.getContainer().get(w.vK.IFontService),this.cameraService=c.getContainer().get(w.vK.ICameraService),this.layerService=c.getContainer().get(w.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var a=this.rendererService.createTexture2D;this.createTexture2D=a,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:w.gl.NEAREST,min:w.gl.NEAREST,width:1,height:1}))}return(0,W.Z)(i,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(a){var s=!1;return rs()(a.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=a.opacity),rs()(a.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=a.strokeOpacity),rs()(a.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=a.strokeWidth),rs()(a.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=a.stroke),rs()(a.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=a.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(a){this.clearLastCalRes(),a.opacity!==void 0&&!ki()(a.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),a.strokeOpacity!==void 0&&!ki()(a.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),a.strokeWidth!==void 0&&!ki()(a.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),a.stroke!==void 0&&!this.isStaticColor(a.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),a.offsets!==void 0&&!this.isOffsetStatic(a.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(a){return ka()(a)?!!(0,Rs.ZP)(a):!1}},{key:"getStrokeColor",value:function(a){if(this.isStaticColor(a)){var s=(0,rt.CI)(a);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(a){return!!(ga()(a)&&a.length===2&&ki()(a[0])&&ki()(a[1]))}},{key:"patchMod",value:function(a,s){for(var l=0;l<s;l++)a.push(-1)}},{key:"patchData",value:function(a,s,l){var d=Nu(l),_;try{for(d.s();!(_=d.n()).done;){var T=_.value,I=T.attr,R=T.count,ee=s[I];ee?I==="stroke"?a.push.apply(a,(0,ii.Z)((0,rt.CI)(ee))):I==="offsets"?this.isOffsetStatic(ee)?a.push(-ee[0],ee[1]):a.push(0,0):a.push(ki()(ee)?ee:1):this.patchMod(a,R)}}catch(X){d.e(X)}finally{d.f()}}},{key:"calDataFrame",value:function(a,s,l){for(var d=s.length,_=Math.ceil(d*a/this.DATA_TEXTURE_WIDTH),T=_*this.DATA_TEXTURE_WIDTH,I=[],R=0;R<d;R++){var ee=s[R];this.patchData(I,ee,l)}for(var X=I.length;X<T;X++)I.push(-1);return{data:I,width:this.DATA_TEXTURE_WIDTH,height:_}}},{key:"getBlend",value:function(){var a=this.layer.getLayerConfig(),s=a.blend,l=s===void 0?"normal":s;return ma[w.h0[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.duration||4,a.interval||.2,a.trailLength||.1]}},{key:"startModelAnimate",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),i}(),_l=(0,ni.Z)(lo.prototype,"configService",[ns],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xl=(0,ni.Z)(lo.prototype,"shaderModuleService",[Ta],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lo),zs=S(83628),Ss=S.n(zs),m=S(10714),A=m.create(),j=m.create(),O=m.create(),le=m.create(),Ie=m.create();function ut(i,c,a,s,l){m.add(i,a,s),m.normalize(i,i),c=m.fromValues(-i[1],i[0]);var d=m.fromValues(-a[1],a[0]);return[l/m.dot(c,d),c]}function Pt(i,c){return m.set(i,-c[1],c[0])}function Ot(i,c,a){return m.sub(i,c,a),m.normalize(i,i),i}function Ar(i,c){return i[0]===c[0]&&i[1]===c[1]}function jr(i){for(var c=new Map,a=0;a<i.length;a++){var s=i[0].toString()+"-"+i[1].toString();c.get(s)?(i.splice(a,1),a++):c.set(s,s)}return i}var qn=function(){function i(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,K.Z)(this,i),(0,L.Z)(this,"complex",void 0),(0,L.Z)(this,"join",void 0),(0,L.Z)(this,"cap",void 0),(0,L.Z)(this,"miterLimit",void 0),(0,L.Z)(this,"thickness",void 0),(0,L.Z)(this,"normal",void 0),(0,L.Z)(this,"lastFlip",-1),(0,L.Z)(this,"miter",m.fromValues(0,0)),(0,L.Z)(this,"started",!1),(0,L.Z)(this,"dash",!1),(0,L.Z)(this,"totalDistance",0),this.join=c.join||"miter",this.cap=c.cap||"butt",this.miterLimit=c.miterLimit||10,this.thickness=c.thickness||1,this.dash=c.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,W.Z)(i,[{key:"extrude_gaode2",value:function(a,s){var l=this.complex;if(a.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=a.length,_=l.startIndex,T=1;T<d;T++){var I=a[T-1],R=s[T-1],ee=a[T],X=s[T],ve=T<a.length-1?a[T+1]:null,Be=T<s.length-1?s[T+1]:null,lt=this.segment_gaode2(l,_,I,ee,ve,R,X,Be);_+=lt}if(this.dash)for(var Mt=0;Mt<l.positions.length/6;Mt++)l.positions[Mt*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(a){var s=this.complex;if(a.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=a.length,d=s.startIndex,_=1;_<l;_++){var T=a[_-1],I=a[_],R=_<a.length-1?a[_+1]:null,ee=this.segment(s,d,T,I,R);d+=ee}if(this.dash)for(var X=0;X<s.positions.length/6;X++)s.positions[X*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(a,s,l,d,_,T,I,R){var ee=0,X=a.indices,ve=a.positions,Be=a.normals,lt=this.cap==="square",Mt=this.join==="bevel",pr=(0,rt.Z)([I[0],I[1]]),xr=(0,rt.Z)([T[0],T[1]]);Ot(O,d,l);var kr=0;if(this.dash&&(kr=this.lineSegmentDistance(pr,xr),this.totalDistance+=kr),this.normal||(this.normal=m.create(),Pt(this.normal,O)),!this.started)if(this.started=!0,lt){var hn=m.create(),cn=m.create();m.add(hn,this.normal,O),m.add(cn,this.normal,O),Be.push(cn[0],cn[1],0),Be.push(hn[0],hn[1],0),ve.push(l[0],l[1],0,this.totalDistance-kr,-this.thickness,0),ve.push(l[0],l[1],0,this.totalDistance-kr,this.thickness,0)}else this.extrusions(ve,Be,l,this.normal,this.thickness,this.totalDistance-kr);if(X.push(s+0,s+1,s+2),_){Ar(d,_)&&m.add(_,d,m.normalize(_,m.subtract(_,d,l))),Ot(le,_,d);var vn=ut(Ie,m.create(),O,le,this.thickness),mi=(0,q.Z)(vn,2),Ki=mi[0],ba=mi[1],pi=m.dot(Ie,this.normal)<0?-1:1,Ia=Mt;if(!Ia&&this.join==="miter"){var to=Ki;to>this.miterLimit&&(Ia=!0)}Ia?(Be.push(this.normal[0],this.normal[1],0),Be.push(ba[0],ba[1],0),ve.push(d[0],d[1],0,this.totalDistance,-this.thickness*pi,0),ve.push(d[0],d[1],0,this.totalDistance,this.thickness*pi,0),X.push.apply(X,(0,ii.Z)(this.lastFlip!==-pi?[s,s+2,s+3]:[s+2,s+1,s+3])),X.push(s+2,s+3,s+4),Pt(A,le),m.copy(this.normal,A),Be.push(this.normal[0],this.normal[1],0),ve.push(d[0],d[1],0,this.totalDistance,-this.thickness*pi,0),ee+=3):(this.extrusions(ve,Be,d,ba,Ki,this.totalDistance),X.push.apply(X,(0,ii.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),pi=-1,m.copy(this.normal,ba),ee+=2),this.lastFlip=pi}else{if(Pt(this.normal,O),lt){var In=m.create(),oi=m.create();m.sub(oi,O,this.normal),m.add(In,O,this.normal),Be.push(oi[0],oi[1],0),Be.push(In[0],In[1],0),ve.push(d[0],d[1],0,this.totalDistance,this.thickness,0),ve.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(ve,Be,d,this.normal,this.thickness,this.totalDistance);X.push.apply(X,(0,ii.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),ee+=2}return ee}},{key:"segment",value:function(a,s,l,d,_){var T=0,I=a.indices,R=a.positions,ee=a.normals,X=this.cap==="square",ve=this.join==="bevel",Be=(0,rt.Z)([d[0],d[1]]),lt=(0,rt.Z)([l[0],l[1]]);Ot(O,Be,lt);var Mt=0;if(this.dash&&(Mt=this.lineSegmentDistance(Be,lt),this.totalDistance+=Mt),this.normal||(this.normal=m.create(),Pt(this.normal,O)),!this.started)if(this.started=!0,X){var pr=m.create(),xr=m.create();m.add(pr,this.normal,O),m.add(xr,this.normal,O),ee.push(xr[0],xr[1],0),ee.push(pr[0],pr[1],0),R.push(l[0],l[1],0,this.totalDistance-Mt,-this.thickness,0),R.push(l[0],l[1],0,this.totalDistance-Mt,this.thickness,0)}else this.extrusions(R,ee,l,this.normal,this.thickness,this.totalDistance-Mt);if(I.push(s+0,s+1,s+2),_){var cn=(0,rt.Z)([_[0],_[1]]);Ar(Be,cn)&&m.add(cn,Be,m.normalize(cn,m.subtract(cn,Be,lt))),Ot(le,cn,Be);var In=ut(Ie,m.create(),O,le,this.thickness),oi=(0,q.Z)(In,2),vn=oi[0],mi=oi[1],Ki=m.dot(Ie,this.normal)<0?-1:1,ba=ve;if(!ba&&this.join==="miter"){var pi=vn;pi>this.miterLimit&&(ba=!0)}ba?(ee.push(this.normal[0],this.normal[1],0),ee.push(mi[0],mi[1],0),R.push(d[0],d[1],0,this.totalDistance,-this.thickness*Ki,0),R.push(d[0],d[1],0,this.totalDistance,this.thickness*Ki,0),I.push.apply(I,(0,ii.Z)(this.lastFlip!==-Ki?[s,s+2,s+3]:[s+2,s+1,s+3])),I.push(s+2,s+3,s+4),Pt(A,le),m.copy(this.normal,A),ee.push(this.normal[0],this.normal[1],0),R.push(d[0],d[1],0,this.totalDistance,-this.thickness*Ki,0),T+=3):(this.extrusions(R,ee,d,mi,vn,this.totalDistance),I.push.apply(I,(0,ii.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),Ki=-1,m.copy(this.normal,mi),T+=2),this.lastFlip=Ki}else{if(Pt(this.normal,O),X){var kr=m.create(),hn=m.create();m.sub(hn,O,this.normal),m.add(kr,O,this.normal),ee.push(hn[0],hn[1],0),ee.push(kr[0],kr[1],0),R.push(d[0],d[1],0,this.totalDistance,this.thickness,0),R.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(R,ee,d,this.normal,this.thickness,this.totalDistance);I.push.apply(I,(0,ii.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),T+=2}return T}},{key:"extrusions",value:function(a,s,l,d,_,T){s.push(d[0],d[1],0),s.push(d[0],d[1],0),a.push(l[0],l[1],0,T,-_,0),a.push(l[0],l[1],0,T,_,0)}},{key:"lineSegmentDistance",value:function(a,s){var l=s[0]-a[0],d=s[1]-a[1];return Math.sqrt(l*l+d*d)}}]),i}();function gi(i){if(ki()(i[0]))return i;if(ki()(i[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ki()(i[0][0][0])){var c=i,a=0,s=0,l=0;return c.forEach(function(d){d.forEach(function(_){a+=_[0],s+=_[1],l++})}),[a/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var wn=S(21706);function fa(i){var c=i[0][0],a=i[0][i[0].length-1];c[0]===a[0]&&c[1]===a[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var s=i[0].length,l=Ss().flatten(i),d=l.vertices,_=l.dimensions,T=[],I=[],R=0;R<d.length/_;R++)_===2?T.push(d[R*2],d[R*2+1],1):T.push(d[R*3],d[R*3+1],1);var ee=Ss()(l.vertices,l.holes,l.dimensions);I.push.apply(I,(0,ii.Z)(ee));for(var X=function(lt){var Mt=l.vertices.slice(lt*_,(lt+1)*_),pr=l.vertices.slice((lt+1)*_,(lt+2)*_);pr.length===0&&(pr=l.vertices.slice(0,_));var xr=T.length/3;T.push(Mt[0],Mt[1],1,pr[0],pr[1],1,Mt[0],Mt[1],0,pr[0],pr[1],0),I.push.apply(I,(0,ii.Z)([0,2,1,2,3,1].map(function(kr){return kr+xr})))},ve=0;ve<s;ve++)X(ve);return{positions:T,index:I}}function Ni(i){var c=Ss().flatten(i),a=Ss()(c.vertices,c.holes,c.dimensions);return{positions:c.vertices,index:a}}function Oa(i){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=i[0][0],s=i[0][i[0].length-1];a[0]===s[0]&&a[1]===s[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var l=i[0].length,d=Ss().flatten(i),_=d.vertices,T=d.dimensions,I=[],R=[],ee=[],X=0;X<_.length/T;X++)T===2?I.push(_[X*2],_[X*2+1],1,-1,-1):I.push(_[X*3],_[X*3+1],1,-1,-1),ee.push(0,0,1);var ve=Ss()(d.vertices,d.holes,d.dimensions);R.push.apply(R,(0,ii.Z)(ve));for(var Be=function(pr){var xr=d.vertices.slice(pr*T,(pr+1)*T),kr=d.vertices.slice((pr+1)*T,(pr+2)*T);kr.length===0&&(kr=d.vertices.slice(0,T));var hn=I.length/5;I.push(xr[0],xr[1],1,0,0,kr[0],kr[1],1,.1,0,xr[0],xr[1],0,0,.8,kr[0],kr[1],0,.1,.8);var cn=ua([kr[0],kr[1],1],[xr[0],xr[1],0],[xr[0],xr[1],1],c);ee.push.apply(ee,(0,ii.Z)(cn).concat((0,ii.Z)(cn),(0,ii.Z)(cn),(0,ii.Z)(cn))),R.push.apply(R,(0,ii.Z)([1,2,0,3,2,1].map(function(In){return In+hn})))},lt=0;lt<l;lt++)Be(lt);return{positions:I,index:R,normals:ee}}function ua(i,c,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=wn.create(),d=wn.create(),_=wn.create();s&&(i=(0,rt.vP)(i),c=(0,rt.vP)(c),a=(0,rt.vP)(a));var T=wn.fromValues.apply(wn,(0,ii.Z)(i)),I=wn.fromValues.apply(wn,(0,ii.Z)(c)),R=wn.fromValues.apply(wn,(0,ii.Z)(a));wn.sub(l,R,I),wn.sub(d,T,I),wn.cross(_,l,d);var ee=wn.create();return wn.normalize(ee,_),ee}var Xa,is;(function(i){i.CYLINDER="cylinder",i.SQUARECOLUMN="squareColumn",i.TRIANGLECOLUMN="triangleColumn",i.HEXAGONCOLUMN="hexagonColumn",i.PENTAGONCOLUMN="pentagonColumn"})(is||(is={}));var Es;(function(i){i.CIRCLE="circle",i.SQUARE="square",i.TRIANGLE="triangle",i.HEXAGON="hexagon",i.PENTAGON="pentagon"})(Es||(Es={}));function Au(i){for(var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=Math.PI*2/i,s=[],l=0;l<i;l++)s.push(a*l+c*Math.PI/12);var d=s.map(function(_){var T=Math.sin(_+Math.PI/4),I=Math.cos(_+Math.PI/4);return[T,I,0]});return d}function cu(){return Au(30)}function nl(){return Au(4)}function Ws(){return Au(3)}function Xs(){return Au(6,1)}function Ys(){return Au(5)}var za=(Xa={},(0,L.Z)(Xa,Es.CIRCLE,cu),(0,L.Z)(Xa,Es.HEXAGON,Xs),(0,L.Z)(Xa,Es.TRIANGLE,Ws),(0,L.Z)(Xa,Es.SQUARE,nl),(0,L.Z)(Xa,Es.PENTAGON,Ys),(0,L.Z)(Xa,is.CYLINDER,cu),(0,L.Z)(Xa,is.HEXAGONCOLUMN,Xs),(0,L.Z)(Xa,is.TRIANGLECOLUMN,Ws),(0,L.Z)(Xa,is.SQUARECOLUMN,nl),(0,L.Z)(Xa,is.PENTAGONCOLUMN,Ys),Xa),il={},al=100,ds=36;function Hl(i){var c=gi(i.coordinates);return{vertices:[].concat((0,ii.Z)(c),(0,ii.Z)(c),(0,ii.Z)(c),(0,ii.Z)(c)),indices:[0,1,2,2,3,0],size:c.length}}function fu(i){var c=gi(i.coordinates),a=mc(c);return{vertices:[].concat((0,ii.Z)(a),(0,ii.Z)(a),(0,ii.Z)(a),(0,ii.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function Ds(i){return i/180*Math.acos(-1)}function mc(i){var c=Ds(i[0])+Math.PI/2,a=Ds(i[1]),s=al*Math.cos(a)*Math.cos(c),l=al*Math.cos(a)*Math.sin(c),d=al*Math.sin(a);return[l,d,s]}function Tu(i){var c=i.shape,a=bl(c,!1),s=a.positions,l=a.index,d=a.normals;return{vertices:s,indices:l,normals:d,size:5}}function Ma(i){var c=gi(i.coordinates);return{vertices:(0,ii.Z)(c),indices:[0],size:c.length}}function ol(i){var c=i.coordinates,a=i.originCoordinates,s=i.version,l=new qn({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var d=c;Array.isArray(d[0][0])||(d=[c]);var _=a;Array.isArray(_[0][0])||(_=[a]);for(var T=0;T<d.length;T++){var I=d[T],R=_[T];l.extrude_gaode2(I,R)}}else{var ee=c;Array.isArray(ee[0][0])||(ee=[c]),ee.forEach(function(ve){l.extrude(ve)})}var X=l.complex;return{vertices:X.positions,indices:X.indices,normals:X.normals,size:6}}function Fc(i){var c=i.coordinates,a=Ss().flatten(c),s=a.vertices,l=a.dimensions,d=a.holes;return{indices:Ss()(s,d,l),vertices:s,size:l}}function hu(i){var c=i.coordinates,a=Oa(c,!0),s=a.positions,l=a.index,d=a.normals;return{vertices:s,indices:l,normals:d,size:5}}function Wl(i){var c=i.shape,a=Uu(c),s=a.positions,l=a.index;return{vertices:s,indices:l,size:3}}function Bc(i){var c=i.coordinates,a=[].concat((0,ii.Z)(c[0]),[0,0,1,c[1][0],c[0][1],0,1,1],(0,ii.Z)(c[1]),[0,1,0],(0,ii.Z)(c[0]),[0,0,1],(0,ii.Z)(c[1]),[0,1,0,c[0][0],c[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:a,indices:s,size:5}}function zu(i,c){for(var a=c||30,s=i.coordinates,l=[],d=[],_=function(R){l.push(R,1,R,s[0][0],s[0][1],s[1][0],s[1][1],R,-1,R,s[0][0],s[0][1],s[1][0],s[1][1]),R!==a-1&&d.push.apply(d,(0,ii.Z)([0,1,2,1,3,2].map(function(ee){return R*2+ee})))},T=0;T<a;T++)_(T);return{vertices:l,indices:d,size:7}}function Xl(i){var c=i.coordinates;c.length===2&&c.push(0);var a=i.size,s=pu(-1,1),l=pu(1,1),d=pu(-1,-1),_=pu(1,-1),T=[].concat((0,ii.Z)(c),(0,ii.Z)(s),(0,ii.Z)(c),(0,ii.Z)(d),(0,ii.Z)(c),(0,ii.Z)(_),(0,ii.Z)(c),(0,ii.Z)(l)),I=[0,1,2,3,0,2];return{vertices:T,indices:I,size:5}}function bl(i){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(il&&il[i])return il[i];var a=za[i]?za[i]():za.cylinder(),s=Oa([a],c);return il[i]=s,s}function Sl(i,c){for(var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(i.length/a*3),d,_,T,I=vec3.create(),R=vec3.create(),ee=vec3.create(),X=0,ve=c.length;X<ve;X+=3){d=c[X+0]*3,_=c[X+1]*3,T=c[X+2]*3;var Be=[i[d],i[d+1]],lt=[i[_],i[_+1]],Mt=[i[T],i[T+1]];s&&(Be=lngLatToMeters(Be),lt=lngLatToMeters(lt),Mt=lngLatToMeters(Mt));var pr=Be,xr=_slicedToArray(pr,2),kr=xr[0],hn=xr[1],cn=vec3.fromValues(kr,hn,i[d+2]),In=lt,oi=_slicedToArray(In,2),vn=oi[0],mi=oi[1],Ki=vec3.fromValues(vn,mi,i[_+2]),ba=Mt,pi=_slicedToArray(ba,2),Ia=pi[0],to=pi[1],Cu=vec3.fromValues(Ia,to,i[T+2]);vec3.sub(I,Cu,Ki),vec3.sub(R,cn,Ki),vec3.cross(ee,I,R),l[d]+=I[0],l[d+1]+=I[1],l[d+2]+=I[2],l[_]+=I[0],l[_+1]+=I[1],l[_+2]+=I[2],l[T]+=I[0],l[T+1]+=I[1],l[T+2]+=I[2]}return sl(l),l}function sl(i){for(var c=0,a=i.length;c<a;c+=3){var s=vec3.fromValues(i[c],i[c+1],i[c+2]),l=vec3.create();vec3.normalize(l,s),i.set(l,c)}}function El(i){var c=i[0][0],a=i[0][i[0].length-1];return c[0]===a[0]&&c[1]===a[1]}function Uu(i){var c=["cylinder","triangleColumn","hexagonColumn","squareColumn"],a=za[i]?za[i]():za.circle(),s=c.indexOf(i)===-1?Ni([a]):fa([a]);return s}function pu(i,c){var a=(i+1)/2,s=(c+1)/2;return[a,s]}function ul(){var i=Us(al,{segments:ds}),c=i.positionsArr,a=i.indicesArr,s=i.normalArr;return{vertices:c,indices:a,size:5,normals:s}}function Us(i,c){var a=mat4.create(),s=mat4.create(),l=vec3.fromValues(0,1,0),d=vec3.fromValues(0,0,0);c=c||{},i=typeof i!="undefined"?i:1;for(var _=typeof c.segments!="undefined"?c.segments:32,T=2+_,I=2*T,R=[],ee=[],X=[],ve=[],Be=[],lt=[],Mt=[],pr=0;pr<=T;pr++){for(var xr=pr/T,kr=xr*Math.PI,hn=0;hn<=I;hn++){var cn=hn/I,In=cn*Math.PI*2;mat4.identity(s),mat4.rotateZ(s,s,-kr),mat4.identity(a),mat4.rotateY(a,a,In),vec3.transformMat4(d,l,s),vec3.transformMat4(d,d,a),vec3.scale(d,d,-i),X.push(d.slice()),ve.push.apply(ve,_toConsumableArray(d.slice())),vec3.normalize(d,d),Be.push(d.slice()),lt.push.apply(lt,_toConsumableArray(d.slice())),Mt.push([cn,1-xr]),ve.push(cn,1-xr)}if(pr>0)for(var oi=X.length,vn=oi-2*(I+1);vn+I+2<oi;vn++)R.push([vn,vn+1,vn+I+1]),ee.push(vn,vn+1,vn+I+1),R.push([vn+I+1,vn+1,vn+I+2]),ee.push(vn+I+1,vn+1,vn+I+2)}return{cells:R,positions:X,normals:Be,uvs:Mt,positionsArr:ve,indicesArr:ee,normalArr:lt}}function gc(i){var c=yc();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function yc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Nc=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Zu=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Cl=function(i){(0,Ne.Z)(a,i);var c=gc(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.baseColor,I=T===void 0?"rgb(16,16,16)":T,R=l.brightColor,ee=R===void 0?"rgb(255,176,38)":R,X=l.windowColor,ve=X===void 0?"rgb(30,60,89)":X,Be=l.time,lt=Be===void 0?0:Be;return{u_opacity:_,u_baseColor:(0,rt.CI)(I),u_brightColor:(0,rt.CI)(ee),u_windowColor:(0,rt.CI)(ve),u_time:this.layer.getLayerAnimateTime()||lt}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Zu,fragmentShader:Nc,triangulation:hu})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,_,T,I,R){return R}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,_,T,I){var R=d.size,ee=R===void 0?10:R;return Array.isArray(ee)?[ee[0]]:[ee]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,_,T,I){var R=d.size;return[T[3],T[4]]}}})}}]),a}(co);function Yl(i){var c=_c();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function _c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Kl=function(i){(0,Ne.Z)(a,i);var c=Yl(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","PolygonLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){this.layerModel=new Cl(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),a}(uo);function $l(i){var c=Pu();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Pu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Mu=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Jl=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Ql=function(i){(0,Ne.Z)(a,i);var c=$l(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:_||.9,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:Mu,fragmentShader:Jl,triangulation:Wl,depth:{enable:!1},primitive:w.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,_){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),a}(co);function du(i){var c=xc();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function xc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var wl=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,bc=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ju=function(i){(0,Ne.Z)(a,i);var c=du(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:_||1,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:wl,fragmentShader:bc,triangulation:Tu,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,_,T,I){var R=d.size;return Array.isArray(R)?[R[0]]:[R]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,_,T,I,R){return R}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,_){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),a}(co),Va=S(76180);function ll(i,c){for(var a=[],s=[],l=[],d=i+1,_=c+1,T=i/2,I=c/2,R=0;R<_;R++)for(var ee=R-I,X=0;X<d;X++){var ve=X-T;s.push(ve/T,-ee/I,0),l.push(X/i),l.push(1-R/c)}for(var Be=0;Be<c;Be++)for(var lt=0;lt<i;lt++){var Mt=lt+d*Be,pr=lt+d*(Be+1),xr=lt+1+d*(Be+1),kr=lt+1+d*Be;a.push(Mt,pr,kr),a.push(pr,xr,kr)}return{vertices:s,indices:a,uvs:l}}var Ya,Vu;function Iu(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function Ks(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Iu(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Iu(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function ra(i){var c=Fa();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Fa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Cs=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,ql=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,vu=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,ec=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,nf=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,af=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,cl=(Ya=(0,Ct.b2)(),Ya(Vu=function(i){(0,Ne.Z)(a,i);var c=ra(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"colorTexture",void 0),(0,L.Z)((0,N.Z)(s),"heatmapFramerBuffer",void 0),(0,L.Z)((0,N.Z)(s),"intensityModel",void 0),(0,L.Z)((0,N.Z)(s),"colorModel",void 0),(0,L.Z)((0,N.Z)(s),"shapeType",void 0),s}return(0,W.Z)(a,[{key:"render",value:function(){var l=this,d=this.rendererService,_=d.clear,T=d.useFramebuffer;T(this.heatmapFramerBuffer,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,d=this.rendererService,_=d.createFramebuffer,T=d.clear,I=d.getViewportSize,R=d.createTexture2D,ee=d.useFramebuffer,X=this.styleAttributeService.getLayerStyleAttribute("shape"),ve=(X==null||(l=X.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=ve,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=ve==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Be=this.layer.getLayerConfig(),lt=Be.rampColors,Mt=(0,rt.Cl)(lt),pr=I(),xr=pr.width,kr=pr.height;return this.heatmapFramerBuffer=_({color:R({width:Math.floor(xr/4),height:Math.floor(kr/4),wrapS:w.gl.CLAMP_TO_EDGE,wrapT:w.gl.CLAMP_TO_EDGE,min:w.gl.LINEAR,mag:w.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:w.GC.Attribute,descriptor:{name:"a_Dir",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,_,T,I){return[T[3],T[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,_,T,I){var R=d.size,ee=R===void 0?1:R;return[ee]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:nf,fragmentShader:ec,triangulation:Xl,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:w.gl.ONE,srcAlpha:1,dstRGB:w.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:af,fs:vu});var l=this.shaderModuleService.getModule("heatmapColor"),d=l.vs,_=l.fs,T=l.uniforms,I=this.rendererService,R=I.createAttribute,ee=I.createElements,X=I.createBuffer,ve=I.createModel;return ve({vs:d,fs:_,attributes:{a_Position:R({buffer:X({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:w.gl.FLOAT}),size:3}),a_Uv:R({buffer:X({data:[0,1,1,1,0,0,1,0],type:w.gl.FLOAT}),size:2})},uniforms:Ks({},T),depth:{enable:!1},blend:this.getBlend(),count:6,elements:ee({data:[0,2,1,2,3,1],type:w.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.intensity,T=_===void 0?10:_,I=l.radius,R=I===void 0?5:I;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:R,u_intensity:T}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=Va.create();Va.invert(_,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ii.Z)(_)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,d=l(),_=d.width,T=d.height,I=ll(_/4,T/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:ql,fs:Cs});var R=this.shaderModuleService.getModule("heatmap3dColor"),ee=R.vs,X=R.fs,ve=R.uniforms,Be=this.rendererService,lt=Be.createAttribute,Mt=Be.createElements,pr=Be.createBuffer,xr=Be.createModel;return xr({vs:ee,fs:X,attributes:{a_Position:lt({buffer:pr({data:I.vertices,type:w.gl.FLOAT}),size:3}),a_Uv:lt({buffer:pr({data:I.uvs,type:w.gl.FLOAT}),size:2})},primitive:w.gl.TRIANGLES,uniforms:Ks({},ve),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:w.gl.SRC_ALPHA,srcAlpha:1,dstRGB:w.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Mt({data:I.indices,type:w.gl.UNSIGNED_INT,count:I.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),_=d.rampColors,T=(0,rt.Cl)(_);this.colorTexture=l({data:new Uint8Array(T.data),width:T.width,height:T.height,wrapS:w.gl.CLAMP_TO_EDGE,wrapT:w.gl.CLAMP_TO_EDGE,min:w.gl.NEAREST,mag:w.gl.NEAREST,flipY:!1})}}]),a}(co))||Vu);function Al(i){var c=Ou();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ou(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ro=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Tl=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Zs=function(i){(0,Ne.Z)(a,i);var c=Al(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:_||.9,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:Tl,fragmentShader:Ro,triangulation:Wl,depth:{enable:!1},primitive:w.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,_){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),a}(co),Eo={heatmap:cl,heatmap3d:cl,grid:Ql,grid3d:ju,hexagon:Zs},Bn=Eo;function mo(i){var c=mu();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function mu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var fl=function(i){(0,Ne.Z)(a,i);var c=mo(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","HeatMapLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Bn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(_){return _.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=this.getLayerConfig(),T=_.shape3d,I=this.getSource(),R=I.data.type,ee=(d==null||(l=d.scale)===null||l===void 0?void 0:l.field)||"heatmap";return ee==="heatmap"||ee==="heatmap3d"?"heatmap":R==="hexagon"?(T==null?void 0:T.indexOf(ee))===-1?"hexagon":"grid3d":R==="grid"?(T==null?void 0:T.indexOf(ee))===-1?"grid":"grid3d":"heatmap"}}]),a}(uo);function $s(i){var c=ws();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ws(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Sc=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,gn=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,tc=function(i){(0,Ne.Z)(a,i);var c=$s(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,d=this.layer.getSource(),_=this.rendererService.createTexture2D;return this.texture=_({height:0,width:0}),d.data.images.then(function(T){l.texture=_({data:T[0],width:T[0].width,height:T[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:gn,fragmentShader:Sc,triangulation:Bc,primitive:w.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,_,T,I){return[T[3],T[4]]}}})}}]),a}(co),rc={image:tc},Lu=rc;function Ua(i){var c=As();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function As(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var nc=function(i){(0,Ne.Z)(a,i);var c=Ua(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","ImageLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Lu[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={image:{}};return d[l]}},{key:"getModelType",value:function(){return"image"}}]),a}(uo);function gu(i){var c=Ts();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var yu=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = v_dataset.r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = v_dataset.b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float d_texCount = v_dataset.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = 1.0 - fract(arcRadio * d_texCount + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = v_dataset.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,zc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_dataset.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_dataset.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_dataset.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_dataset.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Pl={solid:0,dash:1},Ec=function(i){(0,Ne.Z)(a,i);var c=gu(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,R=I===void 0?"normal":I,ee=l.lineType,X=ee===void 0?"solid":ee,ve=l.dashArray,Be=ve===void 0?[10,5]:ve,lt=l.forward,Mt=lt===void 0?!0:lt,pr=l.lineTexture,xr=pr===void 0?!1:pr,kr=l.iconStep,hn=kr===void 0?100:kr,cn=l.segmentNumber,In=cn===void 0?30:cn;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var oi=this.layer.getEncodedData(),vn=this.calDataFrame(this.cellLength,oi,this.cellProperties),mi=vn.data,Ki=vn.width,ba=vn.height;this.rowCount=ba,this.dataTexture=this.cellLength>0&&mi.length>0?this.createTexture2D({flipY:!0,data:mi,format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:Ki,height:ba}):this.createTexture2D({flipY:!0,data:[1],format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:1,height:1})}Be.length===2&&Be.push(0,0);var pi=0,Ia=[0,0,0,0],to=[0,0,0,0];return _&&T&&(Ia=(0,rt.CI)(_),to=(0,rt.CI)(T),pi=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(d)?d:1,u_textureBlend:R==="normal"?0:1,segmentNumber:In,u_line_type:Pl[X||"solid"],u_dash_array:Be,u_blur:.9,u_lineDir:Mt?1:-1,u_texture:this.texture,u_line_texture:xr?1:0,u_icon_step:hn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:pi,u_sourceColor:Ia,u_targetColor:to}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),d=l.segmentNumber,_=d===void 0?30:d;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:zc,fragmentShader:yu,triangulation:zu,depth:{enable:!1},blend:this.getBlend(),segmentNumber:_})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(_,T,I,R){var ee=_.size,X=ee===void 0?1:ee;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:w.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(_,T,I,R){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(_,T,I,R){var ee=l.iconService.getIconMap(),X=_.texture,ve=ee[X]||{x:0,y:0},Be=ve.x,lt=ve.y;return[Be,lt]}}})}}]),a}(co);function Cc(i){var c=Js();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Js(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ps=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,na=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_dataset.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel(u_icon_step);
    v_dataset.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,_u={solid:0,dash:1},Qs=function(i){(0,Ne.Z)(a,i);var c=Cc(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,R=I===void 0?"normal":I,ee=l.lineType,X=ee===void 0?"solid":ee,ve=l.dashArray,Be=ve===void 0?[10,5]:ve,lt=l.lineTexture,Mt=lt===void 0?!1:lt,pr=l.iconStep,xr=pr===void 0?100:pr,kr=l.segmentNumber,hn=kr===void 0?30:kr;Be.length===2&&Be.push(0,0);var cn=0,In=[0,0,0,0],oi=[0,0,0,0];if(_&&T&&(In=(0,rt.CI)(_),oi=(0,rt.CI)(T),cn=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var vn=this.layer.getEncodedData(),mi=this.calDataFrame(this.cellLength,vn,this.cellProperties),Ki=mi.data,ba=mi.width,pi=mi.height;this.rowCount=pi,this.dataTexture=this.cellLength>0&&Ki.length>0?this.createTexture2D({flipY:!0,data:Ki,format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:ba,height:pi}):this.createTexture2D({flipY:!0,data:[1],format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(d)?d:1,u_textureBlend:R==="normal"?0:1,segmentNumber:hn,u_line_type:_u[X]||0,u_dash_array:Be,u_texture:this.texture,u_line_texture:Mt?1:0,u_icon_step:xr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:cn,u_sourceColor:In,u_targetColor:oi}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:na,fragmentShader:Ps,triangulation:zu,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(_,T,I,R){var ee=_.size,X=ee===void 0?1:ee;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:w.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(_,T,I,R){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(_,T,I,R){var ee=l.iconService.getIconMap(),X=_.texture,ve=ee[X]||{x:0,y:0},Be=ve.x,lt=ve.y;return[Be,lt]}}})}}]),a}(co);function Uo(i){var c=Gu();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Gu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ru=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = v_dataset.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,nu=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_dataset.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_dataset.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,Co={solid:0,dash:1},Hu=function(i){(0,Ne.Z)(a,i);var c=Uo(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,R=I===void 0?"normal":I,ee=l.lineType,X=ee===void 0?"solid":ee,ve=l.dashArray,Be=ve===void 0?[10,5]:ve,lt=l.lineTexture,Mt=lt===void 0?!1:lt,pr=l.iconStep,xr=pr===void 0?100:pr,kr=l.segmentNumber,hn=kr===void 0?30:kr;Be.length===2&&Be.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var cn=0,In=[0,0,0,0],oi=[0,0,0,0];if(_&&T&&(In=(0,rt.CI)(_),oi=(0,rt.CI)(T),cn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var vn=this.layer.getEncodedData(),mi=this.calDataFrame(this.cellLength,vn,this.cellProperties),Ki=mi.data,ba=mi.width,pi=mi.height;this.rowCount=pi,this.dataTexture=this.cellLength>0&&Ki.length>0?this.createTexture2D({flipY:!0,data:Ki,format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:ba,height:pi}):this.createTexture2D({flipY:!0,data:[1],format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(d)?d:1,u_textureBlend:R==="normal"?0:1,segmentNumber:hn,u_line_type:Co[X]||0,u_dash_array:Be,u_texture:this.texture,u_line_texture:Mt?1:0,u_icon_step:xr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:cn,u_sourceColor:In,u_targetColor:oi}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:nu,fragmentShader:ru,triangulation:zu,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(_,T,I,R){var ee=_.size,X=ee===void 0?1:ee;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:w.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(_,T,I,R){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(_,T,I,R){var ee=l.iconService.getIconMap(),X=_.texture,ve=ee[X]||{x:0,y:0},Be=ve.x,lt=ve.y;return[Be,lt]}}})}}]),a}(co);function ri(i){var c=Kn();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Kn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ml=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,as=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset.r = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset.g = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset.b = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset.a = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,js={solid:0,dash:1},Zo=function(i){(0,Ne.Z)(a,i);var c=ri(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,R=I===void 0?"normal":I,ee=l.lineType,X=ee===void 0?"solid":ee,ve=l.dashArray,Be=ve===void 0?[10,5,0,0]:ve,lt=l.lineTexture,Mt=lt===void 0?!1:lt,pr=l.iconStep,xr=pr===void 0?100:pr;Be.length===2&&Be.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var kr=0,hn=[0,0,0,0],cn=[0,0,0,0];if(_&&T&&(hn=(0,rt.CI)(_),cn=(0,rt.CI)(T),kr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var In=this.layer.getEncodedData(),oi=this.calDataFrame(this.cellLength,In,this.cellProperties),vn=oi.data,mi=oi.width,Ki=oi.height;this.rowCount=Ki,this.dataTexture=this.cellLength>0&&vn.length>0?this.createTexture2D({flipY:!0,data:vn,format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:mi,height:Ki}):this.createTexture2D({flipY:!0,data:[1],format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(d)?d:1,u_textureBlend:R==="normal"?0:1,u_line_type:js[X],u_dash_array:Be,u_texture:this.texture,u_line_texture:Mt?1:0,u_icon_step:xr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:kr,u_sourceColor:hn,u_targetColor:cn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:as,fragmentShader:Ml,triangulation:ol,primitive:w.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.lineType,T=_===void 0?"solid":_;this.styleAttributeService.registerStyleAttribute({name:"distance",type:w.GC.Attribute,descriptor:{name:"a_Distance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(R,ee,X,ve){return[X[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:w.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(R,ee,X,ve){return[X[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(R,ee,X,ve){var Be=R.size,lt=Be===void 0?1:Be;return Array.isArray(lt)?[lt[0],lt[1]]:[lt,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(R,ee,X,ve,Be){return Be}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:w.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(R,ee,X,ve){return[X[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(R,ee,X,ve){var Be=l.iconService.getIconMap(),lt=R.texture,Mt=Be[lt]||{x:0,y:0},pr=Mt.x,xr=Mt.y;return[pr,xr]}}})}},{key:"loadImage",value:function(l){return new Promise(function(d,_){if(l instanceof HTMLImageElement){d(l);return}var T=new Image;T.crossOrigin="anonymous",T.onload=function(){d(T)},T.onerror=function(){_(new Error("Could not load image at "+l))},T.src=l instanceof File?URL.createObjectURL(l):l})}}]),a}(co),iu={arc:Ec,arc3d:Qs,greatcircle:Hu,line:Zo},wc=iu;function ic(i){var c=ia();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ia(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Do=function(i){(0,Ne.Z)(a,i);var c=ic(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","LineLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new wc[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[l]}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return _||"line"}}]),a}(uo);function Uc(i){var c=gs();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function gs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Il=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ms=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,os=function(i){(0,Ne.Z)(a,i);var c=Uc(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var T=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,T,this.cellProperties),R=I.data,ee=I.width,X=I.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&R.length>0?this.createTexture2D({flipY:!0,data:R,format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:ee,height:X}):this.createTexture2D({flipY:!0,data:[1],format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:Ms,fragmentShader:Il,triangulation:Tu,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,_,T,I){var R=d.size;if(R){var ee=[];return Array.isArray(R)&&(ee=R.length===2?[R[0],R[0],R[1]]:R),Array.isArray(R)||(ee=[R]),ee}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,_,T,I,R){return R}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,_){var T=gi(d.coordinates);return[T[0],T[1],0]}}})}}]),a}(co);function hl(i){var c=au();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function au(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ac=`#define Animate 0.0

uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

}
`,Wu=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Xu=function(i){(0,Ne.Z)(a,i);var c=hl(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.strokeOpacity,I=T===void 0?1:T,R=l.strokeWidth,ee=R===void 0?0:R,X=l.stroke,ve=X===void 0?"rgba(0,0,0,0)":X,Be=l.offsets,lt=Be===void 0?[0,0]:Be,Mt=l.isGlobel,pr=Mt===void 0?!1:Mt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeOpacity:I,strokeWidth:ee,stroke:ve,offsets:lt})){this.judgeStyleAttributes({opacity:_,strokeOpacity:I,strokeWidth:ee,stroke:ve,offsets:lt});var xr=this.layer.getEncodedData(),kr=this.calDataFrame(this.cellLength,xr,this.cellProperties),hn=kr.data,cn=kr.width,In=kr.height;this.rowCount=In,this.dataTexture=this.cellLength>0&&hn.length>0?this.createTexture2D({flipY:!0,data:hn,format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:cn,height:In}):this.createTexture2D({flipY:!0,data:[1],format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(_)?_:1,u_stroke_opacity:ki()(I)?I:1,u_stroke_width:ki()(ee)?ee:0,u_stroke_color:this.getStrokeColor(ve),u_offsets:this.isOffsetStatic(lt)?lt:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Hl)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var l=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:Wu,fragmentShader:ac,triangulation:l?fu:Hl,depth:{enable:l},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:w.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(T,I,R,ee){var X;if(d){var ve=(0,q.Z)(R,3),Be=ve[0],lt=ve[1],Mt=ve[2],pr=wn.fromValues(0,0,1),xr=wn.fromValues(Be,0,Mt),kr=Be>=0?wn.angle(pr,xr):Math.PI*2-wn.angle(pr,xr),hn=Math.PI*2-Math.asin(lt/100),cn=Va.create();Va.rotateY(cn,cn,kr),Va.rotateX(cn,cn,hn);var In=wn.fromValues(1,1,0);wn.transformMat4(In,In,cn),wn.normalize(In,In);var oi=wn.fromValues(-1,1,0);wn.transformMat4(oi,oi,cn),wn.normalize(oi,oi);var vn=wn.fromValues(-1,-1,0);wn.transformMat4(vn,vn,cn),wn.normalize(vn,vn);var mi=wn.fromValues(1,-1,0);wn.transformMat4(mi,mi,cn),wn.normalize(mi,mi),X=[].concat((0,ii.Z)(In),(0,ii.Z)(oi),(0,ii.Z)(vn),(0,ii.Z)(mi))}else X=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Ki=ee%4*3;return[X[Ki],X[Ki+1],X[Ki+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(T,I,R,ee){var X=T.size,ve=X===void 0?5:X;return Array.isArray(ve)?[ve[0]]:[ve]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:w.GC.Attribute,descriptor:{name:"a_Shape",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(T,I,R,ee){var X=T.shape,ve=X===void 0?2:X,Be=l.layer.getLayerConfig().shape2d,lt=Be.indexOf(ve);return[lt]}}})}}]),a}(co);function Zc(i){var c=Ol();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ol(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var pl=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,jc=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Yu=function(i){(0,Ne.Z)(a,i);var c=Zc(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:jc,fragmentShader:pl,triangulation:Ma,primitive:w.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(_,T,I,R){var ee=_.size;return Array.isArray(ee)?[ee[0]]:[ee]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(_,T,I,R){var ee=l.fontService.mapping,X=_.shape,ve=l.fontService.getGlyph(X),Be=ee[ve],lt=Be.x,Mt=Be.y;return[lt,Mt]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=l({data:d,mag:w.gl.LINEAR,min:w.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.fontWeight,T=_===void 0?"normal":_,I=d.fontFamily,R=I===void 0?"sans-serif":I,ee=this.layer.getEncodedData(),X=[];ee.forEach(function(ve){var Be=ve.shape,lt=Be===void 0?"":Be;lt=lt.toString();var Mt=l.fontService.getGlyph(lt);X.indexOf(Mt)===-1&&X.push(Mt)}),this.fontService.setFontOptions({characterSet:X,fontWeight:T,fontFamily:R,fontSize:48})}}]),a}(co);function Ru(i){var c=oc();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function oc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Du=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Vs=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Ac=function(i){(0,Ne.Z)(a,i);var c=Ru(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.renderLayers();return}s.texture=T({data:s.iconService.getCanvas(),mag:w.gl.LINEAR,min:w.gl.LINEAR,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.offsets,T=_===void 0?[0,0]:_;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:T})){this.judgeStyleAttributes({opacity:d,offsets:T});var I=this.layer.getEncodedData(),R=this.calDataFrame(this.cellLength,I,this.cellProperties),ee=R.data,X=R.width,ve=R.height;this.rowCount=ve,this.dataTexture=this.cellLength>0&&ee.length>0?this.createTexture2D({flipY:!0,data:ee,format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:X,height:ve}):this.createTexture2D({flipY:!0,data:[1],format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ki()(d)?d:1,u_offsets:this.isOffsetStatic(T)?T:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Vs,fragmentShader:Du,triangulation:Ma,primitive:w.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(_,T,I,R){var ee=_.size,X=ee===void 0?5:ee;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(_,T,I,R){var ee=l.iconService.getIconMap(),X=_.shape,ve=ee[X]||{x:0,y:0},Be=ve.x,lt=ve.y;return[Be,lt]}}})}}]),a}(co);function sc(i){var c=uc();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function uc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ku=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,n=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function u(i){var c=i.coordinates;return{vertices:(0,ii.Z)(c),indices:[0],size:c.length}}var o=function(i){(0,Ne.Z)(a,i);var c=sc(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.offsets,I=T===void 0?[0,0]:T;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,offsets:I})){this.judgeStyleAttributes({opacity:_,offsets:I});var R=this.layer.getEncodedData(),ee=this.calDataFrame(this.cellLength,R,this.cellProperties),X=ee.data,ve=ee.width,Be=ee.height;this.rowCount=Be,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:ve,height:Be}):this.createTexture2D({flipY:!0,data:[1],format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(_)?_:1,u_offsets:this.isOffsetStatic(I)?I:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:n,fragmentShader:Ku,triangulation:u,depth:{enable:!1},primitive:w.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,_,T,I){var R=d.size,ee=R===void 0?1:R;return Array.isArray(ee)?[ee[0]]:[ee]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:w.h0.additive}}}]),a}(co),h=S(86804);function y(i,c){var a=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!a){if(Array.isArray(i)||(a=b(i))||c&&i&&typeof i.length=="number"){a&&(i=a);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){a=a.call(i)},n:function(){var R=a.next();return d=R.done,R},e:function(R){_=!0,T=R},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function b(i,c){if(!!i){if(typeof i=="string")return P(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return P(i,c)}}function P(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}var F=function(){function i(c,a,s){(0,K.Z)(this,i),(0,L.Z)(this,"boxCells",[]),(0,L.Z)(this,"xCellCount",void 0),(0,L.Z)(this,"yCellCount",void 0),(0,L.Z)(this,"boxKeys",void 0),(0,L.Z)(this,"bboxes",void 0),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0),(0,L.Z)(this,"xScale",void 0),(0,L.Z)(this,"yScale",void 0),(0,L.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(c/s),this.yCellCount=Math.ceil(a/s);for(var d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=c,this.height=a,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/a,this.boxUid=0}return(0,W.Z)(i,[{key:"insert",value:function(a,s,l,d,_){this.forEachCell(s,l,d,_,this.insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(_)}},{key:"query",value:function(a,s,l,d,_){return this.queryHitTest(a,s,l,d,!1,_)}},{key:"hitTest",value:function(a,s,l,d,_){return this.queryHitTest(a,s,l,d,!0,_)}},{key:"insertBoxCell",value:function(a,s,l,d,_,T){this.boxCells[_].push(T)}},{key:"queryHitTest",value:function(a,s,l,d,_,T){if(l<0||a>this.width||d<0||s>this.height)return _?!1:[];var I=[];if(a<=0&&s<=0&&this.width<=l&&this.height<=d){if(_)return!0;for(var R=0;R<this.boxKeys.length;R++)I.push({key:this.boxKeys[R],x1:this.bboxes[R*4],y1:this.bboxes[R*4+1],x2:this.bboxes[R*4+2],y2:this.bboxes[R*4+3]});return T?I.filter(T):I}var ee={hitTest:_,seenUids:{box:{},circle:{}}};return this.forEachCell(a,s,l,d,this.queryCell,I,ee,T),_?I.length>0:I}},{key:"queryCell",value:function(a,s,l,d,_,T,I,R){var ee=I.seenUids,X=this.boxCells[_];if(X!==null){var ve=this.bboxes,Be=y(X),lt;try{for(Be.s();!(lt=Be.n()).done;){var Mt=lt.value;if(!ee.box[Mt]){ee.box[Mt]=!0;var pr=Mt*4;if(a<=ve[pr+2]&&s<=ve[pr+3]&&l>=ve[pr+0]&&d>=ve[pr+1]&&(!R||R(this.boxKeys[Mt]))){if(I.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Mt],x1:ve[pr],y1:ve[pr+1],x2:ve[pr+2],y2:ve[pr+3]})}}}}catch(xr){Be.e(xr)}finally{Be.f()}}return!1}},{key:"forEachCell",value:function(a,s,l,d,_,T,I,R){for(var ee=this.convertToXCellCoord(a),X=this.convertToYCellCoord(s),ve=this.convertToXCellCoord(l),Be=this.convertToYCellCoord(d),lt=ee;lt<=ve;lt++)for(var Mt=X;Mt<=Be;Mt++){var pr=this.xCellCount*Mt+lt;if(_.call(this,a,s,l,d,pr,T,I,R))return}}},{key:"convertToXCellCoord",value:function(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}},{key:"convertToYCellCoord",value:function(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}}]),i}(),H=F,ae=function(){function i(c,a){(0,K.Z)(this,i),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0),(0,L.Z)(this,"grid",void 0),(0,L.Z)(this,"viewportPadding",100),(0,L.Z)(this,"screenRightBoundary",void 0),(0,L.Z)(this,"screenBottomBoundary",void 0),(0,L.Z)(this,"gridRightBoundary",void 0),(0,L.Z)(this,"gridBottomBoundary",void 0),this.width=c,this.height=a,this.viewportPadding=Math.max(c,a),this.grid=new H(c+this.viewportPadding,a+this.viewportPadding,25),this.screenRightBoundary=c+this.viewportPadding,this.screenBottomBoundary=a+this.viewportPadding,this.gridRightBoundary=c+2*this.viewportPadding,this.gridBottomBoundary=a+2*this.viewportPadding}return(0,W.Z)(i,[{key:"placeCollisionBox",value:function(a){var s=a.x1+a.anchorPointX+this.viewportPadding,l=a.y1+a.anchorPointY+this.viewportPadding,d=a.x2+a.anchorPointX+this.viewportPadding,_=a.y2+a.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,d,_)||this.grid.hitTest(s,l,d,_)?{box:[]}:{box:[s,l,d,_]}}},{key:"insertCollisionBox",value:function(a,s){var l={featureIndex:s};this.grid.insert(l,a[0],a[1],a[2],a[3])}},{key:"project",value:function(a,s,l){var d=h.al(s,l,0,1),_=h.Ue(),T=Va.fromValues.apply(Va,(0,ii.Z)(a));return h.fF(_,d,T),{x:(_[0]/_[3]+1)/2*this.width+this.viewportPadding,y:(-_[1]/_[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(a,s,l,d){return l>=0&&a<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}}]),i}();function xe(i,c){var a=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!a){if(Array.isArray(i)||(a=we(i))||c&&i&&typeof i.length=="number"){a&&(i=a);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){a=a.call(i)},n:function(){var R=a.next();return d=R.done,R},e:function(R){_=!0,T=R},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function we(i,c){if(!!i){if(typeof i=="string")return Te(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Te(i,c)}}function Te(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}function He(i){var c=.5,a=.5;switch(i){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0;break;default:c=.5}switch(i){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0;break;default:a=.5}return{horizontalAlign:c,verticalAlign:a}}function je(i,c,a,s,l){if(!!l){var d=i[s],_=d.glyph;if(_)for(var T=c[_].advance*d.scale,I=(i[s].x+T)*l,R=a;R<=s;R++)i[R].x-=I}}function it(i,c,a,s,l,d,_){var T=(c-a)*l,I=(-s*_+.5)*d,R=xe(i),ee;try{for(R.s();!(ee=R.n()).done;){var X=ee.value;X.x+=T,X.y+=I}}catch(ve){R.e(ve)}finally{R.f()}}function ze(i,c,a,s,l,d,_){var T=-8,I=0,R=T,ee=0,X=i.positionedGlyphs,ve=d==="right"?1:d==="left"?0:.5,Be=X.length;a.forEach(function(kr){if(kr.split("").forEach(function(cn){var In=c[cn],oi=0;In&&(X.push({glyph:cn,x:I,y:R+oi,vertical:!1,scale:1,metrics:In}),I+=In.advance+_)}),X.length!==Be){var hn=I-_;ee=Math.max(hn,ee),je(X,c,Be,X.length-1,ve)}I=0,R+=s});var lt=He(l),Mt=lt.horizontalAlign,pr=lt.verticalAlign;it(X,ve,Mt,pr,ee,s,a.length);var xr=R-T;i.top+=-pr*xr,i.bottom=i.top+xr,i.left+=-Mt*ee,i.right=i.left+ee}function at(i,c,a,s,l,d,_){var T=-8,I=0,R=T,ee=0,X=i.positionedGlyphs,ve=d==="right"?1:d==="left"?0:.5,Be=X.length;a.forEach(function(kr){var hn=c[kr],cn=0;if(hn&&(X.push({glyph:kr,x:I,y:R+cn,vertical:!1,scale:1,metrics:hn}),I+=hn.advance+_),X.length!==Be){var In=I-_;ee=Math.max(In,ee),je(X,c,Be,X.length-1,ve)}I=0,R+=s});var lt=He(l),Mt=lt.horizontalAlign,pr=lt.verticalAlign;it(X,ve,Mt,pr,ee,s,a.length);var xr=R-T;i.top+=-pr*xr,i.bottom=i.top+xr,i.left+=-Mt*ee,i.right=i.left+ee}function xt(i,c,a,s,l,d){var _=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],T=arguments.length>7?arguments[7]:void 0,I=i.split(`
`),R=[],ee={positionedGlyphs:R,top:_[1],bottom:_[1],left:_[0],right:_[0],lineCount:I.length,text:i};return T?at(ee,c,I,a,s,l,d):ze(ee,c,I,a,s,l,d),R.length?ee:!1}function jt(i){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],a=arguments.length>2?arguments[2]:void 0,s=i.positionedGlyphs,l=s===void 0?[]:s,d=[],_=xe(l),T;try{for(_.s();!(T=_.n()).done;){var I=T.value,R=I.metrics,ee=4,X=R.advance*I.scale/2,ve=a?[I.x+X,I.y]:[0,0],Be=a?[0,0]:[I.x+X+c[0],I.y+c[1]],lt=(0-ee)*I.scale-X+Be[0],Mt=(0-ee)*I.scale+Be[1],pr=lt+R.width*I.scale,xr=Mt+R.height*I.scale,kr={x:lt,y:Mt},hn={x:pr,y:Mt},cn={x:lt,y:xr},In={x:pr,y:xr};d.push({tl:kr,tr:hn,bl:cn,br:In,tex:R,glyphOffset:ve})}}catch(oi){_.e(oi)}finally{_.f()}return d}function gr(i,c){var a=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!a){if(Array.isArray(i)||(a=lr(i))||c&&i&&typeof i.length=="number"){a&&(i=a);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){a=a.call(i)},n:function(){var R=a.next();return d=R.done,R},e:function(R){_=!0,T=R},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function lr(i,c){if(!!i){if(typeof i=="string")return _r(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _r(i,c)}}function _r(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}function zr(i){var c=on();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function on(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Qr=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Pn=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ei(i){var c=this,a=i.id,s=[],l=[];if(!c.glyphInfoMap||!c.glyphInfoMap[a])return{vertices:[],indices:[],size:7};var d=c.glyphInfoMap[a].centroid,_=d.length===2?[d[0],d[1],0]:d;return c.glyphInfoMap[a].glyphQuads.forEach(function(T,I){s.push.apply(s,(0,ii.Z)(_).concat([T.tex.x,T.tex.y+T.tex.height,T.tl.x,T.tl.y],(0,ii.Z)(_),[T.tex.x+T.tex.width,T.tex.y+T.tex.height,T.tr.x,T.tr.y],(0,ii.Z)(_),[T.tex.x+T.tex.width,T.tex.y,T.br.x,T.br.y],(0,ii.Z)(_),[T.tex.x,T.tex.y,T.bl.x,T.bl.y])),l.push(0+I*4,1+I*4,2+I*4,2+I*4,3+I*4,0+I*4)}),{vertices:s,indices:l,size:7}}var ci=function(i){(0,Ne.Z)(a,i);var c=zr(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"glyphInfo",void 0),(0,L.Z)((0,N.Z)(s),"glyphInfoMap",{}),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"currentZoom",-1),(0,L.Z)((0,N.Z)(s),"extent",void 0),(0,L.Z)((0,N.Z)(s),"textureHeight",0),(0,L.Z)((0,N.Z)(s),"textCount",0),(0,L.Z)((0,N.Z)(s),"preTextStyle",{}),(0,L.Z)((0,N.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:Pn,fragmentShader:Qr,triangulation:ei.bind((0,N.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.stroke,I=T===void 0?"#fff":T,R=l.strokeWidth,ee=R===void 0?0:R,X=l.textAnchor,ve=X===void 0?"center":X,Be=l.textAllowOverlap,lt=Be===void 0?!1:Be,Mt=l.halo,pr=Mt===void 0?.5:Mt,xr=l.gamma,kr=xr===void 0?2:xr,hn=this.fontService,cn=hn.canvas,In=hn.mapping;if(Object.keys(In).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(In).length),this.preTextStyle={textAnchor:ve,textAllowOverlap:lt},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeWidth:ee,stroke:I})){this.judgeStyleAttributes({opacity:_,strokeWidth:ee,stroke:I});var oi=this.layer.getEncodedData(),vn=this.calDataFrame(this.cellLength,oi,this.cellProperties),mi=vn.data,Ki=vn.width,ba=vn.height;this.rowCount=ba,this.dataTexture=this.cellLength>0&&mi.length>0?this.createTexture2D({flipY:!0,data:mi,format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:Ki,height:ba}):this.createTexture2D({flipY:!0,data:[1],format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(_)?_:1,u_stroke_width:ki()(ee)?ee:0,u_stroke_color:this.getStrokeColor(I),u_sdf_map:this.texture,u_halo_blur:pr,u_gamma_scale:kr,u_sdf_map_size:[cn.width,cn.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),d=l.textAnchor,_=d===void 0?"center":d,T=l.textAllowOverlap,I=T===void 0?!0:T;return this.preTextStyle={textAnchor:_,textAllowOverlap:I},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),d=l.textAllowOverlap,_=d===void 0?!1:d,T=this.mapService.getZoom(),I=this.mapService.getBounds(),R=(0,rt.oO)(this.extent,I);return!_&&(Math.abs(this.currentZoom-T)>1||!R)||_!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:w.GC.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,_,T,I){var R=d.rotate,ee=R===void 0?0:R;return Array.isArray(ee)?[ee[0]]:[ee]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:w.GC.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,_,T,I){return[T[5],T[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,_,T,I){var R=d.size,ee=R===void 0?12:R;return Array.isArray(ee)?[ee[0]]:[ee]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:w.GC.Attribute,descriptor:{name:"a_tex",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,_,T,I){return[T[3],T[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,rt.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,_=d===void 0?"400":d,T=l.fontFamily,I=T===void 0?"sans-serif":T,R=this.layer.getEncodedData(),ee=[];R.forEach(function(X){var ve=X.shape,Be=ve===void 0?"":ve;Be=Be.toString();var lt=gr(Be),Mt;try{for(lt.s();!(Mt=lt.n()).done;){var pr=Mt.value;ee.indexOf(pr)===-1&&ee.push(pr)}}catch(xr){lt.e(xr)}finally{lt.f()}}),this.fontService.setFontOptions({characterSet:ee,fontWeight:_,fontFamily:I,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,_=d===void 0?"400":d,T=l.fontFamily,I=T===void 0?"sans-serif":T,R=this.layer.getEncodedData(),ee=[];R.forEach(function(X){var ve=X.shape,Be=ve===void 0?"":ve;Be=Be.toString(),ee.indexOf(Be)===-1&&ee.push(Be)}),this.fontService.setFontOptions({characterSet:ee,fontWeight:_,fontFamily:I,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var d=this,_=this.fontService.mapping,T=this.layer.getLayerConfig(),I=T.spacing,R=I===void 0?2:I,ee=T.textAnchor,X=ee===void 0?"center":ee,ve=this.layer.getEncodedData();this.glyphInfo=ve.map(function(Be){var lt=Be.shape,Mt=lt===void 0?"":lt,pr=Be.id,xr=Be.size,kr=xr===void 0?1:xr,hn=Be.textOffset,cn=hn===void 0?[0,0]:hn,In=xt(Mt.toString(),_,kr,X,"center",R,cn,l),oi=jt(In,cn,!1);return Be.shaping=In,Be.glyphQuads=oi,Be.centroid=gi(Be.coordinates),Be.originCentroid=Be.version==="GAODE2.x"?gi(Be.originCoordinates):Be.originCentroid=Be.centroid,d.glyphInfoMap[pr]={shaping:In,glyphQuads:oi,centroid:gi(Be.coordinates)},Be})}},{key:"filterGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.padding,T=_===void 0?[4,4]:_,I=d.textAllowOverlap,R=I===void 0?!1:I;if(!R){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var ee=this.rendererService.getViewportSize(),X=ee.width,ve=ee.height,Be=new ae(X,ve),lt=this.glyphInfo.filter(function(Mt){var pr=Mt.shaping,xr=Mt.id,kr=xr===void 0?0:xr,hn=Mt.version==="GAODE2.x"?Mt.originCentroid:Mt.centroid,cn=Mt.size,In=cn/24,oi=l.mapService.lngLatToContainer(hn),vn=Be.placeCollisionBox({x1:pr.left*In-T[0],x2:pr.right*In+T[0],y1:pr.top*In-T[1],y2:pr.bottom*In+T[1],anchorPointX:oi.x,anchorPointY:oi.y}),mi=vn.box;return mi&&mi.length?(Be.insertCollisionBox(mi,kr),!0):!1});lt.forEach(function(Mt){l.glyphInfoMap[Mt.id]=Mt})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),d=l.iconfont,_=d===void 0?!1:d;_?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(_)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=l({data:d,mag:w.gl.LINEAR,min:w.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Pn,fragmentShader:Qr,triangulation:ei.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),a}(co),ti={fill:Xu,image:Ac,normal:o,extrude:os,text:ci,icon:Yu},aa=ti;function jn(i){var c=xi();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function xi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var zi=function(i){(0,Ne.Z)(a,i);var c=jn(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","PointLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new aa[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),_=d.shape2d,T=d.shape3d,I=this.iconService.getIconMap(),R=l.find(function(X){return X.hasOwnProperty("shape")});if(R){var ee=R.shape;return ee==="dot"?"normal":(_==null?void 0:_.indexOf(ee))!==-1?"fill":(T==null?void 0:T.indexOf(ee))!==-1?"extrude":I.hasOwnProperty(ee)?"image":this.fontService.getGlyph(ee)!==""?"icon":"text"}else return"normal"}}]),a}(uo);function J(i){var c=Q();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Q(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var D=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,k=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,te=function(i){(0,Ne.Z)(a,i);var c=J(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var T=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,T,this.cellProperties),R=I.data,ee=I.width,X=I.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&R.length>0?this.createTexture2D({flipY:!0,data:R,format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:ee,height:X}):this.createTexture2D({flipY:!0,data:[1],format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:k,fragmentShader:D,triangulation:hu})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,_,T,I,R){return R}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,_,T,I){var R=d.size,ee=R===void 0?10:R;return Array.isArray(ee)?[ee[0]]:[ee]}}})}}]),a}(co);function Ce(i){var c=st();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function st(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Bt=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,bt=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Kt=function(i){(0,Ne.Z)(a,i);var c=Ce(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var T=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,T,this.cellProperties),R=I.data,ee=I.width,X=I.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&R.length>0?this.createTexture2D({flipY:!0,data:R,format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:ee,height:X}):this.createTexture2D({flipY:!0,data:[1],format:w.gl.LUMINANCE,type:w.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ki()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:bt,fragmentShader:Bt,triangulation:Fc,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),a}(co),Ir={fill:Kt,line:Zo,extrude:te,text:ci,point_fill:Xu,point_image:Ac,point_normal:o,point_extrude:os},Fn=Ir;function Nn(i){var c=fi();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function fi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var si=function(i){(0,Ne.Z)(a,i);var c=Nn(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","PolygonLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Fn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return _==="fill"?"fill":_==="extrude"?"extrude":_==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),_=d.shape2d,T=d.shape3d,I=this.iconService.getIconMap(),R=l.find(function(X){return X.hasOwnProperty("shape")});if(R){var ee=R.shape;return ee==="dot"?"point_normal":(_==null?void 0:_.indexOf(ee))!==-1?"point_fill":(T==null?void 0:T.indexOf(ee))!==-1?"point_extrude":I.hasOwnProperty(ee)?"point_image":"text"}else return"fill"}}]),a}(uo);function yi(i){var c=Hi();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Hi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ya=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,_a=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Ka=function(i){(0,Ne.Z)(a,i);var c=yi(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"colorTexture",void 0),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.clampLow,I=T===void 0?!0:T,R=l.clampHigh,ee=R===void 0?!0:R,X=l.noDataValue,ve=X===void 0?-9999999:X,Be=l.domain,lt=Be===void 0?[0,1]:Be;return this.updateColorTexure(),{u_opacity:_||1,u_texture:this.texture,u_domain:lt,u_clampLow:I,u_clampHigh:typeof ee!="undefined"?ee:I,u_noDataValue:ve,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),d=this.rendererService.createTexture2D,_=l.data.dataArray[0];this.texture=d({data:_.data,width:_.width,height:_.height,format:w.gl.LUMINANCE,type:w.gl.FLOAT});var T=this.layer.getLayerConfig(),I=T.rampColors,R=(0,rt.Cl)(I);return this.colorTexture=d({data:R.data,width:R.width,height:R.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:_a,fragmentShader:ya,triangulation:Bc,primitive:w.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,_,T,I){return[T[3],T[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),_=d.rampColors,T=(0,rt.Cl)(_);this.colorTexture=l({data:T.data,width:T.width,height:T.height,flipY:!1})}}]),a}(co),Ba={raster:Ka,raster3d:Ka},wo=Ba;function La(i){var c=Sa();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Sa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var la=function(i){(0,Ne.Z)(a,i);var c=La(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","RasterLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new wo[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={raster:{},raster3d:{}};return d[l]}},{key:"getModelType",value:function(){return"raster"}}]),a}(uo),va=S(20250),Ga=S.n(va),Na,ko,Ui,$o,Po,Ao,Tc,ku,$u;function Ju(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function Ll(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Ju(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Ju(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}var Qu=(Na=(0,Ct.b2)(),ko=(0,Ct.f3)(w.vK.IGlobalConfigService),Ui=(0,Ct.f3)(w.vK.IMapService),$o=(0,Ct.f3)(w.vK.IFontService),Na(Po=(Ao=function(){function i(){(0,K.Z)(this,i),(0,Fi.Z)(this,"configService",Tc,this),(0,Fi.Z)(this,"mapService",ku,this),(0,Fi.Z)(this,"fontService",$u,this)}return(0,W.Z)(i,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(a,{styleAttributeService:d})}),a.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return a.dataState.dataMappingNeedUpdate=!1,l.generateMaping(a,{styleAttributeService:d}),!0}),a.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!a.layerModelNeedUpdate){var _=d.getLayerStyleAttributes()||[],T=d.getLayerStyleAttribute("filter"),I=a.getSource().data.dataArray,R=_.filter(function(X){return X.needRemapping}),ee=I;T!=null&&T.needRemapping&&T!==null&&T!==void 0&&T.scale&&(ee=I.filter(function(X){return l.applyAttributeMapping(T,X)[0]})),R.length&&(T!=null&&T.needRemapping?(a.setEncodedData(l.mapping(_,ee)),T.needRemapping=!1):a.setEncodedData(l.mapping(R,ee,a.getEncodedData())),a.emit("remapping",null))}})}},{key:"generateMaping",value:function(a,s){var l=this,d=s.styleAttributeService,_=d.getLayerStyleAttributes()||[],T=d.getLayerStyleAttribute("filter"),I=a.getSource().data.dataArray,R=I;T!=null&&T.scale&&(R=I.filter(function(ee){return l.applyAttributeMapping(T,ee)[0]})),a.setEncodedData(this.mapping(_,R))}},{key:"mapping",value:function(a,s,l){var d=this,_=s.map(function(T,I){var R=l?l[I]:{},ee=Ll({id:T._id,coordinates:T.coordinates},R);return a.filter(function(X){return X.scale!==void 0}).forEach(function(X){var ve=d.applyAttributeMapping(X,T);X.needRemapping=!1,X.name==="color"&&(ve=ve.map(function(Be){return(0,rt.CI)(Be)})),ee[X.name]=Array.isArray(ve)&&ve.length===1?ve[0]:ve,X.name==="shape"&&(ee.shape=d.fontService.getIconFontKey(ee[X.name]))}),ee});return _.length>0&&this.mapService.version==="GAODE2.x"&&(typeof _[0].coordinates[0]=="number"?_.filter(function(T){return!T.originCoordinates}).map(function(T){T.version="GAODE2.x",T.originCoordinates=Ga()(T.coordinates),T.coordinates=d.mapService.lngLatToCoord(T.coordinates)}):_.filter(function(T){return!T.originCoordinates}).map(function(T){T.version="GAODE2.x",T.originCoordinates=Ga()(T.coordinates),T.coordinates=d.mapService.lngLatToCoords(T.coordinates)})),_}},{key:"applyAttributeMapping",value:function(a,s){var l;if(!a.scale)return[];var d=(a==null||(l=a.scale)===null||l===void 0?void 0:l.scalers)||[],_=[];return d.forEach(function(T){var I,R=T.field;(s.hasOwnProperty(R)||((I=a.scale)===null||I===void 0?void 0:I.type)==="variable")&&_.push(s[R])}),a.mapping?a.mapping(_):[]}}]),i}(),Tc=(0,ni.Z)(Ao.prototype,"configService",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ku=(0,ni.Z)(Ao.prototype,"mapService",[Ui],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$u=(0,ni.Z)(Ao.prototype,"fontService",[$o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ao))||Po),dl={},Rl={},xu=function(c){return Rl[c]},Mo=function(c,a){Rl[c]=a},Ff=function(c){return dl[c]},Dl=function(c,a){dl[c]=a},of={},xf={},bf=34,kl=10,Fl=13;function Ph(i){return new Function("d","return {"+i.map(function(c,a){return JSON.stringify(c)+": d["+a+'] || ""'}).join(",")+"}")}function Bf(i,c){var a=Ph(i);return function(s,l){return c(a(s),l,i)}}function Nf(i){var c=Object.create(null),a=[];return i.forEach(function(s){for(var l in s)l in c||a.push(c[l]=l)}),a}function ss(i,c){var a=i+"",s=a.length;return s<c?new Array(c-s+1).join(0)+a:a}function sf(i){return i<0?"-"+ss(-i,6):i>9999?"+"+ss(i,6):ss(i,4)}function sp(i){var c=i.getUTCHours(),a=i.getUTCMinutes(),s=i.getUTCSeconds(),l=i.getUTCMilliseconds();return isNaN(i)?"Invalid Date":sf(i.getUTCFullYear(),4)+"-"+ss(i.getUTCMonth()+1,2)+"-"+ss(i.getUTCDate(),2)+(l?"T"+ss(c,2)+":"+ss(a,2)+":"+ss(s,2)+"."+ss(l,3)+"Z":s?"T"+ss(c,2)+":"+ss(a,2)+":"+ss(s,2)+"Z":a||c?"T"+ss(c,2)+":"+ss(a,2)+"Z":"")}function uf(i){var c=new RegExp('["'+i+`
\r]`),a=i.charCodeAt(0);function s(X,ve){var Be,lt,Mt=l(X,function(pr,xr){if(Be)return Be(pr,xr-1);lt=pr,Be=ve?Bf(pr,ve):Ph(pr)});return Mt.columns=lt||[],Mt}function l(X,ve){var Be=[],lt=X.length,Mt=0,pr=0,xr,kr=lt<=0,hn=!1;X.charCodeAt(lt-1)===kl&&--lt,X.charCodeAt(lt-1)===Fl&&--lt;function cn(){if(kr)return xf;if(hn)return hn=!1,of;var oi,vn=Mt,mi;if(X.charCodeAt(vn)===bf){for(;Mt++<lt&&X.charCodeAt(Mt)!==bf||X.charCodeAt(++Mt)===bf;);return(oi=Mt)>=lt?kr=!0:(mi=X.charCodeAt(Mt++))===kl?hn=!0:mi===Fl&&(hn=!0,X.charCodeAt(Mt)===kl&&++Mt),X.slice(vn+1,oi-1).replace(/""/g,'"')}for(;Mt<lt;){if((mi=X.charCodeAt(oi=Mt++))===kl)hn=!0;else if(mi===Fl)hn=!0,X.charCodeAt(Mt)===kl&&++Mt;else if(mi!==a)continue;return X.slice(vn,oi)}return kr=!0,X.slice(vn,lt)}for(;(xr=cn())!==xf;){for(var In=[];xr!==of&&xr!==xf;)In.push(xr),xr=cn();ve&&(In=ve(In,pr++))==null||Be.push(In)}return Be}function d(X,ve){return X.map(function(Be){return ve.map(function(lt){return ee(Be[lt])}).join(i)})}function _(X,ve){return ve==null&&(ve=Nf(X)),[ve.map(ee).join(i)].concat(d(X,ve)).join(`
`)}function T(X,ve){return ve==null&&(ve=Nf(X)),d(X,ve).join(`
`)}function I(X){return X.map(R).join(`
`)}function R(X){return X.map(ee).join(i)}function ee(X){return X==null?"":X instanceof Date?sp(X):c.test(X+="")?'"'+X.replace(/"/g,'""')+'"':X}return{parse:s,parseRows:l,format:_,formatBody:T,formatRows:I,formatRow:R,formatValue:ee}}var lc=uf(","),up=lc.parse,zp=lc.parseRows,lp=lc.format,Up=lc.formatBody,Mh=lc.formatRows,Zp=lc.formatRow,Sf=lc.formatValue,cp=S(56928),jo=S.n(cp);function Ef(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function lh(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Ef(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Ef(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function Cf(i,c){var a=c.x,s=c.y,l=c.x1,d=c.y1,_=c.coordinates,T=[];return i.forEach(function(I,R){var ee=[];if(a&&s&&(ee=[parseFloat(I[a]),parseFloat(I[s])]),a&&s&&l&&d){var X=[parseFloat(I[a]),parseFloat(I[s])],ve=[parseFloat(I[l]),parseFloat(I[d])];ee=[X,ve]}if(_){var Be="Polygon";Array.isArray(_[0])||(Be="Point"),Array.isArray(_[0])&&!Array.isArray(_[0][0])&&(Be="LineString");var lt={type:Be,coordinates:(0,ii.Z)(I[_])};jo()(lt,!0),ee=lt.coordinates}var Mt=lh(lh({},I),{},{_id:R,coordinates:ee});T.push(Mt)}),{dataArray:T}}function zf(i,c){var a=up(i);return Cf(a,c)}var Pc=S(98576);function Uf(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function wf(i){if(Array.isArray(i))return i;if(i.type==="Feature"){if(i.geometry!==null)return i.geometry.coordinates}else if(i.coordinates)return i.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Mc(i){if(i.length>1&&isNumber(i[0])&&isNumber(i[1]))return!0;if(Array.isArray(i[0])&&i[0].length)return Mc(i[0]);throw new Error("coordinates must only contain numbers")}function Zf(i,c,a){if(!c||!a)throw new Error("type and name required");if(!i||i.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+i.type)}function Af(i,c,a){if(!i)throw new Error("No feature passed");if(!a)throw new Error(".featureOf() requires a name");if(!i||i.type!=="Feature"||!i.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!i.geometry||i.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+i.geometry.type)}function ch(i,c,a){if(!i)throw new Error("No featureCollection passed");if(!a)throw new Error(".collectionOf() requires a name");if(!i||i.type!=="FeatureCollection")throw new Error("Invalid input to "+a+", FeatureCollection required");for(var s=0,l=i.features;s<l.length;s++){var d=l[s];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!d.geometry||d.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+d.geometry.type)}}function Vc(i){return i.type==="Feature"?i.geometry:i}function Ih(i,c){return i.type==="FeatureCollection"?"FeatureCollection":i.type==="GeometryCollection"?"GeometryCollection":i.type==="Feature"&&i.geometry!==null?i.geometry.type:i.type}function cc(i,c,a){if(i!==null)for(var s,l,d,_,T,I,R,ee=0,X=0,ve,Be=i.type,lt=Be==="FeatureCollection",Mt=Be==="Feature",pr=lt?i.features.length:1,xr=0;xr<pr;xr++){R=lt?i.features[xr].geometry:Mt?i.geometry:i,ve=R?R.type==="GeometryCollection":!1,T=ve?R.geometries.length:1;for(var kr=0;kr<T;kr++){var hn=0,cn=0;if(_=ve?R.geometries[kr]:R,_!==null){I=_.coordinates;var In=_.type;switch(ee=a&&(In==="Polygon"||In==="MultiPolygon")?1:0,In){case null:break;case"Point":if(c(I,X,xr,hn,cn)===!1)return!1;X++,hn++;break;case"LineString":case"MultiPoint":for(s=0;s<I.length;s++){if(c(I[s],X,xr,hn,cn)===!1)return!1;X++,In==="MultiPoint"&&hn++}In==="LineString"&&hn++;break;case"Polygon":case"MultiLineString":for(s=0;s<I.length;s++){for(l=0;l<I[s].length-ee;l++){if(c(I[s][l],X,xr,hn,cn)===!1)return!1;X++}In==="MultiLineString"&&hn++,In==="Polygon"&&cn++}In==="Polygon"&&hn++;break;case"MultiPolygon":for(s=0;s<I.length;s++){for(cn=0,l=0;l<I[s].length;l++){for(d=0;d<I[s][l].length-ee;d++){if(c(I[s][l][d],X,xr,hn,cn)===!1)return!1;X++}cn++}hn++}break;case"GeometryCollection":for(s=0;s<_.geometries.length;s++)if(cc(_.geometries[s],c,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function fh(i,c,a,s){var l=a;return cc(i,function(d,_,T,I,R){_===0&&a===void 0?l=d:l=c(l,d,_,T,I,R)},s),l}function lf(i,c){var a;switch(i.type){case"FeatureCollection":for(a=0;a<i.features.length&&c(i.features[a].properties,a)!==!1;a++);break;case"Feature":c(i.properties,0);break}}function cf(i,c,a){var s=a;return lf(i,function(l,d){d===0&&a===void 0?s=l:s=c(s,l,d)}),s}function ou(i,c){if(i.type==="Feature")c(i,0);else if(i.type==="FeatureCollection")for(var a=0;a<i.features.length&&c(i.features[a],a)!==!1;a++);}function jf(i,c,a){var s=a;return ou(i,function(l,d){d===0&&a===void 0?s=l:s=c(s,l,d)}),s}function Vf(i){var c=[];return cc(i,function(a){c.push(a)}),c}function ff(i,c){var a,s,l,d,_,T,I,R,ee,X,ve=0,Be=i.type==="FeatureCollection",lt=i.type==="Feature",Mt=Be?i.features.length:1;for(a=0;a<Mt;a++){for(T=Be?i.features[a].geometry:lt?i.geometry:i,R=Be?i.features[a].properties:lt?i.properties:{},ee=Be?i.features[a].bbox:lt?i.bbox:void 0,X=Be?i.features[a].id:lt?i.id:void 0,I=T?T.type==="GeometryCollection":!1,_=I?T.geometries.length:1,l=0;l<_;l++){if(d=I?T.geometries[l]:T,d===null){if(c(null,ve,R,ee,X)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(d,ve,R,ee,X)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(c(d.geometries[s],ve,R,ee,X)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ve++}}function Oh(i,c,a){var s=a;return ff(i,function(l,d,_,T,I){d===0&&a===void 0?s=l:s=c(s,l,d,_,T,I)}),s}function fc(i,c){ff(i,function(a,s,l,d,_){var T=a===null?null:a.type;switch(T){case null:case"Point":case"LineString":case"Polygon":return c((0,Pc.zL)(a,l,{bbox:d,id:_}),s,0)===!1?!1:void 0}var I;switch(T){case"MultiPoint":I="Point";break;case"MultiLineString":I="LineString";break;case"MultiPolygon":I="Polygon";break}for(var R=0;R<a.coordinates.length;R++){var ee=a.coordinates[R],X={type:I,coordinates:ee};if(c((0,Pc.zL)(X,l),s,R)===!1)return!1}})}function vl(i,c,a){var s=a;return fc(i,function(l,d,_){d===0&&_===0&&a===void 0?s=l:s=c(s,l,d,_)}),s}function Lh(i,c){fc(i,function(a,s,l){var d=0;if(!!a.geometry){var _=a.geometry.type;if(!(_==="Point"||_==="MultiPoint")){var T,I=0,R=0,ee=0;if(cc(a,function(X,ve,Be,lt,Mt){if(T===void 0||s>I||lt>R||Mt>ee){T=X,I=s,R=lt,ee=Mt,d=0;return}var pr=lineString([T,X],a.properties);if(c(pr,s,l,Mt,d)===!1)return!1;d++,T=X})===!1)return!1}}})}function Rh(i,c,a){var s=a,l=!1;return Lh(i,function(d,_,T,I,R){l===!1&&a===void 0?s=d:s=c(s,d,_,T,I,R),l=!0}),s}function Dh(i,c){if(!i)throw new Error("geojson is required");fc(i,function(a,s,l){if(a.geometry!==null){var d=a.geometry.type,_=a.geometry.coordinates;switch(d){case"LineString":if(c(a,s,l,0,0)===!1)return!1;break;case"Polygon":for(var T=0;T<_.length;T++)if(c(lineString(_[T],a.properties),s,l,T)===!1)return!1;break}}})}function fp(i,c,a){var s=a;return Dh(i,function(l,d,_,T){d===0&&a===void 0?s=l:s=c(s,l,d,_,T)}),s}function jp(i,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.segmentIndex||0,_=c.properties,T;switch(i.type){case"FeatureCollection":a<0&&(a=i.features.length+a),_=_||i.features[a].properties,T=i.features[a].geometry;break;case"Feature":_=_||i.properties,T=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":T=i;break;default:throw new Error("geojson is invalid")}if(T===null)return null;var I=T.coordinates;switch(T.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=I.length+d-1),lineString([I[d],I[d+1]],_,c);case"Polygon":return l<0&&(l=I.length+l),d<0&&(d=I[l].length+d-1),lineString([I[l][d],I[l][d+1]],_,c);case"MultiLineString":return s<0&&(s=I.length+s),d<0&&(d=I[s].length+d-1),lineString([I[s][d],I[s][d+1]],_,c);case"MultiPolygon":return s<0&&(s=I.length+s),l<0&&(l=I[s].length+l),d<0&&(d=I[s][l].length-d-1),lineString([I[s][l][d],I[s][l][d+1]],_,c)}throw new Error("geojson is invalid")}function Gc(i,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.coordIndex||0,_=c.properties,T;switch(i.type){case"FeatureCollection":a<0&&(a=i.features.length+a),_=_||i.features[a].properties,T=i.features[a].geometry;break;case"Feature":_=_||i.properties,T=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":T=i;break;default:throw new Error("geojson is invalid")}if(T===null)return null;var I=T.coordinates;switch(T.type){case"Point":return point(I,_,c);case"MultiPoint":return s<0&&(s=I.length+s),point(I[s],_,c);case"LineString":return d<0&&(d=I.length+d),point(I[d],_,c);case"Polygon":return l<0&&(l=I.length+l),d<0&&(d=I[l].length+d),point(I[l][d],_,c);case"MultiLineString":return s<0&&(s=I.length+s),d<0&&(d=I[s].length+d),point(I[s][d],_,c);case"MultiPolygon":return s<0&&(s=I.length+s),l<0&&(l=I[s].length+l),d<0&&(d=I[s][l].length-d),point(I[s][l][d],_,c)}throw new Error("geojson is invalid")}function Ic(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function hh(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Ic(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Ic(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function Gf(i,c){var a=[],s={};if(i.features=i.features.filter(function(d){var _=d.geometry;return d!=null&&_&&_.type&&_.coordinates&&_.coordinates.length>0}),jo()(i,!0),i.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return fc(i,function(d,_){var T=wf(d),I=_,R=hh(hh({},d.properties),{},{coordinates:T,_id:I});a.push(R)}),{dataArray:a,featureKeys:s}}function hf(i,c){var a=c.extent,s=new Promise(function(d){qu(i,function(_){d(_)})}),l={images:s,_id:1,dataArray:[{_id:0,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return l}function qu(i,c){var a=i,s=[];if(typeof a=="string")(0,rt.gJ)({url:a},function(_,T){s.push(T),c(s)});else{var l=a.length,d=0;a.forEach(function(_){(0,rt.gJ)({url:_},function(T,I){d++,s.push(I),d===l&&c(s)})})}return hf}function hp(i,c){var a=c.extent,s=c.width,l=c.height,d=c.min,_=c.max,T={_id:1,dataArray:[{_id:1,data:Array.from(i),width:s,height:l,min:d,max:_,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return T}var Bl=S(24602),kh=S.n(Bl);function ml(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function Nl(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ml(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):ml(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function ph(i,c){var a=c.radius,s=a===void 0?40:a,l=c.maxZoom,d=l===void 0?18:l,_=c.minZoom,T=_===void 0?0:_,I=c.zoom,R=I===void 0?2:I;if(i.pointIndex){var ee=i.pointIndex.getClusters(i.extent,Math.floor(R));return i.dataArray=dh(ee),i}var X=new(Xi())({radius:s,minZoom:T,maxZoom:d}),ve={type:"FeatureCollection",features:[]};return ve.features=i.dataArray.map(function(Be){return{type:"Feature",geometry:{type:"Point",coordinates:Be.coordinates},properties:Nl({},Be)}}),X.load(ve.features),X}function dh(i){return i.map(function(c,a){return Nl({coordinates:c.geometry.coordinates,_id:a+1},c.properties)})}function Hf(i){if(i.length===0)throw new Error("max requires at least one data point");for(var c=i[0],a=1;a<i.length;a++)i[a]>c&&(c=i[a]);return c}function Fh(i){if(i.length===0)throw new Error("min requires at least one data point");for(var c=i[0],a=1;a<i.length;a++)i[a]<c&&(c=i[a]);return c}function us(i){if(i.length===0)return 0;for(var c=i[0],a=0,s,l=1;l<i.length;l++)s=c+i[l]*1,Math.abs(c)>=Math.abs(i[l])?a+=c-s+i[l]:a+=i[l]-s+c,c=s;return c+a*1}function Vo(i){if(i.length===0)throw new Error("mean requires at least one data point");return us(i)/i.length}var ls={min:Fh,max:Hf,mean:Vo,sum:us};function su(i,c){return i.map(function(a){return a[c]*1})}function Wf(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function Bh(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Wf(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Wf(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function Nh(i){var c=pp();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function pp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function dp(i,c){if(Array.isArray(c))return c}var zh=function(i){(0,Ne.Z)(a,i);var c=Nh(a);function a(s,l){var d;return(0,K.Z)(this,a),d=c.call(this),(0,L.Z)((0,N.Z)(d),"data",void 0),(0,L.Z)((0,N.Z)(d),"extent",void 0),(0,L.Z)((0,N.Z)(d),"hooks",{init:new ta.ni}),(0,L.Z)((0,N.Z)(d),"parser",{type:"geojson"}),(0,L.Z)((0,N.Z)(d),"transforms",[]),(0,L.Z)((0,N.Z)(d),"cluster",!1),(0,L.Z)((0,N.Z)(d),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,L.Z)((0,N.Z)(d),"mapService",void 0),(0,L.Z)((0,N.Z)(d),"invalidExtent",!1),(0,L.Z)((0,N.Z)(d),"originData",void 0),(0,L.Z)((0,N.Z)(d),"rawData",void 0),(0,L.Z)((0,N.Z)(d),"cfg",{}),(0,L.Z)((0,N.Z)(d),"clusterIndex",void 0),d.originData=s,d.initCfg(l),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,W.Z)(a,[{key:"setData",value:function(l,d){this.rawData=l,this.originData=l,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var d=this,_=this.clusterOptions,T=_.method,I=T===void 0?"sum":T,R=_.field,ee=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,ee.forEach(function(X){X.id||(X.properties.point_count=1)}),(R||ho()(I))&&(ee=ee.map(function(X){var ve=X.id;if(ve){var Be=d.clusterIndex.getLeaves(ve,Infinity),lt=Be.map(function(xr){return xr.properties}),Mt;if(ka()(I)&&R){var pr=su(lt,R);Mt=ls[I](pr)}ho()(I)&&(Mt=I(lt)),X.properties.stat=Mt}else X.properties.point_count=1;return X})),this.data=xu("geojson")({type:"FeatureCollection",features:ee}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var d=this.parser.type,_=d===void 0?"geojson":d;if(_==="geojson"&&!this.cluster){var T=l<this.originData.features.length?this.originData.features[l]:"null",I=Ga()(T);if(this.transforms.length!==0){var R=this.data.dataArray.find(function(ee){return ee._id===l});I.properties=R}return I}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,d){var _=this.data.dataArray.find(function(T){return T[l]===name});return _==null?void 0:_._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,rt.yA)((0,rt.ds)(this.extent),l)),d[0].concat(d[1])}},{key:"initCfg",value:function(l){this.cfg=kh()(this.cfg,l,dp);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=Bh(Bh({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,d=l.type||"geojson",_=xu(d);this.data=_(this.originData,l),this.extent=(0,rt.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,d=this.transforms;d.forEach(function(_){var T=_.type,I=Ff(T)(l.data,_);Object.assign(l.data,I)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=ph(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),a}(Xt.EventEmitter);function Uh(i,c){var a=c.callback;return a&&(i.dataArray=i.dataArray.filter(a)),i}function Zh(i,c){var a=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!a){if(Array.isArray(i)||(a=vp(i))||c&&i&&typeof i.length=="number"){a&&(i=a);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){a=a.call(i)},n:function(){var R=a.next();return d=R.done,R},e:function(R){_=!0,T=R},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function vp(i,c){if(!!i){if(typeof i=="string")return pf(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pf(i,c)}}function pf(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}var Xf=6378e3;function vh(i,c){var a=i.dataArray,s=c.size,l=s===void 0?10:s,d=l/(2*Math.PI*Xf)*(256<<20)/2,_=Tf(a,l),T=_.gridHash,I=_.gridOffset,R=Hc(T,I,c);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:R}}function Tf(i,c){var a=Infinity,s=-Infinity,l,d=Zh(i),_;try{for(d.s();!(_=d.n()).done;){var T=_.value;l=T.coordinates[1],Number.isFinite(l)&&(a=l<a?l:a,s=l>s?l:s)}}catch(hn){d.e(hn)}finally{d.f()}var I=(a+s)/2,R=$a(c,I);if(R.xOffset<=0||R.yOffset<=0)return{gridHash:{},gridOffset:R};var ee={},X=Zh(i),ve;try{for(X.s();!(ve=X.n()).done;){var Be=ve.value,lt=Be.coordinates[1],Mt=Be.coordinates[0];if(Number.isFinite(lt)&&Number.isFinite(Mt)){var pr=Math.floor((lt+90)/R.yOffset),xr=Math.floor((Mt+180)/R.xOffset),kr="".concat(pr,"-").concat(xr);ee[kr]=ee[kr]||{count:0,points:[]},ee[kr].count+=1,ee[kr].points.push(Be)}}}catch(hn){X.e(hn)}finally{X.f()}return{gridHash:ee,gridOffset:R}}function $a(i,c){var a=jh(i),s=hc(c,i);return{yOffset:a,xOffset:s}}function jh(i){return i/Xf*(180/Math.PI)}function hc(i,c){return c/Xf*(180/Math.PI)/Math.cos(i*Math.PI/180)}function Hc(i,c,a){return Object.keys(i).reduce(function(s,l,d){var _=l.split("-"),T=parseInt(_[0],10),I=parseInt(_[1],10),R={};if(a.field&&a.method){var ee=rt.a5.getColumn(i[l].points,a.field);R[a.method]=rt.a5.statMap[a.method](ee)}return Object.assign(R,{_id:d,coordinates:(0,rt.Z)([-180+c.xOffset*(I+.5),-90+c.yOffset*(T+.5)]),rawData:i[l].points,count:i[l].count}),s.push(R),s},[])}var Wc=Math.PI/3,V=[0,Wc,2*Wc,3*Wc,4*Wc,5*Wc];function Me(i){return i[0]}function $e(i){return i[1]}function ar(){var i=0,c=0,a=1,s=1,l=Me,d=$e,_,T,I;function R(X){var ve={},Be=[],lt,Mt=X.length;for(lt=0;lt<Mt;++lt)if(!(isNaN(xr=+l.call(null,pr=X[lt],lt,X))||isNaN(kr=+d.call(null,pr,lt,X)))){var pr,xr,kr,hn=Math.round(kr=kr/I),cn=Math.round(xr=xr/T-(hn&1)/2),In=kr-hn;if(Math.abs(In)*3>1){var oi=xr-cn,vn=cn+(xr<cn?-1:1)/2,mi=hn+(kr<hn?-1:1),Ki=xr-vn,ba=kr-mi;oi*oi+In*In>Ki*Ki+ba*ba&&(cn=vn+(hn&1?1:-1)/2,hn=mi)}var pi=cn+"-"+hn,Ia=ve[pi];Ia?Ia.push(pr):(Be.push(Ia=ve[pi]=[pr]),Ia.x=(cn+(hn&1)/2)*T,Ia.y=hn*I)}return Be}function ee(X){var ve=0,Be=0;return V.map(function(lt){var Mt=Math.sin(lt)*X,pr=-Math.cos(lt)*X,xr=Mt-ve,kr=pr-Be;return ve=Mt,Be=pr,[xr,kr]})}return R.hexagon=function(X){return"m"+ee(X==null?_:+X).join("l")+"z"},R.centers=function(){for(var X=[],ve=Math.round(c/I),Be=Math.round(i/T),lt=ve*I;lt<s+_;lt+=I,++ve)for(var Mt=Be*T+(ve&1)*T/2;Mt<a+T/2;Mt+=T)X.push([Mt,lt]);return X},R.mesh=function(){var X=ee(_).slice(0,4).join("l");return R.centers().map(function(ve){return"M"+ve+"m"+X}).join("")},R.x=function(X){return arguments.length?(l=X,R):l},R.y=function(X){return arguments.length?(d=X,R):d},R.radius=function(X){return arguments.length?(_=+X,T=_*2*Math.sin(Wc),I=_*1.5,R):_},R.size=function(X){return arguments.length?(i=c=0,a=+X[0],s=+X[1],R):[a-i,s-c]},R.extent=function(X){return arguments.length?(i=+X[0][0],c=+X[0][1],a=+X[1][0],s=+X[1][1],R):[[i,c],[a,s]]},R.radius(1)}function Pr(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function rr(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Pr(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Pr(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}var Cr=6378e3;function Fr(i,c){var a=i.dataArray,s=c.size,l=s===void 0?10:s,d=c.method,_=d===void 0?"sum":d,T=l/(2*Math.PI*Cr)*(256<<20)/2,I=a.map(function(ve){var Be=(0,rt.Z)(ve.coordinates),lt=(0,q.Z)(Be,2),Mt=lt[0],pr=lt[1];return rr(rr({},ve),{},{coordinates:[Mt,pr]})}),R=ar().radius(T).x(function(ve){return ve.coordinates[0]}).y(function(ve){return ve.coordinates[1]}),ee=R(I),X={dataArray:ee.map(function(ve,Be){var lt;if(c.field&&_){var Mt=rt.a5.getColumn(ve,c.field);ve[_]=rt.a5.statMap[_](Mt)}return lt={},(0,L.Z)(lt,c.method,ve[_]),(0,L.Z)(lt,"count",ve.length),(0,L.Z)(lt,"rawData",ve),(0,L.Z)(lt,"coordinates",[ve.x,ve.y]),(0,L.Z)(lt,"_id",Be),lt}),radius:T,xOffset:T,yOffset:T,type:"hexagon"};return X}function Vr(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function Kr(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Vr(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Vr(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function $r(i,c){var a=c.sourceField,s=c.targetField,l=c.data,d={};return l.forEach(function(_){d[_[a]]=_}),i.dataArray=i.dataArray.map(function(_){var T=_[s];return Kr(Kr({},_),d[T])}),i}function rn(i,c){var a=c.callback;return a&&(i.dataArray=i.dataArray.map(a)),i}var dn=S(82008),Hr=zh;Mo("geojson",Gf),Mo("image",hf),Mo("csv",zf),Mo("json",Cf),Mo("raster",hp),Dl("cluster",ph),Dl("filter",Uh),Dl("join",$r),Dl("map",rn),Dl("grid",vh),Dl("hexagon",Fr);var en,Lt,vr=(en=(0,Ct.b2)(),en(Lt=function(){function i(){(0,K.Z)(this,i),(0,L.Z)(this,"mapService",void 0)}return(0,W.Z)(i,[{key:"apply",value:function(a){var s=this;this.mapService=a.getContainer().get(w.vK.IMapService),a.hooks.init.tap("DataSourcePlugin",function(){var l=a.getSource();if(!l){var d=a.sourceOption,_=d.data,T=d.options;a.setSource(new Hr(_,T))}s.updateClusterData(a)}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(a),d=a.dataState.dataSourceNeedUpdate;return a.dataState.dataSourceNeedUpdate=!1,l||d})}},{key:"updateClusterData",value:function(a){var s=a.getSource(),l=s.cluster,d=s.clusterOptions,_=d.zoom,T=_===void 0?0:_,I=d.maxZoom,R=I===void 0?16:I,ee=this.mapService.getZoom()-1,X=a.dataState.dataSourceNeedUpdate;return l&&(X||Math.abs(T-ee)>1)&&R>T?(s.updateClusterData(Math.floor(ee)),!0):!1}}]),i}())||Lt),Xr=S(21691),On=S.n(Xr),wr=S(93544),bn=S.n(wr);function tn(i,c){return i<c?-1:i>c?1:i>=c?0:NaN}function ui(i){return i.length===1&&(i=Tr(i)),{left:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;i(c[d],a)<0?s=d+1:l=d}return s},right:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;i(c[d],a)>0?l=d:s=d+1}return s}}}function Tr(i){return function(c,a){return tn(i(c),a)}}var Sr=ui(tn),Xn=Sr.right,yn=Sr.left,Yr=Xn;function An(i,c){var a=i.length,s=-1,l,d,_;if(c==null){for(;++s<a;)if((l=i[s])!=null&&l>=l)for(d=_=l;++s<a;)(l=i[s])!=null&&(d>l&&(d=l),_<l&&(_=l))}else for(;++s<a;)if((l=c(i[s],s,i))!=null&&l>=l)for(d=_=l;++s<a;)(l=c(i[s],s,i))!=null&&(d>l&&(d=l),_<l&&(_=l));return[d,_]}var Sn=Array.prototype,Zi=Sn.slice,Oi=Sn.map,Tn=Math.sqrt(50),En=Math.sqrt(10),bi=Math.sqrt(2);function Li(i,c,a){var s,l=-1,d,_,T;if(c=+c,i=+i,a=+a,i===c&&a>0)return[i];if((s=c<i)&&(d=i,i=c,c=d),(T=qi(i,c,a))===0||!isFinite(T))return[];if(T>0)for(i=Math.ceil(i/T),c=Math.floor(c/T),_=new Array(d=Math.ceil(c-i+1));++l<d;)_[l]=(i+l)*T;else for(i=Math.floor(i*T),c=Math.ceil(c*T),_=new Array(d=Math.ceil(i-c+1));++l<d;)_[l]=(i-l)/T;return s&&_.reverse(),_}function qi(i,c,a){var s=(c-i)/Math.max(0,a),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=Tn?10:d>=En?5:d>=bi?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=Tn?10:d>=En?5:d>=bi?2:1)}function yo(i,c,a){var s=Math.abs(c-i)/Math.max(0,a),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=Tn?l*=10:d>=En?l*=5:d>=bi&&(l*=2),c<i?-l:l}function Fo(){var i=identity,c=extent,a=sturges;function s(l){var d,_=l.length,T,I=new Array(_);for(d=0;d<_;++d)I[d]=i(l[d],d,l);var R=c(I),ee=R[0],X=R[1],ve=a(I,ee,X);Array.isArray(ve)||(ve=tickStep(ee,X,ve),ve=range(Math.ceil(ee/ve)*ve,X,ve));for(var Be=ve.length;ve[0]<=ee;)ve.shift(),--Be;for(;ve[Be-1]>X;)ve.pop(),--Be;var lt=new Array(Be+1),Mt;for(d=0;d<=Be;++d)Mt=lt[d]=[],Mt.x0=d>0?ve[d-1]:ee,Mt.x1=d<Be?ve[d]:X;for(d=0;d<_;++d)T=I[d],ee<=T&&T<=X&&lt[bisect(ve,T,0,Be)].push(l[d]);return lt}return s.value=function(l){return arguments.length?(i=typeof l=="function"?l:constant(l),s):i},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(a=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):a},s}function pa(i,c,a){return i=map.call(i,number).sort(ascending),Math.ceil((a-c)/(2*(quantile(i,.75)-quantile(i,.25))*Math.pow(i.length,-1/3)))}function ys(i){return i===null?NaN:+i}function fo(i,c,a){if(a==null&&(a=ys),!!(s=i.length)){if((c=+c)<=0||s<2)return+a(i[0],0,i);if(c>=1)return+a(i[s-1],s-1,i);var s,l=(s-1)*c,d=Math.floor(l),_=+a(i[d],d,i),T=+a(i[d+1],d+1,i);return _+(T-_)*(l-d)}}var Ja="$";function Io(){}Io.prototype=cs.prototype={constructor:Io,has:function(i){return Ja+i in this},get:function(i){return this[Ja+i]},set:function(i,c){return this[Ja+i]=c,this},remove:function(i){var c=Ja+i;return c in this&&delete this[c]},clear:function(){for(var i in this)i[0]===Ja&&delete this[i]},keys:function(){var i=[];for(var c in this)c[0]===Ja&&i.push(c.slice(1));return i},values:function(){var i=[];for(var c in this)c[0]===Ja&&i.push(this[c]);return i},entries:function(){var i=[];for(var c in this)c[0]===Ja&&i.push({key:c.slice(1),value:this[c]});return i},size:function(){var i=0;for(var c in this)c[0]===Ja&&++i;return i},empty:function(){for(var i in this)if(i[0]===Ja)return!1;return!0},each:function(i){for(var c in this)c[0]===Ja&&i(this[c],c.slice(1),this)}};function cs(i,c){var a=new Io;if(i instanceof Io)i.each(function(T,I){a.set(I,T)});else if(Array.isArray(i)){var s=-1,l=i.length,d;if(c==null)for(;++s<l;)a.set(s,i[s]);else for(;++s<l;)a.set(c(d=i[s],s,i),d)}else if(i)for(var _ in i)a.set(_,i[_]);return a}var fs=cs;function _s(){var i=[],c=[],a,s,l;function d(T,I,R,ee){if(I>=i.length)return a!=null&&T.sort(a),s!=null?s(T):T;for(var X=-1,ve=T.length,Be=i[I++],lt,Mt,pr=map(),xr,kr=R();++X<ve;)(xr=pr.get(lt=Be(Mt=T[X])+""))?xr.push(Mt):pr.set(lt,[Mt]);return pr.each(function(hn,cn){ee(kr,cn,d(hn,I,R,ee))}),kr}function _(T,I){if(++I>i.length)return T;var R,ee=c[I-1];return s!=null&&I>=i.length?R=T.entries():(R=[],T.each(function(X,ve){R.push({key:ve,values:_(X,I)})})),ee!=null?R.sort(function(X,ve){return ee(X.key,ve.key)}):R}return l={object:function(T){return d(T,0,Go,Wi)},map:function(T){return d(T,0,Jo,Pa)},entries:function(T){return _(d(T,0,Jo,Pa),0)},key:function(T){return i.push(T),l},sortKeys:function(T){return c[i.length-1]=T,l},sortValues:function(T){return a=T,l},rollup:function(T){return s=T,l}}}function Go(){return{}}function Wi(i,c,a){i[c]=a}function Jo(){return map()}function Pa(i,c,a){i.set(c,a)}function _o(){}var _i=fs.prototype;_o.prototype=ha.prototype={constructor:_o,has:_i.has,add:function(i){return i+="",this[Ja+i]=i,this},remove:_i.remove,clear:_i.clear,values:_i.keys,size:_i.size,empty:_i.empty,each:_i.each};function ha(i,c){var a=new _o;if(i instanceof _o)i.each(function(d){a.add(d)});else if(i){var s=-1,l=i.length;if(c==null)for(;++s<l;)a.add(i[s]);else for(;++s<l;)a.add(c(i[s],s,i))}return a}var io=null,xo=Array.prototype,bu=xo.map,Ue=xo.slice;function er(i,c){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(c).domain(i);break}return this}function Jt(i,c){switch(arguments.length){case 0:break;case 1:this.interpolator(i);break;default:this.interpolator(c).domain(i);break}return this}var zn={name:"implicit"};function oa(){var i=fs(),c=[],a=[],s=zn;function l(d){var _=d+"",T=i.get(_);if(!T){if(s!==zn)return s;i.set(_,T=c.push(d))}return a[(T-1)%a.length]}return l.domain=function(d){if(!arguments.length)return c.slice();c=[],i=fs();for(var _=-1,T=d.length,I,R;++_<T;)i.has(R=(I=d[_])+"")||i.set(R,c.push(I));return l},l.range=function(d){return arguments.length?(a=Ue.call(d),l):a.slice()},l.unknown=function(d){return arguments.length?(s=d,l):s},l.copy=function(){return oa(c,a).unknown(s)},er.apply(l,arguments),l}function ke(){var i=ordinal().unknown(void 0),c=i.domain,a=i.range,s=[0,1],l,d,_=!1,T=0,I=0,R=.5;delete i.unknown;function ee(){var X=c().length,ve=s[1]<s[0],Be=s[ve-0],lt=s[1-ve];l=(lt-Be)/Math.max(1,X-T+I*2),_&&(l=Math.floor(l)),Be+=(lt-Be-l*(X-T))*R,d=l*(1-T),_&&(Be=Math.round(Be),d=Math.round(d));var Mt=sequence(X).map(function(pr){return Be+l*pr});return a(ve?Mt.reverse():Mt)}return i.domain=function(X){return arguments.length?(c(X),ee()):c()},i.range=function(X){return arguments.length?(s=[+X[0],+X[1]],ee()):s.slice()},i.rangeRound=function(X){return s=[+X[0],+X[1]],_=!0,ee()},i.bandwidth=function(){return d},i.step=function(){return l},i.round=function(X){return arguments.length?(_=!!X,ee()):_},i.padding=function(X){return arguments.length?(T=Math.min(1,I=+X),ee()):T},i.paddingInner=function(X){return arguments.length?(T=Math.min(1,X),ee()):T},i.paddingOuter=function(X){return arguments.length?(I=+X,ee()):I},i.align=function(X){return arguments.length?(R=Math.max(0,Math.min(1,X)),ee()):R},i.copy=function(){return ke(c(),s).round(_).paddingInner(T).paddingOuter(I).align(R)},initRange.apply(ee(),arguments)}function Se(i){var c=i.copy;return i.padding=i.paddingOuter,delete i.paddingInner,delete i.paddingOuter,i.copy=function(){return Se(c())},i}function ot(){return Se(ke.apply(null,arguments).paddingInner(1))}var Rt=S(45257),or=S(53254);function vt(i,c){return i=+i,c=+c,function(a){return Math.round(i*(1-a)+c*a)}}function ft(i){return function(){return i}}function nt(i){return+i}var Oe=[0,1];function Qe(i){return i}function Fe(i,c){return(c-=i=+i)?function(a){return(a-i)/c}:ft(isNaN(c)?NaN:.5)}function kt(i){var c=i[0],a=i[i.length-1],s;return c>a&&(s=c,c=a,a=s),function(l){return Math.max(c,Math.min(a,l))}}function Wt(i,c,a){var s=i[0],l=i[1],d=c[0],_=c[1];return l<s?(s=Fe(l,s),d=a(_,d)):(s=Fe(s,l),d=a(d,_)),function(T){return d(s(T))}}function Br(i,c,a){var s=Math.min(i.length,c.length)-1,l=new Array(s),d=new Array(s),_=-1;for(i[s]<i[0]&&(i=i.slice().reverse(),c=c.slice().reverse());++_<s;)l[_]=Fe(i[_],i[_+1]),d[_]=a(c[_],c[_+1]);return function(T){var I=Yr(i,T,1,s)-1;return d[I](l[I](T))}}function un(i,c){return c.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function fn(){var i=Oe,c=Oe,a=Rt.Z,s,l,d,_=Qe,T,I,R;function ee(){return T=Math.min(i.length,c.length)>2?Br:Wt,I=R=null,X}function X(ve){return isNaN(ve=+ve)?d:(I||(I=T(i.map(s),c,a)))(s(_(ve)))}return X.invert=function(ve){return _(l((R||(R=T(c,i.map(s),or.Z)))(ve)))},X.domain=function(ve){return arguments.length?(i=bu.call(ve,nt),_===Qe||(_=kt(i)),ee()):i.slice()},X.range=function(ve){return arguments.length?(c=Ue.call(ve),ee()):c.slice()},X.rangeRound=function(ve){return c=Ue.call(ve),a=vt,ee()},X.clamp=function(ve){return arguments.length?(_=ve?kt(i):Qe,X):_!==Qe},X.interpolate=function(ve){return arguments.length?(a=ve,ee()):a},X.unknown=function(ve){return arguments.length?(d=ve,X):d},function(ve,Be){return s=ve,l=Be,ee()}}function Mn(i,c){return fn()(i,c)}var ln=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Hn(i){if(!(c=ln.exec(i)))throw new Error("invalid format: "+i);var c;return new Rn({fill:c[1],align:c[2],sign:c[3],symbol:c[4],zero:c[5],width:c[6],comma:c[7],precision:c[8]&&c[8].slice(1),trim:c[9],type:c[10]})}Hn.prototype=Rn.prototype;function Rn(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}Rn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Yn(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function Vn(i,c){if((a=(i=c?i.toExponential(c-1):i.toExponential()).indexOf("e"))<0)return null;var a,s=i.slice(0,a);return[s.length>1?s[0]+s.slice(2):s,+i.slice(a+1)]}function Un(i){return i=Vn(Math.abs(i)),i?i[1]:NaN}function di(i,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Un(c)/3)))*3-Un(Math.abs(i)))}function Qa(i,c){return function(a,s){for(var l=a.length,d=[],_=0,T=i[0],I=0;l>0&&T>0&&(I+T+1>s&&(T=Math.max(1,s-I)),d.push(a.substring(l-=T,l+T)),!((I+=T+1)>s));)T=i[_=(_+1)%i.length];return d.reverse().join(c)}}function Ho(i){return function(c){return c.replace(/[0-9]/g,function(a){return i[+a]})}}function zl(i){e:for(var c=i.length,a=1,s=-1,l;a<c;++a)switch(i[a]){case".":s=l=a;break;case"0":s===0&&(s=a),l=a;break;default:if(!+i[a])break e;s>0&&(s=0);break}return s>0?i.slice(0,s)+i.slice(l+1):i}var qa;function Ra(i,c){var a=Vn(i,c);if(!a)return i+"";var s=a[0],l=a[1],d=l-(qa=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,_=s.length;return d===_?s:d>_?s+new Array(d-_+1).join("0"):d>0?s.slice(0,d)+"."+s.slice(d):"0."+new Array(1-d).join("0")+Vn(i,Math.max(0,c+d-1))[0]}function ks(i,c){var a=Vn(i,c);if(!a)return i+"";var s=a[0],l=a[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var el={"%":function(i,c){return(i*100).toFixed(c)},b:function(i){return Math.round(i).toString(2)},c:function(i){return i+""},d:Yn,e:function(i,c){return i.toExponential(c)},f:function(i,c){return i.toFixed(c)},g:function(i,c){return i.toPrecision(c)},o:function(i){return Math.round(i).toString(8)},p:function(i,c){return ks(i*100,c)},r:ks,s:Ra,X:function(i){return Math.round(i).toString(16).toUpperCase()},x:function(i){return Math.round(i).toString(16)}};function Su(i){return i}var Yf=Array.prototype.map,Fu=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Kf(i){var c=i.grouping===void 0||i.thousands===void 0?Su:Qa(Yf.call(i.grouping,Number),i.thousands+""),a=i.currency===void 0?"":i.currency[0]+"",s=i.currency===void 0?"":i.currency[1]+"",l=i.decimal===void 0?".":i.decimal+"",d=i.numerals===void 0?Su:Ho(Yf.call(i.numerals,String)),_=i.percent===void 0?"%":i.percent+"",T=i.minus===void 0?"-":i.minus+"",I=i.nan===void 0?"NaN":i.nan+"";function R(X){X=Hn(X);var ve=X.fill,Be=X.align,lt=X.sign,Mt=X.symbol,pr=X.zero,xr=X.width,kr=X.comma,hn=X.precision,cn=X.trim,In=X.type;In==="n"?(kr=!0,In="g"):el[In]||(hn===void 0&&(hn=12),cn=!0,In="g"),(pr||ve==="0"&&Be==="=")&&(pr=!0,ve="0",Be="=");var oi=Mt==="$"?a:Mt==="#"&&/[boxX]/.test(In)?"0"+In.toLowerCase():"",vn=Mt==="$"?s:/[%p]/.test(In)?_:"",mi=el[In],Ki=/[defgprs%]/.test(In);hn=hn===void 0?6:/[gprs]/.test(In)?Math.max(1,Math.min(21,hn)):Math.max(0,Math.min(20,hn));function ba(pi){var Ia=oi,to=vn,Cu,np,ip;if(In==="c")to=mi(pi)+to,pi="";else{pi=+pi;var ap=pi<0||1/pi<0;if(pi=isNaN(pi)?I:mi(Math.abs(pi),hn),cn&&(pi=zl(pi)),ap&&+pi==0&&lt!=="+"&&(ap=!1),Ia=(ap?lt==="("?lt:T:lt==="-"||lt==="("?"":lt)+Ia,to=(In==="s"?Fu[8+qa/3]:"")+to+(ap&&lt==="("?")":""),Ki){for(Cu=-1,np=pi.length;++Cu<np;)if(ip=pi.charCodeAt(Cu),48>ip||ip>57){to=(ip===46?l+pi.slice(Cu+1):pi.slice(Cu))+to,pi=pi.slice(0,Cu);break}}}kr&&!pr&&(pi=c(pi,Infinity));var op=Ia.length+pi.length+to.length,rf=op<xr?new Array(xr-op+1).join(ve):"";switch(kr&&pr&&(pi=c(rf+pi,rf.length?xr-to.length:Infinity),rf=""),Be){case"<":pi=Ia+pi+to+rf;break;case"=":pi=Ia+rf+pi+to;break;case"^":pi=rf.slice(0,op=rf.length>>1)+Ia+pi+to+rf.slice(op);break;default:pi=rf+Ia+pi+to;break}return d(pi)}return ba.toString=function(){return X+""},ba}function ee(X,ve){var Be=R((X=Hn(X),X.type="f",X)),lt=Math.max(-8,Math.min(8,Math.floor(Un(ve)/3)))*3,Mt=Math.pow(10,-lt),pr=Fu[8+lt/3];return function(xr){return Be(Mt*xr)+pr}}return{format:R,formatPrefix:ee}}var Oc,Xc,mp;vs({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function vs(i){return Oc=Kf(i),Xc=Oc.format,mp=Oc.formatPrefix,Oc}function mh(i,c){return i=Math.abs(i),c=Math.abs(c)-i,Math.max(0,Un(c)-Un(i))+1}function Yc(i){return Math.max(0,-Un(Math.abs(i)))}function Vh(i,c,a,s){var l=yo(i,c,a),d;switch(s=Hn(s==null?",f":s),s.type){case"s":{var _=Math.max(Math.abs(i),Math.abs(c));return s.precision==null&&!isNaN(d=di(l,_))&&(s.precision=d),mp(s,_)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(d=mh(l,Math.max(Math.abs(i),Math.abs(c))))&&(s.precision=d-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(d=Yc(l))&&(s.precision=d-(s.type==="%")*2);break}}return Xc(s)}function Pf(i){var c=i.domain;return i.ticks=function(a){var s=c();return Li(s[0],s[s.length-1],a==null?10:a)},i.tickFormat=function(a,s){var l=c();return Vh(l[0],l[l.length-1],a==null?10:a,s)},i.nice=function(a){a==null&&(a=10);var s=c(),l=0,d=s.length-1,_=s[l],T=s[d],I;return T<_&&(I=_,_=T,T=I,I=l,l=d,d=I),I=qi(_,T,a),I>0?(_=Math.floor(_/I)*I,T=Math.ceil(T/I)*I,I=qi(_,T,a)):I<0&&(_=Math.ceil(_*I)/I,T=Math.floor(T*I)/I,I=qi(_,T,a)),I>0?(s[l]=Math.floor(_/I)*I,s[d]=Math.ceil(T/I)*I,c(s)):I<0&&(s[l]=Math.ceil(_*I)/I,s[d]=Math.floor(T*I)/I,c(s)),i},i}function Gh(){var i=Mn(Qe,Qe);return i.copy=function(){return un(i,Gh())},er.apply(i,arguments),Pf(i)}function Mf(i){var c;function a(s){return isNaN(s=+s)?c:s}return a.invert=a,a.domain=a.range=function(s){return arguments.length?(i=bu.call(s,nt),a):i.slice()},a.unknown=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return Mf(i).unknown(c)},i=arguments.length?bu.call(i,nt):[0,1],Pf(a)}function Lc(i,c){i=i.slice();var a=0,s=i.length-1,l=i[a],d=i[s],_;return d<l&&(_=a,a=s,s=_,_=l,l=d,d=_),i[a]=c.floor(l),i[s]=c.ceil(d),i}function gp(i){return Math.log(i)}function yp(i){return Math.exp(i)}function Ed(i){return-Math.log(-i)}function Is(i){return-Math.exp(-i)}function df(i){return isFinite(i)?+("1e"+i):i<0?0:i}function Vp(i){return i===10?df:i===Math.E?Math.exp:function(c){return Math.pow(i,c)}}function e(i){return i===Math.E?Math.log:i===10&&Math.log10||i===2&&Math.log2||(i=Math.log(i),function(c){return Math.log(c)/i})}function t(i){return function(c){return-i(-c)}}function r(i){var c=i(gp,yp),a=c.domain,s=10,l,d;function _(){return l=e(s),d=Vp(s),a()[0]<0?(l=t(l),d=t(d),i(Ed,Is)):i(gp,yp),c}return c.base=function(T){return arguments.length?(s=+T,_()):s},c.domain=function(T){return arguments.length?(a(T),_()):a()},c.ticks=function(T){var I=a(),R=I[0],ee=I[I.length-1],X;(X=ee<R)&&(ve=R,R=ee,ee=ve);var ve=l(R),Be=l(ee),lt,Mt,pr,xr=T==null?10:+T,kr=[];if(!(s%1)&&Be-ve<xr){if(ve=Math.round(ve)-1,Be=Math.round(Be)+1,R>0){for(;ve<Be;++ve)for(Mt=1,lt=d(ve);Mt<s;++Mt)if(pr=lt*Mt,!(pr<R)){if(pr>ee)break;kr.push(pr)}}else for(;ve<Be;++ve)for(Mt=s-1,lt=d(ve);Mt>=1;--Mt)if(pr=lt*Mt,!(pr<R)){if(pr>ee)break;kr.push(pr)}}else kr=Li(ve,Be,Math.min(Be-ve,xr)).map(d);return X?kr.reverse():kr},c.tickFormat=function(T,I){if(I==null&&(I=s===10?".0e":","),typeof I!="function"&&(I=Xc(I)),T===Infinity)return I;T==null&&(T=10);var R=Math.max(1,s*T/c.ticks().length);return function(ee){var X=ee/d(Math.round(l(ee)));return X*s<s-.5&&(X*=s),X<=R?I(ee):""}},c.nice=function(){return a(Lc(a(),{floor:function(T){return d(Math.floor(l(T)))},ceil:function(T){return d(Math.ceil(l(T)))}}))},c}function f(){var i=r(fn()).domain([1,10]);return i.copy=function(){return un(i,f()).base(i.base())},er.apply(i,arguments),i}function v(i){return function(c){return Math.sign(c)*Math.log1p(Math.abs(c/i))}}function g(i){return function(c){return Math.sign(c)*Math.expm1(Math.abs(c))*i}}function x(i){var c=1,a=i(v(c),g(c));return a.constant=function(s){return arguments.length?i(v(c=+s),g(c)):c},linearish(a)}function M(){var i=x(transformer());return i.copy=function(){return copy(i,M()).constant(i.constant())},initRange.apply(i,arguments)}function B(i){return function(c){return c<0?-Math.pow(-c,i):Math.pow(c,i)}}function G(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function $(i){return i<0?-i*i:i*i}function ne(i){var c=i(Qe,Qe),a=1;function s(){return a===1?i(Qe,Qe):a===.5?i(G,$):i(B(a),B(1/a))}return c.exponent=function(l){return arguments.length?(a=+l,s()):a},Pf(c)}function fe(){var i=ne(fn());return i.copy=function(){return un(i,fe()).exponent(i.exponent())},er.apply(i,arguments),i}function _e(){return fe.apply(null,arguments).exponent(.5)}function Ve(){var i=[],c=[],a=[],s;function l(){var _=0,T=Math.max(1,c.length);for(a=new Array(T-1);++_<T;)a[_-1]=fo(i,_/T);return d}function d(_){return isNaN(_=+_)?s:c[Yr(a,_)]}return d.invertExtent=function(_){var T=c.indexOf(_);return T<0?[NaN,NaN]:[T>0?a[T-1]:i[0],T<a.length?a[T]:i[i.length-1]]},d.domain=function(_){if(!arguments.length)return i.slice();i=[];for(var T=0,I=_.length,R;T<I;++T)R=_[T],R!=null&&!isNaN(R=+R)&&i.push(R);return i.sort(tn),l()},d.range=function(_){return arguments.length?(c=Ue.call(_),l()):c.slice()},d.unknown=function(_){return arguments.length?(s=_,d):s},d.quantiles=function(){return a.slice()},d.copy=function(){return Ve().domain(i).range(c).unknown(s)},er.apply(d,arguments)}function We(){var i=0,c=1,a=1,s=[.5],l=[0,1],d;function _(I){return I<=I?l[Yr(s,I,0,a)]:d}function T(){var I=-1;for(s=new Array(a);++I<a;)s[I]=((I+1)*c-(I-a)*i)/(a+1);return _}return _.domain=function(I){return arguments.length?(i=+I[0],c=+I[1],T()):[i,c]},_.range=function(I){return arguments.length?(a=(l=Ue.call(I)).length-1,T()):l.slice()},_.invertExtent=function(I){var R=l.indexOf(I);return R<0?[NaN,NaN]:R<1?[i,s[0]]:R>=a?[s[a-1],c]:[s[R-1],s[R]]},_.unknown=function(I){return arguments.length&&(d=I),_},_.thresholds=function(){return s.slice()},_.copy=function(){return We().domain([i,c]).range(l).unknown(d)},er.apply(Pf(_),arguments)}function ht(){var i=[.5],c=[0,1],a,s=1;function l(d){return d<=d?c[Yr(i,d,0,s)]:a}return l.domain=function(d){return arguments.length?(i=Ue.call(d),s=Math.min(i.length,c.length-1),l):i.slice()},l.range=function(d){return arguments.length?(c=Ue.call(d),s=Math.min(i.length,c.length-1),l):c.slice()},l.invertExtent=function(d){var _=c.indexOf(d);return[i[_-1],i[_]]},l.unknown=function(d){return arguments.length?(a=d,l):a},l.copy=function(){return ht().domain(i).range(c).unknown(a)},er.apply(l,arguments)}var et=new Date,Tt=new Date;function Nt(i,c,a,s){function l(d){return i(d=arguments.length===0?new Date:new Date(+d)),d}return l.floor=function(d){return i(d=new Date(+d)),d},l.ceil=function(d){return i(d=new Date(d-1)),c(d,1),i(d),d},l.round=function(d){var _=l(d),T=l.ceil(d);return d-_<T-d?_:T},l.offset=function(d,_){return c(d=new Date(+d),_==null?1:Math.floor(_)),d},l.range=function(d,_,T){var I=[],R;if(d=l.ceil(d),T=T==null?1:Math.floor(T),!(d<_)||!(T>0))return I;do I.push(R=new Date(+d)),c(d,T),i(d);while(R<d&&d<_);return I},l.filter=function(d){return Nt(function(_){if(_>=_)for(;i(_),!d(_);)_.setTime(_-1)},function(_,T){if(_>=_)if(T<0)for(;++T<=0;)for(;c(_,-1),!d(_););else for(;--T>=0;)for(;c(_,1),!d(_););})},a&&(l.count=function(d,_){return et.setTime(+d),Tt.setTime(+_),i(et),i(Tt),Math.floor(a(et,Tt))},l.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?l.filter(s?function(_){return s(_)%d==0}:function(_){return l.count(0,_)%d==0}):l}),l}var cr=Nt(function(i){i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,c){i.setFullYear(i.getFullYear()+c)},function(i,c){return c.getFullYear()-i.getFullYear()},function(i){return i.getFullYear()});cr.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:Nt(function(c){c.setFullYear(Math.floor(c.getFullYear()/i)*i),c.setMonth(0,1),c.setHours(0,0,0,0)},function(c,a){c.setFullYear(c.getFullYear()+a*i)})};var fr=cr,Or=cr.range,nn=Nt(function(i){i.setDate(1),i.setHours(0,0,0,0)},function(i,c){i.setMonth(i.getMonth()+c)},function(i,c){return c.getMonth()-i.getMonth()+(c.getFullYear()-i.getFullYear())*12},function(i){return i.getMonth()}),_n=nn,hi=nn.range,Dn=1e3,ai=6e4,Zn=36e5,ea=864e5,Ci=6048e5;function $n(i){return Nt(function(c){c.setDate(c.getDate()-(c.getDay()+7-i)%7),c.setHours(0,0,0,0)},function(c,a){c.setDate(c.getDate()+a*7)},function(c,a){return(a-c-(a.getTimezoneOffset()-c.getTimezoneOffset())*ai)/Ci})}var ca=$n(0),ji=$n(1),Ea=$n(2),vi=$n(3),xa=$n(4),To=$n(5),Wo=$n(6),Xo=ca.range,Oo=ji.range,Qo=Ea.range,Os=vi.range,Ls=xa.range,uu=To.range,Fs=Wo.range,Gs=Nt(function(i){i.setHours(0,0,0,0)},function(i,c){i.setDate(i.getDate()+c)},function(i,c){return(c-i-(c.getTimezoneOffset()-i.getTimezoneOffset())*ai)/ea},function(i){return i.getDate()-1}),Bo=Gs,Bs=Gs.range,da=Nt(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*Dn-i.getMinutes()*ai)},function(i,c){i.setTime(+i+c*Zn)},function(i,c){return(c-i)/Zn},function(i){return i.getHours()}),ao=da,eo=da.range,Ca=Nt(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*Dn)},function(i,c){i.setTime(+i+c*ai)},function(i,c){return(c-i)/ai},function(i){return i.getMinutes()}),lu=Ca,qs=Ca.range,go=Nt(function(i){i.setTime(i-i.getMilliseconds())},function(i,c){i.setTime(+i+c*Dn)},function(i,c){return(c-i)/Dn},function(i){return i.getUTCSeconds()}),hs=go,eu=go.range,wa=Nt(function(){},function(i,c){i.setTime(+i+c)},function(i,c){return c-i});wa.every=function(i){return i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?Nt(function(c){c.setTime(Math.floor(c/i)*i)},function(c,a){c.setTime(+c+a*i)},function(c,a){return(a-c)/i}):wa};var Rc=wa,gl=wa.range;function Eu(i){return Nt(function(c){c.setUTCDate(c.getUTCDate()-(c.getUTCDay()+7-i)%7),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCDate(c.getUTCDate()+a*7)},function(c,a){return(a-c)/Ci})}var Yo=Eu(0),yl=Eu(1),Ul=Eu(2),$f=Eu(3),Zl=Eu(4),Jf=Eu(5),Kc=Eu(6),gh=Yo.range,_p=yl.range,yh=Ul.range,Hh=$f.range,xp=Zl.range,bp=Jf.range,vf=Kc.range,Qf=Nt(function(i){i.setUTCHours(0,0,0,0)},function(i,c){i.setUTCDate(i.getUTCDate()+c)},function(i,c){return(c-i)/ea},function(i){return i.getUTCDate()-1}),If=Qf,Of=Qf.range,mf=Nt(function(i){i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,c){i.setUTCFullYear(i.getUTCFullYear()+c)},function(i,c){return c.getUTCFullYear()-i.getUTCFullYear()},function(i){return i.getUTCFullYear()});mf.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:Nt(function(c){c.setUTCFullYear(Math.floor(c.getUTCFullYear()/i)*i),c.setUTCMonth(0,1),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCFullYear(c.getUTCFullYear()+a*i)})};var gf=mf,Sp=mf.range;function Lf(i){if(0<=i.y&&i.y<100){var c=new Date(-1,i.m,i.d,i.H,i.M,i.S,i.L);return c.setFullYear(i.y),c}return new Date(i.y,i.m,i.d,i.H,i.M,i.S,i.L)}function Rf(i){if(0<=i.y&&i.y<100){var c=new Date(Date.UTC(-1,i.m,i.d,i.H,i.M,i.S,i.L));return c.setUTCFullYear(i.y),c}return new Date(Date.UTC(i.y,i.m,i.d,i.H,i.M,i.S,i.L))}function yf(i,c,a){return{y:i,m:c,d:a,H:0,M:0,S:0,L:0}}function _h(i){var c=i.dateTime,a=i.date,s=i.time,l=i.periods,d=i.days,_=i.shortDays,T=i.months,I=i.shortMonths,R=$c(l),ee=pc(l),X=$c(d),ve=pc(d),Be=$c(_),lt=pc(_),Mt=$c(T),pr=pc(T),xr=$c(I),kr=pc(I),hn={a:ap,A:op,b:rf,B:Zg,c:null,d:Eh,e:Eh,f:Xp,g:nh,G:ah,H:Tp,I:Wp,j:Ch,L:Pp,m:Yp,M:Kp,p:jg,q:Vg,Q:sd,s:ud,S:$p,u:tl,U:Jh,V:kc,w:Ad,W:Jp,x:null,X:null,y:Df,Y:ih,Z:oh,"%":kp},cn={a:Gg,A:Hg,b:Wg,B:Xg,c:null,d:Ip,e:Ip,f:Op,g:wh,G:ep,H:Qp,I:qp,j:ed,L:Qh,m:Qc,M:td,p:Yg,q:Kg,Q:sd,s:ud,S:Lp,u:Rp,U:rd,V:nd,w:id,W:Dp,x:null,X:null,y:ad,Y:od,Z:Td,"%":kp},In={a:ba,A:pi,b:Ia,B:to,c:Cu,d:jl,e:jl,f:Dc,g:Xh,G:wp,H:Jc,I:Jc,j:wd,L:Yh,m:qo,M:Ap,p:Ki,q:bh,Q:Sh,s:$h,S:Hp,u:rh,U:Ep,V:Gp,w:xh,W:Cp,x:np,X:ip,y:Xh,Y:wp,Z:Cd,"%":Kh};hn.x=oi(a,hn),hn.X=oi(s,hn),hn.c=oi(c,hn),cn.x=oi(a,cn),cn.X=oi(s,cn),cn.c=oi(c,cn);function oi(Mi,ro){return function(bo){var Gn=[],Vl=-1,ps=0,dc=Mi.length,vc,Th,ym;for(bo instanceof Date||(bo=new Date(+bo));++Vl<dc;)Mi.charCodeAt(Vl)===37&&(Gn.push(Mi.slice(ps,Vl)),(Th=qf[vc=Mi.charAt(++Vl)])!=null?vc=Mi.charAt(++Vl):Th=vc==="e"?" ":"0",(ym=ro[vc])&&(vc=ym(bo,Th)),Gn.push(vc),ps=Vl+1);return Gn.push(Mi.slice(ps,Vl)),Gn.join("")}}function vn(Mi,ro){return function(bo){var Gn=yf(1900,void 0,1),Vl=mi(Gn,Mi,bo+="",0),ps,dc;if(Vl!=bo.length)return null;if("Q"in Gn)return new Date(Gn.Q);if("s"in Gn)return new Date(Gn.s*1e3+("L"in Gn?Gn.L:0));if(ro&&!("Z"in Gn)&&(Gn.Z=0),"p"in Gn&&(Gn.H=Gn.H%12+Gn.p*12),Gn.m===void 0&&(Gn.m="q"in Gn?Gn.q:0),"V"in Gn){if(Gn.V<1||Gn.V>53)return null;"w"in Gn||(Gn.w=1),"Z"in Gn?(ps=Rf(yf(Gn.y,0,1)),dc=ps.getUTCDay(),ps=dc>4||dc===0?yl.ceil(ps):yl(ps),ps=If.offset(ps,(Gn.V-1)*7),Gn.y=ps.getUTCFullYear(),Gn.m=ps.getUTCMonth(),Gn.d=ps.getUTCDate()+(Gn.w+6)%7):(ps=Lf(yf(Gn.y,0,1)),dc=ps.getDay(),ps=dc>4||dc===0?ji.ceil(ps):ji(ps),ps=Bo.offset(ps,(Gn.V-1)*7),Gn.y=ps.getFullYear(),Gn.m=ps.getMonth(),Gn.d=ps.getDate()+(Gn.w+6)%7)}else("W"in Gn||"U"in Gn)&&("w"in Gn||(Gn.w="u"in Gn?Gn.u%7:"W"in Gn?1:0),dc="Z"in Gn?Rf(yf(Gn.y,0,1)).getUTCDay():Lf(yf(Gn.y,0,1)).getDay(),Gn.m=0,Gn.d="W"in Gn?(Gn.w+6)%7+Gn.W*7-(dc+5)%7:Gn.w+Gn.U*7-(dc+6)%7);return"Z"in Gn?(Gn.H+=Gn.Z/100|0,Gn.M+=Gn.Z%100,Rf(Gn)):Lf(Gn)}}function mi(Mi,ro,bo,Gn){for(var Vl=0,ps=ro.length,dc=bo.length,vc,Th;Vl<ps;){if(Gn>=dc)return-1;if(vc=ro.charCodeAt(Vl++),vc===37){if(vc=ro.charAt(Vl++),Th=In[vc in qf?ro.charAt(Vl++):vc],!Th||(Gn=Th(Mi,bo,Gn))<0)return-1}else if(vc!=bo.charCodeAt(Gn++))return-1}return Gn}function Ki(Mi,ro,bo){var Gn=R.exec(ro.slice(bo));return Gn?(Mi.p=ee[Gn[0].toLowerCase()],bo+Gn[0].length):-1}function ba(Mi,ro,bo){var Gn=Be.exec(ro.slice(bo));return Gn?(Mi.w=lt[Gn[0].toLowerCase()],bo+Gn[0].length):-1}function pi(Mi,ro,bo){var Gn=X.exec(ro.slice(bo));return Gn?(Mi.w=ve[Gn[0].toLowerCase()],bo+Gn[0].length):-1}function Ia(Mi,ro,bo){var Gn=xr.exec(ro.slice(bo));return Gn?(Mi.m=kr[Gn[0].toLowerCase()],bo+Gn[0].length):-1}function to(Mi,ro,bo){var Gn=Mt.exec(ro.slice(bo));return Gn?(Mi.m=pr[Gn[0].toLowerCase()],bo+Gn[0].length):-1}function Cu(Mi,ro,bo){return mi(Mi,c,ro,bo)}function np(Mi,ro,bo){return mi(Mi,a,ro,bo)}function ip(Mi,ro,bo){return mi(Mi,s,ro,bo)}function ap(Mi){return _[Mi.getDay()]}function op(Mi){return d[Mi.getDay()]}function rf(Mi){return I[Mi.getMonth()]}function Zg(Mi){return T[Mi.getMonth()]}function jg(Mi){return l[+(Mi.getHours()>=12)]}function Vg(Mi){return 1+~~(Mi.getMonth()/3)}function Gg(Mi){return _[Mi.getUTCDay()]}function Hg(Mi){return d[Mi.getUTCDay()]}function Wg(Mi){return I[Mi.getUTCMonth()]}function Xg(Mi){return T[Mi.getUTCMonth()]}function Yg(Mi){return l[+(Mi.getUTCHours()>=12)]}function Kg(Mi){return 1+~~(Mi.getUTCMonth()/3)}return{format:function(Mi){var ro=oi(Mi+="",hn);return ro.toString=function(){return Mi},ro},parse:function(Mi){var ro=vn(Mi+="",!1);return ro.toString=function(){return Mi},ro},utcFormat:function(Mi){var ro=oi(Mi+="",cn);return ro.toString=function(){return Mi},ro},utcParse:function(Mi){var ro=vn(Mi+="",!0);return ro.toString=function(){return Mi},ro}}}var qf={"-":"",_:" ","0":"0"},xs=/^\s*\d+/,Wh=/^%/,eh=/[\\^$*+?|[\]().{}]/g;function Ha(i,c,a){var s=i<0?"-":"",l=(s?-i:i)+"",d=l.length;return s+(d<a?new Array(a-d+1).join(c)+l:l)}function th(i){return i.replace(eh,"\\$&")}function $c(i){return new RegExp("^(?:"+i.map(th).join("|")+")","i")}function pc(i){for(var c={},a=-1,s=i.length;++a<s;)c[i[a].toLowerCase()]=a;return c}function xh(i,c,a){var s=xs.exec(c.slice(a,a+1));return s?(i.w=+s[0],a+s[0].length):-1}function rh(i,c,a){var s=xs.exec(c.slice(a,a+1));return s?(i.u=+s[0],a+s[0].length):-1}function Ep(i,c,a){var s=xs.exec(c.slice(a,a+2));return s?(i.U=+s[0],a+s[0].length):-1}function Gp(i,c,a){var s=xs.exec(c.slice(a,a+2));return s?(i.V=+s[0],a+s[0].length):-1}function Cp(i,c,a){var s=xs.exec(c.slice(a,a+2));return s?(i.W=+s[0],a+s[0].length):-1}function wp(i,c,a){var s=xs.exec(c.slice(a,a+4));return s?(i.y=+s[0],a+s[0].length):-1}function Xh(i,c,a){var s=xs.exec(c.slice(a,a+2));return s?(i.y=+s[0]+(+s[0]>68?1900:2e3),a+s[0].length):-1}function Cd(i,c,a){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(c.slice(a,a+6));return s?(i.Z=s[1]?0:-(s[2]+(s[3]||"00")),a+s[0].length):-1}function bh(i,c,a){var s=xs.exec(c.slice(a,a+1));return s?(i.q=s[0]*3-3,a+s[0].length):-1}function qo(i,c,a){var s=xs.exec(c.slice(a,a+2));return s?(i.m=s[0]-1,a+s[0].length):-1}function jl(i,c,a){var s=xs.exec(c.slice(a,a+2));return s?(i.d=+s[0],a+s[0].length):-1}function wd(i,c,a){var s=xs.exec(c.slice(a,a+3));return s?(i.m=0,i.d=+s[0],a+s[0].length):-1}function Jc(i,c,a){var s=xs.exec(c.slice(a,a+2));return s?(i.H=+s[0],a+s[0].length):-1}function Ap(i,c,a){var s=xs.exec(c.slice(a,a+2));return s?(i.M=+s[0],a+s[0].length):-1}function Hp(i,c,a){var s=xs.exec(c.slice(a,a+2));return s?(i.S=+s[0],a+s[0].length):-1}function Yh(i,c,a){var s=xs.exec(c.slice(a,a+3));return s?(i.L=+s[0],a+s[0].length):-1}function Dc(i,c,a){var s=xs.exec(c.slice(a,a+6));return s?(i.L=Math.floor(s[0]/1e3),a+s[0].length):-1}function Kh(i,c,a){var s=Wh.exec(c.slice(a,a+1));return s?a+s[0].length:-1}function Sh(i,c,a){var s=xs.exec(c.slice(a));return s?(i.Q=+s[0],a+s[0].length):-1}function $h(i,c,a){var s=xs.exec(c.slice(a));return s?(i.s=+s[0],a+s[0].length):-1}function Eh(i,c){return Ha(i.getDate(),c,2)}function Tp(i,c){return Ha(i.getHours(),c,2)}function Wp(i,c){return Ha(i.getHours()%12||12,c,2)}function Ch(i,c){return Ha(1+Bo.count(fr(i),i),c,3)}function Pp(i,c){return Ha(i.getMilliseconds(),c,3)}function Xp(i,c){return Pp(i,c)+"000"}function Yp(i,c){return Ha(i.getMonth()+1,c,2)}function Kp(i,c){return Ha(i.getMinutes(),c,2)}function $p(i,c){return Ha(i.getSeconds(),c,2)}function tl(i){var c=i.getDay();return c===0?7:c}function Jh(i,c){return Ha(ca.count(fr(i)-1,i),c,2)}function Mp(i){var c=i.getDay();return c>=4||c===0?xa(i):xa.ceil(i)}function kc(i,c){return i=Mp(i),Ha(xa.count(fr(i),i)+(fr(i).getDay()===4),c,2)}function Ad(i){return i.getDay()}function Jp(i,c){return Ha(ji.count(fr(i)-1,i),c,2)}function Df(i,c){return Ha(i.getFullYear()%100,c,2)}function nh(i,c){return i=Mp(i),Ha(i.getFullYear()%100,c,2)}function ih(i,c){return Ha(i.getFullYear()%1e4,c,4)}function ah(i,c){var a=i.getDay();return i=a>=4||a===0?xa(i):xa.ceil(i),Ha(i.getFullYear()%1e4,c,4)}function oh(i){var c=i.getTimezoneOffset();return(c>0?"-":(c*=-1,"+"))+Ha(c/60|0,"0",2)+Ha(c%60,"0",2)}function Ip(i,c){return Ha(i.getUTCDate(),c,2)}function Qp(i,c){return Ha(i.getUTCHours(),c,2)}function qp(i,c){return Ha(i.getUTCHours()%12||12,c,2)}function ed(i,c){return Ha(1+If.count(gf(i),i),c,3)}function Qh(i,c){return Ha(i.getUTCMilliseconds(),c,3)}function Op(i,c){return Qh(i,c)+"000"}function Qc(i,c){return Ha(i.getUTCMonth()+1,c,2)}function td(i,c){return Ha(i.getUTCMinutes(),c,2)}function Lp(i,c){return Ha(i.getUTCSeconds(),c,2)}function Rp(i){var c=i.getUTCDay();return c===0?7:c}function rd(i,c){return Ha(Yo.count(gf(i)-1,i),c,2)}function qh(i){var c=i.getUTCDay();return c>=4||c===0?Zl(i):Zl.ceil(i)}function nd(i,c){return i=qh(i),Ha(Zl.count(gf(i),i)+(gf(i).getUTCDay()===4),c,2)}function id(i){return i.getUTCDay()}function Dp(i,c){return Ha(yl.count(gf(i)-1,i),c,2)}function ad(i,c){return Ha(i.getUTCFullYear()%100,c,2)}function wh(i,c){return i=qh(i),Ha(i.getUTCFullYear()%100,c,2)}function od(i,c){return Ha(i.getUTCFullYear()%1e4,c,4)}function ep(i,c){var a=i.getUTCDay();return i=a>=4||a===0?Zl(i):Zl.ceil(i),Ha(i.getUTCFullYear()%1e4,c,4)}function Td(){return"+0000"}function kp(){return"%"}function sd(i){return+i}function ud(i){return Math.floor(+i/1e3)}var sh,ld,Pd,Md,Id;Od({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Od(i){return sh=_h(i),ld=sh.format,Pd=sh.parse,Md=sh.utcFormat,Id=sh.utcParse,sh}var rl=1e3,_f=rl*60,uh=_f*60,qc=uh*24,cd=qc*7,Zd=qc*30,Ld=qc*365;function _m(i){return new Date(i)}function xm(i){return i instanceof Date?+i:+new Date(+i)}function jd(i,c,a,s,l,d,_,T,I){var R=Mn(Qe,Qe),ee=R.invert,X=R.domain,ve=I(".%L"),Be=I(":%S"),lt=I("%I:%M"),Mt=I("%I %p"),pr=I("%a %d"),xr=I("%b %d"),kr=I("%B"),hn=I("%Y"),cn=[[_,1,rl],[_,5,5*rl],[_,15,15*rl],[_,30,30*rl],[d,1,_f],[d,5,5*_f],[d,15,15*_f],[d,30,30*_f],[l,1,uh],[l,3,3*uh],[l,6,6*uh],[l,12,12*uh],[s,1,qc],[s,2,2*qc],[a,1,cd],[c,1,Zd],[c,3,3*Zd],[i,1,Ld]];function In(vn){return(_(vn)<vn?ve:d(vn)<vn?Be:l(vn)<vn?lt:s(vn)<vn?Mt:c(vn)<vn?a(vn)<vn?pr:xr:i(vn)<vn?kr:hn)(vn)}function oi(vn,mi,Ki,ba){if(vn==null&&(vn=10),typeof vn=="number"){var pi=Math.abs(Ki-mi)/vn,Ia=ui(function(to){return to[2]}).right(cn,pi);Ia===cn.length?(ba=yo(mi/Ld,Ki/Ld,vn),vn=i):Ia?(Ia=cn[pi/cn[Ia-1][2]<cn[Ia][2]/pi?Ia-1:Ia],ba=Ia[1],vn=Ia[0]):(ba=Math.max(yo(mi,Ki,vn),1),vn=T)}return ba==null?vn:vn.every(ba)}return R.invert=function(vn){return new Date(ee(vn))},R.domain=function(vn){return arguments.length?X(bu.call(vn,xm)):X().map(_m)},R.ticks=function(vn,mi){var Ki=X(),ba=Ki[0],pi=Ki[Ki.length-1],Ia=pi<ba,to;return Ia&&(to=ba,ba=pi,pi=to),to=oi(vn,ba,pi,mi),to=to?to.range(ba,pi+1):[],Ia?to.reverse():to},R.tickFormat=function(vn,mi){return mi==null?In:I(mi)},R.nice=function(vn,mi){var Ki=X();return(vn=oi(vn,Ki[0],Ki[Ki.length-1],mi))?X(Lc(Ki,vn)):R},R.copy=function(){return un(R,jd(i,c,a,s,l,d,_,T,I))},R}function bm(){return er.apply(jd(fr,_n,ca,Bo,ao,lu,hs,Rc,ld).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function $g(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function fd(){var i=0,c=1,a,s,l,d,_=identity,T=!1,I;function R(ee){return isNaN(ee=+ee)?I:_(l===0?.5:(ee=(d(ee)-a)*l,T?Math.max(0,Math.min(1,ee)):ee))}return R.domain=function(ee){return arguments.length?(a=d(i=+ee[0]),s=d(c=+ee[1]),l=a===s?0:1/(s-a),R):[i,c]},R.clamp=function(ee){return arguments.length?(T=!!ee,R):T},R.interpolator=function(ee){return arguments.length?(_=ee,R):_},R.unknown=function(ee){return arguments.length?(I=ee,R):I},function(ee){return d=ee,a=ee(i),s=ee(c),l=a===s?0:1/(s-a),R}}function hd(i,c){return c.domain(i.domain()).interpolator(i.interpolator()).clamp(i.clamp()).unknown(i.unknown())}function Sm(){var i=linearish(fd()(identity));return i.copy=function(){return hd(i,Sm())},initInterpolator.apply(i,arguments)}function Em(){var i=loggish(fd()).domain([1,10]);return i.copy=function(){return hd(i,Em()).base(i.base())},initInterpolator.apply(i,arguments)}function Cm(){var i=symlogish(fd());return i.copy=function(){return hd(i,Cm()).constant(i.constant())},initInterpolator.apply(i,arguments)}function Vd(){var i=powish(fd());return i.copy=function(){return hd(i,Vd()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function Jg(){return Vd.apply(null,arguments).exponent(.5)}function wm(){var i=[],c=identity;function a(s){if(!isNaN(s=+s))return c((bisect(i,s)-1)/(i.length-1))}return a.domain=function(s){if(!arguments.length)return i.slice();i=[];for(var l=0,d=s.length,_;l<d;++l)_=s[l],_!=null&&!isNaN(_=+_)&&i.push(_);return i.sort(ascending),a},a.interpolator=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return wm(c).domain(i)},initInterpolator.apply(a,arguments)}function pd(){var i=0,c=.5,a=1,s,l,d,_,T,I=identity,R,ee=!1,X;function ve(Be){return isNaN(Be=+Be)?X:(Be=.5+((Be=+R(Be))-l)*(Be<l?_:T),I(ee?Math.max(0,Math.min(1,Be)):Be))}return ve.domain=function(Be){return arguments.length?(s=R(i=+Be[0]),l=R(c=+Be[1]),d=R(a=+Be[2]),_=s===l?0:.5/(l-s),T=l===d?0:.5/(d-l),ve):[i,c,a]},ve.clamp=function(Be){return arguments.length?(ee=!!Be,ve):ee},ve.interpolator=function(Be){return arguments.length?(I=Be,ve):I},ve.unknown=function(Be){return arguments.length?(X=Be,ve):X},function(Be){return R=Be,s=Be(i),l=Be(c),d=Be(a),_=s===l?0:.5/(l-s),T=l===d?0:.5/(d-l),ve}}function Am(){var i=linearish(pd()(identity));return i.copy=function(){return copy(i,Am())},initInterpolator.apply(i,arguments)}function Tm(){var i=loggish(pd()).domain([.1,1,10]);return i.copy=function(){return copy(i,Tm()).base(i.base())},initInterpolator.apply(i,arguments)}function Pm(){var i=symlogish(pd());return i.copy=function(){return copy(i,Pm()).constant(i.constant())},initInterpolator.apply(i,arguments)}function Gd(){var i=powish(pd());return i.copy=function(){return copy(i,Gd()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function Qg(){return Gd.apply(null,arguments).exponent(.5)}var ef,Hd,Wd,Xd,Rd,Yd,Mm=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Im=(ef={},(0,L.Z)(ef,w.vY.LINEAR,Gh),(0,L.Z)(ef,w.vY.POWER,fe),(0,L.Z)(ef,w.vY.LOG,f),(0,L.Z)(ef,w.vY.IDENTITY,Mf),(0,L.Z)(ef,w.vY.TIME,bm),(0,L.Z)(ef,w.vY.QUANTILE,Ve),(0,L.Z)(ef,w.vY.QUANTIZE,We),(0,L.Z)(ef,w.vY.THRESHOLD,ht),(0,L.Z)(ef,w.vY.CAT,oa),ef),Om=(Hd=(0,Ct.b2)(),Wd=(0,Ct.f3)(w.vK.IGlobalConfigService),Hd(Xd=(Rd=function(){function i(){(0,K.Z)(this,i),(0,Fi.Z)(this,"configService",Yd,this),(0,L.Z)(this,"scaleCache",{}),(0,L.Z)(this,"scaleOptions",{})}return(0,W.Z)(i,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=d.getLayerStyleAttributes(),T=a.getSource().data.dataArray;T.length!==0&&l.caculateScalesForAttributes(_||[],T)}),a.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=d.getLayerStyleAttributes(),T=a.getSource().data.dataArray;return l.caculateScalesForAttributes(_||[],T),a.layerModelNeedUpdate=!0,!0}),a.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!a.layerModelNeedUpdate){l.scaleOptions=a.getScaleOptions();var _=d.getLayerStyleAttributes();if(_){var T=a.getSource().data.dataArray;if(T.length===0)return;var I=_.filter(function(R){return R.needRescale});I.length&&l.caculateScalesForAttributes(I,T)}}})}},{key:"isNumber",value:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}},{key:"caculateScalesForAttributes",value:function(a,s){var l=this;this.scaleCache={},a.forEach(function(d){if(d.scale){var _=d.scale,T=d.name;_.names=l.parseFields(d.scale.field||[]);var I=[];_.names.forEach(function(R){I.push(l.getOrCreateScale(R,d,s))}),I.some(function(R){return R.type===w.ee.VARIABLE})?(_.type=w.ee.VARIABLE,I.forEach(function(R){if(!_.callback){var ee;if(_.values&&_.values!=="text"){var X;if(((X=R.option)===null||X===void 0?void 0:X.type)==="linear"&&_.values.length>2){var ve=R.scale.ticks(_.values.length);T==="color"&&R.scale.domain(ve)}R.scale.range(_.values)}else((ee=R.option)===null||ee===void 0?void 0:ee.type)==="cat"&&R.scale.range(R.option.domain)}})):(_.type=w.ee.CONSTANT,_.defaultValues=I.map(function(R,ee){return R.scale(_.names[ee])})),_.scalers=I.map(function(R){return{field:R.field,func:R.scale,option:R.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(a,s,l){var d,_=[a,s.name].join("_"),T=(d=s.scale)===null||d===void 0?void 0:d.values,I=this.createScale(a,s.name,T,l);return I}},{key:"parseFields",value:function(a){return Array.isArray(a)?a:ka()(a)?a.split("*"):[a]}},{key:"createScale",value:function(a,s,l,d){var _,T,I=this.scaleOptions[s]&&((_=this.scaleOptions[s])===null||_===void 0?void 0:_.field)===a?this.scaleOptions[s]:this.scaleOptions[a],R={field:a,scale:void 0,type:w.ee.VARIABLE,option:I};if(!d||!d.length)return I&&I.type?R.scale=this.createDefaultScale(I):(R.scale=oa([a]),R.type=w.ee.CONSTANT),R;var ee=(T=d.find(function(Be){return!bn()(Be[a])}))===null||T===void 0?void 0:T[a];if(this.isNumber(a)||bn()(ee)&&!I)R.scale=oa([a]),R.type=w.ee.CONSTANT;else{var X=I&&I.type||this.getDefaultType(ee);l==="text"&&(X=w.vY.CAT);var ve=this.createDefaultScaleConfig(X,a,d);Object.assign(ve,I),R.scale=this.createDefaultScale(ve),R.option=ve}return R}},{key:"getDefaultType",value:function(a){var s=w.vY.LINEAR;return typeof a=="string"&&(s=Mm.test(a)?w.vY.TIME:w.vY.CAT),s}},{key:"createDefaultScaleConfig",value:function(a,s,l){var d={type:a},_=(l==null?void 0:l.map(function(T){return T[s]}))||[];return a!==w.vY.CAT&&a!==w.vY.QUANTILE?d.domain=An(_):a===w.vY.CAT?d.domain=On()(_):a===w.vY.QUANTILE&&(d.domain=_),d}},{key:"createDefaultScale",value:function(a){var s=a.type,l=a.domain,d=Im[s]();return l&&d.domain(l),d}}]),i}(),Yd=(0,ni.Z)(Rd.prototype,"configService",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd))||Xd),Kd,$d,Jd,Qd,dd,qd,ev;function tv(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function Lm(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?tv(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):tv(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}var Rm=(Kd=(0,Ct.b2)(),$d=(0,Ct.f3)(w.vK.ICameraService),Jd=(0,Ct.f3)(w.vK.IRendererService),Kd(Qd=(dd=function(){function i(){(0,K.Z)(this,i),(0,Fi.Z)(this,"cameraService",qd,this),(0,Fi.Z)(this,"rendererService",ev,this)}return(0,W.Z)(i,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){a.models.forEach(function(s){s.addUniforms(Lm({},a.layerModel.getAnimateUniforms()))})})}}]),i}(),qd=(0,ni.Z)(dd.prototype,"cameraService",[$d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ev=(0,ni.Z)(dd.prototype,"rendererService",[Jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dd))||Qd),rv,nv,Dm=(rv=(0,Ct.b2)(),rv(nv=function(){function i(){(0,K.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(a){a.hooks.init.tap("LayerModelPlugin",function(){a.prepareBuildModel(),a.buildModels(),a.styleNeedUpdate=!1}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return a.prepareBuildModel(),a.clearModels(),a.buildModels(),a.layerModelNeedUpdate=!1,!1})}}]),i}())||nv),iv,av,km=(iv=(0,Ct.b2)(),iv(av=function(){function i(){(0,K.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(a){a.hooks.afterInit.tap("LayerStylePlugin",function(){a.updateLayerConfig({});var s=a.getLayerConfig(),l=s.autoFit,d=s.fitBoundsOptions;l&&setTimeout(function(){a.fitBounds(d)},100)})}}]),i}())||av),ov,sv;function uv(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function Fp(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?uv(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):uv(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}var lv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Fm={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Bm={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Nm={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},qg=null;function zm(i){var c={u_DirectionalLights:new Array(3).fill(Fp({},Bm)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Fp({},Nm)),u_NumOfSpotLights:0};return(!i||!i.length)&&(i=[Fm]),i.forEach(function(a,s){var l=a.type,d=l===void 0?"directional":l,_=(0,sa.Z)(a,["type"]),T=lv[d].lights,I=lv[d].num,R=c[I];c[T][R]=Fp(Fp({},c[T][R]),_),c[I]++}),c}var Um=(ov=(0,Ct.b2)(),ov(sv=function(){function i(){(0,K.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LightingPlugin",function(){var s=a.getLayerConfig(),l=s.enableLighting;l&&a.models.forEach(function(d){return d.addUniforms(Fp({},zm()))})})}}]),i}())||sv),cv,fv,vd={NONE:0,ENCODE:1,HIGHLIGHT:2},Zm=(cv=(0,Ct.b2)(),cv(fv=function(){function i(){(0,K.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(a,s){var l=s.rendererService,d=s.styleAttributeService;a.hooks.init.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),T=_.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:w.GC.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:w.gl.FLOAT},size:3,update:function(R,ee){var X=R.id;return T?(0,rt.Z6)(X):[0,0,0]}}})}),a.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),T=_.enablePicking;T&&a.isVisible()&&a.models.forEach(function(I){return I.addUniforms({u_PickingStage:vd.ENCODE})})}),a.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),T=_.enablePicking;T&&a.isVisible()&&a.models.forEach(function(I){return I.addUniforms({u_PickingStage:vd.HIGHLIGHT})})}),a.hooks.beforeHighlight.tap("PixelPickingPlugin",function(_){var T=a.getLayerConfig(),I=T.highlightColor,R=typeof I=="string"?(0,rt.CI)(I):I||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,rt.W0)(new Uint8Array(_))}),a.models.forEach(function(ee){return ee.addUniforms({u_PickingStage:vd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:R.map(function(X){return X*255})})})}),a.hooks.beforeSelect.tap("PixelPickingPlugin",function(_){var T=a.getLayerConfig(),I=T.selectColor,R=typeof I=="string"?(0,rt.CI)(I):I||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,rt.W0)(new Uint8Array(_))}),a.models.forEach(function(ee){return ee.addUniforms({u_PickingStage:vd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:R.map(function(X){return X*255})})})})}}]),i}())||fv),hv,pv,jm=(hv=(0,Ct.b2)(),hv(pv=function(){function i(){(0,K.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(a){a.registerStyleAttribute({name:"position",type:w.GC.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:w.gl.FLOAT},size:3,update:function(l,d,_){return _.length===2?[_[0],_[1],0]:[_[0],_[1],_[2]]}}}),a.registerStyleAttribute({name:"filter",type:w.GC.Attribute,descriptor:{name:"filter",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(l,d){var _=l.filter;return _?[1]:[0]}}}),a.registerStyleAttribute({name:"color",type:w.GC.Attribute,descriptor:{name:"a_Color",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(l,d){var _=l.color;return!_||!_.length?[1,1,1,1]:_}}}),a.registerStyleAttribute({name:"vertexId",type:w.GC.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(l,d,_,T){return[d]}}})}}]),i}())||pv),dv,vv,mv,gv,yv,_v,tp,xv,bv,Sv,Ev,Vm=(dv=(0,Ct.b2)(),vv=(0,Ct.f3)(w.vK.ICameraService),mv=(0,Ct.f3)(w.vK.ICoordinateSystemService),gv=(0,Ct.f3)(w.vK.IRendererService),yv=(0,Ct.f3)(w.vK.IMapService),dv(_v=(tp=function(){function i(){(0,K.Z)(this,i),(0,Fi.Z)(this,"cameraService",xv,this),(0,Fi.Z)(this,"coordinateSystemService",bv,this),(0,Fi.Z)(this,"rendererService",Sv,this),(0,Fi.Z)(this,"mapService",Ev,this)}return(0,W.Z)(i,[{key:"apply",value:function(a){var s=this,l=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_=[0,0];a.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(d=s.mapService.map.customCoords.getMVPMatrix(),_=s.mapService.getCustomCoordCenter());var T=s.rendererService.getViewportSize(),I=T.width,R=T.height;a.models.forEach(function(ee){var X;ee.addUniforms((X={},(0,L.Z)(X,w.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,L.Z)(X,w.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,L.Z)(X,w.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,L.Z)(X,w.CameraUniform.Zoom,s.cameraService.getZoom()),(0,L.Z)(X,w.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,L.Z)(X,w.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,L.Z)(X,w.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,L.Z)(X,w.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,L.Z)(X,w.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,L.Z)(X,w.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,L.Z)(X,w.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,L.Z)(X,w.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,L.Z)(X,w.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,L.Z)(X,w.CoordinateUniform.Mvp,d),(0,L.Z)(X,"u_SceneCenterMKT",_),(0,L.Z)(X,"u_ViewportSize",[I,R]),(0,L.Z)(X,"u_DevicePixelRatio",window.devicePixelRatio),(0,L.Z)(X,"u_ModelMatrix",s.cameraService.getModelMatrix()),(0,L.Z)(X,"u_PickingBuffer",a.getLayerConfig().pickingBuffer||0),X))})})}}]),i}(),xv=(0,ni.Z)(tp.prototype,"cameraService",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bv=(0,ni.Z)(tp.prototype,"coordinateSystemService",[mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sv=(0,ni.Z)(tp.prototype,"rendererService",[gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ev=(0,ni.Z)(tp.prototype,"mapService",[yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tp))||_v),Cv,wv,Gm=(Cv=(0,Ct.b2)(),Cv(wv=function(){function i(){(0,K.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("UpdateModelPlugin",function(){a.layerModel&&a.layerModel.needUpdate()})}}]),i}())||wv),Av,Tv,Hm=(Av=(0,Ct.b2)(),Av(Tv=function(){function i(){(0,K.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(a,{styleAttributeService:d})}),a.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){a.layerModelNeedUpdate||l.updateStyleAtrribute(a,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(a,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[],_=l.getLayerStyleAttribute("filter"),T=l.getLayerStyleAttribute("shape");if(_&&_.needRegenerateVertices||T&&T.needRegenerateVertices){a.layerModelNeedUpdate=!0,d.forEach(function(I){return I.needRegenerateVertices=!1});return}d.filter(function(I){return I.needRegenerateVertices}).forEach(function(I){l.updateAttributeByFeatureRange(I.name,a.getEncodedData(),I.featureRange.startIndex,I.featureRange.endIndex),I.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(a,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[];d.filter(function(_){return _.needRegenerateVertices}).forEach(function(_){l.updateAttributeByFeatureRange(_.name,a.getEncodedData(),_.featureRange.startIndex,_.featureRange.endIndex),_.needRegenerateVertices=!1})}}]),i}())||Tv);w.nC.bind(w.vK.ILayerPlugin).to(vr).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(jm).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Om).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Qu).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(km).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Hm).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Gm).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Wa).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Vm).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Rm).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Um).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Zm).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Dm).inRequestScope();var ey="2.5.27";function Pv(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function ty(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Pv(Object(a),!0).forEach(function(s){Wm(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Pv(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function Wm(i,c,a){return c in i?Object.defineProperty(i,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[c]=a,i}function ry(i,c){return $m(i)||Km(i,c)||Ym(i,c)||Xm()}function Xm(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ym(i,c){if(!!i){if(typeof i=="string")return Mv(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Mv(i,c)}}function Mv(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}function Km(i,c){var a=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(i);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function $m(i){if(Array.isArray(i))return i}var ny=null,iy=null,Iv,Dd,Ov;function Lv(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function Rv(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Lv(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Lv(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}var Jm=(Iv=(0,w.yT)(w.vK.IGlobalConfigService),Dd=function(){function i(c){(0,K.Z)(this,i),(0,Fi.Z)(this,"configService",Ov,this),(0,L.Z)(this,"config",void 0),this.config=c}return(0,W.Z)(i,[{key:"setContainer",value:function(a,s){a.bind(w.vK.MapConfig).toConstantValue(Rv(Rv({},this.config),{},{id:s})),a.bind(w.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),i}(),Ov=(0,ni.Z)(Dd.prototype,"configService",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dd),Qm=S(97399),qm=S.n(Qm),kd;(function(i){i["GAODE1.x"]="GAODE1.x",i["GAODE2.x"]="GAODE2.x",i.MAPBOX="MAPBOX",i.L7MAP="L7MAP",i.GLOBEL="GLOBEL"})(kd||(kd={}));function Bp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function md(i,c){var a=h.fF([],c,i);return h.bA(a,a,1/a[3]),a}function ay(i,c){var a=i%c;return a<0?c+a:a}function oy(i,c,a){return a*c+(1-a)*i}function Ah(i,c){if(!i)throw new Error(c||"viewport-mercator-project: assertion failed.")}var tf=Math.PI,Dv=tf/4,kf=tf/180,kv=180/tf,Fd=512,Bd=4003e4,e0=1.5;function Fv(i){return Math.pow(2,i)}function t0(i){return Math.log2(i)}function gd(i,c){var a=(0,q.Z)(i,2),s=a[0],l=a[1];Ah(Number.isFinite(s)&&Number.isFinite(c)),Ah(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),c*=Fd;var d=s*kf,_=l*kf,T=c*(d+tf)/(2*tf),I=c*(tf-Math.log(Math.tan(Dv+_*.5)))/(2*tf);return[T,I]}function Nd(i,c){var a=(0,q.Z)(i,2),s=a[0],l=a[1];c*=Fd;var d=s/c*(2*tf)-tf,_=2*(Math.atan(Math.exp(tf-l/c*(2*tf)))-Dv);return[d*kv,_*kv]}function sy(i){var c=i.latitude;assert(Number.isFinite(c));var a=Math.cos(c*kf);return t0(Bd*a)-9}function Bv(i){var c=i.latitude,a=i.longitude,s=i.zoom,l=i.scale,d=i.highPrecision,_=d===void 0?!1:d;l=l!==void 0?l:Fv(s),Ah(Number.isFinite(c)&&Number.isFinite(a)&&Number.isFinite(l));var T={},I=Fd*l,R=Math.cos(c*kf),ee=I/360,X=ee/R,ve=I/Bd/R;if(T.pixelsPerMeter=[ve,-ve,ve],T.metersPerPixel=[1/ve,-1/ve,1/ve],T.pixelsPerDegree=[ee,-X,ve],T.degreesPerPixel=[1/ee,-1/X,1/ve],_){var Be=kf*Math.tan(c*kf)/R,lt=ee*Be/2,Mt=I/Bd*Be,pr=Mt/X*ve;T.pixelsPerDegree2=[0,-lt,Mt],T.pixelsPerMeter2=[pr,0,pr]}return T}function uy(i,c){var a=_slicedToArray(i,3),s=a[0],l=a[1],d=a[2],_=_slicedToArray(c,3),T=_[0],I=_[1],R=_[2],ee=1,X=Bv({longitude:s,latitude:l,scale:ee,highPrecision:!0}),ve=X.pixelsPerMeter,Be=X.pixelsPerMeter2,lt=gd(i,ee);lt[0]+=T*(ve[0]+Be[0]*I),lt[1]+=I*(ve[1]+Be[1]*I);var Mt=Nd(lt,ee),pr=(d||0)+(R||0);return Number.isFinite(d)||Number.isFinite(R)?[Mt[0],Mt[1],pr]:Mt}function r0(i){var c=i.height,a=i.pitch,s=i.bearing,l=i.altitude,d=i.center,_=d===void 0?null:d,T=i.flipY,I=T===void 0?!1:T,R=Bp();return Va.translate(R,R,[0,0,-l]),Va.scale(R,R,[1,1,1/c]),Va.rotateX(R,R,-a*kf),Va.rotateZ(R,R,s*kf),I&&Va.scale(R,R,[1,-1,1]),_&&Va.translate(R,R,wn.negate([],_)),R}function n0(i){var c=i.width,a=i.height,s=i.altitude,l=s===void 0?e0:s,d=i.pitch,_=d===void 0?0:d,T=i.nearZMultiplier,I=T===void 0?1:T,R=i.farZMultiplier,ee=R===void 0?1:R,X=_*kf,ve=Math.atan(.5/l),Be=Math.sin(ve)*l/Math.sin(Math.PI/2-X-ve),lt=Math.cos(Math.PI/2-X)*Be+l;return{fov:2*Math.atan(a/2/l),aspect:c/a,focalDistance:l,near:I,far:lt*ee}}function i0(i){var c=i.width,a=i.height,s=i.pitch,l=i.altitude,d=i.nearZMultiplier,_=i.farZMultiplier,T=n0({width:c,height:a,altitude:l,pitch:s,nearZMultiplier:d,farZMultiplier:_}),I=T.fov,R=T.aspect,ee=T.near,X=T.far,ve=Va.perspective([],I,R,ee,X);return ve}function a0(i,c){var a=(0,q.Z)(i,3),s=a[0],l=a[1],d=a[2],_=d===void 0?0:d;return Ah(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(_)),md(c,[s,l,_,1])}function Nv(i,c){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,q.Z)(i,3),l=s[0],d=s[1],_=s[2];if(Ah(Number.isFinite(l)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(_)){var T=md(c,[l,d,_,1]);return T}var I=md(c,[l,d,0,1]),R=md(c,[l,d,1,1]),ee=I[2],X=R[2],ve=ee===X?0:((a||0)-ee)/(X-ee);return m.lerp([],I,R,ve)}var zv=Bp(),o0=function(){function i(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=c.width,s=c.height,l=c.viewMatrix,d=l===void 0?zv:l,_=c.projectionMatrix,T=_===void 0?zv:_;(0,K.Z)(this,i),this.width=a||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=T;var I=Bp();Va.multiply(I,I,this.projectionMatrix),Va.multiply(I,I,this.viewMatrix),this.viewProjectionMatrix=I;var R=Bp();Va.scale(R,R,[this.width/2,-this.height/2,1]),Va.translate(R,R,[1,-1,0]),Va.multiply(R,R,this.viewProjectionMatrix);var ee=Va.invert(Bp(),R);if(!ee)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=R,this.pixelUnprojectionMatrix=ee,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,W.Z)(i,[{key:"equals",value:function(a){return a instanceof i?a.width===this.width&&a.height===this.height&&Va.equals(a.projectionMatrix,this.projectionMatrix)&&Va.equals(a.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,_=this.projectPosition(a),T=a0(_,this.pixelProjectionMatrix),I=(0,q.Z)(T,2),R=I[0],ee=I[1],X=d?ee:this.height-ee;return a.length===2?[R,X]:[R,X,T[2]]}},{key:"unproject",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,_=s.targetZ,T=(0,q.Z)(a,3),I=T[0],R=T[1],ee=T[2],X=d?R:this.height-R,ve=_&&_*this.pixelsPerMeter,Be=Nv([I,X,ee],this.pixelUnprojectionMatrix,ve),lt=this.unprojectPosition(Be),Mt=(0,q.Z)(lt,3),pr=Mt[0],xr=Mt[1],kr=Mt[2];return Number.isFinite(ee)?[pr,xr,kr]:Number.isFinite(_)?[pr,xr,_]:[pr,xr]}},{key:"projectPosition",value:function(a){var s=this.projectFlat(a),l=(0,q.Z)(s,2),d=l[0],_=l[1],T=(a[2]||0)*this.pixelsPerMeter;return[d,_,T]}},{key:"unprojectPosition",value:function(a){var s=this.unprojectFlat(a),l=(0,q.Z)(s,2),d=l[0],_=l[1],T=(a[2]||0)/this.pixelsPerMeter;return[d,_,T]}},{key:"projectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}},{key:"unprojectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}}]),i}();function s0(i){var c=i.width,a=i.height,s=i.bounds,l=i.minExtent,d=l===void 0?0:l,_=i.maxZoom,T=_===void 0?24:_,I=i.padding,R=I===void 0?0:I,ee=i.offset,X=ee===void 0?[0,0]:ee,ve=(0,q.Z)(s,2),Be=(0,q.Z)(ve[0],2),lt=Be[0],Mt=Be[1],pr=(0,q.Z)(ve[1],2),xr=pr[0],kr=pr[1];if(Number.isFinite(R)){var hn=R;R={top:hn,bottom:hn,left:hn,right:hn}}else Ah(Number.isFinite(R.top)&&Number.isFinite(R.bottom)&&Number.isFinite(R.left)&&Number.isFinite(R.right));var cn=new Uv({width:c,height:a,longitude:0,latitude:0,zoom:0}),In=cn.project([lt,kr]),oi=cn.project([xr,Mt]),vn=[Math.max(Math.abs(oi[0]-In[0]),d),Math.max(Math.abs(oi[1]-In[1]),d)],mi=[c-R.left-R.right-Math.abs(X[0])*2,a-R.top-R.bottom-Math.abs(X[1])*2];Ah(mi[0]>0&&mi[1]>0);var Ki=mi[0]/vn[0],ba=mi[1]/vn[1],pi=(R.right-R.left)/2/Ki,Ia=(R.bottom-R.top)/2/ba,to=[(oi[0]+In[0])/2+pi,(oi[1]+In[1])/2+Ia],Cu=cn.unproject(to),np=cn.zoom+Math.log2(Math.abs(Math.min(Ki,ba)));return{longitude:Cu[0],latitude:Cu[1],zoom:Math.min(np,T)}}var Uv=function(i){(0,Ne.Z)(c,i);function c(){var a,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,d=s.height,_=s.latitude,T=_===void 0?0:_,I=s.longitude,R=I===void 0?0:I,ee=s.zoom,X=ee===void 0?0:ee,ve=s.pitch,Be=ve===void 0?0:ve,lt=s.bearing,Mt=lt===void 0?0:lt,pr=s.altitude,xr=pr===void 0?1.5:pr,kr=s.nearZMultiplier,hn=s.farZMultiplier;(0,K.Z)(this,c),l=l||1,d=d||1;var cn=Fv(X);xr=Math.max(.75,xr);var In=gd([R,T],cn);In[2]=0;var oi=i0({width:l,height:d,pitch:Be,bearing:Mt,altitude:xr,nearZMultiplier:kr||1/d,farZMultiplier:hn||1.01}),vn=r0({height:d,center:In,pitch:Be,bearing:Mt,altitude:xr,flipY:!0});return a=(0,Ye.Z)(this,(0,Je.Z)(c).call(this,{width:l,height:d,viewMatrix:vn,projectionMatrix:oi})),a.latitude=T,a.longitude=R,a.zoom=X,a.pitch=Be,a.bearing=Mt,a.altitude=xr,a.scale=cn,a.center=In,a.pixelsPerMeter=Bv((0,N.Z)((0,N.Z)(a))).pixelsPerMeter[2],Object.freeze((0,N.Z)((0,N.Z)(a))),a}return(0,W.Z)(c,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return gd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Nd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,d=s.pos,_=Nv(d,this.pixelUnprojectionMatrix),T=gd(l,this.scale),I=m.add([],T,m.negate([],_)),R=m.add([],this.center,I);return Nd(R,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,d=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:d})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,_=this.height,T=s0(Object.assign({width:d,height:_,bounds:s},l)),I=T.longitude,R=T.latitude,ee=T.zoom;return new c({width:d,height:_,longitude:I,latitude:R,zoom:ee})}}]),c}(o0),u0=function(){function i(){(0,K.Z)(this,i),(0,L.Z)(this,"viewport",void 0)}return(0,W.Z)(i,[{key:"syncWithMapCamera",value:function(a){var s=a.center,l=a.zoom,d=a.pitch,_=a.bearing,T=a.viewportHeight,I=a.viewportWidth;this.viewport=new Uv({width:I,height:T,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:d,bearing:_})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(a,s){return this.viewport.projectFlat(a,s)}}]),i}(),Zv={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},jv,Vv,Gv,Hv,Wv,Xv,rp,Yv,Kv,$v,Jv;function Qv(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function l0(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Qv(Object(a),!0).forEach(function(s){(0,L.Z)(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Qv(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function c0(i,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=i:l.appendChild(c.createTextNode(i)),a.appendChild(l),l}}c0(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=qm();var qv={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},f0=0,h0=12,em="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",p0=(jv=(0,Ct.b2)(),Vv=(0,Ct.f3)(w.vK.MapConfig),Gv=(0,Ct.f3)(w.vK.IGlobalConfigService),Hv=(0,Ct.f3)(w.vK.ICoordinateSystemService),Wv=(0,Ct.f3)(w.vK.IEventEmitter),jv(Xv=(rp=function(){function i(){var c=this;(0,K.Z)(this,i),(0,L.Z)(this,"version",kd.MAPBOX),(0,L.Z)(this,"map",void 0),(0,Fi.Z)(this,"config",Yv,this),(0,Fi.Z)(this,"configService",Kv,this),(0,Fi.Z)(this,"coordinateSystemService",$v,this),(0,Fi.Z)(this,"eventEmitter",Jv,this),(0,L.Z)(this,"viewport",void 0),(0,L.Z)(this,"markerContainer",void 0),(0,L.Z)(this,"cameraChangedCallback",void 0),(0,L.Z)(this,"$mapContainer",void 0),(0,L.Z)(this,"handleCameraChanged",function(){var a=c.map.getCenter().wrap(),s=a.lat,l=a.lng;c.viewport.syncWithMapCamera({bearing:c.map.getBearing(),center:[l,s],viewportHeight:c.map.transform.height,pitch:c.map.getPitch(),viewportWidth:c.map.transform.width,zoom:c.map.getZoom(),cameraHeight:0});var d=c.config.offsetZoom,_=d===void 0?h0:d;c.viewport.getZoom()>_?c.coordinateSystemService.setCoordinateSystem(w.CoordinateSystem.LNGLAT_OFFSET):c.coordinateSystemService.setCoordinateSystem(w.CoordinateSystem.LNGLAT),c.cameraChangedCallback(c.viewport)})}return(0,W.Z)(i,[{key:"addMarkerContainer",value:function(){var a=this.map.getCanvasContainer();this.markerContainer=rt.SO.create("div","l7-marker-container",a),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(a,s){w.MapServiceEvent.indexOf(a)!==-1?this.eventEmitter.on(a,s):this.map.on(qv[a]||a,s)}},{key:"off",value:function(a,s){this.map.off(qv[a]||a,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var a=this.map.transform;return[a.width,a.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(a){return this.map.setZoom(a)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(a){this.map.setCenter(a)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(a){this.map.setBearing(a)}},{key:"zoomIn",value:function(a,s){this.map.zoomIn(a,s)}},{key:"zoomOut",value:function(a,s){this.map.zoomOut(a,s)}},{key:"setPitch",value:function(a){return this.map.setPitch(a)}},{key:"panTo",value:function(a){this.map.panTo(a)}},{key:"panBy",value:function(a){this.panTo(a)}},{key:"fitBounds",value:function(a,s){this.map.fitBounds(a,s)}},{key:"setMaxZoom",value:function(a){this.map.setMaxZoom(a)}},{key:"setMinZoom",value:function(a){this.map.setMinZoom(a)}},{key:"setMapStatus",value:function(a){a.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),a.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),a.dragEnable===!1&&this.map.dragPan.disable(),a.dragEnable===!0&&this.map.dragPan.enable(),a.rotateEnable===!1&&this.map.dragRotate.disable(),a.rotateEnable===!0&&this.map.dragRotate.enable(),a.keyboardEnable===!1&&this.map.keyboard.disable(),a.keyboardEnable===!0&&this.map.keyboard.enable(),a.zoomEnable===!1&&this.map.scrollZoom.disable(),a.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(a,s){this.map.flyTo({zoom:a,center:s})}},{key:"setMapStyle",value:function(a){this.map.setStyle(this.getMapStyle(a))}},{key:"pixelToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToPixel",value:function(a){return this.map.project(a)}},{key:"containerToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToContainer",value:function(a){return this.map.project(a)}},{key:"lngLatToCoord",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},l=this.lngLatToMercator(a,0),d=l.x,_=l.y;return[d-s.x,_-s.y]}},{key:"lngLatToMercator",value:function(a,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),d=l.x,_=d===void 0?0:d,T=l.y,I=T===void 0?0:T,R=l.z,ee=R===void 0?0:R;return{x:_,y:I,z:ee}}},{key:"getModelMatrix",value:function(a,s,l){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},T=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),I=T.meterInMercatorCoordinateUnits(),R=Va.create();return Va.translate(R,R,wn.fromValues(T.x-_.x,T.y-_.y,T.z||0-_.z)),Va.scale(R,R,wn.fromValues(I*d[0],-I*d[1],I*d[2])),Va.rotateX(R,R,l[0]),Va.rotateY(R,R,l[1]),Va.rotateZ(R,R,l[2]),R}},{key:"init",value:function(){var c=(0,qe.Z)(St().mark(function s(){var l,d,_,T,I,R,ee,X,ve,Be,lt,Mt,pr;return St().wrap(function(kr){for(;;)switch(kr.prev=kr.next){case 0:l=this.config,d=l.id,_=d===void 0?"map":d,T=l.attributionControl,I=T===void 0?!1:T,R=l.style,ee=R===void 0?"light":R,X=l.token,ve=X===void 0?em:X,Be=l.rotation,lt=Be===void 0?0:Be,Mt=l.mapInstance,pr=(0,sa.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new u0,!Mt&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),ve===em&&ee!=="blank"&&!window.mapboxgl.accessToken&&!Mt&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Mt&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=ve),Mt?(this.map=Mt,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(_),this.map=new window.mapboxgl.Map(l0({container:this.$mapContainer,style:this.getMapStyle(ee),attributionControl:I,bearing:lt},pr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return kr.stop()}},s,this)}));function a(){return c.apply(this,arguments)}return a}()},{key:"destroy",value:function(){var a,s;(a=this.$mapContainer)===null||a===void 0||(s=a.parentNode)===null||s===void 0||s.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(a){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),_=1;_<l;_++)d[_-1]=arguments[_];(s=this.eventEmitter).emit.apply(s,[a].concat(d))}},{key:"once",value:function(a){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),_=1;_<l;_++)d[_-1]=arguments[_];(s=this.eventEmitter).once.apply(s,[a].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(a){var s=this.map.getCanvas(),l=a==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(a){this.cameraChangedCallback=a}},{key:"creatAmapContainer",value:function(a){var s=a;typeof a=="string"&&(s=document.getElementById(a));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+f0++,s.appendChild(l),l}},{key:"getMapStyle",value:function(a){return typeof a!="string"?a:Zv[a]?Zv[a]:a}}]),i}(),Yv=(0,ni.Z)(rp.prototype,"config",[Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kv=(0,ni.Z)(rp.prototype,"configService",[Gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$v=(0,ni.Z)(rp.prototype,"coordinateSystemService",[Hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jv=(0,ni.Z)(rp.prototype,"eventEmitter",[Wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rp))||Xv);function d0(i){var c=v0();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function v0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function m0(i,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=i:l.appendChild(c.createTextNode(i)),a.appendChild(l),l}}m0(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var g0=function(i){(0,Ne.Z)(a,i);var c=d0(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getServiceConstructor",value:function(){return p0}}]),a}(Jm);function tm(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function rm(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?tm(Object(a),!0).forEach(function(s){y0(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):tm(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function y0(i,c,a){return c in i?Object.defineProperty(i,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[c]=a,i}function _0(i,c){return E0(i)||S0(i,c)||b0(i,c)||x0()}function x0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function b0(i,c){if(!!i){if(typeof i=="string")return nm(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return nm(i,c)}}function nm(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}function S0(i,c){var a=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(i);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function E0(i){if(Array.isArray(i))return i}var C0=ue.memo(function(i){var c=i.style,a=i.className,s=i.map,l=i.option,d=i.onSceneLoaded,_=(0,ue.createRef)(),T=(0,ue.useState)(),I=_0(T,2),R=I[0],ee=I[1];return(0,ue.useEffect)(function(){var X=new wi(rm(rm({id:_.current},l),{},{map:new g0(s)}));return X.on("loaded",function(){ee(X),d&&d(X)}),function(){X.destroy()}},[]),(0,ue.useEffect)(function(){R&&s.style&&R.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,ue.useEffect)(function(){R&&s.zoom&&R.setZoom(s.zoom)},[s.zoom]),(0,ue.useEffect)(function(){R&&s.center&&R.setCenter(s.center)},[JSON.stringify(s.center)]),(0,ue.useEffect)(function(){R&&s.pitch!==void 0&&R.setPitch(s.pitch||0)},[s.pitch]),(0,ue.useEffect)(function(){R&&s.rotation&&R.setRotation(s.rotation)},[s.rotation]),ue.createElement(C.Provider,{value:R},(0,ue.createElement)("div",{ref:_,style:c,className:a},R&&i.children))}),w0=C0;function im(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function ly(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?im(Object(a),!0).forEach(function(s){A0(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):im(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function A0(i,c,a){return c in i?Object.defineProperty(i,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[c]=a,i}function cy(i,c){return I0(i)||M0(i,c)||P0(i,c)||T0()}function T0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P0(i,c){if(!!i){if(typeof i=="string")return am(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return am(i,c)}}function am(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}function M0(i,c){var a=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(i);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function I0(i){if(Array.isArray(i))return i}var fy=null,hy=null;function om(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function py(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?om(Object(a),!0).forEach(function(s){O0(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):om(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function O0(i,c,a){return c in i?Object.defineProperty(i,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[c]=a,i}function dy(i,c){return k0(i)||D0(i,c)||R0(i,c)||L0()}function L0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function R0(i,c){if(!!i){if(typeof i=="string")return sm(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return sm(i,c)}}function sm(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}function D0(i,c){var a=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(i);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function k0(i){if(Array.isArray(i))return i}var vy=null,gy=null;function yy(i,c){return z0(i)||N0(i,c)||B0(i,c)||F0()}function F0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B0(i,c){if(!!i){if(typeof i=="string")return um(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return um(i,c)}}function um(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}function N0(i,c){var a=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(i);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function z0(i){if(Array.isArray(i))return i}var _y=null,xy=null;function lm(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function by(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?lm(Object(a),!0).forEach(function(s){U0(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):lm(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function U0(i,c,a){return c in i?Object.defineProperty(i,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[c]=a,i}function Sy(i,c){if(i==null)return{};var a=Z0(i,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(a[s]=i[s]))}return a}function Z0(i,c){if(i==null)return{};var a={},s=Object.keys(i),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(a[l]=i[l]);return a}var Ey=null,cm=S(5672);function j0(i,c){return W0(i)||H0(i,c)||G0(i,c)||V0()}function V0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function G0(i,c){if(!!i){if(typeof i=="string")return fm(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fm(i,c)}}function fm(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}function H0(i,c){var a=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(i);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function W0(i){if(Array.isArray(i))return i}var X0=ue.useEffect,Y0=ue.useState;function Cy(i){var c=i.className,a=i.style,s=i.children,l=i.position,d=useSceneValue(),_=Y0(function(){return document.createElement("div")}),T=j0(_,1),I=T[0];return X0(function(){var R=new Control({position:l});return R.onAdd=function(){if(c&&(I.className=c),a){var ee=Object.keys(a).map(function(X){return"".concat(X,":").concat(a[X])}).join(";");I.style.cssText=ee}return I},d.addControl(R),function(){d.removeControl(R)}},[]),createPortal(s,I)}var hm=(0,ue.createContext)({});function wy(){return useContext(hm)}var K0=ue.useEffect,$0=ue.memo(function(c){var a=c.layer,s=c.active;return K0(function(){a.active(s.option)},[JSON.stringify(s)]),null}),J0=ue.useEffect,Q0=ue.memo(function(c){var a=c.layer,s=c.animate;return J0(function(){a.animate(s)},[JSON.stringify(s)]),null}),q0=ue.useEffect,eg=ue.memo(function(c){var a=c.layer,s=c.color;return q0(function(){s.field?a.color(s.field,s.values):a.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),tg=ue.useEffect,rg=ue.memo(function(c){var a=c.layer,s=c.filter;return tg(function(){s.field&&a.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),ng=ue.useEffect,ig=ue.memo(function(c){var a=c.layer,s=c.scale;return ng(function(){a.scale(s.values)},[s.values]),null}),ag=ue.useEffect,og=ue.memo(function(c){var a=c.layer,s=c.select;return ag(function(){a.select(s.option)},[JSON.stringify(s)]),null}),sg=ue.useEffect,ug=ue.memo(function(c){var a=c.layer,s=c.shape;return sg(function(){s.field?a.shape(s.field,s.values):a.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),lg=ue.useEffect,cg=ue.memo(function(c){var a=c.layer,s=c.size;return lg(function(){s.field?a.size(s.field,s.values):a.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),fg=["data"];function hg(i,c){if(i==null)return{};var a=pg(i,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(a[s]=i[s]))}return a}function pg(i,c){if(i==null)return{};var a={},s=Object.keys(i),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(a[l]=i[l]);return a}var dg=ue.useEffect,vg=ue.memo(function(c){var a=c.layer,s=c.source,l=s.data,d=hg(s,fg);return dg(function(){a.inited?a.setData(l,d):a.source(l,d),d.autoFit&&a.fitBounds(d&&d.fitBoundsOptions)},[l,JSON.stringify(d)]),null}),mg=ue.useEffect,gg=ue.memo(function(c){var a=c.layer,s=c.style;return mg(function(){a.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function yg(i,c){return Sg(i)||bg(i,c)||xg(i,c)||_g()}function _g(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xg(i,c){if(!!i){if(typeof i=="string")return pm(i,c);var a=Object.prototype.toString.call(i).slice(8,-1);if(a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set")return Array.from(i);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pm(i,c)}}function pm(i,c){(c==null||c>i.length)&&(c=i.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=i[a];return s}function bg(i,c){var a=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,T;try{for(a=a.call(i);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw T}}return s}}function Sg(i){if(Array.isArray(i))return i}var Np=ue.useEffect,Eg=ue.useState;function dm(i,c){var a=c.source,s=c.color,l=c.shape,d=c.style,_=c.size,T=c.scale,I=c.active,R=c.select,ee=c.filter,X=c.animate,ve=c.options,Be=c.onLayerLoaded,lt=p(),Mt=Eg(function(){var kr;switch(i){case"polygonLayer":kr=new si(ve);break;case"lineLayer":kr=new Do(ve);break;case"pointLayer":kr=new zi(ve);break;case"heatmapLayer":kr=new fl(ve);break;case"rasterLayer":kr=new la(ve);break;case"imageLayer":kr=new nc(ve);break;case"citybuildingLayer":kr=new Kl(ve);break;default:kr=new si(ve)}return kr.on("inited",function(){Be&&Be(kr,lt)}),kr}),pr=yg(Mt,1),xr=pr[0];return Np(function(){return lt.addLayer(xr),function(){lt.removeLayer(xr)}},[]),Np(function(){xr.inited&&ve&&xr.updateLayerConfig(ve)},[ve==null?void 0:ve.minZoom,ve==null?void 0:ve.maxZoom,ve==null?void 0:ve.visible]),Np(function(){xr.inited&&(ve==null?void 0:ve.zIndex)&&xr.setIndex(ve.zIndex)},[ve==null?void 0:ve.zIndex]),Np(function(){xr.inited&&(ve==null?void 0:ve.blend)&&xr.setBlend(ve.blend)},[ve==null?void 0:ve.blend]),Np(function(){lt.render()}),ue.createElement(hm.Provider,{value:xr},ue.createElement(vg,{layer:xr,source:a}),T&&ue.createElement(ig,{layer:xr,scale:T}),s&&ue.createElement(eg,{layer:xr,color:s}),_&&ue.createElement(cg,{layer:xr,size:_}),l&&ue.createElement(ug,{layer:xr,shape:l}),d&&ue.createElement(gg,{layer:xr,style:d}),I&&ue.createElement($0,{layer:xr,active:I}),R&&ue.createElement(og,{layer:xr,select:R}),ee&&ue.createElement(rg,{layer:xr,filter:ee}),X&&ue.createElement(Q0,{layer:xr,animate:X}),c.children)}var Ay=null,Ty=null,Cg=ue.memo(function(c){return dm("pointLayer",c)}),wg=ue.memo(function(c){return dm("heatmapLayer",c)}),Py=null,My=null,Iy=null,Oy=ue.useEffect,Ly=null,Ry=null;function yd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?yd=function(a){return typeof a}:yd=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},yd(i)}function vm(i,c){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),a.push.apply(a,s)}return a}function _d(i){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?vm(Object(a),!0).forEach(function(s){Ag(i,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):vm(Object(a)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(a,s))})}return i}function Ag(i,c,a){return c in i?Object.defineProperty(i,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[c]=a,i}function Tg(i,c){if(!(i instanceof c))throw new TypeError("Cannot call a class as a function")}function mm(i,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function Pg(i,c,a){return c&&mm(i.prototype,c),a&&mm(i,a),i}function Mg(i,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(c&&c.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),c&&zd(i,c)}function zd(i,c){return zd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},zd(i,c)}function Ig(i){var c=Rg();return function(){var s=xd(i),l;if(c){var d=xd(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Og(this,l)}}function Og(i,c){if(c&&(yd(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Lg(i)}function Lg(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Rg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function xd(i){return xd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},xd(i)}var Dy=function(i){Mg(a,i);var c=Ig(a);function a(s){var l;return Tg(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return Pg(a,[{key:"componentDidMount",value:function(){var l,d=this.props,_=d.lnglat,T=d.children,I=d.option,R=d.lngLat,ee=new be(_d(_d({},I),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));_&&ee.setLnglat(_),R&&ee.setLnglat(R),T&&ee.setDOMContent(this.el),this.popup=ee,this.scene.addPopup(ee)}},{key:"componentDidUpdate",value:function(l){var d,_,T,I,R,ee,X=Array.isArray(l.lnglat)?l.lnglat:[l==null||(d=l.lnglat)===null||d===void 0?void 0:d.lng,l==null||(_=l.lnglat)===null||_===void 0?void 0:_.lat],ve=Array.isArray(this.props.lnglat)?this.props.lnglat:[(T=this.props)===null||T===void 0||(I=T.lnglat)===null||I===void 0?void 0:I.lng,(R=this.props)===null||R===void 0||(ee=R.lnglat)===null||ee===void 0?void 0:ee.lat],Be=X.toString()!==ve.toString();if(Be){var lt;this.popup.remove(),this.popup=new be(_d(_d({},this.props.option),{},{stopPropagation:(lt=this.props.option)===null||lt===void 0?void 0:lt.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return ue.createElement(C.Consumer,{},function(d){return d&&(l.scene=d),(0,cm.createPortal)(l.props.children,l.el)})}}]),a}(ue.PureComponent);function bd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?bd=function(a){return typeof a}:bd=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},bd(i)}function Dg(i,c){if(!(i instanceof c))throw new TypeError("Cannot call a class as a function")}function gm(i,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function kg(i,c,a){return c&&gm(i.prototype,c),a&&gm(i,a),i}function Fg(i,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(c&&c.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),c&&Ud(i,c)}function Ud(i,c){return Ud=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Ud(i,c)}function Bg(i){var c=Ug();return function(){var s=Sd(i),l;if(c){var d=Sd(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Ng(this,l)}}function Ng(i,c){if(c&&(bd(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zg(i)}function zg(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Ug(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Sd(i){return Sd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},Sd(i)}var ky=function(i){Fg(a,i);var c=Bg(a);function a(s){var l;return Dg(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return kg(a,[{key:"componentDidMount",value:function(){var l=this.props,d=l.lnglat,_=l.children,T=l.option,I=l.onMarkerLoaded,R=new Ft(T);d&&R.setLnglat(d),_&&R.setElement(this.el),this.marker=R,I&&I(R),this.scene.addMarker(R)}},{key:"componentDidUpdate",value:function(l){var d,_=(l==null?void 0:l.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());_&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return ue.createElement(C.Consumer,{},function(d){return d&&(l.scene=d),(0,cm.createPortal)(l.props.children,l.el)})}}]),a}(ue.PureComponent),Fy=ue.useEffect,By=null,Ny=null,zy=ue.useEffect,Uy=null},82008:function(){},41889:function(Lr,U,S){"use strict";S.d(U,{SO:function(){return ue},z6:function(){return mt},a5:function(){return C},Z:function(){return Vt},rQ:function(){return Jn},bV:function(){return Er},zi:function(){return Wn},ds:function(){return tt},Ev:function(){return yt},oO:function(){return Nr},W0:function(){return Zr},Z6:function(){return Jr},We:function(){return tr},Cl:function(){return qr},gJ:function(){return Ze},vP:function(){return Ge},yM:function(){return ie},yA:function(){return Mr},CI:function(){return Gr}});var ue={};S.r(ue),S.d(ue,{DPR:function(){return Ke},addClass:function(){return rt},create:function(){return Ye},empty:function(){return At},getClass:function(){return Ut},getContainer:function(){return W},getViewPortScale:function(){return wt},hasClass:function(){return Gt},printCanvas:function(){return mr},remove:function(){return Je},removeClass:function(){return Xt},setClass:function(){return nr},setTransform:function(){return dr},splitWords:function(){return N},triggerResize:function(){return re},trim:function(){return L}});var C={};S.r(C),S.d(C,{getColumn:function(){return ce},getSatByColumn:function(){return me},max:function(){return Ti},mean:function(){return Pi},min:function(){return $i},mode:function(){return Ri},statMap:function(){return Y},sum:function(){return Ji}});function p(z){var oe=131,de=137,Ae=0;z+="x";for(var se=Math.floor(9007199254740991/de),Ee=0;Ee<z.length;Ee++)Ae>se&&(Ae=Math.floor(Ae/de)),Ae=Ae*oe+z.charCodeAt(Ee);return Ae}function w(z){z=z.toString();for(var oe=5381,de=z.length;de;)oe=oe*33^z.charCodeAt(--de);return oe>>>0}var q=S(83405),K=window.document.documentElement.style;function W(z){var oe=z;return typeof z=="string"&&(oe=document.getElementById(z)),oe}function L(z){return z.trim?z.trim():z.replace(/^\s+|\s+$/g,"")}function N(z){return L(z).split(/\s+/)}function Ne(z){if(!K)return z[0];for(var oe in z)if(z[oe]&&z[oe]in K)return z[oe];return z[0]}function Ye(z,oe,de){var Ae=document.createElement(z);return Ae.className=oe||"",de&&de.appendChild(Ae),Ae}function Je(z){var oe=z.parentNode;oe&&oe.removeChild(z)}function rt(z,oe){if(z.classList!==void 0)for(var de=N(oe),Ae=0,se=de.length;Ae<se;Ae++)z.classList.add(de[Ae]);else if(!Gt(z,oe)){var Ee=Ut(z);nr(z,(Ee?Ee+" ":"")+oe)}}function Xt(z,oe){z.classList!==void 0?z.classList.remove(oe):nr(z,L((" "+Ut(z)+" ").replace(" "+oe+" "," ")))}function Gt(z,oe){if(z.classList!==void 0)return z.classList.contains(oe);var de=Ut(z);return de.length>0&&new RegExp("(^|\\s)"+oe+"(\\s|$)").test(de)}function nr(z,oe){z instanceof HTMLElement?z.className=oe:z.className.baseVal=oe}function Ut(z){return z instanceof SVGElement&&(z=z.correspondingElement),z.className.baseVal===void 0?z.className:z.className.baseVal}function At(z){for(;z&&z.firstChild;)z.removeChild(z.firstChild)}var Et=Ne(["transform","WebkitTransform"]);function dr(z,oe){z.style[Et]=oe}function re(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var z=window.document.createEvent("UIEvents");z.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(z)}}function mr(z){var oe=["padding: "+(z.height/2-8)+"px "+z.width/2+"px;","line-height: "+z.height+"px;","background-image: url("+z.toDataURL()+");"];console.log(`%c
`,oe.join(""))}function wt(){var z,oe=document.querySelector('meta[name="viewport"]');if(!oe)return 1;var de=(z=oe.content)===null||z===void 0?void 0:z.split(","),Ae=de.find(function(se){var Ee=se.split("="),dt=(0,q.Z)(Ee,2),br=dt[0],Ht=dt[1];return br==="initial-scale"});return Ae?Ae.split("=")[1]*1:1}var Ke=wt()<1?1:window.devicePixelRatio,Dt=S(51548),Xe=S(46893),Zt=S(67708),yr=S(37150),ur=S(87896),Ur=S(74415),he=S(80792);function Re(z){return Function.toString.call(z).indexOf("[native code]")!==-1}var ge=S(86315);function _t(z,oe,de){return(0,ge.Z)()?_t=Reflect.construct:_t=function(se,Ee,dt){var br=[null];br.push.apply(br,Ee);var Ht=Function.bind.apply(se,br),Qt=new Ht;return dt&&(0,he.Z)(Qt,dt.prototype),Qt},_t.apply(null,arguments)}function pt(z){var oe=typeof Map=="function"?new Map:void 0;return pt=function(Ae){if(Ae===null||!Re(Ae))return Ae;if(typeof Ae!="function")throw new TypeError("Super expression must either be null or a function");if(typeof oe!="undefined"){if(oe.has(Ae))return oe.get(Ae);oe.set(Ae,se)}function se(){return _t(Ae,arguments,(0,Ur.Z)(this).constructor)}return se.prototype=Object.create(Ae.prototype,{constructor:{value:se,enumerable:!1,writable:!0,configurable:!0}}),(0,he.Z)(se,Ae)},pt(z)}var zt=S(19297);function Ft(z){var oe=Dr();return function(){var Ae=(0,Ur.Z)(z),se;if(oe){var Ee=(0,Ur.Z)(this).constructor;se=Reflect.construct(Ae,arguments,Ee)}else se=Ae.apply(this,arguments);return(0,ur.Z)(this,se)}}function Dr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var pn=function(z){(0,yr.Z)(de,z);var oe=Ft(de);function de(Ae,se,Ee){var dt;return(0,Dt.Z)(this,de),dt=oe.call(this,Ae),(0,zt.Z)((0,Zt.Z)(dt),"status",void 0),(0,zt.Z)((0,Zt.Z)(dt),"url",void 0),dt.status=se,dt.url=Ee,dt.name=dt.constructor.name,dt.message=Ae,dt}return(0,Xe.Z)(de,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),de}(pt(Error));function mn(z){var oe=new XMLHttpRequest;oe.open("GET",z.url,!0);for(var de in z.headers)z.headers.hasOwnProperty(de)&&oe.setRequestHeader(de,z.headers[de]);return oe.withCredentials=z.credentials==="include",oe}var Xi=function(oe,de){var Ae=mn(oe);return Ae.setRequestHeader("Accept","application/json"),Ae.onerror=function(){de(new Error(Ae.statusText))},Ae.onload=function(){if(Ae.status>=200&&Ae.status<300&&Ae.response){var se;try{se=JSON.parse(Ae.response)}catch(Ee){return de(Ee)}de(null,se)}else Ae.status===401?de(new pn("".concat(Ae.statusText),Ae.status,oe.url)):de(new pn(Ae.statusText,Ae.status,oe.url))},Ae.send(),Ae},ir=function(oe,de){var Ae=mn(oe);return Ae.responseType="arraybuffer",Ae.onerror=function(){de(new Error(Ae.statusText))},Ae.onload=function(){var se=Ae.response;if(se.byteLength===0&&Ae.status===200)return de(new Error("http status 200 returned without content."));Ae.status>=200&&Ae.status<300&&Ae.response?de(null,{data:se,cacheControl:Ae.getResponseHeader("Cache-Control"),expires:Ae.getResponseHeader("Expires")}):de(new pn(Ae.statusText,Ae.status,oe.url))},Ae.send(),Ae};function pe(z){var oe=window.document.createElement("a");return oe.href=z,oe.protocol===window.document.location.protocol&&oe.host===window.document.location.host}var Pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ze=function(oe,de){return ir(oe,function(Ae,se){if(Ae)de(Ae);else if(se){var Ee=new window.Image;Ee.crossOrigin="anonymous";var dt=window.URL||window.webkitURL;Ee.onload=function(){de(null,Ee),dt.revokeObjectURL(Ee.src)};var br=new window.Blob([new Uint8Array(se.data)],{type:"image/png"});Ee.src=se.data.byteLength?dt.createObjectURL(br):Pe}})},Le=S(98576),It=2*Math.PI*6378137/2;function tr(z){var oe=[Infinity,Infinity,-Infinity,-Infinity];return z.forEach(function(de){var Ae=de.coordinates;E(oe,Ae)}),oe}function E(z,oe){return Array.isArray(oe[0])?oe.forEach(function(de){E(z,de)}):(z[0]>oe[0]&&(z[0]=oe[0]),z[1]>oe[1]&&(z[1]=oe[1]),z[2]<oe[0]&&(z[2]=oe[0]),z[3]<oe[1]&&(z[3]=oe[1])),z}function Z(z,oe){return be(z,oe)}function be(z,oe){return Array.isArray(z[0])?z.map(function(de){return be(de,oe)}):oe(z)}function Ge(z){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};z=Ct(z,oe);var Ae=z[0],se=z[1],Ee=Ae*It/180,dt=Math.log(Math.tan((90+se)*Math.PI/360))/(Math.PI/180);return dt=dt*It/180,de.enable&&(Ee=Number(Ee.toFixed(de.decimal)),dt=Number(dt.toFixed(de.decimal))),z.length===3?[Ee,dt,z[2]]:[Ee,dt]}function qe(z){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,de=z[0],Ae=z[1],se=de/It*180,Ee=Ae/It*180;return Ee=180/Math.PI*(2*Math.atan(Math.exp(Ee*Math.PI/180))-Math.PI/2),oe!=null&&(se=Number(se.toFixed(oe)),Ee=Number(Ee.toFixed(oe))),z.length===3?[se,Ee,z[2]]:[se,Ee]}function gt(z){if(z==null)throw new Error("lng is required");return(z>180||z<-180)&&(z=z%360,z>180&&(z=-360+z),z<-180&&(z=360+z),z===0&&(z=0)),z}function St(z){if(z==null)throw new Error("lat is required");return(z>90||z<-90)&&(z=z%180,z>90&&(z=-180+z),z<-90&&(z=180+z),z===0&&(z=0)),z}function Ct(z,oe){if(oe===!1)return z;var de=gt(z[0]),Ae=St(z[1]);return Ae>85&&(Ae=85),Ae<-85&&(Ae=-85),z.length===3?[de,Ae,z[2]]:[de,Ae]}function Vt(z){var oe=85.0511287798,de=Math.max(Math.min(oe,z[1]),-oe),Ae=256<<20,se=Math.PI/180,Ee=z[0]*se,dt=de*se;dt=Math.log(Math.tan(Math.PI/4+dt/2));var br=.5/Math.PI,Ht=.5,Qt=-.5/Math.PI;return se=.5,Ee=Ae*(br*Ee+Ht),dt=Ae*(Qt*dt+se),[Math.floor(Ee),Math.floor(dt)]}function qt(z){var oe=.5/Math.PI,de=.5,Ae=-.5/Math.PI,se=.5,Ee=256<<20,dt=_slicedToArray(z,2),br=dt[0],Ht=dt[1];br=(br/Ee-de)/oe,Ht=(Ht/Ee-se)/Ae,Ht=(Math.atan(Math.pow(Math.E,Ht))-Math.PI/4)*2,se=Math.PI/180;var Qt=Ht/se,Rr=br/se;return[Rr,Qt]}function ie(z,oe,de){var Ae=(0,Le.Ht)(oe[1]-z[1]),se=(0,Le.Ht)(oe[0]-z[0]),Ee=(0,Le.Ht)(z[1]),dt=(0,Le.Ht)(oe[1]),br=Math.pow(Math.sin(Ae/2),2)+Math.pow(Math.sin(se/2),2)*Math.cos(Ee)*Math.cos(dt);return(0,Le.DL)(2*Math.atan2(Math.sqrt(br),Math.sqrt(1-br)),de="meters")}function sr(z){var oe=Math.PI/180,de=85.0511287798,Ae=6378137,se=Math.max(Math.min(de,z[1]),-de),Ee=Math.sin(se*oe),dt=Ae*z[0]*oe,br=Ae*Math.log((1+Ee)/(1-Ee))/2;return[dt,br]}function Mr(z,oe){var de=Math.abs(z[1][1]-z[0][1])*oe,Ae=Math.abs(z[1][0]-z[0][0])*oe;return[[z[0][0]-Ae,z[0][1]-de],[z[1][0]+Ae,z[1][1]+de]]}function Nr(z,oe){return z[0][0]<=oe[0][0]&&z[0][1]<=oe[0][1]&&z[1][0]>=oe[1][0]&&z[1][1]>=oe[1][1]}function tt(z){return[[z[0],z[1]],[z[2],z[3]]]}var mt=function(){function z(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,de=arguments.length>1?arguments[1]:void 0;(0,Dt.Z)(this,z),(0,zt.Z)(this,"limit",void 0),(0,zt.Z)(this,"cache",void 0),(0,zt.Z)(this,"destroy",void 0),(0,zt.Z)(this,"order",void 0),this.limit=oe,this.destroy=de||this.defaultDestroy,this.order=[],this.clear()}return(0,Xe.Z)(z,[{key:"clear",value:function(){var de=this;this.order.forEach(function(Ae){de.delete(Ae)}),this.cache={},this.order=[]}},{key:"get",value:function(de){var Ae=this.cache[de];return Ae&&(this.deleteOrder(de),this.appendOrder(de)),Ae}},{key:"set",value:function(de,Ae){this.cache[de]?(this.delete(de),this.cache[de]=Ae,this.appendOrder(de)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[de]=Ae,this.appendOrder(de))}},{key:"delete",value:function(de){var Ae=this.cache[de];Ae&&(this.deleteCache(de),this.deleteOrder(de),this.destroy(Ae,de))}},{key:"deleteCache",value:function(de){delete this.cache[de]}},{key:"deleteOrder",value:function(de){var Ae=this.order.findIndex(function(se){return se===de});Ae>=0&&this.order.splice(Ae,1)}},{key:"appendOrder",value:function(de){this.order.push(de)}},{key:"defaultDestroy",value:function(de,Ae){return null}}]),z}();function yt(z,oe){z.forEach(function(de){!oe[de]||(oe[de]=oe[de].bind(oe))})}var hr=S(34663);function Gr(z){var oe=hr.ZP(z),de=[0,0,0,0];return oe!=null&&(de[0]=oe.r/255,de[1]=oe.g/255,de[2]=oe.b/255,de[3]=oe.opacity),de}function Zr(z){var oe=z&&z[0],de=z&&z[1],Ae=z&&z[2],se=oe+de*256+Ae*65536-1;return se}function Jr(z){return[z+1&255,z+1>>8&255,z+1>>8>>8&255]}function qr(z){var oe=document.createElement("canvas"),de=oe.getContext("2d");oe.width=256,oe.height=1;for(var Ae=de.createLinearGradient(0,0,256,1),se=null,Ee=z.positions[0],dt=z.positions[z.positions.length-1],br=0;br<z.colors.length;++br){var Ht=(z.positions[br]-Ee)/(dt-Ee);Ae.addColorStop(Ht,z.colors[br])}return de.fillStyle=Ae,de.fillRect(0,0,256,1),se=new Uint8ClampedArray(de.getImageData(0,0,256,1).data),new ImageData(se,256,1)}var Er;(function(z){z.CENTER="center",z.TOP="top",z["TOP-LEFT"]="top-left",z["TOP-RIGHT"]="top-right",z.BOTTOM="bottom",z["BOTTOM-LEFT"]="bottom-left",z.LEFT="left",z.RIGHT="right"})(Er||(Er={}));var Jn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Wn(z,oe,de){var Ae=z.classList;for(var se in Jn)Jn.hasOwnProperty(se)&&Ae.remove("l7-".concat(de,"-anchor-").concat(se));Ae.add("l7-".concat(de,"-anchor-").concat(oe))}function Ti(z){if(z.length===0)throw new Error("max requires at least one data point");for(var oe=z[0],de=1;de<z.length;de++)z[de]>oe&&(oe=z[de]);return oe*1}function $i(z){if(z.length===0)throw new Error("min requires at least one data point");for(var oe=z[0],de=1;de<z.length;de++)z[de]<oe&&(oe=z[de]);return oe*1}function Ji(z){if(z.length===0)return 0;for(var oe=z[0]*1,de=1;de<z.length;de++)oe+=z[de]*1;return oe}function Pi(z){if(z.length===0)throw new Error("mean requires at least one data point");return Ji(z)/z.length}function Ri(z){if(z.length===0)throw new Error("mean requires at least one data point");if(z.length<3)return z[0];z.sort();for(var oe=z[0],de=NaN,Ae=0,se=1,Ee=1;Ee<z.length+1;Ee++)z[Ee]!==oe?(se>Ae&&(Ae=se,de=oe),se=1,oe=z[Ee]):se++;return de*1}var Y={min:$i,max:Ti,mean:Pi,sum:Ji,mode:Ri};function ce(z,oe){return z.map(function(de){return de[oe]})}function me(z,oe){return Y[z](oe)}},7273:function(Lr,U,S){"use strict";S.d(U,{Z:function(){return ue}});function ue(C,p,w,q,K){var W={};return Object.keys(q).forEach(function(L){W[L]=q[L]}),W.enumerable=!!W.enumerable,W.configurable=!!W.configurable,("value"in W||W.initializer)&&(W.writable=!0),W=w.slice().reverse().reduce(function(L,N){return N(C,p,L)||L},W),K&&W.initializer!==void 0&&(W.value=W.initializer?W.initializer.call(K):void 0,W.initializer=void 0),W.initializer===void 0&&(Object.defineProperty(C,p,W),W=null),W}},66366:function(Lr,U,S){"use strict";S.d(U,{Z:function(){return p}});var ue=S(74415);function C(w,q){for(;!Object.prototype.hasOwnProperty.call(w,q)&&(w=(0,ue.Z)(w),w!==null););return w}function p(w,q,K){return typeof Reflect!="undefined"&&Reflect.get?p=Reflect.get:p=function(L,N,Ne){var Ye=C(L,N);if(!!Ye){var Je=Object.getOwnPropertyDescriptor(Ye,N);return Je.get?Je.get.call(Ne):Je.value}},p(w,q,K||w)}},84904:function(Lr,U,S){"use strict";S.d(U,{Z:function(){return ue}});function ue(C,p,w,q){!w||Object.defineProperty(C,p,{enumerable:w.enumerable,configurable:w.configurable,writable:w.writable,value:w.initializer?w.initializer.call(q):void 0})}},42512:function(Lr,U,S){var ue=S(48027);Lr.exports.geometry=C,Lr.exports.ring=w;function C(K){var W=0,L;switch(K.type){case"Polygon":return p(K.coordinates);case"MultiPolygon":for(L=0;L<K.coordinates.length;L++)W+=p(K.coordinates[L]);return W;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(L=0;L<K.geometries.length;L++)W+=C(K.geometries[L]);return W}}function p(K){var W=0;if(K&&K.length>0){W+=Math.abs(w(K[0]));for(var L=1;L<K.length;L++)W-=Math.abs(w(K[L]))}return W}function w(K){var W,L,N,Ne,Ye,Je,rt,Xt=0,Gt=K.length;if(Gt>2){for(rt=0;rt<Gt;rt++)rt===Gt-2?(Ne=Gt-2,Ye=Gt-1,Je=0):rt===Gt-1?(Ne=Gt-1,Ye=0,Je=1):(Ne=rt,Ye=rt+1,Je=rt+2),W=K[Ne],L=K[Ye],N=K[Je],Xt+=(q(N[0])-q(W[0]))*Math.sin(q(L[1]));Xt=Xt*ue.RADIUS*ue.RADIUS/2}return Xt}function q(K){return K*Math.PI/180}},56928:function(Lr,U,S){var ue=S(42512);Lr.exports=C;function C(L,N){switch(L&&L.type||null){case"FeatureCollection":return L.features=L.features.map(p(C,N)),L;case"GeometryCollection":return L.geometries=L.geometries.map(p(C,N)),L;case"Feature":return L.geometry=C(L.geometry,N),L;case"Polygon":case"MultiPolygon":return w(L,N);default:return L}}function p(L,N){return function(Ne){return L(Ne,N)}}function w(L,N){return L.type==="Polygon"?L.coordinates=q(L.coordinates,N):L.type==="MultiPolygon"&&(L.coordinates=L.coordinates.map(p(q,N))),L}function q(L,N){N=!!N,L[0]=K(L[0],N);for(var Ne=1;Ne<L.length;Ne++)L[Ne]=K(L[Ne],!N);return L}function K(L,N){return W(L)===N?L:L.reverse()}function W(L){return ue.ring(L)>=0}},52155:function(Lr){"use strict";Lr.exports=S,Lr.exports.default=S;var U=1e20;function S(q,K,W,L,N,Ne){this.fontSize=q||24,this.buffer=K===void 0?3:K,this.cutoff=L||.25,this.fontFamily=N||"sans-serif",this.fontWeight=Ne||"normal",this.radius=W||8;var Ye=this.size=this.fontSize+this.buffer*2,Je=Ye+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ye,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Je*Je),this.gridInner=new Float64Array(Je*Je),this.f=new Float64Array(Je),this.z=new Float64Array(Je+1),this.v=new Uint16Array(Je),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Ye/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ue(q,K,W,L,N,Ne,Ye){Ne.fill(U,0,K*W),Ye.fill(0,0,K*W);for(var Je=(K-L)/2,rt=0;rt<N;rt++)for(var Xt=0;Xt<L;Xt++){var Gt=(rt+Je)*K+Xt+Je,nr=q.data[4*(rt*L+Xt)+3]/255;if(nr===1)Ne[Gt]=0,Ye[Gt]=U;else if(nr===0)Ne[Gt]=U,Ye[Gt]=0;else{var Ut=Math.max(0,.5-nr),At=Math.max(0,nr-.5);Ne[Gt]=Ut*Ut,Ye[Gt]=At*At}}}function C(q,K,W,L,N,Ne,Ye){for(var Je=0;Je<K*W;Je++){var rt=Math.sqrt(L[Je])-Math.sqrt(N[Je]);q[Je]=Math.round(255-255*(rt/Ne+Ye))}}S.prototype._draw=function(q,K){var W=this.ctx.measureText(q),L=W.width,N=2*this.buffer,Ne,Ye,Je,rt,Xt,Gt,nr,Ut;K&&this.useMetrics?(Xt=Math.floor(W.actualBoundingBoxAscent),Ut=this.buffer+Math.ceil(W.actualBoundingBoxAscent),Gt=this.buffer,nr=this.buffer,Ye=Math.min(this.size,Math.ceil(W.actualBoundingBoxRight-W.actualBoundingBoxLeft)),rt=Math.min(this.size-Gt,Math.ceil(W.actualBoundingBoxAscent+W.actualBoundingBoxDescent)),Ne=Ye+N,Je=rt+N,this.ctx.textBaseline="alphabetic"):(Ne=Ye=this.size,Je=rt=this.size,Xt=19*this.fontSize/24,Gt=nr=0,Ut=this.middle,this.ctx.textBaseline="middle");var At;Ye&&rt&&(this.ctx.clearRect(nr,Gt,Ye,rt),this.ctx.fillText(q,this.buffer,Ut),At=this.ctx.getImageData(nr,Gt,Ye,rt));var Et=new Uint8ClampedArray(Ne*Je);return ue(At,Ne,Je,Ye,rt,this.gridOuter,this.gridInner),p(this.gridOuter,Ne,Je,this.f,this.v,this.z),p(this.gridInner,Ne,Je,this.f,this.v,this.z),C(Et,Ne,Je,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Et,metrics:{width:Ye,height:rt,sdfWidth:Ne,sdfHeight:Je,top:Xt,left:0,advance:L}}},S.prototype.draw=function(q){return this._draw(q,!1).data},S.prototype.drawWithMetrics=function(q){return this._draw(q,!0)};function p(q,K,W,L,N,Ne){for(var Ye=0;Ye<K;Ye++)w(q,Ye,K,W,L,N,Ne);for(var Je=0;Je<W;Je++)w(q,Je*K,1,K,L,N,Ne)}function w(q,K,W,L,N,Ne,Ye){var Je,rt,Xt,Gt;for(Ne[0]=0,Ye[0]=-U,Ye[1]=U,Je=0;Je<L;Je++)N[Je]=q[K+Je*W];for(Je=1,rt=0,Xt=0;Je<L;Je++){do Gt=Ne[rt],Xt=(N[Je]-N[Gt]+Je*Je-Gt*Gt)/(Je-Gt)/2;while(Xt<=Ye[rt]&&--rt>-1);rt++,Ne[rt]=Je,Ye[rt]=Xt,Ye[rt+1]=U}for(Je=0,rt=0;Je<L;Je++){for(;Ye[rt+1]<Je;)rt++;Gt=Ne[rt],q[K+Je*W]=N[Gt]+(Je-Gt)*(Je-Gt)}}},98576:function(Lr,U,S){"use strict";S.d(U,{zL:function(){return q},DL:function(){return Et},Ht:function(){return Ke}});var ue=63710088e-1,C={centimeters:ue*100,centimetres:ue*100,degrees:ue/111325,feet:ue*3.28084,inches:ue*39.37,kilometers:ue/1e3,kilometres:ue/1e3,meters:ue,metres:ue,miles:ue/1609.344,millimeters:ue*1e3,millimetres:ue*1e3,nauticalmiles:ue/1852,radians:1,yards:ue*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ue,yards:1.0936133},w={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function q(he,Re,ge){ge===void 0&&(ge={});var _t={type:"Feature"};return(ge.id===0||ge.id)&&(_t.id=ge.id),ge.bbox&&(_t.bbox=ge.bbox),_t.properties=Re||{},_t.geometry=he,_t}function K(he,Re,ge){switch(ge===void 0&&(ge={}),he){case"Point":return W(Re).geometry;case"LineString":return Ye(Re).geometry;case"Polygon":return N(Re).geometry;case"MultiPoint":return Gt(Re).geometry;case"MultiLineString":return Xt(Re).geometry;case"MultiPolygon":return nr(Re).geometry;default:throw new Error(he+" is invalid")}}function W(he,Re,ge){if(ge===void 0&&(ge={}),!he)throw new Error("coordinates is required");if(!Array.isArray(he))throw new Error("coordinates must be an Array");if(he.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Zt(he[0])||!Zt(he[1]))throw new Error("coordinates must contain numbers");var _t={type:"Point",coordinates:he};return q(_t,Re,ge)}function L(he,Re,ge){return ge===void 0&&(ge={}),rt(he.map(function(_t){return W(_t,Re)}),ge)}function N(he,Re,ge){ge===void 0&&(ge={});for(var _t=0,pt=he;_t<pt.length;_t++){var zt=pt[_t];if(zt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Ft=0;Ft<zt[zt.length-1].length;Ft++)if(zt[zt.length-1][Ft]!==zt[0][Ft])throw new Error("First and last Position are not equivalent.")}var Dr={type:"Polygon",coordinates:he};return q(Dr,Re,ge)}function Ne(he,Re,ge){return ge===void 0&&(ge={}),rt(he.map(function(_t){return N(_t,Re)}),ge)}function Ye(he,Re,ge){if(ge===void 0&&(ge={}),he.length<2)throw new Error("coordinates must be an array of two or more positions");var _t={type:"LineString",coordinates:he};return q(_t,Re,ge)}function Je(he,Re,ge){return ge===void 0&&(ge={}),rt(he.map(function(_t){return Ye(_t,Re)}),ge)}function rt(he,Re){Re===void 0&&(Re={});var ge={type:"FeatureCollection"};return Re.id&&(ge.id=Re.id),Re.bbox&&(ge.bbox=Re.bbox),ge.features=he,ge}function Xt(he,Re,ge){ge===void 0&&(ge={});var _t={type:"MultiLineString",coordinates:he};return q(_t,Re,ge)}function Gt(he,Re,ge){ge===void 0&&(ge={});var _t={type:"MultiPoint",coordinates:he};return q(_t,Re,ge)}function nr(he,Re,ge){ge===void 0&&(ge={});var _t={type:"MultiPolygon",coordinates:he};return q(_t,Re,ge)}function Ut(he,Re,ge){ge===void 0&&(ge={});var _t={type:"GeometryCollection",geometries:he};return q(_t,Re,ge)}function At(he,Re){if(Re===void 0&&(Re=0),Re&&!(Re>=0))throw new Error("precision must be a positive number");var ge=Math.pow(10,Re||0);return Math.round(he*ge)/ge}function Et(he,Re){Re===void 0&&(Re="kilometers");var ge=C[Re];if(!ge)throw new Error(Re+" units is invalid");return he*ge}function dr(he,Re){Re===void 0&&(Re="kilometers");var ge=C[Re];if(!ge)throw new Error(Re+" units is invalid");return he/ge}function re(he,Re){return wt(dr(he,Re))}function mr(he){var Re=he%360;return Re<0&&(Re+=360),Re}function wt(he){var Re=he%(2*Math.PI);return Re*180/Math.PI}function Ke(he){var Re=he%360;return Re*Math.PI/180}function Dt(he,Re,ge){if(Re===void 0&&(Re="kilometers"),ge===void 0&&(ge="kilometers"),!(he>=0))throw new Error("length must be a positive number");return Et(dr(he,Re),ge)}function Xe(he,Re,ge){if(Re===void 0&&(Re="meters"),ge===void 0&&(ge="kilometers"),!(he>=0))throw new Error("area must be a positive number");var _t=w[Re];if(!_t)throw new Error("invalid original units");var pt=w[ge];if(!pt)throw new Error("invalid final units");return he/_t*pt}function Zt(he){return!isNaN(he)&&he!==null&&!Array.isArray(he)}function yr(he){return!!he&&he.constructor===Object}function ur(he){if(!he)throw new Error("bbox is required");if(!Array.isArray(he))throw new Error("bbox must be an Array");if(he.length!==4&&he.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");he.forEach(function(Re){if(!Zt(Re))throw new Error("bbox must only contain numbers")})}function Ur(he){if(!he)throw new Error("id is required");if(["string","number"].indexOf(typeof he)===-1)throw new Error("id must be a number or a string")}},83114:function(){},83628:function(Lr){"use strict";Lr.exports=U,Lr.exports.default=U;function U(he,Re,ge){ge=ge||2;var _t=Re&&Re.length,pt=_t?Re[0]*ge:he.length,zt=S(he,0,pt,ge,!0),Ft=[];if(!zt||zt.next===zt.prev)return Ft;var Dr,pn,mn,Xi,ir,pe,Pe;if(_t&&(zt=W(he,Re,zt,ge)),he.length>80*ge){Dr=mn=he[0],pn=Xi=he[1];for(var Ze=ge;Ze<pt;Ze+=ge)ir=he[Ze],pe=he[Ze+1],ir<Dr&&(Dr=ir),pe<pn&&(pn=pe),ir>mn&&(mn=ir),pe>Xi&&(Xi=pe);Pe=Math.max(mn-Dr,Xi-pn),Pe=Pe!==0?1/Pe:0}return C(zt,Ft,ge,Dr,pn,Pe),Ft}function S(he,Re,ge,_t,pt){var zt,Ft;if(pt===Ur(he,Re,ge,_t)>0)for(zt=Re;zt<ge;zt+=_t)Ft=Zt(zt,he[zt],he[zt+1],Ft);else for(zt=ge-_t;zt>=Re;zt-=_t)Ft=Zt(zt,he[zt],he[zt+1],Ft);return Ft&&Et(Ft,Ft.next)&&(yr(Ft),Ft=Ft.next),Ft}function ue(he,Re){if(!he)return he;Re||(Re=he);var ge=he,_t;do if(_t=!1,!ge.steiner&&(Et(ge,ge.next)||At(ge.prev,ge,ge.next)===0)){if(yr(ge),ge=Re=ge.prev,ge===ge.next)break;_t=!0}else ge=ge.next;while(_t||ge!==Re);return Re}function C(he,Re,ge,_t,pt,zt,Ft){if(!!he){!Ft&&zt&&Je(he,_t,pt,zt);for(var Dr=he,pn,mn;he.prev!==he.next;){if(pn=he.prev,mn=he.next,zt?w(he,_t,pt,zt):p(he)){Re.push(pn.i/ge),Re.push(he.i/ge),Re.push(mn.i/ge),yr(he),he=mn.next,Dr=mn.next;continue}if(he=mn,he===Dr){Ft?Ft===1?(he=q(ue(he),Re,ge),C(he,Re,ge,_t,pt,zt,2)):Ft===2&&K(he,Re,ge,_t,pt,zt):C(ue(he),Re,ge,_t,pt,zt,1);break}}}}function p(he){var Re=he.prev,ge=he,_t=he.next;if(At(Re,ge,_t)>=0)return!1;for(var pt=he.next.next;pt!==he.prev;){if(nr(Re.x,Re.y,ge.x,ge.y,_t.x,_t.y,pt.x,pt.y)&&At(pt.prev,pt,pt.next)>=0)return!1;pt=pt.next}return!0}function w(he,Re,ge,_t){var pt=he.prev,zt=he,Ft=he.next;if(At(pt,zt,Ft)>=0)return!1;for(var Dr=pt.x<zt.x?pt.x<Ft.x?pt.x:Ft.x:zt.x<Ft.x?zt.x:Ft.x,pn=pt.y<zt.y?pt.y<Ft.y?pt.y:Ft.y:zt.y<Ft.y?zt.y:Ft.y,mn=pt.x>zt.x?pt.x>Ft.x?pt.x:Ft.x:zt.x>Ft.x?zt.x:Ft.x,Xi=pt.y>zt.y?pt.y>Ft.y?pt.y:Ft.y:zt.y>Ft.y?zt.y:Ft.y,ir=Xt(Dr,pn,Re,ge,_t),pe=Xt(mn,Xi,Re,ge,_t),Pe=he.prevZ,Ze=he.nextZ;Pe&&Pe.z>=ir&&Ze&&Ze.z<=pe;){if(Pe!==he.prev&&Pe!==he.next&&nr(pt.x,pt.y,zt.x,zt.y,Ft.x,Ft.y,Pe.x,Pe.y)&&At(Pe.prev,Pe,Pe.next)>=0||(Pe=Pe.prevZ,Ze!==he.prev&&Ze!==he.next&&nr(pt.x,pt.y,zt.x,zt.y,Ft.x,Ft.y,Ze.x,Ze.y)&&At(Ze.prev,Ze,Ze.next)>=0))return!1;Ze=Ze.nextZ}for(;Pe&&Pe.z>=ir;){if(Pe!==he.prev&&Pe!==he.next&&nr(pt.x,pt.y,zt.x,zt.y,Ft.x,Ft.y,Pe.x,Pe.y)&&At(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.prevZ}for(;Ze&&Ze.z<=pe;){if(Ze!==he.prev&&Ze!==he.next&&nr(pt.x,pt.y,zt.x,zt.y,Ft.x,Ft.y,Ze.x,Ze.y)&&At(Ze.prev,Ze,Ze.next)>=0)return!1;Ze=Ze.nextZ}return!0}function q(he,Re,ge){var _t=he;do{var pt=_t.prev,zt=_t.next.next;!Et(pt,zt)&&dr(pt,_t,_t.next,zt)&&Ke(pt,zt)&&Ke(zt,pt)&&(Re.push(pt.i/ge),Re.push(_t.i/ge),Re.push(zt.i/ge),yr(_t),yr(_t.next),_t=he=zt),_t=_t.next}while(_t!==he);return ue(_t)}function K(he,Re,ge,_t,pt,zt){var Ft=he;do{for(var Dr=Ft.next.next;Dr!==Ft.prev;){if(Ft.i!==Dr.i&&Ut(Ft,Dr)){var pn=Xe(Ft,Dr);Ft=ue(Ft,Ft.next),pn=ue(pn,pn.next),C(Ft,Re,ge,_t,pt,zt),C(pn,Re,ge,_t,pt,zt);return}Dr=Dr.next}Ft=Ft.next}while(Ft!==he)}function W(he,Re,ge,_t){var pt=[],zt,Ft,Dr,pn,mn;for(zt=0,Ft=Re.length;zt<Ft;zt++)Dr=Re[zt]*_t,pn=zt<Ft-1?Re[zt+1]*_t:he.length,mn=S(he,Dr,pn,_t,!1),mn===mn.next&&(mn.steiner=!0),pt.push(Gt(mn));for(pt.sort(L),zt=0;zt<pt.length;zt++)ge=N(pt[zt],ge),ge=ue(ge,ge.next);return ge}function L(he,Re){return he.x-Re.x}function N(he,Re){var ge=Ne(he,Re);if(!ge)return Re;var _t=Xe(ge,he),pt=ue(ge,ge.next);return ue(_t,_t.next),Re===ge?pt:Re}function Ne(he,Re){var ge=Re,_t=he.x,pt=he.y,zt=-Infinity,Ft;do{if(pt<=ge.y&&pt>=ge.next.y&&ge.next.y!==ge.y){var Dr=ge.x+(pt-ge.y)*(ge.next.x-ge.x)/(ge.next.y-ge.y);if(Dr<=_t&&Dr>zt){if(zt=Dr,Dr===_t){if(pt===ge.y)return ge;if(pt===ge.next.y)return ge.next}Ft=ge.x<ge.next.x?ge:ge.next}}ge=ge.next}while(ge!==Re);if(!Ft)return null;if(_t===zt)return Ft;var pn=Ft,mn=Ft.x,Xi=Ft.y,ir=Infinity,pe;ge=Ft;do _t>=ge.x&&ge.x>=mn&&_t!==ge.x&&nr(pt<Xi?_t:zt,pt,mn,Xi,pt<Xi?zt:_t,pt,ge.x,ge.y)&&(pe=Math.abs(pt-ge.y)/(_t-ge.x),Ke(ge,he)&&(pe<ir||pe===ir&&(ge.x>Ft.x||ge.x===Ft.x&&Ye(Ft,ge)))&&(Ft=ge,ir=pe)),ge=ge.next;while(ge!==pn);return Ft}function Ye(he,Re){return At(he.prev,he,Re.prev)<0&&At(Re.next,he,he.next)<0}function Je(he,Re,ge,_t){var pt=he;do pt.z===null&&(pt.z=Xt(pt.x,pt.y,Re,ge,_t)),pt.prevZ=pt.prev,pt.nextZ=pt.next,pt=pt.next;while(pt!==he);pt.prevZ.nextZ=null,pt.prevZ=null,rt(pt)}function rt(he){var Re,ge,_t,pt,zt,Ft,Dr,pn,mn=1;do{for(ge=he,he=null,zt=null,Ft=0;ge;){for(Ft++,_t=ge,Dr=0,Re=0;Re<mn&&(Dr++,_t=_t.nextZ,!!_t);Re++);for(pn=mn;Dr>0||pn>0&&_t;)Dr!==0&&(pn===0||!_t||ge.z<=_t.z)?(pt=ge,ge=ge.nextZ,Dr--):(pt=_t,_t=_t.nextZ,pn--),zt?zt.nextZ=pt:he=pt,pt.prevZ=zt,zt=pt;ge=_t}zt.nextZ=null,mn*=2}while(Ft>1);return he}function Xt(he,Re,ge,_t,pt){return he=32767*(he-ge)*pt,Re=32767*(Re-_t)*pt,he=(he|he<<8)&16711935,he=(he|he<<4)&252645135,he=(he|he<<2)&858993459,he=(he|he<<1)&1431655765,Re=(Re|Re<<8)&16711935,Re=(Re|Re<<4)&252645135,Re=(Re|Re<<2)&858993459,Re=(Re|Re<<1)&1431655765,he|Re<<1}function Gt(he){var Re=he,ge=he;do(Re.x<ge.x||Re.x===ge.x&&Re.y<ge.y)&&(ge=Re),Re=Re.next;while(Re!==he);return ge}function nr(he,Re,ge,_t,pt,zt,Ft,Dr){return(pt-Ft)*(Re-Dr)-(he-Ft)*(zt-Dr)>=0&&(he-Ft)*(_t-Dr)-(ge-Ft)*(Re-Dr)>=0&&(ge-Ft)*(zt-Dr)-(pt-Ft)*(_t-Dr)>=0}function Ut(he,Re){return he.next.i!==Re.i&&he.prev.i!==Re.i&&!wt(he,Re)&&(Ke(he,Re)&&Ke(Re,he)&&Dt(he,Re)&&(At(he.prev,he,Re.prev)||At(he,Re.prev,Re))||Et(he,Re)&&At(he.prev,he,he.next)>0&&At(Re.prev,Re,Re.next)>0)}function At(he,Re,ge){return(Re.y-he.y)*(ge.x-Re.x)-(Re.x-he.x)*(ge.y-Re.y)}function Et(he,Re){return he.x===Re.x&&he.y===Re.y}function dr(he,Re,ge,_t){var pt=mr(At(he,Re,ge)),zt=mr(At(he,Re,_t)),Ft=mr(At(ge,_t,he)),Dr=mr(At(ge,_t,Re));return!!(pt!==zt&&Ft!==Dr||pt===0&&re(he,ge,Re)||zt===0&&re(he,_t,Re)||Ft===0&&re(ge,he,_t)||Dr===0&&re(ge,Re,_t))}function re(he,Re,ge){return Re.x<=Math.max(he.x,ge.x)&&Re.x>=Math.min(he.x,ge.x)&&Re.y<=Math.max(he.y,ge.y)&&Re.y>=Math.min(he.y,ge.y)}function mr(he){return he>0?1:he<0?-1:0}function wt(he,Re){var ge=he;do{if(ge.i!==he.i&&ge.next.i!==he.i&&ge.i!==Re.i&&ge.next.i!==Re.i&&dr(ge,ge.next,he,Re))return!0;ge=ge.next}while(ge!==he);return!1}function Ke(he,Re){return At(he.prev,he,he.next)<0?At(he,Re,he.next)>=0&&At(he,he.prev,Re)>=0:At(he,Re,he.prev)<0||At(he,he.next,Re)<0}function Dt(he,Re){var ge=he,_t=!1,pt=(he.x+Re.x)/2,zt=(he.y+Re.y)/2;do ge.y>zt!=ge.next.y>zt&&ge.next.y!==ge.y&&pt<(ge.next.x-ge.x)*(zt-ge.y)/(ge.next.y-ge.y)+ge.x&&(_t=!_t),ge=ge.next;while(ge!==he);return _t}function Xe(he,Re){var ge=new ur(he.i,he.x,he.y),_t=new ur(Re.i,Re.x,Re.y),pt=he.next,zt=Re.prev;return he.next=Re,Re.prev=he,ge.next=pt,pt.prev=ge,_t.next=ge,ge.prev=_t,zt.next=_t,_t.prev=zt,_t}function Zt(he,Re,ge,_t){var pt=new ur(he,Re,ge);return _t?(pt.next=_t.next,pt.prev=_t,_t.next.prev=pt,_t.next=pt):(pt.prev=pt,pt.next=pt),pt}function yr(he){he.next.prev=he.prev,he.prev.next=he.next,he.prevZ&&(he.prevZ.nextZ=he.nextZ),he.nextZ&&(he.nextZ.prevZ=he.prevZ)}function ur(he,Re,ge){this.i=he,this.x=Re,this.y=ge,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}U.deviation=function(he,Re,ge,_t){var pt=Re&&Re.length,zt=pt?Re[0]*ge:he.length,Ft=Math.abs(Ur(he,0,zt,ge));if(pt)for(var Dr=0,pn=Re.length;Dr<pn;Dr++){var mn=Re[Dr]*ge,Xi=Dr<pn-1?Re[Dr+1]*ge:he.length;Ft-=Math.abs(Ur(he,mn,Xi,ge))}var ir=0;for(Dr=0;Dr<_t.length;Dr+=3){var pe=_t[Dr]*ge,Pe=_t[Dr+1]*ge,Ze=_t[Dr+2]*ge;ir+=Math.abs((he[pe]-he[Ze])*(he[Pe+1]-he[pe+1])-(he[pe]-he[Pe])*(he[Ze+1]-he[pe+1]))}return Ft===0&&ir===0?0:Math.abs((ir-Ft)/Ft)};function Ur(he,Re,ge,_t){for(var pt=0,zt=Re,Ft=ge-_t;zt<ge;zt+=_t)pt+=(he[Ft]-he[zt])*(he[zt+1]+he[Ft+1]),Ft=zt;return pt}U.flatten=function(he){for(var Re=he[0][0].length,ge={vertices:[],holes:[],dimensions:Re},_t=0,pt=0;pt<he.length;pt++){for(var zt=0;zt<he[pt].length;zt++)for(var Ft=0;Ft<Re;Ft++)ge.vertices.push(he[pt][zt][Ft]);pt>0&&(_t+=he[pt-1].length,ge.holes.push(_t))}return ge}},67499:function(Lr){function U(ue){var C=ue.target||ue.srcElement;C.__resizeRAF__&&cancelAnimationFrame(C.__resizeRAF__),C.__resizeRAF__=requestAnimationFrame(function(){var p=C.__resizeTrigger__,w=p&&p.__resizeListeners__;w&&w.forEach(function(q){q.call(p,ue)})})}var S=function(C,p){var w=this,q=w.document,K,W=q.attachEvent;typeof navigator!="undefined"&&(K=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function L(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",U)}if(!C.__resizeListeners__)if(C.__resizeListeners__=[],W)C.__resizeTrigger__=C,C.attachEvent("onresize",U);else{getComputedStyle(C).position==="static"&&(C.style.position="relative");var N=C.__resizeTrigger__=q.createElement("object");N.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),N.setAttribute("class","resize-sensor"),N.setAttribute("tabindex","-1"),N.setAttribute("title",""),N.__resizeElement__=C,N.onload=L,N.type="text/html",K&&C.appendChild(N),N.data="about:blank",K||C.appendChild(N)}C.__resizeListeners__.push(p)};Lr.exports=typeof window=="undefined"?S:S.bind(window),Lr.exports.unbind=function(ue,C){var p=document.attachEvent,w=ue.__resizeListeners__||[];if(C){var q=w.indexOf(C);q!==-1&&w.splice(q,1)}else w=ue.__resizeListeners__=[];if(!w.length){if(p)ue.detachEvent("onresize",U);else if(ue.__resizeTrigger__){var K=ue.__resizeTrigger__.contentDocument,W=K&&K.defaultView;W&&(W.removeEventListener("resize",U),delete W.__resizeTrigger__),ue.__resizeTrigger__=!ue.removeChild(ue.__resizeTrigger__)}delete ue.__resizeListeners__}}},40666:function(Lr){"use strict";var U=Object.prototype.hasOwnProperty,S="~";function ue(){}Object.create&&(ue.prototype=Object.create(null),new ue().__proto__||(S=!1));function C(K,W,L){this.fn=K,this.context=W,this.once=L||!1}function p(K,W,L,N,Ne){if(typeof L!="function")throw new TypeError("The listener must be a function");var Ye=new C(L,N||K,Ne),Je=S?S+W:W;return K._events[Je]?K._events[Je].fn?K._events[Je]=[K._events[Je],Ye]:K._events[Je].push(Ye):(K._events[Je]=Ye,K._eventsCount++),K}function w(K,W){--K._eventsCount==0?K._events=new ue:delete K._events[W]}function q(){this._events=new ue,this._eventsCount=0}q.prototype.eventNames=function(){var W=[],L,N;if(this._eventsCount===0)return W;for(N in L=this._events)U.call(L,N)&&W.push(S?N.slice(1):N);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(L)):W},q.prototype.listeners=function(W){var L=S?S+W:W,N=this._events[L];if(!N)return[];if(N.fn)return[N.fn];for(var Ne=0,Ye=N.length,Je=new Array(Ye);Ne<Ye;Ne++)Je[Ne]=N[Ne].fn;return Je},q.prototype.listenerCount=function(W){var L=S?S+W:W,N=this._events[L];return N?N.fn?1:N.length:0},q.prototype.emit=function(W,L,N,Ne,Ye,Je){var rt=S?S+W:W;if(!this._events[rt])return!1;var Xt=this._events[rt],Gt=arguments.length,nr,Ut;if(Xt.fn){switch(Xt.once&&this.removeListener(W,Xt.fn,void 0,!0),Gt){case 1:return Xt.fn.call(Xt.context),!0;case 2:return Xt.fn.call(Xt.context,L),!0;case 3:return Xt.fn.call(Xt.context,L,N),!0;case 4:return Xt.fn.call(Xt.context,L,N,Ne),!0;case 5:return Xt.fn.call(Xt.context,L,N,Ne,Ye),!0;case 6:return Xt.fn.call(Xt.context,L,N,Ne,Ye,Je),!0}for(Ut=1,nr=new Array(Gt-1);Ut<Gt;Ut++)nr[Ut-1]=arguments[Ut];Xt.fn.apply(Xt.context,nr)}else{var At=Xt.length,Et;for(Ut=0;Ut<At;Ut++)switch(Xt[Ut].once&&this.removeListener(W,Xt[Ut].fn,void 0,!0),Gt){case 1:Xt[Ut].fn.call(Xt[Ut].context);break;case 2:Xt[Ut].fn.call(Xt[Ut].context,L);break;case 3:Xt[Ut].fn.call(Xt[Ut].context,L,N);break;case 4:Xt[Ut].fn.call(Xt[Ut].context,L,N,Ne);break;default:if(!nr)for(Et=1,nr=new Array(Gt-1);Et<Gt;Et++)nr[Et-1]=arguments[Et];Xt[Ut].fn.apply(Xt[Ut].context,nr)}}return!0},q.prototype.on=function(W,L,N){return p(this,W,L,N,!1)},q.prototype.once=function(W,L,N){return p(this,W,L,N,!0)},q.prototype.removeListener=function(W,L,N,Ne){var Ye=S?S+W:W;if(!this._events[Ye])return this;if(!L)return w(this,Ye),this;var Je=this._events[Ye];if(Je.fn)Je.fn===L&&(!Ne||Je.once)&&(!N||Je.context===N)&&w(this,Ye);else{for(var rt=0,Xt=[],Gt=Je.length;rt<Gt;rt++)(Je[rt].fn!==L||Ne&&!Je[rt].once||N&&Je[rt].context!==N)&&Xt.push(Je[rt]);Xt.length?this._events[Ye]=Xt.length===1?Xt[0]:Xt:w(this,Ye)}return this},q.prototype.removeAllListeners=function(W){var L;return W?(L=S?S+W:W,this._events[L]&&w(this,L)):(this._events=new ue,this._eventsCount=0),this},q.prototype.off=q.prototype.removeListener,q.prototype.addListener=q.prototype.on,q.prefixed=S,q.EventEmitter=q,Lr.exports=q},76180:function(Lr,U,S){"use strict";S.r(U),S.d(U,{create:function(){return C},clone:function(){return p},copy:function(){return w},fromValues:function(){return q},set:function(){return K},identity:function(){return W},transpose:function(){return L},invert:function(){return N},adjoint:function(){return Ne},determinant:function(){return Ye},multiply:function(){return Je},translate:function(){return rt},scale:function(){return Xt},rotate:function(){return Gt},rotateX:function(){return nr},rotateY:function(){return Ut},rotateZ:function(){return At},fromTranslation:function(){return Et},fromScaling:function(){return dr},fromRotation:function(){return re},fromXRotation:function(){return mr},fromYRotation:function(){return wt},fromZRotation:function(){return Ke},fromRotationTranslation:function(){return Dt},fromQuat2:function(){return Xe},getTranslation:function(){return Zt},getScaling:function(){return yr},getRotation:function(){return ur},fromRotationTranslationScale:function(){return Ur},fromRotationTranslationScaleOrigin:function(){return he},fromQuat:function(){return Re},frustum:function(){return ge},perspective:function(){return _t},perspectiveFromFieldOfView:function(){return pt},ortho:function(){return zt},lookAt:function(){return Ft},targetTo:function(){return Dr},str:function(){return pn},frob:function(){return mn},add:function(){return Xi},subtract:function(){return ir},multiplyScalar:function(){return pe},multiplyScalarAndAdd:function(){return Pe},exactEquals:function(){return Ze},equals:function(){return Le},mul:function(){return It},sub:function(){return tr}});var ue=S(32933);function C(){var E=new ue.WT(16);return ue.WT!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=0,E[12]=0,E[13]=0,E[14]=0),E[0]=1,E[5]=1,E[10]=1,E[15]=1,E}function p(E){var Z=new ue.WT(16);return Z[0]=E[0],Z[1]=E[1],Z[2]=E[2],Z[3]=E[3],Z[4]=E[4],Z[5]=E[5],Z[6]=E[6],Z[7]=E[7],Z[8]=E[8],Z[9]=E[9],Z[10]=E[10],Z[11]=E[11],Z[12]=E[12],Z[13]=E[13],Z[14]=E[14],Z[15]=E[15],Z}function w(E,Z){return E[0]=Z[0],E[1]=Z[1],E[2]=Z[2],E[3]=Z[3],E[4]=Z[4],E[5]=Z[5],E[6]=Z[6],E[7]=Z[7],E[8]=Z[8],E[9]=Z[9],E[10]=Z[10],E[11]=Z[11],E[12]=Z[12],E[13]=Z[13],E[14]=Z[14],E[15]=Z[15],E}function q(E,Z,be,Ge,qe,gt,St,Ct,Vt,qt,ie,sr,Mr,Nr,tt,mt){var yt=new ue.WT(16);return yt[0]=E,yt[1]=Z,yt[2]=be,yt[3]=Ge,yt[4]=qe,yt[5]=gt,yt[6]=St,yt[7]=Ct,yt[8]=Vt,yt[9]=qt,yt[10]=ie,yt[11]=sr,yt[12]=Mr,yt[13]=Nr,yt[14]=tt,yt[15]=mt,yt}function K(E,Z,be,Ge,qe,gt,St,Ct,Vt,qt,ie,sr,Mr,Nr,tt,mt,yt){return E[0]=Z,E[1]=be,E[2]=Ge,E[3]=qe,E[4]=gt,E[5]=St,E[6]=Ct,E[7]=Vt,E[8]=qt,E[9]=ie,E[10]=sr,E[11]=Mr,E[12]=Nr,E[13]=tt,E[14]=mt,E[15]=yt,E}function W(E){return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function L(E,Z){if(E===Z){var be=Z[1],Ge=Z[2],qe=Z[3],gt=Z[6],St=Z[7],Ct=Z[11];E[1]=Z[4],E[2]=Z[8],E[3]=Z[12],E[4]=be,E[6]=Z[9],E[7]=Z[13],E[8]=Ge,E[9]=gt,E[11]=Z[14],E[12]=qe,E[13]=St,E[14]=Ct}else E[0]=Z[0],E[1]=Z[4],E[2]=Z[8],E[3]=Z[12],E[4]=Z[1],E[5]=Z[5],E[6]=Z[9],E[7]=Z[13],E[8]=Z[2],E[9]=Z[6],E[10]=Z[10],E[11]=Z[14],E[12]=Z[3],E[13]=Z[7],E[14]=Z[11],E[15]=Z[15];return E}function N(E,Z){var be=Z[0],Ge=Z[1],qe=Z[2],gt=Z[3],St=Z[4],Ct=Z[5],Vt=Z[6],qt=Z[7],ie=Z[8],sr=Z[9],Mr=Z[10],Nr=Z[11],tt=Z[12],mt=Z[13],yt=Z[14],hr=Z[15],Gr=be*Ct-Ge*St,Zr=be*Vt-qe*St,Jr=be*qt-gt*St,qr=Ge*Vt-qe*Ct,Er=Ge*qt-gt*Ct,Jn=qe*qt-gt*Vt,Wn=ie*mt-sr*tt,Ti=ie*yt-Mr*tt,$i=ie*hr-Nr*tt,Ji=sr*yt-Mr*mt,Pi=sr*hr-Nr*mt,Ri=Mr*hr-Nr*yt,Y=Gr*Ri-Zr*Pi+Jr*Ji+qr*$i-Er*Ti+Jn*Wn;return Y?(Y=1/Y,E[0]=(Ct*Ri-Vt*Pi+qt*Ji)*Y,E[1]=(qe*Pi-Ge*Ri-gt*Ji)*Y,E[2]=(mt*Jn-yt*Er+hr*qr)*Y,E[3]=(Mr*Er-sr*Jn-Nr*qr)*Y,E[4]=(Vt*$i-St*Ri-qt*Ti)*Y,E[5]=(be*Ri-qe*$i+gt*Ti)*Y,E[6]=(yt*Jr-tt*Jn-hr*Zr)*Y,E[7]=(ie*Jn-Mr*Jr+Nr*Zr)*Y,E[8]=(St*Pi-Ct*$i+qt*Wn)*Y,E[9]=(Ge*$i-be*Pi-gt*Wn)*Y,E[10]=(tt*Er-mt*Jr+hr*Gr)*Y,E[11]=(sr*Jr-ie*Er-Nr*Gr)*Y,E[12]=(Ct*Ti-St*Ji-Vt*Wn)*Y,E[13]=(be*Ji-Ge*Ti+qe*Wn)*Y,E[14]=(mt*Zr-tt*qr-yt*Gr)*Y,E[15]=(ie*qr-sr*Zr+Mr*Gr)*Y,E):null}function Ne(E,Z){var be=Z[0],Ge=Z[1],qe=Z[2],gt=Z[3],St=Z[4],Ct=Z[5],Vt=Z[6],qt=Z[7],ie=Z[8],sr=Z[9],Mr=Z[10],Nr=Z[11],tt=Z[12],mt=Z[13],yt=Z[14],hr=Z[15];return E[0]=Ct*(Mr*hr-Nr*yt)-sr*(Vt*hr-qt*yt)+mt*(Vt*Nr-qt*Mr),E[1]=-(Ge*(Mr*hr-Nr*yt)-sr*(qe*hr-gt*yt)+mt*(qe*Nr-gt*Mr)),E[2]=Ge*(Vt*hr-qt*yt)-Ct*(qe*hr-gt*yt)+mt*(qe*qt-gt*Vt),E[3]=-(Ge*(Vt*Nr-qt*Mr)-Ct*(qe*Nr-gt*Mr)+sr*(qe*qt-gt*Vt)),E[4]=-(St*(Mr*hr-Nr*yt)-ie*(Vt*hr-qt*yt)+tt*(Vt*Nr-qt*Mr)),E[5]=be*(Mr*hr-Nr*yt)-ie*(qe*hr-gt*yt)+tt*(qe*Nr-gt*Mr),E[6]=-(be*(Vt*hr-qt*yt)-St*(qe*hr-gt*yt)+tt*(qe*qt-gt*Vt)),E[7]=be*(Vt*Nr-qt*Mr)-St*(qe*Nr-gt*Mr)+ie*(qe*qt-gt*Vt),E[8]=St*(sr*hr-Nr*mt)-ie*(Ct*hr-qt*mt)+tt*(Ct*Nr-qt*sr),E[9]=-(be*(sr*hr-Nr*mt)-ie*(Ge*hr-gt*mt)+tt*(Ge*Nr-gt*sr)),E[10]=be*(Ct*hr-qt*mt)-St*(Ge*hr-gt*mt)+tt*(Ge*qt-gt*Ct),E[11]=-(be*(Ct*Nr-qt*sr)-St*(Ge*Nr-gt*sr)+ie*(Ge*qt-gt*Ct)),E[12]=-(St*(sr*yt-Mr*mt)-ie*(Ct*yt-Vt*mt)+tt*(Ct*Mr-Vt*sr)),E[13]=be*(sr*yt-Mr*mt)-ie*(Ge*yt-qe*mt)+tt*(Ge*Mr-qe*sr),E[14]=-(be*(Ct*yt-Vt*mt)-St*(Ge*yt-qe*mt)+tt*(Ge*Vt-qe*Ct)),E[15]=be*(Ct*Mr-Vt*sr)-St*(Ge*Mr-qe*sr)+ie*(Ge*Vt-qe*Ct),E}function Ye(E){var Z=E[0],be=E[1],Ge=E[2],qe=E[3],gt=E[4],St=E[5],Ct=E[6],Vt=E[7],qt=E[8],ie=E[9],sr=E[10],Mr=E[11],Nr=E[12],tt=E[13],mt=E[14],yt=E[15],hr=Z*St-be*gt,Gr=Z*Ct-Ge*gt,Zr=Z*Vt-qe*gt,Jr=be*Ct-Ge*St,qr=be*Vt-qe*St,Er=Ge*Vt-qe*Ct,Jn=qt*tt-ie*Nr,Wn=qt*mt-sr*Nr,Ti=qt*yt-Mr*Nr,$i=ie*mt-sr*tt,Ji=ie*yt-Mr*tt,Pi=sr*yt-Mr*mt;return hr*Pi-Gr*Ji+Zr*$i+Jr*Ti-qr*Wn+Er*Jn}function Je(E,Z,be){var Ge=Z[0],qe=Z[1],gt=Z[2],St=Z[3],Ct=Z[4],Vt=Z[5],qt=Z[6],ie=Z[7],sr=Z[8],Mr=Z[9],Nr=Z[10],tt=Z[11],mt=Z[12],yt=Z[13],hr=Z[14],Gr=Z[15],Zr=be[0],Jr=be[1],qr=be[2],Er=be[3];return E[0]=Zr*Ge+Jr*Ct+qr*sr+Er*mt,E[1]=Zr*qe+Jr*Vt+qr*Mr+Er*yt,E[2]=Zr*gt+Jr*qt+qr*Nr+Er*hr,E[3]=Zr*St+Jr*ie+qr*tt+Er*Gr,Zr=be[4],Jr=be[5],qr=be[6],Er=be[7],E[4]=Zr*Ge+Jr*Ct+qr*sr+Er*mt,E[5]=Zr*qe+Jr*Vt+qr*Mr+Er*yt,E[6]=Zr*gt+Jr*qt+qr*Nr+Er*hr,E[7]=Zr*St+Jr*ie+qr*tt+Er*Gr,Zr=be[8],Jr=be[9],qr=be[10],Er=be[11],E[8]=Zr*Ge+Jr*Ct+qr*sr+Er*mt,E[9]=Zr*qe+Jr*Vt+qr*Mr+Er*yt,E[10]=Zr*gt+Jr*qt+qr*Nr+Er*hr,E[11]=Zr*St+Jr*ie+qr*tt+Er*Gr,Zr=be[12],Jr=be[13],qr=be[14],Er=be[15],E[12]=Zr*Ge+Jr*Ct+qr*sr+Er*mt,E[13]=Zr*qe+Jr*Vt+qr*Mr+Er*yt,E[14]=Zr*gt+Jr*qt+qr*Nr+Er*hr,E[15]=Zr*St+Jr*ie+qr*tt+Er*Gr,E}function rt(E,Z,be){var Ge=be[0],qe=be[1],gt=be[2],St,Ct,Vt,qt,ie,sr,Mr,Nr,tt,mt,yt,hr;return Z===E?(E[12]=Z[0]*Ge+Z[4]*qe+Z[8]*gt+Z[12],E[13]=Z[1]*Ge+Z[5]*qe+Z[9]*gt+Z[13],E[14]=Z[2]*Ge+Z[6]*qe+Z[10]*gt+Z[14],E[15]=Z[3]*Ge+Z[7]*qe+Z[11]*gt+Z[15]):(St=Z[0],Ct=Z[1],Vt=Z[2],qt=Z[3],ie=Z[4],sr=Z[5],Mr=Z[6],Nr=Z[7],tt=Z[8],mt=Z[9],yt=Z[10],hr=Z[11],E[0]=St,E[1]=Ct,E[2]=Vt,E[3]=qt,E[4]=ie,E[5]=sr,E[6]=Mr,E[7]=Nr,E[8]=tt,E[9]=mt,E[10]=yt,E[11]=hr,E[12]=St*Ge+ie*qe+tt*gt+Z[12],E[13]=Ct*Ge+sr*qe+mt*gt+Z[13],E[14]=Vt*Ge+Mr*qe+yt*gt+Z[14],E[15]=qt*Ge+Nr*qe+hr*gt+Z[15]),E}function Xt(E,Z,be){var Ge=be[0],qe=be[1],gt=be[2];return E[0]=Z[0]*Ge,E[1]=Z[1]*Ge,E[2]=Z[2]*Ge,E[3]=Z[3]*Ge,E[4]=Z[4]*qe,E[5]=Z[5]*qe,E[6]=Z[6]*qe,E[7]=Z[7]*qe,E[8]=Z[8]*gt,E[9]=Z[9]*gt,E[10]=Z[10]*gt,E[11]=Z[11]*gt,E[12]=Z[12],E[13]=Z[13],E[14]=Z[14],E[15]=Z[15],E}function Gt(E,Z,be,Ge){var qe=Ge[0],gt=Ge[1],St=Ge[2],Ct=Math.hypot(qe,gt,St),Vt,qt,ie,sr,Mr,Nr,tt,mt,yt,hr,Gr,Zr,Jr,qr,Er,Jn,Wn,Ti,$i,Ji,Pi,Ri,Y,ce;return Ct<ue.Ib?null:(Ct=1/Ct,qe*=Ct,gt*=Ct,St*=Ct,Vt=Math.sin(be),qt=Math.cos(be),ie=1-qt,sr=Z[0],Mr=Z[1],Nr=Z[2],tt=Z[3],mt=Z[4],yt=Z[5],hr=Z[6],Gr=Z[7],Zr=Z[8],Jr=Z[9],qr=Z[10],Er=Z[11],Jn=qe*qe*ie+qt,Wn=gt*qe*ie+St*Vt,Ti=St*qe*ie-gt*Vt,$i=qe*gt*ie-St*Vt,Ji=gt*gt*ie+qt,Pi=St*gt*ie+qe*Vt,Ri=qe*St*ie+gt*Vt,Y=gt*St*ie-qe*Vt,ce=St*St*ie+qt,E[0]=sr*Jn+mt*Wn+Zr*Ti,E[1]=Mr*Jn+yt*Wn+Jr*Ti,E[2]=Nr*Jn+hr*Wn+qr*Ti,E[3]=tt*Jn+Gr*Wn+Er*Ti,E[4]=sr*$i+mt*Ji+Zr*Pi,E[5]=Mr*$i+yt*Ji+Jr*Pi,E[6]=Nr*$i+hr*Ji+qr*Pi,E[7]=tt*$i+Gr*Ji+Er*Pi,E[8]=sr*Ri+mt*Y+Zr*ce,E[9]=Mr*Ri+yt*Y+Jr*ce,E[10]=Nr*Ri+hr*Y+qr*ce,E[11]=tt*Ri+Gr*Y+Er*ce,Z!==E&&(E[12]=Z[12],E[13]=Z[13],E[14]=Z[14],E[15]=Z[15]),E)}function nr(E,Z,be){var Ge=Math.sin(be),qe=Math.cos(be),gt=Z[4],St=Z[5],Ct=Z[6],Vt=Z[7],qt=Z[8],ie=Z[9],sr=Z[10],Mr=Z[11];return Z!==E&&(E[0]=Z[0],E[1]=Z[1],E[2]=Z[2],E[3]=Z[3],E[12]=Z[12],E[13]=Z[13],E[14]=Z[14],E[15]=Z[15]),E[4]=gt*qe+qt*Ge,E[5]=St*qe+ie*Ge,E[6]=Ct*qe+sr*Ge,E[7]=Vt*qe+Mr*Ge,E[8]=qt*qe-gt*Ge,E[9]=ie*qe-St*Ge,E[10]=sr*qe-Ct*Ge,E[11]=Mr*qe-Vt*Ge,E}function Ut(E,Z,be){var Ge=Math.sin(be),qe=Math.cos(be),gt=Z[0],St=Z[1],Ct=Z[2],Vt=Z[3],qt=Z[8],ie=Z[9],sr=Z[10],Mr=Z[11];return Z!==E&&(E[4]=Z[4],E[5]=Z[5],E[6]=Z[6],E[7]=Z[7],E[12]=Z[12],E[13]=Z[13],E[14]=Z[14],E[15]=Z[15]),E[0]=gt*qe-qt*Ge,E[1]=St*qe-ie*Ge,E[2]=Ct*qe-sr*Ge,E[3]=Vt*qe-Mr*Ge,E[8]=gt*Ge+qt*qe,E[9]=St*Ge+ie*qe,E[10]=Ct*Ge+sr*qe,E[11]=Vt*Ge+Mr*qe,E}function At(E,Z,be){var Ge=Math.sin(be),qe=Math.cos(be),gt=Z[0],St=Z[1],Ct=Z[2],Vt=Z[3],qt=Z[4],ie=Z[5],sr=Z[6],Mr=Z[7];return Z!==E&&(E[8]=Z[8],E[9]=Z[9],E[10]=Z[10],E[11]=Z[11],E[12]=Z[12],E[13]=Z[13],E[14]=Z[14],E[15]=Z[15]),E[0]=gt*qe+qt*Ge,E[1]=St*qe+ie*Ge,E[2]=Ct*qe+sr*Ge,E[3]=Vt*qe+Mr*Ge,E[4]=qt*qe-gt*Ge,E[5]=ie*qe-St*Ge,E[6]=sr*qe-Ct*Ge,E[7]=Mr*qe-Vt*Ge,E}function Et(E,Z){return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=Z[0],E[13]=Z[1],E[14]=Z[2],E[15]=1,E}function dr(E,Z){return E[0]=Z[0],E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=Z[1],E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=Z[2],E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function re(E,Z,be){var Ge=be[0],qe=be[1],gt=be[2],St=Math.hypot(Ge,qe,gt),Ct,Vt,qt;return St<ue.Ib?null:(St=1/St,Ge*=St,qe*=St,gt*=St,Ct=Math.sin(Z),Vt=Math.cos(Z),qt=1-Vt,E[0]=Ge*Ge*qt+Vt,E[1]=qe*Ge*qt+gt*Ct,E[2]=gt*Ge*qt-qe*Ct,E[3]=0,E[4]=Ge*qe*qt-gt*Ct,E[5]=qe*qe*qt+Vt,E[6]=gt*qe*qt+Ge*Ct,E[7]=0,E[8]=Ge*gt*qt+qe*Ct,E[9]=qe*gt*qt-Ge*Ct,E[10]=gt*gt*qt+Vt,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E)}function mr(E,Z){var be=Math.sin(Z),Ge=Math.cos(Z);return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=Ge,E[6]=be,E[7]=0,E[8]=0,E[9]=-be,E[10]=Ge,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function wt(E,Z){var be=Math.sin(Z),Ge=Math.cos(Z);return E[0]=Ge,E[1]=0,E[2]=-be,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=be,E[9]=0,E[10]=Ge,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function Ke(E,Z){var be=Math.sin(Z),Ge=Math.cos(Z);return E[0]=Ge,E[1]=be,E[2]=0,E[3]=0,E[4]=-be,E[5]=Ge,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function Dt(E,Z,be){var Ge=Z[0],qe=Z[1],gt=Z[2],St=Z[3],Ct=Ge+Ge,Vt=qe+qe,qt=gt+gt,ie=Ge*Ct,sr=Ge*Vt,Mr=Ge*qt,Nr=qe*Vt,tt=qe*qt,mt=gt*qt,yt=St*Ct,hr=St*Vt,Gr=St*qt;return E[0]=1-(Nr+mt),E[1]=sr+Gr,E[2]=Mr-hr,E[3]=0,E[4]=sr-Gr,E[5]=1-(ie+mt),E[6]=tt+yt,E[7]=0,E[8]=Mr+hr,E[9]=tt-yt,E[10]=1-(ie+Nr),E[11]=0,E[12]=be[0],E[13]=be[1],E[14]=be[2],E[15]=1,E}function Xe(E,Z){var be=new ue.WT(3),Ge=-Z[0],qe=-Z[1],gt=-Z[2],St=Z[3],Ct=Z[4],Vt=Z[5],qt=Z[6],ie=Z[7],sr=Ge*Ge+qe*qe+gt*gt+St*St;return sr>0?(be[0]=(Ct*St+ie*Ge+Vt*gt-qt*qe)*2/sr,be[1]=(Vt*St+ie*qe+qt*Ge-Ct*gt)*2/sr,be[2]=(qt*St+ie*gt+Ct*qe-Vt*Ge)*2/sr):(be[0]=(Ct*St+ie*Ge+Vt*gt-qt*qe)*2,be[1]=(Vt*St+ie*qe+qt*Ge-Ct*gt)*2,be[2]=(qt*St+ie*gt+Ct*qe-Vt*Ge)*2),Dt(E,Z,be),E}function Zt(E,Z){return E[0]=Z[12],E[1]=Z[13],E[2]=Z[14],E}function yr(E,Z){var be=Z[0],Ge=Z[1],qe=Z[2],gt=Z[4],St=Z[5],Ct=Z[6],Vt=Z[8],qt=Z[9],ie=Z[10];return E[0]=Math.hypot(be,Ge,qe),E[1]=Math.hypot(gt,St,Ct),E[2]=Math.hypot(Vt,qt,ie),E}function ur(E,Z){var be=new ue.WT(3);yr(be,Z);var Ge=1/be[0],qe=1/be[1],gt=1/be[2],St=Z[0]*Ge,Ct=Z[1]*qe,Vt=Z[2]*gt,qt=Z[4]*Ge,ie=Z[5]*qe,sr=Z[6]*gt,Mr=Z[8]*Ge,Nr=Z[9]*qe,tt=Z[10]*gt,mt=St+ie+tt,yt=0;return mt>0?(yt=Math.sqrt(mt+1)*2,E[3]=.25*yt,E[0]=(sr-Nr)/yt,E[1]=(Mr-Vt)/yt,E[2]=(Ct-qt)/yt):St>ie&&St>tt?(yt=Math.sqrt(1+St-ie-tt)*2,E[3]=(sr-Nr)/yt,E[0]=.25*yt,E[1]=(Ct+qt)/yt,E[2]=(Mr+Vt)/yt):ie>tt?(yt=Math.sqrt(1+ie-St-tt)*2,E[3]=(Mr-Vt)/yt,E[0]=(Ct+qt)/yt,E[1]=.25*yt,E[2]=(sr+Nr)/yt):(yt=Math.sqrt(1+tt-St-ie)*2,E[3]=(Ct-qt)/yt,E[0]=(Mr+Vt)/yt,E[1]=(sr+Nr)/yt,E[2]=.25*yt),E}function Ur(E,Z,be,Ge){var qe=Z[0],gt=Z[1],St=Z[2],Ct=Z[3],Vt=qe+qe,qt=gt+gt,ie=St+St,sr=qe*Vt,Mr=qe*qt,Nr=qe*ie,tt=gt*qt,mt=gt*ie,yt=St*ie,hr=Ct*Vt,Gr=Ct*qt,Zr=Ct*ie,Jr=Ge[0],qr=Ge[1],Er=Ge[2];return E[0]=(1-(tt+yt))*Jr,E[1]=(Mr+Zr)*Jr,E[2]=(Nr-Gr)*Jr,E[3]=0,E[4]=(Mr-Zr)*qr,E[5]=(1-(sr+yt))*qr,E[6]=(mt+hr)*qr,E[7]=0,E[8]=(Nr+Gr)*Er,E[9]=(mt-hr)*Er,E[10]=(1-(sr+tt))*Er,E[11]=0,E[12]=be[0],E[13]=be[1],E[14]=be[2],E[15]=1,E}function he(E,Z,be,Ge,qe){var gt=Z[0],St=Z[1],Ct=Z[2],Vt=Z[3],qt=gt+gt,ie=St+St,sr=Ct+Ct,Mr=gt*qt,Nr=gt*ie,tt=gt*sr,mt=St*ie,yt=St*sr,hr=Ct*sr,Gr=Vt*qt,Zr=Vt*ie,Jr=Vt*sr,qr=Ge[0],Er=Ge[1],Jn=Ge[2],Wn=qe[0],Ti=qe[1],$i=qe[2],Ji=(1-(mt+hr))*qr,Pi=(Nr+Jr)*qr,Ri=(tt-Zr)*qr,Y=(Nr-Jr)*Er,ce=(1-(Mr+hr))*Er,me=(yt+Gr)*Er,z=(tt+Zr)*Jn,oe=(yt-Gr)*Jn,de=(1-(Mr+mt))*Jn;return E[0]=Ji,E[1]=Pi,E[2]=Ri,E[3]=0,E[4]=Y,E[5]=ce,E[6]=me,E[7]=0,E[8]=z,E[9]=oe,E[10]=de,E[11]=0,E[12]=be[0]+Wn-(Ji*Wn+Y*Ti+z*$i),E[13]=be[1]+Ti-(Pi*Wn+ce*Ti+oe*$i),E[14]=be[2]+$i-(Ri*Wn+me*Ti+de*$i),E[15]=1,E}function Re(E,Z){var be=Z[0],Ge=Z[1],qe=Z[2],gt=Z[3],St=be+be,Ct=Ge+Ge,Vt=qe+qe,qt=be*St,ie=Ge*St,sr=Ge*Ct,Mr=qe*St,Nr=qe*Ct,tt=qe*Vt,mt=gt*St,yt=gt*Ct,hr=gt*Vt;return E[0]=1-sr-tt,E[1]=ie+hr,E[2]=Mr-yt,E[3]=0,E[4]=ie-hr,E[5]=1-qt-tt,E[6]=Nr+mt,E[7]=0,E[8]=Mr+yt,E[9]=Nr-mt,E[10]=1-qt-sr,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function ge(E,Z,be,Ge,qe,gt,St){var Ct=1/(be-Z),Vt=1/(qe-Ge),qt=1/(gt-St);return E[0]=gt*2*Ct,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=gt*2*Vt,E[6]=0,E[7]=0,E[8]=(be+Z)*Ct,E[9]=(qe+Ge)*Vt,E[10]=(St+gt)*qt,E[11]=-1,E[12]=0,E[13]=0,E[14]=St*gt*2*qt,E[15]=0,E}function _t(E,Z,be,Ge,qe){var gt=1/Math.tan(Z/2),St;return E[0]=gt/be,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=gt,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=-1,E[12]=0,E[13]=0,E[15]=0,qe!=null&&qe!==Infinity?(St=1/(Ge-qe),E[10]=(qe+Ge)*St,E[14]=2*qe*Ge*St):(E[10]=-1,E[14]=-2*Ge),E}function pt(E,Z,be,Ge){var qe=Math.tan(Z.upDegrees*Math.PI/180),gt=Math.tan(Z.downDegrees*Math.PI/180),St=Math.tan(Z.leftDegrees*Math.PI/180),Ct=Math.tan(Z.rightDegrees*Math.PI/180),Vt=2/(St+Ct),qt=2/(qe+gt);return E[0]=Vt,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=qt,E[6]=0,E[7]=0,E[8]=-((St-Ct)*Vt*.5),E[9]=(qe-gt)*qt*.5,E[10]=Ge/(be-Ge),E[11]=-1,E[12]=0,E[13]=0,E[14]=Ge*be/(be-Ge),E[15]=0,E}function zt(E,Z,be,Ge,qe,gt,St){var Ct=1/(Z-be),Vt=1/(Ge-qe),qt=1/(gt-St);return E[0]=-2*Ct,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=-2*Vt,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=2*qt,E[11]=0,E[12]=(Z+be)*Ct,E[13]=(qe+Ge)*Vt,E[14]=(St+gt)*qt,E[15]=1,E}function Ft(E,Z,be,Ge){var qe,gt,St,Ct,Vt,qt,ie,sr,Mr,Nr,tt=Z[0],mt=Z[1],yt=Z[2],hr=Ge[0],Gr=Ge[1],Zr=Ge[2],Jr=be[0],qr=be[1],Er=be[2];return Math.abs(tt-Jr)<ue.Ib&&Math.abs(mt-qr)<ue.Ib&&Math.abs(yt-Er)<ue.Ib?W(E):(ie=tt-Jr,sr=mt-qr,Mr=yt-Er,Nr=1/Math.hypot(ie,sr,Mr),ie*=Nr,sr*=Nr,Mr*=Nr,qe=Gr*Mr-Zr*sr,gt=Zr*ie-hr*Mr,St=hr*sr-Gr*ie,Nr=Math.hypot(qe,gt,St),Nr?(Nr=1/Nr,qe*=Nr,gt*=Nr,St*=Nr):(qe=0,gt=0,St=0),Ct=sr*St-Mr*gt,Vt=Mr*qe-ie*St,qt=ie*gt-sr*qe,Nr=Math.hypot(Ct,Vt,qt),Nr?(Nr=1/Nr,Ct*=Nr,Vt*=Nr,qt*=Nr):(Ct=0,Vt=0,qt=0),E[0]=qe,E[1]=Ct,E[2]=ie,E[3]=0,E[4]=gt,E[5]=Vt,E[6]=sr,E[7]=0,E[8]=St,E[9]=qt,E[10]=Mr,E[11]=0,E[12]=-(qe*tt+gt*mt+St*yt),E[13]=-(Ct*tt+Vt*mt+qt*yt),E[14]=-(ie*tt+sr*mt+Mr*yt),E[15]=1,E)}function Dr(E,Z,be,Ge){var qe=Z[0],gt=Z[1],St=Z[2],Ct=Ge[0],Vt=Ge[1],qt=Ge[2],ie=qe-be[0],sr=gt-be[1],Mr=St-be[2],Nr=ie*ie+sr*sr+Mr*Mr;Nr>0&&(Nr=1/Math.sqrt(Nr),ie*=Nr,sr*=Nr,Mr*=Nr);var tt=Vt*Mr-qt*sr,mt=qt*ie-Ct*Mr,yt=Ct*sr-Vt*ie;return Nr=tt*tt+mt*mt+yt*yt,Nr>0&&(Nr=1/Math.sqrt(Nr),tt*=Nr,mt*=Nr,yt*=Nr),E[0]=tt,E[1]=mt,E[2]=yt,E[3]=0,E[4]=sr*yt-Mr*mt,E[5]=Mr*tt-ie*yt,E[6]=ie*mt-sr*tt,E[7]=0,E[8]=ie,E[9]=sr,E[10]=Mr,E[11]=0,E[12]=qe,E[13]=gt,E[14]=St,E[15]=1,E}function pn(E){return"mat4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+", "+E[4]+", "+E[5]+", "+E[6]+", "+E[7]+", "+E[8]+", "+E[9]+", "+E[10]+", "+E[11]+", "+E[12]+", "+E[13]+", "+E[14]+", "+E[15]+")"}function mn(E){return Math.hypot(E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15])}function Xi(E,Z,be){return E[0]=Z[0]+be[0],E[1]=Z[1]+be[1],E[2]=Z[2]+be[2],E[3]=Z[3]+be[3],E[4]=Z[4]+be[4],E[5]=Z[5]+be[5],E[6]=Z[6]+be[6],E[7]=Z[7]+be[7],E[8]=Z[8]+be[8],E[9]=Z[9]+be[9],E[10]=Z[10]+be[10],E[11]=Z[11]+be[11],E[12]=Z[12]+be[12],E[13]=Z[13]+be[13],E[14]=Z[14]+be[14],E[15]=Z[15]+be[15],E}function ir(E,Z,be){return E[0]=Z[0]-be[0],E[1]=Z[1]-be[1],E[2]=Z[2]-be[2],E[3]=Z[3]-be[3],E[4]=Z[4]-be[4],E[5]=Z[5]-be[5],E[6]=Z[6]-be[6],E[7]=Z[7]-be[7],E[8]=Z[8]-be[8],E[9]=Z[9]-be[9],E[10]=Z[10]-be[10],E[11]=Z[11]-be[11],E[12]=Z[12]-be[12],E[13]=Z[13]-be[13],E[14]=Z[14]-be[14],E[15]=Z[15]-be[15],E}function pe(E,Z,be){return E[0]=Z[0]*be,E[1]=Z[1]*be,E[2]=Z[2]*be,E[3]=Z[3]*be,E[4]=Z[4]*be,E[5]=Z[5]*be,E[6]=Z[6]*be,E[7]=Z[7]*be,E[8]=Z[8]*be,E[9]=Z[9]*be,E[10]=Z[10]*be,E[11]=Z[11]*be,E[12]=Z[12]*be,E[13]=Z[13]*be,E[14]=Z[14]*be,E[15]=Z[15]*be,E}function Pe(E,Z,be,Ge){return E[0]=Z[0]+be[0]*Ge,E[1]=Z[1]+be[1]*Ge,E[2]=Z[2]+be[2]*Ge,E[3]=Z[3]+be[3]*Ge,E[4]=Z[4]+be[4]*Ge,E[5]=Z[5]+be[5]*Ge,E[6]=Z[6]+be[6]*Ge,E[7]=Z[7]+be[7]*Ge,E[8]=Z[8]+be[8]*Ge,E[9]=Z[9]+be[9]*Ge,E[10]=Z[10]+be[10]*Ge,E[11]=Z[11]+be[11]*Ge,E[12]=Z[12]+be[12]*Ge,E[13]=Z[13]+be[13]*Ge,E[14]=Z[14]+be[14]*Ge,E[15]=Z[15]+be[15]*Ge,E}function Ze(E,Z){return E[0]===Z[0]&&E[1]===Z[1]&&E[2]===Z[2]&&E[3]===Z[3]&&E[4]===Z[4]&&E[5]===Z[5]&&E[6]===Z[6]&&E[7]===Z[7]&&E[8]===Z[8]&&E[9]===Z[9]&&E[10]===Z[10]&&E[11]===Z[11]&&E[12]===Z[12]&&E[13]===Z[13]&&E[14]===Z[14]&&E[15]===Z[15]}function Le(E,Z){var be=E[0],Ge=E[1],qe=E[2],gt=E[3],St=E[4],Ct=E[5],Vt=E[6],qt=E[7],ie=E[8],sr=E[9],Mr=E[10],Nr=E[11],tt=E[12],mt=E[13],yt=E[14],hr=E[15],Gr=Z[0],Zr=Z[1],Jr=Z[2],qr=Z[3],Er=Z[4],Jn=Z[5],Wn=Z[6],Ti=Z[7],$i=Z[8],Ji=Z[9],Pi=Z[10],Ri=Z[11],Y=Z[12],ce=Z[13],me=Z[14],z=Z[15];return Math.abs(be-Gr)<=ue.Ib*Math.max(1,Math.abs(be),Math.abs(Gr))&&Math.abs(Ge-Zr)<=ue.Ib*Math.max(1,Math.abs(Ge),Math.abs(Zr))&&Math.abs(qe-Jr)<=ue.Ib*Math.max(1,Math.abs(qe),Math.abs(Jr))&&Math.abs(gt-qr)<=ue.Ib*Math.max(1,Math.abs(gt),Math.abs(qr))&&Math.abs(St-Er)<=ue.Ib*Math.max(1,Math.abs(St),Math.abs(Er))&&Math.abs(Ct-Jn)<=ue.Ib*Math.max(1,Math.abs(Ct),Math.abs(Jn))&&Math.abs(Vt-Wn)<=ue.Ib*Math.max(1,Math.abs(Vt),Math.abs(Wn))&&Math.abs(qt-Ti)<=ue.Ib*Math.max(1,Math.abs(qt),Math.abs(Ti))&&Math.abs(ie-$i)<=ue.Ib*Math.max(1,Math.abs(ie),Math.abs($i))&&Math.abs(sr-Ji)<=ue.Ib*Math.max(1,Math.abs(sr),Math.abs(Ji))&&Math.abs(Mr-Pi)<=ue.Ib*Math.max(1,Math.abs(Mr),Math.abs(Pi))&&Math.abs(Nr-Ri)<=ue.Ib*Math.max(1,Math.abs(Nr),Math.abs(Ri))&&Math.abs(tt-Y)<=ue.Ib*Math.max(1,Math.abs(tt),Math.abs(Y))&&Math.abs(mt-ce)<=ue.Ib*Math.max(1,Math.abs(mt),Math.abs(ce))&&Math.abs(yt-me)<=ue.Ib*Math.max(1,Math.abs(yt),Math.abs(me))&&Math.abs(hr-z)<=ue.Ib*Math.max(1,Math.abs(hr),Math.abs(z))}var It=Je,tr=ir},86804:function(Lr,U,S){"use strict";S.d(U,{Ue:function(){return C},al:function(){return w},bA:function(){return nr},fF:function(){return ur}});var ue=S(32933);function C(){var pe=new ue.WT(4);return ue.WT!=Float32Array&&(pe[0]=0,pe[1]=0,pe[2]=0,pe[3]=0),pe}function p(pe){var Pe=new glMatrix.ARRAY_TYPE(4);return Pe[0]=pe[0],Pe[1]=pe[1],Pe[2]=pe[2],Pe[3]=pe[3],Pe}function w(pe,Pe,Ze,Le){var It=new ue.WT(4);return It[0]=pe,It[1]=Pe,It[2]=Ze,It[3]=Le,It}function q(pe,Pe){return pe[0]=Pe[0],pe[1]=Pe[1],pe[2]=Pe[2],pe[3]=Pe[3],pe}function K(pe,Pe,Ze,Le,It){return pe[0]=Pe,pe[1]=Ze,pe[2]=Le,pe[3]=It,pe}function W(pe,Pe,Ze){return pe[0]=Pe[0]+Ze[0],pe[1]=Pe[1]+Ze[1],pe[2]=Pe[2]+Ze[2],pe[3]=Pe[3]+Ze[3],pe}function L(pe,Pe,Ze){return pe[0]=Pe[0]-Ze[0],pe[1]=Pe[1]-Ze[1],pe[2]=Pe[2]-Ze[2],pe[3]=Pe[3]-Ze[3],pe}function N(pe,Pe,Ze){return pe[0]=Pe[0]*Ze[0],pe[1]=Pe[1]*Ze[1],pe[2]=Pe[2]*Ze[2],pe[3]=Pe[3]*Ze[3],pe}function Ne(pe,Pe,Ze){return pe[0]=Pe[0]/Ze[0],pe[1]=Pe[1]/Ze[1],pe[2]=Pe[2]/Ze[2],pe[3]=Pe[3]/Ze[3],pe}function Ye(pe,Pe){return pe[0]=Math.ceil(Pe[0]),pe[1]=Math.ceil(Pe[1]),pe[2]=Math.ceil(Pe[2]),pe[3]=Math.ceil(Pe[3]),pe}function Je(pe,Pe){return pe[0]=Math.floor(Pe[0]),pe[1]=Math.floor(Pe[1]),pe[2]=Math.floor(Pe[2]),pe[3]=Math.floor(Pe[3]),pe}function rt(pe,Pe,Ze){return pe[0]=Math.min(Pe[0],Ze[0]),pe[1]=Math.min(Pe[1],Ze[1]),pe[2]=Math.min(Pe[2],Ze[2]),pe[3]=Math.min(Pe[3],Ze[3]),pe}function Xt(pe,Pe,Ze){return pe[0]=Math.max(Pe[0],Ze[0]),pe[1]=Math.max(Pe[1],Ze[1]),pe[2]=Math.max(Pe[2],Ze[2]),pe[3]=Math.max(Pe[3],Ze[3]),pe}function Gt(pe,Pe){return pe[0]=Math.round(Pe[0]),pe[1]=Math.round(Pe[1]),pe[2]=Math.round(Pe[2]),pe[3]=Math.round(Pe[3]),pe}function nr(pe,Pe,Ze){return pe[0]=Pe[0]*Ze,pe[1]=Pe[1]*Ze,pe[2]=Pe[2]*Ze,pe[3]=Pe[3]*Ze,pe}function Ut(pe,Pe,Ze,Le){return pe[0]=Pe[0]+Ze[0]*Le,pe[1]=Pe[1]+Ze[1]*Le,pe[2]=Pe[2]+Ze[2]*Le,pe[3]=Pe[3]+Ze[3]*Le,pe}function At(pe,Pe){var Ze=Pe[0]-pe[0],Le=Pe[1]-pe[1],It=Pe[2]-pe[2],tr=Pe[3]-pe[3];return Math.hypot(Ze,Le,It,tr)}function Et(pe,Pe){var Ze=Pe[0]-pe[0],Le=Pe[1]-pe[1],It=Pe[2]-pe[2],tr=Pe[3]-pe[3];return Ze*Ze+Le*Le+It*It+tr*tr}function dr(pe){var Pe=pe[0],Ze=pe[1],Le=pe[2],It=pe[3];return Math.hypot(Pe,Ze,Le,It)}function re(pe){var Pe=pe[0],Ze=pe[1],Le=pe[2],It=pe[3];return Pe*Pe+Ze*Ze+Le*Le+It*It}function mr(pe,Pe){return pe[0]=-Pe[0],pe[1]=-Pe[1],pe[2]=-Pe[2],pe[3]=-Pe[3],pe}function wt(pe,Pe){return pe[0]=1/Pe[0],pe[1]=1/Pe[1],pe[2]=1/Pe[2],pe[3]=1/Pe[3],pe}function Ke(pe,Pe){var Ze=Pe[0],Le=Pe[1],It=Pe[2],tr=Pe[3],E=Ze*Ze+Le*Le+It*It+tr*tr;return E>0&&(E=1/Math.sqrt(E)),pe[0]=Ze*E,pe[1]=Le*E,pe[2]=It*E,pe[3]=tr*E,pe}function Dt(pe,Pe){return pe[0]*Pe[0]+pe[1]*Pe[1]+pe[2]*Pe[2]+pe[3]*Pe[3]}function Xe(pe,Pe,Ze,Le){var It=Ze[0]*Le[1]-Ze[1]*Le[0],tr=Ze[0]*Le[2]-Ze[2]*Le[0],E=Ze[0]*Le[3]-Ze[3]*Le[0],Z=Ze[1]*Le[2]-Ze[2]*Le[1],be=Ze[1]*Le[3]-Ze[3]*Le[1],Ge=Ze[2]*Le[3]-Ze[3]*Le[2],qe=Pe[0],gt=Pe[1],St=Pe[2],Ct=Pe[3];return pe[0]=gt*Ge-St*be+Ct*Z,pe[1]=-(qe*Ge)+St*E-Ct*tr,pe[2]=qe*be-gt*E+Ct*It,pe[3]=-(qe*Z)+gt*tr-St*It,pe}function Zt(pe,Pe,Ze,Le){var It=Pe[0],tr=Pe[1],E=Pe[2],Z=Pe[3];return pe[0]=It+Le*(Ze[0]-It),pe[1]=tr+Le*(Ze[1]-tr),pe[2]=E+Le*(Ze[2]-E),pe[3]=Z+Le*(Ze[3]-Z),pe}function yr(pe,Pe){Pe=Pe||1;var Ze,Le,It,tr,E,Z;do Ze=glMatrix.RANDOM()*2-1,Le=glMatrix.RANDOM()*2-1,E=Ze*Ze+Le*Le;while(E>=1);do It=glMatrix.RANDOM()*2-1,tr=glMatrix.RANDOM()*2-1,Z=It*It+tr*tr;while(Z>=1);var be=Math.sqrt((1-E)/Z);return pe[0]=Pe*Ze,pe[1]=Pe*Le,pe[2]=Pe*It*be,pe[3]=Pe*tr*be,pe}function ur(pe,Pe,Ze){var Le=Pe[0],It=Pe[1],tr=Pe[2],E=Pe[3];return pe[0]=Ze[0]*Le+Ze[4]*It+Ze[8]*tr+Ze[12]*E,pe[1]=Ze[1]*Le+Ze[5]*It+Ze[9]*tr+Ze[13]*E,pe[2]=Ze[2]*Le+Ze[6]*It+Ze[10]*tr+Ze[14]*E,pe[3]=Ze[3]*Le+Ze[7]*It+Ze[11]*tr+Ze[15]*E,pe}function Ur(pe,Pe,Ze){var Le=Pe[0],It=Pe[1],tr=Pe[2],E=Ze[0],Z=Ze[1],be=Ze[2],Ge=Ze[3],qe=Ge*Le+Z*tr-be*It,gt=Ge*It+be*Le-E*tr,St=Ge*tr+E*It-Z*Le,Ct=-E*Le-Z*It-be*tr;return pe[0]=qe*Ge+Ct*-E+gt*-be-St*-Z,pe[1]=gt*Ge+Ct*-Z+St*-E-qe*-be,pe[2]=St*Ge+Ct*-be+qe*-Z-gt*-E,pe[3]=Pe[3],pe}function he(pe){return pe[0]=0,pe[1]=0,pe[2]=0,pe[3]=0,pe}function Re(pe){return"vec4("+pe[0]+", "+pe[1]+", "+pe[2]+", "+pe[3]+")"}function ge(pe,Pe){return pe[0]===Pe[0]&&pe[1]===Pe[1]&&pe[2]===Pe[2]&&pe[3]===Pe[3]}function _t(pe,Pe){var Ze=pe[0],Le=pe[1],It=pe[2],tr=pe[3],E=Pe[0],Z=Pe[1],be=Pe[2],Ge=Pe[3];return Math.abs(Ze-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ze),Math.abs(E))&&Math.abs(Le-Z)<=glMatrix.EPSILON*Math.max(1,Math.abs(Le),Math.abs(Z))&&Math.abs(It-be)<=glMatrix.EPSILON*Math.max(1,Math.abs(It),Math.abs(be))&&Math.abs(tr-Ge)<=glMatrix.EPSILON*Math.max(1,Math.abs(tr),Math.abs(Ge))}var pt=null,zt=null,Ft=null,Dr=null,pn=null,mn=null,Xi=null,ir=function(){var pe=C();return function(Pe,Ze,Le,It,tr,E){var Z,be;for(Ze||(Ze=4),Le||(Le=0),It?be=Math.min(It*Ze+Le,Pe.length):be=Pe.length,Z=Le;Z<be;Z+=Ze)pe[0]=Pe[Z],pe[1]=Pe[Z+1],pe[2]=Pe[Z+2],pe[3]=Pe[Z+3],tr(pe,pe,E),Pe[Z]=pe[0],Pe[Z+1]=pe[1],Pe[Z+2]=pe[2],Pe[Z+3]=pe[3];return Pe}}()},83959:function(Lr,U,S){var ue;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(C,p,w,q){"use strict";var K=["","webkit","Moz","MS","ms","o"],W=p.createElement("div"),L="function",N=Math.round,Ne=Math.abs,Ye=Date.now;function Je(ye,De,ct){return setTimeout(dr(ye,ct),De)}function rt(ye,De,ct){return Array.isArray(ye)?(Xt(ye,ct[De],ct),!0):!1}function Xt(ye,De,ct){var Yt;if(!!ye)if(ye.forEach)ye.forEach(De,ct);else if(ye.length!==q)for(Yt=0;Yt<ye.length;)De.call(ct,ye[Yt],Yt,ye),Yt++;else for(Yt in ye)ye.hasOwnProperty(Yt)&&De.call(ct,ye[Yt],Yt,ye)}function Gt(ye,De,ct){var Yt="DEPRECATED METHOD: "+De+`
`+ct+` AT 
`;return function(){var Wr=new Error("get-stack-trace"),Qn=Wr&&Wr.stack?Wr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Si=C.console&&(C.console.warn||C.console.log);return Si&&Si.call(C.console,Yt,Qn),ye.apply(this,arguments)}}var nr;typeof Object.assign!="function"?nr=function(De){if(De===q||De===null)throw new TypeError("Cannot convert undefined or null to object");for(var ct=Object(De),Yt=1;Yt<arguments.length;Yt++){var Wr=arguments[Yt];if(Wr!==q&&Wr!==null)for(var Qn in Wr)Wr.hasOwnProperty(Qn)&&(ct[Qn]=Wr[Qn])}return ct}:nr=Object.assign;var Ut=Gt(function(De,ct,Yt){for(var Wr=Object.keys(ct),Qn=0;Qn<Wr.length;)(!Yt||Yt&&De[Wr[Qn]]===q)&&(De[Wr[Qn]]=ct[Wr[Qn]]),Qn++;return De},"extend","Use `assign`."),At=Gt(function(De,ct){return Ut(De,ct,!0)},"merge","Use `assign`.");function Et(ye,De,ct){var Yt=De.prototype,Wr;Wr=ye.prototype=Object.create(Yt),Wr.constructor=ye,Wr._super=Yt,ct&&nr(Wr,ct)}function dr(ye,De){return function(){return ye.apply(De,arguments)}}function re(ye,De){return typeof ye==L?ye.apply(De&&De[0]||q,De):ye}function mr(ye,De){return ye===q?De:ye}function wt(ye,De,ct){Xt(Zt(De),function(Yt){ye.addEventListener(Yt,ct,!1)})}function Ke(ye,De,ct){Xt(Zt(De),function(Yt){ye.removeEventListener(Yt,ct,!1)})}function Dt(ye,De){for(;ye;){if(ye==De)return!0;ye=ye.parentNode}return!1}function Xe(ye,De){return ye.indexOf(De)>-1}function Zt(ye){return ye.trim().split(/\s+/g)}function yr(ye,De,ct){if(ye.indexOf&&!ct)return ye.indexOf(De);for(var Yt=0;Yt<ye.length;){if(ct&&ye[Yt][ct]==De||!ct&&ye[Yt]===De)return Yt;Yt++}return-1}function ur(ye){return Array.prototype.slice.call(ye,0)}function Ur(ye,De,ct){for(var Yt=[],Wr=[],Qn=0;Qn<ye.length;){var Si=De?ye[Qn][De]:ye[Qn];yr(Wr,Si)<0&&Yt.push(ye[Qn]),Wr[Qn]=Si,Qn++}return ct&&(De?Yt=Yt.sort(function(vo,so){return vo[De]>so[De]}):Yt=Yt.sort()),Yt}function he(ye,De){for(var ct,Yt,Wr=De[0].toUpperCase()+De.slice(1),Qn=0;Qn<K.length;){if(ct=K[Qn],Yt=ct?ct+Wr:De,Yt in ye)return Yt;Qn++}return q}var Re=1;function ge(){return Re++}function _t(ye){var De=ye.ownerDocument||ye;return De.defaultView||De.parentWindow||C}var pt=/mobile|tablet|ip(ad|hone|od)|android/i,zt="ontouchstart"in C,Ft=he(C,"PointerEvent")!==q,Dr=zt&&pt.test(navigator.userAgent),pn="touch",mn="pen",Xi="mouse",ir="kinect",pe=25,Pe=1,Ze=2,Le=4,It=8,tr=1,E=2,Z=4,be=8,Ge=16,qe=E|Z,gt=be|Ge,St=qe|gt,Ct=["x","y"],Vt=["clientX","clientY"];function qt(ye,De){var ct=this;this.manager=ye,this.callback=De,this.element=ye.element,this.target=ye.options.inputTarget,this.domHandler=function(Yt){re(ye.options.enable,[ye])&&ct.handler(Yt)},this.init()}qt.prototype={handler:function(){},init:function(){this.evEl&&wt(this.element,this.evEl,this.domHandler),this.evTarget&&wt(this.target,this.evTarget,this.domHandler),this.evWin&&wt(_t(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ke(this.element,this.evEl,this.domHandler),this.evTarget&&Ke(this.target,this.evTarget,this.domHandler),this.evWin&&Ke(_t(this.element),this.evWin,this.domHandler)}};function ie(ye){var De,ct=ye.options.inputClass;return ct?De=ct:Ft?De=ce:Dr?De=dt:zt?De=Rr:De=$i,new De(ye,sr)}function sr(ye,De,ct){var Yt=ct.pointers.length,Wr=ct.changedPointers.length,Qn=De&Pe&&Yt-Wr==0,Si=De&(Le|It)&&Yt-Wr==0;ct.isFirst=!!Qn,ct.isFinal=!!Si,Qn&&(ye.session={}),ct.eventType=De,Mr(ye,ct),ye.emit("hammer.input",ct),ye.recognize(ct),ye.session.prevInput=ct}function Mr(ye,De){var ct=ye.session,Yt=De.pointers,Wr=Yt.length;ct.firstInput||(ct.firstInput=mt(De)),Wr>1&&!ct.firstMultiple?ct.firstMultiple=mt(De):Wr===1&&(ct.firstMultiple=!1);var Qn=ct.firstInput,Si=ct.firstMultiple,Za=Si?Si.center:Qn.center,vo=De.center=yt(Yt);De.timeStamp=Ye(),De.deltaTime=De.timeStamp-Qn.timeStamp,De.angle=Jr(Za,vo),De.distance=Zr(Za,vo),Nr(ct,De),De.offsetDirection=Gr(De.deltaX,De.deltaY);var so=hr(De.deltaTime,De.deltaX,De.deltaY);De.overallVelocityX=so.x,De.overallVelocityY=so.y,De.overallVelocity=Ne(so.x)>Ne(so.y)?so.x:so.y,De.scale=Si?Er(Si.pointers,Yt):1,De.rotation=Si?qr(Si.pointers,Yt):0,De.maxPointers=ct.prevInput?De.pointers.length>ct.prevInput.maxPointers?De.pointers.length:ct.prevInput.maxPointers:De.pointers.length,tt(ct,De);var es=ye.element;Dt(De.srcEvent.target,es)&&(es=De.srcEvent.target),De.target=es}function Nr(ye,De){var ct=De.center,Yt=ye.offsetDelta||{},Wr=ye.prevDelta||{},Qn=ye.prevInput||{};(De.eventType===Pe||Qn.eventType===Le)&&(Wr=ye.prevDelta={x:Qn.deltaX||0,y:Qn.deltaY||0},Yt=ye.offsetDelta={x:ct.x,y:ct.y}),De.deltaX=Wr.x+(ct.x-Yt.x),De.deltaY=Wr.y+(ct.y-Yt.y)}function tt(ye,De){var ct=ye.lastInterval||De,Yt=De.timeStamp-ct.timeStamp,Wr,Qn,Si,Za;if(De.eventType!=It&&(Yt>pe||ct.velocity===q)){var vo=De.deltaX-ct.deltaX,so=De.deltaY-ct.deltaY,es=hr(Yt,vo,so);Qn=es.x,Si=es.y,Wr=Ne(es.x)>Ne(es.y)?es.x:es.y,Za=Gr(vo,so),ye.lastInterval=De}else Wr=ct.velocity,Qn=ct.velocityX,Si=ct.velocityY,Za=ct.direction;De.velocity=Wr,De.velocityX=Qn,De.velocityY=Si,De.direction=Za}function mt(ye){for(var De=[],ct=0;ct<ye.pointers.length;)De[ct]={clientX:N(ye.pointers[ct].clientX),clientY:N(ye.pointers[ct].clientY)},ct++;return{timeStamp:Ye(),pointers:De,center:yt(De),deltaX:ye.deltaX,deltaY:ye.deltaY}}function yt(ye){var De=ye.length;if(De===1)return{x:N(ye[0].clientX),y:N(ye[0].clientY)};for(var ct=0,Yt=0,Wr=0;Wr<De;)ct+=ye[Wr].clientX,Yt+=ye[Wr].clientY,Wr++;return{x:N(ct/De),y:N(Yt/De)}}function hr(ye,De,ct){return{x:De/ye||0,y:ct/ye||0}}function Gr(ye,De){return ye===De?tr:Ne(ye)>=Ne(De)?ye<0?E:Z:De<0?be:Ge}function Zr(ye,De,ct){ct||(ct=Ct);var Yt=De[ct[0]]-ye[ct[0]],Wr=De[ct[1]]-ye[ct[1]];return Math.sqrt(Yt*Yt+Wr*Wr)}function Jr(ye,De,ct){ct||(ct=Ct);var Yt=De[ct[0]]-ye[ct[0]],Wr=De[ct[1]]-ye[ct[1]];return Math.atan2(Wr,Yt)*180/Math.PI}function qr(ye,De){return Jr(De[1],De[0],Vt)+Jr(ye[1],ye[0],Vt)}function Er(ye,De){return Zr(De[0],De[1],Vt)/Zr(ye[0],ye[1],Vt)}var Jn={mousedown:Pe,mousemove:Ze,mouseup:Le},Wn="mousedown",Ti="mousemove mouseup";function $i(){this.evEl=Wn,this.evWin=Ti,this.pressed=!1,qt.apply(this,arguments)}Et($i,qt,{handler:function(De){var ct=Jn[De.type];ct&Pe&&De.button===0&&(this.pressed=!0),ct&Ze&&De.which!==1&&(ct=Le),!!this.pressed&&(ct&Le&&(this.pressed=!1),this.callback(this.manager,ct,{pointers:[De],changedPointers:[De],pointerType:Xi,srcEvent:De}))}});var Ji={pointerdown:Pe,pointermove:Ze,pointerup:Le,pointercancel:It,pointerout:It},Pi={2:pn,3:mn,4:Xi,5:ir},Ri="pointerdown",Y="pointermove pointerup pointercancel";C.MSPointerEvent&&!C.PointerEvent&&(Ri="MSPointerDown",Y="MSPointerMove MSPointerUp MSPointerCancel");function ce(){this.evEl=Ri,this.evWin=Y,qt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Et(ce,qt,{handler:function(De){var ct=this.store,Yt=!1,Wr=De.type.toLowerCase().replace("ms",""),Qn=Ji[Wr],Si=Pi[De.pointerType]||De.pointerType,Za=Si==pn,vo=yr(ct,De.pointerId,"pointerId");Qn&Pe&&(De.button===0||Za)?vo<0&&(ct.push(De),vo=ct.length-1):Qn&(Le|It)&&(Yt=!0),!(vo<0)&&(ct[vo]=De,this.callback(this.manager,Qn,{pointers:ct,changedPointers:[De],pointerType:Si,srcEvent:De}),Yt&&ct.splice(vo,1))}});var me={touchstart:Pe,touchmove:Ze,touchend:Le,touchcancel:It},z="touchstart",oe="touchstart touchmove touchend touchcancel";function de(){this.evTarget=z,this.evWin=oe,this.started=!1,qt.apply(this,arguments)}Et(de,qt,{handler:function(De){var ct=me[De.type];if(ct===Pe&&(this.started=!0),!!this.started){var Yt=Ae.call(this,De,ct);ct&(Le|It)&&Yt[0].length-Yt[1].length==0&&(this.started=!1),this.callback(this.manager,ct,{pointers:Yt[0],changedPointers:Yt[1],pointerType:pn,srcEvent:De})}}});function Ae(ye,De){var ct=ur(ye.touches),Yt=ur(ye.changedTouches);return De&(Le|It)&&(ct=Ur(ct.concat(Yt),"identifier",!0)),[ct,Yt]}var se={touchstart:Pe,touchmove:Ze,touchend:Le,touchcancel:It},Ee="touchstart touchmove touchend touchcancel";function dt(){this.evTarget=Ee,this.targetIds={},qt.apply(this,arguments)}Et(dt,qt,{handler:function(De){var ct=se[De.type],Yt=br.call(this,De,ct);!Yt||this.callback(this.manager,ct,{pointers:Yt[0],changedPointers:Yt[1],pointerType:pn,srcEvent:De})}});function br(ye,De){var ct=ur(ye.touches),Yt=this.targetIds;if(De&(Pe|Ze)&&ct.length===1)return Yt[ct[0].identifier]=!0,[ct,ct];var Wr,Qn,Si=ur(ye.changedTouches),Za=[],vo=this.target;if(Qn=ct.filter(function(so){return Dt(so.target,vo)}),De===Pe)for(Wr=0;Wr<Qn.length;)Yt[Qn[Wr].identifier]=!0,Wr++;for(Wr=0;Wr<Si.length;)Yt[Si[Wr].identifier]&&Za.push(Si[Wr]),De&(Le|It)&&delete Yt[Si[Wr].identifier],Wr++;if(!!Za.length)return[Ur(Qn.concat(Za),"identifier",!0),Za]}var Ht=2500,Qt=25;function Rr(){qt.apply(this,arguments);var ye=dr(this.handler,this);this.touch=new dt(this.manager,ye),this.mouse=new $i(this.manager,ye),this.primaryTouch=null,this.lastTouches=[]}Et(Rr,qt,{handler:function(De,ct,Yt){var Wr=Yt.pointerType==pn,Qn=Yt.pointerType==Xi;if(!(Qn&&Yt.sourceCapabilities&&Yt.sourceCapabilities.firesTouchEvents)){if(Wr)kn.call(this,ct,Yt);else if(Qn&&$t.call(this,Yt))return;this.callback(De,ct,Yt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function kn(ye,De){ye&Pe?(this.primaryTouch=De.changedPointers[0].identifier,Ln.call(this,De)):ye&(Le|It)&&Ln.call(this,De)}function Ln(ye){var De=ye.changedPointers[0];if(De.identifier===this.primaryTouch){var ct={x:De.clientX,y:De.clientY};this.lastTouches.push(ct);var Yt=this.lastTouches,Wr=function(){var Qn=Yt.indexOf(ct);Qn>-1&&Yt.splice(Qn,1)};setTimeout(Wr,Ht)}}function $t(ye){for(var De=ye.srcEvent.clientX,ct=ye.srcEvent.clientY,Yt=0;Yt<this.lastTouches.length;Yt++){var Wr=this.lastTouches[Yt],Qn=Math.abs(De-Wr.x),Si=Math.abs(ct-Wr.y);if(Qn<=Qt&&Si<=Qt)return!0}return!1}var Cn=he(W.style,"touchAction"),sn=Cn!==q,an="compute",Ii="auto",xn="manipulation",Ai="none",Qi="pan-x",li="pan-y",Yi=sa();function Bi(ye,De){this.manager=ye,this.set(De)}Bi.prototype={set:function(ye){ye==an&&(ye=this.compute()),sn&&this.manager.element.style&&Yi[ye]&&(this.manager.element.style[Cn]=ye),this.actions=ye.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ye=[];return Xt(this.manager.recognizers,function(De){re(De.options.enable,[De])&&(ye=ye.concat(De.getTouchAction()))}),wi(ye.join(" "))},preventDefaults:function(ye){var De=ye.srcEvent,ct=ye.offsetDirection;if(this.manager.session.prevented){De.preventDefault();return}var Yt=this.actions,Wr=Xe(Yt,Ai)&&!Yi[Ai],Qn=Xe(Yt,li)&&!Yi[li],Si=Xe(Yt,Qi)&&!Yi[Qi];if(Wr){var Za=ye.pointers.length===1,vo=ye.distance<2,so=ye.deltaTime<250;if(Za&&vo&&so)return}if(!(Si&&Qn)&&(Wr||Qn&&ct&qe||Si&&ct&gt))return this.preventSrc(De)},preventSrc:function(ye){this.manager.session.prevented=!0,ye.preventDefault()}};function wi(ye){if(Xe(ye,Ai))return Ai;var De=Xe(ye,Qi),ct=Xe(ye,li);return De&&ct?Ai:De||ct?De?Qi:li:Xe(ye,xn)?xn:Ii}function sa(){if(!sn)return!1;var ye={},De=C.CSS&&C.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ct){ye[ct]=De?C.CSS.supports("touch-action",ct):!0}),ye}var Fi=1,ni=2,Di=4,Ei=8,no=Ei,ho=16,ta=32;function Vi(ye){this.options=nr({},this.defaults,ye||{}),this.id=ge(),this.manager=null,this.options.enable=mr(this.options.enable,!0),this.state=Fi,this.simultaneous={},this.requireFail=[]}Vi.prototype={defaults:{},set:function(ye){return nr(this.options,ye),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ye){if(rt(ye,"recognizeWith",this))return this;var De=this.simultaneous;return ye=Aa(ye,this),De[ye.id]||(De[ye.id]=ye,ye.recognizeWith(this)),this},dropRecognizeWith:function(ye){return rt(ye,"dropRecognizeWith",this)?this:(ye=Aa(ye,this),delete this.simultaneous[ye.id],this)},requireFailure:function(ye){if(rt(ye,"requireFailure",this))return this;var De=this.requireFail;return ye=Aa(ye,this),yr(De,ye)===-1&&(De.push(ye),ye.requireFailure(this)),this},dropRequireFailure:function(ye){if(rt(ye,"dropRequireFailure",this))return this;ye=Aa(ye,this);var De=yr(this.requireFail,ye);return De>-1&&this.requireFail.splice(De,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ye){return!!this.simultaneous[ye.id]},emit:function(ye){var De=this,ct=this.state;function Yt(Wr){De.manager.emit(Wr,ye)}ct<Ei&&Yt(De.options.event+Ns(ct)),Yt(De.options.event),ye.additionalEvent&&Yt(ye.additionalEvent),ct>=Ei&&Yt(De.options.event+Ns(ct))},tryEmit:function(ye){if(this.canEmit())return this.emit(ye);this.state=ta},canEmit:function(){for(var ye=0;ye<this.requireFail.length;){if(!(this.requireFail[ye].state&(ta|Fi)))return!1;ye++}return!0},recognize:function(ye){var De=nr({},ye);if(!re(this.options.enable,[this,De])){this.reset(),this.state=ta;return}this.state&(no|ho|ta)&&(this.state=Fi),this.state=this.process(De),this.state&(ni|Di|Ei|ho)&&this.tryEmit(De)},process:function(ye){},getTouchAction:function(){},reset:function(){}};function Ns(ye){return ye&ho?"cancel":ye&Ei?"end":ye&Di?"move":ye&ni?"start":""}function tu(ye){return ye==Ge?"down":ye==be?"up":ye==E?"left":ye==Z?"right":""}function Aa(ye,De){var ct=De.manager;return ct?ct.get(ye):ye}function No(){Vi.apply(this,arguments)}Et(No,Vi,{defaults:{pointers:1},attrTest:function(ye){var De=this.options.pointers;return De===0||ye.pointers.length===De},process:function(ye){var De=this.state,ct=ye.eventType,Yt=De&(ni|Di),Wr=this.attrTest(ye);return Yt&&(ct&It||!Wr)?De|ho:Yt||Wr?ct&Le?De|Ei:De&ni?De|Di:ni:ta}});function Gi(){No.apply(this,arguments),this.pX=null,this.pY=null}Et(Gi,No,{defaults:{event:"pan",threshold:10,pointers:1,direction:St},getTouchAction:function(){var ye=this.options.direction,De=[];return ye&qe&&De.push(li),ye&gt&&De.push(Qi),De},directionTest:function(ye){var De=this.options,ct=!0,Yt=ye.distance,Wr=ye.direction,Qn=ye.deltaX,Si=ye.deltaY;return Wr&De.direction||(De.direction&qe?(Wr=Qn===0?tr:Qn<0?E:Z,ct=Qn!=this.pX,Yt=Math.abs(ye.deltaX)):(Wr=Si===0?tr:Si<0?be:Ge,ct=Si!=this.pY,Yt=Math.abs(ye.deltaY))),ye.direction=Wr,ct&&Yt>De.threshold&&Wr&De.direction},attrTest:function(ye){return No.prototype.attrTest.call(this,ye)&&(this.state&ni||!(this.state&ni)&&this.directionTest(ye))},emit:function(ye){this.pX=ye.deltaX,this.pY=ye.deltaY;var De=tu(ye.direction);De&&(ye.additionalEvent=this.options.event+De),this._super.emit.call(this,ye)}});function Wa(){No.apply(this,arguments)}Et(Wa,No,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ai]},attrTest:function(ye){return this._super.attrTest.call(this,ye)&&(Math.abs(ye.scale-1)>this.options.threshold||this.state&ni)},emit:function(ye){if(ye.scale!==1){var De=ye.scale<1?"in":"out";ye.additionalEvent=this.options.event+De}this._super.emit.call(this,ye)}});function oo(){Vi.apply(this,arguments),this._timer=null,this._input=null}Et(oo,Vi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ii]},process:function(ye){var De=this.options,ct=ye.pointers.length===De.pointers,Yt=ye.distance<De.threshold,Wr=ye.deltaTime>De.time;if(this._input=ye,!Yt||!ct||ye.eventType&(Le|It)&&!Wr)this.reset();else if(ye.eventType&Pe)this.reset(),this._timer=Je(function(){this.state=no,this.tryEmit()},De.time,this);else if(ye.eventType&Le)return no;return ta},reset:function(){clearTimeout(this._timer)},emit:function(ye){this.state===no&&(ye&&ye.eventType&Le?this.manager.emit(this.options.event+"up",ye):(this._input.timeStamp=Ye(),this.manager.emit(this.options.event,this._input)))}});function ma(){No.apply(this,arguments)}Et(ma,No,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ai]},attrTest:function(ye){return this._super.attrTest.call(this,ye)&&(Math.abs(ye.rotation)>this.options.threshold||this.state&ni)}});function Lo(){No.apply(this,arguments)}Et(Lo,No,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:qe|gt,pointers:1},getTouchAction:function(){return Gi.prototype.getTouchAction.call(this)},attrTest:function(ye){var De=this.options.direction,ct;return De&(qe|gt)?ct=ye.overallVelocity:De&qe?ct=ye.overallVelocityX:De&gt&&(ct=ye.overallVelocityY),this._super.attrTest.call(this,ye)&&De&ye.offsetDirection&&ye.distance>this.options.threshold&&ye.maxPointers==this.options.pointers&&Ne(ct)>this.options.velocity&&ye.eventType&Le},emit:function(ye){var De=tu(ye.offsetDirection);De&&this.manager.emit(this.options.event+De,ye),this.manager.emit(this.options.event,ye)}});function ka(){Vi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Et(ka,Vi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[xn]},process:function(ye){var De=this.options,ct=ye.pointers.length===De.pointers,Yt=ye.distance<De.threshold,Wr=ye.deltaTime<De.time;if(this.reset(),ye.eventType&Pe&&this.count===0)return this.failTimeout();if(Yt&&Wr&&ct){if(ye.eventType!=Le)return this.failTimeout();var Qn=this.pTime?ye.timeStamp-this.pTime<De.interval:!0,Si=!this.pCenter||Zr(this.pCenter,ye.center)<De.posThreshold;this.pTime=ye.timeStamp,this.pCenter=ye.center,!Si||!Qn?this.count=1:this.count+=1,this._input=ye;var Za=this.count%De.taps;if(Za===0)return this.hasRequireFailures()?(this._timer=Je(function(){this.state=no,this.tryEmit()},De.interval,this),ni):no}return ta},failTimeout:function(){return this._timer=Je(function(){this.state=ta},this.options.interval,this),ta},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==no&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function bs(ye,De){return De=De||{},De.recognizers=mr(De.recognizers,bs.defaults.preset),new ga(ye,De)}bs.VERSION="2.0.7",bs.defaults={domEvents:!1,touchAction:an,enable:!0,inputTarget:null,inputClass:null,preset:[[ma,{enable:!1}],[Wa,{enable:!1},["rotate"]],[Lo,{direction:qe}],[Gi,{direction:qe},["swipe"]],[ka],[ka,{event:"doubletap",taps:2},["tap"]],[oo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ki=1,Ko=2;function ga(ye,De){this.options=nr({},bs.defaults,De||{}),this.options.inputTarget=this.options.inputTarget||ye,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ye,this.input=ie(this),this.touchAction=new Bi(this,this.options.touchAction),po(this,!0),Xt(this.options.recognizers,function(ct){var Yt=this.add(new ct[0](ct[1]));ct[2]&&Yt.recognizeWith(ct[2]),ct[3]&&Yt.requireFailure(ct[3])},this)}ga.prototype={set:function(ye){return nr(this.options,ye),ye.touchAction&&this.touchAction.update(),ye.inputTarget&&(this.input.destroy(),this.input.target=ye.inputTarget,this.input.init()),this},stop:function(ye){this.session.stopped=ye?Ko:ki},recognize:function(ye){var De=this.session;if(!De.stopped){this.touchAction.preventDefaults(ye);var ct,Yt=this.recognizers,Wr=De.curRecognizer;(!Wr||Wr&&Wr.state&no)&&(Wr=De.curRecognizer=null);for(var Qn=0;Qn<Yt.length;)ct=Yt[Qn],De.stopped!==Ko&&(!Wr||ct==Wr||ct.canRecognizeWith(Wr))?ct.recognize(ye):ct.reset(),!Wr&&ct.state&(ni|Di|Ei)&&(Wr=De.curRecognizer=ct),Qn++}},get:function(ye){if(ye instanceof Vi)return ye;for(var De=this.recognizers,ct=0;ct<De.length;ct++)if(De[ct].options.event==ye)return De[ct];return null},add:function(ye){if(rt(ye,"add",this))return this;var De=this.get(ye.options.event);return De&&this.remove(De),this.recognizers.push(ye),ye.manager=this,this.touchAction.update(),ye},remove:function(ye){if(rt(ye,"remove",this))return this;if(ye=this.get(ye),ye){var De=this.recognizers,ct=yr(De,ye);ct!==-1&&(De.splice(ct,1),this.touchAction.update())}return this},on:function(ye,De){if(ye!==q&&De!==q){var ct=this.handlers;return Xt(Zt(ye),function(Yt){ct[Yt]=ct[Yt]||[],ct[Yt].push(De)}),this}},off:function(ye,De){if(ye!==q){var ct=this.handlers;return Xt(Zt(ye),function(Yt){De?ct[Yt]&&ct[Yt].splice(yr(ct[Yt],De),1):delete ct[Yt]}),this}},emit:function(ye,De){this.options.domEvents&&Da(ye,De);var ct=this.handlers[ye]&&this.handlers[ye].slice();if(!(!ct||!ct.length)){De.type=ye,De.preventDefault=function(){De.srcEvent.preventDefault()};for(var Yt=0;Yt<ct.length;)ct[Yt](De),Yt++}},destroy:function(){this.element&&po(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function po(ye,De){var ct=ye.element;if(!!ct.style){var Yt;Xt(ye.options.cssProps,function(Wr,Qn){Yt=he(ct.style,Qn),De?(ye.oldCssProps[Yt]=ct.style[Yt],ct.style[Yt]=Wr):ct.style[Yt]=ye.oldCssProps[Yt]||""}),De||(ye.oldCssProps={})}}function Da(ye,De){var ct=p.createEvent("Event");ct.initEvent(ye,!0,!0),ct.gesture=De,De.target.dispatchEvent(ct)}nr(bs,{INPUT_START:Pe,INPUT_MOVE:Ze,INPUT_END:Le,INPUT_CANCEL:It,STATE_POSSIBLE:Fi,STATE_BEGAN:ni,STATE_CHANGED:Di,STATE_ENDED:Ei,STATE_RECOGNIZED:no,STATE_CANCELLED:ho,STATE_FAILED:ta,DIRECTION_NONE:tr,DIRECTION_LEFT:E,DIRECTION_RIGHT:Z,DIRECTION_UP:be,DIRECTION_DOWN:Ge,DIRECTION_HORIZONTAL:qe,DIRECTION_VERTICAL:gt,DIRECTION_ALL:St,Manager:ga,Input:qt,TouchAction:Bi,TouchInput:dt,MouseInput:$i,PointerEventInput:ce,TouchMouseInput:Rr,SingleTouchInput:de,Recognizer:Vi,AttrRecognizer:No,Tap:ka,Pan:Gi,Swipe:Lo,Pinch:Wa,Rotate:ma,Press:oo,on:wt,off:Ke,each:Xt,merge:At,extend:Ut,assign:nr,inherit:Et,bindFn:dr,prefixed:he});var So=typeof C!="undefined"?C:typeof self!="undefined"?self:{};So.Hammer=bs,ue=function(){return bs}.call(U,S,U,Lr),ue!==q&&(Lr.exports=ue)})(window,document,"Hammer")},3039:function(Lr,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0});var S=Symbol.for("INJECTION");function ue(K,W,L,N){function Ne(){return N&&!Reflect.hasMetadata(S,this,W)&&Reflect.defineMetadata(S,L(),this,W),Reflect.hasMetadata(S,this,W)?Reflect.getMetadata(S,this,W):L()}function Ye(Je){Reflect.defineMetadata(S,Je,this,W)}Object.defineProperty(K,W,{configurable:!0,enumerable:!0,get:Ne,set:Ye})}function C(K,W){return function(L){return function(N,Ne){var Ye=function(){return K.get(L)};ue(N,Ne,Ye,W)}}}U.makePropertyInjectDecorator=C;function p(K,W){return function(L,N){return function(Ne,Ye){var Je=function(){return K.getNamed(L,N)};ue(Ne,Ye,Je,W)}}}U.makePropertyInjectNamedDecorator=p;function w(K,W){return function(L,N,Ne){return function(Ye,Je){var rt=function(){return K.getTagged(L,N,Ne)};ue(Ye,Je,rt,W)}}}U.makePropertyInjectTaggedDecorator=w;function q(K,W){return function(L){return function(N,Ne){var Ye=function(){return K.getAll(L)};ue(N,Ne,Ye,W)}}}U.makePropertyMultiInjectDecorator=q},11922:function(Lr,U,S){"use strict";var ue;ue={value:!0};var C=S(3039);function p(w,q){q===void 0&&(q=!0);var K=C.makePropertyInjectDecorator(w,q),W=C.makePropertyInjectNamedDecorator(w,q),L=C.makePropertyInjectTaggedDecorator(w,q),N=C.makePropertyMultiInjectDecorator(w,q);return{lazyInject:K,lazyInjectNamed:W,lazyInjectTagged:L,lazyMultiInject:N}}U.Z=p},80626:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.tagProperty=U.tagParameter=U.decorate=void 0;var ue=S(36078),C=S(50295);function p(N,Ne,Ye,Je){var rt=C.TAGGED;q(rt,N,Ne,Je,Ye)}U.tagParameter=p;function w(N,Ne,Ye){var Je=C.TAGGED_PROP;q(Je,N.constructor,Ne,Ye)}U.tagProperty=w;function q(N,Ne,Ye,Je,rt){var Xt={},Gt=typeof rt=="number",nr=rt!==void 0&&Gt?rt.toString():Ye;if(Gt&&Ye!==void 0)throw new Error(ue.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(N,Ne)&&(Xt=Reflect.getMetadata(N,Ne));var Ut=Xt[nr];if(!Array.isArray(Ut))Ut=[];else for(var At=0,Et=Ut;At<Et.length;At++){var dr=Et[At];if(dr.key===Je.key)throw new Error(ue.DUPLICATED_METADATA+" "+dr.key.toString())}Ut.push(Je),Xt[nr]=Ut,Reflect.defineMetadata(N,Xt,Ne)}function K(N,Ne){Reflect.decorate(N,Ne)}function W(N,Ne){return function(Ye,Je){Ne(Ye,Je,N)}}function L(N,Ne,Ye){typeof Ye=="number"?K([W(Ye,N)],Ne):typeof Ye=="string"?Reflect.decorate([N],Ne,Ye):K([N],Ne)}U.decorate=L},76213:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.inject=U.LazyServiceIdentifer=void 0;var ue=S(36078),C=S(50295),p=S(25092),w=S(80626),q=function(){function W(L){this._cb=L}return W.prototype.unwrap=function(){return this._cb()},W}();U.LazyServiceIdentifer=q;function K(W){return function(L,N,Ne){if(W===void 0)throw new Error(ue.UNDEFINED_INJECT_ANNOTATION(L.name));var Ye=new p.Metadata(C.INJECT_TAG,W);typeof Ne=="number"?w.tagParameter(L,N,Ne,Ye):w.tagProperty(L,N,Ye)}}U.inject=K},91773:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.injectable=void 0;var ue=S(36078),C=S(50295);function p(){return function(w){if(Reflect.hasOwnMetadata(C.PARAM_TYPES,w))throw new Error(ue.DUPLICATED_INJECTABLE_DECORATOR);var q=Reflect.getMetadata(C.DESIGN_PARAM_TYPES,w)||[];return Reflect.defineMetadata(C.PARAM_TYPES,q,w),w}}U.injectable=p},41528:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.multiInject=void 0;var ue=S(50295),C=S(25092),p=S(80626);function w(q){return function(K,W,L){var N=new C.Metadata(ue.MULTI_INJECT_TAG,q);typeof L=="number"?p.tagParameter(K,W,L,N):p.tagProperty(K,W,N)}}U.multiInject=w},79817:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.named=void 0;var ue=S(50295),C=S(25092),p=S(80626);function w(q){return function(K,W,L){var N=new C.Metadata(ue.NAMED_TAG,q);typeof L=="number"?p.tagParameter(K,W,L,N):p.tagProperty(K,W,N)}}U.named=w},71316:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.optional=void 0;var ue=S(50295),C=S(25092),p=S(80626);function w(){return function(q,K,W){var L=new C.Metadata(ue.OPTIONAL_TAG,!0);typeof W=="number"?p.tagParameter(q,K,W,L):p.tagProperty(q,K,L)}}U.optional=w},71971:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.postConstruct=void 0;var ue=S(36078),C=S(50295),p=S(25092);function w(){return function(q,K,W){var L=new p.Metadata(C.POST_CONSTRUCT,K);if(Reflect.hasOwnMetadata(C.POST_CONSTRUCT,q.constructor))throw new Error(ue.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(C.POST_CONSTRUCT,L,q.constructor)}}U.postConstruct=w},79189:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.tagged=void 0;var ue=S(25092),C=S(80626);function p(w,q){return function(K,W,L){var N=new ue.Metadata(w,q);typeof L=="number"?C.tagParameter(K,W,L,N):C.tagProperty(K,W,N)}}U.tagged=p},8245:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.targetName=void 0;var ue=S(50295),C=S(25092),p=S(80626);function w(q){return function(K,W,L){var N=new C.Metadata(ue.NAME_TAG,q);p.tagParameter(K,W,L,N)}}U.targetName=w},19235:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.unmanaged=void 0;var ue=S(50295),C=S(25092),p=S(80626);function w(){return function(q,K,W){var L=new C.Metadata(ue.UNMANAGED_TAG,!0);p.tagParameter(q,K,W,L)}}U.unmanaged=w},30683:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Binding=void 0;var ue=S(77690),C=S(70023),p=function(){function w(q,K){this.id=C.id(),this.activated=!1,this.serviceIdentifier=q,this.scope=K,this.type=ue.BindingTypeEnum.Invalid,this.constraint=function(W){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return w.prototype.clone=function(){var q=new w(this.serviceIdentifier,this.scope);return q.activated=q.scope===ue.BindingScopeEnum.Singleton?this.activated:!1,q.implementationType=this.implementationType,q.dynamicValue=this.dynamicValue,q.scope=this.scope,q.type=this.type,q.factory=this.factory,q.provider=this.provider,q.constraint=this.constraint,q.onActivation=this.onActivation,q.cache=this.cache,q},w}();U.Binding=p},13497:function(Lr,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingCount=void 0;var S={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};U.BindingCount=S},36078:function(Lr,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.STACK_OVERFLOW=U.CIRCULAR_DEPENDENCY_IN_FACTORY=U.POST_CONSTRUCT_ERROR=U.MULTIPLE_POST_CONSTRUCT_METHODS=U.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=U.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=U.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=U.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=U.ARGUMENTS_LENGTH_MISMATCH=U.INVALID_DECORATOR_OPERATION=U.INVALID_TO_SELF_VALUE=U.INVALID_FUNCTION_BINDING=U.INVALID_MIDDLEWARE_RETURN=U.NO_MORE_SNAPSHOTS_AVAILABLE=U.INVALID_BINDING_TYPE=U.NOT_IMPLEMENTED=U.CIRCULAR_DEPENDENCY=U.UNDEFINED_INJECT_ANNOTATION=U.MISSING_INJECT_ANNOTATION=U.MISSING_INJECTABLE_ANNOTATION=U.NOT_REGISTERED=U.CANNOT_UNBIND=U.AMBIGUOUS_MATCH=U.KEY_NOT_FOUND=U.NULL_ARGUMENT=U.DUPLICATED_METADATA=U.DUPLICATED_INJECTABLE_DECORATOR=void 0,U.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",U.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",U.NULL_ARGUMENT="NULL argument",U.KEY_NOT_FOUND="Key Not Found",U.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",U.CANNOT_UNBIND="Could not unbind serviceIdentifier:",U.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",U.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",U.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var S=function(w){return"@inject called with undefined this could mean that the class "+w+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};U.UNDEFINED_INJECT_ANNOTATION=S,U.CIRCULAR_DEPENDENCY="Circular dependency found:",U.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",U.INVALID_BINDING_TYPE="Invalid binding type:",U.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",U.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",U.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",U.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",U.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ue=function(){for(var w=[],q=0;q<arguments.length;q++)w[q]=arguments[q];return"The number of constructor arguments in the derived class "+(w[0]+" must be >= than the number of constructor arguments of its base class.")};U.ARGUMENTS_LENGTH_MISMATCH=ue,U.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",U.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",U.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",U.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",U.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var C=function(){for(var w=[],q=0;q<arguments.length;q++)w[q]=arguments[q];return"@postConstruct error in class "+w[0]+": "+w[1]};U.POST_CONSTRUCT_ERROR=C;var p=function(){for(var w=[],q=0;q<arguments.length;q++)w[q]=arguments[q];return"It looks like there is a circular dependency "+("in one of the '"+w[0]+"' bindings. Please investigate bindings with")+("service identifier '"+w[1]+"'.")};U.CIRCULAR_DEPENDENCY_IN_FACTORY=p,U.STACK_OVERFLOW="Maximum call stack size exceeded"},77690:function(Lr,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.TargetTypeEnum=U.BindingTypeEnum=U.BindingScopeEnum=void 0;var S={Request:"Request",Singleton:"Singleton",Transient:"Transient"};U.BindingScopeEnum=S;var ue={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};U.BindingTypeEnum=ue;var C={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};U.TargetTypeEnum=C},50295:function(Lr,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.NON_CUSTOM_TAG_KEYS=U.POST_CONSTRUCT=U.DESIGN_PARAM_TYPES=U.PARAM_TYPES=U.TAGGED_PROP=U.TAGGED=U.MULTI_INJECT_TAG=U.INJECT_TAG=U.OPTIONAL_TAG=U.UNMANAGED_TAG=U.NAME_TAG=U.NAMED_TAG=void 0,U.NAMED_TAG="named",U.NAME_TAG="name",U.UNMANAGED_TAG="unmanaged",U.OPTIONAL_TAG="optional",U.INJECT_TAG="inject",U.MULTI_INJECT_TAG="multi_inject",U.TAGGED="inversify:tagged",U.TAGGED_PROP="inversify:tagged_props",U.PARAM_TYPES="inversify:paramtypes",U.DESIGN_PARAM_TYPES="design:paramtypes",U.POST_CONSTRUCT="post_construct";function S(){return[U.INJECT_TAG,U.MULTI_INJECT_TAG,U.NAME_TAG,U.UNMANAGED_TAG,U.NAMED_TAG,U.OPTIONAL_TAG]}U.NON_CUSTOM_TAG_KEYS=S()},70596:function(Lr,U,S){"use strict";var ue=this&&this.__awaiter||function(Ut,At,Et,dr){function re(mr){return mr instanceof Et?mr:new Et(function(wt){wt(mr)})}return new(Et||(Et=Promise))(function(mr,wt){function Ke(Zt){try{Xe(dr.next(Zt))}catch(yr){wt(yr)}}function Dt(Zt){try{Xe(dr.throw(Zt))}catch(yr){wt(yr)}}function Xe(Zt){Zt.done?mr(Zt.value):re(Zt.value).then(Ke,Dt)}Xe((dr=dr.apply(Ut,At||[])).next())})},C=this&&this.__generator||function(Ut,At){var Et={label:0,sent:function(){if(mr[0]&1)throw mr[1];return mr[1]},trys:[],ops:[]},dr,re,mr,wt;return wt={next:Ke(0),throw:Ke(1),return:Ke(2)},typeof Symbol=="function"&&(wt[Symbol.iterator]=function(){return this}),wt;function Ke(Xe){return function(Zt){return Dt([Xe,Zt])}}function Dt(Xe){if(dr)throw new TypeError("Generator is already executing.");for(;Et;)try{if(dr=1,re&&(mr=Xe[0]&2?re.return:Xe[0]?re.throw||((mr=re.return)&&mr.call(re),0):re.next)&&!(mr=mr.call(re,Xe[1])).done)return mr;switch(re=0,mr&&(Xe=[Xe[0]&2,mr.value]),Xe[0]){case 0:case 1:mr=Xe;break;case 4:return Et.label++,{value:Xe[1],done:!1};case 5:Et.label++,re=Xe[1],Xe=[0];continue;case 7:Xe=Et.ops.pop(),Et.trys.pop();continue;default:if(mr=Et.trys,!(mr=mr.length>0&&mr[mr.length-1])&&(Xe[0]===6||Xe[0]===2)){Et=0;continue}if(Xe[0]===3&&(!mr||Xe[1]>mr[0]&&Xe[1]<mr[3])){Et.label=Xe[1];break}if(Xe[0]===6&&Et.label<mr[1]){Et.label=mr[1],mr=Xe;break}if(mr&&Et.label<mr[2]){Et.label=mr[2],Et.ops.push(Xe);break}mr[2]&&Et.ops.pop(),Et.trys.pop();continue}Xe=At.call(Ut,Et)}catch(Zt){Xe=[6,Zt],re=0}finally{dr=mr=0}if(Xe[0]&5)throw Xe[1];return{value:Xe[0]?Xe[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(Ut,At){for(var Et=0,dr=At.length,re=Ut.length;Et<dr;Et++,re++)Ut[re]=At[Et];return Ut};Object.defineProperty(U,"__esModule",{value:!0}),U.Container=void 0;var w=S(30683),q=S(36078),K=S(77690),W=S(50295),L=S(43870),N=S(54142),Ne=S(9386),Ye=S(43313),Je=S(70023),rt=S(29552),Xt=S(71878),Gt=S(82543),nr=function(){function Ut(At){this._appliedMiddleware=[];var Et=At||{};if(typeof Et!="object")throw new Error(""+q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Et.defaultScope===void 0)Et.defaultScope=K.BindingScopeEnum.Transient;else if(Et.defaultScope!==K.BindingScopeEnum.Singleton&&Et.defaultScope!==K.BindingScopeEnum.Transient&&Et.defaultScope!==K.BindingScopeEnum.Request)throw new Error(""+q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Et.autoBindInjectable===void 0)Et.autoBindInjectable=!1;else if(typeof Et.autoBindInjectable!="boolean")throw new Error(""+q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Et.skipBaseClassChecks===void 0)Et.skipBaseClassChecks=!1;else if(typeof Et.skipBaseClassChecks!="boolean")throw new Error(""+q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Et.autoBindInjectable,defaultScope:Et.defaultScope,skipBaseClassChecks:Et.skipBaseClassChecks},this.id=Je.id(),this._bindingDictionary=new Gt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new L.MetadataReader}return Ut.merge=function(At,Et){for(var dr=[],re=2;re<arguments.length;re++)dr[re-2]=arguments[re];var mr=new Ut,wt=p([At,Et],dr).map(function(Xe){return N.getBindingDictionary(Xe)}),Ke=N.getBindingDictionary(mr);function Dt(Xe,Zt){Xe.traverse(function(yr,ur){ur.forEach(function(Ur){Zt.add(Ur.serviceIdentifier,Ur.clone())})})}return wt.forEach(function(Xe){Dt(Xe,Ke)}),mr},Ut.prototype.load=function(){for(var At=[],Et=0;Et<arguments.length;Et++)At[Et]=arguments[Et];for(var dr=this._getContainerModuleHelpersFactory(),re=0,mr=At;re<mr.length;re++){var wt=mr[re],Ke=dr(wt.id);wt.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)}},Ut.prototype.loadAsync=function(){for(var At=[],Et=0;Et<arguments.length;Et++)At[Et]=arguments[Et];return ue(this,void 0,void 0,function(){var dr,re,mr,wt,Ke;return C(this,function(Dt){switch(Dt.label){case 0:dr=this._getContainerModuleHelpersFactory(),re=0,mr=At,Dt.label=1;case 1:return re<mr.length?(wt=mr[re],Ke=dr(wt.id),[4,wt.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)]):[3,4];case 2:Dt.sent(),Dt.label=3;case 3:return re++,[3,1];case 4:return[2]}})})},Ut.prototype.unload=function(){for(var At=this,Et=[],dr=0;dr<arguments.length;dr++)Et[dr]=arguments[dr];var re=function(mr){return function(wt){return wt.moduleId===mr}};Et.forEach(function(mr){var wt=re(mr.id);At._bindingDictionary.removeByCondition(wt)})},Ut.prototype.bind=function(At){var Et=this.options.defaultScope||K.BindingScopeEnum.Transient,dr=new w.Binding(At,Et);return this._bindingDictionary.add(At,dr),new Ye.BindingToSyntax(dr)},Ut.prototype.rebind=function(At){return this.unbind(At),this.bind(At)},Ut.prototype.unbind=function(At){try{this._bindingDictionary.remove(At)}catch(Et){throw new Error(q.CANNOT_UNBIND+" "+rt.getServiceIdentifierAsString(At))}},Ut.prototype.unbindAll=function(){this._bindingDictionary=new Gt.Lookup},Ut.prototype.isBound=function(At){var Et=this._bindingDictionary.hasKey(At);return!Et&&this.parent&&(Et=this.parent.isBound(At)),Et},Ut.prototype.isBoundNamed=function(At,Et){return this.isBoundTagged(At,W.NAMED_TAG,Et)},Ut.prototype.isBoundTagged=function(At,Et,dr){var re=!1;if(this._bindingDictionary.hasKey(At)){var mr=this._bindingDictionary.get(At),wt=N.createMockRequest(this,At,Et,dr);re=mr.some(function(Ke){return Ke.constraint(wt)})}return!re&&this.parent&&(re=this.parent.isBoundTagged(At,Et,dr)),re},Ut.prototype.snapshot=function(){this._snapshots.push(Xt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ut.prototype.restore=function(){var At=this._snapshots.pop();if(At===void 0)throw new Error(q.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=At.bindings,this._middleware=At.middleware},Ut.prototype.createChild=function(At){var Et=new Ut(At||this.options);return Et.parent=this,Et},Ut.prototype.applyMiddleware=function(){for(var At=[],Et=0;Et<arguments.length;Et++)At[Et]=arguments[Et];this._appliedMiddleware=this._appliedMiddleware.concat(At);var dr=this._middleware?this._middleware:this._planAndResolve();this._middleware=At.reduce(function(re,mr){return mr(re)},dr)},Ut.prototype.applyCustomMetadataReader=function(At){this._metadataReader=At},Ut.prototype.get=function(At){return this._get(!1,!1,K.TargetTypeEnum.Variable,At)},Ut.prototype.getTagged=function(At,Et,dr){return this._get(!1,!1,K.TargetTypeEnum.Variable,At,Et,dr)},Ut.prototype.getNamed=function(At,Et){return this.getTagged(At,W.NAMED_TAG,Et)},Ut.prototype.getAll=function(At){return this._get(!0,!0,K.TargetTypeEnum.Variable,At)},Ut.prototype.getAllTagged=function(At,Et,dr){return this._get(!1,!0,K.TargetTypeEnum.Variable,At,Et,dr)},Ut.prototype.getAllNamed=function(At,Et){return this.getAllTagged(At,W.NAMED_TAG,Et)},Ut.prototype.resolve=function(At){var Et=this.createChild();return Et.bind(At).toSelf(),this._appliedMiddleware.forEach(function(dr){Et.applyMiddleware(dr)}),Et.get(At)},Ut.prototype._getContainerModuleHelpersFactory=function(){var At=this,Et=function(Ke,Dt){Ke._binding.moduleId=Dt},dr=function(Ke){return function(Dt){var Xe=At.bind.bind(At),Zt=Xe(Dt);return Et(Zt,Ke),Zt}},re=function(Ke){return function(Dt){var Xe=At.unbind.bind(At);Xe(Dt)}},mr=function(Ke){return function(Dt){var Xe=At.isBound.bind(At);return Xe(Dt)}},wt=function(Ke){return function(Dt){var Xe=At.rebind.bind(At),Zt=Xe(Dt);return Et(Zt,Ke),Zt}};return function(Ke){return{bindFunction:dr(Ke),isboundFunction:mr(Ke),rebindFunction:wt(Ke),unbindFunction:re(Ke)}}},Ut.prototype._get=function(At,Et,dr,re,mr,wt){var Ke=null,Dt={avoidConstraints:At,contextInterceptor:function(Xe){return Xe},isMultiInject:Et,key:mr,serviceIdentifier:re,targetType:dr,value:wt};if(this._middleware){if(Ke=this._middleware(Dt),Ke==null)throw new Error(q.INVALID_MIDDLEWARE_RETURN)}else Ke=this._planAndResolve()(Dt);return Ke},Ut.prototype._planAndResolve=function(){var At=this;return function(Et){var dr=N.plan(At._metadataReader,At,Et.isMultiInject,Et.targetType,Et.serviceIdentifier,Et.key,Et.value,Et.avoidConstraints);dr=Et.contextInterceptor(dr);var re=Ne.resolve(dr);return re}},Ut}();U.Container=nr},55607:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.AsyncContainerModule=U.ContainerModule=void 0;var ue=S(70023),C=function(){function w(q){this.id=ue.id(),this.registry=q}return w}();U.ContainerModule=C;var p=function(){function w(q){this.id=ue.id(),this.registry=q}return w}();U.AsyncContainerModule=p},71878:function(Lr,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.ContainerSnapshot=void 0;var S=function(){function ue(){}return ue.of=function(C,p){var w=new ue;return w.bindings=C,w.middleware=p,w},ue}();U.ContainerSnapshot=S},82543:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Lookup=void 0;var ue=S(36078),C=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(w,q){if(w==null)throw new Error(ue.NULL_ARGUMENT);if(q==null)throw new Error(ue.NULL_ARGUMENT);var K=this._map.get(w);K!==void 0?(K.push(q),this._map.set(w,K)):this._map.set(w,[q])},p.prototype.get=function(w){if(w==null)throw new Error(ue.NULL_ARGUMENT);var q=this._map.get(w);if(q!==void 0)return q;throw new Error(ue.KEY_NOT_FOUND)},p.prototype.remove=function(w){if(w==null)throw new Error(ue.NULL_ARGUMENT);if(!this._map.delete(w))throw new Error(ue.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(w){var q=this;this._map.forEach(function(K,W){var L=K.filter(function(N){return!w(N)});L.length>0?q._map.set(W,L):q._map.delete(W)})},p.prototype.hasKey=function(w){if(w==null)throw new Error(ue.NULL_ARGUMENT);return this._map.has(w)},p.prototype.clone=function(){var w=new p;return this._map.forEach(function(q,K){q.forEach(function(W){return w.add(K,W.clone())})}),w},p.prototype.traverse=function(w){this._map.forEach(function(q,K){w(K,q)})},p}();U.Lookup=C},99311:function(Lr,U,S){"use strict";var ue;ue={value:!0},ue=ue=ue=ue=ue=ue=U.GW=ue=ue=U.zY=ue=ue=ue=ue=ue=U.f3=ue=ue=U.b2=ue=ue=ue=ue=ue=U.W2=ue=void 0;var C=S(50295);ue=C;var p=S(70596);Object.defineProperty(U,"W2",{enumerable:!0,get:function(){return p.Container}});var w=S(77690);ue={enumerable:!0,get:function(){return w.BindingScopeEnum}},ue={enumerable:!0,get:function(){return w.BindingTypeEnum}},ue={enumerable:!0,get:function(){return w.TargetTypeEnum}};var q=S(55607);ue={enumerable:!0,get:function(){return q.AsyncContainerModule}},ue={enumerable:!0,get:function(){return q.ContainerModule}};var K=S(91773);Object.defineProperty(U,"b2",{enumerable:!0,get:function(){return K.injectable}});var W=S(79189);ue={enumerable:!0,get:function(){return W.tagged}};var L=S(79817);ue={enumerable:!0,get:function(){return L.named}};var N=S(76213);Object.defineProperty(U,"f3",{enumerable:!0,get:function(){return N.inject}}),ue={enumerable:!0,get:function(){return N.LazyServiceIdentifer}};var Ne=S(71316);ue={enumerable:!0,get:function(){return Ne.optional}};var Ye=S(19235);ue={enumerable:!0,get:function(){return Ye.unmanaged}};var Je=S(41528);ue={enumerable:!0,get:function(){return Je.multiInject}};var rt=S(8245);ue={enumerable:!0,get:function(){return rt.targetName}};var Xt=S(71971);Object.defineProperty(U,"zY",{enumerable:!0,get:function(){return Xt.postConstruct}});var Gt=S(43870);ue={enumerable:!0,get:function(){return Gt.MetadataReader}};var nr=S(70023);ue={enumerable:!0,get:function(){return nr.id}};var Ut=S(80626);Object.defineProperty(U,"GW",{enumerable:!0,get:function(){return Ut.decorate}});var At=S(83140);ue={enumerable:!0,get:function(){return At.traverseAncerstors}},ue={enumerable:!0,get:function(){return At.taggedConstraint}},ue={enumerable:!0,get:function(){return At.namedConstraint}},ue={enumerable:!0,get:function(){return At.typeConstraint}};var Et=S(29552);ue={enumerable:!0,get:function(){return Et.getServiceIdentifierAsString}};var dr=S(34384);ue={enumerable:!0,get:function(){return dr.multiBindToService}}},91519:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Context=void 0;var ue=S(70023),C=function(){function p(w){this.id=ue.id(),this.container=w}return p.prototype.addPlan=function(w){this.plan=w},p.prototype.setCurrentRequest=function(w){this.currentRequest=w},p}();U.Context=C},25092:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Metadata=void 0;var ue=S(50295),C=function(){function p(w,q){this.key=w,this.value=q}return p.prototype.toString=function(){return this.key===ue.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();U.Metadata=C},43870:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.MetadataReader=void 0;var ue=S(50295),C=function(){function p(){}return p.prototype.getConstructorMetadata=function(w){var q=Reflect.getMetadata(ue.PARAM_TYPES,w),K=Reflect.getMetadata(ue.TAGGED,w);return{compilerGeneratedMetadata:q,userGeneratedMetadata:K||{}}},p.prototype.getPropertiesMetadata=function(w){var q=Reflect.getMetadata(ue.TAGGED_PROP,w)||[];return q},p}();U.MetadataReader=C},6335:function(Lr,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Plan=void 0;var S=function(){function ue(C,p){this.parentContext=C,this.rootRequest=p}return ue}();U.Plan=S},54142:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.getBindingDictionary=U.createMockRequest=U.plan=void 0;var ue=S(13497),C=S(36078),p=S(77690),w=S(50295),q=S(92542),K=S(29552),W=S(91519),L=S(25092),N=S(6335),Ne=S(16664),Ye=S(14810),Je=S(69660);function rt(re){return re._bindingDictionary}U.getBindingDictionary=rt;function Xt(re,mr,wt,Ke,Dt,Xe){var Zt=re?w.MULTI_INJECT_TAG:w.INJECT_TAG,yr=new L.Metadata(Zt,wt),ur=new Je.Target(mr,Ke,wt,yr);if(Dt!==void 0){var Ur=new L.Metadata(Dt,Xe);ur.metadata.push(Ur)}return ur}function Gt(re,mr,wt,Ke,Dt){var Xe=At(wt.container,Dt.serviceIdentifier),Zt=[];return Xe.length===ue.BindingCount.NoBindingsAvailable&&wt.container.options.autoBindInjectable&&typeof Dt.serviceIdentifier=="function"&&re.getConstructorMetadata(Dt.serviceIdentifier).compilerGeneratedMetadata&&(wt.container.bind(Dt.serviceIdentifier).toSelf(),Xe=At(wt.container,Dt.serviceIdentifier)),mr?Zt=Xe:Zt=Xe.filter(function(yr){var ur=new Ye.Request(yr.serviceIdentifier,wt,Ke,yr,Dt);return yr.constraint(ur)}),nr(Dt.serviceIdentifier,Zt,Dt,wt.container),Zt}function nr(re,mr,wt,Ke){switch(mr.length){case ue.BindingCount.NoBindingsAvailable:if(wt.isOptional())return mr;var Dt=K.getServiceIdentifierAsString(re),Xe=C.NOT_REGISTERED;throw Xe+=K.listMetadataForTarget(Dt,wt),Xe+=K.listRegisteredBindingsForServiceIdentifier(Ke,Dt,At),new Error(Xe);case ue.BindingCount.OnlyOneBindingAvailable:if(!wt.isArray())return mr;case ue.BindingCount.MultipleBindingsAvailable:default:if(wt.isArray())return mr;var Dt=K.getServiceIdentifierAsString(re),Xe=C.AMBIGUOUS_MATCH+" "+Dt;throw Xe+=K.listRegisteredBindingsForServiceIdentifier(Ke,Dt,At),new Error(Xe)}}function Ut(re,mr,wt,Ke,Dt,Xe){var Zt,yr;if(Dt===null){Zt=Gt(re,mr,Ke,null,Xe),yr=new Ye.Request(wt,Ke,null,Zt,Xe);var ur=new N.Plan(Ke,yr);Ke.addPlan(ur)}else Zt=Gt(re,mr,Ke,Dt,Xe),yr=Dt.addChildRequest(Xe.serviceIdentifier,Zt,Xe);Zt.forEach(function(Ur){var he=null;if(Xe.isArray())he=yr.addChildRequest(Ur.serviceIdentifier,Ur,Xe);else{if(Ur.cache)return;he=yr}if(Ur.type===p.BindingTypeEnum.Instance&&Ur.implementationType!==null){var Re=Ne.getDependencies(re,Ur.implementationType);if(!Ke.container.options.skipBaseClassChecks){var ge=Ne.getBaseClassDependencyCount(re,Ur.implementationType);if(Re.length<ge){var _t=C.ARGUMENTS_LENGTH_MISMATCH(Ne.getFunctionName(Ur.implementationType));throw new Error(_t)}}Re.forEach(function(pt){Ut(re,!1,pt.serviceIdentifier,Ke,he,pt)})}})}function At(re,mr){var wt=[],Ke=rt(re);return Ke.hasKey(mr)?wt=Ke.get(mr):re.parent!==null&&(wt=At(re.parent,mr)),wt}function Et(re,mr,wt,Ke,Dt,Xe,Zt,yr){yr===void 0&&(yr=!1);var ur=new W.Context(mr),Ur=Xt(wt,Ke,Dt,"",Xe,Zt);try{return Ut(re,yr,Dt,ur,null,Ur),ur}catch(he){throw q.isStackOverflowExeption(he)&&ur.plan&&K.circularDependencyToException(ur.plan.rootRequest),he}}U.plan=Et;function dr(re,mr,wt,Ke){var Dt=new Je.Target(p.TargetTypeEnum.Variable,"",mr,new L.Metadata(wt,Ke)),Xe=new W.Context(re),Zt=new Ye.Request(mr,Xe,null,[],Dt);return Zt}U.createMockRequest=dr},68634:function(Lr,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.QueryableString=void 0;var S=function(){function ue(C){this.str=C}return ue.prototype.startsWith=function(C){return this.str.indexOf(C)===0},ue.prototype.endsWith=function(C){var p="",w=C.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},w)},ue.prototype.contains=function(C){return this.str.indexOf(C)!==-1},ue.prototype.equals=function(C){return this.str===C},ue.prototype.value=function(){return this.str},ue}();U.QueryableString=S},16664:function(Lr,U,S){"use strict";var ue=this&&this.__spreadArray||function(Gt,nr){for(var Ut=0,At=nr.length,Et=Gt.length;Ut<At;Ut++,Et++)Gt[Et]=nr[Ut];return Gt};Object.defineProperty(U,"__esModule",{value:!0}),U.getFunctionName=U.getBaseClassDependencyCount=U.getDependencies=void 0;var C=S(76213),p=S(36078),w=S(77690),q=S(50295),K=S(29552);Object.defineProperty(U,"getFunctionName",{enumerable:!0,get:function(){return K.getFunctionName}});var W=S(69660);function L(Gt,nr){var Ut=K.getFunctionName(nr),At=N(Gt,Ut,nr,!1);return At}U.getDependencies=L;function N(Gt,nr,Ut,At){var Et=Gt.getConstructorMetadata(Ut),dr=Et.compilerGeneratedMetadata;if(dr===void 0){var re=p.MISSING_INJECTABLE_ANNOTATION+" "+nr+".";throw new Error(re)}var mr=Et.userGeneratedMetadata,wt=Object.keys(mr),Ke=Ut.length===0&&wt.length>0,Dt=wt.length>Ut.length,Xe=Ke||Dt?wt.length:Ut.length,Zt=Ye(At,nr,dr,mr,Xe),yr=Je(Gt,Ut),ur=ue(ue([],Zt),yr);return ur}function Ne(Gt,nr,Ut,At,Et){var dr=Et[Gt.toString()]||[],re=Xt(dr),mr=re.unmanaged!==!0,wt=At[Gt],Ke=re.inject||re.multiInject;if(wt=Ke||wt,wt instanceof C.LazyServiceIdentifer&&(wt=wt.unwrap()),mr){var Dt=wt===Object,Xe=wt===Function,Zt=wt===void 0,yr=Dt||Xe||Zt;if(!nr&&yr){var ur=p.MISSING_INJECT_ANNOTATION+" argument "+Gt+" in class "+Ut+".";throw new Error(ur)}var Ur=new W.Target(w.TargetTypeEnum.ConstructorArgument,re.targetName,wt);return Ur.metadata=dr,Ur}return null}function Ye(Gt,nr,Ut,At,Et){for(var dr=[],re=0;re<Et;re++){var mr=re,wt=Ne(mr,Gt,nr,Ut,At);wt!==null&&dr.push(wt)}return dr}function Je(Gt,nr){for(var Ut=Gt.getPropertiesMetadata(nr),At=[],Et=Object.keys(Ut),dr=0,re=Et;dr<re.length;dr++){var mr=re[dr],wt=Ut[mr],Ke=Xt(Ut[mr]),Dt=Ke.targetName||mr,Xe=Ke.inject||Ke.multiInject,Zt=new W.Target(w.TargetTypeEnum.ClassProperty,Dt,Xe);Zt.metadata=wt,At.push(Zt)}var yr=Object.getPrototypeOf(nr.prototype).constructor;if(yr!==Object){var ur=Je(Gt,yr);At=ue(ue([],At),ur)}return At}function rt(Gt,nr){var Ut=Object.getPrototypeOf(nr.prototype).constructor;if(Ut!==Object){var At=K.getFunctionName(Ut),Et=N(Gt,At,Ut,!0),dr=Et.map(function(wt){return wt.metadata.filter(function(Ke){return Ke.key===q.UNMANAGED_TAG})}),re=[].concat.apply([],dr).length,mr=Et.length-re;return mr>0?mr:rt(Gt,Ut)}else return 0}U.getBaseClassDependencyCount=rt;function Xt(Gt){var nr={};return Gt.forEach(function(Ut){nr[Ut.key.toString()]=Ut.value}),{inject:nr[q.INJECT_TAG],multiInject:nr[q.MULTI_INJECT_TAG],targetName:nr[q.NAME_TAG],unmanaged:nr[q.UNMANAGED_TAG]}}},14810:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Request=void 0;var ue=S(70023),C=function(){function p(w,q,K,W,L){this.id=ue.id(),this.serviceIdentifier=w,this.parentContext=q,this.parentRequest=K,this.target=L,this.childRequests=[],this.bindings=Array.isArray(W)?W:[W],this.requestScope=K===null?new Map:null}return p.prototype.addChildRequest=function(w,q,K){var W=new p(w,this.parentContext,this,q,K);return this.childRequests.push(W),W},p}();U.Request=C},69660:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Target=void 0;var ue=S(50295),C=S(70023),p=S(25092),w=S(68634),q=function(){function K(W,L,N,Ne){this.id=C.id(),this.type=W,this.serviceIdentifier=N,this.name=new w.QueryableString(L||""),this.metadata=new Array;var Ye=null;typeof Ne=="string"?Ye=new p.Metadata(ue.NAMED_TAG,Ne):Ne instanceof p.Metadata&&(Ye=Ne),Ye!==null&&this.metadata.push(Ye)}return K.prototype.hasTag=function(W){for(var L=0,N=this.metadata;L<N.length;L++){var Ne=N[L];if(Ne.key===W)return!0}return!1},K.prototype.isArray=function(){return this.hasTag(ue.MULTI_INJECT_TAG)},K.prototype.matchesArray=function(W){return this.matchesTag(ue.MULTI_INJECT_TAG)(W)},K.prototype.isNamed=function(){return this.hasTag(ue.NAMED_TAG)},K.prototype.isTagged=function(){return this.metadata.some(function(W){return ue.NON_CUSTOM_TAG_KEYS.every(function(L){return W.key!==L})})},K.prototype.isOptional=function(){return this.matchesTag(ue.OPTIONAL_TAG)(!0)},K.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(W){return W.key===ue.NAMED_TAG})[0]:null},K.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(W){return ue.NON_CUSTOM_TAG_KEYS.every(function(L){return W.key!==L})}):null},K.prototype.matchesNamedTag=function(W){return this.matchesTag(ue.NAMED_TAG)(W)},K.prototype.matchesTag=function(W){var L=this;return function(N){for(var Ne=0,Ye=L.metadata;Ne<Ye.length;Ne++){var Je=Ye[Ne];if(Je.key===W&&Je.value===N)return!0}return!1}},K}();U.Target=q},74962:function(Lr,U,S){"use strict";var ue=this&&this.__spreadArray||function(N,Ne){for(var Ye=0,Je=Ne.length,rt=N.length;Ye<Je;Ye++,rt++)N[rt]=Ne[Ye];return N};Object.defineProperty(U,"__esModule",{value:!0}),U.resolveInstance=void 0;var C=S(36078),p=S(77690),w=S(50295);function q(N,Ne,Ye){var Je=Ne.filter(function(Xt){return Xt.target!==null&&Xt.target.type===p.TargetTypeEnum.ClassProperty}),rt=Je.map(Ye);return Je.forEach(function(Xt,Gt){var nr="";nr=Xt.target.name.value();var Ut=rt[Gt];N[nr]=Ut}),N}function K(N,Ne){return new(N.bind.apply(N,ue([void 0],Ne)))}function W(N,Ne){if(Reflect.hasMetadata(w.POST_CONSTRUCT,N)){var Ye=Reflect.getMetadata(w.POST_CONSTRUCT,N);try{Ne[Ye.value]()}catch(Je){throw new Error(C.POST_CONSTRUCT_ERROR(N.name,Je.message))}}}function L(N,Ne,Ye){var Je=null;if(Ne.length>0){var rt=Ne.filter(function(Gt){return Gt.target!==null&&Gt.target.type===p.TargetTypeEnum.ConstructorArgument}),Xt=rt.map(Ye);Je=K(N,Xt),Je=q(Je,Ne,Ye)}else Je=new N;return W(N,Je),Je}U.resolveInstance=L},9386:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.resolve=void 0;var ue=S(36078),C=S(77690),p=S(92542),w=S(29552),q=S(74962),K=function(N,Ne,Ye){try{return Ye()}catch(Je){throw p.isStackOverflowExeption(Je)?new Error(ue.CIRCULAR_DEPENDENCY_IN_FACTORY(N,Ne.toString())):Je}},W=function(N){return function(Ne){Ne.parentContext.setCurrentRequest(Ne);var Ye=Ne.bindings,Je=Ne.childRequests,rt=Ne.target&&Ne.target.isArray(),Xt=!Ne.parentRequest||!Ne.parentRequest.target||!Ne.target||!Ne.parentRequest.target.matchesArray(Ne.target.serviceIdentifier);if(rt&&Xt)return Je.map(function(dr){var re=W(N);return re(dr)});var Gt=null;if(Ne.target.isOptional()&&Ye.length===0)return;var nr=Ye[0],Ut=nr.scope===C.BindingScopeEnum.Singleton,At=nr.scope===C.BindingScopeEnum.Request;if(Ut&&nr.activated)return nr.cache;if(At&&N!==null&&N.has(nr.id))return N.get(nr.id);if(nr.type===C.BindingTypeEnum.ConstantValue)Gt=nr.cache,nr.activated=!0;else if(nr.type===C.BindingTypeEnum.Function)Gt=nr.cache,nr.activated=!0;else if(nr.type===C.BindingTypeEnum.Constructor)Gt=nr.implementationType;else if(nr.type===C.BindingTypeEnum.DynamicValue&&nr.dynamicValue!==null)Gt=K("toDynamicValue",nr.serviceIdentifier,function(){return nr.dynamicValue(Ne.parentContext)});else if(nr.type===C.BindingTypeEnum.Factory&&nr.factory!==null)Gt=K("toFactory",nr.serviceIdentifier,function(){return nr.factory(Ne.parentContext)});else if(nr.type===C.BindingTypeEnum.Provider&&nr.provider!==null)Gt=K("toProvider",nr.serviceIdentifier,function(){return nr.provider(Ne.parentContext)});else if(nr.type===C.BindingTypeEnum.Instance&&nr.implementationType!==null)Gt=q.resolveInstance(nr.implementationType,Je,W(N));else{var Et=w.getServiceIdentifierAsString(Ne.serviceIdentifier);throw new Error(ue.INVALID_BINDING_TYPE+" "+Et)}return typeof nr.onActivation=="function"&&(Gt=nr.onActivation(Ne.parentContext,Gt)),Ut&&(nr.cache=Gt,nr.activated=!0),At&&N!==null&&!N.has(nr.id)&&N.set(nr.id,Gt),Gt}};function L(N){var Ne=W(N.plan.rootRequest.requestScope);return Ne(N.plan.rootRequest)}U.resolve=L},91640:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingInSyntax=void 0;var ue=S(77690),C=S(46890),p=function(){function w(q){this._binding=q}return w.prototype.inRequestScope=function(){return this._binding.scope=ue.BindingScopeEnum.Request,new C.BindingWhenOnSyntax(this._binding)},w.prototype.inSingletonScope=function(){return this._binding.scope=ue.BindingScopeEnum.Singleton,new C.BindingWhenOnSyntax(this._binding)},w.prototype.inTransientScope=function(){return this._binding.scope=ue.BindingScopeEnum.Transient,new C.BindingWhenOnSyntax(this._binding)},w}();U.BindingInSyntax=p},82386:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingInWhenOnSyntax=void 0;var ue=S(91640),C=S(8926),p=S(36890),w=function(){function q(K){this._binding=K,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new C.BindingOnSyntax(this._binding),this._bindingInSyntax=new ue.BindingInSyntax(K)}return q.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},q.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},q.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},q.prototype.when=function(K){return this._bindingWhenSyntax.when(K)},q.prototype.whenTargetNamed=function(K){return this._bindingWhenSyntax.whenTargetNamed(K)},q.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},q.prototype.whenTargetTagged=function(K,W){return this._bindingWhenSyntax.whenTargetTagged(K,W)},q.prototype.whenInjectedInto=function(K){return this._bindingWhenSyntax.whenInjectedInto(K)},q.prototype.whenParentNamed=function(K){return this._bindingWhenSyntax.whenParentNamed(K)},q.prototype.whenParentTagged=function(K,W){return this._bindingWhenSyntax.whenParentTagged(K,W)},q.prototype.whenAnyAncestorIs=function(K){return this._bindingWhenSyntax.whenAnyAncestorIs(K)},q.prototype.whenNoAncestorIs=function(K){return this._bindingWhenSyntax.whenNoAncestorIs(K)},q.prototype.whenAnyAncestorNamed=function(K){return this._bindingWhenSyntax.whenAnyAncestorNamed(K)},q.prototype.whenAnyAncestorTagged=function(K,W){return this._bindingWhenSyntax.whenAnyAncestorTagged(K,W)},q.prototype.whenNoAncestorNamed=function(K){return this._bindingWhenSyntax.whenNoAncestorNamed(K)},q.prototype.whenNoAncestorTagged=function(K,W){return this._bindingWhenSyntax.whenNoAncestorTagged(K,W)},q.prototype.whenAnyAncestorMatches=function(K){return this._bindingWhenSyntax.whenAnyAncestorMatches(K)},q.prototype.whenNoAncestorMatches=function(K){return this._bindingWhenSyntax.whenNoAncestorMatches(K)},q.prototype.onActivation=function(K){return this._bindingOnSyntax.onActivation(K)},q}();U.BindingInWhenOnSyntax=w},8926:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingOnSyntax=void 0;var ue=S(36890),C=function(){function p(w){this._binding=w}return p.prototype.onActivation=function(w){return this._binding.onActivation=w,new ue.BindingWhenSyntax(this._binding)},p}();U.BindingOnSyntax=C},43313:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingToSyntax=void 0;var ue=S(36078),C=S(77690),p=S(82386),w=S(46890),q=function(){function K(W){this._binding=W}return K.prototype.to=function(W){return this._binding.type=C.BindingTypeEnum.Instance,this._binding.implementationType=W,new p.BindingInWhenOnSyntax(this._binding)},K.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ue.INVALID_TO_SELF_VALUE);var W=this._binding.serviceIdentifier;return this.to(W)},K.prototype.toConstantValue=function(W){return this._binding.type=C.BindingTypeEnum.ConstantValue,this._binding.cache=W,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=C.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},K.prototype.toDynamicValue=function(W){return this._binding.type=C.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=W,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},K.prototype.toConstructor=function(W){return this._binding.type=C.BindingTypeEnum.Constructor,this._binding.implementationType=W,this._binding.scope=C.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},K.prototype.toFactory=function(W){return this._binding.type=C.BindingTypeEnum.Factory,this._binding.factory=W,this._binding.scope=C.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},K.prototype.toFunction=function(W){if(typeof W!="function")throw new Error(ue.INVALID_FUNCTION_BINDING);var L=this.toConstantValue(W);return this._binding.type=C.BindingTypeEnum.Function,this._binding.scope=C.BindingScopeEnum.Singleton,L},K.prototype.toAutoFactory=function(W){return this._binding.type=C.BindingTypeEnum.Factory,this._binding.factory=function(L){var N=function(){return L.container.get(W)};return N},this._binding.scope=C.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},K.prototype.toProvider=function(W){return this._binding.type=C.BindingTypeEnum.Provider,this._binding.provider=W,this._binding.scope=C.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},K.prototype.toService=function(W){this.toDynamicValue(function(L){return L.container.get(W)})},K}();U.BindingToSyntax=q},46890:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingWhenOnSyntax=void 0;var ue=S(8926),C=S(36890),p=function(){function w(q){this._binding=q,this._bindingWhenSyntax=new C.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ue.BindingOnSyntax(this._binding)}return w.prototype.when=function(q){return this._bindingWhenSyntax.when(q)},w.prototype.whenTargetNamed=function(q){return this._bindingWhenSyntax.whenTargetNamed(q)},w.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},w.prototype.whenTargetTagged=function(q,K){return this._bindingWhenSyntax.whenTargetTagged(q,K)},w.prototype.whenInjectedInto=function(q){return this._bindingWhenSyntax.whenInjectedInto(q)},w.prototype.whenParentNamed=function(q){return this._bindingWhenSyntax.whenParentNamed(q)},w.prototype.whenParentTagged=function(q,K){return this._bindingWhenSyntax.whenParentTagged(q,K)},w.prototype.whenAnyAncestorIs=function(q){return this._bindingWhenSyntax.whenAnyAncestorIs(q)},w.prototype.whenNoAncestorIs=function(q){return this._bindingWhenSyntax.whenNoAncestorIs(q)},w.prototype.whenAnyAncestorNamed=function(q){return this._bindingWhenSyntax.whenAnyAncestorNamed(q)},w.prototype.whenAnyAncestorTagged=function(q,K){return this._bindingWhenSyntax.whenAnyAncestorTagged(q,K)},w.prototype.whenNoAncestorNamed=function(q){return this._bindingWhenSyntax.whenNoAncestorNamed(q)},w.prototype.whenNoAncestorTagged=function(q,K){return this._bindingWhenSyntax.whenNoAncestorTagged(q,K)},w.prototype.whenAnyAncestorMatches=function(q){return this._bindingWhenSyntax.whenAnyAncestorMatches(q)},w.prototype.whenNoAncestorMatches=function(q){return this._bindingWhenSyntax.whenNoAncestorMatches(q)},w.prototype.onActivation=function(q){return this._bindingOnSyntax.onActivation(q)},w}();U.BindingWhenOnSyntax=p},36890:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingWhenSyntax=void 0;var ue=S(8926),C=S(83140),p=function(){function w(q){this._binding=q}return w.prototype.when=function(q){return this._binding.constraint=q,new ue.BindingOnSyntax(this._binding)},w.prototype.whenTargetNamed=function(q){return this._binding.constraint=C.namedConstraint(q),new ue.BindingOnSyntax(this._binding)},w.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(q){var K=q.target!==null&&!q.target.isNamed()&&!q.target.isTagged();return K},new ue.BindingOnSyntax(this._binding)},w.prototype.whenTargetTagged=function(q,K){return this._binding.constraint=C.taggedConstraint(q)(K),new ue.BindingOnSyntax(this._binding)},w.prototype.whenInjectedInto=function(q){return this._binding.constraint=function(K){return C.typeConstraint(q)(K.parentRequest)},new ue.BindingOnSyntax(this._binding)},w.prototype.whenParentNamed=function(q){return this._binding.constraint=function(K){return C.namedConstraint(q)(K.parentRequest)},new ue.BindingOnSyntax(this._binding)},w.prototype.whenParentTagged=function(q,K){return this._binding.constraint=function(W){return C.taggedConstraint(q)(K)(W.parentRequest)},new ue.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorIs=function(q){return this._binding.constraint=function(K){return C.traverseAncerstors(K,C.typeConstraint(q))},new ue.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorIs=function(q){return this._binding.constraint=function(K){return!C.traverseAncerstors(K,C.typeConstraint(q))},new ue.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorNamed=function(q){return this._binding.constraint=function(K){return C.traverseAncerstors(K,C.namedConstraint(q))},new ue.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorNamed=function(q){return this._binding.constraint=function(K){return!C.traverseAncerstors(K,C.namedConstraint(q))},new ue.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorTagged=function(q,K){return this._binding.constraint=function(W){return C.traverseAncerstors(W,C.taggedConstraint(q)(K))},new ue.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorTagged=function(q,K){return this._binding.constraint=function(W){return!C.traverseAncerstors(W,C.taggedConstraint(q)(K))},new ue.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorMatches=function(q){return this._binding.constraint=function(K){return C.traverseAncerstors(K,q)},new ue.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorMatches=function(q){return this._binding.constraint=function(K){return!C.traverseAncerstors(K,q)},new ue.BindingOnSyntax(this._binding)},w}();U.BindingWhenSyntax=p},83140:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.typeConstraint=U.namedConstraint=U.taggedConstraint=U.traverseAncerstors=void 0;var ue=S(50295),C=S(25092),p=function(W,L){var N=W.parentRequest;return N!==null?L(N)?!0:p(N,L):!1};U.traverseAncerstors=p;var w=function(W){return function(L){var N=function(Ne){return Ne!==null&&Ne.target!==null&&Ne.target.matchesTag(W)(L)};return N.metaData=new C.Metadata(W,L),N}};U.taggedConstraint=w;var q=w(ue.NAMED_TAG);U.namedConstraint=q;var K=function(W){return function(L){var N=null;if(L!==null)if(N=L.bindings[0],typeof W=="string"){var Ne=N.serviceIdentifier;return Ne===W}else{var Ye=L.bindings[0].implementationType;return W===Ye}return!1}};U.typeConstraint=K},34384:function(Lr,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.multiBindToService=void 0;var S=function(ue){return function(C){return function(){for(var p=[],w=0;w<arguments.length;w++)p[w]=arguments[w];return p.forEach(function(q){return ue.bind(q).toService(C)})}}};U.multiBindToService=S},92542:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.isStackOverflowExeption=void 0;var ue=S(36078);function C(p){return p instanceof RangeError||p.message===ue.STACK_OVERFLOW}U.isStackOverflowExeption=C},70023:function(Lr,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.id=void 0;var S=0;function ue(){return S++}U.id=ue},29552:function(Lr,U,S){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.circularDependencyToException=U.listMetadataForTarget=U.listRegisteredBindingsForServiceIdentifier=U.getServiceIdentifierAsString=U.getFunctionName=void 0;var ue=S(36078);function C(N){if(typeof N=="function"){var Ne=N;return Ne.name}else{if(typeof N=="symbol")return N.toString();var Ne=N;return Ne}}U.getServiceIdentifierAsString=C;function p(N,Ne,Ye){var Je="",rt=Ye(N,Ne);return rt.length!==0&&(Je=`
Registered bindings:`,rt.forEach(function(Xt){var Gt="Object";Xt.implementationType!==null&&(Gt=L(Xt.implementationType)),Je=Je+`
 `+Gt,Xt.constraint.metaData&&(Je=Je+" - "+Xt.constraint.metaData)})),Je}U.listRegisteredBindingsForServiceIdentifier=p;function w(N,Ne){return N.parentRequest===null?!1:N.parentRequest.serviceIdentifier===Ne?!0:w(N.parentRequest,Ne)}function q(N){function Ne(Je,rt){rt===void 0&&(rt=[]);var Xt=C(Je.serviceIdentifier);return rt.push(Xt),Je.parentRequest!==null?Ne(Je.parentRequest,rt):rt}var Ye=Ne(N);return Ye.reverse().join(" --> ")}function K(N){N.childRequests.forEach(function(Ne){if(w(Ne,Ne.serviceIdentifier)){var Ye=q(Ne);throw new Error(ue.CIRCULAR_DEPENDENCY+" "+Ye)}else K(Ne)})}U.circularDependencyToException=K;function W(N,Ne){if(Ne.isTagged()||Ne.isNamed()){var Ye="",Je=Ne.getNamedTag(),rt=Ne.getCustomTags();return Je!==null&&(Ye+=Je.toString()+`
`),rt!==null&&rt.forEach(function(Xt){Ye+=Xt.toString()+`
`})," "+N+`
 `+N+" - "+Ye}else return" "+N}U.listMetadataForTarget=W;function L(N){if(N.name)return N.name;var Ne=N.toString(),Ye=Ne.match(/^function\s*([^\s(]+)/);return Ye?Ye[1]:"Anonymous function: "+Ne}U.getFunctionName=L},40077:function(Lr,U,S){"use strict";S.r(U),S.d(U,{Function:function(){return zs},Interpreter:function(){return lo},default:function(){return Ss},evaluate:function(){return co},vm:function(){return ue}});var ue={};S.r(ue),S.d(ue,{Script:function(){return wu},compileFunction:function(){return xl},createContext:function(){return _l},runInContext:function(){return Nu},runInNewContext:function(){return Gl}});var C={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},p="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",w={5:p,"5module":p+" export import",6:p+" const class extends export import super"},q=/^in(stanceof)?$/,K="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",W="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",L=new RegExp("["+K+"]"),N=new RegExp("["+K+W+"]");K=W=null;var Ne=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Ye=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Je(m,A){for(var j=65536,O=0;O<A.length;O+=2){if(j+=A[O],j>m)return!1;if(j+=A[O+1],j>=m)return!0}}function rt(m,A){return m<65?m===36:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&L.test(String.fromCharCode(m)):A===!1?!1:Je(m,Ne)}function Xt(m,A){return m<48?m===36:m<58?!0:m<65?!1:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&N.test(String.fromCharCode(m)):A===!1?!1:Je(m,Ne)||Je(m,Ye)}var Gt=function(A,j){j===void 0&&(j={}),this.label=A,this.keyword=j.keyword,this.beforeExpr=!!j.beforeExpr,this.startsExpr=!!j.startsExpr,this.isLoop=!!j.isLoop,this.isAssign=!!j.isAssign,this.prefix=!!j.prefix,this.postfix=!!j.postfix,this.binop=j.binop||null,this.updateContext=null};function nr(m,A){return new Gt(m,{beforeExpr:!0,binop:A})}var Ut={beforeExpr:!0},At={startsExpr:!0},Et={};function dr(m,A){return A===void 0&&(A={}),A.keyword=m,Et[m]=new Gt(m,A)}var re={num:new Gt("num",At),regexp:new Gt("regexp",At),string:new Gt("string",At),name:new Gt("name",At),eof:new Gt("eof"),bracketL:new Gt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Gt("]"),braceL:new Gt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Gt("}"),parenL:new Gt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Gt(")"),comma:new Gt(",",Ut),semi:new Gt(";",Ut),colon:new Gt(":",Ut),dot:new Gt("."),question:new Gt("?",Ut),questionDot:new Gt("?."),arrow:new Gt("=>",Ut),template:new Gt("template"),invalidTemplate:new Gt("invalidTemplate"),ellipsis:new Gt("...",Ut),backQuote:new Gt("`",At),dollarBraceL:new Gt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Gt("=",{beforeExpr:!0,isAssign:!0}),assign:new Gt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Gt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Gt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:nr("||",1),logicalAND:nr("&&",2),bitwiseOR:nr("|",3),bitwiseXOR:nr("^",4),bitwiseAND:nr("&",5),equality:nr("==/!=/===/!==",6),relational:nr("</>/<=/>=",7),bitShift:nr("<</>>/>>>",8),plusMin:new Gt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:nr("%",10),star:nr("*",10),slash:nr("/",10),starstar:new Gt("**",{beforeExpr:!0}),coalesce:nr("??",1),_break:dr("break"),_case:dr("case",Ut),_catch:dr("catch"),_continue:dr("continue"),_debugger:dr("debugger"),_default:dr("default",Ut),_do:dr("do",{isLoop:!0,beforeExpr:!0}),_else:dr("else",Ut),_finally:dr("finally"),_for:dr("for",{isLoop:!0}),_function:dr("function",At),_if:dr("if"),_return:dr("return",Ut),_switch:dr("switch"),_throw:dr("throw",Ut),_try:dr("try"),_var:dr("var"),_const:dr("const"),_while:dr("while",{isLoop:!0}),_with:dr("with"),_new:dr("new",{beforeExpr:!0,startsExpr:!0}),_this:dr("this",At),_super:dr("super",At),_class:dr("class",At),_extends:dr("extends",Ut),_export:dr("export"),_import:dr("import",At),_null:dr("null",At),_true:dr("true",At),_false:dr("false",At),_in:dr("in",{beforeExpr:!0,binop:7}),_instanceof:dr("instanceof",{beforeExpr:!0,binop:7}),_typeof:dr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:dr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:dr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},mr=/\r\n?|\n|\u2028|\u2029/,wt=new RegExp(mr.source,"g");function Ke(m,A){return m===10||m===13||!A&&(m===8232||m===8233)}var Dt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Xe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Zt=Object.prototype,yr=Zt.hasOwnProperty,ur=Zt.toString;function Ur(m,A){return yr.call(m,A)}var he=Array.isArray||function(m){return ur.call(m)==="[object Array]"};function Re(m){return new RegExp("^(?:"+m.replace(/ /g,"|")+")$")}var ge=function(A,j){this.line=A,this.column=j};ge.prototype.offset=function(A){return new ge(this.line,this.column+A)};var _t=function(A,j,O){this.start=j,this.end=O,A.sourceFile!==null&&(this.source=A.sourceFile)};function pt(m,A){for(var j=1,O=0;;){wt.lastIndex=O;var le=wt.exec(m);if(le&&le.index<A)++j,O=le.index+le[0].length;else return new ge(j,A-O)}}var zt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Ft(m){var A={};for(var j in zt)A[j]=m&&Ur(m,j)?m[j]:zt[j];if(A.ecmaVersion>=2015&&(A.ecmaVersion-=2009),A.allowReserved==null&&(A.allowReserved=A.ecmaVersion<5),he(A.onToken)){var O=A.onToken;A.onToken=function(le){return O.push(le)}}return he(A.onComment)&&(A.onComment=Dr(A,A.onComment)),A}function Dr(m,A){return function(j,O,le,Ie,ut,Pt){var Ot={type:j?"Block":"Line",value:O,start:le,end:Ie};m.locations&&(Ot.loc=new _t(this,ut,Pt)),m.ranges&&(Ot.range=[le,Ie]),A.push(Ot)}}var pn=1,mn=2,Xi=pn|mn,ir=4,pe=8,Pe=16,Ze=32,Le=64,It=128;function tr(m,A){return mn|(m?ir:0)|(A?pe:0)}var E=0,Z=1,be=2,Ge=3,qe=4,gt=5,St=function(A,j,O){this.options=A=Ft(A),this.sourceFile=A.sourceFile,this.keywords=Re(w[A.ecmaVersion>=6?6:A.sourceType==="module"?"5module":5]);var le="";if(A.allowReserved!==!0){for(var Ie=A.ecmaVersion;!(le=C[Ie]);Ie--);A.sourceType==="module"&&(le+=" await")}this.reservedWords=Re(le);var ut=(le?le+" ":"")+C.strict;this.reservedWordsStrict=Re(ut),this.reservedWordsStrictBind=Re(ut+" "+C.strictBind),this.input=String(j),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(mr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=re.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=A.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&A.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(pn),this.regexpState=null},Ct={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};St.prototype.parse=function(){var A=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(A)},Ct.inFunction.get=function(){return(this.currentVarScope().flags&mn)>0},Ct.inGenerator.get=function(){return(this.currentVarScope().flags&pe)>0},Ct.inAsync.get=function(){return(this.currentVarScope().flags&ir)>0},Ct.allowSuper.get=function(){return(this.currentThisScope().flags&Le)>0},Ct.allowDirectSuper.get=function(){return(this.currentThisScope().flags&It)>0},Ct.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},St.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&mn)>0},St.extend=function(){for(var A=[],j=arguments.length;j--;)A[j]=arguments[j];for(var O=this,le=0;le<A.length;le++)O=A[le](O);return O},St.parse=function(A,j){return new this(j,A).parse()},St.parseExpressionAt=function(A,j,O){var le=new this(O,A,j);return le.nextToken(),le.parseExpression()},St.tokenizer=function(A,j){return new this(j,A)},Object.defineProperties(St.prototype,Ct);var Vt=St.prototype,qt=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Vt.strictDirective=function(m){for(;;){Xe.lastIndex=m,m+=Xe.exec(this.input)[0].length;var A=qt.exec(this.input.slice(m));if(!A)return!1;if((A[1]||A[2])==="use strict"){Xe.lastIndex=m+A[0].length;var j=Xe.exec(this.input),O=j.index+j[0].length,le=this.input.charAt(O);return le===";"||le==="}"||mr.test(j[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(le)||le==="!"&&this.input.charAt(O+1)==="=")}m+=A[0].length,Xe.lastIndex=m,m+=Xe.exec(this.input)[0].length,this.input[m]===";"&&m++}},Vt.eat=function(m){return this.type===m?(this.next(),!0):!1},Vt.isContextual=function(m){return this.type===re.name&&this.value===m&&!this.containsEsc},Vt.eatContextual=function(m){return this.isContextual(m)?(this.next(),!0):!1},Vt.expectContextual=function(m){this.eatContextual(m)||this.unexpected()},Vt.canInsertSemicolon=function(){return this.type===re.eof||this.type===re.braceR||mr.test(this.input.slice(this.lastTokEnd,this.start))},Vt.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Vt.semicolon=function(){!this.eat(re.semi)&&!this.insertSemicolon()&&this.unexpected()},Vt.afterTrailingComma=function(m,A){if(this.type===m)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),A||this.next(),!0},Vt.expect=function(m){this.eat(m)||this.unexpected()},Vt.unexpected=function(m){this.raise(m!=null?m:this.start,"Unexpected token")};function ie(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Vt.checkPatternErrors=function(m,A){if(!!m){m.trailingComma>-1&&this.raiseRecoverable(m.trailingComma,"Comma is not permitted after the rest element");var j=A?m.parenthesizedAssign:m.parenthesizedBind;j>-1&&this.raiseRecoverable(j,"Parenthesized pattern")}},Vt.checkExpressionErrors=function(m,A){if(!m)return!1;var j=m.shorthandAssign,O=m.doubleProto;if(!A)return j>=0||O>=0;j>=0&&this.raise(j,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},Vt.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Vt.isSimpleAssignTarget=function(m){return m.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(m.expression):m.type==="Identifier"||m.type==="MemberExpression"};var sr=St.prototype;sr.parseTopLevel=function(m){var A={};for(m.body||(m.body=[]);this.type!==re.eof;){var j=this.parseStatement(null,!0,A);m.body.push(j)}if(this.inModule)for(var O=0,le=Object.keys(this.undefinedExports);O<le.length;O+=1){var Ie=le[O];this.raiseRecoverable(this.undefinedExports[Ie].start,"Export '"+Ie+"' is not defined")}return this.adaptDirectivePrologue(m.body),this.next(),m.sourceType=this.options.sourceType,this.finishNode(m,"Program")};var Mr={kind:"loop"},Nr={kind:"switch"};sr.isLet=function(m){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Xe.lastIndex=this.pos;var A=Xe.exec(this.input),j=this.pos+A[0].length,O=this.input.charCodeAt(j);if(O===91)return!0;if(m)return!1;if(O===123)return!0;if(rt(O,!0)){for(var le=j+1;Xt(this.input.charCodeAt(le),!0);)++le;var Ie=this.input.slice(j,le);if(!q.test(Ie))return!0}return!1},sr.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Xe.lastIndex=this.pos;var m=Xe.exec(this.input),A=this.pos+m[0].length;return!mr.test(this.input.slice(this.pos,A))&&this.input.slice(A,A+8)==="function"&&(A+8===this.input.length||!Xt(this.input.charAt(A+8)))},sr.parseStatement=function(m,A,j){var O=this.type,le=this.startNode(),Ie;switch(this.isLet(m)&&(O=re._var,Ie="let"),O){case re._break:case re._continue:return this.parseBreakContinueStatement(le,O.keyword);case re._debugger:return this.parseDebuggerStatement(le);case re._do:return this.parseDoStatement(le);case re._for:return this.parseForStatement(le);case re._function:return m&&(this.strict||m!=="if"&&m!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(le,!1,!m);case re._class:return m&&this.unexpected(),this.parseClass(le,!0);case re._if:return this.parseIfStatement(le);case re._return:return this.parseReturnStatement(le);case re._switch:return this.parseSwitchStatement(le);case re._throw:return this.parseThrowStatement(le);case re._try:return this.parseTryStatement(le);case re._const:case re._var:return Ie=Ie||this.value,m&&Ie!=="var"&&this.unexpected(),this.parseVarStatement(le,Ie);case re._while:return this.parseWhileStatement(le);case re._with:return this.parseWithStatement(le);case re.braceL:return this.parseBlock(!0,le);case re.semi:return this.parseEmptyStatement(le);case re._export:case re._import:if(this.options.ecmaVersion>10&&O===re._import){Xe.lastIndex=this.pos;var ut=Xe.exec(this.input),Pt=this.pos+ut[0].length,Ot=this.input.charCodeAt(Pt);if(Ot===40||Ot===46)return this.parseExpressionStatement(le,this.parseExpression())}return this.options.allowImportExportEverywhere||(A||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===re._import?this.parseImport(le):this.parseExport(le,j);default:if(this.isAsyncFunction())return m&&this.unexpected(),this.next(),this.parseFunctionStatement(le,!0,!m);var Ar=this.value,jr=this.parseExpression();return O===re.name&&jr.type==="Identifier"&&this.eat(re.colon)?this.parseLabeledStatement(le,Ar,jr,m):this.parseExpressionStatement(le,jr)}},sr.parseBreakContinueStatement=function(m,A){var j=A==="break";this.next(),this.eat(re.semi)||this.insertSemicolon()?m.label=null:this.type!==re.name?this.unexpected():(m.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var le=this.labels[O];if((m.label==null||le.name===m.label.name)&&(le.kind!=null&&(j||le.kind==="loop")||m.label&&j))break}return O===this.labels.length&&this.raise(m.start,"Unsyntactic "+A),this.finishNode(m,j?"BreakStatement":"ContinueStatement")},sr.parseDebuggerStatement=function(m){return this.next(),this.semicolon(),this.finishNode(m,"DebuggerStatement")},sr.parseDoStatement=function(m){return this.next(),this.labels.push(Mr),m.body=this.parseStatement("do"),this.labels.pop(),this.expect(re._while),m.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(re.semi):this.semicolon(),this.finishNode(m,"DoWhileStatement")},sr.parseForStatement=function(m){this.next();var A=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Mr),this.enterScope(0),this.expect(re.parenL),this.type===re.semi)return A>-1&&this.unexpected(A),this.parseFor(m,null);var j=this.isLet();if(this.type===re._var||this.type===re._const||j){var O=this.startNode(),le=j?"let":this.value;return this.next(),this.parseVar(O,!0,le),this.finishNode(O,"VariableDeclaration"),(this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===re._in?A>-1&&this.unexpected(A):m.await=A>-1),this.parseForIn(m,O)):(A>-1&&this.unexpected(A),this.parseFor(m,O))}var Ie=new ie,ut=this.parseExpression(!0,Ie);return this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===re._in?A>-1&&this.unexpected(A):m.await=A>-1),this.toAssignable(ut,!1,Ie),this.checkLVal(ut),this.parseForIn(m,ut)):(this.checkExpressionErrors(Ie,!0),A>-1&&this.unexpected(A),this.parseFor(m,ut))},sr.parseFunctionStatement=function(m,A,j){return this.next(),this.parseFunction(m,mt|(j?0:yt),!1,A)},sr.parseIfStatement=function(m){return this.next(),m.test=this.parseParenExpression(),m.consequent=this.parseStatement("if"),m.alternate=this.eat(re._else)?this.parseStatement("if"):null,this.finishNode(m,"IfStatement")},sr.parseReturnStatement=function(m){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(re.semi)||this.insertSemicolon()?m.argument=null:(m.argument=this.parseExpression(),this.semicolon()),this.finishNode(m,"ReturnStatement")},sr.parseSwitchStatement=function(m){this.next(),m.discriminant=this.parseParenExpression(),m.cases=[],this.expect(re.braceL),this.labels.push(Nr),this.enterScope(0);for(var A,j=!1;this.type!==re.braceR;)if(this.type===re._case||this.type===re._default){var O=this.type===re._case;A&&this.finishNode(A,"SwitchCase"),m.cases.push(A=this.startNode()),A.consequent=[],this.next(),O?A.test=this.parseExpression():(j&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),j=!0,A.test=null),this.expect(re.colon)}else A||this.unexpected(),A.consequent.push(this.parseStatement(null));return this.exitScope(),A&&this.finishNode(A,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(m,"SwitchStatement")},sr.parseThrowStatement=function(m){return this.next(),mr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),m.argument=this.parseExpression(),this.semicolon(),this.finishNode(m,"ThrowStatement")};var tt=[];sr.parseTryStatement=function(m){if(this.next(),m.block=this.parseBlock(),m.handler=null,this.type===re._catch){var A=this.startNode();if(this.next(),this.eat(re.parenL)){A.param=this.parseBindingAtom();var j=A.param.type==="Identifier";this.enterScope(j?Ze:0),this.checkLVal(A.param,j?qe:be),this.expect(re.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),A.param=null,this.enterScope(0);A.body=this.parseBlock(!1),this.exitScope(),m.handler=this.finishNode(A,"CatchClause")}return m.finalizer=this.eat(re._finally)?this.parseBlock():null,!m.handler&&!m.finalizer&&this.raise(m.start,"Missing catch or finally clause"),this.finishNode(m,"TryStatement")},sr.parseVarStatement=function(m,A){return this.next(),this.parseVar(m,!1,A),this.semicolon(),this.finishNode(m,"VariableDeclaration")},sr.parseWhileStatement=function(m){return this.next(),m.test=this.parseParenExpression(),this.labels.push(Mr),m.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(m,"WhileStatement")},sr.parseWithStatement=function(m){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),m.object=this.parseParenExpression(),m.body=this.parseStatement("with"),this.finishNode(m,"WithStatement")},sr.parseEmptyStatement=function(m){return this.next(),this.finishNode(m,"EmptyStatement")},sr.parseLabeledStatement=function(m,A,j,O){for(var le=0,Ie=this.labels;le<Ie.length;le+=1){var ut=Ie[le];ut.name===A&&this.raise(j.start,"Label '"+A+"' is already declared")}for(var Pt=this.type.isLoop?"loop":this.type===re._switch?"switch":null,Ot=this.labels.length-1;Ot>=0;Ot--){var Ar=this.labels[Ot];if(Ar.statementStart===m.start)Ar.statementStart=this.start,Ar.kind=Pt;else break}return this.labels.push({name:A,kind:Pt,statementStart:this.start}),m.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),m.label=j,this.finishNode(m,"LabeledStatement")},sr.parseExpressionStatement=function(m,A){return m.expression=A,this.semicolon(),this.finishNode(m,"ExpressionStatement")},sr.parseBlock=function(m,A,j){for(m===void 0&&(m=!0),A===void 0&&(A=this.startNode()),A.body=[],this.expect(re.braceL),m&&this.enterScope(0);this.type!==re.braceR;){var O=this.parseStatement(null);A.body.push(O)}return j&&(this.strict=!1),this.next(),m&&this.exitScope(),this.finishNode(A,"BlockStatement")},sr.parseFor=function(m,A){return m.init=A,this.expect(re.semi),m.test=this.type===re.semi?null:this.parseExpression(),this.expect(re.semi),m.update=this.type===re.parenR?null:this.parseExpression(),this.expect(re.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,"ForStatement")},sr.parseForIn=function(m,A){var j=this.type===re._in;return this.next(),A.type==="VariableDeclaration"&&A.declarations[0].init!=null&&(!j||this.options.ecmaVersion<8||this.strict||A.kind!=="var"||A.declarations[0].id.type!=="Identifier")?this.raise(A.start,(j?"for-in":"for-of")+" loop variable declaration may not have an initializer"):A.type==="AssignmentPattern"&&this.raise(A.start,"Invalid left-hand side in for-loop"),m.left=A,m.right=j?this.parseExpression():this.parseMaybeAssign(),this.expect(re.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,j?"ForInStatement":"ForOfStatement")},sr.parseVar=function(m,A,j){for(m.declarations=[],m.kind=j;;){var O=this.startNode();if(this.parseVarId(O,j),this.eat(re.eq)?O.init=this.parseMaybeAssign(A):j==="const"&&!(this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(A&&(this.type===re._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,m.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(re.comma))break}return m},sr.parseVarId=function(m,A){m.id=this.parseBindingAtom(),this.checkLVal(m.id,A==="var"?Z:be,!1)};var mt=1,yt=2,hr=4;sr.parseFunction=function(m,A,j,O){this.initFunction(m),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===re.star&&A&yt&&this.unexpected(),m.generator=this.eat(re.star)),this.options.ecmaVersion>=8&&(m.async=!!O),A&mt&&(m.id=A&hr&&this.type!==re.name?null:this.parseIdent(),m.id&&!(A&yt)&&this.checkLVal(m.id,this.strict||m.generator||m.async?this.treatFunctionsAsVar?Z:be:Ge));var le=this.yieldPos,Ie=this.awaitPos,ut=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(tr(m.async,m.generator)),A&mt||(m.id=this.type===re.name?this.parseIdent():null),this.parseFunctionParams(m),this.parseFunctionBody(m,j,!1),this.yieldPos=le,this.awaitPos=Ie,this.awaitIdentPos=ut,this.finishNode(m,A&mt?"FunctionDeclaration":"FunctionExpression")},sr.parseFunctionParams=function(m){this.expect(re.parenL),m.params=this.parseBindingList(re.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},sr.parseClass=function(m,A){this.next();var j=this.strict;this.strict=!0,this.parseClassId(m,A),this.parseClassSuper(m);var O=this.startNode(),le=!1;for(O.body=[],this.expect(re.braceL);this.type!==re.braceR;){var Ie=this.parseClassElement(m.superClass!==null);Ie&&(O.body.push(Ie),Ie.type==="MethodDefinition"&&Ie.kind==="constructor"&&(le&&this.raise(Ie.start,"Duplicate constructor in the same class"),le=!0))}return this.strict=j,this.next(),m.body=this.finishNode(O,"ClassBody"),this.finishNode(m,A?"ClassDeclaration":"ClassExpression")},sr.parseClassElement=function(m){var A=this;if(this.eat(re.semi))return null;var j=this.startNode(),O=function(Ot,Ar){Ar===void 0&&(Ar=!1);var jr=A.start,qn=A.startLoc;return A.eatContextual(Ot)?A.type!==re.parenL&&(!Ar||!A.canInsertSemicolon())?!0:(j.key&&A.unexpected(),j.computed=!1,j.key=A.startNodeAt(jr,qn),j.key.name=Ot,A.finishNode(j.key,"Identifier"),!1):!1};j.kind="method",j.static=O("static");var le=this.eat(re.star),Ie=!1;le||(this.options.ecmaVersion>=8&&O("async",!0)?(Ie=!0,le=this.options.ecmaVersion>=9&&this.eat(re.star)):O("get")?j.kind="get":O("set")&&(j.kind="set")),j.key||this.parsePropertyName(j);var ut=j.key,Pt=!1;return!j.computed&&!j.static&&(ut.type==="Identifier"&&ut.name==="constructor"||ut.type==="Literal"&&ut.value==="constructor")?(j.kind!=="method"&&this.raise(ut.start,"Constructor can't have get/set modifier"),le&&this.raise(ut.start,"Constructor can't be a generator"),Ie&&this.raise(ut.start,"Constructor can't be an async method"),j.kind="constructor",Pt=m):j.static&&ut.type==="Identifier"&&ut.name==="prototype"&&this.raise(ut.start,"Classes may not have a static property named prototype"),this.parseClassMethod(j,le,Ie,Pt),j.kind==="get"&&j.value.params.length!==0&&this.raiseRecoverable(j.value.start,"getter should have no params"),j.kind==="set"&&j.value.params.length!==1&&this.raiseRecoverable(j.value.start,"setter should have exactly one param"),j.kind==="set"&&j.value.params[0].type==="RestElement"&&this.raiseRecoverable(j.value.params[0].start,"Setter cannot use rest params"),j},sr.parseClassMethod=function(m,A,j,O){return m.value=this.parseMethod(A,j,O),this.finishNode(m,"MethodDefinition")},sr.parseClassId=function(m,A){this.type===re.name?(m.id=this.parseIdent(),A&&this.checkLVal(m.id,be,!1)):(A===!0&&this.unexpected(),m.id=null)},sr.parseClassSuper=function(m){m.superClass=this.eat(re._extends)?this.parseExprSubscripts():null},sr.parseExport=function(m,A){if(this.next(),this.eat(re.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(m.exported=this.parseIdent(!0),this.checkExport(A,m.exported.name,this.lastTokStart)):m.exported=null),this.expectContextual("from"),this.type!==re.string&&this.unexpected(),m.source=this.parseExprAtom(),this.semicolon(),this.finishNode(m,"ExportAllDeclaration");if(this.eat(re._default)){this.checkExport(A,"default",this.lastTokStart);var j;if(this.type===re._function||(j=this.isAsyncFunction())){var O=this.startNode();this.next(),j&&this.next(),m.declaration=this.parseFunction(O,mt|hr,!1,j)}else if(this.type===re._class){var le=this.startNode();m.declaration=this.parseClass(le,"nullableID")}else m.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(m,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())m.declaration=this.parseStatement(null),m.declaration.type==="VariableDeclaration"?this.checkVariableExport(A,m.declaration.declarations):this.checkExport(A,m.declaration.id.name,m.declaration.id.start),m.specifiers=[],m.source=null;else{if(m.declaration=null,m.specifiers=this.parseExportSpecifiers(A),this.eatContextual("from"))this.type!==re.string&&this.unexpected(),m.source=this.parseExprAtom();else{for(var Ie=0,ut=m.specifiers;Ie<ut.length;Ie+=1){var Pt=ut[Ie];this.checkUnreserved(Pt.local),this.checkLocalExport(Pt.local)}m.source=null}this.semicolon()}return this.finishNode(m,"ExportNamedDeclaration")},sr.checkExport=function(m,A,j){!m||(Ur(m,A)&&this.raiseRecoverable(j,"Duplicate export '"+A+"'"),m[A]=!0)},sr.checkPatternExport=function(m,A){var j=A.type;if(j==="Identifier")this.checkExport(m,A.name,A.start);else if(j==="ObjectPattern")for(var O=0,le=A.properties;O<le.length;O+=1){var Ie=le[O];this.checkPatternExport(m,Ie)}else if(j==="ArrayPattern")for(var ut=0,Pt=A.elements;ut<Pt.length;ut+=1){var Ot=Pt[ut];Ot&&this.checkPatternExport(m,Ot)}else j==="Property"?this.checkPatternExport(m,A.value):j==="AssignmentPattern"?this.checkPatternExport(m,A.left):j==="RestElement"?this.checkPatternExport(m,A.argument):j==="ParenthesizedExpression"&&this.checkPatternExport(m,A.expression)},sr.checkVariableExport=function(m,A){if(!!m)for(var j=0,O=A;j<O.length;j+=1){var le=O[j];this.checkPatternExport(m,le.id)}},sr.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},sr.parseExportSpecifiers=function(m){var A=[],j=!0;for(this.expect(re.braceL);!this.eat(re.braceR);){if(j)j=!1;else if(this.expect(re.comma),this.afterTrailingComma(re.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(m,O.exported.name,O.exported.start),A.push(this.finishNode(O,"ExportSpecifier"))}return A},sr.parseImport=function(m){return this.next(),this.type===re.string?(m.specifiers=tt,m.source=this.parseExprAtom()):(m.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),m.source=this.type===re.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(m,"ImportDeclaration")},sr.parseImportSpecifiers=function(){var m=[],A=!0;if(this.type===re.name){var j=this.startNode();if(j.local=this.parseIdent(),this.checkLVal(j.local,be),m.push(this.finishNode(j,"ImportDefaultSpecifier")),!this.eat(re.comma))return m}if(this.type===re.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,be),m.push(this.finishNode(O,"ImportNamespaceSpecifier")),m}for(this.expect(re.braceL);!this.eat(re.braceR);){if(A)A=!1;else if(this.expect(re.comma),this.afterTrailingComma(re.braceR))break;var le=this.startNode();le.imported=this.parseIdent(!0),this.eatContextual("as")?le.local=this.parseIdent():(this.checkUnreserved(le.imported),le.local=le.imported),this.checkLVal(le.local,be),m.push(this.finishNode(le,"ImportSpecifier"))}return m},sr.adaptDirectivePrologue=function(m){for(var A=0;A<m.length&&this.isDirectiveCandidate(m[A]);++A)m[A].directive=m[A].expression.raw.slice(1,-1)},sr.isDirectiveCandidate=function(m){return m.type==="ExpressionStatement"&&m.expression.type==="Literal"&&typeof m.expression.value=="string"&&(this.input[m.start]==='"'||this.input[m.start]==="'")};var Gr=St.prototype;Gr.toAssignable=function(m,A,j){if(this.options.ecmaVersion>=6&&m)switch(m.type){case"Identifier":this.inAsync&&m.name==="await"&&this.raise(m.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":m.type="ObjectPattern",j&&this.checkPatternErrors(j,!0);for(var O=0,le=m.properties;O<le.length;O+=1){var Ie=le[O];this.toAssignable(Ie,A),Ie.type==="RestElement"&&(Ie.argument.type==="ArrayPattern"||Ie.argument.type==="ObjectPattern")&&this.raise(Ie.argument.start,"Unexpected token")}break;case"Property":m.kind!=="init"&&this.raise(m.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(m.value,A);break;case"ArrayExpression":m.type="ArrayPattern",j&&this.checkPatternErrors(j,!0),this.toAssignableList(m.elements,A);break;case"SpreadElement":m.type="RestElement",this.toAssignable(m.argument,A),m.argument.type==="AssignmentPattern"&&this.raise(m.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":m.operator!=="="&&this.raise(m.left.end,"Only '=' operator can be used for specifying default value."),m.type="AssignmentPattern",delete m.operator,this.toAssignable(m.left,A);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(m.expression,A,j);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!A)break;default:this.raise(m.start,"Assigning to rvalue")}else j&&this.checkPatternErrors(j,!0);return m},Gr.toAssignableList=function(m,A){for(var j=m.length,O=0;O<j;O++){var le=m[O];le&&this.toAssignable(le,A)}if(j){var Ie=m[j-1];this.options.ecmaVersion===6&&A&&Ie&&Ie.type==="RestElement"&&Ie.argument.type!=="Identifier"&&this.unexpected(Ie.argument.start)}return m},Gr.parseSpread=function(m){var A=this.startNode();return this.next(),A.argument=this.parseMaybeAssign(!1,m),this.finishNode(A,"SpreadElement")},Gr.parseRestBinding=function(){var m=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==re.name&&this.unexpected(),m.argument=this.parseBindingAtom(),this.finishNode(m,"RestElement")},Gr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case re.bracketL:var m=this.startNode();return this.next(),m.elements=this.parseBindingList(re.bracketR,!0,!0),this.finishNode(m,"ArrayPattern");case re.braceL:return this.parseObj(!0)}return this.parseIdent()},Gr.parseBindingList=function(m,A,j){for(var O=[],le=!0;!this.eat(m);)if(le?le=!1:this.expect(re.comma),A&&this.type===re.comma)O.push(null);else{if(j&&this.afterTrailingComma(m))break;if(this.type===re.ellipsis){var Ie=this.parseRestBinding();this.parseBindingListItem(Ie),O.push(Ie),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(m);break}else{var ut=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(ut),O.push(ut)}}return O},Gr.parseBindingListItem=function(m){return m},Gr.parseMaybeDefault=function(m,A,j){if(j=j||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(re.eq))return j;var O=this.startNodeAt(m,A);return O.left=j,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},Gr.checkLVal=function(m,A,j){switch(A===void 0&&(A=E),m.type){case"Identifier":A===be&&m.name==="let"&&this.raiseRecoverable(m.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(m.name)&&this.raiseRecoverable(m.start,(A?"Binding ":"Assigning to ")+m.name+" in strict mode"),j&&(Ur(j,m.name)&&this.raiseRecoverable(m.start,"Argument name clash"),j[m.name]=!0),A!==E&&A!==gt&&this.declareName(m.name,A,m.start);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":A&&this.raiseRecoverable(m.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,le=m.properties;O<le.length;O+=1){var Ie=le[O];this.checkLVal(Ie,A,j)}break;case"Property":this.checkLVal(m.value,A,j);break;case"ArrayPattern":for(var ut=0,Pt=m.elements;ut<Pt.length;ut+=1){var Ot=Pt[ut];Ot&&this.checkLVal(Ot,A,j)}break;case"AssignmentPattern":this.checkLVal(m.left,A,j);break;case"RestElement":this.checkLVal(m.argument,A,j);break;case"ParenthesizedExpression":this.checkLVal(m.expression,A,j);break;default:this.raise(m.start,(A?"Binding":"Assigning to")+" rvalue")}};var Zr=St.prototype;Zr.checkPropClash=function(m,A,j){if(!(this.options.ecmaVersion>=9&&m.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(m.computed||m.method||m.shorthand))){var O=m.key,le;switch(O.type){case"Identifier":le=O.name;break;case"Literal":le=String(O.value);break;default:return}var Ie=m.kind;if(this.options.ecmaVersion>=6){le==="__proto__"&&Ie==="init"&&(A.proto&&(j?j.doubleProto<0&&(j.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),A.proto=!0);return}le="$"+le;var ut=A[le];if(ut){var Pt;Ie==="init"?Pt=this.strict&&ut.init||ut.get||ut.set:Pt=ut.init||ut[Ie],Pt&&this.raiseRecoverable(O.start,"Redefinition of property")}else ut=A[le]={init:!1,get:!1,set:!1};ut[Ie]=!0}},Zr.parseExpression=function(m,A){var j=this.start,O=this.startLoc,le=this.parseMaybeAssign(m,A);if(this.type===re.comma){var Ie=this.startNodeAt(j,O);for(Ie.expressions=[le];this.eat(re.comma);)Ie.expressions.push(this.parseMaybeAssign(m,A));return this.finishNode(Ie,"SequenceExpression")}return le},Zr.parseMaybeAssign=function(m,A,j){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(m);this.exprAllowed=!1}var O=!1,le=-1,Ie=-1;A?(le=A.parenthesizedAssign,Ie=A.trailingComma,A.parenthesizedAssign=A.trailingComma=-1):(A=new ie,O=!0);var ut=this.start,Pt=this.startLoc;(this.type===re.parenL||this.type===re.name)&&(this.potentialArrowAt=this.start);var Ot=this.parseMaybeConditional(m,A);if(j&&(Ot=j.call(this,Ot,ut,Pt)),this.type.isAssign){var Ar=this.startNodeAt(ut,Pt);return Ar.operator=this.value,Ar.left=this.type===re.eq?this.toAssignable(Ot,!1,A):Ot,O||(A.parenthesizedAssign=A.trailingComma=A.doubleProto=-1),A.shorthandAssign>=Ar.left.start&&(A.shorthandAssign=-1),this.checkLVal(Ot),this.next(),Ar.right=this.parseMaybeAssign(m),this.finishNode(Ar,"AssignmentExpression")}else O&&this.checkExpressionErrors(A,!0);return le>-1&&(A.parenthesizedAssign=le),Ie>-1&&(A.trailingComma=Ie),Ot},Zr.parseMaybeConditional=function(m,A){var j=this.start,O=this.startLoc,le=this.parseExprOps(m,A);if(this.checkExpressionErrors(A))return le;if(this.eat(re.question)){var Ie=this.startNodeAt(j,O);return Ie.test=le,Ie.consequent=this.parseMaybeAssign(),this.expect(re.colon),Ie.alternate=this.parseMaybeAssign(m),this.finishNode(Ie,"ConditionalExpression")}return le},Zr.parseExprOps=function(m,A){var j=this.start,O=this.startLoc,le=this.parseMaybeUnary(A,!1);return this.checkExpressionErrors(A)||le.start===j&&le.type==="ArrowFunctionExpression"?le:this.parseExprOp(le,j,O,-1,m)},Zr.parseExprOp=function(m,A,j,O,le){var Ie=this.type.binop;if(Ie!=null&&(!le||this.type!==re._in)&&Ie>O){var ut=this.type===re.logicalOR||this.type===re.logicalAND,Pt=this.type===re.coalesce;Pt&&(Ie=re.logicalAND.binop);var Ot=this.value;this.next();var Ar=this.start,jr=this.startLoc,qn=this.parseExprOp(this.parseMaybeUnary(null,!1),Ar,jr,Ie,le),gi=this.buildBinary(A,j,m,qn,Ot,ut||Pt);return(ut&&this.type===re.coalesce||Pt&&(this.type===re.logicalOR||this.type===re.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(gi,A,j,O,le)}return m},Zr.buildBinary=function(m,A,j,O,le,Ie){var ut=this.startNodeAt(m,A);return ut.left=j,ut.operator=le,ut.right=O,this.finishNode(ut,Ie?"LogicalExpression":"BinaryExpression")},Zr.parseMaybeUnary=function(m,A){var j=this.start,O=this.startLoc,le;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))le=this.parseAwait(),A=!0;else if(this.type.prefix){var Ie=this.startNode(),ut=this.type===re.incDec;Ie.operator=this.value,Ie.prefix=!0,this.next(),Ie.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(m,!0),ut?this.checkLVal(Ie.argument):this.strict&&Ie.operator==="delete"&&Ie.argument.type==="Identifier"?this.raiseRecoverable(Ie.start,"Deleting local variable in strict mode"):A=!0,le=this.finishNode(Ie,ut?"UpdateExpression":"UnaryExpression")}else{if(le=this.parseExprSubscripts(m),this.checkExpressionErrors(m))return le;for(;this.type.postfix&&!this.canInsertSemicolon();){var Pt=this.startNodeAt(j,O);Pt.operator=this.value,Pt.prefix=!1,Pt.argument=le,this.checkLVal(le),this.next(),le=this.finishNode(Pt,"UpdateExpression")}}return!A&&this.eat(re.starstar)?this.buildBinary(j,O,le,this.parseMaybeUnary(null,!1),"**",!1):le},Zr.parseExprSubscripts=function(m){var A=this.start,j=this.startLoc,O=this.parseExprAtom(m);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var le=this.parseSubscripts(O,A,j);return m&&le.type==="MemberExpression"&&(m.parenthesizedAssign>=le.start&&(m.parenthesizedAssign=-1),m.parenthesizedBind>=le.start&&(m.parenthesizedBind=-1)),le},Zr.parseSubscripts=function(m,A,j,O){for(var le=this.options.ecmaVersion>=8&&m.type==="Identifier"&&m.name==="async"&&this.lastTokEnd===m.end&&!this.canInsertSemicolon()&&m.end-m.start==5&&this.potentialArrowAt===m.start,Ie=!1;;){var ut=this.parseSubscript(m,A,j,O,le,Ie);if(ut.optional&&(Ie=!0),ut===m||ut.type==="ArrowFunctionExpression"){if(Ie){var Pt=this.startNodeAt(A,j);Pt.expression=ut,ut=this.finishNode(Pt,"ChainExpression")}return ut}m=ut}},Zr.parseSubscript=function(m,A,j,O,le,Ie){var ut=this.options.ecmaVersion>=11,Pt=ut&&this.eat(re.questionDot);O&&Pt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Ot=this.eat(re.bracketL);if(Ot||Pt&&this.type!==re.parenL&&this.type!==re.backQuote||this.eat(re.dot)){var Ar=this.startNodeAt(A,j);Ar.object=m,Ar.property=Ot?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Ar.computed=!!Ot,Ot&&this.expect(re.bracketR),ut&&(Ar.optional=Pt),m=this.finishNode(Ar,"MemberExpression")}else if(!O&&this.eat(re.parenL)){var jr=new ie,qn=this.yieldPos,gi=this.awaitPos,wn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var fa=this.parseExprList(re.parenR,this.options.ecmaVersion>=8,!1,jr);if(le&&!Pt&&!this.canInsertSemicolon()&&this.eat(re.arrow))return this.checkPatternErrors(jr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=qn,this.awaitPos=gi,this.awaitIdentPos=wn,this.parseArrowExpression(this.startNodeAt(A,j),fa,!0);this.checkExpressionErrors(jr,!0),this.yieldPos=qn||this.yieldPos,this.awaitPos=gi||this.awaitPos,this.awaitIdentPos=wn||this.awaitIdentPos;var Ni=this.startNodeAt(A,j);Ni.callee=m,Ni.arguments=fa,ut&&(Ni.optional=Pt),m=this.finishNode(Ni,"CallExpression")}else if(this.type===re.backQuote){(Pt||Ie)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Oa=this.startNodeAt(A,j);Oa.tag=m,Oa.quasi=this.parseTemplate({isTagged:!0}),m=this.finishNode(Oa,"TaggedTemplateExpression")}return m},Zr.parseExprAtom=function(m){this.type===re.slash&&this.readRegexp();var A,j=this.potentialArrowAt===this.start;switch(this.type){case re._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),A=this.startNode(),this.next(),this.type===re.parenL&&!this.allowDirectSuper&&this.raise(A.start,"super() call outside constructor of a subclass"),this.type!==re.dot&&this.type!==re.bracketL&&this.type!==re.parenL&&this.unexpected(),this.finishNode(A,"Super");case re._this:return A=this.startNode(),this.next(),this.finishNode(A,"ThisExpression");case re.name:var O=this.start,le=this.startLoc,Ie=this.containsEsc,ut=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Ie&&ut.name==="async"&&!this.canInsertSemicolon()&&this.eat(re._function))return this.parseFunction(this.startNodeAt(O,le),0,!1,!0);if(j&&!this.canInsertSemicolon()){if(this.eat(re.arrow))return this.parseArrowExpression(this.startNodeAt(O,le),[ut],!1);if(this.options.ecmaVersion>=8&&ut.name==="async"&&this.type===re.name&&!Ie)return ut=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(re.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,le),[ut],!0)}return ut;case re.regexp:var Pt=this.value;return A=this.parseLiteral(Pt.value),A.regex={pattern:Pt.pattern,flags:Pt.flags},A;case re.num:case re.string:return this.parseLiteral(this.value);case re._null:case re._true:case re._false:return A=this.startNode(),A.value=this.type===re._null?null:this.type===re._true,A.raw=this.type.keyword,this.next(),this.finishNode(A,"Literal");case re.parenL:var Ot=this.start,Ar=this.parseParenAndDistinguishExpression(j);return m&&(m.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Ar)&&(m.parenthesizedAssign=Ot),m.parenthesizedBind<0&&(m.parenthesizedBind=Ot)),Ar;case re.bracketL:return A=this.startNode(),this.next(),A.elements=this.parseExprList(re.bracketR,!0,!0,m),this.finishNode(A,"ArrayExpression");case re.braceL:return this.parseObj(!1,m);case re._function:return A=this.startNode(),this.next(),this.parseFunction(A,0);case re._class:return this.parseClass(this.startNode(),!1);case re._new:return this.parseNew();case re.backQuote:return this.parseTemplate();case re._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Zr.parseExprImport=function(){var m=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var A=this.parseIdent(!0);switch(this.type){case re.parenL:return this.parseDynamicImport(m);case re.dot:return m.meta=A,this.parseImportMeta(m);default:this.unexpected()}},Zr.parseDynamicImport=function(m){if(this.next(),m.source=this.parseMaybeAssign(),!this.eat(re.parenR)){var A=this.start;this.eat(re.comma)&&this.eat(re.parenR)?this.raiseRecoverable(A,"Trailing comma is not allowed in import()"):this.unexpected(A)}return this.finishNode(m,"ImportExpression")},Zr.parseImportMeta=function(m){this.next();var A=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="meta"&&this.raiseRecoverable(m.property.start,"The only valid meta property for import is 'import.meta'"),A&&this.raiseRecoverable(m.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(m.start,"Cannot use 'import.meta' outside a module"),this.finishNode(m,"MetaProperty")},Zr.parseLiteral=function(m){var A=this.startNode();return A.value=m,A.raw=this.input.slice(this.start,this.end),A.raw.charCodeAt(A.raw.length-1)===110&&(A.bigint=A.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(A,"Literal")},Zr.parseParenExpression=function(){this.expect(re.parenL);var m=this.parseExpression();return this.expect(re.parenR),m},Zr.parseParenAndDistinguishExpression=function(m){var A=this.start,j=this.startLoc,O,le=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Ie=this.start,ut=this.startLoc,Pt=[],Ot=!0,Ar=!1,jr=new ie,qn=this.yieldPos,gi=this.awaitPos,wn;for(this.yieldPos=0,this.awaitPos=0;this.type!==re.parenR;)if(Ot?Ot=!1:this.expect(re.comma),le&&this.afterTrailingComma(re.parenR,!0)){Ar=!0;break}else if(this.type===re.ellipsis){wn=this.start,Pt.push(this.parseParenItem(this.parseRestBinding())),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Pt.push(this.parseMaybeAssign(!1,jr,this.parseParenItem));var fa=this.start,Ni=this.startLoc;if(this.expect(re.parenR),m&&!this.canInsertSemicolon()&&this.eat(re.arrow))return this.checkPatternErrors(jr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=qn,this.awaitPos=gi,this.parseParenArrowList(A,j,Pt);(!Pt.length||Ar)&&this.unexpected(this.lastTokStart),wn&&this.unexpected(wn),this.checkExpressionErrors(jr,!0),this.yieldPos=qn||this.yieldPos,this.awaitPos=gi||this.awaitPos,Pt.length>1?(O=this.startNodeAt(Ie,ut),O.expressions=Pt,this.finishNodeAt(O,"SequenceExpression",fa,Ni)):O=Pt[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var Oa=this.startNodeAt(A,j);return Oa.expression=O,this.finishNode(Oa,"ParenthesizedExpression")}else return O},Zr.parseParenItem=function(m){return m},Zr.parseParenArrowList=function(m,A,j){return this.parseArrowExpression(this.startNodeAt(m,A),j)};var Jr=[];Zr.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var m=this.startNode(),A=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(re.dot)){m.meta=A;var j=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="target"&&this.raiseRecoverable(m.property.start,"The only valid meta property for new is 'new.target'"),j&&this.raiseRecoverable(m.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(m.start,"'new.target' can only be used in functions"),this.finishNode(m,"MetaProperty")}var O=this.start,le=this.startLoc,Ie=this.type===re._import;return m.callee=this.parseSubscripts(this.parseExprAtom(),O,le,!0),Ie&&m.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(re.parenL)?m.arguments=this.parseExprList(re.parenR,this.options.ecmaVersion>=8,!1):m.arguments=Jr,this.finishNode(m,"NewExpression")},Zr.parseTemplateElement=function(m){var A=m.isTagged,j=this.startNode();return this.type===re.invalidTemplate?(A||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),j.value={raw:this.value,cooked:null}):j.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),j.tail=this.type===re.backQuote,this.finishNode(j,"TemplateElement")},Zr.parseTemplate=function(m){m===void 0&&(m={});var A=m.isTagged;A===void 0&&(A=!1);var j=this.startNode();this.next(),j.expressions=[];var O=this.parseTemplateElement({isTagged:A});for(j.quasis=[O];!O.tail;)this.type===re.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(re.dollarBraceL),j.expressions.push(this.parseExpression()),this.expect(re.braceR),j.quasis.push(O=this.parseTemplateElement({isTagged:A}));return this.next(),this.finishNode(j,"TemplateLiteral")},Zr.isAsyncProp=function(m){return!m.computed&&m.key.type==="Identifier"&&m.key.name==="async"&&(this.type===re.name||this.type===re.num||this.type===re.string||this.type===re.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===re.star)&&!mr.test(this.input.slice(this.lastTokEnd,this.start))},Zr.parseObj=function(m,A){var j=this.startNode(),O=!0,le={};for(j.properties=[],this.next();!this.eat(re.braceR);){if(O)O=!1;else if(this.expect(re.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(re.braceR))break;var Ie=this.parseProperty(m,A);m||this.checkPropClash(Ie,le,A),j.properties.push(Ie)}return this.finishNode(j,m?"ObjectPattern":"ObjectExpression")},Zr.parseProperty=function(m,A){var j=this.startNode(),O,le,Ie,ut;if(this.options.ecmaVersion>=9&&this.eat(re.ellipsis))return m?(j.argument=this.parseIdent(!1),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(j,"RestElement")):(this.type===re.parenL&&A&&(A.parenthesizedAssign<0&&(A.parenthesizedAssign=this.start),A.parenthesizedBind<0&&(A.parenthesizedBind=this.start)),j.argument=this.parseMaybeAssign(!1,A),this.type===re.comma&&A&&A.trailingComma<0&&(A.trailingComma=this.start),this.finishNode(j,"SpreadElement"));this.options.ecmaVersion>=6&&(j.method=!1,j.shorthand=!1,(m||A)&&(Ie=this.start,ut=this.startLoc),m||(O=this.eat(re.star)));var Pt=this.containsEsc;return this.parsePropertyName(j),!m&&!Pt&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(j)?(le=!0,O=this.options.ecmaVersion>=9&&this.eat(re.star),this.parsePropertyName(j,A)):le=!1,this.parsePropertyValue(j,m,O,le,Ie,ut,A,Pt),this.finishNode(j,"Property")},Zr.parsePropertyValue=function(m,A,j,O,le,Ie,ut,Pt){if((j||O)&&this.type===re.colon&&this.unexpected(),this.eat(re.colon))m.value=A?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,ut),m.kind="init";else if(this.options.ecmaVersion>=6&&this.type===re.parenL)A&&this.unexpected(),m.kind="init",m.method=!0,m.value=this.parseMethod(j,O);else if(!A&&!Pt&&this.options.ecmaVersion>=5&&!m.computed&&m.key.type==="Identifier"&&(m.key.name==="get"||m.key.name==="set")&&this.type!==re.comma&&this.type!==re.braceR&&this.type!==re.eq){(j||O)&&this.unexpected(),m.kind=m.key.name,this.parsePropertyName(m),m.value=this.parseMethod(!1);var Ot=m.kind==="get"?0:1;if(m.value.params.length!==Ot){var Ar=m.value.start;m.kind==="get"?this.raiseRecoverable(Ar,"getter should have no params"):this.raiseRecoverable(Ar,"setter should have exactly one param")}else m.kind==="set"&&m.value.params[0].type==="RestElement"&&this.raiseRecoverable(m.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!m.computed&&m.key.type==="Identifier"?((j||O)&&this.unexpected(),this.checkUnreserved(m.key),m.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=le),m.kind="init",A?m.value=this.parseMaybeDefault(le,Ie,m.key):this.type===re.eq&&ut?(ut.shorthandAssign<0&&(ut.shorthandAssign=this.start),m.value=this.parseMaybeDefault(le,Ie,m.key)):m.value=m.key,m.shorthand=!0):this.unexpected()},Zr.parsePropertyName=function(m){if(this.options.ecmaVersion>=6){if(this.eat(re.bracketL))return m.computed=!0,m.key=this.parseMaybeAssign(),this.expect(re.bracketR),m.key;m.computed=!1}return m.key=this.type===re.num||this.type===re.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Zr.initFunction=function(m){m.id=null,this.options.ecmaVersion>=6&&(m.generator=m.expression=!1),this.options.ecmaVersion>=8&&(m.async=!1)},Zr.parseMethod=function(m,A,j){var O=this.startNode(),le=this.yieldPos,Ie=this.awaitPos,ut=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=m),this.options.ecmaVersion>=8&&(O.async=!!A),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(tr(A,O.generator)|Le|(j?It:0)),this.expect(re.parenL),O.params=this.parseBindingList(re.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=le,this.awaitPos=Ie,this.awaitIdentPos=ut,this.finishNode(O,"FunctionExpression")},Zr.parseArrowExpression=function(m,A,j){var O=this.yieldPos,le=this.awaitPos,Ie=this.awaitIdentPos;return this.enterScope(tr(j,!1)|Pe),this.initFunction(m),this.options.ecmaVersion>=8&&(m.async=!!j),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,m.params=this.toAssignableList(A,!0),this.parseFunctionBody(m,!0,!1),this.yieldPos=O,this.awaitPos=le,this.awaitIdentPos=Ie,this.finishNode(m,"ArrowFunctionExpression")},Zr.parseFunctionBody=function(m,A,j){var O=A&&this.type!==re.braceL,le=this.strict,Ie=!1;if(O)m.body=this.parseMaybeAssign(),m.expression=!0,this.checkParams(m,!1);else{var ut=this.options.ecmaVersion>=7&&!this.isSimpleParamList(m.params);(!le||ut)&&(Ie=this.strictDirective(this.end),Ie&&ut&&this.raiseRecoverable(m.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Pt=this.labels;this.labels=[],Ie&&(this.strict=!0),this.checkParams(m,!le&&!Ie&&!A&&!j&&this.isSimpleParamList(m.params)),this.strict&&m.id&&this.checkLVal(m.id,gt),m.body=this.parseBlock(!1,void 0,Ie&&!le),m.expression=!1,this.adaptDirectivePrologue(m.body.body),this.labels=Pt}this.exitScope()},Zr.isSimpleParamList=function(m){for(var A=0,j=m;A<j.length;A+=1){var O=j[A];if(O.type!=="Identifier")return!1}return!0},Zr.checkParams=function(m,A){for(var j={},O=0,le=m.params;O<le.length;O+=1){var Ie=le[O];this.checkLVal(Ie,Z,A?null:j)}},Zr.parseExprList=function(m,A,j,O){for(var le=[],Ie=!0;!this.eat(m);){if(Ie)Ie=!1;else if(this.expect(re.comma),A&&this.afterTrailingComma(m))break;var ut=void 0;j&&this.type===re.comma?ut=null:this.type===re.ellipsis?(ut=this.parseSpread(O),O&&this.type===re.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):ut=this.parseMaybeAssign(!1,O),le.push(ut)}return le},Zr.checkUnreserved=function(m){var A=m.start,j=m.end,O=m.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(A,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(A,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(A,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(A,j).indexOf("\\")!==-1)){var le=this.strict?this.reservedWordsStrict:this.reservedWords;le.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(A,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(A,"The keyword '"+O+"' is reserved"))}},Zr.parseIdent=function(m,A){var j=this.startNode();return this.type===re.name?j.name=this.value:this.type.keyword?(j.name=this.type.keyword,(j.name==="class"||j.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!m),this.finishNode(j,"Identifier"),m||(this.checkUnreserved(j),j.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=j.start)),j},Zr.parseYield=function(m){this.yieldPos||(this.yieldPos=this.start);var A=this.startNode();return this.next(),this.type===re.semi||this.canInsertSemicolon()||this.type!==re.star&&!this.type.startsExpr?(A.delegate=!1,A.argument=null):(A.delegate=this.eat(re.star),A.argument=this.parseMaybeAssign(m)),this.finishNode(A,"YieldExpression")},Zr.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var m=this.startNode();return this.next(),m.argument=this.parseMaybeUnary(null,!1),this.finishNode(m,"AwaitExpression")};var qr=St.prototype;qr.raise=function(m,A){var j=pt(this.input,m);A+=" ("+j.line+":"+j.column+")";var O=new SyntaxError(A);throw O.pos=m,O.loc=j,O.raisedAt=this.pos,O},qr.raiseRecoverable=qr.raise,qr.curPosition=function(){if(this.options.locations)return new ge(this.curLine,this.pos-this.lineStart)};var Er=St.prototype,Jn=function(A){this.flags=A,this.var=[],this.lexical=[],this.functions=[]};Er.enterScope=function(m){this.scopeStack.push(new Jn(m))},Er.exitScope=function(){this.scopeStack.pop()},Er.treatFunctionsAsVarInScope=function(m){return m.flags&mn||!this.inModule&&m.flags&pn},Er.declareName=function(m,A,j){var O=!1;if(A===be){var le=this.currentScope();O=le.lexical.indexOf(m)>-1||le.functions.indexOf(m)>-1||le.var.indexOf(m)>-1,le.lexical.push(m),this.inModule&&le.flags&pn&&delete this.undefinedExports[m]}else if(A===qe){var Ie=this.currentScope();Ie.lexical.push(m)}else if(A===Ge){var ut=this.currentScope();this.treatFunctionsAsVar?O=ut.lexical.indexOf(m)>-1:O=ut.lexical.indexOf(m)>-1||ut.var.indexOf(m)>-1,ut.functions.push(m)}else for(var Pt=this.scopeStack.length-1;Pt>=0;--Pt){var Ot=this.scopeStack[Pt];if(Ot.lexical.indexOf(m)>-1&&!(Ot.flags&Ze&&Ot.lexical[0]===m)||!this.treatFunctionsAsVarInScope(Ot)&&Ot.functions.indexOf(m)>-1){O=!0;break}if(Ot.var.push(m),this.inModule&&Ot.flags&pn&&delete this.undefinedExports[m],Ot.flags&Xi)break}O&&this.raiseRecoverable(j,"Identifier '"+m+"' has already been declared")},Er.checkLocalExport=function(m){this.scopeStack[0].lexical.indexOf(m.name)===-1&&this.scopeStack[0].var.indexOf(m.name)===-1&&(this.undefinedExports[m.name]=m)},Er.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Er.currentVarScope=function(){for(var m=this.scopeStack.length-1;;m--){var A=this.scopeStack[m];if(A.flags&Xi)return A}},Er.currentThisScope=function(){for(var m=this.scopeStack.length-1;;m--){var A=this.scopeStack[m];if(A.flags&Xi&&!(A.flags&Pe))return A}};var Wn=function(A,j,O){this.type="",this.start=j,this.end=0,A.options.locations&&(this.loc=new _t(A,O)),A.options.directSourceFile&&(this.sourceFile=A.options.directSourceFile),A.options.ranges&&(this.range=[j,0])},Ti=St.prototype;Ti.startNode=function(){return new Wn(this,this.start,this.startLoc)},Ti.startNodeAt=function(m,A){return new Wn(this,m,A)};function $i(m,A,j,O){return m.type=A,m.end=j,this.options.locations&&(m.loc.end=O),this.options.ranges&&(m.range[1]=j),m}Ti.finishNode=function(m,A){return $i.call(this,m,A,this.lastTokEnd,this.lastTokEndLoc)},Ti.finishNodeAt=function(m,A,j,O){return $i.call(this,m,A,j,O)};var Ji=function(A,j,O,le,Ie){this.token=A,this.isExpr=!!j,this.preserveSpace=!!O,this.override=le,this.generator=!!Ie},Pi={b_stat:new Ji("{",!1),b_expr:new Ji("{",!0),b_tmpl:new Ji("${",!1),p_stat:new Ji("(",!1),p_expr:new Ji("(",!0),q_tmpl:new Ji("`",!0,!0,function(m){return m.tryReadTemplateToken()}),f_stat:new Ji("function",!1),f_expr:new Ji("function",!0),f_expr_gen:new Ji("function",!0,!1,null,!0),f_gen:new Ji("function",!1,!1,null,!0)},Ri=St.prototype;Ri.initialContext=function(){return[Pi.b_stat]},Ri.braceIsBlock=function(m){var A=this.curContext();return A===Pi.f_expr||A===Pi.f_stat?!0:m===re.colon&&(A===Pi.b_stat||A===Pi.b_expr)?!A.isExpr:m===re._return||m===re.name&&this.exprAllowed?mr.test(this.input.slice(this.lastTokEnd,this.start)):m===re._else||m===re.semi||m===re.eof||m===re.parenR||m===re.arrow?!0:m===re.braceL?A===Pi.b_stat:m===re._var||m===re._const||m===re.name?!1:!this.exprAllowed},Ri.inGeneratorContext=function(){for(var m=this.context.length-1;m>=1;m--){var A=this.context[m];if(A.token==="function")return A.generator}return!1},Ri.updateContext=function(m){var A,j=this.type;j.keyword&&m===re.dot?this.exprAllowed=!1:(A=j.updateContext)?A.call(this,m):this.exprAllowed=j.beforeExpr},re.parenR.updateContext=re.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var m=this.context.pop();m===Pi.b_stat&&this.curContext().token==="function"&&(m=this.context.pop()),this.exprAllowed=!m.isExpr},re.braceL.updateContext=function(m){this.context.push(this.braceIsBlock(m)?Pi.b_stat:Pi.b_expr),this.exprAllowed=!0},re.dollarBraceL.updateContext=function(){this.context.push(Pi.b_tmpl),this.exprAllowed=!0},re.parenL.updateContext=function(m){var A=m===re._if||m===re._for||m===re._with||m===re._while;this.context.push(A?Pi.p_stat:Pi.p_expr),this.exprAllowed=!0},re.incDec.updateContext=function(){},re._function.updateContext=re._class.updateContext=function(m){m.beforeExpr&&m!==re.semi&&m!==re._else&&!(m===re._return&&mr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((m===re.colon||m===re.braceL)&&this.curContext()===Pi.b_stat)?this.context.push(Pi.f_expr):this.context.push(Pi.f_stat),this.exprAllowed=!1},re.backQuote.updateContext=function(){this.curContext()===Pi.q_tmpl?this.context.pop():this.context.push(Pi.q_tmpl),this.exprAllowed=!1},re.star.updateContext=function(m){if(m===re._function){var A=this.context.length-1;this.context[A]===Pi.f_expr?this.context[A]=Pi.f_expr_gen:this.context[A]=Pi.f_gen}this.exprAllowed=!0},re.name.updateContext=function(m){var A=!1;this.options.ecmaVersion>=6&&m!==re.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(A=!0),this.exprAllowed=A};var Y="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ce=Y+" Extended_Pictographic",me=ce,z={9:Y,10:ce,11:me},oe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",de="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Ae=de+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",se=Ae+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Ee={9:de,10:Ae,11:se},dt={};function br(m){var A=dt[m]={binary:Re(z[m]+" "+oe),nonBinary:{General_Category:Re(oe),Script:Re(Ee[m])}};A.nonBinary.Script_Extensions=A.nonBinary.Script,A.nonBinary.gc=A.nonBinary.General_Category,A.nonBinary.sc=A.nonBinary.Script,A.nonBinary.scx=A.nonBinary.Script_Extensions}br(9),br(10),br(11);var Ht=St.prototype,Qt=function(A){this.parser=A,this.validFlags="gim"+(A.options.ecmaVersion>=6?"uy":"")+(A.options.ecmaVersion>=9?"s":""),this.unicodeProperties=dt[A.options.ecmaVersion>=11?11:A.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Qt.prototype.reset=function(A,j,O){var le=O.indexOf("u")!==-1;this.start=A|0,this.source=j+"",this.flags=O,this.switchU=le&&this.parser.options.ecmaVersion>=6,this.switchN=le&&this.parser.options.ecmaVersion>=9},Qt.prototype.raise=function(A){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+A)},Qt.prototype.at=function(A,j){j===void 0&&(j=!1);var O=this.source,le=O.length;if(A>=le)return-1;var Ie=O.charCodeAt(A);if(!(j||this.switchU)||Ie<=55295||Ie>=57344||A+1>=le)return Ie;var ut=O.charCodeAt(A+1);return ut>=56320&&ut<=57343?(Ie<<10)+ut-56613888:Ie},Qt.prototype.nextIndex=function(A,j){j===void 0&&(j=!1);var O=this.source,le=O.length;if(A>=le)return le;var Ie=O.charCodeAt(A),ut;return!(j||this.switchU)||Ie<=55295||Ie>=57344||A+1>=le||(ut=O.charCodeAt(A+1))<56320||ut>57343?A+1:A+2},Qt.prototype.current=function(A){return A===void 0&&(A=!1),this.at(this.pos,A)},Qt.prototype.lookahead=function(A){return A===void 0&&(A=!1),this.at(this.nextIndex(this.pos,A),A)},Qt.prototype.advance=function(A){A===void 0&&(A=!1),this.pos=this.nextIndex(this.pos,A)},Qt.prototype.eat=function(A,j){return j===void 0&&(j=!1),this.current(j)===A?(this.advance(j),!0):!1};function Rr(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Ht.validateRegExpFlags=function(m){for(var A=m.validFlags,j=m.flags,O=0;O<j.length;O++){var le=j.charAt(O);A.indexOf(le)===-1&&this.raise(m.start,"Invalid regular expression flag"),j.indexOf(le,O+1)>-1&&this.raise(m.start,"Duplicate regular expression flag")}},Ht.validateRegExpPattern=function(m){this.regexp_pattern(m),!m.switchN&&this.options.ecmaVersion>=9&&m.groupNames.length>0&&(m.switchN=!0,this.regexp_pattern(m))},Ht.regexp_pattern=function(m){m.pos=0,m.lastIntValue=0,m.lastStringValue="",m.lastAssertionIsQuantifiable=!1,m.numCapturingParens=0,m.maxBackReference=0,m.groupNames.length=0,m.backReferenceNames.length=0,this.regexp_disjunction(m),m.pos!==m.source.length&&(m.eat(41)&&m.raise("Unmatched ')'"),(m.eat(93)||m.eat(125))&&m.raise("Lone quantifier brackets")),m.maxBackReference>m.numCapturingParens&&m.raise("Invalid escape");for(var A=0,j=m.backReferenceNames;A<j.length;A+=1){var O=j[A];m.groupNames.indexOf(O)===-1&&m.raise("Invalid named capture referenced")}},Ht.regexp_disjunction=function(m){for(this.regexp_alternative(m);m.eat(124);)this.regexp_alternative(m);this.regexp_eatQuantifier(m,!0)&&m.raise("Nothing to repeat"),m.eat(123)&&m.raise("Lone quantifier brackets")},Ht.regexp_alternative=function(m){for(;m.pos<m.source.length&&this.regexp_eatTerm(m););},Ht.regexp_eatTerm=function(m){return this.regexp_eatAssertion(m)?(m.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(m)&&m.switchU&&m.raise("Invalid quantifier"),!0):(m.switchU?this.regexp_eatAtom(m):this.regexp_eatExtendedAtom(m))?(this.regexp_eatQuantifier(m),!0):!1},Ht.regexp_eatAssertion=function(m){var A=m.pos;if(m.lastAssertionIsQuantifiable=!1,m.eat(94)||m.eat(36))return!0;if(m.eat(92)){if(m.eat(66)||m.eat(98))return!0;m.pos=A}if(m.eat(40)&&m.eat(63)){var j=!1;if(this.options.ecmaVersion>=9&&(j=m.eat(60)),m.eat(61)||m.eat(33))return this.regexp_disjunction(m),m.eat(41)||m.raise("Unterminated group"),m.lastAssertionIsQuantifiable=!j,!0}return m.pos=A,!1},Ht.regexp_eatQuantifier=function(m,A){return A===void 0&&(A=!1),this.regexp_eatQuantifierPrefix(m,A)?(m.eat(63),!0):!1},Ht.regexp_eatQuantifierPrefix=function(m,A){return m.eat(42)||m.eat(43)||m.eat(63)||this.regexp_eatBracedQuantifier(m,A)},Ht.regexp_eatBracedQuantifier=function(m,A){var j=m.pos;if(m.eat(123)){var O=0,le=-1;if(this.regexp_eatDecimalDigits(m)&&(O=m.lastIntValue,m.eat(44)&&this.regexp_eatDecimalDigits(m)&&(le=m.lastIntValue),m.eat(125)))return le!==-1&&le<O&&!A&&m.raise("numbers out of order in {} quantifier"),!0;m.switchU&&!A&&m.raise("Incomplete quantifier"),m.pos=j}return!1},Ht.regexp_eatAtom=function(m){return this.regexp_eatPatternCharacters(m)||m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)},Ht.regexp_eatReverseSolidusAtomEscape=function(m){var A=m.pos;if(m.eat(92)){if(this.regexp_eatAtomEscape(m))return!0;m.pos=A}return!1},Ht.regexp_eatUncapturingGroup=function(m){var A=m.pos;if(m.eat(40)){if(m.eat(63)&&m.eat(58)){if(this.regexp_disjunction(m),m.eat(41))return!0;m.raise("Unterminated group")}m.pos=A}return!1},Ht.regexp_eatCapturingGroup=function(m){if(m.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(m):m.current()===63&&m.raise("Invalid group"),this.regexp_disjunction(m),m.eat(41))return m.numCapturingParens+=1,!0;m.raise("Unterminated group")}return!1},Ht.regexp_eatExtendedAtom=function(m){return m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)||this.regexp_eatInvalidBracedQuantifier(m)||this.regexp_eatExtendedPatternCharacter(m)},Ht.regexp_eatInvalidBracedQuantifier=function(m){return this.regexp_eatBracedQuantifier(m,!0)&&m.raise("Nothing to repeat"),!1},Ht.regexp_eatSyntaxCharacter=function(m){var A=m.current();return kn(A)?(m.lastIntValue=A,m.advance(),!0):!1};function kn(m){return m===36||m>=40&&m<=43||m===46||m===63||m>=91&&m<=94||m>=123&&m<=125}Ht.regexp_eatPatternCharacters=function(m){for(var A=m.pos,j=0;(j=m.current())!==-1&&!kn(j);)m.advance();return m.pos!==A},Ht.regexp_eatExtendedPatternCharacter=function(m){var A=m.current();return A!==-1&&A!==36&&!(A>=40&&A<=43)&&A!==46&&A!==63&&A!==91&&A!==94&&A!==124?(m.advance(),!0):!1},Ht.regexp_groupSpecifier=function(m){if(m.eat(63)){if(this.regexp_eatGroupName(m)){m.groupNames.indexOf(m.lastStringValue)!==-1&&m.raise("Duplicate capture group name"),m.groupNames.push(m.lastStringValue);return}m.raise("Invalid group")}},Ht.regexp_eatGroupName=function(m){if(m.lastStringValue="",m.eat(60)){if(this.regexp_eatRegExpIdentifierName(m)&&m.eat(62))return!0;m.raise("Invalid capture group name")}return!1},Ht.regexp_eatRegExpIdentifierName=function(m){if(m.lastStringValue="",this.regexp_eatRegExpIdentifierStart(m)){for(m.lastStringValue+=Rr(m.lastIntValue);this.regexp_eatRegExpIdentifierPart(m);)m.lastStringValue+=Rr(m.lastIntValue);return!0}return!1},Ht.regexp_eatRegExpIdentifierStart=function(m){var A=m.pos,j=this.options.ecmaVersion>=11,O=m.current(j);return m.advance(j),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,j)&&(O=m.lastIntValue),Ln(O)?(m.lastIntValue=O,!0):(m.pos=A,!1)};function Ln(m){return rt(m,!0)||m===36||m===95}Ht.regexp_eatRegExpIdentifierPart=function(m){var A=m.pos,j=this.options.ecmaVersion>=11,O=m.current(j);return m.advance(j),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,j)&&(O=m.lastIntValue),$t(O)?(m.lastIntValue=O,!0):(m.pos=A,!1)};function $t(m){return Xt(m,!0)||m===36||m===95||m===8204||m===8205}Ht.regexp_eatAtomEscape=function(m){return this.regexp_eatBackReference(m)||this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)||m.switchN&&this.regexp_eatKGroupName(m)?!0:(m.switchU&&(m.current()===99&&m.raise("Invalid unicode escape"),m.raise("Invalid escape")),!1)},Ht.regexp_eatBackReference=function(m){var A=m.pos;if(this.regexp_eatDecimalEscape(m)){var j=m.lastIntValue;if(m.switchU)return j>m.maxBackReference&&(m.maxBackReference=j),!0;if(j<=m.numCapturingParens)return!0;m.pos=A}return!1},Ht.regexp_eatKGroupName=function(m){if(m.eat(107)){if(this.regexp_eatGroupName(m))return m.backReferenceNames.push(m.lastStringValue),!0;m.raise("Invalid named reference")}return!1},Ht.regexp_eatCharacterEscape=function(m){return this.regexp_eatControlEscape(m)||this.regexp_eatCControlLetter(m)||this.regexp_eatZero(m)||this.regexp_eatHexEscapeSequence(m)||this.regexp_eatRegExpUnicodeEscapeSequence(m,!1)||!m.switchU&&this.regexp_eatLegacyOctalEscapeSequence(m)||this.regexp_eatIdentityEscape(m)},Ht.regexp_eatCControlLetter=function(m){var A=m.pos;if(m.eat(99)){if(this.regexp_eatControlLetter(m))return!0;m.pos=A}return!1},Ht.regexp_eatZero=function(m){return m.current()===48&&!Ai(m.lookahead())?(m.lastIntValue=0,m.advance(),!0):!1},Ht.regexp_eatControlEscape=function(m){var A=m.current();return A===116?(m.lastIntValue=9,m.advance(),!0):A===110?(m.lastIntValue=10,m.advance(),!0):A===118?(m.lastIntValue=11,m.advance(),!0):A===102?(m.lastIntValue=12,m.advance(),!0):A===114?(m.lastIntValue=13,m.advance(),!0):!1},Ht.regexp_eatControlLetter=function(m){var A=m.current();return Cn(A)?(m.lastIntValue=A%32,m.advance(),!0):!1};function Cn(m){return m>=65&&m<=90||m>=97&&m<=122}Ht.regexp_eatRegExpUnicodeEscapeSequence=function(m,A){A===void 0&&(A=!1);var j=m.pos,O=A||m.switchU;if(m.eat(117)){if(this.regexp_eatFixedHexDigits(m,4)){var le=m.lastIntValue;if(O&&le>=55296&&le<=56319){var Ie=m.pos;if(m.eat(92)&&m.eat(117)&&this.regexp_eatFixedHexDigits(m,4)){var ut=m.lastIntValue;if(ut>=56320&&ut<=57343)return m.lastIntValue=(le-55296)*1024+(ut-56320)+65536,!0}m.pos=Ie,m.lastIntValue=le}return!0}if(O&&m.eat(123)&&this.regexp_eatHexDigits(m)&&m.eat(125)&&sn(m.lastIntValue))return!0;O&&m.raise("Invalid unicode escape"),m.pos=j}return!1};function sn(m){return m>=0&&m<=1114111}Ht.regexp_eatIdentityEscape=function(m){if(m.switchU)return this.regexp_eatSyntaxCharacter(m)?!0:m.eat(47)?(m.lastIntValue=47,!0):!1;var A=m.current();return A!==99&&(!m.switchN||A!==107)?(m.lastIntValue=A,m.advance(),!0):!1},Ht.regexp_eatDecimalEscape=function(m){m.lastIntValue=0;var A=m.current();if(A>=49&&A<=57){do m.lastIntValue=10*m.lastIntValue+(A-48),m.advance();while((A=m.current())>=48&&A<=57);return!0}return!1},Ht.regexp_eatCharacterClassEscape=function(m){var A=m.current();if(an(A))return m.lastIntValue=-1,m.advance(),!0;if(m.switchU&&this.options.ecmaVersion>=9&&(A===80||A===112)){if(m.lastIntValue=-1,m.advance(),m.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(m)&&m.eat(125))return!0;m.raise("Invalid property name")}return!1};function an(m){return m===100||m===68||m===115||m===83||m===119||m===87}Ht.regexp_eatUnicodePropertyValueExpression=function(m){var A=m.pos;if(this.regexp_eatUnicodePropertyName(m)&&m.eat(61)){var j=m.lastStringValue;if(this.regexp_eatUnicodePropertyValue(m)){var O=m.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(m,j,O),!0}}if(m.pos=A,this.regexp_eatLoneUnicodePropertyNameOrValue(m)){var le=m.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(m,le),!0}return!1},Ht.regexp_validateUnicodePropertyNameAndValue=function(m,A,j){Ur(m.unicodeProperties.nonBinary,A)||m.raise("Invalid property name"),m.unicodeProperties.nonBinary[A].test(j)||m.raise("Invalid property value")},Ht.regexp_validateUnicodePropertyNameOrValue=function(m,A){m.unicodeProperties.binary.test(A)||m.raise("Invalid property name")},Ht.regexp_eatUnicodePropertyName=function(m){var A=0;for(m.lastStringValue="";Ii(A=m.current());)m.lastStringValue+=Rr(A),m.advance();return m.lastStringValue!==""};function Ii(m){return Cn(m)||m===95}Ht.regexp_eatUnicodePropertyValue=function(m){var A=0;for(m.lastStringValue="";xn(A=m.current());)m.lastStringValue+=Rr(A),m.advance();return m.lastStringValue!==""};function xn(m){return Ii(m)||Ai(m)}Ht.regexp_eatLoneUnicodePropertyNameOrValue=function(m){return this.regexp_eatUnicodePropertyValue(m)},Ht.regexp_eatCharacterClass=function(m){if(m.eat(91)){if(m.eat(94),this.regexp_classRanges(m),m.eat(93))return!0;m.raise("Unterminated character class")}return!1},Ht.regexp_classRanges=function(m){for(;this.regexp_eatClassAtom(m);){var A=m.lastIntValue;if(m.eat(45)&&this.regexp_eatClassAtom(m)){var j=m.lastIntValue;m.switchU&&(A===-1||j===-1)&&m.raise("Invalid character class"),A!==-1&&j!==-1&&A>j&&m.raise("Range out of order in character class")}}},Ht.regexp_eatClassAtom=function(m){var A=m.pos;if(m.eat(92)){if(this.regexp_eatClassEscape(m))return!0;if(m.switchU){var j=m.current();(j===99||Yi(j))&&m.raise("Invalid class escape"),m.raise("Invalid escape")}m.pos=A}var O=m.current();return O!==93?(m.lastIntValue=O,m.advance(),!0):!1},Ht.regexp_eatClassEscape=function(m){var A=m.pos;if(m.eat(98))return m.lastIntValue=8,!0;if(m.switchU&&m.eat(45))return m.lastIntValue=45,!0;if(!m.switchU&&m.eat(99)){if(this.regexp_eatClassControlLetter(m))return!0;m.pos=A}return this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)},Ht.regexp_eatClassControlLetter=function(m){var A=m.current();return Ai(A)||A===95?(m.lastIntValue=A%32,m.advance(),!0):!1},Ht.regexp_eatHexEscapeSequence=function(m){var A=m.pos;if(m.eat(120)){if(this.regexp_eatFixedHexDigits(m,2))return!0;m.switchU&&m.raise("Invalid escape"),m.pos=A}return!1},Ht.regexp_eatDecimalDigits=function(m){var A=m.pos,j=0;for(m.lastIntValue=0;Ai(j=m.current());)m.lastIntValue=10*m.lastIntValue+(j-48),m.advance();return m.pos!==A};function Ai(m){return m>=48&&m<=57}Ht.regexp_eatHexDigits=function(m){var A=m.pos,j=0;for(m.lastIntValue=0;Qi(j=m.current());)m.lastIntValue=16*m.lastIntValue+li(j),m.advance();return m.pos!==A};function Qi(m){return m>=48&&m<=57||m>=65&&m<=70||m>=97&&m<=102}function li(m){return m>=65&&m<=70?10+(m-65):m>=97&&m<=102?10+(m-97):m-48}Ht.regexp_eatLegacyOctalEscapeSequence=function(m){if(this.regexp_eatOctalDigit(m)){var A=m.lastIntValue;if(this.regexp_eatOctalDigit(m)){var j=m.lastIntValue;A<=3&&this.regexp_eatOctalDigit(m)?m.lastIntValue=A*64+j*8+m.lastIntValue:m.lastIntValue=A*8+j}else m.lastIntValue=A;return!0}return!1},Ht.regexp_eatOctalDigit=function(m){var A=m.current();return Yi(A)?(m.lastIntValue=A-48,m.advance(),!0):(m.lastIntValue=0,!1)};function Yi(m){return m>=48&&m<=55}Ht.regexp_eatFixedHexDigits=function(m,A){var j=m.pos;m.lastIntValue=0;for(var O=0;O<A;++O){var le=m.current();if(!Qi(le))return m.pos=j,!1;m.lastIntValue=16*m.lastIntValue+li(le),m.advance()}return!0};var Bi=function(A){this.type=A.type,this.value=A.value,this.start=A.start,this.end=A.end,A.options.locations&&(this.loc=new _t(A,A.startLoc,A.endLoc)),A.options.ranges&&(this.range=[A.start,A.end])},wi=St.prototype;wi.next=function(m){!m&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Bi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},wi.getToken=function(){return this.next(),new Bi(this)},typeof Symbol!="undefined"&&(wi[Symbol.iterator]=function(){var m=this;return{next:function(){var A=m.getToken();return{done:A.type===re.eof,value:A}}}}),wi.curContext=function(){return this.context[this.context.length-1]},wi.nextToken=function(){var m=this.curContext();if((!m||!m.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(re.eof);if(m.override)return m.override(this);this.readToken(this.fullCharCodeAtPos())},wi.readToken=function(m){return rt(m,this.options.ecmaVersion>=6)||m===92?this.readWord():this.getTokenFromCode(m)},wi.fullCharCodeAtPos=function(){var m=this.input.charCodeAt(this.pos);if(m<=55295||m>=57344)return m;var A=this.input.charCodeAt(this.pos+1);return(m<<10)+A-56613888},wi.skipBlockComment=function(){var m=this.options.onComment&&this.curPosition(),A=this.pos,j=this.input.indexOf("*/",this.pos+=2);if(j===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=j+2,this.options.locations){wt.lastIndex=A;for(var O;(O=wt.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(A+2,j),A,this.pos,m,this.curPosition())},wi.skipLineComment=function(m){for(var A=this.pos,j=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=m);this.pos<this.input.length&&!Ke(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(A+m,this.pos),A,this.pos,j,this.curPosition())},wi.skipSpace=function(){e:for(;this.pos<this.input.length;){var m=this.input.charCodeAt(this.pos);switch(m){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(m>8&&m<14||m>=5760&&Dt.test(String.fromCharCode(m)))++this.pos;else break e}}},wi.finishToken=function(m,A){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var j=this.type;this.type=m,this.value=A,this.updateContext(j)},wi.readToken_dot=function(){var m=this.input.charCodeAt(this.pos+1);if(m>=48&&m<=57)return this.readNumber(!0);var A=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&m===46&&A===46?(this.pos+=3,this.finishToken(re.ellipsis)):(++this.pos,this.finishToken(re.dot))},wi.readToken_slash=function(){var m=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):m===61?this.finishOp(re.assign,2):this.finishOp(re.slash,1)},wi.readToken_mult_modulo_exp=function(m){var A=this.input.charCodeAt(this.pos+1),j=1,O=m===42?re.star:re.modulo;return this.options.ecmaVersion>=7&&m===42&&A===42&&(++j,O=re.starstar,A=this.input.charCodeAt(this.pos+2)),A===61?this.finishOp(re.assign,j+1):this.finishOp(O,j)},wi.readToken_pipe_amp=function(m){var A=this.input.charCodeAt(this.pos+1);if(A===m){if(this.options.ecmaVersion>=12){var j=this.input.charCodeAt(this.pos+2);if(j===61)return this.finishOp(re.assign,3)}return this.finishOp(m===124?re.logicalOR:re.logicalAND,2)}return A===61?this.finishOp(re.assign,2):this.finishOp(m===124?re.bitwiseOR:re.bitwiseAND,1)},wi.readToken_caret=function(){var m=this.input.charCodeAt(this.pos+1);return m===61?this.finishOp(re.assign,2):this.finishOp(re.bitwiseXOR,1)},wi.readToken_plus_min=function(m){var A=this.input.charCodeAt(this.pos+1);return A===m?A===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||mr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(re.incDec,2):A===61?this.finishOp(re.assign,2):this.finishOp(re.plusMin,1)},wi.readToken_lt_gt=function(m){var A=this.input.charCodeAt(this.pos+1),j=1;return A===m?(j=m===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+j)===61?this.finishOp(re.assign,j+1):this.finishOp(re.bitShift,j)):A===33&&m===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(A===61&&(j=2),this.finishOp(re.relational,j))},wi.readToken_eq_excl=function(m){var A=this.input.charCodeAt(this.pos+1);return A===61?this.finishOp(re.equality,this.input.charCodeAt(this.pos+2)===61?3:2):m===61&&A===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(re.arrow)):this.finishOp(m===61?re.eq:re.prefix,1)},wi.readToken_question=function(){var m=this.options.ecmaVersion;if(m>=11){var A=this.input.charCodeAt(this.pos+1);if(A===46){var j=this.input.charCodeAt(this.pos+2);if(j<48||j>57)return this.finishOp(re.questionDot,2)}if(A===63){if(m>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(re.assign,3)}return this.finishOp(re.coalesce,2)}}return this.finishOp(re.question,1)},wi.getTokenFromCode=function(m){switch(m){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(re.parenL);case 41:return++this.pos,this.finishToken(re.parenR);case 59:return++this.pos,this.finishToken(re.semi);case 44:return++this.pos,this.finishToken(re.comma);case 91:return++this.pos,this.finishToken(re.bracketL);case 93:return++this.pos,this.finishToken(re.bracketR);case 123:return++this.pos,this.finishToken(re.braceL);case 125:return++this.pos,this.finishToken(re.braceR);case 58:return++this.pos,this.finishToken(re.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(re.backQuote);case 48:var A=this.input.charCodeAt(this.pos+1);if(A===120||A===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(A===111||A===79)return this.readRadixNumber(8);if(A===98||A===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(m);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(m);case 124:case 38:return this.readToken_pipe_amp(m);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(m);case 60:case 62:return this.readToken_lt_gt(m);case 61:case 33:return this.readToken_eq_excl(m);case 63:return this.readToken_question();case 126:return this.finishOp(re.prefix,1)}this.raise(this.pos,"Unexpected character '"+ni(m)+"'")},wi.finishOp=function(m,A){var j=this.input.slice(this.pos,this.pos+A);return this.pos+=A,this.finishToken(m,j)},wi.readRegexp=function(){for(var m,A,j=this.pos;;){this.pos>=this.input.length&&this.raise(j,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(mr.test(O)&&this.raise(j,"Unterminated regular expression"),m)m=!1;else{if(O==="[")A=!0;else if(O==="]"&&A)A=!1;else if(O==="/"&&!A)break;m=O==="\\"}++this.pos}var le=this.input.slice(j,this.pos);++this.pos;var Ie=this.pos,ut=this.readWord1();this.containsEsc&&this.unexpected(Ie);var Pt=this.regexpState||(this.regexpState=new Qt(this));Pt.reset(j,le,ut),this.validateRegExpFlags(Pt),this.validateRegExpPattern(Pt);var Ot=null;try{Ot=new RegExp(le,ut)}catch(Ar){}return this.finishToken(re.regexp,{pattern:le,flags:ut,value:Ot})},wi.readInt=function(m,A,j){for(var O=this.options.ecmaVersion>=12&&A===void 0,le=j&&this.input.charCodeAt(this.pos)===48,Ie=this.pos,ut=0,Pt=0,Ot=0,Ar=A==null?Infinity:A;Ot<Ar;++Ot,++this.pos){var jr=this.input.charCodeAt(this.pos),qn=void 0;if(O&&jr===95){le&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Pt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Ot===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Pt=jr;continue}if(jr>=97?qn=jr-97+10:jr>=65?qn=jr-65+10:jr>=48&&jr<=57?qn=jr-48:qn=Infinity,qn>=m)break;Pt=jr,ut=ut*m+qn}return O&&Pt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Ie||A!=null&&this.pos-Ie!==A?null:ut};function sa(m,A){return A?parseInt(m,8):parseFloat(m.replace(/_/g,""))}function Fi(m){return typeof BigInt!="function"?null:BigInt(m.replace(/_/g,""))}wi.readRadixNumber=function(m){var A=this.pos;this.pos+=2;var j=this.readInt(m);return j==null&&this.raise(this.start+2,"Expected number in radix "+m),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(j=Fi(this.input.slice(A,this.pos)),++this.pos):rt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(re.num,j)},wi.readNumber=function(m){var A=this.pos;!m&&this.readInt(10,void 0,!0)===null&&this.raise(A,"Invalid number");var j=this.pos-A>=2&&this.input.charCodeAt(A)===48;j&&this.strict&&this.raise(A,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!j&&!m&&this.options.ecmaVersion>=11&&O===110){var le=Fi(this.input.slice(A,this.pos));return++this.pos,rt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(re.num,le)}j&&/[89]/.test(this.input.slice(A,this.pos))&&(j=!1),O===46&&!j&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!j&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(A,"Invalid number")),rt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Ie=sa(this.input.slice(A,this.pos),j);return this.finishToken(re.num,Ie)},wi.readCodePoint=function(){var m=this.input.charCodeAt(this.pos),A;if(m===123){this.options.ecmaVersion<6&&this.unexpected();var j=++this.pos;A=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,A>1114111&&this.invalidStringToken(j,"Code point out of bounds")}else A=this.readHexChar(4);return A};function ni(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}wi.readString=function(m){for(var A="",j=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===m)break;O===92?(A+=this.input.slice(j,this.pos),A+=this.readEscapedChar(!1),j=this.pos):(Ke(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return A+=this.input.slice(j,this.pos++),this.finishToken(re.string,A)};var Di={};wi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(m){if(m===Di)this.readInvalidTemplateToken();else throw m}this.inTemplateElement=!1},wi.invalidStringToken=function(m,A){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Di;this.raise(m,A)},wi.readTmplToken=function(){for(var m="",A=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var j=this.input.charCodeAt(this.pos);if(j===96||j===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===re.template||this.type===re.invalidTemplate)?j===36?(this.pos+=2,this.finishToken(re.dollarBraceL)):(++this.pos,this.finishToken(re.backQuote)):(m+=this.input.slice(A,this.pos),this.finishToken(re.template,m));if(j===92)m+=this.input.slice(A,this.pos),m+=this.readEscapedChar(!0),A=this.pos;else if(Ke(j)){switch(m+=this.input.slice(A,this.pos),++this.pos,j){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:m+=`
`;break;default:m+=String.fromCharCode(j);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),A=this.pos}else++this.pos}},wi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(re.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},wi.readEscapedChar=function(m){var A=this.input.charCodeAt(++this.pos);switch(++this.pos,A){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ni(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(m){var j=this.pos-1;return this.invalidStringToken(j,"Invalid escape sequence in template string"),null}default:if(A>=48&&A<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],le=parseInt(O,8);return le>255&&(O=O.slice(0,-1),le=parseInt(O,8)),this.pos+=O.length-1,A=this.input.charCodeAt(this.pos),(O!=="0"||A===56||A===57)&&(this.strict||m)&&this.invalidStringToken(this.pos-1-O.length,m?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(le)}return Ke(A)?"":String.fromCharCode(A)}},wi.readHexChar=function(m){var A=this.pos,j=this.readInt(16,m);return j===null&&this.invalidStringToken(A,"Bad character escape sequence"),j},wi.readWord1=function(){this.containsEsc=!1;for(var m="",A=!0,j=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var le=this.fullCharCodeAtPos();if(Xt(le,O))this.pos+=le<=65535?1:2;else if(le===92){this.containsEsc=!0,m+=this.input.slice(j,this.pos);var Ie=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var ut=this.readCodePoint();(A?rt:Xt)(ut,O)||this.invalidStringToken(Ie,"Invalid Unicode escape"),m+=ni(ut),j=this.pos}else break;A=!1}return m+this.input.slice(j,this.pos)},wi.readWord=function(){var m=this.readWord1(),A=re.name;return this.keywords.test(m)&&(A=Et[m]),this.finishToken(A,m)};var Ei="7.4.1";St.acorn={Parser:St,version:Ei,defaultOptions:zt,Position:ge,SourceLocation:_t,getLineInfo:pt,Node:Wn,TokenType:Gt,tokTypes:re,keywordTypes:Et,TokContext:Ji,tokContexts:Pi,isIdentifierChar:Xt,isIdentifierStart:rt,Token:Bi,isNewLine:Ke,lineBreak:mr,lineBreakG:wt,nonASCIIwhitespace:Dt};function no(m,A){return St.parse(m,A)}function ho(m,A,j){return St.parseExpressionAt(m,A,j)}function ta(m,A){return St.tokenizer(m,A)}function Vi(m,A){m.prototype=Object.create(A.prototype),m.prototype.constructor=m,m.__proto__=A}function Ns(m){var A=typeof Map=="function"?new Map:void 0;return Ns=function(O){if(O===null||!No(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof A!="undefined"){if(A.has(O))return A.get(O);A.set(O,le)}function le(){return Aa(O,arguments,Wa(this).constructor)}return le.prototype=Object.create(O.prototype,{constructor:{value:le,enumerable:!1,writable:!0,configurable:!0}}),Gi(le,O)},Ns(m)}function tu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function Aa(m,A,j){return tu()?Aa=Reflect.construct:Aa=function(le,Ie,ut){var Pt=[null];Pt.push.apply(Pt,Ie);var Ot=Function.bind.apply(le,Pt),Ar=new Ot;return ut&&Gi(Ar,ut.prototype),Ar},Aa.apply(null,arguments)}function No(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function Gi(m,A){return Gi=Object.setPrototypeOf||function(O,le){return O.__proto__=le,O},Gi(m,A)}function Wa(m){return Wa=Object.setPrototypeOf?Object.getPrototypeOf:function(j){return j.__proto__||Object.getPrototypeOf(j)},Wa(m)}var oo=function(m){Vi(A,m);function A(){return m.apply(this,arguments)||this}return A}(Ns(Error)),ma=function(m){Vi(A,m);function A(){return m.apply(this,arguments)||this}return A}(Ns(SyntaxError)),Lo=function(m){Vi(A,m);function A(){return m.apply(this,arguments)||this}return A}(Ns(ReferenceError)),ka=function(m){Vi(A,m);function A(){return m.apply(this,arguments)||this}return A}(Ns(TypeError)),bs=function(m){Vi(A,m);function A(){return m.apply(this,arguments)||this}return A}(oo),ki=function(m){Vi(A,m);function A(){return m.apply(this,arguments)||this}return A}(ma),Ko=function(m){Vi(A,m);function A(){return m.apply(this,arguments)||this}return A}(Lo),ga={UnknownError:[3001,"%0",bs],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",bs],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Ko],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Ko],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Ko],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Ko],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Ko],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Ko],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Ko],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Ko],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Ko],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Ko],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Lo],VariableUndefinedReferenceError:[2002,"%0 is not defined",Lo],IsNotConstructor:[2003,"%0 is not a constructor",ka]};function po(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function Da(m,A,j){return po()?Da=Reflect.construct:Da=function(le,Ie,ut){var Pt=[null];Pt.push.apply(Pt,Ie);var Ot=Function.bind.apply(le,Pt),Ar=new Ot;return ut&&So(Ar,ut.prototype),Ar},Da.apply(null,arguments)}function So(m,A){return So=Object.setPrototypeOf||function(O,le){return O.__proto__=le,O},So(m,A)}var ye="0.0.2";function De(m,A){Object.defineProperty(m,"name",{value:A,writable:!1,enumerable:!1,configurable:!0})}var ct=Object.prototype.hasOwnProperty,Yt=Symbol("Break"),Wr=Symbol("Continue"),Qn=Symbol("DefaultCase"),Si=Symbol("EmptyStatementReturn"),Za=Symbol("WithScopeName"),vo=Symbol("SuperScopeName"),so=Symbol("RootScopeName"),es=Symbol("GlobalScopeName");function Hs(m){return typeof m=="function"}var ja=function(){function m(j){this.interpreter=j}var A=m.prototype;return A.generator=function(){var O=this.interpreter;function le(){return this.getCurrentScope()}function Ie(){return this.getGlobalScope()}function ut(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:le.bind(O),getGlobalScope:Ie.bind(O),getCurrentContext:ut.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},m}();function Bu(m,A,j){if(j===void 0&&(j=!0),!(m instanceof ja))throw new Error("Illegal call");if(typeof A!="string")return A;if(!!A){var O=m.generator(),le=O.getOptions(),Ie={timeout:le.timeout,_initEnv:function(){j||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},ut=j?O.getGlobalScope():O.getCurrentScope(),Pt=new lo(ut,Ie);return Pt.evaluate(A)}}Object.defineProperty(Bu,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function ts(m){if(!(m instanceof ja))throw new Error("Illegal call");for(var A=m.generator(),j=arguments.length,O=new Array(j>1?j-1:0),le=1;le<j;le++)O[le-1]=arguments[le];var Ie=O.pop(),ut=new lo(A.getGlobalScope(),A.getOptions()),Pt=`
		    (function anonymous(`+O.join(",")+`){
		        `+Ie+`
		    });
		    `;return ut.evaluate(Pt)}Object.defineProperty(ts,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var zo=function(A){this.value=A},uo=function(A){this.value=A},ii=function(A){this.value=A},ms=function(A,j,O){j===void 0&&(j=null),this.name=O,this.parent=j,this.data=A,this.labelStack=[]};function rs(){}function Rs(m,A){return m===void 0&&(m=null),new ms(Object.create(null),m,A)}function ns(m){return Object.create(m)}var Ta={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Bu,Function:ts};typeof JSON!="undefined"&&(Ta.JSON=JSON),typeof Promise!="undefined"&&(Ta.Promise=Promise),typeof Set!="undefined"&&(Ta.Set=Set),typeof Map!="undefined"&&(Ta.Map=Map),typeof Symbol!="undefined"&&(Ta.Symbol=Symbol),typeof Proxy!="undefined"&&(Ta.Proxy=Proxy),typeof WeakMap!="undefined"&&(Ta.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Ta.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Ta.Reflect=Reflect);var lo=function(){function m(j,O){j===void 0&&(j=m.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||m.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?m.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=j||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var A=m.prototype;return A.initEnvironment=function(O){var le;if(O instanceof ms)le=O;else{var Ie=null,ut=this.createSuperScope(O);this.options.rootContext&&(Ie=new ms(ns(this.options.rootContext),ut,so)),le=new ms(O,Ie||ut,es)}this.globalScope=le,this.currentScope=this.globalScope,this.globalContext=le.data,this.currentContext=le.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Pt=this.options._initEnv;Pt&&Pt.call(this)},A.getExecStartTime=function(){return this.execStartTime},A.getExecutionTime=function(){return this.execEndTime-this.execStartTime},A.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},A.getOptions=function(){return this.options},A.getGlobalScope=function(){return this.globalScope},A.getCurrentScope=function(){return this.currentScope},A.getCurrentContext=function(){return this.currentContext},A.isInterruptThrow=function(O){return O instanceof bs||O instanceof Ko||O instanceof ki},A.createSuperScope=function(O){var le=Object.assign({},Ta),Ie=Object.keys(le);return Ie.forEach(function(ut){ut in O&&delete le[ut]}),new ms(le,null,vo)},A.setCurrentContext=function(O){this.currentContext=O},A.setCurrentScope=function(O){this.currentScope=O},A.evaluate=function(O){O===void 0&&(O="");var le;if(!!O)return le=no(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||m.ecmaVersion}),this.evaluateNode(le,O)},A.appendCode=function(O){return this.evaluate(O)},A.evaluateNode=function(O,le){var Ie=this;le===void 0&&(le=""),this.value=void 0,this.source=le,this.sourceList.push(le),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ut=this.getCurrentScope(),Pt=this.getCurrentContext(),Ot=ut.labelStack.concat([]),Ar=this.callStack.concat([]),jr=function(){Ie.setCurrentScope(ut),Ie.setCurrentContext(Pt),ut.labelStack=Ot,Ie.callStack=Ar};try{var qn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),qn()}catch(gi){throw gi}finally{jr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},A.createErrorMessage=function(O,le,Ie){var ut=O[1].replace("%0",String(le));return Ie!==null&&(ut+=this.getNodePosition(Ie||this.lastExecNode)),ut},A.createError=function(O,le){return new le(O)},A.createThrowError=function(O,le){return this.createError(O,le)},A.createInternalThrowError=function(O,le,Ie){return this.createError(this.createErrorMessage(O,le,Ie),O[2])},A.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,le=Date.now();return le-this.execStartTime>O},A.getNodePosition=function(O){if(O){var le="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+le:""}return""},A.createClosure=function(O){var le=this,Ie;switch(O.type){case"BinaryExpression":Ie=this.binaryExpressionHandler(O);break;case"LogicalExpression":Ie=this.logicalExpressionHandler(O);break;case"UnaryExpression":Ie=this.unaryExpressionHandler(O);break;case"UpdateExpression":Ie=this.updateExpressionHandler(O);break;case"ObjectExpression":Ie=this.objectExpressionHandler(O);break;case"ArrayExpression":Ie=this.arrayExpressionHandler(O);break;case"CallExpression":Ie=this.callExpressionHandler(O);break;case"NewExpression":Ie=this.newExpressionHandler(O);break;case"MemberExpression":Ie=this.memberExpressionHandler(O);break;case"ThisExpression":Ie=this.thisExpressionHandler(O);break;case"SequenceExpression":Ie=this.sequenceExpressionHandler(O);break;case"Literal":Ie=this.literalHandler(O);break;case"Identifier":Ie=this.identifierHandler(O);break;case"AssignmentExpression":Ie=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":Ie=this.functionDeclarationHandler(O);break;case"VariableDeclaration":Ie=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":Ie=this.programHandler(O);break;case"ExpressionStatement":Ie=this.expressionStatementHandler(O);break;case"EmptyStatement":Ie=this.emptyStatementHandler(O);break;case"ReturnStatement":Ie=this.returnStatementHandler(O);break;case"FunctionExpression":Ie=this.functionExpressionHandler(O);break;case"IfStatement":Ie=this.ifStatementHandler(O);break;case"ConditionalExpression":Ie=this.conditionalExpressionHandler(O);break;case"ForStatement":Ie=this.forStatementHandler(O);break;case"WhileStatement":Ie=this.whileStatementHandler(O);break;case"DoWhileStatement":Ie=this.doWhileStatementHandler(O);break;case"ForInStatement":Ie=this.forInStatementHandler(O);break;case"WithStatement":Ie=this.withStatementHandler(O);break;case"ThrowStatement":Ie=this.throwStatementHandler(O);break;case"TryStatement":Ie=this.tryStatementHandler(O);break;case"ContinueStatement":Ie=this.continueStatementHandler(O);break;case"BreakStatement":Ie=this.breakStatementHandler(O);break;case"SwitchStatement":Ie=this.switchStatementHandler(O);break;case"LabeledStatement":Ie=this.labeledStatementHandler(O);break;case"DebuggerStatement":Ie=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(ga.NodeTypeSyntaxError,O.type,O)}return function(){var ut=le.options.timeout;if(ut&&ut>0&&le.checkTimeout())throw le.createInternalThrowError(ga.ExecutionTimeOutError,ut,null);return le.lastExecNode=O,Ie.apply(void 0,arguments)}},A.binaryExpressionHandler=function(O){var le=this,Ie=this.createClosure(O.left),ut=this.createClosure(O.right);return function(){var Pt=Ie(),Ot=ut();switch(O.operator){case"==":return Pt==Ot;case"!=":return Pt!=Ot;case"===":return Pt===Ot;case"!==":return Pt!==Ot;case"<":return Pt<Ot;case"<=":return Pt<=Ot;case">":return Pt>Ot;case">=":return Pt>=Ot;case"<<":return Pt<<Ot;case">>":return Pt>>Ot;case">>>":return Pt>>>Ot;case"+":return Pt+Ot;case"-":return Pt-Ot;case"*":return Pt*Ot;case"**":return Math.pow(Pt,Ot);case"/":return Pt/Ot;case"%":return Pt%Ot;case"|":return Pt|Ot;case"^":return Pt^Ot;case"&":return Pt&Ot;case"in":return Pt in Ot;case"instanceof":return Pt instanceof Ot;default:throw le.createInternalThrowError(ga.BinaryOperatorSyntaxError,O.operator,O)}}},A.logicalExpressionHandler=function(O){var le=this,Ie=this.createClosure(O.left),ut=this.createClosure(O.right);return function(){switch(O.operator){case"||":return Ie()||ut();case"&&":return Ie()&&ut();default:throw le.createInternalThrowError(ga.LogicalOperatorSyntaxError,O.operator,O)}}},A.unaryExpressionHandler=function(O){var le=this;switch(O.operator){case"delete":var Ie=this.createObjectGetter(O.argument),ut=this.createNameGetter(O.argument);return function(){var jr=Ie(),qn=ut();return delete jr[qn]};default:var Pt;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var Ot=this.createObjectGetter(O.argument),Ar=this.createNameGetter(O.argument);Pt=function(){return Ot()[Ar()]}}else Pt=this.createClosure(O.argument);return function(){var jr=Pt();switch(O.operator){case"-":return-jr;case"+":return+jr;case"!":return!jr;case"~":return~jr;case"void":return;case"typeof":return typeof jr;default:throw le.createInternalThrowError(ga.UnaryOperatorSyntaxError,O.operator,O)}}}},A.updateExpressionHandler=function(O){var le=this,Ie=this.createObjectGetter(O.argument),ut=this.createNameGetter(O.argument);return function(){var Pt=Ie(),Ot=ut();switch(le.assertVariable(Pt,Ot,O),O.operator){case"++":return O.prefix?++Pt[Ot]:Pt[Ot]++;case"--":return O.prefix?--Pt[Ot]:Pt[Ot]--;default:throw le.createInternalThrowError(ga.UpdateOperatorSyntaxError,O.operator,O)}}},A.objectExpressionHandler=function(O){var le=this,Ie=[];function ut(Ot){return Ot.type==="Identifier"?Ot.name:Ot.type==="Literal"?Ot.value:this.throwError(ga.ObjectStructureSyntaxError,Ot.type,Ot)}var Pt=Object.create(null);return O.properties.forEach(function(Ot){var Ar=Ot.kind,jr=ut(Ot.key);(!Pt[jr]||Ar==="init")&&(Pt[jr]={}),Pt[jr][Ar]=le.createClosure(Ot.value),Ie.push({key:jr,property:Ot})}),function(){for(var Ot={},Ar=Ie.length,jr=0;jr<Ar;jr++){var qn=Ie[jr],gi=qn.key,wn=Pt[gi],fa=wn.init?wn.init():void 0,Ni=wn.get?wn.get():function(){},Oa=wn.set?wn.set():function(Es){};if("set"in wn||"get"in wn){var ua={configurable:!0,enumerable:!0,get:Ni,set:Oa};Object.defineProperty(Ot,gi,ua)}else{var Xa=qn.property,is=Xa.kind;Xa.key.type==="Identifier"&&Xa.value.type==="FunctionExpression"&&is==="init"&&!Xa.value.id&&De(fa,Xa.key.name),Ot[gi]=fa}}return Ot}},A.arrayExpressionHandler=function(O){var le=this,Ie=O.elements.map(function(ut){return ut&&le.createClosure(ut)});return function(){for(var ut=Ie.length,Pt=Array(ut),Ot=0;Ot<ut;Ot++){var Ar=Ie[Ot];Ar&&(Pt[Ot]=Ar())}return Pt}},A.safeObjectGet=function(O,le,Ie){return O[le]},A.createCallFunctionGetter=function(O){var le=this;switch(O.type){case"MemberExpression":var Ie=this.createClosure(O.object),ut=this.createMemberKeyGetter(O),Pt=this.source;return function(){var Ar=Ie(),jr=ut(),qn=le.safeObjectGet(Ar,jr,O);if(!qn||!Hs(qn)){var gi=Pt.slice(O.start,O.end);throw le.createInternalThrowError(ga.FunctionUndefinedReferenceError,gi,O)}return qn.__IS_EVAL_FUNC?function(wn){return qn(new ja(le),wn,!0)}:qn.__IS_FUNCTION_FUNC?function(){for(var wn=arguments.length,fa=new Array(wn),Ni=0;Ni<wn;Ni++)fa[Ni]=arguments[Ni];return qn.apply(void 0,[new ja(le)].concat(fa))}:qn.bind(Ar)};default:var Ot=this.createClosure(O);return function(){var Ar="";O.type==="Identifier"&&(Ar=O.name);var jr=Ot();if(!jr||!Hs(jr))throw le.createInternalThrowError(ga.FunctionUndefinedReferenceError,Ar,O);if(O.type==="Identifier"&&jr.__IS_EVAL_FUNC&&Ar==="eval")return function(wn){var fa=le.getScopeFromName(Ar,le.getCurrentScope()),Ni=fa.name===vo||fa.name===es||fa.name===so;return jr(new ja(le),wn,!Ni)};if(jr.__IS_EVAL_FUNC)return function(wn){return jr(new ja(le),wn,!0)};if(jr.__IS_FUNCTION_FUNC)return function(){for(var wn=arguments.length,fa=new Array(wn),Ni=0;Ni<wn;Ni++)fa[Ni]=arguments[Ni];return jr.apply(void 0,[new ja(le)].concat(fa))};var qn=le.options.globalContextInFunction;if(O.type==="Identifier"){var gi=le.getIdentifierScope(O);gi.name===Za&&(qn=gi.data)}return jr.bind(qn)}}},A.callExpressionHandler=function(O){var le=this,Ie=this.createCallFunctionGetter(O.callee),ut=O.arguments.map(function(Pt){return le.createClosure(Pt)});return function(){return Ie().apply(void 0,ut.map(function(Pt){return Pt()}))}},A.functionExpressionHandler=function(O){var le=this,Ie=this,ut=this.source,Pt=this.collectDeclVars,Ot=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Ar=O.id?O.id.name:"",jr=O.params.length,qn=O.params.map(function(Ni){return le.createParamNameGetter(Ni)}),gi=this.createClosure(O.body),wn=this.collectDeclVars,fa=this.collectDeclFuncs;return this.collectDeclVars=Pt,this.collectDeclFuncs=Ot,function(){var Ni=Ie.getCurrentScope(),Oa=function ua(){for(var Xa=arguments.length,is=new Array(Xa),Es=0;Es<Xa;Es++)is[Es]=arguments[Es];Ie.callStack.push(""+Ar);var Au=Ie.getCurrentScope(),cu=Rs(Ni,"FunctionScope("+Ar+")");Ie.setCurrentScope(cu),Ie.addDeclarationsToScope(wn,fa,cu),Ar&&(cu.data[Ar]=ua),cu.data.arguments=arguments,qn.forEach(function(Xs,Ys){cu.data[Xs()]=is[Ys]});var nl=Ie.getCurrentContext();Ie.setCurrentContext(this);var Ws=gi();if(Ie.setCurrentContext(nl),Ie.setCurrentScope(Au),Ie.callStack.pop(),Ws instanceof zo)return Ws.value};return De(Oa,Ar),Object.defineProperty(Oa,"length",{value:jr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Oa,"toString",{value:function(){return ut.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Oa,"valueOf",{value:function(){return ut.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Oa}},A.newExpressionHandler=function(O){var le=this,Ie=this.source,ut=this.createClosure(O.callee),Pt=O.arguments.map(function(Ot){return le.createClosure(Ot)});return function(){var Ot=ut();if(!Hs(Ot)||Ot.__IS_EVAL_FUNC){var Ar=O.callee,jr=Ie.slice(Ar.start,Ar.end);throw le.createInternalThrowError(ga.IsNotConstructor,jr,O)}return Ot.__IS_FUNCTION_FUNC?Ot.apply(void 0,[new ja(le)].concat(Pt.map(function(qn){return qn()}))):Da(Ot,Pt.map(function(qn){return qn()}))}},A.memberExpressionHandler=function(O){var le=this.createClosure(O.object),Ie=this.createMemberKeyGetter(O);return function(){var ut=le(),Pt=Ie();return ut[Pt]}},A.thisExpressionHandler=function(O){var le=this;return function(){return le.getCurrentContext()}},A.sequenceExpressionHandler=function(O){var le=this,Ie=O.expressions.map(function(ut){return le.createClosure(ut)});return function(){for(var ut,Pt=Ie.length,Ot=0;Ot<Pt;Ot++){var Ar=Ie[Ot];ut=Ar()}return ut}},A.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},A.identifierHandler=function(O){var le=this;return function(){var Ie=le.getCurrentScope(),ut=le.getScopeDataFromName(O.name,Ie);return le.assertVariable(ut,O.name,O),ut[O.name]}},A.getIdentifierScope=function(O){var le=this.getCurrentScope(),Ie=this.getScopeFromName(O.name,le);return Ie},A.assignmentExpressionHandler=function(O){var le=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var Ie=this.createObjectGetter(O.left),ut=this.createNameGetter(O.left),Pt=this.createClosure(O.right);return function(){var Ot=Ie(),Ar=ut(),jr=Pt();switch(O.operator!=="="&&le.assertVariable(Ot,Ar,O),O.operator){case"=":return Ot[Ar]=jr;case"+=":return Ot[Ar]+=jr;case"-=":return Ot[Ar]-=jr;case"*=":return Ot[Ar]*=jr;case"**=":return Ot[Ar]=Math.pow(Ot[Ar],jr);case"/=":return Ot[Ar]/=jr;case"%=":return Ot[Ar]%=jr;case"<<=":return Ot[Ar]<<=jr;case">>=":return Ot[Ar]>>=jr;case">>>=":return Ot[Ar]>>>=jr;case"&=":return Ot[Ar]&=jr;case"^=":return Ot[Ar]^=jr;case"|=":return Ot[Ar]|=jr;default:throw le.createInternalThrowError(ga.AssignmentExpressionSyntaxError,O.type,O)}}},A.functionDeclarationHandler=function(O){if(O.id){var le=this.functionExpressionHandler(O);Object.defineProperty(le,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,le)}return function(){return Si}},A.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(ga.VariableTypeSyntaxError,O.type,O)},A.variableDeclarationHandler=function(O){for(var le=this,Ie,ut=[],Pt=0;Pt<O.declarations.length;Pt++){var Ot=O.declarations[Pt];this.varDeclaration(this.getVariableName(Ot.id)),Ot.init&&ut.push({type:"AssignmentExpression",operator:"=",left:Ot.id,right:Ot.init})}return ut.length&&(Ie=this.createClosure({type:"BlockStatement",body:ut})),function(){if(Ie){var Ar=le.isVarDeclMode;le.isVarDeclMode=!0,Ie(),le.isVarDeclMode=Ar}return Si}},A.assertVariable=function(O,le,Ie){if(O===this.globalScope.data&&!(le in O))throw this.createInternalThrowError(ga.VariableUndefinedReferenceError,le,Ie)},A.programHandler=function(O){var le=this,Ie=O.body.map(function(ut){return le.createClosure(ut)});return function(){for(var ut=Si,Pt=0;Pt<Ie.length;Pt++){var Ot=Ie[Pt],Ar=le.setValue(Ot());if(Ar!==Si&&(ut=Ar,ut instanceof zo||ut instanceof uo||ut instanceof ii||ut===Yt||ut===Wr))break}return ut}},A.expressionStatementHandler=function(O){return this.createClosure(O.expression)},A.emptyStatementHandler=function(O){return function(){return Si}},A.returnStatementHandler=function(O){var le=O.argument?this.createClosure(O.argument):rs;return function(){return new zo(le())}},A.ifStatementHandler=function(O){var le=this.createClosure(O.test),Ie=this.createClosure(O.consequent),ut=O.alternate?this.createClosure(O.alternate):function(){return Si};return function(){return le()?Ie():ut()}},A.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},A.forStatementHandler=function(O){var le=this,Ie=rs,ut=O.test?this.createClosure(O.test):function(){return!0},Pt=rs,Ot=this.createClosure(O.body);return O.type==="ForStatement"&&(Ie=O.init?this.createClosure(O.init):Ie,Pt=O.update?this.createClosure(O.update):rs),function(Ar){var jr,qn=Si,gi=O.type==="DoWhileStatement";for(Ar&&Ar.type==="LabeledStatement"&&(jr=Ar.label.name),Ie();gi||ut();Pt()){gi=!1;var wn=le.setValue(Ot());if(!(wn===Si||wn===Wr)){if(wn===Yt)break;if(qn=wn,qn instanceof ii&&qn.value===jr){qn=Si;continue}if(qn instanceof zo||qn instanceof uo||qn instanceof ii)break}}return qn}},A.whileStatementHandler=function(O){return this.forStatementHandler(O)},A.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},A.forInStatementHandler=function(O){var le=this,Ie=O.left,ut=this.createClosure(O.right),Pt=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),Ie=O.left.declarations[0].id),function(Ot){var Ar,jr=Si,qn;Ot&&Ot.type==="LabeledStatement"&&(Ar=Ot.label.name);var gi=ut();for(qn in gi){le.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Ie,right:{type:"Literal",value:qn}})();var wn=le.setValue(Pt());if(!(wn===Si||wn===Wr)){if(wn===Yt)break;if(jr=wn,jr instanceof ii&&jr.value===Ar){jr=Si;continue}if(jr instanceof zo||jr instanceof uo||jr instanceof ii)break}}return jr}},A.withStatementHandler=function(O){var le=this,Ie=this.createClosure(O.object),ut=this.createClosure(O.body);return function(){var Pt=Ie(),Ot=le.getCurrentScope(),Ar=new ms(Pt,Ot,Za);le.setCurrentScope(Ar);var jr=le.setValue(ut());return le.setCurrentScope(Ot),jr}},A.throwStatementHandler=function(O){var le=this,Ie=this.createClosure(O.argument);return function(){throw le.setValue(void 0),Ie()}},A.tryStatementHandler=function(O){var le=this,Ie=this.createClosure(O.block),ut=O.handler?this.catchClauseHandler(O.handler):null,Pt=O.finalizer?this.createClosure(O.finalizer):null;return function(){var Ot=le.getCurrentScope(),Ar=le.getCurrentContext(),jr=Ot.labelStack.concat([]),qn=le.callStack.concat([]),gi=Si,wn,fa,Ni=function(){le.setCurrentScope(Ot),le.setCurrentContext(Ar),Ot.labelStack=jr,le.callStack=qn};try{gi=le.setValue(Ie()),gi instanceof zo&&(wn=gi)}catch(Oa){if(Ni(),le.isInterruptThrow(Oa))throw Oa;if(ut)try{gi=le.setValue(ut(Oa)),gi instanceof zo&&(wn=gi)}catch(ua){if(Ni(),le.isInterruptThrow(ua))throw ua;fa=ua}}if(Pt)try{gi=Pt(),gi instanceof zo&&(wn=gi)}catch(Oa){if(Ni(),le.isInterruptThrow(Oa))throw Oa;fa=Oa}if(fa)throw fa;return wn||gi}},A.catchClauseHandler=function(O){var le=this,Ie=this.createParamNameGetter(O.param),ut=this.createClosure(O.body);return function(Pt){var Ot,Ar=le.getCurrentScope(),jr=Ar.data,qn=Ie(),gi=ct.call(jr,qn),wn=jr[qn];return jr[qn]=Pt,Ot=ut(),gi?jr[qn]=wn:delete jr[qn],Ot}},A.continueStatementHandler=function(O){return function(){return O.label?new ii(O.label.name):Wr}},A.breakStatementHandler=function(O){return function(){return O.label?new uo(O.label.name):Yt}},A.switchStatementHandler=function(O){var le=this,Ie=this.createClosure(O.discriminant),ut=O.cases.map(function(Pt){return le.switchCaseHandler(Pt)});return function(){for(var Pt=Ie(),Ot=!1,Ar,jr,qn,gi=0;gi<ut.length;gi++){var wn=ut[gi](),fa=wn.testClosure();if(fa===Qn){qn=wn;continue}if(Ot||fa===Pt){if(Ot=!0,jr=le.setValue(wn.bodyClosure()),jr===Si)continue;if(jr===Yt||(Ar=jr,Ar instanceof zo||Ar instanceof uo||Ar instanceof ii||Ar===Wr))break}}if(!Ot&&qn){jr=le.setValue(qn.bodyClosure());var Ni=jr===Si||jr===Yt||jr===Wr;Ni||(Ar=jr)}return Ar}},A.switchCaseHandler=function(O){var le=O.test?this.createClosure(O.test):function(){return Qn},Ie=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:le,bodyClosure:Ie}}},A.labeledStatementHandler=function(O){var le=this,Ie=O.label.name,ut=this.createClosure(O.body);return function(){var Pt,Ot=le.getCurrentScope();return Ot.labelStack.push(Ie),Pt=ut(O),Pt instanceof uo&&Pt.value===Ie&&(Pt=Si),Ot.labelStack.pop(),Pt}},A.debuggerStatementHandler=function(O){return function(){debugger;return Si}},A.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(ga.ParamTypeSyntaxError,O.type,O)},A.createObjectKeyGetter=function(O){var le;return O.type==="Identifier"?le=function(){return O.name}:le=this.createClosure(O),function(){return le()}},A.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},A.createObjectGetter=function(O){var le=this;switch(O.type){case"Identifier":return function(){return le.getScopeDataFromName(O.name,le.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(ga.AssignmentTypeSyntaxError,O.type,O)}},A.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(ga.AssignmentTypeSyntaxError,O.type,O)}},A.varDeclaration=function(O){var le=this.collectDeclVars;le[O]=void 0},A.funcDeclaration=function(O,le){var Ie=this.collectDeclFuncs;Ie[O]=le},A.addDeclarationsToScope=function(O,le,Ie){var ut=Ie.data;for(var Pt in le){var Ot=le[Pt];ut[Pt]=Ot&&Ot()}for(var Ar in O)Ar in ut||(ut[Ar]=void 0)},A.getScopeValue=function(O,le){var Ie=this.getScopeFromName(O,le);return Ie.data[O]},A.getScopeDataFromName=function(O,le){return this.getScopeFromName(O,le).data},A.getScopeFromName=function(O,le){var Ie=le;do if(O in Ie.data)return Ie;while(Ie=Ie.parent);return this.globalScope},A.setValue=function(O){var le=this.callStack.length;return this.isVarDeclMode||le||O===Si||O===Yt||O===Wr||O instanceof uo||O instanceof ii||(this.value=O instanceof zo?O.value:O),O},A.getValue=function(){return this.value},m}();lo.version=ye,lo.eval=Bu,lo.Function=ts,lo.ecmaVersion=5,lo.globalContextInFunction=void 0,lo.global=Object.create(null);function _l(m){return m===void 0&&(m=Object.create(null)),m}function xl(m,A,j){A===void 0&&(A=[]),j===void 0&&(j={});var O=j.parsingContext,le=j.timeout===void 0?0:j.timeout,Ie=`
    (function anonymous(`+A.join(",")+`){
         `+m+`
    });
    `,ut=new lo(O,{ecmaVersion:j.ecmaVersion,timeout:le,rootContext:j.rootContext,globalContextInFunction:j.globalContextInFunction});return ut.evaluate(Ie)}function Nu(m,A,j){var O=new lo(A,j);return O.evaluate(m)}var Gl=Nu,wu=function(){function m(j){this._code=j}var A=m.prototype;return A.runInContext=function(O){return Nu(this._code,O)},A.runInNewContext=function(O){return Nu(this._code,O)},m}(),co=function(m,A,j){return Nu(m,A,j)};function zs(){for(var m=arguments.length,A=new Array(m),j=0;j<m;j++)A[j]=arguments[j];var O=A.pop();return xl(O||"",A)}var Ss=co},30954:function(Lr,U,S){(function(ue,C){Lr.exports=C(S(40077))})(this,function(ue){"use strict";var C=function(V){return V instanceof Uint8Array||V instanceof Uint16Array||V instanceof Uint32Array||V instanceof Int8Array||V instanceof Int16Array||V instanceof Int32Array||V instanceof Float32Array||V instanceof Float64Array||V instanceof Uint8ClampedArray},p=function(V,Me){for(var $e=Object.keys(Me),ar=0;ar<$e.length;++ar)V[$e[ar]]=Me[$e[ar]];return V},w=`
`;function q(V){return typeof atob!="undefined"?atob(V):"base64:"+V}function K(V){var Me=new Error("(regl) "+V);throw console.error(Me),Me}function W(V,Me){V||K(Me)}function L(V){return V?": "+V:""}function N(V,Me,$e){V in Me||K("unknown parameter ("+V+")"+L($e)+". possible values: "+Object.keys(Me).join())}function Ne(V,Me){C(V)||K("invalid parameter type"+L(Me)+". must be a typed array")}function Ye(V,Me){switch(Me){case"number":return typeof V=="number";case"object":return typeof V=="object";case"string":return typeof V=="string";case"boolean":return typeof V=="boolean";case"function":return typeof V=="function";case"undefined":return typeof V=="undefined";case"symbol":return typeof V=="symbol"}}function Je(V,Me,$e){Ye(V,Me)||K("invalid parameter type"+L($e)+". expected "+Me+", got "+typeof V)}function rt(V,Me){V>=0&&(V|0)===V||K("invalid parameter type, ("+V+")"+L(Me)+". must be a nonnegative integer")}function Xt(V,Me,$e){Me.indexOf(V)<0&&K("invalid value"+L($e)+". must be one of: "+Me)}var Gt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function nr(V){Object.keys(V).forEach(function(Me){Gt.indexOf(Me)<0&&K('invalid regl constructor argument "'+Me+'". must be one of '+Gt)})}function Ut(V,Me){for(V=V+"";V.length<Me;)V=" "+V;return V}function At(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Et(V,Me){this.number=V,this.line=Me,this.errors=[]}function dr(V,Me,$e){this.file=V,this.line=Me,this.message=$e}function re(){var V=new Error,Me=(V.stack||V).toString(),$e=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Me);if($e)return $e[1];var ar=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Me);return ar?ar[1]:"unknown"}function mr(){var V=new Error,Me=(V.stack||V).toString(),$e=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Me);if($e)return $e[1];var ar=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Me);return ar?ar[1]:"unknown"}function wt(V,Me){var $e=V.split(`
`),ar=1,Pr=0,rr={unknown:new At,0:new At};rr.unknown.name=rr[0].name=Me||re(),rr.unknown.lines.push(new Et(0,""));for(var Cr=0;Cr<$e.length;++Cr){var Fr=$e[Cr],Vr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Fr);if(Vr)switch(Vr[1]){case"line":var Kr=/(\d+)(\s+\d+)?/.exec(Vr[2]);Kr&&(ar=Kr[1]|0,Kr[2]&&(Pr=Kr[2]|0,Pr in rr||(rr[Pr]=new At)));break;case"define":var $r=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Vr[2]);$r&&(rr[Pr].name=$r[1]?q($r[2]):$r[2]);break}rr[Pr].lines.push(new Et(ar++,Fr))}return Object.keys(rr).forEach(function(rn){var dn=rr[rn];dn.lines.forEach(function(Hr){dn.index[Hr.number]=Hr})}),rr}function Ke(V){var Me=[];return V.split(`
`).forEach(function($e){if(!($e.length<5)){var ar=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec($e);ar?Me.push(new dr(ar[1]|0,ar[2]|0,ar[3].trim())):$e.length>0&&Me.push(new dr("unknown",0,$e))}}),Me}function Dt(V,Me){Me.forEach(function($e){var ar=V[$e.file];if(ar){var Pr=ar.index[$e.line];if(Pr){Pr.errors.push($e),ar.hasErrors=!0;return}}V.unknown.hasErrors=!0,V.unknown.lines[0].errors.push($e)})}function Xe(V,Me,$e,ar,Pr){if(!V.getShaderParameter(Me,V.COMPILE_STATUS)){var rr=V.getShaderInfoLog(Me),Cr=ar===V.FRAGMENT_SHADER?"fragment":"vertex";ge($e,"string",Cr+" shader source must be a string",Pr);var Fr=wt($e,Pr),Vr=Ke(rr);Dt(Fr,Vr),Object.keys(Fr).forEach(function(Kr){var $r=Fr[Kr];if(!$r.hasErrors)return;var rn=[""],dn=[""];function Hr(en,Lt){rn.push(en),dn.push(Lt||"")}Hr("file number "+Kr+": "+$r.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),$r.lines.forEach(function(en){if(en.errors.length>0){Hr(Ut(en.number,4)+"|  ","background-color:yellow; font-weight:bold"),Hr(en.line+w,"color:red; background-color:yellow; font-weight:bold");var Lt=0;en.errors.forEach(function(vr){var Xr=vr.message,On=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Xr);if(On){var wr=On[1];switch(Xr=On[2],wr){case"assign":wr="=";break}Lt=Math.max(en.line.indexOf(wr,Lt),0)}else Lt=0;Hr(Ut("| ",6)),Hr(Ut("^^^",Lt+3)+w,"font-weight:bold"),Hr(Ut("| ",6)),Hr(Xr+w,"font-weight:bold")}),Hr(Ut("| ",6)+w)}else Hr(Ut(en.number,4)+"|  "),Hr(en.line+w,"color:red")}),typeof document!="undefined"&&!window.chrome?(dn[0]=rn.join("%c"),console.log.apply(console,dn)):console.log(rn.join(""))}),W.raise("Error compiling "+Cr+" shader, "+Fr[0].name)}}function Zt(V,Me,$e,ar,Pr){if(!V.getProgramParameter(Me,V.LINK_STATUS)){var rr=V.getProgramInfoLog(Me),Cr=wt($e,Pr),Fr=wt(ar,Pr),Vr='Error linking program with vertex shader, "'+Fr[0].name+'", and fragment shader "'+Cr[0].name+'"';typeof document!="undefined"?console.log("%c"+Vr+w+"%c"+rr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Vr+w+rr),W.raise(Vr)}}function yr(V){V._commandRef=re()}function ur(V,Me,$e,ar){yr(V);function Pr(Vr){return Vr?ar.id(Vr):0}V._fragId=Pr(V.static.frag),V._vertId=Pr(V.static.vert);function rr(Vr,Kr){Object.keys(Kr).forEach(function($r){Vr[ar.id($r)]=!0})}var Cr=V._uniformSet={};rr(Cr,Me.static),rr(Cr,Me.dynamic);var Fr=V._attributeSet={};rr(Fr,$e.static),rr(Fr,$e.dynamic),V._hasCount="count"in V.static||"count"in V.dynamic||"elements"in V.static||"elements"in V.dynamic}function Ur(V,Me){var $e=mr();K(V+" in command "+(Me||re())+($e==="unknown"?"":" called from "+$e))}function he(V,Me,$e){V||Ur(Me,$e||re())}function Re(V,Me,$e,ar){V in Me||Ur("unknown parameter ("+V+")"+L($e)+". possible values: "+Object.keys(Me).join(),ar||re())}function ge(V,Me,$e,ar){Ye(V,Me)||Ur("invalid parameter type"+L($e)+". expected "+Me+", got "+typeof V,ar||re())}function _t(V){V()}function pt(V,Me,$e){V.texture?Xt(V.texture._texture.internalformat,Me,"unsupported texture format for attachment"):Xt(V.renderbuffer._renderbuffer.format,$e,"unsupported renderbuffer format for attachment")}var zt=33071,Ft=9728,Dr=9984,pn=9985,mn=9986,Xi=9987,ir=5120,pe=5121,Pe=5122,Ze=5123,Le=5124,It=5125,tr=5126,E=32819,Z=32820,be=33635,Ge=34042,qe=36193,gt={};gt[ir]=gt[pe]=1,gt[Pe]=gt[Ze]=gt[qe]=gt[be]=gt[E]=gt[Z]=2,gt[Le]=gt[It]=gt[tr]=gt[Ge]=4;function St(V,Me){return V===Z||V===E||V===be?2:V===Ge?4:gt[V]*Me}function Ct(V){return!(V&V-1)&&!!V}function Vt(V,Me,$e){var ar,Pr=Me.width,rr=Me.height,Cr=Me.channels;W(Pr>0&&Pr<=$e.maxTextureSize&&rr>0&&rr<=$e.maxTextureSize,"invalid texture shape"),(V.wrapS!==zt||V.wrapT!==zt)&&W(Ct(Pr)&&Ct(rr),"incompatible wrap mode for texture, both width and height must be power of 2"),Me.mipmask===1?Pr!==1&&rr!==1&&W(V.minFilter!==Dr&&V.minFilter!==mn&&V.minFilter!==pn&&V.minFilter!==Xi,"min filter requires mipmap"):(W(Ct(Pr)&&Ct(rr),"texture must be a square power of 2 to support mipmapping"),W(Me.mipmask===(Pr<<1)-1,"missing or incomplete mipmap data")),Me.type===tr&&($e.extensions.indexOf("oes_texture_float_linear")<0&&W(V.minFilter===Ft&&V.magFilter===Ft,"filter not supported, must enable oes_texture_float_linear"),W(!V.genMipmaps,"mipmap generation not supported with float textures"));var Fr=Me.images;for(ar=0;ar<16;++ar)if(Fr[ar]){var Vr=Pr>>ar,Kr=rr>>ar;W(Me.mipmask&1<<ar,"missing mipmap data");var $r=Fr[ar];if(W($r.width===Vr&&$r.height===Kr,"invalid shape for mip images"),W($r.format===Me.format&&$r.internalformat===Me.internalformat&&$r.type===Me.type,"incompatible type for mip image"),!$r.compressed)if($r.data){var rn=Math.ceil(St($r.type,Cr)*Vr/$r.unpackAlignment)*$r.unpackAlignment;W($r.data.byteLength===rn*Kr,"invalid data for image, buffer size is inconsistent with image format")}else $r.element||$r.copy}else V.genMipmaps||W((Me.mipmask&1<<ar)==0,"extra mipmap data");Me.compressed&&W(!V.genMipmaps,"mipmap generation for compressed images not supported")}function qt(V,Me,$e,ar){var Pr=V.width,rr=V.height,Cr=V.channels;W(Pr>0&&Pr<=ar.maxTextureSize&&rr>0&&rr<=ar.maxTextureSize,"invalid texture shape"),W(Pr===rr,"cube map must be square"),W(Me.wrapS===zt&&Me.wrapT===zt,"wrap mode not supported by cube map");for(var Fr=0;Fr<$e.length;++Fr){var Vr=$e[Fr];W(Vr.width===Pr&&Vr.height===rr,"inconsistent cube map face shape"),Me.genMipmaps&&(W(!Vr.compressed,"can not generate mipmap for compressed textures"),W(Vr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Kr=Vr.images,$r=0;$r<16;++$r){var rn=Kr[$r];if(rn){var dn=Pr>>$r,Hr=rr>>$r;W(Vr.mipmask&1<<$r,"missing mipmap data"),W(rn.width===dn&&rn.height===Hr,"invalid shape for mip images"),W(rn.format===V.format&&rn.internalformat===V.internalformat&&rn.type===V.type,"incompatible type for mip image"),rn.compressed||(rn.data?W(rn.data.byteLength===dn*Hr*Math.max(St(rn.type,Cr),rn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):rn.element||rn.copy)}}}}var ie=p(W,{optional:_t,raise:K,commandRaise:Ur,command:he,parameter:N,commandParameter:Re,constructor:nr,type:Je,commandType:ge,isTypedArray:Ne,nni:rt,oneOf:Xt,shaderError:Xe,linkError:Zt,callSite:mr,saveCommandRef:yr,saveDrawInfo:ur,framebufferFormat:pt,guessCommand:re,texture2D:Vt,textureCube:qt}),sr=0,Mr=0,Nr=5,tt=6;function mt(V,Me){this.id=sr++,this.type=V,this.data=Me}function yt(V){return V.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function hr(V){if(V.length===0)return[];var Me=V.charAt(0),$e=V.charAt(V.length-1);if(V.length>1&&Me===$e&&(Me==='"'||Me==="'"))return['"'+yt(V.substr(1,V.length-2))+'"'];var ar=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(V);if(ar)return hr(V.substr(0,ar.index)).concat(hr(ar[1])).concat(hr(V.substr(ar.index+ar[0].length)));var Pr=V.split(".");if(Pr.length===1)return['"'+yt(V)+'"'];for(var rr=[],Cr=0;Cr<Pr.length;++Cr)rr=rr.concat(hr(Pr[Cr]));return rr}function Gr(V){return"["+hr(V).join("][")+"]"}function Zr(V,Me){return new mt(V,Gr(Me+""))}function Jr(V){return typeof V=="function"&&!V._reglType||V instanceof mt}function qr(V,Me){if(typeof V=="function")return new mt(Mr,V);if(typeof V=="number"||typeof V=="boolean")return new mt(Nr,V);if(Array.isArray(V))return new mt(tt,V.map(function($e,ar){return qr($e,Me+"["+ar+"]")}));if(V instanceof mt)return V;ie(!1,"invalid option type in uniform "+Me)}var Er={DynamicVariable:mt,define:Zr,isDynamic:Jr,unbox:qr,accessor:Gr},Jn={next:typeof requestAnimationFrame=="function"?function(V){return requestAnimationFrame(V)}:function(V){return setTimeout(V,16)},cancel:typeof cancelAnimationFrame=="function"?function(V){return cancelAnimationFrame(V)}:clearTimeout},Wn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Ti=Wn?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function $i(){var V={"":0},Me=[""];return{id:function($e){var ar=V[$e];return ar||(ar=V[$e]=Me.length,Me.push($e),ar)},str:function($e){return Me[$e]}}}function Ji(V,Me,$e){var ar=document.createElement("canvas");p(ar.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),V.appendChild(ar),V===document.body&&(ar.style.position="absolute",p(V.style,{margin:0,padding:0}));function Pr(){var Fr=window.innerWidth,Vr=window.innerHeight;if(V!==document.body){var Kr=ar.getBoundingClientRect();Fr=Kr.right-Kr.left,Vr=Kr.bottom-Kr.top}ar.width=$e*Fr,ar.height=$e*Vr}var rr;V!==document.body&&typeof ResizeObserver=="function"?(rr=new ResizeObserver(function(){setTimeout(Pr)}),rr.observe(V)):window.addEventListener("resize",Pr,!1);function Cr(){rr?rr.disconnect():window.removeEventListener("resize",Pr),V.removeChild(ar)}return Pr(),{canvas:ar,onDestroy:Cr}}function Pi(V,Me){function $e(ar){try{return V.getContext(ar,Me)}catch(Pr){return null}}return $e("webgl")||$e("experimental-webgl")||$e("webgl-experimental")}function Ri(V){return typeof V.nodeName=="string"&&typeof V.appendChild=="function"&&typeof V.getBoundingClientRect=="function"}function Y(V){return typeof V.drawArrays=="function"||typeof V.drawElements=="function"}function ce(V){return typeof V=="string"?V.split():(ie(Array.isArray(V),"invalid extension array"),V)}function me(V){return typeof V=="string"?(ie(typeof document!="undefined","not supported outside of DOM"),document.querySelector(V)):V}function z(V){var Me=V||{},$e,ar,Pr,rr,Cr={},Fr=[],Vr=[],Kr=typeof window=="undefined"?1:window.devicePixelRatio,$r=!1,rn=function(en){en&&ie.raise(en)},dn=function(){};if(typeof Me=="string"?(ie(typeof document!="undefined","selector queries only supported in DOM environments"),$e=document.querySelector(Me),ie($e,"invalid query string for element")):typeof Me=="object"?Ri(Me)?$e=Me:Y(Me)?(rr=Me,Pr=rr.canvas):(ie.constructor(Me),"gl"in Me?rr=Me.gl:"canvas"in Me?Pr=me(Me.canvas):"container"in Me&&(ar=me(Me.container)),"attributes"in Me&&(Cr=Me.attributes,ie.type(Cr,"object","invalid context attributes")),"extensions"in Me&&(Fr=ce(Me.extensions)),"optionalExtensions"in Me&&(Vr=ce(Me.optionalExtensions)),"onDone"in Me&&(ie.type(Me.onDone,"function","invalid or missing onDone callback"),rn=Me.onDone),"profile"in Me&&($r=!!Me.profile),"pixelRatio"in Me&&(Kr=+Me.pixelRatio,ie(Kr>0,"invalid pixel ratio"))):ie.raise("invalid arguments to regl"),$e&&($e.nodeName.toLowerCase()==="canvas"?Pr=$e:ar=$e),!rr){if(!Pr){ie(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Hr=Ji(ar||document.body,rn,Kr);if(!Hr)return null;Pr=Hr.canvas,dn=Hr.onDestroy}Cr.premultipliedAlpha===void 0&&(Cr.premultipliedAlpha=!0),rr=Pi(Pr,Cr)}return rr?{gl:rr,canvas:Pr,container:ar,extensions:Fr,optionalExtensions:Vr,pixelRatio:Kr,profile:$r,onDone:rn,onDestroy:dn}:(dn(),rn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function oe(V,Me){var $e={};function ar(Fr){ie.type(Fr,"string","extension name must be string");var Vr=Fr.toLowerCase(),Kr;try{Kr=$e[Vr]=Pr(Fr)}catch($r){}return!!Kr}function Pr(Fr){return V.getExtension(Fr)?V.getExtension(Fr):V.getExtension(Fr.toLowerCase())?V.getExtension(Fr.toLowerCase()):null}for(var rr=0;rr<Me.extensions.length;++rr){var Cr=Me.extensions[rr];if(!ar(Cr))return Me.onDestroy(),Me.onDone('"'+Cr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Me.optionalExtensions.forEach(ar),{extensions:$e,restore:function(){Object.keys($e).forEach(function(Fr){if($e[Fr]&&!ar(Fr))throw new Error("(regl): error restoring extension "+Fr)})}}}function de(V,Me){for(var $e=Array(V),ar=0;ar<V;++ar)$e[ar]=Me(ar);return $e}var Ae=5120,se=5121,Ee=5122,dt=5123,br=5124,Ht=5125,Qt=5126;function Rr(V){for(var Me=16;Me<=1<<28;Me*=16)if(V<=Me)return Me;return 0}function kn(V){var Me,$e;return Me=(V>65535)<<4,V>>>=Me,$e=(V>255)<<3,V>>>=$e,Me|=$e,$e=(V>15)<<2,V>>>=$e,Me|=$e,$e=(V>3)<<1,V>>>=$e,Me|=$e,Me|V>>1}function Ln(){var V=de(8,function(){return[]});function Me(rr){var Cr=Rr(rr),Fr=V[kn(Cr)>>2];return Fr.length>0?Fr.pop():new ArrayBuffer(Cr)}function $e(rr){V[kn(rr.byteLength)>>2].push(rr)}function ar(rr,Cr){var Fr=null;switch(rr){case Ae:Fr=new Int8Array(Me(Cr),0,Cr);break;case se:Fr=new Uint8Array(Me(Cr),0,Cr);break;case Ee:Fr=new Int16Array(Me(2*Cr),0,Cr);break;case dt:Fr=new Uint16Array(Me(2*Cr),0,Cr);break;case br:Fr=new Int32Array(Me(4*Cr),0,Cr);break;case Ht:Fr=new Uint32Array(Me(4*Cr),0,Cr);break;case Qt:Fr=new Float32Array(Me(4*Cr),0,Cr);break;default:return null}return Fr.length!==Cr?Fr.subarray(0,Cr):Fr}function Pr(rr){$e(rr.buffer)}return{alloc:Me,free:$e,allocType:ar,freeType:Pr}}var $t=Ln();$t.zero=Ln();var Cn=3408,sn=3410,an=3411,Ii=3412,xn=3413,Ai=3414,Qi=3415,li=33901,Yi=33902,Bi=3379,wi=3386,sa=34921,Fi=36347,ni=36348,Di=35661,Ei=35660,no=34930,ho=36349,ta=34076,Vi=34024,Ns=7936,tu=7937,Aa=7938,No=35724,Gi=34047,Wa=36063,oo=34852,ma=3553,Lo=34067,ka=34069,bs=33984,ki=6408,Ko=5126,ga=5121,po=36160,Da=36053,So=36064,ye=16384,De=function(V,Me){var $e=1;Me.ext_texture_filter_anisotropic&&($e=V.getParameter(Gi));var ar=1,Pr=1;Me.webgl_draw_buffers&&(ar=V.getParameter(oo),Pr=V.getParameter(Wa));var rr=!!Me.oes_texture_float;if(rr){var Cr=V.createTexture();V.bindTexture(ma,Cr),V.texImage2D(ma,0,ki,1,1,0,ki,Ko,null);var Fr=V.createFramebuffer();if(V.bindFramebuffer(po,Fr),V.framebufferTexture2D(po,So,ma,Cr,0),V.bindTexture(ma,null),V.checkFramebufferStatus(po)!==Da)rr=!1;else{V.viewport(0,0,1,1),V.clearColor(1,0,0,1),V.clear(ye);var Vr=$t.allocType(Ko,4);V.readPixels(0,0,1,1,ki,Ko,Vr),V.getError()?rr=!1:(V.deleteFramebuffer(Fr),V.deleteTexture(Cr),rr=Vr[0]===1),$t.freeType(Vr)}}var Kr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),$r=!0;if(!Kr){var rn=V.createTexture(),dn=$t.allocType(ga,36);V.activeTexture(bs),V.bindTexture(Lo,rn),V.texImage2D(ka,0,ki,3,3,0,ki,ga,dn),$t.freeType(dn),V.bindTexture(Lo,null),V.deleteTexture(rn),$r=!V.getError()}return{colorBits:[V.getParameter(sn),V.getParameter(an),V.getParameter(Ii),V.getParameter(xn)],depthBits:V.getParameter(Ai),stencilBits:V.getParameter(Qi),subpixelBits:V.getParameter(Cn),extensions:Object.keys(Me).filter(function(Hr){return!!Me[Hr]}),maxAnisotropic:$e,maxDrawbuffers:ar,maxColorAttachments:Pr,pointSizeDims:V.getParameter(li),lineWidthDims:V.getParameter(Yi),maxViewportDims:V.getParameter(wi),maxCombinedTextureUnits:V.getParameter(Di),maxCubeMapSize:V.getParameter(ta),maxRenderbufferSize:V.getParameter(Vi),maxTextureUnits:V.getParameter(no),maxTextureSize:V.getParameter(Bi),maxAttributes:V.getParameter(sa),maxVertexUniforms:V.getParameter(Fi),maxVertexTextureUnits:V.getParameter(Ei),maxVaryingVectors:V.getParameter(ni),maxFragmentUniforms:V.getParameter(ho),glsl:V.getParameter(No),renderer:V.getParameter(tu),vendor:V.getParameter(Ns),version:V.getParameter(Aa),readFloat:rr,npotTextureCube:$r}};function ct(V){return!!V&&typeof V=="object"&&Array.isArray(V.shape)&&Array.isArray(V.stride)&&typeof V.offset=="number"&&V.shape.length===V.stride.length&&(Array.isArray(V.data)||C(V.data))}var Yt=function(V){return Object.keys(V).map(function(Me){return V[Me]})},Wr={shape:es,flatten:so};function Qn(V,Me,$e){for(var ar=0;ar<Me;++ar)$e[ar]=V[ar]}function Si(V,Me,$e,ar){for(var Pr=0,rr=0;rr<Me;++rr)for(var Cr=V[rr],Fr=0;Fr<$e;++Fr)ar[Pr++]=Cr[Fr]}function Za(V,Me,$e,ar,Pr,rr){for(var Cr=rr,Fr=0;Fr<Me;++Fr)for(var Vr=V[Fr],Kr=0;Kr<$e;++Kr)for(var $r=Vr[Kr],rn=0;rn<ar;++rn)Pr[Cr++]=$r[rn]}function vo(V,Me,$e,ar,Pr){for(var rr=1,Cr=$e+1;Cr<Me.length;++Cr)rr*=Me[Cr];var Fr=Me[$e];if(Me.length-$e==4){var Vr=Me[$e+1],Kr=Me[$e+2],$r=Me[$e+3];for(Cr=0;Cr<Fr;++Cr)Za(V[Cr],Vr,Kr,$r,ar,Pr),Pr+=rr}else for(Cr=0;Cr<Fr;++Cr)vo(V[Cr],Me,$e+1,ar,Pr),Pr+=rr}function so(V,Me,$e,ar){var Pr=1;if(Me.length)for(var rr=0;rr<Me.length;++rr)Pr*=Me[rr];else Pr=0;var Cr=ar||$t.allocType($e,Pr);switch(Me.length){case 0:break;case 1:Qn(V,Me[0],Cr);break;case 2:Si(V,Me[0],Me[1],Cr);break;case 3:Za(V,Me[0],Me[1],Me[2],Cr,0);break;default:vo(V,Me,0,Cr,0)}return Cr}function es(V){for(var Me=[],$e=V;$e.length;$e=$e[0])Me.push($e.length);return Me}var Hs={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ja=5120,Bu=5122,ts=5124,zo=5121,uo=5123,ii=5125,ms=5126,rs=5126,Rs={int8:ja,int16:Bu,int32:ts,uint8:zo,uint16:uo,uint32:ii,float:ms,float32:rs},ns=35048,Ta=35040,lo={dynamic:ns,stream:Ta,static:35044},_l=Wr.flatten,xl=Wr.shape,Nu=35044,Gl=35040,wu=5121,co=5126,zs=[];zs[5120]=1,zs[5122]=2,zs[5124]=4,zs[5121]=1,zs[5123]=2,zs[5125]=4,zs[5126]=4;function Ss(V){return Hs[Object.prototype.toString.call(V)]|0}function m(V,Me){for(var $e=0;$e<Me.length;++$e)V[$e]=Me[$e]}function A(V,Me,$e,ar,Pr,rr,Cr){for(var Fr=0,Vr=0;Vr<$e;++Vr)for(var Kr=0;Kr<ar;++Kr)V[Fr++]=Me[Pr*Vr+rr*Kr+Cr]}function j(V,Me,$e,ar){var Pr=0,rr={};function Cr(Lt){this.id=Pr++,this.buffer=V.createBuffer(),this.type=Lt,this.usage=Nu,this.byteLength=0,this.dimension=1,this.dtype=wu,this.persistentData=null,$e.profile&&(this.stats={size:0})}Cr.prototype.bind=function(){V.bindBuffer(this.type,this.buffer)},Cr.prototype.destroy=function(){dn(this)};var Fr=[];function Vr(Lt,vr){var Xr=Fr.pop();return Xr||(Xr=new Cr(Lt)),Xr.bind(),rn(Xr,vr,Gl,0,1,!1),Xr}function Kr(Lt){Fr.push(Lt)}function $r(Lt,vr,Xr){Lt.byteLength=vr.byteLength,V.bufferData(Lt.type,vr,Xr)}function rn(Lt,vr,Xr,On,wr,bn){var tn;if(Lt.usage=Xr,Array.isArray(vr)){if(Lt.dtype=On||co,vr.length>0){var ui;if(Array.isArray(vr[0])){tn=xl(vr);for(var Tr=1,Sr=1;Sr<tn.length;++Sr)Tr*=tn[Sr];Lt.dimension=Tr,ui=_l(vr,tn,Lt.dtype),$r(Lt,ui,Xr),bn?Lt.persistentData=ui:$t.freeType(ui)}else if(typeof vr[0]=="number"){Lt.dimension=wr;var Xn=$t.allocType(Lt.dtype,vr.length);m(Xn,vr),$r(Lt,Xn,Xr),bn?Lt.persistentData=Xn:$t.freeType(Xn)}else C(vr[0])?(Lt.dimension=vr[0].length,Lt.dtype=On||Ss(vr[0])||co,ui=_l(vr,[vr.length,vr[0].length],Lt.dtype),$r(Lt,ui,Xr),bn?Lt.persistentData=ui:$t.freeType(ui)):ie.raise("invalid buffer data")}}else if(C(vr))Lt.dtype=On||Ss(vr),Lt.dimension=wr,$r(Lt,vr,Xr),bn&&(Lt.persistentData=new Uint8Array(new Uint8Array(vr.buffer)));else if(ct(vr)){tn=vr.shape;var yn=vr.stride,Yr=vr.offset,An=0,Sn=0,Zi=0,Oi=0;tn.length===1?(An=tn[0],Sn=1,Zi=yn[0],Oi=0):tn.length===2?(An=tn[0],Sn=tn[1],Zi=yn[0],Oi=yn[1]):ie.raise("invalid shape"),Lt.dtype=On||Ss(vr.data)||co,Lt.dimension=Sn;var Tn=$t.allocType(Lt.dtype,An*Sn);A(Tn,vr.data,An,Sn,Zi,Oi,Yr),$r(Lt,Tn,Xr),bn?Lt.persistentData=Tn:$t.freeType(Tn)}else vr instanceof ArrayBuffer?(Lt.dtype=wu,Lt.dimension=wr,$r(Lt,vr,Xr),bn&&(Lt.persistentData=new Uint8Array(new Uint8Array(vr)))):ie.raise("invalid buffer data")}function dn(Lt){Me.bufferCount--,ar(Lt);var vr=Lt.buffer;ie(vr,"buffer must not be deleted already"),V.deleteBuffer(vr),Lt.buffer=null,delete rr[Lt.id]}function Hr(Lt,vr,Xr,On){Me.bufferCount++;var wr=new Cr(vr);rr[wr.id]=wr;function bn(Tr){var Sr=Nu,Xn=null,yn=0,Yr=0,An=1;return Array.isArray(Tr)||C(Tr)||ct(Tr)||Tr instanceof ArrayBuffer?Xn=Tr:typeof Tr=="number"?yn=Tr|0:Tr&&(ie.type(Tr,"object","buffer arguments must be an object, a number or an array"),"data"in Tr&&(ie(Xn===null||Array.isArray(Xn)||C(Xn)||ct(Xn),"invalid data for buffer"),Xn=Tr.data),"usage"in Tr&&(ie.parameter(Tr.usage,lo,"invalid buffer usage"),Sr=lo[Tr.usage]),"type"in Tr&&(ie.parameter(Tr.type,Rs,"invalid buffer type"),Yr=Rs[Tr.type]),"dimension"in Tr&&(ie.type(Tr.dimension,"number","invalid dimension"),An=Tr.dimension|0),"length"in Tr&&(ie.nni(yn,"buffer length must be a nonnegative integer"),yn=Tr.length|0)),wr.bind(),Xn?rn(wr,Xn,Sr,Yr,An,On):(yn&&V.bufferData(wr.type,yn,Sr),wr.dtype=Yr||wu,wr.usage=Sr,wr.dimension=An,wr.byteLength=yn),$e.profile&&(wr.stats.size=wr.byteLength*zs[wr.dtype]),bn}function tn(Tr,Sr){ie(Sr+Tr.byteLength<=wr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Tr.byteLength+" starting from offset "+Sr+" to a buffer of size "+wr.byteLength),V.bufferSubData(wr.type,Sr,Tr)}function ui(Tr,Sr){var Xn=(Sr||0)|0,yn;if(wr.bind(),C(Tr)||Tr instanceof ArrayBuffer)tn(Tr,Xn);else if(Array.isArray(Tr)){if(Tr.length>0)if(typeof Tr[0]=="number"){var Yr=$t.allocType(wr.dtype,Tr.length);m(Yr,Tr),tn(Yr,Xn),$t.freeType(Yr)}else if(Array.isArray(Tr[0])||C(Tr[0])){yn=xl(Tr);var An=_l(Tr,yn,wr.dtype);tn(An,Xn),$t.freeType(An)}else ie.raise("invalid buffer data")}else if(ct(Tr)){yn=Tr.shape;var Sn=Tr.stride,Zi=0,Oi=0,Tn=0,En=0;yn.length===1?(Zi=yn[0],Oi=1,Tn=Sn[0],En=0):yn.length===2?(Zi=yn[0],Oi=yn[1],Tn=Sn[0],En=Sn[1]):ie.raise("invalid shape");var bi=Array.isArray(Tr.data)?wr.dtype:Ss(Tr.data),Li=$t.allocType(bi,Zi*Oi);A(Li,Tr.data,Zi,Oi,Tn,En,Tr.offset),tn(Li,Xn),$t.freeType(Li)}else ie.raise("invalid data for buffer subdata");return bn}return Xr||bn(Lt),bn._reglType="buffer",bn._buffer=wr,bn.subdata=ui,$e.profile&&(bn.stats=wr.stats),bn.destroy=function(){dn(wr)},bn}function en(){Yt(rr).forEach(function(Lt){Lt.buffer=V.createBuffer(),V.bindBuffer(Lt.type,Lt.buffer),V.bufferData(Lt.type,Lt.persistentData||Lt.byteLength,Lt.usage)})}return $e.profile&&(Me.getTotalBufferSize=function(){var Lt=0;return Object.keys(rr).forEach(function(vr){Lt+=rr[vr].stats.size}),Lt}),{create:Hr,createStream:Vr,destroyStream:Kr,clear:function(){Yt(rr).forEach(dn),Fr.forEach(dn)},getBuffer:function(Lt){return Lt&&Lt._buffer instanceof Cr?Lt._buffer:null},restore:en,_initBuffer:rn}}var O=0,le=0,Ie=1,ut=1,Pt=4,Ot=4,Ar={points:O,point:le,lines:Ie,line:ut,triangles:Pt,triangle:Ot,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},jr=0,qn=1,gi=4,wn=5120,fa=5121,Ni=5122,Oa=5123,ua=5124,Xa=5125,is=34963,Es=35040,Au=35044;function cu(V,Me,$e,ar){var Pr={},rr=0,Cr={uint8:fa,uint16:Oa};Me.oes_element_index_uint&&(Cr.uint32=Xa);function Fr(en){this.id=rr++,Pr[this.id]=this,this.buffer=en,this.primType=gi,this.vertCount=0,this.type=0}Fr.prototype.bind=function(){this.buffer.bind()};var Vr=[];function Kr(en){var Lt=Vr.pop();return Lt||(Lt=new Fr($e.create(null,is,!0,!1)._buffer)),rn(Lt,en,Es,-1,-1,0,0),Lt}function $r(en){Vr.push(en)}function rn(en,Lt,vr,Xr,On,wr,bn){en.buffer.bind();var tn;if(Lt){var ui=bn;!bn&&(!C(Lt)||ct(Lt)&&!C(Lt.data))&&(ui=Me.oes_element_index_uint?Xa:Oa),$e._initBuffer(en.buffer,Lt,vr,ui,3)}else V.bufferData(is,wr,vr),en.buffer.dtype=tn||fa,en.buffer.usage=vr,en.buffer.dimension=3,en.buffer.byteLength=wr;if(tn=bn,!bn){switch(en.buffer.dtype){case fa:case wn:tn=fa;break;case Oa:case Ni:tn=Oa;break;case Xa:case ua:tn=Xa;break;default:ie.raise("unsupported type for element array")}en.buffer.dtype=tn}en.type=tn,ie(tn!==Xa||!!Me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Tr=On;Tr<0&&(Tr=en.buffer.byteLength,tn===Oa?Tr>>=1:tn===Xa&&(Tr>>=2)),en.vertCount=Tr;var Sr=Xr;if(Xr<0){Sr=gi;var Xn=en.buffer.dimension;Xn===1&&(Sr=jr),Xn===2&&(Sr=qn),Xn===3&&(Sr=gi)}en.primType=Sr}function dn(en){ar.elementsCount--,ie(en.buffer!==null,"must not double destroy elements"),delete Pr[en.id],en.buffer.destroy(),en.buffer=null}function Hr(en,Lt){var vr=$e.create(null,is,!0),Xr=new Fr(vr._buffer);ar.elementsCount++;function On(wr){if(!wr)vr(),Xr.primType=gi,Xr.vertCount=0,Xr.type=fa;else if(typeof wr=="number")vr(wr),Xr.primType=gi,Xr.vertCount=wr|0,Xr.type=fa;else{var bn=null,tn=Au,ui=-1,Tr=-1,Sr=0,Xn=0;Array.isArray(wr)||C(wr)||ct(wr)?bn=wr:(ie.type(wr,"object","invalid arguments for elements"),"data"in wr&&(bn=wr.data,ie(Array.isArray(bn)||C(bn)||ct(bn),"invalid data for element buffer")),"usage"in wr&&(ie.parameter(wr.usage,lo,"invalid element buffer usage"),tn=lo[wr.usage]),"primitive"in wr&&(ie.parameter(wr.primitive,Ar,"invalid element buffer primitive"),ui=Ar[wr.primitive]),"count"in wr&&(ie(typeof wr.count=="number"&&wr.count>=0,"invalid vertex count for elements"),Tr=wr.count|0),"type"in wr&&(ie.parameter(wr.type,Cr,"invalid buffer type"),Xn=Cr[wr.type]),"length"in wr?Sr=wr.length|0:(Sr=Tr,Xn===Oa||Xn===Ni?Sr*=2:(Xn===Xa||Xn===ua)&&(Sr*=4))),rn(Xr,bn,tn,ui,Tr,Sr,Xn)}return On}return On(en),On._reglType="elements",On._elements=Xr,On.subdata=function(wr,bn){return vr.subdata(wr,bn),On},On.destroy=function(){dn(Xr)},On}return{create:Hr,createStream:Kr,destroyStream:$r,getElements:function(en){return typeof en=="function"&&en._elements instanceof Fr?en._elements:null},clear:function(){Yt(Pr).forEach(dn)}}}var nl=new Float32Array(1),Ws=new Uint32Array(nl.buffer),Xs=5123;function Ys(V){for(var Me=$t.allocType(Xs,V.length),$e=0;$e<V.length;++$e)if(isNaN(V[$e]))Me[$e]=65535;else if(V[$e]===Infinity)Me[$e]=31744;else if(V[$e]===-Infinity)Me[$e]=64512;else{nl[0]=V[$e];var ar=Ws[0],Pr=ar>>>31<<15,rr=(ar<<1>>>24)-127,Cr=ar>>13&(1<<10)-1;if(rr<-24)Me[$e]=Pr;else if(rr<-14){var Fr=-14-rr;Me[$e]=Pr+(Cr+(1<<10)>>Fr)}else rr>15?Me[$e]=Pr+31744:Me[$e]=Pr+(rr+15<<10)+Cr}return Me}function za(V){return Array.isArray(V)||C(V)}var il=function(V){return!(V&V-1)&&!!V},al=34467,ds=3553,Hl=34067,fu=34069,Ds=6408,mc=6406,Tu=6407,Ma=6409,ol=6410,Fc=32854,hu=32855,Wl=36194,Bc=32819,zu=32820,Xl=33635,bl=34042,Sl=6402,sl=34041,El=35904,Uu=35906,pu=36193,ul=33776,Us=33777,gc=33778,yc=33779,Nc=35986,Zu=35987,Cl=34798,Yl=35840,_c=35841,Kl=35842,$l=35843,Pu=36196,Mu=5121,Jl=5123,Ql=5125,du=5126,xc=10242,wl=10243,bc=10497,ju=33071,Va=33648,ll=10240,Ya=10241,Vu=9728,Iu=9729,Ks=9984,ra=9985,Fa=9986,Cs=9987,ql=33170,vu=4352,ec=4353,nf=4354,af=34046,cl=3317,Al=37440,Ou=37441,Ro=37443,Tl=37444,Zs=33984,Eo=[Ks,Fa,ra,Cs],Bn=[0,Ma,ol,Tu,Ds],mo={};mo[Ma]=mo[mc]=mo[Sl]=1,mo[sl]=mo[ol]=2,mo[Tu]=mo[El]=3,mo[Ds]=mo[Uu]=4;function mu(V){return"[object "+V+"]"}var fl=mu("HTMLCanvasElement"),$s=mu("OffscreenCanvas"),ws=mu("CanvasRenderingContext2D"),Sc=mu("ImageBitmap"),gn=mu("HTMLImageElement"),tc=mu("HTMLVideoElement"),rc=Object.keys(Hs).concat([fl,$s,ws,Sc,gn,tc]),Lu=[];Lu[Mu]=1,Lu[du]=4,Lu[pu]=2,Lu[Jl]=2,Lu[Ql]=4;var Ua=[];Ua[Fc]=2,Ua[hu]=2,Ua[Wl]=2,Ua[sl]=4,Ua[ul]=.5,Ua[Us]=.5,Ua[gc]=1,Ua[yc]=1,Ua[Nc]=.5,Ua[Zu]=1,Ua[Cl]=1,Ua[Yl]=.5,Ua[_c]=.25,Ua[Kl]=.5,Ua[$l]=.25,Ua[Pu]=.5;function As(V){return Array.isArray(V)&&(V.length===0||typeof V[0]=="number")}function nc(V){if(!Array.isArray(V))return!1;var Me=V.length;return!(Me===0||!za(V[0]))}function gu(V){return Object.prototype.toString.call(V)}function Ts(V){return gu(V)===fl}function yu(V){return gu(V)===$s}function zc(V){return gu(V)===ws}function Pl(V){return gu(V)===Sc}function Ec(V){return gu(V)===gn}function Cc(V){return gu(V)===tc}function Js(V){var Me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(Me&&V&&V.getContext)}function Ps(V){if(!V)return!1;if(Js(V))return!0;var Me=gu(V);return rc.indexOf(Me)>=0?!0:As(V)||nc(V)||ct(V)}function na(V){return Hs[Object.prototype.toString.call(V)]|0}function _u(V,Me){var $e=Me.length;switch(V.type){case Mu:case Jl:case Ql:case du:var ar=$t.allocType(V.type,$e);ar.set(Me),V.data=ar;break;case pu:V.data=Ys(Me);break;default:ie.raise("unsupported texture type, must specify a typed array")}}function Qs(V,Me){return $t.allocType(V.type===pu?du:V.type,Me)}function Uo(V,Me){V.type===pu?(V.data=Ys(Me),$t.freeType(Me)):V.data=Me}function Gu(V,Me,$e,ar,Pr,rr){for(var Cr=V.width,Fr=V.height,Vr=V.channels,Kr=Cr*Fr*Vr,$r=Qs(V,Kr),rn=0,dn=0;dn<Fr;++dn)for(var Hr=0;Hr<Cr;++Hr)for(var en=0;en<Vr;++en)$r[rn++]=Me[$e*Hr+ar*dn+Pr*en+rr];Uo(V,$r)}function ru(V,Me,$e,ar,Pr,rr){var Cr;if(typeof Ua[V]!="undefined"?Cr=Ua[V]:Cr=mo[V]*Lu[Me],rr&&(Cr*=6),Pr){for(var Fr=0,Vr=$e;Vr>=1;)Fr+=Cr*Vr*Vr,Vr/=2;return Fr}else return Cr*$e*ar}function nu(V,Me,$e,ar,Pr,rr,Cr){var Fr={"don't care":vu,"dont care":vu,nice:nf,fast:ec},Vr={repeat:bc,clamp:ju,mirror:Va},Kr={nearest:Vu,linear:Iu},$r=p({mipmap:Cs,"nearest mipmap nearest":Ks,"linear mipmap nearest":ra,"nearest mipmap linear":Fa,"linear mipmap linear":Cs},Kr),rn={none:0,browser:Tl},dn={uint8:Mu,rgba4:Bc,rgb565:Xl,"rgb5 a1":zu},Hr={alpha:mc,luminance:Ma,"luminance alpha":ol,rgb:Tu,rgba:Ds,rgba4:Fc,"rgb5 a1":hu,rgb565:Wl},en={};Me.ext_srgb&&(Hr.srgb=El,Hr.srgba=Uu),Me.oes_texture_float&&(dn.float32=dn.float=du),Me.oes_texture_half_float&&(dn.float16=dn["half float"]=pu),Me.webgl_depth_texture&&(p(Hr,{depth:Sl,"depth stencil":sl}),p(dn,{uint16:Jl,uint32:Ql,"depth stencil":bl})),Me.webgl_compressed_texture_s3tc&&p(en,{"rgb s3tc dxt1":ul,"rgba s3tc dxt1":Us,"rgba s3tc dxt3":gc,"rgba s3tc dxt5":yc}),Me.webgl_compressed_texture_atc&&p(en,{"rgb atc":Nc,"rgba atc explicit alpha":Zu,"rgba atc interpolated alpha":Cl}),Me.webgl_compressed_texture_pvrtc&&p(en,{"rgb pvrtc 4bppv1":Yl,"rgb pvrtc 2bppv1":_c,"rgba pvrtc 4bppv1":Kl,"rgba pvrtc 2bppv1":$l}),Me.webgl_compressed_texture_etc1&&(en["rgb etc1"]=Pu);var Lt=Array.prototype.slice.call(V.getParameter(al)||new Uint32Array(0));Object.keys(en).forEach(function(Ue){var er=en[Ue];Lt.indexOf(er)>=0&&(Hr[Ue]=er)});var vr=Object.keys(Hr);$e.textureFormats=vr;var Xr=[];Object.keys(Hr).forEach(function(Ue){var er=Hr[Ue];Xr[er]=Ue});var On=[];Object.keys(dn).forEach(function(Ue){var er=dn[Ue];On[er]=Ue});var wr=[];Object.keys(Kr).forEach(function(Ue){var er=Kr[Ue];wr[er]=Ue});var bn=[];Object.keys($r).forEach(function(Ue){var er=$r[Ue];bn[er]=Ue});var tn=[];Object.keys(Vr).forEach(function(Ue){var er=Vr[Ue];tn[er]=Ue});var ui=vr.reduce(function(Ue,er){var Jt=Hr[er];return Jt===Ma||Jt===mc||Jt===Ma||Jt===ol||Jt===Sl||Jt===sl||Me.ext_srgb&&(Jt===El||Jt===Uu)?Ue[Jt]=Jt:Jt===hu||er.indexOf("rgba")>=0?Ue[Jt]=Ds:Ue[Jt]=Tu,Ue},{});function Tr(){this.internalformat=Ds,this.format=Ds,this.type=Mu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Tl,this.width=0,this.height=0,this.channels=0}function Sr(Ue,er){Ue.internalformat=er.internalformat,Ue.format=er.format,Ue.type=er.type,Ue.compressed=er.compressed,Ue.premultiplyAlpha=er.premultiplyAlpha,Ue.flipY=er.flipY,Ue.unpackAlignment=er.unpackAlignment,Ue.colorSpace=er.colorSpace,Ue.width=er.width,Ue.height=er.height,Ue.channels=er.channels}function Xn(Ue,er){if(!(typeof er!="object"||!er)){if("premultiplyAlpha"in er&&(ie.type(er.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ue.premultiplyAlpha=er.premultiplyAlpha),"flipY"in er&&(ie.type(er.flipY,"boolean","invalid texture flip"),Ue.flipY=er.flipY),"alignment"in er&&(ie.oneOf(er.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ue.unpackAlignment=er.alignment),"colorSpace"in er&&(ie.parameter(er.colorSpace,rn,"invalid colorSpace"),Ue.colorSpace=rn[er.colorSpace]),"type"in er){var Jt=er.type;ie(Me.oes_texture_float||!(Jt==="float"||Jt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),ie(Me.oes_texture_half_float||!(Jt==="half float"||Jt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ie(Me.webgl_depth_texture||!(Jt==="uint16"||Jt==="uint32"||Jt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ie.parameter(Jt,dn,"invalid texture type"),Ue.type=dn[Jt]}var zn=Ue.width,oa=Ue.height,ke=Ue.channels,Se=!1;"shape"in er?(ie(Array.isArray(er.shape)&&er.shape.length>=2,"shape must be an array"),zn=er.shape[0],oa=er.shape[1],er.shape.length===3&&(ke=er.shape[2],ie(ke>0&&ke<=4,"invalid number of channels"),Se=!0),ie(zn>=0&&zn<=$e.maxTextureSize,"invalid width"),ie(oa>=0&&oa<=$e.maxTextureSize,"invalid height")):("radius"in er&&(zn=oa=er.radius,ie(zn>=0&&zn<=$e.maxTextureSize,"invalid radius")),"width"in er&&(zn=er.width,ie(zn>=0&&zn<=$e.maxTextureSize,"invalid width")),"height"in er&&(oa=er.height,ie(oa>=0&&oa<=$e.maxTextureSize,"invalid height")),"channels"in er&&(ke=er.channels,ie(ke>0&&ke<=4,"invalid number of channels"),Se=!0)),Ue.width=zn|0,Ue.height=oa|0,Ue.channels=ke|0;var ot=!1;if("format"in er){var Rt=er.format;ie(Me.webgl_depth_texture||!(Rt==="depth"||Rt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ie.parameter(Rt,Hr,"invalid texture format");var or=Ue.internalformat=Hr[Rt];Ue.format=ui[or],Rt in dn&&("type"in er||(Ue.type=dn[Rt])),Rt in en&&(Ue.compressed=!0),ot=!0}!Se&&ot?Ue.channels=mo[Ue.format]:Se&&!ot?Ue.channels!==Bn[Ue.format]&&(Ue.format=Ue.internalformat=Bn[Ue.channels]):ot&&Se&&ie(Ue.channels===mo[Ue.format],"number of channels inconsistent with specified format")}}function yn(Ue){V.pixelStorei(Al,Ue.flipY),V.pixelStorei(Ou,Ue.premultiplyAlpha),V.pixelStorei(Ro,Ue.colorSpace),V.pixelStorei(cl,Ue.unpackAlignment)}function Yr(){Tr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function An(Ue,er){var Jt=null;if(Ps(er)?Jt=er:er&&(ie.type(er,"object","invalid pixel data type"),Xn(Ue,er),"x"in er&&(Ue.xOffset=er.x|0),"y"in er&&(Ue.yOffset=er.y|0),Ps(er.data)&&(Jt=er.data)),ie(!Ue.compressed||Jt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),er.copy){ie(!Jt,"can not specify copy and data field for the same texture");var zn=Pr.viewportWidth,oa=Pr.viewportHeight;Ue.width=Ue.width||zn-Ue.xOffset,Ue.height=Ue.height||oa-Ue.yOffset,Ue.needsCopy=!0,ie(Ue.xOffset>=0&&Ue.xOffset<zn&&Ue.yOffset>=0&&Ue.yOffset<oa&&Ue.width>0&&Ue.width<=zn&&Ue.height>0&&Ue.height<=oa,"copy texture read out of bounds")}else if(!Jt)Ue.width=Ue.width||1,Ue.height=Ue.height||1,Ue.channels=Ue.channels||4;else if(C(Jt))Ue.channels=Ue.channels||4,Ue.data=Jt,!("type"in er)&&Ue.type===Mu&&(Ue.type=na(Jt));else if(As(Jt))Ue.channels=Ue.channels||4,_u(Ue,Jt),Ue.alignment=1,Ue.needsFree=!0;else if(ct(Jt)){var ke=Jt.data;!Array.isArray(ke)&&Ue.type===Mu&&(Ue.type=na(ke));var Se=Jt.shape,ot=Jt.stride,Rt,or,vt,ft,nt,Oe;Se.length===3?(vt=Se[2],Oe=ot[2]):(ie(Se.length===2,"invalid ndarray pixel data, must be 2 or 3D"),vt=1,Oe=1),Rt=Se[0],or=Se[1],ft=ot[0],nt=ot[1],Ue.alignment=1,Ue.width=Rt,Ue.height=or,Ue.channels=vt,Ue.format=Ue.internalformat=Bn[vt],Ue.needsFree=!0,Gu(Ue,ke,ft,nt,Oe,Jt.offset)}else if(Js(Jt)||Ts(Jt)||yu(Jt)||zc(Jt))Js(Jt)||Ts(Jt)||yu(Jt)?Ue.element=Jt:Ue.element=Jt.canvas,Ue.width=Ue.element.width,Ue.height=Ue.element.height,Ue.channels=4;else if(Pl(Jt))Ue.element=Jt,Ue.width=Jt.width,Ue.height=Jt.height,Ue.channels=4;else if(Ec(Jt))Ue.element=Jt,Ue.width=Jt.naturalWidth,Ue.height=Jt.naturalHeight,Ue.channels=4;else if(Cc(Jt))Ue.element=Jt,Ue.width=Jt.videoWidth,Ue.height=Jt.videoHeight,Ue.channels=4;else if(nc(Jt)){var Qe=Ue.width||Jt[0].length,Fe=Ue.height||Jt.length,kt=Ue.channels;za(Jt[0][0])?kt=kt||Jt[0][0].length:kt=kt||1;for(var Wt=Wr.shape(Jt),Br=1,un=0;un<Wt.length;++un)Br*=Wt[un];var fn=Qs(Ue,Br);Wr.flatten(Jt,Wt,"",fn),Uo(Ue,fn),Ue.alignment=1,Ue.width=Qe,Ue.height=Fe,Ue.channels=kt,Ue.format=Ue.internalformat=Bn[kt],Ue.needsFree=!0}Ue.type===du?ie($e.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ue.type===pu&&ie($e.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Sn(Ue,er,Jt){var zn=Ue.element,oa=Ue.data,ke=Ue.internalformat,Se=Ue.format,ot=Ue.type,Rt=Ue.width,or=Ue.height;yn(Ue),zn?V.texImage2D(er,Jt,Se,Se,ot,zn):Ue.compressed?V.compressedTexImage2D(er,Jt,ke,Rt,or,0,oa):Ue.needsCopy?(ar(),V.copyTexImage2D(er,Jt,Se,Ue.xOffset,Ue.yOffset,Rt,or,0)):V.texImage2D(er,Jt,Se,Rt,or,0,Se,ot,oa||null)}function Zi(Ue,er,Jt,zn,oa){var ke=Ue.element,Se=Ue.data,ot=Ue.internalformat,Rt=Ue.format,or=Ue.type,vt=Ue.width,ft=Ue.height;yn(Ue),ke?V.texSubImage2D(er,oa,Jt,zn,Rt,or,ke):Ue.compressed?V.compressedTexSubImage2D(er,oa,Jt,zn,ot,vt,ft,Se):Ue.needsCopy?(ar(),V.copyTexSubImage2D(er,oa,Jt,zn,Ue.xOffset,Ue.yOffset,vt,ft)):V.texSubImage2D(er,oa,Jt,zn,vt,ft,Rt,or,Se)}var Oi=[];function Tn(){return Oi.pop()||new Yr}function En(Ue){Ue.needsFree&&$t.freeType(Ue.data),Yr.call(Ue),Oi.push(Ue)}function bi(){Tr.call(this),this.genMipmaps=!1,this.mipmapHint=vu,this.mipmask=0,this.images=Array(16)}function Li(Ue,er,Jt){var zn=Ue.images[0]=Tn();Ue.mipmask=1,zn.width=Ue.width=er,zn.height=Ue.height=Jt,zn.channels=Ue.channels=4}function qi(Ue,er){var Jt=null;if(Ps(er))Jt=Ue.images[0]=Tn(),Sr(Jt,Ue),An(Jt,er),Ue.mipmask=1;else if(Xn(Ue,er),Array.isArray(er.mipmap))for(var zn=er.mipmap,oa=0;oa<zn.length;++oa)Jt=Ue.images[oa]=Tn(),Sr(Jt,Ue),Jt.width>>=oa,Jt.height>>=oa,An(Jt,zn[oa]),Ue.mipmask|=1<<oa;else Jt=Ue.images[0]=Tn(),Sr(Jt,Ue),An(Jt,er),Ue.mipmask=1;Sr(Ue,Ue.images[0]),Ue.compressed&&(Ue.internalformat===ul||Ue.internalformat===Us||Ue.internalformat===gc||Ue.internalformat===yc)&&ie(Ue.width%4==0&&Ue.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function yo(Ue,er){for(var Jt=Ue.images,zn=0;zn<Jt.length;++zn){if(!Jt[zn])return;Sn(Jt[zn],er,zn)}}var Fo=[];function pa(){var Ue=Fo.pop()||new bi;Tr.call(Ue),Ue.mipmask=0;for(var er=0;er<16;++er)Ue.images[er]=null;return Ue}function ys(Ue){for(var er=Ue.images,Jt=0;Jt<er.length;++Jt)er[Jt]&&En(er[Jt]),er[Jt]=null;Fo.push(Ue)}function fo(){this.minFilter=Vu,this.magFilter=Vu,this.wrapS=ju,this.wrapT=ju,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=vu}function Ja(Ue,er){if("min"in er){var Jt=er.min;ie.parameter(Jt,$r),Ue.minFilter=$r[Jt],Eo.indexOf(Ue.minFilter)>=0&&!("faces"in er)&&(Ue.genMipmaps=!0)}if("mag"in er){var zn=er.mag;ie.parameter(zn,Kr),Ue.magFilter=Kr[zn]}var oa=Ue.wrapS,ke=Ue.wrapT;if("wrap"in er){var Se=er.wrap;typeof Se=="string"?(ie.parameter(Se,Vr),oa=ke=Vr[Se]):Array.isArray(Se)&&(ie.parameter(Se[0],Vr),ie.parameter(Se[1],Vr),oa=Vr[Se[0]],ke=Vr[Se[1]])}else{if("wrapS"in er){var ot=er.wrapS;ie.parameter(ot,Vr),oa=Vr[ot]}if("wrapT"in er){var Rt=er.wrapT;ie.parameter(Rt,Vr),ke=Vr[Rt]}}if(Ue.wrapS=oa,Ue.wrapT=ke,"anisotropic"in er){var or=er.anisotropic;ie(typeof or=="number"&&or>=1&&or<=$e.maxAnisotropic,"aniso samples must be between 1 and "),Ue.anisotropic=er.anisotropic}if("mipmap"in er){var vt=!1;switch(typeof er.mipmap){case"string":ie.parameter(er.mipmap,Fr,"invalid mipmap hint"),Ue.mipmapHint=Fr[er.mipmap],Ue.genMipmaps=!0,vt=!0;break;case"boolean":vt=Ue.genMipmaps=er.mipmap;break;case"object":ie(Array.isArray(er.mipmap),"invalid mipmap type"),Ue.genMipmaps=!1,vt=!0;break;default:ie.raise("invalid mipmap type")}vt&&!("min"in er)&&(Ue.minFilter=Ks)}}function Io(Ue,er){V.texParameteri(er,Ya,Ue.minFilter),V.texParameteri(er,ll,Ue.magFilter),V.texParameteri(er,xc,Ue.wrapS),V.texParameteri(er,wl,Ue.wrapT),Me.ext_texture_filter_anisotropic&&V.texParameteri(er,af,Ue.anisotropic),Ue.genMipmaps&&(V.hint(ql,Ue.mipmapHint),V.generateMipmap(er))}var cs=0,fs={},_s=$e.maxTextureUnits,Go=Array(_s).map(function(){return null});function Wi(Ue){Tr.call(this),this.mipmask=0,this.internalformat=Ds,this.id=cs++,this.refCount=1,this.target=Ue,this.texture=V.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new fo,Cr.profile&&(this.stats={size:0})}function Jo(Ue){V.activeTexture(Zs),V.bindTexture(Ue.target,Ue.texture)}function Pa(){var Ue=Go[0];Ue?V.bindTexture(Ue.target,Ue.texture):V.bindTexture(ds,null)}function _o(Ue){var er=Ue.texture;ie(er,"must not double destroy texture");var Jt=Ue.unit,zn=Ue.target;Jt>=0&&(V.activeTexture(Zs+Jt),V.bindTexture(zn,null),Go[Jt]=null),V.deleteTexture(er),Ue.texture=null,Ue.params=null,Ue.pixels=null,Ue.refCount=0,delete fs[Ue.id],rr.textureCount--}p(Wi.prototype,{bind:function(){var Ue=this;Ue.bindCount+=1;var er=Ue.unit;if(er<0){for(var Jt=0;Jt<_s;++Jt){var zn=Go[Jt];if(zn){if(zn.bindCount>0)continue;zn.unit=-1}Go[Jt]=Ue,er=Jt;break}er>=_s&&ie.raise("insufficient number of texture units"),Cr.profile&&rr.maxTextureUnits<er+1&&(rr.maxTextureUnits=er+1),Ue.unit=er,V.activeTexture(Zs+er),V.bindTexture(Ue.target,Ue.texture)}return er},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&_o(this)}});function _i(Ue,er){var Jt=new Wi(ds);fs[Jt.id]=Jt,rr.textureCount++;function zn(Se,ot){var Rt=Jt.texInfo;fo.call(Rt);var or=pa();return typeof Se=="number"?typeof ot=="number"?Li(or,Se|0,ot|0):Li(or,Se|0,Se|0):Se?(ie.type(Se,"object","invalid arguments to regl.texture"),Ja(Rt,Se),qi(or,Se)):Li(or,1,1),Rt.genMipmaps&&(or.mipmask=(or.width<<1)-1),Jt.mipmask=or.mipmask,Sr(Jt,or),ie.texture2D(Rt,or,$e),Jt.internalformat=or.internalformat,zn.width=or.width,zn.height=or.height,Jo(Jt),yo(or,ds),Io(Rt,ds),Pa(),ys(or),Cr.profile&&(Jt.stats.size=ru(Jt.internalformat,Jt.type,or.width,or.height,Rt.genMipmaps,!1)),zn.format=Xr[Jt.internalformat],zn.type=On[Jt.type],zn.mag=wr[Rt.magFilter],zn.min=bn[Rt.minFilter],zn.wrapS=tn[Rt.wrapS],zn.wrapT=tn[Rt.wrapT],zn}function oa(Se,ot,Rt,or){ie(!!Se,"must specify image data");var vt=ot|0,ft=Rt|0,nt=or|0,Oe=Tn();return Sr(Oe,Jt),Oe.width=0,Oe.height=0,An(Oe,Se),Oe.width=Oe.width||(Jt.width>>nt)-vt,Oe.height=Oe.height||(Jt.height>>nt)-ft,ie(Jt.type===Oe.type&&Jt.format===Oe.format&&Jt.internalformat===Oe.internalformat,"incompatible format for texture.subimage"),ie(vt>=0&&ft>=0&&vt+Oe.width<=Jt.width&&ft+Oe.height<=Jt.height,"texture.subimage write out of bounds"),ie(Jt.mipmask&1<<nt,"missing mipmap data"),ie(Oe.data||Oe.element||Oe.needsCopy,"missing image data"),Jo(Jt),Zi(Oe,ds,vt,ft,nt),Pa(),En(Oe),zn}function ke(Se,ot){var Rt=Se|0,or=ot|0||Rt;if(Rt===Jt.width&&or===Jt.height)return zn;zn.width=Jt.width=Rt,zn.height=Jt.height=or,Jo(Jt);for(var vt=0;Jt.mipmask>>vt;++vt){var ft=Rt>>vt,nt=or>>vt;if(!ft||!nt)break;V.texImage2D(ds,vt,Jt.format,ft,nt,0,Jt.format,Jt.type,null)}return Pa(),Cr.profile&&(Jt.stats.size=ru(Jt.internalformat,Jt.type,Rt,or,!1,!1)),zn}return zn(Ue,er),zn.subimage=oa,zn.resize=ke,zn._reglType="texture2d",zn._texture=Jt,Cr.profile&&(zn.stats=Jt.stats),zn.destroy=function(){Jt.decRef()},zn}function ha(Ue,er,Jt,zn,oa,ke){var Se=new Wi(Hl);fs[Se.id]=Se,rr.cubeCount++;var ot=new Array(6);function Rt(ft,nt,Oe,Qe,Fe,kt){var Wt,Br=Se.texInfo;for(fo.call(Br),Wt=0;Wt<6;++Wt)ot[Wt]=pa();if(typeof ft=="number"||!ft){var un=ft|0||1;for(Wt=0;Wt<6;++Wt)Li(ot[Wt],un,un)}else if(typeof ft=="object")if(nt)qi(ot[0],ft),qi(ot[1],nt),qi(ot[2],Oe),qi(ot[3],Qe),qi(ot[4],Fe),qi(ot[5],kt);else if(Ja(Br,ft),Xn(Se,ft),"faces"in ft){var fn=ft.faces;for(ie(Array.isArray(fn)&&fn.length===6,"cube faces must be a length 6 array"),Wt=0;Wt<6;++Wt)ie(typeof fn[Wt]=="object"&&!!fn[Wt],"invalid input for cube map face"),Sr(ot[Wt],Se),qi(ot[Wt],fn[Wt])}else for(Wt=0;Wt<6;++Wt)qi(ot[Wt],ft);else ie.raise("invalid arguments to cube map");for(Sr(Se,ot[0]),ie.optional(function(){$e.npotTextureCube||ie(il(Se.width)&&il(Se.height),"your browser does not support non power or two texture dimensions")}),Br.genMipmaps?Se.mipmask=(ot[0].width<<1)-1:Se.mipmask=ot[0].mipmask,ie.textureCube(Se,Br,ot,$e),Se.internalformat=ot[0].internalformat,Rt.width=ot[0].width,Rt.height=ot[0].height,Jo(Se),Wt=0;Wt<6;++Wt)yo(ot[Wt],fu+Wt);for(Io(Br,Hl),Pa(),Cr.profile&&(Se.stats.size=ru(Se.internalformat,Se.type,Rt.width,Rt.height,Br.genMipmaps,!0)),Rt.format=Xr[Se.internalformat],Rt.type=On[Se.type],Rt.mag=wr[Br.magFilter],Rt.min=bn[Br.minFilter],Rt.wrapS=tn[Br.wrapS],Rt.wrapT=tn[Br.wrapT],Wt=0;Wt<6;++Wt)ys(ot[Wt]);return Rt}function or(ft,nt,Oe,Qe,Fe){ie(!!nt,"must specify image data"),ie(typeof ft=="number"&&ft===(ft|0)&&ft>=0&&ft<6,"invalid face");var kt=Oe|0,Wt=Qe|0,Br=Fe|0,un=Tn();return Sr(un,Se),un.width=0,un.height=0,An(un,nt),un.width=un.width||(Se.width>>Br)-kt,un.height=un.height||(Se.height>>Br)-Wt,ie(Se.type===un.type&&Se.format===un.format&&Se.internalformat===un.internalformat,"incompatible format for texture.subimage"),ie(kt>=0&&Wt>=0&&kt+un.width<=Se.width&&Wt+un.height<=Se.height,"texture.subimage write out of bounds"),ie(Se.mipmask&1<<Br,"missing mipmap data"),ie(un.data||un.element||un.needsCopy,"missing image data"),Jo(Se),Zi(un,fu+ft,kt,Wt,Br),Pa(),En(un),Rt}function vt(ft){var nt=ft|0;if(nt!==Se.width){Rt.width=Se.width=nt,Rt.height=Se.height=nt,Jo(Se);for(var Oe=0;Oe<6;++Oe)for(var Qe=0;Se.mipmask>>Qe;++Qe)V.texImage2D(fu+Oe,Qe,Se.format,nt>>Qe,nt>>Qe,0,Se.format,Se.type,null);return Pa(),Cr.profile&&(Se.stats.size=ru(Se.internalformat,Se.type,Rt.width,Rt.height,!1,!0)),Rt}}return Rt(Ue,er,Jt,zn,oa,ke),Rt.subimage=or,Rt.resize=vt,Rt._reglType="textureCube",Rt._texture=Se,Cr.profile&&(Rt.stats=Se.stats),Rt.destroy=function(){Se.decRef()},Rt}function io(){for(var Ue=0;Ue<_s;++Ue)V.activeTexture(Zs+Ue),V.bindTexture(ds,null),Go[Ue]=null;Yt(fs).forEach(_o),rr.cubeCount=0,rr.textureCount=0}Cr.profile&&(rr.getTotalTextureSize=function(){var Ue=0;return Object.keys(fs).forEach(function(er){Ue+=fs[er].stats.size}),Ue});function xo(){for(var Ue=0;Ue<_s;++Ue){var er=Go[Ue];er&&(er.bindCount=0,er.unit=-1,Go[Ue]=null)}Yt(fs).forEach(function(Jt){Jt.texture=V.createTexture(),V.bindTexture(Jt.target,Jt.texture);for(var zn=0;zn<32;++zn)if((Jt.mipmask&1<<zn)!=0)if(Jt.target===ds)V.texImage2D(ds,zn,Jt.internalformat,Jt.width>>zn,Jt.height>>zn,0,Jt.internalformat,Jt.type,null);else for(var oa=0;oa<6;++oa)V.texImage2D(fu+oa,zn,Jt.internalformat,Jt.width>>zn,Jt.height>>zn,0,Jt.internalformat,Jt.type,null);Io(Jt.texInfo,Jt.target)})}function bu(){for(var Ue=0;Ue<_s;++Ue){var er=Go[Ue];er&&(er.bindCount=0,er.unit=-1,Go[Ue]=null),V.activeTexture(Zs+Ue),V.bindTexture(ds,null),V.bindTexture(Hl,null)}}return{create2D:_i,createCube:ha,clear:io,getTexture:function(Ue){return null},restore:xo,refresh:bu}}var Co=36161,Hu=32854,ri=32855,Kn=36194,Ml=33189,as=36168,js=34041,Zo=35907,iu=34836,wc=34842,ic=34843,ia=[];ia[Hu]=2,ia[ri]=2,ia[Kn]=2,ia[Ml]=2,ia[as]=1,ia[js]=4,ia[Zo]=4,ia[iu]=16,ia[wc]=8,ia[ic]=6;function Do(V,Me,$e){return ia[V]*Me*$e}var Uc=function(V,Me,$e,ar,Pr){var rr={rgba4:Hu,rgb565:Kn,"rgb5 a1":ri,depth:Ml,stencil:as,"depth stencil":js};Me.ext_srgb&&(rr.srgba=Zo),Me.ext_color_buffer_half_float&&(rr.rgba16f=wc,rr.rgb16f=ic),Me.webgl_color_buffer_float&&(rr.rgba32f=iu);var Cr=[];Object.keys(rr).forEach(function(Hr){var en=rr[Hr];Cr[en]=Hr});var Fr=0,Vr={};function Kr(Hr){this.id=Fr++,this.refCount=1,this.renderbuffer=Hr,this.format=Hu,this.width=0,this.height=0,Pr.profile&&(this.stats={size:0})}Kr.prototype.decRef=function(){--this.refCount<=0&&$r(this)};function $r(Hr){var en=Hr.renderbuffer;ie(en,"must not double destroy renderbuffer"),V.bindRenderbuffer(Co,null),V.deleteRenderbuffer(en),Hr.renderbuffer=null,Hr.refCount=0,delete Vr[Hr.id],ar.renderbufferCount--}function rn(Hr,en){var Lt=new Kr(V.createRenderbuffer());Vr[Lt.id]=Lt,ar.renderbufferCount++;function vr(On,wr){var bn=0,tn=0,ui=Hu;if(typeof On=="object"&&On){var Tr=On;if("shape"in Tr){var Sr=Tr.shape;ie(Array.isArray(Sr)&&Sr.length>=2,"invalid renderbuffer shape"),bn=Sr[0]|0,tn=Sr[1]|0}else"radius"in Tr&&(bn=tn=Tr.radius|0),"width"in Tr&&(bn=Tr.width|0),"height"in Tr&&(tn=Tr.height|0);"format"in Tr&&(ie.parameter(Tr.format,rr,"invalid renderbuffer format"),ui=rr[Tr.format])}else typeof On=="number"?(bn=On|0,typeof wr=="number"?tn=wr|0:tn=bn):On?ie.raise("invalid arguments to renderbuffer constructor"):bn=tn=1;if(ie(bn>0&&tn>0&&bn<=$e.maxRenderbufferSize&&tn<=$e.maxRenderbufferSize,"invalid renderbuffer size"),!(bn===Lt.width&&tn===Lt.height&&ui===Lt.format))return vr.width=Lt.width=bn,vr.height=Lt.height=tn,Lt.format=ui,V.bindRenderbuffer(Co,Lt.renderbuffer),V.renderbufferStorage(Co,ui,bn,tn),ie(V.getError()===0,"invalid render buffer format"),Pr.profile&&(Lt.stats.size=Do(Lt.format,Lt.width,Lt.height)),vr.format=Cr[Lt.format],vr}function Xr(On,wr){var bn=On|0,tn=wr|0||bn;return bn===Lt.width&&tn===Lt.height||(ie(bn>0&&tn>0&&bn<=$e.maxRenderbufferSize&&tn<=$e.maxRenderbufferSize,"invalid renderbuffer size"),vr.width=Lt.width=bn,vr.height=Lt.height=tn,V.bindRenderbuffer(Co,Lt.renderbuffer),V.renderbufferStorage(Co,Lt.format,bn,tn),ie(V.getError()===0,"invalid render buffer format"),Pr.profile&&(Lt.stats.size=Do(Lt.format,Lt.width,Lt.height))),vr}return vr(Hr,en),vr.resize=Xr,vr._reglType="renderbuffer",vr._renderbuffer=Lt,Pr.profile&&(vr.stats=Lt.stats),vr.destroy=function(){Lt.decRef()},vr}Pr.profile&&(ar.getTotalRenderbufferSize=function(){var Hr=0;return Object.keys(Vr).forEach(function(en){Hr+=Vr[en].stats.size}),Hr});function dn(){Yt(Vr).forEach(function(Hr){Hr.renderbuffer=V.createRenderbuffer(),V.bindRenderbuffer(Co,Hr.renderbuffer),V.renderbufferStorage(Co,Hr.format,Hr.width,Hr.height)}),V.bindRenderbuffer(Co,null)}return{create:rn,clear:function(){Yt(Vr).forEach($r)},restore:dn}},gs=36160,Il=36161,Ms=3553,os=34069,hl=36064,au=36096,ac=36128,Wu=33306,Xu=36053,Zc=36054,Ol=36055,pl=36057,jc=36061,Yu=36193,Ru=5121,oc=5126,Du=6407,Vs=6408,Ac=6402,sc=[Du,Vs],uc=[];uc[Vs]=4,uc[Du]=3;var Ku=[];Ku[Ru]=1,Ku[oc]=4,Ku[Yu]=2;var n=32854,u=32855,o=36194,h=33189,y=36168,b=34041,P=35907,F=34836,H=34842,ae=34843,xe=[n,u,o,P,H,ae,F],we={};we[Xu]="complete",we[Zc]="incomplete attachment",we[pl]="incomplete dimensions",we[Ol]="incomplete, missing attachment",we[jc]="unsupported";function Te(V,Me,$e,ar,Pr,rr){var Cr={cur:null,next:null,dirty:!1,setFBO:null},Fr=["rgba"],Vr=["rgba4","rgb565","rgb5 a1"];Me.ext_srgb&&Vr.push("srgba"),Me.ext_color_buffer_half_float&&Vr.push("rgba16f","rgb16f"),Me.webgl_color_buffer_float&&Vr.push("rgba32f");var Kr=["uint8"];Me.oes_texture_half_float&&Kr.push("half float","float16"),Me.oes_texture_float&&Kr.push("float","float32");function $r(Yr,An,Sn){this.target=Yr,this.texture=An,this.renderbuffer=Sn;var Zi=0,Oi=0;An?(Zi=An.width,Oi=An.height):Sn&&(Zi=Sn.width,Oi=Sn.height),this.width=Zi,this.height=Oi}function rn(Yr){Yr&&(Yr.texture&&Yr.texture._texture.decRef(),Yr.renderbuffer&&Yr.renderbuffer._renderbuffer.decRef())}function dn(Yr,An,Sn){if(!!Yr)if(Yr.texture){var Zi=Yr.texture._texture,Oi=Math.max(1,Zi.width),Tn=Math.max(1,Zi.height);ie(Oi===An&&Tn===Sn,"inconsistent width/height for supplied texture"),Zi.refCount+=1}else{var En=Yr.renderbuffer._renderbuffer;ie(En.width===An&&En.height===Sn,"inconsistent width/height for renderbuffer"),En.refCount+=1}}function Hr(Yr,An){An&&(An.texture?V.framebufferTexture2D(gs,Yr,An.target,An.texture._texture.texture,0):V.framebufferRenderbuffer(gs,Yr,Il,An.renderbuffer._renderbuffer.renderbuffer))}function en(Yr){var An=Ms,Sn=null,Zi=null,Oi=Yr;typeof Yr=="object"&&(Oi=Yr.data,"target"in Yr&&(An=Yr.target|0)),ie.type(Oi,"function","invalid attachment data");var Tn=Oi._reglType;return Tn==="texture2d"?(Sn=Oi,ie(An===Ms)):Tn==="textureCube"?(Sn=Oi,ie(An>=os&&An<os+6,"invalid cube map target")):Tn==="renderbuffer"?(Zi=Oi,An=Il):ie.raise("invalid regl object for attachment"),new $r(An,Sn,Zi)}function Lt(Yr,An,Sn,Zi,Oi){if(Sn){var Tn=ar.create2D({width:Yr,height:An,format:Zi,type:Oi});return Tn._texture.refCount=0,new $r(Ms,Tn,null)}else{var En=Pr.create({width:Yr,height:An,format:Zi});return En._renderbuffer.refCount=0,new $r(Il,null,En)}}function vr(Yr){return Yr&&(Yr.texture||Yr.renderbuffer)}function Xr(Yr,An,Sn){Yr&&(Yr.texture?Yr.texture.resize(An,Sn):Yr.renderbuffer&&Yr.renderbuffer.resize(An,Sn),Yr.width=An,Yr.height=Sn)}var On=0,wr={};function bn(){this.id=On++,wr[this.id]=this,this.framebuffer=V.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function tn(Yr){Yr.colorAttachments.forEach(rn),rn(Yr.depthAttachment),rn(Yr.stencilAttachment),rn(Yr.depthStencilAttachment)}function ui(Yr){var An=Yr.framebuffer;ie(An,"must not double destroy framebuffer"),V.deleteFramebuffer(An),Yr.framebuffer=null,rr.framebufferCount--,delete wr[Yr.id]}function Tr(Yr){var An;V.bindFramebuffer(gs,Yr.framebuffer);var Sn=Yr.colorAttachments;for(An=0;An<Sn.length;++An)Hr(hl+An,Sn[An]);for(An=Sn.length;An<$e.maxColorAttachments;++An)V.framebufferTexture2D(gs,hl+An,Ms,null,0);V.framebufferTexture2D(gs,Wu,Ms,null,0),V.framebufferTexture2D(gs,au,Ms,null,0),V.framebufferTexture2D(gs,ac,Ms,null,0),Hr(au,Yr.depthAttachment),Hr(ac,Yr.stencilAttachment),Hr(Wu,Yr.depthStencilAttachment);var Zi=V.checkFramebufferStatus(gs);!V.isContextLost()&&Zi!==Xu&&ie.raise("framebuffer configuration not supported, status = "+we[Zi]),V.bindFramebuffer(gs,Cr.next?Cr.next.framebuffer:null),Cr.cur=Cr.next,V.getError()}function Sr(Yr,An){var Sn=new bn;rr.framebufferCount++;function Zi(Tn,En){var bi;ie(Cr.next!==Sn,"can not update framebuffer which is currently in use");var Li=0,qi=0,yo=!0,Fo=!0,pa=null,ys=!0,fo="rgba",Ja="uint8",Io=1,cs=null,fs=null,_s=null,Go=!1;if(typeof Tn=="number")Li=Tn|0,qi=En|0||Li;else if(!Tn)Li=qi=1;else{ie.type(Tn,"object","invalid arguments for framebuffer");var Wi=Tn;if("shape"in Wi){var Jo=Wi.shape;ie(Array.isArray(Jo)&&Jo.length>=2,"invalid shape for framebuffer"),Li=Jo[0],qi=Jo[1]}else"radius"in Wi&&(Li=qi=Wi.radius),"width"in Wi&&(Li=Wi.width),"height"in Wi&&(qi=Wi.height);("color"in Wi||"colors"in Wi)&&(pa=Wi.color||Wi.colors,Array.isArray(pa)&&ie(pa.length===1||Me.webgl_draw_buffers,"multiple render targets not supported")),pa||("colorCount"in Wi&&(Io=Wi.colorCount|0,ie(Io>0,"invalid color buffer count")),"colorTexture"in Wi&&(ys=!!Wi.colorTexture,fo="rgba4"),"colorType"in Wi&&(Ja=Wi.colorType,ys?(ie(Me.oes_texture_float||!(Ja==="float"||Ja==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ie(Me.oes_texture_half_float||!(Ja==="half float"||Ja==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ja==="half float"||Ja==="float16"?(ie(Me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),fo="rgba16f"):(Ja==="float"||Ja==="float32")&&(ie(Me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),fo="rgba32f"),ie.oneOf(Ja,Kr,"invalid color type")),"colorFormat"in Wi&&(fo=Wi.colorFormat,Fr.indexOf(fo)>=0?ys=!0:Vr.indexOf(fo)>=0?ys=!1:ie.optional(function(){ys?ie.oneOf(Wi.colorFormat,Fr,"invalid color format for texture"):ie.oneOf(Wi.colorFormat,Vr,"invalid color format for renderbuffer")}))),("depthTexture"in Wi||"depthStencilTexture"in Wi)&&(Go=!!(Wi.depthTexture||Wi.depthStencilTexture),ie(!Go||Me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Wi&&(typeof Wi.depth=="boolean"?yo=Wi.depth:(cs=Wi.depth,Fo=!1)),"stencil"in Wi&&(typeof Wi.stencil=="boolean"?Fo=Wi.stencil:(fs=Wi.stencil,yo=!1)),"depthStencil"in Wi&&(typeof Wi.depthStencil=="boolean"?yo=Fo=Wi.depthStencil:(_s=Wi.depthStencil,yo=!1,Fo=!1))}var Pa=null,_o=null,_i=null,ha=null;if(Array.isArray(pa))Pa=pa.map(en);else if(pa)Pa=[en(pa)];else for(Pa=new Array(Io),bi=0;bi<Io;++bi)Pa[bi]=Lt(Li,qi,ys,fo,Ja);ie(Me.webgl_draw_buffers||Pa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ie(Pa.length<=$e.maxColorAttachments,"too many color attachments, not supported"),Li=Li||Pa[0].width,qi=qi||Pa[0].height,cs?_o=en(cs):yo&&!Fo&&(_o=Lt(Li,qi,Go,"depth","uint32")),fs?_i=en(fs):Fo&&!yo&&(_i=Lt(Li,qi,!1,"stencil","uint8")),_s?ha=en(_s):!cs&&!fs&&Fo&&yo&&(ha=Lt(Li,qi,Go,"depth stencil","depth stencil")),ie(!!cs+!!fs+!!_s<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var io=null;for(bi=0;bi<Pa.length;++bi)if(dn(Pa[bi],Li,qi),ie(!Pa[bi]||Pa[bi].texture&&sc.indexOf(Pa[bi].texture._texture.format)>=0||Pa[bi].renderbuffer&&xe.indexOf(Pa[bi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+bi+" is invalid"),Pa[bi]&&Pa[bi].texture){var xo=uc[Pa[bi].texture._texture.format]*Ku[Pa[bi].texture._texture.type];io===null?io=xo:ie(io===xo,"all color attachments much have the same number of bits per pixel.")}return dn(_o,Li,qi),ie(!_o||_o.texture&&_o.texture._texture.format===Ac||_o.renderbuffer&&_o.renderbuffer._renderbuffer.format===h,"invalid depth attachment for framebuffer object"),dn(_i,Li,qi),ie(!_i||_i.renderbuffer&&_i.renderbuffer._renderbuffer.format===y,"invalid stencil attachment for framebuffer object"),dn(ha,Li,qi),ie(!ha||ha.texture&&ha.texture._texture.format===b||ha.renderbuffer&&ha.renderbuffer._renderbuffer.format===b,"invalid depth-stencil attachment for framebuffer object"),tn(Sn),Sn.width=Li,Sn.height=qi,Sn.colorAttachments=Pa,Sn.depthAttachment=_o,Sn.stencilAttachment=_i,Sn.depthStencilAttachment=ha,Zi.color=Pa.map(vr),Zi.depth=vr(_o),Zi.stencil=vr(_i),Zi.depthStencil=vr(ha),Zi.width=Sn.width,Zi.height=Sn.height,Tr(Sn),Zi}function Oi(Tn,En){ie(Cr.next!==Sn,"can not resize a framebuffer which is currently in use");var bi=Math.max(Tn|0,1),Li=Math.max(En|0||bi,1);if(bi===Sn.width&&Li===Sn.height)return Zi;for(var qi=Sn.colorAttachments,yo=0;yo<qi.length;++yo)Xr(qi[yo],bi,Li);return Xr(Sn.depthAttachment,bi,Li),Xr(Sn.stencilAttachment,bi,Li),Xr(Sn.depthStencilAttachment,bi,Li),Sn.width=Zi.width=bi,Sn.height=Zi.height=Li,Tr(Sn),Zi}return Zi(Yr,An),p(Zi,{resize:Oi,_reglType:"framebuffer",_framebuffer:Sn,destroy:function(){ui(Sn),tn(Sn)},use:function(Tn){Cr.setFBO({framebuffer:Zi},Tn)}})}function Xn(Yr){var An=Array(6);function Sn(Oi){var Tn;ie(An.indexOf(Cr.next)<0,"can not update framebuffer which is currently in use");var En={color:null},bi=0,Li=null,qi="rgba",yo="uint8",Fo=1;if(typeof Oi=="number")bi=Oi|0;else if(!Oi)bi=1;else{ie.type(Oi,"object","invalid arguments for framebuffer");var pa=Oi;if("shape"in pa){var ys=pa.shape;ie(Array.isArray(ys)&&ys.length>=2,"invalid shape for framebuffer"),ie(ys[0]===ys[1],"cube framebuffer must be square"),bi=ys[0]}else"radius"in pa&&(bi=pa.radius|0),"width"in pa?(bi=pa.width|0,"height"in pa&&ie(pa.height===bi,"must be square")):"height"in pa&&(bi=pa.height|0);("color"in pa||"colors"in pa)&&(Li=pa.color||pa.colors,Array.isArray(Li)&&ie(Li.length===1||Me.webgl_draw_buffers,"multiple render targets not supported")),Li||("colorCount"in pa&&(Fo=pa.colorCount|0,ie(Fo>0,"invalid color buffer count")),"colorType"in pa&&(ie.oneOf(pa.colorType,Kr,"invalid color type"),yo=pa.colorType),"colorFormat"in pa&&(qi=pa.colorFormat,ie.oneOf(pa.colorFormat,Fr,"invalid color format for texture"))),"depth"in pa&&(En.depth=pa.depth),"stencil"in pa&&(En.stencil=pa.stencil),"depthStencil"in pa&&(En.depthStencil=pa.depthStencil)}var fo;if(Li)if(Array.isArray(Li))for(fo=[],Tn=0;Tn<Li.length;++Tn)fo[Tn]=Li[Tn];else fo=[Li];else{fo=Array(Fo);var Ja={radius:bi,format:qi,type:yo};for(Tn=0;Tn<Fo;++Tn)fo[Tn]=ar.createCube(Ja)}for(En.color=Array(fo.length),Tn=0;Tn<fo.length;++Tn){var Io=fo[Tn];ie(typeof Io=="function"&&Io._reglType==="textureCube","invalid cube map"),bi=bi||Io.width,ie(Io.width===bi&&Io.height===bi,"invalid cube map shape"),En.color[Tn]={target:os,data:fo[Tn]}}for(Tn=0;Tn<6;++Tn){for(var cs=0;cs<fo.length;++cs)En.color[cs].target=os+Tn;Tn>0&&(En.depth=An[0].depth,En.stencil=An[0].stencil,En.depthStencil=An[0].depthStencil),An[Tn]?An[Tn](En):An[Tn]=Sr(En)}return p(Sn,{width:bi,height:bi,color:fo})}function Zi(Oi){var Tn,En=Oi|0;if(ie(En>0&&En<=$e.maxCubeMapSize,"invalid radius for cube fbo"),En===Sn.width)return Sn;var bi=Sn.color;for(Tn=0;Tn<bi.length;++Tn)bi[Tn].resize(En);for(Tn=0;Tn<6;++Tn)An[Tn].resize(En);return Sn.width=Sn.height=En,Sn}return Sn(Yr),p(Sn,{faces:An,resize:Zi,_reglType:"framebufferCube",destroy:function(){An.forEach(function(Oi){Oi.destroy()})}})}function yn(){Cr.cur=null,Cr.next=null,Cr.dirty=!0,Yt(wr).forEach(function(Yr){Yr.framebuffer=V.createFramebuffer(),Tr(Yr)})}return p(Cr,{getFramebuffer:function(Yr){if(typeof Yr=="function"&&Yr._reglType==="framebuffer"){var An=Yr._framebuffer;if(An instanceof bn)return An}return null},create:Sr,createCube:Xn,clear:function(){Yt(wr).forEach(ui)},restore:yn})}var He=5126,je=34962,it=34963,ze=["attributes","elements","offset","count","primitive","instances"];function at(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=He,this.offset=0,this.stride=0,this.divisor=0}function xt(V,Me,$e,ar,Pr,rr,Cr){for(var Fr=$e.maxAttributes,Vr=new Array(Fr),Kr=0;Kr<Fr;++Kr)Vr[Kr]=new at;var $r=0,rn={},dn={Record:at,scope:{},state:Vr,currentVAO:null,targetVAO:null,restore:en()?tn:function(){},createVAO:ui,getVAO:vr,destroyBuffer:Hr,setVAO:en()?Xr:On,clear:en()?wr:function(){}};function Hr(Tr){for(var Sr=0;Sr<Vr.length;++Sr){var Xn=Vr[Sr];Xn.buffer===Tr&&(V.disableVertexAttribArray(Sr),Xn.buffer=null)}}function en(){return Me.oes_vertex_array_object}function Lt(){return Me.angle_instanced_arrays}function vr(Tr){return typeof Tr=="function"&&Tr._vao?Tr._vao:null}function Xr(Tr){if(Tr!==dn.currentVAO){var Sr=en();Tr?Sr.bindVertexArrayOES(Tr.vao):Sr.bindVertexArrayOES(null),dn.currentVAO=Tr}}function On(Tr){if(Tr!==dn.currentVAO){if(Tr)Tr.bindAttrs();else{for(var Sr=Lt(),Xn=0;Xn<Vr.length;++Xn){var yn=Vr[Xn];yn.buffer?(V.enableVertexAttribArray(Xn),yn.buffer.bind(),V.vertexAttribPointer(Xn,yn.size,yn.type,yn.normalized,yn.stride,yn.offfset),Sr&&yn.divisor&&Sr.vertexAttribDivisorANGLE(Xn,yn.divisor)):(V.disableVertexAttribArray(Xn),V.vertexAttrib4f(Xn,yn.x,yn.y,yn.z,yn.w))}Cr.elements?V.bindBuffer(it,Cr.elements.buffer.buffer):V.bindBuffer(it,null)}dn.currentVAO=Tr}}function wr(){Yt(rn).forEach(function(Tr){Tr.destroy()})}function bn(){this.id=++$r,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Tr=en();Tr?this.vao=Tr.createVertexArrayOES():this.vao=null,rn[this.id]=this,this.buffers=[]}bn.prototype.bindAttrs=function(){for(var Tr=Lt(),Sr=this.attributes,Xn=0;Xn<Sr.length;++Xn){var yn=Sr[Xn];yn.buffer?(V.enableVertexAttribArray(Xn),V.bindBuffer(je,yn.buffer.buffer),V.vertexAttribPointer(Xn,yn.size,yn.type,yn.normalized,yn.stride,yn.offset),Tr&&yn.divisor&&Tr.vertexAttribDivisorANGLE(Xn,yn.divisor)):(V.disableVertexAttribArray(Xn),V.vertexAttrib4f(Xn,yn.x,yn.y,yn.z,yn.w))}for(var Yr=Sr.length;Yr<Fr;++Yr)V.disableVertexAttribArray(Yr);var An=rr.getElements(this.elements);An?V.bindBuffer(it,An.buffer.buffer):V.bindBuffer(it,null)},bn.prototype.refresh=function(){var Tr=en();Tr&&(Tr.bindVertexArrayOES(this.vao),this.bindAttrs(),dn.currentVAO=null,Tr.bindVertexArrayOES(null))},bn.prototype.destroy=function(){if(this.vao){var Tr=en();this===dn.currentVAO&&(dn.currentVAO=null,Tr.bindVertexArrayOES(null)),Tr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),rn[this.id]&&(delete rn[this.id],ar.vaoCount-=1)};function tn(){var Tr=en();Tr&&Yt(rn).forEach(function(Sr){Sr.refresh()})}function ui(Tr){var Sr=new bn;ar.vaoCount+=1;function Xn(yn){var Yr;if(Array.isArray(yn))Yr=yn,Sr.elements&&Sr.ownsElements&&Sr.elements.destroy(),Sr.elements=null,Sr.ownsElements=!1,Sr.offset=0,Sr.count=0,Sr.instances=-1,Sr.primitive=4;else{if(ie(typeof yn=="object","invalid arguments for create vao"),ie("attributes"in yn,"must specify attributes for vao"),yn.elements){var An=yn.elements;Sr.ownsElements?typeof An=="function"&&An._reglType==="elements"?(Sr.elements.destroy(),Sr.ownsElements=!1):(Sr.elements(An),Sr.ownsElements=!1):rr.getElements(yn.elements)?(Sr.elements=yn.elements,Sr.ownsElements=!1):(Sr.elements=rr.create(yn.elements),Sr.ownsElements=!0)}else Sr.elements=null,Sr.ownsElements=!1;Yr=yn.attributes,Sr.offset=0,Sr.count=-1,Sr.instances=-1,Sr.primitive=4,Sr.elements&&(Sr.count=Sr.elements._elements.vertCount,Sr.primitive=Sr.elements._elements.primType),"offset"in yn&&(Sr.offset=yn.offset|0),"count"in yn&&(Sr.count=yn.count|0),"instances"in yn&&(Sr.instances=yn.instances|0),"primitive"in yn&&(ie(yn.primitive in Ar,"bad primitive type: "+yn.primitive),Sr.primitive=Ar[yn.primitive]),ie.optional(()=>{for(var yo=Object.keys(yn),Fo=0;Fo<yo.length;++Fo)ie(ze.indexOf(yo[Fo])>=0,'invalid option for vao: "'+yo[Fo]+'" valid options are '+ze)}),ie(Array.isArray(Yr),"attributes must be an array")}ie(Yr.length<Fr,"too many attributes"),ie(Yr.length>0,"must specify at least one attribute");var Sn={},Zi=Sr.attributes;Zi.length=Yr.length;for(var Oi=0;Oi<Yr.length;++Oi){var Tn=Yr[Oi],En=Zi[Oi]=new at,bi=Tn.data||Tn;if(Array.isArray(bi)||C(bi)||ct(bi)){var Li;Sr.buffers[Oi]&&(Li=Sr.buffers[Oi],C(bi)&&Li._buffer.byteLength>=bi.byteLength?Li.subdata(bi):(Li.destroy(),Sr.buffers[Oi]=null)),Sr.buffers[Oi]||(Li=Sr.buffers[Oi]=Pr.create(Tn,je,!1,!0)),En.buffer=Pr.getBuffer(Li),En.size=En.buffer.dimension|0,En.normalized=!1,En.type=En.buffer.dtype,En.offset=0,En.stride=0,En.divisor=0,En.state=1,Sn[Oi]=1}else Pr.getBuffer(Tn)?(En.buffer=Pr.getBuffer(Tn),En.size=En.buffer.dimension|0,En.normalized=!1,En.type=En.buffer.dtype,En.offset=0,En.stride=0,En.divisor=0,En.state=1):Pr.getBuffer(Tn.buffer)?(En.buffer=Pr.getBuffer(Tn.buffer),En.size=(+Tn.size||En.buffer.dimension)|0,En.normalized=!!Tn.normalized||!1,"type"in Tn?(ie.parameter(Tn.type,Rs,"invalid buffer type"),En.type=Rs[Tn.type]):En.type=En.buffer.dtype,En.offset=(Tn.offset||0)|0,En.stride=(Tn.stride||0)|0,En.divisor=(Tn.divisor||0)|0,En.state=1,ie(En.size>=1&&En.size<=4,"size must be between 1 and 4"),ie(En.offset>=0,"invalid offset"),ie(En.stride>=0&&En.stride<=255,"stride must be between 0 and 255"),ie(En.divisor>=0,"divisor must be positive"),ie(!En.divisor||!!Me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Tn?(ie(Oi>0,"first attribute must not be a constant"),En.x=+Tn.x||0,En.y=+Tn.y||0,En.z=+Tn.z||0,En.w=+Tn.w||0,En.state=2):ie(!1,"invalid attribute spec for location "+Oi)}for(var qi=0;qi<Sr.buffers.length;++qi)!Sn[qi]&&Sr.buffers[qi]&&(Sr.buffers[qi].destroy(),Sr.buffers[qi]=null);return Sr.refresh(),Xn}return Xn.destroy=function(){for(var yn=0;yn<Sr.buffers.length;++yn)Sr.buffers[yn]&&Sr.buffers[yn].destroy();Sr.buffers.length=0,Sr.ownsElements&&(Sr.elements.destroy(),Sr.elements=null,Sr.ownsElements=!1),Sr.destroy()},Xn._vao=Sr,Xn._reglType="vao",Xn(Tr)}return dn}var jt=35632,gr=35633,lr=35718,_r=35721;function zr(V,Me,$e,ar){var Pr={},rr={};function Cr(Lt,vr,Xr,On){this.name=Lt,this.id=vr,this.location=Xr,this.info=On}function Fr(Lt,vr){for(var Xr=0;Xr<Lt.length;++Xr)if(Lt[Xr].id===vr.id){Lt[Xr].location=vr.location;return}Lt.push(vr)}function Vr(Lt,vr,Xr){var On=Lt===jt?Pr:rr,wr=On[vr];if(!wr){var bn=Me.str(vr);wr=V.createShader(Lt),V.shaderSource(wr,bn),V.compileShader(wr),ie.shaderError(V,wr,bn,Lt,Xr),On[vr]=wr}return wr}var Kr={},$r=[],rn=0;function dn(Lt,vr){this.id=rn++,this.fragId=Lt,this.vertId=vr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,ar.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Hr(Lt,vr,Xr){var On,wr,bn=Vr(jt,Lt.fragId),tn=Vr(gr,Lt.vertId),ui=Lt.program=V.createProgram();if(V.attachShader(ui,bn),V.attachShader(ui,tn),Xr)for(On=0;On<Xr.length;++On){var Tr=Xr[On];V.bindAttribLocation(ui,Tr[0],Tr[1])}V.linkProgram(ui),ie.linkError(V,ui,Me.str(Lt.fragId),Me.str(Lt.vertId),vr);var Sr=V.getProgramParameter(ui,lr);ar.profile&&(Lt.stats.uniformsCount=Sr);var Xn=Lt.uniforms;for(On=0;On<Sr;++On)if(wr=V.getActiveUniform(ui,On),wr)if(wr.size>1)for(var yn=0;yn<wr.size;++yn){var Yr=wr.name.replace("[0]","["+yn+"]");Fr(Xn,new Cr(Yr,Me.id(Yr),V.getUniformLocation(ui,Yr),wr))}else Fr(Xn,new Cr(wr.name,Me.id(wr.name),V.getUniformLocation(ui,wr.name),wr));var An=V.getProgramParameter(ui,_r);ar.profile&&(Lt.stats.attributesCount=An);var Sn=Lt.attributes;for(On=0;On<An;++On)wr=V.getActiveAttrib(ui,On),wr&&Fr(Sn,new Cr(wr.name,Me.id(wr.name),V.getAttribLocation(ui,wr.name),wr))}ar.profile&&($e.getMaxUniformsCount=function(){var Lt=0;return $r.forEach(function(vr){vr.stats.uniformsCount>Lt&&(Lt=vr.stats.uniformsCount)}),Lt},$e.getMaxAttributesCount=function(){var Lt=0;return $r.forEach(function(vr){vr.stats.attributesCount>Lt&&(Lt=vr.stats.attributesCount)}),Lt});function en(){Pr={},rr={};for(var Lt=0;Lt<$r.length;++Lt)Hr($r[Lt],null,$r[Lt].attributes.map(function(vr){return[vr.location,vr.name]}))}return{clear:function(){var Lt=V.deleteShader.bind(V);Yt(Pr).forEach(Lt),Pr={},Yt(rr).forEach(Lt),rr={},$r.forEach(function(vr){V.deleteProgram(vr.program)}),$r.length=0,Kr={},$e.shaderCount=0},program:function(Lt,vr,Xr,On){ie.command(Lt>=0,"missing vertex shader",Xr),ie.command(vr>=0,"missing fragment shader",Xr);var wr=Kr[vr];wr||(wr=Kr[vr]={});var bn=wr[Lt];if(bn&&(bn.refCount++,!On))return bn;var tn=new dn(vr,Lt);return $e.shaderCount++,Hr(tn,Xr,On),bn||(wr[Lt]=tn),$r.push(tn),p(tn,{destroy:function(){if(tn.refCount--,tn.refCount<=0){V.deleteProgram(tn.program);var ui=$r.indexOf(tn);$r.splice(ui,1),$e.shaderCount--}wr[tn.vertId].refCount<=0&&(V.deleteShader(rr[tn.vertId]),delete rr[tn.vertId],delete Kr[tn.fragId][tn.vertId]),Object.keys(Kr[tn.fragId]).length||(V.deleteShader(Pr[tn.fragId]),delete Pr[tn.fragId],delete Kr[tn.fragId])}})},restore:en,shader:Vr,frag:-1,vert:-1}}var on=6408,Qr=5121,Pn=3333,ei=5126;function ci(V,Me,$e,ar,Pr,rr,Cr){function Fr($r){var rn;Me.next===null?(ie(Pr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),rn=Qr):(ie(Me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),rn=Me.next.colorAttachments[0].texture._texture.type,ie.optional(function(){rr.oes_texture_float?(ie(rn===Qr||rn===ei,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),rn===ei&&ie(Cr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ie(rn===Qr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var dn=0,Hr=0,en=ar.framebufferWidth,Lt=ar.framebufferHeight,vr=null;C($r)?vr=$r:$r&&(ie.type($r,"object","invalid arguments to regl.read()"),dn=$r.x|0,Hr=$r.y|0,ie(dn>=0&&dn<ar.framebufferWidth,"invalid x offset for regl.read"),ie(Hr>=0&&Hr<ar.framebufferHeight,"invalid y offset for regl.read"),en=($r.width||ar.framebufferWidth-dn)|0,Lt=($r.height||ar.framebufferHeight-Hr)|0,vr=$r.data||null),vr&&(rn===Qr?ie(vr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):rn===ei&&ie(vr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ie(en>0&&en+dn<=ar.framebufferWidth,"invalid width for read pixels"),ie(Lt>0&&Lt+Hr<=ar.framebufferHeight,"invalid height for read pixels"),$e();var Xr=en*Lt*4;return vr||(rn===Qr?vr=new Uint8Array(Xr):rn===ei&&(vr=vr||new Float32Array(Xr))),ie.isTypedArray(vr,"data buffer for regl.read() must be a typedarray"),ie(vr.byteLength>=Xr,"data buffer for regl.read() too small"),V.pixelStorei(Pn,4),V.readPixels(dn,Hr,en,Lt,on,rn,vr),vr}function Vr($r){var rn;return Me.setFBO({framebuffer:$r.framebuffer},function(){rn=Fr($r)}),rn}function Kr($r){return!$r||!("framebuffer"in $r)?Fr($r):Vr($r)}return Kr}function ti(V){return Array.prototype.slice.call(V)}function aa(V){return ti(V).join("")}function jn(){var V=0,Me=[],$e=[];function ar(rn){for(var dn=0;dn<$e.length;++dn)if($e[dn]===rn)return Me[dn];var Hr="g"+V++;return Me.push(Hr),$e.push(rn),Hr}function Pr(){var rn=[];function dn(){rn.push.apply(rn,ti(arguments))}var Hr=[];function en(){var Lt="v"+V++;return Hr.push(Lt),arguments.length>0&&(rn.push(Lt,"="),rn.push.apply(rn,ti(arguments)),rn.push(";")),Lt}return p(dn,{def:en,toString:function(){return aa([Hr.length>0?"var "+Hr.join(",")+";":"",aa(rn)])}})}function rr(){var rn=Pr(),dn=Pr(),Hr=rn.toString,en=dn.toString;function Lt(vr,Xr){dn(vr,Xr,"=",rn.def(vr,Xr),";")}return p(function(){rn.apply(rn,ti(arguments))},{def:rn.def,entry:rn,exit:dn,save:Lt,set:function(vr,Xr,On){Lt(vr,Xr),rn(vr,Xr,"=",On,";")},toString:function(){return Hr()+en()}})}function Cr(){var rn=aa(arguments),dn=rr(),Hr=rr(),en=dn.toString,Lt=Hr.toString;return p(dn,{then:function(){return dn.apply(dn,ti(arguments)),this},else:function(){return Hr.apply(Hr,ti(arguments)),this},toString:function(){var vr=Lt();return vr&&(vr="else{"+vr+"}"),aa(["if(",rn,"){",en(),"}",vr])}})}var Fr=Pr(),Vr={};function Kr(rn,dn){var Hr=[];function en(){var wr="a"+Hr.length;return Hr.push(wr),wr}dn=dn||0;for(var Lt=0;Lt<dn;++Lt)en();var vr=rr(),Xr=vr.toString,On=Vr[rn]=p(vr,{arg:en,toString:function(){return aa(["function(",Hr.join(),"){",Xr(),"}"])}});return On}function $r(){var rn=['"use strict";',Fr,"return {"];Object.keys(Vr).forEach(function(Lt){rn.push('"',Lt,'":',Vr[Lt].toString(),",")}),rn.push("}");var dn=aa(rn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Hr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",en=Hr?ue.Function.apply(null,Me.concat(dn)):Function.apply(null,Me.concat(dn));return en.apply(null,$e)}return{global:Fr,link:ar,block:Pr,proc:Kr,scope:rr,cond:Cr,compile:$r}}var xi="xyzw".split(""),zi=5121,J=1,Q=2,D=0,k=1,te=2,Ce=3,st=4,Bt=5,bt=6,Kt="dither",Ir="blend.enable",Fn="blend.color",Nn="blend.equation",fi="blend.func",si="depth.enable",yi="depth.func",Hi="depth.range",ya="depth.mask",_a="colorMask",Ka="cull.enable",Ba="cull.face",wo="frontFace",La="lineWidth",Sa="polygonOffset.enable",la="polygonOffset.offset",va="sample.alpha",Ga="sample.enable",Na="sample.coverage",ko="stencil.enable",Ui="stencil.mask",$o="stencil.func",Po="stencil.opFront",Ao="stencil.opBack",Tc="scissor.enable",ku="scissor.box",$u="viewport",Ju="profile",Ll="framebuffer",Qu="vert",dl="frag",Rl="elements",xu="primitive",Mo="count",Ff="offset",Dl="instances",of="vao",xf="Width",bf="Height",kl=Ll+xf,Fl=Ll+bf,Ph=$u+xf,Bf=$u+bf,Nf="drawingBuffer",ss=Nf+xf,sf=Nf+bf,sp=[fi,Nn,$o,Po,Ao,Na,$u,ku,la],uf=34962,lc=34963,up=35632,zp=35633,lp=3553,Up=34067,Mh=2884,Zp=3042,Sf=3024,cp=2960,jo=2929,Ef=3089,lh=32823,Cf=32926,zf=32928,Pc=5126,Uf=35664,wf=35665,Mc=35666,Zf=5124,Af=35667,ch=35668,Vc=35669,Ih=35670,cc=35671,fh=35672,lf=35673,cf=35674,ou=35675,jf=35676,Vf=35678,ff=35680,Oh=4,fc=1028,vl=1029,Lh=2304,Rh=2305,Dh=32775,fp=32776,jp=519,Gc=7680,Ic=0,hh=1,Gf=32774,hf=513,qu=36160,hp=36064,Bl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},kh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ml={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Nl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ph={frag:up,vert:zp},dh={cw:Lh,ccw:Rh};function Hf(V){return Array.isArray(V)||C(V)||ct(V)}function Fh(V){return V.sort(function(Me,$e){return Me===$u?-1:$e===$u?1:Me<$e?-1:1})}function us(V,Me,$e,ar){this.thisDep=V,this.contextDep=Me,this.propDep=$e,this.append=ar}function Vo(V){return V&&!(V.thisDep||V.contextDep||V.propDep)}function ls(V){return new us(!1,!1,!1,V)}function su(V,Me){var $e=V.type;if($e===D){var ar=V.data.length;return new us(!0,ar>=1,ar>=2,Me)}else if($e===st){var Pr=V.data;return new us(Pr.thisDep,Pr.contextDep,Pr.propDep,Me)}else{if($e===Bt)return new us(!1,!1,!1,Me);if($e===bt){for(var rr=!1,Cr=!1,Fr=!1,Vr=0;Vr<V.data.length;++Vr){var Kr=V.data[Vr];if(Kr.type===k)Fr=!0;else if(Kr.type===te)Cr=!0;else if(Kr.type===Ce)rr=!0;else if(Kr.type===D){rr=!0;var $r=Kr.data;$r>=1&&(Cr=!0),$r>=2&&(Fr=!0)}else Kr.type===st&&(rr=rr||Kr.data.thisDep,Cr=Cr||Kr.data.contextDep,Fr=Fr||Kr.data.propDep)}return new us(rr,Cr,Fr,Me)}else return new us($e===Ce,$e===te,$e===k,Me)}}var Wf=new us(!1,!1,!1,function(){});function Bh(V,Me,$e,ar,Pr,rr,Cr,Fr,Vr,Kr,$r,rn,dn,Hr,en){var Lt=Kr.Record,vr={add:32774,subtract:32778,"reverse subtract":32779};$e.ext_blend_minmax&&(vr.min=Dh,vr.max=fp);var Xr=$e.angle_instanced_arrays,On=$e.webgl_draw_buffers,wr=$e.oes_vertex_array_object,bn={dirty:!0,profile:en.profile},tn={},ui=[],Tr={},Sr={};function Xn(ke){return ke.replace(".","_")}function yn(ke,Se,ot){var Rt=Xn(ke);ui.push(ke),tn[Rt]=bn[Rt]=!!ot,Tr[Rt]=Se}function Yr(ke,Se,ot){var Rt=Xn(ke);ui.push(ke),Array.isArray(ot)?(bn[Rt]=ot.slice(),tn[Rt]=ot.slice()):bn[Rt]=tn[Rt]=ot,Sr[Rt]=Se}yn(Kt,Sf),yn(Ir,Zp),Yr(Fn,"blendColor",[0,0,0,0]),Yr(Nn,"blendEquationSeparate",[Gf,Gf]),Yr(fi,"blendFuncSeparate",[hh,Ic,hh,Ic]),yn(si,jo,!0),Yr(yi,"depthFunc",hf),Yr(Hi,"depthRange",[0,1]),Yr(ya,"depthMask",!0),Yr(_a,_a,[!0,!0,!0,!0]),yn(Ka,Mh),Yr(Ba,"cullFace",vl),Yr(wo,wo,Rh),Yr(La,La,1),yn(Sa,lh),Yr(la,"polygonOffset",[0,0]),yn(va,Cf),yn(Ga,zf),Yr(Na,"sampleCoverage",[1,!1]),yn(ko,cp),Yr(Ui,"stencilMask",-1),Yr($o,"stencilFunc",[jp,0,-1]),Yr(Po,"stencilOpSeparate",[fc,Gc,Gc,Gc]),Yr(Ao,"stencilOpSeparate",[vl,Gc,Gc,Gc]),yn(Tc,Ef),Yr(ku,"scissor",[0,0,V.drawingBufferWidth,V.drawingBufferHeight]),Yr($u,$u,[0,0,V.drawingBufferWidth,V.drawingBufferHeight]);var An={gl:V,context:dn,strings:Me,next:tn,current:bn,draw:rn,elements:rr,buffer:Pr,shader:$r,attributes:Kr.state,vao:Kr,uniforms:Vr,framebuffer:Fr,extensions:$e,timer:Hr,isBufferArgs:Hf},Sn={primTypes:Ar,compareFuncs:ml,blendFuncs:Bl,blendEquations:vr,stencilOps:Nl,glTypes:Rs,orientationType:dh};ie.optional(function(){An.isArrayLike=za}),On&&(Sn.backBuffer=[vl],Sn.drawBuffer=de(ar.maxDrawbuffers,function(ke){return ke===0?[0]:de(ke,function(Se){return hp+Se})}));var Zi=0;function Oi(){var ke=jn(),Se=ke.link,ot=ke.global;ke.id=Zi++,ke.batchId="0";var Rt=Se(An),or=ke.shared={props:"a0"};Object.keys(An).forEach(function(Qe){or[Qe]=ot.def(Rt,".",Qe)}),ie.optional(function(){ke.CHECK=Se(ie),ke.commandStr=ie.guessCommand(),ke.command=Se(ke.commandStr),ke.assert=function(Qe,Fe,kt){Qe("if(!(",Fe,"))",this.CHECK,".commandRaise(",Se(kt),",",this.command,");")},Sn.invalidBlendCombinations=kh});var vt=ke.next={},ft=ke.current={};Object.keys(Sr).forEach(function(Qe){Array.isArray(bn[Qe])&&(vt[Qe]=ot.def(or.next,".",Qe),ft[Qe]=ot.def(or.current,".",Qe))});var nt=ke.constants={};Object.keys(Sn).forEach(function(Qe){nt[Qe]=ot.def(JSON.stringify(Sn[Qe]))}),ke.invoke=function(Qe,Fe){switch(Fe.type){case D:var kt=["this",or.context,or.props,ke.batchId];return Qe.def(Se(Fe.data),".call(",kt.slice(0,Math.max(Fe.data.length+1,4)),")");case k:return Qe.def(or.props,Fe.data);case te:return Qe.def(or.context,Fe.data);case Ce:return Qe.def("this",Fe.data);case st:return Fe.data.append(ke,Qe),Fe.data.ref;case Bt:return Fe.data.toString();case bt:return Fe.data.map(function(Wt){return ke.invoke(Qe,Wt)})}},ke.attribCache={};var Oe={};return ke.scopeAttrib=function(Qe){var Fe=Me.id(Qe);if(Fe in Oe)return Oe[Fe];var kt=Kr.scope[Fe];kt||(kt=Kr.scope[Fe]=new Lt);var Wt=Oe[Fe]=Se(kt);return Wt},ke}function Tn(ke){var Se=ke.static,ot=ke.dynamic,Rt;if(Ju in Se){var or=!!Se[Ju];Rt=ls(function(ft,nt){return or}),Rt.enable=or}else if(Ju in ot){var vt=ot[Ju];Rt=su(vt,function(ft,nt){return ft.invoke(nt,vt)})}return Rt}function En(ke,Se){var ot=ke.static,Rt=ke.dynamic;if(Ll in ot){var or=ot[Ll];return or?(or=Fr.getFramebuffer(or),ie.command(or,"invalid framebuffer object"),ls(function(ft,nt){var Oe=ft.link(or),Qe=ft.shared;nt.set(Qe.framebuffer,".next",Oe);var Fe=Qe.context;return nt.set(Fe,"."+kl,Oe+".width"),nt.set(Fe,"."+Fl,Oe+".height"),Oe})):ls(function(ft,nt){var Oe=ft.shared;nt.set(Oe.framebuffer,".next","null");var Qe=Oe.context;return nt.set(Qe,"."+kl,Qe+"."+ss),nt.set(Qe,"."+Fl,Qe+"."+sf),"null"})}else if(Ll in Rt){var vt=Rt[Ll];return su(vt,function(ft,nt){var Oe=ft.invoke(nt,vt),Qe=ft.shared,Fe=Qe.framebuffer,kt=nt.def(Fe,".getFramebuffer(",Oe,")");ie.optional(function(){ft.assert(nt,"!"+Oe+"||"+kt,"invalid framebuffer object")}),nt.set(Fe,".next",kt);var Wt=Qe.context;return nt.set(Wt,"."+kl,kt+"?"+kt+".width:"+Wt+"."+ss),nt.set(Wt,"."+Fl,kt+"?"+kt+".height:"+Wt+"."+sf),kt})}else return null}function bi(ke,Se,ot){var Rt=ke.static,or=ke.dynamic;function vt(Oe){if(Oe in Rt){var Qe=Rt[Oe];ie.commandType(Qe,"object","invalid "+Oe,ot.commandStr);var Fe=!0,kt=Qe.x|0,Wt=Qe.y|0,Br,un;return"width"in Qe?(Br=Qe.width|0,ie.command(Br>=0,"invalid "+Oe,ot.commandStr)):Fe=!1,"height"in Qe?(un=Qe.height|0,ie.command(un>=0,"invalid "+Oe,ot.commandStr)):Fe=!1,new us(!Fe&&Se&&Se.thisDep,!Fe&&Se&&Se.contextDep,!Fe&&Se&&Se.propDep,function(ln,Hn){var Rn=ln.shared.context,Yn=Br;"width"in Qe||(Yn=Hn.def(Rn,".",kl,"-",kt));var Vn=un;return"height"in Qe||(Vn=Hn.def(Rn,".",Fl,"-",Wt)),[kt,Wt,Yn,Vn]})}else if(Oe in or){var fn=or[Oe],Mn=su(fn,function(ln,Hn){var Rn=ln.invoke(Hn,fn);ie.optional(function(){ln.assert(Hn,Rn+"&&typeof "+Rn+'==="object"',"invalid "+Oe)});var Yn=ln.shared.context,Vn=Hn.def(Rn,".x|0"),Un=Hn.def(Rn,".y|0"),di=Hn.def('"width" in ',Rn,"?",Rn,".width|0:","(",Yn,".",kl,"-",Vn,")"),Qa=Hn.def('"height" in ',Rn,"?",Rn,".height|0:","(",Yn,".",Fl,"-",Un,")");return ie.optional(function(){ln.assert(Hn,di+">=0&&"+Qa+">=0","invalid "+Oe)}),[Vn,Un,di,Qa]});return Se&&(Mn.thisDep=Mn.thisDep||Se.thisDep,Mn.contextDep=Mn.contextDep||Se.contextDep,Mn.propDep=Mn.propDep||Se.propDep),Mn}else return Se?new us(Se.thisDep,Se.contextDep,Se.propDep,function(ln,Hn){var Rn=ln.shared.context;return[0,0,Hn.def(Rn,".",kl),Hn.def(Rn,".",Fl)]}):null}var ft=vt($u);if(ft){var nt=ft;ft=new us(ft.thisDep,ft.contextDep,ft.propDep,function(Oe,Qe){var Fe=nt.append(Oe,Qe),kt=Oe.shared.context;return Qe.set(kt,"."+Ph,Fe[2]),Qe.set(kt,"."+Bf,Fe[3]),Fe})}return{viewport:ft,scissor_box:vt(ku)}}function Li(ke,Se){var ot=ke.static,Rt=typeof ot[dl]=="string"&&typeof ot[Qu]=="string";if(Rt){if(Object.keys(Se.dynamic).length>0)return null;var or=Se.static,vt=Object.keys(or);if(vt.length>0&&typeof or[vt[0]]=="number"){for(var ft=[],nt=0;nt<vt.length;++nt)ie(typeof or[vt[nt]]=="number","must specify all vertex attribute locations when using vaos"),ft.push([or[vt[nt]]|0,vt[nt]]);return ft}}return null}function qi(ke,Se,ot){var Rt=ke.static,or=ke.dynamic;function vt(Fe){if(Fe in Rt){var kt=Me.id(Rt[Fe]);ie.optional(function(){$r.shader(ph[Fe],kt,ie.guessCommand())});var Wt=ls(function(){return kt});return Wt.id=kt,Wt}else if(Fe in or){var Br=or[Fe];return su(Br,function(un,fn){var Mn=un.invoke(fn,Br),ln=fn.def(un.shared.strings,".id(",Mn,")");return ie.optional(function(){fn(un.shared.shader,".shader(",ph[Fe],",",ln,",",un.command,");")}),ln})}return null}var ft=vt(dl),nt=vt(Qu),Oe=null,Qe;return Vo(ft)&&Vo(nt)?(Oe=$r.program(nt.id,ft.id,null,ot),Qe=ls(function(Fe,kt){return Fe.link(Oe)})):Qe=new us(ft&&ft.thisDep||nt&&nt.thisDep,ft&&ft.contextDep||nt&&nt.contextDep,ft&&ft.propDep||nt&&nt.propDep,function(Fe,kt){var Wt=Fe.shared.shader,Br;ft?Br=ft.append(Fe,kt):Br=kt.def(Wt,".",dl);var un;nt?un=nt.append(Fe,kt):un=kt.def(Wt,".",Qu);var fn=Wt+".program("+un+","+Br;return ie.optional(function(){fn+=","+Fe.command}),kt.def(fn+")")}),{frag:ft,vert:nt,progVar:Qe,program:Oe}}function yo(ke,Se){var ot=ke.static,Rt=ke.dynamic,or={},vt=!1;function ft(){if(of in ot){var Hn=ot[of];return Hn!==null&&Kr.getVAO(Hn)===null&&(Hn=Kr.createVAO(Hn)),vt=!0,or.vao=Hn,ls(function(Yn){var Vn=Kr.getVAO(Hn);return Vn?Yn.link(Vn):"null"})}else if(of in Rt){vt=!0;var Rn=Rt[of];return su(Rn,function(Yn,Vn){var Un=Yn.invoke(Vn,Rn);return Vn.def(Yn.shared.vao+".getVAO("+Un+")")})}return null}var nt=ft(),Oe=!1;function Qe(){if(Rl in ot){var Hn=ot[Rl];if(or.elements=Hn,Hf(Hn)){var Rn=or.elements=rr.create(Hn,!0);Hn=rr.getElements(Rn),Oe=!0}else Hn&&(Hn=rr.getElements(Hn),Oe=!0,ie.command(Hn,"invalid elements",Se.commandStr));var Yn=ls(function(Un,di){if(Hn){var Qa=Un.link(Hn);return Un.ELEMENTS=Qa,Qa}return Un.ELEMENTS=null,null});return Yn.value=Hn,Yn}else if(Rl in Rt){Oe=!0;var Vn=Rt[Rl];return su(Vn,function(Un,di){var Qa=Un.shared,Ho=Qa.isBufferArgs,zl=Qa.elements,qa=Un.invoke(di,Vn),Ra=di.def("null"),ks=di.def(Ho,"(",qa,")"),el=Un.cond(ks).then(Ra,"=",zl,".createStream(",qa,");").else(Ra,"=",zl,".getElements(",qa,");");return ie.optional(function(){Un.assert(el.else,"!"+qa+"||"+Ra,"invalid elements")}),di.entry(el),di.exit(Un.cond(ks).then(zl,".destroyStream(",Ra,");")),Un.ELEMENTS=Ra,Ra})}else if(vt)return new us(nt.thisDep,nt.contextDep,nt.propDep,function(Un,di){return di.def(Un.shared.vao+".currentVAO?"+Un.shared.elements+".getElements("+Un.shared.vao+".currentVAO.elements):null")});return null}var Fe=Qe();function kt(){if(xu in ot){var Hn=ot[xu];return or.primitive=Hn,ie.commandParameter(Hn,Ar,"invalid primitve",Se.commandStr),ls(function(Yn,Vn){return Ar[Hn]})}else if(xu in Rt){var Rn=Rt[xu];return su(Rn,function(Yn,Vn){var Un=Yn.constants.primTypes,di=Yn.invoke(Vn,Rn);return ie.optional(function(){Yn.assert(Vn,di+" in "+Un,"invalid primitive, must be one of "+Object.keys(Ar))}),Vn.def(Un,"[",di,"]")})}else{if(Oe)return Vo(Fe)?Fe.value?ls(function(Yn,Vn){return Vn.def(Yn.ELEMENTS,".primType")}):ls(function(){return Oh}):new us(Fe.thisDep,Fe.contextDep,Fe.propDep,function(Yn,Vn){var Un=Yn.ELEMENTS;return Vn.def(Un,"?",Un,".primType:",Oh)});if(vt)return new us(nt.thisDep,nt.contextDep,nt.propDep,function(Yn,Vn){return Vn.def(Yn.shared.vao+".currentVAO?"+Yn.shared.vao+".currentVAO.primitive:"+Oh)})}return null}function Wt(Hn,Rn){if(Hn in ot){var Yn=ot[Hn]|0;return Rn?or.offset=Yn:or.instances=Yn,ie.command(!Rn||Yn>=0,"invalid "+Hn,Se.commandStr),ls(function(Un,di){return Rn&&(Un.OFFSET=Yn),Yn})}else if(Hn in Rt){var Vn=Rt[Hn];return su(Vn,function(Un,di){var Qa=Un.invoke(di,Vn);return Rn&&(Un.OFFSET=Qa,ie.optional(function(){Un.assert(di,Qa+">=0","invalid "+Hn)})),Qa})}else if(Rn){if(Oe)return ls(function(Un,di){return Un.OFFSET=0,0});if(vt)return new us(nt.thisDep,nt.contextDep,nt.propDep,function(Un,di){return di.def(Un.shared.vao+".currentVAO?"+Un.shared.vao+".currentVAO.offset:0")})}else if(vt)return new us(nt.thisDep,nt.contextDep,nt.propDep,function(Un,di){return di.def(Un.shared.vao+".currentVAO?"+Un.shared.vao+".currentVAO.instances:-1")});return null}var Br=Wt(Ff,!0);function un(){if(Mo in ot){var Hn=ot[Mo]|0;return or.count=Hn,ie.command(typeof Hn=="number"&&Hn>=0,"invalid vertex count",Se.commandStr),ls(function(){return Hn})}else if(Mo in Rt){var Rn=Rt[Mo];return su(Rn,function(di,Qa){var Ho=di.invoke(Qa,Rn);return ie.optional(function(){di.assert(Qa,"typeof "+Ho+'==="number"&&'+Ho+">=0&&"+Ho+"===("+Ho+"|0)","invalid vertex count")}),Ho})}else if(Oe)if(Vo(Fe)){if(Fe)return Br?new us(Br.thisDep,Br.contextDep,Br.propDep,function(di,Qa){var Ho=Qa.def(di.ELEMENTS,".vertCount-",di.OFFSET);return ie.optional(function(){di.assert(Qa,Ho+">=0","invalid vertex offset/element buffer too small")}),Ho}):ls(function(di,Qa){return Qa.def(di.ELEMENTS,".vertCount")});var Yn=ls(function(){return-1});return ie.optional(function(){Yn.MISSING=!0}),Yn}else{var Vn=new us(Fe.thisDep||Br.thisDep,Fe.contextDep||Br.contextDep,Fe.propDep||Br.propDep,function(di,Qa){var Ho=di.ELEMENTS;return di.OFFSET?Qa.def(Ho,"?",Ho,".vertCount-",di.OFFSET,":-1"):Qa.def(Ho,"?",Ho,".vertCount:-1")});return ie.optional(function(){Vn.DYNAMIC=!0}),Vn}else if(vt){var Un=new us(nt.thisDep,nt.contextDep,nt.propDep,function(di,Qa){return Qa.def(di.shared.vao,".currentVAO?",di.shared.vao,".currentVAO.count:-1")});return Un}return null}var fn=kt(),Mn=un(),ln=Wt(Dl,!1);return{elements:Fe,primitive:fn,count:Mn,instances:ln,offset:Br,vao:nt,vaoActive:vt,elementsActive:Oe,static:or}}function Fo(ke,Se){var ot=ke.static,Rt=ke.dynamic,or={};return ui.forEach(function(vt){var ft=Xn(vt);function nt(Oe,Qe){if(vt in ot){var Fe=Oe(ot[vt]);or[ft]=ls(function(){return Fe})}else if(vt in Rt){var kt=Rt[vt];or[ft]=su(kt,function(Wt,Br){return Qe(Wt,Br,Wt.invoke(Br,kt))})}}switch(vt){case Ka:case Ir:case Kt:case ko:case si:case Tc:case Sa:case va:case Ga:case ya:return nt(function(Oe){return ie.commandType(Oe,"boolean",vt,Se.commandStr),Oe},function(Oe,Qe,Fe){return ie.optional(function(){Oe.assert(Qe,"typeof "+Fe+'==="boolean"',"invalid flag "+vt,Oe.commandStr)}),Fe});case yi:return nt(function(Oe){return ie.commandParameter(Oe,ml,"invalid "+vt,Se.commandStr),ml[Oe]},function(Oe,Qe,Fe){var kt=Oe.constants.compareFuncs;return ie.optional(function(){Oe.assert(Qe,Fe+" in "+kt,"invalid "+vt+", must be one of "+Object.keys(ml))}),Qe.def(kt,"[",Fe,"]")});case Hi:return nt(function(Oe){return ie.command(za(Oe)&&Oe.length===2&&typeof Oe[0]=="number"&&typeof Oe[1]=="number"&&Oe[0]<=Oe[1],"depth range is 2d array",Se.commandStr),Oe},function(Oe,Qe,Fe){ie.optional(function(){Oe.assert(Qe,Oe.shared.isArrayLike+"("+Fe+")&&"+Fe+".length===2&&typeof "+Fe+'[0]==="number"&&typeof '+Fe+'[1]==="number"&&'+Fe+"[0]<="+Fe+"[1]","depth range must be a 2d array")});var kt=Qe.def("+",Fe,"[0]"),Wt=Qe.def("+",Fe,"[1]");return[kt,Wt]});case fi:return nt(function(Oe){ie.commandType(Oe,"object","blend.func",Se.commandStr);var Qe="srcRGB"in Oe?Oe.srcRGB:Oe.src,Fe="srcAlpha"in Oe?Oe.srcAlpha:Oe.src,kt="dstRGB"in Oe?Oe.dstRGB:Oe.dst,Wt="dstAlpha"in Oe?Oe.dstAlpha:Oe.dst;return ie.commandParameter(Qe,Bl,ft+".srcRGB",Se.commandStr),ie.commandParameter(Fe,Bl,ft+".srcAlpha",Se.commandStr),ie.commandParameter(kt,Bl,ft+".dstRGB",Se.commandStr),ie.commandParameter(Wt,Bl,ft+".dstAlpha",Se.commandStr),ie.command(kh.indexOf(Qe+", "+kt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Qe+", "+kt+")",Se.commandStr),[Bl[Qe],Bl[kt],Bl[Fe],Bl[Wt]]},function(Oe,Qe,Fe){var kt=Oe.constants.blendFuncs;ie.optional(function(){Oe.assert(Qe,Fe+"&&typeof "+Fe+'==="object"',"invalid blend func, must be an object")});function Wt(Rn,Yn){var Vn=Qe.def('"',Rn,Yn,'" in ',Fe,"?",Fe,".",Rn,Yn,":",Fe,".",Rn);return ie.optional(function(){Oe.assert(Qe,Vn+" in "+kt,"invalid "+vt+"."+Rn+Yn+", must be one of "+Object.keys(Bl))}),Vn}var Br=Wt("src","RGB"),un=Wt("dst","RGB");ie.optional(function(){var Rn=Oe.constants.invalidBlendCombinations;Oe.assert(Qe,Rn+".indexOf("+Br+'+", "+'+un+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var fn=Qe.def(kt,"[",Br,"]"),Mn=Qe.def(kt,"[",Wt("src","Alpha"),"]"),ln=Qe.def(kt,"[",un,"]"),Hn=Qe.def(kt,"[",Wt("dst","Alpha"),"]");return[fn,ln,Mn,Hn]});case Nn:return nt(function(Oe){if(typeof Oe=="string")return ie.commandParameter(Oe,vr,"invalid "+vt,Se.commandStr),[vr[Oe],vr[Oe]];if(typeof Oe=="object")return ie.commandParameter(Oe.rgb,vr,vt+".rgb",Se.commandStr),ie.commandParameter(Oe.alpha,vr,vt+".alpha",Se.commandStr),[vr[Oe.rgb],vr[Oe.alpha]];ie.commandRaise("invalid blend.equation",Se.commandStr)},function(Oe,Qe,Fe){var kt=Oe.constants.blendEquations,Wt=Qe.def(),Br=Qe.def(),un=Oe.cond("typeof ",Fe,'==="string"');return ie.optional(function(){function fn(Mn,ln,Hn){Oe.assert(Mn,Hn+" in "+kt,"invalid "+ln+", must be one of "+Object.keys(vr))}fn(un.then,vt,Fe),Oe.assert(un.else,Fe+"&&typeof "+Fe+'==="object"',"invalid "+vt),fn(un.else,vt+".rgb",Fe+".rgb"),fn(un.else,vt+".alpha",Fe+".alpha")}),un.then(Wt,"=",Br,"=",kt,"[",Fe,"];"),un.else(Wt,"=",kt,"[",Fe,".rgb];",Br,"=",kt,"[",Fe,".alpha];"),Qe(un),[Wt,Br]});case Fn:return nt(function(Oe){return ie.command(za(Oe)&&Oe.length===4,"blend.color must be a 4d array",Se.commandStr),de(4,function(Qe){return+Oe[Qe]})},function(Oe,Qe,Fe){return ie.optional(function(){Oe.assert(Qe,Oe.shared.isArrayLike+"("+Fe+")&&"+Fe+".length===4","blend.color must be a 4d array")}),de(4,function(kt){return Qe.def("+",Fe,"[",kt,"]")})});case Ui:return nt(function(Oe){return ie.commandType(Oe,"number",ft,Se.commandStr),Oe|0},function(Oe,Qe,Fe){return ie.optional(function(){Oe.assert(Qe,"typeof "+Fe+'==="number"',"invalid stencil.mask")}),Qe.def(Fe,"|0")});case $o:return nt(function(Oe){ie.commandType(Oe,"object",ft,Se.commandStr);var Qe=Oe.cmp||"keep",Fe=Oe.ref||0,kt="mask"in Oe?Oe.mask:-1;return ie.commandParameter(Qe,ml,vt+".cmp",Se.commandStr),ie.commandType(Fe,"number",vt+".ref",Se.commandStr),ie.commandType(kt,"number",vt+".mask",Se.commandStr),[ml[Qe],Fe,kt]},function(Oe,Qe,Fe){var kt=Oe.constants.compareFuncs;ie.optional(function(){function fn(){Oe.assert(Qe,Array.prototype.join.call(arguments,""),"invalid stencil.func")}fn(Fe+"&&typeof ",Fe,'==="object"'),fn('!("cmp" in ',Fe,")||(",Fe,".cmp in ",kt,")")});var Wt=Qe.def('"cmp" in ',Fe,"?",kt,"[",Fe,".cmp]",":",Gc),Br=Qe.def(Fe,".ref|0"),un=Qe.def('"mask" in ',Fe,"?",Fe,".mask|0:-1");return[Wt,Br,un]});case Po:case Ao:return nt(function(Oe){ie.commandType(Oe,"object",ft,Se.commandStr);var Qe=Oe.fail||"keep",Fe=Oe.zfail||"keep",kt=Oe.zpass||"keep";return ie.commandParameter(Qe,Nl,vt+".fail",Se.commandStr),ie.commandParameter(Fe,Nl,vt+".zfail",Se.commandStr),ie.commandParameter(kt,Nl,vt+".zpass",Se.commandStr),[vt===Ao?vl:fc,Nl[Qe],Nl[Fe],Nl[kt]]},function(Oe,Qe,Fe){var kt=Oe.constants.stencilOps;ie.optional(function(){Oe.assert(Qe,Fe+"&&typeof "+Fe+'==="object"',"invalid "+vt)});function Wt(Br){return ie.optional(function(){Oe.assert(Qe,'!("'+Br+'" in '+Fe+")||("+Fe+"."+Br+" in "+kt+")","invalid "+vt+"."+Br+", must be one of "+Object.keys(Nl))}),Qe.def('"',Br,'" in ',Fe,"?",kt,"[",Fe,".",Br,"]:",Gc)}return[vt===Ao?vl:fc,Wt("fail"),Wt("zfail"),Wt("zpass")]});case la:return nt(function(Oe){ie.commandType(Oe,"object",ft,Se.commandStr);var Qe=Oe.factor|0,Fe=Oe.units|0;return ie.commandType(Qe,"number",ft+".factor",Se.commandStr),ie.commandType(Fe,"number",ft+".units",Se.commandStr),[Qe,Fe]},function(Oe,Qe,Fe){ie.optional(function(){Oe.assert(Qe,Fe+"&&typeof "+Fe+'==="object"',"invalid "+vt)});var kt=Qe.def(Fe,".factor|0"),Wt=Qe.def(Fe,".units|0");return[kt,Wt]});case Ba:return nt(function(Oe){var Qe=0;return Oe==="front"?Qe=fc:Oe==="back"&&(Qe=vl),ie.command(!!Qe,ft,Se.commandStr),Qe},function(Oe,Qe,Fe){return ie.optional(function(){Oe.assert(Qe,Fe+'==="front"||'+Fe+'==="back"',"invalid cull.face")}),Qe.def(Fe,'==="front"?',fc,":",vl)});case La:return nt(function(Oe){return ie.command(typeof Oe=="number"&&Oe>=ar.lineWidthDims[0]&&Oe<=ar.lineWidthDims[1],"invalid line width, must be a positive number between "+ar.lineWidthDims[0]+" and "+ar.lineWidthDims[1],Se.commandStr),Oe},function(Oe,Qe,Fe){return ie.optional(function(){Oe.assert(Qe,"typeof "+Fe+'==="number"&&'+Fe+">="+ar.lineWidthDims[0]+"&&"+Fe+"<="+ar.lineWidthDims[1],"invalid line width")}),Fe});case wo:return nt(function(Oe){return ie.commandParameter(Oe,dh,ft,Se.commandStr),dh[Oe]},function(Oe,Qe,Fe){return ie.optional(function(){Oe.assert(Qe,Fe+'==="cw"||'+Fe+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Qe.def(Fe+'==="cw"?'+Lh+":"+Rh)});case _a:return nt(function(Oe){return ie.command(za(Oe)&&Oe.length===4,"color.mask must be length 4 array",Se.commandStr),Oe.map(function(Qe){return!!Qe})},function(Oe,Qe,Fe){return ie.optional(function(){Oe.assert(Qe,Oe.shared.isArrayLike+"("+Fe+")&&"+Fe+".length===4","invalid color.mask")}),de(4,function(kt){return"!!"+Fe+"["+kt+"]"})});case Na:return nt(function(Oe){ie.command(typeof Oe=="object"&&Oe,ft,Se.commandStr);var Qe="value"in Oe?Oe.value:1,Fe=!!Oe.invert;return ie.command(typeof Qe=="number"&&Qe>=0&&Qe<=1,"sample.coverage.value must be a number between 0 and 1",Se.commandStr),[Qe,Fe]},function(Oe,Qe,Fe){ie.optional(function(){Oe.assert(Qe,Fe+"&&typeof "+Fe+'==="object"',"invalid sample.coverage")});var kt=Qe.def('"value" in ',Fe,"?+",Fe,".value:1"),Wt=Qe.def("!!",Fe,".invert");return[kt,Wt]})}}),or}function pa(ke,Se){var ot=ke.static,Rt=ke.dynamic,or={};return Object.keys(ot).forEach(function(vt){var ft=ot[vt],nt;if(typeof ft=="number"||typeof ft=="boolean")nt=ls(function(){return ft});else if(typeof ft=="function"){var Oe=ft._reglType;Oe==="texture2d"||Oe==="textureCube"?nt=ls(function(Qe){return Qe.link(ft)}):Oe==="framebuffer"||Oe==="framebufferCube"?(ie.command(ft.color.length>0,'missing color attachment for framebuffer sent to uniform "'+vt+'"',Se.commandStr),nt=ls(function(Qe){return Qe.link(ft.color[0])})):ie.commandRaise('invalid data for uniform "'+vt+'"',Se.commandStr)}else za(ft)?nt=ls(function(Qe){var Fe=Qe.global.def("[",de(ft.length,function(kt){return ie.command(typeof ft[kt]=="number"||typeof ft[kt]=="boolean","invalid uniform "+vt,Qe.commandStr),ft[kt]}),"]");return Fe}):ie.commandRaise('invalid or missing data for uniform "'+vt+'"',Se.commandStr);nt.value=ft,or[vt]=nt}),Object.keys(Rt).forEach(function(vt){var ft=Rt[vt];or[vt]=su(ft,function(nt,Oe){return nt.invoke(Oe,ft)})}),or}function ys(ke,Se){var ot=ke.static,Rt=ke.dynamic,or={};return Object.keys(ot).forEach(function(vt){var ft=ot[vt],nt=Me.id(vt),Oe=new Lt;if(Hf(ft))Oe.state=J,Oe.buffer=Pr.getBuffer(Pr.create(ft,uf,!1,!0)),Oe.type=0;else{var Qe=Pr.getBuffer(ft);if(Qe)Oe.state=J,Oe.buffer=Qe,Oe.type=0;else if(ie.command(typeof ft=="object"&&ft,"invalid data for attribute "+vt,Se.commandStr),"constant"in ft){var Fe=ft.constant;Oe.buffer="null",Oe.state=Q,typeof Fe=="number"?Oe.x=Fe:(ie.command(za(Fe)&&Fe.length>0&&Fe.length<=4,"invalid constant for attribute "+vt,Se.commandStr),xi.forEach(function(ln,Hn){Hn<Fe.length&&(Oe[ln]=Fe[Hn])}))}else{Hf(ft.buffer)?Qe=Pr.getBuffer(Pr.create(ft.buffer,uf,!1,!0)):Qe=Pr.getBuffer(ft.buffer),ie.command(!!Qe,'missing buffer for attribute "'+vt+'"',Se.commandStr);var kt=ft.offset|0;ie.command(kt>=0,'invalid offset for attribute "'+vt+'"',Se.commandStr);var Wt=ft.stride|0;ie.command(Wt>=0&&Wt<256,'invalid stride for attribute "'+vt+'", must be integer betweeen [0, 255]',Se.commandStr);var Br=ft.size|0;ie.command(!("size"in ft)||Br>0&&Br<=4,'invalid size for attribute "'+vt+'", must be 1,2,3,4',Se.commandStr);var un=!!ft.normalized,fn=0;"type"in ft&&(ie.commandParameter(ft.type,Rs,"invalid type for attribute "+vt,Se.commandStr),fn=Rs[ft.type]);var Mn=ft.divisor|0;ie.optional(function(){"divisor"in ft&&(ie.command(Mn===0||Xr,'cannot specify divisor for attribute "'+vt+'", instancing not supported',Se.commandStr),ie.command(Mn>=0,'invalid divisor for attribute "'+vt+'"',Se.commandStr));var ln=Se.commandStr,Hn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(ft).forEach(function(Rn){ie.command(Hn.indexOf(Rn)>=0,'unknown parameter "'+Rn+'" for attribute pointer "'+vt+'" (valid parameters are '+Hn+")",ln)})}),Oe.buffer=Qe,Oe.state=J,Oe.size=Br,Oe.normalized=un,Oe.type=fn||Qe.dtype,Oe.offset=kt,Oe.stride=Wt,Oe.divisor=Mn}}or[vt]=ls(function(ln,Hn){var Rn=ln.attribCache;if(nt in Rn)return Rn[nt];var Yn={isStream:!1};return Object.keys(Oe).forEach(function(Vn){Yn[Vn]=Oe[Vn]}),Oe.buffer&&(Yn.buffer=ln.link(Oe.buffer),Yn.type=Yn.type||Yn.buffer+".dtype"),Rn[nt]=Yn,Yn})}),Object.keys(Rt).forEach(function(vt){var ft=Rt[vt];function nt(Oe,Qe){var Fe=Oe.invoke(Qe,ft),kt=Oe.shared,Wt=Oe.constants,Br=kt.isBufferArgs,un=kt.buffer;ie.optional(function(){Oe.assert(Qe,Fe+"&&(typeof "+Fe+'==="object"||typeof '+Fe+'==="function")&&('+Br+"("+Fe+")||"+un+".getBuffer("+Fe+")||"+un+".getBuffer("+Fe+".buffer)||"+Br+"("+Fe+'.buffer)||("constant" in '+Fe+"&&(typeof "+Fe+'.constant==="number"||'+kt.isArrayLike+"("+Fe+".constant))))",'invalid dynamic attribute "'+vt+'"')});var fn={isStream:Qe.def(!1)},Mn=new Lt;Mn.state=J,Object.keys(Mn).forEach(function(Yn){fn[Yn]=Qe.def(""+Mn[Yn])});var ln=fn.buffer,Hn=fn.type;Qe("if(",Br,"(",Fe,")){",fn.isStream,"=true;",ln,"=",un,".createStream(",uf,",",Fe,");",Hn,"=",ln,".dtype;","}else{",ln,"=",un,".getBuffer(",Fe,");","if(",ln,"){",Hn,"=",ln,".dtype;",'}else if("constant" in ',Fe,"){",fn.state,"=",Q,";","if(typeof "+Fe+'.constant === "number"){',fn[xi[0]],"=",Fe,".constant;",xi.slice(1).map(function(Yn){return fn[Yn]}).join("="),"=0;","}else{",xi.map(function(Yn,Vn){return fn[Yn]+"="+Fe+".constant.length>"+Vn+"?"+Fe+".constant["+Vn+"]:0;"}).join(""),"}}else{","if(",Br,"(",Fe,".buffer)){",ln,"=",un,".createStream(",uf,",",Fe,".buffer);","}else{",ln,"=",un,".getBuffer(",Fe,".buffer);","}",Hn,'="type" in ',Fe,"?",Wt.glTypes,"[",Fe,".type]:",ln,".dtype;",fn.normalized,"=!!",Fe,".normalized;");function Rn(Yn){Qe(fn[Yn],"=",Fe,".",Yn,"|0;")}return Rn("size"),Rn("offset"),Rn("stride"),Rn("divisor"),Qe("}}"),Qe.exit("if(",fn.isStream,"){",un,".destroyStream(",ln,");","}"),fn}or[vt]=su(ft,nt)}),or}function fo(ke){var Se=ke.static,ot=ke.dynamic,Rt={};return Object.keys(Se).forEach(function(or){var vt=Se[or];Rt[or]=ls(function(ft,nt){return typeof vt=="number"||typeof vt=="boolean"?""+vt:ft.link(vt)})}),Object.keys(ot).forEach(function(or){var vt=ot[or];Rt[or]=su(vt,function(ft,nt){return ft.invoke(nt,vt)})}),Rt}function Ja(ke,Se,ot,Rt,or){var vt=ke.static,ft=ke.dynamic;ie.optional(function(){var Rn=[Ll,Qu,dl,Rl,xu,Ff,Mo,Dl,Ju,of].concat(ui);function Yn(Vn){Object.keys(Vn).forEach(function(Un){ie.command(Rn.indexOf(Un)>=0,'unknown parameter "'+Un+'"',or.commandStr)})}Yn(vt),Yn(ft)});var nt=Li(ke,Se),Oe=En(ke,or),Qe=bi(ke,Oe,or),Fe=yo(ke,or),kt=Fo(ke,or),Wt=qi(ke,or,nt);function Br(Rn){var Yn=Qe[Rn];Yn&&(kt[Rn]=Yn)}Br($u),Br(Xn(ku));var un=Object.keys(kt).length>0,fn={framebuffer:Oe,draw:Fe,shader:Wt,state:kt,dirty:un,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(fn.profile=Tn(ke,or),fn.uniforms=pa(ot,or),fn.drawVAO=fn.scopeVAO=Fe.vao,!fn.drawVAO&&Wt.program&&!nt&&$e.angle_instanced_arrays&&Fe.static.elements){var Mn=!0,ln=Wt.program.attributes.map(function(Rn){var Yn=Se.static[Rn];return Mn=Mn&&!!Yn,Yn});if(Mn&&ln.length>0){var Hn=Kr.getVAO(Kr.createVAO({attributes:ln,elements:Fe.static.elements}));fn.drawVAO=new us(null,null,null,function(Rn,Yn){return Rn.link(Hn)}),fn.useVAO=!0}}return nt?fn.useVAO=!0:fn.attributes=ys(Se,or),fn.context=fo(Rt,or),fn}function Io(ke,Se,ot){var Rt=ke.shared,or=Rt.context,vt=ke.scope();Object.keys(ot).forEach(function(ft){Se.save(or,"."+ft);var nt=ot[ft],Oe=nt.append(ke,Se);Array.isArray(Oe)?vt(or,".",ft,"=[",Oe.join(),"];"):vt(or,".",ft,"=",Oe,";")}),Se(vt)}function cs(ke,Se,ot,Rt){var or=ke.shared,vt=or.gl,ft=or.framebuffer,nt;On&&(nt=Se.def(or.extensions,".webgl_draw_buffers"));var Oe=ke.constants,Qe=Oe.drawBuffer,Fe=Oe.backBuffer,kt;ot?kt=ot.append(ke,Se):kt=Se.def(ft,".next"),Rt||Se("if(",kt,"!==",ft,".cur){"),Se("if(",kt,"){",vt,".bindFramebuffer(",qu,",",kt,".framebuffer);"),On&&Se(nt,".drawBuffersWEBGL(",Qe,"[",kt,".colorAttachments.length]);"),Se("}else{",vt,".bindFramebuffer(",qu,",null);"),On&&Se(nt,".drawBuffersWEBGL(",Fe,");"),Se("}",ft,".cur=",kt,";"),Rt||Se("}")}function fs(ke,Se,ot){var Rt=ke.shared,or=Rt.gl,vt=ke.current,ft=ke.next,nt=Rt.current,Oe=Rt.next,Qe=ke.cond(nt,".dirty");ui.forEach(function(Fe){var kt=Xn(Fe);if(!(kt in ot.state)){var Wt,Br;if(kt in ft){Wt=ft[kt],Br=vt[kt];var un=de(bn[kt].length,function(Mn){return Qe.def(Wt,"[",Mn,"]")});Qe(ke.cond(un.map(function(Mn,ln){return Mn+"!=="+Br+"["+ln+"]"}).join("||")).then(or,".",Sr[kt],"(",un,");",un.map(function(Mn,ln){return Br+"["+ln+"]="+Mn}).join(";"),";"))}else{Wt=Qe.def(Oe,".",kt);var fn=ke.cond(Wt,"!==",nt,".",kt);Qe(fn),kt in Tr?fn(ke.cond(Wt).then(or,".enable(",Tr[kt],");").else(or,".disable(",Tr[kt],");"),nt,".",kt,"=",Wt,";"):fn(or,".",Sr[kt],"(",Wt,");",nt,".",kt,"=",Wt,";")}}}),Object.keys(ot.state).length===0&&Qe(nt,".dirty=false;"),Se(Qe)}function _s(ke,Se,ot,Rt){var or=ke.shared,vt=ke.current,ft=or.current,nt=or.gl;Fh(Object.keys(ot)).forEach(function(Oe){var Qe=ot[Oe];if(!(Rt&&!Rt(Qe))){var Fe=Qe.append(ke,Se);if(Tr[Oe]){var kt=Tr[Oe];Vo(Qe)?Fe?Se(nt,".enable(",kt,");"):Se(nt,".disable(",kt,");"):Se(ke.cond(Fe).then(nt,".enable(",kt,");").else(nt,".disable(",kt,");")),Se(ft,".",Oe,"=",Fe,";")}else if(za(Fe)){var Wt=vt[Oe];Se(nt,".",Sr[Oe],"(",Fe,");",Fe.map(function(Br,un){return Wt+"["+un+"]="+Br}).join(";"),";")}else Se(nt,".",Sr[Oe],"(",Fe,");",ft,".",Oe,"=",Fe,";")}})}function Go(ke,Se){Xr&&(ke.instancing=Se.def(ke.shared.extensions,".angle_instanced_arrays"))}function Wi(ke,Se,ot,Rt,or){var vt=ke.shared,ft=ke.stats,nt=vt.current,Oe=vt.timer,Qe=ot.profile;function Fe(){var Rn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return Rn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var kt,Wt;function Br(Rn){kt=Se.def(),Rn(kt,"=",Fe(),";"),typeof or=="string"?Rn(ft,".count+=",or,";"):Rn(ft,".count++;"),Hr&&(Rt?(Wt=Se.def(),Rn(Wt,"=",Oe,".getNumPendingQueries();")):Rn(Oe,".beginQuery(",ft,");"))}function un(Rn){Rn(ft,".cpuTime+=",Fe(),"-",kt,";"),Hr&&(Rt?Rn(Oe,".pushScopeStats(",Wt,",",Oe,".getNumPendingQueries(),",ft,");"):Rn(Oe,".endQuery();"))}function fn(Rn){var Yn=Se.def(nt,".profile");Se(nt,".profile=",Rn,";"),Se.exit(nt,".profile=",Yn,";")}var Mn;if(Qe){if(Vo(Qe)){Qe.enable?(Br(Se),un(Se.exit),fn("true")):fn("false");return}Mn=Qe.append(ke,Se),fn(Mn)}else Mn=Se.def(nt,".profile");var ln=ke.block();Br(ln),Se("if(",Mn,"){",ln,"}");var Hn=ke.block();un(Hn),Se.exit("if(",Mn,"){",Hn,"}")}function Jo(ke,Se,ot,Rt,or){var vt=ke.shared;function ft(Oe){switch(Oe){case Uf:case Af:case cc:return 2;case wf:case ch:case fh:return 3;case Mc:case Vc:case lf:return 4;default:return 1}}function nt(Oe,Qe,Fe){var kt=vt.gl,Wt=Se.def(Oe,".location"),Br=Se.def(vt.attributes,"[",Wt,"]"),un=Fe.state,fn=Fe.buffer,Mn=[Fe.x,Fe.y,Fe.z,Fe.w],ln=["buffer","normalized","offset","stride"];function Hn(){Se("if(!",Br,".buffer){",kt,".enableVertexAttribArray(",Wt,");}");var Yn=Fe.type,Vn;if(Fe.size?Vn=Se.def(Fe.size,"||",Qe):Vn=Qe,Se("if(",Br,".type!==",Yn,"||",Br,".size!==",Vn,"||",ln.map(function(di){return Br+"."+di+"!=="+Fe[di]}).join("||"),"){",kt,".bindBuffer(",uf,",",fn,".buffer);",kt,".vertexAttribPointer(",[Wt,Vn,Yn,Fe.normalized,Fe.stride,Fe.offset],");",Br,".type=",Yn,";",Br,".size=",Vn,";",ln.map(function(di){return Br+"."+di+"="+Fe[di]+";"}).join(""),"}"),Xr){var Un=Fe.divisor;Se("if(",Br,".divisor!==",Un,"){",ke.instancing,".vertexAttribDivisorANGLE(",[Wt,Un],");",Br,".divisor=",Un,";}")}}function Rn(){Se("if(",Br,".buffer){",kt,".disableVertexAttribArray(",Wt,");",Br,".buffer=null;","}if(",xi.map(function(Yn,Vn){return Br+"."+Yn+"!=="+Mn[Vn]}).join("||"),"){",kt,".vertexAttrib4f(",Wt,",",Mn,");",xi.map(function(Yn,Vn){return Br+"."+Yn+"="+Mn[Vn]+";"}).join(""),"}")}un===J?Hn():un===Q?Rn():(Se("if(",un,"===",J,"){"),Hn(),Se("}else{"),Rn(),Se("}"))}Rt.forEach(function(Oe){var Qe=Oe.name,Fe=ot.attributes[Qe],kt;if(Fe){if(!or(Fe))return;kt=Fe.append(ke,Se)}else{if(!or(Wf))return;var Wt=ke.scopeAttrib(Qe);ie.optional(function(){ke.assert(Se,Wt+".state","missing attribute "+Qe)}),kt={},Object.keys(new Lt).forEach(function(Br){kt[Br]=Se.def(Wt,".",Br)})}nt(ke.link(Oe),ft(Oe.info.type),kt)})}function Pa(ke,Se,ot,Rt,or,vt){for(var ft=ke.shared,nt=ft.gl,Oe,Qe=0;Qe<Rt.length;++Qe){var Fe=Rt[Qe],kt=Fe.name,Wt=Fe.info.type,Br=ot.uniforms[kt],un=ke.link(Fe),fn=un+".location",Mn;if(Br){if(!or(Br))continue;if(Vo(Br)){var ln=Br.value;if(ie.command(ln!==null&&typeof ln!="undefined",'missing uniform "'+kt+'"',ke.commandStr),Wt===Vf||Wt===ff){ie.command(typeof ln=="function"&&(Wt===Vf&&(ln._reglType==="texture2d"||ln._reglType==="framebuffer")||Wt===ff&&(ln._reglType==="textureCube"||ln._reglType==="framebufferCube")),"invalid texture for uniform "+kt,ke.commandStr);var Hn=ke.link(ln._texture||ln.color[0]._texture);Se(nt,".uniform1i(",fn,",",Hn+".bind());"),Se.exit(Hn,".unbind();")}else if(Wt===cf||Wt===ou||Wt===jf){ie.optional(function(){ie.command(za(ln),"invalid matrix for uniform "+kt,ke.commandStr),ie.command(Wt===cf&&ln.length===4||Wt===ou&&ln.length===9||Wt===jf&&ln.length===16,"invalid length for matrix uniform "+kt,ke.commandStr)});var Rn=ke.global.def("new Float32Array(["+Array.prototype.slice.call(ln)+"])"),Yn=2;Wt===ou?Yn=3:Wt===jf&&(Yn=4),Se(nt,".uniformMatrix",Yn,"fv(",fn,",false,",Rn,");")}else{switch(Wt){case Pc:ie.commandType(ln,"number","uniform "+kt,ke.commandStr),Oe="1f";break;case Uf:ie.command(za(ln)&&ln.length===2,"uniform "+kt,ke.commandStr),Oe="2f";break;case wf:ie.command(za(ln)&&ln.length===3,"uniform "+kt,ke.commandStr),Oe="3f";break;case Mc:ie.command(za(ln)&&ln.length===4,"uniform "+kt,ke.commandStr),Oe="4f";break;case Ih:ie.commandType(ln,"boolean","uniform "+kt,ke.commandStr),Oe="1i";break;case Zf:ie.commandType(ln,"number","uniform "+kt,ke.commandStr),Oe="1i";break;case cc:ie.command(za(ln)&&ln.length===2,"uniform "+kt,ke.commandStr),Oe="2i";break;case Af:ie.command(za(ln)&&ln.length===2,"uniform "+kt,ke.commandStr),Oe="2i";break;case fh:ie.command(za(ln)&&ln.length===3,"uniform "+kt,ke.commandStr),Oe="3i";break;case ch:ie.command(za(ln)&&ln.length===3,"uniform "+kt,ke.commandStr),Oe="3i";break;case lf:ie.command(za(ln)&&ln.length===4,"uniform "+kt,ke.commandStr),Oe="4i";break;case Vc:ie.command(za(ln)&&ln.length===4,"uniform "+kt,ke.commandStr),Oe="4i";break}Se(nt,".uniform",Oe,"(",fn,",",za(ln)?Array.prototype.slice.call(ln):ln,");")}continue}else Mn=Br.append(ke,Se)}else{if(!or(Wf))continue;Mn=Se.def(ft.uniforms,"[",Me.id(kt),"]")}Wt===Vf?(ie(!Array.isArray(Mn),"must specify a scalar prop for textures"),Se("if(",Mn,"&&",Mn,'._reglType==="framebuffer"){',Mn,"=",Mn,".color[0];","}")):Wt===ff&&(ie(!Array.isArray(Mn),"must specify a scalar prop for cube maps"),Se("if(",Mn,"&&",Mn,'._reglType==="framebufferCube"){',Mn,"=",Mn,".color[0];","}")),ie.optional(function(){function ks(Fu,Kf){ke.assert(Se,Fu,'bad data or missing for uniform "'+kt+'".  '+Kf)}function el(Fu){ie(!Array.isArray(Mn),"must not specify an array type for uniform"),ks("typeof "+Mn+'==="'+Fu+'"',"invalid type, expected "+Fu)}function Su(Fu,Kf){Array.isArray(Mn)?ie(Mn.length===Fu,"must have length "+Fu):ks(ft.isArrayLike+"("+Mn+")&&"+Mn+".length==="+Fu,"invalid vector, should have length "+Fu,ke.commandStr)}function Yf(Fu){ie(!Array.isArray(Mn),"must not specify a value type"),ks("typeof "+Mn+'==="function"&&'+Mn+'._reglType==="texture'+(Fu===lp?"2d":"Cube")+'"',"invalid texture type",ke.commandStr)}switch(Wt){case Zf:el("number");break;case Af:Su(2,"number");break;case ch:Su(3,"number");break;case Vc:Su(4,"number");break;case Pc:el("number");break;case Uf:Su(2,"number");break;case wf:Su(3,"number");break;case Mc:Su(4,"number");break;case Ih:el("boolean");break;case cc:Su(2,"boolean");break;case fh:Su(3,"boolean");break;case lf:Su(4,"boolean");break;case cf:Su(4,"number");break;case ou:Su(9,"number");break;case jf:Su(16,"number");break;case Vf:Yf(lp);break;case ff:Yf(Up);break}});var Vn=1;switch(Wt){case Vf:case ff:var Un=Se.def(Mn,"._texture");Se(nt,".uniform1i(",fn,",",Un,".bind());"),Se.exit(Un,".unbind();");continue;case Zf:case Ih:Oe="1i";break;case Af:case cc:Oe="2i",Vn=2;break;case ch:case fh:Oe="3i",Vn=3;break;case Vc:case lf:Oe="4i",Vn=4;break;case Pc:Oe="1f";break;case Uf:Oe="2f",Vn=2;break;case wf:Oe="3f",Vn=3;break;case Mc:Oe="4f",Vn=4;break;case cf:Oe="Matrix2fv";break;case ou:Oe="Matrix3fv";break;case jf:Oe="Matrix4fv";break}if(Oe.charAt(0)==="M"){Se(nt,".uniform",Oe,"(",fn,",");var di=Math.pow(Wt-cf+2,2),Qa=ke.global.def("new Float32Array(",di,")");Array.isArray(Mn)?Se("false,(",de(di,function(ks){return Qa+"["+ks+"]="+Mn[ks]}),",",Qa,")"):Se("false,(Array.isArray(",Mn,")||",Mn," instanceof Float32Array)?",Mn,":(",de(di,function(ks){return Qa+"["+ks+"]="+Mn+"["+ks+"]"}),",",Qa,")"),Se(");")}else if(Vn>1){for(var Ho=[],zl=[],qa=0;qa<Vn;++qa)Array.isArray(Mn)?zl.push(Mn[qa]):zl.push(Se.def(Mn+"["+qa+"]")),vt&&Ho.push(Se.def());vt&&Se("if(!",ke.batchId,"||",Ho.map(function(ks,el){return ks+"!=="+zl[el]}).join("||"),"){",Ho.map(function(ks,el){return ks+"="+zl[el]+";"}).join("")),Se(nt,".uniform",Oe,"(",fn,",",zl.join(","),");"),vt&&Se("}")}else{if(ie(!Array.isArray(Mn),"uniform value must not be an array"),vt){var Ra=Se.def();Se("if(!",ke.batchId,"||",Ra,"!==",Mn,"){",Ra,"=",Mn,";")}Se(nt,".uniform",Oe,"(",fn,",",Mn,");"),vt&&Se("}")}}}function _o(ke,Se,ot,Rt){var or=ke.shared,vt=or.gl,ft=or.draw,nt=Rt.draw;function Oe(){var Vn=nt.elements,Un,di=Se;return Vn?((Vn.contextDep&&Rt.contextDynamic||Vn.propDep)&&(di=ot),Un=Vn.append(ke,di),nt.elementsActive&&di("if("+Un+")"+vt+".bindBuffer("+lc+","+Un+".buffer.buffer);")):(Un=di.def(),di(Un,"=",ft,".",Rl,";","if(",Un,"){",vt,".bindBuffer(",lc,",",Un,".buffer.buffer);}","else if(",or.vao,".currentVAO){",Un,"=",ke.shared.elements+".getElements("+or.vao,".currentVAO.elements);",wr?"":"if("+Un+")"+vt+".bindBuffer("+lc+","+Un+".buffer.buffer);","}")),Un}function Qe(){var Vn=nt.count,Un,di=Se;return Vn?((Vn.contextDep&&Rt.contextDynamic||Vn.propDep)&&(di=ot),Un=Vn.append(ke,di),ie.optional(function(){Vn.MISSING&&ke.assert(Se,"false","missing vertex count"),Vn.DYNAMIC&&ke.assert(di,Un+">=0","missing vertex count")})):(Un=di.def(ft,".",Mo),ie.optional(function(){ke.assert(di,Un+">=0","missing vertex count")})),Un}var Fe=Oe();function kt(Vn){var Un=nt[Vn];return Un?Un.contextDep&&Rt.contextDynamic||Un.propDep?Un.append(ke,ot):Un.append(ke,Se):Se.def(ft,".",Vn)}var Wt=kt(xu),Br=kt(Ff),un=Qe();if(typeof un=="number"){if(un===0)return}else ot("if(",un,"){"),ot.exit("}");var fn,Mn;Xr&&(fn=kt(Dl),Mn=ke.instancing);var ln=Fe+".type",Hn=nt.elements&&Vo(nt.elements)&&!nt.vaoActive;function Rn(){function Vn(){ot(Mn,".drawElementsInstancedANGLE(",[Wt,un,ln,Br+"<<(("+ln+"-"+zi+")>>1)",fn],");")}function Un(){ot(Mn,".drawArraysInstancedANGLE(",[Wt,Br,un,fn],");")}Fe&&Fe!=="null"?Hn?Vn():(ot("if(",Fe,"){"),Vn(),ot("}else{"),Un(),ot("}")):Un()}function Yn(){function Vn(){ot(vt+".drawElements("+[Wt,un,ln,Br+"<<(("+ln+"-"+zi+")>>1)"]+");")}function Un(){ot(vt+".drawArrays("+[Wt,Br,un]+");")}Fe&&Fe!=="null"?Hn?Vn():(ot("if(",Fe,"){"),Vn(),ot("}else{"),Un(),ot("}")):Un()}Xr&&(typeof fn!="number"||fn>=0)?typeof fn=="string"?(ot("if(",fn,">0){"),Rn(),ot("}else if(",fn,"<0){"),Yn(),ot("}")):Rn():Yn()}function _i(ke,Se,ot,Rt,or){var vt=Oi(),ft=vt.proc("body",or);return ie.optional(function(){vt.commandStr=Se.commandStr,vt.command=vt.link(Se.commandStr)}),Xr&&(vt.instancing=ft.def(vt.shared.extensions,".angle_instanced_arrays")),ke(vt,ft,ot,Rt),vt.compile().body}function ha(ke,Se,ot,Rt){Go(ke,Se),ot.useVAO?ot.drawVAO?Se(ke.shared.vao,".setVAO(",ot.drawVAO.append(ke,Se),");"):Se(ke.shared.vao,".setVAO(",ke.shared.vao,".targetVAO);"):(Se(ke.shared.vao,".setVAO(null);"),Jo(ke,Se,ot,Rt.attributes,function(){return!0})),Pa(ke,Se,ot,Rt.uniforms,function(){return!0},!1),_o(ke,Se,Se,ot)}function io(ke,Se){var ot=ke.proc("draw",1);Go(ke,ot),Io(ke,ot,Se.context),cs(ke,ot,Se.framebuffer),fs(ke,ot,Se),_s(ke,ot,Se.state),Wi(ke,ot,Se,!1,!0);var Rt=Se.shader.progVar.append(ke,ot);if(ot(ke.shared.gl,".useProgram(",Rt,".program);"),Se.shader.program)ha(ke,ot,Se,Se.shader.program);else{ot(ke.shared.vao,".setVAO(null);");var or=ke.global.def("{}"),vt=ot.def(Rt,".id"),ft=ot.def(or,"[",vt,"]");ot(ke.cond(ft).then(ft,".call(this,a0);").else(ft,"=",or,"[",vt,"]=",ke.link(function(nt){return _i(ha,ke,Se,nt,1)}),"(",Rt,");",ft,".call(this,a0);"))}Object.keys(Se.state).length>0&&ot(ke.shared.current,".dirty=true;"),ke.shared.vao&&ot(ke.shared.vao,".setVAO(null);")}function xo(ke,Se,ot,Rt){ke.batchId="a1",Go(ke,Se);function or(){return!0}Jo(ke,Se,ot,Rt.attributes,or),Pa(ke,Se,ot,Rt.uniforms,or,!1),_o(ke,Se,Se,ot)}function bu(ke,Se,ot,Rt){Go(ke,Se);var or=ot.contextDep,vt=Se.def(),ft="a0",nt="a1",Oe=Se.def();ke.shared.props=Oe,ke.batchId=vt;var Qe=ke.scope(),Fe=ke.scope();Se(Qe.entry,"for(",vt,"=0;",vt,"<",nt,";++",vt,"){",Oe,"=",ft,"[",vt,"];",Fe,"}",Qe.exit);function kt(ln){return ln.contextDep&&or||ln.propDep}function Wt(ln){return!kt(ln)}if(ot.needsContext&&Io(ke,Fe,ot.context),ot.needsFramebuffer&&cs(ke,Fe,ot.framebuffer),_s(ke,Fe,ot.state,kt),ot.profile&&kt(ot.profile)&&Wi(ke,Fe,ot,!1,!0),Rt)ot.useVAO?ot.drawVAO?kt(ot.drawVAO)?Fe(ke.shared.vao,".setVAO(",ot.drawVAO.append(ke,Fe),");"):Qe(ke.shared.vao,".setVAO(",ot.drawVAO.append(ke,Qe),");"):Qe(ke.shared.vao,".setVAO(",ke.shared.vao,".targetVAO);"):(Qe(ke.shared.vao,".setVAO(null);"),Jo(ke,Qe,ot,Rt.attributes,Wt),Jo(ke,Fe,ot,Rt.attributes,kt)),Pa(ke,Qe,ot,Rt.uniforms,Wt,!1),Pa(ke,Fe,ot,Rt.uniforms,kt,!0),_o(ke,Qe,Fe,ot);else{var Br=ke.global.def("{}"),un=ot.shader.progVar.append(ke,Fe),fn=Fe.def(un,".id"),Mn=Fe.def(Br,"[",fn,"]");Fe(ke.shared.gl,".useProgram(",un,".program);","if(!",Mn,"){",Mn,"=",Br,"[",fn,"]=",ke.link(function(ln){return _i(xo,ke,ot,ln,2)}),"(",un,");}",Mn,".call(this,a0[",vt,"],",vt,");")}}function Ue(ke,Se){var ot=ke.proc("batch",2);ke.batchId="0",Go(ke,ot);var Rt=!1,or=!0;Object.keys(Se.context).forEach(function(Br){Rt=Rt||Se.context[Br].propDep}),Rt||(Io(ke,ot,Se.context),or=!1);var vt=Se.framebuffer,ft=!1;vt?(vt.propDep?Rt=ft=!0:vt.contextDep&&Rt&&(ft=!0),ft||cs(ke,ot,vt)):cs(ke,ot,null),Se.state.viewport&&Se.state.viewport.propDep&&(Rt=!0);function nt(Br){return Br.contextDep&&Rt||Br.propDep}fs(ke,ot,Se),_s(ke,ot,Se.state,function(Br){return!nt(Br)}),(!Se.profile||!nt(Se.profile))&&Wi(ke,ot,Se,!1,"a1"),Se.contextDep=Rt,Se.needsContext=or,Se.needsFramebuffer=ft;var Oe=Se.shader.progVar;if(Oe.contextDep&&Rt||Oe.propDep)bu(ke,ot,Se,null);else{var Qe=Oe.append(ke,ot);if(ot(ke.shared.gl,".useProgram(",Qe,".program);"),Se.shader.program)bu(ke,ot,Se,Se.shader.program);else{ot(ke.shared.vao,".setVAO(null);");var Fe=ke.global.def("{}"),kt=ot.def(Qe,".id"),Wt=ot.def(Fe,"[",kt,"]");ot(ke.cond(Wt).then(Wt,".call(this,a0,a1);").else(Wt,"=",Fe,"[",kt,"]=",ke.link(function(Br){return _i(bu,ke,Se,Br,2)}),"(",Qe,");",Wt,".call(this,a0,a1);"))}}Object.keys(Se.state).length>0&&ot(ke.shared.current,".dirty=true;"),ke.shared.vao&&ot(ke.shared.vao,".setVAO(null);")}function er(ke,Se){var ot=ke.proc("scope",3);ke.batchId="a2";var Rt=ke.shared,or=Rt.current;Io(ke,ot,Se.context),Se.framebuffer&&Se.framebuffer.append(ke,ot),Fh(Object.keys(Se.state)).forEach(function(ft){var nt=Se.state[ft],Oe=nt.append(ke,ot);za(Oe)?Oe.forEach(function(Qe,Fe){ot.set(ke.next[ft],"["+Fe+"]",Qe)}):ot.set(Rt.next,"."+ft,Oe)}),Wi(ke,ot,Se,!0,!0),[Rl,Ff,Mo,Dl,xu].forEach(function(ft){var nt=Se.draw[ft];!nt||ot.set(Rt.draw,"."+ft,""+nt.append(ke,ot))}),Object.keys(Se.uniforms).forEach(function(ft){var nt=Se.uniforms[ft].append(ke,ot);Array.isArray(nt)&&(nt="["+nt.join()+"]"),ot.set(Rt.uniforms,"["+Me.id(ft)+"]",nt)}),Object.keys(Se.attributes).forEach(function(ft){var nt=Se.attributes[ft].append(ke,ot),Oe=ke.scopeAttrib(ft);Object.keys(new Lt).forEach(function(Qe){ot.set(Oe,"."+Qe,nt[Qe])})}),Se.scopeVAO&&ot.set(Rt.vao,".targetVAO",Se.scopeVAO.append(ke,ot));function vt(ft){var nt=Se.shader[ft];nt&&ot.set(Rt.shader,"."+ft,nt.append(ke,ot))}vt(Qu),vt(dl),Object.keys(Se.state).length>0&&(ot(or,".dirty=true;"),ot.exit(or,".dirty=true;")),ot("a1(",ke.shared.context,",a0,",ke.batchId,");")}function Jt(ke){if(!(typeof ke!="object"||za(ke))){for(var Se=Object.keys(ke),ot=0;ot<Se.length;++ot)if(Er.isDynamic(ke[Se[ot]]))return!0;return!1}}function zn(ke,Se,ot){var Rt=Se.static[ot];if(!Rt||!Jt(Rt))return;var or=ke.global,vt=Object.keys(Rt),ft=!1,nt=!1,Oe=!1,Qe=ke.global.def("{}");vt.forEach(function(kt){var Wt=Rt[kt];if(Er.isDynamic(Wt)){typeof Wt=="function"&&(Wt=Rt[kt]=Er.unbox(Wt));var Br=su(Wt,null);ft=ft||Br.thisDep,Oe=Oe||Br.propDep,nt=nt||Br.contextDep}else{switch(or(Qe,".",kt,"="),typeof Wt){case"number":or(Wt);break;case"string":or('"',Wt,'"');break;case"object":Array.isArray(Wt)&&or("[",Wt.join(),"]");break;default:or(ke.link(Wt));break}or(";")}});function Fe(kt,Wt){vt.forEach(function(Br){var un=Rt[Br];if(!!Er.isDynamic(un)){var fn=kt.invoke(Wt,un);Wt(Qe,".",Br,"=",fn,";")}})}Se.dynamic[ot]=new Er.DynamicVariable(st,{thisDep:ft,contextDep:nt,propDep:Oe,ref:Qe,append:Fe}),delete Se.static[ot]}function oa(ke,Se,ot,Rt,or){var vt=Oi();vt.stats=vt.link(or),Object.keys(Se.static).forEach(function(nt){zn(vt,Se,nt)}),sp.forEach(function(nt){zn(vt,ke,nt)});var ft=Ja(ke,Se,ot,Rt,vt);return io(vt,ft),er(vt,ft),Ue(vt,ft),p(vt.compile(),{destroy:function(){ft.shader.program.destroy()}})}return{next:tn,current:bn,procs:function(){var ke=Oi(),Se=ke.proc("poll"),ot=ke.proc("refresh"),Rt=ke.block();Se(Rt),ot(Rt);var or=ke.shared,vt=or.gl,ft=or.next,nt=or.current;Rt(nt,".dirty=false;"),cs(ke,Se),cs(ke,ot,null,!0);var Oe;Xr&&(Oe=ke.link(Xr)),$e.oes_vertex_array_object&&ot(ke.link($e.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Qe=0;Qe<ar.maxAttributes;++Qe){var Fe=ot.def(or.attributes,"[",Qe,"]"),kt=ke.cond(Fe,".buffer");kt.then(vt,".enableVertexAttribArray(",Qe,");",vt,".bindBuffer(",uf,",",Fe,".buffer.buffer);",vt,".vertexAttribPointer(",Qe,",",Fe,".size,",Fe,".type,",Fe,".normalized,",Fe,".stride,",Fe,".offset);").else(vt,".disableVertexAttribArray(",Qe,");",vt,".vertexAttrib4f(",Qe,",",Fe,".x,",Fe,".y,",Fe,".z,",Fe,".w);",Fe,".buffer=null;"),ot(kt),Xr&&ot(Oe,".vertexAttribDivisorANGLE(",Qe,",",Fe,".divisor);")}return ot(ke.shared.vao,".currentVAO=null;",ke.shared.vao,".setVAO(",ke.shared.vao,".targetVAO);"),Object.keys(Tr).forEach(function(Wt){var Br=Tr[Wt],un=Rt.def(ft,".",Wt),fn=ke.block();fn("if(",un,"){",vt,".enable(",Br,")}else{",vt,".disable(",Br,")}",nt,".",Wt,"=",un,";"),ot(fn),Se("if(",un,"!==",nt,".",Wt,"){",fn,"}")}),Object.keys(Sr).forEach(function(Wt){var Br=Sr[Wt],un=bn[Wt],fn,Mn,ln=ke.block();if(ln(vt,".",Br,"("),za(un)){var Hn=un.length;fn=ke.global.def(ft,".",Wt),Mn=ke.global.def(nt,".",Wt),ln(de(Hn,function(Rn){return fn+"["+Rn+"]"}),");",de(Hn,function(Rn){return Mn+"["+Rn+"]="+fn+"["+Rn+"];"}).join("")),Se("if(",de(Hn,function(Rn){return fn+"["+Rn+"]!=="+Mn+"["+Rn+"]"}).join("||"),"){",ln,"}")}else fn=Rt.def(ft,".",Wt),Mn=Rt.def(nt,".",Wt),ln(fn,");",nt,".",Wt,"=",fn,";"),Se("if(",fn,"!==",Mn,"){",ln,"}");ot(ln)}),ke.compile()}(),compile:oa}}function Nh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var pp=34918,dp=34919,zh=35007,Uh=function(V,Me){if(!Me.ext_disjoint_timer_query)return null;var $e=[];function ar(){return $e.pop()||Me.ext_disjoint_timer_query.createQueryEXT()}function Pr(Xr){$e.push(Xr)}var rr=[];function Cr(Xr){var On=ar();Me.ext_disjoint_timer_query.beginQueryEXT(zh,On),rr.push(On),Hr(rr.length-1,rr.length,Xr)}function Fr(){Me.ext_disjoint_timer_query.endQueryEXT(zh)}function Vr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Kr=[];function $r(){return Kr.pop()||new Vr}function rn(Xr){Kr.push(Xr)}var dn=[];function Hr(Xr,On,wr){var bn=$r();bn.startQueryIndex=Xr,bn.endQueryIndex=On,bn.sum=0,bn.stats=wr,dn.push(bn)}var en=[],Lt=[];function vr(){var Xr,On,wr=rr.length;if(wr!==0){Lt.length=Math.max(Lt.length,wr+1),en.length=Math.max(en.length,wr+1),en[0]=0,Lt[0]=0;var bn=0;for(Xr=0,On=0;On<rr.length;++On){var tn=rr[On];Me.ext_disjoint_timer_query.getQueryObjectEXT(tn,dp)?(bn+=Me.ext_disjoint_timer_query.getQueryObjectEXT(tn,pp),Pr(tn)):rr[Xr++]=tn,en[On+1]=bn,Lt[On+1]=Xr}for(rr.length=Xr,Xr=0,On=0;On<dn.length;++On){var ui=dn[On],Tr=ui.startQueryIndex,Sr=ui.endQueryIndex;ui.sum+=en[Sr]-en[Tr];var Xn=Lt[Tr],yn=Lt[Sr];yn===Xn?(ui.stats.gpuTime+=ui.sum/1e6,rn(ui)):(ui.startQueryIndex=Xn,ui.endQueryIndex=yn,dn[Xr++]=ui)}dn.length=Xr}}return{beginQuery:Cr,endQuery:Fr,pushScopeStats:Hr,update:vr,getNumPendingQueries:function(){return rr.length},clear:function(){$e.push.apply($e,rr);for(var Xr=0;Xr<$e.length;Xr++)Me.ext_disjoint_timer_query.deleteQueryEXT($e[Xr]);rr.length=0,$e.length=0},restore:function(){rr.length=0,$e.length=0}}},Zh=16384,vp=256,pf=1024,Xf=34962,vh="webglcontextlost",Tf="webglcontextrestored",$a=1,jh=2,hc=3;function Hc(V,Me){for(var $e=0;$e<V.length;++$e)if(V[$e]===Me)return $e;return-1}function Wc(V){var Me=z(V);if(!Me)return null;var $e=Me.gl,ar=$e.getContextAttributes(),Pr=$e.isContextLost(),rr=oe($e,Me);if(!rr)return null;var Cr=$i(),Fr=Nh(),Vr=rr.extensions,Kr=Uh($e,Vr),$r=Ti(),rn=$e.drawingBufferWidth,dn=$e.drawingBufferHeight,Hr={tick:0,time:0,viewportWidth:rn,viewportHeight:dn,framebufferWidth:rn,framebufferHeight:dn,drawingBufferWidth:rn,drawingBufferHeight:dn,pixelRatio:Me.pixelRatio},en={},Lt={elements:null,primitive:4,count:-1,offset:0,instances:-1},vr=De($e,Vr),Xr=j($e,Fr,Me,bn),On=cu($e,Vr,Xr,Fr),wr=xt($e,Vr,vr,Fr,Xr,On,Lt);function bn(_i){return wr.destroyBuffer(_i)}var tn=zr($e,Cr,Fr,Me),ui=nu($e,Vr,vr,function(){Xn.procs.poll()},Hr,Fr,Me),Tr=Uc($e,Vr,vr,Fr,Me),Sr=Te($e,Vr,vr,ui,Tr,Fr),Xn=Bh($e,Cr,Vr,vr,Xr,On,ui,Sr,en,wr,tn,Lt,Hr,Kr,Me),yn=ci($e,Sr,Xn.procs.poll,Hr,ar,Vr,vr),Yr=Xn.next,An=$e.canvas,Sn=[],Zi=[],Oi=[],Tn=[Me.onDestroy],En=null;function bi(){if(Sn.length===0){Kr&&Kr.update(),En=null;return}En=Jn.next(bi),Go();for(var _i=Sn.length-1;_i>=0;--_i){var ha=Sn[_i];ha&&ha(Hr,null,0)}$e.flush(),Kr&&Kr.update()}function Li(){!En&&Sn.length>0&&(En=Jn.next(bi))}function qi(){En&&(Jn.cancel(bi),En=null)}function yo(_i){_i.preventDefault(),Pr=!0,qi(),Zi.forEach(function(ha){ha()})}function Fo(_i){$e.getError(),Pr=!1,rr.restore(),tn.restore(),Xr.restore(),ui.restore(),Tr.restore(),Sr.restore(),wr.restore(),Kr&&Kr.restore(),Xn.procs.refresh(),Li(),Oi.forEach(function(ha){ha()})}var pa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!pa&&An&&(An.addEventListener(vh,yo,!1),An.addEventListener(Tf,Fo,!1));function ys(){Sn.length=0,qi(),!pa&&An&&(An.removeEventListener(vh,yo),An.removeEventListener(Tf,Fo)),tn.clear(),Sr.clear(),Tr.clear(),wr.clear(),ui.clear(),On.clear(),Xr.clear(),Kr&&Kr.clear(),Tn.forEach(function(_i){_i()})}function fo(_i){ie(!!_i,"invalid args to regl({...})"),ie.type(_i,"object","invalid args to regl({...})");function ha(vt){var ft=p({},vt);delete ft.uniforms,delete ft.attributes,delete ft.context,delete ft.vao,"stencil"in ft&&ft.stencil.op&&(ft.stencil.opBack=ft.stencil.opFront=ft.stencil.op,delete ft.stencil.op);function nt(Oe){if(Oe in ft){var Qe=ft[Oe];delete ft[Oe],Object.keys(Qe).forEach(function(Fe){ft[Oe+"."+Fe]=Qe[Fe]})}}return nt("blend"),nt("depth"),nt("cull"),nt("stencil"),nt("polygonOffset"),nt("scissor"),nt("sample"),"vao"in vt&&(ft.vao=vt.vao),ft}function io(vt,ft){var nt={},Oe={};return Object.keys(vt).forEach(function(Qe){var Fe=vt[Qe];if(Er.isDynamic(Fe)){Oe[Qe]=Er.unbox(Fe,Qe);return}else if(ft&&Array.isArray(Fe)){for(var kt=0;kt<Fe.length;++kt)if(Er.isDynamic(Fe[kt])){Oe[Qe]=Er.unbox(Fe,Qe);return}}nt[Qe]=Fe}),{dynamic:Oe,static:nt}}var xo=io(_i.context||{},!0),bu=io(_i.uniforms||{},!0),Ue=io(_i.attributes||{},!1),er=io(ha(_i),!1),Jt={gpuTime:0,cpuTime:0,count:0},zn=Xn.compile(er,Ue,bu,xo,Jt),oa=zn.draw,ke=zn.batch,Se=zn.scope,ot=[];function Rt(vt){for(;ot.length<vt;)ot.push(null);return ot}function or(vt,ft){var nt;if(Pr&&ie.raise("context lost"),typeof vt=="function")return Se.call(this,null,vt,0);if(typeof ft=="function")if(typeof vt=="number")for(nt=0;nt<vt;++nt)Se.call(this,null,ft,nt);else if(Array.isArray(vt))for(nt=0;nt<vt.length;++nt)Se.call(this,vt[nt],ft,nt);else return Se.call(this,vt,ft,0);else if(typeof vt=="number"){if(vt>0)return ke.call(this,Rt(vt|0),vt|0)}else if(Array.isArray(vt)){if(vt.length)return ke.call(this,vt,vt.length)}else return oa.call(this,vt)}return p(or,{stats:Jt,destroy:function(){zn.destroy()}})}var Ja=Sr.setFBO=fo({framebuffer:Er.define.call(null,$a,"framebuffer")});function Io(_i,ha){var io=0;Xn.procs.poll();var xo=ha.color;xo&&($e.clearColor(+xo[0]||0,+xo[1]||0,+xo[2]||0,+xo[3]||0),io|=Zh),"depth"in ha&&($e.clearDepth(+ha.depth),io|=vp),"stencil"in ha&&($e.clearStencil(ha.stencil|0),io|=pf),ie(!!io,"called regl.clear with no buffer specified"),$e.clear(io)}function cs(_i){if(ie(typeof _i=="object"&&_i,"regl.clear() takes an object as input"),"framebuffer"in _i)if(_i.framebuffer&&_i.framebuffer_reglType==="framebufferCube")for(var ha=0;ha<6;++ha)Ja(p({framebuffer:_i.framebuffer.faces[ha]},_i),Io);else Ja(_i,Io);else Io(null,_i)}function fs(_i){ie.type(_i,"function","regl.frame() callback must be a function"),Sn.push(_i);function ha(){var io=Hc(Sn,_i);ie(io>=0,"cannot cancel a frame twice");function xo(){var bu=Hc(Sn,xo);Sn[bu]=Sn[Sn.length-1],Sn.length-=1,Sn.length<=0&&qi()}Sn[io]=xo}return Li(),{cancel:ha}}function _s(){var _i=Yr.viewport,ha=Yr.scissor_box;_i[0]=_i[1]=ha[0]=ha[1]=0,Hr.viewportWidth=Hr.framebufferWidth=Hr.drawingBufferWidth=_i[2]=ha[2]=$e.drawingBufferWidth,Hr.viewportHeight=Hr.framebufferHeight=Hr.drawingBufferHeight=_i[3]=ha[3]=$e.drawingBufferHeight}function Go(){Hr.tick+=1,Hr.time=Jo(),_s(),Xn.procs.poll()}function Wi(){ui.refresh(),_s(),Xn.procs.refresh(),Kr&&Kr.update()}function Jo(){return(Ti()-$r)/1e3}Wi();function Pa(_i,ha){ie.type(ha,"function","listener callback must be a function");var io;switch(_i){case"frame":return fs(ha);case"lost":io=Zi;break;case"restore":io=Oi;break;case"destroy":io=Tn;break;default:ie.raise("invalid event, must be one of frame,lost,restore,destroy")}return io.push(ha),{cancel:function(){for(var xo=0;xo<io.length;++xo)if(io[xo]===ha){io[xo]=io[io.length-1],io.pop();return}}}}var _o=p(fo,{clear:cs,prop:Er.define.bind(null,$a),context:Er.define.bind(null,jh),this:Er.define.bind(null,hc),draw:fo({}),buffer:function(_i){return Xr.create(_i,Xf,!1,!1)},elements:function(_i){return On.create(_i,!1)},texture:ui.create2D,cube:ui.createCube,renderbuffer:Tr.create,framebuffer:Sr.create,framebufferCube:Sr.createCube,vao:wr.createVAO,attributes:ar,frame:fs,on:Pa,limits:vr,hasExtension:function(_i){return vr.extensions.indexOf(_i.toLowerCase())>=0},read:yn,destroy:ys,_gl:$e,_refresh:Wi,poll:function(){Go(),Kr&&Kr.update()},now:Jo,stats:Fr});return Me.onDone(null,_o),_o}return Wc})},34130:function(Lr){var U=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function S(ue){return ue.match(U)||[]}Lr.exports=S},14318:function(Lr){function U(S,ue,C){return S===S&&(C!==void 0&&(S=S<=C?S:C),ue!==void 0&&(S=S>=ue?S:ue)),S}Lr.exports=U},61856:function(Lr){function U(S){return function(ue){return S==null?void 0:S[ue]}}Lr.exports=U},97815:function(Lr,U,S){var ue=S(4324),C=S(55015),p=S(80935),w=S(44140);function q(K){return function(W){W=w(W);var L=C(W)?p(W):void 0,N=L?L[0]:W.charAt(0),Ne=L?ue(L,1).join(""):W.slice(1);return N[K]()+Ne}}Lr.exports=q},74749:function(Lr,U,S){var ue=S(99861),C=S(31876),p=S(61503),w="['\u2019]",q=RegExp(w,"g");function K(W){return function(L){return ue(p(C(L).replace(q,"")),W,"")}}Lr.exports=K},70668:function(Lr,U,S){var ue=S(61856),C={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=ue(C);Lr.exports=p},62840:function(Lr){var U=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function S(ue){return U.test(ue)}Lr.exports=S},97681:function(Lr){var U="\\ud800-\\udfff",S="\\u0300-\\u036f",ue="\\ufe20-\\ufe2f",C="\\u20d0-\\u20ff",p=S+ue+C,w="\\u2700-\\u27bf",q="a-z\\xdf-\\xf6\\xf8-\\xff",K="\\xac\\xb1\\xd7\\xf7",W="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",L="\\u2000-\\u206f",N=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ne="A-Z\\xc0-\\xd6\\xd8-\\xde",Ye="\\ufe0e\\ufe0f",Je=K+W+L+N,rt="['\u2019]",Xt="["+Je+"]",Gt="["+p+"]",nr="\\d+",Ut="["+w+"]",At="["+q+"]",Et="[^"+U+Je+nr+w+q+Ne+"]",dr="\\ud83c[\\udffb-\\udfff]",re="(?:"+Gt+"|"+dr+")",mr="[^"+U+"]",wt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ke="[\\ud800-\\udbff][\\udc00-\\udfff]",Dt="["+Ne+"]",Xe="\\u200d",Zt="(?:"+At+"|"+Et+")",yr="(?:"+Dt+"|"+Et+")",ur="(?:"+rt+"(?:d|ll|m|re|s|t|ve))?",Ur="(?:"+rt+"(?:D|LL|M|RE|S|T|VE))?",he=re+"?",Re="["+Ye+"]?",ge="(?:"+Xe+"(?:"+[mr,wt,Ke].join("|")+")"+Re+he+")*",_t="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",pt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",zt=Re+he+ge,Ft="(?:"+[Ut,wt,Ke].join("|")+")"+zt,Dr=RegExp([Dt+"?"+At+"+"+ur+"(?="+[Xt,Dt,"$"].join("|")+")",yr+"+"+Ur+"(?="+[Xt,Dt+Zt,"$"].join("|")+")",Dt+"?"+Zt+"+"+ur,Dt+"+"+Ur,pt,_t,nr,Ft].join("|"),"g");function pn(mn){return mn.match(Dr)||[]}Lr.exports=pn},34301:function(Lr,U,S){var ue=S(30225),C=S(74749),p=C(function(w,q,K){return q=q.toLowerCase(),w+(K?ue(q):q)});Lr.exports=p},30225:function(Lr,U,S){var ue=S(44140),C=S(53592);function p(w){return C(ue(w).toLowerCase())}Lr.exports=p},61400:function(Lr,U,S){var ue=S(14318),C=S(20168);function p(w,q,K){return K===void 0&&(K=q,q=void 0),K!==void 0&&(K=C(K),K=K===K?K:0),q!==void 0&&(q=C(q),q=q===q?q:0),ue(C(w),q,K)}Lr.exports=p},31876:function(Lr,U,S){var ue=S(70668),C=S(44140),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,w="\\u0300-\\u036f",q="\\ufe20-\\ufe2f",K="\\u20d0-\\u20ff",W=w+q+K,L="["+W+"]",N=RegExp(L,"g");function Ne(Ye){return Ye=C(Ye),Ye&&Ye.replace(p,ue).replace(N,"")}Lr.exports=Ne},93544:function(Lr){function U(S){return S==null}Lr.exports=U},68868:function(Lr,U,S){var ue=S(86756),C=S(93913),p="[object Number]";function w(q){return typeof q=="number"||C(q)&&ue(q)==p}Lr.exports=w},24602:function(Lr,U,S){var ue=S(50097),C=S(63323),p=C(function(w,q,K,W){ue(w,q,K,W)});Lr.exports=p},21691:function(Lr,U,S){var ue=S(29098);function C(p){return p&&p.length?ue(p):[]}Lr.exports=C},53592:function(Lr,U,S){var ue=S(97815),C=ue("toUpperCase");Lr.exports=C},61503:function(Lr,U,S){var ue=S(34130),C=S(62840),p=S(44140),w=S(97681);function q(K,W,L){return K=p(K),W=L?void 0:W,W===void 0?C(K)?w(K):ue(K):K.match(W)||[]}Lr.exports=q},97399:function(Lr){(function(U,S){Lr.exports=S()})(this,function(){"use strict";var U,S,ue;function C(p,w){if(!U)U=w;else if(!S)S=w;else{var q="var sharedChunk = {}; ("+U+")(sharedChunk); ("+S+")(sharedChunk);",K={};U(K),ue=w(K),typeof window!="undefined"&&(ue.workerUrl=window.URL.createObjectURL(new Blob([q],{type:"text/javascript"})))}}return C(["exports"],function(p){"use strict";function w(e,t){return e(t={exports:{}},t.exports),t.exports}var q=K;function K(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}K.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},K.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},K.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},K.prototype.solveCurveX=function(e,t){var r,f,v,g,x;for(t===void 0&&(t=1e-6),v=e,x=0;x<8;x++){if(g=this.sampleCurveX(v)-e,Math.abs(g)<t)return v;var M=this.sampleCurveDerivativeX(v);if(Math.abs(M)<1e-6)break;v-=g/M}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(g=this.sampleCurveX(v),Math.abs(g-e)<t)return v;e>g?r=v:f=v,v=.5*(f-r)+r}return v},K.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var W=L;function L(e,t){this.x=e,this.y=t}L.prototype={clone:function(){return new L(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},L.convert=function(e){return e instanceof L?e:Array.isArray(e)?new L(e[0],e[1]):e};var N=typeof self!="undefined"?self:{},Ne=Math.pow(2,53)-1;function Ye(e,t,r,f){var v=new q(e,t,r,f);return function(g){return v.solve(g)}}var Je=Ye(.25,.1,.25,1);function rt(e,t,r){return Math.min(r,Math.max(t,e))}function Xt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Gt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var g=v[f];for(var x in g)e[x]=g[x]}return e}var nr=1;function Ut(){return nr++}function At(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Et(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function dr(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function re(e,t){return e.indexOf(t,e.length-t.length)!==-1}function mr(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function wt(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function Ke(e){return Array.isArray(e)?e.map(Ke):typeof e=="object"&&e?mr(e,Ke):e}var Dt={};function Xe(e){Dt[e]||(typeof console!="undefined"&&console.warn(e),Dt[e]=!0)}function Zt(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function yr(e){for(var t=0,r=0,f=e.length,v=f-1,g=void 0,x=void 0;r<f;v=r++)t+=((x=e[v]).x-(g=e[r]).x)*(g.y+x.y);return t}function ur(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ur(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,g,x){var M=g||x;return t[v]=!M||M.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var he=null;function Re(e){if(he==null){var t=e.navigator?e.navigator.userAgent:null;he=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return he}function ge(e){try{var t=N[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var _t,pt,zt,Ft,Dr=N.performance&&N.performance.now?N.performance.now.bind(N.performance):Date.now.bind(Date),pn=N.requestAnimationFrame||N.mozRequestAnimationFrame||N.webkitRequestAnimationFrame||N.msRequestAnimationFrame,mn=N.cancelAnimationFrame||N.mozCancelAnimationFrame||N.webkitCancelAnimationFrame||N.msCancelAnimationFrame,Xi={now:Dr,frame:function(e){var t=pn(e);return{cancel:function(){return mn(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=N.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return _t||(_t=N.document.createElement("a")),_t.href=e,_t.href},hardwareConcurrency:N.navigator&&N.navigator.hardwareConcurrency||4,get devicePixelRatio(){return N.devicePixelRatio},get prefersReducedMotion(){return!!N.matchMedia&&(pt==null&&(pt=N.matchMedia("(prefers-reduced-motion: reduce)")),pt.matches)}},ir={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},pe={supported:!1,testSupport:function(e){!Pe&&Ft&&(Ze?Le(e):zt=e)}},Pe=!1,Ze=!1;function Le(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Ft),e.isContextLost())return;pe.supported=!0}catch(r){}e.deleteTexture(t),Pe=!0}N.document&&((Ft=N.document.createElement("img")).onload=function(){zt&&Le(zt),zt=null,Ze=!0},Ft.onerror=function(){Pe=!0,zt=null},Ft.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var It="01",tr=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function E(e){return e.indexOf("mapbox:")===0}tr.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",It,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},tr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},tr.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},tr.prototype.normalizeStyleURL=function(e,t){if(!E(e))return e;var r=qe(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},tr.prototype.normalizeGlyphsURL=function(e,t){if(!E(e))return e;var r=qe(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},tr.prototype.normalizeSourceURL=function(e,t){if(!E(e))return e;var r=qe(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},tr.prototype.normalizeSpriteURL=function(e,t,r,f){var v=qe(e);return E(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,gt(v))},tr.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!E(e))return e;var r=qe(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Xi.devicePixelRatio>=2||t===512?"@2x":"")+(pe.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var g=0,x=v;g<x.length;g+=1){var M=x[g].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(r.params)||ir.ACCESS_TOKEN;return ir.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},tr.prototype.canonicalizeTileURL=function(e,t){var r=qe(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(g){return!g.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},tr.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&E(t),f=[],v=0,g=e.tiles||[];v<g.length;v+=1){var x=g[v];be(x)?f.push(this.canonicalizeTileURL(x,r)):f.push(x)}return f},tr.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=qe(ir.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!ir.REQUIRE_ACCESS_TOKEN)return gt(e);if(!(t=t||ir.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(g){return g.indexOf("access_token")===-1}),e.params.push("access_token="+t),gt(e)};var Z=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function be(e){return Z.test(e)}var Ge=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qe(e){var t=e.match(Ge);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function gt(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function St(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(N.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var Ct=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Ct.prototype.getStorageKey=function(e){var t,r=St(ir.ACCESS_TOKEN);return t=r&&r.u?N.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):ir.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},Ct.prototype.fetchEventData=function(){var e=ge("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=N.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=N.localStorage.getItem(r);v&&(this.anonId=v)}catch(g){Xe("Unable to read from LocalStorage")}},Ct.prototype.saveEventData=function(){var e=ge("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{N.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&N.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){Xe("Unable to write to LocalStorage")}},Ct.prototype.processRequests=function(e){},Ct.prototype.postEvent=function(e,t,r,f){var v=this;if(ir.EVENTS_URL){var g=qe(ir.EVENTS_URL);g.params.push("access_token="+(f||ir.ACCESS_TOKEN||""));var x={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:It,userId:this.anonId},M=t?Gt(x,t):x,B={url:gt(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Ri(B,function(G){v.pendingRequest=null,r(G),v.saveEventData(),v.processRequests(f)})}},Ct.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Vt,qt,ie=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,g){this.skuToken=v,(ir.EVENTS_URL&&g||ir.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(x){return E(x)||be(x)}))&&this.queueRequest({id:f,timestamp:Date.now()},g)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),g=v.id,x=v.timestamp;g&&this.success[g]||(this.anonId||this.fetchEventData(),Et(this.anonId)||(this.anonId=At()),this.postEvent(x,{skuToken:this.skuToken},function(M){M||g&&(f.success[g]=!0)},r))}},t}(Ct),sr=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){ir.EVENTS_URL&&ir.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return E(v)||be(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=St(ir.ACCESS_TOKEN),g=v?v.u:ir.ACCESS_TOKEN,x=g!==this.eventData.tokenU;Et(this.anonId)||(this.anonId=At(),x=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var B=new Date(this.eventData.lastSuccess),G=new Date(M),$=(M-this.eventData.lastSuccess)/864e5;x=x||$>=1||$<-1||B.getDate()!==G.getDate()}else x=!0;if(!x)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(ne){ne||(f.eventData.lastSuccess=M,f.eventData.tokenU=g)},r)}},t}(Ct)),Mr=sr.postTurnstileEvent.bind(sr),Nr=new ie,tt=Nr.postMapLoadEvent.bind(Nr),mt=500,yt=50;function hr(){N.caches&&!Vt&&(Vt=N.caches.open("mapbox-tiles"))}function Gr(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var Zr,Jr=1/0;function qr(){return Zr==null&&(Zr=N.OffscreenCanvas&&new N.OffscreenCanvas(1,1).getContext("2d")&&typeof N.createImageBitmap=="function"),Zr}var Er={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Er);var Jn=function(e){function t(r,f,v){f===401&&be(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),Wn=ur()?function(){return self.worker&&self.worker.referrer}:function(){return(N.location.protocol==="blob:"?N.parent:N).location.href},Ti,$i,Ji=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Wn())&&!/^\w+:/.test(r))){if(N.fetch&&N.Request&&N.AbortController&&N.Request.prototype.hasOwnProperty("signal"))return function(f,v){var g,x=new N.AbortController,M=new N.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Wn(),signal:x.signal}),B=!1,G=!1,$=(g=M.url).indexOf("sku=")>0&&be(g);f.type==="json"&&M.headers.set("Accept","application/json");var ne=function(_e,Ve,We){if(!G){if(_e&&_e.message!=="SecurityError"&&Xe(_e),Ve&&We)return fe(Ve);var ht=Date.now();N.fetch(M).then(function(et){if(et.ok){var Tt=$?et.clone():null;return fe(et,Tt,ht)}return v(new Jn(et.statusText,et.status,f.url))}).catch(function(et){et.code!==20&&v(new Error(et.message))})}},fe=function(_e,Ve,We){(f.type==="arrayBuffer"?_e.arrayBuffer():f.type==="json"?_e.json():_e.text()).then(function(ht){G||(Ve&&We&&function(et,Tt,Nt){if(hr(),Vt){var cr={status:Tt.status,statusText:Tt.statusText,headers:new N.Headers};Tt.headers.forEach(function(Or,nn){return cr.headers.set(nn,Or)});var fr=Ur(Tt.headers.get("Cache-Control")||"");fr["no-store"]||(fr["max-age"]&&cr.headers.set("Expires",new Date(Nt+1e3*fr["max-age"]).toUTCString()),new Date(cr.headers.get("Expires")).getTime()-Nt<42e4||function(Or,nn){if(qt===void 0)try{new Response(new ReadableStream),qt=!0}catch(_n){qt=!1}qt?nn(Or.body):Or.blob().then(nn)}(Tt,function(Or){var nn=new N.Response(Or,cr);hr(),Vt&&Vt.then(function(_n){return _n.put(Gr(et.url),nn)}).catch(function(_n){return Xe(_n.message)})}))}}(M,Ve,We),B=!0,v(null,ht,_e.headers.get("Cache-Control"),_e.headers.get("Expires")))}).catch(function(ht){G||v(new Error(ht.message))})};return $?function(_e,Ve){if(hr(),!Vt)return Ve(null);var We=Gr(_e.url);Vt.then(function(ht){ht.match(We).then(function(et){var Tt=function(Nt){if(!Nt)return!1;var cr=new Date(Nt.headers.get("Expires")||0),fr=Ur(Nt.headers.get("Cache-Control")||"");return cr>Date.now()&&!fr["no-cache"]}(et);ht.delete(We),Tt&&ht.put(We,et.clone()),Ve(null,et,Tt)}).catch(Ve)}).catch(Ve)}(M,ne):ne(null,null),{cancel:function(){G=!0,B||x.abort()}}}(e,t);if(ur()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var g=new N.XMLHttpRequest;for(var x in g.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(g.responseType="arraybuffer"),f.headers)g.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=f.credentials==="include",g.onerror=function(){v(new Error(g.statusText))},g.onload=function(){if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){var M=g.response;if(f.type==="json")try{M=JSON.parse(g.response)}catch(B){return v(B)}v(null,M,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else v(new Jn(g.statusText,g.status,f.url))},g.send(f.body),{cancel:function(){return g.abort()}}}(e,t)},Pi=function(e,t){return Ji(Gt(e,{type:"arrayBuffer"}),t)},Ri=function(e,t){return Ji(Gt(e,{method:"POST"}),t)},Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ti=[],$i=0;var ce=function(e,t){if(pe.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),$i>=ir.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ti.push(r),r}$i++;var f=!1,v=function(){if(!f)for(f=!0,$i--;Ti.length&&$i<ir.MAX_PARALLEL_IMAGE_REQUESTS;){var x=Ti.shift();x.cancelled||(x.cancel=ce(x.requestParameters,x.callback).cancel)}},g=Pi(e,function(x,M,B,G){v(),x?t(x):M&&(qr()?function($,ne){var fe=new N.Blob([new Uint8Array($)],{type:"image/png"});N.createImageBitmap(fe).then(function(_e){ne(null,_e)}).catch(function(_e){ne(new Error("Could not load image because of "+_e.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,t):function($,ne,fe,_e){var Ve=new N.Image,We=N.URL;Ve.onload=function(){ne(null,Ve),We.revokeObjectURL(Ve.src),Ve.onload=null,N.requestAnimationFrame(function(){Ve.src=Y})},Ve.onerror=function(){return ne(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ht=new N.Blob([new Uint8Array($)],{type:"image/png"});Ve.cacheControl=fe,Ve.expires=_e,Ve.src=$.byteLength?We.createObjectURL(ht):Y}(M,t,B,G))});return{cancel:function(){g.cancel(),v()}}};function me(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function z(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var oe=function(e,t){t===void 0&&(t={}),Gt(this,t),this.type=e},de=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Gt({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(oe),Ae=function(){};Ae.prototype.on=function(e,t){return this._listeners=this._listeners||{},me(e,t,this._listeners),this},Ae.prototype.off=function(e,t){return z(e,t,this._listeners),z(e,t,this._oneTimeListeners),this},Ae.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},me(e,t,this._oneTimeListeners),this},Ae.prototype.fire=function(e,t){typeof e=="string"&&(e=new oe(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var g=0,x=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];g<x.length;g+=1){var M=x[g];z(r,M,this._oneTimeListeners),M.call(this,e)}var B=this._eventedParent;B&&(Gt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),B.fire(e))}else e instanceof de&&console.error(e.error);return this},Ae.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Ae.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var se={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ee=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function dt(e){var t=e.value;return t?[new Ee(e.key,t,"constants have been deprecated as of v8")]:[]}function br(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var g=v[f];for(var x in g)e[x]=g[x]}return e}function Ht(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Qt(e){if(Array.isArray(e))return e.map(Qt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=Qt(e[r]);return t}return Ht(e)}var Rr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),kn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};kn.prototype.concat=function(e){return new kn(this,e)},kn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},kn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Ln={kind:"null"},$t={kind:"number"},Cn={kind:"string"},sn={kind:"boolean"},an={kind:"color"},Ii={kind:"object"},xn={kind:"value"},Ai={kind:"collator"},Qi={kind:"formatted"},li={kind:"resolvedImage"};function Yi(e,t){return{kind:"array",itemType:e,N:t}}function Bi(e){if(e.kind==="array"){var t=Bi(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var wi=[Ln,$t,Cn,sn,an,Qi,Ii,Yi(xn),li];function sa(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!sa(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=wi;r<f.length;r+=1)if(!sa(f[r],t))return null}}return"Expected "+Bi(e)+" but found "+Bi(t)+" instead."}function Fi(e,t){return t.some(function(r){return r.kind===e.kind})}function ni(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var Di=w(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(M){return(M=Math.round(M))<0?0:M>255?255:M}function v(M){return f(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function g(M){return(B=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:B>1?1:B;var B}function x(M,B,G){return G<0?G+=1:G>1&&(G-=1),6*G<1?M+(B-M)*G*6:2*G<1?B:3*G<2?M+(B-M)*(2/3-G)*6:M}try{t.parseCSSColor=function(M){var B,G=M.replace(/ /g,"").toLowerCase();if(G in r)return r[G].slice();if(G[0]==="#")return G.length===4?(B=parseInt(G.substr(1),16))>=0&&B<=4095?[(3840&B)>>4|(3840&B)>>8,240&B|(240&B)>>4,15&B|(15&B)<<4,1]:null:G.length===7&&(B=parseInt(G.substr(1),16))>=0&&B<=16777215?[(16711680&B)>>16,(65280&B)>>8,255&B,1]:null;var $=G.indexOf("("),ne=G.indexOf(")");if($!==-1&&ne+1===G.length){var fe=G.substr(0,$),_e=G.substr($+1,ne-($+1)).split(","),Ve=1;switch(fe){case"rgba":if(_e.length!==4)return null;Ve=g(_e.pop());case"rgb":return _e.length!==3?null:[v(_e[0]),v(_e[1]),v(_e[2]),Ve];case"hsla":if(_e.length!==4)return null;Ve=g(_e.pop());case"hsl":if(_e.length!==3)return null;var We=(parseFloat(_e[0])%360+360)%360/360,ht=g(_e[1]),et=g(_e[2]),Tt=et<=.5?et*(ht+1):et+ht-et*ht,Nt=2*et-Tt;return[f(255*x(Nt,Tt,We+1/3)),f(255*x(Nt,Tt,We)),f(255*x(Nt,Tt,We-1/3)),Ve];default:return null}}return null}}catch(M){}}).parseCSSColor,Ei=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};Ei.parse=function(e){if(e){if(e instanceof Ei)return e;if(typeof e=="string"){var t=Di(e);if(t)return new Ei(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Ei.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},Ei.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Ei.black=new Ei(0,0,0,1),Ei.white=new Ei(1,1,1,1),Ei.transparent=new Ei(0,0,0,0),Ei.red=new Ei(1,0,0,1);var no=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};no.prototype.compare=function(e,t){return this.collator.compare(e,t)},no.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ho=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},ta=function(e){this.sections=e};ta.fromString=function(e){return new ta([new ho(e,null,null,null,null)])},ta.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},ta.factory=function(e){return e instanceof ta?e:ta.fromString(e)},ta.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},ta.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var Vi=function(e){this.name=e.name,this.available=e.available};function Ns(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function tu(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Ei||e instanceof no||e instanceof ta||e instanceof Vi)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!tu(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!tu(e[f]))return!1;return!0}return!1}function Aa(e){if(e===null)return Ln;if(typeof e=="string")return Cn;if(typeof e=="boolean")return sn;if(typeof e=="number")return $t;if(e instanceof Ei)return an;if(e instanceof no)return Ai;if(e instanceof ta)return Qi;if(e instanceof Vi)return li;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var g=Aa(v[f]);if(t){if(t===g)continue;t=xn;break}t=g}return Yi(t||xn,r)}return Ii}function No(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Ei||e instanceof ta||e instanceof Vi?e.toString():JSON.stringify(e)}Vi.prototype.toString=function(){return this.name},Vi.fromString=function(e){return e?new Vi({name:e,available:!1}):null},Vi.prototype.serialize=function(){return["image",this.name]};var Gi=function(e,t){this.type=e,this.value=t};Gi.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!tu(e[1]))return t.error("invalid value");var r=e[1],f=Aa(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Gi(f,r)},Gi.prototype.evaluate=function(){return this.value},Gi.prototype.eachChild=function(){},Gi.prototype.outputDefined=function(){return!0},Gi.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ei?["rgba"].concat(this.value.toArray()):this.value instanceof ta?this.value.serialize():this.value};var Wa=function(e){this.name="ExpressionEvaluationError",this.message=e};Wa.prototype.toJSON=function(){return this.message};var oo={string:Cn,number:$t,boolean:sn,object:Ii},ma=function(e,t){this.type=e,this.args=t};ma.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var g,x;if(e.length>2){var M=e[1];if(typeof M!="string"||!(M in oo)||M==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);g=oo[M],f++}else g=xn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);x=e[2],f++}r=Yi(g,x)}else r=oo[v];for(var B=[];f<e.length;f++){var G=t.parse(e[f],f,xn);if(!G)return null;B.push(G)}return new ma(r,B)},ma.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!sa(this.type,Aa(r)))return r;if(t===this.args.length-1)throw new Wa("Expected value to be of type "+Bi(this.type)+", but found "+Bi(Aa(r))+" instead.")}return null},ma.prototype.eachChild=function(e){this.args.forEach(e)},ma.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},ma.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Lo=function(e){this.type=Qi,this.sections=e};Lo.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,g=1;g<=e.length-1;++g){var x=e[g];if(v&&typeof x=="object"&&!Array.isArray(x)){v=!1;var M=null;if(x["font-scale"]&&!(M=t.parse(x["font-scale"],1,$t)))return null;var B=null;if(x["text-font"]&&!(B=t.parse(x["text-font"],1,Yi(Cn))))return null;var G=null;if(x["text-color"]&&!(G=t.parse(x["text-color"],1,an)))return null;var $=f[f.length-1];$.scale=M,$.font=B,$.textColor=G}else{var ne=t.parse(e[g],1,xn);if(!ne)return null;var fe=ne.type.kind;if(fe!=="string"&&fe!=="value"&&fe!=="null"&&fe!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:ne,scale:null,font:null,textColor:null})}}return new Lo(f)},Lo.prototype.evaluate=function(e){return new ta(this.sections.map(function(t){var r=t.content.evaluate(e);return Aa(r)===li?new ho("",r,null,null,null):new ho(No(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Lo.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},Lo.prototype.outputDefined=function(){return!1},Lo.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var ka=function(e){this.type=li,this.input=e};ka.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,Cn);return r?new ka(r):t.error("No image name provided.")},ka.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=Vi.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},ka.prototype.eachChild=function(e){e(this.input)},ka.prototype.outputDefined=function(){return!1},ka.prototype.serialize=function(){return["image",this.input.serialize()]};var bs={"to-boolean":sn,"to-color":an,"to-number":$t,"to-string":Cn},ki=function(e,t){this.type=e,this.args=t};ki.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=bs[r],v=[],g=1;g<e.length;g++){var x=t.parse(e[g],g,xn);if(!x)return null;v.push(x)}return new ki(f,v)},ki.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof Ei)return t;if(typeof t=="string"){var g=e.parseColor(t);if(g)return g}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":Ns(t[0],t[1],t[2],t[3])))return new Ei(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Wa(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var x=null,M=0,B=this.args;M<B.length;M+=1){if((x=B[M].evaluate(e))===null)return 0;var G=Number(x);if(!isNaN(G))return G}throw new Wa("Could not convert "+JSON.stringify(x)+" to number.")}return this.type.kind==="formatted"?ta.fromString(No(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Vi.fromString(No(this.args[0].evaluate(e))):No(this.args[0].evaluate(e))},ki.prototype.eachChild=function(e){this.args.forEach(e)},ki.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},ki.prototype.serialize=function(){if(this.type.kind==="formatted")return new Lo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ka(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ko=["Unknown","Point","LineString","Polygon"],ga=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ga.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ga.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Ko[this.feature.type]:this.feature.type:null},ga.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ga.prototype.canonicalID=function(){return this.canonical},ga.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ga.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ei.parse(e)),t};var po=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};po.prototype.evaluate=function(e){return this._evaluate(e,this.args)},po.prototype.eachChild=function(e){this.args.forEach(e)},po.prototype.outputDefined=function(){return!1},po.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},po.parse=function(e,t){var r,f=e[0],v=po.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var g=Array.isArray(v)?v[0]:v.type,x=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,M=x.filter(function(ai){var Zn=ai[0];return!Array.isArray(Zn)||Zn.length===e.length-1}),B=null,G=0,$=M;G<$.length;G+=1){var ne=$[G],fe=ne[0],_e=ne[1];B=new rs(t.registry,t.path,null,t.scope);for(var Ve=[],We=!1,ht=1;ht<e.length;ht++){var et=e[ht],Tt=Array.isArray(fe)?fe[ht-1]:fe.type,Nt=B.parse(et,1+Ve.length,Tt);if(!Nt){We=!0;break}Ve.push(Nt)}if(!We)if(Array.isArray(fe)&&fe.length!==Ve.length)B.error("Expected "+fe.length+" arguments, but found "+Ve.length+" instead.");else{for(var cr=0;cr<Ve.length;cr++){var fr=Array.isArray(fe)?fe[cr]:fe.type,Or=Ve[cr];B.concat(cr+1).checkSubtype(fr,Or.type)}if(B.errors.length===0)return new po(f,g,_e,Ve)}}if(M.length===1)(r=t.errors).push.apply(r,B.errors);else{for(var nn=(M.length?M:x).map(function(ai){var Zn;return Zn=ai[0],Array.isArray(Zn)?"("+Zn.map(Bi).join(", ")+")":"("+Bi(Zn.type)+"...)"}).join(" | "),_n=[],hi=1;hi<e.length;hi++){var Dn=t.parse(e[hi],1+_n.length);if(!Dn)return null;_n.push(Bi(Dn.type))}t.error("Expected arguments of type "+nn+", but found ("+_n.join(", ")+") instead.")}return null},po.register=function(e,t){for(var r in po.definitions=t,t)e[r]=po};var Da=function(e,t,r){this.type=Ai,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function So(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function ye(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function De(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function ct(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function Yt(e,t){for(var r,f,v,g,x,M,B,G=!1,$=0,ne=t.length;$<ne;$++)for(var fe=t[$],_e=0,Ve=fe.length;_e<Ve-1;_e++){if((g=(r=e)[0]-(f=fe[_e])[0])*(B=r[1]-(v=fe[_e+1])[1])-(M=r[0]-v[0])*(x=r[1]-f[1])==0&&g*M<=0&&x*B<=0)return!1;ct(e,fe[_e],fe[_e+1])&&(G=!G)}return G}function Wr(e,t){for(var r=0;r<t.length;r++)if(Yt(e,t[r]))return!0;return!1}function Qn(e,t,r,f){var v=f[0]-r[0],g=f[1]-r[1],x=(e[0]-r[0])*g-v*(e[1]-r[1]),M=(t[0]-r[0])*g-v*(t[1]-r[1]);return x>0&&M<0||x<0&&M>0}function Si(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var g=v[f],x=0;x<g.length-1;++x)if((ne=[($=g[x+1])[0]-(G=g[x])[0],$[1]-G[1]])[0]*(fe=[(B=t)[0]-(M=e)[0],B[1]-M[1]])[1]-ne[1]*fe[0]!=0&&Qn(M,B,G,$)&&Qn(G,$,M,B))return!0;var M,B,G,$,ne,fe;return!1}function Za(e,t){for(var r=0;r<e.length;++r)if(!Yt(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(Si(e[f],e[f+1],t))return!1;return!0}function vo(e,t){for(var r=0;r<t.length;r++)if(Za(e,t[r]))return!0;return!1}function so(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var g=[],x=0;x<e[v].length;x++){var M=De(e[v][x],r);So(t,M),g.push(M)}f.push(g)}return f}function es(e,t,r){for(var f=[],v=0;v<e.length;v++){var g=so(e[v],t,r);f.push(g)}return f}function Hs(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,g=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;g===0&&(g=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=g}So(t,e)}function ja(e,t,r,f){for(var v=8192*Math.pow(2,f.z),g=[8192*f.x,8192*f.y],x=[],M=0,B=e;M<B.length;M+=1)for(var G=0,$=B[M];G<$.length;G+=1){var ne=$[G],fe=[ne.x+g[0],ne.y+g[1]];Hs(fe,t,r,v),x.push(fe)}return x}function Bu(e,t,r,f){for(var v,g=8192*Math.pow(2,f.z),x=[8192*f.x,8192*f.y],M=[],B=0,G=e;B<G.length;B+=1){for(var $=[],ne=0,fe=G[B];ne<fe.length;ne+=1){var _e=fe[ne],Ve=[_e.x+x[0],_e.y+x[1]];So(t,Ve),$.push(Ve)}M.push($)}if(t[2]-t[0]<=g/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var We=0,ht=M;We<ht.length;We+=1)for(var et=0,Tt=ht[We];et<Tt.length;et+=1)Hs(Tt[et],t,r,g)}return M}Da.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,sn);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,sn);if(!v)return null;var g=null;return r.locale&&!(g=t.parse(r.locale,1,Cn))?null:new Da(f,v,g)},Da.prototype.evaluate=function(e){return new no(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},Da.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},Da.prototype.outputDefined=function(){return!1},Da.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var ts=function(e,t){this.type=sn,this.geojson=e,this.geometries=t};function zo(e){if(e instanceof po&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof ts)return!1;var t=!0;return e.eachChild(function(r){t&&!zo(r)&&(t=!1)}),t}function uo(e){if(e instanceof po&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!uo(r)&&(t=!1)}),t}function ii(e,t){if(e instanceof po&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!ii(f,t)&&(r=!1)}),r}ts.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(tu(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new ts(r,r.features[f].geometry)}else if(r.type==="Feature"){var g=r.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new ts(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new ts(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ts.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(r.type==="Polygon"){var x=so(r.coordinates,v,g),M=ja(t.geometry(),f,v,g);if(!ye(f,v))return!1;for(var B=0,G=M;B<G.length;B+=1)if(!Yt(G[B],x))return!1}if(r.type==="MultiPolygon"){var $=es(r.coordinates,v,g),ne=ja(t.geometry(),f,v,g);if(!ye(f,v))return!1;for(var fe=0,_e=ne;fe<_e.length;fe+=1)if(!Wr(_e[fe],$))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(r.type==="Polygon"){var x=so(r.coordinates,v,g),M=Bu(t.geometry(),f,v,g);if(!ye(f,v))return!1;for(var B=0,G=M;B<G.length;B+=1)if(!Za(G[B],x))return!1}if(r.type==="MultiPolygon"){var $=es(r.coordinates,v,g),ne=Bu(t.geometry(),f,v,g);if(!ye(f,v))return!1;for(var fe=0,_e=ne;fe<_e.length;fe+=1)if(!vo(_e[fe],$))return!1}return!0}(e,this.geometries)}return!1},ts.prototype.eachChild=function(){},ts.prototype.outputDefined=function(){return!0},ts.prototype.serialize=function(){return["within",this.geojson]};var ms=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};ms.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new ms(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},ms.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},ms.prototype.eachChild=function(){},ms.prototype.outputDefined=function(){return!1},ms.prototype.serialize=function(){return["var",this.name]};var rs=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new kn),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(g){return"["+g+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function Rs(e,t){for(var r,f=e.length-1,v=0,g=f,x=0;v<=g;)if((r=e[x=Math.floor((v+g)/2)])<=t){if(x===f||t<e[x+1])return x;v=x+1}else{if(!(r>t))throw new Wa("Input is not a number.");g=x-1}return 0}rs.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},rs.prototype._parse=function(e,t){function r(G,$,ne){return ne==="assert"?new ma($,[G]):ne==="coerce"?new ki($,[G]):G}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var g=v.parse(e,this);if(!g)return null;if(this.expectedType){var x=this.expectedType,M=g.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||M.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(x,M))return null}else g=r(g,x,t.typeAnnotation||"coerce");else g=r(g,x,t.typeAnnotation||"assert")}if(!(g instanceof Gi)&&g.type.kind!=="resolvedImage"&&function G($){if($ instanceof ms)return G($.boundExpression);if($ instanceof po&&$.name==="error"||$ instanceof Da||$ instanceof ts)return!1;var ne=$ instanceof ki||$ instanceof ma,fe=!0;return $.eachChild(function(_e){fe=ne?fe&&G(_e):fe&&_e instanceof Gi}),!!fe&&zo($)&&ii($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(g)){var B=new ga;try{g=new Gi(g.type,g.evaluate(B))}catch(G){return this.error(G.message),null}}return g}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},rs.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new rs(this.registry,f,t||null,v,this.errors)},rs.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new Rr(f,e))},rs.prototype.checkSubtype=function(e,t){var r=sa(e,t);return r&&this.error(r),r};var ns=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var g=v[f],x=g[1];this.labels.push(g[0]),this.outputs.push(x)}};function Ta(e,t,r){return e*(1-r)+t*r}ns.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,$t);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var g=1;g<e.length;g+=2){var x=g===1?-1/0:e[g],M=e[g+1],B=g,G=g+1;if(typeof x!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(f.length&&f[f.length-1][0]>=x)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);var $=t.parse(M,G,v);if(!$)return null;v=v||$.type,f.push([x,$])}return new ns(v,r,f)},ns.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[Rs(t,f)].evaluate(e)},ns.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ns.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ns.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var lo=Object.freeze({__proto__:null,number:Ta,color:function(e,t,r){return new Ei(Ta(e.r,t.r,r),Ta(e.g,t.g,r),Ta(e.b,t.b,r),Ta(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return Ta(f,t[v],r)})}}),_l=6/29*3*(6/29),xl=Math.PI/180,Nu=180/Math.PI;function Gl(e){return e>.008856451679035631?Math.pow(e,1/3):e/_l+4/29}function wu(e){return e>6/29?e*e*e:_l*(e-4/29)}function co(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function zs(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ss(e){var t=zs(e.r),r=zs(e.g),f=zs(e.b),v=Gl((.4124564*t+.3575761*r+.1804375*f)/.95047),g=Gl((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*g-16,a:500*(v-g),b:200*(g-Gl((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function m(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*wu(t),r=.95047*wu(r),f=1.08883*wu(f),new Ei(co(3.2404542*r-1.5371385*t-.4985314*f),co(-.969266*r+1.8760108*t+.041556*f),co(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function A(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var j={forward:Ss,reverse:m,interpolate:function(e,t,r){return{l:Ta(e.l,t.l,r),a:Ta(e.a,t.a,r),b:Ta(e.b,t.b,r),alpha:Ta(e.alpha,t.alpha,r)}}},O={forward:function(e){var t=Ss(e),r=t.l,f=t.a,v=t.b,g=Math.atan2(v,f)*Nu;return{h:g<0?g+360:g,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*xl,r=e.c;return m({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:A(e.h,t.h,r),c:Ta(e.c,t.c,r),l:Ta(e.l,t.l,r),alpha:Ta(e.alpha,t.alpha,r)}}},le=Object.freeze({__proto__:null,lab:j,hcl:O}),Ie=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var g=0,x=v;g<x.length;g+=1){var M=x[g],B=M[1];this.labels.push(M[0]),this.outputs.push(B)}};function ut(e,t,r,f){var v=f-r,g=e-r;return v===0?0:t===1?g/v:(Math.pow(t,g)-1)/(Math.pow(t,v)-1)}Ie.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=ut(t,e.base,r,f);else if(e.name==="linear")v=ut(t,1,r,f);else if(e.name==="cubic-bezier"){var g=e.controlPoints;v=new q(g[0],g[1],g[2],g[3]).solve(ut(t,1,r,f))}return v},Ie.parse=function(e,t){var r=e[0],f=e[1],v=e[2],g=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var x=f[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:x}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var M=f.slice(1);if(M.length!==4||M.some(function(ht){return typeof ht!="number"||ht<0||ht>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:M}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,$t)))return null;var B=[],G=null;r==="interpolate-hcl"||r==="interpolate-lab"?G=an:t.expectedType&&t.expectedType.kind!=="value"&&(G=t.expectedType);for(var $=0;$<g.length;$+=2){var ne=g[$],fe=g[$+1],_e=$+3,Ve=$+4;if(typeof ne!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_e);if(B.length&&B[B.length-1][0]>=ne)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',_e);var We=t.parse(fe,Ve,G);if(!We)return null;G=G||We.type,B.push([ne,We])}return G.kind==="number"||G.kind==="color"||G.kind==="array"&&G.itemType.kind==="number"&&typeof G.N=="number"?new Ie(G,r,f,v,B):t.error("Type "+Bi(G)+" is not interpolatable.")},Ie.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var g=Rs(t,f),x=Ie.interpolationFactor(this.interpolation,f,t[g],t[g+1]),M=r[g].evaluate(e),B=r[g+1].evaluate(e);return this.operator==="interpolate"?lo[this.type.kind.toLowerCase()](M,B,x):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(M),O.forward(B),x)):j.reverse(j.interpolate(j.forward(M),j.forward(B),x))},Ie.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Ie.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Ie.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Pt=function(e,t){this.type=e,this.args=t};Pt.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],g=0,x=e.slice(1);g<x.length;g+=1){var M=t.parse(x[g],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!M)return null;r=r||M.type,v.push(M)}var B=f&&v.some(function(G){return sa(f,G.type)});return new Pt(B?xn:r,v)},Pt.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,g=this.args;v<g.length&&(f++,(r=g[v].evaluate(e))&&r instanceof Vi&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},Pt.prototype.eachChild=function(e){this.args.forEach(e)},Pt.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Pt.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ot=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Ot.prototype.evaluate=function(e){return this.result.evaluate(e)},Ot.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Ot.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var g=t.parse(e[f+1],f+1);if(!g)return null;r.push([v,g])}var x=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return x?new Ot(r,x):null},Ot.prototype.outputDefined=function(){return this.result.outputDefined()},Ot.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var Ar=function(e,t,r){this.type=e,this.index=t,this.input=r};Ar.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,$t),f=t.parse(e[2],2,Yi(t.expectedType||xn));return r&&f?new Ar(f.type.itemType,r,f):null},Ar.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Wa("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Wa("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Wa("Array index must be an integer, but found "+t+" instead.");return r[t]},Ar.prototype.eachChild=function(e){e(this.index),e(this.input)},Ar.prototype.outputDefined=function(){return!1},Ar.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var jr=function(e,t){this.type=sn,this.needle=e,this.haystack=t};jr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,xn),f=t.parse(e[2],2,xn);return r&&f?Fi(r.type,[sn,Cn,$t,Ln,xn])?new jr(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Bi(r.type)+" instead"):null},jr.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!ni(t,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+Bi(Aa(t))+" instead.");if(!ni(r,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+Bi(Aa(r))+" instead.");return r.indexOf(t)>=0},jr.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},jr.prototype.outputDefined=function(){return!0},jr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var qn=function(e,t,r){this.type=$t,this.needle=e,this.haystack=t,this.fromIndex=r};qn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,xn),f=t.parse(e[2],2,xn);if(!r||!f)return null;if(!Fi(r.type,[sn,Cn,$t,Ln,xn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Bi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,$t);return v?new qn(r,f,v):null}return new qn(r,f)},qn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!ni(t,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+Bi(Aa(t))+" instead.");if(!ni(r,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+Bi(Aa(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},qn.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},qn.prototype.outputDefined=function(){return!1},qn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var gi=function(e,t,r,f,v,g){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=g};gi.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},g=[],x=2;x<e.length-1;x+=2){var M=e[x],B=e[x+1];Array.isArray(M)||(M=[M]);var G=t.concat(x);if(M.length===0)return G.error("Expected at least one branch label.");for(var $=0,ne=M;$<ne.length;$+=1){var fe=ne[$];if(typeof fe!="number"&&typeof fe!="string")return G.error("Branch labels must be numbers or strings.");if(typeof fe=="number"&&Math.abs(fe)>Number.MAX_SAFE_INTEGER)return G.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof fe=="number"&&Math.floor(fe)!==fe)return G.error("Numeric branch labels must be integer values.");if(r){if(G.checkSubtype(r,Aa(fe)))return null}else r=Aa(fe);if(v[String(fe)]!==void 0)return G.error("Branch labels must be unique.");v[String(fe)]=g.length}var _e=t.parse(B,x,f);if(!_e)return null;f=f||_e.type,g.push(_e)}var Ve=t.parse(e[1],1,xn);if(!Ve)return null;var We=t.parse(e[e.length-1],e.length-1,f);return We?Ve.type.kind!=="value"&&t.concat(1).checkSubtype(r,Ve.type)?null:new gi(r,f,Ve,v,g,We):null},gi.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(Aa(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},gi.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},gi.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},gi.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,g=Object.keys(this.cases).sort();v<g.length;v+=1){var x=g[v];(ne=f[this.cases[x]])===void 0?(f[this.cases[x]]=r.length,r.push([this.cases[x],[x]])):r[ne][1].push(x)}for(var M=function(_e){return e.inputType.kind==="number"?Number(_e):_e},B=0,G=r;B<G.length;B+=1){var $=G[B],ne=$[0],fe=$[1];t.push(fe.length===1?M(fe[0]):fe.map(M)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var wn=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};wn.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var g=t.parse(e[v],v,sn);if(!g)return null;var x=t.parse(e[v+1],v+1,r);if(!x)return null;f.push([g,x]),r=r||x.type}var M=t.parse(e[e.length-1],e.length-1,r);return M?new wn(r,f,M):null},wn.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},wn.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},wn.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},wn.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var fa=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function Ni(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Oa(e,t,r,f){return f.compare(t,r)===0}function ua(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(g,x,M){this.type=sn,this.lhs=g,this.rhs=x,this.collator=M,this.hasUntypedArgument=g.type.kind==="value"||x.type.kind==="value"}return v.parse=function(g,x){if(g.length!==3&&g.length!==4)return x.error("Expected two or three arguments.");var M=g[0],B=x.parse(g[1],1,xn);if(!B)return null;if(!Ni(M,B.type))return x.concat(1).error('"'+M+`" comparisons are not supported for type '`+Bi(B.type)+"'.");var G=x.parse(g[2],2,xn);if(!G)return null;if(!Ni(M,G.type))return x.concat(2).error('"'+M+`" comparisons are not supported for type '`+Bi(G.type)+"'.");if(B.type.kind!==G.type.kind&&B.type.kind!=="value"&&G.type.kind!=="value")return x.error("Cannot compare types '"+Bi(B.type)+"' and '"+Bi(G.type)+"'.");f&&(B.type.kind==="value"&&G.type.kind!=="value"?B=new ma(G.type,[B]):B.type.kind!=="value"&&G.type.kind==="value"&&(G=new ma(B.type,[G])));var $=null;if(g.length===4){if(B.type.kind!=="string"&&G.type.kind!=="string"&&B.type.kind!=="value"&&G.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(!($=x.parse(g[3],3,Ai)))return null}return new v(B,G,$)},v.prototype.evaluate=function(g){var x=this.lhs.evaluate(g),M=this.rhs.evaluate(g);if(f&&this.hasUntypedArgument){var B=Aa(x),G=Aa(M);if(B.kind!==G.kind||B.kind!=="string"&&B.kind!=="number")throw new Wa('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+B.kind+", "+G.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var $=Aa(x),ne=Aa(M);if($.kind!=="string"||ne.kind!=="string")return t(g,x,M)}return this.collator?r(g,x,M,this.collator.evaluate(g)):t(g,x,M)},v.prototype.eachChild=function(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var g=[e];return this.eachChild(function(x){g.push(x.serialize())}),g},v}()}fa.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,xn),f=t.parse(e[2],2,$t);if(!r||!f)return null;if(!Fi(r.type,[Yi(xn),Cn,xn]))return t.error("Expected first argument to be of type array or string, but found "+Bi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,$t);return v?new fa(r.type,r,f,v):null}return new fa(r.type,r,f)},fa.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!ni(t,["string","array"]))throw new Wa("Expected first argument to be of type array or string, but found "+Bi(Aa(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},fa.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},fa.prototype.outputDefined=function(){return!1},fa.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Xa=ua("==",function(e,t,r){return t===r},Oa),is=ua("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!Oa(0,t,r,f)}),Es=ua("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),Au=ua(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),cu=ua("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),nl=ua(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),Ws=function(e,t,r,f,v){this.type=Cn,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};Ws.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,$t);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,Cn)))return null;var g=null;if(f.currency&&!(g=t.parse(f.currency,1,Cn)))return null;var x=null;if(f["min-fraction-digits"]&&!(x=t.parse(f["min-fraction-digits"],1,$t)))return null;var M=null;return f["max-fraction-digits"]&&!(M=t.parse(f["max-fraction-digits"],1,$t))?null:new Ws(r,v,g,x,M)},Ws.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Ws.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Ws.prototype.outputDefined=function(){return!1},Ws.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Xs=function(e){this.type=$t,this.input=e};Xs.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Bi(r.type)+" instead."):new Xs(r):null},Xs.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Wa("Expected value to be of type string or array, but found "+Bi(Aa(t))+" instead.")},Xs.prototype.eachChild=function(e){e(this.input)},Xs.prototype.outputDefined=function(){return!1},Xs.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ys={"==":Xa,"!=":is,">":Au,"<":Es,">=":nl,"<=":cu,array:ma,at:Ar,boolean:ma,case:wn,coalesce:Pt,collator:Da,format:Lo,image:ka,in:jr,"index-of":qn,interpolate:Ie,"interpolate-hcl":Ie,"interpolate-lab":Ie,length:Xs,let:Ot,literal:Gi,match:gi,number:ma,"number-format":Ws,object:ma,slice:fa,step:ns,string:ma,"to-boolean":ki,"to-color":ki,"to-number":ki,"to-string":ki,var:ms,within:ts};function za(e,t){var r=t[0],f=t[1],v=t[2],g=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var x=g?g.evaluate(e):1,M=Ns(r,f,v,x);if(M)throw new Wa(M);return new Ei(r/255*x,f/255*x,v/255*x,x)}function il(e,t){return e in t}function al(e,t){var r=t[e];return r===void 0?null:r}function ds(e){return{type:e}}function Hl(e){return{result:"success",value:e}}function fu(e){return{result:"error",value:e}}function Ds(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function mc(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Tu(e){return!!e.expression&&e.expression.interpolated}function Ma(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function ol(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Fc(e){return e}function hu(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function Wl(e,t,r,f,v){return hu(typeof r===v?f[r]:void 0,e.default,t.default)}function Bc(e,t,r){if(Ma(r)!=="number")return hu(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=Rs(e.stops.map(function(g){return g[0]}),r);return e.stops[v][1]}function zu(e,t,r){var f=e.base!==void 0?e.base:1;if(Ma(r)!=="number")return hu(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var g=Rs(e.stops.map(function(ne){return ne[0]}),r),x=function(ne,fe,_e,Ve){var We=Ve-_e,ht=ne-_e;return We===0?0:fe===1?ht/We:(Math.pow(fe,ht)-1)/(Math.pow(fe,We)-1)}(r,f,e.stops[g][0],e.stops[g+1][0]),M=e.stops[g][1],B=e.stops[g+1][1],G=lo[t.type]||Fc;if(e.colorSpace&&e.colorSpace!=="rgb"){var $=le[e.colorSpace];G=function(ne,fe){return $.reverse($.interpolate($.forward(ne),$.forward(fe),x))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var ne=[],fe=arguments.length;fe--;)ne[fe]=arguments[fe];var _e=M.evaluate.apply(void 0,ne),Ve=B.evaluate.apply(void 0,ne);if(_e!==void 0&&Ve!==void 0)return G(_e,Ve,x)}}:G(M,B,x)}function Xl(e,t,r){return t.type==="color"?r=Ei.parse(r):t.type==="formatted"?r=ta.fromString(r.toString()):t.type==="resolvedImage"?r=Vi.fromString(r.toString()):Ma(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),hu(r,e.default,t.default)}po.register(Ys,{error:[{kind:"error"},[Cn],function(e,t){throw new Wa(t[0].evaluate(e))}],typeof:[Cn,[xn],function(e,t){return Bi(Aa(t[0].evaluate(e)))}],"to-rgba":[Yi($t,4),[an],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[an,[$t,$t,$t],za],rgba:[an,[$t,$t,$t,$t],za],has:{type:sn,overloads:[[[Cn],function(e,t){return il(t[0].evaluate(e),e.properties())}],[[Cn,Ii],function(e,t){var r=t[1];return il(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:xn,overloads:[[[Cn],function(e,t){return al(t[0].evaluate(e),e.properties())}],[[Cn,Ii],function(e,t){var r=t[1];return al(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[xn,[Cn],function(e,t){return al(t[0].evaluate(e),e.featureState||{})}],properties:[Ii,[],function(e){return e.properties()}],"geometry-type":[Cn,[],function(e){return e.geometryType()}],id:[xn,[],function(e){return e.id()}],zoom:[$t,[],function(e){return e.globals.zoom}],"heatmap-density":[$t,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[$t,[],function(e){return e.globals.lineProgress||0}],accumulated:[xn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[$t,ds($t),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[$t,ds($t),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:$t,overloads:[[[$t,$t],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[$t],function(e,t){return-t[0].evaluate(e)}]]},"/":[$t,[$t,$t],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[$t,[$t,$t],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[$t,[],function(){return Math.LN2}],pi:[$t,[],function(){return Math.PI}],e:[$t,[],function(){return Math.E}],"^":[$t,[$t,$t],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[$t,[$t],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[$t,[$t],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[$t,[$t],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[$t,[$t],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[$t,[$t],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[$t,[$t],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[$t,[$t],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[$t,[$t],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[$t,[$t],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[$t,[$t],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[$t,ds($t),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[$t,ds($t),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[$t,[$t],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[$t,[$t],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[$t,[$t],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[$t,[$t],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[sn,[Cn,xn],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[sn,[xn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[sn,[Cn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[sn,[Cn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v<g}],"filter-id-<":[sn,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[sn,[Cn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v>g}],"filter-id->":[sn,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[sn,[Cn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v<=g}],"filter-id-<=":[sn,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[sn,[Cn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v>=g}],"filter-id->=":[sn,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[sn,[xn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[sn,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[sn,[Yi(Cn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[sn,[Yi(xn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[sn,[Cn,Yi(xn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[sn,[Cn,Yi(xn)],function(e,t){var r=t[0],f=t[1];return function(v,g,x,M){for(;x<=M;){var B=x+M>>1;if(g[B]===v)return!0;g[B]>v?M=B-1:x=B+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:sn,overloads:[[[sn,sn],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[ds(sn),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:sn,overloads:[[[sn,sn],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[ds(sn),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[sn,[sn],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[sn,[Cn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[Cn,[Cn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[Cn,[Cn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[Cn,ds(xn),function(e,t){return t.map(function(r){return No(r.evaluate(e))}).join("")}],"resolved-locale":[Cn,[Ai],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var bl=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new ga,this._defaultValue=t?function(r){return r.type==="color"&&ol(r.default)?new Ei(0,0,0,0):r.type==="color"?Ei.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function Sl(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Ys}function sl(e,t){var r=new rs(Ys,[],t?function(v){var g={color:an,string:Cn,number:$t,enum:Cn,boolean:sn,formatted:Qi,resolvedImage:li};return v.type==="array"?Yi(g[v.value]||xn,v.length):g[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Hl(new bl(f,t)):fu(r.errors)}bl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)},bl.prototype.evaluate=function(e,t,r,f,v,g){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=g||null;try{var x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Wa("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(x)+" instead.");return x}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var El=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!uo(t.expression)};El.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,g)},El.prototype.evaluate=function(e,t,r,f,v,g){return this._styleExpression.evaluate(e,t,r,f,v,g)};var Uu=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!uo(t.expression),this.interpolationType=f};function pu(e,t){if((e=sl(e,t)).result==="error")return e;var r=e.value.expression,f=zo(r);if(!f&&!Ds(t))return fu([new Rr("","data expressions not supported")]);var v=ii(r,["zoom"]);if(!v&&!mc(t))return fu([new Rr("","zoom expressions not supported")]);var g=function x(M){var B=null;if(M instanceof Ot)B=x(M.result);else if(M instanceof Pt)for(var G=0,$=M.args;G<$.length&&!(B=x($[G]));G+=1);else(M instanceof ns||M instanceof Ie)&&M.input instanceof po&&M.input.name==="zoom"&&(B=M);return B instanceof Rr||M.eachChild(function(ne){var fe=x(ne);fe instanceof Rr?B=fe:!B&&fe?B=new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):B&&fe&&B!==fe&&(B=new Rr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),B}(r);return g||v?g instanceof Rr?fu([g]):g instanceof Ie&&!Tu(t)?fu([new Rr("",'"interpolate" expressions cannot be used with this property')]):Hl(g?new Uu(f?"camera":"composite",e.value,g.labels,g instanceof Ie?g.interpolation:void 0):new El(f?"constant":"source",e.value)):fu([new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Uu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,g)},Uu.prototype.evaluate=function(e,t,r,f,v,g){return this._styleExpression.evaluate(e,t,r,f,v,g)},Uu.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?Ie.interpolationFactor(this.interpolationType,e,t,r):0};var ul=function(e,t){this._parameters=e,this._specification=t,br(this,function r(f,v){var g,x,M,B=v.type==="color",G=f.stops&&typeof f.stops[0][0]=="object",$=G||!(G||f.property!==void 0),ne=f.type||(Tu(v)?"exponential":"interval");if(B&&((f=br({},f)).stops&&(f.stops=f.stops.map(function(Dn){return[Dn[0],Ei.parse(Dn[1])]})),f.default=Ei.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!le[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(ne==="exponential")g=zu;else if(ne==="interval")g=Bc;else if(ne==="categorical"){g=Wl,x=Object.create(null);for(var fe=0,_e=f.stops;fe<_e.length;fe+=1){var Ve=_e[fe];x[Ve[0]]=Ve[1]}M=typeof f.stops[0][0]}else{if(ne!=="identity")throw new Error('Unknown function type "'+ne+'"');g=Xl}if(G){for(var We={},ht=[],et=0;et<f.stops.length;et++){var Tt=f.stops[et],Nt=Tt[0].zoom;We[Nt]===void 0&&(We[Nt]={zoom:Nt,type:f.type,property:f.property,default:f.default,stops:[]},ht.push(Nt)),We[Nt].stops.push([Tt[0].value,Tt[1]])}for(var cr=[],fr=0,Or=ht;fr<Or.length;fr+=1){var nn=Or[fr];cr.push([We[nn].zoom,r(We[nn],v)])}var _n={name:"linear"};return{kind:"composite",interpolationType:_n,interpolationFactor:Ie.interpolationFactor.bind(void 0,_n),zoomStops:cr.map(function(Dn){return Dn[0]}),evaluate:function(Dn,ai){var Zn=Dn.zoom;return zu({stops:cr,base:f.base},v,Zn).evaluate(Zn,ai)}}}if($){var hi=ne==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:hi,interpolationFactor:Ie.interpolationFactor.bind(void 0,hi),zoomStops:f.stops.map(function(Dn){return Dn[0]}),evaluate:function(Dn){return g(f,v,Dn.zoom,x,M)}}}return{kind:"source",evaluate:function(Dn,ai){var Zn=ai&&ai.properties?ai.properties[f.property]:void 0;return Zn===void 0?hu(f.default,v.default):g(f,v,Zn,x,M)}}}(this._parameters,this._specification))};function Us(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},g=e.style,x=e.styleSpec,M=[],B=Ma(r);if(B!=="object")return[new Ee(t,r,"object expected, "+B+" found")];for(var G in r){var $=G.split(".")[0],ne=f[$]||f["*"],fe=void 0;if(v[$])fe=v[$];else if(f[$])fe=ra;else if(v["*"])fe=v["*"];else{if(!f["*"]){M.push(new Ee(t,r[G],'unknown property "'+G+'"'));continue}fe=ra}M=M.concat(fe({key:(t&&t+".")+G,value:r[G],valueSpec:ne,style:g,styleSpec:x,object:r,objectKey:G},r))}for(var _e in f)v[_e]||f[_e].required&&f[_e].default===void 0&&r[_e]===void 0&&M.push(new Ee(t,r,'missing required property "'+_e+'"'));return M}function gc(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,g=e.key,x=e.arrayElementValidator||ra;if(Ma(t)!=="array")return[new Ee(g,t,"array expected, "+Ma(t)+" found")];if(r.length&&t.length!==r.length)return[new Ee(g,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new Ee(g,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var M={type:r.value,values:r.values};v.$version<7&&(M.function=r.function),Ma(r.value)==="object"&&(M=r.value);for(var B=[],G=0;G<t.length;G++)B=B.concat(x({array:t,arrayIndex:G,value:t[G],valueSpec:M,style:f,styleSpec:v,key:g+"["+G+"]"}));return B}function yc(e){var t=e.key,r=e.value,f=e.valueSpec,v=Ma(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new Ee(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new Ee(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new Ee(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function Nc(e){var t,r,f,v=e.valueSpec,g=Ht(e.value.type),x={},M=g!=="categorical"&&e.value.property===void 0,B=!M,G=Ma(e.value.stops)==="array"&&Ma(e.value.stops[0])==="array"&&Ma(e.value.stops[0][0])==="object",$=Us({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(_e){if(g==="identity")return[new Ee(_e.key,_e.value,'identity function may not have a "stops" property')];var Ve=[],We=_e.value;return Ve=Ve.concat(gc({key:_e.key,value:We,valueSpec:_e.valueSpec,style:_e.style,styleSpec:_e.styleSpec,arrayElementValidator:ne})),Ma(We)==="array"&&We.length===0&&Ve.push(new Ee(_e.key,We,"array must have at least one stop")),Ve},default:function(_e){return ra({key:_e.key,value:_e.value,valueSpec:v,style:_e.style,styleSpec:_e.styleSpec})}}});return g==="identity"&&M&&$.push(new Ee(e.key,e.value,'missing required property "property"')),g==="identity"||e.value.stops||$.push(new Ee(e.key,e.value,'missing required property "stops"')),g==="exponential"&&e.valueSpec.expression&&!Tu(e.valueSpec)&&$.push(new Ee(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(B&&!Ds(e.valueSpec)?$.push(new Ee(e.key,e.value,"property functions not supported")):M&&!mc(e.valueSpec)&&$.push(new Ee(e.key,e.value,"zoom functions not supported"))),g!=="categorical"&&!G||e.value.property!==void 0||$.push(new Ee(e.key,e.value,'"property" property is required')),$;function ne(_e){var Ve=[],We=_e.value,ht=_e.key;if(Ma(We)!=="array")return[new Ee(ht,We,"array expected, "+Ma(We)+" found")];if(We.length!==2)return[new Ee(ht,We,"array length 2 expected, length "+We.length+" found")];if(G){if(Ma(We[0])!=="object")return[new Ee(ht,We,"object expected, "+Ma(We[0])+" found")];if(We[0].zoom===void 0)return[new Ee(ht,We,"object stop key must have zoom")];if(We[0].value===void 0)return[new Ee(ht,We,"object stop key must have value")];if(f&&f>Ht(We[0].zoom))return[new Ee(ht,We[0].zoom,"stop zoom values must appear in ascending order")];Ht(We[0].zoom)!==f&&(f=Ht(We[0].zoom),r=void 0,x={}),Ve=Ve.concat(Us({key:ht+"[0]",value:We[0],valueSpec:{zoom:{}},style:_e.style,styleSpec:_e.styleSpec,objectElementValidators:{zoom:yc,value:fe}}))}else Ve=Ve.concat(fe({key:ht+"[0]",value:We[0],valueSpec:{},style:_e.style,styleSpec:_e.styleSpec},We));return Sl(Qt(We[1]))?Ve.concat([new Ee(ht+"[1]",We[1],"expressions are not allowed in function stops.")]):Ve.concat(ra({key:ht+"[1]",value:We[1],valueSpec:v,style:_e.style,styleSpec:_e.styleSpec}))}function fe(_e,Ve){var We=Ma(_e.value),ht=Ht(_e.value),et=_e.value!==null?_e.value:Ve;if(t){if(We!==t)return[new Ee(_e.key,et,We+" stop domain type must match previous stop domain type "+t)]}else t=We;if(We!=="number"&&We!=="string"&&We!=="boolean")return[new Ee(_e.key,et,"stop domain value must be a number, string, or boolean")];if(We!=="number"&&g!=="categorical"){var Tt="number expected, "+We+" found";return Ds(v)&&g===void 0&&(Tt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ee(_e.key,et,Tt)]}return g!=="categorical"||We!=="number"||isFinite(ht)&&Math.floor(ht)===ht?g!=="categorical"&&We==="number"&&r!==void 0&&ht<r?[new Ee(_e.key,et,"stop domain values must appear in ascending order")]:(r=ht,g==="categorical"&&ht in x?[new Ee(_e.key,et,"stop domain values must be unique")]:(x[ht]=!0,[])):[new Ee(_e.key,et,"integer expected, found "+ht)]}}function Zu(e){var t=(e.expressionContext==="property"?pu:sl)(Qt(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new Ee(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new Ee(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!uo(r))return[new Ee(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!uo(r))return[new Ee(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!ii(r,["zoom","feature-state"]))return[new Ee(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!zo(r))return[new Ee(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cl(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Ht(r))===-1&&v.push(new Ee(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(Ht(r))===-1&&v.push(new Ee(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function Yl(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!Yl(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}ul.deserialize=function(e){return new ul(e._parameters,e._specification)},ul.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var _c={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Kl(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Yl(e)||(e=Pu(e));var t=sl(e,_c);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function $l(e,t){return e<t?-1:e>t?1:0}function Pu(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?Mu(e[1],e[2],"=="):r==="!="?du(Mu(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Mu(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Pu))):r==="all"?["all"].concat(e.slice(1).map(Pu)):r==="none"?["all"].concat(e.slice(1).map(Pu).map(du)):r==="in"?Jl(e[1],e.slice(2)):r==="!in"?du(Jl(e[1],e.slice(2))):r==="has"?Ql(e[1]):r==="!has"?du(Ql(e[1])):r!=="within"||e}function Mu(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function Jl(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort($l)]]:["filter-in-small",e,["literal",t]]}}function Ql(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function du(e){return["!",e]}function xc(e){return Yl(Qt(e.value))?Zu(br({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(Ma(f)!=="array")return[new Ee(v,f,"array expected, "+Ma(f)+" found")];var g,x=r.styleSpec,M=[];if(f.length<1)return[new Ee(v,f,"filter array must have at least 1 element")];switch(M=M.concat(Cl({key:v+"[0]",value:f[0],valueSpec:x.filter_operator,style:r.style,styleSpec:r.styleSpec})),Ht(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Ht(f[1])==="$type"&&M.push(new Ee(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&M.push(new Ee(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(g=Ma(f[1]))!=="string"&&M.push(new Ee(v+"[1]",f[1],"string expected, "+g+" found"));for(var B=2;B<f.length;B++)g=Ma(f[B]),Ht(f[1])==="$type"?M=M.concat(Cl({key:v+"["+B+"]",value:f[B],valueSpec:x.geometry_type,style:r.style,styleSpec:r.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&M.push(new Ee(v+"["+B+"]",f[B],"string, number, or boolean expected, "+g+" found"));break;case"any":case"all":case"none":for(var G=1;G<f.length;G++)M=M.concat(t({key:v+"["+G+"]",value:f[G],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":g=Ma(f[1]),f.length!==2?M.push(new Ee(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):g!=="string"&&M.push(new Ee(v+"[1]",f[1],"string expected, "+g+" found"));break;case"within":g=Ma(f[1]),f.length!==2?M.push(new Ee(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):g!=="object"&&M.push(new Ee(v+"[1]",f[1],"object expected, "+g+" found"))}return M}(e)}function wl(e,t){var r=e.key,f=e.style,v=e.styleSpec,g=e.value,x=e.objectKey,M=v[t+"_"+e.layerType];if(!M)return[];var B=x.match(/^(.*)-transition$/);if(t==="paint"&&B&&M[B[1]]&&M[B[1]].transition)return ra({key:r,value:g,valueSpec:v.transition,style:f,styleSpec:v});var G,$=e.valueSpec||M[x];if(!$)return[new Ee(r,g,'unknown property "'+x+'"')];if(Ma(g)==="string"&&Ds($)&&!$.tokens&&(G=/^{([^}]+)}$/.exec(g)))return[new Ee(r,g,'"'+x+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(G[1])+" }`.")];var ne=[];return e.layerType==="symbol"&&(x==="text-field"&&f&&!f.glyphs&&ne.push(new Ee(r,g,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&ol(Qt(g))&&Ht(g.type)==="identity"&&ne.push(new Ee(r,g,'"text-font" does not support identity functions'))),ne.concat(ra({key:e.key,value:g,valueSpec:$,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:x}))}function bc(e){return wl(e,"paint")}function ju(e){return wl(e,"layout")}function Va(e){var t=[],r=e.value,f=e.key,v=e.style,g=e.styleSpec;r.type||r.ref||t.push(new Ee(f,r,'either "type" or "ref" is required'));var x,M=Ht(r.type),B=Ht(r.ref);if(r.id)for(var G=Ht(r.id),$=0;$<e.arrayIndex;$++){var ne=v.layers[$];Ht(ne.id)===G&&t.push(new Ee(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+ne.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Ve){Ve in r&&t.push(new Ee(f,r[Ve],'"'+Ve+'" is prohibited for ref layers'))}),v.layers.forEach(function(Ve){Ht(Ve.id)===B&&(x=Ve)}),x?x.ref?t.push(new Ee(f,r.ref,"ref cannot reference another ref layer")):M=Ht(x.type):t.push(new Ee(f,r.ref,'ref layer "'+B+'" not found'));else if(M!=="background")if(r.source){var fe=v.sources&&v.sources[r.source],_e=fe&&Ht(fe.type);fe?_e==="vector"&&M==="raster"?t.push(new Ee(f,r.source,'layer "'+r.id+'" requires a raster source')):_e==="raster"&&M!=="raster"?t.push(new Ee(f,r.source,'layer "'+r.id+'" requires a vector source')):_e!=="vector"||r["source-layer"]?_e==="raster-dem"&&M!=="hillshade"?t.push(new Ee(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!r.paint||!r.paint["line-gradient"]||_e==="geojson"&&fe.lineMetrics||t.push(new Ee(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Ee(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new Ee(f,r.source,'source "'+r.source+'" not found'))}else t.push(new Ee(f,r,'missing required property "source"'));return t=t.concat(Us({key:f,value:r,valueSpec:g.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ra({key:f+".type",value:r.type,valueSpec:g.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:xc,layout:function(Ve){return Us({layer:r,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(We){return ju(br({layerType:M},We))}}})},paint:function(Ve){return Us({layer:r,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(We){return bc(br({layerType:M},We))}}})}}}))}function ll(e){var t=e.value,r=e.key,f=Ma(t);return f!=="string"?[new Ee(r,t,"string expected, "+f+" found")]:[]}var Ya={promoteId:function(e){var t=e.key,r=e.value;if(Ma(r)==="string")return ll({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,ll({key:t+"."+v,value:r[v]}));return f}};function Vu(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new Ee(r,t,'"type" is required')];var g,x=Ht(t.type);switch(x){case"vector":case"raster":case"raster-dem":return Us({key:r,value:t,valueSpec:f["source_"+x.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:Ya});case"geojson":if(g=Us({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:Ya}),t.cluster)for(var M in t.clusterProperties){var B=t.clusterProperties[M],G=B[0],$=typeof G=="string"?[G,["accumulated"],["get",M]]:G;g.push.apply(g,Zu({key:r+"."+M+".map",value:B[1],expressionContext:"cluster-map"})),g.push.apply(g,Zu({key:r+"."+M+".reduce",value:$,expressionContext:"cluster-reduce"}))}return g;case"video":return Us({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return Us({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new Ee(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cl({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function Iu(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,g=[],x=Ma(t);if(t===void 0)return g;if(x!=="object")return g.concat([new Ee("light",t,"object expected, "+x+" found")]);for(var M in t){var B=M.match(/^(.*)-transition$/);g=g.concat(B&&f[B[1]]&&f[B[1]].transition?ra({key:M,value:t[M],valueSpec:r.transition,style:v,styleSpec:r}):f[M]?ra({key:M,value:t[M],valueSpec:f[M],style:v,styleSpec:r}):[new Ee(M,t[M],'unknown property "'+M+'"')])}return g}var Ks={"*":function(){return[]},array:gc,boolean:function(e){var t=e.value,r=e.key,f=Ma(t);return f!=="boolean"?[new Ee(r,t,"boolean expected, "+f+" found")]:[]},number:yc,color:function(e){var t=e.key,r=e.value,f=Ma(r);return f!=="string"?[new Ee(t,r,"color expected, "+f+" found")]:Di(r)===null?[new Ee(t,r,'color expected, "'+r+'" found')]:[]},constants:dt,enum:Cl,filter:xc,function:Nc,layer:Va,object:Us,source:Vu,light:Iu,string:ll,formatted:function(e){return ll(e).length===0?[]:Zu(e)},resolvedImage:function(e){return ll(e).length===0?[]:Zu(e)}};function ra(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&ol(Ht(t))?Nc(e):r.expression&&Sl(Qt(t))?Zu(e):r.type&&Ks[r.type]?Ks[r.type](e):Us(br({},e,{valueSpec:r.type?f[r.type]:r}))}function Fa(e){var t=e.value,r=e.key,f=ll(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new Ee(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new Ee(r,t,'"glyphs" url must include a "{range}" token'))),f}function Cs(e,t){t===void 0&&(t=se);var r=[];return r=r.concat(ra({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Fa,"*":function(){return[]}}})),e.constants&&(r=r.concat(dt({key:"constants",value:e.constants,style:e,styleSpec:t}))),ql(r)}function ql(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function vu(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return ql(e.apply(this,t))}}Cs.source=vu(Vu),Cs.light=vu(Iu),Cs.layer=vu(Va),Cs.filter=vu(xc),Cs.paintProperty=vu(bc),Cs.layoutProperty=vu(ju);var ec=Cs,nf=ec.light,af=ec.paintProperty,cl=ec.layoutProperty;function Al(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new de(new Error(v[f].message))),r=!0;return r}var Ou=Ro;function Ro(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var g=0;g<this.d*this.d;g++){var x=v[3+g],M=v[3+g+1];f.push(x===M?null:v.subarray(x,M))}var B=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],B),this.bboxes=v.subarray(B),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var G=0;G<this.d*this.d;G++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var $=r/t*e;this.min=-$,this.max=e+$}Ro.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},Ro.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ro.prototype._insertCell=function(e,t,r,f,v,g){this.cells[v].push(g)},Ro.prototype.query=function(e,t,r,f,v){var g=this.min,x=this.max;if(e<=g&&t<=g&&x<=r&&x<=f&&!v)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(e,t,r,f,this._queryCell,M,{},v),M},Ro.prototype._queryCell=function(e,t,r,f,v,g,x,M){var B=this.cells[v];if(B!==null)for(var G=this.keys,$=this.bboxes,ne=0;ne<B.length;ne++){var fe=B[ne];if(x[fe]===void 0){var _e=4*fe;(M?M($[_e+0],$[_e+1],$[_e+2],$[_e+3]):e<=$[_e+2]&&t<=$[_e+3]&&r>=$[_e+0]&&f>=$[_e+1])?(x[fe]=!0,g.push(G[fe])):x[fe]=!1}}},Ro.prototype._forEachCell=function(e,t,r,f,v,g,x,M){for(var B=this._convertToCellCoord(e),G=this._convertToCellCoord(t),$=this._convertToCellCoord(r),ne=this._convertToCellCoord(f),fe=B;fe<=$;fe++)for(var _e=G;_e<=ne;_e++){var Ve=this.d*_e+fe;if((!M||M(this._convertFromCellCoord(fe),this._convertFromCellCoord(_e),this._convertFromCellCoord(fe+1),this._convertFromCellCoord(_e+1)))&&v.call(this,e,t,r,f,Ve,g,x,M))return}},Ro.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Ro.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Ro.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var g=t,x=0;x<e.length;x++){var M=e[x];v[3+x]=g,v.set(M,g),g+=M.length}return v[3+e.length]=g,v.set(this.keys,g),v[3+e.length+1]=g+=this.keys.length,v.set(this.bboxes,g),g+=this.bboxes.length,v.buffer};var Tl=N.ImageData,Zs=N.ImageBitmap,Eo={};function Bn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Eo[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var mo in Bn("Object",Object),Ou.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Ou.deserialize=function(e){return new Ou(e.buffer)},Bn("Grid",Ou),Bn("Color",Ei),Bn("Error",Error),Bn("ResolvedImage",Vi),Bn("StylePropertyFunction",ul),Bn("StyleExpression",bl,{omit:["_evaluator"]}),Bn("ZoomDependentExpression",Uu),Bn("ZoomConstantExpression",El),Bn("CompoundExpression",po,{omit:["_evaluate"]}),Ys)Ys[mo]._classRegistryKey||Bn("Expression_"+mo,Ys[mo]);function mu(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function fl(e){return Zs&&e instanceof Zs}function $s(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(mu(e)||fl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof Tl)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,g=e;v<g.length;v+=1)f.push($s(g[v],t));return f}if(typeof e=="object"){var x=e.constructor,M=x._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var B=x.serialize?x.serialize(e,t):{};if(!x.serialize){for(var G in e)if(e.hasOwnProperty(G)&&!(Eo[M].omit.indexOf(G)>=0)){var $=e[G];B[G]=Eo[M].shallow.indexOf(G)>=0?$:$s($,t)}e instanceof Error&&(B.message=e.message)}if(B.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(B.$name=M),B}throw new Error("can't serialize object of type "+typeof e)}function ws(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||mu(e)||fl(e)||ArrayBuffer.isView(e)||e instanceof Tl)return e;if(Array.isArray(e))return e.map(ws);if(typeof e=="object"){var t=e.$name||"Object",r=Eo[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,g=Object.keys(e);v<g.length;v+=1){var x=g[v];if(x!=="$name"){var M=e[x];f[x]=Eo[t].shallow.indexOf(x)>=0?M:ws(M)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var Sc=function(){this.first=!0};Sc.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var gn={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function tc(e){for(var t=0,r=e;t<r.length;t+=1)if(rc(r[t].charCodeAt(0)))return!0;return!1}function rc(e){return!(e!==746&&e!==747&&(e<4352||!(gn["Bopomofo Extended"](e)||gn.Bopomofo(e)||gn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||gn["CJK Compatibility Ideographs"](e)||gn["CJK Compatibility"](e)||gn["CJK Radicals Supplement"](e)||gn["CJK Strokes"](e)||!(!gn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||gn["CJK Unified Ideographs Extension A"](e)||gn["CJK Unified Ideographs"](e)||gn["Enclosed CJK Letters and Months"](e)||gn["Hangul Compatibility Jamo"](e)||gn["Hangul Jamo Extended-A"](e)||gn["Hangul Jamo Extended-B"](e)||gn["Hangul Jamo"](e)||gn["Hangul Syllables"](e)||gn.Hiragana(e)||gn["Ideographic Description Characters"](e)||gn.Kanbun(e)||gn["Kangxi Radicals"](e)||gn["Katakana Phonetic Extensions"](e)||gn.Katakana(e)&&e!==12540||!(!gn["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!gn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||gn["Unified Canadian Aboriginal Syllabics"](e)||gn["Unified Canadian Aboriginal Syllabics Extended"](e)||gn["Vertical Forms"](e)||gn["Yijing Hexagram Symbols"](e)||gn["Yi Syllables"](e)||gn["Yi Radicals"](e))))}function Lu(e){return!(rc(e)||function(t){return!!(gn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||gn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||gn["Letterlike Symbols"](t)||gn["Number Forms"](t)||gn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||gn["Control Pictures"](t)&&t!==9251||gn["Optical Character Recognition"](t)||gn["Enclosed Alphanumerics"](t)||gn["Geometric Shapes"](t)||gn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||gn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||gn["CJK Symbols and Punctuation"](t)||gn.Katakana(t)||gn["Private Use Area"](t)||gn["CJK Compatibility Forms"](t)||gn["Small Form Variants"](t)||gn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function Ua(e){return e>=1424&&e<=2303||gn["Arabic Presentation Forms-A"](e)||gn["Arabic Presentation Forms-B"](e)}function As(e,t){return!(!t&&Ua(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||gn.Khmer(e))}function nc(e){for(var t=0,r=e;t<r.length;t+=1)if(Ua(r[t].charCodeAt(0)))return!0;return!1}var gu=null,Ts="unavailable",yu=null,zc=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Ts="error"),gu&&gu(e)};function Pl(){Ec.fire(new oe("pluginStateChange",{pluginStatus:Ts,pluginURL:yu}))}var Ec=new Ae,Cc=function(){return Ts},Js=function(){if(Ts!=="deferred"||!yu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ts="loading",Pl(),yu&&Pi({url:yu},function(e){e?zc(e):(Ts="loaded",Pl())})},Ps={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ts==="loaded"||Ps.applyArabicShaping!=null},isLoading:function(){return Ts==="loading"},setState:function(e){Ts=e.pluginStatus,yu=e.pluginURL},isParsed:function(){return Ps.applyArabicShaping!=null&&Ps.processBidirectionalText!=null&&Ps.processStyledBidirectionalText!=null},getPluginURL:function(){return yu}},na=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sc,this.transition={})};na.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!As(v[f].charCodeAt(0),r))return!1;return!0}(e,Ps.isLoaded())},na.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},na.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var _u=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(ol(r))return new ul(r,f);if(Sl(r)){var v=pu(r,f);if(v.result==="error")throw new Error(v.value.map(function(x){return x.key+": "+x.message}).join(", "));return v.value}var g=r;return typeof r=="string"&&f.type==="color"&&(g=Ei.parse(r)),{kind:"constant",evaluate:function(){return g}}}(t===void 0?e.specification.default:t,e.specification)};_u.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},_u.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var Qs=function(e){this.property=e,this.value=new _u(e,void 0)};Qs.prototype.transitioned=function(e,t){return new Gu(this.property,this.value,t,Gt({},e.transition,this.transition),e.now)},Qs.prototype.untransitioned=function(){return new Gu(this.property,this.value,null,{},0)};var Uo=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Uo.prototype.getValue=function(e){return Ke(this._values[e].value.value)},Uo.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Qs(this._values[e].property)),this._values[e].value=new _u(this._values[e].property,t===null?void 0:Ke(t))},Uo.prototype.getTransition=function(e){return Ke(this._values[e].transition)},Uo.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Qs(this._values[e].property)),this._values[e].transition=Ke(t)||void 0},Uo.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var g=this.getTransition(f);g!==void 0&&(e[f+"-transition"]=g)}return e},Uo.prototype.transitioned=function(e,t){for(var r=new ru(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var g=v[f];r._values[g]=this._values[g].transitioned(e,t._values[g])}return r},Uo.prototype.untransitioned=function(){for(var e=new ru(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var Gu=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};Gu.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),g=this.prior;if(g){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return g.possiblyEvaluate(e,t,r);var x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,t,r),v,function(M){if(M<=0)return 0;if(M>=1)return 1;var B=M*M,G=B*M;return 4*(M<.5?G:3*(M-B)+G-.75)}(x))}return v};var ru=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};ru.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Hu(this._properties),v=0,g=Object.keys(this._values);v<g.length;v+=1){var x=g[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f},ru.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var nu=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};nu.prototype.getValue=function(e){return Ke(this._values[e].value)},nu.prototype.setValue=function(e,t){this._values[e]=new _u(this._values[e].property,t===null?void 0:Ke(t))},nu.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},nu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Hu(this._properties),v=0,g=Object.keys(this._values);v<g.length;v+=1){var x=g[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f};var Co=function(e,t,r){this.property=e,this.value=t,this.parameters=r};Co.prototype.isConstant=function(){return this.value.kind==="constant"},Co.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},Co.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var Hu=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Hu.prototype.get=function(e){return this._values[e]};var ri=function(e){this.specification=e};ri.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},ri.prototype.interpolate=function(e,t,r){var f=lo[this.specification.type];return f?f(e,t,r):e};var Kn=function(e,t){this.specification=e,this.overrides=t};Kn.prototype.possiblyEvaluate=function(e,t,r,f){return new Co(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},Kn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new Co(this,{kind:"constant",value:void 0},e.parameters);var f=lo[this.specification.type];return f?new Co(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},Kn.prototype.evaluate=function(e,t,r,f,v,g){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,g)};var Ml=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,g){if(r.value===void 0)return new Co(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var x=r.expression.evaluate(f,null,{},v,g),M=r.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,B=this._calculate(M,M,M,f);return new Co(this,{kind:"constant",value:B},f)}if(r.expression.kind==="camera"){var G=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new Co(this,{kind:"constant",value:G},f)}return new Co(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,g,x,M){if(r.kind==="source"){var B=r.evaluate(f,v,g,x,M);return this._calculate(B,B,B,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,g),r.evaluate({zoom:Math.floor(f.zoom)},v,g),r.evaluate({zoom:Math.floor(f.zoom)+1},v,g),f):r.value},t.prototype._calculate=function(r,f,v,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(Kn),as=function(e){this.specification=e};as.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new na(Math.floor(t.zoom-1),t)),e.expression.evaluate(new na(Math.floor(t.zoom),t)),e.expression.evaluate(new na(Math.floor(t.zoom+1),t)),t)}},as.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},as.prototype.interpolate=function(e){return e};var js=function(e){this.specification=e};js.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},js.prototype.interpolate=function(){return!1};var Zo=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new _u(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new Qs(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};Bn("DataDrivenProperty",Kn),Bn("DataConstantProperty",ri),Bn("CrossFadedDataDrivenProperty",Ml),Bn("CrossFadedProperty",as),Bn("ColorRampProperty",js);var iu=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new nu(f.layout)),f.paint)){for(var v in this._transitionablePaint=new Uo(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var g in r.layout)this.setLayoutProperty(g,r.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Hu(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(cl,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return re(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(af,"layers."+this.id+".paint."+r,r,f,v))return!1;if(re(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var g=this._transitionablePaint._values[r],x=g.property.specification["property-type"]==="cross-faded-data-driven",M=g.value.isDataDriven(),B=g.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var G=this._transitionablePaint._values[r].value;return G.isDataDriven()||M||x||this._handleOverridablePaintPropertyUpdate(r,B,G)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),wt(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,g,x){return x===void 0&&(x={}),(!x||x.validate!==!1)&&Al(this,r.call(ec,{key:f,layerType:this.type,objectKey:v,value:g,styleSpec:se,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof Co&&Ds(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(Ae),wc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ic=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ia=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Do(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var g=wc[v.type].BYTES_PER_ELEMENT,x=r=Uc(r,Math.max(t,g)),M=v.components||1;return f=Math.max(f,g),r+=g*M,{name:v.name,type:v.type,components:M,offset:x}}),size:Uc(r,Math.max(f,t)),alignment:t}}function Uc(e,t){return Math.ceil(e/t)*t}ia.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},ia.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},ia.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ia.prototype.clear=function(){this.length=0},ia.prototype.resize=function(e){this.reserve(e),this.length=e},ia.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},ia.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var gs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.int16[g+0]=f,this.int16[g+1]=v,r},t}(ia);gs.prototype.bytesPerElement=4,Bn("StructArrayLayout2i4",gs);var Il=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,x){var M=4*r;return this.int16[M+0]=f,this.int16[M+1]=v,this.int16[M+2]=g,this.int16[M+3]=x,r},t}(ia);Il.prototype.bytesPerElement=8,Bn("StructArrayLayout4i8",Il);var Ms=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,M){var B=this.length;return this.resize(B+1),this.emplace(B,r,f,v,g,x,M)},t.prototype.emplace=function(r,f,v,g,x,M,B){var G=6*r;return this.int16[G+0]=f,this.int16[G+1]=v,this.int16[G+2]=g,this.int16[G+3]=x,this.int16[G+4]=M,this.int16[G+5]=B,r},t}(ia);Ms.prototype.bytesPerElement=12,Bn("StructArrayLayout2i4i12",Ms);var os=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,M){var B=this.length;return this.resize(B+1),this.emplace(B,r,f,v,g,x,M)},t.prototype.emplace=function(r,f,v,g,x,M,B){var G=4*r,$=8*r;return this.int16[G+0]=f,this.int16[G+1]=v,this.uint8[$+4]=g,this.uint8[$+5]=x,this.uint8[$+6]=M,this.uint8[$+7]=B,r},t}(ia);os.prototype.bytesPerElement=8,Bn("StructArrayLayout2i4ub8",os);var hl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.float32[g+0]=f,this.float32[g+1]=v,r},t}(ia);hl.prototype.bytesPerElement=8,Bn("StructArrayLayout2f8",hl);var au=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,M,B,G,$,ne){var fe=this.length;return this.resize(fe+1),this.emplace(fe,r,f,v,g,x,M,B,G,$,ne)},t.prototype.emplace=function(r,f,v,g,x,M,B,G,$,ne,fe){var _e=10*r;return this.uint16[_e+0]=f,this.uint16[_e+1]=v,this.uint16[_e+2]=g,this.uint16[_e+3]=x,this.uint16[_e+4]=M,this.uint16[_e+5]=B,this.uint16[_e+6]=G,this.uint16[_e+7]=$,this.uint16[_e+8]=ne,this.uint16[_e+9]=fe,r},t}(ia);au.prototype.bytesPerElement=20,Bn("StructArrayLayout10ui20",au);var ac=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,M,B,G,$,ne,fe,_e){var Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,r,f,v,g,x,M,B,G,$,ne,fe,_e)},t.prototype.emplace=function(r,f,v,g,x,M,B,G,$,ne,fe,_e,Ve){var We=12*r;return this.int16[We+0]=f,this.int16[We+1]=v,this.int16[We+2]=g,this.int16[We+3]=x,this.uint16[We+4]=M,this.uint16[We+5]=B,this.uint16[We+6]=G,this.uint16[We+7]=$,this.int16[We+8]=ne,this.int16[We+9]=fe,this.int16[We+10]=_e,this.int16[We+11]=Ve,r},t}(ia);ac.prototype.bytesPerElement=24,Bn("StructArrayLayout4i4ui4i24",ac);var Wu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=3*r;return this.float32[x+0]=f,this.float32[x+1]=v,this.float32[x+2]=g,r},t}(ia);Wu.prototype.bytesPerElement=12,Bn("StructArrayLayout3f12",Wu);var Xu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(ia);Xu.prototype.bytesPerElement=4,Bn("StructArrayLayout1ul4",Xu);var Zc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,M,B,G,$){var ne=this.length;return this.resize(ne+1),this.emplace(ne,r,f,v,g,x,M,B,G,$)},t.prototype.emplace=function(r,f,v,g,x,M,B,G,$,ne){var fe=10*r,_e=5*r;return this.int16[fe+0]=f,this.int16[fe+1]=v,this.int16[fe+2]=g,this.int16[fe+3]=x,this.int16[fe+4]=M,this.int16[fe+5]=B,this.uint32[_e+3]=G,this.uint16[fe+8]=$,this.uint16[fe+9]=ne,r},t}(ia);Zc.prototype.bytesPerElement=20,Bn("StructArrayLayout6i1ul2ui20",Zc);var Ol=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,M){var B=this.length;return this.resize(B+1),this.emplace(B,r,f,v,g,x,M)},t.prototype.emplace=function(r,f,v,g,x,M,B){var G=6*r;return this.int16[G+0]=f,this.int16[G+1]=v,this.int16[G+2]=g,this.int16[G+3]=x,this.int16[G+4]=M,this.int16[G+5]=B,r},t}(ia);Ol.prototype.bytesPerElement=12,Bn("StructArrayLayout2i2i2i12",Ol);var pl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x){var M=this.length;return this.resize(M+1),this.emplace(M,r,f,v,g,x)},t.prototype.emplace=function(r,f,v,g,x,M){var B=4*r,G=8*r;return this.float32[B+0]=f,this.float32[B+1]=v,this.float32[B+2]=g,this.int16[G+6]=x,this.int16[G+7]=M,r},t}(ia);pl.prototype.bytesPerElement=16,Bn("StructArrayLayout2f1f2i16",pl);var jc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,x){var M=12*r,B=3*r;return this.uint8[M+0]=f,this.uint8[M+1]=v,this.float32[B+1]=g,this.float32[B+2]=x,r},t}(ia);jc.prototype.bytesPerElement=12,Bn("StructArrayLayout2ub2f12",jc);var Yu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=3*r;return this.uint16[x+0]=f,this.uint16[x+1]=v,this.uint16[x+2]=g,r},t}(ia);Yu.prototype.bytesPerElement=6,Bn("StructArrayLayout3ui6",Yu);var Ru=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,M,B,G,$,ne,fe,_e,Ve,We,ht,et,Tt){var Nt=this.length;return this.resize(Nt+1),this.emplace(Nt,r,f,v,g,x,M,B,G,$,ne,fe,_e,Ve,We,ht,et,Tt)},t.prototype.emplace=function(r,f,v,g,x,M,B,G,$,ne,fe,_e,Ve,We,ht,et,Tt,Nt){var cr=24*r,fr=12*r,Or=48*r;return this.int16[cr+0]=f,this.int16[cr+1]=v,this.uint16[cr+2]=g,this.uint16[cr+3]=x,this.uint32[fr+2]=M,this.uint32[fr+3]=B,this.uint32[fr+4]=G,this.uint16[cr+10]=$,this.uint16[cr+11]=ne,this.uint16[cr+12]=fe,this.float32[fr+7]=_e,this.float32[fr+8]=Ve,this.uint8[Or+36]=We,this.uint8[Or+37]=ht,this.uint8[Or+38]=et,this.uint32[fr+10]=Tt,this.int16[cr+22]=Nt,r},t}(ia);Ru.prototype.bytesPerElement=48,Bn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ru);var oc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,M,B,G,$,ne,fe,_e,Ve,We,ht,et,Tt,Nt,cr,fr,Or,nn,_n,hi,Dn,ai,Zn,ea){var Ci=this.length;return this.resize(Ci+1),this.emplace(Ci,r,f,v,g,x,M,B,G,$,ne,fe,_e,Ve,We,ht,et,Tt,Nt,cr,fr,Or,nn,_n,hi,Dn,ai,Zn,ea)},t.prototype.emplace=function(r,f,v,g,x,M,B,G,$,ne,fe,_e,Ve,We,ht,et,Tt,Nt,cr,fr,Or,nn,_n,hi,Dn,ai,Zn,ea,Ci){var $n=34*r,ca=17*r;return this.int16[$n+0]=f,this.int16[$n+1]=v,this.int16[$n+2]=g,this.int16[$n+3]=x,this.int16[$n+4]=M,this.int16[$n+5]=B,this.int16[$n+6]=G,this.int16[$n+7]=$,this.uint16[$n+8]=ne,this.uint16[$n+9]=fe,this.uint16[$n+10]=_e,this.uint16[$n+11]=Ve,this.uint16[$n+12]=We,this.uint16[$n+13]=ht,this.uint16[$n+14]=et,this.uint16[$n+15]=Tt,this.uint16[$n+16]=Nt,this.uint16[$n+17]=cr,this.uint16[$n+18]=fr,this.uint16[$n+19]=Or,this.uint16[$n+20]=nn,this.uint16[$n+21]=_n,this.uint16[$n+22]=hi,this.uint32[ca+12]=Dn,this.float32[ca+13]=ai,this.float32[ca+14]=Zn,this.float32[ca+15]=ea,this.float32[ca+16]=Ci,r},t}(ia);oc.prototype.bytesPerElement=68,Bn("StructArrayLayout8i15ui1ul4f68",oc);var Du=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(ia);Du.prototype.bytesPerElement=4,Bn("StructArrayLayout1f4",Du);var Vs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=3*r;return this.int16[x+0]=f,this.int16[x+1]=v,this.int16[x+2]=g,r},t}(ia);Vs.prototype.bytesPerElement=6,Bn("StructArrayLayout3i6",Vs);var Ac=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=4*r;return this.uint32[2*r+0]=f,this.uint16[x+2]=v,this.uint16[x+3]=g,r},t}(ia);Ac.prototype.bytesPerElement=8,Bn("StructArrayLayout1ul2ui8",Ac);var sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.uint16[g+0]=f,this.uint16[g+1]=v,r},t}(ia);sc.prototype.bytesPerElement=4,Bn("StructArrayLayout2ui4",sc);var uc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(ia);uc.prototype.bytesPerElement=2,Bn("StructArrayLayout1ui2",uc);var Ku=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,x){var M=4*r;return this.float32[M+0]=f,this.float32[M+1]=v,this.float32[M+2]=g,this.float32[M+3]=x,r},t}(ia);Ku.prototype.bytesPerElement=16,Bn("StructArrayLayout4f16",Ku);var n=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new W(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(ic);n.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new n(this,r)},t}(Zc);Bn("CollisionBoxArray",u);var o=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(ic);o.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new o(this,r)},t}(Ru);Bn("PlacedSymbolArray",h);var y=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(ic);y.prototype.size=68;var b=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new y(this,r)},t}(oc);Bn("SymbolInstanceArray",b);var P=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(Du);Bn("GlyphOffsetArray",P);var F=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(Vs);Bn("SymbolLineVertexArray",F);var H=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(ic);H.prototype.size=8;var ae=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new H(this,r)},t}(Ac);Bn("FeatureIndexArray",ae);var xe=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,we=function(e){e===void 0&&(e=[]),this.segments=e};function Te(e,t){return 256*(e=rt(Math.floor(e),0,255))+rt(Math.floor(t),0,255)}we.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>we.MAX_VERTEX_ARRAY_LENGTH&&Xe("Max vertices per segment is "+we.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>we.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},we.prototype.get=function(){return this.segments},we.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},we.simpleSegment=function(e,t,r,f){return new we([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},we.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bn("SegmentVector",we);var He=Do([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),je=w(function(e){e.exports=function(t,r){var f,v,g,x,M,B,G,$;for(v=t.length-(f=3&t.length),g=r,M=3432918353,B=461845907,$=0;$<v;)G=255&t.charCodeAt($)|(255&t.charCodeAt(++$))<<8|(255&t.charCodeAt(++$))<<16|(255&t.charCodeAt(++$))<<24,++$,g=27492+(65535&(x=5*(65535&(g=(g^=G=(65535&(G=(G=(65535&G)*M+(((G>>>16)*M&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(G=0,f){case 3:G^=(255&t.charCodeAt($+2))<<16;case 2:G^=(255&t.charCodeAt($+1))<<8;case 1:g^=G=(65535&(G=(G=(65535&(G^=255&t.charCodeAt($)))*M+(((G>>>16)*M&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295}return g^=t.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),it=w(function(e){e.exports=function(t,r){for(var f,v=t.length,g=r^v,x=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24))+((1540483477*(f>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++x;switch(v){case 3:g^=(255&t.charCodeAt(x+2))<<16;case 2:g^=(255&t.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&t.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),ze=je,at=it;ze.murmur3=je,ze.murmur2=at;var xt=function(){this.ids=[],this.positions=[],this.indexed=!1};xt.prototype.add=function(e,t,r,f){this.ids.push(gr(e)),this.positions.push(t,r,f)},xt.prototype.getPositions=function(e){for(var t=gr(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var g=[];this.ids[r]===t;)g.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return g},xt.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(g,x,M,B){for(;M<B;){for(var G=g[M+B>>1],$=M-1,ne=B+1;;){do $++;while(g[$]<G);do ne--;while(g[ne]>G);if($>=ne)break;lr(g,$,ne),lr(x,3*$,3*ne),lr(x,3*$+1,3*ne+1),lr(x,3*$+2,3*ne+2)}ne-M<B-ne?(v(g,x,M,ne),M=ne+1):(v(g,x,ne+1,B),B=ne)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},xt.deserialize=function(e){var t=new xt;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var jt=Math.pow(2,53)-1;function gr(e){var t=+e;return!isNaN(t)&&t<=jt?t:ze(String(e))}function lr(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}Bn("FeaturePositionMap",xt);var _r=function(e,t){this.gl=e.gl,this.location=t},zr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(_r),on=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(_r),Qr=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(_r),Pn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(_r),ei=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(_r),ci=function(e){function t(r,f){e.call(this,r,f),this.current=Ei.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(_r),ti=new Float32Array(16),aa=function(e){function t(r,f){e.call(this,r,f),this.current=ti}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(_r);function jn(e){return[Te(255*e.r,255*e.g),Te(255*e.b,255*e.a)]}var xi=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};xi.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},xi.prototype.getBinding=function(e,t,r){return this.type==="color"?new ci(e,t):new on(e,t)};var zi=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};zi.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},zi.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},zi.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new ei(e,t):new on(e,t)};var J=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};J.prototype.populatePaintArray=function(e,t,r,f,v){var g=this.paintVertexArray.length,x=this.expression.evaluate(new na(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(g,e,x)},J.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},J.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=jn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var g=e;g<t;g++)this.paintVertexArray.emplace(g,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},J.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},J.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Q=function(e,t,r,f,v,g){this.expression=e,this.uniformNames=t.map(function(x){return"u_"+x+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(x){return{name:"a_"+x,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new g};Q.prototype.populatePaintArray=function(e,t,r,f,v){var g=this.expression.evaluate(new na(this.zoom),t,{},f,[],v),x=this.expression.evaluate(new na(this.zoom+1),t,{},f,[],v),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,g,x)},Q.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),g=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,g)},Q.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=jn(r),g=jn(f),x=e;x<t;x++)this.paintVertexArray.emplace(x,v[0],v[1],g[0],g[1]);else{for(var M=e;M<t;M++)this.paintVertexArray.emplace(M,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},Q.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Q.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Q.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=rt(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},Q.prototype.getBinding=function(e,t,r){return new on(e,t)};var D=function(e,t,r,f,v,g){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=g,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};D.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},D.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},D.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],g=f[r.mid],x=f[r.max];if(v&&g&&x)for(var M=e;M<t;M++)this.zoomInPaintVertexArray.emplace(M,g.tl[0],g.tl[1],g.br[0],g.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],g.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,g.tl[0],g.tl[1],g.br[0],g.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],g.pixelRatio,x.pixelRatio)}},D.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,He.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,He.members,this.expression.isStateDependent))},D.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var k=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var g=e.paint.get(v);if(g instanceof Co&&Ds(g.property.specification)){var x=Ce(v,e.type),M=g.value,B=g.property.specification.type,G=g.property.useIntegerZoom,$=g.property.specification["property-type"],ne=$==="cross-faded"||$==="cross-faded-data-driven";if(M.kind==="constant")this.binders[v]=ne?new zi(M.value,x):new xi(M.value,x,B),f.push("/u_"+v);else if(M.kind==="source"||ne){var fe=st(v,B,"source");this.binders[v]=ne?new D(M,B,G,t,fe,e.id):new J(M,x,B,fe),f.push("/a_"+v)}else{var _e=st(v,B,"composite");this.binders[v]=new Q(M,x,B,G,t,_e),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};k.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof J||t instanceof Q?t.maxValue:0},k.prototype.populatePaintArrays=function(e,t,r,f,v){for(var g in this.binders){var x=this.binders[g];(x instanceof J||x instanceof Q||x instanceof D)&&x.populatePaintArray(e,t,r,f,v)}},k.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof zi&&f.setConstantPatternPositions(e,t)}},k.prototype.updatePaintArrays=function(e,t,r,f,v){var g=!1;for(var x in e)for(var M=0,B=t.getPositions(x);M<B.length;M+=1){var G=B[M],$=r.feature(G.index);for(var ne in this.binders){var fe=this.binders[ne];if((fe instanceof J||fe instanceof Q||fe instanceof D)&&fe.expression.isStateDependent===!0){var _e=f.paint.get(ne);fe.expression=_e.value,fe.updatePaintArray(G.start,G.end,$,e[x],v),g=!0}}}return g},k.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof xi||r instanceof zi)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},k.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof J||r instanceof Q)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof D)for(var v=0;v<He.members.length;v++)e.push(He.members[v].name)}return e},k.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof xi||r instanceof zi||r instanceof Q)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},k.prototype.getPaintVertexBuffers=function(){return this._buffers},k.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof xi||v instanceof zi||v instanceof Q)for(var g=0,x=v.uniformNames;g<x.length;g+=1){var M=x[g];if(t[M]){var B=v.getBinding(e,t[M],M);r.push({name:M,property:f,binding:B})}}}return r},k.prototype.setUniforms=function(e,t,r,f){for(var v=0,g=t;v<g.length;v+=1){var x=g[v],M=x.name,B=x.property;this.binders[B].setUniform(x.binding,f,r.get(B),M)}},k.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof D){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof J||r instanceof Q)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},k.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof J||r instanceof Q||r instanceof D)&&r.upload(e)}this.updatePaintBuffers()},k.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof J||t instanceof Q||t instanceof D)&&t.destroy()}};var te=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var g=v[f];this.programConfigurations[g.id]=new k(g,t,r)}this.needsUpload=!1,this._featureMap=new xt,this._bufferOffset=0};function Ce(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function st(e,t,r){var f={color:{source:hl,composite:Ku},number:{source:Du,composite:hl}},v=function(g){return{"line-pattern":{source:au,composite:au},"fill-pattern":{source:au,composite:au},"fill-extrusion-pattern":{source:au,composite:au}}[g]}(e);return v&&v[r]||f[t][r]}te.prototype.populatePaintArrays=function(e,t,r,f,v,g){for(var x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,t,f,v,g);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},te.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,g=r;v<g.length;v+=1){var x=g[v];this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,t,x,f)||this.needsUpload}},te.prototype.get=function(e){return this.programConfigurations[e]},te.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},te.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Bn("ConstantBinder",xi),Bn("CrossFadedConstantBinder",zi),Bn("SourceExpressionBinder",J),Bn("CrossFadedCompositeBinder",D),Bn("CompositeExpressionBinder",Q),Bn("ProgramConfiguration",k,{omit:["_buffers"]}),Bn("ProgramConfigurationSet",te);var Bt=Math.pow(2,14)-1,bt=-Bt-1;function Kt(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],g=0;g<v.length;g++){var x=v[g],M=Math.round(x.x*t),B=Math.round(x.y*t);x.x=rt(M,bt,Bt),x.y=rt(B,bt,Bt),(M<x.x||M>x.x+1||B<x.y||B>x.y+1)&&Xe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function Ir(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Kt(e):[]}}function Fn(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var Nn=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new gs,this.indexArray=new Yu,this.segments=new we,this.programConfigurations=new te(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function fi(e,t){for(var r=0;r<e.length;r++)if(La(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(La(e,t[f]))return!0;return!!ya(e,t)}function si(e,t,r){return!!La(e,t)||!!Ka(t,e,r)}function yi(e,t){if(e.length===1)return wo(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(La(e,f[v]))return!0;for(var g=0;g<e.length;g++)if(wo(t,e[g]))return!0;for(var x=0;x<t.length;x++)if(ya(e,t[x]))return!0;return!1}function Hi(e,t,r){if(e.length>1){if(ya(e,t))return!0;for(var f=0;f<t.length;f++)if(Ka(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(Ka(e[v],t,r))return!0;return!1}function ya(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],g=0;g<t.length-1;g++)if(_a(f,v,t[g],t[g+1]))return!0;return!1}function _a(e,t,r,f){return Zt(e,r,f)!==Zt(t,r,f)&&Zt(e,t,r)!==Zt(e,t,f)}function Ka(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(Ba(e,t[v-1],t[v])<f)return!0;return!1}function Ba(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function wo(e,t){for(var r,f,v,g=!1,x=0;x<e.length;x++)for(var M=0,B=(r=e[x]).length-1;M<r.length;B=M++)(f=r[M]).y>t.y!=(v=r[B]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(g=!g);return g}function La(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var g=e[f],x=e[v];g.y>t.y!=x.y>t.y&&t.x<(x.x-g.x)*(t.y-g.y)/(x.y-g.y)+g.x&&(r=!r)}return r}function Sa(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var g=Zt(e,t,r[0]);return g!==Zt(e,t,r[1])||g!==Zt(e,t,r[2])||g!==Zt(e,t,r[3])}function la(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function va(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ga(e,t,r,f,v){if(!t[0]&&!t[1])return e;var g=W.convert(t)._mult(v);r==="viewport"&&g._rotate(-f);for(var x=[],M=0;M<e.length;M++)x.push(e[M].sub(g));return x}Nn.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],g=null;f.type==="circle"&&(g=f.layout.get("circle-sort-key"));for(var x=0,M=e;x<M.length;x+=1){var B=M[x],G=B.feature,$=B.id,ne=B.index,fe=B.sourceLayerIndex,_e=this.layers[0]._featureFilter.needGeometry,Ve=Ir(G,_e);if(this.layers[0]._featureFilter.filter(new na(this.zoom),Ve,r)){var We=g?g.evaluate(Ve,{},r):void 0,ht={id:$,properties:G.properties,type:G.type,sourceLayerIndex:fe,index:ne,geometry:_e?Ve.geometry:Kt(G),patterns:{},sortKey:We};v.push(ht)}}g&&v.sort(function(_n,hi){return _n.sortKey-hi.sortKey});for(var et=0,Tt=v;et<Tt.length;et+=1){var Nt=Tt[et],cr=Nt.geometry,fr=Nt.index,Or=Nt.sourceLayerIndex,nn=e[fr].feature;this.addFeature(Nt,cr,fr,r),t.featureIndex.insert(nn,cr,fr,Or,this.index)}},Nn.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Nn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Nn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Nn.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xe),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Nn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Nn.prototype.addFeature=function(e,t,r,f){for(var v=0,g=t;v<g.length;v+=1)for(var x=0,M=g[v];x<M.length;x+=1){var B=M[x],G=B.x,$=B.y;if(!(G<0||G>=8192||$<0||$>=8192)){var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),fe=ne.vertexLength;Fn(this.layoutVertexArray,G,$,-1,-1),Fn(this.layoutVertexArray,G,$,1,-1),Fn(this.layoutVertexArray,G,$,1,1),Fn(this.layoutVertexArray,G,$,-1,1),this.indexArray.emplaceBack(fe,fe+1,fe+2),this.indexArray.emplaceBack(fe,fe+3,fe+2),ne.vertexLength+=4,ne.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},Bn("CircleBucket",Nn,{omit:["layers"]});var Na=new Zo({"circle-sort-key":new Kn(se.layout_circle["circle-sort-key"])}),ko={paint:new Zo({"circle-radius":new Kn(se.paint_circle["circle-radius"]),"circle-color":new Kn(se.paint_circle["circle-color"]),"circle-blur":new Kn(se.paint_circle["circle-blur"]),"circle-opacity":new Kn(se.paint_circle["circle-opacity"]),"circle-translate":new ri(se.paint_circle["circle-translate"]),"circle-translate-anchor":new ri(se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ri(se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ri(se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kn(se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kn(se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kn(se.paint_circle["circle-stroke-opacity"])}),layout:Na},Ui=typeof Float32Array!="undefined"?Float32Array:Array;function $o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Po(e,t,r){var f=t[0],v=t[1],g=t[2],x=t[3],M=t[4],B=t[5],G=t[6],$=t[7],ne=t[8],fe=t[9],_e=t[10],Ve=t[11],We=t[12],ht=t[13],et=t[14],Tt=t[15],Nt=r[0],cr=r[1],fr=r[2],Or=r[3];return e[0]=Nt*f+cr*M+fr*ne+Or*We,e[1]=Nt*v+cr*B+fr*fe+Or*ht,e[2]=Nt*g+cr*G+fr*_e+Or*et,e[3]=Nt*x+cr*$+fr*Ve+Or*Tt,e[4]=(Nt=r[4])*f+(cr=r[5])*M+(fr=r[6])*ne+(Or=r[7])*We,e[5]=Nt*v+cr*B+fr*fe+Or*ht,e[6]=Nt*g+cr*G+fr*_e+Or*et,e[7]=Nt*x+cr*$+fr*Ve+Or*Tt,e[8]=(Nt=r[8])*f+(cr=r[9])*M+(fr=r[10])*ne+(Or=r[11])*We,e[9]=Nt*v+cr*B+fr*fe+Or*ht,e[10]=Nt*g+cr*G+fr*_e+Or*et,e[11]=Nt*x+cr*$+fr*Ve+Or*Tt,e[12]=(Nt=r[12])*f+(cr=r[13])*M+(fr=r[14])*ne+(Or=r[15])*We,e[13]=Nt*v+cr*B+fr*fe+Or*ht,e[14]=Nt*g+cr*G+fr*_e+Or*et,e[15]=Nt*x+cr*$+fr*Ve+Or*Tt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Ao,Tc=Po;function ku(e,t,r){var f=t[0],v=t[1],g=t[2],x=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*g+r[12]*x,e[1]=r[1]*f+r[5]*v+r[9]*g+r[13]*x,e[2]=r[2]*f+r[6]*v+r[10]*g+r[14]*x,e[3]=r[3]*f+r[7]*v+r[11]*g+r[15]*x,e}Ao=new Ui(3),Ui!=Float32Array&&(Ao[0]=0,Ao[1]=0,Ao[2]=0),function(){var e=new Ui(4);Ui!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var $u=(function(){var e=new Ui(2);Ui!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,ko)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Nn(r)},t.prototype.queryRadius=function(r){var f=r;return la("circle-radius",this,f)+la("circle-stroke-width",this,f)+va(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,M,B,G){for(var $=Ga(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,B),ne=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),fe=this.paint.get("circle-pitch-alignment")==="map",_e=fe?$:function(nn,_n){return nn.map(function(hi){return Ju(hi,_n)})}($,G),Ve=fe?ne*B:ne,We=0,ht=g;We<ht.length;We+=1)for(var et=0,Tt=ht[We];et<Tt.length;et+=1){var Nt=Tt[et],cr=fe?Nt:Ju(Nt,G),fr=Ve,Or=ku([],[Nt.x,Nt.y,0,1],G);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?fr*=Or[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(fr*=M.cameraToCenterDistance/Or[3]),si(_e,cr,fr))return!0}return!1},t}(iu));function Ju(e,t){var r=ku([],[e.x,e.y,0,1],t);return new W(r[0]/r[3],r[1]/r[3])}var Ll=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Nn);function Qu(e,t,r,f){var v=t.width,g=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*g*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*g*r);return e.width=v,e.height=g,e.data=f,e}function dl(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var g=Qu({},{width:f,height:v},r);Rl(e,g,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=g.data}}function Rl(e,t,r,f,v,g){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var x=e.data,M=t.data,B=0;B<v.height;B++)for(var G=((r.y+B)*e.width+r.x)*g,$=((f.y+B)*t.width+f.x)*g,ne=0;ne<v.width*g;ne++)M[$+ne]=x[G+ne];return t}Bn("HeatmapBucket",Ll,{omit:["layers"]});var xu=function(e,t){Qu(this,e,1,t)};xu.prototype.resize=function(e){dl(this,e,1)},xu.prototype.clone=function(){return new xu({width:this.width,height:this.height},new Uint8Array(this.data))},xu.copy=function(e,t,r,f,v){Rl(e,t,r,f,v,1)};var Mo=function(e,t){Qu(this,e,4,t)};Mo.prototype.resize=function(e){dl(this,e,4)},Mo.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},Mo.prototype.clone=function(){return new Mo({width:this.width,height:this.height},new Uint8Array(this.data))},Mo.copy=function(e,t,r,f,v){Rl(e,t,r,f,v,4)},Bn("AlphaImage",xu),Bn("RGBAImage",Mo);var Ff={paint:new Zo({"heatmap-radius":new Kn(se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kn(se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ri(se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new js(se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ri(se.paint_heatmap["heatmap-opacity"])})};function Dl(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new Mo({width:r,height:f}),g=function(Ve,We,ht){t[e.evaluationKey]=ht;var et=e.expression.evaluate(t);v.data[Ve+We+0]=Math.floor(255*et.r/et.a),v.data[Ve+We+1]=Math.floor(255*et.g/et.a),v.data[Ve+We+2]=Math.floor(255*et.b/et.a),v.data[Ve+We+3]=Math.floor(255*et.a)};if(e.clips)for(var x=0,M=0;x<f;++x,M+=4*r)for(var B=0,G=0;B<r;B++,G+=4){var $=B/(r-1),ne=e.clips[x];g(M,G,ne.start*(1-$)+ne.end*$)}else for(var fe=0,_e=0;fe<r;fe++,_e+=4)g(0,_e,fe/(r-1));return v}var of=function(e){function t(r){e.call(this,r,Ff),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Ll(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=Dl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(iu),xf={paint:new Zo({"hillshade-illumination-direction":new ri(se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ri(se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ri(se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ri(se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ri(se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ri(se.paint_hillshade["hillshade-accent-color"])})},bf=function(e){function t(r){e.call(this,r,xf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(iu),kl=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,Fl=Bf,Ph=Bf;function Bf(e,t,r){r=r||2;var f,v,g,x,M,B,G,$=t&&t.length,ne=$?t[0]*r:e.length,fe=Nf(e,0,ne,r,!0),_e=[];if(!fe||fe.next===fe.prev)return _e;if($&&(fe=function(We,ht,et,Tt){var Nt,cr,fr,Or=[];for(Nt=0,cr=ht.length;Nt<cr;Nt++)(fr=Nf(We,ht[Nt]*Tt,Nt<cr-1?ht[Nt+1]*Tt:We.length,Tt,!1))===fr.next&&(fr.steiner=!0),Or.push(Zp(fr));for(Or.sort(zp),Nt=0;Nt<Or.length;Nt++)lp(Or[Nt],et),et=ss(et,et.next);return et}(e,t,fe,r)),e.length>80*r){f=g=e[0],v=x=e[1];for(var Ve=r;Ve<ne;Ve+=r)(M=e[Ve])<f&&(f=M),(B=e[Ve+1])<v&&(v=B),M>g&&(g=M),B>x&&(x=B);G=(G=Math.max(g-f,x-v))!==0?1/G:0}return sf(fe,_e,r,f,v,G),_e}function Nf(e,t,r,f,v){var g,x;if(v===Af(e,t,r,f)>0)for(g=t;g<r;g+=f)x=wf(g,e[g],e[g+1],x);else for(g=r-f;g>=t;g-=f)x=wf(g,e[g],e[g+1],x);return x&&Ef(x,x.next)&&(Mc(x),x=x.next),x}function ss(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!Ef(f,f.next)&&jo(f.prev,f,f.next)!==0)f=f.next;else{if(Mc(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function sf(e,t,r,f,v,g,x){if(e){!x&&g&&function($,ne,fe,_e){var Ve=$;do Ve.z===null&&(Ve.z=Mh(Ve.x,Ve.y,ne,fe,_e)),Ve.prevZ=Ve.prev,Ve.nextZ=Ve.next,Ve=Ve.next;while(Ve!==$);Ve.prevZ.nextZ=null,Ve.prevZ=null,function(We){var ht,et,Tt,Nt,cr,fr,Or,nn,_n=1;do{for(et=We,We=null,cr=null,fr=0;et;){for(fr++,Tt=et,Or=0,ht=0;ht<_n&&(Or++,Tt=Tt.nextZ);ht++);for(nn=_n;Or>0||nn>0&&Tt;)Or!==0&&(nn===0||!Tt||et.z<=Tt.z)?(Nt=et,et=et.nextZ,Or--):(Nt=Tt,Tt=Tt.nextZ,nn--),cr?cr.nextZ=Nt:We=Nt,Nt.prevZ=cr,cr=Nt;et=Tt}cr.nextZ=null,_n*=2}while(fr>1)}(Ve)}(e,f,v,g);for(var M,B,G=e;e.prev!==e.next;)if(M=e.prev,B=e.next,g?uf(e,f,v,g):sp(e))t.push(M.i/r),t.push(e.i/r),t.push(B.i/r),Mc(e),e=B.next,G=B.next;else if((e=B)===G){x?x===1?sf(e=lc(ss(e),t,r),t,r,f,v,g,2):x===2&&up(e,t,r,f,v,g):sf(ss(e),t,r,f,v,g,1);break}}}function sp(e){var t=e.prev,r=e,f=e.next;if(jo(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(Sf(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&jo(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function uf(e,t,r,f){var v=e.prev,g=e,x=e.next;if(jo(v,g,x)>=0)return!1;for(var M=v.x>g.x?v.x>x.x?v.x:x.x:g.x>x.x?g.x:x.x,B=v.y>g.y?v.y>x.y?v.y:x.y:g.y>x.y?g.y:x.y,G=Mh(v.x<g.x?v.x<x.x?v.x:x.x:g.x<x.x?g.x:x.x,v.y<g.y?v.y<x.y?v.y:x.y:g.y<x.y?g.y:x.y,t,r,f),$=Mh(M,B,t,r,f),ne=e.prevZ,fe=e.nextZ;ne&&ne.z>=G&&fe&&fe.z<=$;){if(ne!==e.prev&&ne!==e.next&&Sf(v.x,v.y,g.x,g.y,x.x,x.y,ne.x,ne.y)&&jo(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,fe!==e.prev&&fe!==e.next&&Sf(v.x,v.y,g.x,g.y,x.x,x.y,fe.x,fe.y)&&jo(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ne&&ne.z>=G;){if(ne!==e.prev&&ne!==e.next&&Sf(v.x,v.y,g.x,g.y,x.x,x.y,ne.x,ne.y)&&jo(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;fe&&fe.z<=$;){if(fe!==e.prev&&fe!==e.next&&Sf(v.x,v.y,g.x,g.y,x.x,x.y,fe.x,fe.y)&&jo(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function lc(e,t,r){var f=e;do{var v=f.prev,g=f.next.next;!Ef(v,g)&&lh(v,f,f.next,g)&&Pc(v,g)&&Pc(g,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(g.i/r),Mc(f),Mc(f.next),f=e=g),f=f.next}while(f!==e);return ss(f)}function up(e,t,r,f,v,g){var x=e;do{for(var M=x.next.next;M!==x.prev;){if(x.i!==M.i&&cp(x,M)){var B=Uf(x,M);return x=ss(x,x.next),B=ss(B,B.next),sf(x,t,r,f,v,g),void sf(B,t,r,f,v,g)}M=M.next}x=x.next}while(x!==e)}function zp(e,t){return e.x-t.x}function lp(e,t){if(t=function(f,v){var g,x=v,M=f.x,B=f.y,G=-1/0;do{if(B<=x.y&&B>=x.next.y&&x.next.y!==x.y){var $=x.x+(B-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if($<=M&&$>G){if(G=$,$===M){if(B===x.y)return x;if(B===x.next.y)return x.next}g=x.x<x.next.x?x:x.next}}x=x.next}while(x!==v);if(!g)return null;if(M===G)return g;var ne,fe=g,_e=g.x,Ve=g.y,We=1/0;x=g;do M>=x.x&&x.x>=_e&&M!==x.x&&Sf(B<Ve?M:G,B,_e,Ve,B<Ve?G:M,B,x.x,x.y)&&(ne=Math.abs(B-x.y)/(M-x.x),Pc(x,f)&&(ne<We||ne===We&&(x.x>g.x||x.x===g.x&&Up(g,x)))&&(g=x,We=ne)),x=x.next;while(x!==fe);return g}(e,t)){var r=Uf(t,e);ss(t,t.next),ss(r,r.next)}}function Up(e,t){return jo(e.prev,e,t.prev)<0&&jo(t.next,e,e.next)<0}function Mh(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Zp(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Sf(e,t,r,f,v,g,x,M){return(v-x)*(t-M)-(e-x)*(g-M)>=0&&(e-x)*(f-M)-(r-x)*(t-M)>=0&&(r-x)*(g-M)-(v-x)*(f-M)>=0}function cp(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&lh(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(Pc(e,t)&&Pc(t,e)&&function(r,f){var v=r,g=!1,x=(r.x+f.x)/2,M=(r.y+f.y)/2;do v.y>M!=v.next.y>M&&v.next.y!==v.y&&x<(v.next.x-v.x)*(M-v.y)/(v.next.y-v.y)+v.x&&(g=!g),v=v.next;while(v!==r);return g}(e,t)&&(jo(e.prev,e,t.prev)||jo(e,t.prev,t))||Ef(e,t)&&jo(e.prev,e,e.next)>0&&jo(t.prev,t,t.next)>0)}function jo(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Ef(e,t){return e.x===t.x&&e.y===t.y}function lh(e,t,r,f){var v=zf(jo(e,t,r)),g=zf(jo(e,t,f)),x=zf(jo(r,f,e)),M=zf(jo(r,f,t));return v!==g&&x!==M||!(v!==0||!Cf(e,r,t))||!(g!==0||!Cf(e,f,t))||!(x!==0||!Cf(r,e,f))||!(M!==0||!Cf(r,t,f))}function Cf(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function zf(e){return e>0?1:e<0?-1:0}function Pc(e,t){return jo(e.prev,e,e.next)<0?jo(e,t,e.next)>=0&&jo(e,e.prev,t)>=0:jo(e,t,e.prev)<0||jo(e,e.next,t)<0}function Uf(e,t){var r=new Zf(e.i,e.x,e.y),f=new Zf(t.i,t.x,t.y),v=e.next,g=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,g.next=f,f.prev=g,f}function wf(e,t,r,f){var v=new Zf(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function Mc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Zf(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Af(e,t,r,f){for(var v=0,g=t,x=r-f;g<r;g+=f)v+=(e[x]-e[g])*(e[g+1]+e[x+1]),x=g;return v}function ch(e,t,r,f,v){(function g(x,M,B,G,$){for(;G>B;){if(G-B>600){var ne=G-B+1,fe=M-B+1,_e=Math.log(ne),Ve=.5*Math.exp(2*_e/3),We=.5*Math.sqrt(_e*Ve*(ne-Ve)/ne)*(fe-ne/2<0?-1:1);g(x,M,Math.max(B,Math.floor(M-fe*Ve/ne+We)),Math.min(G,Math.floor(M+(ne-fe)*Ve/ne+We)),$)}var ht=x[M],et=B,Tt=G;for(Vc(x,B,M),$(x[G],ht)>0&&Vc(x,B,G);et<Tt;){for(Vc(x,et,Tt),et++,Tt--;$(x[et],ht)<0;)et++;for(;$(x[Tt],ht)>0;)Tt--}$(x[B],ht)===0?Vc(x,B,Tt):Vc(x,++Tt,G),Tt<=M&&(B=Tt+1),M<=Tt&&(G=Tt-1)}})(e,t,r||0,f||e.length-1,v||Ih)}function Vc(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function Ih(e,t){return e<t?-1:e>t?1:0}function cc(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,g=[],x=0;x<r;x++){var M=yr(e[x]);M!==0&&(e[x].area=Math.abs(M),v===void 0&&(v=M<0),v===M<0?(f&&g.push(f),f=[e[x]]):f.push(e[x]))}if(f&&g.push(f),t>1)for(var B=0;B<g.length;B++)g[B].length<=t||(ch(g[B],t,1,g[B].length-1,fh),g[B]=g[B].slice(0,t));return g}function fh(e,t){return t.area-e.area}function lf(e,t,r){for(var f=r.patternDependencies,v=!1,g=0,x=t;g<x.length;g+=1){var M=x[g].paint.get(e+"-pattern");M.isConstant()||(v=!0);var B=M.constantOr(null);B&&(v=!0,f[B.to]=!0,f[B.from]=!0)}return v}function cf(e,t,r,f,v){for(var g=v.patternDependencies,x=0,M=t;x<M.length;x+=1){var B=M[x],G=B.paint.get(e+"-pattern").value;if(G.kind!=="constant"){var $=G.evaluate({zoom:f-1},r,{},v.availableImages),ne=G.evaluate({zoom:f},r,{},v.availableImages),fe=G.evaluate({zoom:f+1},r,{},v.availableImages);ne=ne&&ne.name?ne.name:ne,fe=fe&&fe.name?fe.name:fe,g[$=$&&$.name?$.name:$]=!0,g[ne]=!0,g[fe]=!0,r.patterns[B.id]={min:$,mid:ne,max:fe}}}return r}Bf.deviation=function(e,t,r,f){var v=t&&t.length,g=Math.abs(Af(e,0,v?t[0]*r:e.length,r));if(v)for(var x=0,M=t.length;x<M;x++)g-=Math.abs(Af(e,t[x]*r,x<M-1?t[x+1]*r:e.length,r));var B=0;for(x=0;x<f.length;x+=3){var G=f[x]*r,$=f[x+1]*r,ne=f[x+2]*r;B+=Math.abs((e[G]-e[ne])*(e[$+1]-e[G+1])-(e[G]-e[$])*(e[ne+1]-e[G+1]))}return g===0&&B===0?0:Math.abs((B-g)/g)},Bf.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var g=0;g<e[v].length;g++)for(var x=0;x<t;x++)r.vertices.push(e[v][g][x]);v>0&&r.holes.push(f+=e[v-1].length)}return r},Fl.default=Ph;var ou=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new gs,this.indexArray=new Yu,this.indexArray2=new sc,this.programConfigurations=new te(e.layers,e.zoom),this.segments=new we,this.segments2=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};ou.prototype.populate=function(e,t,r){this.hasPattern=lf("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],g=0,x=e;g<x.length;g+=1){var M=x[g],B=M.feature,G=M.id,$=M.index,ne=M.sourceLayerIndex,fe=this.layers[0]._featureFilter.needGeometry,_e=Ir(B,fe);if(this.layers[0]._featureFilter.filter(new na(this.zoom),_e,r)){var Ve=f?f.evaluate(_e,{},r,t.availableImages):void 0,We={id:G,properties:B.properties,type:B.type,sourceLayerIndex:ne,index:$,geometry:fe?_e.geometry:Kt(B),patterns:{},sortKey:Ve};v.push(We)}}f&&v.sort(function(nn,_n){return nn.sortKey-_n.sortKey});for(var ht=0,et=v;ht<et.length;ht+=1){var Tt=et[ht],Nt=Tt.geometry,cr=Tt.index,fr=Tt.sourceLayerIndex;if(this.hasPattern){var Or=cf("fill",this.layers,Tt,this.zoom,t);this.patternFeatures.push(Or)}else this.addFeature(Tt,Nt,cr,r,{});t.featureIndex.insert(e[cr].feature,Nt,cr,fr,this.index)}},ou.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},ou.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},ou.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ou.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ou.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kl),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},ou.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ou.prototype.addFeature=function(e,t,r,f,v){for(var g=0,x=cc(t,500);g<x.length;g+=1){for(var M=x[g],B=0,G=0,$=M;G<$.length;G+=1)B+=$[G].length;for(var ne=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray),fe=ne.vertexLength,_e=[],Ve=[],We=0,ht=M;We<ht.length;We+=1){var et=ht[We];if(et.length!==0){et!==M[0]&&Ve.push(_e.length/2);var Tt=this.segments2.prepareSegment(et.length,this.layoutVertexArray,this.indexArray2),Nt=Tt.vertexLength;this.layoutVertexArray.emplaceBack(et[0].x,et[0].y),this.indexArray2.emplaceBack(Nt+et.length-1,Nt),_e.push(et[0].x),_e.push(et[0].y);for(var cr=1;cr<et.length;cr++)this.layoutVertexArray.emplaceBack(et[cr].x,et[cr].y),this.indexArray2.emplaceBack(Nt+cr-1,Nt+cr),_e.push(et[cr].x),_e.push(et[cr].y);Tt.vertexLength+=et.length,Tt.primitiveLength+=et.length}}for(var fr=Fl(_e,Ve),Or=0;Or<fr.length;Or+=3)this.indexArray.emplaceBack(fe+fr[Or],fe+fr[Or+1],fe+fr[Or+2]);ne.vertexLength+=B,ne.primitiveLength+=fr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Bn("FillBucket",ou,{omit:["layers","patternFeatures"]});var jf=new Zo({"fill-sort-key":new Kn(se.layout_fill["fill-sort-key"])}),Vf={paint:new Zo({"fill-antialias":new ri(se.paint_fill["fill-antialias"]),"fill-opacity":new Kn(se.paint_fill["fill-opacity"]),"fill-color":new Kn(se.paint_fill["fill-color"]),"fill-outline-color":new Kn(se.paint_fill["fill-outline-color"]),"fill-translate":new ri(se.paint_fill["fill-translate"]),"fill-translate-anchor":new ri(se.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ml(se.paint_fill["fill-pattern"])}),layout:jf},ff=function(e){function t(r){e.call(this,r,Vf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new ou(r)},t.prototype.queryRadius=function(){return va(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,M,B){return yi(Ga(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,B),g)},t.prototype.isTileClipped=function(){return!0},t}(iu),Oh=Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,fc=vl;function vl(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(Lh,this,t)}function Lh(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var g=f.readVarint()+f.pos;f.pos<g;){var x=v._keys[f.readVarint()],M=v._values[f.readVarint()];v.properties[x]=M}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Rh(e){for(var t,r,f=0,v=0,g=e.length,x=g-1;v<g;x=v++)f+=((r=e[x]).x-(t=e[v]).x)*(t.y+r.y);return f}vl.types=["Unknown","Point","LineString","Polygon"],vl.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,g=0,x=0,M=[];e.pos<r;){if(v<=0){var B=e.readVarint();f=7&B,v=B>>3}if(v--,f===1||f===2)g+=e.readSVarint(),x+=e.readSVarint(),f===1&&(t&&M.push(t),t=[]),t.push(new W(g,x));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&M.push(t),M},vl.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,g=0,x=1/0,M=-1/0,B=1/0,G=-1/0;e.pos<t;){if(f<=0){var $=e.readVarint();r=7&$,f=$>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<x&&(x=v),v>M&&(M=v),(g+=e.readSVarint())<B&&(B=g),g>G&&(G=g);else if(r!==7)throw new Error("unknown command "+r)}return[x,B,M,G]},vl.prototype.toGeoJSON=function(e,t,r){var f,v,g=this.extent*Math.pow(2,r),x=this.extent*e,M=this.extent*t,B=this.loadGeometry(),G=vl.types[this.type];function $(_e){for(var Ve=0;Ve<_e.length;Ve++){var We=_e[Ve];_e[Ve]=[360*(We.x+x)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(We.y+M)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var ne=[];for(f=0;f<B.length;f++)ne[f]=B[f][0];$(B=ne);break;case 2:for(f=0;f<B.length;f++)$(B[f]);break;case 3:for(B=function(_e){var Ve=_e.length;if(Ve<=1)return[_e];for(var We,ht,et=[],Tt=0;Tt<Ve;Tt++){var Nt=Rh(_e[Tt]);Nt!==0&&(ht===void 0&&(ht=Nt<0),ht===Nt<0?(We&&et.push(We),We=[_e[Tt]]):We.push(_e[Tt]))}return We&&et.push(We),et}(B),f=0;f<B.length;f++)for(v=0;v<B[f].length;v++)$(B[f][v])}B.length===1?B=B[0]:G="Multi"+G;var fe={type:"Feature",geometry:{type:G,coordinates:B},properties:this.properties};return"id"in this&&(fe.id=this.id),fe};var Dh=fp;function fp(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(jp,this,t),this.length=this._features.length}function jp(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,g=f.readVarint()+f.pos;f.pos<g;){var x=f.readVarint()>>3;v=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return v}(r))}function Gc(e,t,r){if(e===3){var f=new Dh(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}fp.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new fc(this._pbf,t,this.extent,this._keys,this._values)};var Ic={VectorTile:function(e,t){this.layers=e.readFields(Gc,{},t)},VectorTileFeature:fc,VectorTileLayer:Dh},hh=Ic.VectorTileFeature.types,Gf=Math.pow(2,13);function hf(e,t,r,f,v,g,x,M){e.emplaceBack(t,r,2*Math.floor(f*Gf)+x,v*Gf*2,g*Gf*2,Math.round(M))}var qu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ms,this.indexArray=new Yu,this.programConfigurations=new te(e.layers,e.zoom),this.segments=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function hp(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}qu.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=lf("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var g=v[f],x=g.feature,M=g.id,B=g.index,G=g.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,ne=Ir(x,$);if(this.layers[0]._featureFilter.filter(new na(this.zoom),ne,r)){var fe={id:M,sourceLayerIndex:G,index:B,geometry:$?ne.geometry:Kt(x),properties:x.properties,type:x.type,patterns:{}};this.hasPattern?this.features.push(cf("fill-extrusion",this.layers,fe,this.zoom,t)):this.addFeature(fe,fe.geometry,B,r,{}),t.featureIndex.insert(x,fe.geometry,B,G,this.index,!0)}}},qu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},qu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},qu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},qu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},qu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Oh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},qu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},qu.prototype.addFeature=function(e,t,r,f,v){for(var g=0,x=cc(t,500);g<x.length;g+=1){for(var M=x[g],B=0,G=0,$=M;G<$.length;G+=1)B+=$[G].length;for(var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),fe=0,_e=M;fe<_e.length;fe+=1){var Ve=_e[fe];if(Ve.length!==0&&!((ca=Ve).every(function(ji){return ji.x<0})||ca.every(function(ji){return ji.x>8192})||ca.every(function(ji){return ji.y<0})||ca.every(function(ji){return ji.y>8192})))for(var We=0,ht=0;ht<Ve.length;ht++){var et=Ve[ht];if(ht>=1){var Tt=Ve[ht-1];if(!hp(et,Tt)){ne.vertexLength+4>we.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Nt=et.sub(Tt)._perp()._unit(),cr=Tt.dist(et);We+cr>32768&&(We=0),hf(this.layoutVertexArray,et.x,et.y,Nt.x,Nt.y,0,0,We),hf(this.layoutVertexArray,et.x,et.y,Nt.x,Nt.y,0,1,We),hf(this.layoutVertexArray,Tt.x,Tt.y,Nt.x,Nt.y,0,0,We+=cr),hf(this.layoutVertexArray,Tt.x,Tt.y,Nt.x,Nt.y,0,1,We);var fr=ne.vertexLength;this.indexArray.emplaceBack(fr,fr+2,fr+1),this.indexArray.emplaceBack(fr+1,fr+2,fr+3),ne.vertexLength+=4,ne.primitiveLength+=2}}}}if(ne.vertexLength+B>we.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray)),hh[e.type]==="Polygon"){for(var Or=[],nn=[],_n=ne.vertexLength,hi=0,Dn=M;hi<Dn.length;hi+=1){var ai=Dn[hi];if(ai.length!==0){ai!==M[0]&&nn.push(Or.length/2);for(var Zn=0;Zn<ai.length;Zn++){var ea=ai[Zn];hf(this.layoutVertexArray,ea.x,ea.y,0,0,1,1,0),Or.push(ea.x),Or.push(ea.y)}}}for(var Ci=Fl(Or,nn),$n=0;$n<Ci.length;$n+=3)this.indexArray.emplaceBack(_n+Ci[$n],_n+Ci[$n+2],_n+Ci[$n+1]);ne.primitiveLength+=Ci.length/3,ne.vertexLength+=B}}var ca;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Bn("FillExtrusionBucket",qu,{omit:["layers","features"]});var Bl={paint:new Zo({"fill-extrusion-opacity":new ri(se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kn(se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ri(se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ri(se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ml(se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kn(se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kn(se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ri(se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},kh=function(e){function t(r){e.call(this,r,Bl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new qu(r)},t.prototype.queryRadius=function(){return va(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,M,B,G){var $=Ga(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,B),ne=this.paint.get("fill-extrusion-height").evaluate(f,v),fe=this.paint.get("fill-extrusion-base").evaluate(f,v),_e=function(We,ht,et,Tt){for(var Nt=[],cr=0,fr=We;cr<fr.length;cr+=1){var Or=fr[cr],nn=[Or.x,Or.y,0,1];ku(nn,nn,ht),Nt.push(new W(nn[0]/nn[3],nn[1]/nn[3]))}return Nt}($,G),Ve=function(We,ht,et,Tt){for(var Nt=[],cr=[],fr=Tt[8]*ht,Or=Tt[9]*ht,nn=Tt[10]*ht,_n=Tt[11]*ht,hi=Tt[8]*et,Dn=Tt[9]*et,ai=Tt[10]*et,Zn=Tt[11]*et,ea=0,Ci=We;ea<Ci.length;ea+=1){for(var $n=[],ca=[],ji=0,Ea=Ci[ea];ji<Ea.length;ji+=1){var vi=Ea[ji],xa=vi.x,To=vi.y,Wo=Tt[0]*xa+Tt[4]*To+Tt[12],Xo=Tt[1]*xa+Tt[5]*To+Tt[13],Oo=Tt[2]*xa+Tt[6]*To+Tt[14],Qo=Tt[3]*xa+Tt[7]*To+Tt[15],Os=Oo+nn,Ls=Qo+_n,uu=Wo+hi,Fs=Xo+Dn,Gs=Oo+ai,Bo=Qo+Zn,Bs=new W((Wo+fr)/Ls,(Xo+Or)/Ls);Bs.z=Os/Ls,$n.push(Bs);var da=new W(uu/Bo,Fs/Bo);da.z=Gs/Bo,ca.push(da)}Nt.push($n),cr.push(ca)}return[Nt,cr]}(g,fe,ne,G);return function(We,ht,et){var Tt=1/0;yi(et,ht)&&(Tt=Nl(et,ht[0]));for(var Nt=0;Nt<ht.length;Nt++)for(var cr=ht[Nt],fr=We[Nt],Or=0;Or<cr.length-1;Or++){var nn=cr[Or],_n=[nn,cr[Or+1],fr[Or+1],fr[Or],nn];fi(et,_n)&&(Tt=Math.min(Tt,Nl(et,_n)))}return Tt!==1/0&&Tt}(Ve[0],Ve[1],_e)},t}(iu);function ml(e,t){return e.x*t.x+e.y*t.y}function Nl(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var g=t[f],x=e[0],M=r.sub(v),B=g.sub(v),G=x.sub(v),$=ml(M,M),ne=ml(M,B),fe=ml(B,B),_e=ml(G,M),Ve=ml(G,B),We=$*fe-ne*ne,ht=(fe*_e-ne*Ve)/We,et=($*Ve-ne*_e)/We,Tt=v.z*(1-ht-et)+r.z*ht+g.z*et;if(isFinite(Tt))return Tt}return 1/0}for(var Nt=1/0,cr=0,fr=t;cr<fr.length;cr+=1)Nt=Math.min(Nt,fr[cr].z);return Nt}var ph=Do([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,dh=Do([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Hf=Ic.VectorTileFeature.types,Fh=Math.cos(Math.PI/180*37.5),us=Math.pow(2,14)/.5,Vo=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new os,this.layoutVertexArray2=new hl,this.indexArray=new Yu,this.programConfigurations=new te(e.layers,e.zoom),this.segments=new we,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};Vo.prototype.populate=function(e,t,r){this.hasPattern=lf("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],g=0,x=e;g<x.length;g+=1){var M=x[g],B=M.feature,G=M.id,$=M.index,ne=M.sourceLayerIndex,fe=this.layers[0]._featureFilter.needGeometry,_e=Ir(B,fe);if(this.layers[0]._featureFilter.filter(new na(this.zoom),_e,r)){var Ve=f?f.evaluate(_e,{},r):void 0,We={id:G,properties:B.properties,type:B.type,sourceLayerIndex:ne,index:$,geometry:fe?_e.geometry:Kt(B),patterns:{},sortKey:Ve};v.push(We)}}f&&v.sort(function(nn,_n){return nn.sortKey-_n.sortKey});for(var ht=0,et=v;ht<et.length;ht+=1){var Tt=et[ht],Nt=Tt.geometry,cr=Tt.index,fr=Tt.sourceLayerIndex;if(this.hasPattern){var Or=cf("line",this.layers,Tt,this.zoom,t);this.patternFeatures.push(Or)}else this.addFeature(Tt,Nt,cr,r,{});t.featureIndex.insert(e[cr].feature,Nt,cr,fr,this.index)}},Vo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Vo.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},Vo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Vo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Vo.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,dh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ph),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Vo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Vo.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Vo.prototype.addFeature=function(e,t,r,f,v){var g=this.layers[0].layout,x=g.get("line-join").evaluate(e,{}),M=g.get("line-cap"),B=g.get("line-miter-limit"),G=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var $=0,ne=t;$<ne.length;$+=1)this.addLine(ne[$],e,x,M,B,G);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Vo.prototype.addLine=function(e,t,r,f,v,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var x=0;x<e.length-1;x++)this.totalDistance+=e[x].dist(e[x+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Hf[t.type]==="Polygon",B=e.length;B>=2&&e[B-1].equals(e[B-2]);)B--;for(var G=0;G<B-1&&e[G].equals(e[G+1]);)G++;if(!(B<(M?3:2))){r==="bevel"&&(v=1.05);var $,ne=this.overscaling<=16?122880/(512*this.overscaling):0,fe=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray),_e=void 0,Ve=void 0,We=void 0,ht=void 0;this.e1=this.e2=-1,M&&(ht=e[G].sub($=e[B-2])._unit()._perp());for(var et=G;et<B;et++)if(!(Ve=et===B-1?M?e[G+1]:void 0:e[et+1])||!e[et].equals(Ve)){ht&&(We=ht),$&&(_e=$),$=e[et],ht=Ve?Ve.sub($)._unit()._perp():We;var Tt=(We=We||ht).add(ht);Tt.x===0&&Tt.y===0||Tt._unit();var Nt=We.x*ht.x+We.y*ht.y,cr=Tt.x*ht.x+Tt.y*ht.y,fr=cr!==0?1/cr:1/0,Or=2*Math.sqrt(2-2*cr),nn=cr<Fh&&_e&&Ve,_n=We.x*ht.y-We.y*ht.x>0;if(nn&&et>G){var hi=$.dist(_e);if(hi>2*ne){var Dn=$.sub($.sub(_e)._mult(ne/hi)._round());this.updateDistance(_e,Dn),this.addCurrentVertex(Dn,We,0,0,fe),_e=Dn}}var ai=_e&&Ve,Zn=ai?r:M?"butt":f;if(ai&&Zn==="round"&&(fr<g?Zn="miter":fr<=2&&(Zn="fakeround")),Zn==="miter"&&fr>v&&(Zn="bevel"),Zn==="bevel"&&(fr>2&&(Zn="flipbevel"),fr<v&&(Zn="miter")),_e&&this.updateDistance(_e,$),Zn==="miter")Tt._mult(fr),this.addCurrentVertex($,Tt,0,0,fe);else if(Zn==="flipbevel"){if(fr>100)Tt=ht.mult(-1);else{var ea=fr*We.add(ht).mag()/We.sub(ht).mag();Tt._perp()._mult(ea*(_n?-1:1))}this.addCurrentVertex($,Tt,0,0,fe),this.addCurrentVertex($,Tt.mult(-1),0,0,fe)}else if(Zn==="bevel"||Zn==="fakeround"){var Ci=-Math.sqrt(fr*fr-1),$n=_n?Ci:0,ca=_n?0:Ci;if(_e&&this.addCurrentVertex($,We,$n,ca,fe),Zn==="fakeround")for(var ji=Math.round(180*Or/Math.PI/20),Ea=1;Ea<ji;Ea++){var vi=Ea/ji;if(vi!==.5){var xa=vi-.5;vi+=vi*xa*(vi-1)*((1.0904+Nt*(Nt*(3.55645-1.43519*Nt)-3.2452))*xa*xa+(.848013+Nt*(.215638*Nt-1.06021)))}var To=ht.sub(We)._mult(vi)._add(We)._unit()._mult(_n?-1:1);this.addHalfVertex($,To.x,To.y,!1,_n,0,fe)}Ve&&this.addCurrentVertex($,ht,-$n,-ca,fe)}else if(Zn==="butt")this.addCurrentVertex($,Tt,0,0,fe);else if(Zn==="square"){var Wo=_e?1:-1;this.addCurrentVertex($,Tt,Wo,Wo,fe)}else Zn==="round"&&(_e&&(this.addCurrentVertex($,We,0,0,fe),this.addCurrentVertex($,We,1,1,fe,!0)),Ve&&(this.addCurrentVertex($,ht,-1,-1,fe,!0),this.addCurrentVertex($,ht,0,0,fe)));if(nn&&et<B-1){var Xo=$.dist(Ve);if(Xo>2*ne){var Oo=$.add(Ve.sub($)._mult(ne/Xo)._round());this.updateDistance($,Oo),this.addCurrentVertex(Oo,ht,0,0,fe),$=Oo}}}}},Vo.prototype.addCurrentVertex=function(e,t,r,f,v,g){g===void 0&&(g=!1);var x=t.y*f-t.x,M=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,g,!1,r,v),this.addHalfVertex(e,x,M,g,!0,-f,v),this.distance>us/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,g))},Vo.prototype.addHalfVertex=function(e,t,r,f,v,g,x){var M=.5*(this.lineClips?this.scaledDistance*(us-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(g===0?0:g<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var B=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,B),x.primitiveLength++),v?this.e2=B:this.e1=B},Vo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Vo.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Bn("LineBucket",Vo,{omit:["layers","patternFeatures"]});var ls=new Zo({"line-cap":new ri(se.layout_line["line-cap"]),"line-join":new Kn(se.layout_line["line-join"]),"line-miter-limit":new ri(se.layout_line["line-miter-limit"]),"line-round-limit":new ri(se.layout_line["line-round-limit"]),"line-sort-key":new Kn(se.layout_line["line-sort-key"])}),su={paint:new Zo({"line-opacity":new Kn(se.paint_line["line-opacity"]),"line-color":new Kn(se.paint_line["line-color"]),"line-translate":new ri(se.paint_line["line-translate"]),"line-translate-anchor":new ri(se.paint_line["line-translate-anchor"]),"line-width":new Kn(se.paint_line["line-width"]),"line-gap-width":new Kn(se.paint_line["line-gap-width"]),"line-offset":new Kn(se.paint_line["line-offset"]),"line-blur":new Kn(se.paint_line["line-blur"]),"line-dasharray":new as(se.paint_line["line-dasharray"]),"line-pattern":new Ml(se.paint_line["line-pattern"]),"line-gradient":new js(se.paint_line["line-gradient"])}),layout:ls},Wf=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new na(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,g){return f=Gt({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,g)},t}(Kn))(su.paint.properties["line-width"].specification);Wf.useIntegerZoom=!0;var Bh=function(e){function t(r){e.call(this,r,su),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ns,this.gradientVersion=(this.gradientVersion+1)%Ne)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=Wf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new Vo(r)},t.prototype.queryRadius=function(r){var f=r,v=Nh(la("line-width",this,f),la("line-gap-width",this,f)),g=la("line-offset",this,f);return v/2+Math.abs(g)+va(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,M,B){var G=Ga(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,B),$=B/2*Nh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),ne=this.paint.get("line-offset").evaluate(f,v);return ne&&(g=function(fe,_e){for(var Ve=[],We=new W(0,0),ht=0;ht<fe.length;ht++){for(var et=fe[ht],Tt=[],Nt=0;Nt<et.length;Nt++){var cr=et[Nt],fr=et[Nt+1],Or=Nt===0?We:cr.sub(et[Nt-1])._unit()._perp(),nn=Nt===et.length-1?We:fr.sub(cr)._unit()._perp(),_n=Or._add(nn)._unit();_n._mult(1/(_n.x*nn.x+_n.y*nn.y)),Tt.push(_n._mult(_e)._add(cr))}Ve.push(Tt)}return Ve}(g,ne*B)),function(fe,_e,Ve){for(var We=0;We<_e.length;We++){var ht=_e[We];if(fe.length>=3){for(var et=0;et<ht.length;et++)if(La(fe,ht[et]))return!0}if(Hi(fe,ht,Ve))return!0}return!1}(G,g,$)},t.prototype.isTileClipped=function(){return!0},t}(iu);function Nh(e,t){return t>0?t+2*e:e}var pp=Do([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),dp=Do([{name:"a_projected_pos",components:3,type:"Float32"}],4),zh=(Do([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Do([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Uh=(Do([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Zh=Do([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function vp(e,t,r){return e.sections.forEach(function(f){f.text=function(v,g,x){var M=g.layout.get("text-transform").evaluate(x,{});return M==="uppercase"?v=v.toLocaleUpperCase():M==="lowercase"&&(v=v.toLocaleLowerCase()),Ps.applyArabicShaping&&(v=Ps.applyArabicShaping(v)),v}(f.text,t,r)}),e}Do([{name:"triangle",components:3,type:"Uint16"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Do([{type:"Float32",name:"offsetX"}]),Do([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var pf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Xf=function(e,t,r,f,v){var g,x,M=8*v-f-1,B=(1<<M)-1,G=B>>1,$=-7,ne=r?v-1:0,fe=r?-1:1,_e=e[t+ne];for(ne+=fe,g=_e&(1<<-$)-1,_e>>=-$,$+=M;$>0;g=256*g+e[t+ne],ne+=fe,$-=8);for(x=g&(1<<-$)-1,g>>=-$,$+=f;$>0;x=256*x+e[t+ne],ne+=fe,$-=8);if(g===0)g=1-G;else{if(g===B)return x?NaN:1/0*(_e?-1:1);x+=Math.pow(2,f),g-=G}return(_e?-1:1)*x*Math.pow(2,g-f)},vh=function(e,t,r,f,v,g){var x,M,B,G=8*g-v-1,$=(1<<G)-1,ne=$>>1,fe=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,_e=f?0:g-1,Ve=f?1:-1,We=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(M=isNaN(t)?1:0,x=$):(x=Math.floor(Math.log(t)/Math.LN2),t*(B=Math.pow(2,-x))<1&&(x--,B*=2),(t+=x+ne>=1?fe/B:fe*Math.pow(2,1-ne))*B>=2&&(x++,B/=2),x+ne>=$?(M=0,x=$):x+ne>=1?(M=(t*B-1)*Math.pow(2,v),x+=ne):(M=t*Math.pow(2,ne-1)*Math.pow(2,v),x=0));v>=8;e[r+_e]=255&M,_e+=Ve,M/=256,v-=8);for(x=x<<v|M,G+=v;G>0;e[r+_e]=255&x,_e+=Ve,x/=256,G-=8);e[r+_e-Ve]|=128*We},Tf=$a;function $a(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}$a.Varint=0,$a.Fixed64=1,$a.Bytes=2,$a.Fixed32=5;var jh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function hc(e){return e.type===$a.Bytes?e.readVarint()+e.pos:e.pos+1}function Hc(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Wc(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function V(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Me(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function $e(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function ar(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Pr(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function rr(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Cr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Fr(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Vr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Kr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function $r(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function rn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function dn(e,t,r){e===1&&r.readMessage(Hr,t)}function Hr(e,t,r){if(e===3){var f=r.readMessage(en,{}),v=f.width,g=f.height,x=f.left,M=f.top,B=f.advance;t.push({id:f.id,bitmap:new xu({width:v+6,height:g+6},f.bitmap),metrics:{width:v,height:g,left:x,top:M,advance:B}})}}function en(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function Lt(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var g=v[f];t+=g.w*g.h,r=Math.max(r,g.w)}e.sort(function(We,ht){return ht.h-We.h});for(var x=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],M=0,B=0,G=0,$=e;G<$.length;G+=1)for(var ne=$[G],fe=x.length-1;fe>=0;fe--){var _e=x[fe];if(!(ne.w>_e.w||ne.h>_e.h)){if(ne.x=_e.x,ne.y=_e.y,B=Math.max(B,ne.y+ne.h),M=Math.max(M,ne.x+ne.w),ne.w===_e.w&&ne.h===_e.h){var Ve=x.pop();fe<x.length&&(x[fe]=Ve)}else ne.h===_e.h?(_e.x+=ne.w,_e.w-=ne.w):ne.w===_e.w?(_e.y+=ne.h,_e.h-=ne.h):(x.push({x:_e.x+ne.w,y:_e.y,w:_e.w-ne.w,h:ne.h}),_e.y+=ne.h,_e.h-=ne.h);break}}return{w:M,h:B,fill:t/(M*B)||0}}$a.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,g=this.pos;this.type=7&f,e(v,t,this),this.pos===g&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Kr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=rn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Kr(this.buf,this.pos)+4294967296*Kr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=Kr(this.buf,this.pos)+4294967296*rn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Xf(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Xf(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,g,x){var M,B,G=x.buf;if(M=(112&(B=G[x.pos++]))>>4,B<128||(M|=(127&(B=G[x.pos++]))<<3,B<128)||(M|=(127&(B=G[x.pos++]))<<10,B<128)||(M|=(127&(B=G[x.pos++]))<<17,B<128)||(M|=(127&(B=G[x.pos++]))<<24,B<128)||(M|=(1&(B=G[x.pos++]))<<31,B<128))return Hc(v,M,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&jh?function(r,f,v){return jh.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var g="",x=f;x<v;){var M,B,G,$=r[x],ne=null,fe=$>239?4:$>223?3:$>191?2:1;if(x+fe>v)break;fe===1?$<128&&(ne=$):fe===2?(192&(M=r[x+1]))==128&&(ne=(31&$)<<6|63&M)<=127&&(ne=null):fe===3?(B=r[x+2],(192&(M=r[x+1]))==128&&(192&B)==128&&((ne=(15&$)<<12|(63&M)<<6|63&B)<=2047||ne>=55296&&ne<=57343)&&(ne=null)):fe===4&&(B=r[x+2],G=r[x+3],(192&(M=r[x+1]))==128&&(192&B)==128&&(192&G)==128&&((ne=(15&$)<<18|(63&M)<<12|(63&B)<<6|63&G)<=65535||ne>=1114112)&&(ne=null)),ne===null?(ne=65533,fe=1):ne>65535&&(ne-=65536,g+=String.fromCharCode(ne>>>10&1023|55296),ne=56320|1023&ne),g+=String.fromCharCode(ne),x+=fe}return g}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==$a.Bytes)return e.push(this.readVarint(t));var r=hc(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==$a.Bytes)return e.push(this.readSVarint());var t=hc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==$a.Bytes)return e.push(this.readBoolean());var t=hc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==$a.Bytes)return e.push(this.readFloat());var t=hc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==$a.Bytes)return e.push(this.readDouble());var t=hc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==$a.Bytes)return e.push(this.readFixed32());var t=hc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==$a.Bytes)return e.push(this.readSFixed32());var t=hc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==$a.Bytes)return e.push(this.readFixed64());var t=hc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==$a.Bytes)return e.push(this.readSFixed64());var t=hc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===$a.Varint)for(;this.buf[this.pos++]>127;);else if(t===$a.Bytes)this.pos=this.readVarint()+this.pos;else if(t===$a.Fixed32)this.pos+=4;else{if(t!==$a.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),$r(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),$r(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),$r(this.buf,-1&e,this.pos),$r(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),$r(this.buf,-1&e,this.pos),$r(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(g,x,M){M.buf[M.pos++]=127&g|128,g>>>=7,M.buf[M.pos++]=127&g|128,g>>>=7,M.buf[M.pos++]=127&g|128,g>>>=7,M.buf[M.pos++]=127&g|128,M.buf[M.pos]=127&(g>>>=7)}(f,0,r),function(g,x){var M=(7&g)<<4;x.buf[x.pos++]|=M|((g>>>=3)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,g){for(var x,M,B=0;B<v.length;B++){if((x=v.charCodeAt(B))>55295&&x<57344){if(!M){x>56319||B+1===v.length?(f[g++]=239,f[g++]=191,f[g++]=189):M=x;continue}if(x<56320){f[g++]=239,f[g++]=191,f[g++]=189,M=x;continue}x=M-55296<<10|x-56320|65536,M=null}else M&&(f[g++]=239,f[g++]=191,f[g++]=189,M=null);x<128?f[g++]=x:(x<2048?f[g++]=x>>6|192:(x<65536?f[g++]=x>>12|224:(f[g++]=x>>18|240,f[g++]=x>>12&63|128),f[g++]=x>>6&63|128),f[g++]=63&x|128)}return g}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&Wc(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),vh(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),vh(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&Wc(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,$a.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,V,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Me,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Pr,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,$e,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,ar,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,rr,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Cr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Fr,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Vr,t)},writeBytesField:function(e,t){this.writeTag(e,$a.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,$a.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,$a.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,$a.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,$a.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,$a.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,$a.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,$a.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,$a.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,$a.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var vr=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,g=t.stretchY,x=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=g,this.content=x,this.version=f},Xr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Xr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Xr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Xr.tlbr.get=function(){return this.tl.concat(this.br)},Xr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(vr.prototype,Xr);var On=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var g=Lt(v),x=new Mo({width:g.w||1,height:g.h||1});for(var M in e){var B=e[M],G=r[M].paddedRect;Mo.copy(B.data,x,{x:0,y:0},{x:G.x+1,y:G.y+1},B.data)}for(var $ in t){var ne=t[$],fe=f[$].paddedRect,_e=fe.x+1,Ve=fe.y+1,We=ne.data.width,ht=ne.data.height;Mo.copy(ne.data,x,{x:0,y:0},{x:_e,y:Ve},ne.data),Mo.copy(ne.data,x,{x:0,y:ht-1},{x:_e,y:Ve-1},{width:We,height:1}),Mo.copy(ne.data,x,{x:0,y:0},{x:_e,y:Ve+ht},{width:We,height:1}),Mo.copy(ne.data,x,{x:We-1,y:0},{x:_e-1,y:Ve},{width:1,height:ht}),Mo.copy(ne.data,x,{x:0,y:0},{x:_e+We,y:Ve},{width:1,height:ht})}this.image=x,this.iconPositions=r,this.patternPositions=f};On.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],g={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(g),t[f]=new vr(g,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},On.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},On.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},Bn("ImagePosition",vr),Bn("ImageAtlas",On);var wr={horizontal:1,vertical:2,horizontalOnly:3},bn=function(){this.scale=1,this.fontStack="",this.imageName=null};bn.forText=function(e,t){var r=new bn;return r.scale=e||1,r.fontStack=t,r},bn.forImage=function(e){var t=new bn;return t.imageName=e,t};var tn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function ui(e,t,r,f,v,g,x,M,B,G,$,ne,fe,_e,Ve,We){var ht,et=tn.fromFeature(e,v);ne===wr.vertical&&et.verticalizePunctuation();var Tt=Ps.processBidirectionalText,Nt=Ps.processStyledBidirectionalText;if(Tt&&et.sections.length===1){ht=[];for(var cr=0,fr=Tt(et.toString(),Sn(et,G,g,t,f,_e,Ve));cr<fr.length;cr+=1){var Or=fr[cr],nn=new tn;nn.text=Or,nn.sections=et.sections;for(var _n=0;_n<Or.length;_n++)nn.sectionIndex.push(0);ht.push(nn)}}else if(Nt){ht=[];for(var hi=0,Dn=Nt(et.text,et.sectionIndex,Sn(et,G,g,t,f,_e,Ve));hi<Dn.length;hi+=1){var ai=Dn[hi],Zn=new tn;Zn.text=ai[0],Zn.sectionIndex=ai[1],Zn.sections=et.sections,ht.push(Zn)}}else ht=function($n,ca){for(var ji=[],Ea=$n.text,vi=0,xa=0,To=ca;xa<To.length;xa+=1){var Wo=To[xa];ji.push($n.substring(vi,Wo)),vi=Wo}return vi<Ea.length&&ji.push($n.substring(vi,Ea.length)),ji}(et,Sn(et,G,g,t,f,_e,Ve));var ea=[],Ci={positionedLines:ea,text:et.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:ne,iconsInText:!1,verticalizable:!1};return function($n,ca,ji,Ea,vi,xa,To,Wo,Xo,Oo,Qo,Os){for(var Ls=0,uu=-17,Fs=0,Gs=0,Bo=Wo==="right"?1:Wo==="left"?0:.5,Bs=0,da=0,ao=vi;da<ao.length;da+=1){var eo=ao[da];eo.trim();var Ca=eo.getMaxScale(),lu=24*(Ca-1),qs={positionedGlyphs:[],lineOffset:0};$n.positionedLines[Bs]=qs;var go=qs.positionedGlyphs,hs=0;if(eo.length()){for(var eu=0;eu<eo.length();eu++){var wa=eo.getSection(eu),Rc=eo.getSectionIndex(eu),gl=eo.getCharCode(eu),Eu=0,Yo=null,yl=null,Ul=null,$f=24,Zl=!(Xo===wr.horizontal||!Qo&&!rc(gl)||Qo&&(Tr[gl]||(vf=gl,gn.Arabic(vf)||gn["Arabic Supplement"](vf)||gn["Arabic Extended-A"](vf)||gn["Arabic Presentation Forms-A"](vf)||gn["Arabic Presentation Forms-B"](vf))));if(wa.imageName){var Jf=Ea[wa.imageName];if(!Jf)continue;Ul=wa.imageName,$n.iconsInText=$n.iconsInText||!0,yl=Jf.paddedRect;var Kc=Jf.displaySize;wa.scale=24*wa.scale/Os,Eu=lu+(24-Kc[1]*wa.scale),$f=(Yo={width:Kc[0],height:Kc[1],left:1,top:-3,advance:Zl?Kc[1]:Kc[0]}).advance;var gh=Zl?Kc[0]*wa.scale-24*Ca:Kc[1]*wa.scale-24*Ca;gh>0&&gh>hs&&(hs=gh)}else{var _p=ji[wa.fontStack],yh=_p&&_p[gl];if(yh&&yh.rect)yl=yh.rect,Yo=yh.metrics;else{var Hh=ca[wa.fontStack],xp=Hh&&Hh[gl];if(!xp)continue;Yo=xp.metrics}Eu=24*(Ca-wa.scale)}Zl?($n.verticalizable=!0,go.push({glyph:gl,imageName:Ul,x:Ls,y:uu+Eu,vertical:Zl,scale:wa.scale,fontStack:wa.fontStack,sectionIndex:Rc,metrics:Yo,rect:yl}),Ls+=$f*wa.scale+Oo):(go.push({glyph:gl,imageName:Ul,x:Ls,y:uu+Eu,vertical:Zl,scale:wa.scale,fontStack:wa.fontStack,sectionIndex:Rc,metrics:Yo,rect:yl}),Ls+=Yo.advance*wa.scale+Oo)}go.length!==0&&(Fs=Math.max(Ls-Oo,Fs),Oi(go,0,go.length-1,Bo,hs)),Ls=0;var bp=xa*Ca+hs;qs.lineOffset=Math.max(hs,lu),uu+=bp,Gs=Math.max(bp,Gs),++Bs}else uu+=xa,++Bs}var vf,Qf=uu- -17,If=Zi(To),Of=If.horizontalAlign,mf=If.verticalAlign;(function(gf,Sp,Lf,Rf,yf,_h,qf,xs,Wh){var eh,Ha=(Sp-Lf)*yf;eh=_h!==qf?-xs*Rf- -17:(-Rf*Wh+.5)*qf;for(var th=0,$c=gf;th<$c.length;th+=1)for(var pc=0,xh=$c[th].positionedGlyphs;pc<xh.length;pc+=1){var rh=xh[pc];rh.x+=Ha,rh.y+=eh}})($n.positionedLines,Bo,Of,mf,Fs,Gs,xa,Qf,vi.length),$n.top+=-mf*Qf,$n.bottom=$n.top+Qf,$n.left+=-Of*Fs,$n.right=$n.left+Fs}(Ci,t,r,f,ht,x,M,B,ne,G,fe,We),!function($n){for(var ca=0,ji=$n;ca<ji.length;ca+=1)if(ji[ca].positionedGlyphs.length!==0)return!1;return!0}(ea)&&Ci}tn.fromFeature=function(e,t){for(var r=new tn,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},tn.prototype.length=function(){return this.text.length},tn.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},tn.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},tn.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},tn.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&Lu(f)&&!pf[e[r+1]]||v&&Lu(v)&&!pf[e[r-1]]||!pf[e[r]]?e[r]:pf[e[r]]}return t}(this.text)},tn.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&Tr[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&Tr[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},tn.prototype.substring=function(e,t){var r=new tn;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},tn.prototype.toString=function(){return this.text},tn.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},tn.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(bn.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},tn.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(bn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Xe("Reached maximum number of images 6401")}else Xe("Can't add FormattedSection with an empty image.")},tn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Tr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Sr={};function Xn(e,t,r,f,v,g){if(t.imageName){var x=f[t.imageName];return x?x.displaySize[0]*t.scale*24/g+v:0}var M=r[t.fontStack],B=M&&M[e];return B?B.metrics.advance*t.scale+v:0}function yn(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function Yr(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function An(e,t,r,f,v,g){for(var x=null,M=yn(t,r,v,g),B=0,G=f;B<G.length;B+=1){var $=G[B],ne=yn(t-$.x,r,v,g)+$.badness;ne<=M&&(x=$,M=ne)}return{index:e,x:t,priorBreak:x,badness:M}}function Sn(e,t,r,f,v,g,x){if(g!=="point")return[];if(!e)return[];for(var M,B=[],G=function(ht,et,Tt,Nt,cr,fr){for(var Or=0,nn=0;nn<ht.length();nn++){var _n=ht.getSection(nn);Or+=Xn(ht.getCharCode(nn),_n,Nt,cr,et,fr)}return Or/Math.max(1,Math.ceil(Or/Tt))}(e,t,r,f,v,x),$=e.text.indexOf("\u200B")>=0,ne=0,fe=0;fe<e.length();fe++){var _e=e.getSection(fe),Ve=e.getCharCode(fe);if(Tr[Ve]||(ne+=Xn(Ve,_e,f,v,t,x)),fe<e.length()-1){var We=!((M=Ve)<11904||!(gn["Bopomofo Extended"](M)||gn.Bopomofo(M)||gn["CJK Compatibility Forms"](M)||gn["CJK Compatibility Ideographs"](M)||gn["CJK Compatibility"](M)||gn["CJK Radicals Supplement"](M)||gn["CJK Strokes"](M)||gn["CJK Symbols and Punctuation"](M)||gn["CJK Unified Ideographs Extension A"](M)||gn["CJK Unified Ideographs"](M)||gn["Enclosed CJK Letters and Months"](M)||gn["Halfwidth and Fullwidth Forms"](M)||gn.Hiragana(M)||gn["Ideographic Description Characters"](M)||gn["Kangxi Radicals"](M)||gn["Katakana Phonetic Extensions"](M)||gn.Katakana(M)||gn["Vertical Forms"](M)||gn["Yi Radicals"](M)||gn["Yi Syllables"](M)));(Sr[Ve]||We||_e.imageName)&&B.push(An(fe+1,ne,G,B,Yr(Ve,e.getCharCode(fe+1),We&&$),!1))}}return function ht(et){return et?ht(et.priorBreak).concat(et.index):[]}(An(e.length(),ne,G,B,0,!0))}function Zi(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Oi(e,t,r,f,v){if(f||v)for(var g=e[r],x=(e[r].x+g.metrics.advance*g.scale)*f,M=t;M<=r;M++)e[M].x-=x,e[M].y+=v}function Tn(e,t,r,f,v,g){var x,M=e.image;if(M.content){var B=M.content,G=M.pixelRatio||1;x=[B[0]/G,B[1]/G,M.displaySize[0]-B[2]/G,M.displaySize[1]-B[3]/G]}var $,ne,fe,_e,Ve=t.left*g,We=t.right*g;r==="width"||r==="both"?(_e=v[0]+Ve-f[3],ne=v[0]+We+f[1]):ne=(_e=v[0]+(Ve+We-M.displaySize[0])/2)+M.displaySize[0];var ht=t.top*g,et=t.bottom*g;return r==="height"||r==="both"?($=v[1]+ht-f[0],fe=v[1]+et+f[2]):fe=($=v[1]+(ht+et-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:$,right:ne,bottom:fe,left:_e,collisionPadding:x}}Sr[10]=!0,Sr[32]=!0,Sr[38]=!0,Sr[40]=!0,Sr[41]=!0,Sr[43]=!0,Sr[45]=!0,Sr[47]=!0,Sr[173]=!0,Sr[183]=!0,Sr[8203]=!0,Sr[8208]=!0,Sr[8211]=!0,Sr[8231]=!0;var En=function(e){function t(r,f,v,g){e.call(this,r,f),this.angle=v,g!==void 0&&(this.segment=g)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(W);function bi(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new na(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,g=0;g<f.length&&f[g]<=e;)g++;for(var x=g=Math.max(0,g-1);x<f.length&&f[x]<e+1;)x++;x=Math.min(f.length-1,x);var M=f[g],B=f[x];return r.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:B,interpolationType:v}:{kind:"camera",minZoom:M,maxZoom:B,minSize:r.evaluate(new na(M)),maxSize:r.evaluate(new na(B)),interpolationType:v}}function Li(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?Ta(v/128,r.upperSize/128,t.uSizeT):f}function qi(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,g=v?rt(Ie.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=Ta(e.minSize,e.maxSize,g):r=g}return{uSizeT:r,uSize:f}}Bn("Anchor",En);var yo=Object.freeze({__proto__:null,getSizeData:bi,evaluateSizeForFeature:Li,evaluateSizeForZoom:qi,SIZE_PACK_FACTOR:128});function Fo(e,t,r,f,v){if(t.segment===void 0)return!0;for(var g=t,x=t.segment+1,M=0;M>-r/2;){if(--x<0)return!1;M-=e[x].dist(g),g=e[x]}M+=e[x].dist(e[x+1]),x++;for(var B=[],G=0;M<r/2;){var $=e[x],ne=e[x+1];if(!ne)return!1;var fe=e[x-1].angleTo($)-$.angleTo(ne);for(fe=Math.abs((fe+3*Math.PI)%(2*Math.PI)-Math.PI),B.push({distance:M,angleDelta:fe}),G+=fe;M-B[0].distance>f;)G-=B.shift().angleDelta;if(G>v)return!1;x++,M+=$.dist(ne)}return!0}function pa(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function ys(e,t,r){return e?.6*t*r:0}function fo(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Ja(e,t,r,f,v,g){for(var x=ys(r,v,g),M=fo(r,f)*g,B=0,G=pa(e)/2,$=0;$<e.length-1;$++){var ne=e[$],fe=e[$+1],_e=ne.dist(fe);if(B+_e>G){var Ve=(G-B)/_e,We=Ta(ne.x,fe.x,Ve),ht=Ta(ne.y,fe.y,Ve),et=new En(We,ht,fe.angleTo(ne),$);return et._round(),!x||Fo(e,et,M,x,t)?et:void 0}B+=_e}}function Io(e,t,r,f,v,g,x,M,B){var G=ys(f,g,x),$=fo(f,v),ne=$*x,fe=e[0].x===0||e[0].x===B||e[0].y===0||e[0].y===B;return t-ne<t/4&&(t=ne+t/4),function _e(Ve,We,ht,et,Tt,Nt,cr,fr,Or){for(var nn=Nt/2,_n=pa(Ve),hi=0,Dn=We-ht,ai=[],Zn=0;Zn<Ve.length-1;Zn++){for(var ea=Ve[Zn],Ci=Ve[Zn+1],$n=ea.dist(Ci),ca=Ci.angleTo(ea);Dn+ht<hi+$n;){var ji=((Dn+=ht)-hi)/$n,Ea=Ta(ea.x,Ci.x,ji),vi=Ta(ea.y,Ci.y,ji);if(Ea>=0&&Ea<Or&&vi>=0&&vi<Or&&Dn-nn>=0&&Dn+nn<=_n){var xa=new En(Ea,vi,ca,Zn);xa._round(),et&&!Fo(Ve,xa,Nt,et,Tt)||ai.push(xa)}}hi+=$n}return fr||ai.length||cr||(ai=_e(Ve,hi/2,ht,et,Tt,Nt,cr,!0,Or)),ai}(e,fe?t/2*M%t:($/2+2*g)*x*M%t,t,G,r,ne,fe,!1,B)}function cs(e,t,r,f,v){for(var g=[],x=0;x<e.length;x++)for(var M=e[x],B=void 0,G=0;G<M.length-1;G++){var $=M[G],ne=M[G+1];$.x<t&&ne.x<t||($.x<t?$=new W(t,$.y+(t-$.x)/(ne.x-$.x)*(ne.y-$.y))._round():ne.x<t&&(ne=new W(t,$.y+(t-$.x)/(ne.x-$.x)*(ne.y-$.y))._round()),$.y<r&&ne.y<r||($.y<r?$=new W($.x+(r-$.y)/(ne.y-$.y)*(ne.x-$.x),r)._round():ne.y<r&&(ne=new W($.x+(r-$.y)/(ne.y-$.y)*(ne.x-$.x),r)._round()),$.x>=f&&ne.x>=f||($.x>=f?$=new W(f,$.y+(f-$.x)/(ne.x-$.x)*(ne.y-$.y))._round():ne.x>=f&&(ne=new W(f,$.y+(f-$.x)/(ne.x-$.x)*(ne.y-$.y))._round()),$.y>=v&&ne.y>=v||($.y>=v?$=new W($.x+(v-$.y)/(ne.y-$.y)*(ne.x-$.x),v)._round():ne.y>=v&&(ne=new W($.x+(v-$.y)/(ne.y-$.y)*(ne.x-$.x),v)._round()),B&&$.equals(B[B.length-1])||g.push(B=[$]),B.push(ne)))))}return g}function fs(e,t,r,f){var v=[],g=e.image,x=g.pixelRatio,M=g.paddedRect.w-2,B=g.paddedRect.h-2,G=e.right-e.left,$=e.bottom-e.top,ne=g.stretchX||[[0,M]],fe=g.stretchY||[[0,B]],_e=function(Ea,vi){return Ea+vi[1]-vi[0]},Ve=ne.reduce(_e,0),We=fe.reduce(_e,0),ht=M-Ve,et=B-We,Tt=0,Nt=Ve,cr=0,fr=We,Or=0,nn=ht,_n=0,hi=et;if(g.content&&f){var Dn=g.content;Tt=_s(ne,0,Dn[0]),cr=_s(fe,0,Dn[1]),Nt=_s(ne,Dn[0],Dn[2]),fr=_s(fe,Dn[1],Dn[3]),Or=Dn[0]-Tt,_n=Dn[1]-cr,nn=Dn[2]-Dn[0]-Nt,hi=Dn[3]-Dn[1]-fr}var ai=function(Ea,vi,xa,To){var Wo=Wi(Ea.stretch-Tt,Nt,G,e.left),Xo=Jo(Ea.fixed-Or,nn,Ea.stretch,Ve),Oo=Wi(vi.stretch-cr,fr,$,e.top),Qo=Jo(vi.fixed-_n,hi,vi.stretch,We),Os=Wi(xa.stretch-Tt,Nt,G,e.left),Ls=Jo(xa.fixed-Or,nn,xa.stretch,Ve),uu=Wi(To.stretch-cr,fr,$,e.top),Fs=Jo(To.fixed-_n,hi,To.stretch,We),Gs=new W(Wo,Oo),Bo=new W(Os,Oo),Bs=new W(Os,uu),da=new W(Wo,uu),ao=new W(Xo/x,Qo/x),eo=new W(Ls/x,Fs/x),Ca=t*Math.PI/180;if(Ca){var lu=Math.sin(Ca),qs=Math.cos(Ca),go=[qs,-lu,lu,qs];Gs._matMult(go),Bo._matMult(go),da._matMult(go),Bs._matMult(go)}var hs=Ea.stretch+Ea.fixed,eu=vi.stretch+vi.fixed;return{tl:Gs,tr:Bo,bl:da,br:Bs,tex:{x:g.paddedRect.x+1+hs,y:g.paddedRect.y+1+eu,w:xa.stretch+xa.fixed-hs,h:To.stretch+To.fixed-eu},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ao,pixelOffsetBR:eo,minFontScaleX:nn/x/G,minFontScaleY:hi/x/$,isSDF:r}};if(f&&(g.stretchX||g.stretchY))for(var Zn=Go(ne,ht,Ve),ea=Go(fe,et,We),Ci=0;Ci<Zn.length-1;Ci++)for(var $n=Zn[Ci],ca=Zn[Ci+1],ji=0;ji<ea.length-1;ji++)v.push(ai($n,ea[ji],ca,ea[ji+1]));else v.push(ai({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:B+1}));return v}function _s(e,t,r){for(var f=0,v=0,g=e;v<g.length;v+=1){var x=g[v];f+=Math.max(t,Math.min(r,x[1]))-Math.max(t,Math.min(r,x[0]))}return f}function Go(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,g=e;v<g.length;v+=1){var x=g[v],M=x[0],B=x[1],G=f[f.length-1];f.push({fixed:M-G.stretch,stretch:G.stretch}),f.push({fixed:M-G.stretch,stretch:G.stretch+(B-M)})}return f.push({fixed:t+1,stretch:r}),f}function Wi(e,t,r,f){return e/t*r+f}function Jo(e,t,r,f){return e-t*r/f}var Pa=function(e,t,r,f,v,g,x,M,B,G){if(this.boxStartIndex=e.length,B){var $=g.top,ne=g.bottom,fe=g.collisionPadding;fe&&($-=fe[1],ne+=fe[3]);var _e=ne-$;_e>0&&(_e=Math.max(10,_e),this.circleDiameter=_e)}else{var Ve=g.top*x-M,We=g.bottom*x+M,ht=g.left*x-M,et=g.right*x+M,Tt=g.collisionPadding;if(Tt&&(ht-=Tt[0]*x,Ve-=Tt[1]*x,et+=Tt[2]*x,We+=Tt[3]*x),G){var Nt=new W(ht,Ve),cr=new W(et,Ve),fr=new W(ht,We),Or=new W(et,We),nn=G*Math.PI/180;Nt._rotate(nn),cr._rotate(nn),fr._rotate(nn),Or._rotate(nn),ht=Math.min(Nt.x,cr.x,fr.x,Or.x),et=Math.max(Nt.x,cr.x,fr.x,Or.x),Ve=Math.min(Nt.y,cr.y,fr.y,Or.y),We=Math.max(Nt.y,cr.y,fr.y,Or.y)}e.emplaceBack(t.x,t.y,ht,Ve,et,We,r,f,v)}this.boxEndIndex=e.length},_o=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=_i),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function _i(e,t){return e<t?-1:e>t?1:0}function ha(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,g=-1/0,x=-1/0,M=e[0],B=0;B<M.length;B++){var G=M[B];(!B||G.x<f)&&(f=G.x),(!B||G.y<v)&&(v=G.y),(!B||G.x>g)&&(g=G.x),(!B||G.y>x)&&(x=G.y)}var $=Math.min(g-f,x-v),ne=$/2,fe=new _o([],io);if($===0)return new W(f,v);for(var _e=f;_e<g;_e+=$)for(var Ve=v;Ve<x;Ve+=$)fe.push(new xo(_e+ne,Ve+ne,ne,e));for(var We=function(Tt){for(var Nt=0,cr=0,fr=0,Or=Tt[0],nn=0,_n=Or.length,hi=_n-1;nn<_n;hi=nn++){var Dn=Or[nn],ai=Or[hi],Zn=Dn.x*ai.y-ai.x*Dn.y;cr+=(Dn.x+ai.x)*Zn,fr+=(Dn.y+ai.y)*Zn,Nt+=3*Zn}return new xo(cr/Nt,fr/Nt,0,Tt)}(e),ht=fe.length;fe.length;){var et=fe.pop();(et.d>We.d||!We.d)&&(We=et,r&&console.log("found best %d after %d probes",Math.round(1e4*et.d)/1e4,ht)),et.max-We.d<=t||(fe.push(new xo(et.p.x-(ne=et.h/2),et.p.y-ne,ne,e)),fe.push(new xo(et.p.x+ne,et.p.y-ne,ne,e)),fe.push(new xo(et.p.x-ne,et.p.y+ne,ne,e)),fe.push(new xo(et.p.x+ne,et.p.y+ne,ne,e)),ht+=4)}return r&&(console.log("num probes: "+ht),console.log("best distance: "+We.d)),We.p}function io(e,t){return t.max-e.max}function xo(e,t,r,f){this.p=new W(e,t),this.h=r,this.d=function(v,g){for(var x=!1,M=1/0,B=0;B<g.length;B++)for(var G=g[B],$=0,ne=G.length,fe=ne-1;$<ne;fe=$++){var _e=G[$],Ve=G[fe];_e.y>v.y!=Ve.y>v.y&&v.x<(Ve.x-_e.x)*(v.y-_e.y)/(Ve.y-_e.y)+_e.x&&(x=!x),M=Math.min(M,Ba(v,_e,Ve))}return(x?1:-1)*Math.sqrt(M)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}_o.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},_o.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},_o.prototype.peek=function(){return this.data[0]},_o.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,g=t[v];if(r(f,g)>=0)break;t[e]=g,e=v}t[e]=f},_o.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var g=1+(e<<1),x=t[g],M=g+1;if(M<this.length&&r(t[M],x)<0&&(g=M,x=t[M]),r(x,v)>=0)break;t[e]=x,e=g}t[e]=v};var bu=Number.POSITIVE_INFINITY;function Ue(e,t){return t[1]!==bu?function(r,f,v){var g=0,x=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":x=v-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-v}switch(r){case"top-right":case"bottom-right":case"right":g=-f;break;case"top-left":case"bottom-left":case"left":g=f}return[g,x]}(e,t[0],t[1]):function(r,f){var v=0,g=0;f<0&&(f=0);var x=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":g=x-7;break;case"bottom-right":case"bottom-left":g=7-x;break;case"bottom":g=7-f;break;case"top":g=f-7}switch(r){case"top-right":case"bottom-right":v=-x;break;case"top-left":case"bottom-left":v=x;break;case"left":v=f;break;case"right":v=-f}return[v,g]}(e,t[0])}function er(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jt(e,t,r,f,v,g,x,M,B,G,$,ne,fe,_e,Ve){var We=function(cr,fr,Or,nn,_n,hi,Dn,ai){for(var Zn=nn.layout.get("text-rotate").evaluate(hi,{})*Math.PI/180,ea=[],Ci=0,$n=fr.positionedLines;Ci<$n.length;Ci+=1)for(var ca=$n[Ci],ji=0,Ea=ca.positionedGlyphs;ji<Ea.length;ji+=1){var vi=Ea[ji];if(vi.rect){var xa=vi.rect||{},To=4,Wo=!0,Xo=1,Oo=0,Qo=(_n||ai)&&vi.vertical,Os=vi.metrics.advance*vi.scale/2;if(ai&&fr.verticalizable&&(Oo=ca.lineOffset/2-(vi.imageName?-(24-vi.metrics.width*vi.scale)/2:24*(vi.scale-1))),vi.imageName){var Ls=Dn[vi.imageName];Wo=Ls.sdf,To=1/(Xo=Ls.pixelRatio)}var uu=_n?[vi.x+Os,vi.y]:[0,0],Fs=_n?[0,0]:[vi.x+Os+Or[0],vi.y+Or[1]-Oo],Gs=[0,0];Qo&&(Gs=Fs,Fs=[0,0]);var Bo=(vi.metrics.left-To)*vi.scale-Os+Fs[0],Bs=(-vi.metrics.top-To)*vi.scale+Fs[1],da=Bo+xa.w*vi.scale/Xo,ao=Bs+xa.h*vi.scale/Xo,eo=new W(Bo,Bs),Ca=new W(da,Bs),lu=new W(Bo,ao),qs=new W(da,ao);if(Qo){var go=new W(-Os,Os- -17),hs=-Math.PI/2,eu=12-Os,wa=new W(22-eu,-(vi.imageName?eu:0)),Rc=new(Function.prototype.bind.apply(W,[null].concat(Gs)));eo._rotateAround(hs,go)._add(wa)._add(Rc),Ca._rotateAround(hs,go)._add(wa)._add(Rc),lu._rotateAround(hs,go)._add(wa)._add(Rc),qs._rotateAround(hs,go)._add(wa)._add(Rc)}if(Zn){var gl=Math.sin(Zn),Eu=Math.cos(Zn),Yo=[Eu,-gl,gl,Eu];eo._matMult(Yo),Ca._matMult(Yo),lu._matMult(Yo),qs._matMult(Yo)}var yl=new W(0,0),Ul=new W(0,0);ea.push({tl:eo,tr:Ca,bl:lu,br:qs,tex:xa,writingMode:fr.writingMode,glyphOffset:uu,sectionIndex:vi.sectionIndex,isSDF:Wo,pixelOffsetTL:yl,pixelOffsetBR:Ul,minFontScaleX:0,minFontScaleY:0})}}return ea}(0,r,M,v,g,x,f,e.allowVerticalPlacement),ht=e.textSizeData,et=null;ht.kind==="source"?(et=[128*v.layout.get("text-size").evaluate(x,{})])[0]>32640&&Xe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ht.kind==="composite"&&((et=[128*_e.compositeTextSizes[0].evaluate(x,{},Ve),128*_e.compositeTextSizes[1].evaluate(x,{},Ve)])[0]>32640||et[1]>32640)&&Xe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,We,et,M,g,x,G,t,B.lineStartIndex,B.lineLength,fe,Ve);for(var Tt=0,Nt=$;Tt<Nt.length;Tt+=1)ne[Nt[Tt]]=e.text.placedSymbolArray.length-1;return 4*We.length}function zn(e){for(var t in e)return e[t];return null}function oa(e,t,r,f){var v=e.compareText;if(t in v){for(var g=v[t],x=g.length-1;x>=0;x--)if(f.dist(g[x])<r)return!0}else v[t]=[];return v[t].push(f),!1}var ke=Ic.VectorTileFeature.types,Se=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ot(e,t,r,f,v,g,x,M,B,G,$,ne,fe){var _e=M?Math.min(32640,Math.round(M[0])):0,Ve=M?Math.min(32640,Math.round(M[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),g,x,(_e<<1)+(B?1:0),Ve,16*G,16*$,256*ne,256*fe)}function Rt(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function or(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(nc(r[t].text))return!0;return!1}var vt=function(e){this.layoutVertexArray=new ac,this.indexArray=new Yu,this.programConfigurations=e,this.segments=new we,this.dynamicLayoutVertexArray=new Wu,this.opacityVertexArray=new Xu,this.placedSymbolArray=new h};vt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},vt.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,dp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Se,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},vt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Bn("SymbolBuffers",vt);var ft=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new we,this.collisionVertexArray=new jc};ft.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,zh.members,!0)},ft.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Bn("CollisionBuffers",ft);var nt=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(g){return g.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=$o([]),this.placementViewportMatrix=$o([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bi(this.zoom,t["text-size"]),this.iconSizeData=bi(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(g){return wr[g]})),this.stateDependentLayerIds=this.layers.filter(function(g){return g.isStateDependent()}).map(function(g){return g.id}),this.sourceID=e.sourceID};nt.prototype.createArrays=function(){this.text=new vt(new te(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new vt(new te(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new P,this.lineVertexArray=new F,this.symbolInstances=new b},nt.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var g=0;g<e.length;g++)if(t[e.charCodeAt(g)]=!0,(r||f)&&v){var x=pf[e.charAt(g)];x&&(t[x.charCodeAt(0)]=!0)}},nt.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,g=v.get("text-font"),x=v.get("text-field"),M=v.get("icon-image"),B=(x.value.kind!=="constant"||x.value.value instanceof ta&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),G=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,$=v.get("symbol-sort-key");if(this.features=[],B||G){for(var ne=t.iconDependencies,fe=t.glyphDependencies,_e=t.availableImages,Ve=new na(this.zoom),We=0,ht=e;We<ht.length;We+=1){var et=ht[We],Tt=et.feature,Nt=et.id,cr=et.index,fr=et.sourceLayerIndex,Or=f._featureFilter.needGeometry,nn=Ir(Tt,Or);if(f._featureFilter.filter(Ve,nn,r)){Or||(nn.geometry=Kt(Tt));var _n=void 0;if(B){var hi=f.getValueAndResolveTokens("text-field",nn,r,_e),Dn=ta.factory(hi);or(Dn)&&(this.hasRTLText=!0),(!this.hasRTLText||Cc()==="unavailable"||this.hasRTLText&&Ps.isParsed())&&(_n=vp(Dn,f,nn))}var ai=void 0;if(G){var Zn=f.getValueAndResolveTokens("icon-image",nn,r,_e);ai=Zn instanceof Vi?Zn:Vi.fromString(Zn)}if(_n||ai){var ea=this.sortFeaturesByKey?$.evaluate(nn,{},r):void 0;if(this.features.push({id:Nt,text:_n,icon:ai,index:cr,sourceLayerIndex:fr,geometry:nn.geometry,properties:Tt.properties,type:ke[Tt.type],sortKey:ea}),ai&&(ne[ai.name]=!0),_n){var Ci=g.evaluate(nn,{},r).join(","),$n=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(wr.vertical)>=0;for(var ca=0,ji=_n.sections;ca<ji.length;ca+=1){var Ea=ji[ca];if(Ea.image)ne[Ea.image.name]=!0;else{var vi=tc(_n.toString()),xa=Ea.fontStack||Ci,To=fe[xa]=fe[xa]||{};this.calculateGlyphDependencies(Ea.text,To,$n,this.allowVerticalPlacement,vi)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(Wo){var Xo={},Oo={},Qo=[],Os=0;function Ls(go){Qo.push(Wo[go]),Os++}function uu(go,hs,eu){var wa=Oo[go];return delete Oo[go],Oo[hs]=wa,Qo[wa].geometry[0].pop(),Qo[wa].geometry[0]=Qo[wa].geometry[0].concat(eu[0]),wa}function Fs(go,hs,eu){var wa=Xo[hs];return delete Xo[hs],Xo[go]=wa,Qo[wa].geometry[0].shift(),Qo[wa].geometry[0]=eu[0].concat(Qo[wa].geometry[0]),wa}function Gs(go,hs,eu){var wa=eu?hs[0][hs[0].length-1]:hs[0][0];return go+":"+wa.x+":"+wa.y}for(var Bo=0;Bo<Wo.length;Bo++){var Bs=Wo[Bo],da=Bs.geometry,ao=Bs.text?Bs.text.toString():null;if(ao){var eo=Gs(ao,da),Ca=Gs(ao,da,!0);if(eo in Oo&&Ca in Xo&&Oo[eo]!==Xo[Ca]){var lu=Fs(eo,Ca,da),qs=uu(eo,Ca,Qo[lu].geometry);delete Xo[eo],delete Oo[Ca],Oo[Gs(ao,Qo[qs].geometry,!0)]=qs,Qo[lu].geometry=null}else eo in Oo?uu(eo,Ca,da):Ca in Xo?Fs(eo,Ca,da):(Ls(Bo),Xo[eo]=Os-1,Oo[Ca]=Os-1)}else Ls(Bo)}return Qo.filter(function(go){return go.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Wo,Xo){return Wo.sortKey-Xo.sortKey})}},nt.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},nt.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},nt.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},nt.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},nt.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},nt.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},nt.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),g={},x=e.segment+1;x<t.length;x++)g[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:f},x<t.length-1&&(f+=t[x+1].dist(t[x]));for(var M=e.segment||0;M>=0;M--)g[M]={x:t[M].x,y:t[M].y,tileUnitDistanceFromAnchor:v},M>0&&(v+=t[M-1].dist(t[M]));for(var B=0;B<t.length;B++){var G=g[B];this.lineVertexArray.emplaceBack(G.x,G.y,G.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},nt.prototype.addSymbols=function(e,t,r,f,v,g,x,M,B,G,$,ne){for(var fe=e.indexArray,_e=e.layoutVertexArray,Ve=e.segments.prepareSegment(4*t.length,_e,fe,this.canOverlap?g.sortKey:void 0),We=this.glyphOffsetArray.length,ht=Ve.vertexLength,et=this.allowVerticalPlacement&&x===wr.vertical?Math.PI/2:0,Tt=g.text&&g.text.sections,Nt=0;Nt<t.length;Nt++){var cr=t[Nt],fr=cr.tl,Or=cr.tr,nn=cr.bl,_n=cr.br,hi=cr.tex,Dn=cr.pixelOffsetTL,ai=cr.pixelOffsetBR,Zn=cr.minFontScaleX,ea=cr.minFontScaleY,Ci=cr.glyphOffset,$n=cr.isSDF,ca=cr.sectionIndex,ji=Ve.vertexLength,Ea=Ci[1];ot(_e,M.x,M.y,fr.x,Ea+fr.y,hi.x,hi.y,r,$n,Dn.x,Dn.y,Zn,ea),ot(_e,M.x,M.y,Or.x,Ea+Or.y,hi.x+hi.w,hi.y,r,$n,ai.x,Dn.y,Zn,ea),ot(_e,M.x,M.y,nn.x,Ea+nn.y,hi.x,hi.y+hi.h,r,$n,Dn.x,ai.y,Zn,ea),ot(_e,M.x,M.y,_n.x,Ea+_n.y,hi.x+hi.w,hi.y+hi.h,r,$n,ai.x,ai.y,Zn,ea),Rt(e.dynamicLayoutVertexArray,M,et),fe.emplaceBack(ji,ji+1,ji+2),fe.emplaceBack(ji+1,ji+2,ji+3),Ve.vertexLength+=4,Ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ci[0]),Nt!==t.length-1&&ca===t[Nt+1].sectionIndex||e.programConfigurations.populatePaintArrays(_e.length,g,g.index,{},ne,Tt&&Tt[ca])}e.placedSymbolArray.emplaceBack(M.x,M.y,We,this.glyphOffsetArray.length-We,ht,B,G,M.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],x,0,!1,0,$)},nt.prototype._addCollisionDebugVertex=function(e,t,r,f,v,g){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(g.x),Math.round(g.y))},nt.prototype.addCollisionDebugVertices=function(e,t,r,f,v,g,x){var M=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),B=M.vertexLength,G=v.layoutVertexArray,$=v.collisionVertexArray,ne=x.anchorX,fe=x.anchorY;this._addCollisionDebugVertex(G,$,g,ne,fe,new W(e,t)),this._addCollisionDebugVertex(G,$,g,ne,fe,new W(r,t)),this._addCollisionDebugVertex(G,$,g,ne,fe,new W(r,f)),this._addCollisionDebugVertex(G,$,g,ne,fe,new W(e,f)),M.vertexLength+=4;var _e=v.indexArray;_e.emplaceBack(B,B+1),_e.emplaceBack(B+1,B+2),_e.emplaceBack(B+2,B+3),_e.emplaceBack(B+3,B),M.primitiveLength+=4},nt.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var g=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,f?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,r)}},nt.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ft(Ol,Uh.members,sc),this.iconCollisionBox=new ft(Ol,Uh.members,sc);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},nt.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,g,x,M,B){for(var G={},$=t;$<r;$++){var ne=e.get($);G.textBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},G.textFeatureIndex=ne.featureIndex;break}for(var fe=f;fe<v;fe++){var _e=e.get(fe);G.verticalTextBox={x1:_e.x1,y1:_e.y1,x2:_e.x2,y2:_e.y2,anchorPointX:_e.anchorPointX,anchorPointY:_e.anchorPointY},G.verticalTextFeatureIndex=_e.featureIndex;break}for(var Ve=g;Ve<x;Ve++){var We=e.get(Ve);G.iconBox={x1:We.x1,y1:We.y1,x2:We.x2,y2:We.y2,anchorPointX:We.anchorPointX,anchorPointY:We.anchorPointY},G.iconFeatureIndex=We.featureIndex;break}for(var ht=M;ht<B;ht++){var et=e.get(ht);G.verticalIconBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},G.verticalIconFeatureIndex=et.featureIndex;break}return G},nt.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},nt.prototype.hasTextData=function(){return this.text.segments.get().length>0},nt.prototype.hasIconData=function(){return this.icon.segments.get().length>0},nt.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},nt.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},nt.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},nt.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},nt.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],g=[],x=0;x<this.symbolInstances.length;++x){g.push(x);var M=this.symbolInstances.get(x);f.push(0|Math.round(t*M.anchorX+r*M.anchorY)),v.push(M.featureIndex)}return g.sort(function(B,G){return f[B]-f[G]||v[G]-v[B]}),g},nt.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},nt.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(g,x,M){g>=0&&M.indexOf(g)===x&&t.addIndicesForPlacedSymbol(t.text,g)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Bn("SymbolBucket",nt,{omit:["layers","collisionBoxArray","features","compareText"]}),nt.MAX_GLYPHS=65535,nt.addDynamicAttributes=Rt;var Oe=new Zo({"symbol-placement":new ri(se.layout_symbol["symbol-placement"]),"symbol-spacing":new ri(se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ri(se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kn(se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ri(se.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ri(se.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ri(se.layout_symbol["icon-ignore-placement"]),"icon-optional":new ri(se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ri(se.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kn(se.layout_symbol["icon-size"]),"icon-text-fit":new ri(se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ri(se.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kn(se.layout_symbol["icon-image"]),"icon-rotate":new Kn(se.layout_symbol["icon-rotate"]),"icon-padding":new ri(se.layout_symbol["icon-padding"]),"icon-keep-upright":new ri(se.layout_symbol["icon-keep-upright"]),"icon-offset":new Kn(se.layout_symbol["icon-offset"]),"icon-anchor":new Kn(se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ri(se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ri(se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ri(se.layout_symbol["text-rotation-alignment"]),"text-field":new Kn(se.layout_symbol["text-field"]),"text-font":new Kn(se.layout_symbol["text-font"]),"text-size":new Kn(se.layout_symbol["text-size"]),"text-max-width":new Kn(se.layout_symbol["text-max-width"]),"text-line-height":new ri(se.layout_symbol["text-line-height"]),"text-letter-spacing":new Kn(se.layout_symbol["text-letter-spacing"]),"text-justify":new Kn(se.layout_symbol["text-justify"]),"text-radial-offset":new Kn(se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ri(se.layout_symbol["text-variable-anchor"]),"text-anchor":new Kn(se.layout_symbol["text-anchor"]),"text-max-angle":new ri(se.layout_symbol["text-max-angle"]),"text-writing-mode":new ri(se.layout_symbol["text-writing-mode"]),"text-rotate":new Kn(se.layout_symbol["text-rotate"]),"text-padding":new ri(se.layout_symbol["text-padding"]),"text-keep-upright":new ri(se.layout_symbol["text-keep-upright"]),"text-transform":new Kn(se.layout_symbol["text-transform"]),"text-offset":new Kn(se.layout_symbol["text-offset"]),"text-allow-overlap":new ri(se.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ri(se.layout_symbol["text-ignore-placement"]),"text-optional":new ri(se.layout_symbol["text-optional"])}),Qe={paint:new Zo({"icon-opacity":new Kn(se.paint_symbol["icon-opacity"]),"icon-color":new Kn(se.paint_symbol["icon-color"]),"icon-halo-color":new Kn(se.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kn(se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kn(se.paint_symbol["icon-halo-blur"]),"icon-translate":new ri(se.paint_symbol["icon-translate"]),"icon-translate-anchor":new ri(se.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kn(se.paint_symbol["text-opacity"]),"text-color":new Kn(se.paint_symbol["text-color"],{runtimeType:an,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Kn(se.paint_symbol["text-halo-color"]),"text-halo-width":new Kn(se.paint_symbol["text-halo-width"]),"text-halo-blur":new Kn(se.paint_symbol["text-halo-blur"]),"text-translate":new ri(se.paint_symbol["text-translate"]),"text-translate-anchor":new ri(se.paint_symbol["text-translate-anchor"])}),layout:Oe},Fe=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ln,this.defaultValue=e};Fe.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Fe.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Fe.prototype.outputDefined=function(){return!1},Fe.prototype.serialize=function(){return null},Bn("FormatSectionOverride",Fe,{omit:["defaultValue"]});var kt=function(e){function t(r){e.call(this,r,Qe)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var g=[],x=0,M=v;x<M.length;x+=1){var B=M[x];g.indexOf(B)<0&&g.push(B)}this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,g){var x=this.layout.get(r).evaluate(f,{},v,g),M=this._unevaluatedLayout._values[r];return M.isDataDriven()||Sl(M.value)||!x?x:function(B,G){return G.replace(/{([^{}]+)}/g,function($,ne){return ne in B?String(B[ne]):""})}(f.properties,x)},t.prototype.createBucket=function(r){return new nt(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=Qe.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var g,x=this.paint.get(v),M=new Fe(x),B=new bl(M,x.property.specification);g=x.value.kind==="constant"||x.value.kind==="source"?new El("source",B):new Uu("composite",B,x.value.zoomStops,x.value._interpolationType),this.paint._values[v]=new Co(x.property,g,x.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),g=Qe.paint.properties[f],x=!1,M=function($){for(var ne=0,fe=$;ne<fe.length;ne+=1)if(g.overrides&&g.overrides.hasOverride(fe[ne]))return void(x=!0)};if(v.value.kind==="constant"&&v.value.value instanceof ta)M(v.value.value.sections);else if(v.value.kind==="source"){var B=function($){x||($ instanceof Gi&&Aa($.value)===Qi?M($.value.sections):$ instanceof Lo?M($.sections):$.eachChild(B))},G=v.value;G._styleExpression&&B(G._styleExpression.expression)}return x},t}(iu),Wt={paint:new Zo({"background-color":new ri(se.paint_background["background-color"]),"background-pattern":new as(se.paint_background["background-pattern"]),"background-opacity":new ri(se.paint_background["background-opacity"])})},Br=function(e){function t(r){e.call(this,r,Wt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(iu),un={paint:new Zo({"raster-opacity":new ri(se.paint_raster["raster-opacity"]),"raster-hue-rotate":new ri(se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ri(se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ri(se.paint_raster["raster-brightness-max"]),"raster-saturation":new ri(se.paint_raster["raster-saturation"]),"raster-contrast":new ri(se.paint_raster["raster-contrast"]),"raster-resampling":new ri(se.paint_raster["raster-resampling"]),"raster-fade-duration":new ri(se.paint_raster["raster-fade-duration"])})},fn=function(e){function t(r){e.call(this,r,un)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(iu),Mn=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(iu),ln={circle:$u,heatmap:of,hillshade:bf,fill:ff,"fill-extrusion":kh,line:Bh,symbol:kt,background:Br,raster:fn},Hn=N.HTMLImageElement,Rn=N.HTMLCanvasElement,Yn=N.HTMLVideoElement,Vn=N.ImageData,Un=N.ImageBitmap,di=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};di.prototype.update=function(e,t,r){var f=e.width,v=e.height,g=!(this.size&&this.size[0]===f&&this.size[1]===v||r),x=this.context,M=x.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!t||t.premultiply!==!1)),g)this.size=[f,v],e instanceof Hn||e instanceof Rn||e instanceof Yn||e instanceof Vn||Un&&e instanceof Un?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,e):M.texImage2D(M.TEXTURE_2D,0,this.format,f,v,0,this.format,M.UNSIGNED_BYTE,e.data);else{var B=r||{x:0,y:0},G=B.x,$=B.y;e instanceof Hn||e instanceof Rn||e instanceof Yn||e instanceof Vn||Un&&e instanceof Un?M.texSubImage2D(M.TEXTURE_2D,0,G,$,M.RGBA,M.UNSIGNED_BYTE,e):M.texSubImage2D(M.TEXTURE_2D,0,G,$,f,v,M.RGBA,M.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},di.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},di.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},di.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Qa=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Qa.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Qa.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ho=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},dr(["receive","process"],this),this.invoker=new Qa(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ur()?e:N};function zl(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}Ho.prototype.send=function(e,t,r,f,v){var g=this;v===void 0&&(v=!1);var x=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[x]=r);var M=Re(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:$s(t,M)},M),{cancel:function(){r&&delete g.callbacks[x],g.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:g.mapId})}}},Ho.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else ur()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},Ho.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Ho.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(ws(t.error)):f(null,ws(t.data)))}else{var v=!1,g=Re(this.globalScope)?void 0:[],x=t.hasCallback?function($,ne){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:$?$s($):null,data:$s(ne,g)},g)}:function($){v=!0},M=null,B=ws(t.data);if(this.parent[t.type])M=this.parent[t.type](t.sourceMapId,B,x);else if(this.parent.getWorkerSource){var G=t.type.split(".");M=this.parent.getWorkerSource(t.sourceMapId,G[0],B.source)[G[1]](B,x)}else x(new Error("Could not find function "+t.type));!v&&M&&M.cancel&&(this.cancelCallbacks[e]=M.cancel)}},Ho.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var qa=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};qa.prototype.setNorthEast=function(e){return this._ne=e instanceof Ra?new Ra(e.lng,e.lat):Ra.convert(e),this},qa.prototype.setSouthWest=function(e){return this._sw=e instanceof Ra?new Ra(e.lng,e.lat):Ra.convert(e),this},qa.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof Ra)t=e,r=e;else{if(!(e instanceof qa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(qa.convert(e)):this.extend(Ra.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new Ra(t.lng,t.lat),this._ne=new Ra(r.lng,r.lat)),this},qa.prototype.getCenter=function(){return new Ra((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},qa.prototype.getSouthWest=function(){return this._sw},qa.prototype.getNorthEast=function(){return this._ne},qa.prototype.getNorthWest=function(){return new Ra(this.getWest(),this.getNorth())},qa.prototype.getSouthEast=function(){return new Ra(this.getEast(),this.getSouth())},qa.prototype.getWest=function(){return this._sw.lng},qa.prototype.getSouth=function(){return this._sw.lat},qa.prototype.getEast=function(){return this._ne.lng},qa.prototype.getNorth=function(){return this._ne.lat},qa.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},qa.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},qa.prototype.isEmpty=function(){return!(this._sw&&this._ne)},qa.prototype.contains=function(e){var t=Ra.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},qa.convert=function(e){return!e||e instanceof qa?e:new qa(e)};var Ra=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ra.prototype.wrap=function(){return new Ra(Xt(this.lng,-180,180),this.lat)},Ra.prototype.toArray=function(){return[this.lng,this.lat]},Ra.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ra.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},Ra.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new qa(new Ra(this.lng-r,this.lat-t),new Ra(this.lng+r,this.lat+t))},Ra.convert=function(e){if(e instanceof Ra)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ra(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ra(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var ks=2*Math.PI*63710088e-1;function el(e){return ks*Math.cos(e*Math.PI/180)}function Su(e){return(180+e)/360}function Yf(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Fu(e,t){return e/el(t)}function Kf(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Oc=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Oc.fromLngLat=function(e,t){t===void 0&&(t=0);var r=Ra.convert(e);return new Oc(Su(r.lng),Yf(r.lat),Fu(t,r.lat))},Oc.prototype.toLngLat=function(){return new Ra(360*this.x-180,Kf(this.y))},Oc.prototype.toAltitude=function(){return this.z*el(Kf(this.y))},Oc.prototype.meterInMercatorCoordinateUnits=function(){return 1/ks*(e=Kf(this.y),1/Math.cos(e*Math.PI/180));var e};var Xc=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=mh(0,e,e,t,r)};Xc.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Xc.prototype.url=function(e,t){var r,f,v,g,x,M=(f=this.y,v=this.z,g=zl(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),x=zl(256*(r+1),256*(f+1),v),g[0]+","+g[1]+","+x[0]+","+x[1]),B=function(G,$,ne){for(var fe,_e="",Ve=G;Ve>0;Ve--)_e+=($&(fe=1<<Ve-1)?1:0)+(ne&fe?2:0);return _e}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",B).replace("{bbox-epsg-3857}",M)},Xc.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new W(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Xc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var mp=function(e,t){this.wrap=e,this.canonical=t,this.key=mh(e,t.z,t.z,t.x,t.y)},vs=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new Xc(r,+f,+v),this.key=mh(t,e,r,f,v)};function mh(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var g=1<<r;return(g*g*e+g*v+f).toString(36)+r.toString(36)+t.toString(36)}vs.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},vs.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new vs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vs(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},vs.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?mh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):mh(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},vs.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},vs.prototype.children=function(e){if(this.overscaledZ>=e)return[new vs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new vs(t,this.wrap,t,r,f),new vs(t,this.wrap,t,r+1,f),new vs(t,this.wrap,t,r,f+1),new vs(t,this.wrap,t,r+1,f+1)]},vs.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},vs.prototype.wrapped=function(){return new vs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},vs.prototype.unwrapTo=function(e){return new vs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},vs.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},vs.prototype.toUnwrapped=function(){return new mp(this.wrap,this.canonical)},vs.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},vs.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Oc(e.x-this.wrap,e.y))},Bn("CanonicalTileID",Xc),Bn("OverscaledTileID",vs,{omit:["posMatrix"]});var Yc=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Xe('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};Yc.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},Yc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Yc.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Yc.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},Yc.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},Yc.prototype.getPixels=function(){return new Mo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Yc.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,g=r*this.dim,x=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:g=x-1;break;case 1:x=g+1}for(var M=-t*this.dim,B=-r*this.dim,G=g;G<x;G++)for(var $=f;$<v;$++)this.data[this._idx($,G)]=e.data[this._idx($+M,G+B)]},Bn("DEMData",Yc);var Vh=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};Vh.prototype.encode=function(e){return this._stringToNumber[e]},Vh.prototype.decode=function(e){return this._numberToString[e]};var Pf=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},Gh={geometry:{configurable:!0}};Gh.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Gh.geometry.set=function(e){this._geometry=e},Pf.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Pf.prototype,Gh);var Mf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Mf.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Gt(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var g in this.deletedStates[e][f]={},this.state[e][f])r[g]||(this.deletedStates[e][f][g]=null);else for(var x in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][x]===null&&delete this.deletedStates[e][f][x]},Mf.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},Mf.prototype.getState=function(e,t){var r=String(t),f=Gt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var g in v)delete f[g]}return f},Mf.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Mf.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var g in this.stateChanges[f])this.state[f][g]||(this.state[f][g]={}),Gt(this.state[f][g],this.stateChanges[f][g]),v[g]=this.state[f][g];r[f]=v}for(var x in this.deletedStates){this.state[x]=this.state[x]||{};var M={};if(this.deletedStates[x]===null)for(var B in this.state[x])M[B]={},this.state[x][B]={};else for(var G in this.deletedStates[x]){if(this.deletedStates[x][G]===null)this.state[x][G]={};else for(var $=0,ne=Object.keys(this.deletedStates[x][G]);$<ne.length;$+=1)delete this.state[x][G][ne[$]];M[G]=this.state[x][G]}r[x]=r[x]||{},Gt(r[x],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var fe in e)e[fe].setFeatureState(r,t)};var Lc=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ou(8192,16,0),this.grid3D=new Ou(8192,16,0),this.featureIndexArray=new ae,this.promoteId=t};function gp(e,t,r,f,v){return mr(e,function(g,x){var M=t instanceof Hu?t.get(x):null;return M&&M.evaluate?M.evaluate(r,f,v):M})}function yp(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,g=0,x=e;g<x.length;g+=1){var M=x[g];t=Math.min(t,M.x),r=Math.min(r,M.y),f=Math.max(f,M.x),v=Math.max(v,M.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function Ed(e,t){return t-e}Lc.prototype.insert=function(e,t,r,f,v,g){var x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var M=g?this.grid3D:this.grid,B=0;B<t.length;B++){for(var G=t[B],$=[1/0,1/0,-1/0,-1/0],ne=0;ne<G.length;ne++){var fe=G[ne];$[0]=Math.min($[0],fe.x),$[1]=Math.min($[1],fe.y),$[2]=Math.max($[2],fe.x),$[3]=Math.max($[3],fe.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&M.insert(x,$[0],$[1],$[2],$[3])}},Lc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Ic.VectorTile(new Tf(this.rawTileData)).layers,this.sourceLayerCoder=new Vh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Lc.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var g=e.params||{},x=8192/e.tileSize/e.scale,M=Kl(g.filter),B=e.queryGeometry,G=e.queryPadding*x,$=yp(B),ne=this.grid.query($.minX-G,$.minY-G,$.maxX+G,$.maxY+G),fe=yp(e.cameraQueryGeometry),_e=this.grid3D.query(fe.minX-G,fe.minY-G,fe.maxX+G,fe.maxY+G,function(cr,fr,Or,nn){return function(_n,hi,Dn,ai,Zn){for(var ea=0,Ci=_n;ea<Ci.length;ea+=1){var $n=Ci[ea];if(hi<=$n.x&&Dn<=$n.y&&ai>=$n.x&&Zn>=$n.y)return!0}var ca=[new W(hi,Dn),new W(hi,Zn),new W(ai,Zn),new W(ai,Dn)];if(_n.length>2){for(var ji=0,Ea=ca;ji<Ea.length;ji+=1)if(La(_n,Ea[ji]))return!0}for(var vi=0;vi<_n.length-1;vi++)if(Sa(_n[vi],_n[vi+1],ca))return!0;return!1}(e.cameraQueryGeometry,cr-G,fr-G,Or+G,nn+G)}),Ve=0,We=_e;Ve<We.length;Ve+=1)ne.push(We[Ve]);ne.sort(Ed);for(var ht,et={},Tt=function(cr){var fr=ne[cr];if(fr!==ht){ht=fr;var Or=v.featureIndexArray.get(fr),nn=null;v.loadMatchingFeature(et,Or.bucketIndex,Or.sourceLayerIndex,Or.featureIndex,M,g.layers,g.availableImages,t,r,f,function(_n,hi,Dn){return nn||(nn=Kt(_n)),hi.queryIntersectsFeature(B,_n,Dn,nn,v.z,e.transform,x,e.pixelPosMatrix)})}},Nt=0;Nt<ne.length;Nt++)Tt(Nt);return et},Lc.prototype.loadMatchingFeature=function(e,t,r,f,v,g,x,M,B,G,$){var ne=this.bucketLayerIDs[t];if(!g||function(_n,hi){for(var Dn=0;Dn<_n.length;Dn++)if(hi.indexOf(_n[Dn])>=0)return!0;return!1}(g,ne)){var fe=this.sourceLayerCoder.decode(r),_e=this.vtLayers[fe].feature(f);if(v.needGeometry){var Ve=Ir(_e,!0);if(!v.filter(new na(this.tileID.overscaledZ),Ve,this.tileID.canonical))return}else if(!v.filter(new na(this.tileID.overscaledZ),_e))return;for(var We=this.getId(_e,fe),ht=0;ht<ne.length;ht++){var et=ne[ht];if(!(g&&g.indexOf(et)<0)){var Tt=M[et];if(Tt){var Nt={};We!==void 0&&G&&(Nt=G.getState(Tt.sourceLayer||"_geojsonTileLayer",We));var cr=Gt({},B[et]);cr.paint=gp(cr.paint,Tt.paint,_e,Nt,x),cr.layout=gp(cr.layout,Tt.layout,_e,Nt,x);var fr=!$||$(_e,Tt,Nt);if(fr){var Or=new Pf(_e,this.z,this.x,this.y,We);Or.layer=cr;var nn=e[et];nn===void 0&&(nn=e[et]=[]),nn.push({featureIndex:f,feature:Or,intersectionZ:fr})}}}}}},Lc.prototype.lookupSymbolFeatures=function(e,t,r,f,v,g,x,M){var B={};this.loadVTLayers();for(var G=Kl(v),$=0,ne=e;$<ne.length;$+=1)this.loadMatchingFeature(B,r,f,ne[$],G,g,x,M,t);return B},Lc.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},Lc.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Bn("FeatureIndex",Lc,{omit:["rawTileData","sourceLayerCoder"]});var Is=function(e,t){this.tileID=e,this.uid=Ut(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Is.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<Xi.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Is.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Is.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(G,$){var ne={};if(!$)return ne;for(var fe=function(){var We=Ve[_e],ht=We.layerIds.map(function(Nt){return $.getLayer(Nt)}).filter(Boolean);if(ht.length!==0){We.layers=ht,We.stateDependentLayerIds&&(We.stateDependentLayers=We.stateDependentLayerIds.map(function(Nt){return ht.filter(function(cr){return cr.id===Nt})[0]}));for(var et=0,Tt=ht;et<Tt.length;et+=1)ne[Tt[et].id]=We}},_e=0,Ve=G;_e<Ve.length;_e+=1)fe();return ne}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof nt){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var g in this.buckets){var x=this.buckets[g];if(x instanceof nt&&x.hasRTLText){this.hasRTLText=!0,Ps.isLoading()||Ps.isLoaded()||Cc()!=="deferred"||Js();break}}for(var M in this.queryPadding=0,this.buckets){var B=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(M).queryRadius(B))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},Is.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Is.prototype.getBucket=function(e){return this.buckets[e.id]},Is.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new di(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new di(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},Is.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},Is.prototype.queryRenderedFeatures=function(e,t,r,f,v,g,x,M,B,G){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:g,tileSize:this.tileSize,pixelPosMatrix:G,transform:M,params:x,queryPadding:this.queryPadding*B},e,t,r):{}},Is.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",g=f._geojsonTileLayer||f[v];if(g)for(var x=Kl(t&&t.filter),M=this.tileID.canonical,B=M.z,G=M.x,$=M.y,ne={z:B,x:G,y:$},fe=0;fe<g.length;fe++){var _e=g.feature(fe);if(x.needGeometry){var Ve=Ir(_e,!0);if(!x.filter(new na(this.tileID.overscaledZ),Ve,this.tileID.canonical))continue}else if(!x.filter(new na(this.tileID.overscaledZ),_e))continue;var We=r.getId(_e,v),ht=new Pf(_e,B,G,$,We);ht.tile=ne,e.push(ht)}}},Is.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Is.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Is.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=Ur(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var g=this.expirationTime-t;g?this.expirationTime=f+Math.max(g,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Is.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Is.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],g=v.layers[0].sourceLayer||"_geojsonTileLayer",x=r[g],M=e[g];if(x&&M&&Object.keys(M).length!==0){v.update(M,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});var B=t&&t.style&&t.style.getLayer(f);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(v)))}}}},Is.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Is.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Xi.now()},Is.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Is.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=Xi.now()+e},Is.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},Is.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var g=0,x=t;g<x.length;g+=1)if(v[x[g]])return!0}}return!1};var df=N.performance,Vp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},df.mark(this._marks.start)};Vp.prototype.finish=function(){df.mark(this._marks.end);var e=df.getEntriesByName(this._marks.measure);return e.length===0&&(df.measure(this._marks.measure,this._marks.start,this._marks.end),e=df.getEntriesByName(this._marks.measure),df.clearMarks(this._marks.start),df.clearMarks(this._marks.end),df.clearMeasures(this._marks.measure)),e},p.Actor=Ho,p.AlphaImage=xu,p.CanonicalTileID=Xc,p.CollisionBoxArray=u,p.Color=Ei,p.DEMData=Yc,p.DataConstantProperty=ri,p.DictionaryCoder=Vh,p.EXTENT=8192,p.ErrorEvent=de,p.EvaluationParameters=na,p.Event=oe,p.Evented=Ae,p.FeatureIndex=Lc,p.FillBucket=ou,p.FillExtrusionBucket=qu,p.ImageAtlas=On,p.ImagePosition=vr,p.LineBucket=Vo,p.LngLat=Ra,p.LngLatBounds=qa,p.MercatorCoordinate=Oc,p.ONE_EM=24,p.OverscaledTileID=vs,p.Point=W,p.Point$1=W,p.Properties=Zo,p.Protobuf=Tf,p.RGBAImage=Mo,p.RequestManager=tr,p.RequestPerformance=Vp,p.ResourceType=Er,p.SegmentVector=we,p.SourceFeatureState=Mf,p.StructArrayLayout1ui2=uc,p.StructArrayLayout2f1f2i16=pl,p.StructArrayLayout2i4=gs,p.StructArrayLayout3ui6=Yu,p.StructArrayLayout4i8=Il,p.SymbolBucket=nt,p.Texture=di,p.Tile=Is,p.Transitionable=Uo,p.Uniform1f=on,p.Uniform1i=zr,p.Uniform2f=Qr,p.Uniform3f=Pn,p.Uniform4f=ei,p.UniformColor=ci,p.UniformMatrix4f=aa,p.UnwrappedTileID=mp,p.ValidationError=Ee,p.WritingMode=wr,p.ZoomHistory=Sc,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=Rt,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),g=null;e.forEach(function(x,M){t(x,function(B,G){B&&(g=B),v[M]=G,--f==0&&r(g,v)})})},p.bezier=Ye,p.bindAll=dr,p.browser=Xi,p.cacheEntryPossiblyAdded=function(e){++Jr>yt&&(e.getActor().send("enforceCacheSizeLimit",mt),Jr=0)},p.clamp=rt,p.clearTileCache=function(e){var t=N.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=cs,p.clone=function(e){var t=new Ui(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=Ke,p.clone$2=function(e){var t=new Ui(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=Zh,p.config=ir,p.create=function(){var e=new Ui(16);return Ui!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new Ui(9);return Ui!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new Ui(4);return Ui!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=w,p.createExpression=sl,p.createLayout=Do,p.createStyleLayer=function(e){return e.type==="custom"?new Mn(e):new ln[e.type](e)},p.cross=function(e,t,r){var f=t[0],v=t[1],g=t[2],x=r[0],M=r[1],B=r[2];return e[0]=v*B-g*M,e[1]=g*x-f*B,e[2]=f*M-v*x,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=Je,p.emitValidationErrors=Al,p.endsWith=re,p.enforceCacheSizeLimit=function(e){hr(),Vt&&Vt.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},p.evaluateSizeForFeature=Li,p.evaluateSizeForZoom=qi,p.evaluateVariableOffset=Ue,p.evented=Ec,p.extend=Gt,p.featureFilter=Kl,p.filterObject=wt,p.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Zi,p.getAnchorJustification=er,p.getArrayBuffer=Pi,p.getImage=ce,p.getJSON=function(e,t){return Ji(Gt(e,{type:"json"}),t)},p.getRTLTextPluginStatus=Cc,p.getReferrer=Wn,p.getVideo=function(e,t){var r,f,v=N.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var g=0;g<e.length;g++){var x=N.document.createElement("source");r=e[g],f=void 0,(f=N.document.createElement("a")).href=r,(f.protocol!==N.document.location.protocol||f.host!==N.document.location.host)&&(v.crossOrigin="Anonymous"),x.src=e[g],v.appendChild(x)}return{cancel:function(){}}},p.identity=$o,p.invert=function(e,t){var r=t[0],f=t[1],v=t[2],g=t[3],x=t[4],M=t[5],B=t[6],G=t[7],$=t[8],ne=t[9],fe=t[10],_e=t[11],Ve=t[12],We=t[13],ht=t[14],et=t[15],Tt=r*M-f*x,Nt=r*B-v*x,cr=r*G-g*x,fr=f*B-v*M,Or=f*G-g*M,nn=v*G-g*B,_n=$*We-ne*Ve,hi=$*ht-fe*Ve,Dn=$*et-_e*Ve,ai=ne*ht-fe*We,Zn=ne*et-_e*We,ea=fe*et-_e*ht,Ci=Tt*ea-Nt*Zn+cr*ai+fr*Dn-Or*hi+nn*_n;return Ci?(e[0]=(M*ea-B*Zn+G*ai)*(Ci=1/Ci),e[1]=(v*Zn-f*ea-g*ai)*Ci,e[2]=(We*nn-ht*Or+et*fr)*Ci,e[3]=(fe*Or-ne*nn-_e*fr)*Ci,e[4]=(B*Dn-x*ea-G*hi)*Ci,e[5]=(r*ea-v*Dn+g*hi)*Ci,e[6]=(ht*cr-Ve*nn-et*Nt)*Ci,e[7]=($*nn-fe*cr+_e*Nt)*Ci,e[8]=(x*Zn-M*Dn+G*_n)*Ci,e[9]=(f*Dn-r*Zn-g*_n)*Ci,e[10]=(Ve*Or-We*cr+et*Tt)*Ci,e[11]=(ne*cr-$*Or-_e*Tt)*Ci,e[12]=(M*hi-x*ai-B*_n)*Ci,e[13]=(r*ai-f*hi+v*_n)*Ci,e[14]=(We*Nt-Ve*fr-ht*Tt)*Ci,e[15]=($*fr-ne*Nt+fe*Tt)*Ci,e):null},p.isChar=gn,p.isMapboxURL=E,p.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},p.makeRequest=Ji,p.mapObject=mr,p.mercatorXfromLng=Su,p.mercatorYfromLat=Yf,p.mercatorZfromAltitude=Fu,p.mul=Tc,p.multiply=Po,p.mvt=Ic,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],g=r*r+f*f+v*v;return g>0&&(g=1/Math.sqrt(g)),e[0]=t[0]*g,e[1]=t[1]*g,e[2]=t[2]*g,e},p.number=Ta,p.offscreenCanvasSupported=qr,p.ortho=function(e,t,r,f,v,g,x){var M=1/(t-r),B=1/(f-v),G=1/(g-x);return e[0]=-2*M,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*B,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*G,e[11]=0,e[12]=(t+r)*M,e[13]=(v+f)*B,e[14]=(x+g)*G,e[15]=1,e},p.parseGlyphPBF=function(e){return new Tf(e).readFields(dn,[])},p.pbf=Tf,p.performSymbolLayout=function(e,t,r,f,v,g,x){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var M=e.layers[0].layout,B=e.layers[0]._unevaluatedLayout._values,G={};if(e.textSizeData.kind==="composite"){var $=e.textSizeData,ne=$.maxZoom;G.compositeTextSizes=[B["text-size"].possiblyEvaluate(new na($.minZoom),x),B["text-size"].possiblyEvaluate(new na(ne),x)]}if(e.iconSizeData.kind==="composite"){var fe=e.iconSizeData,_e=fe.maxZoom;G.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new na(fe.minZoom),x),B["icon-size"].possiblyEvaluate(new na(_e),x)]}G.layoutTextSize=B["text-size"].possiblyEvaluate(new na(e.zoom+1),x),G.layoutIconSize=B["icon-size"].possiblyEvaluate(new na(e.zoom+1),x),G.textMaxSize=B["text-size"].possiblyEvaluate(new na(18));for(var Ve=24*M.get("text-line-height"),We=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",ht=M.get("text-keep-upright"),et=M.get("text-size"),Tt=function(){var fr=cr[Nt],Or=M.get("text-font").evaluate(fr,{},x).join(","),nn=et.evaluate(fr,{},x),_n=G.layoutTextSize.evaluate(fr,{},x),hi=G.layoutIconSize.evaluate(fr,{},x),Dn={horizontal:{},vertical:void 0},ai=fr.text,Zn=[0,0];if(ai){var ea=ai.toString(),Ci=24*M.get("text-letter-spacing").evaluate(fr,{},x),$n=function(da){for(var ao=0,eo=da;ao<eo.length;ao+=1)if(Ca=eo[ao].charCodeAt(0),gn.Arabic(Ca)||gn["Arabic Supplement"](Ca)||gn["Arabic Extended-A"](Ca)||gn["Arabic Presentation Forms-A"](Ca)||gn["Arabic Presentation Forms-B"](Ca))return!1;var Ca;return!0}(ea)?Ci:0,ca=M.get("text-anchor").evaluate(fr,{},x),ji=M.get("text-variable-anchor");if(!ji){var Ea=M.get("text-radial-offset").evaluate(fr,{},x);Zn=Ea?Ue(ca,[24*Ea,bu]):M.get("text-offset").evaluate(fr,{},x).map(function(da){return 24*da})}var vi=We?"center":M.get("text-justify").evaluate(fr,{},x),xa=M.get("symbol-placement"),To=xa==="point"?24*M.get("text-max-width").evaluate(fr,{},x):0,Wo=function(){e.allowVerticalPlacement&&tc(ea)&&(Dn.vertical=ui(ai,t,r,v,Or,To,Ve,ca,"left",$n,Zn,wr.vertical,!0,xa,_n,nn))};if(!We&&ji){for(var Xo=vi==="auto"?ji.map(function(da){return er(da)}):[vi],Oo=!1,Qo=0;Qo<Xo.length;Qo++){var Os=Xo[Qo];if(!Dn.horizontal[Os])if(Oo)Dn.horizontal[Os]=Dn.horizontal[0];else{var Ls=ui(ai,t,r,v,Or,To,Ve,"center",Os,$n,Zn,wr.horizontal,!1,xa,_n,nn);Ls&&(Dn.horizontal[Os]=Ls,Oo=Ls.positionedLines.length===1)}}Wo()}else{vi==="auto"&&(vi=er(ca));var uu=ui(ai,t,r,v,Or,To,Ve,ca,vi,$n,Zn,wr.horizontal,!1,xa,_n,nn);uu&&(Dn.horizontal[vi]=uu),Wo(),tc(ea)&&We&&ht&&(Dn.vertical=ui(ai,t,r,v,Or,To,Ve,ca,vi,$n,Zn,wr.vertical,!1,xa,_n,nn))}}var Fs=void 0,Gs=!1;if(fr.icon&&fr.icon.name){var Bo=f[fr.icon.name];Bo&&(Fs=function(da,ao,eo){var Ca=Zi(eo),lu=ao[0]-da.displaySize[0]*Ca.horizontalAlign,qs=ao[1]-da.displaySize[1]*Ca.verticalAlign;return{image:da,top:qs,bottom:qs+da.displaySize[1],left:lu,right:lu+da.displaySize[0]}}(v[fr.icon.name],M.get("icon-offset").evaluate(fr,{},x),M.get("icon-anchor").evaluate(fr,{},x)),Gs=Bo.sdf,e.sdfIcons===void 0?e.sdfIcons=Bo.sdf:e.sdfIcons!==Bo.sdf&&Xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Bo.pixelRatio!==e.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Bs=zn(Dn.horizontal)||Dn.vertical;e.iconsInText=!!Bs&&Bs.iconsInText,(Bs||Fs)&&function(da,ao,eo,Ca,lu,qs,go,hs,eu,wa,Rc){var gl=qs.textMaxSize.evaluate(ao,{});gl===void 0&&(gl=go);var Eu,Yo=da.layers[0].layout,yl=Yo.get("icon-offset").evaluate(ao,{},Rc),Ul=zn(eo.horizontal),$f=go/24,Zl=da.tilePixelRatio*$f,Jf=da.tilePixelRatio*gl/24,Kc=da.tilePixelRatio*hs,gh=da.tilePixelRatio*Yo.get("symbol-spacing"),_p=Yo.get("text-padding")*da.tilePixelRatio,yh=Yo.get("icon-padding")*da.tilePixelRatio,Hh=Yo.get("text-max-angle")/180*Math.PI,xp=Yo.get("text-rotation-alignment")==="map"&&Yo.get("symbol-placement")!=="point",bp=Yo.get("icon-rotation-alignment")==="map"&&Yo.get("symbol-placement")!=="point",vf=Yo.get("symbol-placement"),Qf=gh/2,If=Yo.get("icon-text-fit");Ca&&If!=="none"&&(da.allowVerticalPlacement&&eo.vertical&&(Eu=Tn(Ca,eo.vertical,If,Yo.get("icon-text-fit-padding"),yl,$f)),Ul&&(Ca=Tn(Ca,Ul,If,Yo.get("icon-text-fit-padding"),yl,$f)));var Of=function(Cd,bh){bh.x<0||bh.x>=8192||bh.y<0||bh.y>=8192||function(qo,jl,wd,Jc,Ap,Hp,Yh,Dc,Kh,Sh,$h,Eh,Tp,Wp,Ch,Pp,Xp,Yp,Kp,$p,tl,Jh,Mp,kc,Ad){var Jp,Df,nh,ih,ah,oh=qo.addToLineVertexArray(jl,wd),Ip=0,Qp=0,qp=0,ed=0,Qh=-1,Op=-1,Qc={},td=ze(""),Lp=0,Rp=0;if(Dc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Lp=(Jp=Dc.layout.get("text-offset").evaluate(tl,{},kc).map(function(qc){return 24*qc}))[0],Rp=Jp[1]):(Lp=24*Dc.layout.get("text-radial-offset").evaluate(tl,{},kc),Rp=bu),qo.allowVerticalPlacement&&Jc.vertical){var rd=Dc.layout.get("text-rotate").evaluate(tl,{},kc)+90;ih=new Pa(Kh,jl,Sh,$h,Eh,Jc.vertical,Tp,Wp,Ch,rd),Yh&&(ah=new Pa(Kh,jl,Sh,$h,Eh,Yh,Xp,Yp,Ch,rd))}if(Ap){var qh=Dc.layout.get("icon-rotate").evaluate(tl,{}),nd=Dc.layout.get("icon-text-fit")!=="none",id=fs(Ap,qh,Mp,nd),Dp=Yh?fs(Yh,qh,Mp,nd):void 0;nh=new Pa(Kh,jl,Sh,$h,Eh,Ap,Xp,Yp,!1,qh),Ip=4*id.length;var ad=qo.iconSizeData,wh=null;ad.kind==="source"?(wh=[128*Dc.layout.get("icon-size").evaluate(tl,{})])[0]>32640&&Xe(qo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):ad.kind==="composite"&&((wh=[128*Jh.compositeIconSizes[0].evaluate(tl,{},kc),128*Jh.compositeIconSizes[1].evaluate(tl,{},kc)])[0]>32640||wh[1]>32640)&&Xe(qo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),qo.addSymbols(qo.icon,id,wh,$p,Kp,tl,!1,jl,oh.lineStartIndex,oh.lineLength,-1,kc),Qh=qo.icon.placedSymbolArray.length-1,Dp&&(Qp=4*Dp.length,qo.addSymbols(qo.icon,Dp,wh,$p,Kp,tl,wr.vertical,jl,oh.lineStartIndex,oh.lineLength,-1,kc),Op=qo.icon.placedSymbolArray.length-1)}for(var od in Jc.horizontal){var ep=Jc.horizontal[od];if(!Df){td=ze(ep.text);var Td=Dc.layout.get("text-rotate").evaluate(tl,{},kc);Df=new Pa(Kh,jl,Sh,$h,Eh,ep,Tp,Wp,Ch,Td)}var kp=ep.positionedLines.length===1;if(qp+=Jt(qo,jl,ep,Hp,Dc,Ch,tl,Pp,oh,Jc.vertical?wr.horizontal:wr.horizontalOnly,kp?Object.keys(Jc.horizontal):[od],Qc,Qh,Jh,kc),kp)break}Jc.vertical&&(ed+=Jt(qo,jl,Jc.vertical,Hp,Dc,Ch,tl,Pp,oh,wr.vertical,["vertical"],Qc,Op,Jh,kc));var sd=Df?Df.boxStartIndex:qo.collisionBoxArray.length,ud=Df?Df.boxEndIndex:qo.collisionBoxArray.length,sh=ih?ih.boxStartIndex:qo.collisionBoxArray.length,ld=ih?ih.boxEndIndex:qo.collisionBoxArray.length,Pd=nh?nh.boxStartIndex:qo.collisionBoxArray.length,Md=nh?nh.boxEndIndex:qo.collisionBoxArray.length,Id=ah?ah.boxStartIndex:qo.collisionBoxArray.length,Od=ah?ah.boxEndIndex:qo.collisionBoxArray.length,rl=-1,_f=function(qc,cd){return qc&&qc.circleDiameter?Math.max(qc.circleDiameter,cd):cd};rl=_f(Df,rl),rl=_f(ih,rl),rl=_f(nh,rl);var uh=(rl=_f(ah,rl))>-1?1:0;uh&&(rl*=Ad/24),qo.glyphOffsetArray.length>=nt.MAX_GLYPHS&&Xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tl.sortKey!==void 0&&qo.addToSortKeyRanges(qo.symbolInstances.length,tl.sortKey),qo.symbolInstances.emplaceBack(jl.x,jl.y,Qc.right>=0?Qc.right:-1,Qc.center>=0?Qc.center:-1,Qc.left>=0?Qc.left:-1,Qc.vertical||-1,Qh,Op,td,sd,ud,sh,ld,Pd,Md,Id,Od,Sh,qp,ed,Ip,Qp,uh,0,Tp,Lp,Rp,rl)}(da,bh,Cd,eo,Ca,lu,Eu,da.layers[0],da.collisionBoxArray,ao.index,ao.sourceLayerIndex,da.index,Zl,_p,xp,eu,Kc,yh,bp,yl,ao,qs,wa,Rc,go)};if(vf==="line")for(var mf=0,gf=cs(ao.geometry,0,0,8192,8192);mf<gf.length;mf+=1)for(var Sp=gf[mf],Lf=0,Rf=Io(Sp,gh,Hh,eo.vertical||Ul,Ca,24,Jf,da.overscaling,8192);Lf<Rf.length;Lf+=1){var yf=Rf[Lf];Ul&&oa(da,Ul.text,Qf,yf)||Of(Sp,yf)}else if(vf==="line-center")for(var _h=0,qf=ao.geometry;_h<qf.length;_h+=1){var xs=qf[_h];if(xs.length>1){var Wh=Ja(xs,Hh,eo.vertical||Ul,Ca,24,Jf);Wh&&Of(xs,Wh)}}else if(ao.type==="Polygon")for(var eh=0,Ha=cc(ao.geometry,0);eh<Ha.length;eh+=1){var th=Ha[eh],$c=ha(th,16);Of(th[0],new En($c.x,$c.y,0))}else if(ao.type==="LineString")for(var pc=0,xh=ao.geometry;pc<xh.length;pc+=1){var rh=xh[pc];Of(rh,new En(rh[0].x,rh[0].y,0))}else if(ao.type==="Point")for(var Ep=0,Gp=ao.geometry;Ep<Gp.length;Ep+=1)for(var Cp=0,wp=Gp[Ep];Cp<wp.length;Cp+=1){var Xh=wp[Cp];Of([Xh],new En(Xh.x,Xh.y,0))}}(e,fr,Dn,Fs,f,G,_n,hi,Zn,Gs,x)},Nt=0,cr=e.features;Nt<cr.length;Nt+=1)Tt();g&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,f,v){var g,x=1/Math.tan(t/2);return e[0]=x/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(g=1/(f-v)),e[14]=2*v*f*g):(e[10]=-1,e[14]=-2*f),e},p.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},p.plugin=Ps,p.polygonIntersectsPolygon=fi,p.postMapLoadEvent=tt,p.postTurnstileEvent=Mr,p.potpack=Lt,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=Bn,p.registerForPluginStateChange=function(e){return e({pluginStatus:Ts,pluginURL:yu}),Ec.on("pluginStateChange",e),e},p.renderColorRamp=Dl,p.rotate=function(e,t,r){var f=t[0],v=t[1],g=t[2],x=t[3],M=Math.sin(r),B=Math.cos(r);return e[0]=f*B+g*M,e[1]=v*B+x*M,e[2]=f*-M+g*B,e[3]=v*-M+x*B,e},p.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),g=t[4],x=t[5],M=t[6],B=t[7],G=t[8],$=t[9],ne=t[10],fe=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=g*v+G*f,e[5]=x*v+$*f,e[6]=M*v+ne*f,e[7]=B*v+fe*f,e[8]=G*v-g*f,e[9]=$*v-x*f,e[10]=ne*v-M*f,e[11]=fe*v-B*f,e},p.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),g=t[0],x=t[1],M=t[2],B=t[3],G=t[4],$=t[5],ne=t[6],fe=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=g*v+G*f,e[1]=x*v+$*f,e[2]=M*v+ne*f,e[3]=B*v+fe*f,e[4]=G*v-g*f,e[5]=$*v-x*f,e[6]=ne*v-M*f,e[7]=fe*v-B*f,e},p.scale=function(e,t,r){var f=r[0],v=r[1],g=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*g,e[9]=t[9]*g,e[10]=t[10]*g,e[11]=t[11]*g,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){mt=e,yt=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Ts==="deferred"||Ts==="loading"||Ts==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");yu=Xi.resolveURL(e),Ts="deferred",gu=t,Pl(),r||Js()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=se,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=yo,p.transformMat3=function(e,t,r){var f=t[0],v=t[1],g=t[2];return e[0]=f*r[0]+v*r[3]+g*r[6],e[1]=f*r[1]+v*r[4]+g*r[7],e[2]=f*r[2]+v*r[5]+g*r[8],e},p.transformMat4=ku,p.translate=function(e,t,r){var f,v,g,x,M,B,G,$,ne,fe,_e,Ve,We=r[0],ht=r[1],et=r[2];return t===e?(e[12]=t[0]*We+t[4]*ht+t[8]*et+t[12],e[13]=t[1]*We+t[5]*ht+t[9]*et+t[13],e[14]=t[2]*We+t[6]*ht+t[10]*et+t[14],e[15]=t[3]*We+t[7]*ht+t[11]*et+t[15]):(v=t[1],g=t[2],x=t[3],M=t[4],B=t[5],G=t[6],$=t[7],ne=t[8],fe=t[9],_e=t[10],Ve=t[11],e[0]=f=t[0],e[1]=v,e[2]=g,e[3]=x,e[4]=M,e[5]=B,e[6]=G,e[7]=$,e[8]=ne,e[9]=fe,e[10]=_e,e[11]=Ve,e[12]=f*We+M*ht+ne*et+t[12],e[13]=v*We+B*ht+fe*et+t[13],e[14]=g*We+G*ht+_e*et+t[14],e[15]=x*We+$*ht+Ve*et+t[15]),e},p.triggerPluginCompletionEvent=zc,p.uniqueId=Ut,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=nf,p.validateStyle=ec,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=Ic,p.version="1.13.1",p.warnOnce=Xe,p.webpSupported=pe,p.window=N,p.wrap=Xt}),C(["./shared"],function(p){"use strict";function w(Y){var ce=typeof Y;if(ce==="number"||ce==="boolean"||ce==="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){for(var me="[",z=0,oe=Y;z<oe.length;z+=1)me+=w(oe[z])+",";return me+"]"}for(var de=Object.keys(Y).sort(),Ae="{",se=0;se<de.length;se++)Ae+=JSON.stringify(de[se])+":"+w(Y[de[se]])+",";return Ae+"}"}function q(Y){for(var ce="",me=0,z=p.refProperties;me<z.length;me+=1)ce+="/"+w(Y[z[me]]);return ce}var K=function(Y){this.keyCache={},Y&&this.replace(Y)};K.prototype.replace=function(Y){this._layerConfigs={},this._layers={},this.update(Y,[])},K.prototype.update=function(Y,ce){for(var me=this,z=0,oe=Y;z<oe.length;z+=1){var de=oe[z];this._layerConfigs[de.id]=de;var Ae=this._layers[de.id]=p.createStyleLayer(de);Ae._featureFilter=p.featureFilter(Ae.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(var se=0,Ee=ce;se<Ee.length;se+=1){var dt=Ee[se];delete this.keyCache[dt],delete this._layerConfigs[dt],delete this._layers[dt]}this.familiesBySource={};for(var br=0,Ht=function(sn,an){for(var Ii={},xn=0;xn<sn.length;xn++){var Ai=an&&an[sn[xn].id]||q(sn[xn]);an&&(an[sn[xn].id]=Ai);var Qi=Ii[Ai];Qi||(Qi=Ii[Ai]=[]),Qi.push(sn[xn])}var li=[];for(var Yi in Ii)li.push(Ii[Yi]);return li}(p.values(this._layerConfigs),this.keyCache);br<Ht.length;br+=1){var Qt=Ht[br].map(function(sn){return me._layers[sn.id]}),Rr=Qt[0];if(Rr.visibility!=="none"){var kn=Rr.source||"",Ln=this.familiesBySource[kn];Ln||(Ln=this.familiesBySource[kn]={});var $t=Rr.sourceLayer||"_geojsonTileLayer",Cn=Ln[$t];Cn||(Cn=Ln[$t]=[]),Cn.push(Qt)}}};var W=function(Y){var ce={},me=[];for(var z in Y){var oe=Y[z],de=ce[z]={};for(var Ae in oe){var se=oe[+Ae];if(se&&se.bitmap.width!==0&&se.bitmap.height!==0){var Ee={x:0,y:0,w:se.bitmap.width+2,h:se.bitmap.height+2};me.push(Ee),de[Ae]={rect:Ee,metrics:se.metrics}}}}var dt=p.potpack(me),br=new p.AlphaImage({width:dt.w||1,height:dt.h||1});for(var Ht in Y){var Qt=Y[Ht];for(var Rr in Qt){var kn=Qt[+Rr];if(kn&&kn.bitmap.width!==0&&kn.bitmap.height!==0){var Ln=ce[Ht][Rr].rect;p.AlphaImage.copy(kn.bitmap,br,{x:0,y:0},{x:Ln.x+1,y:Ln.y+1},kn.bitmap)}}}this.image=br,this.positions=ce};p.register("GlyphAtlas",W);var L=function(Y){this.tileID=new p.OverscaledTileID(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId};function N(Y,ce,me){for(var z=new p.EvaluationParameters(ce),oe=0,de=Y;oe<de.length;oe+=1)de[oe].recalculate(z,me)}function Ne(Y,ce){var me=p.getArrayBuffer(Y.request,function(z,oe,de,Ae){z?ce(z):oe&&ce(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(oe)),rawData:oe,cacheControl:de,expires:Ae})});return function(){me.cancel(),ce()}}L.prototype.parse=function(Y,ce,me,z,oe){var de=this;this.status="parsing",this.data=Y,this.collisionBoxArray=new p.CollisionBoxArray;var Ae=new p.DictionaryCoder(Object.keys(Y.layers).sort()),se=new p.FeatureIndex(this.tileID,this.promoteId);se.bucketLayerIDs=[];var Ee,dt,br,Ht,Qt={},Rr={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},kn=ce.familiesBySource[this.source];for(var Ln in kn){var $t=Y.layers[Ln];if($t){$t.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+Ln+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Cn=Ae.encode(Ln),sn=[],an=0;an<$t.length;an++){var Ii=$t.feature(an),xn=se.getId(Ii,Ln);sn.push({feature:Ii,id:xn,index:an,sourceLayerIndex:Cn})}for(var Ai=0,Qi=kn[Ln];Ai<Qi.length;Ai+=1){var li=Qi[Ai],Yi=li[0];Yi.minzoom&&this.zoom<Math.floor(Yi.minzoom)||Yi.maxzoom&&this.zoom>=Yi.maxzoom||Yi.visibility!=="none"&&(N(li,this.zoom,me),(Qt[Yi.id]=Yi.createBucket({index:se.bucketLayerIDs.length,layers:li,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Cn,sourceID:this.source})).populate(sn,Rr,this.tileID.canonical),se.bucketLayerIDs.push(li.map(function(ni){return ni.id})))}}}var Bi=p.mapObject(Rr.glyphDependencies,function(ni){return Object.keys(ni).map(Number)});Object.keys(Bi).length?z.send("getGlyphs",{uid:this.uid,stacks:Bi},function(ni,Di){Ee||(Ee=ni,dt=Di,Fi.call(de))}):dt={};var wi=Object.keys(Rr.iconDependencies);wi.length?z.send("getImages",{icons:wi,source:this.source,tileID:this.tileID,type:"icons"},function(ni,Di){Ee||(Ee=ni,br=Di,Fi.call(de))}):br={};var sa=Object.keys(Rr.patternDependencies);function Fi(){if(Ee)return oe(Ee);if(dt&&br&&Ht){var ni=new W(dt),Di=new p.ImageAtlas(br,Ht);for(var Ei in Qt){var no=Qt[Ei];no instanceof p.SymbolBucket?(N(no.layers,this.zoom,me),p.performSymbolLayout(no,dt,ni.positions,br,Di.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):no.hasPattern&&(no instanceof p.LineBucket||no instanceof p.FillBucket||no instanceof p.FillExtrusionBucket)&&(N(no.layers,this.zoom,me),no.addFeatures(Rr,this.tileID.canonical,Di.patternPositions))}this.status="done",oe(null,{buckets:p.values(Qt).filter(function(ho){return!ho.isEmpty()}),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ni.image,imageAtlas:Di,glyphMap:this.returnDependencies?dt:null,iconMap:this.returnDependencies?br:null,glyphPositions:this.returnDependencies?ni.positions:null})}}sa.length?z.send("getImages",{icons:sa,source:this.source,tileID:this.tileID,type:"patterns"},function(ni,Di){Ee||(Ee=ni,Ht=Di,Fi.call(de))}):Ht={},Fi.call(this)};var Ye=function(Y,ce,me,z){this.actor=Y,this.layerIndex=ce,this.availableImages=me,this.loadVectorData=z||Ne,this.loading={},this.loaded={}};Ye.prototype.loadTile=function(Y,ce){var me=this,z=Y.uid;this.loading||(this.loading={});var oe=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new p.RequestPerformance(Y.request),de=this.loading[z]=new L(Y);de.abort=this.loadVectorData(Y,function(Ae,se){if(delete me.loading[z],Ae||!se)return de.status="done",me.loaded[z]=de,ce(Ae);var Ee=se.rawData,dt={};se.expires&&(dt.expires=se.expires),se.cacheControl&&(dt.cacheControl=se.cacheControl);var br={};if(oe){var Ht=oe.finish();Ht&&(br.resourceTiming=JSON.parse(JSON.stringify(Ht)))}de.vectorTile=se.vectorTile,de.parse(se.vectorTile,me.layerIndex,me.availableImages,me.actor,function(Qt,Rr){if(Qt||!Rr)return ce(Qt);ce(null,p.extend({rawTileData:Ee.slice(0)},Rr,dt,br))}),me.loaded=me.loaded||{},me.loaded[z]=de})},Ye.prototype.reloadTile=function(Y,ce){var me=this,z=this.loaded,oe=Y.uid,de=this;if(z&&z[oe]){var Ae=z[oe];Ae.showCollisionBoxes=Y.showCollisionBoxes;var se=function(Ee,dt){var br=Ae.reloadCallback;br&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,de.layerIndex,me.availableImages,de.actor,br)),ce(Ee,dt)};Ae.status==="parsing"?Ae.reloadCallback=se:Ae.status==="done"&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,se):se())}},Ye.prototype.abortTile=function(Y,ce){var me=this.loading,z=Y.uid;me&&me[z]&&me[z].abort&&(me[z].abort(),delete me[z]),ce()},Ye.prototype.removeTile=function(Y,ce){var me=this.loaded,z=Y.uid;me&&me[z]&&delete me[z],ce()};var Je=p.window.ImageBitmap,rt=function(){this.loaded={}};function Xt(Y,ce){if(Y.length!==0){Gt(Y[0],ce);for(var me=1;me<Y.length;me++)Gt(Y[me],!ce)}}function Gt(Y,ce){for(var me=0,z=0,oe=Y.length,de=oe-1;z<oe;de=z++)me+=(Y[z][0]-Y[de][0])*(Y[de][1]+Y[z][1]);me>=0!=!!ce&&Y.reverse()}rt.prototype.loadTile=function(Y,ce){var me=Y.uid,z=Y.encoding,oe=Y.rawImageData,de=Je&&oe instanceof Je?this.getImageData(oe):oe,Ae=new p.DEMData(me,de,z);this.loaded=this.loaded||{},this.loaded[me]=Ae,ce(null,Ae)},rt.prototype.getImageData=function(Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);var ce=this.offscreenCanvasContext.getImageData(-1,-1,Y.width+2,Y.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:ce.width,height:ce.height},ce.data)},rt.prototype.removeTile=function(Y){var ce=this.loaded,me=Y.uid;ce&&ce[me]&&delete ce[me]};var nr=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ut=function(Y){this._feature=Y,this.extent=p.EXTENT,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))};Ut.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Y=[],ce=0,me=this._feature.geometry;ce<me.length;ce+=1){var z=me[ce];Y.push([new p.Point$1(z[0],z[1])])}return Y}for(var oe=[],de=0,Ae=this._feature.geometry;de<Ae.length;de+=1){for(var se=[],Ee=0,dt=Ae[de];Ee<dt.length;Ee+=1){var br=dt[Ee];se.push(new p.Point$1(br[0],br[1]))}oe.push(se)}return oe},Ut.prototype.toGeoJSON=function(Y,ce,me){return nr.call(this,Y,ce,me)};var At=function(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=Y.length,this._features=Y};At.prototype.feature=function(Y){return new Ut(this._features[Y])};var Et=p.vectorTile.VectorTileFeature,dr=re;function re(Y,ce){this.options=ce||{},this.features=Y,this.length=Y.length}function mr(Y,ce){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=ce||4096}re.prototype.feature=function(Y){return new mr(this.features[Y],this.options.extent)},mr.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var ce=0;ce<Y.length;ce++){for(var me=Y[ce],z=[],oe=0;oe<me.length;oe++)z.push(new p.Point$1(me[oe][0],me[oe][1]));this.geometry.push(z)}return this.geometry},mr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,ce=1/0,me=-1/0,z=1/0,oe=-1/0,de=0;de<Y.length;de++)for(var Ae=Y[de],se=0;se<Ae.length;se++){var Ee=Ae[se];ce=Math.min(ce,Ee.x),me=Math.max(me,Ee.x),z=Math.min(z,Ee.y),oe=Math.max(oe,Ee.y)}return[ce,z,me,oe]},mr.prototype.toGeoJSON=Et.prototype.toGeoJSON;var wt=Dt,Ke=dr;function Dt(Y){var ce=new p.pbf;return function(me,z){for(var oe in me.layers)z.writeMessage(3,Xe,me.layers[oe])}(Y,ce),ce.finish()}function Xe(Y,ce){var me;ce.writeVarintField(15,Y.version||1),ce.writeStringField(1,Y.name||""),ce.writeVarintField(5,Y.extent||4096);var z={keys:[],values:[],keycache:{},valuecache:{}};for(me=0;me<Y.length;me++)z.feature=Y.feature(me),ce.writeMessage(2,Zt,z);var oe=z.keys;for(me=0;me<oe.length;me++)ce.writeStringField(3,oe[me]);var de=z.values;for(me=0;me<de.length;me++)ce.writeMessage(4,Re,de[me])}function Zt(Y,ce){var me=Y.feature;me.id!==void 0&&ce.writeVarintField(1,me.id),ce.writeMessage(2,yr,Y),ce.writeVarintField(3,me.type),ce.writeMessage(4,he,me)}function yr(Y,ce){var me=Y.feature,z=Y.keys,oe=Y.values,de=Y.keycache,Ae=Y.valuecache;for(var se in me.properties){var Ee=de[se];Ee===void 0&&(z.push(se),de[se]=Ee=z.length-1),ce.writeVarint(Ee);var dt=me.properties[se],br=typeof dt;br!=="string"&&br!=="boolean"&&br!=="number"&&(dt=JSON.stringify(dt));var Ht=br+":"+dt,Qt=Ae[Ht];Qt===void 0&&(oe.push(dt),Ae[Ht]=Qt=oe.length-1),ce.writeVarint(Qt)}}function ur(Y,ce){return(ce<<3)+(7&Y)}function Ur(Y){return Y<<1^Y>>31}function he(Y,ce){for(var me=Y.loadGeometry(),z=Y.type,oe=0,de=0,Ae=me.length,se=0;se<Ae;se++){var Ee=me[se],dt=1;z===1&&(dt=Ee.length),ce.writeVarint(ur(1,dt));for(var br=z===3?Ee.length-1:Ee.length,Ht=0;Ht<br;Ht++){Ht===1&&z!==1&&ce.writeVarint(ur(2,br-1));var Qt=Ee[Ht].x-oe,Rr=Ee[Ht].y-de;ce.writeVarint(Ur(Qt)),ce.writeVarint(Ur(Rr)),oe+=Qt,de+=Rr}z===3&&ce.writeVarint(ur(7,1))}}function Re(Y,ce){var me=typeof Y;me==="string"?ce.writeStringField(1,Y):me==="boolean"?ce.writeBooleanField(7,Y):me==="number"&&(Y%1!=0?ce.writeDoubleField(3,Y):Y<0?ce.writeSVarintField(6,Y):ce.writeVarintField(5,Y))}function ge(Y,ce,me,z){_t(Y,me,z),_t(ce,2*me,2*z),_t(ce,2*me+1,2*z+1)}function _t(Y,ce,me){var z=Y[ce];Y[ce]=Y[me],Y[me]=z}function pt(Y,ce,me,z){var oe=Y-me,de=ce-z;return oe*oe+de*de}wt.fromVectorTileJs=Dt,wt.fromGeojsonVt=function(Y,ce){ce=ce||{};var me={};for(var z in Y)me[z]=new dr(Y[z].features,ce),me[z].name=z,me[z].version=ce.version,me[z].extent=ce.extent;return Dt({layers:me})},wt.GeoJSONWrapper=Ke;var zt=function(Y){return Y[0]},Ft=function(Y){return Y[1]},Dr=function(Y,ce,me,z,oe){ce===void 0&&(ce=zt),me===void 0&&(me=Ft),z===void 0&&(z=64),oe===void 0&&(oe=Float64Array),this.nodeSize=z,this.points=Y;for(var de=Y.length<65536?Uint16Array:Uint32Array,Ae=this.ids=new de(Y.length),se=this.coords=new oe(2*Y.length),Ee=0;Ee<Y.length;Ee++)Ae[Ee]=Ee,se[2*Ee]=ce(Y[Ee]),se[2*Ee+1]=me(Y[Ee]);(function dt(br,Ht,Qt,Rr,kn,Ln){if(!(kn-Rr<=Qt)){var $t=Rr+kn>>1;(function Cn(sn,an,Ii,xn,Ai,Qi){for(;Ai>xn;){if(Ai-xn>600){var li=Ai-xn+1,Yi=Ii-xn+1,Bi=Math.log(li),wi=.5*Math.exp(2*Bi/3),sa=.5*Math.sqrt(Bi*wi*(li-wi)/li)*(Yi-li/2<0?-1:1);Cn(sn,an,Ii,Math.max(xn,Math.floor(Ii-Yi*wi/li+sa)),Math.min(Ai,Math.floor(Ii+(li-Yi)*wi/li+sa)),Qi)}var Fi=an[2*Ii+Qi],ni=xn,Di=Ai;for(ge(sn,an,xn,Ii),an[2*Ai+Qi]>Fi&&ge(sn,an,xn,Ai);ni<Di;){for(ge(sn,an,ni,Di),ni++,Di--;an[2*ni+Qi]<Fi;)ni++;for(;an[2*Di+Qi]>Fi;)Di--}an[2*xn+Qi]===Fi?ge(sn,an,xn,Di):ge(sn,an,++Di,Ai),Di<=Ii&&(xn=Di+1),Ii<=Di&&(Ai=Di-1)}})(br,Ht,$t,Rr,kn,Ln%2),dt(br,Ht,Qt,Rr,$t-1,Ln+1),dt(br,Ht,Qt,$t+1,kn,Ln+1)}})(Ae,se,z,0,Ae.length-1,0)};Dr.prototype.range=function(Y,ce,me,z){return function(oe,de,Ae,se,Ee,dt,br){for(var Ht,Qt,Rr=[0,oe.length-1,0],kn=[];Rr.length;){var Ln=Rr.pop(),$t=Rr.pop(),Cn=Rr.pop();if($t-Cn<=br)for(var sn=Cn;sn<=$t;sn++)Qt=de[2*sn+1],(Ht=de[2*sn])>=Ae&&Ht<=Ee&&Qt>=se&&Qt<=dt&&kn.push(oe[sn]);else{var an=Math.floor((Cn+$t)/2);Qt=de[2*an+1],(Ht=de[2*an])>=Ae&&Ht<=Ee&&Qt>=se&&Qt<=dt&&kn.push(oe[an]);var Ii=(Ln+1)%2;(Ln===0?Ae<=Ht:se<=Qt)&&(Rr.push(Cn),Rr.push(an-1),Rr.push(Ii)),(Ln===0?Ee>=Ht:dt>=Qt)&&(Rr.push(an+1),Rr.push($t),Rr.push(Ii))}}return kn}(this.ids,this.coords,Y,ce,me,z,this.nodeSize)},Dr.prototype.within=function(Y,ce,me){return function(z,oe,de,Ae,se,Ee){for(var dt=[0,z.length-1,0],br=[],Ht=se*se;dt.length;){var Qt=dt.pop(),Rr=dt.pop(),kn=dt.pop();if(Rr-kn<=Ee)for(var Ln=kn;Ln<=Rr;Ln++)pt(oe[2*Ln],oe[2*Ln+1],de,Ae)<=Ht&&br.push(z[Ln]);else{var $t=Math.floor((kn+Rr)/2),Cn=oe[2*$t],sn=oe[2*$t+1];pt(Cn,sn,de,Ae)<=Ht&&br.push(z[$t]);var an=(Qt+1)%2;(Qt===0?de-se<=Cn:Ae-se<=sn)&&(dt.push(kn),dt.push($t-1),dt.push(an)),(Qt===0?de+se>=Cn:Ae+se>=sn)&&(dt.push($t+1),dt.push(Rr),dt.push(an))}}return br}(this.ids,this.coords,Y,ce,me,this.nodeSize)};var pn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Y){return Y}},mn=function(Y){this.options=It(Object.create(pn),Y),this.trees=new Array(this.options.maxZoom+1)};function Xi(Y,ce,me,z,oe){return{x:Y,y:ce,zoom:1/0,id:me,parentId:-1,numPoints:z,properties:oe}}function ir(Y,ce){var me=Y.geometry.coordinates,z=me[1];return{x:Ze(me[0]),y:Le(z),zoom:1/0,index:ce,parentId:-1}}function pe(Y){return{type:"Feature",id:Y.id,properties:Pe(Y),geometry:{type:"Point",coordinates:[(z=Y.x,360*(z-.5)),(ce=Y.y,me=(180-360*ce)*Math.PI/180,360*Math.atan(Math.exp(me))/Math.PI-90)]}};var ce,me,z}function Pe(Y){var ce=Y.numPoints,me=ce>=1e4?Math.round(ce/1e3)+"k":ce>=1e3?Math.round(ce/100)/10+"k":ce;return It(It({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:ce,point_count_abbreviated:me})}function Ze(Y){return Y/360+.5}function Le(Y){var ce=Math.sin(Y*Math.PI/180),me=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return me<0?0:me>1?1:me}function It(Y,ce){for(var me in ce)Y[me]=ce[me];return Y}function tr(Y){return Y.x}function E(Y){return Y.y}function Z(Y,ce,me,z,oe,de){var Ae=oe-me,se=de-z;if(Ae!==0||se!==0){var Ee=((Y-me)*Ae+(ce-z)*se)/(Ae*Ae+se*se);Ee>1?(me=oe,z=de):Ee>0&&(me+=Ae*Ee,z+=se*Ee)}return(Ae=Y-me)*Ae+(se=ce-z)*se}function be(Y,ce,me,z){var oe={id:Y===void 0?null:Y,type:ce,geometry:me,tags:z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var Ae=de.geometry,se=de.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")Ge(de,Ae);else if(se==="Polygon"||se==="MultiLineString")for(var Ee=0;Ee<Ae.length;Ee++)Ge(de,Ae[Ee]);else if(se==="MultiPolygon")for(Ee=0;Ee<Ae.length;Ee++)for(var dt=0;dt<Ae[Ee].length;dt++)Ge(de,Ae[Ee][dt])}(oe),oe}function Ge(Y,ce){for(var me=0;me<ce.length;me+=3)Y.minX=Math.min(Y.minX,ce[me]),Y.minY=Math.min(Y.minY,ce[me+1]),Y.maxX=Math.max(Y.maxX,ce[me]),Y.maxY=Math.max(Y.maxY,ce[me+1])}function qe(Y,ce,me,z){if(ce.geometry){var oe=ce.geometry.coordinates,de=ce.geometry.type,Ae=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2),se=[],Ee=ce.id;if(me.promoteId?Ee=ce.properties[me.promoteId]:me.generateId&&(Ee=z||0),de==="Point")gt(oe,se);else if(de==="MultiPoint")for(var dt=0;dt<oe.length;dt++)gt(oe[dt],se);else if(de==="LineString")St(oe,se,Ae,!1);else if(de==="MultiLineString"){if(me.lineMetrics){for(dt=0;dt<oe.length;dt++)St(oe[dt],se=[],Ae,!1),Y.push(be(Ee,"LineString",se,ce.properties));return}Ct(oe,se,Ae,!1)}else if(de==="Polygon")Ct(oe,se,Ae,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(dt=0;dt<ce.geometry.geometries.length;dt++)qe(Y,{id:Ee,geometry:ce.geometry.geometries[dt],properties:ce.properties},me,z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(dt=0;dt<oe.length;dt++){var br=[];Ct(oe[dt],br,Ae,!0),se.push(br)}}Y.push(be(Ee,de,se,ce.properties))}}function gt(Y,ce){ce.push(Vt(Y[0])),ce.push(qt(Y[1])),ce.push(0)}function St(Y,ce,me,z){for(var oe,de,Ae=0,se=0;se<Y.length;se++){var Ee=Vt(Y[se][0]),dt=qt(Y[se][1]);ce.push(Ee),ce.push(dt),ce.push(0),se>0&&(Ae+=z?(oe*dt-Ee*de)/2:Math.sqrt(Math.pow(Ee-oe,2)+Math.pow(dt-de,2))),oe=Ee,de=dt}var br=ce.length-3;ce[2]=1,function Ht(Qt,Rr,kn,Ln){for(var $t,Cn=Ln,sn=kn-Rr>>1,an=kn-Rr,Ii=Qt[Rr],xn=Qt[Rr+1],Ai=Qt[kn],Qi=Qt[kn+1],li=Rr+3;li<kn;li+=3){var Yi=Z(Qt[li],Qt[li+1],Ii,xn,Ai,Qi);if(Yi>Cn)$t=li,Cn=Yi;else if(Yi===Cn){var Bi=Math.abs(li-sn);Bi<an&&($t=li,an=Bi)}}Cn>Ln&&($t-Rr>3&&Ht(Qt,Rr,$t,Ln),Qt[$t+2]=Cn,kn-$t>3&&Ht(Qt,$t,kn,Ln))}(ce,0,br,me),ce[br+2]=1,ce.size=Math.abs(Ae),ce.start=0,ce.end=ce.size}function Ct(Y,ce,me,z){for(var oe=0;oe<Y.length;oe++){var de=[];St(Y[oe],de,me,z),ce.push(de)}}function Vt(Y){return Y/360+.5}function qt(Y){var ce=Math.sin(Y*Math.PI/180),me=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return me<0?0:me>1?1:me}function ie(Y,ce,me,z,oe,de,Ae,se){if(z/=ce,de>=(me/=ce)&&Ae<z)return Y;if(Ae<me||de>=z)return null;for(var Ee=[],dt=0;dt<Y.length;dt++){var br=Y[dt],Ht=br.geometry,Qt=br.type,Rr=oe===0?br.minX:br.minY,kn=oe===0?br.maxX:br.maxY;if(Rr>=me&&kn<z)Ee.push(br);else if(!(kn<me||Rr>=z)){var Ln=[];if(Qt==="Point"||Qt==="MultiPoint")sr(Ht,Ln,me,z,oe);else if(Qt==="LineString")Mr(Ht,Ln,me,z,oe,!1,se.lineMetrics);else if(Qt==="MultiLineString")tt(Ht,Ln,me,z,oe,!1);else if(Qt==="Polygon")tt(Ht,Ln,me,z,oe,!0);else if(Qt==="MultiPolygon")for(var $t=0;$t<Ht.length;$t++){var Cn=[];tt(Ht[$t],Cn,me,z,oe,!0),Cn.length&&Ln.push(Cn)}if(Ln.length){if(se.lineMetrics&&Qt==="LineString"){for($t=0;$t<Ln.length;$t++)Ee.push(be(br.id,Qt,Ln[$t],br.tags));continue}Qt!=="LineString"&&Qt!=="MultiLineString"||(Ln.length===1?(Qt="LineString",Ln=Ln[0]):Qt="MultiLineString"),Qt!=="Point"&&Qt!=="MultiPoint"||(Qt=Ln.length===3?"Point":"MultiPoint"),Ee.push(be(br.id,Qt,Ln,br.tags))}}}return Ee.length?Ee:null}function sr(Y,ce,me,z,oe){for(var de=0;de<Y.length;de+=3){var Ae=Y[de+oe];Ae>=me&&Ae<=z&&(ce.push(Y[de]),ce.push(Y[de+1]),ce.push(Y[de+2]))}}function Mr(Y,ce,me,z,oe,de,Ae){for(var se,Ee,dt=Nr(Y),br=oe===0?yt:hr,Ht=Y.start,Qt=0;Qt<Y.length-3;Qt+=3){var Rr=Y[Qt],kn=Y[Qt+1],Ln=Y[Qt+2],$t=Y[Qt+3],Cn=Y[Qt+4],sn=oe===0?Rr:kn,an=oe===0?$t:Cn,Ii=!1;Ae&&(se=Math.sqrt(Math.pow(Rr-$t,2)+Math.pow(kn-Cn,2))),sn<me?an>me&&(Ee=br(dt,Rr,kn,$t,Cn,me),Ae&&(dt.start=Ht+se*Ee)):sn>z?an<z&&(Ee=br(dt,Rr,kn,$t,Cn,z),Ae&&(dt.start=Ht+se*Ee)):mt(dt,Rr,kn,Ln),an<me&&sn>=me&&(Ee=br(dt,Rr,kn,$t,Cn,me),Ii=!0),an>z&&sn<=z&&(Ee=br(dt,Rr,kn,$t,Cn,z),Ii=!0),!de&&Ii&&(Ae&&(dt.end=Ht+se*Ee),ce.push(dt),dt=Nr(Y)),Ae&&(Ht+=se)}var xn=Y.length-3;Rr=Y[xn],kn=Y[xn+1],Ln=Y[xn+2],(sn=oe===0?Rr:kn)>=me&&sn<=z&&mt(dt,Rr,kn,Ln),xn=dt.length-3,de&&xn>=3&&(dt[xn]!==dt[0]||dt[xn+1]!==dt[1])&&mt(dt,dt[0],dt[1],dt[2]),dt.length&&ce.push(dt)}function Nr(Y){var ce=[];return ce.size=Y.size,ce.start=Y.start,ce.end=Y.end,ce}function tt(Y,ce,me,z,oe,de){for(var Ae=0;Ae<Y.length;Ae++)Mr(Y[Ae],ce,me,z,oe,de,!1)}function mt(Y,ce,me,z){Y.push(ce),Y.push(me),Y.push(z)}function yt(Y,ce,me,z,oe,de){var Ae=(de-ce)/(z-ce);return Y.push(de),Y.push(me+(oe-me)*Ae),Y.push(1),Ae}function hr(Y,ce,me,z,oe,de){var Ae=(de-me)/(oe-me);return Y.push(ce+(z-ce)*Ae),Y.push(de),Y.push(1),Ae}function Gr(Y,ce){for(var me=[],z=0;z<Y.length;z++){var oe,de=Y[z],Ae=de.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")oe=Zr(de.geometry,ce);else if(Ae==="MultiLineString"||Ae==="Polygon"){oe=[];for(var se=0;se<de.geometry.length;se++)oe.push(Zr(de.geometry[se],ce))}else if(Ae==="MultiPolygon")for(oe=[],se=0;se<de.geometry.length;se++){for(var Ee=[],dt=0;dt<de.geometry[se].length;dt++)Ee.push(Zr(de.geometry[se][dt],ce));oe.push(Ee)}me.push(be(de.id,Ae,oe,de.tags))}return me}function Zr(Y,ce){var me=[];me.size=Y.size,Y.start!==void 0&&(me.start=Y.start,me.end=Y.end);for(var z=0;z<Y.length;z+=3)me.push(Y[z]+ce,Y[z+1],Y[z+2]);return me}function Jr(Y,ce){if(Y.transformed)return Y;var me,z,oe,de=1<<Y.z,Ae=Y.x,se=Y.y;for(me=0;me<Y.features.length;me++){var Ee=Y.features[me],dt=Ee.geometry,br=Ee.type;if(Ee.geometry=[],br===1)for(z=0;z<dt.length;z+=2)Ee.geometry.push(qr(dt[z],dt[z+1],ce,de,Ae,se));else for(z=0;z<dt.length;z++){var Ht=[];for(oe=0;oe<dt[z].length;oe+=2)Ht.push(qr(dt[z][oe],dt[z][oe+1],ce,de,Ae,se));Ee.geometry.push(Ht)}}return Y.transformed=!0,Y}function qr(Y,ce,me,z,oe,de){return[Math.round(me*(Y*z-oe)),Math.round(me*(ce*z-de))]}function Er(Y,ce,me,z,oe){for(var de=ce===oe.maxZoom?0:oe.tolerance/((1<<ce)*oe.extent),Ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:me,y:z,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},se=0;se<Y.length;se++){Ae.numFeatures++,Jn(Ae,Y[se],de,oe);var Ee=Y[se].minX,dt=Y[se].minY,br=Y[se].maxX,Ht=Y[se].maxY;Ee<Ae.minX&&(Ae.minX=Ee),dt<Ae.minY&&(Ae.minY=dt),br>Ae.maxX&&(Ae.maxX=br),Ht>Ae.maxY&&(Ae.maxY=Ht)}return Ae}function Jn(Y,ce,me,z){var oe=ce.geometry,de=ce.type,Ae=[];if(de==="Point"||de==="MultiPoint")for(var se=0;se<oe.length;se+=3)Ae.push(oe[se]),Ae.push(oe[se+1]),Y.numPoints++,Y.numSimplified++;else if(de==="LineString")Wn(Ae,oe,Y,me,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(se=0;se<oe.length;se++)Wn(Ae,oe[se],Y,me,de==="Polygon",se===0);else if(de==="MultiPolygon")for(var Ee=0;Ee<oe.length;Ee++){var dt=oe[Ee];for(se=0;se<dt.length;se++)Wn(Ae,dt[se],Y,me,!0,se===0)}if(Ae.length){var br=ce.tags||null;if(de==="LineString"&&z.lineMetrics){for(var Ht in br={},ce.tags)br[Ht]=ce.tags[Ht];br.mapbox_clip_start=oe.start/oe.size,br.mapbox_clip_end=oe.end/oe.size}var Qt={geometry:Ae,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:br};ce.id!==null&&(Qt.id=ce.id),Y.features.push(Qt)}}function Wn(Y,ce,me,z,oe,de){var Ae=z*z;if(z>0&&ce.size<(oe?Ae:z))me.numPoints+=ce.length/3;else{for(var se=[],Ee=0;Ee<ce.length;Ee+=3)(z===0||ce[Ee+2]>Ae)&&(me.numSimplified++,se.push(ce[Ee]),se.push(ce[Ee+1])),me.numPoints++;oe&&function(dt,br){for(var Ht=0,Qt=0,Rr=dt.length,kn=Rr-2;Qt<Rr;kn=Qt,Qt+=2)Ht+=(dt[Qt]-dt[kn])*(dt[Qt+1]+dt[kn+1]);if(Ht>0===br)for(Qt=0,Rr=dt.length;Qt<Rr/2;Qt+=2){var Ln=dt[Qt],$t=dt[Qt+1];dt[Qt]=dt[Rr-2-Qt],dt[Qt+1]=dt[Rr-1-Qt],dt[Rr-2-Qt]=Ln,dt[Rr-1-Qt]=$t}}(se,de),Y.push(se)}}function Ti(Y,ce){var me=(ce=this.options=function(oe,de){for(var Ae in de)oe[Ae]=de[Ae];return oe}(Object.create(this.options),ce)).debug;if(me&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");var z=function(oe,de){var Ae=[];if(oe.type==="FeatureCollection")for(var se=0;se<oe.features.length;se++)qe(Ae,oe.features[se],de,se);else qe(Ae,oe.type==="Feature"?oe:{geometry:oe},de);return Ae}(Y,ce);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(z=function(oe,de){var Ae=de.buffer/de.extent,se=oe,Ee=ie(oe,1,-1-Ae,Ae,0,-1,2,de),dt=ie(oe,1,1-Ae,2+Ae,0,-1,2,de);return(Ee||dt)&&(se=ie(oe,1,-Ae,1+Ae,0,-1,2,de)||[],Ee&&(se=Gr(Ee,1).concat(se)),dt&&(se=se.concat(Gr(dt,-1)))),se}(z,ce)).length&&this.splitTile(z,0,0,0),me&&(z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $i(Y,ce,me){return 32*((1<<Y)*me+ce)+Y}function Ji(Y,ce){var me=Y.tileID.canonical;if(!this._geoJSONIndex)return ce(null,null);var z=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!z)return ce(null,null);var oe=new At(z.features),de=wt(oe);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),ce(null,{vectorTile:oe,rawData:de.buffer})}mn.prototype.load=function(Y){var ce=this.options,me=ce.log,z=ce.minZoom,oe=ce.maxZoom,de=ce.nodeSize;me&&console.time("total time");var Ae="prepare "+Y.length+" points";me&&console.time(Ae),this.points=Y;for(var se=[],Ee=0;Ee<Y.length;Ee++)Y[Ee].geometry&&se.push(ir(Y[Ee],Ee));this.trees[oe+1]=new Dr(se,tr,E,de,Float32Array),me&&console.timeEnd(Ae);for(var dt=oe;dt>=z;dt--){var br=+Date.now();se=this._cluster(se,dt),this.trees[dt]=new Dr(se,tr,E,de,Float32Array),me&&console.log("z%d: %d clusters in %dms",dt,se.length,+Date.now()-br)}return me&&console.timeEnd("total time"),this},mn.prototype.getClusters=function(Y,ce){var me=((Y[0]+180)%360+360)%360-180,z=Math.max(-90,Math.min(90,Y[1])),oe=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,de=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)me=-180,oe=180;else if(me>oe){var Ae=this.getClusters([me,z,180,de],ce),se=this.getClusters([-180,z,oe,de],ce);return Ae.concat(se)}for(var Ee=this.trees[this._limitZoom(ce)],dt=[],br=0,Ht=Ee.range(Ze(me),Le(de),Ze(oe),Le(z));br<Ht.length;br+=1){var Qt=Ee.points[Ht[br]];dt.push(Qt.numPoints?pe(Qt):this.points[Qt.index])}return dt},mn.prototype.getChildren=function(Y){var ce=this._getOriginId(Y),me=this._getOriginZoom(Y),z="No cluster with the specified id.",oe=this.trees[me];if(!oe)throw new Error(z);var de=oe.points[ce];if(!de)throw new Error(z);for(var Ae=this.options.radius/(this.options.extent*Math.pow(2,me-1)),se=[],Ee=0,dt=oe.within(de.x,de.y,Ae);Ee<dt.length;Ee+=1){var br=oe.points[dt[Ee]];br.parentId===Y&&se.push(br.numPoints?pe(br):this.points[br.index])}if(se.length===0)throw new Error(z);return se},mn.prototype.getLeaves=function(Y,ce,me){var z=[];return this._appendLeaves(z,Y,ce=ce||10,me=me||0,0),z},mn.prototype.getTile=function(Y,ce,me){var z=this.trees[this._limitZoom(Y)],oe=Math.pow(2,Y),de=this.options,Ae=de.radius/de.extent,se=(me-Ae)/oe,Ee=(me+1+Ae)/oe,dt={features:[]};return this._addTileFeatures(z.range((ce-Ae)/oe,se,(ce+1+Ae)/oe,Ee),z.points,ce,me,oe,dt),ce===0&&this._addTileFeatures(z.range(1-Ae/oe,se,1,Ee),z.points,oe,me,oe,dt),ce===oe-1&&this._addTileFeatures(z.range(0,se,Ae/oe,Ee),z.points,-1,me,oe,dt),dt.features.length?dt:null},mn.prototype.getClusterExpansionZoom=function(Y){for(var ce=this._getOriginZoom(Y)-1;ce<=this.options.maxZoom;){var me=this.getChildren(Y);if(ce++,me.length!==1)break;Y=me[0].properties.cluster_id}return ce},mn.prototype._appendLeaves=function(Y,ce,me,z,oe){for(var de=0,Ae=this.getChildren(ce);de<Ae.length;de+=1){var se=Ae[de],Ee=se.properties;if(Ee&&Ee.cluster?oe+Ee.point_count<=z?oe+=Ee.point_count:oe=this._appendLeaves(Y,Ee.cluster_id,me,z,oe):oe<z?oe++:Y.push(se),Y.length===me)break}return oe},mn.prototype._addTileFeatures=function(Y,ce,me,z,oe,de){for(var Ae=0,se=Y;Ae<se.length;Ae+=1){var Ee=ce[se[Ae]],dt=Ee.numPoints,br={type:1,geometry:[[Math.round(this.options.extent*(Ee.x*oe-me)),Math.round(this.options.extent*(Ee.y*oe-z))]],tags:dt?Pe(Ee):this.points[Ee.index].properties},Ht=void 0;dt?Ht=Ee.id:this.options.generateId?Ht=Ee.index:this.points[Ee.index].id&&(Ht=this.points[Ee.index].id),Ht!==void 0&&(br.id=Ht),de.features.push(br)}},mn.prototype._limitZoom=function(Y){return Math.max(this.options.minZoom,Math.min(+Y,this.options.maxZoom+1))},mn.prototype._cluster=function(Y,ce){for(var me=[],z=this.options,oe=z.reduce,de=z.minPoints,Ae=z.radius/(z.extent*Math.pow(2,ce)),se=0;se<Y.length;se++){var Ee=Y[se];if(!(Ee.zoom<=ce)){Ee.zoom=ce;for(var dt=this.trees[ce+1],br=dt.within(Ee.x,Ee.y,Ae),Ht=Ee.numPoints||1,Qt=Ht,Rr=0,kn=br;Rr<kn.length;Rr+=1){var Ln=dt.points[kn[Rr]];Ln.zoom>ce&&(Qt+=Ln.numPoints||1)}if(Qt>=de){for(var $t=Ee.x*Ht,Cn=Ee.y*Ht,sn=oe&&Ht>1?this._map(Ee,!0):null,an=(se<<5)+(ce+1)+this.points.length,Ii=0,xn=br;Ii<xn.length;Ii+=1){var Ai=dt.points[xn[Ii]];if(!(Ai.zoom<=ce)){Ai.zoom=ce;var Qi=Ai.numPoints||1;$t+=Ai.x*Qi,Cn+=Ai.y*Qi,Ai.parentId=an,oe&&(sn||(sn=this._map(Ee,!0)),oe(sn,this._map(Ai)))}}Ee.parentId=an,me.push(Xi($t/Qt,Cn/Qt,an,Qt,sn))}else if(me.push(Ee),Qt>1)for(var li=0,Yi=br;li<Yi.length;li+=1){var Bi=dt.points[Yi[li]];Bi.zoom<=ce||(Bi.zoom=ce,me.push(Bi))}}}return me},mn.prototype._getOriginId=function(Y){return Y-this.points.length>>5},mn.prototype._getOriginZoom=function(Y){return(Y-this.points.length)%32},mn.prototype._map=function(Y,ce){if(Y.numPoints)return ce?It({},Y.properties):Y.properties;var me=this.points[Y.index].properties,z=this.options.map(me);return ce&&z===me?It({},z):z},Ti.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ti.prototype.splitTile=function(Y,ce,me,z,oe,de,Ae){for(var se=[Y,ce,me,z],Ee=this.options,dt=Ee.debug;se.length;){z=se.pop(),me=se.pop(),ce=se.pop(),Y=se.pop();var br=1<<ce,Ht=$i(ce,me,z),Qt=this.tiles[Ht];if(!Qt&&(dt>1&&console.time("creation"),Qt=this.tiles[Ht]=Er(Y,ce,me,z,Ee),this.tileCoords.push({z:ce,x:me,y:z}),dt)){dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,me,z,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));var Rr="z"+ce;this.stats[Rr]=(this.stats[Rr]||0)+1,this.total++}if(Qt.source=Y,oe){if(ce===Ee.maxZoom||ce===oe)continue;var kn=1<<oe-ce;if(me!==Math.floor(de/kn)||z!==Math.floor(Ae/kn))continue}else if(ce===Ee.indexMaxZoom||Qt.numPoints<=Ee.indexMaxPoints)continue;if(Qt.source=null,Y.length!==0){dt>1&&console.time("clipping");var Ln,$t,Cn,sn,an,Ii,xn=.5*Ee.buffer/Ee.extent,Ai=.5-xn,Qi=.5+xn,li=1+xn;Ln=$t=Cn=sn=null,an=ie(Y,br,me-xn,me+Qi,0,Qt.minX,Qt.maxX,Ee),Ii=ie(Y,br,me+Ai,me+li,0,Qt.minX,Qt.maxX,Ee),Y=null,an&&(Ln=ie(an,br,z-xn,z+Qi,1,Qt.minY,Qt.maxY,Ee),$t=ie(an,br,z+Ai,z+li,1,Qt.minY,Qt.maxY,Ee),an=null),Ii&&(Cn=ie(Ii,br,z-xn,z+Qi,1,Qt.minY,Qt.maxY,Ee),sn=ie(Ii,br,z+Ai,z+li,1,Qt.minY,Qt.maxY,Ee),Ii=null),dt>1&&console.timeEnd("clipping"),se.push(Ln||[],ce+1,2*me,2*z),se.push($t||[],ce+1,2*me,2*z+1),se.push(Cn||[],ce+1,2*me+1,2*z),se.push(sn||[],ce+1,2*me+1,2*z+1)}}},Ti.prototype.getTile=function(Y,ce,me){var z=this.options,oe=z.extent,de=z.debug;if(Y<0||Y>24)return null;var Ae=1<<Y,se=$i(Y,ce=(ce%Ae+Ae)%Ae,me);if(this.tiles[se])return Jr(this.tiles[se],oe);de>1&&console.log("drilling down to z%d-%d-%d",Y,ce,me);for(var Ee,dt=Y,br=ce,Ht=me;!Ee&&dt>0;)dt--,br=Math.floor(br/2),Ht=Math.floor(Ht/2),Ee=this.tiles[$i(dt,br,Ht)];return Ee&&Ee.source?(de>1&&console.log("found parent tile z%d-%d-%d",dt,br,Ht),de>1&&console.time("drilling down"),this.splitTile(Ee.source,dt,br,Ht,Y,ce,me),de>1&&console.timeEnd("drilling down"),this.tiles[se]?Jr(this.tiles[se],oe):null):null};var Pi=function(Y){function ce(me,z,oe,de){Y.call(this,me,z,oe,Ji),de&&(this.loadGeoJSON=de)}return Y&&(ce.__proto__=Y),(ce.prototype=Object.create(Y&&Y.prototype)).constructor=ce,ce.prototype.loadData=function(me,z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=z,this._pendingLoadDataParams=me,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ce.prototype._loadData=function(){var me=this;if(this._pendingCallback&&this._pendingLoadDataParams){var z=this._pendingCallback,oe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var de=!!(oe&&oe.request&&oe.request.collectResourceTiming)&&new p.RequestPerformance(oe.request);this.loadGeoJSON(oe,function(Ae,se){if(Ae||!se)return z(Ae);if(typeof se!="object")return z(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."));(function Qt(Rr,kn){var Ln,$t=Rr&&Rr.type;if($t==="FeatureCollection")for(Ln=0;Ln<Rr.features.length;Ln++)Qt(Rr.features[Ln],kn);else if($t==="GeometryCollection")for(Ln=0;Ln<Rr.geometries.length;Ln++)Qt(Rr.geometries[Ln],kn);else if($t==="Feature")Qt(Rr.geometry,kn);else if($t==="Polygon")Xt(Rr.coordinates,kn);else if($t==="MultiPolygon")for(Ln=0;Ln<Rr.coordinates.length;Ln++)Xt(Rr.coordinates[Ln],kn);return Rr})(se,!0);try{if(oe.filter){var Ee=p.createExpression(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ee.result==="error")throw new Error(Ee.value.map(function(Qt){return Qt.key+": "+Qt.message}).join(", "));var dt=se.features.filter(function(Qt){return Ee.value.evaluate({zoom:0},Qt)});se={type:"FeatureCollection",features:dt}}me._geoJSONIndex=oe.cluster?new mn(function(Qt){var Rr=Qt.superclusterOptions,kn=Qt.clusterProperties;if(!kn||!Rr)return Rr;for(var Ln={},$t={},Cn={accumulated:null,zoom:0},sn={properties:null},an=Object.keys(kn),Ii=0,xn=an;Ii<xn.length;Ii+=1){var Ai=xn[Ii],Qi=kn[Ai],li=Qi[0],Yi=p.createExpression(Qi[1]),Bi=p.createExpression(typeof li=="string"?[li,["accumulated"],["get",Ai]]:li);Ln[Ai]=Yi.value,$t[Ai]=Bi.value}return Rr.map=function(wi){sn.properties=wi;for(var sa={},Fi=0,ni=an;Fi<ni.length;Fi+=1){var Di=ni[Fi];sa[Di]=Ln[Di].evaluate(Cn,sn)}return sa},Rr.reduce=function(wi,sa){sn.properties=sa;for(var Fi=0,ni=an;Fi<ni.length;Fi+=1){var Di=ni[Fi];Cn.accumulated=wi[Di],wi[Di]=$t[Di].evaluate(Cn,sn)}},Rr}(oe)).load(se.features):function(Qt,Rr){return new Ti(Qt,Rr)}(se,oe.geojsonVtOptions)}catch(Qt){return z(Qt)}me.loaded={};var br={};if(de){var Ht=de.finish();Ht&&(br.resourceTiming={},br.resourceTiming[oe.source]=JSON.parse(JSON.stringify(Ht)))}z(null,br)})}},ce.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ce.prototype.reloadTile=function(me,z){var oe=this.loaded;return oe&&oe[me.uid]?Y.prototype.reloadTile.call(this,me,z):this.loadTile(me,z)},ce.prototype.loadGeoJSON=function(me,z){if(me.request)p.getJSON(me.request,z);else{if(typeof me.data!="string")return z(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."));try{return z(null,JSON.parse(me.data))}catch(oe){return z(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."))}}},ce.prototype.removeSource=function(me,z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),z()},ce.prototype.getClusterExpansionZoom=function(me,z){try{z(null,this._geoJSONIndex.getClusterExpansionZoom(me.clusterId))}catch(oe){z(oe)}},ce.prototype.getClusterChildren=function(me,z){try{z(null,this._geoJSONIndex.getChildren(me.clusterId))}catch(oe){z(oe)}},ce.prototype.getClusterLeaves=function(me,z){try{z(null,this._geoJSONIndex.getLeaves(me.clusterId,me.limit,me.offset))}catch(oe){z(oe)}},ce}(Ye),Ri=function(Y){var ce=this;this.self=Y,this.actor=new p.Actor(Y,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ye,geojson:Pi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(me,z){if(ce.workerSourceTypes[me])throw new Error('Worker source with name "'+me+'" already registered.');ce.workerSourceTypes[me]=z},this.self.registerRTLTextPlugin=function(me){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=me.applyArabicShaping,p.plugin.processBidirectionalText=me.processBidirectionalText,p.plugin.processStyledBidirectionalText=me.processStyledBidirectionalText}};return Ri.prototype.setReferrer=function(Y,ce){this.referrer=ce},Ri.prototype.setImages=function(Y,ce,me){for(var z in this.availableImages[Y]=ce,this.workerSources[Y]){var oe=this.workerSources[Y][z];for(var de in oe)oe[de].availableImages=ce}me()},Ri.prototype.setLayers=function(Y,ce,me){this.getLayerIndex(Y).replace(ce),me()},Ri.prototype.updateLayers=function(Y,ce,me){this.getLayerIndex(Y).update(ce.layers,ce.removedIds),me()},Ri.prototype.loadTile=function(Y,ce,me){this.getWorkerSource(Y,ce.type,ce.source).loadTile(ce,me)},Ri.prototype.loadDEMTile=function(Y,ce,me){this.getDEMWorkerSource(Y,ce.source).loadTile(ce,me)},Ri.prototype.reloadTile=function(Y,ce,me){this.getWorkerSource(Y,ce.type,ce.source).reloadTile(ce,me)},Ri.prototype.abortTile=function(Y,ce,me){this.getWorkerSource(Y,ce.type,ce.source).abortTile(ce,me)},Ri.prototype.removeTile=function(Y,ce,me){this.getWorkerSource(Y,ce.type,ce.source).removeTile(ce,me)},Ri.prototype.removeDEMTile=function(Y,ce){this.getDEMWorkerSource(Y,ce.source).removeTile(ce)},Ri.prototype.removeSource=function(Y,ce,me){if(this.workerSources[Y]&&this.workerSources[Y][ce.type]&&this.workerSources[Y][ce.type][ce.source]){var z=this.workerSources[Y][ce.type][ce.source];delete this.workerSources[Y][ce.type][ce.source],z.removeSource!==void 0?z.removeSource(ce,me):me()}},Ri.prototype.loadWorkerSource=function(Y,ce,me){try{this.self.importScripts(ce.url),me()}catch(z){me(z.toString())}},Ri.prototype.syncRTLPluginState=function(Y,ce,me){try{p.plugin.setState(ce);var z=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&z!=null){this.self.importScripts(z);var oe=p.plugin.isParsed();me(oe?void 0:new Error("RTL Text Plugin failed to import scripts from "+z),oe)}}catch(de){me(de.toString())}},Ri.prototype.getAvailableImages=function(Y){var ce=this.availableImages[Y];return ce||(ce=[]),ce},Ri.prototype.getLayerIndex=function(Y){var ce=this.layerIndexes[Y];return ce||(ce=this.layerIndexes[Y]=new K),ce},Ri.prototype.getWorkerSource=function(Y,ce,me){var z=this;return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][ce]||(this.workerSources[Y][ce]={}),this.workerSources[Y][ce][me]||(this.workerSources[Y][ce][me]=new this.workerSourceTypes[ce]({send:function(oe,de,Ae){z.actor.send(oe,de,Ae,Y)}},this.getLayerIndex(Y),this.getAvailableImages(Y))),this.workerSources[Y][ce][me]},Ri.prototype.getDEMWorkerSource=function(Y,ce){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][ce]||(this.demWorkerSources[Y][ce]=new rt),this.demWorkerSources[Y][ce]},Ri.prototype.enforceCacheSizeLimit=function(Y,ce){p.enforceCacheSizeLimit(ce)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ri(self)),Ri}),C(["./shared"],function(p){"use strict";var w=p.createCommonjsModule(function(n){function u(y){return!o(y)}function o(y){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,F,H=new Blob([""],{type:"text/javascript"}),ae=URL.createObjectURL(H);try{F=new Worker(ae),P=!0}catch(xe){P=!1}return F&&F.terminate(),URL.revokeObjectURL(ae),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var F=P.getContext("2d");if(!F)return!1;var H=F.getImageData(0,0,1,1);return H&&H.width===P.width}()?(h[b=y&&y.failIfMajorPerformanceCaveat]===void 0&&(h[b]=function(P){var F=function(ae){var xe=document.createElement("canvas"),we=Object.create(u.webGLContextAttributes);return we.failIfMajorPerformanceCaveat=ae,xe.probablySupportsContext?xe.probablySupportsContext("webgl",we)||xe.probablySupportsContext("experimental-webgl",we):xe.supportsContext?xe.supportsContext("webgl",we)||xe.supportsContext("experimental-webgl",we):xe.getContext("webgl",we)||xe.getContext("experimental-webgl",we)}(P);if(!F)return!1;var H=F.createShader(F.VERTEX_SHADER);return!(!H||F.isContextLost())&&(F.shaderSource(H,"void main() {}"),F.compileShader(H),F.getShaderParameter(H,F.COMPILE_STATUS)===!0)}(b)),h[b]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var b}n.exports?n.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=o);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),q={create:function(n,u,o){var h=p.window.document.createElement(n);return u!==void 0&&(h.className=u),o&&o.appendChild(h),h},createNS:function(n,u){return p.window.document.createElementNS(n,u)}},K=p.window.document&&p.window.document.documentElement.style;function W(n){if(!K)return n[0];for(var u=0;u<n.length;u++)if(n[u]in K)return n[u];return n[0]}var L,N=W(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);q.disableDrag=function(){K&&N&&(L=K[N],K[N]="none")},q.enableDrag=function(){K&&N&&(K[N]=L)};var Ne=W(["transform","WebkitTransform"]);q.setTransform=function(n,u){n.style[Ne]=u};var Ye=!1;try{var Je=Object.defineProperty({},"passive",{get:function(){Ye=!0}});p.window.addEventListener("test",Je,Je),p.window.removeEventListener("test",Je,Je)}catch(n){Ye=!1}q.addEventListener=function(n,u,o,h){h===void 0&&(h={}),n.addEventListener(u,o,"passive"in h&&Ye?h:h.capture)},q.removeEventListener=function(n,u,o,h){h===void 0&&(h={}),n.removeEventListener(u,o,"passive"in h&&Ye?h:h.capture)};var rt=function(n){n.preventDefault(),n.stopPropagation(),p.window.removeEventListener("click",rt,!0)};function Xt(n){var u=n.userImage;return!!(u&&u.render&&u.render())&&(n.data.replace(new Uint8Array(u.data.buffer)),!0)}q.suppressClick=function(){p.window.addEventListener("click",rt,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",rt,!0)},0)},q.mousePos=function(n,u){var o=n.getBoundingClientRect();return new p.Point(u.clientX-o.left-n.clientLeft,u.clientY-o.top-n.clientTop)},q.touchPos=function(n,u){for(var o=n.getBoundingClientRect(),h=[],y=0;y<u.length;y++)h.push(new p.Point(u[y].clientX-o.left-n.clientLeft,u[y].clientY-o.top-n.clientTop));return h},q.mouseButton=function(n){return p.window.InstallTrigger!==void 0&&n.button===2&&n.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:n.button},q.remove=function(n){n.parentNode&&n.parentNode.removeChild(n)};var Gt=function(n){function u(){n.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(o){if(this.loaded!==o&&(this.loaded=o,o)){for(var h=0,y=this.requestors;h<y.length;h+=1){var b=y[h];this._notify(b.ids,b.callback)}this.requestors=[]}},u.prototype.getImage=function(o){return this.images[o]},u.prototype.addImage=function(o,h){this._validate(o,h)&&(this.images[o]=h)},u.prototype._validate=function(o,h){var y=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchX" value'))),y=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchY" value'))),y=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "content" value'))),y=!1),y},u.prototype._validateStretch=function(o,h){if(!o)return!0;for(var y=0,b=0,P=o;b<P.length;b+=1){var F=P[b];if(F[0]<y||F[1]<F[0]||h<F[1])return!1;y=F[1]}return!0},u.prototype._validateContent=function(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))},u.prototype.updateImage=function(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0},u.prototype.removeImage=function(o){var h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(o,h){var y=!0;if(!this.isLoaded())for(var b=0,P=o;b<P.length;b+=1)this.images[P[b]]||(y=!1);this.isLoaded()||y?this._notify(o,h):this.requestors.push({ids:o,callback:h})},u.prototype._notify=function(o,h){for(var y={},b=0,P=o;b<P.length;b+=1){var F=P[b];this.images[F]||this.fire(new p.Event("styleimagemissing",{id:F}));var H=this.images[F];H?y[F]={data:H.data.clone(),pixelRatio:H.pixelRatio,sdf:H.sdf,version:H.version,stretchX:H.stretchX,stretchY:H.stretchY,content:H.content,hasRenderCallback:Boolean(H.userImage&&H.userImage.render)}:p.warnOnce('Image "'+F+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,y)},u.prototype.getPixelSize=function(){var o=this.atlasImage;return{width:o.width,height:o.height}},u.prototype.getPattern=function(o){var h=this.patterns[o],y=this.getImage(o);if(!y)return null;if(h&&h.position.version===y.version)return h.position;if(h)h.position.version=y.version;else{var b={w:y.data.width+2,h:y.data.height+2,x:0,y:0},P=new p.ImagePosition(b,y);this.patterns[o]={bin:b,position:P}}return this._updatePatternAtlas(),this.patterns[o].position},u.prototype.bind=function(o){var h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var o=[];for(var h in this.patterns)o.push(this.patterns[h].bin);var y=p.potpack(o),b=y.w,P=y.h,F=this.atlasImage;for(var H in F.resize({width:b||1,height:P||1}),this.patterns){var ae=this.patterns[H].bin,xe=ae.x+1,we=ae.y+1,Te=this.images[H].data,He=Te.width,je=Te.height;p.RGBAImage.copy(Te,F,{x:0,y:0},{x:xe,y:we},{width:He,height:je}),p.RGBAImage.copy(Te,F,{x:0,y:je-1},{x:xe,y:we-1},{width:He,height:1}),p.RGBAImage.copy(Te,F,{x:0,y:0},{x:xe,y:we+je},{width:He,height:1}),p.RGBAImage.copy(Te,F,{x:He-1,y:0},{x:xe-1,y:we},{width:1,height:je}),p.RGBAImage.copy(Te,F,{x:0,y:0},{x:xe+He,y:we},{width:1,height:je})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(o){for(var h=0,y=o;h<y.length;h+=1){var b=y[h];if(!this.callbackDispatchedThisFrame[b]){this.callbackDispatchedThisFrame[b]=!0;var P=this.images[b];Xt(P)&&this.updateImage(b,P)}}},u}(p.Evented),nr=Et,Ut=Et,At=1e20;function Et(n,u,o,h,y,b){this.fontSize=n||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=y||"sans-serif",this.fontWeight=b||"normal",this.radius=o||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function dr(n,u,o,h,y,b,P){for(var F=0;F<u;F++){for(var H=0;H<o;H++)h[H]=n[H*u+F];for(re(h,y,b,P,o),H=0;H<o;H++)n[H*u+F]=y[H]}for(H=0;H<o;H++){for(F=0;F<u;F++)h[F]=n[H*u+F];for(re(h,y,b,P,u),F=0;F<u;F++)n[H*u+F]=Math.sqrt(y[F])}}function re(n,u,o,h,y){o[0]=0,h[0]=-At,h[1]=+At;for(var b=1,P=0;b<y;b++){for(var F=(n[b]+b*b-(n[o[P]]+o[P]*o[P]))/(2*b-2*o[P]);F<=h[P];)P--,F=(n[b]+b*b-(n[o[P]]+o[P]*o[P]))/(2*b-2*o[P]);o[++P]=b,h[P]=F,h[P+1]=+At}for(b=0,P=0;b<y;b++){for(;h[P+1]<b;)P++;u[b]=(b-o[P])*(b-o[P])+n[o[P]]}}Et.prototype.draw=function(n){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(n,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),o=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var y=u.data[4*h+3]/255;this.gridOuter[h]=y===1?0:y===0?At:Math.pow(Math.max(0,.5-y),2),this.gridInner[h]=y===1?At:y===0?0:Math.pow(Math.max(0,y-.5),2)}for(dr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),dr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)o[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return o},nr.default=Ut;var mr=function(n,u){this.requestManager=n,this.localIdeographFontFamily=u,this.entries={}};mr.prototype.setURL=function(n){this.url=n},mr.prototype.getGlyphs=function(n,u){var o=this,h=[];for(var y in n)for(var b=0,P=n[y];b<P.length;b+=1)h.push({stack:y,id:P[b]});p.asyncAll(h,function(F,H){var ae=F.stack,xe=F.id,we=o.entries[ae];we||(we=o.entries[ae]={glyphs:{},requests:{},ranges:{}});var Te=we.glyphs[xe];if(Te===void 0){if(Te=o._tinySDF(we,ae,xe))return we.glyphs[xe]=Te,void H(null,{stack:ae,id:xe,glyph:Te});var He=Math.floor(xe/256);if(256*He>65535)H(new Error("glyphs > 65535 not supported"));else if(we.ranges[He])H(null,{stack:ae,id:xe,glyph:Te});else{var je=we.requests[He];je||(je=we.requests[He]=[],mr.loadGlyphRange(ae,He,o.url,o.requestManager,function(it,ze){if(ze){for(var at in ze)o._doesCharSupportLocalGlyph(+at)||(we.glyphs[+at]=ze[+at]);we.ranges[He]=!0}for(var xt=0,jt=je;xt<jt.length;xt+=1)(0,jt[xt])(it,ze);delete we.requests[He]})),je.push(function(it,ze){it?H(it):ze&&H(null,{stack:ae,id:xe,glyph:ze[xe]||null})})}}else H(null,{stack:ae,id:xe,glyph:Te})},function(F,H){if(F)u(F);else if(H){for(var ae={},xe=0,we=H;xe<we.length;xe+=1){var Te=we[xe],He=Te.stack,je=Te.id,it=Te.glyph;(ae[He]||(ae[He]={}))[je]=it&&{id:it.id,bitmap:it.bitmap.clone(),metrics:it.metrics}}u(null,ae)}})},mr.prototype._doesCharSupportLocalGlyph=function(n){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](n)||p.isChar["Hangul Syllables"](n)||p.isChar.Hiragana(n)||p.isChar.Katakana(n))},mr.prototype._tinySDF=function(n,u,o){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(o)){var y=n.tinySDF;if(!y){var b="400";/bold/i.test(u)?b="900":/medium/i.test(u)?b="500":/light/i.test(u)&&(b="200"),y=n.tinySDF=new mr.TinySDF(24,3,8,.25,h,b)}return{id:o,bitmap:new p.AlphaImage({width:30,height:30},y.draw(String.fromCharCode(o))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},mr.loadGlyphRange=function(n,u,o,h,y){var b=256*u,P=b+255,F=h.transformRequest(h.normalizeGlyphsURL(o).replace("{fontstack}",n).replace("{range}",b+"-"+P),p.ResourceType.Glyphs);p.getArrayBuffer(F,function(H,ae){if(H)y(H);else if(ae){for(var xe={},we=0,Te=p.parseGlyphPBF(ae);we<Te.length;we+=1){var He=Te[we];xe[He.id]=He}y(null,xe)}})},mr.TinySDF=nr;var wt=function(){this.specification=p.styleSpec.light.position};wt.prototype.possiblyEvaluate=function(n,u){return p.sphericalToCartesian(n.expression.evaluate(u))},wt.prototype.interpolate=function(n,u,o){return{x:p.number(n.x,u.x,o),y:p.number(n.y,u.y,o),z:p.number(n.z,u.z,o)}};var Ke=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new wt,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),Dt=function(n){function u(o){n.call(this),this._transitionable=new p.Transitionable(Ke),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(o,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,o,h))for(var y in o){var b=o[y];p.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-"-transition".length),b):this._transitionable.setValue(y,b)}},u.prototype.updateTransitions=function(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(o){this.properties=this._transitioning.possiblyEvaluate(o)},u.prototype._validate=function(o,h,y){return(!y||y.validate!==!1)&&p.emitValidationErrors(this,o.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},u}(p.Evented),Xe=function(n,u){this.width=n,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Xe.prototype.getDash=function(n,u){var o=n.join(",")+String(u);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(n,u)),this.dashEntry[o]},Xe.prototype.getDashRanges=function(n,u,o){var h=[],y=n.length%2==1?-n[n.length-1]*o:0,b=n[0]*o,P=!0;h.push({left:y,right:b,isDash:P,zeroLength:n[0]===0});for(var F=n[0],H=1;H<n.length;H++){var ae=n[H];h.push({left:y=F*o,right:b=(F+=ae)*o,isDash:P=!P,zeroLength:ae===0})}return h},Xe.prototype.addRoundDash=function(n,u,o){for(var h=u/2,y=-o;y<=o;y++)for(var b=this.width*(this.nextRow+o+y),P=0,F=n[P],H=0;H<this.width;H++){H/F.right>1&&(F=n[++P]);var ae=Math.abs(H-F.left),xe=Math.abs(H-F.right),we=Math.min(ae,xe),Te=void 0,He=y/o*(h+1);if(F.isDash){var je=h-Math.abs(He);Te=Math.sqrt(we*we+je*je)}else Te=h-Math.sqrt(we*we+He*He);this.data[b+H]=Math.max(0,Math.min(255,Te+128))}},Xe.prototype.addRegularDash=function(n){for(var u=n.length-1;u>=0;--u){var o=n[u],h=n[u+1];o.zeroLength?n.splice(u,1):h&&h.isDash===o.isDash&&(h.left=o.left,n.splice(u,1))}var y=n[0],b=n[n.length-1];y.isDash===b.isDash&&(y.left=b.left-this.width,b.right=y.right+this.width);for(var P=this.width*this.nextRow,F=0,H=n[F],ae=0;ae<this.width;ae++){ae/H.right>1&&(H=n[++F]);var xe=Math.abs(ae-H.left),we=Math.abs(ae-H.right),Te=Math.min(xe,we);this.data[P+ae]=Math.max(0,Math.min(255,(H.isDash?Te:-Te)+128))}},Xe.prototype.addDash=function(n,u){var o=u?7:0,h=2*o+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var y=0,b=0;b<n.length;b++)y+=n[b];if(y!==0){var P=this.width/y,F=this.getDashRanges(n,this.width,P);u?this.addRoundDash(F,P,o):this.addRegularDash(F)}var H={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:y};return this.nextRow+=h,this.dirty=!0,H},Xe.prototype.bind=function(n){var u=n.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Zt=function n(u,o){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),y=0;y<h.length;y++){var b=new n.Actor(h[y],o,this.id);b.name="Worker "+y,this.actors.push(b)}};function yr(n,u,o){var h=function(y,b){if(y)return o(y);if(b){var P=p.pick(p.extend(b,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(P.vectorLayers=b.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(F){return F.id})),P.tiles=u.canonicalizeTileset(P,n.url),o(null,P)}};return n.url?p.getJSON(u.transformRequest(u.normalizeSourceURL(n.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,n)})}Zt.prototype.broadcast=function(n,u,o){p.asyncAll(this.actors,function(h,y){h.send(n,u,y)},o=o||function(){})},Zt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Zt.prototype.remove=function(){this.actors.forEach(function(n){n.remove()}),this.actors=[],this.workerPool.release(this.id)},Zt.Actor=p.Actor;var ur=function(n,u,o){this.bounds=p.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=u||0,this.maxzoom=o||24};ur.prototype.validateBounds=function(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]},ur.prototype.contains=function(n){var u=Math.pow(2,n.z),o=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),y=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),b=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return n.x>=o&&n.x<y&&n.y>=h&&n.y<b};var Ur=function(n){function u(o,h,y,b){if(n.call(this),this.id=o,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yr(this._options,this.map._requestManager,function(h,y){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new p.ErrorEvent(h)):y&&(p.extend(o,y),y.bounds&&(o.tileBounds=new ur(y.bounds,o.minzoom,o.maxzoom)),p.postTurnstileEvent(y.tiles,o.map._requestManager._customAccessToken),p.postMapLoadEvent(y.tiles,o.map._getMapId(),o.map._requestManager._skuToken,o.map._requestManager._customAccessToken),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setSourceProperty=function(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(o){var h=this;return this.setSourceProperty(function(){h._options.tiles=o}),this},u.prototype.setUrl=function(o){var h=this;return this.setSourceProperty(function(){h.url=o,h._options.url=o}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.loadTile=function(o,h){var y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(y,p.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(F,H){return delete o.request,o.aborted?h(null):F&&F.status!==404?h(F):(H&&H.resourceTiming&&(o.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&o.setExpiryData(H),o.loadVectorData(H,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}b.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",b,P.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",b,P.bind(this)))},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(p.Evented),he=function(n){function u(o,h,y,b){n.call(this),this.id=o,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yr(this._options,this.map._requestManager,function(h,y){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new p.ErrorEvent(h)):y&&(p.extend(o,y),y.bounds&&(o.tileBounds=new ur(y.bounds,o.minzoom,o.maxzoom)),p.postTurnstileEvent(y.tiles),p.postMapLoadEvent(y.tiles,o.map._getMapId(),o.map._requestManager._skuToken),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.loadTile=function(o,h){var y=this,b=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);o.request=p.getImage(this.map._requestManager.transformRequest(b,p.ResourceType.Tile),function(P,F){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(P)o.state="errored",h(P);else if(F){y.map._refreshExpiredTiles&&o.setExpiryData(F),delete F.cacheControl,delete F.expires;var H=y.map.painter.context,ae=H.gl;o.texture=y.map.painter.getTileTexture(F.width),o.texture?o.texture.update(F,{useMipmap:!0}):(o.texture=new p.Texture(H,F,ae.RGBA,{useMipmap:!0}),o.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE,ae.LINEAR_MIPMAP_NEAREST),H.extTextureFilterAnisotropic&&ae.texParameterf(ae.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax)),o.state="loaded",p.cacheEntryPossiblyAdded(y.dispatcher),h(null)}})},u.prototype.abortTile=function(o,h){o.request&&(o.request.cancel(),delete o.request),h()},u.prototype.unloadTile=function(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Re=function(n){function u(o,h,y,b){n.call(this,o,h,y,b),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(o,h){var y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function b(P,F){P&&(o.state="errored",h(P)),F&&(o.dem=F,o.needsHillshadePrepare=!0,o.state="loaded",h(null))}o.request=p.getImage(this.map._requestManager.transformRequest(y,p.ResourceType.Tile),function(P,F){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(P)o.state="errored",h(P);else if(F){this.map._refreshExpiredTiles&&o.setExpiryData(F),delete F.cacheControl,delete F.expires;var H=p.window.ImageBitmap&&F instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?F:p.browser.getImageData(F,1),ae={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:H,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",ae,b.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)},u.prototype._getNeighboringTiles=function(o){var h=o.canonical,y=Math.pow(2,h.z),b=(h.x-1+y)%y,P=h.x===0?o.wrap-1:o.wrap,F=(h.x+1+y)%y,H=h.x+1===y?o.wrap+1:o.wrap,ae={};return ae[new p.OverscaledTileID(o.overscaledZ,P,h.z,b,h.y).key]={backfilled:!1},ae[new p.OverscaledTileID(o.overscaledZ,H,h.z,F,h.y).key]={backfilled:!1},h.y>0&&(ae[new p.OverscaledTileID(o.overscaledZ,P,h.z,b,h.y-1).key]={backfilled:!1},ae[new p.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},ae[new p.OverscaledTileID(o.overscaledZ,H,h.z,F,h.y-1).key]={backfilled:!1}),h.y+1<y&&(ae[new p.OverscaledTileID(o.overscaledZ,P,h.z,b,h.y+1).key]={backfilled:!1},ae[new p.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},ae[new p.OverscaledTileID(o.overscaledZ,H,h.z,F,h.y+1).key]={backfilled:!1}),ae},u.prototype.unloadTile=function(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})},u}(he),ge=function(n){function u(o,h,y,b){n.call(this),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=y.getActor(),this.setEventedParent(b),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var P=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*P,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*P,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*P,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var o=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)o.fire(new p.ErrorEvent(h));else{var y={dataType:"source",sourceDataType:"metadata"};o._collectResourceTiming&&o._resourceTiming&&o._resourceTiming.length>0&&(y.resourceTiming=o._resourceTiming,o._resourceTiming=[]),o.fire(new p.Event("data",y))}})},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setData=function(o){var h=this;return this._data=o,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(y){if(y)h.fire(new p.ErrorEvent(y));else{var b={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(b.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",b))}}),this},u.prototype.getClusterExpansionZoom=function(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this},u.prototype.getClusterChildren=function(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this},u.prototype.getClusterLeaves=function(o,h,y,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:y},b),this},u.prototype._updateWorkerData=function(o){var h=this;this._loaded=!1;var y=p.extend({},this.workerOptions),b=this._data;typeof b=="string"?(y.request=this.map._requestManager.transformRequest(p.browser.resolveURL(b),p.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(b),this.actor.send(this.type+".loadData",y,function(P,F){h._removed||F&&F.abandoned||(h._loaded=!0,F&&F.resourceTiming&&F.resourceTiming[h.id]&&(h._resourceTiming=F.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:y.source},null),o(P))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(o,h){var y=this,b=o.actor?"reloadTile":"loadTile";o.actor=this.actor,o.request=this.actor.send(b,{type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,F){return delete o.request,o.unloadVectorData(),o.aborted?h(null):P?h(P):(o.loadVectorData(F,y.map.painter,b==="reloadTile"),h(null))})},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0},u.prototype.unloadTile=function(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(p.Evented),_t=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),pt=function(n){function u(o,h,y,b){n.call(this),this.id=o,this.dispatcher=y,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(o,h){var y=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(b,P){y._loaded=!0,b?y.fire(new p.ErrorEvent(b)):P&&(y.image=P,o&&(y.coordinates=o),h&&h(),y._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(o){var h=this;return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setCoordinates=function(o){var h=this;this.coordinates=o;var y=o.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var F=1/0,H=1/0,ae=-1/0,xe=-1/0,we=0,Te=P;we<Te.length;we+=1){var He=Te[we];F=Math.min(F,He.x),H=Math.min(H,He.y),ae=Math.max(ae,He.x),xe=Math.max(xe,He.y)}var je=Math.max(ae-F,xe-H),it=Math.max(0,Math.floor(-Math.log(je)/Math.LN2)),ze=Math.pow(2,it);return new p.CanonicalTileID(it,Math.floor((F+ae)/2*ze),Math.floor((H+xe)/2*ze))}(y),this.minzoom=this.maxzoom=this.tileID.z;var b=y.map(function(P){return h.tileID.getTilePoint(P)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(b[0].x,b[0].y,0,0),this._boundsArray.emplaceBack(b[1].x,b[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(b[3].x,b[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(b[2].x,b[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var o=this.map.painter.context,h=o.gl;for(var y in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.loadTile=function(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(p.Evented),zt=function(n){function u(o,h,y,b){n.call(this,o,h,y,b),this.roundZoom=!0,this.type="video",this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1;var h=this.options;this.urls=[];for(var y=0,b=h.urls;y<b.length;y+=1)this.urls.push(this.map._requestManager.transformRequest(b[y],p.ResourceType.Source).url);p.getVideo(this.urls,function(P,F){o._loaded=!0,P?o.fire(new p.ErrorEvent(P)):F&&(o.video=F,o.video.loop=!0,o.video.addEventListener("playing",function(){o.map.triggerRepaint()}),o.map&&o.video.play(),o._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(o){if(this.video){var h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=o}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var o=this.map.painter.context,h=o.gl;for(var y in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(pt),Ft=function(n){function u(o,h,y,b){n.call(this,o,h,y,b),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(F){return typeof F!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,y=h.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,y.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[b];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var o=0,h=[this.canvas.width,this.canvas.height];o<h.length;o+=1){var y=h[o];if(isNaN(y)||y<=0)return!0}return!1},u}(pt),Dr={vector:Ur,raster:he,"raster-dem":Re,geojson:ge,video:zt,image:pt,canvas:Ft};function pn(n,u){var o=p.identity([]);return p.translate(o,o,[1,1,0]),p.scale(o,o,[.5*n.width,.5*n.height,1]),p.multiply(o,o,n.calculatePosMatrix(u.toUnwrapped()))}function mn(n,u,o,h,y,b){var P=function(it,ze,at){if(it)for(var xt=0,jt=it;xt<jt.length;xt+=1){var gr=ze[jt[xt]];if(gr&&gr.source===at&&gr.type==="fill-extrusion")return!0}else for(var lr in ze){var _r=ze[lr];if(_r.source===at&&_r.type==="fill-extrusion")return!0}return!1}(y&&y.layers,u,n.id),F=b.maxPitchScaleFactor(),H=n.tilesIn(h,F,P);H.sort(Xi);for(var ae=[],xe=0,we=H;xe<we.length;xe+=1){var Te=we[xe];ae.push({wrappedTileID:Te.tileID.wrapped().key,queryResults:Te.tile.queryRenderedFeatures(u,o,n._state,Te.queryGeometry,Te.cameraQueryGeometry,Te.scale,y,b,F,pn(n.transform,Te.tileID))})}var He=function(it){for(var ze={},at={},xt=0,jt=it;xt<jt.length;xt+=1){var gr=jt[xt],lr=gr.queryResults,_r=gr.wrappedTileID,zr=at[_r]=at[_r]||{};for(var on in lr)for(var Qr=lr[on],Pn=zr[on]=zr[on]||{},ei=ze[on]=ze[on]||[],ci=0,ti=Qr;ci<ti.length;ci+=1){var aa=ti[ci];Pn[aa.featureIndex]||(Pn[aa.featureIndex]=!0,ei.push(aa))}}return ze}(ae);for(var je in He)He[je].forEach(function(it){var ze=it.feature,at=n.getFeatureState(ze.layer["source-layer"],ze.id);ze.source=ze.layer.source,ze.layer["source-layer"]&&(ze.sourceLayer=ze.layer["source-layer"]),ze.state=at});return He}function Xi(n,u){var o=n.tileID,h=u.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}var ir=function(n,u){this.max=n,this.onRemove=u,this.reset()};ir.prototype.reset=function(){for(var n in this.data)for(var u=0,o=this.data[n];u<o.length;u+=1){var h=o[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},ir.prototype.add=function(n,u,o){var h=this,y=n.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);var b={value:u,timeout:void 0};if(o!==void 0&&(b.timeout=setTimeout(function(){h.remove(n,b)},o)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},ir.prototype.has=function(n){return n.wrapped().key in this.data},ir.prototype.getAndRemove=function(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null},ir.prototype._getAndRemoveByKey=function(n){var u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value},ir.prototype.getByKey=function(n){var u=this.data[n];return u?u[0].value:null},ir.prototype.get=function(n){return this.has(n)?this.data[n.wrapped().key][0].value:null},ir.prototype.remove=function(n,u){if(!this.has(n))return this;var o=n.wrapped().key,h=u===void 0?0:this.data[o].indexOf(u),y=this.data[o][h];return this.data[o].splice(h,1),y.timeout&&clearTimeout(y.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(y.value),this.order.splice(this.order.indexOf(o),1),this},ir.prototype.setMaxSize=function(n){for(this.max=n;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},ir.prototype.filter=function(n){var u=[];for(var o in this.data)for(var h=0,y=this.data[o];h<y.length;h+=1){var b=y[h];n(b.value)||u.push(b)}for(var P=0,F=u;P<F.length;P+=1){var H=F[P];this.remove(H.value.tileID,H)}};var pe=function(n,u,o){this.context=n;var h=n.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(o),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};pe.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},pe.prototype.updateData=function(n){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)},pe.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Pe={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ze=function(n,u,o,h){this.length=u.length,this.attributes=o,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=n;var y=n.gl;this.buffer=y.createBuffer(),n.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};Ze.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ze.prototype.updateData=function(n){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)},Ze.prototype.enableAttributes=function(n,u){for(var o=0;o<this.attributes.length;o++){var h=u.attributes[this.attributes[o].name];h!==void 0&&n.enableVertexAttribArray(h)}},Ze.prototype.setVertexAttribPointers=function(n,u,o){for(var h=0;h<this.attributes.length;h++){var y=this.attributes[h],b=u.attributes[y.name];b!==void 0&&n.vertexAttribPointer(b,y.components,n[Pe[y.type]],!1,this.itemSize,y.offset+this.itemSize*(o||0))}},Ze.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Le=function(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Le.prototype.get=function(){return this.current},Le.prototype.set=function(n){},Le.prototype.getDefault=function(){return this.default},Le.prototype.setDefault=function(){this.set(this.default)};var It=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Le),tr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)},u}(Le),E=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)},u}(Le),Z=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Le),be=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)},u}(Le),Ge=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)},u}(Le),qe=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(o){var h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)},u}(Le),gt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)},u}(Le),St=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}},u}(Le),Ct=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Le),Vt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}},u}(Le),qt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)},u}(Le),ie=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}},u}(Le),sr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.ONE,o.ZERO]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Le),Mr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Le),Nr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)},u}(Le),tt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}},u}(Le),mt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)},u}(Le),yt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)},u}(Le),hr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)},u}(Le),Gr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)},u}(Le),Zr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Le),Jr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}},u}(Le),qr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Le),Er=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}},u}(Le),Jn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}},u}(Le),Wn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1},u}(Le),Ti=function(n){function u(o){n.call(this,o),this.vao=o.extVertexArrayObject}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)},u}(Le),$i=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}},u}(Le),Ji=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}},u}(Le),Pi=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}},u}(Le),Ri=function(n){function u(o,h){n.call(this,o),this.context=o,this.parent=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(Le),Y=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}},u}(Ri),ce=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Ri),me=function(n,u,o,h){this.context=n,this.width=u,this.height=o;var y=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Y(n,y),h&&(this.depthAttachment=new ce(n,y))};me.prototype.destroy=function(){var n=this.context.gl,u=this.colorAttachment.get();if(u&&n.deleteTexture(u),this.depthAttachment){var o=this.depthAttachment.get();o&&n.deleteRenderbuffer(o)}n.deleteFramebuffer(this.framebuffer)};var z=function(n,u,o){this.func=n,this.mask=u,this.range=o};z.ReadOnly=!1,z.ReadWrite=!0,z.disabled=new z(519,z.ReadOnly,[0,1]);var oe=function(n,u,o,h,y,b){this.test=n,this.ref=u,this.mask=o,this.fail=h,this.depthFail=y,this.pass=b};oe.disabled=new oe({func:519,mask:0},0,0,7680,7680,7680);var de=function(n,u,o){this.blendFunction=n,this.blendColor=u,this.mask=o};de.disabled=new de(de.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),de.unblended=new de(de.Replace,p.Color.transparent,[!0,!0,!0,!0]),de.alphaBlended=new de([1,771],p.Color.transparent,[!0,!0,!0,!0]);var Ae=function(n,u,o){this.enable=n,this.mode=u,this.frontFace=o};Ae.disabled=new Ae(!1,1029,2305),Ae.backCCW=new Ae(!0,1029,2305);var se=function(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new It(this),this.clearDepth=new tr(this),this.clearStencil=new E(this),this.colorMask=new Z(this),this.depthMask=new be(this),this.stencilMask=new Ge(this),this.stencilFunc=new qe(this),this.stencilOp=new gt(this),this.stencilTest=new St(this),this.depthRange=new Ct(this),this.depthTest=new Vt(this),this.depthFunc=new qt(this),this.blend=new ie(this),this.blendFunc=new sr(this),this.blendColor=new Mr(this),this.blendEquation=new Nr(this),this.cullFace=new tt(this),this.cullFaceSide=new mt(this),this.frontFace=new yt(this),this.program=new hr(this),this.activeTexture=new Gr(this),this.viewport=new Zr(this),this.bindFramebuffer=new Jr(this),this.bindRenderbuffer=new qr(this),this.bindTexture=new Er(this),this.bindVertexBuffer=new Jn(this),this.bindElementBuffer=new Wn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ti(this),this.pixelStoreUnpack=new $i(this),this.pixelStoreUnpackPremultiplyAlpha=new Ji(this),this.pixelStoreUnpackFlipY=new Pi(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)};se.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},se.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},se.prototype.createIndexBuffer=function(n,u){return new pe(this,n,u)},se.prototype.createVertexBuffer=function(n,u,o){return new Ze(this,n,u,o)},se.prototype.createRenderbuffer=function(n,u,o){var h=this.gl,y=h.createRenderbuffer();return this.bindRenderbuffer.set(y),h.renderbufferStorage(h.RENDERBUFFER,n,u,o),this.bindRenderbuffer.set(null),y},se.prototype.createFramebuffer=function(n,u,o){return new me(this,n,u,o)},se.prototype.clear=function(n){var u=n.color,o=n.depth,h=this.gl,y=0;u&&(y|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(y|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h.clear(y)},se.prototype.setCullFace=function(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))},se.prototype.setDepthMode=function(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)},se.prototype.setStencilMode=function(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)},se.prototype.setColorMode=function(n){p.deepEqual(n.blendFunction,de.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)},se.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ee=function(n){function u(o,h,y){var b=this;n.call(this),this.id=o,this.dispatcher=y,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(b._sourceLoaded=!0),b._sourceLoaded&&!b._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(b.reload(),b.transform&&b.update(b.transform))}),this.on("error",function(){b._sourceErrored=!0}),this._source=function(P,F,H,ae){var xe=new Dr[F.type](P,F,H,ae);if(xe.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+xe.id);return p.bindAll(["load","abort","unload","serialize","prepare"],xe),xe}(o,h,y,this),this._tiles={},this._cache=new ir(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)},u.prototype.onRemove=function(o){this._source&&this._source.onRemove&&this._source.onRemove(o)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var o in this._tiles){var h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(o,h){return this._source.loadTile(o,h)},u.prototype._unloadTile=function(o){if(this._source.unloadTile)return this._source.unloadTile(o,function(){})},u.prototype._abortTile=function(o){if(this._source.abortTile)return this._source.abortTile(o,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(o){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var y=this._tiles[h];y.upload(o),y.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return p.values(this._tiles).map(function(o){return o.tileID}).sort(dt).map(function(o){return o.key})},u.prototype.getRenderableIds=function(o){var h=this,y=[];for(var b in this._tiles)this._isIdRenderable(b,o)&&y.push(this._tiles[b]);return o?y.sort(function(P,F){var H=P.tileID,ae=F.tileID,xe=new p.Point(H.canonical.x,H.canonical.y)._rotate(h.transform.angle),we=new p.Point(ae.canonical.x,ae.canonical.y)._rotate(h.transform.angle);return H.overscaledZ-ae.overscaledZ||we.y-xe.y||we.x-xe.x}).map(function(P){return P.tileID.key}):y.map(function(P){return P.tileID}).sort(dt).map(function(P){return P.key})},u.prototype.hasRenderableParent=function(o){var h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var o in this._cache.reset(),this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")},u.prototype._reloadTile=function(o,h){var y=this._tiles[o];y&&(y.state!=="loading"&&(y.state=h),this._loadTile(y,this._tileLoaded.bind(this,y,o,h)))},u.prototype._tileLoaded=function(o,h,y,b){if(b)return o.state="errored",void(b.status!==404?this._source.fire(new p.ErrorEvent(b,{tile:o})):this.update(this.transform));o.timeAdded=p.browser.now(),y==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:o,coord:o.tileID}))},u.prototype._backfillDEM=function(o){for(var h=this.getRenderableIds(),y=0;y<h.length;y++){var b=h[y];if(o.neighboringTiles&&o.neighboringTiles[b]){var P=this.getTileByID(b);F(o,P),F(P,o)}}function F(H,ae){H.needsHillshadePrepare=!0;var xe=ae.tileID.canonical.x-H.tileID.canonical.x,we=ae.tileID.canonical.y-H.tileID.canonical.y,Te=Math.pow(2,H.tileID.canonical.z),He=ae.tileID.key;xe===0&&we===0||Math.abs(we)>1||(Math.abs(xe)>1&&(Math.abs(xe+Te)===1?xe+=Te:Math.abs(xe-Te)===1&&(xe-=Te)),ae.dem&&H.dem&&(H.dem.backfillBorder(ae.dem,xe,we),H.neighboringTiles&&H.neighboringTiles[He]&&(H.neighboringTiles[He].backfilled=!0)))}},u.prototype.getTile=function(o){return this.getTileByID(o.key)},u.prototype.getTileByID=function(o){return this._tiles[o]},u.prototype._retainLoadedChildren=function(o,h,y,b){for(var P in this._tiles){var F=this._tiles[P];if(!(b[P]||!F.hasData()||F.tileID.overscaledZ<=h||F.tileID.overscaledZ>y)){for(var H=F.tileID;F&&F.tileID.overscaledZ>h+1;){var ae=F.tileID.scaledTo(F.tileID.overscaledZ-1);(F=this._tiles[ae.key])&&F.hasData()&&(H=ae)}for(var xe=H;xe.overscaledZ>h;)if(o[(xe=xe.scaledTo(xe.overscaledZ-1)).key]){b[H.key]=H;break}}}},u.prototype.findLoadedParent=function(o,h){if(o.key in this._loadedParentTiles){var y=this._loadedParentTiles[o.key];return y&&y.tileID.overscaledZ>=h?y:null}for(var b=o.overscaledZ-1;b>=h;b--){var P=o.scaledTo(b),F=this._getLoadedTile(P);if(F)return F}},u.prototype._getLoadedTile=function(o){var h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)},u.prototype.updateCacheSize=function(o){var h=Math.ceil(o.width/this._source.tileSize)+1,y=Math.ceil(o.height/this._source.tileSize)+1,b=Math.floor(h*y*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(P)},u.prototype.handleWrapJump=function(o){var h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){var y={};for(var b in this._tiles){var P=this._tiles[b];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),y[P.tileID.key]=P}for(var F in this._tiles=y,this._timers)clearTimeout(this._timers[F]),delete this._timers[F];for(var H in this._tiles)this._setTileReloadTimer(H,this._tiles[H])}},u.prototype.update=function(o){var h=this;if(this.transform=o,this._sourceLoaded&&!this._paused){var y;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?y=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(zr){return new p.OverscaledTileID(zr.canonical.z,zr.wrap,zr.canonical.z,zr.canonical.x,zr.canonical.y)}):(y=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(y=y.filter(function(zr){return h._source.hasTile(zr)}))):y=[];var b=o.coveringZoomLevel(this._source),P=Math.max(b-u.maxOverzooming,this._source.minzoom),F=Math.max(b+u.maxUnderzooming,this._source.minzoom),H=this._updateRetainedTiles(y,b);if(br(this._source.type)){for(var ae={},xe={},we=0,Te=Object.keys(H);we<Te.length;we+=1){var He=Te[we],je=H[He],it=this._tiles[He];if(it&&!(it.fadeEndTime&&it.fadeEndTime<=p.browser.now())){var ze=this.findLoadedParent(je,P);ze&&(this._addTile(ze.tileID),ae[ze.tileID.key]=ze.tileID),xe[He]=je}}for(var at in this._retainLoadedChildren(xe,b,F,H),ae)H[at]||(this._coveredTiles[at]=!0,H[at]=ae[at])}for(var xt in H)this._tiles[xt].clearFadeHold();for(var jt=0,gr=p.keysDifference(this._tiles,H);jt<gr.length;jt+=1){var lr=gr[jt],_r=this._tiles[lr];_r.hasSymbolBuckets&&!_r.holdingForFade()?_r.setHoldDuration(this.map._fadeDuration):_r.hasSymbolBuckets&&!_r.symbolFadeFinished()||this._removeTile(lr)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)},u.prototype._updateRetainedTiles=function(o,h){for(var y={},b={},P=Math.max(h-u.maxOverzooming,this._source.minzoom),F=Math.max(h+u.maxUnderzooming,this._source.minzoom),H={},ae=0,xe=o;ae<xe.length;ae+=1){var we=xe[ae],Te=this._addTile(we);y[we.key]=we,Te.hasData()||h<this._source.maxzoom&&(H[we.key]=we)}this._retainLoadedChildren(H,h,F,y);for(var He=0,je=o;He<je.length;He+=1){var it=je[He],ze=this._tiles[it.key];if(!ze.hasData()){if(h+1>this._source.maxzoom){var at=it.children(this._source.maxzoom)[0],xt=this.getTile(at);if(xt&&xt.hasData()){y[at.key]=at;continue}}else{var jt=it.children(this._source.maxzoom);if(y[jt[0].key]&&y[jt[1].key]&&y[jt[2].key]&&y[jt[3].key])continue}for(var gr=ze.wasRequested(),lr=it.overscaledZ-1;lr>=P;--lr){var _r=it.scaledTo(lr);if(b[_r.key]||(b[_r.key]=!0,!(ze=this.getTile(_r))&&gr&&(ze=this._addTile(_r)),ze&&(y[_r.key]=_r,gr=ze.wasRequested(),ze.hasData())))break}}}return y},u.prototype._updateLoadedParentTileCache=function(){for(var o in this._loadedParentTiles={},this._tiles){for(var h=[],y=void 0,b=this._tiles[o].tileID;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){y=this._loadedParentTiles[b.key];break}h.push(b.key);var P=b.scaledTo(b.overscaledZ-1);if(y=this._getLoadedTile(P))break;b=P}for(var F=0,H=h;F<H.length;F+=1)this._loadedParentTiles[H[F]]=y}},u.prototype._addTile=function(o){var h=this._tiles[o.key];if(h)return h;(h=this._cache.getAndRemove(o))&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));var y=Boolean(h);return y||(h=new p.Tile(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h?(h.uses++,this._tiles[o.key]=h,y||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(o,h){var y=this;o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);var b=h.getExpiryTimeout();b&&(this._timers[o]=setTimeout(function(){y._reloadTile(o,"expired"),delete y._timers[o]},b))},u.prototype._removeTile=function(o){var h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var o in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(o);this._cache.reset()},u.prototype.tilesIn=function(o,h,y){var b=this,P=[],F=this.transform;if(!F)return P;for(var H=y?F.getCameraQueryGeometry(o):o,ae=o.map(function(lr){return F.pointCoordinate(lr)}),xe=H.map(function(lr){return F.pointCoordinate(lr)}),we=this.getIds(),Te=1/0,He=1/0,je=-1/0,it=-1/0,ze=0,at=xe;ze<at.length;ze+=1){var xt=at[ze];Te=Math.min(Te,xt.x),He=Math.min(He,xt.y),je=Math.max(je,xt.x),it=Math.max(it,xt.y)}for(var jt=function(lr){var _r=b._tiles[we[lr]];if(!_r.holdingForFade()){var zr=_r.tileID,on=Math.pow(2,F.zoom-_r.tileID.overscaledZ),Qr=h*_r.queryPadding*p.EXTENT/_r.tileSize/on,Pn=[zr.getTilePoint(new p.MercatorCoordinate(Te,He)),zr.getTilePoint(new p.MercatorCoordinate(je,it))];if(Pn[0].x-Qr<p.EXTENT&&Pn[0].y-Qr<p.EXTENT&&Pn[1].x+Qr>=0&&Pn[1].y+Qr>=0){var ei=ae.map(function(ti){return zr.getTilePoint(ti)}),ci=xe.map(function(ti){return zr.getTilePoint(ti)});P.push({tile:_r,tileID:zr,queryGeometry:ei,cameraQueryGeometry:ci,scale:on})}}},gr=0;gr<we.length;gr++)jt(gr);return P},u.prototype.getVisibleCoordinates=function(o){for(var h=this,y=this.getRenderableIds(o).map(function(H){return h._tiles[H].tileID}),b=0,P=y;b<P.length;b+=1){var F=P[b];F.posMatrix=this.transform.calculatePosMatrix(F.toUnwrapped())}return y},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(br(this._source.type))for(var o in this._tiles){var h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},u.prototype.setFeatureState=function(o,h,y){this._state.updateState(o=o||"_geojsonTileLayer",h,y)},u.prototype.removeFeatureState=function(o,h,y){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,y)},u.prototype.getFeatureState=function(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(o,h,y){var b=this._tiles[o];b&&b.setDependencies(h,y)},u.prototype.reloadTilesForDependencies=function(o,h){for(var y in this._tiles)this._tiles[y].hasDependency(o,h)&&this._reloadTile(y,"reloading");this._cache.filter(function(b){return!b.hasDependency(o,h)})},u}(p.Evented);function dt(n,u){var o=Math.abs(2*n.wrap)-+(n.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return n.overscaledZ-u.overscaledZ||h-o||u.canonical.y-n.canonical.y||u.canonical.x-n.canonical.x}function br(n){return n==="raster"||n==="image"||n==="video"}function Ht(){return new p.window.Worker(Ku.workerUrl)}Ee.maxOverzooming=10,Ee.maxUnderzooming=3;var Qt="mapboxgl_preloaded_worker_pool",Rr=function(){this.active={}};Rr.prototype.acquire=function(n){if(!this.workers)for(this.workers=[];this.workers.length<Rr.workerCount;)this.workers.push(new Ht);return this.active[n]=!0,this.workers.slice()},Rr.prototype.release=function(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},Rr.prototype.isPreloaded=function(){return!!this.active[Qt]},Rr.prototype.numActive=function(){return Object.keys(this.active).length};var kn,Ln=Math.floor(p.browser.hardwareConcurrency/2);function $t(){return kn||(kn=new Rr),kn}function Cn(n,u){var o={};for(var h in n)h!=="ref"&&(o[h]=n[h]);return p.refProperties.forEach(function(y){y in u&&(o[y]=u[y])}),o}function sn(n){n=n.slice();for(var u=Object.create(null),o=0;o<n.length;o++)u[n[o].id]=n[o];for(var h=0;h<n.length;h++)"ref"in n[h]&&(n[h]=Cn(n[h],u[n[h].ref]));return n}Rr.workerCount=Math.max(Math.min(Ln,6),1);var an={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ii(n,u,o){o.push({command:an.addSource,args:[n,u[n]]})}function xn(n,u,o){u.push({command:an.removeSource,args:[n]}),o[n]=!0}function Ai(n,u,o,h){xn(n,o,h),Ii(n,u,o)}function Qi(n,u,o){var h;for(h in n[o])if(n[o].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[o][h],u[o][h]))return!1;for(h in u[o])if(u[o].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[o][h],u[o][h]))return!1;return!0}function li(n,u,o,h,y,b){var P;for(P in u=u||{},n=n||{})n.hasOwnProperty(P)&&(p.deepEqual(n[P],u[P])||o.push({command:b,args:[h,P,u[P],y]}));for(P in u)u.hasOwnProperty(P)&&!n.hasOwnProperty(P)&&(p.deepEqual(n[P],u[P])||o.push({command:b,args:[h,P,u[P],y]}))}function Yi(n){return n.id}function Bi(n,u){return n[u.id]=u,n}var wi=function(n,u){this.reset(n,u)};wi.prototype.reset=function(n,u){this.points=n||[],this._distances=[0];for(var o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},wi.prototype.lerp=function(n){if(this.points.length===1)return this.points[0];n=p.clamp(n,0,1);for(var u=1,o=this._distances[u],h=n*this.paddedLength+this.padding;o<h&&u<this._distances.length;)o=this._distances[++u];var y=u-1,b=this._distances[y],P=o-b,F=P>0?(h-b)/P:0;return this.points[y].mult(1-F).add(this.points[u].mult(F))};var sa=function(n,u,o){var h=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(n/o),this.yCellCount=Math.ceil(u/o);for(var b=0;b<this.xCellCount*this.yCellCount;b++)h.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function Fi(n,u,o,h,y){var b=p.create();return u?(p.scale(b,b,[1/y,1/y,1]),o||p.rotateZ(b,b,h.angle)):p.multiply(b,h.labelPlaneMatrix,n),b}function ni(n,u,o,h,y){if(u){var b=p.clone(n);return p.scale(b,b,[y,y,1]),o||p.rotateZ(b,b,-h.angle),b}return h.glCoordMatrix}function Di(n,u){var o=[n.x,n.y,0,1];Wa(o,o,u);var h=o[3];return{point:new p.Point(o[0]/h,o[1]/h),signedDistanceFromCamera:h}}function Ei(n,u){return .5+n/u*.5}function no(n,u){var o=n[0]/n[3],h=n[1]/n[3];return o>=-u[0]&&o<=u[0]&&h>=-u[1]&&h<=u[1]}function ho(n,u,o,h,y,b,P,F){var H=h?n.textSizeData:n.iconSizeData,ae=p.evaluateSizeForZoom(H,o.transform.zoom),xe=[256/o.width*2+1,256/o.height*2+1],we=h?n.text.dynamicLayoutVertexArray:n.icon.dynamicLayoutVertexArray;we.clear();for(var Te=n.lineVertexArray,He=h?n.text.placedSymbolArray:n.icon.placedSymbolArray,je=o.transform.width/o.transform.height,it=!1,ze=0;ze<He.length;ze++){var at=He.get(ze);if(at.hidden||at.writingMode===p.WritingMode.vertical&&!it)Gi(at.numGlyphs,we);else{it=!1;var xt=[at.anchorX,at.anchorY,0,1];if(p.transformMat4(xt,xt,u),no(xt,xe)){var jt=Ei(o.transform.cameraToCenterDistance,xt[3]),gr=p.evaluateSizeForFeature(H,ae,at),lr=P?gr/jt:gr*jt,_r=new p.Point(at.anchorX,at.anchorY),zr=Di(_r,y).point,on={},Qr=Ns(at,lr,!1,F,u,y,b,n.glyphOffsetArray,Te,we,zr,_r,on,je);it=Qr.useVertical,(Qr.notEnoughRoom||it||Qr.needsFlipping&&Ns(at,lr,!0,F,u,y,b,n.glyphOffsetArray,Te,we,zr,_r,on,je).notEnoughRoom)&&Gi(at.numGlyphs,we)}else Gi(at.numGlyphs,we)}}h?n.text.dynamicLayoutVertexBuffer.updateData(we):n.icon.dynamicLayoutVertexBuffer.updateData(we)}function ta(n,u,o,h,y,b,P,F,H,ae,xe){var we=F.glyphStartIndex+F.numGlyphs,Te=F.lineStartIndex,He=F.lineStartIndex+F.lineLength,je=u.getoffsetX(F.glyphStartIndex),it=u.getoffsetX(we-1),ze=Aa(n*je,o,h,y,b,P,F.segment,Te,He,H,ae,xe);if(!ze)return null;var at=Aa(n*it,o,h,y,b,P,F.segment,Te,He,H,ae,xe);return at?{first:ze,last:at}:null}function Vi(n,u,o,h){return n===p.WritingMode.horizontal&&Math.abs(o.y-u.y)>Math.abs(o.x-u.x)*h?{useVertical:!0}:(n===p.WritingMode.vertical?u.y<o.y:u.x>o.x)?{needsFlipping:!0}:null}function Ns(n,u,o,h,y,b,P,F,H,ae,xe,we,Te,He){var je,it=u/24,ze=n.lineOffsetX*it,at=n.lineOffsetY*it;if(n.numGlyphs>1){var xt=n.glyphStartIndex+n.numGlyphs,jt=n.lineStartIndex,gr=n.lineStartIndex+n.lineLength,lr=ta(it,F,ze,at,o,xe,we,n,H,b,Te);if(!lr)return{notEnoughRoom:!0};var _r=Di(lr.first.point,P).point,zr=Di(lr.last.point,P).point;if(h&&!o){var on=Vi(n.writingMode,_r,zr,He);if(on)return on}je=[lr.first];for(var Qr=n.glyphStartIndex+1;Qr<xt-1;Qr++)je.push(Aa(it*F.getoffsetX(Qr),ze,at,o,xe,we,n.segment,jt,gr,H,b,Te));je.push(lr.last)}else{if(h&&!o){var Pn=Di(we,y).point,ei=n.lineStartIndex+n.segment+1,ci=new p.Point(H.getx(ei),H.gety(ei)),ti=Di(ci,y),aa=ti.signedDistanceFromCamera>0?ti.point:tu(we,ci,Pn,1,y),jn=Vi(n.writingMode,Pn,aa,He);if(jn)return jn}var xi=Aa(it*F.getoffsetX(n.glyphStartIndex),ze,at,o,xe,we,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,H,b,Te);if(!xi)return{notEnoughRoom:!0};je=[xi]}for(var zi=0,J=je;zi<J.length;zi+=1){var Q=J[zi];p.addDynamicAttributes(ae,Q.point,Q.angle)}return{}}function tu(n,u,o,h,y){var b=Di(n.add(n.sub(u)._unit()),y).point,P=o.sub(b);return o.add(P._mult(h/P.mag()))}function Aa(n,u,o,h,y,b,P,F,H,ae,xe,we){var Te=h?n-u:n+u,He=Te>0?1:-1,je=0;h&&(He*=-1,je=Math.PI),He<0&&(je+=Math.PI);for(var it=He>0?F+P:F+P+1,ze=y,at=y,xt=0,jt=0,gr=Math.abs(Te),lr=[];xt+jt<=gr;){if((it+=He)<F||it>=H)return null;if(at=ze,lr.push(ze),(ze=we[it])===void 0){var _r=new p.Point(ae.getx(it),ae.gety(it)),zr=Di(_r,xe);if(zr.signedDistanceFromCamera>0)ze=we[it]=zr.point;else{var on=it-He;ze=tu(xt===0?b:new p.Point(ae.getx(on),ae.gety(on)),_r,at,gr-xt+1,xe)}}xt+=jt,jt=at.dist(ze)}var Qr=(gr-xt)/jt,Pn=ze.sub(at),ei=Pn.mult(Qr)._add(at);ei._add(Pn._unit()._perp()._mult(o*He));var ci=je+Math.atan2(ze.y-at.y,ze.x-at.x);return lr.push(ei),{point:ei,angle:ci,path:lr}}sa.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},sa.prototype.insert=function(n,u,o,h,y){this._forEachCell(u,o,h,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(y)},sa.prototype.insertCircle=function(n,u,o,h){this._forEachCell(u-h,o-h,u+h,o+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(o),this.circles.push(h)},sa.prototype._insertBoxCell=function(n,u,o,h,y,b){this.boxCells[y].push(b)},sa.prototype._insertCircleCell=function(n,u,o,h,y,b){this.circleCells[y].push(b)},sa.prototype._query=function(n,u,o,h,y,b){if(o<0||n>this.width||h<0||u>this.height)return!y&&[];var P=[];if(n<=0&&u<=0&&this.width<=o&&this.height<=h){if(y)return!0;for(var F=0;F<this.boxKeys.length;F++)P.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(var H=0;H<this.circleKeys.length;H++){var ae=this.circles[3*H],xe=this.circles[3*H+1],we=this.circles[3*H+2];P.push({key:this.circleKeys[H],x1:ae-we,y1:xe-we,x2:ae+we,y2:xe+we})}return b?P.filter(b):P}return this._forEachCell(n,u,o,h,this._queryCell,P,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?P.length>0:P},sa.prototype._queryCircle=function(n,u,o,h,y){var b=n-o,P=n+o,F=u-o,H=u+o;if(P<0||b>this.width||H<0||F>this.height)return!h&&[];var ae=[];return this._forEachCell(b,F,P,H,this._queryCellCircle,ae,{hitTest:h,circle:{x:n,y:u,radius:o},seenUids:{box:{},circle:{}}},y),h?ae.length>0:ae},sa.prototype.query=function(n,u,o,h,y){return this._query(n,u,o,h,!1,y)},sa.prototype.hitTest=function(n,u,o,h,y){return this._query(n,u,o,h,!0,y)},sa.prototype.hitTestCircle=function(n,u,o,h){return this._queryCircle(n,u,o,!0,h)},sa.prototype._queryCell=function(n,u,o,h,y,b,P,F){var H=P.seenUids,ae=this.boxCells[y];if(ae!==null)for(var xe=this.bboxes,we=0,Te=ae;we<Te.length;we+=1){var He=Te[we];if(!H.box[He]){H.box[He]=!0;var je=4*He;if(n<=xe[je+2]&&u<=xe[je+3]&&o>=xe[je+0]&&h>=xe[je+1]&&(!F||F(this.boxKeys[He]))){if(P.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[He],x1:xe[je],y1:xe[je+1],x2:xe[je+2],y2:xe[je+3]})}}}var it=this.circleCells[y];if(it!==null)for(var ze=this.circles,at=0,xt=it;at<xt.length;at+=1){var jt=xt[at];if(!H.circle[jt]){H.circle[jt]=!0;var gr=3*jt;if(this._circleAndRectCollide(ze[gr],ze[gr+1],ze[gr+2],n,u,o,h)&&(!F||F(this.circleKeys[jt]))){if(P.hitTest)return b.push(!0),!0;var lr=ze[gr],_r=ze[gr+1],zr=ze[gr+2];b.push({key:this.circleKeys[jt],x1:lr-zr,y1:_r-zr,x2:lr+zr,y2:_r+zr})}}}},sa.prototype._queryCellCircle=function(n,u,o,h,y,b,P,F){var H=P.circle,ae=P.seenUids,xe=this.boxCells[y];if(xe!==null)for(var we=this.bboxes,Te=0,He=xe;Te<He.length;Te+=1){var je=He[Te];if(!ae.box[je]){ae.box[je]=!0;var it=4*je;if(this._circleAndRectCollide(H.x,H.y,H.radius,we[it+0],we[it+1],we[it+2],we[it+3])&&(!F||F(this.boxKeys[je])))return b.push(!0),!0}}var ze=this.circleCells[y];if(ze!==null)for(var at=this.circles,xt=0,jt=ze;xt<jt.length;xt+=1){var gr=jt[xt];if(!ae.circle[gr]){ae.circle[gr]=!0;var lr=3*gr;if(this._circlesCollide(at[lr],at[lr+1],at[lr+2],H.x,H.y,H.radius)&&(!F||F(this.circleKeys[gr])))return b.push(!0),!0}}},sa.prototype._forEachCell=function(n,u,o,h,y,b,P,F){for(var H=this._convertToXCellCoord(n),ae=this._convertToYCellCoord(u),xe=this._convertToXCellCoord(o),we=this._convertToYCellCoord(h),Te=H;Te<=xe;Te++)for(var He=ae;He<=we;He++)if(y.call(this,n,u,o,h,this.xCellCount*He+Te,b,P,F))return},sa.prototype._convertToXCellCoord=function(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))},sa.prototype._convertToYCellCoord=function(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))},sa.prototype._circlesCollide=function(n,u,o,h,y,b){var P=h-n,F=y-u,H=o+b;return H*H>P*P+F*F},sa.prototype._circleAndRectCollide=function(n,u,o,h,y,b,P){var F=(b-h)/2,H=Math.abs(n-(h+F));if(H>F+o)return!1;var ae=(P-y)/2,xe=Math.abs(u-(y+ae));if(xe>ae+o)return!1;if(H<=F||xe<=ae)return!0;var we=H-F,Te=xe-ae;return we*we+Te*Te<=o*o};var No=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Gi(n,u){for(var o=0;o<n;o++){var h=u.length;u.resize(h+4),u.float32.set(No,3*h)}}function Wa(n,u,o){var h=u[0],y=u[1];return n[0]=o[0]*h+o[4]*y+o[12],n[1]=o[1]*h+o[5]*y+o[13],n[3]=o[3]*h+o[7]*y+o[15],n}var oo=function(n,u,o){u===void 0&&(u=new sa(n.width+200,n.height+200,25)),o===void 0&&(o=new sa(n.width+200,n.height+200,25)),this.transform=n,this.grid=u,this.ignoredGrid=o,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+100,this.screenBottomBoundary=n.height+100,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200};function ma(n,u,o){return u*(p.EXTENT/(n.tileSize*Math.pow(2,o-n.tileID.overscaledZ)))}oo.prototype.placeCollisionBox=function(n,u,o,h,y){var b=this.projectAndGetPerspectiveRatio(h,n.anchorPointX,n.anchorPointY),P=o*b.perspectiveRatio,F=n.x1*P+b.point.x,H=n.y1*P+b.point.y,ae=n.x2*P+b.point.x,xe=n.y2*P+b.point.y;return!this.isInsideGrid(F,H,ae,xe)||!u&&this.grid.hitTest(F,H,ae,xe,y)?{box:[],offscreen:!1}:{box:[F,H,ae,xe],offscreen:this.isOffscreen(F,H,ae,xe)}},oo.prototype.placeCollisionCircles=function(n,u,o,h,y,b,P,F,H,ae,xe,we,Te){var He=[],je=new p.Point(u.anchorX,u.anchorY),it=Di(je,b),ze=Ei(this.transform.cameraToCenterDistance,it.signedDistanceFromCamera),at=(ae?y/ze:y*ze)/p.ONE_EM,xt=Di(je,P).point,jt=ta(at,h,u.lineOffsetX*at,u.lineOffsetY*at,!1,xt,je,u,o,P,{}),gr=!1,lr=!1,_r=!0;if(jt){for(var zr=.5*we*ze+Te,on=new p.Point(-100,-100),Qr=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),Pn=new wi,ei=jt.first,ci=jt.last,ti=[],aa=ei.path.length-1;aa>=1;aa--)ti.push(ei.path[aa]);for(var jn=1;jn<ci.path.length;jn++)ti.push(ci.path[jn]);var xi=2.5*zr;if(F){var zi=ti.map(function(Hi){return Di(Hi,F)});ti=zi.some(function(Hi){return Hi.signedDistanceFromCamera<=0})?[]:zi.map(function(Hi){return Hi.point})}var J=[];if(ti.length>0){for(var Q=ti[0].clone(),D=ti[0].clone(),k=1;k<ti.length;k++)Q.x=Math.min(Q.x,ti[k].x),Q.y=Math.min(Q.y,ti[k].y),D.x=Math.max(D.x,ti[k].x),D.y=Math.max(D.y,ti[k].y);J=Q.x>=on.x&&D.x<=Qr.x&&Q.y>=on.y&&D.y<=Qr.y?[ti]:D.x<on.x||Q.x>Qr.x||D.y<on.y||Q.y>Qr.y?[]:p.clipLine([ti],on.x,on.y,Qr.x,Qr.y)}for(var te=0,Ce=J;te<Ce.length;te+=1){var st;Pn.reset(Ce[te],.25*zr),st=Pn.length<=.5*zr?1:Math.ceil(Pn.paddedLength/xi)+1;for(var Bt=0;Bt<st;Bt++){var bt=Bt/Math.max(st-1,1),Kt=Pn.lerp(bt),Ir=Kt.x+100,Fn=Kt.y+100;He.push(Ir,Fn,zr,0);var Nn=Ir-zr,fi=Fn-zr,si=Ir+zr,yi=Fn+zr;if(_r=_r&&this.isOffscreen(Nn,fi,si,yi),lr=lr||this.isInsideGrid(Nn,fi,si,yi),!n&&this.grid.hitTestCircle(Ir,Fn,zr,xe)&&(gr=!0,!H))return{circles:[],offscreen:!1,collisionDetected:gr}}}}return{circles:!H&&gr||!lr?[]:He,offscreen:_r,collisionDetected:gr}},oo.prototype.queryRenderedSymbols=function(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],o=1/0,h=1/0,y=-1/0,b=-1/0,P=0,F=n;P<F.length;P+=1){var H=F[P],ae=new p.Point(H.x+100,H.y+100);o=Math.min(o,ae.x),h=Math.min(h,ae.y),y=Math.max(y,ae.x),b=Math.max(b,ae.y),u.push(ae)}for(var xe={},we={},Te=0,He=this.grid.query(o,h,y,b).concat(this.ignoredGrid.query(o,h,y,b));Te<He.length;Te+=1){var je=He[Te],it=je.key;if(xe[it.bucketInstanceId]===void 0&&(xe[it.bucketInstanceId]={}),!xe[it.bucketInstanceId][it.featureIndex]){var ze=[new p.Point(je.x1,je.y1),new p.Point(je.x2,je.y1),new p.Point(je.x2,je.y2),new p.Point(je.x1,je.y2)];p.polygonIntersectsPolygon(u,ze)&&(xe[it.bucketInstanceId][it.featureIndex]=!0,we[it.bucketInstanceId]===void 0&&(we[it.bucketInstanceId]=[]),we[it.bucketInstanceId].push(it.featureIndex))}}return we},oo.prototype.insertCollisionBox=function(n,u,o,h,y){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:h,collisionGroupID:y},n[0],n[1],n[2],n[3])},oo.prototype.insertCollisionCircles=function(n,u,o,h,y){for(var b=u?this.ignoredGrid:this.grid,P={bucketInstanceId:o,featureIndex:h,collisionGroupID:y},F=0;F<n.length;F+=4)b.insertCircle(P,n[F],n[F+1],n[F+2])},oo.prototype.projectAndGetPerspectiveRatio=function(n,u,o){var h=[u,o,0,1];return Wa(h,h,n),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},oo.prototype.isOffscreen=function(n,u,o,h){return o<100||n>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},oo.prototype.isInsideGrid=function(n,u,o,h){return o>=0&&n<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},oo.prototype.getViewportMatrix=function(){var n=p.identity([]);return p.translate(n,n,[-100,-100,0]),n};var Lo=function(n,u,o,h){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):h&&o?1:0,this.placed=o};Lo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var ka=function(n,u,o,h,y){this.text=new Lo(n?n.text:null,u,o,y),this.icon=new Lo(n?n.icon:null,u,h,y)};ka.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var bs=function(n,u,o){this.text=n,this.icon=u,this.skipFade=o},ki=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},Ko=function(n,u,o,h,y){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=o,this.bucketIndex=h,this.tileID=y},ga=function(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}};function po(n,u,o,h,y){var b=p.getAnchorAlignment(n),P=-(b.horizontalAlign-.5)*u,F=-(b.verticalAlign-.5)*o,H=p.evaluateVariableOffset(n,h);return new p.Point(P+H[0]*y,F+H[1]*y)}function Da(n,u,o,h,y,b){var P=n.x1,F=n.x2,H=n.y1,ae=n.y2,xe=n.anchorPointX,we=n.anchorPointY,Te=new p.Point(u,o);return h&&Te._rotate(y?b:-b),{x1:P+Te.x,y1:H+Te.y,x2:F+Te.x,y2:ae+Te.y,anchorPointX:xe,anchorPointY:we}}ga.prototype.get=function(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){var u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:function(o){return o.collisionGroupID===u}}}return this.collisionGroups[n]};var So=function(n,u,o,h){this.transform=n.clone(),this.collisionIndex=new oo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ga(o),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function ye(n,u,o,h,y){n.emplaceBack(u?1:0,o?1:0,h||0,y||0),n.emplaceBack(u?1:0,o?1:0,h||0,y||0),n.emplaceBack(u?1:0,o?1:0,h||0,y||0),n.emplaceBack(u?1:0,o?1:0,h||0,y||0)}So.prototype.getBucketParts=function(n,u,o,h){var y=o.getBucket(u),b=o.latestFeatureIndex;if(y&&b&&u.id===y.layerIds[0]){var P=o.collisionBoxArray,F=y.layers[0].layout,H=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),ae=o.tileSize/p.EXTENT,xe=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),we=F.get("text-pitch-alignment")==="map",Te=F.get("text-rotation-alignment")==="map",He=ma(o,1,this.transform.zoom),je=Fi(xe,we,Te,this.transform,He),it=null;if(we){var ze=ni(xe,we,Te,this.transform,He);it=p.multiply([],this.transform.labelPlaneMatrix,ze)}this.retainedQueryData[y.bucketInstanceId]=new Ko(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,o.tileID);var at={bucket:y,layout:F,posMatrix:xe,textLabelPlaneMatrix:je,labelToScreenMatrix:it,scale:H,textPixelRatio:ae,holdingForFade:o.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(h)for(var xt=0,jt=y.sortKeyRanges;xt<jt.length;xt+=1){var gr=jt[xt];n.push({sortKey:gr.sortKey,symbolInstanceStart:gr.symbolInstanceStart,symbolInstanceEnd:gr.symbolInstanceEnd,parameters:at})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:at})}},So.prototype.attemptAnchorPlacement=function(n,u,o,h,y,b,P,F,H,ae,xe,we,Te,He,je){var it,ze=[we.textOffset0,we.textOffset1],at=po(n,o,h,ze,y),xt=this.collisionIndex.placeCollisionBox(Da(u,at.x,at.y,b,P,this.transform.angle),xe,F,H,ae.predicate);if(!je||this.collisionIndex.placeCollisionBox(Da(je,at.x,at.y,b,P,this.transform.angle),xe,F,H,ae.predicate).box.length!==0)return xt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID].text&&(it=this.prevPlacement.variableOffsets[we.crossTileID].anchor),this.variableOffsets[we.crossTileID]={textOffset:ze,width:o,height:h,anchor:n,textBoxScale:y,prevAnchor:it},this.markUsedJustification(Te,n,we,He),Te.allowVerticalPlacement&&(this.markUsedOrientation(Te,He,we),this.placedOrientations[we.crossTileID]=He),{shift:at,placedGlyphBoxes:xt}):void 0},So.prototype.placeLayerBucketPart=function(n,u,o){var h=this,y=n.parameters,b=y.bucket,P=y.layout,F=y.posMatrix,H=y.textLabelPlaneMatrix,ae=y.labelToScreenMatrix,xe=y.textPixelRatio,we=y.holdingForFade,Te=y.collisionBoxArray,He=y.partiallyEvaluatedTextSize,je=y.collisionGroup,it=P.get("text-optional"),ze=P.get("icon-optional"),at=P.get("text-allow-overlap"),xt=P.get("icon-allow-overlap"),jt=P.get("text-rotation-alignment")==="map",gr=P.get("text-pitch-alignment")==="map",lr=P.get("icon-text-fit")!=="none",_r=P.get("symbol-z-order")==="viewport-y",zr=at&&(xt||!b.hasIconData()||ze),on=xt&&(at||!b.hasTextData()||it);!b.collisionArrays&&Te&&b.deserializeCollisionBoxes(Te);var Qr=function(jn,xi){if(!u[jn.crossTileID])if(we)h.placements[jn.crossTileID]=new bs(!1,!1,!1);else{var zi,J=!1,Q=!1,D=!0,k=null,te={box:null,offscreen:null},Ce={box:null,offscreen:null},st=null,Bt=null,bt=0,Kt=0,Ir=0;xi.textFeatureIndex?bt=xi.textFeatureIndex:jn.useRuntimeCollisionCircles&&(bt=jn.featureIndex),xi.verticalTextFeatureIndex&&(Kt=xi.verticalTextFeatureIndex);var Fn=xi.textBox;if(Fn){var Nn=function(Ui){var $o=p.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Ui&&h.prevPlacement){var Po=h.prevPlacement.placedOrientations[jn.crossTileID];Po&&(h.placedOrientations[jn.crossTileID]=Po,h.markUsedOrientation(b,$o=Po,jn))}return $o},fi=function(Ui,$o){if(b.allowVerticalPlacement&&jn.numVerticalGlyphVertices>0&&xi.verticalTextBox)for(var Po=0,Ao=b.writingModes;Po<Ao.length&&(Ao[Po]===p.WritingMode.vertical?(te=$o(),Ce=te):te=Ui(),!(te&&te.box&&te.box.length));Po+=1);else te=Ui()};if(P.get("text-variable-anchor")){var si=P.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[jn.crossTileID]){var yi=h.prevPlacement.variableOffsets[jn.crossTileID];si.indexOf(yi.anchor)>0&&(si=si.filter(function(Ui){return Ui!==yi.anchor})).unshift(yi.anchor)}var Hi=function(Ui,$o,Po){for(var Ao=Ui.x2-Ui.x1,Tc=Ui.y2-Ui.y1,ku=jn.textBoxScale,$u=lr&&!xt?$o:null,Ju={box:[],offscreen:!1},Ll=at?2*si.length:si.length,Qu=0;Qu<Ll;++Qu){var dl=h.attemptAnchorPlacement(si[Qu%si.length],Ui,Ao,Tc,ku,jt,gr,xe,F,je,Qu>=si.length,jn,b,Po,$u);if(dl&&(Ju=dl.placedGlyphBoxes)&&Ju.box&&Ju.box.length){J=!0,k=dl.shift;break}}return Ju};fi(function(){return Hi(Fn,xi.iconBox,p.WritingMode.horizontal)},function(){var Ui=xi.verticalTextBox;return b.allowVerticalPlacement&&!(te&&te.box&&te.box.length)&&jn.numVerticalGlyphVertices>0&&Ui?Hi(Ui,xi.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),te&&(J=te.box,D=te.offscreen);var ya=Nn(te&&te.box);if(!J&&h.prevPlacement){var _a=h.prevPlacement.variableOffsets[jn.crossTileID];_a&&(h.variableOffsets[jn.crossTileID]=_a,h.markUsedJustification(b,_a.anchor,jn,ya))}}else{var Ka=function(Ui,$o){var Po=h.collisionIndex.placeCollisionBox(Ui,at,xe,F,je.predicate);return Po&&Po.box&&Po.box.length&&(h.markUsedOrientation(b,$o,jn),h.placedOrientations[jn.crossTileID]=$o),Po};fi(function(){return Ka(Fn,p.WritingMode.horizontal)},function(){var Ui=xi.verticalTextBox;return b.allowVerticalPlacement&&jn.numVerticalGlyphVertices>0&&Ui?Ka(Ui,p.WritingMode.vertical):{box:null,offscreen:null}}),Nn(te&&te.box&&te.box.length)}}if(J=(zi=te)&&zi.box&&zi.box.length>0,D=zi&&zi.offscreen,jn.useRuntimeCollisionCircles){var Ba=b.text.placedSymbolArray.get(jn.centerJustifiedTextSymbolIndex),wo=p.evaluateSizeForFeature(b.textSizeData,He,Ba),La=P.get("text-padding");st=h.collisionIndex.placeCollisionCircles(at,Ba,b.lineVertexArray,b.glyphOffsetArray,wo,F,H,ae,o,gr,je.predicate,jn.collisionCircleDiameter,La),J=at||st.circles.length>0&&!st.collisionDetected,D=D&&st.offscreen}if(xi.iconFeatureIndex&&(Ir=xi.iconFeatureIndex),xi.iconBox){var Sa=function(Ui){var $o=lr&&k?Da(Ui,k.x,k.y,jt,gr,h.transform.angle):Ui;return h.collisionIndex.placeCollisionBox($o,xt,xe,F,je.predicate)};Q=Ce&&Ce.box&&Ce.box.length&&xi.verticalIconBox?(Bt=Sa(xi.verticalIconBox)).box.length>0:(Bt=Sa(xi.iconBox)).box.length>0,D=D&&Bt.offscreen}var la=it||jn.numHorizontalGlyphVertices===0&&jn.numVerticalGlyphVertices===0,va=ze||jn.numIconVertices===0;if(la||va?va?la||(Q=Q&&J):J=Q&&J:Q=J=Q&&J,J&&zi&&zi.box&&h.collisionIndex.insertCollisionBox(zi.box,P.get("text-ignore-placement"),b.bucketInstanceId,Ce&&Ce.box&&Kt?Kt:bt,je.ID),Q&&Bt&&h.collisionIndex.insertCollisionBox(Bt.box,P.get("icon-ignore-placement"),b.bucketInstanceId,Ir,je.ID),st&&(J&&h.collisionIndex.insertCollisionCircles(st.circles,P.get("text-ignore-placement"),b.bucketInstanceId,bt,je.ID),o)){var Ga=b.bucketInstanceId,Na=h.collisionCircleArrays[Ga];Na===void 0&&(Na=h.collisionCircleArrays[Ga]=new ki);for(var ko=0;ko<st.circles.length;ko+=4)Na.circles.push(st.circles[ko+0]),Na.circles.push(st.circles[ko+1]),Na.circles.push(st.circles[ko+2]),Na.circles.push(st.collisionDetected?1:0)}h.placements[jn.crossTileID]=new bs(J||zr,Q||on,D||b.justReloaded),u[jn.crossTileID]=!0}};if(_r)for(var Pn=b.getSortedSymbolIndexes(this.transform.angle),ei=Pn.length-1;ei>=0;--ei){var ci=Pn[ei];Qr(b.symbolInstances.get(ci),b.collisionArrays[ci])}else for(var ti=n.symbolInstanceStart;ti<n.symbolInstanceEnd;ti++)Qr(b.symbolInstances.get(ti),b.collisionArrays[ti]);if(o&&b.bucketInstanceId in this.collisionCircleArrays){var aa=this.collisionCircleArrays[b.bucketInstanceId];p.invert(aa.invProjMatrix,F),aa.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1},So.prototype.markUsedJustification=function(n,u,o,h){var y;y=h===p.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];for(var b=0,P=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];b<P.length;b+=1){var F=P[b];F>=0&&(n.text.placedSymbolArray.get(F).crossTileID=y>=0&&F!==y?0:o.crossTileID)}},So.prototype.markUsedOrientation=function(n,u,o){for(var h=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,y=u===p.WritingMode.vertical?u:0,b=0,P=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];b<P.length;b+=1)n.text.placedSymbolArray.get(P[b]).placedOrientation=h;o.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=y)},So.prototype.commit=function(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,o=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(n):1,y=u?u.opacities:{},b=u?u.variableOffsets:{},P=u?u.placedOrientations:{};for(var F in this.placements){var H=this.placements[F],ae=y[F];ae?(this.opacities[F]=new ka(ae,h,H.text,H.icon),o=o||H.text!==ae.text.placed||H.icon!==ae.icon.placed):(this.opacities[F]=new ka(null,h,H.text,H.icon,H.skipFade),o=o||H.text||H.icon)}for(var xe in y){var we=y[xe];if(!this.opacities[xe]){var Te=new ka(we,h,!1,!1);Te.isHidden()||(this.opacities[xe]=Te,o=o||we.text.placed||we.icon.placed)}}for(var He in b)this.variableOffsets[He]||!this.opacities[He]||this.opacities[He].isHidden()||(this.variableOffsets[He]=b[He]);for(var je in P)this.placedOrientations[je]||!this.opacities[je]||this.opacities[je].isHidden()||(this.placedOrientations[je]=P[je]);o?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)},So.prototype.updateLayerOpacities=function(n,u){for(var o={},h=0,y=u;h<y.length;h+=1){var b=y[h],P=b.getBucket(n);P&&b.latestFeatureIndex&&n.id===P.layerIds[0]&&this.updateBucketOpacities(P,o,b.collisionBoxArray)}},So.prototype.updateBucketOpacities=function(n,u,o){var h=this;n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();var y=n.layers[0].layout,b=new ka(null,0,!1,!1,!0),P=y.get("text-allow-overlap"),F=y.get("icon-allow-overlap"),H=y.get("text-variable-anchor"),ae=y.get("text-rotation-alignment")==="map",xe=y.get("text-pitch-alignment")==="map",we=y.get("icon-text-fit")!=="none",Te=new ka(null,0,P&&(F||!n.hasIconData()||y.get("icon-optional")),F&&(P||!n.hasTextData()||y.get("text-optional")),!0);!n.collisionArrays&&o&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(o);for(var He=function(at,xt,jt){for(var gr=0;gr<xt/4;gr++)at.opacityVertexArray.emplaceBack(jt)},je=function(at){var xt=n.symbolInstances.get(at),jt=xt.numHorizontalGlyphVertices,gr=xt.numVerticalGlyphVertices,lr=xt.crossTileID,_r=h.opacities[lr];u[lr]?_r=b:_r||(h.opacities[lr]=_r=Te),u[lr]=!0;var zr=xt.numIconVertices>0,on=h.placedOrientations[xt.crossTileID],Qr=on===p.WritingMode.vertical,Pn=on===p.WritingMode.horizontal||on===p.WritingMode.horizontalOnly;if(jt>0||gr>0){var ei=vo(_r.text);He(n.text,jt,Qr?so:ei),He(n.text,gr,Pn?so:ei);var ci=_r.text.isHidden();[xt.rightJustifiedTextSymbolIndex,xt.centerJustifiedTextSymbolIndex,xt.leftJustifiedTextSymbolIndex].forEach(function(te){te>=0&&(n.text.placedSymbolArray.get(te).hidden=ci||Qr?1:0)}),xt.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(xt.verticalPlacedTextSymbolIndex).hidden=ci||Pn?1:0);var ti=h.variableOffsets[xt.crossTileID];ti&&h.markUsedJustification(n,ti.anchor,xt,on);var aa=h.placedOrientations[xt.crossTileID];aa&&(h.markUsedJustification(n,"left",xt,aa),h.markUsedOrientation(n,aa,xt))}if(zr){var jn=vo(_r.icon),xi=!(we&&xt.verticalPlacedIconSymbolIndex&&Qr);xt.placedIconSymbolIndex>=0&&(He(n.icon,xt.numIconVertices,xi?jn:so),n.icon.placedSymbolArray.get(xt.placedIconSymbolIndex).hidden=_r.icon.isHidden()),xt.verticalPlacedIconSymbolIndex>=0&&(He(n.icon,xt.numVerticalIconVertices,xi?so:jn),n.icon.placedSymbolArray.get(xt.verticalPlacedIconSymbolIndex).hidden=_r.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){var zi=n.collisionArrays[at];if(zi){var J=new p.Point(0,0);if(zi.textBox||zi.verticalTextBox){var Q=!0;if(H){var D=h.variableOffsets[lr];D?(J=po(D.anchor,D.width,D.height,D.textOffset,D.textBoxScale),ae&&J._rotate(xe?h.transform.angle:-h.transform.angle)):Q=!1}zi.textBox&&ye(n.textCollisionBox.collisionVertexArray,_r.text.placed,!Q||Qr,J.x,J.y),zi.verticalTextBox&&ye(n.textCollisionBox.collisionVertexArray,_r.text.placed,!Q||Pn,J.x,J.y)}var k=Boolean(!Pn&&zi.verticalIconBox);zi.iconBox&&ye(n.iconCollisionBox.collisionVertexArray,_r.icon.placed,k,we?J.x:0,we?J.y:0),zi.verticalIconBox&&ye(n.iconCollisionBox.collisionVertexArray,_r.icon.placed,!k,we?J.x:0,we?J.y:0)}}},it=0;it<n.symbolInstances.length;it++)je(it);if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){var ze=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ze.invProjMatrix,n.placementViewportMatrix=ze.viewportMatrix,n.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}},So.prototype.symbolFadeChange=function(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},So.prototype.zoomAdjustment=function(n){return Math.max(0,(this.transform.zoom-n)/1.5)},So.prototype.hasTransitions=function(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration},So.prototype.stillRecent=function(n,u){var o=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*o>n},So.prototype.setStale=function(){this.stale=!0};var De=Math.pow(2,25),ct=Math.pow(2,24),Yt=Math.pow(2,17),Wr=Math.pow(2,16),Qn=Math.pow(2,9),Si=Math.pow(2,8),Za=Math.pow(2,1);function vo(n){if(n.opacity===0&&!n.placed)return 0;if(n.opacity===1&&n.placed)return 4294967295;var u=n.placed?1:0,o=Math.floor(127*n.opacity);return o*De+u*ct+o*Yt+u*Wr+o*Qn+u*Si+o*Za+u}var so=0,es=function(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};es.prototype.continuePlacement=function(n,u,o,h,y){for(var b=this._bucketParts;this._currentTileIndex<n.length;)if(u.getBucketParts(b,h,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort(function(P,F){return P.sortKey-F.sortKey}));this._currentPartIndex<b.length;)if(u.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,y())return!0;return!1};var Hs=function(n,u,o,h,y,b,P){this.placement=new So(n,y,b,P),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=h,this._done=!1};Hs.prototype.isDone=function(){return this._done},Hs.prototype.continuePlacement=function(n,u,o){for(var h=this,y=p.browser.now(),b=function(){var H=p.browser.now()-y;return!h._forceFullPlacement&&H>2};this._currentPlacementIndex>=0;){var P=u[n[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=F)&&(!P.maxzoom||P.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new es(P)),this._inProgressLayer.continuePlacement(o[P.source],this.placement,this._showCollisionBoxes,P,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Hs.prototype.commit=function(n){return this.placement.commit(n),this.placement};var ja=512/p.EXTENT/2,Bu=function(n,u,o){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(var h=0;h<u.length;h++){var y=u.get(h),b=y.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,n)})}};Bu.prototype.getScaledCoordinates=function(n,u){var o=ja/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+n.anchorX)*o),y:Math.floor((u.canonical.y*p.EXTENT+n.anchorY)*o)}},Bu.prototype.findMatches=function(n,u,o){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),y=0;y<n.length;y++){var b=n.get(y);if(!b.crossTileID){var P=this.indexedSymbolInstances[b.key];if(P)for(var F=this.getScaledCoordinates(b,u),H=0,ae=P;H<ae.length;H+=1){var xe=ae[H];if(Math.abs(xe.coord.x-F.x)<=h&&Math.abs(xe.coord.y-F.y)<=h&&!o[xe.crossTileID]){o[xe.crossTileID]=!0,b.crossTileID=xe.crossTileID;break}}}}};var ts=function(){this.maxCrossTileID=0};ts.prototype.generate=function(){return++this.maxCrossTileID};var zo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};zo.prototype.handleWrapJump=function(n){var u=Math.round((n-this.lng)/360);if(u!==0)for(var o in this.indexes){var h=this.indexes[o],y={};for(var b in h){var P=h[b];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+u),y[P.tileID.key]=P}this.indexes[o]=y}this.lng=n},zo.prototype.addBucket=function(n,u,o){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});var y=this.usedCrossTileIDs[n.overscaledZ];for(var b in this.indexes){var P=this.indexes[b];if(Number(b)>n.overscaledZ)for(var F in P){var H=P[F];H.tileID.isChildOf(n)&&H.findMatches(u.symbolInstances,n,y)}else{var ae=P[n.scaledTo(Number(b)).key];ae&&ae.findMatches(u.symbolInstances,n,y)}}for(var xe=0;xe<u.symbolInstances.length;xe++){var we=u.symbolInstances.get(xe);we.crossTileID||(we.crossTileID=o.generate(),y[we.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Bu(n,u.symbolInstances,u.bucketInstanceId),!0},zo.prototype.removeBucketCrossTileIDs=function(n,u){for(var o in u.indexedSymbolInstances)for(var h=0,y=u.indexedSymbolInstances[o];h<y.length;h+=1)delete this.usedCrossTileIDs[n][y[h].crossTileID]},zo.prototype.removeStaleBuckets=function(n){var u=!1;for(var o in this.indexes){var h=this.indexes[o];for(var y in h)n[h[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,h[y]),delete h[y],u=!0)}return u};var uo=function(){this.layerIndexes={},this.crossTileIDs=new ts,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};uo.prototype.addLayer=function(n,u,o){var h=this.layerIndexes[n.id];h===void 0&&(h=this.layerIndexes[n.id]=new zo);var y=!1,b={};h.handleWrapJump(o);for(var P=0,F=u;P<F.length;P+=1){var H=F[P],ae=H.getBucket(n);ae&&n.id===ae.layerIds[0]&&(ae.bucketInstanceId||(ae.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(H.tileID,ae,this.crossTileIDs)&&(y=!0),b[ae.bucketInstanceId]=!0)}return h.removeStaleBuckets(b)&&(y=!0),y},uo.prototype.pruneUnusedLayers=function(n){var u={};for(var o in n.forEach(function(h){u[h]=!0}),this.layerIndexes)u[o]||delete this.layerIndexes[o]};var ii=function(n,u){return p.emitValidationErrors(n,u&&u.filter(function(o){return o.identifier!=="source.canvas"}))},ms=p.pick(an,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),rs=p.pick(an,["setCenter","setZoom","setBearing","setPitch"]),Rs=function(){var n={},u=p.styleSpec.$version;for(var o in p.styleSpec.$root){var h,y=p.styleSpec.$root[o];y.required&&(h=o==="version"?u:y.type==="array"?[]:{})!=null&&(n[o]=h)}return n}(),ns=function(n){function u(o,h){var y=this;h===void 0&&(h={}),n.call(this),this.map=o,this.dispatcher=new Zt($t(),this),this.imageManager=new Gt,this.imageManager.setEventedParent(this),this.glyphManager=new mr(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Xe(256,512),this.crossTileSymbolIndex=new uo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var b=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(P){b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(F,H){if(p.triggerPluginCompletionEvent(F),H&&H.every(function(xe){return xe}))for(var ae in b.sourceCaches)b.sourceCaches[ae].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var F=y.sourceCaches[P.sourceId];if(F){var H=F.getSource();if(H&&H.vectorLayerIds)for(var ae in y._layers){var xe=y._layers[ae];xe.source===H.id&&y._validateLayer(xe)}}}})}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.loadURL=function(o,h){var y=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var b=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);var P=this.map._requestManager.transformRequest(o,p.ResourceType.Style);this._request=p.getJSON(P,function(F,H){y._request=null,F?y.fire(new p.ErrorEvent(F)):H&&y._load(H,b)})},u.prototype.loadJSON=function(o,h){var y=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){y._request=null,y._load(o,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Rs,!1)},u.prototype._load=function(o,h){if(!h||!ii(this,p.validateStyle(o))){for(var y in this._loaded=!0,this.stylesheet=o,o.sources)this.addSource(y,o.sources[y],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);var b=sn(this.stylesheet.layers);this._order=b.map(function(ae){return ae.id}),this._layers={},this._serializedLayers={};for(var P=0,F=b;P<F.length;P+=1){var H=F[P];(H=p.createStyleLayer(H)).setEventedParent(this,{layer:{id:H.id}}),this._layers[H.id]=H,this._serializedLayers[H.id]=H.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Dt(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},u.prototype._loadSprite=function(o){var h=this;this._spriteRequest=function(y,b,P){var F,H,ae,xe=p.browser.devicePixelRatio>1?"@2x":"",we=p.getJSON(b.transformRequest(b.normalizeSpriteURL(y,xe,".json"),p.ResourceType.SpriteJSON),function(je,it){we=null,ae||(ae=je,F=it,He())}),Te=p.getImage(b.transformRequest(b.normalizeSpriteURL(y,xe,".png"),p.ResourceType.SpriteImage),function(je,it){Te=null,ae||(ae=je,H=it,He())});function He(){if(ae)P(ae);else if(F&&H){var je=p.browser.getImageData(H),it={};for(var ze in F){var at=F[ze],xt=at.width,jt=at.height,gr=at.x,lr=at.y,_r=at.sdf,zr=at.pixelRatio,on=at.stretchX,Qr=at.stretchY,Pn=at.content,ei=new p.RGBAImage({width:xt,height:jt});p.RGBAImage.copy(je,ei,{x:gr,y:lr},{x:0,y:0},{width:xt,height:jt}),it[ze]={data:ei,pixelRatio:zr,sdf:_r,stretchX:on,stretchY:Qr,content:Pn}}P(null,it)}}return{cancel:function(){we&&(we.cancel(),we=null),Te&&(Te.cancel(),Te=null)}}}(o,this.map._requestManager,function(y,b){if(h._spriteRequest=null,y)h.fire(new p.ErrorEvent(y));else if(b)for(var P in b)h.imageManager.addImage(P,b[P]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(o){var h=this.sourceCaches[o.source];if(h){var y=o.sourceLayer;if(y){var b=h.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(y)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+y+'" does not exist on source "'+b.id+'" as specified by style layer "'+o.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(o){for(var h=[],y=0,b=o;y<b.length;y+=1){var P=this._layers[b[y]];P.type!=="custom"&&h.push(P.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(o){if(this._loaded){var h=this._changed;if(this._changed){var y=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);for(var P in(y.length||b.length)&&this._updateWorkerLayers(y,b),this._updatedSources){var F=this._updatedSources[P];F==="reload"?this._reloadSource(P):F==="clear"&&this._clearSource(P)}for(var H in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[H].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}var ae={};for(var xe in this.sourceCaches){var we=this.sourceCaches[xe];ae[xe]=we.used,we.used=!1}for(var Te=0,He=this._order;Te<He.length;Te+=1){var je=this._layers[He[Te]];je.recalculate(o,this._availableImages),!je.isHidden(o.zoom)&&je.source&&(this.sourceCaches[je.source].used=!0)}for(var it in ae){var ze=this.sourceCaches[it];ae[it]!==ze.used&&ze.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:it}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var o=Object.keys(this._changedImages);if(o.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}},u.prototype._updateWorkerLayers=function(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(o){var h=this;if(this._checkLoaded(),ii(this,p.validateStyle(o)))return!1;(o=p.clone$1(o)).layers=sn(o.layers);var y=function(P,F){if(!P)return[{command:an.setStyle,args:[F]}];var H=[];try{if(!p.deepEqual(P.version,F.version))return[{command:an.setStyle,args:[F]}];p.deepEqual(P.center,F.center)||H.push({command:an.setCenter,args:[F.center]}),p.deepEqual(P.zoom,F.zoom)||H.push({command:an.setZoom,args:[F.zoom]}),p.deepEqual(P.bearing,F.bearing)||H.push({command:an.setBearing,args:[F.bearing]}),p.deepEqual(P.pitch,F.pitch)||H.push({command:an.setPitch,args:[F.pitch]}),p.deepEqual(P.sprite,F.sprite)||H.push({command:an.setSprite,args:[F.sprite]}),p.deepEqual(P.glyphs,F.glyphs)||H.push({command:an.setGlyphs,args:[F.glyphs]}),p.deepEqual(P.transition,F.transition)||H.push({command:an.setTransition,args:[F.transition]}),p.deepEqual(P.light,F.light)||H.push({command:an.setLight,args:[F.light]});var ae={},xe=[];(function(Te,He,je,it){var ze;for(ze in He=He||{},Te=Te||{})Te.hasOwnProperty(ze)&&(He.hasOwnProperty(ze)||xn(ze,je,it));for(ze in He)He.hasOwnProperty(ze)&&(Te.hasOwnProperty(ze)?p.deepEqual(Te[ze],He[ze])||(Te[ze].type==="geojson"&&He[ze].type==="geojson"&&Qi(Te,He,ze)?je.push({command:an.setGeoJSONSourceData,args:[ze,He[ze].data]}):Ai(ze,He,je,it)):Ii(ze,He,je))})(P.sources,F.sources,xe,ae);var we=[];P.layers&&P.layers.forEach(function(Te){ae[Te.source]?H.push({command:an.removeLayer,args:[Te.id]}):we.push(Te)}),H=H.concat(xe),function(Te,He,je){He=He||[];var it,ze,at,xt,jt,gr,lr,_r=(Te=Te||[]).map(Yi),zr=He.map(Yi),on=Te.reduce(Bi,{}),Qr=He.reduce(Bi,{}),Pn=_r.slice(),ei=Object.create(null);for(it=0,ze=0;it<_r.length;it++)Qr.hasOwnProperty(at=_r[it])?ze++:(je.push({command:an.removeLayer,args:[at]}),Pn.splice(Pn.indexOf(at,ze),1));for(it=0,ze=0;it<zr.length;it++)Pn[Pn.length-1-it]!==(at=zr[zr.length-1-it])&&(on.hasOwnProperty(at)?(je.push({command:an.removeLayer,args:[at]}),Pn.splice(Pn.lastIndexOf(at,Pn.length-ze),1)):ze++,je.push({command:an.addLayer,args:[Qr[at],gr=Pn[Pn.length-it]]}),Pn.splice(Pn.length-it,0,at),ei[at]=!0);for(it=0;it<zr.length;it++)if(xt=on[at=zr[it]],jt=Qr[at],!ei[at]&&!p.deepEqual(xt,jt))if(p.deepEqual(xt.source,jt.source)&&p.deepEqual(xt["source-layer"],jt["source-layer"])&&p.deepEqual(xt.type,jt.type)){for(lr in li(xt.layout,jt.layout,je,at,null,an.setLayoutProperty),li(xt.paint,jt.paint,je,at,null,an.setPaintProperty),p.deepEqual(xt.filter,jt.filter)||je.push({command:an.setFilter,args:[at,jt.filter]}),p.deepEqual(xt.minzoom,jt.minzoom)&&p.deepEqual(xt.maxzoom,jt.maxzoom)||je.push({command:an.setLayerZoomRange,args:[at,jt.minzoom,jt.maxzoom]}),xt)xt.hasOwnProperty(lr)&&lr!=="layout"&&lr!=="paint"&&lr!=="filter"&&lr!=="metadata"&&lr!=="minzoom"&&lr!=="maxzoom"&&(lr.indexOf("paint.")===0?li(xt[lr],jt[lr],je,at,lr.slice(6),an.setPaintProperty):p.deepEqual(xt[lr],jt[lr])||je.push({command:an.setLayerProperty,args:[at,lr,jt[lr]]}));for(lr in jt)jt.hasOwnProperty(lr)&&!xt.hasOwnProperty(lr)&&lr!=="layout"&&lr!=="paint"&&lr!=="filter"&&lr!=="metadata"&&lr!=="minzoom"&&lr!=="maxzoom"&&(lr.indexOf("paint.")===0?li(xt[lr],jt[lr],je,at,lr.slice(6),an.setPaintProperty):p.deepEqual(xt[lr],jt[lr])||je.push({command:an.setLayerProperty,args:[at,lr,jt[lr]]}))}else je.push({command:an.removeLayer,args:[at]}),gr=Pn[Pn.lastIndexOf(at)+1],je.push({command:an.addLayer,args:[jt,gr]})}(we,F.layers,H)}catch(Te){console.warn("Unable to compute style diff:",Te),H=[{command:an.setStyle,args:[F]}]}return H}(this.serialize(),o).filter(function(P){return!(P.command in rs)});if(y.length===0)return!1;var b=y.filter(function(P){return!(P.command in ms)});if(b.length>0)throw new Error("Unimplemented: "+b.map(function(P){return P.command}).join(", ")+".");return y.forEach(function(P){P.command!=="setTransition"&&h[P.command].apply(h,P.args)}),this.stylesheet=o,!0},u.prototype.addImage=function(o,h){if(this.getImage(o))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,h),this._afterImageUpdated(o)},u.prototype.updateImage=function(o,h){this.imageManager.updateImage(o,h)},u.prototype.getImage=function(o){return this.imageManager.getImage(o)},u.prototype.removeImage=function(o){if(!this.getImage(o))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)},u.prototype._afterImageUpdated=function(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(o,h,y){var b=this;if(y===void 0&&(y={}),this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+o,h,null,y))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var P=this.sourceCaches[o]=new Ee(o,h,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:b.loaded(),source:P.serialize(),sourceId:o}}),P.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===o)return this.fire(new p.ErrorEvent(new Error('Source "'+o+'" cannot be removed while layer "'+h+'" is using it.')));var y=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],y.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),y.setEventedParent(null),y.clearTiles(),y.onRemove&&y.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(o,h){this._checkLoaded(),this.sourceCaches[o].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()},u.prototype.addLayer=function(o,h,y){y===void 0&&(y={}),this._checkLoaded();var b=o.id;if(this.getLayer(b))this.fire(new p.ErrorEvent(new Error('Layer with id "'+b+'" already exists on this map')));else{var P;if(o.type==="custom"){if(ii(this,p.validateCustomStyleLayer(o)))return;P=p.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(b,o.source),o=p.clone$1(o),o=p.extend(o,{source:b})),this._validate(p.validateStyle.layer,"layers."+b,o,{arrayIndex:-1},y))return;P=p.createStyleLayer(o),this._validateLayer(P),P.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[P.id]=P.serialize()}var F=h?this._order.indexOf(h):this._order.length;if(h&&F===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(F,0,b),this._layerOrderChanged=!0,this._layers[b]=P,this._removedLayers[b]&&P.source&&P.type!=="custom"){var H=this._removedLayers[b];delete this._removedLayers[b],H.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},u.prototype.moveLayer=function(o,h){if(this._checkLoaded(),this._changed=!0,this._layers[o]){if(o!==h){var y=this._order.indexOf(o);this._order.splice(y,1);var b=h?this._order.indexOf(h):this._order.length;h&&b===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(b,0,o),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(o){this._checkLoaded();var h=this._layers[o];if(h){h.setEventedParent(null);var y=this._order.indexOf(o);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(o){return this._layers[o]},u.prototype.hasLayer=function(o){return o in this._layers},u.prototype.setLayerZoomRange=function(o,h,y){this._checkLoaded();var b=this.getLayer(o);b?b.minzoom===h&&b.maxzoom===y||(h!=null&&(b.minzoom=h),y!=null&&(b.maxzoom=y),this._updateLayer(b)):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(o,h,y){y===void 0&&(y={}),this._checkLoaded();var b=this.getLayer(o);if(b){if(!p.deepEqual(b.filter,h))return h==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(p.validateStyle.filter,"layers."+b.id+".filter",h,null,y)||(b.filter=p.clone$1(h),this._updateLayer(b)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(o){return p.clone$1(this.getLayer(o).filter)},u.prototype.setLayoutProperty=function(o,h,y,b){b===void 0&&(b={}),this._checkLoaded();var P=this.getLayer(o);P?p.deepEqual(P.getLayoutProperty(h),y)||(P.setLayoutProperty(h,y,b),this._updateLayer(P)):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(o,h){var y=this.getLayer(o);if(y)return y.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(o,h,y,b){b===void 0&&(b={}),this._checkLoaded();var P=this.getLayer(o);P?p.deepEqual(P.getPaintProperty(h),y)||(P.setPaintProperty(h,y,b)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(o,h){return this.getLayer(o).getPaintProperty(h)},u.prototype.setFeatureState=function(o,h){this._checkLoaded();var y=o.source,b=o.sourceLayer,P=this.sourceCaches[y];if(P!==void 0){var F=P.getSource().type;F==="geojson"&&b?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):F!=="vector"||b?(o.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(b,o.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(o,h){this._checkLoaded();var y=o.source,b=this.sourceCaches[y];if(b!==void 0){var P=b.getSource().type,F=P==="vector"?o.sourceLayer:void 0;P!=="vector"||F?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(F,o.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(o){this._checkLoaded();var h=o.source,y=o.sourceLayer,b=this.sourceCaches[h];if(b!==void 0){if(b.getSource().type!=="vector"||y)return o.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),b.getFeatureState(y,o.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(o){return o.serialize()}),layers:this._serializeLayers(this._order)},function(o){return o!==void 0})},u.prototype._updateLayer=function(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(o){for(var h=this,y=function(on){return h._layers[on].type==="fill-extrusion"},b={},P=[],F=this._order.length-1;F>=0;F--){var H=this._order[F];if(y(H)){b[H]=F;for(var ae=0,xe=o;ae<xe.length;ae+=1){var we=xe[ae][H];if(we)for(var Te=0,He=we;Te<He.length;Te+=1)P.push(He[Te])}}}P.sort(function(on,Qr){return Qr.intersectionZ-on.intersectionZ});for(var je=[],it=this._order.length-1;it>=0;it--){var ze=this._order[it];if(y(ze))for(var at=P.length-1;at>=0;at--){var xt=P[at].feature;if(b[xt.layer.id]<it)break;je.push(xt),P.pop()}else for(var jt=0,gr=o;jt<gr.length;jt+=1){var lr=gr[jt][ze];if(lr)for(var _r=0,zr=lr;_r<zr.length;_r+=1)je.push(zr[_r].feature)}}return je},u.prototype.queryRenderedFeatures=function(o,h,y){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var b={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,F=h.layers;P<F.length;P+=1){var H=F[P],ae=this._layers[H];if(!ae)return this.fire(new p.ErrorEvent(new Error("The layer '"+H+"' does not exist in the map's style and cannot be queried for features."))),[];b[ae.source]=!0}}var xe=[];for(var we in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!b[we]||xe.push(mn(this.sourceCaches[we],this._layers,this._serializedLayers,o,h,y));return this.placement&&xe.push(function(Te,He,je,it,ze,at,xt){for(var jt={},gr=at.queryRenderedSymbols(it),lr=[],_r=0,zr=Object.keys(gr).map(Number);_r<zr.length;_r+=1)lr.push(xt[zr[_r]]);lr.sort(Xi);for(var on=function(){var ti=Pn[Qr],aa=ti.featureIndex.lookupSymbolFeatures(gr[ti.bucketInstanceId],He,ti.bucketIndex,ti.sourceLayerIndex,ze.filter,ze.layers,ze.availableImages,Te);for(var jn in aa){var xi=jt[jn]=jt[jn]||[],zi=aa[jn];zi.sort(function(D,k){var te=ti.featureSortOrder;if(te){var Ce=te.indexOf(D.featureIndex);return te.indexOf(k.featureIndex)-Ce}return k.featureIndex-D.featureIndex});for(var J=0,Q=zi;J<Q.length;J+=1)xi.push(Q[J])}},Qr=0,Pn=lr;Qr<Pn.length;Qr+=1)on();var ei=function(ti){jt[ti].forEach(function(aa){var jn=aa.feature,xi=je[Te[ti].source].getFeatureState(jn.layer["source-layer"],jn.id);jn.source=jn.layer.source,jn.layer["source-layer"]&&(jn.sourceLayer=jn.layer["source-layer"]),jn.state=xi})};for(var ci in jt)ei(ci);return jt}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(xe)},u.prototype.querySourceFeatures=function(o,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var y=this.sourceCaches[o];return y?function(b,P){for(var F=b.getRenderableIds().map(function(He){return b.getTileByID(He)}),H=[],ae={},xe=0;xe<F.length;xe++){var we=F[xe],Te=we.tileID.canonical.key;ae[Te]||(ae[Te]=!0,we.querySourceFeatures(H,P))}return H}(y,h):[]},u.prototype.addSourceType=function(o,h,y){return u.getSourceType(o)?y(new Error('A source type called "'+o+'" already exists.')):(u.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},y):y(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(o,h){h===void 0&&(h={}),this._checkLoaded();var y=this.light.getLight(),b=!1;for(var P in o)if(!p.deepEqual(o[P],y[P])){b=!0;break}if(b){var F={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(F)}},u.prototype._validate=function(o,h,y,b,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&ii(this,o.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:y,styleSpec:p.styleSpec},b)))},u.prototype._remove=function(){for(var o in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[o].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(o){this.sourceCaches[o].clearTiles()},u.prototype._reloadSource=function(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()},u.prototype._updateSources=function(o){for(var h in this.sourceCaches)this.sourceCaches[h].update(o)},u.prototype._generateCollisionBoxes=function(){for(var o in this.sourceCaches)this._reloadSource(o)},u.prototype._updatePlacement=function(o,h,y,b,P){P===void 0&&(P=!1);for(var F=!1,H=!1,ae={},xe=0,we=this._order;xe<we.length;xe+=1){var Te=this._layers[we[xe]];if(Te.type==="symbol"){if(!ae[Te.source]){var He=this.sourceCaches[Te.source];ae[Te.source]=He.getRenderableIds(!0).map(function(xt){return He.getTileByID(xt)}).sort(function(xt,jt){return jt.tileID.overscaledZ-xt.tileID.overscaledZ||(xt.tileID.isLessThan(jt.tileID)?-1:1)})}var je=this.crossTileSymbolIndex.addLayer(Te,ae[Te.source],o.center.lng);F=F||je}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),o.zoom))&&(this.pauseablePlacement=new Hs(o,this._order,P,h,y,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ae),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),H=!0),F&&this.pauseablePlacement.placement.setStale()),H||F)for(var it=0,ze=this._order;it<ze.length;it+=1){var at=this._layers[ze[it]];at.type==="symbol"&&this.placement.updateLayerOpacities(at,ae[at.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()},u.prototype.getImages=function(o,h,y){this.imageManager.getImages(h.icons,y),this._updateTilesForChangedImages();var b=this.sourceCaches[h.source];b&&b.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(o,h,y){this.glyphManager.getGlyphs(h.stacks,y)},u.prototype.getResource=function(o,h,y){return p.makeRequest(h,y)},u}(p.Evented);ns.getSourceType=function(n){return Dr[n]},ns.setSourceType=function(n,u){Dr[n]=u},ns.registerForPluginStateChange=p.registerForPluginStateChange;var Ta=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),lo=ua(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),_l=ua(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),xl=ua(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Nu=ua(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Gl=ua("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),wu=ua(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),co=ua(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),zs=ua("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Ss=ua("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),m=ua("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),A=ua(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),j=ua(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=ua(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),le=ua(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ie=ua(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ut=ua(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Pt=ua(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ot=ua(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Ar=ua(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),jr=ua(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),qn=ua(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),gi=ua(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),wn=ua(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),fa=ua(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ni=ua(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Oa=ua(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ua(n,u){var o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),y=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=b?b.concat(y):y,F={};return{fragmentSource:n=n.replace(o,function(H,ae,xe,we,Te){return F[Te]=!0,ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Te+`
varying `+xe+" "+we+" "+Te+`;
#else
uniform `+xe+" "+we+" u_"+Te+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Te+`
    `+xe+" "+we+" "+Te+" = u_"+Te+`;
#endif
`}),vertexSource:u=u.replace(o,function(H,ae,xe,we,Te){var He=we==="float"?"vec2":"vec4",je=Te.match(/color/)?"color":He;return F[Te]?ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Te+`
uniform lowp float u_`+Te+`_t;
attribute `+xe+" "+He+" a_"+Te+`;
varying `+xe+" "+we+" "+Te+`;
#else
uniform `+xe+" "+we+" u_"+Te+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+Te+" = a_"+Te+`;
#else
    `+xe+" "+we+" "+Te+" = u_"+Te+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+Te+" = unpack_mix_"+je+"(a_"+Te+", u_"+Te+`_t);
#else
    `+xe+" "+we+" "+Te+" = u_"+Te+`;
#endif
`:ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Te+`
uniform lowp float u_`+Te+`_t;
attribute `+xe+" "+He+" a_"+Te+`;
#else
uniform `+xe+" "+we+" u_"+Te+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+xe+" "+we+" "+Te+" = a_"+Te+`;
#else
    `+xe+" "+we+" "+Te+" = u_"+Te+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+xe+" "+we+" "+Te+" = unpack_mix_"+je+"(a_"+Te+", u_"+Te+`_t);
#else
    `+xe+" "+we+" "+Te+" = u_"+Te+`;
#endif
`}),staticAttributes:h,staticUniforms:P}}var Xa=Object.freeze({__proto__:null,prelude:lo,background:_l,backgroundPattern:xl,circle:Nu,clippingMask:Gl,heatmap:wu,heatmapTexture:co,collisionBox:zs,collisionCircle:Ss,debug:m,fill:A,fillOutline:j,fillOutlinePattern:O,fillPattern:le,fillExtrusion:Ie,fillExtrusionPattern:ut,hillshadePrepare:Pt,hillshade:Ot,line:Ar,lineGradient:jr,linePattern:qn,lineSDF:gi,raster:wn,symbolIcon:fa,symbolSDF:Ni,symbolTextAndIcon:Oa}),is=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Es(n){for(var u=[],o=0;o<n.length;o++)if(n[o]!==null){var h=n[o].split(" ");u.push(h.pop())}return u}is.prototype.bind=function(n,u,o,h,y,b,P,F){this.context=n;for(var H=this.boundPaintVertexBuffers.length!==h.length,ae=0;!H&&ae<h.length;ae++)this.boundPaintVertexBuffers[ae]!==h[ae]&&(H=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===o&&!H&&this.boundIndexBuffer===y&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===F?(n.bindVertexArrayOES.set(this.vao),P&&P.bind(),y&&y.dynamicDraw&&y.bind(),F&&F.bind()):this.freshBind(u,o,h,y,b,P,F)},is.prototype.freshBind=function(n,u,o,h,y,b,P){var F,H=n.numAttributes,ae=this.context,xe=ae.gl;if(ae.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ae.extVertexArrayObject.createVertexArrayOES(),ae.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=h,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=P;else{F=ae.currentNumAttributes||0;for(var we=H;we<F;we++)xe.disableVertexAttribArray(we)}u.enableAttributes(xe,n);for(var Te=0,He=o;Te<He.length;Te+=1)He[Te].enableAttributes(xe,n);b&&b.enableAttributes(xe,n),P&&P.enableAttributes(xe,n),u.bind(),u.setVertexAttribPointers(xe,n,y);for(var je=0,it=o;je<it.length;je+=1){var ze=it[je];ze.bind(),ze.setVertexAttribPointers(xe,n,y)}b&&(b.bind(),b.setVertexAttribPointers(xe,n,y)),h&&h.bind(),P&&(P.bind(),P.setVertexAttribPointers(xe,n,y)),ae.currentNumAttributes=H},is.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Au=function(n,u,o,h,y,b){var P=n.gl;this.program=P.createProgram();for(var F=Es(o.staticAttributes),H=h?h.getBinderAttributes():[],ae=F.concat(H),xe=o.staticUniforms?Es(o.staticUniforms):[],we=h?h.getBinderUniforms():[],Te=[],He=0,je=xe.concat(we);He<je.length;He+=1){var it=je[He];Te.indexOf(it)<0&&Te.push(it)}var ze=h?h.defines():[];b&&ze.push("#define OVERDRAW_INSPECTOR;");var at=ze.concat(lo.fragmentSource,o.fragmentSource).join(`
`),xt=ze.concat(lo.vertexSource,o.vertexSource).join(`
`),jt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(jt,at),P.compileShader(jt),P.attachShader(this.program,jt);var gr=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(gr,xt),P.compileShader(gr),P.attachShader(this.program,gr),this.attributes={};var lr={};this.numAttributes=ae.length;for(var _r=0;_r<this.numAttributes;_r++)ae[_r]&&(P.bindAttribLocation(this.program,_r,ae[_r]),this.attributes[ae[_r]]=_r);P.linkProgram(this.program),P.deleteShader(gr),P.deleteShader(jt);for(var zr=0;zr<Te.length;zr++){var on=Te[zr];if(on&&!lr[on]){var Qr=P.getUniformLocation(this.program,on);Qr&&(lr[on]=Qr)}}this.fixedUniforms=y(n,lr),this.binderUniforms=h?h.getUniforms(n,lr):[]}}};function cu(n,u,o){var h=1/ma(o,1,u.transform.tileZoom),y=Math.pow(2,o.tileID.overscaledZ),b=o.tileSize*Math.pow(2,u.transform.tileZoom)/y,P=b*(o.tileID.canonical.x+o.tileID.wrap*y),F=b*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,n.fromScale,n.toScale],u_fade:n.t,u_pixel_coord_upper:[P>>16,F>>16],u_pixel_coord_lower:[65535&P,65535&F]}}Au.prototype.draw=function(n,u,o,h,y,b,P,F,H,ae,xe,we,Te,He,je,it){var ze,at=n.gl;if(!this.failedToCreate){for(var xt in n.program.set(this.program),n.setDepthMode(o),n.setStencilMode(h),n.setColorMode(y),n.setCullFace(b),this.fixedUniforms)this.fixedUniforms[xt].set(P[xt]);He&&He.setUniforms(n,this.binderUniforms,we,{zoom:Te});for(var jt=(ze={},ze[at.LINES]=2,ze[at.TRIANGLES]=3,ze[at.LINE_STRIP]=1,ze)[u],gr=0,lr=xe.get();gr<lr.length;gr+=1){var _r=lr[gr],zr=_r.vaos||(_r.vaos={});(zr[F]||(zr[F]=new is)).bind(n,this,H,He?He.getPaintVertexBuffers():[],ae,_r.vertexOffset,je,it),at.drawElements(u,_r.primitiveLength*jt,at.UNSIGNED_SHORT,_r.primitiveOffset*jt*2)}}};var nl=function(n,u,o,h){var y=u.style.light,b=y.properties.get("position"),P=[b.x,b.y,b.z],F=p.create$1();y.properties.get("anchor")==="viewport"&&p.fromRotation(F,-u.transform.angle),p.transformMat3(P,P,F);var H=y.properties.get("color");return{u_matrix:n,u_lightpos:P,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+o,u_opacity:h}},Ws=function(n,u,o,h,y,b,P){return p.extend(nl(n,u,o,h),cu(b,u,P),{u_height_factor:-Math.pow(2,y.overscaledZ)/P.tileSize/8})},Xs=function(n){return{u_matrix:n}},Ys=function(n,u,o,h){return p.extend(Xs(n),cu(o,u,h))},za=function(n,u){return{u_matrix:n,u_world:u}},il=function(n,u,o,h,y){return p.extend(Ys(n,u,o,h),{u_world:y})},al=function(n,u,o,h){var y,b,P=n.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var F=ma(o,1,P.zoom);y=!0,b=[F,F]}else y=!1,b=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:n.translatePosMatrix(u.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:b}},ds=function(n,u,o){var h=ma(o,1,u.zoom),y=Math.pow(2,u.zoom-o.tileID.overscaledZ),b=o.tileID.overscaleFactor();return{u_matrix:n,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*y),u.pixelsToGLUnits[1]/(h*y)],u_overscale_factor:b}},Hl=function(n,u,o){return{u_matrix:n,u_inv_matrix:u,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}},fu=function(n,u,o){return o===void 0&&(o=1),{u_matrix:n,u_color:u,u_overlay:0,u_overlay_scale:o}},Ds=function(n){return{u_matrix:n}},mc=function(n,u,o,h){return{u_matrix:n,u_extrude_scale:ma(u,1,o),u_intensity:h}},Tu=function(n,u,o){var h=n.transform;return{u_matrix:Wl(n,u,o),u_ratio:1/ma(u,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ma=function(n,u,o,h){return p.extend(Tu(n,u,o),{u_image:0,u_image_height:h})},ol=function(n,u,o,h){var y=n.transform,b=hu(u,y);return{u_matrix:Wl(n,u,o),u_texsize:u.imageAtlasTexture.size,u_ratio:1/ma(u,1,y.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[b,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Fc=function(n,u,o,h,y){var b=n.lineAtlas,P=hu(u,n.transform),F=o.layout.get("line-cap")==="round",H=b.getDash(h.from,F),ae=b.getDash(h.to,F),xe=H.width*y.fromScale,we=ae.width*y.toScale;return p.extend(Tu(n,u,o),{u_patternscale_a:[P/xe,-H.height/2],u_patternscale_b:[P/we,-ae.height/2],u_sdfgamma:b.width/(256*Math.min(xe,we)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:ae.y,u_mix:y.t})};function hu(n,u){return 1/ma(n,1,u.tileZoom)}function Wl(n,u,o){return n.translatePosMatrix(u.tileID.posMatrix,u,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}var Bc=function(n,u,o,h,y){return{u_matrix:n,u_tl_parent:u,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(P=y.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(b=y.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:zu(y.paint.get("raster-hue-rotate"))};var b,P};function zu(n){n*=Math.PI/180;var u=Math.sin(n),o=Math.cos(n);return[(2*o+1)/3,(-Math.sqrt(3)*u-o+1)/3,(Math.sqrt(3)*u-o+1)/3]}var Xl,bl=function(n,u,o,h,y,b,P,F,H,ae){var xe=y.transform;return{u_is_size_zoom_constant:+(n==="constant"||n==="source"),u_is_size_feature_constant:+(n==="constant"||n==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:xe.cameraToCenterDistance,u_pitch:xe.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:xe.width/xe.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:P,u_coord_matrix:F,u_is_text:+H,u_pitch_with_map:+h,u_texsize:ae,u_texture:0}},Sl=function(n,u,o,h,y,b,P,F,H,ae,xe){var we=y.transform;return p.extend(bl(n,u,o,h,y,b,P,F,H,ae),{u_gamma_scale:h?Math.cos(we._pitch)*we.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+xe})},sl=function(n,u,o,h,y,b,P,F,H,ae){return p.extend(Sl(n,u,o,h,y,b,P,F,!0,H,!0),{u_texsize_icon:ae,u_texture_icon:1})},El=function(n,u,o){return{u_matrix:n,u_opacity:u,u_color:o}},Uu=function(n,u,o,h,y,b){return p.extend(function(P,F,H,ae){var xe=H.imageManager.getPattern(P.from.toString()),we=H.imageManager.getPattern(P.to.toString()),Te=H.imageManager.getPixelSize(),He=Te.width,je=Te.height,it=Math.pow(2,ae.tileID.overscaledZ),ze=ae.tileSize*Math.pow(2,H.transform.tileZoom)/it,at=ze*(ae.tileID.canonical.x+ae.tileID.wrap*it),xt=ze*ae.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:xe.tl,u_pattern_br_a:xe.br,u_pattern_tl_b:we.tl,u_pattern_br_b:we.br,u_texsize:[He,je],u_mix:F.t,u_pattern_size_a:xe.displaySize,u_pattern_size_b:we.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/ma(ae,1,H.transform.tileZoom),u_pixel_coord_upper:[at>>16,xt>>16],u_pixel_coord_lower:[65535&at,65535&xt]}}(h,b,o,y),{u_matrix:n,u_opacity:u})},pu={fillExtrusion:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fillExtrusionPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_height_factor:new p.Uniform1f(n,u.u_height_factor),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fill:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},fillPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},fillOutline:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world)}},fillOutlinePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},circle:function(n,u){return{u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(n,u.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},collisionBox:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(n,u.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_overscale_factor:new p.Uniform1f(n,u.u_overscale_factor)}},collisionCircle:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_inv_matrix:new p.UniformMatrix4f(n,u.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(n,u.u_viewport_size)}},debug:function(n,u){return{u_color:new p.UniformColor(n,u.u_color),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_overlay:new p.Uniform1i(n,u.u_overlay),u_overlay_scale:new p.Uniform1f(n,u.u_overlay_scale)}},clippingMask:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmap:function(n,u){return{u_extrude_scale:new p.Uniform1f(n,u.u_extrude_scale),u_intensity:new p.Uniform1f(n,u.u_intensity),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmapTexture:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_color_ramp:new p.Uniform1i(n,u.u_color_ramp),u_opacity:new p.Uniform1f(n,u.u_opacity)}},hillshade:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_latrange:new p.Uniform2f(n,u.u_latrange),u_light:new p.Uniform2f(n,u.u_light),u_shadow:new p.UniformColor(n,u.u_shadow),u_highlight:new p.UniformColor(n,u.u_highlight),u_accent:new p.UniformColor(n,u.u_accent)}},hillshadePrepare:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_dimension:new p.Uniform2f(n,u.u_dimension),u_zoom:new p.Uniform1f(n,u.u_zoom),u_unpack:new p.Uniform4f(n,u.u_unpack)}},line:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels)}},lineGradient:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_image:new p.Uniform1i(n,u.u_image),u_image_height:new p.Uniform1f(n,u.u_image_height)}},linePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_texsize:new p.Uniform2f(n,u.u_texsize),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_image:new p.Uniform1i(n,u.u_image),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},lineSDF:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(n,u.u_patternscale_a),u_patternscale_b:new p.Uniform2f(n,u.u_patternscale_b),u_sdfgamma:new p.Uniform1f(n,u.u_sdfgamma),u_image:new p.Uniform1i(n,u.u_image),u_tex_y_a:new p.Uniform1f(n,u.u_tex_y_a),u_tex_y_b:new p.Uniform1f(n,u.u_tex_y_b),u_mix:new p.Uniform1f(n,u.u_mix)}},raster:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_tl_parent:new p.Uniform2f(n,u.u_tl_parent),u_scale_parent:new p.Uniform1f(n,u.u_scale_parent),u_buffer_scale:new p.Uniform1f(n,u.u_buffer_scale),u_fade_t:new p.Uniform1f(n,u.u_fade_t),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image0:new p.Uniform1i(n,u.u_image0),u_image1:new p.Uniform1i(n,u.u_image1),u_brightness_low:new p.Uniform1f(n,u.u_brightness_low),u_brightness_high:new p.Uniform1f(n,u.u_brightness_high),u_saturation_factor:new p.Uniform1f(n,u.u_saturation_factor),u_contrast_factor:new p.Uniform1f(n,u.u_contrast_factor),u_spin_weights:new p.Uniform3f(n,u.u_spin_weights)}},symbolIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture)}},symbolSDF:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},symbolTextAndIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texsize_icon:new p.Uniform2f(n,u.u_texsize_icon),u_texture:new p.Uniform1i(n,u.u_texture),u_texture_icon:new p.Uniform1i(n,u.u_texture_icon),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},background:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_color:new p.UniformColor(n,u.u_color)}},backgroundPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image:new p.Uniform1i(n,u.u_image),u_pattern_tl_a:new p.Uniform2f(n,u.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(n,u.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(n,u.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(n,u.u_pattern_br_b),u_texsize:new p.Uniform2f(n,u.u_texsize),u_mix:new p.Uniform1f(n,u.u_mix),u_pattern_size_a:new p.Uniform2f(n,u.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(n,u.u_pattern_size_b),u_scale_a:new p.Uniform1f(n,u.u_scale_a),u_scale_b:new p.Uniform1f(n,u.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(n,u.u_tile_units_to_pixels)}}};function ul(n,u,o,h,y,b,P){for(var F=n.context,H=F.gl,ae=n.useProgram("collisionBox"),xe=[],we=0,Te=0,He=0;He<h.length;He++){var je=h[He],it=u.getTile(je),ze=it.getBucket(o);if(ze){var at=je.posMatrix;y[0]===0&&y[1]===0||(at=n.translatePosMatrix(je.posMatrix,it,y,b));var xt=P?ze.textCollisionBox:ze.iconCollisionBox,jt=ze.collisionCircleArray;if(jt.length>0){var gr=p.create(),lr=at;p.mul(gr,ze.placementInvProjMatrix,n.transform.glCoordMatrix),p.mul(gr,gr,ze.placementViewportMatrix),xe.push({circleArray:jt,circleOffset:Te,transform:lr,invTransform:gr}),Te=we+=jt.length/4}xt&&ae.draw(F,H.LINES,z.disabled,oe.disabled,n.colorModeForRenderPass(),Ae.disabled,ds(at,n.transform,it),o.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,null,n.transform.zoom,null,null,xt.collisionVertexBuffer)}}if(P&&xe.length){var _r=n.useProgram("collisionCircle"),zr=new p.StructArrayLayout2f1f2i16;zr.resize(4*we),zr._trim();for(var on=0,Qr=0,Pn=xe;Qr<Pn.length;Qr+=1)for(var ei=Pn[Qr],ci=0;ci<ei.circleArray.length/4;ci++){var ti=4*ci,aa=ei.circleArray[ti+0],jn=ei.circleArray[ti+1],xi=ei.circleArray[ti+2],zi=ei.circleArray[ti+3];zr.emplace(on++,aa,jn,xi,zi,0),zr.emplace(on++,aa,jn,xi,zi,1),zr.emplace(on++,aa,jn,xi,zi,2),zr.emplace(on++,aa,jn,xi,zi,3)}(!Xl||Xl.length<2*we)&&(Xl=function(st){var Bt=2*st,bt=new p.StructArrayLayout3ui6;bt.resize(Bt),bt._trim();for(var Kt=0;Kt<Bt;Kt++){var Ir=6*Kt;bt.uint16[Ir+0]=4*Kt+0,bt.uint16[Ir+1]=4*Kt+1,bt.uint16[Ir+2]=4*Kt+2,bt.uint16[Ir+3]=4*Kt+2,bt.uint16[Ir+4]=4*Kt+3,bt.uint16[Ir+5]=4*Kt+0}return bt}(we));for(var J=F.createIndexBuffer(Xl,!0),Q=F.createVertexBuffer(zr,p.collisionCircleLayout.members,!0),D=0,k=xe;D<k.length;D+=1){var te=k[D],Ce=Hl(te.transform,te.invTransform,n.transform);_r.draw(F,H.TRIANGLES,z.disabled,oe.disabled,n.colorModeForRenderPass(),Ae.disabled,Ce,o.id,Q,J,p.SegmentVector.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,n.transform.zoom,null,null,null)}Q.destroy(),J.destroy()}}var Us=p.identity(new Float32Array(16));function gc(n,u,o,h,y,b){var P=p.getAnchorAlignment(n),F=-(P.horizontalAlign-.5)*u,H=-(P.verticalAlign-.5)*o,ae=p.evaluateVariableOffset(n,h);return new p.Point((F/y+ae[0])*b,(H/y+ae[1])*b)}function yc(n,u,o,h,y,b,P,F,H,ae,xe){var we=n.text.placedSymbolArray,Te=n.text.dynamicLayoutVertexArray,He=n.icon.dynamicLayoutVertexArray,je={};Te.clear();for(var it=0;it<we.length;it++){var ze=we.get(it),at=ze.hidden||!ze.crossTileID||n.allowVerticalPlacement&&!ze.placedOrientation?null:h[ze.crossTileID];if(at){var xt=new p.Point(ze.anchorX,ze.anchorY),jt=Di(xt,o?F:P),gr=Ei(b.cameraToCenterDistance,jt.signedDistanceFromCamera),lr=y.evaluateSizeForFeature(n.textSizeData,ae,ze)*gr/p.ONE_EM;o&&(lr*=n.tilePixelRatio/H);for(var _r=gc(at.anchor,at.width,at.height,at.textOffset,at.textBoxScale,lr),zr=o?Di(xt.add(_r),P).point:jt.point.add(u?_r.rotate(-b.angle):_r),on=n.allowVerticalPlacement&&ze.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,Qr=0;Qr<ze.numGlyphs;Qr++)p.addDynamicAttributes(Te,zr,on);xe&&ze.associatedIconIndex>=0&&(je[ze.associatedIconIndex]={shiftedAnchor:zr,angle:on})}else Gi(ze.numGlyphs,Te)}if(xe){He.clear();for(var Pn=n.icon.placedSymbolArray,ei=0;ei<Pn.length;ei++){var ci=Pn.get(ei);if(ci.hidden)Gi(ci.numGlyphs,He);else{var ti=je[ei];if(ti)for(var aa=0;aa<ci.numGlyphs;aa++)p.addDynamicAttributes(He,ti.shiftedAnchor,ti.angle);else Gi(ci.numGlyphs,He)}}n.icon.dynamicLayoutVertexBuffer.updateData(He)}n.text.dynamicLayoutVertexBuffer.updateData(Te)}function Nc(n,u,o){return o.iconsInText&&u?"symbolTextAndIcon":n?"symbolSDF":"symbolIcon"}function Zu(n,u,o,h,y,b,P,F,H,ae,xe,we){for(var Te=n.context,He=Te.gl,je=n.transform,it=F==="map",ze=H==="map",at=it&&o.layout.get("symbol-placement")!=="point",xt=it&&!ze&&!at,jt=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,gr=!1,lr=n.depthModeForSublayer(0,z.ReadOnly),_r=o.layout.get("text-variable-anchor"),zr=[],on=0,Qr=h;on<Qr.length;on+=1){var Pn=Qr[on],ei=u.getTile(Pn),ci=ei.getBucket(o);if(ci){var ti=y?ci.text:ci.icon;if(ti&&ti.segments.get().length){var aa=ti.programConfigurations.get(o.id),jn=y||ci.sdfIcons,xi=y?ci.textSizeData:ci.iconSizeData,zi=ze||je.pitch!==0,J=n.useProgram(Nc(jn,y,ci),aa),Q=p.evaluateSizeForZoom(xi,je.zoom),D=void 0,k=[0,0],te=void 0,Ce=void 0,st=null,Bt=void 0;if(y)te=ei.glyphAtlasTexture,Ce=He.LINEAR,D=ei.glyphAtlasTexture.size,ci.iconsInText&&(k=ei.imageAtlasTexture.size,st=ei.imageAtlasTexture,Bt=zi||n.options.rotating||n.options.zooming||xi.kind==="composite"||xi.kind==="camera"?He.LINEAR:He.NEAREST);else{var bt=o.layout.get("icon-size").constantOr(0)!==1||ci.iconsNeedLinear;te=ei.imageAtlasTexture,Ce=jn||n.options.rotating||n.options.zooming||bt||zi?He.LINEAR:He.NEAREST,D=ei.imageAtlasTexture.size}var Kt=ma(ei,1,n.transform.zoom),Ir=Fi(Pn.posMatrix,ze,it,n.transform,Kt),Fn=ni(Pn.posMatrix,ze,it,n.transform,Kt),Nn=_r&&ci.hasTextData(),fi=o.layout.get("icon-text-fit")!=="none"&&Nn&&ci.hasIconData();at&&ho(ci,Pn.posMatrix,n,y,Ir,Fn,ze,ae);var si=n.translatePosMatrix(Pn.posMatrix,ei,b,P),yi=at||y&&_r||fi?Us:Ir,Hi=n.translatePosMatrix(Fn,ei,b,P,!0),ya=jn&&o.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0,_a={program:J,buffers:ti,uniformValues:jn?ci.iconsInText?sl(xi.kind,Q,xt,ze,n,si,yi,Hi,D,k):Sl(xi.kind,Q,xt,ze,n,si,yi,Hi,y,D,!0):bl(xi.kind,Q,xt,ze,n,si,yi,Hi,y,D),atlasTexture:te,atlasTextureIcon:st,atlasInterpolation:Ce,atlasInterpolationIcon:Bt,isSDF:jn,hasHalo:ya};if(jt&&ci.canOverlap){gr=!0;for(var Ka=0,Ba=ti.segments.get();Ka<Ba.length;Ka+=1){var wo=Ba[Ka];zr.push({segments:new p.SegmentVector([wo]),sortKey:wo.sortKey,state:_a})}}else zr.push({segments:ti.segments,sortKey:0,state:_a})}}}gr&&zr.sort(function(Na,ko){return Na.sortKey-ko.sortKey});for(var La=0,Sa=zr;La<Sa.length;La+=1){var la=Sa[La],va=la.state;if(Te.activeTexture.set(He.TEXTURE0),va.atlasTexture.bind(va.atlasInterpolation,He.CLAMP_TO_EDGE),va.atlasTextureIcon&&(Te.activeTexture.set(He.TEXTURE1),va.atlasTextureIcon&&va.atlasTextureIcon.bind(va.atlasInterpolationIcon,He.CLAMP_TO_EDGE)),va.isSDF){var Ga=va.uniformValues;va.hasHalo&&(Ga.u_is_halo=1,Cl(va.buffers,la.segments,o,n,va.program,lr,xe,we,Ga)),Ga.u_is_halo=0}Cl(va.buffers,la.segments,o,n,va.program,lr,xe,we,va.uniformValues)}}function Cl(n,u,o,h,y,b,P,F,H){var ae=h.context;y.draw(ae,ae.gl.TRIANGLES,b,P,F,Ae.disabled,H,o.id,n.layoutVertexBuffer,n.indexBuffer,u,o.paint,h.transform.zoom,n.programConfigurations.get(o.id),n.dynamicLayoutVertexBuffer,n.opacityVertexBuffer)}function Yl(n,u,o,h,y,b,P){var F,H,ae,xe,we,Te=n.context.gl,He=o.paint.get("fill-pattern"),je=He&&He.constantOr(1),it=o.getCrossfadeParameters();P?(H=je&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=Te.LINES):(H=je?"fillPattern":"fill",F=Te.TRIANGLES);for(var ze=0,at=h;ze<at.length;ze+=1){var xt=at[ze],jt=u.getTile(xt);if(!je||jt.patternsLoaded()){var gr=jt.getBucket(o);if(gr){var lr=gr.programConfigurations.get(o.id),_r=n.useProgram(H,lr);je&&(n.context.activeTexture.set(Te.TEXTURE0),jt.imageAtlasTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),lr.updatePaintBuffers(it));var zr=He.constantOr(null);if(zr&&jt.imageAtlas){var on=jt.imageAtlas,Qr=on.patternPositions[zr.to.toString()],Pn=on.patternPositions[zr.from.toString()];Qr&&Pn&&lr.setConstantPatternPositions(Qr,Pn)}var ei=n.translatePosMatrix(xt.posMatrix,jt,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(P){xe=gr.indexBuffer2,we=gr.segments2;var ci=[Te.drawingBufferWidth,Te.drawingBufferHeight];ae=H==="fillOutlinePattern"&&je?il(ei,n,it,jt,ci):za(ei,ci)}else xe=gr.indexBuffer,we=gr.segments,ae=je?Ys(ei,n,it,jt):Xs(ei);_r.draw(n.context,F,y,n.stencilModeForClipping(xt),b,Ae.disabled,ae,o.id,gr.layoutVertexBuffer,xe,we,o.paint,n.transform.zoom,lr)}}}}function _c(n,u,o,h,y,b,P){for(var F=n.context,H=F.gl,ae=o.paint.get("fill-extrusion-pattern"),xe=ae.constantOr(1),we=o.getCrossfadeParameters(),Te=o.paint.get("fill-extrusion-opacity"),He=0,je=h;He<je.length;He+=1){var it=je[He],ze=u.getTile(it),at=ze.getBucket(o);if(at){var xt=at.programConfigurations.get(o.id),jt=n.useProgram(xe?"fillExtrusionPattern":"fillExtrusion",xt);xe&&(n.context.activeTexture.set(H.TEXTURE0),ze.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),xt.updatePaintBuffers(we));var gr=ae.constantOr(null);if(gr&&ze.imageAtlas){var lr=ze.imageAtlas,_r=lr.patternPositions[gr.to.toString()],zr=lr.patternPositions[gr.from.toString()];_r&&zr&&xt.setConstantPatternPositions(_r,zr)}var on=n.translatePosMatrix(it.posMatrix,ze,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Qr=o.paint.get("fill-extrusion-vertical-gradient"),Pn=xe?Ws(on,n,Qr,Te,it,we,ze):nl(on,n,Qr,Te);jt.draw(F,F.gl.TRIANGLES,y,b,P,Ae.backCCW,Pn,o.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,o.paint,n.transform.zoom,xt)}}}function Kl(n,u,o,h,y,b){var P=n.context,F=P.gl,H=u.fbo;if(H){var ae=n.useProgram("hillshade");P.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,H.colorAttachment.get());var xe=function(we,Te,He){var je=He.paint.get("hillshade-shadow-color"),it=He.paint.get("hillshade-highlight-color"),ze=He.paint.get("hillshade-accent-color"),at=He.paint.get("hillshade-illumination-direction")*(Math.PI/180);He.paint.get("hillshade-illumination-anchor")==="viewport"&&(at-=we.transform.angle);var xt,jt,gr,lr=!we.options.moving;return{u_matrix:we.transform.calculatePosMatrix(Te.tileID.toUnwrapped(),lr),u_image:0,u_latrange:(xt=Te.tileID,jt=Math.pow(2,xt.canonical.z),gr=xt.canonical.y,[new p.MercatorCoordinate(0,gr/jt).toLngLat().lat,new p.MercatorCoordinate(0,(gr+1)/jt).toLngLat().lat]),u_light:[He.paint.get("hillshade-exaggeration"),at],u_shadow:je,u_highlight:it,u_accent:ze}}(n,u,o);ae.draw(P,F.TRIANGLES,h,y,b,Ae.disabled,xe,o.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}}function $l(n,u,o,h,y,b){var P=n.context,F=P.gl,H=u.dem;if(H&&H.data){var ae=H.dim,xe=H.stride,we=H.getPixels();if(P.activeTexture.set(F.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||n.getTileTexture(xe),u.demTexture){var Te=u.demTexture;Te.update(we,{premultiply:!1}),Te.bind(F.NEAREST,F.CLAMP_TO_EDGE)}else u.demTexture=new p.Texture(P,we,F.RGBA,{premultiply:!1}),u.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);P.activeTexture.set(F.TEXTURE0);var He=u.fbo;if(!He){var je=new p.Texture(P,{width:ae,height:ae,data:null},F.RGBA);je.bind(F.LINEAR,F.CLAMP_TO_EDGE),(He=u.fbo=P.createFramebuffer(ae,ae,!0)).colorAttachment.set(je.texture)}P.bindFramebuffer.set(He.framebuffer),P.viewport.set([0,0,ae,ae]),n.useProgram("hillshadePrepare").draw(P,F.TRIANGLES,h,y,b,Ae.disabled,function(it,ze){var at=ze.stride,xt=p.create();return p.ortho(xt,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(xt,xt,[0,-p.EXTENT,0]),{u_matrix:xt,u_image:1,u_dimension:[at,at],u_zoom:it.overscaledZ,u_unpack:ze.getUnpackVector()}}(u.tileID,H),o.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Pu(n,u,o,h,y){var b=h.paint.get("raster-fade-duration");if(b>0){var P=p.browser.now(),F=(P-n.timeAdded)/b,H=u?(P-u.timeAdded)/b:-1,ae=o.getSource(),xe=y.coveringZoomLevel({tileSize:ae.tileSize,roundZoom:ae.roundZoom}),we=!u||Math.abs(u.tileID.overscaledZ-xe)>Math.abs(n.tileID.overscaledZ-xe),Te=we&&n.refreshedUponExpiration?1:p.clamp(we?F:1-H,0,1);return n.refreshedUponExpiration&&F>=1&&(n.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Te}:{opacity:Te,mix:0}}return{opacity:1,mix:0}}var Mu=new p.Color(1,0,0,1),Jl=new p.Color(0,1,0,1),Ql=new p.Color(0,0,1,1),du=new p.Color(1,0,1,1),xc=new p.Color(0,1,1,1);function wl(n,u,o,h){ju(n,0,u+o/2,n.transform.width,o,h)}function bc(n,u,o,h){ju(n,u-o/2,0,o,n.transform.height,h)}function ju(n,u,o,h,y,b){var P=n.context,F=P.gl;F.enable(F.SCISSOR_TEST),F.scissor(u*p.browser.devicePixelRatio,o*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,y*p.browser.devicePixelRatio),P.clear({color:b}),F.disable(F.SCISSOR_TEST)}function Va(n,u,o){var h=n.context,y=h.gl,b=o.posMatrix,P=n.useProgram("debug"),F=z.disabled,H=oe.disabled,ae=n.colorModeForRenderPass();h.activeTexture.set(y.TEXTURE0),n.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),P.draw(h,y.LINE_STRIP,F,H,ae,Ae.disabled,fu(b,p.Color.red),"$debug",n.debugBuffer,n.tileBorderIndexBuffer,n.debugSegments);var xe=u.getTileByID(o.key).latestRawTileData,we=Math.floor((xe&&xe.byteLength||0)/1024),Te=u.getTile(o).tileSize,He=512/Math.min(Te,512)*(o.overscaledZ/n.transform.zoom)*.5,je=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(je+=" => "+o.overscaledZ),function(it,ze){it.initDebugOverlayCanvas();var at=it.debugOverlayCanvas,xt=it.context.gl,jt=it.debugOverlayCanvas.getContext("2d");jt.clearRect(0,0,at.width,at.height),jt.shadowColor="white",jt.shadowBlur=2,jt.lineWidth=1.5,jt.strokeStyle="white",jt.textBaseline="top",jt.font="bold 36px Open Sans, sans-serif",jt.fillText(ze,5,5),jt.strokeText(ze,5,5),it.debugOverlayTexture.update(at),it.debugOverlayTexture.bind(xt.LINEAR,xt.CLAMP_TO_EDGE)}(n,je+" "+we+"kb"),P.draw(h,y.TRIANGLES,F,H,de.alphaBlended,Ae.disabled,fu(b,p.Color.transparent,He),"$debug",n.debugBuffer,n.quadTriangleIndexBuffer,n.debugSegments)}var ll={symbol:function(n,u,o,h,y){if(n.renderPass==="translucent"){var b=oe.disabled,P=n.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(F,H,ae,xe,we,Te,He){for(var je=H.transform,it=we==="map",ze=Te==="map",at=0,xt=F;at<xt.length;at+=1){var jt=xt[at],gr=xe.getTile(jt),lr=gr.getBucket(ae);if(lr&&lr.text&&lr.text.segments.get().length){var _r=p.evaluateSizeForZoom(lr.textSizeData,je.zoom),zr=ma(gr,1,H.transform.zoom),on=Fi(jt.posMatrix,ze,it,H.transform,zr),Qr=ae.layout.get("icon-text-fit")!=="none"&&lr.hasIconData();if(_r){var Pn=Math.pow(2,je.zoom-gr.tileID.overscaledZ);yc(lr,it,ze,He,p.symbolSize,je,on,jt.posMatrix,Pn,_r,Qr)}}}}(h,n,o,u,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),y),o.paint.get("icon-opacity").constantOr(1)!==0&&Zu(n,u,o,h,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),b,P),o.paint.get("text-opacity").constantOr(1)!==0&&Zu(n,u,o,h,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),b,P),u.map.showCollisionBoxes&&(ul(n,u,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),ul(n,u,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))}},circle:function(n,u,o,h){if(n.renderPass==="translucent"){var y=o.paint.get("circle-opacity"),b=o.paint.get("circle-stroke-width"),P=o.paint.get("circle-stroke-opacity"),F=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)!==0||b.constantOr(1)!==0&&P.constantOr(1)!==0){for(var H=n.context,ae=H.gl,xe=n.depthModeForSublayer(0,z.ReadOnly),we=oe.disabled,Te=n.colorModeForRenderPass(),He=[],je=0;je<h.length;je++){var it=h[je],ze=u.getTile(it),at=ze.getBucket(o);if(at){var xt=at.programConfigurations.get(o.id),jt={programConfiguration:xt,program:n.useProgram("circle",xt),layoutVertexBuffer:at.layoutVertexBuffer,indexBuffer:at.indexBuffer,uniformValues:al(n,it,ze,o)};if(F)for(var gr=0,lr=at.segments.get();gr<lr.length;gr+=1){var _r=lr[gr];He.push({segments:new p.SegmentVector([_r]),sortKey:_r.sortKey,state:jt})}else He.push({segments:at.segments,sortKey:0,state:jt})}}F&&He.sort(function(ei,ci){return ei.sortKey-ci.sortKey});for(var zr=0,on=He;zr<on.length;zr+=1){var Qr=on[zr],Pn=Qr.state;Pn.program.draw(H,ae.TRIANGLES,xe,we,Te,Ae.disabled,Pn.uniformValues,o.id,Pn.layoutVertexBuffer,Pn.indexBuffer,Qr.segments,o.paint,n.transform.zoom,Pn.programConfiguration)}}}},heatmap:function(n,u,o,h){if(o.paint.get("heatmap-opacity")!==0)if(n.renderPass==="offscreen"){var y=n.context,b=y.gl,P=oe.disabled,F=new de([b.ONE,b.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(He,je,it){var ze=He.gl;He.activeTexture.set(ze.TEXTURE1),He.viewport.set([0,0,je.width/4,je.height/4]);var at=it.heatmapFbo;if(at)ze.bindTexture(ze.TEXTURE_2D,at.colorAttachment.get()),He.bindFramebuffer.set(at.framebuffer);else{var xt=ze.createTexture();ze.bindTexture(ze.TEXTURE_2D,xt),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_S,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_T,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MIN_FILTER,ze.LINEAR),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MAG_FILTER,ze.LINEAR),at=it.heatmapFbo=He.createFramebuffer(je.width/4,je.height/4,!1),function(jt,gr,lr,_r){var zr=jt.gl;zr.texImage2D(zr.TEXTURE_2D,0,zr.RGBA,gr.width/4,gr.height/4,0,zr.RGBA,jt.extRenderToTextureHalfFloat?jt.extTextureHalfFloat.HALF_FLOAT_OES:zr.UNSIGNED_BYTE,null),_r.colorAttachment.set(lr)}(He,je,xt,at)}})(y,n,o),y.clear({color:p.Color.transparent});for(var H=0;H<h.length;H++){var ae=h[H];if(!u.hasRenderableParent(ae)){var xe=u.getTile(ae),we=xe.getBucket(o);if(we){var Te=we.programConfigurations.get(o.id);n.useProgram("heatmap",Te).draw(y,b.TRIANGLES,z.disabled,P,F,Ae.disabled,mc(ae.posMatrix,xe,n.transform.zoom,o.paint.get("heatmap-intensity")),o.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,o.paint,n.transform.zoom,Te)}}}y.viewport.set([0,0,n.width,n.height])}else n.renderPass==="translucent"&&(n.context.setColorMode(n.colorModeForRenderPass()),function(He,je){var it=He.context,ze=it.gl,at=je.heatmapFbo;if(at){it.activeTexture.set(ze.TEXTURE0),ze.bindTexture(ze.TEXTURE_2D,at.colorAttachment.get()),it.activeTexture.set(ze.TEXTURE1);var xt=je.colorRampTexture;xt||(xt=je.colorRampTexture=new p.Texture(it,je.colorRamp,ze.RGBA)),xt.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),He.useProgram("heatmapTexture").draw(it,ze.TRIANGLES,z.disabled,oe.disabled,He.colorModeForRenderPass(),Ae.disabled,function(jt,gr,lr,_r){var zr=p.create();p.ortho(zr,0,jt.width,jt.height,0,0,1);var on=jt.context.gl;return{u_matrix:zr,u_world:[on.drawingBufferWidth,on.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:gr.paint.get("heatmap-opacity")}}(He,je),je.id,He.viewportBuffer,He.quadTriangleIndexBuffer,He.viewportSegments,je.paint,He.transform.zoom)}}(n,o))},line:function(n,u,o,h){if(n.renderPass==="translucent"){var y=o.paint.get("line-opacity"),b=o.paint.get("line-width");if(y.constantOr(1)!==0&&b.constantOr(1)!==0)for(var P=n.depthModeForSublayer(0,z.ReadOnly),F=n.colorModeForRenderPass(),H=o.paint.get("line-dasharray"),ae=o.paint.get("line-pattern"),xe=ae.constantOr(1),we=o.paint.get("line-gradient"),Te=o.getCrossfadeParameters(),He=xe?"linePattern":H?"lineSDF":we?"lineGradient":"line",je=n.context,it=je.gl,ze=!0,at=0,xt=h;at<xt.length;at+=1){var jt=xt[at],gr=u.getTile(jt);if(!xe||gr.patternsLoaded()){var lr=gr.getBucket(o);if(lr){var _r=lr.programConfigurations.get(o.id),zr=n.context.program.get(),on=n.useProgram(He,_r),Qr=ze||on.program!==zr,Pn=ae.constantOr(null);if(Pn&&gr.imageAtlas){var ei=gr.imageAtlas,ci=ei.patternPositions[Pn.to.toString()],ti=ei.patternPositions[Pn.from.toString()];ci&&ti&&_r.setConstantPatternPositions(ci,ti)}var aa=xe?ol(n,gr,o,Te):H?Fc(n,gr,o,H,Te):we?Ma(n,gr,o,lr.lineClipsArray.length):Tu(n,gr,o);if(xe)je.activeTexture.set(it.TEXTURE0),gr.imageAtlasTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE),_r.updatePaintBuffers(Te);else if(H&&(Qr||n.lineAtlas.dirty))je.activeTexture.set(it.TEXTURE0),n.lineAtlas.bind(je);else if(we){var jn=lr.gradients[o.id],xi=jn.texture;if(o.gradientVersion!==jn.version){var zi=256;if(o.stepInterpolant){var J=u.getSource().maxzoom,Q=jt.canonical.z===J?Math.ceil(1<<n.transform.maxZoom-jt.canonical.z):1;zi=p.clamp(p.nextPowerOfTwo(lr.maxLineLength/p.EXTENT*1024*Q),256,je.maxTextureSize)}jn.gradient=p.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:zi,image:jn.gradient||void 0,clips:lr.lineClipsArray}),jn.texture?jn.texture.update(jn.gradient):jn.texture=new p.Texture(je,jn.gradient,it.RGBA),jn.version=o.gradientVersion,xi=jn.texture}je.activeTexture.set(it.TEXTURE0),xi.bind(o.stepInterpolant?it.NEAREST:it.LINEAR,it.CLAMP_TO_EDGE)}on.draw(je,it.TRIANGLES,P,n.stencilModeForClipping(jt),F,Ae.disabled,aa,o.id,lr.layoutVertexBuffer,lr.indexBuffer,lr.segments,o.paint,n.transform.zoom,_r,lr.layoutVertexBuffer2),ze=!1}}}}},fill:function(n,u,o,h){var y=o.paint.get("fill-color"),b=o.paint.get("fill-opacity");if(b.constantOr(1)!==0){var P=n.colorModeForRenderPass(),F=o.paint.get("fill-pattern"),H=n.opaquePassEnabledForLayer()&&!F.constantOr(1)&&y.constantOr(p.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(n.renderPass===H){var ae=n.depthModeForSublayer(1,n.renderPass==="opaque"?z.ReadWrite:z.ReadOnly);Yl(n,u,o,h,ae,P,!1)}if(n.renderPass==="translucent"&&o.paint.get("fill-antialias")){var xe=n.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,z.ReadOnly);Yl(n,u,o,h,xe,P,!0)}}},"fill-extrusion":function(n,u,o,h){var y=o.paint.get("fill-extrusion-opacity");if(y!==0&&n.renderPass==="translucent"){var b=new z(n.context.gl.LEQUAL,z.ReadWrite,n.depthRangeFor3D);if(y!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))_c(n,u,o,h,b,oe.disabled,de.disabled),_c(n,u,o,h,b,n.stencilModeFor3D(),n.colorModeForRenderPass());else{var P=n.colorModeForRenderPass();_c(n,u,o,h,b,oe.disabled,P)}}},hillshade:function(n,u,o,h){if(n.renderPass==="offscreen"||n.renderPass==="translucent"){for(var y=n.context,b=n.depthModeForSublayer(0,z.ReadOnly),P=n.colorModeForRenderPass(),F=n.renderPass==="translucent"?n.stencilConfigForOverlap(h):[{},h],H=F[0],ae=0,xe=F[1];ae<xe.length;ae+=1){var we=xe[ae],Te=u.getTile(we);Te.needsHillshadePrepare&&n.renderPass==="offscreen"?$l(n,Te,o,b,oe.disabled,P):n.renderPass==="translucent"&&Kl(n,Te,o,b,H[we.overscaledZ],P)}y.viewport.set([0,0,n.width,n.height])}},raster:function(n,u,o,h){if(n.renderPass==="translucent"&&o.paint.get("raster-opacity")!==0&&h.length)for(var y=n.context,b=y.gl,P=u.getSource(),F=n.useProgram("raster"),H=n.colorModeForRenderPass(),ae=P instanceof pt?[{},h]:n.stencilConfigForOverlap(h),xe=ae[0],we=ae[1],Te=we[we.length-1].overscaledZ,He=!n.options.moving,je=0,it=we;je<it.length;je+=1){var ze=it[je],at=n.depthModeForSublayer(ze.overscaledZ-Te,o.paint.get("raster-opacity")===1?z.ReadWrite:z.ReadOnly,b.LESS),xt=u.getTile(ze),jt=n.transform.calculatePosMatrix(ze.toUnwrapped(),He);xt.registerFadeDuration(o.paint.get("raster-fade-duration"));var gr=u.findLoadedParent(ze,0),lr=Pu(xt,gr,u,o,n.transform),_r=void 0,zr=void 0,on=o.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;y.activeTexture.set(b.TEXTURE0),xt.texture.bind(on,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),y.activeTexture.set(b.TEXTURE1),gr?(gr.texture.bind(on,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),_r=Math.pow(2,gr.tileID.overscaledZ-xt.tileID.overscaledZ),zr=[xt.tileID.canonical.x*_r%1,xt.tileID.canonical.y*_r%1]):xt.texture.bind(on,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);var Qr=Bc(jt,zr||[0,0],_r||1,lr,o);P instanceof pt?F.draw(y,b.TRIANGLES,at,oe.disabled,H,Ae.disabled,Qr,o.id,P.boundsBuffer,n.quadTriangleIndexBuffer,P.boundsSegments):F.draw(y,b.TRIANGLES,at,xe[ze.overscaledZ],H,Ae.disabled,Qr,o.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}},background:function(n,u,o){var h=o.paint.get("background-color"),y=o.paint.get("background-opacity");if(y!==0){var b=n.context,P=b.gl,F=n.transform,H=F.tileSize,ae=o.paint.get("background-pattern");if(!n.isPatternMissing(ae)){var xe=!ae&&h.a===1&&y===1&&n.opaquePassEnabledForLayer()?"opaque":"translucent";if(n.renderPass===xe){var we=oe.disabled,Te=n.depthModeForSublayer(0,xe==="opaque"?z.ReadWrite:z.ReadOnly),He=n.colorModeForRenderPass(),je=n.useProgram(ae?"backgroundPattern":"background"),it=F.coveringTiles({tileSize:H});ae&&(b.activeTexture.set(P.TEXTURE0),n.imageManager.bind(n.context));for(var ze=o.getCrossfadeParameters(),at=0,xt=it;at<xt.length;at+=1){var jt=xt[at],gr=n.transform.calculatePosMatrix(jt.toUnwrapped()),lr=ae?Uu(gr,y,n,ae,{tileID:jt,tileSize:H},ze):El(gr,y,h);je.draw(b,P.TRIANGLES,Te,we,He,Ae.disabled,lr,o.id,n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}}}},debug:function(n,u,o){for(var h=0;h<o.length;h++)Va(n,u,o[h])},custom:function(n,u,o){var h=n.context,y=o.implementation;if(n.renderPass==="offscreen"){var b=y.prerender;b&&(n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),b.call(y,h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState())}else if(n.renderPass==="translucent"){n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),h.setStencilMode(oe.disabled);var P=y.renderingMode==="3d"?new z(n.context.gl.LEQUAL,z.ReadWrite,n.depthRangeFor3D):n.depthModeForSublayer(0,z.ReadOnly);h.setDepthMode(P),y.render(h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState(),h.bindFramebuffer.set(null)}}},Ya=function(n,u){this.context=new se(n),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=Ee.maxUnderzooming+Ee.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new uo,this.gpuTimers={}};Ya.prototype.resize=function(n,u){if(this.width=n*p.browser.devicePixelRatio,this.height=u*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var o=0,h=this.style._order;o<h.length;o+=1)this.style._layers[h[o]].resize()},Ya.prototype.setup=function(){var n=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(u,Ta.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var o=new p.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(p.EXTENT,0),o.emplaceBack(0,p.EXTENT),o.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=n.createVertexBuffer(o,Ta.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(h,_t.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var y=new p.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,Ta.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var b=new p.StructArrayLayout1ui2;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(b);var P=new p.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(P),this.emptyTexture=new p.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);var F=this.context.gl;this.stencilClearMode=new oe({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO)},Ya.prototype.clearStencil=function(){var n=this.context,u=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var o=p.create();p.ortho(o,0,this.width,this.height,0,0,1),p.scale(o,o,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,u.TRIANGLES,z.disabled,this.stencilClearMode,de.disabled,Ae.disabled,Ds(o),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ya.prototype._renderTileClippingMasks=function(n,u){if(this.currentStencilSource!==n.source&&n.isTileClipped()&&u&&u.length){this.currentStencilSource=n.source;var o=this.context,h=o.gl;this.nextStencilID+u.length>256&&this.clearStencil(),o.setColorMode(de.disabled),o.setDepthMode(z.disabled);var y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var b=0,P=u;b<P.length;b+=1){var F=P[b],H=this._tileClippingMaskIDs[F.key]=this.nextStencilID++;y.draw(o,h.TRIANGLES,z.disabled,new oe({func:h.ALWAYS,mask:0},H,255,h.KEEP,h.KEEP,h.REPLACE),de.disabled,Ae.disabled,Ds(F.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ya.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var n=this.nextStencilID++,u=this.context.gl;return new oe({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)},Ya.prototype.stencilModeForClipping=function(n){var u=this.context.gl;return new oe({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)},Ya.prototype.stencilConfigForOverlap=function(n){var u,o=this.context.gl,h=n.sort(function(H,ae){return ae.overscaledZ-H.overscaledZ}),y=h[h.length-1].overscaledZ,b=h[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();for(var P={},F=0;F<b;F++)P[F+y]=new oe({func:o.GEQUAL,mask:255},F+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=b,[P,h]}return[(u={},u[y]=oe.disabled,u),h]},Ya.prototype.colorModeForRenderPass=function(){var n=this.context.gl;return this._showOverdrawInspector?new de([n.CONSTANT_COLOR,n.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?de.unblended:de.alphaBlended},Ya.prototype.depthModeForSublayer=function(n,u,o){if(!this.opaquePassEnabledForLayer())return z.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new z(o||this.context.gl.LEQUAL,u,[h,h])},Ya.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ya.prototype.render=function(n,u){var o=this;this.style=n,this.options=u,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,y=this.style.sourceCaches;for(var b in y){var P=y[b];P.used&&P.prepare(this.context)}var F,H,ae={},xe={},we={};for(var Te in y){var He=y[Te];ae[Te]=He.getVisibleCoordinates(),xe[Te]=ae[Te].slice().reverse(),we[Te]=He.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var je=0;je<h.length;je++)if(this.style._layers[h[je]].is3D()){this.opaquePassCutoff=je;break}this.renderPass="offscreen";for(var it=0,ze=h;it<ze.length;it+=1){var at=this.style._layers[ze[it]];if(at.hasOffscreenPass()&&!at.isHidden(this.transform.zoom)){var xt=xe[at.source];(at.type==="custom"||xt.length)&&this.renderLayer(this,y[at.source],at,xt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var jt=this.style._layers[h[this.currentLayer]],gr=y[jt.source],lr=ae[jt.source];this._renderTileClippingMasks(jt,lr),this.renderLayer(this,gr,jt,lr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var _r=this.style._layers[h[this.currentLayer]],zr=y[_r.source],on=(_r.type==="symbol"?we:xe)[_r.source];this._renderTileClippingMasks(_r,ae[_r.source]),this.renderLayer(this,zr,_r,on)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(Qr){Qr.source&&!Qr.isHidden(o.transform.zoom)&&(Qr.source!==(H&&H.id)&&(H=o.style.sourceCaches[Qr.source]),(!F||F.getSource().maxzoom<H.getSource().maxzoom)&&(F=H))}),F&&ll.debug(this,F,F.getVisibleCoordinates())),this.options.showPadding&&function(Qr){var Pn=Qr.transform.padding;wl(Qr,Qr.transform.height-(Pn.top||0),3,Mu),wl(Qr,Pn.bottom||0,3,Jl),bc(Qr,Pn.left||0,3,Ql),bc(Qr,Qr.transform.width-(Pn.right||0),3,du);var ei=Qr.transform.centerPoint;(function(ci,ti,aa,jn){ju(ci,ti-1,aa-10,2,20,jn),ju(ci,ti-10,aa-1,20,2,jn)})(Qr,ei.x,Qr.transform.height-ei.y,xc)}(this),this.context.setDefault()},Ya.prototype.renderLayer=function(n,u,o,h){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||h.length)&&(this.id=o.id,this.gpuTimingStart(o),ll[o.type](n,u,o,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ya.prototype.gpuTimingStart=function(n){if(this.options.gpuTiming){var u=this.context.extTimerQuery,o=this.gpuTimers[n.id];o||(o=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),o.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,o.query)}},Ya.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}},Ya.prototype.collectGpuTimers=function(){var n=this.gpuTimers;return this.gpuTimers={},n},Ya.prototype.queryGpuTimers=function(n){var u={};for(var o in n){var h=n[o],y=this.context.extTimerQuery,b=y.getQueryObjectEXT(h.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(h.query),u[o]=b}return u},Ya.prototype.translatePosMatrix=function(n,u,o,h,y){if(!o[0]&&!o[1])return n;var b=y?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(b){var P=Math.sin(b),F=Math.cos(b);o=[o[0]*F-o[1]*P,o[0]*P+o[1]*F]}var H=[y?o[0]:ma(u,o[0],this.transform.zoom),y?o[1]:ma(u,o[1],this.transform.zoom),0],ae=new Float32Array(16);return p.translate(ae,n,H),ae},Ya.prototype.saveTileTexture=function(n){var u=this._tileTextures[n.size[0]];u?u.push(n):this._tileTextures[n.size[0]]=[n]},Ya.prototype.getTileTexture=function(n){var u=this._tileTextures[n];return u&&u.length>0?u.pop():null},Ya.prototype.isPatternMissing=function(n){if(!n)return!1;if(!n.from||!n.to)return!0;var u=this.imageManager.getPattern(n.from.toString()),o=this.imageManager.getPattern(n.to.toString());return!u||!o},Ya.prototype.useProgram=function(n,u){this.cache=this.cache||{};var o=""+n+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[o]||(this.cache[o]=new Au(this.context,n,Xa[n],u,pu[n],this._showOverdrawInspector)),this.cache[o]},Ya.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ya.prototype.setBaseState=function(){var n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)},Ya.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ya.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Vu=function(n,u){this.points=n,this.planes=u};Vu.fromInvProjectionMatrix=function(n,u,o){var h=Math.pow(2,o),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return p.transformMat4([],P,n)}).map(function(P){return p.scale$1([],P,1/P[3]/u*h)}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var F=p.sub([],y[P[0]],y[P[1]]),H=p.sub([],y[P[2]],y[P[1]]),ae=p.normalize([],p.cross([],F,H)),xe=-p.dot(ae,y[P[1]]);return ae.concat(xe)});return new Vu(y,b)};var Iu=function(n,u){this.min=n,this.max=u,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};Iu.prototype.quadrant=function(n){for(var u=[n%2==0,n<2],o=p.clone$2(this.min),h=p.clone$2(this.max),y=0;y<u.length;y++)o[y]=u[y]?this.min[y]:this.center[y],h[y]=u[y]?this.center[y]:this.max[y];return h[2]=this.max[2],new Iu(o,h)},Iu.prototype.distanceX=function(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]},Iu.prototype.distanceY=function(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]},Iu.prototype.intersects=function(n){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],o=!0,h=0;h<n.planes.length;h++){for(var y=n.planes[h],b=0,P=0;P<u.length;P++)b+=p.dot$1(y,u[P])>=0;if(b===0)return 0;b!==u.length&&(o=!1)}if(o)return 2;for(var F=0;F<3;F++){for(var H=Number.MAX_VALUE,ae=-Number.MAX_VALUE,xe=0;xe<n.points.length;xe++){var we=n.points[xe][F]-this.min[F];H=Math.min(H,we),ae=Math.max(ae,we)}if(ae<0||H>this.max[F]-this.min[F])return 0}return 1};var Ks=function(n,u,o,h){if(n===void 0&&(n=0),u===void 0&&(u=0),o===void 0&&(o=0),h===void 0&&(h=0),isNaN(n)||n<0||isNaN(u)||u<0||isNaN(o)||o<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=o,this.right=h};Ks.prototype.interpolate=function(n,u,o){return u.top!=null&&n.top!=null&&(this.top=p.number(n.top,u.top,o)),u.bottom!=null&&n.bottom!=null&&(this.bottom=p.number(n.bottom,u.bottom,o)),u.left!=null&&n.left!=null&&(this.left=p.number(n.left,u.left,o)),u.right!=null&&n.right!=null&&(this.right=p.number(n.right,u.right,o)),this},Ks.prototype.getCenter=function(n,u){var o=p.clamp((this.left+n-this.right)/2,0,n),h=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.Point(o,h)},Ks.prototype.equals=function(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right},Ks.prototype.clone=function(){return new Ks(this.top,this.bottom,this.left,this.right)},Ks.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ra=function(n,u,o,h,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||y,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=o==null?0:o,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ks,this._posMatrixCache={},this._alignedPosMatrixCache={}},Fa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ra.prototype.clone=function(){var n=new ra(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n},Fa.minZoom.get=function(){return this._minZoom},Fa.minZoom.set=function(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))},Fa.maxZoom.get=function(){return this._maxZoom},Fa.maxZoom.set=function(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))},Fa.minPitch.get=function(){return this._minPitch},Fa.minPitch.set=function(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))},Fa.maxPitch.get=function(){return this._maxPitch},Fa.maxPitch.set=function(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))},Fa.renderWorldCopies.get=function(){return this._renderWorldCopies},Fa.renderWorldCopies.set=function(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n},Fa.worldSize.get=function(){return this.tileSize*this.scale},Fa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Fa.size.get=function(){return new p.Point(this.width,this.height)},Fa.bearing.get=function(){return-this.angle/Math.PI*180},Fa.bearing.set=function(n){var u=-p.wrap(n,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Fa.pitch.get=function(){return this._pitch/Math.PI*180},Fa.pitch.set=function(n){var u=p.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Fa.fov.get=function(){return this._fov/Math.PI*180},Fa.fov.set=function(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())},Fa.zoom.get=function(){return this._zoom},Fa.zoom.set=function(n){var u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Fa.center.get=function(){return this._center},Fa.center.set=function(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())},Fa.padding.get=function(){return this._edgeInsets.toJSON()},Fa.padding.set=function(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())},Fa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ra.prototype.isPaddingEqual=function(n){return this._edgeInsets.equals(n)},ra.prototype.interpolatePadding=function(n,u,o){this._unmodified=!1,this._edgeInsets.interpolate(n,u,o),this._constrain(),this._calcMatrices()},ra.prototype.coveringZoomLevel=function(n){var u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)},ra.prototype.getVisibleUnwrappedCoordinates=function(n){var u=[new p.UnwrappedTileID(0,n)];if(this._renderWorldCopies)for(var o=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),y=this.pointCoordinate(new p.Point(this.width,this.height)),b=this.pointCoordinate(new p.Point(0,this.height)),P=Math.floor(Math.min(o.x,h.x,y.x,b.x)),F=Math.floor(Math.max(o.x,h.x,y.x,b.x)),H=P-1;H<=F+1;H++)H!==0&&u.push(new p.UnwrappedTileID(H,n));return u},ra.prototype.coveringTiles=function(n){var u=this.coveringZoomLevel(n),o=u;if(n.minzoom!==void 0&&u<n.minzoom)return[];n.maxzoom!==void 0&&u>n.maxzoom&&(u=n.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),y=Math.pow(2,u),b=[y*h.x,y*h.y,0],P=Vu.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),F=n.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(F=u);var H=function(Qr){return{aabb:new Iu([Qr*y,0,0],[(Qr+1)*y,y,0]),zoom:0,x:0,y:0,wrap:Qr,fullyVisible:!1}},ae=[],xe=[],we=u,Te=n.reparseOverscaled?o:u;if(this._renderWorldCopies)for(var He=1;He<=3;He++)ae.push(H(-He)),ae.push(H(He));for(ae.push(H(0));ae.length>0;){var je=ae.pop(),it=je.x,ze=je.y,at=je.fullyVisible;if(!at){var xt=je.aabb.intersects(P);if(xt===0)continue;at=xt===2}var jt=je.aabb.distanceX(b),gr=je.aabb.distanceY(b),lr=Math.max(Math.abs(jt),Math.abs(gr));if(je.zoom===we||lr>3+(1<<we-je.zoom)-2&&je.zoom>=F)xe.push({tileID:new p.OverscaledTileID(je.zoom===we?Te:je.zoom,je.wrap,je.zoom,it,ze),distanceSq:p.sqrLen([b[0]-.5-it,b[1]-.5-ze])});else for(var _r=0;_r<4;_r++){var zr=(it<<1)+_r%2,on=(ze<<1)+(_r>>1);ae.push({aabb:je.aabb.quadrant(_r),zoom:je.zoom+1,x:zr,y:on,wrap:je.wrap,fullyVisible:at})}}return xe.sort(function(Qr,Pn){return Qr.distanceSq-Pn.distanceSq}).map(function(Qr){return Qr.tileID})},ra.prototype.resize=function(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()},Fa.unmodified.get=function(){return this._unmodified},ra.prototype.zoomScale=function(n){return Math.pow(2,n)},ra.prototype.scaleZoom=function(n){return Math.log(n)/Math.LN2},ra.prototype.project=function(n){var u=p.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(n.lng)*this.worldSize,p.mercatorYfromLat(u)*this.worldSize)},ra.prototype.unproject=function(n){return new p.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()},Fa.point.get=function(){return this.project(this.center)},ra.prototype.setLocationAtPoint=function(n,u){var o=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(n),b=new p.MercatorCoordinate(y.x-(o.x-h.x),y.y-(o.y-h.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())},ra.prototype.locationPoint=function(n){return this.coordinatePoint(this.locationCoordinate(n))},ra.prototype.pointLocation=function(n){return this.coordinateLocation(this.pointCoordinate(n))},ra.prototype.locationCoordinate=function(n){return p.MercatorCoordinate.fromLngLat(n)},ra.prototype.coordinateLocation=function(n){return n.toLngLat()},ra.prototype.pointCoordinate=function(n){var u=[n.x,n.y,0,1],o=[n.x,n.y,1,1];p.transformMat4(u,u,this.pixelMatrixInverse),p.transformMat4(o,o,this.pixelMatrixInverse);var h=u[3],y=o[3],b=u[1]/h,P=o[1]/y,F=u[2]/h,H=o[2]/y,ae=F===H?0:(0-F)/(H-F);return new p.MercatorCoordinate(p.number(u[0]/h,o[0]/y,ae)/this.worldSize,p.number(b,P,ae)/this.worldSize)},ra.prototype.coordinatePoint=function(n){var u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix),new p.Point(u[0]/u[3],u[1]/u[3])},ra.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},ra.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ra.prototype.setMaxBounds=function(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ra.prototype.calculatePosMatrix=function(n,u){u===void 0&&(u=!1);var o=n.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[o])return h[o];var y=n.canonical,b=this.worldSize/this.zoomScale(y.z),P=y.x+Math.pow(2,y.z)*n.wrap,F=p.identity(new Float64Array(16));return p.translate(F,F,[P*b,y.y*b,0]),p.scale(F,F,[b/p.EXTENT,b/p.EXTENT,1]),p.multiply(F,u?this.alignedProjMatrix:this.projMatrix,F),h[o]=new Float32Array(F),h[o]},ra.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ra.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var n,u,o,h,y=-90,b=90,P=-180,F=180,H=this.size,ae=this._unmodified;if(this.latRange){var xe=this.latRange;y=p.mercatorYfromLat(xe[1])*this.worldSize,n=(b=p.mercatorYfromLat(xe[0])*this.worldSize)-y<H.y?H.y/(b-y):0}if(this.lngRange){var we=this.lngRange;P=p.mercatorXfromLng(we[0])*this.worldSize,u=(F=p.mercatorXfromLng(we[1])*this.worldSize)-P<H.x?H.x/(F-P):0}var Te=this.point,He=Math.max(u||0,n||0);if(He)return this.center=this.unproject(new p.Point(u?(F+P)/2:Te.x,n?(b+y)/2:Te.y)),this.zoom+=this.scaleZoom(He),this._unmodified=ae,void(this._constraining=!1);if(this.latRange){var je=Te.y,it=H.y/2;je-it<y&&(h=y+it),je+it>b&&(h=b-it)}if(this.lngRange){var ze=Te.x,at=H.x/2;ze-at<P&&(o=P+at),ze+at>F&&(o=F-at)}o===void 0&&h===void 0||(this.center=this.unproject(new p.Point(o!==void 0?o:Te.x,h!==void 0?h:Te.y))),this._unmodified=ae,this._constraining=!1}},ra.prototype._calcMatrices=function(){if(this.height){var n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,o=this._fov*(.5+n.y/this.height),h=Math.sin(o)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-u-o,.01,Math.PI-.01)),y=this.point,b=y.x,P=y.y,F=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),H=this.height/50,ae=new Float64Array(16);p.perspective(ae,this._fov,this.width/this.height,H,F),ae[8]=2*-n.x/this.width,ae[9]=2*n.y/this.height,p.scale(ae,ae,[1,-1,1]),p.translate(ae,ae,[0,0,-this.cameraToCenterDistance]),p.rotateX(ae,ae,this._pitch),p.rotateZ(ae,ae,this.angle),p.translate(ae,ae,[-b,-P,0]),this.mercatorMatrix=p.scale([],ae,[this.worldSize,this.worldSize,this.worldSize]),p.scale(ae,ae,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ae,this.invProjMatrix=p.invert([],this.projMatrix);var xe=this.width%2/2,we=this.height%2/2,Te=Math.cos(this.angle),He=Math.sin(this.angle),je=b-Math.round(b)+Te*xe+He*we,it=P-Math.round(P)+Te*we+He*xe,ze=new Float64Array(ae);if(p.translate(ze,ze,[je>.5?je-1:je,it>.5?it-1:it,0]),this.alignedProjMatrix=ze,ae=p.create(),p.scale(ae,ae,[this.width/2,-this.height/2,1]),p.translate(ae,ae,[1,-1,0]),this.labelPlaneMatrix=ae,ae=p.create(),p.scale(ae,ae,[1,-1,1]),p.translate(ae,ae,[-1,-1,0]),p.scale(ae,ae,[2/this.width,2/this.height,1]),this.glCoordMatrix=ae,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ae=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ae,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ra.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var n=this.pointCoordinate(new p.Point(0,0)),u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},ra.prototype.getCameraPoint=function(){var n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,n))},ra.prototype.getCameraQueryGeometry=function(n){var u=this.getCameraPoint();if(n.length===1)return[n[0],u];for(var o=u.x,h=u.y,y=u.x,b=u.y,P=0,F=n;P<F.length;P+=1){var H=F[P];o=Math.min(o,H.x),h=Math.min(h,H.y),y=Math.max(y,H.x),b=Math.max(b,H.y)}return[new p.Point(o,h),new p.Point(y,h),new p.Point(y,b),new p.Point(o,b),new p.Point(o,h)]},Object.defineProperties(ra.prototype,Fa);var Cs=function(n){var u,o,h,y;this._hashName=n&&encodeURIComponent(n),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),o=!1,h=null,y=function(){h=null,o&&(u(),h=setTimeout(y,300),o=!1)},function(){return o=!0,h||y(),h})};Cs.prototype.addTo=function(n){return this._map=n,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Cs.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Cs.prototype.getHashString=function(n){var u=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,h=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,h),b=Math.round(u.lng*y)/y,P=Math.round(u.lat*y)/y,F=this._map.getBearing(),H=this._map.getPitch(),ae="";if(ae+=n?"/"+b+"/"+P+"/"+o:o+"/"+P+"/"+b,(F||H)&&(ae+="/"+Math.round(10*F)/10),H&&(ae+="/"+Math.round(H)),this._hashName){var xe=this._hashName,we=!1,Te=p.window.location.hash.slice(1).split("&").map(function(He){var je=He.split("=")[0];return je===xe?(we=!0,je+"="+ae):He}).filter(function(He){return He});return we||Te.push(xe+"="+ae),"#"+Te.join("&")}return"#"+ae},Cs.prototype._getCurrentHash=function(){var n,u=this,o=p.window.location.hash.replace("#","");return this._hashName?(o.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(n=h)}),(n&&n[1]||"").split("/")):o.split("/")},Cs.prototype._onHashChange=function(){var n=this._getCurrentHash();if(n.length>=3&&!n.some(function(o){return isNaN(o)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1},Cs.prototype._updateHashUnthrottled=function(){var n=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,n)}catch(u){}};var ql={linearity:.3,easing:p.bezier(0,0,.3,1)},vu=p.extend({deceleration:2500,maxSpeed:1400},ql),ec=p.extend({deceleration:20,maxSpeed:1400},ql),nf=p.extend({deceleration:1e3,maxSpeed:360},ql),af=p.extend({deceleration:1e3,maxSpeed:90},ql),cl=function(n){this._map=n,this.clear()};function Al(n,u){(!n.duration||n.duration<u.duration)&&(n.duration=u.duration,n.easing=u.easing)}function Ou(n,u,o){var h=o.maxSpeed,y=o.linearity,b=o.deceleration,P=p.clamp(n*y/(u/1e3),-h,h),F=Math.abs(P)/(b*y);return{easing:o.easing,duration:1e3*F,amount:P*(F/2)}}cl.prototype.clear=function(){this._inertiaBuffer=[]},cl.prototype.record=function(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:n})},cl.prototype._drainInertiaBuffer=function(){for(var n=this._inertiaBuffer,u=p.browser.now();n.length>0&&u-n[0].time>160;)n.shift()},cl.prototype._onMoveEnd=function(n){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},o=0,h=this._inertiaBuffer;o<h.length;o+=1){var y=h[o].settings;u.zoom+=y.zoomDelta||0,u.bearing+=y.bearingDelta||0,u.pitch+=y.pitchDelta||0,y.panDelta&&u.pan._add(y.panDelta),y.around&&(u.around=y.around),y.pinchAround&&(u.pinchAround=y.pinchAround)}var b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(u.pan.mag()){var F=Ou(u.pan.mag(),b,p.extend({},vu,n||{}));P.offset=u.pan.mult(F.amount/u.pan.mag()),P.center=this._map.transform.center,Al(P,F)}if(u.zoom){var H=Ou(u.zoom,b,ec);P.zoom=this._map.transform.zoom+H.amount,Al(P,H)}if(u.bearing){var ae=Ou(u.bearing,b,nf);P.bearing=this._map.transform.bearing+p.clamp(ae.amount,-179,179),Al(P,ae)}if(u.pitch){var xe=Ou(u.pitch,b,af);P.pitch=this._map.transform.pitch+xe.amount,Al(P,xe)}if(P.zoom||P.bearing){var we=u.pinchAround===void 0?u.around:u.pinchAround;P.around=we?this._map.unproject(we):this._map.getCenter()}return this.clear(),p.extend(P,{noMoveStart:!0})}};var Ro=function(n){function u(h,y,b,P){P===void 0&&(P={});var F=q.mousePos(y.getCanvasContainer(),b),H=y.unproject(F);n.call(this,h,p.extend({point:F,lngLat:H,originalEvent:b},P)),this._defaultPrevented=!1,this.target=y}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),Tl=function(n){function u(h,y,b){var P=h==="touchend"?b.changedTouches:b.touches,F=q.touchPos(y.getCanvasContainer(),P),H=F.map(function(we){return y.unproject(we)}),ae=F.reduce(function(we,Te,He,je){return we.add(Te.div(je.length))},new p.Point(0,0)),xe=y.unproject(ae);n.call(this,h,{points:F,point:ae,lngLats:H,lngLat:xe,originalEvent:b}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),Zs=function(n){function u(h,y,b){n.call(this,h,{originalEvent:b}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),Eo=function(n,u){this._map=n,this._clickTolerance=u.clickTolerance};Eo.prototype.reset=function(){delete this._mousedownPos},Eo.prototype.wheel=function(n){return this._firePreventable(new Zs(n.type,this._map,n))},Eo.prototype.mousedown=function(n,u){return this._mousedownPos=u,this._firePreventable(new Ro(n.type,this._map,n))},Eo.prototype.mouseup=function(n){this._map.fire(new Ro(n.type,this._map,n))},Eo.prototype.click=function(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Ro(n.type,this._map,n))},Eo.prototype.dblclick=function(n){return this._firePreventable(new Ro(n.type,this._map,n))},Eo.prototype.mouseover=function(n){this._map.fire(new Ro(n.type,this._map,n))},Eo.prototype.mouseout=function(n){this._map.fire(new Ro(n.type,this._map,n))},Eo.prototype.touchstart=function(n){return this._firePreventable(new Tl(n.type,this._map,n))},Eo.prototype.touchmove=function(n){this._map.fire(new Tl(n.type,this._map,n))},Eo.prototype.touchend=function(n){this._map.fire(new Tl(n.type,this._map,n))},Eo.prototype.touchcancel=function(n){this._map.fire(new Tl(n.type,this._map,n))},Eo.prototype._firePreventable=function(n){if(this._map.fire(n),n.defaultPrevented)return{}},Eo.prototype.isEnabled=function(){return!0},Eo.prototype.isActive=function(){return!1},Eo.prototype.enable=function(){},Eo.prototype.disable=function(){};var Bn=function(n){this._map=n};Bn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Bn.prototype.mousemove=function(n){this._map.fire(new Ro(n.type,this._map,n))},Bn.prototype.mousedown=function(){this._delayContextMenu=!0},Bn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ro("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Bn.prototype.contextmenu=function(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Ro(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()},Bn.prototype.isEnabled=function(){return!0},Bn.prototype.isActive=function(){return!1},Bn.prototype.enable=function(){},Bn.prototype.disable=function(){};var mo=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1};function mu(n,u){for(var o={},h=0;h<n.length;h++)o[n[h].identifier]=u[h];return o}mo.prototype.isEnabled=function(){return!!this._enabled},mo.prototype.isActive=function(){return!!this._active},mo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},mo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},mo.prototype.mousedown=function(n,u){this.isEnabled()&&n.shiftKey&&n.button===0&&(q.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},mo.prototype.mousemoveWindow=function(n,u){if(this._active){var o=u;if(!(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=o,this._box||(this._box=q.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));var y=Math.min(h.x,o.x),b=Math.max(h.x,o.x),P=Math.min(h.y,o.y),F=Math.max(h.y,o.y);q.setTransform(this._box,"translate("+y+"px,"+P+"px)"),this._box.style.width=b-y+"px",this._box.style.height=F-P+"px"}}},mo.prototype.mouseupWindow=function(n,u){var o=this;if(this._active&&n.button===0){var h=this._startPos,y=u;if(this.reset(),q.suppressClick(),h.x!==y.x||h.y!==y.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:function(b){return b.fitScreenCoordinates(h,y,o._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",n)}},mo.prototype.keydown=function(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))},mo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos},mo.prototype._fireEvent=function(n,u){return this._map.fire(new p.Event(n,{originalEvent:u}))};var fl=function(n){this.reset(),this.numTouches=n.numTouches};fl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},fl.prototype.touchstart=function(n,u,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),o.length===this.numTouches&&(this.centroid=function(h){for(var y=new p.Point(0,0),b=0,P=h;b<P.length;b+=1)y._add(P[b]);return y.div(h.length)}(u),this.touches=mu(o,u)))},fl.prototype.touchmove=function(n,u,o){if(!this.aborted&&this.centroid){var h=mu(o,u);for(var y in this.touches){var b=h[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}},fl.prototype.touchend=function(n,u,o){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var $s=function(n){this.singleTap=new fl(n),this.numTaps=n.numTaps,this.reset()};$s.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},$s.prototype.touchstart=function(n,u,o){this.singleTap.touchstart(n,u,o)},$s.prototype.touchmove=function(n,u,o){this.singleTap.touchmove(n,u,o)},$s.prototype.touchend=function(n,u,o){var h=this.singleTap.touchend(n,u,o);if(h){var y=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(h)<30;if(y&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var ws=function(){this._zoomIn=new $s({numTouches:1,numTaps:2}),this._zoomOut=new $s({numTouches:2,numTaps:1}),this.reset()};ws.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ws.prototype.touchstart=function(n,u,o){this._zoomIn.touchstart(n,u,o),this._zoomOut.touchstart(n,u,o)},ws.prototype.touchmove=function(n,u,o){this._zoomIn.touchmove(n,u,o),this._zoomOut.touchmove(n,u,o)},ws.prototype.touchend=function(n,u,o){var h=this,y=this._zoomIn.touchend(n,u,o),b=this._zoomOut.touchend(n,u,o);return y?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(y)},{originalEvent:n})}}):b?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(b)},{originalEvent:n})}}):void 0},ws.prototype.touchcancel=function(){this.reset()},ws.prototype.enable=function(){this._enabled=!0},ws.prototype.disable=function(){this._enabled=!1,this.reset()},ws.prototype.isEnabled=function(){return this._enabled},ws.prototype.isActive=function(){return this._active};var Sc={0:1,2:2},gn=function(n){this.reset(),this._clickTolerance=n.clickTolerance||1};gn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},gn.prototype._correctButton=function(n,u){return!1},gn.prototype._move=function(n,u){return{}},gn.prototype.mousedown=function(n,u){if(!this._lastPoint){var o=q.mouseButton(n);this._correctButton(n,o)&&(this._lastPoint=u,this._eventButton=o)}},gn.prototype.mousemoveWindow=function(n,u){var o=this._lastPoint;if(o){if(n.preventDefault(),function(h,y){var b=Sc[y];return h.buttons===void 0||(h.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(u.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(o,u)}},gn.prototype.mouseupWindow=function(n){this._lastPoint&&q.mouseButton(n)===this._eventButton&&(this._moved&&q.suppressClick(),this.reset())},gn.prototype.enable=function(){this._enabled=!0},gn.prototype.disable=function(){this._enabled=!1,this.reset()},gn.prototype.isEnabled=function(){return this._enabled},gn.prototype.isActive=function(){return this._active};var tc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.mousedown=function(o,h){n.prototype.mousedown.call(this,o,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(o,h){return h===0&&!o.ctrlKey},u.prototype._move=function(o,h){return{around:h,panDelta:h.sub(o)}},u}(gn),rc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var y=.8*(h.x-o.x);if(y)return this._active=!0,{bearingDelta:y}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(gn),Lu=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var y=-.5*(h.y-o.y);if(y)return this._active=!0,{pitchDelta:y}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(gn),Ua=function(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()};Ua.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},Ua.prototype.touchstart=function(n,u,o){return this._calculateTransform(n,u,o)},Ua.prototype.touchmove=function(n,u,o){if(this._active&&!(o.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,u,o)},Ua.prototype.touchend=function(n,u,o){this._calculateTransform(n,u,o),this._active&&o.length<this._minTouches&&this.reset()},Ua.prototype.touchcancel=function(){this.reset()},Ua.prototype._calculateTransform=function(n,u,o){o.length>0&&(this._active=!0);var h=mu(o,u),y=new p.Point(0,0),b=new p.Point(0,0),P=0;for(var F in h){var H=h[F],ae=this._touches[F];ae&&(y._add(H),b._add(H.sub(ae)),P++,h[F]=H)}if(this._touches=h,!(P<this._minTouches)&&b.mag()){var xe=b.div(P);if(this._sum._add(xe),!(this._sum.mag()<this._clickTolerance))return{around:y.div(P),panDelta:xe}}},Ua.prototype.enable=function(){this._enabled=!0},Ua.prototype.disable=function(){this._enabled=!1,this.reset()},Ua.prototype.isEnabled=function(){return this._enabled},Ua.prototype.isActive=function(){return this._active};var As=function(){this.reset()};function nc(n,u,o){for(var h=0;h<n.length;h++)if(n[h].identifier===o)return u[h]}function gu(n,u){return Math.log(n/u)/Math.LN2}As.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},As.prototype._start=function(n){},As.prototype._move=function(n,u,o){return{}},As.prototype.touchstart=function(n,u,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([u[0],u[1]]))},As.prototype.touchmove=function(n,u,o){if(this._firstTwoTouches){n.preventDefault();var h=this._firstTwoTouches,y=h[1],b=nc(o,u,h[0]),P=nc(o,u,y);if(b&&P){var F=this._aroundCenter?null:b.add(P).div(2);return this._move([b,P],F,n)}}},As.prototype.touchend=function(n,u,o){if(this._firstTwoTouches){var h=this._firstTwoTouches,y=h[1],b=nc(o,u,h[0]),P=nc(o,u,y);b&&P||(this._active&&q.suppressClick(),this.reset())}},As.prototype.touchcancel=function(){this.reset()},As.prototype.enable=function(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"},As.prototype.disable=function(){this._enabled=!1,this.reset()},As.prototype.isEnabled=function(){return this._enabled},As.prototype.isActive=function(){return this._active};var Ts=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(o){this._startDistance=this._distance=o[0].dist(o[1])},u.prototype._move=function(o,h){var y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(gu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gu(this._distance,y),pinchAround:h}},u}(As);function yu(n,u){return 180*n.angleWith(u)/Math.PI}var zc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])},u.prototype._move=function(o,h){var y=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:yu(this._vector,y),pinchAround:h}},u.prototype._isBelowThreshold=function(o){this._minDiameter=Math.min(this._minDiameter,o.mag());var h=25/(Math.PI*this._minDiameter)*360,y=yu(o,this._startVector);return Math.abs(y)<h},u}(As);function Pl(n){return Math.abs(n.y)>Math.abs(n.x)}var Ec=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(o){this._lastPoints=o,Pl(o[0].sub(o[1]))&&(this._valid=!1)},u.prototype._move=function(o,h,y){var b=o[0].sub(this._lastPoints[0]),P=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(b,P,y.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(b.y+P.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(o,h,y){if(this._valid!==void 0)return this._valid;var b=o.mag()>=2,P=h.mag()>=2;if(b||P){if(!b||!P)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;var F=o.y>0==h.y>0;return Pl(o)&&Pl(h)&&F}},u}(As),Cc={panStep:100,bearingStep:15,pitchStep:10},Js=function(){var n=Cc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1};function Ps(n){return n*(2-n)}Js.prototype.reset=function(){this._active=!1},Js.prototype.keydown=function(n){var u=this;if(!(n.altKey||n.ctrlKey||n.metaKey)){var o=0,h=0,y=0,b=0,P=0;switch(n.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),P=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(h=0,y=0),{cameraAnimation:function(F){var H=F.getZoom();F.easeTo({duration:300,easeId:"keyboardHandler",easing:Ps,zoom:o?Math.round(H)+o*(n.shiftKey?2:1):H,bearing:F.getBearing()+h*u._bearingStep,pitch:F.getPitch()+y*u._pitchStep,offset:[-b*u._panStep,-P*u._panStep],center:F.getCenter()},{originalEvent:n})}}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active},Js.prototype.disableRotation=function(){this._rotationDisabled=!0},Js.prototype.enableRotation=function(){this._rotationDisabled=!1};var na=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};na.prototype.setZoomRate=function(n){this._defaultZoomRate=n},na.prototype.setWheelZoomRate=function(n){this._wheelZoomRate=n},na.prototype.isEnabled=function(){return!!this._enabled},na.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},na.prototype.isZooming=function(){return!!this._zooming},na.prototype.enable=function(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&n.around==="center")},na.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},na.prototype.wheel=function(n){if(this.isEnabled()){var u=n.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,o=p.browser.now(),h=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}},na.prototype._onTimeout=function(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)},na.prototype._start=function(n){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=q.mousePos(this._el,n);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},na.prototype.renderFrame=function(){var n=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var o=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*o)));this._delta<0&&h!==0&&(h=1/h);var y=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(y*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var b,P=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,F=this._startZoom,H=this._easing,ae=!1;if(this._type==="wheel"&&F&&H){var xe=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),we=H(xe);b=p.number(F,P,we),xe<1?this._frameId||(this._frameId=!0):ae=!0}else b=P,ae=!0;return this._active=!0,ae&&(this._active=!1,this._finishTimeout=setTimeout(function(){n._zooming=!1,n._handler._triggerRenderFrame(),delete n._targetZoom,delete n._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ae,zoomDelta:b-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},na.prototype._smoothOutEasing=function(n){var u=p.ease;if(this._prevEase){var o=this._prevEase,h=(p.browser.now()-o.start)/o.duration,y=o.easing(h+.01)-o.easing(h),b=.27/Math.sqrt(y*y+1e-4)*.01,P=Math.sqrt(.0729-b*b);u=p.bezier(b,P,.25,1)}return this._prevEase={start:p.browser.now(),duration:n,easing:u},u},na.prototype.reset=function(){this._active=!1};var _u=function(n,u){this._clickZoom=n,this._tapZoom=u};_u.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},_u.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},_u.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},_u.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Qs=function(){this.reset()};Qs.prototype.reset=function(){this._active=!1},Qs.prototype.dblclick=function(n,u){return n.preventDefault(),{cameraAnimation:function(o){o.easeTo({duration:300,zoom:o.getZoom()+(n.shiftKey?-1:1),around:o.unproject(u)},{originalEvent:n})}}},Qs.prototype.enable=function(){this._enabled=!0},Qs.prototype.disable=function(){this._enabled=!1,this.reset()},Qs.prototype.isEnabled=function(){return this._enabled},Qs.prototype.isActive=function(){return this._active};var Uo=function(){this._tap=new $s({numTouches:1,numTaps:1}),this.reset()};Uo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Uo.prototype.touchstart=function(n,u,o){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=u[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(n,u,o))},Uo.prototype.touchmove=function(n,u,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;var h=u[0],y=h.y-this._swipePoint.y;return this._swipePoint=h,n.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(n,u,o)},Uo.prototype.touchend=function(n,u,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(n,u,o)&&(this._tapTime=n.timeStamp)},Uo.prototype.touchcancel=function(){this.reset()},Uo.prototype.enable=function(){this._enabled=!0},Uo.prototype.disable=function(){this._enabled=!1,this.reset()},Uo.prototype.isEnabled=function(){return this._enabled},Uo.prototype.isActive=function(){return this._active};var Gu=function(n,u,o){this._el=n,this._mousePan=u,this._touchPan=o};Gu.prototype.enable=function(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Gu.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Gu.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Gu.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ru=function(n,u,o){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=o};ru.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ru.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ru.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ru.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var nu=function(n,u,o,h){this._el=n,this._touchZoom=u,this._touchRotate=o,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};nu.prototype.enable=function(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},nu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},nu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},nu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},nu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},nu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Co=function(n){return n.zoom||n.drag||n.pitch||n.rotate},Hu=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u}(p.Event);function ri(n){return n.panDelta&&n.panDelta.mag()||n.zoomDelta||n.bearingDelta||n.pitchDelta}var Kn=function(n,u){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cl(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);var o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,y=this._listeners;h<y.length;h+=1){var b=y[h],P=b[0];q.addEventListener(P,b[1],P===p.window.document?this.handleWindowEvent:this.handleEvent,b[2])}};Kn.prototype.destroy=function(){for(var n=0,u=this._listeners;n<u.length;n+=1){var o=u[n],h=o[0];q.removeEventListener(h,o[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,o[2])}},Kn.prototype._addDefaultHandlers=function(n){var u=this._map,o=u.getCanvasContainer();this._add("mapEvent",new Eo(u,n));var h=u.boxZoom=new mo(u,n);this._add("boxZoom",h);var y=new ws,b=new Qs;u.doubleClickZoom=new _u(b,y),this._add("tapZoom",y),this._add("clickZoom",b);var P=new Uo;this._add("tapDragZoom",P);var F=u.touchPitch=new Ec;this._add("touchPitch",F);var H=new rc(n),ae=new Lu(n);u.dragRotate=new ru(n,H,ae),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",ae,["mouseRotate"]);var xe=new tc(n),we=new Ua(n);u.dragPan=new Gu(o,xe,we),this._add("mousePan",xe),this._add("touchPan",we,["touchZoom","touchRotate"]);var Te=new zc,He=new Ts;u.touchZoomRotate=new nu(o,He,Te,P),this._add("touchRotate",Te,["touchPan","touchZoom"]),this._add("touchZoom",He,["touchPan","touchRotate"]);var je=u.scrollZoom=new na(u,this);this._add("scrollZoom",je,["mousePan"]);var it=u.keyboard=new Js;this._add("keyboard",it),this._add("blockableMapEvent",new Bn(u));for(var ze=0,at=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ze<at.length;ze+=1){var xt=at[ze];n.interactive&&n[xt]&&u[xt].enable(n[xt])}},Kn.prototype._add=function(n,u,o){this._handlers.push({handlerName:n,handler:u,allowed:o}),this._handlersById[n]=u},Kn.prototype.stop=function(n){if(!this._updatingCamera){for(var u=0,o=this._handlers;u<o.length;u+=1)o[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}},Kn.prototype.isActive=function(){for(var n=0,u=this._handlers;n<u.length;n+=1)if(u[n].handler.isActive())return!0;return!1},Kn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Kn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Kn.prototype.isMoving=function(){return Boolean(Co(this._eventsInProgress))||this.isZooming()},Kn.prototype._blockedByActive=function(n,u,o){for(var h in n)if(h!==o&&(!u||u.indexOf(h)<0))return!0;return!1},Kn.prototype.handleWindowEvent=function(n){this.handleEvent(n,n.type+"Window")},Kn.prototype._getMapTouches=function(n){for(var u=[],o=0,h=n;o<h.length;o+=1){var y=h[o];this._el.contains(y.target)&&u.push(y)}return u},Kn.prototype.handleEvent=function(n,u){if(n.type!=="blur"){this._updatingCamera=!0;for(var o=n.type==="renderFrame"?void 0:n,h={needsRenderFrame:!1},y={},b={},P=n.touches?this._getMapTouches(n.touches):void 0,F=P?q.touchPos(this._el,P):q.mousePos(this._el,n),H=0,ae=this._handlers;H<ae.length;H+=1){var xe=ae[H],we=xe.handlerName,Te=xe.handler,He=xe.allowed;if(Te.isEnabled()){var je=void 0;this._blockedByActive(b,He,we)?Te.reset():Te[u||n.type]&&(je=Te[u||n.type](n,F,P),this.mergeHandlerResult(h,y,je,we,o),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Te.isActive())&&(b[we]=Te)}}var it={};for(var ze in this._previousActiveHandlers)b[ze]||(it[ze]=o);this._previousActiveHandlers=b,(Object.keys(it).length||ri(h))&&(this._changes.push([h,y,it]),this._triggerRenderFrame()),(Object.keys(b).length||ri(h))&&this._map._stop(!0),this._updatingCamera=!1;var at=h.cameraAnimation;at&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],at(this._map))}else this.stop(!0)},Kn.prototype.mergeHandlerResult=function(n,u,o,h,y){if(o){p.extend(n,o);var b={handlerName:h,originalEvent:o.originalEvent||y};o.zoomDelta!==void 0&&(u.zoom=b),o.panDelta!==void 0&&(u.drag=b),o.pitchDelta!==void 0&&(u.pitch=b),o.bearingDelta!==void 0&&(u.rotate=b)}},Kn.prototype._applyChanges=function(){for(var n={},u={},o={},h=0,y=this._changes;h<y.length;h+=1){var b=y[h],P=b[0],F=b[1],H=b[2];P.panDelta&&(n.panDelta=(n.panDelta||new p.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(n.around=P.around),P.pinchAround!==void 0&&(n.pinchAround=P.pinchAround),P.noInertia&&(n.noInertia=P.noInertia),p.extend(u,F),p.extend(o,H)}this._updateMapTransform(n,u,o),this._changes=[]},Kn.prototype._updateMapTransform=function(n,u,o){var h=this._map,y=h.transform;if(!ri(n))return this._fireEvents(u,o,!0);var b=n.panDelta,P=n.zoomDelta,F=n.bearingDelta,H=n.pitchDelta,ae=n.around,xe=n.pinchAround;xe!==void 0&&(ae=xe),h._stop(!0),ae=ae||h.transform.centerPoint;var we=y.pointLocation(b?ae.sub(b):ae);F&&(y.bearing+=F),H&&(y.pitch+=H),P&&(y.zoom+=P),y.setLocationAtPoint(we,ae),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,o,!0)},Kn.prototype._fireEvents=function(n,u,o){var h=this,y=Co(this._eventsInProgress),b=Co(n),P={};for(var F in n)this._eventsInProgress[F]||(P[F+"start"]=n[F].originalEvent),this._eventsInProgress[F]=n[F];for(var H in!y&&b&&this._fireEvent("movestart",b.originalEvent),P)this._fireEvent(H,P[H]);for(var ae in b&&this._fireEvent("move",b.originalEvent),n)this._fireEvent(ae,n[ae].originalEvent);var xe,we={};for(var Te in this._eventsInProgress){var He=this._eventsInProgress[Te],je=He.handlerName,it=He.originalEvent;this._handlersById[je].isActive()||(delete this._eventsInProgress[Te],we[Te+"end"]=xe=u[je]||it)}for(var ze in we)this._fireEvent(ze,we[ze]);var at=Co(this._eventsInProgress);if(o&&(y||b)&&!at){this._updatingCamera=!0;var xt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),jt=function(gr){return gr!==0&&-h._bearingSnap<gr&&gr<h._bearingSnap};xt?(jt(xt.bearing||this._map.getBearing())&&(xt.bearing=0),this._map.easeTo(xt,{originalEvent:xe})):(this._map.fire(new p.Event("moveend",{originalEvent:xe})),jt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Kn.prototype._fireEvent=function(n,u){this._map.fire(new p.Event(n,u?{originalEvent:u}:{}))},Kn.prototype._requestFrame=function(){var n=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete n._frameId,n.handleEvent(new Hu("renderFrame",{timeStamp:u})),n._applyChanges()})},Kn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Ml=function(n){function u(o,h){n.call(this),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(o,h){return this.jumpTo({center:o},h)},u.prototype.panBy=function(o,h,y){return o=p.Point.convert(o).mult(-1),this.panTo(this.transform.center,p.extend({offset:o},h),y)},u.prototype.panTo=function(o,h,y){return this.easeTo(p.extend({center:o},h),y)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(o,h){return this.jumpTo({zoom:o},h),this},u.prototype.zoomTo=function(o,h,y){return this.easeTo(p.extend({zoom:o},h),y)},u.prototype.zoomIn=function(o,h){return this.zoomTo(this.getZoom()+1,o,h),this},u.prototype.zoomOut=function(o,h){return this.zoomTo(this.getZoom()-1,o,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(o,h){return this.jumpTo({bearing:o},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(o,h){return this.jumpTo({padding:o},h),this},u.prototype.rotateTo=function(o,h,y){return this.easeTo(p.extend({bearing:o},h),y)},u.prototype.resetNorth=function(o,h){return this.rotateTo(0,p.extend({duration:1e3},o),h),this},u.prototype.resetNorthPitch=function(o,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},o),h),this},u.prototype.snapToNorth=function(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(o,h){return this.jumpTo({pitch:o},h),this},u.prototype.cameraForBounds=function(o,h){o=p.LngLatBounds.convert(o);var y=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),y,h)},u.prototype._cameraForBoxAndBearing=function(o,h,y,b){var P={top:0,bottom:0,right:0,left:0};if(typeof(b=p.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){var F=b.padding;b.padding={top:F,bottom:F,right:F,left:F}}b.padding=p.extend(P,b.padding);var H=this.transform,ae=H.padding,xe=H.project(p.LngLat.convert(o)),we=H.project(p.LngLat.convert(h)),Te=xe.rotate(-y*Math.PI/180),He=we.rotate(-y*Math.PI/180),je=new p.Point(Math.max(Te.x,He.x),Math.max(Te.y,He.y)),it=new p.Point(Math.min(Te.x,He.x),Math.min(Te.y,He.y)),ze=je.sub(it),at=(H.width-(ae.left+ae.right+b.padding.left+b.padding.right))/ze.x,xt=(H.height-(ae.top+ae.bottom+b.padding.top+b.padding.bottom))/ze.y;if(!(xt<0||at<0)){var jt=Math.min(H.scaleZoom(H.scale*Math.min(at,xt)),b.maxZoom),gr=typeof b.offset.x=="number"?new p.Point(b.offset.x,b.offset.y):p.Point.convert(b.offset),lr=new p.Point((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(y*Math.PI/180),_r=gr.add(lr).mult(H.scale/H.zoomScale(jt));return{center:H.unproject(xe.add(we).div(2).sub(_r)),zoom:jt,bearing:y}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(o,h,y){return this._fitInternal(this.cameraForBounds(o,h),h,y)},u.prototype.fitScreenCoordinates=function(o,h,y,b,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(o)),this.transform.pointLocation(p.Point.convert(h)),y,b),b,P)},u.prototype._fitInternal=function(o,h,y){return o?(delete(h=p.extend(o,h)).padding,h.linear?this.easeTo(h,y):this.flyTo(h,y)):this},u.prototype.jumpTo=function(o,h){this.stop();var y=this.transform,b=!1,P=!1,F=!1;return"zoom"in o&&y.zoom!==+o.zoom&&(b=!0,y.zoom=+o.zoom),o.center!==void 0&&(y.center=p.LngLat.convert(o.center)),"bearing"in o&&y.bearing!==+o.bearing&&(P=!0,y.bearing=+o.bearing),"pitch"in o&&y.pitch!==+o.pitch&&(F=!0,y.pitch=+o.pitch),o.padding==null||y.isPaddingEqual(o.padding)||(y.padding=o.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),b&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),P&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),F&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},u.prototype.easeTo=function(o,h){var y=this;this._stop(!1,o.easeId),((o=p.extend({offset:[0,0],duration:500,easing:p.ease},o)).animate===!1||!o.essential&&p.browser.prefersReducedMotion)&&(o.duration=0);var b=this.transform,P=this.getZoom(),F=this.getBearing(),H=this.getPitch(),ae=this.getPadding(),xe="zoom"in o?+o.zoom:P,we="bearing"in o?this._normalizeBearing(o.bearing,F):F,Te="pitch"in o?+o.pitch:H,He="padding"in o?o.padding:b.padding,je=p.Point.convert(o.offset),it=b.centerPoint.add(je),ze=b.pointLocation(it),at=p.LngLat.convert(o.center||ze);this._normalizeCenter(at);var xt,jt,gr=b.project(ze),lr=b.project(at).sub(gr),_r=b.zoomScale(xe-P);o.around&&(xt=p.LngLat.convert(o.around),jt=b.locationPoint(xt));var zr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||xe!==P,this._rotating=this._rotating||F!==we,this._pitching=this._pitching||Te!==H,this._padding=!b.isPaddingEqual(He),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,zr),this._ease(function(on){if(y._zooming&&(b.zoom=p.number(P,xe,on)),y._rotating&&(b.bearing=p.number(F,we,on)),y._pitching&&(b.pitch=p.number(H,Te,on)),y._padding&&(b.interpolatePadding(ae,He,on),it=b.centerPoint.add(je)),xt)b.setLocationAtPoint(xt,jt);else{var Qr=b.zoomScale(b.zoom-P),Pn=xe>P?Math.min(2,_r):Math.max(.5,_r),ei=Math.pow(Pn,1-on),ci=b.unproject(gr.add(lr.mult(on*ei)).mult(Qr));b.setLocationAtPoint(b.renderWorldCopies?ci.wrap():ci,it)}y._fireMoveEvents(h)},function(on){y._afterEase(h,on)},o),this},u.prototype._prepareEase=function(o,h,y){y===void 0&&(y={}),this._moving=!0,h||y.moving||this.fire(new p.Event("movestart",o)),this._zooming&&!y.zooming&&this.fire(new p.Event("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new p.Event("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new p.Event("pitchstart",o))},u.prototype._fireMoveEvents=function(o){this.fire(new p.Event("move",o)),this._zooming&&this.fire(new p.Event("zoom",o)),this._rotating&&this.fire(new p.Event("rotate",o)),this._pitching&&this.fire(new p.Event("pitch",o))},u.prototype._afterEase=function(o,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var y=this._zooming,b=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new p.Event("zoomend",o)),b&&this.fire(new p.Event("rotateend",o)),P&&this.fire(new p.Event("pitchend",o)),this.fire(new p.Event("moveend",o))}},u.prototype.flyTo=function(o,h){var y=this;if(!o.essential&&p.browser.prefersReducedMotion){var b=p.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(b,h)}this.stop(),o=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},o);var P=this.transform,F=this.getZoom(),H=this.getBearing(),ae=this.getPitch(),xe=this.getPadding(),we="zoom"in o?p.clamp(+o.zoom,P.minZoom,P.maxZoom):F,Te="bearing"in o?this._normalizeBearing(o.bearing,H):H,He="pitch"in o?+o.pitch:ae,je="padding"in o?o.padding:P.padding,it=P.zoomScale(we-F),ze=p.Point.convert(o.offset),at=P.centerPoint.add(ze),xt=P.pointLocation(at),jt=p.LngLat.convert(o.center||xt);this._normalizeCenter(jt);var gr=P.project(xt),lr=P.project(jt).sub(gr),_r=o.curve,zr=Math.max(P.width,P.height),on=zr/it,Qr=lr.mag();if("minZoom"in o){var Pn=p.clamp(Math.min(o.minZoom,F,we),P.minZoom,P.maxZoom),ei=zr/P.zoomScale(Pn-F);_r=Math.sqrt(ei/Qr*2)}var ci=_r*_r;function ti(k){var te=(on*on-zr*zr+(k?-1:1)*ci*ci*Qr*Qr)/(2*(k?on:zr)*ci*Qr);return Math.log(Math.sqrt(te*te+1)-te)}function aa(k){return(Math.exp(k)-Math.exp(-k))/2}function jn(k){return(Math.exp(k)+Math.exp(-k))/2}var xi=ti(0),zi=function(k){return jn(xi)/jn(xi+_r*k)},J=function(k){return zr*((jn(xi)*(aa(te=xi+_r*k)/jn(te))-aa(xi))/ci)/Qr;var te},Q=(ti(1)-xi)/_r;if(Math.abs(Qr)<1e-6||!isFinite(Q)){if(Math.abs(zr-on)<1e-6)return this.easeTo(o,h);var D=on<zr?-1:1;Q=Math.abs(Math.log(on/zr))/_r,J=function(){return 0},zi=function(k){return Math.exp(D*_r*k)}}return o.duration="duration"in o?+o.duration:1e3*Q/("screenSpeed"in o?+o.screenSpeed/_r:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=H!==Te,this._pitching=He!==ae,this._padding=!P.isPaddingEqual(je),this._prepareEase(h,!1),this._ease(function(k){var te=k*Q,Ce=1/zi(te);P.zoom=k===1?we:F+P.scaleZoom(Ce),y._rotating&&(P.bearing=p.number(H,Te,k)),y._pitching&&(P.pitch=p.number(ae,He,k)),y._padding&&(P.interpolatePadding(xe,je,k),at=P.centerPoint.add(ze));var st=k===1?jt:P.unproject(gr.add(lr.mult(J(te))).mult(Ce));P.setLocationAtPoint(P.renderWorldCopies?st.wrap():st,at),y._fireMoveEvents(h)},function(){return y._afterEase(h)},o),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}if(!o){var b=this.handlers;b&&b.stop(!1)}return this},u.prototype._ease=function(o,h,y){y.animate===!1||y.duration===0?(o(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var o=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(o,h){o=p.wrap(o,-180,180);var y=Math.abs(o-h);return Math.abs(o-360-h)<y&&(o-=360),Math.abs(o+360-h)<y&&(o+=360),o},u.prototype._normalizeCenter=function(o){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var y=o.lng-h.center.lng;o.lng+=y>180?-360:y<-180?360:0}},u}(p.Evented),as=function(n){n===void 0&&(n={}),this.options=n,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};as.prototype.getDefaultPosition=function(){return"bottom-right"},as.prototype.onAdd=function(n){var u=this.options&&this.options.compact;return this._map=n,this._container=q.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=q.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},as.prototype.onRemove=function(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},as.prototype._setElementTitle=function(n,u){var o=this._map._getUIString("AttributionControl."+u);n.title=o,n.setAttribute("aria-label",o)},as.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},as.prototype._updateEditLink=function(){var n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(n){var o=u.reduce(function(h,y,b){return y.value&&(h+=y.key+"="+y.value+(b<u.length-1?"&":"")),h},"?");n.href=p.config.FEEDBACK_URL+"/"+o+(this._map._hash?this._map._hash.getHashString(!0):""),n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}},as.prototype._updateData=function(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},as.prototype._updateAttributions=function(){if(this._map.style){var n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(function(F){return typeof F!="string"?"":F})):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var o=this._map.style.sourceCaches;for(var h in o){var y=o[h];if(y.used){var b=y.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort(function(F,H){return F.length-H.length});var P=(n=n.filter(function(F,H){for(var ae=H+1;ae<n.length;ae++)if(n[ae].indexOf(F)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,n.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},as.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var js=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};js.prototype.onAdd=function(n){this._map=n,this._container=q.create("div","mapboxgl-ctrl");var u=q.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},js.prototype.onRemove=function(){q.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},js.prototype.getDefaultPosition=function(){return"bottom-left"},js.prototype._updateLogo=function(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},js.prototype._logoRequired=function(){if(this._map.style){var n=this._map.style.sourceCaches;for(var u in n)if(n[u].getSource().mapbox_logo)return!0;return!1}},js.prototype._updateCompact=function(){var n=this._container.children;if(n.length){var u=n[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var Zo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Zo.prototype.add=function(n){var u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u},Zo.prototype.remove=function(n){for(var u=this._currentlyRunning,o=0,h=u?this._queue.concat(u):this._queue;o<h.length;o+=1){var y=h[o];if(y.id===n)return void(y.cancelled=!0)}},Zo.prototype.run=function(n){n===void 0&&(n=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var o=0,h=u;o<h.length;o+=1){var y=h[o];if(!y.cancelled&&(y.callback(n),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Zo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var iu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},wc=p.window.HTMLImageElement,ic=p.window.HTMLElement,ia=p.window.ImageBitmap,Do={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Uc=function(n){function u(h){var y=this;if((h=p.extend({},Do,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var b=new ra(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(n.call(this,b,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Zo,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},iu,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof ic))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return y._update(!1)}),this.on("moveend",function(){return y._update(!1)}),this.on("zoom",function(){return y._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Kn(this,h),this._hash=h.hash&&new Cs(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new as({customAttribution:h.customAttribution})),this.addControl(new js,h.logoPosition),this.on("style.load",function(){y.transform.unmodified&&y.jumpTo(y.style.stylesheet)}),this.on("data",function(P){y._update(P.dataType==="style"),y.fire(new p.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){y.fire(new p.Event(P.dataType+"dataloading",P))})}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,y){if(y===void 0&&(y=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var b=h.onAdd(this);this._controls.push(h);var P=this._controlPositions[y];return y.indexOf("bottom")!==-1?P.insertBefore(b,P.firstChild):P.appendChild(b),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var y=this._controls.indexOf(h);return y>-1&&this._controls.splice(y,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var y=this._containerDimensions(),b=y[0],P=y[1];this._resizeCanvas(b,P),this.transform.resize(b,P),this.painter.resize(b,P);var F=!this._moving;return F&&(this.stop(),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h))),this.fire(new p.Event("resize",h)),F&&this.fire(new p.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,y,b){var P,F=this;if(h==="mouseenter"||h==="mouseover"){var H=!1;return{layer:y,listener:b,delegates:{mousemove:function(xe){var we=F.getLayer(y)?F.queryRenderedFeatures(xe.point,{layers:[y]}):[];we.length?H||(H=!0,b.call(F,new Ro(h,F,xe.originalEvent,{features:we}))):H=!1},mouseout:function(){H=!1}}}}if(h==="mouseleave"||h==="mouseout"){var ae=!1;return{layer:y,listener:b,delegates:{mousemove:function(xe){(F.getLayer(y)?F.queryRenderedFeatures(xe.point,{layers:[y]}):[]).length?ae=!0:ae&&(ae=!1,b.call(F,new Ro(h,F,xe.originalEvent)))},mouseout:function(xe){ae&&(ae=!1,b.call(F,new Ro(h,F,xe.originalEvent)))}}}}return{layer:y,listener:b,delegates:(P={},P[h]=function(xe){var we=F.getLayer(y)?F.queryRenderedFeatures(xe.point,{layers:[y]}):[];we.length&&(xe.features=we,b.call(F,xe),delete xe.features)},P)}},u.prototype.on=function(h,y,b){if(b===void 0)return n.prototype.on.call(this,h,y);var P=this._createDelegatedListener(h,y,b);for(var F in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(P),P.delegates)this.on(F,P.delegates[F]);return this},u.prototype.once=function(h,y,b){if(b===void 0)return n.prototype.once.call(this,h,y);var P=this._createDelegatedListener(h,y,b);for(var F in P.delegates)this.once(F,P.delegates[F]);return this},u.prototype.off=function(h,y,b){var P=this;return b===void 0?n.prototype.off.call(this,h,y):(this._delegatedListeners&&this._delegatedListeners[h]&&function(F){for(var H=F[h],ae=0;ae<H.length;ae++){var xe=H[ae];if(xe.layer===y&&xe.listener===b){for(var we in xe.delegates)P.off(we,xe.delegates[we]);return H.splice(ae,1),P}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,y){if(!this.style)return[];var b;if(y!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(y=h,h=void 0),y=y||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")b=[p.Point.convert(h)];else{var P=p.Point.convert(h[0]),F=p.Point.convert(h[1]);b=[P,new p.Point(F.x,P.y),F,new p.Point(P.x,F.y),P]}return this.style.queryRenderedFeatures(b,y,this.transform)},u.prototype.querySourceFeatures=function(h,y){return this.style.querySourceFeatures(h,y)},u.prototype.setStyle=function(h,y){return(y=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},y)).diff!==!1&&y.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,y),this):(this._localIdeographFontFamily=y.localIdeographFontFamily,this._updateStyle(h,y))},u.prototype._getUIString=function(h){var y=this._locale[h];if(y==null)throw new Error("Missing UI string '"+h+"'");return y},u.prototype._updateStyle=function(h,y){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new ns(this,y||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ns(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,y){var b=this;if(typeof h=="string"){var P=this._requestManager.normalizeStyleURL(h),F=this._requestManager.transformRequest(P,p.ResourceType.Style);p.getJSON(F,function(H,ae){H?b.fire(new p.ErrorEvent(H)):ae&&b._updateDiff(ae,y)})}else typeof h=="object"&&this._updateDiff(h,y)},u.prototype._updateDiff=function(h,y){try{this.style.setState(h)&&this._update(!0)}catch(b){p.warnOnce("Unable to perform style diff: "+(b.message||b.error||b)+".  Rebuilding the style from scratch."),this._updateStyle(h,y)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,y){return this._lazyInitEmptyStyle(),this.style.addSource(h,y),this._update(!0)},u.prototype.isSourceLoaded=function(h){var y=this.style&&this.style.sourceCaches[h];if(y!==void 0)return y.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var y in h){var b=h[y]._tiles;for(var P in b){var F=b[P];if(F.state!=="loaded"&&F.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,y,b){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,y,b)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,y,b){b===void 0&&(b={});var P=b.pixelRatio;P===void 0&&(P=1);var F=b.sdf;F===void 0&&(F=!1);var H=b.stretchX,ae=b.stretchY,xe=b.content;if(this._lazyInitEmptyStyle(),y instanceof wc||ia&&y instanceof ia){var we=p.browser.getImageData(y);this.style.addImage(h,{data:new p.RGBAImage({width:we.width,height:we.height},we.data),pixelRatio:P,stretchX:H,stretchY:ae,content:xe,sdf:F,version:0})}else{if(y.width===void 0||y.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Te=y;this.style.addImage(h,{data:new p.RGBAImage({width:y.width,height:y.height},new Uint8Array(y.data)),pixelRatio:P,stretchX:H,stretchY:ae,content:xe,sdf:F,version:0,userImage:Te}),Te.onAdd&&Te.onAdd(this,h)}},u.prototype.updateImage=function(h,y){var b=this.style.getImage(h);if(!b)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=y instanceof wc||ia&&y instanceof ia?p.browser.getImageData(y):y,F=P.width,H=P.height,ae=P.data;return F===void 0||H===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):F!==b.data.width||H!==b.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(b.data.replace(ae,!(y instanceof wc||ia&&y instanceof ia)),void this.style.updateImage(h,b))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,y){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),y)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,y){return this._lazyInitEmptyStyle(),this.style.addLayer(h,y),this._update(!0)},u.prototype.moveLayer=function(h,y){return this.style.moveLayer(h,y),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,y,b){return this.style.setLayerZoomRange(h,y,b),this._update(!0)},u.prototype.setFilter=function(h,y,b){return b===void 0&&(b={}),this.style.setFilter(h,y,b),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,y,b,P){return P===void 0&&(P={}),this.style.setPaintProperty(h,y,b,P),this._update(!0)},u.prototype.getPaintProperty=function(h,y){return this.style.getPaintProperty(h,y)},u.prototype.setLayoutProperty=function(h,y,b,P){return P===void 0&&(P={}),this.style.setLayoutProperty(h,y,b,P),this._update(!0)},u.prototype.getLayoutProperty=function(h,y){return this.style.getLayoutProperty(h,y)},u.prototype.setLight=function(h,y){return y===void 0&&(y={}),this._lazyInitEmptyStyle(),this.style.setLight(h,y),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,y){return this.style.setFeatureState(h,y),this._update()},u.prototype.removeFeatureState=function(h,y){return this.style.removeFeatureState(h,y),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,y=0;return this._container&&(h=this._container.clientWidth||400,y=this._container.clientHeight||300),[h,y]},u.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=q.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var y=this._canvasContainer=q.create("div","mapboxgl-canvas-container",h);this._interactive&&y.classList.add("mapboxgl-interactive"),this._canvas=q.create("canvas","mapboxgl-canvas",y),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var b=this._containerDimensions();this._resizeCanvas(b[0],b[1]);var P=this._controlContainer=q.create("div","mapboxgl-control-container",h),F=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(H){F[H]=q.create("div","mapboxgl-ctrl-"+H,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,y){var b=p.browser.devicePixelRatio||1;this._canvas.width=b*h,this._canvas.height=b*y,this._canvas.style.width=h+"px",this._canvas.style.height=y+"px"},u.prototype._setupPainter=function(){var h=p.extend({},w.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),y=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);y?(this.painter=new Ya(y,this.transform),p.webpSupported.testSupport(y)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var y,b=this,P=0,F=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(y=F.createQueryEXT(),F.beginQueryEXT(F.TIME_ELAPSED_EXT,y),P=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var H=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ae=this.transform.zoom,xe=p.browser.now();this.style.zoomHistory.update(ae,xe);var we=new p.EvaluationParameters(ae,{now:xe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Te=we.crossFadingFactor();Te===1&&Te===this._crossFadingFactor||(H=!0,this._crossFadingFactor=Te),this.style.update(we)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||H)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var He=p.browser.now()-P;F.endQueryEXT(F.TIME_ELAPSED_EXT,y),setTimeout(function(){var ze=F.getQueryObjectEXT(y,F.QUERY_RESULT_EXT)/1e6;F.deleteQueryEXT(y),b.fire(new p.Event("gpu-timing-frame",{cpuTime:He,gpuTime:ze}))},50)}if(this.listens("gpu-timing-layer")){var je=this.painter.collectGpuTimers();setTimeout(function(){var ze=b.painter.queryGpuTimers(je);b.fire(new p.Event("gpu-timing-layer",{layerTimes:ze}))},50)}var it=this._sourcesDirty||this._styleDirty||this._placementDirty;return it||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||it||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,y=this._controls;h<y.length;h+=1)y[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),gs(this._canvasContainer),gs(this._controlContainer),gs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(y){h._frame=null,h._render(y)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,y){p.setCacheLimits(h,y)},o.version.get=function(){return p.version},Object.defineProperties(u.prototype,o),u}(Ml);function gs(n){n.parentNode&&n.parentNode.removeChild(n)}var Il={showCompass:!0,showZoom:!0,visualizePitch:!1},Ms=function(n){var u=this;this.options=p.extend({},Il,n),this._container=q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(o){return o.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(o){return u._map.zoomIn({},{originalEvent:o})}),q.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(o){return u._map.zoomOut({},{originalEvent:o})}),q.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(o){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:o}):u._map.resetNorth({},{originalEvent:o})}),this._compassIcon=q.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Ms.prototype._updateZoomButtons=function(){var n=this._map.getZoom(),u=n===this._map.getMaxZoom(),o=n===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},Ms.prototype._rotateCompassArrow=function(){var n=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=n},Ms.prototype.onAdd=function(n){return this._map=n,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new os(this._map,this._compass,this.options.visualizePitch)),this._container},Ms.prototype.onRemove=function(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ms.prototype._createButton=function(n,u){var o=q.create("button",n,this._container);return o.type="button",o.addEventListener("click",u),o},Ms.prototype._setButtonTitle=function(n,u){var o=this._map._getUIString("NavigationControl."+u);n.title=o,n.setAttribute("aria-label",o)};var os=function(n,u,o){o===void 0&&(o=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new rc({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,o&&(this.mousePitch=new Lu({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),q.addEventListener(u,"mousedown",this.mousedown),q.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(u,"touchmove",this.touchmove),q.addEventListener(u,"touchend",this.touchend),q.addEventListener(u,"touchcancel",this.reset)};function hl(n,u,o){if(n=new p.LngLat(n.lng,n.lat),u){var h=new p.LngLat(n.lng-360,n.lat),y=new p.LngLat(n.lng+360,n.lat),b=o.locationPoint(n).distSqr(u);o.locationPoint(h).distSqr(u)<b?n=h:o.locationPoint(y).distSqr(u)<b&&(n=y)}for(;Math.abs(n.lng-o.center.lng)>180;){var P=o.locationPoint(n);if(P.x>=0&&P.y>=0&&P.x<=o.width&&P.y<=o.height)break;n.lng>o.center.lng?n.lng-=360:n.lng+=360}return n}os.prototype.down=function(n,u){this.mouseRotate.mousedown(n,u),this.mousePitch&&this.mousePitch.mousedown(n,u),q.disableDrag()},os.prototype.move=function(n,u){var o=this.map,h=this.mouseRotate.mousemoveWindow(n,u);if(h&&h.bearingDelta&&o.setBearing(o.getBearing()+h.bearingDelta),this.mousePitch){var y=this.mousePitch.mousemoveWindow(n,u);y&&y.pitchDelta&&o.setPitch(o.getPitch()+y.pitchDelta)}},os.prototype.off=function(){var n=this.element;q.removeEventListener(n,"mousedown",this.mousedown),q.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(n,"touchmove",this.touchmove),q.removeEventListener(n,"touchend",this.touchend),q.removeEventListener(n,"touchcancel",this.reset),this.offTemp()},os.prototype.offTemp=function(){q.enableDrag(),q.removeEventListener(p.window,"mousemove",this.mousemove),q.removeEventListener(p.window,"mouseup",this.mouseup)},os.prototype.mousedown=function(n){this.down(p.extend({},n,{ctrlKey:!0,preventDefault:function(){return n.preventDefault()}}),q.mousePos(this.element,n)),q.addEventListener(p.window,"mousemove",this.mousemove),q.addEventListener(p.window,"mouseup",this.mouseup)},os.prototype.mousemove=function(n){this.move(n,q.mousePos(this.element,n))},os.prototype.mouseup=function(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()},os.prototype.touchstart=function(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return n.preventDefault()}},this._startPos))},os.prototype.touchmove=function(n){n.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:function(){return n.preventDefault()}},this._lastPos))},os.prototype.touchend=function(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},os.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var au={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ac(n,u,o){var h=n.classList;for(var y in au)h.remove("mapboxgl-"+o+"-anchor-"+y);h.add("mapboxgl-"+o+"-anchor-"+u)}var Wu,Xu=function(n){function u(o,h){if(n.call(this),(o instanceof p.window.HTMLElement||h)&&(o=p.extend({element:o},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=p.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div"),this._element.setAttribute("aria-label","Map marker");var y=q.createNS("http://www.w3.org/2000/svg","svg");y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height","41px"),y.setAttributeNS(null,"width","27px"),y.setAttributeNS(null,"viewBox","0 0 27 41");var b=q.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");var P=q.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var F=q.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");for(var H=0,ae=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];H<ae.length;H+=1){var xe=ae[H],we=q.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",xe.rx),we.setAttributeNS(null,"ry",xe.ry),F.appendChild(we)}var Te=q.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"fill",this._color);var He=q.createNS("http://www.w3.org/2000/svg","path");He.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Te.appendChild(He);var je=q.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"opacity","0.25"),je.setAttributeNS(null,"fill","#000000");var it=q.createNS("http://www.w3.org/2000/svg","path");it.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),je.appendChild(it);var ze=q.createNS("http://www.w3.org/2000/svg","g");ze.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ze.setAttributeNS(null,"fill","#FFFFFF");var at=q.createNS("http://www.w3.org/2000/svg","g");at.setAttributeNS(null,"transform","translate(8.0, 8.0)");var xt=q.createNS("http://www.w3.org/2000/svg","circle");xt.setAttributeNS(null,"fill","#000000"),xt.setAttributeNS(null,"opacity","0.25"),xt.setAttributeNS(null,"cx","5.5"),xt.setAttributeNS(null,"cy","5.5"),xt.setAttributeNS(null,"r","5.4999962");var jt=q.createNS("http://www.w3.org/2000/svg","circle");jt.setAttributeNS(null,"fill","#FFFFFF"),jt.setAttributeNS(null,"cx","5.5"),jt.setAttributeNS(null,"cy","5.5"),jt.setAttributeNS(null,"r","5.4999962"),at.appendChild(xt),at.appendChild(jt),P.appendChild(F),P.appendChild(Te),P.appendChild(je),P.appendChild(ze),P.appendChild(at),y.appendChild(P),y.setAttributeNS(null,"height",41*this._scale+"px"),y.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(y),this._offset=p.Point.convert(o&&o.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(gr){gr.preventDefault()}),this._element.addEventListener("mousedown",function(gr){gr.preventDefault()}),ac(this._element,this._anchor,"marker"),this._popup=null}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(o){var h=o.code,y=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&y!==32&&y!==13||this.togglePopup()},u.prototype._onMapClick=function(o){var h=o.originalEvent.target,y=this._element;this._popup&&(h===y||y.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this},u.prototype._update=function(o){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=hl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y="rotateX("+this._map.getPitch()+"deg)"),o&&o.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,au[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+y+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(o){return this._offset=p.Point.convert(o),this._update(),this},u.prototype._onMove=function(o){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(o){return this._rotation=o||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(o){return this._rotationAlignment=o||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(p.Evented),Zc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ol=0,pl=!1,jc=function(n){function u(o){n.call(this),this.options=p.extend({},Zc,o),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(o){var h;return this._map=o,this._container=q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,Wu!==void 0?h(Wu):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(y){h(Wu=y.state!=="denied")}):h(Wu=!!p.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ol=0,pl=!1},u.prototype._isOutOfMapMaxBounds=function(o){var h=this._map.getMaxBounds(),y=o.coords;return h&&(y.longitude<h.getWest()||y.longitude>h.getEast()||y.latitude<h.getSouth()||y.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(o){if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",o)),this._finish()}},u.prototype._updateCamera=function(o){var h=new p.LngLat(o.coords.longitude,o.coords.latitude),y=o.coords.accuracy,b=this._map.getBearing(),P=p.extend({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(y),P,{geolocateSource:!0})},u.prototype._updateMarker=function(o){if(o){var h=new p.LngLat(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var o=this._map._container.clientHeight/2,h=this._map.unproject([0,o]),y=this._map.unproject([1,o]),b=h.distanceTo(y),P=Math.ceil(2*this._accuracy/b);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(o){if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&pl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",o)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(o){var h=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=q.create("button","mapboxgl-ctrl-geolocate",this._container),q.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",o===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y)}else{var b=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Xu(this._dotElement),this._circleElement=q.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||h._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ol--,pl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var o;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ol>1?(o={maximumAge:6e5,timeout:0},pl=!0):(o=this.options.positionOptions,pl=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,o)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(p.Evented),Yu={maxWidth:100,unit:"metric"},Ru=function(n){this.options=p.extend({},Yu,n),p.bindAll(["_onMove","setUnit"],this)};function oc(n,u,o){var h=o&&o.maxWidth||100,y=n._container.clientHeight/2,b=n.unproject([0,y]),P=n.unproject([h,y]),F=b.distanceTo(P);if(o&&o.unit==="imperial"){var H=3.2808*F;H>5280?Du(u,h,H/5280,n._getUIString("ScaleControl.Miles")):Du(u,h,H,n._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Du(u,h,F/1852,n._getUIString("ScaleControl.NauticalMiles")):F>=1e3?Du(u,h,F/1e3,n._getUIString("ScaleControl.Kilometers")):Du(u,h,F,n._getUIString("ScaleControl.Meters"))}function Du(n,u,o,h){var y,b,P,F=(y=o,(b=Math.pow(10,(""+Math.floor(y)).length-1))*(P=(P=y/b)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(H){var ae=Math.pow(10,Math.ceil(-Math.log(H)/Math.LN10));return Math.round(H*ae)/ae}(P)));n.style.width=u*(F/o)+"px",n.innerHTML=F+"&nbsp;"+h}Ru.prototype.getDefaultPosition=function(){return"bottom-left"},Ru.prototype._onMove=function(){oc(this._map,this._container,this.options)},Ru.prototype.onAdd=function(n){return this._map=n,this._container=q.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",n.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Ru.prototype.onRemove=function(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Ru.prototype.setUnit=function(n){this.options.unit=n,oc(this._map,this._container,this.options)};var Vs=function(n){this._fullscreen=!1,n&&n.container&&(n.container instanceof p.window.HTMLElement?this._container=n.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};Vs.prototype.onAdd=function(n){return this._map=n,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Vs.prototype.onRemove=function(){q.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Vs.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},Vs.prototype._setupUI=function(){var n=this._fullscreenButton=q.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);q.create("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden",!0),n.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Vs.prototype._updateTitle=function(){var n=this._getTitle();this._fullscreenButton.setAttribute("aria-label",n),this._fullscreenButton.title=n},Vs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Vs.prototype._isFullscreen=function(){return this._fullscreen},Vs.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Vs.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Ac={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},sc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),uc=function(n){function u(o){n.call(this),this.options=p.extend(Object.create(Ac),o),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(o){return this._map&&this.remove(),this._map=o,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(o){return this.setDOMContent(p.window.document.createTextNode(o))},u.prototype.setHTML=function(o){var h,y=p.window.document.createDocumentFragment(),b=p.window.document.createElement("body");for(b.innerHTML=o;h=b.firstChild;)y.appendChild(h);return this.setDOMContent(y)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(o){return this.options.maxWidth=o,this._update(),this},u.prototype.setDOMContent=function(o){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(o),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(o){this._container&&this._container.classList.add(o)},u.prototype.removeClassName=function(o){this._container&&this._container.classList.remove(o)},u.prototype.setOffset=function(o){return this.options.offset=o,this._update(),this},u.prototype.toggleClassName=function(o){if(this._container)return this._container.classList.toggle(o)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=q.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(o){this._update(o.point)},u.prototype._onMouseMove=function(o){this._update(o.point)},u.prototype._onDrag=function(o){this._update(o.point)},u.prototype._update=function(o){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=q.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=q.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(we){return h._container.classList.add(we)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||o)){var y=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat),b=this.options.anchor,P=function we(Te){if(Te){if(typeof Te=="number"){var He=Math.round(Math.sqrt(.5*Math.pow(Te,2)));return{center:new p.Point(0,0),top:new p.Point(0,Te),"top-left":new p.Point(He,He),"top-right":new p.Point(-He,He),bottom:new p.Point(0,-Te),"bottom-left":new p.Point(He,-He),"bottom-right":new p.Point(-He,-He),left:new p.Point(Te,0),right:new p.Point(-Te,0)}}if(Te instanceof p.Point||Array.isArray(Te)){var je=p.Point.convert(Te);return{center:je,top:je,"top-left":je,"top-right":je,bottom:je,"bottom-left":je,"bottom-right":je,left:je,right:je}}return{center:p.Point.convert(Te.center||[0,0]),top:p.Point.convert(Te.top||[0,0]),"top-left":p.Point.convert(Te["top-left"]||[0,0]),"top-right":p.Point.convert(Te["top-right"]||[0,0]),bottom:p.Point.convert(Te.bottom||[0,0]),"bottom-left":p.Point.convert(Te["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(Te["bottom-right"]||[0,0]),left:p.Point.convert(Te.left||[0,0]),right:p.Point.convert(Te.right||[0,0])}}return we(new p.Point(0,0))}(this.options.offset);if(!b){var F,H=this._container.offsetWidth,ae=this._container.offsetHeight;F=y.y+P.bottom.y<ae?["top"]:y.y>this._map.transform.height-ae?["bottom"]:[],y.x<H/2?F.push("left"):y.x>this._map.transform.width-H/2&&F.push("right"),b=F.length===0?"bottom":F.join("-")}var xe=y.add(P[b]).round();q.setTransform(this._container,au[b]+" translate("+xe.x+"px,"+xe.y+"px)"),ac(this._container,b,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var o=this._container.querySelector(sc);o&&o.focus()}},u.prototype._onClose=function(){this.remove()},u}(p.Evented),Ku={version:p.version,supported:w,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:Uc,NavigationControl:Ms,GeolocateControl:jc,AttributionControl:as,ScaleControl:Ru,FullscreenControl:Vs,Popup:uc,Marker:Xu,Style:ns,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){$t().acquire(Qt)},clearPrewarmedResources:function(){var n=kn;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(Qt),kn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(n){p.config.ACCESS_TOKEN=n},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(n){p.config.API_URL=n},get workerCount(){return Rr.workerCount},set workerCount(n){Rr.workerCount=n},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(n){p.config.MAX_PARALLEL_IMAGE_REQUESTS=n},clearStorage:function(n){p.clearTileCache(n)},workerUrl:""};return Ku}),ue})},78892:function(Lr,U,S){var ue=S(97671);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var C;(function(p){(function(w){var q=typeof S.g=="object"?S.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),K=W(p);typeof q.Reflect=="undefined"?q.Reflect=p:K=W(q.Reflect,K),w(K);function W(L,N){return function(Ne,Ye){typeof L[Ne]!="function"&&Object.defineProperty(L,Ne,{configurable:!0,writable:!0,value:Ye}),N&&N(Ne,Ye)}}})(function(w){var q=Object.prototype.hasOwnProperty,K=typeof Symbol=="function",W=K&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",L=K&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",N=typeof Object.create=="function",Ne={__proto__:[]}instanceof Array,Ye=!N&&!Ne,Je={create:N?function(){return Nr(Object.create(null))}:Ne?function(){return Nr({__proto__:null})}:function(){return Nr({})},has:Ye?function(tt,mt){return q.call(tt,mt)}:function(tt,mt){return mt in tt},get:Ye?function(tt,mt){return q.call(tt,mt)?tt[mt]:void 0}:function(tt,mt){return tt[mt]}},rt=Object.getPrototypeOf(Function),Xt=typeof ue=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Gt=!Xt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ie(),nr=!Xt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:sr(),Ut=!Xt&&typeof WeakMap=="function"?WeakMap:Mr(),At=new Ut;function Et(tt,mt,yt,hr){if(mn(yt)){if(!E(tt))throw new TypeError;if(!be(mt))throw new TypeError;return ur(tt,mt)}else{if(!E(tt))throw new TypeError;if(!pe(mt))throw new TypeError;if(!pe(hr)&&!mn(hr)&&!Xi(hr))throw new TypeError;return Xi(hr)&&(hr=void 0),yt=tr(yt),Ur(tt,mt,yt,hr)}}w("decorate",Et);function dr(tt,mt){function yt(hr,Gr){if(!pe(hr))throw new TypeError;if(!mn(Gr)&&!Ge(Gr))throw new TypeError;zt(tt,mt,hr,Gr)}return yt}w("metadata",dr);function re(tt,mt,yt,hr){if(!pe(yt))throw new TypeError;return mn(hr)||(hr=tr(hr)),zt(tt,mt,yt,hr)}w("defineMetadata",re);function mr(tt,mt,yt){if(!pe(mt))throw new TypeError;return mn(yt)||(yt=tr(yt)),Re(tt,mt,yt)}w("hasMetadata",mr);function wt(tt,mt,yt){if(!pe(mt))throw new TypeError;return mn(yt)||(yt=tr(yt)),ge(tt,mt,yt)}w("hasOwnMetadata",wt);function Ke(tt,mt,yt){if(!pe(mt))throw new TypeError;return mn(yt)||(yt=tr(yt)),_t(tt,mt,yt)}w("getMetadata",Ke);function Dt(tt,mt,yt){if(!pe(mt))throw new TypeError;return mn(yt)||(yt=tr(yt)),pt(tt,mt,yt)}w("getOwnMetadata",Dt);function Xe(tt,mt){if(!pe(tt))throw new TypeError;return mn(mt)||(mt=tr(mt)),Ft(tt,mt)}w("getMetadataKeys",Xe);function Zt(tt,mt){if(!pe(tt))throw new TypeError;return mn(mt)||(mt=tr(mt)),Dr(tt,mt)}w("getOwnMetadataKeys",Zt);function yr(tt,mt,yt){if(!pe(mt))throw new TypeError;mn(yt)||(yt=tr(yt));var hr=he(mt,yt,!1);if(mn(hr)||!hr.delete(tt))return!1;if(hr.size>0)return!0;var Gr=At.get(mt);return Gr.delete(yt),Gr.size>0||At.delete(mt),!0}w("deleteMetadata",yr);function ur(tt,mt){for(var yt=tt.length-1;yt>=0;--yt){var hr=tt[yt],Gr=hr(mt);if(!mn(Gr)&&!Xi(Gr)){if(!be(Gr))throw new TypeError;mt=Gr}}return mt}function Ur(tt,mt,yt,hr){for(var Gr=tt.length-1;Gr>=0;--Gr){var Zr=tt[Gr],Jr=Zr(mt,yt,hr);if(!mn(Jr)&&!Xi(Jr)){if(!pe(Jr))throw new TypeError;hr=Jr}}return hr}function he(tt,mt,yt){var hr=At.get(tt);if(mn(hr)){if(!yt)return;hr=new Gt,At.set(tt,hr)}var Gr=hr.get(mt);if(mn(Gr)){if(!yt)return;Gr=new Gt,hr.set(mt,Gr)}return Gr}function Re(tt,mt,yt){var hr=ge(tt,mt,yt);if(hr)return!0;var Gr=qt(mt);return Xi(Gr)?!1:Re(tt,Gr,yt)}function ge(tt,mt,yt){var hr=he(mt,yt,!1);return mn(hr)?!1:Le(hr.has(tt))}function _t(tt,mt,yt){var hr=ge(tt,mt,yt);if(hr)return pt(tt,mt,yt);var Gr=qt(mt);if(!Xi(Gr))return _t(tt,Gr,yt)}function pt(tt,mt,yt){var hr=he(mt,yt,!1);if(!mn(hr))return hr.get(tt)}function zt(tt,mt,yt,hr){var Gr=he(yt,hr,!0);Gr.set(tt,mt)}function Ft(tt,mt){var yt=Dr(tt,mt),hr=qt(tt);if(hr===null)return yt;var Gr=Ft(hr,mt);if(Gr.length<=0)return yt;if(yt.length<=0)return Gr;for(var Zr=new nr,Jr=[],qr=0,Er=yt;qr<Er.length;qr++){var Jn=Er[qr],Wn=Zr.has(Jn);Wn||(Zr.add(Jn),Jr.push(Jn))}for(var Ti=0,$i=Gr;Ti<$i.length;Ti++){var Jn=$i[Ti],Wn=Zr.has(Jn);Wn||(Zr.add(Jn),Jr.push(Jn))}return Jr}function Dr(tt,mt){var yt=[],hr=he(tt,mt,!1);if(mn(hr))return yt;for(var Gr=hr.keys(),Zr=gt(Gr),Jr=0;;){var qr=Ct(Zr);if(!qr)return yt.length=Jr,yt;var Er=St(qr);try{yt[Jr]=Er}catch(Jn){try{Vt(Zr)}finally{throw Jn}}Jr++}}function pn(tt){if(tt===null)return 1;switch(typeof tt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return tt===null?1:6;default:return 6}}function mn(tt){return tt===void 0}function Xi(tt){return tt===null}function ir(tt){return typeof tt=="symbol"}function pe(tt){return typeof tt=="object"?tt!==null:typeof tt=="function"}function Pe(tt,mt){switch(pn(tt)){case 0:return tt;case 1:return tt;case 2:return tt;case 3:return tt;case 4:return tt;case 5:return tt}var yt=mt===3?"string":mt===5?"number":"default",hr=qe(tt,W);if(hr!==void 0){var Gr=hr.call(tt,yt);if(pe(Gr))throw new TypeError;return Gr}return Ze(tt,yt==="default"?"number":yt)}function Ze(tt,mt){if(mt==="string"){var yt=tt.toString;if(Z(yt)){var hr=yt.call(tt);if(!pe(hr))return hr}var Gr=tt.valueOf;if(Z(Gr)){var hr=Gr.call(tt);if(!pe(hr))return hr}}else{var Gr=tt.valueOf;if(Z(Gr)){var hr=Gr.call(tt);if(!pe(hr))return hr}var Zr=tt.toString;if(Z(Zr)){var hr=Zr.call(tt);if(!pe(hr))return hr}}throw new TypeError}function Le(tt){return!!tt}function It(tt){return""+tt}function tr(tt){var mt=Pe(tt,3);return ir(mt)?mt:It(mt)}function E(tt){return Array.isArray?Array.isArray(tt):tt instanceof Object?tt instanceof Array:Object.prototype.toString.call(tt)==="[object Array]"}function Z(tt){return typeof tt=="function"}function be(tt){return typeof tt=="function"}function Ge(tt){switch(pn(tt)){case 3:return!0;case 4:return!0;default:return!1}}function qe(tt,mt){var yt=tt[mt];if(yt!=null){if(!Z(yt))throw new TypeError;return yt}}function gt(tt){var mt=qe(tt,L);if(!Z(mt))throw new TypeError;var yt=mt.call(tt);if(!pe(yt))throw new TypeError;return yt}function St(tt){return tt.value}function Ct(tt){var mt=tt.next();return mt.done?!1:mt}function Vt(tt){var mt=tt.return;mt&&mt.call(tt)}function qt(tt){var mt=Object.getPrototypeOf(tt);if(typeof tt!="function"||tt===rt||mt!==rt)return mt;var yt=tt.prototype,hr=yt&&Object.getPrototypeOf(yt);if(hr==null||hr===Object.prototype)return mt;var Gr=hr.constructor;return typeof Gr!="function"||Gr===tt?mt:Gr}function ie(){var tt={},mt=[],yt=function(){function Jr(qr,Er,Jn){this._index=0,this._keys=qr,this._values=Er,this._selector=Jn}return Jr.prototype["@@iterator"]=function(){return this},Jr.prototype[L]=function(){return this},Jr.prototype.next=function(){var qr=this._index;if(qr>=0&&qr<this._keys.length){var Er=this._selector(this._keys[qr],this._values[qr]);return qr+1>=this._keys.length?(this._index=-1,this._keys=mt,this._values=mt):this._index++,{value:Er,done:!1}}return{value:void 0,done:!0}},Jr.prototype.throw=function(qr){throw this._index>=0&&(this._index=-1,this._keys=mt,this._values=mt),qr},Jr.prototype.return=function(qr){return this._index>=0&&(this._index=-1,this._keys=mt,this._values=mt),{value:qr,done:!0}},Jr}();return function(){function Jr(){this._keys=[],this._values=[],this._cacheKey=tt,this._cacheIndex=-2}return Object.defineProperty(Jr.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Jr.prototype.has=function(qr){return this._find(qr,!1)>=0},Jr.prototype.get=function(qr){var Er=this._find(qr,!1);return Er>=0?this._values[Er]:void 0},Jr.prototype.set=function(qr,Er){var Jn=this._find(qr,!0);return this._values[Jn]=Er,this},Jr.prototype.delete=function(qr){var Er=this._find(qr,!1);if(Er>=0){for(var Jn=this._keys.length,Wn=Er+1;Wn<Jn;Wn++)this._keys[Wn-1]=this._keys[Wn],this._values[Wn-1]=this._values[Wn];return this._keys.length--,this._values.length--,qr===this._cacheKey&&(this._cacheKey=tt,this._cacheIndex=-2),!0}return!1},Jr.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=tt,this._cacheIndex=-2},Jr.prototype.keys=function(){return new yt(this._keys,this._values,hr)},Jr.prototype.values=function(){return new yt(this._keys,this._values,Gr)},Jr.prototype.entries=function(){return new yt(this._keys,this._values,Zr)},Jr.prototype["@@iterator"]=function(){return this.entries()},Jr.prototype[L]=function(){return this.entries()},Jr.prototype._find=function(qr,Er){return this._cacheKey!==qr&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=qr)),this._cacheIndex<0&&Er&&(this._cacheIndex=this._keys.length,this._keys.push(qr),this._values.push(void 0)),this._cacheIndex},Jr}();function hr(Jr,qr){return Jr}function Gr(Jr,qr){return qr}function Zr(Jr,qr){return[Jr,qr]}}function sr(){return function(){function tt(){this._map=new Gt}return Object.defineProperty(tt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),tt.prototype.has=function(mt){return this._map.has(mt)},tt.prototype.add=function(mt){return this._map.set(mt,mt),this},tt.prototype.delete=function(mt){return this._map.delete(mt)},tt.prototype.clear=function(){this._map.clear()},tt.prototype.keys=function(){return this._map.keys()},tt.prototype.values=function(){return this._map.values()},tt.prototype.entries=function(){return this._map.entries()},tt.prototype["@@iterator"]=function(){return this.keys()},tt.prototype[L]=function(){return this.keys()},tt}()}function Mr(){var tt=16,mt=Je.create(),yt=hr();return function(){function Er(){this._key=hr()}return Er.prototype.has=function(Jn){var Wn=Gr(Jn,!1);return Wn!==void 0?Je.has(Wn,this._key):!1},Er.prototype.get=function(Jn){var Wn=Gr(Jn,!1);return Wn!==void 0?Je.get(Wn,this._key):void 0},Er.prototype.set=function(Jn,Wn){var Ti=Gr(Jn,!0);return Ti[this._key]=Wn,this},Er.prototype.delete=function(Jn){var Wn=Gr(Jn,!1);return Wn!==void 0?delete Wn[this._key]:!1},Er.prototype.clear=function(){this._key=hr()},Er}();function hr(){var Er;do Er="@@WeakMap@@"+qr();while(Je.has(mt,Er));return mt[Er]=!0,Er}function Gr(Er,Jn){if(!q.call(Er,yt)){if(!Jn)return;Object.defineProperty(Er,yt,{value:Je.create()})}return Er[yt]}function Zr(Er,Jn){for(var Wn=0;Wn<Jn;++Wn)Er[Wn]=Math.random()*255|0;return Er}function Jr(Er){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Er)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Er)):Zr(new Uint8Array(Er),Er):Zr(new Array(Er),Er)}function qr(){var Er=Jr(tt);Er[6]=Er[6]&79|64,Er[8]=Er[8]&191|128;for(var Jn="",Wn=0;Wn<tt;++Wn){var Ti=Er[Wn];(Wn===4||Wn===6||Wn===8)&&(Jn+="-"),Ti<16&&(Jn+="0"),Jn+=Ti.toString(16).toLowerCase()}return Jn}}function Nr(tt){return tt.__=void 0,delete tt.__,tt}})})(C||(C={}))},983:function(Lr){(function(U,S){Lr.exports=S()})(this,function(){"use strict";function U(wt,Ke,Dt,Xe,Zt,yr){if(!(Zt-Xe<=Dt)){var ur=Xe+Zt>>1;S(wt,Ke,ur,Xe,Zt,yr%2),U(wt,Ke,Dt,Xe,ur-1,yr+1),U(wt,Ke,Dt,ur+1,Zt,yr+1)}}function S(wt,Ke,Dt,Xe,Zt,yr){for(;Zt>Xe;){if(Zt-Xe>600){var ur=Zt-Xe+1,Ur=Dt-Xe+1,he=Math.log(ur),Re=.5*Math.exp(2*he/3),ge=.5*Math.sqrt(he*Re*(ur-Re)/ur)*(Ur-ur/2<0?-1:1),_t=Math.max(Xe,Math.floor(Dt-Ur*Re/ur+ge)),pt=Math.min(Zt,Math.floor(Dt+(ur-Ur)*Re/ur+ge));S(wt,Ke,Dt,_t,pt,yr)}var zt=Ke[2*Dt+yr],Ft=Xe,Dr=Zt;for(ue(wt,Ke,Xe,Dt),Ke[2*Zt+yr]>zt&&ue(wt,Ke,Xe,Zt);Ft<Dr;){for(ue(wt,Ke,Ft,Dr),Ft++,Dr--;Ke[2*Ft+yr]<zt;)Ft++;for(;Ke[2*Dr+yr]>zt;)Dr--}Ke[2*Xe+yr]===zt?ue(wt,Ke,Xe,Dr):(Dr++,ue(wt,Ke,Dr,Zt)),Dr<=Dt&&(Xe=Dr+1),Dt<=Dr&&(Zt=Dr-1)}}function ue(wt,Ke,Dt,Xe){C(wt,Dt,Xe),C(Ke,2*Dt,2*Xe),C(Ke,2*Dt+1,2*Xe+1)}function C(wt,Ke,Dt){var Xe=wt[Ke];wt[Ke]=wt[Dt],wt[Dt]=Xe}function p(wt,Ke,Dt,Xe,Zt,yr,ur){for(var Ur=[0,wt.length-1,0],he=[],Re,ge;Ur.length;){var _t=Ur.pop(),pt=Ur.pop(),zt=Ur.pop();if(pt-zt<=ur){for(var Ft=zt;Ft<=pt;Ft++)Re=Ke[2*Ft],ge=Ke[2*Ft+1],Re>=Dt&&Re<=Zt&&ge>=Xe&&ge<=yr&&he.push(wt[Ft]);continue}var Dr=Math.floor((zt+pt)/2);Re=Ke[2*Dr],ge=Ke[2*Dr+1],Re>=Dt&&Re<=Zt&&ge>=Xe&&ge<=yr&&he.push(wt[Dr]);var pn=(_t+1)%2;(_t===0?Dt<=Re:Xe<=ge)&&(Ur.push(zt),Ur.push(Dr-1),Ur.push(pn)),(_t===0?Zt>=Re:yr>=ge)&&(Ur.push(Dr+1),Ur.push(pt),Ur.push(pn))}return he}function w(wt,Ke,Dt,Xe,Zt,yr){for(var ur=[0,wt.length-1,0],Ur=[],he=Zt*Zt;ur.length;){var Re=ur.pop(),ge=ur.pop(),_t=ur.pop();if(ge-_t<=yr){for(var pt=_t;pt<=ge;pt++)q(Ke[2*pt],Ke[2*pt+1],Dt,Xe)<=he&&Ur.push(wt[pt]);continue}var zt=Math.floor((_t+ge)/2),Ft=Ke[2*zt],Dr=Ke[2*zt+1];q(Ft,Dr,Dt,Xe)<=he&&Ur.push(wt[zt]);var pn=(Re+1)%2;(Re===0?Dt-Zt<=Ft:Xe-Zt<=Dr)&&(ur.push(_t),ur.push(zt-1),ur.push(pn)),(Re===0?Dt+Zt>=Ft:Xe+Zt>=Dr)&&(ur.push(zt+1),ur.push(ge),ur.push(pn))}return Ur}function q(wt,Ke,Dt,Xe){var Zt=wt-Dt,yr=Ke-Xe;return Zt*Zt+yr*yr}var K=function(wt){return wt[0]},W=function(wt){return wt[1]},L=function(Ke,Dt,Xe,Zt,yr){Dt===void 0&&(Dt=K),Xe===void 0&&(Xe=W),Zt===void 0&&(Zt=64),yr===void 0&&(yr=Float64Array),this.nodeSize=Zt,this.points=Ke;for(var ur=Ke.length<65536?Uint16Array:Uint32Array,Ur=this.ids=new ur(Ke.length),he=this.coords=new yr(Ke.length*2),Re=0;Re<Ke.length;Re++)Ur[Re]=Re,he[2*Re]=Dt(Ke[Re]),he[2*Re+1]=Xe(Ke[Re]);U(Ur,he,Zt,0,Ur.length-1,0)};L.prototype.range=function(Ke,Dt,Xe,Zt){return p(this.ids,this.coords,Ke,Dt,Xe,Zt,this.nodeSize)},L.prototype.within=function(Ke,Dt,Xe){return w(this.ids,this.coords,Ke,Dt,Xe,this.nodeSize)};var N={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(wt){return wt}},Ne=Math.fround||function(wt){return function(Ke){return wt[0]=+Ke,wt[0]}}(new Float32Array(1)),Ye=function(Ke){this.options=dr(Object.create(N),Ke),this.trees=new Array(this.options.maxZoom+1)};Ye.prototype.load=function(Ke){var Dt=this.options,Xe=Dt.log,Zt=Dt.minZoom,yr=Dt.maxZoom,ur=Dt.nodeSize;Xe&&console.time("total time");var Ur="prepare "+Ke.length+" points";Xe&&console.time(Ur),this.points=Ke;for(var he=[],Re=0;Re<Ke.length;Re++)!Ke[Re].geometry||he.push(rt(Ke[Re],Re));this.trees[yr+1]=new L(he,re,mr,ur,Float32Array),Xe&&console.timeEnd(Ur);for(var ge=yr;ge>=Zt;ge--){var _t=+Date.now();he=this._cluster(he,ge),this.trees[ge]=new L(he,re,mr,ur,Float32Array),Xe&&console.log("z%d: %d clusters in %dms",ge,he.length,+Date.now()-_t)}return Xe&&console.timeEnd("total time"),this},Ye.prototype.getClusters=function(Ke,Dt){var Xe=((Ke[0]+180)%360+360)%360-180,Zt=Math.max(-90,Math.min(90,Ke[1])),yr=Ke[2]===180?180:((Ke[2]+180)%360+360)%360-180,ur=Math.max(-90,Math.min(90,Ke[3]));if(Ke[2]-Ke[0]>=360)Xe=-180,yr=180;else if(Xe>yr){var Ur=this.getClusters([Xe,Zt,180,ur],Dt),he=this.getClusters([-180,Zt,yr,ur],Dt);return Ur.concat(he)}for(var Re=this.trees[this._limitZoom(Dt)],ge=Re.range(nr(Xe),Ut(ur),nr(yr),Ut(Zt)),_t=[],pt=0,zt=ge;pt<zt.length;pt+=1){var Ft=zt[pt],Dr=Re.points[Ft];_t.push(Dr.numPoints?Xt(Dr):this.points[Dr.index])}return _t},Ye.prototype.getChildren=function(Ke){var Dt=this._getOriginId(Ke),Xe=this._getOriginZoom(Ke),Zt="No cluster with the specified id.",yr=this.trees[Xe];if(!yr)throw new Error(Zt);var ur=yr.points[Dt];if(!ur)throw new Error(Zt);for(var Ur=this.options.radius/(this.options.extent*Math.pow(2,Xe-1)),he=yr.within(ur.x,ur.y,Ur),Re=[],ge=0,_t=he;ge<_t.length;ge+=1){var pt=_t[ge],zt=yr.points[pt];zt.parentId===Ke&&Re.push(zt.numPoints?Xt(zt):this.points[zt.index])}if(Re.length===0)throw new Error(Zt);return Re},Ye.prototype.getLeaves=function(Ke,Dt,Xe){Dt=Dt||10,Xe=Xe||0;var Zt=[];return this._appendLeaves(Zt,Ke,Dt,Xe,0),Zt},Ye.prototype.getTile=function(Ke,Dt,Xe){var Zt=this.trees[this._limitZoom(Ke)],yr=Math.pow(2,Ke),ur=this.options,Ur=ur.extent,he=ur.radius,Re=he/Ur,ge=(Xe-Re)/yr,_t=(Xe+1+Re)/yr,pt={features:[]};return this._addTileFeatures(Zt.range((Dt-Re)/yr,ge,(Dt+1+Re)/yr,_t),Zt.points,Dt,Xe,yr,pt),Dt===0&&this._addTileFeatures(Zt.range(1-Re/yr,ge,1,_t),Zt.points,yr,Xe,yr,pt),Dt===yr-1&&this._addTileFeatures(Zt.range(0,ge,Re/yr,_t),Zt.points,-1,Xe,yr,pt),pt.features.length?pt:null},Ye.prototype.getClusterExpansionZoom=function(Ke){for(var Dt=this._getOriginZoom(Ke)-1;Dt<=this.options.maxZoom;){var Xe=this.getChildren(Ke);if(Dt++,Xe.length!==1)break;Ke=Xe[0].properties.cluster_id}return Dt},Ye.prototype._appendLeaves=function(Ke,Dt,Xe,Zt,yr){for(var ur=this.getChildren(Dt),Ur=0,he=ur;Ur<he.length;Ur+=1){var Re=he[Ur],ge=Re.properties;if(ge&&ge.cluster?yr+ge.point_count<=Zt?yr+=ge.point_count:yr=this._appendLeaves(Ke,ge.cluster_id,Xe,Zt,yr):yr<Zt?yr++:Ke.push(Re),Ke.length===Xe)break}return yr},Ye.prototype._addTileFeatures=function(Ke,Dt,Xe,Zt,yr,ur){for(var Ur=0,he=Ke;Ur<he.length;Ur+=1){var Re=he[Ur],ge=Dt[Re],_t=ge.numPoints,pt=void 0,zt=void 0,Ft=void 0;if(_t)pt=Gt(ge),zt=ge.x,Ft=ge.y;else{var Dr=this.points[ge.index];pt=Dr.properties,zt=nr(Dr.geometry.coordinates[0]),Ft=Ut(Dr.geometry.coordinates[1])}var pn={type:1,geometry:[[Math.round(this.options.extent*(zt*yr-Xe)),Math.round(this.options.extent*(Ft*yr-Zt))]],tags:pt},mn=void 0;_t?mn=ge.id:this.options.generateId?mn=ge.index:this.points[ge.index].id&&(mn=this.points[ge.index].id),mn!==void 0&&(pn.id=mn),ur.features.push(pn)}},Ye.prototype._limitZoom=function(Ke){return Math.max(this.options.minZoom,Math.min(+Ke,this.options.maxZoom+1))},Ye.prototype._cluster=function(Ke,Dt){for(var Xe=[],Zt=this.options,yr=Zt.radius,ur=Zt.extent,Ur=Zt.reduce,he=Zt.minPoints,Re=yr/(ur*Math.pow(2,Dt)),ge=0;ge<Ke.length;ge++){var _t=Ke[ge];if(!(_t.zoom<=Dt)){_t.zoom=Dt;for(var pt=this.trees[Dt+1],zt=pt.within(_t.x,_t.y,Re),Ft=_t.numPoints||1,Dr=Ft,pn=0,mn=zt;pn<mn.length;pn+=1){var Xi=mn[pn],ir=pt.points[Xi];ir.zoom>Dt&&(Dr+=ir.numPoints||1)}if(Dr>=he){for(var pe=_t.x*Ft,Pe=_t.y*Ft,Ze=Ur&&Ft>1?this._map(_t,!0):null,Le=(ge<<5)+(Dt+1)+this.points.length,It=0,tr=zt;It<tr.length;It+=1){var E=tr[It],Z=pt.points[E];if(!(Z.zoom<=Dt)){Z.zoom=Dt;var be=Z.numPoints||1;pe+=Z.x*be,Pe+=Z.y*be,Z.parentId=Le,Ur&&(Ze||(Ze=this._map(_t,!0)),Ur(Ze,this._map(Z)))}}_t.parentId=Le,Xe.push(Je(pe/Dr,Pe/Dr,Le,Dr,Ze))}else if(Xe.push(_t),Dr>1)for(var Ge=0,qe=zt;Ge<qe.length;Ge+=1){var gt=qe[Ge],St=pt.points[gt];St.zoom<=Dt||(St.zoom=Dt,Xe.push(St))}}}return Xe},Ye.prototype._getOriginId=function(Ke){return Ke-this.points.length>>5},Ye.prototype._getOriginZoom=function(Ke){return(Ke-this.points.length)%32},Ye.prototype._map=function(Ke,Dt){if(Ke.numPoints)return Dt?dr({},Ke.properties):Ke.properties;var Xe=this.points[Ke.index].properties,Zt=this.options.map(Xe);return Dt&&Zt===Xe?dr({},Zt):Zt};function Je(wt,Ke,Dt,Xe,Zt){return{x:Ne(wt),y:Ne(Ke),zoom:Infinity,id:Dt,parentId:-1,numPoints:Xe,properties:Zt}}function rt(wt,Ke){var Dt=wt.geometry.coordinates,Xe=Dt[0],Zt=Dt[1];return{x:Ne(nr(Xe)),y:Ne(Ut(Zt)),zoom:Infinity,index:Ke,parentId:-1}}function Xt(wt){return{type:"Feature",id:wt.id,properties:Gt(wt),geometry:{type:"Point",coordinates:[At(wt.x),Et(wt.y)]}}}function Gt(wt){var Ke=wt.numPoints,Dt=Ke>=1e4?Math.round(Ke/1e3)+"k":Ke>=1e3?Math.round(Ke/100)/10+"k":Ke;return dr(dr({},wt.properties),{cluster:!0,cluster_id:wt.id,point_count:Ke,point_count_abbreviated:Dt})}function nr(wt){return wt/360+.5}function Ut(wt){var Ke=Math.sin(wt*Math.PI/180),Dt=.5-.25*Math.log((1+Ke)/(1-Ke))/Math.PI;return Dt<0?0:Dt>1?1:Dt}function At(wt){return(wt-.5)*360}function Et(wt){var Ke=(180-wt*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ke))/Math.PI-90}function dr(wt,Ke){for(var Dt in Ke)wt[Dt]=Ke[Dt];return wt}function re(wt){return wt.x}function mr(wt){return wt.y}return Ye})},48027:function(Lr){Lr.exports.RADIUS=6378137,Lr.exports.FLATTENING=1/298.257223563,Lr.exports.POLAR_RADIUS=63567523142e-4}}]);
